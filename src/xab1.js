e,t===s-1))))})}renderButton(e,t){return r.cloneElement(e,{...(0,l.iv)(e.props.style,this.getButtonStyle(),t&&this.getButtonLastStyle()),hoveredStyle:(0,l.iv)(this.getButtonHoveredStyle(),t&&this.getButtonLastStyle()).style,pressedStyle:this.getButtonPressedStyle()})}renderChild(e,t){if(e&&"object"==typeof e&&"type"in e){if(e.type===g.Z&&r.isValidElement(e))return r.cloneElement(e,{render:(o,i)=>{const n=e.props.render(o,i);return this.renderButton(n,t)}});if(e.type===m.Z&&r.isValidElement(e))return this.renderButton(e,t)}}getContainerStyle(){return{color:this.theme.actionMenuButtonTextColor,fill:this.theme.actionMenuButtonTextColor,fontSize:12,background:this.theme.whiteButtonBackground,boxShadow:this.theme.lightBoxShadow,display:"flex",whiteSpace:"nowrap",borderRadius:p.Z.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:this.environment.device.isMobile?"auto":"none",opacity:this.environment.device.isMobile?1:0,fontFamily:d.Z.getCompositeFontFamily(s.SP).sans,position:"absolute",right:p.Z.horizontal.small,bottom:p.Z.vertical.small,zIndex:2}}getHoveredContainerStyle(){return{pointerEvents:"auto",opacity:1}}getTopContainerStyle(){return{top:p.Z.vertical.small,bottom:void 0}}getButtonLastStyle(){return{borderRight:"none"}}getButtonStyle(){return{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:d.Z.fontWeight.medium,borderRight:`1px solid ${this.theme.regularDividerColor}`,color:this.theme.actionMenuButtonTextColor,fill:this.theme.actionMenuButtonTextColor}}getButtonHoveredStyle(){return{background:this.theme.whiteButtonHoveredBackground}}getButtonPressedStyle(){return{background:this.theme.whiteButtonPressedBackground}}}h.displayName="ActionMenuGroup";const f=h},41464:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(95182),s=o(50906),l=o(68204),c=o(35328),d=o(95802),p=o(8949),u=o(22294),m=o(86486),g=o(27724),h=o(38870);class f extends r.Z{constructor(){super(...arguments),this.handleShortcut=(e,t)=>{if(!this.shouldBeActive())return;const o=g.default.state.stores,i=g.default.state.pivot||o[0],n=i&&d.C.getRectFromStore(i),r=a.lV.find((t=>!!(t.shortcuts||[]).some((t=>t===e))&&l.vG(t,{environment:this.environment,blocks:o,originRect:n,publicEditMode:void 0})));if(r){"keydown"===t.type&&t.preventDefault&&t.preventDefault(),r.action({environment:this.environment,blocks:o,originRect:n,publicEditMode:void 0},t);const e=o[0];let i,a;e&&(i=e.getType(),a=i?(0,c._A)(i,e.getFormat()):void 0),s.trackBlockAction(this.environment,{analyticsName:r.analyticsName,from:"keyboard_shortcut",block_id:null==e?void 0:e.id,block_type:i,is_toggleable:a}),this.enterKeyboardMode()}},this.prevX=void 0,this.prevY=void 0,this.handleWindowMouseMove=e=>{e.clientX===this.prevX&&e.clientY===this.prevY||(this.prevX=e.clientX,this.prevY=e.clientY,this.exitKeyboardMode())},this.shortcuts=this.getShortcutHandlers()}willMount(e){super.willMount(e),window.addEventListener("mousemove",this.handleWindowMouseMove)}willUnmount(){super.willUnmount(),window.removeEventListener("mousemove",this.handleWindowMouseMove)}renderComponent(){return n()(h.Z,{priority:this.props.priority,enable:this.props.capture,shortcuts:this.shortcuts})}getShortcutHandlers(){const e={};for(const t of a.lV)for(const o of t.shortcuts||[])e[o]=e=>this.handleShortcut(o,e);return e}shouldBeActive(){return!this.intercomIsFocused()&&!p.Z.state.isActive}intercomIsFocused(){const e=document.querySelector("#intercom-container");return!(!e||!e.contains(document.activeElement))}enterKeyboardMode(){u.Z.setKeyboardMode(!0),m.default.reset()}exitKeyboardMode(){u.Z.setKeyboardMode(!1)}}f.displayName="ActionRegistryShortcutListener";const v=f},24809:(e,t,o)=>{o.d(t,{Z:()=>W});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(44615),p=o(70921),u=o(63143),m=o(5366),g=o(16287),h=o(19719),f=o(59488),v=o(65598),y=o(23537),b=o(51811),S=o(77907),w=o(2688),k=o(44904),C=o(79315),_=o(61766),M=o(88632),T=o(49085);class I extends T.Z{getInitialState(){return{selectedItems:[]}}}const P=I;var x=o(4761),B=o(68785),Z=o(77137),E=o(43145),R=o(45194),A=o(93481),D=o(97464),F=o.n(D),L=o(52275),V=o(255),N=o(98707);class O extends l.Z{constructor(){super(...arguments),this.storeTypes={store:P},this.renderFilterListItem=(e,t)=>{var o,i;let{disabled:r,onRemove:a,onClick:s}=t;const l=this.styles,c=n()(V.Z,{disabled:r,onClick:a});return n()(L.Z,{title:(null===(o=(i=this.props).getItemLabel)||void 0===o?void 0:o.call(i,e))||e,disabled:r,focused:!1,right:c,style:l.menuItem,desktopTitleStyle:l.menuItemTitle,onClick:s},e)},this.renderItemForSummary=e=>`hello${e}`,this.renderToken=e=>e,this.renderResultMenuItem=(e,t)=>{var o,i;return s.createElement(L.Z,F()({},t,{key:e,title:(null===(o=(i=this.props).getItemLabel)||void 0===o?void 0:o.call(i,e))||e,checkState:this.props.mode===N.z.Pill&&this.stores.store.state.selectedItems.includes(e)}))},this.performRequest=e=>{let{query:t}=e;return Promise.resolve(this.props.options.filter((e=>e.includes(t))))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}}}willMountOrUpdate(e){this.stores.store.setState({selectedItems:e.items})}renderComponent(){const{mode:e,title:t,onChange:o,disabled:i,focused:r,onMenuDismiss:a,items:s,addItemLabel:l,tokenInputPlaceholder:c,resultSectionTitle:d,componentDebugName:p,icon:u}=this.props;return n()(N.Z,{mode:e,hasItemsSelected:this.stores.store.state.selectedItems.length>0,title:t,icon:u,items:s,onChange:e=>{o(e)},disabled:i,focused:r,renderFilter:(e,t)=>this.renderFilterListItem(e,t),renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:l,labelText:{title:t,tokenInputPlaceholder:c,resultSectionTitle:d,componentDebugName:p},performRequest:this.performRequest,renderResultMenuItem:(e,t)=>this.renderResultMenuItem(e,t),onMenuDismiss:a})}}O.displayName="SearchListFilter";const U=O;var H=o(70268);class z extends l.Z{constructor(){super(...arguments),this.searchListFilterStore=new P,this.storeTypes={activityUpdatesStore:k.o,filterPopupStore:_.Z},this.closeAddFilterMenu=()=>{const{filterPopupStore:e}=this.stores;e.setState({...e.state,open:!1})},this.renderActivityTypeFilter=()=>{const{collectionId:e}=this.props,t=e=>s.createElement(s.Fragment,null,n()(U,{store:this.searchListFilterStore,focused:!1,icon:c.Z.typesMultipleSelect,options:[...e].sort(),items:this.stores.activityUpdatesStore.state.filterActivityTypes,mode:N.z.Pill,title:n()(m.FormattedMessage,{id:"activityUpdates.filterMenu.byType.title",defaultMessage:"Activity type"}),tokenInputPlaceholder:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.search",defaultMessage:"Search for a type",description:"Placeholder text for searching for a type."}),resultSectionTitle:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.resultSectionTitle",defaultMessage:"Activity Types"}),addItemLabel:this.props.intl.formatMessage({id:"activityUpdates.filterMenu.byType.addItemLabel",defaultMessage:"Add an activity type"}),componentDebugName:"ActivityUpdatesSearchEditTypesFilter",onChange:e=>this.updateFiltersAndTrackChange((()=>this.stores.activityUpdatesStore.update((t=>({...t,filterActivityTypes:e,activityIds:[],hasOlderActivities:!0,shouldLoadOlderActivities:!0,shouldLoadNewerActivities:!1}))))),onMenuDismiss:this.closeAddFilterMenu,getItemLabel:e=>e.split("-").map((e=>e.replace(/(^.)/,(e=>e.toUpperCase())))).join(" ")}));return t(e?p.Se:p.Py)},this.renderActivityTimeFilter=()=>n()(A.Z,{mode:N.z.Pill,focused:!1,showButtons:!0,title:n()(m.FormattedMessage,{id:"activityUpdates.filterMenu.byDate",defaultMessage:"Date Range"}),icon:c.Z.calendar,value:this.stores.activityUpdatesStore.state.filterDateRange,onMenuDismiss:this.closeAddFilterMenu,onChange:e=>this.updateFiltersAndTrackChange((()=>this.stores.activityUpdatesStore.update((t=>({...t,filterDateRange:e,activityIds:[],hasOlderActivities:!0,shouldLoadOlderActivities:!0})))))}),this.renderSearchFilters=()=>{const{currentUserStore:e,currentSpaceStore:t}=C.default.state;if(!e||!t)return;const o=this.stores.activityUpdatesStore.state.filterActivityTypes.length>0||this.stores.activityUpdatesStore.state.filterDateRange.ending||this.stores.activityUpdatesStore.state.filterDateRange.starting;return n()("div",{style:{display:"flex",flexDirection:"row",padding:"12px 10px",width:"100%",gap:6}},void 0,this.renderActivityTypeFilter(),this.renderActivityTimeFilter(),o&&this.renderClearButton())},this.showGetNotifiedDropdown=this.createComputedStore((()=>this.props.isTopbarUpdatesMenu)),this.handleActivityEmit=e=>{this.stores.activityUpdatesStore.update((e=>({...e,shouldLoadNewerActivities:!0})))},this.handleActivityEmitThrottled=a().throttle(this.handleActivityEmit,1e3),this.handleNavigableBlockEmit=u.YX(this.handleActivityEmitThrottled),this.handleCollectionEmit=u.YX(this.handleActivityEmitThrottled),this.navigableBlockListenerReference=void 0,this.collectionListenerReference=void 0}willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return M.Z.state.online?this.renderOnline():this.renderOffline()}renderClearButton(){return n()("div",{style:{flexGrow:1,textAlign:"right",cursor:"pointer",fontSize:14,color:this.theme.mediumTextColor,marginRight:8},onClick:()=>this.updateFiltersAndTrackChange((()=>this.stores.activityUpdatesStore.reset()))},void 0,n()(m.FormattedMessage,{defaultMessage:"Clear",id:"activityUpdates.clearFilters"}))}renderOffline(){return n()("div",{style:this.getPlaceholderContentStyle()},void 0,n()(m.FormattedMessage,{defaultMessage:"Please go online to view updates.",id:"activityUpdates.offlineMessage"}))}updateFiltersAndTrackChange(e){const t=this.getFilterDataForTracking();e();const o=this.getFilterDataForTracking();h.Q6({environment:this.environment,activityUpdatesSource:this.props.source,filters:o,prevFilters:t})}renderOnline(){const{spaceId:e,navigableBlock:t,collectionId:o,source:i}=this.props,{currentUserStore:r,currentSpaceStore:a}=C.default.state;if(!r||!a)return;const s=a,{shouldLoadOlderActivities:l,shouldLoadNewerActivities:c,filterActivityTypes:d,filterDateRange:p,activityIds:u,hasOlderActivities:h}=this.stores.activityUpdatesStore.state,v=r.id,w=null==t?void 0:t.id;return n()(Z.Z,{throttle:1e3,request:{spaceId:e,navigableBlockId:w,collectionId:o,shouldLoadOlderActivities:l,shouldLoadNewerActivities:c,filterActivityTypes:d,filterDateRange:p,hasOlderActivities:h,activityIds:u},performRequest:async e=>{const{spaceId:t,navigableBlockId:o,collectionId:i,shouldLoadOlderActivities:n,shouldLoadNewerActivities:r,filterDateRange:a,filterActivityTypes:s,hasOlderActivities:l,activityIds:c}=e,d=x.ZP.startLoading();r?await g.A(this.environment,{store:this.stores.activityUpdatesStore,activityIds:c,spaceId:t,filterActivityTypes:s,filterDateRange:a,navigableBlockId:o,collectionId:i}):n&&l&&await g.h(this.environment,{store:this.stores.activityUpdatesStore,activityIds:c,spaceId:t,filterActivityTypes:s,filterDateRange:a,navigableBlockId:o,collectionId:i}),x.ZP.endLoading(d)},render:(r,a,c)=>{var u,g;const{activityIds:k}=this.stores.activityUpdatesStore.state;if(r)return n()("div",{style:this.getPlaceholderContentStyle()},void 0,n()(m.FormattedMessage,{defaultMessage:"Something went wrong.",id:"activityUpdate.unknownErrorLoadingActivities.message"}));const C=(0,y.oI)(),_=(0,f.Y)("supportsNativeHome"),M={spaceId:e,userId:v,navigableBlockId:w,collectionId:o,filterDateRange:p,filterActivityTypes:d},T=_&&0===k.length&&!c?b.IS(M):k;if(_&&c&&b.HB(M,k),0===T.length&&!c)return n()("div",{},void 0,C&&this.renderSearchFilters(),n()(H.B,{areaHeight:window.innerHeight}));const I=this.getActivityValues(T),P=this.stores.activityUpdatesStore.state,x=0===P.filterActivityTypes.length&&void 0===P.filterDateRange.ending&&void 0===P.filterDateRange.starting,B=0===I.length&&!h&&c;return n()("div",{},void 0,this.showGetNotifiedDropdown.state&&t&&!this.props.prominentGetNotifiedDropdownExperimentEnabled?n()("div",{style:{display:"flex",justifyContent:"flex-end",padding:"8px 8px 0"}},void 0,n()(R.Z,{blockStore:t})):null,C&&this.renderSearchFilters(),n()("div",{style:B?this.getPlaceholderContentStyle():this.getContentStyle(),className:B?"":"notranslate"},void 0,B?null===(u=(g=this.props).empty)||void 0===u?void 0:u.call(g,{hasFiltersOn:!x}):null,n()("div",{},void 0,I.map(((e,t,o)=>{const r=o.length-1===t,a="notifications_tab"===i?{tab:"all",source:i}:{tab:"pageUpdatesSidebar",source:i};return n()(S.LazyActivity,{activity:e,rootStore:s,isLast:r,isTopbarUpdatesMenu:this.props.isTopbarUpdatesMenu,tabArgs:a,useRedesignedIA:!1},e.id)}))),n()(E.Z,{onChange:e=>{e<200&&c&&!l&&h&&(x||T.length>0)&&this.stores.activityUpdatesStore.update((e=>({...e,shouldLoadOlderActivities:!0})))}},void 0,!c&&h?this.renderSpinner(!0):null)))}})}renderSpinner(e){return n()("div",{style:this.getSpinnerStyle(e)},void 0,n()(B.Z,{}))}startMessageListeners(){const{navigableBlock:e,collectionId:t}=this.props,o=null==e?void 0:e.id;if(o){const e=(0,d.bS)(o);this.navigableBlockListenerReference=w.Z.addListener(e,this.handleNavigableBlockEmit,void 0,this.environment)}if(t){const e=(0,d.Cy)(t);this.collectionListenerReference=w.Z.addListener(e,this.handleCollectionEmit,void 0,this.environment)}}stopMessageListeners(){this.navigableBlockListenerReference&&(w.Z.removeListener(this.navigableBlockListenerReference,this.environment),this.navigableBlockListenerReference=void 0),this.collectionListenerReference&&(w.Z.removeListener(this.collectionListenerReference,this.environment),this.collectionListenerReference=void 0)}getActivityValue(e){const{currentUserStore:t,currentSpaceStore:o}=C.default.state;if(!t||!o)return;const i=(0,v.No)(o,e,o.id).getValue();return i&&!i.invalid?i:null}getActivityValues(e){return a().compact(e.map((e=>this.getActivityValue(e))))}getContentStyle(){return{minHeight:this.environment.device.isMobile?void 0:"75vh"}}getPlaceholderContentStyle(){const{device:e}=this.environment;return{...this.getContentStyle(),paddingTop:e.isMobile?64:void 0,minHeight:e.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:this.theme.mediumTextColor,flexDirection:"column",flex:"1 1 0%"}}getSpinnerStyle(e){return{...this.getPlaceholderContentStyle(),minHeight:e?64:220}}getFilterDataForTracking(){var e,t;const{filterActivityTypes:o,filterDateRange:i}=this.stores.activityUpdatesStore.state;return{activityTypes:o,dateRange:{start:null===(e=i.starting)||void 0===e?void 0:e.start_date,end:null===(t=i.ending)||void 0===t?void 0:t.start_date}}}}z.displayName="ActivityUpdates";const W=(0,m.injectIntl)(z)},13401:(e,t,o)=>{o.d(t,{Z:()=>h});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(3779),p=o(60709),u=o(31339),m=o(52275);class g extends l.Z{renderComponent(){const e=this.props.isBlue?c.ZP.blue:this.theme.mediumTextColor;return s.createElement(m.Z,n()({},this.props,{title:a()("div",{style:{color:e,fill:e}},void 0,this.props.title),icon:a()(u.Z,{icon:d.Z.plus,styles:{fill:e}})}))}}g.displayName="AddMenuItem",g.contextTypes={...p.mw,...l.w};const h=g},63314:(e,t,o)=>{o.d(t,{ZP:()=>B});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(24405),c=o(3779),d=o(89837),p=o(5366),u=o(30149),m=o(93678),g=o(37181),h=o(38755),f=o(21115),v=o(8323),y=o(79315),b=o(10161),S=o(78291),w=o(64921),k=o(61519),C=o(76844),_=o(32617);function M(e,t,o){if(o){if("warning"===t){if("settings"===e)return{disableWarningNotificationInSettings:!0,disableWarningNotificationInSidebar:o.disableWarningNotificationInSidebar,disableLimitNotificationInSettings:o.disableLimitNotificationInSettings,disableLimitNotificationInSidebar:o.disableLimitNotificationInSidebar,expirationDate:o.expirationDate};if("sidebar"===e)return{disableWarningNotificationInSettings:o.disableWarningNotificationInSettings,disableWarningNotificationInSidebar:!0,disableLimitNotificationInSettings:o.disableLimitNotificationInSettings,disableLimitNotificationInSidebar:o.disableLimitNotificationInSidebar,expirationDate:o.expirationDate}}if("limit_reached"===t){if("settings"===e)return{disableWarningNotificationInSettings:o.disableWarningNotificationInSettings,disableWarningNotificationInSidebar:o.disableWarningNotificationInSidebar,disableLimitNotificationInSettings:!0,disableLimitNotificationInSidebar:o.disableLimitNotificationInSidebar,expirationDate:o.expirationDate};if("sidebar"===e)return{disableWarningNotificationInSettings:o.disableWarningNotificationInSettings,disableWarningNotificationInSidebar:o.disableWarningNotificationInSidebar,disableLimitNotificationInSettings:o.disableLimitNotificationInSettings,disableLimitNotificationInSidebar:!0,expirationDate:o.expirationDate}}}return{disableWarningNotificationInSettings:"warning"===t&&"settings"===e,disableWarningNotificationInSidebar:"warning"===t&&"sidebar"===e,disableLimitNotificationInSettings:"limit_reached"===t&&"settings"===e,disableLimitNotificationInSidebar:"limit_reached"===t&&"sidebar"===e,expirationDate:(0,d.Xz)({date:Date.now(),daysToAdd:7})}}const T={padding:"4px 14px 8px 14px",fontSize:12,lineHeight:1.4},I={fontWeight:500,lineHeight:2,display:"flex"},P={fontWeight:400},x={textDecoration:"underline"};const B=function(e){window.__c={n:"AddOnLimitUsage"};const t=(0,_.lp)(),o=(0,a.O7)(),i=(0,l.yK)((e=>({empty:{},cancelButton:{background:e.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},dismissButton:{display:"flex",flexDirection:"row-reverse",position:"relative",top:10,right:-6},hovered:{background:e.buttonPressedBackground},closeIcon:{width:14,fill:e.mediumTextColor}})),[]),{data:B,blockPercentageUsed:Z,isApproachingBlockLimit:E,membersCount:R,spaceName:A,settings:D,currentUserSettingsStore:F,showBlockLimitEarlier:L}=(0,s.VK)((()=>{var e,t;return{data:S.default.state.data,blockPercentageUsed:S.default.state.data?f.zl(o,S.default.state.data):0,isApproachingBlockLimit:!!S.default.state.data&&f.XZ(o,S.default.state.data),membersCount:(0,f.qX)(),spaceName:y.default.state.currentSpaceStore&&(0,h.rn)(o,y.default.state.currentSpaceStore),settings:null===(e=y.default.state.currentUserSettingsStore)||void 0===e||null===(t=e.getSettings())||void 0===t?void 0:t.addOnLimitNotifications,currentUserSettingsStore:y.default.state.currentUserSettingsStore,showBlockLimitEarlier:b.default.checkGate("show-block-limit-usage-earlier")}}),[o]),V=(0,s.VK)((()=>t?+t.spaceUsage/t.spaceLimit:0),[t]),{notificationType:N,usageLabelStyles:O}=(0,s.VK)((()=>({notificationType:V>=1?"limit_reached":"warning",usageLabelStyles:i.empty})),[V,i.empty]);if(!(A&&B&&(0,f.GJ)(B)&&F))return null;if(!(0,f.GJ)(B))return null;if(!1===(null==t?void 0:t.isEligible)&&t.isSalesAssisted)return null;if("sidebar"===e.source&&L&&Z>.05)return null;if(E)return null;if(V<.7)return null;if("warning"===N&&("settings"===e.source&&null!=D&&D.disableWarningNotificationInSettings||"sidebar"===e.source&&null!=D&&D.disableWarningNotificationInSidebar))return null;if("limit_reached"===N&&("settings"===e.source&&null!=D&&D.disableLimitNotificationInSettings||"sidebar"===e.source&&null!=D&&D.disableLimitNotificationInSidebar))return null;let U;"settings"===e.source&&R>=3&&(null!=D&&D.expirationDate?Date.now()<D.expirationDate&&(U=!0):(!function(e,t){u.createAndCommit({userAction:"addOnLimitNotifications.ai.initializeSettings",environment:e,perform:e=>{g.d2({transaction:e,userSettingsStore:t,data:{addOnLimitNotifications:{disableWarningNotificationInSettings:!1,disableWarningNotificationInSidebar:!1,disableLimitNotificationInSettings:!1,disableLimitNotificationInSidebar:!1,expirationDate:(0,d.Xz)({date:Date.now(),daysToAdd:7})}}})}})}(o,F),U=!0));const H=n()(p.FormattedMessage,"limit_reached"===N?{id:"addOnLimitUsage.description.usedAllFreeResponses.admins",defaultMessage:"{spaceName} has used all their free AI responses.",description:"Shown when a customer has run out of Notion AI and needs to upgrade.",values:{spaceName:A}}:{id:"addOnLimitUsage.description.approachingLimit.admins",defaultMessage:"{spaceName} has used {spaceUsage} of the {usageLimit} free responses provided to this workspace.",description:"Shown when a customer has run out of Notion AI and needs to upgrade.",values:{spaceName:A,spaceUsage:(null==t?void 0:t.spaceUsage)??0,usageLimit:(null==t?void 0:t.spaceLimit)??0}});return n()(r.Fragment,{},void 0,function(e){if(window.__c={n:"renderDivider"},e)return n()(k.Z,{size:27,style:{paddingLeft:14,paddingRight:14}});return n()(k.Z,{size:0})}("settings"===e.source),n()(w.Z,{style:T,onClick:()=>function(e,t){m.y(e,{from:"sidebar"===t?"ai_limit_sidebar":"ai_limit_settings",for:(0,v.zt)(),addOnFeature:"ai"})}(o,e.source)},void 0,!U&&n()("div",{style:i.dismissButton},void 0,n()(w.Z,{onClick:()=>function(e,t,o){var i;const{currentUserSettingsStore:n}=y.default.state;if(!n)return;const r={addOnLimitNotifications:M(t,o,null===(i=n.getSettings())||void 0===i?void 0:i.addOnLimitNotifications)};u.createAndCommit({userAction:"addOnLimitNotifications.ai.markNotificationAsDismissed",environment:e,perform:e=>{g.d2({transaction:e,userSettingsStore:n,data:r})}})}(o,e.source,N),style:i.cancelButton,hoveredStyle:i.hovered},void 0,c.Z.closeSmall(i.closeIcon))),n()("div",{style:I},void 0,c.Z.sparkles({height:14,width:14,marginTop:4}),n()(p.FormattedMessage,{id:"spaceSettings.sidebar.addOnUpgradeLink",defaultMessage:"Notion AI",description:"Shown in the sidebar as an upsell when users are close to using all their free AI responses."})),n()("div",{style:P},void 0,n()("div",{style:O},void 0,H),n()(C.Z,{style:{marginTop:12,marginBottom:12},percent:V}),n()("div",{style:x},void 0,n()(p.FormattedMessage,{id:"spaceSettings.sidebar.addOnPurchase.buttonLabel",defaultMessage:"Purchase",description:"Shown in the sidebar as an upsell when users are close to using all their free AI responses."})))))}},3104:(e,t,o)=>{o.d(t,{Z:()=>d});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(82990),l=o(77907),c=o(64369);class d extends a.Z{renderComponent(){const{data:e,hideHelp:t,customCollapsedRenderers:o}=this.props,i={fontWeight:s.Z.fontWeight.bold,fontSize:18,marginBottom:8};return r.createElement(r.Fragment,null,!t&&r.createElement(r.Fragment,null,n()("div",{style:i},void 0,"Success"),n()(c.Z,{isSmall:!0,isMultiline:!0,style:{marginBottom:8}},void 0,"Click on a value to copy it into your clipboard.")),n()(l.LazyAdminReactJson,{data:e,customCollapsedRenderers:o}))}}d.displayName="AdminAPIJsonResponse"},28121:(e,t,o)=>{o.d(t,{v:()=>C,Z:()=>M});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(24211),l=o(61784),c=o(82990),d=o(5366),p=o(77671),u=o(47307),m=o(92625),g=o(97977),h=o(27210),f=o(15517),v=o(49085);class y extends v.Z{getInitialState(){return{loginEmail:"",intercomLink:"",preferredLoginRole:"restricted"}}}const b=y;var S=o(10161),w=o(74194),k=o(63296);const C={full:{text:"read-write"},restricted:{text:"view-only"}};class _ extends a.Z{constructor(){super(...arguments),this.storeTypes={store:b},this.handleLoginEmailChange=e=>{const{store:t}=this.stores;t.setState({...t.state,loginEmail:e.target.value})},this.handleIntercomLinkChange=e=>{const{store:t}=this.stores;t.setState({...t.state,intercomLink:e.target.value})},this.handlePreferredLoginRoleChange=e=>{const{store:t}=this.stores;t.setState({...t.state,preferredLoginRole:e})},this.handleSubmit=async e=>{const{store:t}=this.stores,{loginEmail:o,intercomLink:i,preferredLoginRole:n}=t.state,r=(0,d.defineMessages)({loggingInAs:{id:"adminLoginAsUser.loggingInAs.loadingMessage",defaultMessage:"Logging in as {userEmail}"}});if(!S.default.checkGate("user_data_consent_admin_bypass")&&0===i.length)return void u.showErrorMessage("You must include a support ticket link to login as a user!");e.target.blur(),m.j({message:r.loggingInAs,interpolatedValues:{userEmail:o}}),f.ZL(),sessionStorage.clear();const a=await p.N(this.environment,{email:o,intercomLink:i,preferredLoginRole:n});if("failed"===a.type)m.x(),u.showError(a);else{const{userId:e}=a.data,t=`Success! click "Continue" to enter account for "${o}".`,i=a.data.expiryTime?`${t} The user has granted access until ${(0,l.Yx)(a.data.expiryTime,"medium_with_time",s.al)}.`:t;m.x(),u.showDialog({message:i,showCancel:!1,keepFocus:!0,items:[{label:"Continue",color:"blue",onAccept:()=>{g.loginAsAdmin({userId:e,environment:this.environment})}}]})}}}willMount(e){e.email&&this.stores.store.setState({...this.stores.store.state,loginEmail:e.email})}renderComponent(){const{store:e}=this.stores,t=!S.default.checkGate("user_data_consent_admin_bypass"),o=Object.keys(C);return n()("div",{},void 0,n()("div",{style:_.headerStyle},void 0,"Login as User"),t?n()(r.Fragment,{},void 0,n()("div",{style:{marginTop:12,marginBottom:4}},void 0,"Support ticket link"),n()(w.Z,{value:e.state.intercomLink,onChange:this.handleIntercomLinkChange,style:{marginBottom:8}})):void 0,this.props.email?n()("div",{},void 0,"Login as ",this.props.email):r.createElement(r.Fragment,null,n()("div",{style:{marginTop:12,marginBottom:4}},void 0,"User email"),n()(w.Z,{value:e.state.loginEmail,onChange:this.handleLoginEmailChange,onSubmit:this.handleSubmit,style:{marginBottom:8}})),(0,h.v2)()?n()("div",{style:{display:"flex",flexDirection:"row"}},void 0,o.map((e=>n()(k.Z,{isLarge:!0,onClick:async t=>{this.handlePreferredLoginRoleChange(e),await this.handleSubmit(t)},style:{marginRight:"5px"}},void 0,"Login as ",C[e].text)))):n()(k.Z,{isLarge:!0,onClick:this.handleSubmit},void 0,"Login"))}}_.displayName="AdminLoginAsUser",_.headerStyle={fontWeight:c.Z.fontWeight.bold,fontSize:18,marginTop:24};const M=_},86125:(e,t,o)=>{o.d(t,{Z:()=>l});var i=o(77094),n=o.n(i),r=o(67294),a=o(5366),s=o(74136);function l(e){return window.__c={n:"AdminPill"},r.createElement(s.Z,e,"membership_admin"===e.role?n()(a.FormattedMessage,{id:"spacePermissionsSettings.user.membershipAdmin",defaultMessage:"Membership admin",description:"Label that shows on a user that is a workspace membership admin."}):n()(a.FormattedMessage,{id:"spacePermissionsSettings.user.workspaceOwner",defaultMessage:"Workspace owner",description:"Label that shows on a user that is a workspace owner."}))}},3403:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(68785),s=o(33411);class l extends r.Z{renderComponent(){return n()(s.Z,{show:!0,showDelay:400,showHold:100,render:e=>n()("div",{style:l.containerStyle},void 0,e&&n()(a.Z,{}))})}}l.displayName="AppLoadingSpinner",l.containerStyle={display:"flex",alignItems:"center",justifyContent:"center",height:"100%"};const c=l},19079:(e,t,o)=>{o.d(t,{Z:()=>F});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(5366),p=o(80365),u=o(12318),m=o(82990),g=o(84210),h=o(67669),f=o(33665),v=o(79315),y=o(81236),b=o(84076),S=o(31278),w=o(76798),k=o(76725),C=o(98165),_=o(64369);class M extends l.Z{constructor(){super(...arguments),this.storeTypes={},this.renderPathItem=e=>a()(w.Z,{store:e,shouldWrap:!0,maxLength:20},e.id)}renderComponent(){const{store:e}=this.props,t=C.uJ(e);e.isNavigableBlock()&&t.shift(),t.reverse();const o=t.length;if(0===o)return;o>2&&t.splice(1,t.length-2);const i=t.map(this.renderPathItem);o>2&&i.splice(1,0,a()(P,{}));const n=(0,k.Z)(i,(e=>a()(I,{},e)));return a()(_.Z,{isSecondaryColor:!0,isSmall:!0,style:{paddingLeft:8}},void 0,n)}}M.displayName="StaticBreadcrumb";const T=M;function I(){return window.__c={n:"Separator"},a()("span",{style:{paddingLeft:4,paddingRight:4}},void 0,"/")}function P(){return window.__c={n:"TruncationPlaceholder"},a()("span",{},void 0,"...")}var x=o(78454),B=o(32469);class Z extends l.Z{constructor(){super(...arguments),this.isPrivate=this.createComputedStore((()=>!(0,h.yi)(this.environment,this.props.currentBlockStore)&&(0,h.yi)(this.environment,this.props.backlinkStore)))}renderComponent(){const{backlinkStore:e,scrollToBlockId:t,discussionId:o}=this.props,{mainEditorCurrentBlockStore:i}=v.default.state,n=i&&i.id===e.id,r=(0,g.ZP)({store:e,scrollToBlockId:t,discussionId:o,fullyQualified:!0,preferPublicLink:(0,f.Sr)(),getSpaceDomain:()=>{var t;return null===(t=y.Z.getPublicSpaceData(this.environment,e.getSpaceId()))||void 0===t?void 0:t.domain}});return a()(b.Z,{href:r,external:!1,innerStyle:{paddingLeft:8,paddingRight:16}},void 0,a()(x.ZP,{childrenStyle:this.getChildrenStyle(),alignment:x.v2.Center,style:{marginBottom:2,marginRight:4},right:s.createElement(s.Fragment,null,this.props.showOriginalToken&&a()("div",{style:this.getTokenStyle()},void 0,a()(d.FormattedMessage,{defaultMessage:"Original",id:"backlink.originalTokenLabel"})),n&&!this.props.disableCurrentPageToken&&a()("div",{style:this.getTokenStyle()},void 0,a()(d.FormattedMessage,{defaultMessage:"This page",id:"backlink.currentPageTokenLabel"})))},void 0,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,!this.props.disableArrow&&this.renderArrowIcon(),this.renderIcon(),a()(w.Z,{store:e,style:this.getTitleStyle()}),a()("div",{style:{marginTop:-2,minWidth:0,display:"flex",alignItems:"baseline",flex:"2 0 40%",paddingTop:"0.1em"}},void 0,a()(T,{store:e}),this.renderPrivate()))))}renderArrowIcon(){return a()("div",{style:{marginLeft:4,transform:"rotate(180deg)",fill:this.theme.regularIconColor}},void 0,c.Z.alias({width:15,height:15}))}renderIcon(){const{backlinkStore:e}=this.props;return a()(S.Z,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:20,style:{marginLeft:4,marginRight:4}})}renderPrivate(){if(this.isPrivate.state)return a()(B.Z,{style:{paddingRight:4,marginLeft:12}})}getTitleStyle(){return{fontWeight:m.Z.fontWeight.medium,fontSize:m.Z.fontSize.UIRegular.desktop,lineHeight:1.3,borderBottom:`1px solid ${this.theme.darkDividerColor}`,flexShrink:1}}getChildrenStyle(){return{padding:"4px 2px"}}getTokenStyle(){const{device:e}=this.environment;return{padding:"2px 6px",borderRadius:3,color:this.theme.mediumTextColor,background:this.theme.legacyDefaultSelectColor,fontSize:e.isMobile?11:9,lineHeight:e.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em",whiteSpace:"nowrap",marginLeft:4}}}Z.displayName="Backlink";const E=(0,d.injectIntl)(Z);var R=o(89728),A=o(58032);class D extends l.Z{constructor(){super(...arguments),this.storeTypes={showMore:u.default.of(10),hovered:u.default.of(!1)},this.handleMouseMove=()=>{this.stores.hovered.set(!0)},this.handleMouseLeave=()=>{this.stores.hovered.set(!1)},this.handleShowMore=()=>{this.stores.showMore.set(this.stores.showMore.get()+10)},this.backlinksState=this.createComputedStore((()=>(0,p.L)(this.props.store,this.environment)),!0)}renderComponent(){const{originalTransclusionStore:e,disableInaccessiblePages:t}=this.props,o=this.backlinksState.state,i=this.stores.showMore.get(),r=e?e.getNavigableBlockStore():void 0;if(0===o.backlinks.length&&!e)return;const l=o.backlinks.length>i,p=o.inaccessibleBacklinkCount>0&&!t;return a()("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,this.props.headerText&&this.renderHeader(),e&&r&&a()(E,{currentBlockStore:this.props.store,disableArrow:this.props.disableArrow,disableCurrentPageToken:this.props.disableCurrentPageToken,backlinkStore:r,scrollToBlockId:e.id,showOriginalToken:!0}),o.backlinks.slice(0,i).map((e=>s.createElement(E,n()({key:e.backlinkStore.id,currentBlockStore:this.props.store,disableArrow:this.props.disableArrow,disableCurrentPageToken:this.props.disableCurrentPageToken},e)))),(l||p)&&a()(A.Z,{disableTooltip:l,renderTooltip:()=>a()(d.FormattedMessage,{defaultMessage:"Synced in pages that you don't have access to.",id:"page.backlinks.privatePagesTooltip"}),render:e=>s.createElement(R.Z,n()({icon:c.Z.dots,isGray:!0,onClick:this.handleShowMore,style:{padding:`2px ${this.props.disableArrow?17:14}px`,width:"100%"},disabled:!l},e),a()(d.FormattedMessage,l?{defaultMessage:"{count} more",id:"page.backlinks.more",values:{count:o.backlinks.length-i}}:{id:"page.backlinks.privatePages",defaultMessage:"{count, plural, one {{count} private page} other {{count} private pages}}",values:{count:o.inaccessibleBacklinkCount}}))}))}renderHeader(){return a()("div",{style:{display:"flex"}},void 0,a()(_.Z,{isSmall:!0,style:{marginTop:12,marginBottom:8,marginLeft:4,flex:1,paddingLeft:8}},void 0,this.props.headerText))}}D.displayName="Backlinks";const F=D},4350:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(83355),n=o(98459),r=o(79315);class a extends i.Z{willMount(){this.shouldDisableBacklinks()||this.environment.LocalBacklinkStore.initializeBacklinks({block:{id:this.props.store.pointer.id,spaceId:(0,n.CG)(this.props.store.pointer.spaceId)},currentUserId:this.environment.currentUser.id,environment:this.environment})}willUnmount(){this.shouldDisableBacklinks()||this.environment.LocalBacklinkStore.destroyBacklinks(this.props.store.id,this.environment)}shouldDisableBacklinks(){const{mainEditorCurrentBlockStore:e}=r.default.state;return Boolean(e&&"15776535-3f2c-4705-bd45-474e5ba8b46c"===e.id)}}a.displayName="BacklinksListener";const s=a},48601:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(45094),s=o(91754);class l extends r.Z{constructor(){super(...arguments),this.renderBanner=(e,t,o)=>{const{id:i,type:r,render:a}=e,l=o.length>1&&t!==o.length-1;return n()(s.Z,{type:r,shouldUseDivider:l,isMobile:this.props.isMobile},i,a())}}renderComponent(){return n()("div",{style:{width:`calc(100% - ${(0,a.ll)(this.environment,this.props.isInPeekRenderer)}px)`,userSelect:"none",WebkitUserSelect:"none"}},void 0,this.props.arbitraryRenderBefore,this.props.banners.map(this.renderBanner))}}l.displayName="BannersRenderer";const c=l},86671:(e,t,o)=>{o.d(t,{Z:()=>F});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(49271),s=o(41432),l=o(8848),c=o(5366),d=o(78175),p=o(33929),u=o(10663),m=o(68056),g=o(98165),h=o(67669),f=o(65598),v=o(45094),y=o(58202),b=o(3815),S=o(99757),w=o(24666),k=o(3779),C=o(82990),_=o(54564),M=o(24677),T=o(28020),I=o(24229),P=o(68709),x=o(73063);let B;!function(e){e[e.PushContent=0]="PushContent",e[e.FloatRight=1]="FloatRight"}(B||(B={}));class Z extends r.Z{constructor(){super(...arguments),this.handleClick=()=>{M.ZH(this.environment),_.Ib({environment:this.environment,blockStore:this.props.store,analyticsFrom:"discussion_indicator",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:this.props.recursivelyLoadAllDiscussions})},this.selectedDiscussionIdStore=this.createComputedStore((()=>I.Z.getFramePageFirstSelectedDiscussionId())),this.numberOfCommentsStore=this.createComputedStore((()=>{const{store:e,recursivelyLoadAllDiscussions:t,onlyCountBlockLevelDiscussions:o}=this.props,i=f.vV(e,{recursivelyLoadAllDiscussions:t,onlyIncludeBlockLevelDiscussions:o});if(0===i.length)return 0;const n=new Set(i.map((e=>e.id))),r=this.selectedDiscussionIdStore.state;if(r&&n.has(r))return 0;const a=T.RM();if(a){const t=f.MI(a),o=t.indexOf(e),i=new Set(n);for(let e=o-1;e>=0;e--){const o=t[e],r=f.vV(o,{recursivelyLoadAllDiscussions:!1,excludeSelf:!1,onlyIncludeBlockLevelDiscussions:!1,includeLoadingDiscussions:!0}).map((e=>e.id));for(const e of i)r.includes(e)?n.delete(e):i.delete(e);if(0===n.size)return 0;if(0===i.size)break}}return f.Xp(e,{recursivelyLoadAllDiscussions:t,onlyIncludeBlockLevelDiscussions:o})}))}renderComponent(){const e=this.numberOfCommentsStore.state;if(0===e)return null;return this.props.getFormat()===B.FloatRight?n()(P.p,{allowSelectionWithin:!1,style:{width:0,height:0}},void 0,this.renderButton(e)):this.renderButton(e)}renderButton(e){return n()(x.Z,{icon:k.Z.speechBubble,style:{alignSelf:"flex-start",marginLeft:4,marginTop:3},onClick:this.handleClick,caption:this.renderNumberOfComments(e)})}renderNumberOfComments(e){const t=e>9?"9+":e;return n()("span",{style:{marginLeft:2,color:this.theme.lightTextColor,fontWeight:C.Z.fontWeight.semibold}},void 0,t)}}Z.displayName="DiscussionIndicator";const E=Z;var R=o(65187);const A=(0,c.defineMessages)({imageCaption:{defaultMessage:"Write a caption…",id:"block.imageCaption.placeholder"}});class D extends r.Z{constructor(){super(...arguments),this.blockStore=()=>this.props.store,this.canEditComputedStore=this.createComputedStore((()=>{if(this.props.disabled)return!1;if(S.n.state)return!1;const e=this.pageContext&&this.pageContext.publicEditModeStore.state;return!(0,h.YF)(e)&&this.props.store.canEdit()})),this.marginCommentsVisible=this.createComputedStore((()=>(0,u.fg)(this.environment,this.props.store))),this.rootStorePageFont=this.createComputedStore((()=>{const e=this.props.store.getRecordStoreUIRoot();if(e&&e instanceof b.G){const t=e.getFormat();if(t)return t.page_font}})),this.isNoBlockCommentCreationType=this.createComputedStore((()=>{const e=this.props.store.getModel();return Boolean(null==e?void 0:e.isType(s.eh))})),this.captionIsEmpty=this.createComputedStore((()=>{const e=this.props.store.getPropertyStore("caption").getValue();return!e||0===e.length})),this.captionIsFocused=this.createComputedStore((()=>{var e;const t=this.props.store.getPropertyStore("caption");return"editing"===w.default.state.mode&&(null===(e=(0,m.QY)(w.default.state.multiSelection))||void 0===e?void 0:e.store)===t})),this.columnListIndexAndCountStore=this.createComputedStore((()=>{const{store:e}=this.props,t=(0,g.qA)(e);let o,i,n,r;for(const a of t){if(a instanceof b.G&&o){const t=a.getType();if(t&&(0,s.S9)(t)&&a.id!==e.id)break;if("column_list"===t){const e=a.getContentStore().getValue()||[];i=e.indexOf(o.id),n=e.length,r=(0,d.Po)(a,this.environment)}}o=a}return{columnListIndex:i,columnListColumnCount:n,columnListResizable:r}})),this.getDiscussionIndicatorFormat=()=>{const{device:e}=this.environment;if(!e.isMobile){const e=this.columnListIndexAndCountStore.state;if(void 0===e.columnListIndex)return B.FloatRight;if(!e.columnListResizable&&e.columnListColumnCount&&e.columnListIndex===e.columnListColumnCount-1)return B.FloatRight}return B.PushContent}}get registries(){return[y.R]}canEdit(){return this.canEditComputedStore.state}canEditCollection(){if(this.props.disabled)return!1;if(S.n.state)return!1;const e=this.pageContext&&this.pageContext.publicEditModeStore.state;return!(0,h.YF)(e)&&this.props.store.canEditCollection()}canComment(){return!this.props.disabled&&(!S.n.state&&this.props.store.canComment())}canAdmin(){return!this.props.disabled&&(!S.n.state&&this.props.store.canAdmin())}canView(){const{store:e}=this.props;return e.canRead()}isRootOrDirectChild(){return this.props.store.isRootOrDirectChild()}renderComponent(){const{store:e}=this.props;if(e)return e?(0,f.SJ)(e)?void 0:this.renderPersisted():void 0}renderPersisted(){}renderDiscussion(e){const{style:t,recursivelyLoadAllDiscussions:o,hideIfSidebarOrMarginCommentsVisible:i}=e||{};if(this.props.disableCommentMenu)return;if(this.props.hideContent)return;const r=this.isNoBlockCommentCreationType.state,a=(0,v.Sx)(this.environment);return!r&&!i||!a&&!this.marginCommentsVisible.state?n()(E,{store:this.props.store,getFormat:this.getDiscussionIndicatorFormat,style:t,recursivelyLoadAllDiscussions:Boolean(o),onlyCountBlockLevelDiscussions:a},"DiscussionIndicator"):void 0}renderCaption(){if(!this.captionIsEmpty.state||this.captionIsFocused.state){const{disabled:e}=this.props,t=this.props.store.getPropertyStore("caption"),o=this.captionShouldHavePadding(),i={...this.getCaptionStyle(),...o&&{paddingLeft:26,paddingRight:26}};return n()(R.Z,{disabled:e,style:i,placeholderStyle:i,placeholder:p.default.formatMessage(A.imageCaption),disableSlashCommands:!0,disableEmbedMenu:!0,store:t,pasteBehavior:"block"})}}captionShouldHavePadding(){const{device:e,WindowSizeStore:t}=this.environment,{block_full_width:o,block_width:i,block_page_width:n}=this.props.store.getFormat();if(e.isMobile)return!1;if(n)return!1;if(o)return!0;return(i||0)>=t.state.width-(0,v.Wk)(this.environment)-(this.marginCommentsVisible.state&&this.blockStore().isFullWidth()?u.QB:0)}getBlockColorStyle(){const e=this.props.store.getFormat().block_color||"default";return(0,l.fi)(e,this.theme)}getCaptionStyle(){return{fontSize:14,lineHeight:1.4,color:this.theme.mediumTextColor,paddingTop:6,paddingBottom:6,paddingLeft:a.ZD.paddingLeft}}}D.displayName="Block";const F=D},13966:(e,t,o)=>{o.d(t,{Z:()=>y});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(95182),p=o(6404),u=o(24677),m=o(43250),g=o(27724),h=o(64921),f=o(58032);class v extends l.Z{constructor(){super(...arguments),this.renderButton=e=>s.createElement(h.Z,a()({className:this.props.fadeIn?m.JiD:void 0,style:this.getButtonStyle(),hoveredStyle:this.props.hoveredStyle,onClick:this.handleActionButtonClick},e),c.Z.dots({width:14,height:14,...this.props.iconStyle})),this.handleActionButtonClick=e=>{const{store:t,onClick:o,extraAnalyticsData:i}=this.props;u.Ys({environment:this.environment,store:t}),p.Qn({environment:this.environment,stores:g.default.state.stores,left:e.clientX,top:e.clientY,showInput:!this.props.hideFilterActionsInput,actions:this.props.blockMenuActions||d.Qi,analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{isFromBulkActionsToolbar:i?i.isFromBulkActionsToolbar:void 0}}),null==o||o()}}renderComponent(){return this.props.tooltipContent?n()(f.Z,{renderTooltip:()=>this.props.tooltipContent,delayThreshold:300,render:this.renderButton}):this.renderButton({})}getButtonStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:24,height:24,borderRadius:3,fill:e.isMobile?this.theme.lightIconColor:this.theme.mediumIconColor,...this.props.style}}}v.displayName="BlockActionMenuButton";const y=v},48494:(e,t,o)=>{o.d(t,{Z:()=>C,B:()=>k});var i=o(77094),n=o.n(i),r=o(67294),a=o(13991),s=o(480),l=o(81954),c=o(24405),d=o(66897),p=o(61784),u=o(5366),m=o(3815);function g(e){const{parentStore:t,pointer:o}=e,i=(0,m.Kv)(t,o).getValue();if(i)return{table:o.table,value:i}}var h=o(33929),f=o(25464),v=o(24039),y=o(28992),b=o(72495),S=o(58032),w=o(64369);function k(e){const t=e.getCreatedByTable(),o=e.getCreatedById(),i=e.getCreatedTime(),n=e.getLastEditedByTable(),r=e.getLastEditedById(),s=e.getLastEditedTime(),l=h.default.getIntl();if(t&&o&&i&&s&&n&&r){const c=g({parentStore:e,pointer:{table:t,id:o}}),d=(0,p.$b)(i,a.SP,l),u=g({parentStore:e,pointer:{table:n,id:r}}),m=(0,p.$b)(s,a.SP,l);if(!u)return;return{createdBy:c,createdTime:d,lastEditedBy:u,lastEditedTime:m}}}const C=function(e){let{isPageMoreButton:t,hideTopBorder:o,store:i}=e;window.__c={n:"BlockAuthorInfo"};const a=(0,l.VK)((()=>k(i)),[i]),{device:p}=(0,s.O7)(),m=(0,l.VK)((()=>p.isPhone),[p]),g=h.default.getIntl(),C=(0,c.yK)((()=>({menuItem:{paddingTop:m?8:o?0:6,paddingBottom:m?8:16}})),[o,m]);return n()(b.Z,{topBorder:!t&&!o,style:{paddingTop:t?0:8,paddingBottom:8}},void 0,n()(y.Z,{style:a?void 0:C.menuItem,shouldWrapTitle:!0,title:a?n()(S.Z,{placement:f.u.Right,render:e=>r.createElement("div",e,n()(w.Z,{isSmall:!0,isSecondaryColor:!0,isMobile:p.isPhone,isMultiline:!0,style:{marginBottom:4}},void 0,n()(u.FormattedMessage,{id:"blockAuthorInfo.label",defaultMessage:"Last edited by {author}",values:{author:a.lastEditedBy.value?(0,d.$4)(g,a.lastEditedBy):void 0}})),n()(w.Z,{isSmall:!0,isSecondaryColor:!0,isMobile:p.isPhone},void 0,a.lastEditedTime)),renderTooltip:()=>n()(v.Z,{store:i,compactFormat:!0})}):void 0,loading:!a}))}},41216:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(82990),p=o(80025),u=o(33929),m=o(60709),g=o(52275),h=o(58261);class f extends l.Z{renderComponent(){const{color:e,overrideDisplayName:t}=this.props,o=t||u.default.formatMessage((0,p.qf)(e)),i=!this.environment.device.isMobile&&this.props.shortcuts&&this.props.shortcuts[0];return s.createElement(g.Z,n()({},this.props,{title:o,icon:this.renderIcon(),dontShrinkRight:!0,right:this.props.right||i&&a()(h.Z,{name:i,style:this.getShortcutStyle()})}))}renderIcon(){return a()("div",{style:this.getColorIconStyle()},void 0,"A")}getShortcutStyle(){return{color:this.theme.lightTextColor,fontSize:12,whiteSpace:"nowrap"}}getColorIconStyle(){return{display:"inline-flex",alignItems:"center",justifyContent:"center",width:22,height:22,textAlign:"center",fontSize:16,borderRadius:3,fontWeight:d.Z.fontWeight.medium,boxShadow:this.theme.innerBorderBoxShadow,...(0,c.fi)(this.props.color,this.theme)}}}f.displayName="BlockColorMenuItem",f.contextTypes={...m.mw,...l.w};const v=f},98692:(e,t,o)=>{o.d(t,{Z:()=>b});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(8848),l=o(47425),c=o(5366),d=o(93678),p=o(62216),u=o(21115),m=o(10161),g=o(78291),h=o(64921),f=o(61519),v=o(76844);class y extends a.Z{constructor(){super(...arguments),this.handleClick=()=>{d.y(this.environment,{from:"sidebar"===this.props.source?"block_limit_sidebar":"block_limit_settings",for:l.$M})}}renderComponent(){const{data:e}=g.default.state;if(!e)return;if(0===u.Lz(this.environment,e))return;const t=u.zl(this.environment,e);if("sidebar"===this.props.source){if(m.default.checkGate("show-block-limit-usage-earlier")){if(t<.05)return}else if(!u.XZ(this.environment,e))return}return n()(r.Fragment,{},void 0,this.renderDivider("settings"===this.props.source),n()(h.Z,{style:y.buttonStyle,onClick:this.handleClick},void 0,n()("div",{style:y.headerStyle},void 0,n()(c.FormattedMessage,{id:"spaceSettings.sidebar.upgradeLink",defaultMessage:"Upgrade to go unlimited"})),n()("div",{style:y.labelStyle},void 0,n()("div",{style:this.usageLabelStyle(t)},void 0,u.cA(this.environment,e)),!(0,p.du)()&&n()(v.Z,{style:{marginTop:12,marginBottom:12},percent:t}),n()("div",{style:y.ctaStyle},void 0,n()(c.FormattedMessage,{id:"spaceSettings.sidebar.button.upgrade",defaultMessage:"Upgrade plan"})))))}renderDivider(e){return n()(f.Z,e?{size:27,style:{paddingLeft:14,paddingRight:14}}:{size:0})}usageLabelStyle(e){return e>u.Tj&&!(0,p.du)()?(0,s.x7)("red",this.theme):{}}}y.displayName="BlockLimitUsage",y.buttonStyle={padding:14,fontSize:12,lineHeight:1.4},y.headerStyle={fontWeight:500,lineHeight:2},y.labelStyle={fontWeight:400},y.ctaStyle={textDecoration:"underline"};const b=y},80209:(e,t,o)=>{o.d(t,{Z:()=>y});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(26825),l=o(82990),c=o(5366),d=o(47307),p=o(10279),u=o(18878),m=o(617),g=o(98165),h=o(64921),f=o(64369);class v extends a.Z{constructor(){super(...arguments),this.handleRestorePermissionAction=async()=>{const{store:e}=this.props,t=e.getPermissionItems(),o=g.Om(e),i=o?s.Wo(g.fJ(o)):[],r={type:"restore",permissionChanges:s.Xr(t,i)};await d.confirmUserAction({message:(0,u.mX)(r),acceptLabel:(0,u.nH)(r),cancelLabel:n()(c.FormattedMessage,{id:"restrictedPermissionConfirmationModal.actionButton.cancel",defaultMessage:"Close"}),description:n()(u.mo,{openState:r})})&&p.hs({environment:this.environment,store:e})}}renderComponent(){const{store:e}=this.props,t={environment:this.environment,blocks:[e],publicEditMode:void 0};if(m.xD([m.X,m.ff(m.J5)])(t)){const{device:e}=this.environment,o=m.xD([m.c2,m.ff(m.zz)])(t);return r.createElement(r.Fragment,null,n()("div",{style:{backgroundColor:this.theme.sidebarSecondaryBackground,boxShadow:`0 -1px 0 ${this.theme.regularDividerColor}`,marginTop:e.isMobile?28:1}},void 0,n()(h.Z,{disabled:!o,style:{padding:12},onClick:this.handleRestorePermissionAction},void 0,n()(f.Z,{isMultiline:!0,isSmall:!0},void 0,n()(c.FormattedMessage,{id:"blockMenuRestrictedMessage.label",defaultMessage:"You don’t have permission to edit this block because it is restricted."})),o&&n()(f.Z,{style:{marginTop:6,fontWeight:l.Z.fontWeight.semibold}},void 0,n()(c.FormattedMessage,{id:"blockMenuRestrictedMessage.adminRestoreAction.label",defaultMessage:"Restore permissions"})))))}}}v.displayName="BlockMenuRestrictedMessage";const y=v},2456:(e,t,o)=>{o.d(t,{pH:()=>A,SX:()=>D,KX:()=>L,Tl:()=>V,ZD:()=>N,xP:()=>O,Hq:()=>H,SP:()=>z,ZP:()=>W});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(13991),l=o(24405),c=o(17215),d=o(41432),p=o(99036),u=o(80951),m=o(83212),g=o(39068),h=o(6695),f=o(42875),v=o(3779),y=o(22808),b=o(59753),S=o(98459),w=o(21202),k=o(6287),C=o(97880),_=o(82990),M=o(5366),T=o(33929),I=o(77505),P=o(30874),x=o(81865),B=o(31278),Z=o(79931),E=o(63867);const R=(0,M.defineMessages)({[d.Ti.quote]:{defaultMessage:"Quote",id:"edit.quoteBlock.label"},[d.Ti.callout]:{defaultMessage:"Callout",id:"edit.calloutBlock.label"},[d.Ti.button]:{defaultMessage:"Button",id:"edit.buttonBlock.label",description:"The caption for a newly created button block in page updates."},[d.Ti.factory]:{defaultMessage:"Template Button",id:"edit.templateButtonBlock.label"},[d.Ti.bookmark]:{defaultMessage:"Bookmark",id:"edit.bookmarkBlockProperty.label"},[d.Ti.equation]:{defaultMessage:"Equation",id:"edit.equationBlock.label"}});function A(e){return R[e]&&T.default.formatMessage(R[e])}function D(e,t){return e.properties&&e.properties[t]||[]}class F extends a.Z{constructor(){super(...arguments),this.inCommentsSidebar=()=>"comments_sidebar"===this.props.blockPreviewLocation,this.getRecordValue=this.props.rootStore.getRecordValue,this.getRecordModel=b.om.fromGetRecordValueFn(this.getRecordValue)}renderComponent(){const{blockValue:e}=this.props;switch(e.type){case d.Ti.text:return this.renderTextBlock(e);case d.Ti.header:return this.renderHeaderBlock(e);case d.Ti.subHeader:return this.renderSubHeaderBlock(e);case d.Ti.subSubHeader:return this.renderSubSubHeaderBlock(e);case d.Ti.toggle:return this.renderToggleBlock(e);case d.Ti.bulletedList:return this.renderBulletedListBlock(e);case d.Ti.numberedList:return this.renderNumberedListBlock(e);case d.Ti.quote:return this.renderQuoteBlock(e);case d.Ti.factory:return this.renderFactoryBlock(e);case d.Ti.button:{const t=b.kk.fromBlock(e).getAutomationPointer();if(t){const e=this.getRecordValue(t);if(e)return this.renderButtonBlock(e)}break}case d.Ti.equation:return this.renderEquationBlock(e);case d.Ti.toDo:return this.renderTodoBlock(e);case d.Ti.code:return this.renderCodeBlock(e);case d.Ti.bookmark:return this.renderBookmarkBlock(e);case d.Ti.page:return this.renderPageBlock(e);case d.Ti.collectionView:case d.Ti.collectionViewPage:{const t=b.kk.fromBlock(e).getCollectionPointer();if(t){const e=this.getRecordValue(t);if(e)return this.renderCollectionBlock(e)}break}case d.Ti.image:return this.renderImageBlock(e);case d.Ti.embed:return this.renderEmbedBlock(e,"embed");case d.Ti.framer:return this.renderEmbedBlock(e,"framer");case d.Ti.tweet:return this.renderEmbedBlock(e,"tweet");case d.Ti.gist:return this.renderEmbedBlock(e,"gist");case d.Ti.drive:return this.renderDriveBlock(e);case d.Ti.maps:return this.renderEmbedBlock(e,"maps");case d.Ti.invision:return this.renderEmbedBlock(e,"invision");case d.Ti.video:return this.renderEmbedBlock(e,"video");case d.Ti.audio:return this.renderEmbedBlock(e,"audio");case d.Ti.file:return this.renderEmbedBlock(e,"file");case d.Ti.callout:return this.renderCalloutBlock(e);case d.Ti.whimsical:return this.renderEmbedBlock(e,"whimsical");case d.Ti.miro:return this.renderEmbedBlock(e,"miro");case d.Ti.abstract:return this.renderEmbedBlock(e,"abstract");case d.Ti.mixpanel:return this.renderEmbedBlock(e,"mixpanel");case d.Ti.sketch:return this.renderEmbedBlock(e,"sketch");case d.Ti.excalidraw:return this.renderEmbedBlock(e,"excalidraw");case d.Ti.replit:return this.renderEmbedBlock(e,"replit");case d.Ti.pdf:return this.renderEmbedBlock(e,"pdf");case d.Ti.table:return this.renderSimpleTableBlock(e);case d.Ti.tableRow:return this.renderSimpleTableRowBlock(e);case d.Ti.externalObjectInstance:return this.renderExternalObjectInstanceBlock(e)}}getEditBoxStyle(){return this.inCommentsSidebar()?{marginTop:0,marginBottom:0}:void 0}renderBlockProperty(e,t,o,i){return n()(V,{blockValue:e,prop:t,labeled:o,schema:i,intl:this.props.intl,rootStore:this.props.rootStore})}renderBlockTitle(e){return this.renderBlockProperty(e,"title",!1)}renderCheckbox(e){return n()("div",{style:{marginRight:6,marginTop:3}},void 0,this.renderBlockProperty(e,"checked",!1))}renderTextBlock(e){return this.renderBlockTitle(e)}renderCalloutBlock(e){return n()(m.Z,{title:A(d.Ti.callout),theme:this.theme,created:this.props.created,style:this.getEditBoxStyle(),deleted:this.props.deleted},void 0,this.renderBlockTitle(e))}renderHeaderBlock(e){return n()("div",{style:Z.v.headerStyle},void 0,this.renderBlockTitle(e))}renderSubHeaderBlock(e){return n()("div",{style:Z.v.subHeaderStyle},void 0,this.renderBlockTitle(e))}renderSubSubHeaderBlock(e){return n()("div",{style:Z.v.subSubHeaderStyle},void 0,this.renderBlockTitle(e))}renderToggleBlock(e){return n()(N,{},void 0,this.renderBlockTitle(e))}renderBulletedListBlock(e){return n()("ul",{style:{margin:0,paddingLeft:28}},void 0,n()("li",{},void 0,this.renderBlockTitle(e)))}renderNumberedListBlock(e){return n()("ol",{style:{margin:0,paddingLeft:28}},void 0,n()("li",{},void 0,this.renderBlockTitle(e)))}renderQuoteBlock(e){return n()(m.Z,{title:A(d.Ti.quote),theme:this.theme,style:this.getEditBoxStyle(),created:this.props.created,deleted:this.props.deleted},void 0,this.renderBlockTitle(e))}renderFactoryBlock(e){return n()(m.Z,{title:A(d.Ti.factory),theme:this.theme,style:this.getEditBoxStyle(),created:this.props.created,deleted:!0},void 0,this.renderBlockTitle(e))}renderButtonBlock(e){var t;return r.createElement(r.Fragment,null,n()(m.Z,{title:A(d.Ti.button),theme:this.theme,style:this.getEditBoxStyle(),created:this.props.created,deleted:this.props.deleted},void 0,(null===(t=e.properties)||void 0===t?void 0:t.name)??n()(M.FormattedMessage,{defaultMessage:"Untitled",id:"edit.buttonBlock.defaultTitle",description:"The default title for an untitled button block in page history and updates."})),n()(M.FormattedMessage,{defaultMessage:"{numberOfActions, plural, one {{numberOfActions} workflow step} other {{numberOfActions} workflow steps}}",id:"edit.buttonBlock.actionCount",description:"The number of workflow steps to show in page updates when a user creates a button block.",values:{numberOfActions:(e.action_ids||[]).length}}))}renderEquationBlock(e){return n()(m.Z,{title:A(d.Ti.equation),theme:this.theme,style:this.getEditBoxStyle(),created:this.props.created,deleted:this.props.deleted},void 0,this.renderBlockTitle(e))}renderTodoBlock(e){return n()("div",{style:{display:"inline-flex"}},void 0,this.renderCheckbox(e),this.renderBlockTitle(e))}renderCodeBlock(e){return n()(m.Z,{title:z(e),theme:this.theme,style:this.getEditBoxStyle(),created:this.props.created,deleted:this.props.deleted},void 0,n()("span",{style:{fontFamily:_.Z.getCompositeFontFamily(s.SP).mono,fontSize:12,tabSize:2}},void 0,this.renderBlockTitle(e)))}renderCaption(e){return this.hasProperty(e,"caption")&&this.renderBlockProperty(e,"caption",!1)}renderEmbedBlock(e,t){const{intl:o}=this.props;return n()(r.Fragment,{},void 0,n()(m.Z,{title:c.xg(o,t),theme:this.theme,style:this.getEditBoxStyle(),created:this.props.created,deleted:this.props.deleted},void 0,this.renderSource(e)),n()("div",{style:{marginBottom:4}},void 0,this.renderCaption(e)))}renderImageBlock(e){const t=this.getSource(e);if(t){const o=this.renderCaption(e);return"comments_sidebar"===this.props.blockPreviewLocation?n()(r.Fragment,{},void 0,n()("div",{style:{display:"flex",flexDirection:"column"}},void 0,n()(O,{src:t,permissionRecord:{table:w.iU,id:e.id}}),o&&n()("div",{style:{marginBottom:4}},void 0,o))):n()(r.Fragment,{},void 0,n()("div",{style:{display:"flex"}},void 0,n()("div",{style:{marginTop:4,marginBottom:4}},void 0,n()(O,{src:t,permissionRecord:{table:w.iU,id:e.id}}))),o&&n()("div",{style:{marginBottom:4}},void 0,o))}}renderBookmarkBlock(e){const t=this.hasProperty(e,"title")&&n()(m.Z,{title:A(d.Ti.bookmark),theme:this.theme,style:this.getEditBoxStyle(),created:this.props.created},void 0,this.renderBlockTitle(e));return n()(r.Fragment,{},void 0,t,this.hasProperty(e,"caption")&&n()("div",{style:{marginBottom:t?4:0}},void 0,this.renderCaption(e)))}renderDriveBlock(e){const t=(0,h.v0)(e);return t&&t.title?n()("div",{},void 0,n()(m.Z,{title:n()(M.FormattedMessage,{defaultMessage:"Google Drive file",id:"edit.googleDriveFile.label"}),created:!this.props.deleted,deleted:this.props.deleted,theme:this.theme,style:this.getEditBoxStyle()},void 0,t.title)):e.content?this.renderEmbedBlock(e,"drive"):void 0}renderPageBlock(e){const t=this.getRecordValue({table:w.iU,id:e.id})||e,o=b.kk.fromBlock(t).getRenderTitle({getRecordModel:this.getRecordModel,userTimeZone:(0,f.r)(),intl:this.props.intl})||n()(M.FormattedMessage,{defaultMessage:"Untitled",id:"edit.pageBlock.untitled"});return n()("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"}},void 0,n()("div",{style:{paddingRight:6}},void 0,n()(U,{icon:t&&t.format&&t.format.page_icon,rootStore:this.props.rootStore,blockValue:this.props.blockValue})),n()("div",{className:"notranslate",style:{flex:1,textOverflow:"ellipsis",overflow:"hidden"}},void 0,o))}renderCollectionBlock(e){const t=this.getRecordValue({table:k.v,id:e.id})||e,o=b.kk.fromCollection(t).getRenderTitle({intl:this.props.intl,getRecordModel:this.getRecordModel,userTimeZone:(0,f.r)()})||n()(M.FormattedMessage,{defaultMessage:"Untitled",id:"edit.collectionBlock.untitled"});return n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()("div",{style:{paddingRight:4}},void 0,n()(U,{icon:t&&t.icon,rootStore:this.props.rootStore,blockValue:this.props.blockValue})),n()("div",{style:{flex:1}},void 0,o))}renderSimpleTableBlock(e){var t,o,i,r;const a=(null===(t=e.content)||void 0===t?void 0:t.length)||0,s=(null===(o=e.format)||void 0===o||null===(i=o.table_block_column_order)||void 0===i?void 0:i.length)||0;if(!a||!s)return;const l=e.content?e.content.map((t=>this.getRecordValue({table:e.parent_table,id:t,spaceId:e.space_id}))):[],c=null===(r=e.format)||void 0===r?void 0:r.table_block_column_order;return n()("div",{style:{overflow:"scroll"}},void 0,n()("table",{},void 0,n()("tbody",{},void 0,l.map((e=>e?n()("tr",{},void 0,null==c?void 0:c.map((t=>this.renderSimpleTableCell(e,t)))):void 0)))))}renderSimpleTableRowBlock(e){var t;if(!e.properties||0===(0,C.Yd)(e.properties).length)return;const o=this.getRecordValue({table:e.parent_table,id:e.parent_id,spaceId:e.space_id});if(!o)return;const i=null===(t=o.format)||void 0===t?void 0:t.table_block_column_order;return n()("div",{style:{display:"flex",alignItems:"stretch",margin:4}},void 0,n()("table",{},void 0,n()("tr",{},void 0,null==i?void 0:i.map((t=>this.renderSimpleTableCell(e,t))))))}renderExternalObjectInstanceBlock(e){const t=b.kk.fromBlock(e);return n()(m.Z,{title:r.createElement(M.FormattedMessage,c.V1.editLabel),theme:this.theme,created:this.props.created,style:this.getEditBoxStyle(),deleted:this.props.deleted},void 0,c.$F(T.default.getIntl(),t,b.om.fromRecordMap(P.Z.getIntegrationsAsRecordMap())))}renderSimpleTableCell(e,t){const o=D(e,t),i=o&&o.length>0?I.f7({environment:this.environment,cellValue:o,spaceId:e.space_id,parentStore:this.props.rootStore,theme:this.theme}):n()("span",{},void 0," ");return n()("td",{style:{border:`1px solid ${this.theme.tableDividerColor}`,height:"100%"}},void 0,n()("div",{style:{overflowWrap:"break-word",overflow:"hidden",textOverflow:"ellipsis",width:"max-content",maxWidth:120,verticalAlign:"top",lineHeight:_.Z.lineHeight.UIRegular.desktop,padding:4}},void 0,i))}renderSource(e){const t=this.getSource(e);return n()("div",{style:{overflow:"hidden",textOverflow:"ellipsis"}},void 0,n()("span",{style:{wordBreak:"break-word"}},void 0,t))}getSource(e){const t=e&&e.properties&&e.properties.source;return u.zB(t)}hasProperty(e,t){return Boolean(e&&e.properties&&e.properties[t])}}function L(e){let{value:t,propertySchema:o,labeled:i,rootStore:r,disableStyleAnnotations:a,disableDateStyleAnnotations:s}=e;return window.__c={n:"BlockPreviewProperty"},n()(H,{labeled:i,type:o.type,icon:o.icon,name:o.name},void 0,n()(E.Z,{propertySchema:o,value:t,rootStore:r,disableStyleAnnotations:a,disableDateStyleAnnotations:s}))}function V(e){let{blockValue:t,prop:o,labeled:i,schema:r,intl:a,rootStore:s}=e;const l=(r||p.Kc(a))[o];if(l){const e=D(t,o);return n()(L,{value:{value:e,spaceId:(0,S.CG)(t.space_id)},propertySchema:l,labeled:i,rootStore:s})}return null}function N(e){let{children:t}=e;window.__c={n:"Toggle"};const o=n()("div",{style:{width:"1em",height:"1em",display:"flex",alignSelf:"stretch",justifyContent:"center",flexShrink:0,marginLeft:6,marginRight:6,marginTop:6}},void 0,v.Z.triangle({width:"0.6875em",height:"0.6875em",transform:"rotateZ(90deg)"}));return n()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,o,n()("span",{},void 0,t))}function O(e){let{src:t,permissionRecord:o}=e;const i=(0,l.Fg)();return t?n()(x.Z,{url:t,isAuthenticated:!0,permissionRecord:o,width:170,render:(e,t)=>{if(t)return n()("img",{src:t,style:{maxHeight:170,maxWidth:170}})}}):n()("div",{style:{backgroundColor:i.lightTextColor,height:170,width:170}})}function U(e){let{icon:t,rootStore:o,blockValue:i}=e;if(t){if((0,y.Z)(t))return n()("div",{style:{fontSize:16.2,display:"inline-block"}},void 0,t);{const e=b.kk.fromBlock(i).getRenderIcon({getRecordModel:o.getRecordModel});return n()(B.Z,{disabled:!0,icon:e,isEmptyPage:!1,size:18,style:{marginTop:6,marginBottom:6}})}}return v.Z.page({height:18,width:18})}function H(e){let{children:t,type:o,icon:i,name:r,labeled:a}=e;const s=(0,l.Fg)();return a?n()("div",{},void 0,n()("div",{style:{display:"flex",color:s.lightTextColor,paddingTop:7,fontSize:12,lineHeight:1,marginBottom:2}},void 0,n()(g.ZP,{type:o,icon:i,size:14,theme:s}),n()("div",{style:{marginLeft:6}},void 0,r)),n()("div",{style:{display:"flex",alignItems:"center",minHeight:24}},void 0,t)):n()("div",{},void 0,t)}function z(e){window.__c={n:"getCodeTitle"};const t=e&&e.properties&&e.properties.language;if(!t)return n()(M.FormattedMessage,{defaultMessage:"Code",id:"edit.codeBlockChanged.label"});const o=u.Sj(t,p.fG);return n()(M.FormattedMessage,{defaultMessage:"Code - {codeLanguage}",values:{codeLanguage:o},id:"edit.codeBlockWithLanguageChanged.label"})}F.displayName="BlockPreview";const W=(0,M.injectIntl)(F)},70518:(e,t,o)=>{o.d(t,{IS:()=>P,bZ:()=>x,ZP:()=>Z});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(62518),p=o(83355),u=o(41432),m=o(95538),g=o(50906),h=o(96802),f=o(24677),v=o(30149),y=o(28020),b=o(43250),S=o(77546),w=o(58202),k=o(49427),C=o(68859),_=o(3815),M=o(91681),T=o(27724),I=o(6685);let P,x;!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Corner=2]="Corner"}(P||(P={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(x||(x={}));class B extends p.Z{constructor(){super(...arguments),this.dragState=void 0,this.domElm=null,this.storeTypes={blockResizerStore:C.Z},this.handleRef=e=>{this.domElm=e},this.handleDragStart=e=>{e.preventDefault();const t=d.findDOMNode(this.props.resizeComponent);if(!(t&&t instanceof Element))return;let o=0;if(this.domElm){const e=(0,S.VW)(this.domElm);e&&(o=e.getBoundingClientRect().width)}let i=0;const n=this.props.store.getRecordStoreUIParent(),r=n&&n.findRecordStoreUIAncestor((e=>e instanceof _.G)).ancestor;if(r){const e=w.R.getRect(r);e&&(i=e.width);const t=r.getRecordStoreUIParent(),o=t&&t.findRecordStoreUIAncestor((e=>e instanceof _.G)).ancestor;if("tab"===(null==o?void 0:o.getType())){const e=w.R.getRect(o);e&&(i=e.width)}}const a=this.getPageViewWrapWidth()||0,s=T.default.state.stores.filter((e=>this.isResizable(e)));let c;c=l().includes(s,this.props.store)?s:[this.props.store];const{block_width:p,block_height:u,block_full_width:m,block_page_width:g}=this.props.store.getFormat();this.stores.blockResizerStore.setState({...this.stores.blockResizerStore.state,dragging:!0,temporaryHeight:u,temporaryWidth:p,temporaryFullWidth:m,temporaryPageWidth:g}),M.Z.setState({...M.Z.state,isResizing:!0}),f.ZH(this.environment);const h=t.getBoundingClientRect();this.dragState={resizingBlocks:c,startWidth:h.width,startHeight:h.height,parentWidth:i,pageWidth:a,isRootChild:this.props.store.isChildOfRecordStoreUIRoot(),startScrollerWidth:o,didDragMove:!1}},this.handleHorizontalDragMove=e=>{let{diffX:t}=e;if(!this.dragState)return;this.dragState.didDragMove=!0;const{temporaryHeight:o}=this.stores.blockResizerStore.state,{width:i,isFullWidth:n,isPageWidth:r}=this.getNewWidthStyleValue(t);if(this.props.preserveScale){const e=n?o||m.QA:o;this.stores.blockResizerStore.setState({...this.stores.blockResizerStore.state,temporaryWidth:i,temporaryFullWidth:n,temporaryPageWidth:r,temporaryHeight:e})}else this.stores.blockResizerStore.setState({...this.stores.blockResizerStore.state,temporaryWidth:i,temporaryFullWidth:n,temporaryPageWidth:r})},this.handleVerticalDragMove=e=>{let{diffY:t}=e;if(!this.dragState)return;this.dragState.didDragMove=!0;const{height:o}=this.getNewHeightStyleValue(t);this.stores.blockResizerStore.setState({...this.stores.blockResizerStore.state,temporaryHeight:o})},this.handleCornerDragMove=e=>{let{diffX:t,diffY:o}=e;if(!this.dragState)return;this.dragState.didDragMove=!0;const{width:i,isFullWidth:n,isPageWidth:r}=this.getNewWidthStyleValue(t),{height:a}=this.getNewHeightStyleValue(o);this.stores.blockResizerStore.setState({...this.stores.blockResizerStore.state,temporaryWidth:i,temporaryHeight:a,temporaryFullWidth:n,temporaryPageWidth:r})},this.handleDragMove=e=>this.props.resizerType===P.Horizontal?this.handleHorizontalDragMove(e):this.props.resizerType===P.Vertical?this.handleVerticalDragMove(e):this.props.resizerType===P.Corner?this.handleCornerDragMove(e):void 0,this.handleDragEnd=e=>{if(!this.dragState)return;const t=this.stores.blockResizerStore.state;if(this.dragState.didDragMove&&t.dragging){const{temporaryPageWidth:e,temporaryFullWidth:t,temporaryWidth:o,temporaryHeight:i}=this.stores.blockResizerStore.state;v.createAndCommit({userAction:"BlockResizer.handleDragEnd",environment:this.environment,perform:n=>{this.dragState&&h.FH({stores:this.dragState.resizingBlocks,update:{block_height:i,block_width:o,block_full_width:t,block_page_width:e},transaction:n})}});const n=this.props.store.getType();n&&g.trackEmbedBlockResize(this.environment,{block_type:n,block_height:i,block_width:o,block_full_width:t,block_page_width:e})}this.endDrag()},this.handleDragCancel=e=>this.endDrag()}renderComponent(){return n()(I.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,preventSidebar:!0,render:e=>c.createElement("div",a()({ref:this.handleRef,style:B.style,className:b.Ep8},e),this.props.children)})}isResizable(e){const t=e&&e.getType();return t&&u.Ok[t]}isCenterAligned(){const e=this.props.store.getModel();return this.props.store.isChildOfRecordStoreUIRoot()&&(null==e?void 0:e.isType(u.ib))}endDrag(){this.stores.blockResizerStore.setState({...this.stores.blockResizerStore.state,dragging:!1,temporaryPageWidth:void 0,temporaryFullWidth:void 0,temporaryWidth:void 0,temporaryHeight:void 0}),f.ZH(this.environment),M.Z.setState({...M.Z.state,isResizing:!1}),this.dragState=void 0}getNewHeightStyleValue(e){const t=this.getNewPixelHeight(e);return{height:Math.min(t,m.Kz)}}getNewPixelHeight(e){if(this.dragState){if(this.props.resizeVertically){const t=this.props.store.getType(),o=t&&B.minHeightMap[t]||B.defaultMinHeight;return Math.max(this.dragState.startHeight+e,o)}return this.dragState.startHeight}return 0}getNewWidthStyleValue(e){const t=this.getNewPixelWidth(e),o=this.getRound(t),i=Math.round(t/o)*o,n=this.isPageWidth(t,o);return{width:i,isFullWidth:this.isFullWidth(t,o)&&!n,isPageWidth:n}}isPageWidth(e,t){return!!this.dragState&&(this.dragState.isRootChild?this.dragState.pageWidth<e+t&&this.dragState.pageWidth>e-t:this.dragState.parentWidth<e+t)}isFullWidth(e,t){if(this.dragState&&this.dragState.isRootChild){let o=this.dragState.startScrollerWidth;const i=this.props.store.getModel();return i&&!i.isType(u.GP)&&(o-=2*(0,y.ui)(this.environment)),o<e+t}return!1}getNewPixelWidth(e){if(!this.dragState)throw new Error("No start rect.");this.isCenterAligned()&&(e*=2);let t=this.dragState.startWidth;this.props.resizeHorizontally&&(this.props.resizerAlignment===x.Left?t-=e:this.props.resizerAlignment===x.Right&&(t+=e));const o=this.props.store.getType(),i=o&&B.minWidthMap[o]||B.defaultMinWidth,n="page_width"===i?Math.min(this.dragState.parentWidth,this.dragState.pageWidth):i;return n&&t<n&&(t=n),t}getRound(e){return e<144?12:48}getPageViewWrapWidth(){const e=this.props.store.getRecordStoreUIRoot(),t=k.Z.find((t=>t.props.store===e));if(t)return t.getContentInnerWidth()}}B.displayName="BlockResizer",B.defaultMinWidth=96,B.minWidthMap={[u.Ti.image]:36,[u.Ti.video]:96,[u.Ti.embed]:246,[u.Ti.maps]:96,[u.Ti.framer]:96,[u.Ti.tweet]:250,[u.Ti.gist]:96,[u.Ti.audio]:96,[u.Ti.drive]:300,[u.Ti.invision]:96,[u.Ti.pdf]:96,[u.Ti.columnList]:"page_width",[u.Ti.drawing]:300},B.defaultMinHeight=96,B.minHeightMap={[u.Ti.image]:36,[u.Ti.audio]:24,[u.Ti.video]:96,[u.Ti.embed]:96,[u.Ti.drive]:96,[u.Ti.tweet]:96,[u.Ti.framer]:96,[u.Ti.maps]:96,[u.Ti.gist]:96,[u.Ti.invision]:96,[u.Ti.pdf]:96,[u.Ti.drawing]:200},B.style={display:"contents"};const Z=B},1449:(e,t,o)=>{o.d(t,{Z:()=>K});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(62518),c=o(83355),d=o(3779),p=o(27006),u=o(82990),m=o(5366),g=o(22889),h=o(50906),f=o(11302),v=o(52771),y=o(5978),b=o(28020),S=o(73744),w=o(60709),k=o(98165),C=o(45010),_=o(8323),M=o(23537),T=o(25464),I=o(79315),P=o(88923),x=o(3815),B=o(73299),Z=o(62294),E=o(40793),R=o(99208),A=o(64921),D=o(31945),F=o(78140),L=o(9342),V=o(40721),N=o(89728),O=o(31278),U=o(11470),H=o(76798),z=o(72495),W=o(58032);class j extends c.Z{constructor(){super(...arguments),this.comp=void 0,this.moveToButton=void 0,this.shouldShowMoveToStore=this.createComputedStore((()=>{if(!(0,M.bq)())return!1;if(!(0,_.mq)())return!1;const{store:e}=this.props,{currentSpaceViewStore:t}=I.default.state,o=null==t?void 0:t.getPrivatePages(this.environment);return null==o?void 0:o.some((t=>t.id===e.id))})),this.handleCurrentPageMount=e=>{this.comp=e},this.handleMoveToMount=e=>{this.moveToButton=e},this.handleClickCurrentPage=()=>{const e=P.default.isMiniOrCenterPeekOpen()?C.Z.PeekViewScroller:C.Z.PageScroller;if(e&&!e.atScrollStart())return e.scrollToTop({animate:!0}),void h.trackClickBreadcrumbCurrentPageScrollToTop(this.environment);const{store:t}=this.props,o=t.canEdit(),i=t.isLocked(),n=t.getCollectionViewCollectionStore(),r=null==n?void 0:n.isSyncedCollection(),a=t.isExternalObjectInstancePageBlockStore();if(this.props.isMobile||P.default.isMiniOrCenterPeekOpen()||!this.comp||!o||i||a||r||(0,b.xe)(t.id))return;const s=l.findDOMNode(this.comp);if(!s)return;if(!(s instanceof Element))return;const c=s.getBoundingClientRect();v.$({blockStore:t,originRect:c}),h.trackOpenBreadcrumbCurrentPageMenu(this.environment)},this.handleClickMoveTo=()=>{if(!this.moveToButton)return;const e=l.findDOMNode(this.moveToButton);if(!(e&&e instanceof Element))return;const t=e.getBoundingClientRect(),o=new DOMRect(t.x,t.y,t.width,t.height+5);h.trackClickBreadcrumbMoveTo(this.environment),f.bA({environment:this.environment,blocks:[this.props.store],originRect:o,moveToContext:"topbar_breadcrumb"})}}renderComponent(){var e;const{store:t}=this.props,o=t.getTitleStore();if(o&&o.isReady())return null!==(e=this.environment.mobileNative)&&void 0!==e&&e.supportsNativeHomeOnPhone()?a()("div",{style:this.getStyle({ignoreMaxLength:!1}),className:"notranslate"},void 0,this.renderCurrentPageThatOpensBreadcrumbs()):a()("div",{style:this.getStyle(),className:"notranslate"},void 0,this.renderAncestors(),this.renderCurrentPage(),this.renderMoveTo())}renderCurrentPage(){if(this.props.showCurrentPageControls)return this.renderCurrentPageWithControls();{const{store:e,isMobile:t}=this.props,{mobileNative:o}=this.environment;if(t){const t=k.uJ(e),i=0===(e.isNavigableBlock()?t.slice(1):[...t]).length;return s.createElement(s.Fragment,null,a()(N.Z,{shouldShrink:!0,onClick:this.handleClickCurrentPage,isSmall:!0,style:null!=o&&o.supportsNativeHomeOnPhone()?{paddingLeft:0}:void 0},void 0,this.renderReadOnlyPage({store:e,showDivider:!1,ignoreMaxLength:i})))}return a()(N.Z,{shouldShrink:!0,onClick:this.handleClickCurrentPage,isSmall:!0,style:{fontSize:"inherit"}},void 0,this.renderReadOnlyPage({store:e,showDivider:!1}))}}renderCurrentPageThatOpensBreadcrumbs(){const{store:e}=this.props,t=k.uJ(e);return t.reverse(),a()(D.Z,{popupType:D.Z.PopupType.SlideUp,renderOrigin:t=>s.createElement(A.Z,n()({style:{...j.dividerWrapStyle,maxWidth:"100%"},mobileFeedback:!0},t),this.renderReadOnlyPage({store:e,showDivider:!1,ignoreMaxLength:!0})),render:e=>{const o={menuType:w.og.Modal,title:a()(m.FormattedMessage,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"}),right:a()(V.DoneMenuText,{}),onClickRight:e.close};return s.createElement(F.Z,o,a()(L.Z,{type:L.i.Vertical,onAccept:e.close,initialFocus:void 0,sections:this.getMenuListSections(t)}))}},"pages-popup")}renderAncestors(){const{store:e,maxAncestorCount:t}=this.props,o=k.uJ(e),i=e.isNavigableBlock()?o.slice(1):[...o];if(i.reverse(),o.reverse(),i.length>t){const[e,n,r]=[i[0],i.slice(1,i.length-t+1),i.slice(i.length-t+1)];if((0,M.bq)())return[this.renderButtonForStore({store:e,showDivider:!this.props.isMobile}),this.renderBlocksAsPopup(this.props.isMobile?o:n),...r.map((e=>e instanceof x.zX?a()(R.Z,{store:e,showDivider:!0,maxWidth:this.props.ancestorMaxWidth}):a()(E.Z,{store:e,showDivider:!0,maxWidth:this.props.ancestorMaxWidth})))];{const e=i.filter((e=>e instanceof x.G)),o=i.filter((e=>e instanceof x.G));return[a()(E.Z,{store:e[0],showDivider:!this.props.isMobile,maxWidth:this.props.ancestorMaxWidth},e[0].id),this.renderBlocksAsPopup(this.props.isMobile?o:e.slice(1,e.length-t+1)),...e.slice(e.length-t+1).map((e=>a()(E.Z,{store:e,showDivider:!0,maxWidth:this.props.ancestorMaxWidth},e.id)))]}}return i.map((e=>this.renderButtonForStore({store:e,showDivider:!0})))}renderButtonForStore(e){const{store:t,showDivider:o}=e;return t instanceof x.zX?a()(R.Z,{store:t,showDivider:o,maxWidth:this.props.ancestorMaxWidth}):a()(E.Z,{store:t,showDivider:o,maxWidth:this.props.ancestorMaxWidth})}renderReadOnlyPage(e){const{store:t,showDivider:o,ignoreMaxLength:i}=e;return a()("div",{style:{display:"flex",alignItems:"center",flexShrink:1,marginLeft:6,minWidth:0,maxWidth:i?void 0:"100%"}},void 0,a()(Z.Z,{store:t,maxWidth:this.props.ancestorMaxWidth,ignoreMaxLength:i}),o&&a()(B.f,{}))}renderCurrentPageWithControls(){const{store:e}=this.props;return e.isReady()?s.createElement(N.Z,{shouldShrink:!0,onClick:this.handleClickCurrentPage,isSmall:!0,ref:this.handleCurrentPageMount},e.hasIcon()&&a()(O.Z,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:this.getIconSize(),style:{marginRight:6},largeIcon:!0}),a()(H.Z,{store:e,style:{maxWidth:this.props.currentPageMaxWidth},enableHover:!0})):null}getMenuListSections(e){return[{key:"results",render:e=>s.createElement(z.Z,e),items:e.map(((e,t)=>({key:e.id,render:o=>s.createElement(U.Z,n()({},o,{isSubpage:0!==t,store:e,hidePath:!0})),action:t=>{let{event:o}=t;const i=S.DJ(o);e instanceof x.G&&y.navigateToBlock({environment:this.environment,store:e,openInNew:i,visitType:g.vu.Link})}})))}]}renderBlocksAsPopup(e){return a()(D.Z,{popupType:this.props.isMobile?D.Z.PopupType.SlideUp:D.Z.PopupType.Popup,renderOrigin:e=>this.props.isMobile?s.createElement(A.Z,n()({style:{...j.dividerWrapStyle},mobileFeedback:!0},e),a()(B.f,{}),a()("div",{style:{marginLeft:8,marginRight:8}},void 0,"..."),a()(B.f,{})):a()("div",{style:j.dividerWrapStyle},void 0,s.createElement(N.Z,n()({isSmall:!0},e),"..."),a()(B.f,{})),render:t=>{let o;return o=this.props.isMobile?{menuType:w.og.Modal,title:a()(m.FormattedMessage,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"}),right:a()(V.DoneMenuText,{}),onClickRight:t.close}:{menuType:w.og.Popup,width:240},s.createElement(F.Z,o,a()(L.Z,{type:L.i.Vertical,onAccept:t.close,initialFocus:void 0,sections:this.getMenuListSections(e)}))}},"pages-popup")}renderMoveTo(){if(!this.shouldShowMoveToStore.state)return;const e=this.environment.currentUser.id;return this.props.store.getPermissionItems().every((t=>(0,p.jg)(t)&&e===t.user_id))?a()(W.Z,{placement:T.u.Right,renderTooltip:e=>a()("div",{},void 0,a()("div",{},void 0,a()(m.FormattedMessage,{defaultMessage:"Only you have access",id:"breadcrumb.moveTo.hasPermission.title",description:"Tooltip to show that only the current user has access to the page"})),a()("div",{style:{color:this.theme.mediumInvertedTextColor}},void 0,a()(m.FormattedMessage,{defaultMessage:"Click to move",id:"breadcrumb.moveTo.hasPermission.subtitle",description:"Tooltip for clicking to open move menu for this page"}))),render:e=>s.createElement(N.Z,n()({isSmall:!0,disabled:!1,onClick:this.handleClickMoveTo,ref:this.handleMoveToMount},e),d.Z.lockedFilled({width:16,fill:this.theme.lightIconColor}),a()("span",{style:{color:this.theme.lightTextColor,marginLeft:4,marginRight:5}},void 0,a()(m.FormattedMessage,{defaultMessage:"Private",id:"breadcrumb.moveTo.privatePages",description:"Label for private pages"})),d.Z.chevronDown({width:9,fill:this.theme.lightIconColor}))}):void 0}getIconSize(){return this.props.isMobile?24:20}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ignoreMaxLength:!0};const{ignoreMaxLength:t}=e;return{display:"flex",alignItems:"center",lineHeight:1.2,fontSize:this.props.isMobile?u.Z.fontSize.UIRegular.mobile:u.Z.fontSize.UIRegular.desktop,maxWidth:t?void 0:"100%",...this.props.style}}}j.displayName="Breadcrumb",j.dividerWrapStyle={display:"flex",alignItems:"center",flexShrink:0};const K=j},4853:(e,t,o)=>{o.d(t,{y:()=>oe,Z:()=>le});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(1302),p=o(480),u=o(81954),m=o(24405),g=o(63362),h=o(3779),f=o(5366),v=o(97880),y=o(82990),b=o(82993),S=o(27153),w=o(9953),k=o(24677),C=o(98104),_=o(30149),M=o(92223),T=o(23223),I=o(12534),P=o(33929),x=o(98742),B=o(52315),Z=o(29502),E=o(63474),R=o(34859),A=o(68910),D=o(49085);class F extends D.Z{getInitialState(){return{editing:!1,suppressErrorsForActionIds:[]}}startEditing(e){this.setState({editing:!0,suppressErrorsForActionIds:[],placement:e.placement})}stopEditing(){this.setState({editing:!1,suppressErrorsForActionIds:[]})}suppressErrorsForAction(e){this.setState({...this.state,suppressErrorsForActionIds:l().uniq([...this.state.suppressErrorsForActionIds,e])})}}const L=F;var V=o(31792),N=o(3815),O=o(77794),U=o(85631),H=o(10052),z=o(86671),W=o(13966),j=o(68709),K=o(42922),Y=o(73063),G=o(68785),X=o(63296),q=o(44532),$=o(31278),J=o(18647),Q=o(72495),ee=o(58032),te=o(38797);const oe=(0,f.defineMessages)({addIconButtonAriaLabel:{defaultMessage:"Add icon",id:"buttonBlock.button.addIconButtonAriaLabel",description:"Aria label for the add icon button"},editButtonAriaLabel:{defaultMessage:"Edit button",id:"buttonBlock.button.editButtonAriaLabel",description:"Aria label for the edit button icon"},buttonPlaceholder:{defaultMessage:"New button",id:"buttonBlock.button.placeholder",description:"Default placeholder for a new button"},buttonInsufficientPermissions:{defaultMessage:"You don’t have permission to run this button",id:"buttonBlock.button.insufficientPermissions",description:"Error message shown when a user doesn't have permissions to run a workflow."},clickToEdit:{defaultMessage:"Click to edit button",id:"buttonBlock.button.clickToEdit",description:"Label for a tooltip that indicates you can click to edit a button automation"}});class ie extends z.Z{constructor(){super(...arguments),this.sizeObserver=new O.E,this.buttonRef=c.createRef(),this.storeTypes={mouseStore:V.Z,buttonBlockStore:L},this.handleContainerMount=e=>{e&&this.sizeObserver.observe(e)},this.configureButtonBlock=e=>{const{buttonBlockStore:t}=this.stores;C.ZH(this.environment),k.ZH(this.environment);this.sizeObserver.rect.get().width<300&&!this.environment.device.isPhone&&e?t.startEditing({placement:{type:"popup",originRect:e}}):t.startEditing({placement:{type:"inline"}})},this.allActionDependenciesLoaded=this.createComputedStore((()=>{var e;const t=(null===(e=this.props.store.getAutomationStore())||void 0===e?void 0:e.getActionStores())??[];for(const o of t){const e=o.getBlockStores();for(const t of e)B.b(t)}}))}handleCreated(){d.default.afterNextFlush((()=>{var e;this.configureButtonBlock(null===(e=this.buttonRef.current)||void 0===e?void 0:e.getBoundingClientRect())}))}willUnmount(){this.sizeObserver.destroy()}willMountOrUpdate(e){super.willMountOrUpdate(e),this.allActionDependenciesLoaded.state}activate(){var e;null===(e=this.buttonRef.current)||void 0===e||e.activate()}renderPersisted(){const{disabled:e,store:t}=this.props,{mouseStore:o,buttonBlockStore:i}=this.stores;return c.createElement(j.p,{allowSelectionWithin:!0,style:{display:"flex"},ref:this.handleContainerMount},a()("div",{style:{flexGrow:1}},void 0,c.createElement(ne,{store:t,mouseStore:o,buttonBlockStore:i,onConfigure:this.configureButtonBlock,ref:this.buttonRef,disabledFromEditing:e}),a()(re,{store:t,disabled:e,buttonBlockStore:i})),this.renderDiscussion({recursivelyLoadAllDiscussions:!0}))}}const ne=c.forwardRef(((e,t)=>{const{store:o,mouseStore:i,buttonBlockStore:r,onConfigure:s,disabledFromEditing:d}=e,S=(0,f.useIntl)(),w=(0,p.O7)(),[_,T]=(0,c.useState)(!1),I=(0,u.VK)((()=>i.state.mouseEntered),[i]),B=(0,u.VK)((()=>o.getAutomationStore()),[o]),Z=(0,u.VK)((()=>(null==B?void 0:B.getNameStore().getValue())??""),[B]),R=(0,u.VK)((()=>null==B?void 0:B.getIconStore().getValue()),[B]),A=function(e){const{store:t,automationStore:o,buttonBlockStore:i}=e,n=se({store:t,automationStore:o});return(0,u.VK)((()=>{const e=null==n?void 0:n.state;if(!e)return{type:"disabled"};if("insufficient"===e.executionPermissionStatus||"unknown"===e.executionPermissionStatus)return{type:"disabled",tooltip:oe.buttonInsufficientPermissions};if("sufficient"===e.executionPermissionStatus){if(0===((null==o?void 0:o.getActionIds())??[]).length)return{type:"error",tooltip:M.Mm.noActions,hideErrorIconWhenEditorIsOpen:!0};const t=e.typecheckResult.value.actionValidationFailures,n=Object.entries(t).filter((e=>{let[t]=e;return!i.state.suppressErrorsForActionIds.includes(t)})).flatMap((e=>{let[,t]=e;return t})),r=l().first(n);return r?{type:"error",tooltip:(0,M.Fp)(r).forButtonTooltip}:{type:"enabled"}}(0,v.t1)(e)}),[n,o,i])}({store:o,automationStore:B,buttonBlockStore:r}),D="disabled"===A.type||_||"error"===A.type&&d,F=(0,u.VK)((()=>"error"===A.type&&!(A.hideErrorIconWhenEditorIsOpen&&r.state.editing)),[A,r]),L=(0,m.yK)((e=>({wrap:{display:"flex",alignItems:"center",padding:"2px 0"},configureWrap:{display:"flex",alignItems:"center",marginLeft:4},label:{pointerEvents:"none",...y.Z.textOverflowStyle},button:{display:"flex",gap:6,maxWidth:"calc(100% - 24px)",padding:"8px 12px",fontWeight:500,...D?{cursor:"not-allowed"}:{}},labelPlaceholder:{color:e.lightTextColor},warningIcon:{width:16,height:16,fill:e.errorText,color:e.errorText},spinnerWrap:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",marginLeft:-4}})),[D]),V=(0,E.D)(),O=(0,c.useRef)(null),U=(0,c.useCallback)((()=>{i.setState({...i.state,mouseEntered:!0})}),[i]),H=(0,c.useCallback)((()=>{i.setState({...i.state,mouseEntered:!1})}),[i]),z=(0,c.useCallback)((()=>{var e;s(null===(e=O.current)||void 0===e?void 0:e.getBoundingClientRect())}),[s,O]),j=(0,c.useCallback)((()=>{r.state.editing?(r.stopEditing(),(0,g.lN)(V,{block_id:o.id,automation_id:null==B?void 0:B.id})):(z(),(0,g.yK)(V,{block_id:o.id,automation_id:null==B?void 0:B.id}))}),[r,V,o,B,z]),K=(0,c.useCallback)((async()=>{const e=o.getRecordStoreUIRoot();if(B&&e instanceof N.G)if(C.ZH(w),k.ZH(w),"error"===A.type)d||z();else if("enabled"===A.type)try{T(!0),await b.oS({environment:w,store:o,clientContext:{type:"button_block",persisted:!0,automationStore:B,blockStore:o,pageStore:e,intl:P.default.getIntl(),parentRecordStore:B,currentUserId:w.currentUser.id}})}finally{T(!1)}else"disabled"===A.type||(0,v.t1)(A)}),[o,B,w,A,d,z]);(0,c.useImperativeHandle)(t,(()=>({activate:()=>{K()},getBoundingClientRect:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.getBoundingClientRect()}})),[K]);const q=()=>a()("div",{style:L.spinnerWrap},void 0,a()(G.Z,{})),J=[];var Q;R&&(_?J.push({key:"left",comp:q()}):J.push({key:"left",comp:(Q=R,a()($.Z,{largeIcon:!0,disabled:!0,isEmptyPage:!1,size:20,icon:{icon:Q,pointer:o.pointer},style:{marginLeft:Z?-4:0}}))})),Z?J.push({key:"name",comp:a()("div",{style:L.label},void 0,Z)}):R||J.push({key:"placeholder",comp:a()("div",{style:L.labelPlaceholder},void 0,c.createElement(f.FormattedMessage,oe.buttonPlaceholder))}),!R&&_&&J.push({key:"right",comp:q()}),F&&J.push({key:"error",comp:a()("div",{},void 0,h.Z.warning(L.warningIcon))});const te=e=>c.createElement(X.Z,n()({disabled:D,disabledFeedback:!0,style:L.button,ref:O},(0,x.Z)(e??{},{onClick:K})),J.map((e=>{let{key:t,comp:o}=e;return a()(c.Fragment,{},t,o)})));return a()("div",{style:L.wrap,onMouseMove:U,onMouseLeave:H},void 0,A.tooltip?a()(ee.Z,{renderTooltip:()=>a()(M.So,{content:c.createElement(f.FormattedMessage,A.tooltip),subtitle:"error"!==A.type||d?null:c.createElement(f.FormattedMessage,oe.clickToEdit)}),delayThreshold:0,render:te,placement:ee.Z.Placement.Bottom}):te(),!d&&(w.device.isMobile||I)&&a()("div",{style:L.configureWrap},void 0,a()(ee.Z,{renderTooltip:()=>a()(f.FormattedMessage,{defaultMessage:"Edit button",id:"buttonBlock.configureTemplate.button.label",description:"Configure button and its automation"}),delayThreshold:300,render:e=>c.createElement(Y.Z,n()({ariaLabel:S.formatMessage(oe.editButtonAriaLabel),icon:h.Z.settings,onClick:j},e))}),w.device.isMobile&&a()(W.Z,{tooltipContent:a()(f.FormattedMessage,{defaultMessage:"More actions…",id:"buttonBlock.moreActions.button.label",description:"More actions for block"}),store:o,fadeIn:!1})))}));function re(e){const{buttonBlockStore:t}=e,o=(0,u.VK)((()=>t.state.editing?t.state:void 0),[t]),i=(0,m.yK)((e=>({popup:{width:400},editor:{background:e.sidebarBackground,..."inline"===(null==o?void 0:o.placement.type)?{marginTop:6,borderRadius:6,border:`1px solid ${e.regularDividerColor}`,maxWidth:600}:{}}})),[null==o?void 0:o.placement.type]),r=(0,Z.d)({tabletBehavior:"slideUp"});return o?"popup"===o.placement.type?a()(q.ZP,{open:!0,popupType:r,render:()=>c.createElement(ae,n()({},e,{style:i.editor})),originRect:o.placement.originRect,style:i.popup,originGap:4,onDismiss:()=>{t.stopEditing()}}):"inline"===o.placement.type?c.createElement(ae,n()({},e,{style:i.editor})):void(0,v.t1)(o.placement):null}function ae(e){window.__c={n:"ButtonBlockEditor"};const{disabled:t,store:o,buttonBlockStore:i}=e,r=(0,p.O7)(),s=r.currentUser.id,l=(0,f.useIntl)(),d=(0,m.yK)((e=>({header:{display:"flex",alignItems:"center",padding:"12px 12px 8px 12px",gap:6},scroller:{maxHeight:"75vh"},nameInputWrap:{flexGrow:"1"}})),[]),v=(0,E.D)(),y=(0,u.VK)((()=>o.getAutomationStore()),[o]),b=(0,u.VK)((()=>null==y?void 0:y.getNameStore()),[y]),M=(0,u.VK)((()=>null==y?void 0:y.getIconStore()),[y]),T=(0,u.VK)((()=>(null==b?void 0:b.getValue())??""),[b]),B=se({store:o,automationStore:y}),Z=(0,u.VK)((()=>{var e;return o.canEdit()&&"sufficient"===(null==B||null===(e=B.state)||void 0===e?void 0:e.executionPermissionStatus)}),[o,B]),D=(0,u.VK)((()=>null==M?void 0:M.getValue()),[M]),F=(0,u.VK)((()=>{const e=o.getRecordStoreUIRoot();if(e instanceof N.G)return e}),[o]),L=(0,c.useMemo)((()=>{if(y&&F)return new A.L({type:"button_block",persisted:!0,automationStore:y,blockStore:o,pageStore:F,intl:P.default.getIntl(),parentRecordStore:y,currentUserId:s})}),[y,F,o,s]),V=(0,c.useCallback)((e=>{(0,I.ZP)({event:e,context:I.Af.EditorClick,callback:()=>{C.ZH(r),k.ZH(r)}})}),[r]),O=(0,c.useCallback)((()=>{i.stopEditing(),(0,g.lN)(v,{block_id:o.id,automation_id:null==y?void 0:y.id})}),[y,i,o,v]),z=(0,c.useCallback)(((e,t)=>{y&&_.createAndCommit({userAction:"ButtonBlock.updateProperty",environment:r,perform:o=>{w.sW({store:y.getPropertiesStore(),transaction:o,data:{[e]:t??null}})}})}),[y,r]),W=(0,c.useCallback)((e=>z("icon",e)),[z]),G=(0,c.useCallback)((e=>z("name",e)),[z]),X=(0,c.useCallback)((e=>{S.$(r,{originRect:e.currentTarget.getBoundingClientRect(),originGap:4,popupWidth:te.ZP.desktopPopupWidth,popupHeight:te.ZP.desktopPopupHeight,isSmallWidth:!1,title:l.formatMessage({defaultMessage:"Icon",id:"buttonBlock.button.iconHeading",description:"Heading for a menu to pick icons."}),currentTab:"icon",tabs:[{type:"icon",onChange:e=>{W(e),S.Z()}},{type:"emoji",onChange:(e,t)=>{W(e),S.Z()}}],onDelete:()=>{W(void 0),S.Z()}})}),[r,W,l]),q=(0,u.VK)((()=>i.state.suppressErrorsForActionIds),[i]),ie=t||!Z;if(!L)return null;const ne=e=>c.createElement(Y.Z,n()({ariaLabel:l.formatMessage(oe.addIconButtonAriaLabel),style:{width:26,height:26},iconStyle:{width:16,height:16},hasBackground:!0,disabled:ie,showShadow:!0,icon:e=>D?a()($.Z,{disabled:!0,isEmptyPage:!1,size:24,icon:{icon:D,pointer:o.pointer},style:e}):h.Z.addPageIcon(e)},(0,x.Z)(e??{},{onClick:X}))),re=D?ne():a()(ee.Z,{renderTooltip:()=>a()(f.FormattedMessage,{defaultMessage:"Add an icon",id:"buttonBlock.button.addIcon",description:"Button to add an icon to a block."}),delayThreshold:300,render:ne});return a()("div",{style:e.style,onClick:V},void 0,a()(j.p,{allowSelectionWithin:!0,style:d.header},void 0,re,a()(H.b,{onChange:G,value:T,disabled:ie,placeholder:P.default.formatMessage(oe.buttonPlaceholder),wrapStyle:d.nameInputWrap}),a()(K.Z,{onClick:O},void 0,a()(f.FormattedMessage,{defaultMessage:"Done",id:"buttonBlock.button.done",description:"Done button for button block"}))),a()(J.Z,{style:d.scroller,type:R.Z.Y},void 0,a()(Q.Z,{mobileStyle:{boxShadow:"initial"},mobileTitleStyle:{textTransform:"none",marginTop:8},title:a()(f.FormattedMessage,{id:"buttonBlock.actions",defaultMessage:"When button is clicked",description:"Actions for property button"})},void 0,a()(U.t,{contextStore:L,disabled:ie,suppressErrors:q,onActionAdded:e=>{i.suppressErrorsForAction(e)}}),a()("div",{}))))}function se(e){const{store:t,automationStore:o}=e,i=(0,p.O7)().currentUser.id;return(0,u.VK)((()=>{const e=t.getRecordStoreUIRoot();if(o&&e instanceof N.G)return(0,T.Gb)({type:"button_block",persisted:!0,automationStore:o,blockStore:t,pageStore:e,intl:P.default.getIntl(),parentRecordStore:o,currentUserId:i})}),[o,t,i])}const le=ie},79092:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(5366),s=o(37181),l=o(79315),c=o(55422);class d extends r.Z{constructor(){super(...arguments),this.handleStartOfWeekToggle=()=>{1===this.getStartDayOfWeek()?s.rx(this.environment):s.Zf(this.environment)}}renderComponent(){const{device:e}=this.environment;return n()(c.Z,{isMobile:e.isMobile,title:n()(a.FormattedMessage,{id:"calendarSettings.startWeekOnMonday.label",defaultMessage:"Start week on Monday"}),caption:n()(a.FormattedMessage,{id:"calendarSettings.startWeekOnMonday.message",defaultMessage:"This will change how all calendars in your app look."}),type:"toggle",isOn:1===this.getStartDayOfWeek(),onToggle:this.handleStartOfWeekToggle})}getStartDayOfWeek(){const{currentUserSettingsStore:e}=l.default.state;if(e){const t=e.getSettings();if(t)return t.start_day_of_week}}}d.displayName="CalendarSettings";const p=d},44758:(e,t,o)=>{o.d(t,{zq:()=>c,ac:()=>d,VR:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(24405)),a=o(3779),s=o(5366);function l(e){window.__c={n:"CapabilityItem"};const{enabled:t,labelIfEnabled:o,labelIfDisabled:i}=e,s=(0,r.yK)((e=>({container:{color:t?e.mediumTextColor:e.lightTextColor}})),[t]);return n()("div",{style:s.container},void 0,function(e){const t={width:12,display:"inline",verticalAlign:"middle"};return e?a.Z.thinCheck(t):a.Z.close(t)}(t)," ",t?o:i)}function c(e){const t="none"!==e;return[n()(l,{enabled:t&&e.read_content,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.mixedAccess.readContent.enabled",defaultMessage:"Can read content."}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.readContent.disabled",defaultMessage:"Cannot read content."})},"read_content"),n()(l,{enabled:t&&e.insert_content,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.insertContent.enabled",defaultMessage:"Can insert content."}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.insertContent.disabled",defaultMessage:"Cannot insert content."})},"insert_content"),n()(l,{enabled:t&&e.update_content,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.updateContent.enabled",defaultMessage:"Can update content."}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.updateContent.disabled",defaultMessage:"Cannot update content."})},"update_content"),n()(l,{enabled:t&&e.insert_comment,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.insertComment.enabled",defaultMessage:"Can comment.",description:"Label indicating that an integration can comment on a page"}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.insertComment.disabled",defaultMessage:"Cannot comment.",description:"Label indicating that an integration cannot comment on a page"})},"insert_comment"),n()(l,{enabled:t&&e.read_comment,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.readComment.enabled",defaultMessage:"Can read comments.",description:"Label indicating that an integration can read comments on a page"}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.readComment.disabled",defaultMessage:"Cannot read comments.",description:"Label indicating that an integration cannot read comments on a page"})},"read_comment")]}function d(e){return[n()(l,{enabled:e.read_user_without_email,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.userAccess.readUsers.enabled",defaultMessage:"Can view users."}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.userAccess.readUsers.disabled",defaultMessage:"Cannot view users."})},"read_user_without_email"),n()(l,{enabled:e.read_user_with_email,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.userAccess.readUserEmailAddresses.enabled",defaultMessage:"Can view user email addresses."}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.userAccess.readUserEmailAddresses.disabled",defaultMessage:"Cannot view user email addresses."})},"read_user_with_email")]}function p(e){return[n()(l,{enabled:e.link_preview,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.linkPreview.enabled",defaultMessage:"Can preview links.",description:"Label indicating that an integration can show link previews on a page"}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.linkPreview.disabled",defaultMessage:"Cannot preview links.",description:"Label indicating that an integration cannot show link previews on a page"})},"link_preview"),n()(l,{enabled:e.synced_database,labelIfEnabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.syncedDatabase.enabled",defaultMessage:"Can sync databases.",description:"Label indicating that an integration can show synced databases on a page"}),labelIfDisabled:n()(s.FormattedMessage,{id:"capabilitiesTooltip.syncedDatabase.disabled",defaultMessage:"Cannot sync databases.",description:"Label indicating that an integration cannot show synced databases on a page"})},"synced_database")]}},73657:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(97464),n=o.n(i),r=o(67294),a=o(83355),s=o(28992);class l extends a.Z{renderComponent(){return r.createElement(s.Z,n()({},this.props,{style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...this.props.style}}))}}l.displayName="CaptionMenuItem";const c=l},1119:(e,t,o)=>{o.d(t,{Z:()=>E});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(83355),c=o(13991),d=o(8848),p=o(3779),u=o(61784),m=o(24684),g=o(896),h=o(47425),f=o(97880),v=o(82990),y=o(5366),b=o(50906),S=o(99498),w=o(89859),k=o(33929),C=o(8323),_=o(7036),M=o(42922),T=o(64921),I=o(12508),P=o(74194);const x=(0,y.defineMessages)({reasonOtherPlaceholder:{id:"churnSurvey.reasons.reasonOtherPlaceholder",defaultMessage:"Tell us more...",description:"Shown in the downgrade survey in case they want to put a custom reason for why they downgraded."},tenPercentOff:{id:"churnSurvey.offer.tenPercent",defaultMessage:"Get 10% off",description:"Shown in a button to confirm a customer wants to accept the 10% off discount we presented to them."},fiftyPercentOff:{id:"churnSurvey.offer.fiftyPercent",defaultMessage:"Get 50% off",description:"Shown in a button to confirm a customer wants to accept the 50% off discount we presented to them."},collaborativeTeamspaces:{id:"churnSurvey.features.collaborativeTeamspaces",defaultMessage:"Collaborative teamspaces",description:"Describes feature customers will lose access to if they downgrade."},sharingPermissions:{id:"churnSurvey.features.sharingPermissions",defaultMessage:"Sharing permissions",description:"Describes feature customers will lose access to if they downgrade."},versionHistory:{id:"churnSurvey.features.versionHistory",defaultMessage:"30 day version history",description:"Describes feature customers will lose access to if they downgrade."},adminTools:{id:"churnSurvey.features.adminTools",defaultMessage:"Admin tools",description:"Describes feature customers will lose access to if they downgrade."},saml:{id:"churnSurvey.features.saml",defaultMessage:"SAML SSO",description:"Describes feature customers will lose access to if they downgrade."},auditLog:{id:"churnSurvey.features.auditLog",defaultMessage:"Audit log",description:"Describes feature customers will lose access to if they downgrade."},security:{id:"churnSurvey.features.securityAndControls",defaultMessage:"Advanced security and controls",description:"Describes feature customers will lose access to if they downgrade."}}),B={free:n()(y.FormattedMessage,{id:"churnSurveyMenu.free.title",defaultMessage:"Free",description:"Describes which plan the customer is downgrading to when downgrading plans."}),personal:n()(y.FormattedMessage,{id:"churnSurveyMenu.personal.title",defaultMessage:"Personal Pro",description:"Describes which plan the customer is downgrading to when downgrading plans."}),team:n()(y.FormattedMessage,{id:"churnSurveyMenu.team.title",defaultMessage:"Plus",description:"Describes which plan the customer is downgrading to when downgrading plans."}),plus:n()(y.FormattedMessage,{id:"churnSurveyMenu.plus.title",defaultMessage:"Plus",description:"Describes which plan the customer is downgrading to when downgrading plans."}),business:n()(y.FormattedMessage,{id:"churnSurveyMenu.business.title",defaultMessage:"Business",description:"Describes which plan the customer is downgrading to when downgrading plans."})};class Z extends l.Z{constructor(){super(...arguments),this.storeTypes={store:_.ZP},this.handleDowngrade=e=>{this.handleNextStage(e),this.props.onAccept()},this.handleNextStage=e=>{this.stores.store.handleNextStage(e),null!=e&&e.isWorkspaceDeletion&&this.props.onAccept()}}renderComponent(){const{churnType:e,onClose:t,periodEnd:o,isWorkspaceDeletion:i}=this.props,{store:r}=this.stores,a=(0,u.Yx)(o,"long",c.SP),s=B[e];return"closed"===r.state.stage&&t(),b.trackChurnSurvey(this.environment,this.stores.store.state,e),n()("div",{style:{fontSize:14}},void 0,n()("div",{style:{textAlign:"center",padding:"16px 8px 0px"}},void 0,n()(T.Z,{onClick:()=>{b.trackChurnSurveyClose(this.environment,r.state,this.props.churnType),t()},style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,p.Z.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderStageIcon(r),n()("div",{style:{padding:"0px 10px"}},void 0,this.renderTitle(r,s),this.renderDescription(r,a))),this.renderContent(r,s),n()("div",{style:{padding:"20px 24px"}},void 0,this.renderFooter(r,t,s,i)))}renderMessageForReason(e){switch(e){case"not_using_enough":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.notUsingEnough",defaultMessage:"Not using it enough",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"switching":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.switching",defaultMessage:"Switching to another tool",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"too_expensive":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.tooExpensive",defaultMessage:"Cost (too expensive or budget cuts)",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"too_difficult":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.tooDifficult",defaultMessage:"Too difficult to use",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"missing_features":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.missingFeatures",defaultMessage:"Missing features",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"upgraded_by_mistake":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.upgradedByMistake",defaultMessage:"Upgraded by mistake",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"consolidating_workspaces":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.consolidating_workspaces",defaultMessage:"Consolidating Notion workspaces",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"other":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.other",defaultMessage:"Other",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"using_another_ai_service":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.usingAnotherAIService",defaultMessage:"Using another AI service",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"quality_of_results":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.qualityOfResults",defaultMessage:"Quality of results",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"data_security":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.dataSecurity",defaultMessage:"Data security",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"added_by_mistake":return n()(y.FormattedMessage,{id:"churnSurvey.reasons.addedByMistake",defaultMessage:"Added by mistake",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});default:(0,f.t1)(e)}}renderStageIcon(e){const{stage:t}=e.state;switch(t){case"questionnaire":case"enterprise_annual":case"enterprise_three_months":case"business_annual":case"business_three_months":case"team_annual":case"team_three_months":return p.Z.settingsCredit(this.getIconStyle());case"downgrade":return p.Z.arrowDown(this.getIconStyle());case"accepted_enterprise_offer":case"accepted_business_offer":case"accepted_team_offer":case"confirmation":return p.Z.statusCompleteGroup(this.getIconStyle());case"closed":return;default:(0,f.t1)(t)}}renderTitle(e,t){const o=e.state.stage;let i;const r=this.props.churnType===this.props.currentPlan;switch(o){case"questionnaire":if("ai"===this.props.churnType){i=n()(y.FormattedMessage,{id:"churnSurvey.header.questionnaire.aiCancellation.title",defaultMessage:"Why do you want to remove AI?",description:"Shown when a customer attempts to cancel their AI subscription."});break}if(this.props.isWorkspaceDeletion){i=n()(y.FormattedMessage,{id:"churnSurvey.header.questionnaire.workspaceCancellation.title",defaultMessage:"Why do you want to delete your workspace?",description:"Shown when a customer attempts to delete their workspace."});break}if(r){i=n()(y.FormattedMessage,{id:"churnSurvey.header.questionnaire.cancellation.title",defaultMessage:"Why do you want to cancel?",description:"Shown when a customer attempts to cancel their plan"});break}i=n()(y.FormattedMessage,{id:"churnSurvey.header.questionnaire.title",defaultMessage:"Why do you want to downgrade?",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"team_three_months":i=n()(y.FormattedMessage,{id:"churnSurvey.header.plusOfferMonthly.title",defaultMessage:"50% off your Plus Plan, on us.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"team_annual":i=n()(y.FormattedMessage,{id:"churnSurvey.header.plusOfferAnnual.title",defaultMessage:"10% off your Plus Plan, on us.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"business_three_months":case"business_annual":i=n()(y.FormattedMessage,{id:"churnSurvey.header.businessOffer.title",defaultMessage:"10% off your Business Plan, on us.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"enterprise_three_months":case"enterprise_annual":i=n()(y.FormattedMessage,{id:"churnSurvey.header.enterpriseOffer.title",defaultMessage:"10% off your Enterprise plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"downgrade":if(r){i=n()(y.FormattedMessage,{id:"downgradeModal.header.cancellation.title",defaultMessage:"Continue cancelling?",description:"Shown when a customer attempts to cancel their plan.",values:{planMessage:t}});break}i=n()(y.FormattedMessage,{id:"downgradeModal.header.downgrade.title",defaultMessage:"Continue downgrading to {planMessage}?",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{planMessage:t}});break;case"accepted_enterprise_offer":i=n()(y.FormattedMessage,{id:"downgradeModal.header.acceptedEnterpriseOfferConfirmation.title",defaultMessage:"Thank you for staying on your Enterprise Plan",description:"Shown when a customer accepted the offer to stay in their Enterprise plan."});break;case"accepted_business_offer":i=n()(y.FormattedMessage,{id:"downgradeModal.header.acceptedBusinessOfferConfirmation.title",defaultMessage:"Thank you for staying on your Business Plan",description:"Shown when a customer accepted the offer to stay in their Enterprise plan."});break;case"accepted_team_offer":i=n()(y.FormattedMessage,{id:"downgradeModal.header.acceptedPlusOfferConfirmation.title",defaultMessage:"Thank you for staying on your Plus Plan",description:"Shown when a customer accepted the offer to stay in their Plus plan."});break;case"confirmation":i=n()(y.FormattedMessage,{id:"downgradeModal.header.confirmation.title",defaultMessage:"Thank you for switching to {planMessage}",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{planMessage:t}});break;case"closed":break;default:(0,f.t1)(o)}return n()("h3",{style:Z.headerStyle},void 0,i)}renderDescription(e,t){const{stage:o}=e.state;let i;switch(o){case"questionnaire":i=n()(y.FormattedMessage,{id:"churnSurvey.reasons.description",defaultMessage:"We'd love your input to make Notion better",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"team_three_months":i=n()(y.FormattedMessage,{id:"churnSurvey.teamMonthlyOffer.description",defaultMessage:"Get 50% off for 3 months if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"team_annual":i=n()(y.FormattedMessage,{id:"churnSurvey.teamAnnualOffer.description",defaultMessage:"Get 10% off if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"business_three_months":i=n()(y.FormattedMessage,{id:"churnSurvey.businessMonthlyOffer.description",defaultMessage:"Get 10% off for 3 months if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"business_annual":i=n()(y.FormattedMessage,{id:"churnSurvey.businessYearlyOffer.description",defaultMessage:"Get 10% off if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"enterprise_three_months":i=n()(y.FormattedMessage,{id:"churnSurvey.enterpriseMonthlyOffer.description",defaultMessage:"Get 10% off for 3 months if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"enterprise_annual":i=n()(y.FormattedMessage,{id:"churnSurvey.enterpriseAnnualOffer.description",defaultMessage:"Get 10% off if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"downgrade":i=n()(y.FormattedMessage,{id:"churnSurvey.downgrade.description",defaultMessage:"You'll still enjoy all the features of your current plan until {periodEnd}. You can resubscribe or switch to another plan anytime.",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{periodEnd:n()("span",{style:{fontWeight:600}},void 0,t)}});break;case"accepted_team_offer":case"accepted_business_offer":case"accepted_enterprise_offer":i=n()(y.FormattedMessage,{id:"churnSurvey.acceptedOfferConfirmation.description",defaultMessage:"Your updated pricing will kick in on your upcoming renewal date of {periodEnd}",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{periodEnd:n()("span",{style:{fontWeight:600}},void 0,t)}});break;case"confirmation":i=n()(y.FormattedMessage,{id:"churnSurvey.confirmation.description",defaultMessage:"You'll still enjoy all features of your current plan until {periodEnd}. You can resubscribe or switch to another plan anytime.",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{periodEnd:n()("span",{style:{fontWeight:600}},void 0,t)}});break;case"closed":break;default:(0,f.t1)(o)}return n()("p",{style:{lineHeight:1.4,marginTop:8}},void 0,n()("div",{style:this.getDescriptionStyle()},void 0,i))}renderSurveySection(e){const{reasons:t,reasonOther:o}=e.state,{churnType:i}=this.props;let r;switch(i){case"ai":r=_.XM;break;default:r=_.zy}return n()("div",{style:Z.surveySectionStyle},void 0,r.map((i=>{if(this.props.isWorkspaceDeletion&&"upgraded_by_mistake"===i)return;const r=t.includes(i);return s.createElement(s.Fragment,null,n()("div",{style:this.getRowStyle(!0),onClick:()=>{e.setState({...e.state,reasons:r?a().without(t,i):[...t,i]})}},i,n()(I.Z,{checked:r,size:14}),n()("span",{style:{marginLeft:4}},void 0,this.renderMessageForReason(i))),"other"===i&&r&&n()(P.Z,{style:Z.inlineInputStyle,autoFocus:!0,value:o,placeholder:k.default.formatMessage(x.reasonOtherPlaceholder),onChange:t=>{e.setState({...e.state,reasonOther:t.target.value})}}))})))}getRestrictionMessage(e){const t=(0,C.zt)();return(0,h.QM)(e)?(0,h.wP)(t)?m.BE:(0,h.NG)(t)?m.by:m.qQ:"personal"===e?m.rs:(0,h.NG)(e)?m.l2:(0,h.eR)(e)?(0,h.NG)(t)?m._F:m.C5:void 0}renderDowngradeSection(e){const{churnType:t}=this.props;if("ai"===t)return;const o=this.getRestrictionMessage(t);return this.props.churnType===this.props.currentPlan?void 0:n()("div",{style:{padding:"0px 24px 0px"}},void 0,n()("p",{style:this.getDowngradeDescriptionStyle()},void 0,n()(y.FormattedMessage,{id:"churnSurvey.downgradeSection.description",defaultMessage:"The following restrictions will apply when plan switches to {planMessage}",description:"Describes the changes a user will experience when downgrading.",values:{planMessage:e}})),n()("div",{},void 0,o&&o.map((e=>s.createElement(s.Fragment,null,n()("div",{style:this.getRowStyle(!1)},void 0,e.icon(this.getDowngradeSectionIconStyle(!1)),n()("span",{style:this.getRestrictionDurationStyle()},void 0,n()("s",{},void 0,k.default.formatMessage(e.duration))),p.Z.arrowRight(this.getDowngradeSectionIconStyle(!0)),n()("span",{style:this.getRestrictionHighlightedMessageStyle()},void 0,e.highlightedMessage&&k.default.formatMessage(e.highlightedMessage)),e.message&&k.default.formatMessage(e.message)))))))}renderTeamOfferSection(){return s.createElement(s.Fragment,null,n()("li",{},void 0,k.default.formatMessage(x.collaborativeTeamspaces)),n()("li",{},void 0,k.default.formatMessage(x.sharingPermissions)),n()("li",{},void 0,k.default.formatMessage(x.versionHistory)),n()("li",{},void 0,k.default.formatMessage(x.adminTools)))}renderEnterpriseOfferSection(){return s.createElement(s.Fragment,null,n()("li",{},void 0,k.default.formatMessage(x.saml)),n()("li",{},void 0,k.default.formatMessage(x.auditLog)),n()("li",{},void 0,k.default.formatMessage(x.security)))}renderOfferSection(e){return n()("div",{style:{padding:"0px 24px 0px"}},void 0,n()("p",{style:this.getDowngradeDescriptionStyle()},void 0,n()(y.FormattedMessage,{id:"churnSurvey.offerSection.description",defaultMessage:"You'll get to keep",description:"Describes the changes a user will keep if they don't downgrade their plan."})),n()("ul",{style:{margin:0,paddingLeft:28,color:this.theme.mediumTextColor}},void 0,e.startsWith("team")&&this.renderTeamOfferSection(),e.startsWith("enterprise")&&this.renderEnterpriseOfferSection()))}renderContent(e,t){const{stage:o}=e.state;if("ai"===this.props.churnType)return this.renderSurveySection(e);switch(o){case"questionnaire":return this.renderSurveySection(e);case"downgrade":return this.renderDowngradeSection(t);case"team_three_months":case"team_annual":case"enterprise_three_months":case"enterprise_annual":return this.renderOfferSection(o);default:return}}renderOfferAcceptButton(e){const{customerId:t,churnType:o}=this.props;if("ai"===o)return;const i="team_three_months"===e;return n()(M.Z,{isLarge:!0,style:{width:"100%"},onClick:async()=>{await w.A(this.environment,{customerId:t,newPlan:o,coupon:e,offerType:"downgrade_flow"}),this.handleNextStage({downgradeCoupon:e,acceptedOffer:!0})}},void 0,i?k.default.formatMessage(x.fiftyPercentOff):k.default.formatMessage(x.tenPercentOff))}renderTopButton(e,t,o){const{customerId:i,churnType:r,currentPlan:a}=this.props,s=r===a;return n()("div",{style:{display:"flex"}},void 0,"questionnaire"===e&&n()(M.Z,{isLarge:!0,style:{width:"100%"},onClick:async()=>{if("ai"===r)return this.stores.store.setState({...this.stores.store.state,stage:"closed"}),void S.Kj();const e=await w.y(this.environment,{customerId:i,newPlan:r,offerType:"downgrade_flow"});this.handleNextStage({downgradeCoupon:(0,g.$)(e)?e:void 0,isWorkspaceDeletion:o})}},void 0,n()(y.FormattedMessage,{id:"churnSurvey.continueButton.title",defaultMessage:"Continue",description:"Shown in downgrade modal so users can continue downgrading."})),"downgrade"===e&&n()(T.Z,{style:this.getDowngradeButtonStyle(e),onClick:()=>this.handleDowngrade({}),hoveredStyle:{background:d.ZP.redWithAlpha(.8)}},void 0,s&&n()(y.FormattedMessage,{id:"churnSurvey.cancelSubscription.title",defaultMessage:"Cancel subscription",description:"Button shown in case the user wants to cancel their subscription."}),!s&&n()(y.FormattedMessage,{id:"churnSurvey.downgradeButton.title",defaultMessage:"Downgrade",description:"Button shown in case the user no longer wants to downgrade their subscription."})),t&&this.renderOfferAcceptButton(e))}renderFooter(e,t,o,i){const{stage:r}=e.state;if(!r)return;const a=this.isShowingOfferStages(r),l=this.isShowingAcceptedOfferStages(r);return s.createElement(s.Fragment,null,this.renderTopButton(r,a,i),"confirmation"!==r&&n()("div",{style:{display:"flex"}},void 0,n()(T.Z,{style:this.getDowngradeButtonStyle(),onClick:()=>{a?this.handleDowngrade({isWorkspaceDeletion:i}):(b.trackChurnSurveyClose(this.environment,e.state,this.props.churnType),t())}},void 0,a&&!i&&n()(y.FormattedMessage,{id:"churnSurvey.offer.continueDowngrading.title",defaultMessage:"Downgrade to {planMessage}",description:"Shown in the downgrade modal in case they no longer want to downgrade.",values:{planMessage:o}}),a&&i&&n()(y.FormattedMessage,{id:"churnSurvey.offer.continueDeletingWorkspace.title",defaultMessage:"Continue deleting entire workspace",description:"Shown in the downgrade modal in case they no longer want to downgrade.",values:{planMessage:o}}),!a&&!l&&n()(y.FormattedMessage,{id:"churnSurvey.cancelButton.title",defaultMessage:"Cancel",description:"Shown in the downgrade modal in case they no longer want to downgrade."}))))}isShowingOfferStages(e){switch(e){case"team_three_months":case"team_annual":case"business_annual":case"business_three_months":case"enterprise_annual":case"enterprise_three_months":return!0;case"questionnaire":case"downgrade":case"accepted_enterprise_offer":case"accepted_business_offer":case"accepted_team_offer":case"confirmation":case"closed":return!1;default:(0,f.t1)(e)}}isShowingAcceptedOfferStages(e){switch(e){case"accepted_enterprise_offer":case"accepted_business_offer":case"accepted_team_offer":return!0;case"questionnaire":case"team_three_months":case"team_annual":case"business_annual":case"business_three_months":case"enterprise_annual":case"enterprise_three_months":case"downgrade":case"confirmation":case"closed":return!1;default:(0,f.t1)(e)}}isFiftyPercentOffDiscount(){}getRowStyle(e){return{display:"flex",alignItems:"center",cursor:e?"pointer":"default",marginBottom:4}}getDescriptionStyle(){return{margin:0,color:this.theme.mediumTextColor,marginBottom:8}}getIconStyle(){return{display:"inline",height:36,fill:this.theme.accentColors.gray[500],marginTop:8,marginBottom:8}}getDowngradeDescriptionStyle(){return{lineHeight:1.4,marginTop:8,fontWeight:v.Z.fontWeight.medium}}getDowngradeSectionIconStyle(e){return{display:"inline",height:e?14:18,fill:this.theme.accentColors.gray[500],width:void 0,padding:"0px 8px"}}getRestrictionDurationStyle(){return{marginLeft:4,color:this.theme.accentColors.gray[500]}}getRestrictionHighlightedMessageStyle(){return{marginRight:4,color:this.theme.redBadgeBackground}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}getDowngradeButtonStyle(e){const t="downgrade"===e;return{width:"100%",color:t?d.ZP.white:this.theme.mediumTextColor,background:t?this.theme.redBadgeBackground:this.theme.whiteButtonBackground,boxShadow:void 0,display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,whiteSpace:"nowrap",height:28,borderRadius:3,fill:d.ZP.lightTextColor,lineHeight:1.2,paddingLeft:12,paddingRight:12,fontSize:14,fontWeight:v.Z.fontWeight.medium,marginTop:4}}}Z.displayName="ChurnSurvey",Z.surveySectionStyle={padding:"0px 24px"},Z.headerStyle={margin:0,marginBottom:8},Z.inlineInputStyle={marginBottom:12,width:"calc(100% - 18px)"};const E=Z},79727:(e,t,o)=>{o.d(t,{Z:()=>Ze});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(6740),c=o(17397),d=o(99036),p=o(80951),u=o(3779),m=o(15157),g=o(63149),h=o(98459),f=o(70203),v=o(97880),y=o(82990),b=o(5366),S=o(95182),w=o(43132),k=o(22858),C=o(24677),_=o(98104),M=o(30149),T=o(95477),I=o(14976),P=o(33929),x=o(60709),B=o(77907),Z=o(61766),E=o(10161),R=o(33846),A=o(22294),D=o(31792),F=o(31194),L=o(12318),V=o(86671),N=o(13966),O=o(96486),U=o.n(O),H=o(97762),z=o(83355),W=o(1302),j=o(13991);var K=o(15095),Y=o(62193),G=o(44805),X=o(993),q=o(98724),$=o(56971),J=o(74284),Q=o(62619),ee=o(68056),te=o(67669),oe=o(55227),ie=o(89086),ne=o(66638),re=o(52689),ae=o(13884),se=o(24666),le=o(29595),ce=o(93262);class de extends z.Z{constructor(){super(...arguments),this.editor=null,this.mergeEditorRefs=(0,Y.s)(),this.renderContentContainer=(e,t,o)=>{let{leafRef:i,wrapperRef:n,...r}=e;return s.createElement("div",a()({ref:n,style:{display:"flex",...!this.props.codeWrap&&{overflowX:"auto",WebkitOverflowScrolling:"touch"}},className:"line-numbers notion-code-block"},r),s.createElement(le.Z,{ref:this.mergeEditorRefs(this.editorRef,i),style:{...this.getContentEditableStyle(),...this.props.isQuickFind&&{paddingTop:12},...this.props.codeWrap?{whiteSpace:"pre-wrap",wordBreak:"break-all",minWidth:0}:{whiteSpace:"pre"}},getDisabled:this.getDisabled,getHtml:this.getHtml,getSelection:this.getContainerSelection,onMutation:this.handleMutation,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,suppressNewlineEvents:!1,placeholder:" ",disableContentEditableWhenNotEditingTextOnMobile:!0}))},this.renderSyntaxTokens=(e,t)=>{const o=G.Mw(t&&{value:t,spaceId:this.props.parentSpaceId},this.props.store.getRecordModel),i=oe.kF(o,e),r=o.map(f.hD).map(((e,t)=>G.fn({annotations:e,theme:this.theme,spaceId:this.props.parentSpaceId,getRecordModel:this.props.store.getRecordModel})));return i.map(((e,t)=>s.createElement(s.Fragment,null,n()("span",{className:[e.classNames||"",...r[e.textTokenIndex].classNames].join(" "),style:r[e.textTokenIndex].style,"data-token-index":e.textTokenIndex},t,e.value))))},this.handleClick=e=>{I.SD({environment:this.environment,event:e,textValue:this.getTextValue(),editorNode:this.getEditorNode(),store:this.props.store,canEdit:this.canEdit()})},this.handleMutation=e=>{let{newValue:t}=e;this.logTypingLag("typing_lag"),M.createAndCommit({userAction:"CodeBlockValue.handleMutation",environment:this.environment,perform:e=>{X.aS({environment:this.environment,store:this.props.store,newValue:t,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})},this.handleDelete=e=>{if(!this.canEdit())return;this.logTypingLag("typing_delete");const{store:t}=this.props,o=se.default.state;"editing"===o.mode&&o.multiSelection.start.store===t&&M.createAndCommit({userAction:"CodeBlockValue.handleDelete",environment:this.environment,perform:t=>{$.as({environment:this.environment,multiSelection:o.multiSelection,deleteForwards:!0,transaction:t,event:e})}})},this.handleBackspace=e=>{if(!this.canEdit())return;this.logTypingLag("typing_backspace");const{store:t}=this.props,o=se.default.state;if("editing"===o.mode&&o.multiSelection.start.store===t){if($.YV({device:this.environment.device,event:e,multiSelection:o.multiSelection}))return;M.createAndCommit({userAction:"CodeBlockValue.handleBackspace",environment:this.environment,perform:t=>{$.as({environment:this.environment,multiSelection:o.multiSelection,deleteForwards:!1,transaction:t,event:e})}})}},this.handleEnter=e=>{var t;if(!this.canEdit())return;if(this.logTypingLag("typing_enter"),null===(t=e.preventDefault)||void 0===t||t.call(e),this.editor&&this.editor.isComposing)return;const o=se.default.state,i="editing"===o.mode&&(0,ee.QY)(o.multiSelection);i&&M.createAndCommit({userAction:"CodeBlockValue.handleEnter",environment:this.environment,perform:e=>{X.hJ({environment:this.environment,store:this.props.store,string:"\n",selection:i.selection,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})},this.handleShiftEnter=e=>{var t;if(!this.canEdit())return;this.logTypingLag("typing_enter"),null===(t=e.preventDefault)||void 0===t||t.call(e);const o=se.default.state;"editing"===o.mode&&(M.createAndCommit({userAction:"CodeBlockValue.handleShiftEnter",environment:this.environment,perform:e=>{J.IO({environment:this.environment,multiSelection:o.multiSelection,transaction:e})}}),this.flushRenderQueue())},this.handleTab=e=>{if(!this.canEdit())return;this.logTypingLag("typing_tab"),e.preventDefault();const t=se.default.state,o="editing"===t.mode&&(0,ee.QY)(t.multiSelection);o&&M.createAndCommit({userAction:"CodeBlockValue.handleTab",environment:this.environment,perform:e=>{X.wA({environment:this.environment,store:this.props.store,selection:o.selection,transaction:e,shouldStripTokens:!0})}})},this.handleUntab=e=>{if(!this.canEdit())return;this.logTypingLag("typing_untab"),e.preventDefault();const t=se.default.state,o="editing"===t.mode&&(0,ee.QY)(t.multiSelection);o&&M.createAndCommit({userAction:"CodeBlockValue.handleUntab",environment:this.environment,perform:e=>{X.O5({environment:this.environment,store:this.props.store,selection:o.selection,transaction:e,shouldStripTokens:!0})}})},this.handleAnnotation=(e,t)=>{this.canEdit()&&(t.preventDefault(),q.aS({environment:this.environment,annotation:e}),this.flushRenderQueue())},this.handleCopy=e=>{w.JG({environment:this.environment,event:e})},this.handleCut=e=>{this.canEdit()?w.by({environment:this.environment,event:e}):e.preventDefault()},this.handlePaste=e=>{this.canEdit()?M.createAndCommit({userAction:"CodeBlockValue.handlePaste",environment:this.environment,perform:t=>{w.v({environment:this.environment,event:e,disableEmbedMenu:!0,transaction:t,onPasteFiles:w.AL})}}):e.preventDefault()},this.handleMoveUp=e=>{M.createAndCommit({userAction:"CodeBlockValue.handleMoveUp",environment:this.environment,perform:e=>{X.fs({environment:this.environment,transaction:e,direction:"up"})}})},this.handleMoveDown=e=>{M.createAndCommit({userAction:"CodeBlockValue.handleMoveDown",environment:this.environment,perform:e=>{X.fs({environment:this.environment,transaction:e,direction:"down"})}})},this.handleMouseOver=e=>{I.vO({environment:this.environment,event:e,textValue:this.getTextValue(),editorNode:this.getEditorNode(),store:this.props.store,canEdit:this.canEdit()})},this.handleMouseOut=e=>{I.kV({environment:this.environment,event:e,textValue:this.getTextValue(),editorNode:this.getEditorNode(),store:this.props.store,canEdit:this.canEdit()})},this.getDisabled=()=>!this.canEdit(),this.createSyntaxToken=e=>Q.Gs(e)?[e.data]:Q.kK(e)?[e.textContent||"",e.className]:void 0,this.getHtml=()=>{const{store:e,Prism:t}=this.props,o=this.getTextValue(),i=f.Q(o),r=t.languages[this.props.language];if(i&&r&&i.length<1e4){const e=document.createElement("div"),a=t.highlight(i,r,this.props.language);e.innerHTML=this.flattenHtml(a);const l=Array.from(e.childNodes).map(this.createSyntaxToken),c=this.renderSyntaxTokens(U().compact(l),o),d=n()(s.Fragment,{},void 0,c,n()("span",{},void 0,"\n"));return H.renderToStaticMarkup(d)}{const t=I.IY({environment:this.environment,textValue:o&&{value:o,spaceId:this.props.parentSpaceId},parentStore:e,disableHover:!1,disableStyleAnnotations:!1,disableDateStyleAnnotations:!0,disabled:!this.canEdit(),theme:this.theme,emojiType:"raw",katex:void 0,formulaValueTypes:[]});return H.renderToStaticMarkup(s.createElement(s.Fragment,null,t))}},this.flattenHtml=e=>{let t="";const o=document.createElement("div");o.innerHTML=e;const i=Q.kd(o);for(const n of i){const e=U().escape(n.data);if(n.parentNode!==o){t+=`<span class="${U().escape(n.parentNode.className)}">${e}</span>`}else t+=e}return t},this.clearBrowserSelection=()=>{var e;null===(e=this.getEditorNode())||void 0===e||e.blur()},this.isEditing=this.createComputedStore((()=>{var e;const t=se.default.state;return"editing"===t.mode&&(null===(e=(0,ee.QY)(t.multiSelection))||void 0===e?void 0:e.store)===this.props.store})),this.isNewDiscussionMenuTarget=this.createComputedStore((()=>{var e;const t=ae.Z.state;return t.open&&"inline"===t.type&&(null===(e=(0,ee.QY)(t.multiSelection))||void 0===e?void 0:e.store)===this.props.store})),this.getContainerSelection=()=>{if(this.isEditing.state)return(0,ie.HE)(this.props.store)},this.getEndSelection=()=>{const e=K.p4(f.Q(this.getTextValue()));return{startIndex:e.length,endIndex:e.length}},this.editorRef=e=>{this.editor=e}}renderComponent(){const{disabled:e}=this.props;return n()(ce.Z,{store:this.props.store,disabled:e,clearBrowserSelection:this.clearBrowserSelection,getEndSelection:this.getEndSelection,onClick:this.handleClick,onDelete:this.handleDelete,onBackspace:this.handleBackspace,onEnter:this.handleEnter,onShiftEnter:this.handleShiftEnter,onCommandEnter:U().identity,onCommandShiftEnter:U().identity,onTab:this.handleTab,onUntab:this.handleUntab,onToggleHighlight:e=>this.handleAnnotation(["h",re.Z.state.color],e),onToggleBold:e=>this.handleAnnotation(["b"],e),onToggleItalics:e=>this.handleAnnotation(["i"],e),onToggleUnderline:e=>this.handleAnnotation(["_"],e),onToggleStrike:e=>this.handleAnnotation(["s"],e),onToggleCode:U().identity,onCopy:this.handleCopy,onCut:this.handleCut,onPaste:this.handlePaste,onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,render:this.renderContentContainer,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!0,canInsertText:!0,canSelectionDrag:!0,topBottomPadding:40,pasteBehavior:"inline"})}canEdit(){const{disabled:e,store:t}=this.props,o=this.pageContext&&this.pageContext.publicEditModeStore.state;return!(0,te.YF)(o)&&Boolean(!e&&t.canEdit())}getEditorNode(){var e;return(null===(e=this.editor)||void 0===e?void 0:e.getNode())||void 0}getTextValue(){return this.isNewDiscussionMenuTarget.state?I.Gj({store:this.props.store}):this.props.store.getValue()}flushRenderQueue(){W.default.flush()}logTypingLag(e){(0,ne.u)({type:e,environment:this.environment,store:this.props.store,codeLanguage:this.props.language,isInCollectionView:!1})}getContentEditableStyle(){return{flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:y.Z.getCompositeFontFamily(j.SP).githubMono,fontSize:"85%",tabSize:2,padding:"34px 16px 32px 32px",minHeight:"1em",color:this.theme.regularTextColor}}}de.displayName="CodeBlockValue";const pe=(0,B.withDependency)(B.deps.prismjs,((e,t)=>s.createElement(de,a()({},t,{Prism:e}))));var ue=o(68709),me=o(48019),ge=o(52275),he=o(31945),fe=o(68894),ve=o(78140),ye=o(72495),be=o(62385),Se=o(24405),we=o(7406),ke=o(66673),Ce=o(4615),_e=o(64369),Me=o(42402),Te=o(29551);function Ie(e){window.__c={n:"MermaidRenderer"};const{source:t}=e,o=(0,ke.Kt)(t,300,Object.is),i=(0,B.useDependency)(B.deps.mermaidAPI),r=(0,s.useMemo)((()=>{if(i.error)return i.error;if("resolved"!==i.status)return;const e=i.value;try{e.parse(o)}catch(t){return(0,we.tg)(t)}}),[i,o]);return n()("div",{},void 0,r?n()(xe,{error:r}):n()(Pe,{mermaidAPI:i.value,source:o}))}function Pe(e){const{mermaidAPI:t,source:o}=e,i=(0,s.useRef)(null),r=(0,s.useRef)(`mermaid-${(0,Ce.ZP)()}`),[a,l]=(0,s.useState)(),c=(0,Se.yK)((e=>({diagram:Te.gq.styles({alignContent:"center",justifyContent:"center"})})),[]),d=function(e){switch(e){case"dark":return"dark";case"light":return"neutral";default:(0,v.t1)(e)}}((0,Se.Fg)().mode),p=(0,s.useMemo)((()=>`%%{init: {'theme':'${d}'}}%%\n\n${o}`),[o,d]);return(0,s.useLayoutEffect)((()=>{if(!t)return;let e=!1;try{t.render(r.current,p,((t,o)=>{if(e)return;if(!i.current)return;i.current.innerHTML=t;const n=i.current.firstChild;n&&n instanceof SVGSVGElement&&n.removeAttribute("height");try{o&&o(i.current),l(void 0)}catch(r){l((0,we.tg)(r))}}))}catch(o){l((0,we.tg)(o))}return()=>{e=!0}}),[p,t]),s.createElement(s.Fragment,null,a&&n()(xe,{error:a}),s.createElement("div",{style:c.diagram,ref:i}))}function xe(e){window.__c={n:"MermaidError"};const{error:t}=e,o=(0,Se.yK)((e=>({label:{color:e.errorText,marginBottom:4,whiteSpace:"pre-wrap"}})),[]);return"str"in t?n()("div",{},void 0,n()(_e.Z,{isMultiline:!0,style:o.label},void 0,t.str,n()("div",{},void 0,n()(Me.Z,{external:!0,href:"https://mermaid-js.github.io/mermaid/#/examples"},void 0,n()(b.FormattedMessage,{id:"mermaidRenderer.error.seeMermaidExamples",defaultMessage:"See Mermaid examples"}))))):n()(_e.Z,{isMultiline:!0,style:o.label},void 0,n()(b.FormattedMessage,{id:"mermaidRenderer.error.unknownError",defaultMessage:"Unknown error: {error}",values:{error:`${t.name}: ${t.message}`}}))}class Be extends V.Z{constructor(){super(...arguments),this.storeTypes={focusStore:L.default.of(!1),mouseStore:D.Z,languageSelectorButtonPopupStore:Z.Z,codePreviewFormatSelectorButtonPopupStore:Z.Z,inputStore:R.Z},this.enableMermaidRenderer=this.createComputedStore((()=>"local"===T.Z.env||"on"===E.default.getGroup("mermaid"))),this.enableHtmlRenderer=this.createComputedStore((()=>"local"===T.Z.env||E.default.checkGate("html-preview-code-block"))),this.CustomRenderedLanguages={Mermaid:{component:Ie,gate:this.enableMermaidRenderer},HTML:{component:B.LazyHtmlCodePreviewRenderer,gate:this.enableHtmlRenderer}},this.renderLanguageSelectorPopup=e=>{const{device:t}=this.environment,o=this.getCurrentLanguage(),i=c.X0.filter((e=>"Java/C/C++/C#"!==e)),r=[{key:0,render:e=>s.createElement(ye.Z,e),actions:i.map((t=>({key:t,displayName:t,analyticsName:t,searchName:t,render:e=>s.createElement(ge.Z,a()({title:t},e)),action:()=>{this.setPersistedLanguage(t),e.close()},closeParentMenu:!0})))}],l=this.stores.inputStore.state.inputValue,d=n()(me.Z,{filter:l,context:{blocks:[],environment:this.environment,publicEditMode:void 0},sections:r,initialFocus:l?0:i.findIndex((e=>e===o))}),p=n()(ye.Z,{isInput:!0},void 0,n()(fe.ZP,{value:l,onChange:this.handleInputChange,focus:!t.isMobile||void 0,placeholder:P.default.formatMessage(S.sY.searchPlaceholder),focusAfterAnimation:!0}));let u;return u=t.isMobile?{menuType:x.og.Modal,title:n()(b.FormattedMessage,{defaultMessage:"Language",id:"codeBlock.mobileLanguageMenu.title"}),right:n()(b.FormattedMessage,{defaultMessage:"Done",id:"codeBlock.mobileLanguageMenu.doneButton.label"}),onClickRight:e.close,header:p}:{menuType:x.og.Popup,width:240,maxHeight:"50vh",header:p},s.createElement(ve.Z,u,d)},this.renderCodePreviewFormatsPopup=e=>{const{device:t}=this.environment,o=this.props.store.getFormat().code_preview_format,i=n()(me.Z,{context:{blocks:[this.props.store],environment:this.environment,publicEditMode:void 0},sections:S.j8,initialFocus:["code","preview","split_view"].findIndex((e=>e===o))});let r;return r=t.isMobile?{menuType:x.og.ActionSheet}:{menuType:x.og.Popup,width:167,maxHeight:"50vh"},s.createElement(ve.Z,r,i)},this.caption=()=>{this.handleEditCaption()},this.handleEditCaption=()=>{const e=this.props.store.getPropertyStore("caption");C.eP({environment:this.environment,store:this.props.store}),_.NX({store:e})},this.handleCopy=()=>{const e=this.props.store,t=f.Jc(e.getBlockTitleStore().getValue());w.RD({environment:this.environment,stringValue:t,copiedMessage:w.tq.copiedCodeToClipboard})},this.handleInputChange=e=>{this.stores.inputStore.setState({inputValue:e.target.value,focus:!1})},this.handlePopupClose=()=>{this.stores.inputStore.reset()},this.handleFocus=e=>{const t=e.target;t instanceof HTMLElement&&(0,l.E)(t)&&this.stores.focusStore.setState(!0)},this.handleBlur=()=>{this.stores.focusStore.setState(!1)}}renderPersisted(){const{device:e}=this.environment,{store:t,disabled:o}=this.props,i=this.getCurrentLanguage(),r=g.W[i],a=this.getCurrentCodePreviewFormat(i),s=t.getFormat().code_wrap;return n()("div",{style:{display:"flex"}},void 0,n()(ue.p,{allowSelectionWithin:!0,style:this.getStyle(),onMouseMove:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})}},void 0,n()("div",{onFocus:this.handleFocus,onBlur:this.handleBlur,style:this.getLanguageSelectorStyle()},void 0,this.renderLanguageSelector(),this.renderCodePreviewSelector()),n()("div",{onFocus:this.handleFocus,onBlur:this.handleBlur,style:this.getHeaderStyle()},void 0,n()("div",{style:{color:this.theme.mediumTextColor,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,marginTop:4,marginRight:4}},void 0,!e.isMobile&&this.renderCopyToClipboardButton(),!e.isMobile&&this.canEdit()&&this.renderCaptionButton(),this.canEdit()&&n()(N.Z,{style:{height:25,background:this.theme.codeBlockButtonBackground,borderTopLeftRadius:e.isMobile?3:0,borderBottomLeftRadius:e.isMobile?3:0,paddingLeft:8,paddingRight:8},store:this.props.store,fadeIn:!1}))),n()("div",{style:this.getCodeContainerStyle()},void 0,this.shouldShowCodeBlock(i,a)&&n()(pe,{store:t.getBlockTitleStore(),language:r,disabled:o,codeWrap:Boolean(s),isQuickFind:Boolean(this.props.isQuickFind),parentSpaceId:(0,h.CG)(t.pointer.spaceId)}),this.renderCustomCodePreview()),n()("div",{style:this.getCaptionContainerStyle()},void 0,this.renderCaption())),this.renderDiscussion())}hasCustomRenderer(e){return Boolean(this.getCustomRenderer(e))}getCustomRenderer(e){const t=this.CustomRenderedLanguages[e];if(t&&t.gate.state)return t}renderCustomCodePreview(){const{store:e}=this.props,t=this.getCurrentLanguage(),o=e.getBlockTitleStore(),i=this.getCurrentCodePreviewFormat(t),r="code"===i,a=this.getCustomRenderer(t);if(!r&&o.getValue()&&a)return n()("div",{style:this.getCustomPreviewWrapperStyle(i)},void 0,n()(a.component,{source:I.Xh(o.getValue(),o)}))}getCustomPreviewWrapperStyle(e){switch(e){case"split_view":return{padding:16,flexGrow:1,flexShrink:0};case"preview":return{padding:16,paddingTop:40,alignSelf:"center",flexGrow:1,flexShrink:0};case"code":return{};default:(0,v.t1)(e)}}renderCodePreviewSelector(){const{device:e}=this.environment,t=this.getCurrentLanguage();if(this.hasCustomRenderer(t)){const o=this.getCurrentCodePreviewFormat(t);return n()(he.Z,{popupType:e.isMobile?he.Z.PopupType.SlideUp:he.Z.PopupType.Popup,renderOrigin:e=>s.createElement(be.Z,a()({disabled:!this.canEdit(),style:{marginRight:5}},e),this.getCodePreviewFormatText(o),u.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),buttonPopupStore:this.stores.codePreviewFormatSelectorButtonPopupStore,placementToOrigin:F.Iw.Bottom,render:this.renderCodePreviewFormatsPopup})}}renderLanguageSelector(){const{device:e}=this.environment,t=this.getCurrentLanguage();return n()(he.Z,{popupType:e.isMobile?he.Z.PopupType.SlideUp:he.Z.PopupType.Popup,renderOrigin:e=>s.createElement(be.Z,a()({disabled:!this.canEdit(),style:{marginRight:5}},e),t,u.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),buttonPopupStore:this.stores.languageSelectorButtonPopupStore,placementToOrigin:F.Iw.Bottom,render:this.renderLanguageSelectorPopup,onClose:this.handlePopupClose})}renderCopyToClipboardButton(){return n()(be.Z,{onClick:this.handleCopy,style:{...this.getButtonStyle(),borderTopRightRadius:0,borderBottomRightRadius:0}},void 0,u.Z.copy({height:16,width:16,paddingRight:4}),n()(b.FormattedMessage,{defaultMessage:"Copy",id:"codeBlock.copyToClipboard.button"}))}renderCaptionButton(){return n()(be.Z,{onClick:this.handleEditCaption,style:{...this.getButtonStyle(),marginLeft:1,marginRight:1,borderRadius:0}},void 0,n()(b.FormattedMessage,{defaultMessage:"Caption",id:"codeBlock.caption.button"}))}getCurrentLanguage(){const e=this.getPersistedLanguage();return e&&(0,c.L9)(e)?e:Be.defaultLanguage}getPersistedLanguage(){const e=this.props.store.getProperties()||{};return p.Sj(e.language,d.fG)}setPersistedLanguage(e){M.createAndCommit({userAction:"CodeBlock.setPersistedLanguage",environment:this.environment,perform:t=>{k.E({blocks:[this.props.store],language:e,transaction:t})}}),m.Z.set({userId:this.environment.currentUser.id,key:Be.localLanguagePreferenceKey,value:e})}getCurrentCodePreviewFormat(e){return this.hasCustomRenderer(e)?this.props.store.getFormat().code_preview_format??"split_view":Be.defaultCodePreviewFormat}shouldShowCodeBlock(e,t){return!this.hasCustomRenderer(e)||"preview"!==t}getCodePreviewFormatText(e){let t;switch(e){case"split_view":t=S.sY.showSplitViewFormat;break;case"preview":t=S.sY.showCodePreviewFormat;break;case"code":t=S.sY.showOnlyCodeFormat;break;default:(0,v.t1)(e)}return n()(b.FormattedMessage,{defaultMessage:t.defaultMessage,id:t.id,description:t.description})}getStyle(){return{flexGrow:1,borderRadius:3,textAlign:"left",position:"relative",background:this.theme.codeBlockBackground,minWidth:0,width:"100%",...this.props.style}}getButtonStyle(){return{height:25,background:this.theme.codeBlockButtonBackground,color:this.theme.regularTextColor,fontWeight:y.Z.fontWeight.regular,padding:"4px 6px",fontSize:11.5}}getHeaderStyle(){const{mouseEntered:e}=this.stores.mouseStore.state,t=this.stores.focusStore.state,{isMobile:o}=this.environment.device,i=A.Z.state.isKeyboardMode,n=o||t||!i&&e;return{position:"absolute",top:3,right:1,zIndex:1,color:this.theme.mediumTextColor,display:"flex",alignItems:"center",justifyContent:"flex-end",height:25,fontSize:11.5,opacity:n?1:0,transition:Be.transition}}getLanguageSelectorStyle(){const{mouseEntered:e}=this.stores.mouseStore.state,t=this.stores.focusStore.state,{isMobile:o}=this.environment.device,i=e||t||o;return{position:"absolute",top:8,left:8,zIndex:1,color:this.theme.mediumTextColor,display:"flex",alignItems:"center",justifyContent:"flex-end",opacity:i?1:0,transition:Be.transition}}getCaptionContainerStyle(){return{background:this.theme.contentBackground,paddingRight:105}}getCodeContainerStyle(){return{}}}Be.localLanguagePreferenceKey="CodeBlockDefaultLanguage",Be.localCodeWrapPreferenceKey="CodeBlockDefaultCodeWrap",Be.defaultLanguage="JavaScript",Be.defaultCodePreviewFormat="code",Be.transition="opacity 300ms ease-in";const Ze=Be},68500:(e,t,o)=>{o.d(t,{Z:()=>O});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(66897),u=o(14714),m=o(99036),g=o(3779),h=o(4615),f=o(21202),v=o(6287),y=o(97880),b=o(5366),S=o(47307),w=o(31299),k=o(60709),C=o(33846),_=o(29798),M=o(3815),T=o(42922),I=o(52275),P=o(36488),x=o(74194),B=o(68894),Z=o(78140),E=o(9342),R=o(43765),A=o(11470),D=o(77137),F=o(72495),L=o(86765),V=o(97680);class N extends d.Z{constructor(){super(...arguments),this.storeTypes={inputStore:C.Z,menuListStore:_.Z},this.performRelationSearchRequest=async e=>{const{groupBy:t,schema:o,parentStore:i}=this.props,n=o[t.property];if(!n||!(0,m.p_)(n))return;const r=n.collection_pointer;if(!r)return;const a=M.NW.createChildStore(i,{table:v.v,id:r.id});if(await a.load(),!a.isDefined())return;const s=a.getSpaceId();return(await w.df({environment:this.environment,query:e,collectionId:r.id,spaceId:s,excludeTemplates:!0,source:"collection_group_value",limit:20,includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!1})).results.map((e=>({table:f.iU,id:e,spaceId:s})))},this.handleTextInputChange=e=>{const{inputStore:t,menuListStore:o}=this.stores;t.setState({...t.state,inputValue:e.target.value}),o.setState({...o.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.handleTextInputKeydown=e=>{if(13===e.keyCode)this.acceptTextInputValue();else if(27===e.keyCode){var t,o;null===(t=(o=this.props).onClose)||void 0===t||t.call(o)}},this.handleMenuClickRight=()=>{this.acceptTextInputValue()},this.handleClickSubmitButton=()=>{this.acceptTextInputValue()},this.performUserSearchRequest=async e=>(await w.Yu({environment:this.environment,query:e,membersOnly:!1})).slice(0,20)}willMount(e){var t;super.willMount(e);const{inputStore:o}=this.stores,{groupFormat:i}=this.props;i&&("select"===i.value.type||"multi_select"===i.value.type)&&i.value.value?o.setState({...o.state,inputValue:i.value.value}):i&&(0,u.R7)(i.value)&&"exact"===(null===(t=i.value.value)||void 0===t?void 0:t.type)&&o.setState({...o.state,inputValue:i.value.value.value})}renderComponent(){const{groupFormat:e,onClose:t}=this.props;let o;return o=this.environment.device.isPhone?{menuType:k.og.Modal,title:a()(b.FormattedMessage,e?{defaultMessage:"Rename group",id:"codeBlock.databaseEditGroupMenu.renameGroupTitle"}:{defaultMessage:"Add a group",id:"codeBlock.databaseEditGroupMenu.addGroupTitle"}),left:a()(b.FormattedMessage,{defaultMessage:"Cancel",id:"codeBlock.databaseEditGroupMenu.cancelButton.label"}),right:a()(b.FormattedMessage,{defaultMessage:"Done",id:"codeBlock.databaseEditGroupMenu.doneButton.label"}),onClickRight:this.handleMenuClickRight,onClickLeft:t}:{menuType:k.og.Popup,width:this.isTextInputType()?300:240,maxHeight:"50vh"},a()(P.Z,{capture:!0,render:e=>c.createElement(Z.Z,n()({},o,e),this.renderMenuInner())})}renderMenuInner(){const{groupBy:e,schema:t}=this.props;if(t[e.property])return"select"===e.type||"multi_select"===e.type?this.renderTextInput():"person"===e.type?this.renderPersonValue():"relation"===e.type?this.renderRelationValue():(0,u.HB)(e.type)?this.renderTextInput():void("number"!==e.type&&"status"!==e.type&&"date"!==e.type&&"formula"!==e.type&&"checkbox"!==e.type&&"created_time"!==e.type&&"last_edited_time"!==e.type&&"created_by"!==e.type&&"last_edited_by"!==e.type&&"location"!==e.type&&(0,y.t1)(e.type))}renderTextInput(){const{intl:e,groupFormat:t}=this.props,{inputValue:o}=this.stores.inputStore.state,i=t?e.formatMessage({id:"database.collectionEditGroupMenu.renameGroupLabel.placeholder",defaultMessage:"Rename group"}):e.formatMessage({id:"database.collectionEditGroupMenu.newGroupLabel.placeholder",defaultMessage:"New group"});return this.environment.device.isPhone?a()(F.Z,{},void 0,a()(B.ZP,{value:o,focus:!0,selectAll:!0,showClearButton:!1,focusInitial:!0,placeholder:i,onChange:this.handleTextInputChange,onKeyDown:this.handleTextInputKeydown})):a()("div",{style:{display:"flex",alignItems:"center",padding:"8px 10px",width:"100%",background:this.theme.inputBackground}},void 0,a()(x.Z,{value:o,focus:!0,selectAll:!0,focusInitial:!0,placeholder:i,onChange:this.handleTextInputChange,onKeyDown:this.handleTextInputKeydown,format:x.B.Transparent}),a()(T.Z,{onClick:this.handleClickSubmitButton},void 0,a()(b.FormattedMessage,{defaultMessage:"Done",id:"database.collectionEditGroupMenu.submitButton.label"}),g.Z.enter({height:14,width:14,fill:"currentColor",marginLeft:6,marginTop:2})))}renderPersonValue(){const{currentGroups:e,intl:t}=this.props,{inputValue:o}=this.stores.inputStore.state;return a()(D.Z,{request:o,performRequest:this.performUserSearchRequest,debounce:w.vp,render:(i,r,s)=>{r||(r=[]);const d=l().compact(r.map((t=>({key:t.id,render:e=>c.createElement(V.Z,n()({actor:(0,p.dp)(t)},e)),action:()=>{const{onChange:o,groupFormat:i}=this.props,n={type:"person",value:{table:"notion_user",id:t.id}};var r,a;i&&l().isEqual(n,i.value)?null===(r=(a=this.props).onClose)||void 0===r||r.call(a):e.some((e=>(0,u.we)(n,e.value)))?S.showErrorMessage(this.renderGroupAlreadyExistsMessage()):o({newGroupValue:n})}}))));let m;return m=s&&r&&0===d.length?a()(F.Z,{},void 0,a()(R.Z,{title:a()(b.FormattedMessage,{defaultMessage:"No results",id:"database.noPersonSearchResults.message"})})):a()(E.Z,{type:E.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>c.createElement(F.Z,e),items:d}],store:this.stores.menuListStore}),c.createElement(c.Fragment,null,a()(F.Z,{},void 0,a()(B.ZP,{value:o,focus:!0,placeholder:t.formatMessage({defaultMessage:"Search for a person…",id:"database.searchPerson.placeholder"}),onChange:e=>{this.stores.inputStore.setState({...this.stores.inputStore.state,inputValue:e.target.value}),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})),m)}})}renderRelationValue(){const{currentGroups:e,intl:t,parentStore:o,schema:i,groupBy:r}=this.props,{inputValue:s}=this.stores.inputStore.state,d=i[r.property];if(!d||"relation"!==d.type)return;const p=m.j0(d);if(!p)return;const g=M.NW.createChildStore(o,p);return g.isDefined()?a()(D.Z,{request:s,performRequest:this.performRelationSearchRequest,debounce:w.vp,render:(i,r,d)=>{r||(r=[]);const p=l().compact([...r.map((t=>{const i=M.G.createChildStore(o,t);return{key:i.id,render:e=>c.createElement(A.Z,n()({store:i},e)),action:()=>{const{onChange:o,groupFormat:i}=this.props,n={type:"relation",value:t};var r,a;i&&l().isEqual(n,i.value)?null===(r=(a=this.props).onClose)||void 0===r||r.call(a):e.some((e=>(0,u.we)(n,e.value)))?S.showErrorMessage(this.renderGroupAlreadyExistsMessage()):o({newGroupValue:n})}}})),s.length>0?{key:"new-page",render:e=>c.createElement(I.Z,n()({title:a()(L.Z,{targetCollectionStore:g,title:s})},e)),action:()=>{const{onChange:e}=this.props,t={table:f.iU,id:(0,h.ZP)(),spaceId:g.getSpaceId()};e({newGroupValue:{type:"relation",value:t},newPage:{id:t.id,spaceId:t.spaceId,name:s}})}}:void 0]);let m;return m=d&&r&&0===p.length?a()(F.Z,{},void 0,a()(R.Z,{title:a()(b.FormattedMessage,{defaultMessage:"No results",id:"database.noRelationSearchResults.message"})})):a()(E.Z,{type:E.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>c.createElement(F.Z,e),items:p}],store:this.stores.menuListStore}),c.createElement(c.Fragment,null,a()(F.Z,{},void 0,a()(B.ZP,{value:s,focus:!0,placeholder:t.formatMessage({defaultMessage:"Type to search...",id:"database.searchRelation.placeholder"}),onChange:e=>{this.stores.inputStore.setState({...this.stores.inputStore.state,inputValue:e.target.value}),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})),m)}}):void 0}renderGroupAlreadyExistsMessage(){return a()(b.FormattedMessage,{defaultMessage:"Group already exists.",id:"database.groupExistsAlreadyError.message"})}acceptTextInputValue(){const{onChange:e,currentGroups:t,groupBy:o,groupFormat:i}=this.props,{inputStore:n}=this.stores,r=n.state.inputValue.trim().replace(/,/g,"");let a;var s,c,d,p,m,g;("select"===o.type||"multi_select"===o.type?a={type:o.type,value:r}:(0,u.aB)(o)&&(a={type:o.type,value:{type:"exact",value:r}}),a)?r?i&&l().isEqual(a,i.value)?null===(s=(c=this.props).onClose)||void 0===s||s.call(c):t.some((e=>a&&(0,u.we)(a,e.value)))?S.showErrorMessage(this.renderGroupAlreadyExistsMessage()):e({newGroupValue:a}):null===(d=(p=this.props).onClose)||void 0===d||d.call(p):null===(m=(g=this.props).onClose)||void 0===m||m.call(g)}isTextInputType(){const{groupBy:e}=this.props;return"select"===e.type||"multi_select"===e.type||(0,u.HB)(e.type)}}N.displayName="CollectionEditGroupMenu";const O=(0,b.injectIntl)(N)},31775:(e,t,o)=>{o.d(t,{Pq:()=>te,oe:()=>ee,bU:()=>Q});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(76205),u=o(3779),m=o(97880),g=o(5366),h=o(50906),f=o(97004),v=o(17335),y=o(60709),b=o(61766),S=o(13401),w=o(80951),k=o(22433),C=o(34299),_=o(52275),M=o(14871),T=o(64369),I=o(62045);class P extends d.Z{renderComponent(){const{filterValueType:e,filter:t,intl:o}=this.props,i=(0,p.xm)(e),r={width:190,menuTitle:o.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.mobileComparatorValueMenu.title",description:"A comparator is something that compares two values, like 'Less than', 'Greater than', or 'Equals'."}),items:i,selectedItem:t.operator,getKey:e=>e,onSelect:o=>{const i=(0,v.li)(e,t,o,"combinator");this.props.onChange(i),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_comparator"})},renderItem:e=>c.createElement(_.Z,n()({title:(0,v.WC)(e.value)},e)),renderOrigin:e=>c.createElement(I.Z,n()({},e,{placeholder:o.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.comparatorMenuDropdownButton.label"}),title:a()(T.Z,{isMobile:this.environment.device.isMobile},void 0,(0,v.WC)(t.operator)),disableMargins:!0}))};return c.createElement(M.Z,n()({key:"comparator"},r,{mobileActionSheet:!0}))}}P.displayName="CollectionFilterMenuFilterOperator";const x=(0,g.injectIntl)(P);var B=o(28463),Z=o(26909);const E=(0,g.defineMessages)({setFilter:{defaultMessage:"Set filter",id:"database.filterMenu.rollupPropertyValue.mobileMenu.title"}});class R extends d.Z{renderComponent(){const{filter:e}=this.props;if((0,p.ul)(e))return this.renderRollupFilter(e);const t=(0,p.fI)({schema:this.props.schema,property:this.props.property,getRecordValue:this.props.parentStore.getRecordValue});if(!(0,p.ZB)(t,e)){const e=(0,v.rn)(t);return a()(c.Fragment,{},void 0,a()(x,{filterValueType:t,filter:e,collectionViewType:this.props.collectionViewType,onChange:this.props.onChange}),a()(B.Z,{filterValueType:t,filter:e,schema:this.props.schema,property:this.props.property,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId,onChange:this.props.onChange}))}const o=c.createElement(g.FormattedMessage,n()({},v.xe[t],{values:{property:a()(g.FormattedMessage,{id:"collectionFilterMenuFilter.property.name",defaultMessage:"Property",description:"Rendered in property filter rows if property is included in the translation of collectionFilterMenuFilter.filterOperators.order"}),operator:a()(x,{filterValueType:t,filter:e,collectionViewType:this.props.collectionViewType,onChange:this.props.onChange}),operatorValue:a()(B.Z,{filterValueType:t,filter:e,schema:this.props.schema,property:this.props.property,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId,onChange:this.props.onChange})}}));return this.environment.device.isMobile?o:a()("div",{style:{alignItems:"center",display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:this.props.isRollupFilter?void 0:"span 2",gridColumnGap:`${Z.l0}px`,gridTemplateRows:`${Z.fg}px`,gridTemplateColumns:"[value-start] max-content auto [value-end operator-start] auto"}},void 0,o)}renderRollupFilter(e){const{intl:t}=this.props,o={menuTitle:t.formatMessage(E.setFilter),items:p.HH,getKey:e=>e,selectedItem:e.operator,onSelect:t=>{const o={...e,operator:t};this.props.onChange(o),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"set_rollup_set_filter"})},renderItem:e=>c.createElement(_.Z,n()({title:(0,v.SW)(e.value,t)},e)),renderOrigin:o=>c.createElement(I.Z,n()({},o,{placeholder:t.formatMessage(E.setFilter),title:(0,v.SW)(e.operator,t),disableMargins:!0,desktopStyle:{minWidth:70}}))},i=(0,C.gT)({property:this.props.property,schema:this.props.schema,getRecordValue:this.props.parentStore.getRecordValue});if(!i)return a()("div",{style:{gridColumnEnd:"span 2"}});const r=a()(c.Fragment,{},void 0,c.createElement(M.Z,n()({key:"set_filter"},o,{mobileActionSheet:!0})),a()(A,{collectionViewId:this.props.collectionViewId,filter:e.subfilter,schema:i.targetCollectionSchema,property:i.targetProperty,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,onChange:t=>{const o={...e,subfilter:t};this.props.onChange(o)},isRollupFilter:!0}));return this.environment.device.isMobile?r:a()("div",{style:{display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:"span 2",gridColumnGap:`${Z.l0}px`,gridTemplateColumns:"max-content",gridTemplateRows:`${Z.fg}px`}},void 0,r)}}R.displayName="LocalizableCollectionFilterMenuFilter";const A=(0,g.injectIntl)(R),D=A;var F=o(31945),L=o(77498),V=o(50542);class N extends d.Z{constructor(){super(...arguments),this.handleChangeProperty=e=>{var t,o;const{schema:i}=this.props,{property:n,filter:r}=this.props.propertyFilter,a=i[n],s=i[e],l={property:e,filter:r},c=s&&(0,p.J5)(s,r),d=s&&"relation"===s.type&&n!==e,u=a&&("created_by"===a.type||"last_edited_by"===a.type)&&s&&"person"===s.type,m=(0,p.Gb)(r)&&!(0,p.mv)(r)&&(0,p.R8)(r).some((e=>"exact"===e.type&&e.value&&"bot"===e.value.table));(!c||d||u&&m||!(0,k.dN)(l,i))&&(l.filter=(0,v.zZ)({schema:i,property:e,getRecordValue:this.props.parentStore.getRecordValue})),null===(t=(o=this.props).onChange)||void 0===t||t.call(o,this.props.index,l),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_property"})}}renderComponent(){const{device:e}=this.environment,{schema:t,propertyFilter:o}=this.props,i=(0,w.Qm)({schema:t,property:o.property});if(i&&(0,p.J5)(i,o.filter))return a()(c.Fragment,{},void 0,this.props.filterOperator,a()(F.Z,{popupType:e.isMobile?F.Z.PopupType.SlideUp:F.Z.PopupType.Popup,renderOrigin:e=>c.createElement(V.Z,n()({},e,{propertySchema:i,disableMargins:!0})),render:e=>a()(L.Z,{isRelationProperty:!1,schema:this.props.schema,onAccept:this.handleChangeProperty,onClose:e.close})}),a()(g.FormattedMessage,{id:"collectionFilterMenuRow.propertyConjunction.label",defaultMessage:" ",description:"Appears after the property dropdown in database filters. This can be used to make the filter row feel like a sentence. The order is property dropdown ___ operatorValue operator OR property dropdown ____ operatorValue operator."}),a()(D,{filter:o.filter,schema:t,property:o.property,parentStore:this.props.parentStore,collectionViewId:this.props.collectionViewId,collectionViewType:this.props.collectionViewType,onChange:e=>{var t,i;const n={...o,filter:e};null===(t=(i=this.props).onChange)||void 0===t||t.call(i,this.props.index,n)},isRollupFilter:!1}))}}N.displayName="CollectionFilterMenuRow";const O=N;function U(){return window.__c={n:"AddAFilterText"},a()(g.FormattedMessage,{defaultMessage:"Add filter rule",id:"database.filterMenu.addFilterRuleButtonTitle"})}const H=(0,g.defineMessages)({operatorPlaceholder:{defaultMessage:"Operator",id:"database.filterMenu.operatorPlaceholder",description:"An operator refers to an option that joins multiple clauses for this filter to this database. For example, 'and' or 'or' are operators."}});class z extends d.Z{renderComponent(){const{intl:e,filterOperator:t,onChange:o,disableMargins:i}=this.props,r={width:"auto",menuTitle:e.formatMessage({defaultMessage:"Operator",id:"database.filterMenu.filterOperatorMenu.title",description:"An operator refers to an option that joins multiple clauses for this filter to this database. For example, 'and' or 'or' are operators."}),items:p.Uz,getKey:e=>e,selectedItem:t,onSelect:o,renderItem:t=>c.createElement(_.Z,n()({title:(0,v.KV)(t.value,e),caption:(0,v.Qz)(t.value,e)},t)),renderOrigin:o=>c.createElement(I.Z,n()({},o,{title:t&&(0,v.KV)(t,e),placeholder:e.formatMessage(H.operatorPlaceholder),disableMargins:i}))};return c.createElement(M.Z,n()({key:"operator"},r,{mobileActionSheet:!0}))}}z.displayName="CollectionFilterOperatorSelect";const W=(0,g.injectIntl)(z);var j=o(31339),K=o(8982),Y=o(73063),G=o(78140),X=o(9342),q=o(40721),$=o(44532),J=o(72495);const Q=170,ee=400;class te extends d.Z{constructor(){super(...arguments),this.buttonPopupStores=[],this.renderChildFilter=(e,t)=>{const o=this.environment.device.isMobile;return(0,p.vA)(e)?o?this.renderMobileCombinatorFilter(e,t):this.renderDesktopCombinatorFilter(e,t):(0,p.aN)(e)?o?this.renderMobilePropertyFilter(e,t):this.renderDesktopPropertyFilter(e,t):void 0},this.renderAddFilterMenuItem=e=>{const t=this.renderMenuIcon(u.Z.plus);return c.createElement(_.Z,n()({focused:!1},e,{icon:t,title:a()(U,{})}))},this.renderAddFilterGroupMenuItem=e=>{const t=this.renderMenuIcon(u.Z.addFilterGroup);return c.createElement(_.Z,n()({focused:!1},e,{icon:t,title:a()(g.FormattedMessage,{defaultMessage:"Add filter group",id:"database.filterMenu.addFilterGroup2ButtonTitle"}),caption:a()(g.FormattedMessage,{defaultMessage:"A group to nest more filters",id:"database.filterMenu.addFilterGroupButtonCaption"})}))},this.renderCombinatorActions=()=>{const{device:e}=this.environment;if(e.isMobile)return a()(J.Z,{topBorder:this.shouldRenderEmptyState()},void 0,this.renderAddFilterMenuItem({onClick:this.handleAddFilterClick}),this.allowNewCombinatorFilters()&&this.renderAddFilterGroupMenuItem({onClick:this.handleAddFilterGroupClick}));const t={height:32},o={padding:`${Z.cn}px 0`};return this.allowNewCombinatorFilters()?a()(J.Z,{topBorder:this.shouldRenderEmptyState(),desktopStyle:o},void 0,a()(F.Z,{alignmentToOrigin:$.ZP.Alignment.Start,popupType:$.ZP.PopupType.Popup,renderOrigin:e=>a()(K.i,{action:()=>e.onClick(),render:o=>{const{focused:i,...r}=o;return c.createElement(S.Z,n()({},e,r,{focused:i,isBlue:!1,style:t,title:a()("div",{},void 0,a()(U,{}),u.Z.chevronDown({width:10,marginLeft:6,display:"inline"}))}))}}),render:e=>a()(X.Z,{type:X.i.Vertical,initialFocus:0,sections:[{key:"actions",render:e=>c.createElement(J.Z,e),items:[{key:"add_filter",render:this.renderAddFilterMenuItem,action:t=>{e.close(),this.handleAddFilterClick()}},{key:"add_filter_group",render:this.renderAddFilterGroupMenuItem,action:t=>{e.close(),this.handleAddFilterGroupClick()}}]}]})})):a()(J.Z,{topBorder:this.shouldRenderEmptyState(),desktopStyle:o},void 0,a()(K.i,{action:this.handleAddFilterClick,render:e=>{const{focused:o,...i}=e;return c.createElement(S.Z,n()({},i,{focused:e.focused,isBlue:!1,style:t,onClick:this.handleAddFilterClick,title:a()(U,{})}))}}))},this.handleChildFilterChange=(e,t)=>{this.mutateFilters((o=>o.splice(e,1,t)))},this.handleAddFilterClick=()=>{const e=this.getDefaultNewPropertyFilter(this.props.schema);this.mutateFilters((t=>t.push(e))),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"add_filter"})},this.handleAddFilterGroupClick=()=>{const e=this.getDefaultNewPropertyFilter(this.props.schema),t={operator:this.getOppositeOperator(),filters:[e]},o=this.mutateFilters((e=>e.push(t)));this.openIndex(o-1),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"add_filter_group"})},this.handleChangeFilterOperator=e=>{const t={...this.props.combinatorFilter,operator:e};this.props.onChange(this.props.index,t),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_operator"})}}willUnmount(){this.buttonPopupStores=[]}renderComponent(){const{combinatorFilter:e}=this.props,{device:t}=this.environment,o=(e.filters??[]).flatMap((e=>(0,p.Mm)(e)?[]:[e]));return a()(c.Fragment,{},void 0,this.shouldRenderEmptyState()?void 0:a()("div",{style:t.isMobile?void 0:this.getGridStyles()},void 0,o.map(this.renderChildFilter)),this.renderCombinatorActions())}renderDesktopPropertyFilter(e,t){return a()(c.Fragment,{},t,a()(O,{index:t,propertyFilter:e,schema:this.props.schema,filterOperator:this.renderCombinatorOperator(t),parentStore:this.props.parentStore,onChange:this.handleChildFilterChange,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId},t),this.renderRowActions(e,t))}renderMobilePropertyFilter(e,t){return a()(c.Fragment,{},t,this.renderCombinatorOperator(t),a()(J.Z,{title:a()(g.FormattedMessage,{defaultMessage:"Filter {index}",id:"database.filterMenu.filterIndex",description:"Printed above each property filter with the number of the filter",values:{index:t+1}})},void 0,a()(O,{index:t,propertyFilter:e,schema:this.props.schema,filterOperator:null,parentStore:this.props.parentStore,onChange:this.handleChildFilterChange,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId},t),this.renderRowActions(e,t)))}renderDesktopCombinatorFilter(e,t){const o={gridColumn:"property-start / value-end",...this.getSubgridWrapperStyles()};return a()(c.Fragment,{},t,this.renderCombinatorOperator(t),a()("div",{style:o},void 0,a()(te,{index:t,level:this.props.level+1,combinatorFilter:e,onChange:this.handleChildFilterChange,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId})),this.renderRowActions(e,t))}renderMobileCombinatorFilter(e,t){const o=(e.filters||[]).length,i=a()(g.FormattedMessage,{defaultMessage:"Filter Group {index}",id:"database.filterMenu.filterGroupIndex",description:"Printed above each filter group with the number of the filter",values:{index:t+1}});return a()(c.Fragment,{},t,this.renderCombinatorOperator(t),a()(J.Z,{title:i},void 0,a()(F.Z,{buttonPopupStore:this.getButtonPopupStore(t),popupType:F.Z.PopupType.SlideUp,renderOrigin:t=>c.createElement(_.Z,n()({focused:!1},t,{showExtensionArrow:!0,right:o.toString(),title:(0,v.qh)({filter:e,schema:this.props.schema})})),render:o=>a()(G.Z,{menuType:y.og.Modal,title:i,left:a()(q.BackMenuText,{}),onClickLeft:o.close},void 0,a()(te,{index:t,level:this.props.level+1,combinatorFilter:e,onChange:this.handleChildFilterChange,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId}))}),this.renderRowActions(e,t)))}renderCombinatorOperator(e){const t=this.props.combinatorFilter.operator,{device:o}=this.environment,i={justifySelf:"end"},n={...i,lineHeight:"32px",paddingRight:4};if(0===e){if(o.isMobile)return;return a()(T.Z,{style:n},void 0,a()(g.FormattedMessage,{defaultMessage:"Where",id:"database.filterMenu.where",description:"Displayed before every filter group on the desktop"}))}if(1===e){const e=a()(W,{disableMargins:!0,filterOperator:t,onChange:this.handleChangeFilterOperator});return this.environment.device.isMobile?a()(J.Z,{},void 0,e):a()("div",{style:i},void 0,e)}if(!o.isMobile)return a()(T.Z,{style:n},void 0,a()(ie,{operator:t}))}renderRowActions(e,t){return this.environment.device.isMobile?this.renderRowActionMenuItems(e,t,void 0):a()(F.Z,{popupType:$.ZP.PopupType.Popup,renderOrigin:e=>a()(K.i,{action:()=>e.onClick(),render:e=>c.createElement(Y.Z,n()({},e,{hovered:e.focused,style:{width:"100%",height:32},icon:u.Z.dots}))}),render:o=>this.renderRowActionMenuItems(e,t,o)})}renderMenuIcon(e,t){return a()(j.Z,{icon:e,styles:t})}renderRowActionMenuItems(e,t,o){const i=(0,p.vA)(e),r=a()(g.FormattedMessage,i?{defaultMessage:"Remove",id:"database.filterMenu.removeFilterGroupMenuTitle"}:{defaultMessage:"Remove",id:"database.filterMenu.removeFilterMenuTitle"}),s=a()(g.FormattedMessage,i?{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterGroupMenuTitle"}:{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterMenuTitle"}),l=[{key:"delete",action:()=>{o&&o.close(),this.handleDeleteFilter(t)},render:e=>c.createElement(_.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.trash),title:r}))},{key:"duplicate",action:()=>{o&&o.close(),this.handleDuplicateFilter(t)},render:e=>c.createElement(_.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.duplicate),title:s}))}];if((0,p.aN)(e)&&this.allowNewCombinatorFilters()&&l.push({key:"turn_into_group",action:()=>{o&&o.close(),this.handleTurnIntoGroup(t,e)},render:e=>c.createElement(_.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.loop),title:a()(g.FormattedMessage,{defaultMessage:"Turn into group",id:"database.filterMenu.turnIntoGroupMenuTitle"})}))}),(0,p.vA)(e)&&e.filters&&1===e.filters.length){const i=(0,p.vA)(e.filters[0])?a()(g.FormattedMessage,{defaultMessage:"Unwrap group",id:"database.filterMenu.unwrapGroupMenuTitle"}):a()(g.FormattedMessage,{defaultMessage:"Turn into filter",id:"database.filterMenu.turnIntoFilterMenuTitle"});l.push({key:"turn_into_filter",action:()=>{o&&o.close(),this.handleTurnIntoFilter(t,e)},render:e=>c.createElement(_.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.loop),title:i}))})}const d=oe(e);return(0,p.vA)(e)&&this.props.level+d+1<3&&l.push({key:"wrap_in_group",action:()=>{o&&o.close(),this.handleTurnIntoGroup(t,e)},render:e=>c.createElement(_.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.loop),title:a()(g.FormattedMessage,{defaultMessage:"Wrap in group",id:"database.filterMenu.wrapInGroupMenuTitle"}),caption:a()(g.FormattedMessage,{defaultMessage:"Create a filter group around this",id:"database.filterMenu.wrapInGroupMenuCaption"})}))}),a()(X.Z,{initialFocus:this.environment.device.isMobile?void 0:0,type:X.i.Vertical,sections:[{key:"actions",render:this.environment.device.isMobile?e=>c.createElement("div",e):e=>c.createElement(J.Z,e),items:l}]})}handleDuplicateFilter(e){this.mutateFilters((t=>{const o=t[e];if(o){const i={...o};t.splice(e,0,i)}})),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"duplicate_filter"})}handleTurnIntoGroup(e,t){const o={operator:this.getOppositeOperator(),filters:[t]};this.handleChildFilterChange(e,o),this.openIndex(e),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"turn_into_filter_group"})}handleTurnIntoFilter(e,t){const o=l().first(t.filters||[]);o&&!(0,p.Mm)(o)&&this.handleChildFilterChange(e,o),h.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"turn_into_filter"})}handleDeleteFilter(e){this.mutateFilters((t=>t.splice(e,1))),this.getButtonPopupStore(e).reset(),this.buttonPopupStores.splice(e,1)}openIndex(e){this.getButtonPopupStore(e).setState({open:!0})}getButtonPopupStore(e){for(;this.buttonPopupStores.length<e+1;){const e=new b.Z;this.buttonPopupStores.push(e)}return this.buttonPopupStores[e]}getOppositeOperator(){return"or"===this.props.combinatorFilter.operator?"and":"or"}allowNewCombinatorFilters(){return this.props.level<2}getDefaultNewPropertyFilter(e){const t=(this.props.combinatorFilter.filters||[]).filter(p.aN),o=t[t.length-1];return o?l().cloneDeep(o):(0,f.Me)(e)}mutateFilters(e){const t=[...this.props.combinatorFilter.filters||[]],o=e(t),i={...this.props.combinatorFilter,filters:t};return this.props.onChange(this.props.index,i),o}shouldRenderEmptyState(){return(0,p.$1)(this.props.combinatorFilter)&&0===this.props.level}getEmptyTextWrapStyle(){return{color:this.theme.lightTextColor,lineHeight:1.5,whiteSpace:"nowrap"}}getSubgridWrapperStyles(){return{background:this.theme.filterGroupBackground,borderRadius:3,boxShadow:`0 0 0 1px ${this.theme.filterGroupBorder}`,margin:1,alignSelf:"stretch"}}getGridStyles(){return te.style}}function oe(e){if((0,p.vA)(e)){const t=(e.filters||[]).filter(p.vA);return 1+(l().max(t.map(oe))||0)}return 0}function ie(e){const{operator:t,lowercase:o}=e;return"or"===t?a()(g.FormattedMessage,o?{id:"collectionFilterCombinatorGrid.filterOperator.or.lowercase",defaultMessage:"or"}:{id:"collectionFilterCombinatorGrid.filterOperator.or",defaultMessage:"Or"}):"and"===t?a()(g.FormattedMessage,o?{id:"collectionFilterCombinatorGrid.filterOperator.and.lowercase",defaultMessage:"and"}:{id:"collectionFilterCombinatorGrid.filterOperator.and",defaultMessage:"And"}):(0,m.t1)(t)}te.displayName="CollectionFilterCombinatorGrid",te.style={display:"grid",gridTemplateColumns:`\n             [boolean-start] 60px\n             [boolean-end property-start] 120px\n             [property-end opererator-start] 110px\n             [operator-end value-start] auto\n             [value-end menu-start] ${Z.fg}px\n             [menu-end]\n        `,gridAutoRows:`minmax(${Z.fg}px, auto)`,gridColumnGap:Z.l0,gridRowGap:Z.cn,padding:`${Z.cn}px ${Z.l0}px 0 ${Z.l0}px`,justifyItems:"stretch",alignItems:"start"}},28463:(e,t,o)=>{o.d(t,{Z:()=>X,$:()=>G});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(66897),d=o(76205),p=o(99036),u=o(84619),m=o(32918),g=o(76725),h=o(32056),f=o(23014),v=o(97880),y=o(82990),b=o(5366),S=o(50906),w=o(17335),k=o(29376),C=o(3815),_=o(31775),M=o(56723),T=o(68834),I=o(12318),P=o(8982),x=o(36488),B=o(74194),Z=o(68894);const E=(0,b.defineMessages)({value:{defaultMessage:"Value",id:"database.filterAndSort.propertyValueInput.placeholder"}});class R extends l.Z{constructor(){super(...arguments),this.storeTypes={isEditing:I.default.of(!1)},this.input=null,this.handleClick=()=>{this.stores.isEditing.set(!0)},this.handleInputBlur=()=>{this.stores.isEditing.set(!1)},this.handleInputCancel=()=>{this.input&&(this.input.handleBlur(),this.handleInputBlur())},this.handleInputChange=e=>{const t=e.target.value;this.props.onChange(t)}}renderComponent(){return a()("div",{style:{display:"flex",...this.getDivStyle()},onClick:this.handleClick},void 0,this.renderInput())}renderInput(){const{device:e}=this.environment,t=this.stores.isEditing.get(),o=this.props.value||"",{intl:i}=this.props;return e.isMobile?a()(Z.ZP,{value:o,onChange:this.handleInputChange,placeholder:i.formatMessage(E.value),onBlur:this.handleInputBlur,rightMobileEditLabel:a()(b.FormattedMessage,{defaultMessage:"Edit",id:"database.filterAndSort.mobileEditButton.label"})}):a()(P.i,{action:()=>this.stores.isEditing.set(!0),render:e=>s.createElement("div",{ref:e.ref,onMouseEnter:e.onMouseEnter,style:{background:e.focused&&!t?this.theme.buttonHoveredBackground:"transparent",...this.getDivStyle()}},a()(x.Z,{capture:t,render:e=>s.createElement("div",n()({},e,{style:this.getDivStyle()}),s.createElement(B.Z,{focus:t,ref:e=>this.input=e,value:o,onChange:this.handleInputChange,placeholder:i.formatMessage(E.value),onBlur:this.handleInputBlur,onCancel:this.handleInputCancel,style:this.getInputStyle()}))}))})}getDivStyle(){return R.disableMarginStyles}getInputStyle(){return{...R.inputStyle,...R.disableMarginStyles,minWidth:_.bU}}}R.displayName="CollectionOperatorValueInput",R.inputStyle={marginRight:8,paddingLeft:6,paddingRight:0,width:80,height:30},R.disableMarginStyles={margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"};const A=(0,b.injectIntl)(R);var D=o(26909),F=o(52275),L=o(31945),V=o(12508),N=o(14871),O=o(92864),U=o(89845),H=o(62045),z=o(69265),W=o(14390),j=o(22084);const K=(0,b.defineMessages)({dateTitle:{defaultMessage:"Date",id:"database.filterMenu.mobileDateSelectMenu.title"},emptyPlaceholder:{defaultMessage:"Empty",id:"database.filterMenu.dateSelectMenu.emptyPlaceholder"}});class Y extends l.Z{constructor(){super(...arguments),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,property:t,parentStore:o}=this.props,i=e[t];if(i&&(0,p.p_)(i))return(0,k.ke)(i,o)})),this.renderPersonInner=e=>{var t;const{device:o}=this.environment;if(!e.value)return;if("relative"===e.type&&"me"===e.value)return a()("span",{style:{marginTop:1,marginRight:10,marginBottom:6}},void 0,a()(b.FormattedMessage,{defaultMessage:"Me",id:"database.filterAndSort.firstPersonPropertyValue.title"},"relative"));const i=(0,c.Hl)({pointer:e.value,getRecordValue:this.props.parentStore.getRecordValue});return a()(O.ZP,{actor:i,isSingle:!1,shouldShrink:!1,format:o.isMobile?O.vw.Format.Large:O.vw.Format.Medium,showRemoveButton:!1},null===(t=i.value)||void 0===t?void 0:t.id)}}renderComponent(){const{filter:e,property:t,collectionViewId:o,schema:i,parentStore:n}=this.props,r=this.props.filterValueType,s=a()("span",{});if("date"===r)return(0,d.gE)(e)?(0,d.mv)(e)?s:(0,d.TQ)(e)?this.renderDateRangeFilterOperatorValue(e):this.renderDateFilterOperatorValue(e):s;if("text"===r){if(!(0,d.Ly)(e))return s;const t=e;if((0,d.mv)(t))return s;if("string_has_no_alphabet_prefix"===t.operator)return;const o=t.value;return a()(A,{value:o.value,onChange:e=>{const o={type:"exact",value:e},i={...t,value:o};this.props.onChange(i)}})}if("number"===r){if(!(0,d.h6)(e))return s;const t=e;if((0,d.mv)(t))return s;const o=t.value;return a()(A,{value:void 0===o.value?"":o.value.toString(),onChange:e=>{const o={type:"exact",value:(0,h.p3)(e)},i={...t,value:o};this.props.onChange(i)}})}if("checkbox"===r){if(!(0,d.XA)(e)||!o)return s;const r=e,l=r.value;return a()(L.Z,{popupType:this.environment.device.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:e=>this.renderCheckboxOrigin(l,e),render:e=>a()(M.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:r},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:M.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("select"===r||"multi_select"===r||"status"===r){if(!((0,d.dx)(e)||(0,d.NU)(e)||(0,d.r2)(e))||!o)return s;const r=e;if((0,d.mv)(r))return s;const l=this.props.schema[this.props.property];if(!l)return s;const c=(0,d.dx)(r)?(0,d.mg)(r):(0,d.NU)(r)?(0,d.qC)(r):(0,d.Js)(l,(0,d.wB)(r));return a()(L.Z,{popupType:this.environment.device.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:e=>this.renderSelectOrigin(c,e),render:e=>a()(M.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:r},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:M.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("location"===r){if(!(0,d.Mp)(e))return s;const r=e,l=(0,d.u0)(r);return a()(L.Z,{popupType:this.environment.device.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:e=>this.renderLocationOrigin(l,e),render:e=>a()(M.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:r},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:M.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("relation"===r){if(!(0,d.e)(e)||!o)return s;const r=e;if((0,d.mv)(r))return s;const l=(0,d.YO)(r);return a()(L.Z,{popupType:this.environment.device.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:e=>this.renderRelationOrigin(l,e),render:e=>a()(M.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:r},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:M.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("person"===r){if(!(0,d.Gb)(e)||!o)return s;const r=e;if((0,d.mv)(r))return s;const l=(0,d.R8)(r);return a()(L.Z,{popupType:this.environment.device.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:e=>this.renderPersonOrigin(l,e),render:e=>a()(M.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:r},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:M.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("file"===r){if(!(0,d.W6)(e))return s;const t=e;if((0,d.mv)(t))return s;(0,v.t1)(t)}if("verification"===r)return(0,d.Jw)(e)?a()(L.Z,{popupType:this.environment.device.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:t=>this.renderVerificationOrigin((0,d.fl)(e),t),render:r=>a()(M.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:e},schema:i,onChange:e=>{this.props.onChange(e)},onClose:r.close,parentStore:n,context:M.Qv.AdvancedFilter,allowRelativePersonFilter:!1})}):s;(0,v.t1)(r)}renderCheckboxOrigin(e,t){const o=null==e?void 0:e.value;return s.createElement(H.Z,n()({},t,{disableMargins:!0,placeholder:a()(b.FormattedMessage,{defaultMessage:"Select a value",id:"database.filterOperatorValue.checkboxPlaceholder.title"}),title:"boolean"==typeof o&&a()(V.Z,{checked:o,size:16,disabled:!0})}))}renderSelectOrigin(e,t){const{device:o}=this.environment,i=this.props.schema[this.props.property],r=i&&((0,p.cu)(i)||"status"===i.type)&&i.options||[];return s.createElement(H.Z,n()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:a()(b.FormattedMessage,{defaultMessage:"Select an option",id:"collections.operatorValueSelect.placeholder"}),title:e.length>0&&s.createElement(s.Fragment,null,e.map((e=>e.value&&a()(j.Z,{format:o.isMobile?u.l.Large:u.l.Medium,isSingle:!1,value:e.value,options:r,showRemoveButton:!1},e.value))))}))}renderRelationOrigin(e,t){const{device:o}=this.environment;return s.createElement(H.Z,n()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:a()(b.FormattedMessage,{defaultMessage:"Select a page",id:"databaseRelationOperators.selectPlaceholder",description:"Placeholder when selecting a page as a value in a database relation."}),title:e.length>0&&e.map((e=>{if(!e.value)return;const t=e.type,i={isSingle:!1,shouldShrink:!1,format:o.isMobile?u.l.Large:u.l.Medium};if("exact"===t)return s.createElement(z.Z,n()({key:e.value,blockId:e.value,parentStore:this.props.parentStore},i));if("relative"===t){const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;return s.createElement(u.Z,n()({value:f.qB[t][e.value.variable].formattedMessage,backgroundColor:"transparent",theme:this.theme},i))}(0,v.t1)(t)}))}))}renderLocationOrigin(e,t){const{parentStore:o}=this.props;return s.createElement(H.Z,n()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:a()(b.FormattedMessage,{defaultMessage:"Select a location",id:"databaseLocationOperators.selectPlaceholder",description:"Placeholder when selecting a location as a value in a location filter."}),title:e.length>0&&e.map((e=>e.value&&a()("div",{style:{margin:"0 10px 6px 0"}},void 0,a()(T.Z,{collectionStore:C.NW.createChildStore(o,{table:"collection",id:e.value})},e.value))))}))}renderPersonOrigin(e,t){return s.createElement(H.Z,n()({},t,{placeholder:G(void 0),disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),title:e.length>0&&e.map(this.renderPersonInner)}))}renderDateFilterOperatorValue(e){const{intl:t,collectionViewId:o,property:i,schema:r,parentStore:l}=this.props;if(!o)return;const c={menuTitle:t.formatMessage(K.dateTitle),items:d.tO,getKey:e=>"relative"===e.type?e.value:e.type,selectedItem:e.value,onSelect:t=>{const o={...e,value:t};this.props.onChange(o),S.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})},renderItem:e=>s.createElement(F.Z,n()({title:(0,w.x)(e.value)},e)),renderOrigin:o=>s.createElement(H.Z,n()({},o,{disableMargins:!0,placeholder:t.formatMessage(K.emptyPlaceholder),title:(0,w.x)(e.value)}))},p=e.value;if("exact"===p.type){const t=a()(s.Fragment,{},void 0,a()(b.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.date.exact.order",defaultMessage:"{exact}{dateValue}",description:"Controls the ordering of the date filter on databases.",values:{exact:s.createElement(N.Z,n()({key:"date-filter-value-type"},c,{mobileActionSheet:!0})),dateValue:a()(L.Z,{popupType:this.environment.device.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:e=>this.renderExactDateOrigin(p,e,!1),render:t=>a()(M.ZP,{collectionViewId:o,propertyFilter:{property:i,filter:e},schema:r,onChange:e=>{this.props.onChange(e)},onClose:t.close,parentStore:l,context:M.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})),d=this.environment.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:D.l0,width:"100%"}:void 0;return a()("div",{style:d},void 0,t)}return s.createElement(N.Z,n()({key:"date-filter-value-type"},c,{mobileActionSheet:!0}))}renderExactDateOrigin(e,t,o){const i=this.props.schema[this.props.property],r=i&&"date"===i.type?i.date_format:void 0;let l;if("exact"===e.type&&e.value)if((0,m.J_)(e.value))l=e.value;else if((0,m.gR)(e.value)){const t=(0,m.Gc)(e.value);t&&(l=t.value)}return s.createElement(H.Z,n()({},t,{placeholder:a()(b.FormattedMessage,o?{defaultMessage:"Select a range",id:"database.filterAndSort.dateRangePropertyValue.placeholder"}:{defaultMessage:"Select a date",id:"database.filterAndSort.datePropertyValue.placeholder"}),desktopStyle:{minWidth:165},title:l&&a()("span",{style:{...y.Z.textOverflowStyle}},void 0,a()(U.Z,{value:l,dateFormat:r||m.sF})),disableMargins:!0}))}renderDateRangeFilterOperatorValue(e){const{intl:t,parentStore:o,schema:i,collectionViewId:r,property:l}=this.props;if(!r)return;const c={menuTitle:t.formatMessage(K.dateTitle),items:(0,d.bS)(),getKey:e=>(0,d.eX)(e),selectedItem:e.value,onSelect:t=>{const o={...e,value:t};this.props.onChange(o),S.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})},renderItem:e=>s.createElement(F.Z,n()({title:(0,w.ip)(e.value)},e)),renderOrigin:o=>s.createElement(H.Z,n()({},o,{disableMargins:!0,placeholder:t.formatMessage(K.emptyPlaceholder),title:(0,w.ip)(e.value)}))},p=e.value;if("exact"===p.type){const t=a()(s.Fragment,{},void 0,a()(b.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.dateRange.exact.order",defaultMessage:"{dateValue}",description:"Controls the ordering of the date range filter on databases.",values:{exact:s.createElement(N.Z,n()({key:"date-filter-value-type"},c,{mobileActionSheet:!0})),dateValue:a()(L.Z,{popupType:this.environment.device.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:e=>this.renderExactDateOrigin(p,e,!0),render:t=>a()(M.ZP,{collectionViewId:r,propertyFilter:{property:l,filter:e},schema:i,onChange:e=>{this.props.onChange(e)},onClose:t.close,parentStore:o,context:M.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})),d=this.environment.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:D.l0,width:"100%"}:void 0;return a()("div",{style:d},void 0,t)}return"relative"!==p.type||"custom"!==p.value&&"surrounding"!==p.value?s.createElement(N.Z,n()({key:"date-filter-value-type"},c,{mobileActionSheet:!0})):a()(W.b,{renderAsQueryDropdown:this.environment.device.isMobile,filter:p,onUpdate:t=>{const o={...e,value:t};this.props.onChange(o),S.trackConfigureView(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})}})}renderVerificationOrigin(e,t){const o=e.filter((e=>{let{value:t}=e;return Boolean(t)})).map(w.cq);return s.createElement(H.Z,n()({},t,{disableMargins:!0,placeholder:a()(b.FormattedMessage,{defaultMessage:"Select an option",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.placeholder",description:"Placeholder to select a verification state for filtering."}),title:o.length&&a()("span",{},void 0,(0,g.Z)(o,(e=>a()("span",{style:{whiteSpace:"pre"}},e,a()(b.FormattedMessage,{defaultMessage:", ",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.commaSeparator",description:"Separator between different verification states to include for filtering."})))))}))}getValueDesktopStyle(){return{maxWidth:_.oe}}getValueInnerStyle(e){return{paddingTop:e?6:void 0,overflow:"hidden"}}}function G(e){return window.__c={n:"selectPersonMessage"},a()(b.FormattedMessage,e?{defaultMessage:"Select one person",id:"database.personPropertyValue.selectPerson.searchPlaceholderWithLimit",description:"String to prompt user to select a single person when limit is set."}:{defaultMessage:"Select one or more people",id:"database.personPropertyValue.selectPerson.searchPlaceholder",description:"String to prompt user to select multiple people when limit is not set."})}Y.displayName="CollectionFilterMenuFilterOperatorValue";const X=(0,b.injectIntl)(Y)},56723:(e,t,o)=>{o.d(t,{Qv:()=>xe,ZP:()=>De,Sm:()=>Fe,I4:()=>Le});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(480),u=o(81954),m=o(66897),g=o(76205),h=o(99036),f=o(80951),v=o(84619),y=o(67219),b=o(32918),S=o(31942),w=o(42875),k=o(3779),C=o(89837),_=o(32056),M=o(23014),T=o(21202),I=o(77420),P=o(13493),x=o(29369),B=o(19889),Z=o(70203),E=o(97880),R=o(82990),A=o(4308),D=o(5366),F=o(31299),L=o(28020),V=o(97004),N=o(17335),O=o(26991),U=o(33929),H=o(60709),z=o(98742),W=o(98165),j=o(29376),K=o(22850),Y=o(79315),G=o(61766),X=o(29798),q=o(3815),$=o(12318),J=o(68834),Q=o(28398),ee=o(97180),te=o(64921),oe=o(52275),ie=o(31945),ne=o(12508),re=o(73063),ae=o(68894),se=o(3386),le=o(78140),ce=o(9342),de=o(43765),pe=o(40721),ue=o(44532),me=o(11470),ge=o(77137),he=o(72495),fe=o(14871),ve=o(58032),ye=o(92864),be=o(64369),Se=o(66653),we=o(41209),ke=o(93289),Ce=o(83264),_e=o(78948),Me=o(69265),Te=o(22084),Ie=o(85567),Pe=o(47082);let xe;!function(e){e[e.AdvancedFilter=0]="AdvancedFilter",e[e.PropertyFilter=1]="PropertyFilter"}(xe||(xe={}));const Be=(0,D.defineMessages)({startingMessage:{defaultMessage:"Select or type a date...",id:"search.dateMenu.dateMessage"}}),Ze="50vh";class Ee extends d.Z{constructor(){super(...arguments),this.storeTypes={query:$.default.of(""),menuListStore:X.Z,dateFilterPopupStore:G.Z,dateRangeFilterPopupStore:G.Z},this.renderTextMenu=e=>{const{intl:t}=this.props,{device:o}=this.environment,i=a()(he.Z,{isInput:!0,disableDesktopPadding:!0},void 0,a()(ae.ZP,{focus:!0,focusInitial:!0,focusAfterAnimation:!0,value:(0,g.vR)(e)&&e.value.value?e.value.value:"",onChange:e=>{const t=e.target.value;this.updateValue({type:"exact",value:t})},onClearButtonClick:()=>{this.updateValue({type:"exact",value:void 0})},placeholder:t.formatMessage({defaultMessage:"Type a value…",id:"database.filterValue.textType.searchPlaceholder"}),showClearButton:!0,textWrapperStyle:{marginLeft:8,marginRight:8}})),n=a()(he.Z,{disableMobileBorders:!0,disableMobilePadding:!0},void 0,!o.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&i);let r;return r=o.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose,header:n}:{menuType:H.og.Popup,maxHeight:Ze,width:220,header:n},c.createElement(le.Z,r)},this.renderNumberMenu=e=>{const{intl:t}=this.props,{device:o}=this.environment,i=a()(he.Z,{isInput:!0,disableDesktopPadding:!0},void 0,a()(ae.ZP,{focus:!0,focusInitial:!0,focusAfterAnimation:!0,value:(0,g.vR)(e)&&"number"==typeof e.value.value?e.value.value.toString():"",inputLeft:this.renderNumberOperator(e),onChange:e=>{const t=(0,_.p3)(e.target.value);this.updateValue({type:"exact",value:t})},onClearButtonClick:()=>{this.updateValue({type:"exact",value:void 0})},placeholder:t.formatMessage({defaultMessage:"Type a value…",id:"database.filterValue.numberType.searchPlaceholder"}),showClearButton:!0,textWrapperStyle:{marginLeft:8,marginRight:8}})),n=a()(he.Z,{disableMobileBorders:!0,disableMobilePadding:!0},void 0,!o.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&i);let r;return r=o.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose,header:n}:{menuType:H.og.Popup,maxHeight:Ze,width:220,header:n},c.createElement(le.Z,r)},this.renderUserMenuItem=(e,t)=>{const{device:o}=this.environment,i=Boolean(t.find((t=>{var o;return"exact"===t.type&&(null===(o=t.value)||void 0===o?void 0:o.id)===e.id})));return{key:e.id,render:t=>c.createElement(oe.Z,n()({},t,{title:a()(ye.vw,{isSingle:!0,shouldShrink:!0,format:o.isMobile?ye.vw.Format.Large:ye.vw.Format.Medium,userValue:e,showRemoveButton:!1}),isTokenTitle:!0,checkState:i})),action:()=>{const o=i?t.filter((t=>{var o;return!("exact"===t.type&&(null===(o=t.value)||void 0===o?void 0:o.id)===e.id)})):[...t,{type:"exact",value:{table:B.KJ,id:e.id}}];this.updateValue(o)}}},this.renderBotMenuItem=(e,t)=>{const{device:o}=this.environment,i=Boolean(t.find((t=>{var o;return"exact"===t.type&&(null===(o=t.value)||void 0===o?void 0:o.id)===e.id})));return{key:e.id,render:t=>c.createElement(oe.Z,n()({},t,{title:a()(ye.Jn,{isSingle:!0,shouldShrink:!0,format:o.isMobile?ye.Jn.Format.Large:ye.Jn.Format.Medium,botValue:e,showRemoveButton:!1}),isTokenTitle:!0,checkState:i})),action:()=>{const o=i?t.filter((t=>{var o;return!("exact"===t.type&&(null===(o=t.value)||void 0===o?void 0:o.id)===e.id)})):[...t,{type:"exact",value:{table:I.cZ,id:e.id}}];this.updateValue(o)}}},this.getRelatedCollectionPartial=this.createComputedStore((()=>{const e=this.getFilterAppliedPropertySchema();return e&&(0,h.p_)(e)?{appConfigUri:(0,j.ke)(e,this.props.parentStore),schema:(0,j.uJ)(e,this.props.parentStore)}:{}})),this.renderMoreActionsPopup=e=>{const{allowAddingToCombinatorFilter:t}=this.props,{device:o}=this.environment;let i;i=o.isMobile?{menuType:H.og.ActionSheet}:{menuType:H.og.Popup,maxHeight:Ze};const r=l().compact([{key:"delete",render:e=>c.createElement(oe.Z,n()({},e,{title:a()(D.FormattedMessage,{id:"database.filterValue.deleteFilter.title",defaultMessage:"Delete filter"}),icon:k.Z.trash({width:14})})),action:()=>{var t,o;e.close(),null===(t=(o=this.props).onDelete)||void 0===t||t.call(o)}},t&&{key:"merge",render:e=>a()(ve.Z,{placement:ve.Z.Placement.Right,style:{maxWidth:240,whiteSpace:void 0},renderTooltip:()=>a()("div",{},void 0,a()(Q.ep,{})),render:t=>c.createElement(oe.Z,n()({},(0,z.Z)(e,t),{title:a()(D.FormattedMessage,{id:"database.filterValue.mergeIntoAdvancedFilter.title",defaultMessage:"Add to advanced filter"}),icon:k.Z.filter({width:14})}))}),action:()=>{var t,o;e.close(),null===(t=(o=this.props).onAddToCombinatorFilter)||void 0===t||t.call(o)}}]);return c.createElement(le.Z,i,a()(ce.Z,{type:ce.i.Vertical,sections:[{key:"actions",render:e=>c.createElement(he.Z,n()({disableMobilePadding:!0},e)),items:r}],initialFocus:void 0}))},this.handleClose=e=>{var t,o;null===(t=(o=this.props).onClose)||void 0===t||t.call(o)},this.getPersonAutocompleteResults=async e=>{let{users:t,bots:o}=await F.CO({environment:this.environment,query:e,membersOnly:!1});return t=t.slice(0,20),o=o.slice(0,20),await Promise.all([...t.map((async e=>{let{id:t}=e;const o=(0,q.Kv)(this.props.parentStore,{table:B.KJ,id:t});await o.load()})),...o.map((async e=>{const t=(0,q.Kv)(this.props.parentStore,{table:I.cZ,id:e.id,spaceId:e.space_id});await t.load()}))]),{users:t,bots:o}},this.getRelationAutocompleteResults=async e=>{const{query:t,spaceId:o,collectionId:i}=e;if(!o||!i)return[];const{results:n}=await F.df({environment:this.environment,query:t,collectionId:i,limit:20,spaceId:o,excludeTemplates:!0,source:"relation_menu",includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!1});return 0===n.length?[]:(await Promise.all(n.map((async e=>{const t=(0,q.Kv)(this.props.parentStore,{table:T.iU,id:e});await t.load()}))),n)}}renderComponent(){return a()(se.Z,{capture:!0,onEsc:this.handleClose},void 0,this.renderMenu())}renderMenu(){const{propertyFilter:e,schema:t,parentStore:o}=this.props,{property:i,filter:n}=e,r=(0,g.fI)({schema:t,property:i,getRecordValue:o.getRecordValue}),s=(0,g.ul)(n)?n.subfilter:n;if("text"===r)return(0,g.Ly)(s)&&this.renderTextMenu(s);if("relation"===r)return(0,g.e)(s)&&this.renderRelationRequest(s);if("checkbox"===r)return(0,g.XA)(s)&&this.renderCheckboxMenu(s);if("select"===r||"multi_select"===r)return((0,g.dx)(s)||(0,g.NU)(s))&&this.renderSelectMenu(s);if("status"===r)return(0,g.r2)(s)&&this.renderStatusMenu(s);if("person"===r)return(0,g.Gb)(s)&&this.renderPersonRequest(s);if("number"===r)return(0,g.h6)(s)&&this.renderNumberMenu(s);if("date"===r)return(0,g.gE)(s)&&this.renderDateMenu(s);if("file"===r);else{if("location"===r)return(0,g.Mp)(s)?a()(Ae,{filter:s,parentStore:o,updateValue:e=>this.updateValue(e),onClose:this.props.onClose,desktopTopActions:this.renderDesktopTopActions(),mobileMenuTitle:this.renderMobileMenuTitle(),mobileMoreActions:this.renderMobileMoreActions()}):null;if("verification"===r)return(0,g.Jw)(s)&&this.renderVerificationMenu(s);(0,E.t1)(r)}}renderSelectMenu(e){const{intl:t}=this.props,{device:o}=this.environment,i=this.stores.query.get(),n=this.getFilterAppliedPropertySchema();if(!n||!(0,h.cu)(n))return;const r=n.options||[],s=(0,g.vR)(e)?(0,g.dx)(e)?(0,g.mg)(e):(0,g.qC)(e):[],d=Le({query:i,propertySchema:n,selectedValues:s,updateValue:e=>{this.updateValue(e)},isMobile:o.isMobile,styles:{checkboxIcon:{fill:this.theme.regularIconColor,pointerEvents:"none"}}}),p=s.map((e=>e.value&&a()(Te.Z,{format:o.isMobile?v.l.Large:v.l.Small,isSingle:!1,value:e.value,options:r,showRemoveButton:!0,onClickRemove:()=>{const t=l().without(s,e);this.updateValue(t)}}))),u=a()(Pe.Z,{focus:!o.isMobile||void 0,focusAfterAnimation:!0,format:Pe.Z.Format.FilterValue,tokens:p,placeholder:t.formatMessage({defaultMessage:"Select one or more options…",id:"database.filterValue.selectType.searchPlaceholder"}),onRemoveLastToken:()=>{const e=s.slice(0,s.length-1);this.updateValue(e)},onClearButtonClick:()=>{var e,t;this.updateValue([]),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},value:this.stores.query.get(),onChange:e=>{this.updateInputValue(e.target.value)},dontShowBorderBottom:o.isAndroid,showClearButton:!0}),m=a()(he.Z,{desktopStyle:{paddingBottom:0}},void 0,!o.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&u);let f;return f=o.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose,header:m}:{menuType:H.og.Popup,maxHeight:Ze,width:260,header:m,disableHeaderBorder:!0,tokenInputHeader:!0},c.createElement(le.Z,f,(0,g.vR)(e)&&c.createElement(c.Fragment,null,0===d.length&&a()(he.Z,{},void 0,a()(de.Z,{title:a()(D.FormattedMessage,{defaultMessage:"No results",id:"database.filterValue.selectType.noResults.message"})})),d.length>0&&a()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:[{key:"select",render:e=>c.createElement(he.Z,e),items:d}],store:this.stores.menuListStore,onAccept:()=>{this.updateInputValue("")}})))}renderStatusMenu(e){const{device:t}=this.environment,o=this.getFilterAppliedPropertySchema();if(!o||"status"!==o.type)return;const i=a()(he.Z,{desktopStyle:{paddingBottom:0}},void 0,!t.isMobile&&this.renderDesktopTopActions());let r;r=t.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose,header:i}:{menuType:H.og.Popup,maxHeight:Ze,width:260,header:i,disableHeaderBorder:!0,tokenInputHeader:!0};const s=Fe({propertySchema:o,statusFilterValues:(0,g.vR)(e)?(0,g.wB)(e):[],updateValue:e=>{this.updateValue(e)},isMobile:t.isMobile,styles:{checkboxIcon:{fill:this.theme.regularIconColor}}}),l=a()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:[{key:"groups",items:s,render:e=>c.createElement(he.Z,n()({},e,{title:"",style:{paddingTop:0}}))}]}),d=a()(he.Z,{topBorder:!0},void 0,a()(oe.Z,{title:a()(D.FormattedMessage,{defaultMessage:"Clear selection",id:"database.filterValue.selectType.clearSelection.message",description:"Clear the selection for choosing status filter values"}),focused:!1,onClick:()=>{this.updateValue([])}}));return c.createElement(le.Z,r,(0,g.vR)(e)&&c.createElement(c.Fragment,null,l,d))}renderPersonRequest(e){const t=this.stores.query.get();return a()(ge.Z,{request:t,performRequest:this.getPersonAutocompleteResults,render:(t,o)=>this.renderPersonMenu(e,t,o)})}renderPersonMenu(e,t,o){const{intl:i}=this.props,{device:r}=this.environment,s=this.stores.query.get(),d=this.getFilterAppliedPropertySchema();if(!d)return;const p=(0,g.vR)(e)?(0,g.R8)(e):[],u=l().compact(p.map((e=>{if("exact"===e.type&&e.value){const t=(0,m.Hl)({pointer:e.value,getRecordValue:this.props.parentStore.getRecordValue});return a()(ye.ZP,{actor:t,format:r.isMobile?ye.ZP.Format.Large:ye.ZP.Format.Small,showRemoveButton:!0,onClickRemove:()=>{const t=l().without(p,e);this.updateValue(t)},shouldShrink:!0,isSingle:!1},e.value.id)}if("relative"===e.type&&"me"===e.value&&this.props.allowRelativePersonFilter)return a()(Ie.Z,{format:r.isMobile?v.l.Large:v.l.Small,value:this.renderMeMessage(),onClickRemove:()=>{const t=l().without(p,e);this.updateValue(t)},showRemoveButton:!0,isSingle:!1,shouldShrink:!0,backgroundColor:"transparent",showFullValueTooltip:!0})}))),h=a()(Pe.Z,{focus:!r.isMobile||void 0,focusAfterAnimation:!0,format:Pe.Z.Format.FilterValue,tokens:u,placeholder:i.formatMessage({defaultMessage:"Search for one or more people…",id:"database.filterValue.personType.searchPlaceholder"}),onRemoveLastToken:()=>{const e=p.slice(0,p.length-1);this.updateValue(e)},onClearButtonClick:()=>{var e,t;this.updateValue([]),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},value:this.stores.query.get(),onChange:e=>{this.updateInputValue(e.target.value)},dontShowBorderBottom:r.isAndroid,showClearButton:!0,style:{maxHeight:"20vh",overflowY:"auto"}}),f=a()(he.Z,{},void 0,!r.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&h);let y;y=r.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose,header:f}:{menuType:H.og.Popup,maxHeight:Ze,width:260,header:f,disableHeaderBorder:!0};const b=l().compact((o&&o.users||[]).map((e=>this.renderUserMenuItem(e,p)))),S=["created_by","last_edited_by"].includes(d.type)?l().compact((o&&o.bots||[]).map((e=>this.renderBotMenuItem(e,p)))):[];if(this.props.allowRelativePersonFilter&&o&&(!s||"me".includes(s))){const e=Boolean(p.find((e=>"relative"===e.type&&"me"===e.value)));b.unshift({key:"me",render:t=>c.createElement(oe.Z,n()({},t,{title:this.renderMeMessage(),checkState:e,style:r.isMobile?void 0:{fontSize:14}})),action:()=>{const t=e?p.filter((e=>{let{value:t}=e;return"me"!==t})):[...p,{type:"relative",value:"me"}];this.updateValue(t)}})}const w=[];return b.length>0&&w.push({key:"user property",render:e=>c.createElement(he.Z,n()({desktopStyle:{paddingTop:0}},e)),items:b}),S.length>0&&w.push({key:"bot property",render:e=>c.createElement(he.Z,n()({},e,{title:"Pick a bot"})),items:S}),c.createElement(le.Z,y,(0,g.vR)(e)&&c.createElement(c.Fragment,null,t&&a()(he.Z,{},void 0,a()(de.Z,{title:a()(D.FormattedMessage,{defaultMessage:"Something went wrong.",id:"database.filterValue.personType.searchPersonPropertyMenuItem.errorMessage"})})),0===w.length&&o&&!t&&a()(he.Z,{},void 0,a()(de.Z,{title:a()(D.FormattedMessage,{defaultMessage:"No results",id:"database.filterValue.personType.noResults.message"})})),!o&&!t&&a()(he.Z,{},void 0,a()(_e.Z,{})),w.length>0&&a()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:w,store:this.stores.menuListStore,onAccept:()=>{this.updateInputValue("")}})))}renderCheckboxMenu(e){var t;const{device:o}=this.environment,{context:i}=this.props;let r;r=o.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:H.og.Popup,maxHeight:Ze,width:220,footer:this.renderClearSection(e)};const s=null===(t=e.value)||void 0===t?void 0:t.value;return c.createElement(le.Z,r,i===xe.PropertyFilter&&a()(he.Z,{},void 0,!o.isMobile&&this.renderDesktopTopActions()),a()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:[{key:"select",render:e=>c.createElement(he.Z,n()({style:i===xe.PropertyFilter?{paddingTop:0}:void 0},e)),items:[{key:"unchecked",render:e=>c.createElement(oe.Z,n()({},e,{title:a()(D.FormattedMessage,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"}),isTokenTitle:!0,checkState:!1===s})),action:()=>{this.updateValue({type:"exact",value:!1})}},{key:"checked",render:e=>c.createElement(oe.Z,n()({},e,{title:a()(D.FormattedMessage,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"}),isTokenTitle:!0,checkState:!0===s})),action:()=>{this.updateValue({type:"exact",value:!0})}}]}],store:this.stores.menuListStore,onAccept:this.props.onClose}),o.isMobile&&this.renderClearSection(e))}renderRelationRequest(e){const t=this.stores.query.get(),{currentSpaceStore:o}=Y.default.state,i=this.getFilterAppliedPropertySchema();if(!i||!(0,h.p_)(i)||!o)return;const n=o.id,r=(0,h.F0)(i);return r?a()(ge.Z,{request:{query:t,spaceId:n,collectionId:r},performRequest:this.getRelationAutocompleteResults,render:(t,o)=>this.renderRelationMenu(e,t,o)}):void 0}renderRelationMenu(e,t,o){const{intl:i}=this.props,{device:r}=this.environment,s=this.stores.query.get(),d=this.getFilterAppliedPropertySchema();if(!d||!(0,h.p_)(d))return;const p=(0,h.F0)(d);if(!p)return;const u=(0,g.vR)(e)?(0,g.YO)(e):[],m=l().compact(u.map((e=>{if(!e.value)return;const t={format:r.isMobile?v.l.Large:v.l.Small,shouldWrap:!1,showRemoveButton:!0,isSingle:!1,shouldShrink:!0,onClickRemove:()=>{const t=l().without(u,e);this.updateValue(t)}},o=e.type;if("exact"===o)return c.createElement(Me.Z,n()({key:e.value,blockId:e.value,parentStore:this.props.parentStore},t));if("relative"===o){var i,a;const{appConfigUri:o}=this.getRelatedCollectionPartial.state;if(!o)return;return c.createElement(Ie.Z,n()({value:null===(i=M.qB[o])||void 0===i||null===(a=i[e.value.variable])||void 0===a?void 0:a.formattedMessage,backgroundColor:"transparent",showFullValueTooltip:!0},t))}(0,E.t1)(o)}))),f=a()(Pe.Z,{focus:!r.isMobile||void 0,focusAfterAnimation:!0,format:Pe.Z.Format.FilterValue,tokens:m,placeholder:i.formatMessage({defaultMessage:"Search for one or more pages…",id:"database.filterValue.relationType.searchPlaceholder"}),onRemoveLastToken:()=>{const e=u.slice(0,u.length-1);this.updateValue(e)},onClearButtonClick:()=>{var e,t;this.updateValue([]),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},value:this.stores.query.get(),onChange:e=>{this.updateInputValue(e.target.value)},dontShowBorderBottom:r.isAndroid,style:{maxHeight:"20vh",overflowY:"auto"},showClearButton:!0}),y=a()(he.Z,{desktopStyle:{paddingBottom:0}},void 0,!r.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&f);let b;b=r.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose,header:y}:{menuType:H.og.Popup,maxHeight:Ze,width:260,header:y,disableHeaderBorder:!0};const S=this.getTemplatePageStore();o&&!s&&S&&p&&S.getParentCollectionId()===p&&(o=l().uniq([S.id,...o]));let w=[];if(o){const e=this.getExactRelationMenuItems(o,u);w=((0,g.ul)(this.props.propertyFilter.filter)?[]:this.getRelativeRelationMenuItems(s,u)).concat(e)}return c.createElement(le.Z,b,t&&a()(he.Z,{},void 0,a()(de.Z,{title:a()(D.FormattedMessage,{defaultMessage:"Something went wrong.",id:"database.filterValue.relationType.searchRelationPropertyMenuItem.errorMessage",description:"The search request to populate the relation filter menu returned an error"})})),0===w.length&&o&&!t&&a()(he.Z,{},void 0,a()(de.Z,{title:a()(D.FormattedMessage,{defaultMessage:"No results",id:"database.filterValue.relationType.noResults.message",description:"The search request to populate the relation filter menu returned no results"})})),!o&&!t&&a()(he.Z,{},void 0,a()(_e.Z,{})),w.length>0&&a()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>c.createElement(he.Z,e),items:w}],store:this.stores.menuListStore,onAccept:()=>{this.updateInputValue("")}}))}renderDateMenu(e){const{context:t}=this.props,{device:o}=this.environment;let i;return i=o.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:H.og.Popup,maxHeight:Ze},c.createElement(le.Z,i,t===xe.PropertyFilter&&!o.isMobile&&a()(he.Z,{desktopStyle:{paddingBottom:0}},void 0,this.renderDesktopTopActions()),(0,g.vR)(e)?(0,g.TQ)(e)?this.renderDateRangePicker(e):this.renderDatePicker(e):void 0)}renderDateRangePicker(e){const t=this.getFilterAppliedPropertySchema();if(!t)return;let o;if((0,g.TQ)(e)&&"exact"===e.value.type&&e.value.value){const t=e.value.value;o={starting:t.start_date?{type:"date",start_date:t.start_date}:void 0,ending:t.end_date?{type:"date",start_date:t.end_date}:void 0}}else o=(0,g.TQ)(e)&&"relative"===e.value.type?e.value:{starting:void 0,ending:void 0};const i={disableMenuWrap:!0,title:t.name,value:o,onUpdate:e=>{var t,i;if(e.error)return;const n={...o,...e.value},r=null===(t=n.starting)||void 0===t?void 0:t.start_date,a=null===(i=n.ending)||void 0===i?void 0:i.start_date,s={operator:"date_is_within",value:{type:"exact",value:r||a?{type:"daterange",start_date:r,end_date:a}:void 0}};this.updateFilter(s)},allowRelativeRangeFilter:this.props.allowRelativeDateFilter,relativeRangePopupStore:this.stores.dateRangeFilterPopupStore,onUpdateRelativeFilter:t=>{const o={...e,value:t};this.updateFilter(o)}};return c.createElement(c.Fragment,null,a()(he.Z,{},void 0,c.createElement(Ce.Z,i)))}renderDateInput(e,t){return c.createElement(Se.Z,n()({},t,{placeholder:U.default.formatMessage(Be.startingMessage),focused:"exact"===e.value.type,value:e.value,onUpdate:t=>{var o;if(t.error)return;const i=null===(o=t.value)||void 0===o?void 0:o.start_date,n={...e,value:{type:"exact",value:i?{type:"date",start_date:i}:void 0}};this.updateFilter(n)},inputRight:this.props.allowRelativeDateFilter&&a()(re.Z,{icon:k.Z.chevronDown,iconStyle:{width:12},style:{...!this.environment.device.isMobile&&{height:20,width:20},color:this.theme.mediumIconColor},onClick:()=>{this.stores.dateFilterPopupStore.setState({open:!0})}}),hideClearButton:"relative"===e.value.type||void 0,isRightLastElementOfInput:!0}))}renderDatePicker(e){if(!(0,g.vR)(e))return;const t="exact"===e.value.type?e.value.value:(0,C.Id)(e.value);return!t||(0,b.J_)(t)?c.createElement(c.Fragment,null,a()(he.Z,{},void 0,a()(we.Z,{type:"date",filterValue:e.value,onUpdate:t=>{const o={...e,value:t};this.updateFilter(o)},renderOrigin:t=>this.renderDateInput(e,t),disabled:"exact"===e.value.type&&this.props.allowRelativeDateFilter,buttonPopupStore:this.stores.dateFilterPopupStore})),a()(he.Z,{style:{padding:"0px 14px 14px 14px"}},void 0,a()(ke.Z,{firstDayOfWeek:L.AK.state,value:t?C.OQ.notionDateToLuxon(t).toMillis():Date.now(),onChange:e=>{const t=(0,C.hT)(e,(0,w.r)());this.updateValue({type:"exact",value:t})}}),"relative"===e.value.type&&a()(be.Z,{isSmall:!0,style:{marginLeft:4,marginTop:4}},void 0,a()(D.FormattedMessage,{id:"collectionFilterMenu.dateFilter.relativeDateFilter.description",defaultMessage:"Filter will update with the current date",description:"Filter will change everyday based on the current date"})))):void 0}renderVerificationMenu(e){const{device:t}=this.environment,{context:o}=this.props,i=(0,g.vR)(e)?(0,g.fl)(e):[],r=i.map((e=>{let{value:t}=e;return t})),s=A.zz.map((e=>{const t=r.includes(e);return{key:e,render:o=>c.createElement(oe.Z,n()({icon:a()(ne.Z,{checked:t,size:14,style:{fill:this.theme.regularIconColor,pointerEvents:"none"}}),title:(0,N.cq)({type:"exact",value:e})},o)),action:()=>{if(t)this.updateValue(i.filter((t=>{let{value:o}=t;return o!==e})));else{const t={type:"exact",value:e};this.updateValue([...i,t])}}}}));let l;return l=t.isMobile?{menuType:H.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:a()(pe.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:H.og.Popup,maxHeight:Ze,width:220,footer:this.renderClearSection(e)},c.createElement(le.Z,l,o===xe.PropertyFilter&&a()(he.Z,{},void 0,!t.isMobile&&this.renderDesktopTopActions()),a()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:[{key:"select",render:e=>c.createElement(he.Z,e),items:s}],store:this.stores.menuListStore}))}renderNumberOperator(e){return a()("span",{style:{color:this.theme.lightTextColor}},void 0,(0,N.WC)(e.operator).toLocaleLowerCase())}renderMeMessage(){return a()(D.FormattedMessage,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})}renderClearSection(e){if(!(0,g.yI)(e.value))return a()(he.Z,{topBorder:!0},void 0,a()(oe.Z,{focused:!1,title:a()(D.FormattedMessage,{defaultMessage:"Clear",id:"database.filterValue.clear.message"}),onClick:()=>{var e,t;this.updateValue({type:"exact",value:void 0}),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)}}))}renderDesktopTopActions(){const e=this.props,{propertyFilter:t,schema:o,context:i}=e;if(i!==xe.PropertyFilter)return;const{property:n}=t,r=o[n];return r?a()("div",{style:{display:"flex",color:this.theme.lightTextColor,fontSize:12,marginBottom:6}},void 0,a()("span",{style:{flexShrink:1,marginLeft:8,...R.Z.textOverflowStyle}},void 0,r.name),(0,g.ul)(t.filter)&&this.renderRollupOperatorSelect(),this.renderOperatorSelect(),a()("div",{style:{flexGrow:1}}),this.renderMoreActions()):void 0}renderMobileMenuTitle(){const{propertyFilter:e,schema:t,context:o}=this.props,{property:i}=e,n=t[i];if(n)return o===xe.PropertyFilter?a()("div",{style:{display:"flex"}},void 0,a()("span",{style:{fontWeight:R.Z.fontWeight.medium,flexShrink:1,marginLeft:8,maxWidth:150,...R.Z.textOverflowStyle}},void 0,n.name),(0,g.ul)(e.filter)&&this.renderRollupOperatorSelect(),this.renderOperatorSelect()):n.name}renderMobileMoreActions(){const{context:e}=this.props;if(e===xe.PropertyFilter)return this.renderMoreActions()}renderRollupOperatorSelect(){const{propertyFilter:e,intl:t,onChange:o}=this.props,{filter:i}=e,{device:r}=this.environment;if(!(0,g.ul)(i))return;const s={width:190,items:g.HH,getKey:e=>e,selectedItem:i.operator,onSelect:e=>{null==o||o({...i,operator:e})},renderItem:e=>c.createElement(oe.Z,n()({title:(0,N.SW)(e.value,t)},e)),renderOrigin:e=>c.createElement(te.Z,n()({},e,{style:{marginRight:4,marginLeft:2,paddingLeft:2,paddingRight:2,borderRadius:3,flexShrink:0}}),a()("div",{style:{display:"flex",alignItems:"center",...!r.isMobile&&{color:this.theme.lightTextColor,fontSize:12}}},void 0,a()("span",{style:{marginRight:4}},void 0,(0,N.SW)(i.operator,t).toLocaleLowerCase()),a()(Re,{})))};return c.createElement(fe.Z,n()({},s,{mobileActionSheet:!0}))}renderOperatorSelect(){const{propertyFilter:e,schema:t,parentStore:o}=this.props,{property:i}=e,{device:r}=this.environment,s=(0,g.ul)(e.filter)?e.filter.subfilter:e.filter;if((0,g.ul)(s))return;const l=(0,g.fI)({schema:t,property:i,getRecordValue:o.getRecordValue});let d=(0,g.xm)(l);"status"===l&&(d=d.filter((e=>!(0,g._N)(e))));const p={width:190,items:d,selectedItem:s.operator,getKey:e=>e,onSelect:e=>{const t=(0,N.li)(l,s,e,"propertyFilter");this.updateFilter(t)},renderItem:e=>c.createElement(oe.Z,n()({title:(0,N.WC)(e.value)},e)),renderOrigin:e=>c.createElement(te.Z,n()({},e,{style:{marginRight:4,marginLeft:2,paddingLeft:2,paddingRight:2,borderRadius:3,flexShrink:0}}),a()("div",{style:{display:"flex",alignItems:"center",...!r.isMobile&&{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:12}}},void 0,a()("span",{style:{marginRight:4}},void 0,(0,N.WC)(s.operator).toLocaleLowerCase()),a()(Re,{})))};return c.createElement(fe.Z,n()({},p,{mobileActionSheet:!0}))}renderMoreActions(){const{device:e}=this.environment;return a()(ie.Z,{popupType:this.environment.device.isMobile?ue.kQ.SlideUp:ue.kQ.Popup,render:this.renderMoreActionsPopup,renderOrigin:t=>c.createElement(re.Z,n()({icon:k.Z.dots,style:{...!e.isMobile&&{height:20,width:20,marginRight:8,marginTop:-2}}},t)),style:{width:240},originGap:2,placementToOrigin:ie.Z.Placement.Right,alignmentToOrigin:ie.Z.Alignment.Start})}renderRemoveMenuItem(e){return a()(oe.Z,{focused:!1,title:a()(D.FormattedMessage,{defaultMessage:"Remove filter",id:"database.filterValue.removeFilter.message",description:"Removes database filter"}),onClick:()=>{e()}})}getTemplatePageStore(){const{collectionViewId:e}=this.props;if(!e)return;const t=q.Xr.createChildStore(this.props.parentStore,{table:P.n,id:e}).getParentBlockStore();if(!t)return;const o=(0,W.Dg)(t,1);return o&&o.isTemplate()?o:void 0}getExactRelationMenuItems(e,t){return e.map((e=>{const o={type:"exact",value:e},i=this.getCheckedState(t,o),r=q.G.createChildStore(this.props.parentStore,{table:T.iU,id:e});return{key:e,action:this.getMenuListItemAction(i,t,o),render:e=>c.createElement(me.Z,n()({store:r,checkState:i,hidePath:!0},e))}}))}getRelativeRelationMenuItems(e,t){const{appConfigUri:o,schema:i}=this.getRelatedCollectionPartial.state;if(!o||!(0,O.Sh)(i,o))return[];const r=M.qB[o],a=Object.keys(r);return l().compact(a.map((o=>{if(!e||o.includes(e)){const e={type:"relative",value:{type:"builtin",variable:o}},i=this.getCheckedState(t,e);return{key:o,render:e=>c.createElement(oe.Z,n()({},e,{title:r[o].formattedMessage,checkState:i})),action:this.getMenuListItemAction(i,t,e)}}})))}updateValue(e){const{onChange:t,propertyFilter:o}=this.props,{filter:i}=o;(0,g.ul)(i)?null==t||t({...i,subfilter:{...i.subfilter,value:this.normalizeValue(e)}}):null==t||t({...i,value:this.normalizeValue(e)})}updateFilter(e){const{onChange:t,propertyFilter:o}=this.props,{filter:i}=o;(0,g.ul)(i)?null==t||t({...i,subfilter:e}):null==t||t(e)}getFilterAppliedPropertySchema(){const{schema:e,propertyFilter:t,parentStore:o}=this.props,{property:i}=t,n=e[i];if(!(n&&"rollup"===n.type&&n.relation_property&&n.target_property))return n;{const t=e[n.relation_property];if(t&&(0,h.p_)(t)){const e=(0,h.j0)(t);if(e){const t=o.getRecordValue(e);if(!t)return;const i=(0,h.MY)(t);if(i){const e=i[n.target_property];if(e&&"rollup"!==e.type)return e}}}}}normalizeValue(e){return l().isArray(e)?0===e.length?{type:"exact",value:void 0}:1===e.length?e[0]:e:e}updateInputValue(e){this.stores.query.set(e),this.stores.menuListStore.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}getCheckedState(e,t){return Boolean(e.find((e=>l().isEqual(e,t))))}getMenuListItemAction(e,t,o){return()=>{const i=e?t.filter((e=>!l().isEqual(e,o))):[...t,o];this.updateValue(i)}}}function Re(){const{device:e}=(0,p.O7)();return k.Z.chevronDown({width:10,height:10,...e.isMobile&&{marginTop:2}})}function Ae(e){window.__c={n:"LocationFilterValueMenu"};const{filter:t,parentStore:o,updateValue:i,onClose:r,desktopTopActions:s,mobileMenuTitle:d,mobileMoreActions:m}=e,h=(0,p.O7)(),f=(0,c.useMemo)((()=>(0,g.vR)(t)?(0,g.u0)(t):[]),[t]),b=(0,p.Fy)(),w=(0,u.VK)((()=>l().compact(f.map((e=>{if(!e.value)return;const t=q.NW.createChildStore(o,{table:"collection",id:e.value});return a()(Ie.Z,{format:b.isMobile?v.l.Large:v.l.Small,value:a()(J.Z,{collectionStore:t}),onClickRemove:()=>{const t=l().without(f,e);i(t)},showRemoveButton:!0,isSingle:!1,shouldShrink:!0,backgroundColor:"transparent",showFullValueTooltip:!0},e.value)})))),[f,b.isMobile,o,i]),[k,C]=(0,c.useState)(""),_=(0,D.useIntl)(),M=(0,u.VK)((()=>{var e;return null===(e=Y.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),{success:T,typedCollections:I}=(0,K.Yy)({currentSpaceId:M,environment:h,databaseType:y.iS,parentStore:o}),P=(0,u.qz)(void 0,X.Z),B=(0,c.useCallback)(((e,t)=>{const o=Boolean(t.find((t=>"exact"===t.type&&t.value===e.id)));return{key:e.id,render:t=>c.createElement(oe.Z,n()({},t,{title:a()(J.Z,{collectionStore:e}),isTokenTitle:!0,checkState:o})),action:()=>{const o=l().xorBy(t,[{type:"exact",value:e.id}],(e=>e.value));i(o)}}}),[i]),E=(0,u.VK)((()=>{const e=[],t=(0,S.ZP)(k,I||[],(e=>Z.Q(e.getName()??[]))),i={},r=[];for(const o of t){const e=W.VP(o);e?i[e.id]=[...i[e.id]??[],o]:r.push(o)}for(const[a,s]of Object.entries(i)){const t=q.zX.createChildStore(o,{table:x.e0,id:a});e.push({key:a,items:s.map((e=>B(e,f))),render:e=>c.createElement(he.Z,n()({topBorder:!0},e,{title:c.createElement(c.Fragment,null,t.getName()??"")}))})}return e.push({key:"private",items:r.map((e=>B(e,f))),render:e=>c.createElement(he.Z,n()({topBorder:!0},e,{title:a()(D.FormattedMessage,{id:"collectionFilterValueMenu.privateLocationSection",defaultMessage:"Private",description:"A label for a section in the location filter menu that contains all collections that are private"})}))}),e}),[f,o,k,B,I]),R=a()(Pe.Z,{focus:!b.isMobile||void 0,focusAfterAnimation:!0,format:Pe.Z.Format.FilterValue,tokens:w,placeholder:_.formatMessage({defaultMessage:"Search for one or more locations",id:"database.filterValue.locationType.searchPlaceholder",description:"The placeholder text for a search input to allow searching for databases to filter by in a database"}),onRemoveLastToken:()=>{const e=f.slice(0,f.length-1);i(e)},onClearButtonClick:()=>{i([]),null==r||r()},value:k,onChange:e=>{C(e.target.value)},dontShowBorderBottom:b.isAndroid,showClearButton:!0,style:{maxHeight:"20vh",overflowY:"auto"}}),A=a()(he.Z,{desktopStyle:{paddingBottom:0}},void 0,!b.isMobile&&s,R);let F;return F=b.isMobile?{menuType:H.og.Modal,title:d,left:m,right:a()(pe.DoneMenuText,{}),onClickRight:r,header:A}:{menuType:H.og.Popup,maxHeight:Ze,width:260,header:A,disableHeaderBorder:!0},c.createElement(le.Z,F,(0,g.vR)(t)&&c.createElement(c.Fragment,null,!T&&a()(he.Z,{},void 0,a()(de.Z,{title:a()(D.FormattedMessage,{defaultMessage:"Something went wrong.",id:"database.filterValue.personType.searchPersonPropertyMenuItem.errorMessage"})})),T&&c.createElement(c.Fragment,null,0===(null==I?void 0:I.length)&&a()(he.Z,{},void 0,a()(de.Z,{title:a()(D.FormattedMessage,{defaultMessage:"No results",id:"database.filterValue.selectType.noResults.message"})})),I&&I.length>0&&a()(ce.Z,{type:ce.i.Vertical,initialFocus:0,sections:E,store:P,onAccept:()=>{C("")}}))))}Ee.displayName="CollectionFilterValueMenu";const De=(0,D.injectIntl)(Ee);function Fe(e){const{propertySchema:t,statusFilterValues:o,updateValue:i,isMobile:r,styles:s}=e,l=t.groups??[],d=t.options??[],p=[];for(const u of l){const e=()=>{const e=(0,V.CN)(l,d,o,{type:"is_group",value:u.name});e&&i(e)},t=o.some((e=>"is_group"===e.type&&e.value===u.name)),m=d.filter((e=>{var t;return null===(t=u.optionIds)||void 0===t?void 0:t.includes(e.id)}));let g=!1,h=!0;const y=[];for(const p of m){const e=()=>{const e=(0,V.CN)(l,d,o,{type:"is_option",value:p.value});e&&i(e)},b=o.some((e=>"is_option"===e.type&&e.value===p.value));g||=b,h&&=b,y.push({key:`option-${p.value}`,action:e,render:o=>c.createElement(oe.Z,n()({},o,{icon:a()(ne.Z,{checked:t||b,size:14,onClick:e,style:s.checkboxIcon}),title:a()(Te.Z,{format:r?v.l.Large:v.l.Medium,isSingle:!0,value:p.value,options:m,showRemoveButton:!1,isRound:!0,showColoredDot:(0,f.JR)(p,u)}),style:{paddingLeft:12}}))})}p.push({key:`group-${u.id}`,action:e,render:o=>c.createElement(oe.Z,n()({},o,{icon:a()(ne.Z,{checked:!(!t&&!h)||!!g&&"partial",size:14,onClick:e,style:s.checkboxIcon}),title:a()(ee.r,{group:u})}))},...y)}return p}function Le(e){const{query:t,propertySchema:o,selectedValues:i,updateValue:r,isMobile:s,styles:l}=e,d=o.options||[];return(t?(0,S.ZP)(t,d,(e=>e.value)):d).map((e=>{const t=Boolean(i.find((t=>t.value===e.value)));return{key:e.value,render:o=>c.createElement(oe.Z,n()({icon:a()(ne.Z,{onClick:o.onClick,checked:t,size:14,style:l.checkboxIcon}),title:a()(Te.Z,{format:s?v.l.Large:v.l.Medium,isSingle:!0,value:e.value,options:d,showRemoveButton:!1}),isTokenTitle:!0},o)),action:()=>{const o=t?i.filter((t=>{let{value:o}=t;return o!==e.value})):[...i,{type:"exact",value:e.value}];r(o)}}}))}},38769:(e,t,o)=>{o.d(t,{Z:()=>j});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(66897),d=o(14714),p=o(99036),u=o(80951),m=o(84619),g=o(42875),h=o(3779),f=o(61784),v=o(89837),y=o(32056),b=o(23014),S=o(97880),w=o(82990),k=o(5366),C=o(29637),_=o(26991),M=o(78316),T=o(84210),I=o(33929),P=o(29376),x=o(79315),B=o(61766),Z=o(3815),E=o(68500),R=o(97180),A=o(64921),D=o(31945),F=o(12508),L=o(84076),V=o(31278),N=o(76798),O=o(58032),U=o(92864),H=o(69265),z=o(22084);class W extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:B.Z},this.renderEditPopup=()=>{const{schema:e,currentGroups:t,groupBy:o,groupFormat:i}=this.props,n=this.groupParentStore.state;if(n)return a()(E.Z,{groupFormat:i,groupBy:o,currentGroups:t,schema:e,onChange:e=>{var t,o;this.stores.buttonPopupStore.reset(),null===(t=(o=this.props).onChange)||void 0===t||t.call(o,e)},onClose:()=>{var e,t;this.stores.buttonPopupStore.reset(),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},parentStore:n})},this.groupParentStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.groupUiParentStore})),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.groupParentStore.state,i=e[t.property];if(i&&(0,p.p_)(i)&&o)return(0,P.ke)(i,o)}))}renderComponent(){const{groupFormat:e,schema:t,isHiddenGroup:o}=this.props,i=e.value,n=void 0===i.value,r=t[e.property];if(!r)return;const{name:s}=r;if(n)return o?this.renderUncategorizedLabel():a()(O.Z,{renderTooltip:()=>a()(k.FormattedMessage,{defaultMessage:"Any items with an empty <b>{name}</b> property will go here. This group cannot be removed.",values:{name:s,b:e=>a()("span",{style:{fontWeight:w.Z.fontWeight.semibold}},void 0,e)},id:"database.boardView.uncategorizedColumnTooltip"}),style:{width:240},textWrap:!0,render:e=>this.renderUncategorizedLabel(e)});if("select"===i.type||"multi_select"===i.type)return this.renderSelectValue();if("status"===i.type)return this.renderStatusValue();if((0,d.pd)(i.type))return this.renderPersonValue(i);if("relation"===i.type)return this.renderRelationValue(i);if("location"===i.type)return this.renderLocationValue(i);if((0,d.A1)(i.type))return this.renderDateValue(i);if((0,d.HB)(i.type))return this.renderTextValue(i);if("number"===i.type)return this.renderNumberValue(i,"number"===r.type?r:void 0);if("checkbox"===i.type)return this.renderCheckboxValue(i);if("formula"===i.type){if("formula"!==i.type)return;const e=i.value;if(!e)return;if((0,d.HB)(e.type))return this.renderTextValue(e);if("number"===e.type)return this.renderNumberValue(e);if("checkbox"===e.type)return this.renderCheckboxValue(e);if("date"===e.type)return this.renderDateValue(e);(0,S.t1)(e.type)}(0,S.t1)(i.type)}renderUncategorizedLabel(e){const{schema:t,groupFormat:o}=this.props,i=t[o.property];if(!i)return;const{name:r}=i;return s.createElement("div",n()({style:{...W.uncategorizedLabelStyle,paddingLeft:0,...this.props.style}},e),h.Z.collectionInbox({width:14,marginLeft:6,marginRight:6,...this.props.uncategorizedIconStyle}),a()("span",{style:{...w.Z.textOverflowStyle}},void 0,a()(k.FormattedMessage,{defaultMessage:"No {name}",values:{name:r},id:"database.boardView.uncategorizedColumnTitle"})))}renderSelectValue(){const{groupFormat:e,schema:t}=this.props,o=t[e.property];if(!o||!p.cu(o))return;const i=o.options||[],r=e.value;if(r.type!==o.type)return;const{value:l}=r;return l?a()(D.Z,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?D.Z.PopupType.SlideUp:D.Z.PopupType.Popup,originGap:4,renderOrigin:e=>s.createElement(A.Z,n()({style:{...W.personTokenStyle,...this.props.style},disabled:this.props.disabled},e),a()(z.Z,{format:m.l.Medium,isSingle:!0,value:l,options:i,showRemoveButton:!1}))}):void 0}renderStatusValue(){const{groupFormat:e,schema:t}=this.props,o=t[e.property];if(!o||"status"!==o.type)return;const i=e.value;if(i.type!==o.type)return;const{value:n}=i;if(!n)return;const r=o.options??[],s=o.groups??[];if("by_group"===n.type){const e=s.find((e=>e.name===n.group));return e&&a()(R.r,{group:e,style:{fontWeight:500},showIcon:!0,showColor:!0})}if("by_option"===n.type){const e=r.find((e=>e.value===n.option)),t=e&&s.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)}));return e&&a()("span",{style:{fontWeight:500}},void 0,a()(z.Z,{format:m.l.Medium,isSingle:!0,value:e.value,options:r,showRemoveButton:!1,isRound:!0,showColoredDot:(0,u.JR)(e,t)}))}(0,S.t1)(n)}renderPersonValue(e){if(!(0,d.q6)(e))return;const{value:t}=e;if(!t)return;const o=this.groupParentStore.state;if(!o)return;const i=(0,c.Hl)({pointer:t,getRecordValue:o.getRecordValue});return i.value?a()(D.Z,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?D.Z.PopupType.SlideUp:D.Z.PopupType.Popup,originGap:4,renderOrigin:e=>s.createElement(A.Z,n()({style:{...W.personTokenStyle,...this.props.style},disabled:this.props.disabled},e),a()(U.ZP,{format:U.ZP.Format.Medium,actor:i,showRemoveButton:!1,isSingle:!0,disableAvatarTooltip:this.props.isHiddenGroup,shouldShrink:!0}))}):void 0}renderLocationValue(e){const t=this.groupParentStore.state;if("location"!==e.type)return;if(!e.value)return;if(!t)return;const o=Z.NW.createChildStore(t,e.value);return s.createElement(s.Fragment,null,a()(V.Z,{disabled:!0,icon:o.getIcon(),size:20,isEmptyPage:!1,style:{marginTop:2,marginRight:6}}),a()(N.Z,{store:o,underline:!0,style:{fontWeight:w.Z.fontWeight.medium}}))}renderRelationValue(e){const{schema:t,groupFormat:o,collectionContextStore:i}=this.props,n=this.groupParentStore.state;if(!n)return;if("relation"!==e.type)return;const r=t[o.property];if(!r||"relation"!==r.type)return;const l=p.j0(r);if(!l)return;const c=Z.NW.createChildStore(n,l);if(c.isDefined()&&e.value){if((0,d.t2)(e.value)){var u;const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;const o=I.default.formatMessage(C.sY.tasksCurrentSprintV2ViewNamePrefix),r=I.default.formatMessage(C.sY.tasksNextSprintV2ViewNamePrefix),d=e.value.value.variable,p=null===(u=b.qB[t])||void 0===u?void 0:u[d];if(null!=c&&c.isDefined()){const e=(0,_.As)(i,d,l,c);if(!e)return a()("div",{style:{fontWeight:w.Z.fontWeight.medium}},void 0,null==p?void 0:p.formattedMessage);const{mainEditorCurrentBlockStore:t}=x.default.state,u=M.mb({store:e,mainEditorCurrentBlockStore:t,collectionContextStore:i})??(0,T.ZP)({store:e});if(e)return s.createElement(s.Fragment,null,a()("div",{style:{fontWeight:w.Z.fontWeight.medium,marginBottom:.25}},void 0,"current"===d?o:r,":"),a()(L.Z,{style:{...this.props.style,marginLeft:1},innerStyle:{...W.personTokenStyle},href:u},void 0,a()(H.Z,{format:U.ZP.Format.Medium,blockId:e.id,isSingle:!0,shouldShrink:!0,parentStore:n})))}return a()("div",{style:{fontWeight:w.Z.fontWeight.medium,marginBottom:.25}},void 0,null==p?void 0:p.formattedMessage)}if((0,d.RA)(e.value)){const t=Z.G.createChildStore(n,e.value),{mainEditorCurrentBlockStore:o}=x.default.state,r=M.mb({store:t,mainEditorCurrentBlockStore:o,collectionContextStore:i})??(0,T.ZP)({store:t});return a()(L.Z,{style:this.props.style,innerStyle:{...W.personTokenStyle},href:r},void 0,a()(H.Z,{format:U.ZP.Format.Medium,blockId:e.value.id,isSingle:!0,shouldShrink:!0,parentStore:n}))}}}renderDateValue(e){if((0,d.Mc)(e)&&e.value)return a()("div",{style:{...W.personTokenStyle,...w.Z.textOverflowStyle,...this.props.style}},void 0,this.renderDateGroupValue(e.value))}renderDateGroupValue(e){if("today"===e.type)return a()(k.FormattedMessage,{defaultMessage:"Today",id:"database.collectionGroupValue.dateGroup.today"});if("yesterday"===e.type)return a()(k.FormattedMessage,{defaultMessage:"Yesterday",id:"database.collectionGroupValue.dateGroup.yesterday"});if("last_7_days"===e.type)return a()(k.FormattedMessage,{defaultMessage:"Last 7 days",id:"database.collectionGroupValue.dateGroup.last7Days"});if("last_30_days"===e.type)return a()(k.FormattedMessage,{defaultMessage:"Last 30 days",id:"database.collectionGroupValue.dateGroup.last_30Days"});if("tomorrow"===e.type)return a()(k.FormattedMessage,{defaultMessage:"Tomorrow",id:"database.collectionGroupValue.dateGroup.tomorrow"});if("next_7_days"===e.type)return a()(k.FormattedMessage,{defaultMessage:"Next 7 days",id:"database.collectionGroupValue.dateGroup.next7Days"});if("next_30_days"===e.type)return a()(k.FormattedMessage,{defaultMessage:"Next 30 days",id:"database.collectionGroupValue.dateGroup.next30Days"});if("day"===e.type){const t=(0,v.NK)(e.range,(0,g.r)(),this.props.intl.locale);return(0,f.ZW)(t.start,"medium")}if("week"===e.type){const t=(0,v.NK)(e.range,(0,g.r)(),this.props.intl.locale),o=(0,f.ZW)(t.start,"month_short"),i=(0,f.ZW)(t.start,"day"),n=t.start.year,r=(0,f.ZW)(t.end,"month_short"),s=(0,f.ZW)(t.end,"day"),l=t.end.year;return a()(k.FormattedMessage,n!==l?{defaultMessage:"Week of {startMonth} {startDay} {startYear} - {endMonth} {endDay} {endYear}",id:"database.collectionGroupValue.dateGroup.week.differingStartAndEndYear",values:{startMonth:o,startDay:i,endMonth:r,endDay:s,startYear:n,endYear:l}}:o!==r?{defaultMessage:"Week of {startMonth} {startDay} - {endMonth} {endDay} {startYear}",id:"database.collectionGroupValue.dateGroup.week.differingStartAndEndMonth",values:{startMonth:o,startDay:i,endMonth:r,endDay:s,startYear:n}}:{defaultMessage:"Week of {startMonth} {startDay}-{endDay} {startYear}",id:"database.collectionGroupValue.dateGroup.week.sameStartAndEndMonth",values:{startMonth:o,startDay:i,endDay:s,startYear:n}})}if("month"===e.type){const t=(0,v.NK)(e.range,(0,g.r)(),this.props.intl.locale);return(0,f.ZW)(t.start,"month_year_short")}if("year"===e.type){return(0,v.NK)(e.range,(0,g.r)(),this.props.intl.locale).start.year.toString()}(0,S.t1)(e)}renderTextValue(e){if((0,d.R7)(e)&&void 0!==e.value){const t=this.renderTextGroupValue(e.value);return"exact"===e.value.type?a()(D.Z,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?D.Z.PopupType.SlideUp:D.Z.PopupType.Popup,originGap:4,renderOrigin:e=>s.createElement(A.Z,n()({style:{...W.selectStyle,...w.Z.textOverflowStyle,...this.props.style},disabled:this.props.disabled},e),t)}):a()("div",{style:W.selectStyle},void 0,t)}}renderTextGroupValue(e){return"other"===e.type?a()(k.FormattedMessage,{defaultMessage:"Other",id:"database.collectionGroupValue.textGroup.other"}):"alphabet_prefix"===e.type||"exact"===e.type?e.value:void(0,S.t1)(e)}renderNumberValue(e,t){if("number"!==e.type||!e.value)return;const o=(null==t?void 0:t.number_format)||y.dk;return a()("div",{style:{...W.personTokenStyle,...this.props.style}},void 0,this.renderNumberGroupValue(e.value,o))}renderNumberGroupValue(e,t){if("out_of_range"===e.type)return a()(k.FormattedMessage,{defaultMessage:"Out of range",id:"database.collectionGroupValue.numberGroup.outOfRange"});if("range"===e.type){const o=y.uf(e.start,t,this.props.intl),i=y.uf(e.end,t,this.props.intl);return a()(k.FormattedMessage,{defaultMessage:"{start} to {end}",id:"database.collectionGroupValue.numberGroup.range",values:{start:o,end:i}})}(0,S.t1)(e)}renderCheckboxValue(e){if("checkbox"===e.type)return a()("div",{style:{...W.checkboxStyle,...this.props.style}},void 0,a()(F.Z,{checked:e.value,size:14,disabled:!0}))}}W.displayName="CollectionGroupValue",W.selectStyle={overflow:"hidden",padding:3,borderRadius:3,fontWeight:w.Z.fontWeight.medium},W.personTokenStyle={overflow:"hidden",padding:3,paddingRight:6,borderRadius:3,fontWeight:w.Z.fontWeight.medium},W.checkboxStyle={padding:3,paddingRight:6},W.uncategorizedLabelStyle={display:"flex",alignItems:"center",fontSize:14,lineHeight:1.2,paddingLeft:2,paddingRight:4,whiteSpace:"nowrap",overflow:"hidden",fontWeight:w.Z.fontWeight.medium};const j=(0,k.injectIntl)(W)},68834:(e,t,o)=>{o.d(t,{Z:()=>l});var i=o(77094),n=o.n(i),r=(o(67294),o(81954)),a=o(31278),s=o(76798);const l=function(e){window.__c={n:"CollectionLocationToken"};const{collectionStore:t}=e,o=(0,r.VK)((()=>t.getIcon()),[t]);return n()("div",{style:{display:"flex",columnGap:4,alignItems:"center"}},void 0,n()(a.Z,{disabled:!0,icon:o,isEmptyPage:!1,size:20}),n()(s.Z,{store:t,style:{maxWidth:180}}))}},81870:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(3779),s=o(50906),l=o(73063),c=o(16354);class d extends r.Z{renderComponent(){return n()(c.Z,{href:this.props.href,external:!0,onClick:()=>s.trackClickHelpButton(this.environment,{from:this.props.helpButtonContext})},void 0,n()(l.Z,{icon:a.Z.help,style:{height:24,width:24,marginRight:-6,fill:this.theme.mediumIconColor}}))}}d.displayName="CollectionMenuHelpButton";const p=d},31339:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(77094),n=o.n(i),r=(o(67294),o(83355));class a extends r.Z{renderComponent(){const e=this.environment.device.isMobile?a.mobileStyle:a.desktopStyle;return n()("div",{style:e},void 0,this.props.icon(this.props.styles))}}a.displayName="CollectionMenuIcon",a.desktopStyle={width:16},a.mobileStyle={width:16};const s=a},75498:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(96486),n=o.n(i),r=o(83355),a=o(1302),s=o(71644),l=o(97880),c=o(64434),d=o(12318);class p extends r.Z{constructor(){super(...arguments),this.reducerId=this.props.id,this.instanceId=(0,s.ZP)(),this.localResultStoreChangeIsQueued=!1,this.storeTypes={resultStore:d.default.of(void 0)},this.handleLocalResultStoreChange=()=>{this.localResultStoreChangeIsQueued||(this.localResultStoreChangeIsQueued=!0,a.default.afterNextFlush(this.dequeueLocalResultStoreChange))},this.dequeueLocalResultStoreChange=()=>{const{resultStore:e}=this.stores;if(this.localResultStoreChangeIsQueued=!1,!this.componentIsMounted)return;const t=this.getCurrentResult();n().isEqual(t,e.get())||e.set(t)}}willMount(e){const{collectionContextStore:t}=e;t.remoteResult.addListener(this.handleLocalResultStoreChange),t.localResultStore.addListener(this.handleLocalResultStoreChange),this.updateReducer(e),this.handleLocalResultStoreChange()}willUpdate(e){this.updateReducer(e)}willUnmount(){super.willUnmount();const{collectionContextStore:e}=this.props;c.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:void 0,collectionContextStore:e}),e.remoteResult.removeListener(this.handleLocalResultStoreChange),e.localResultStore.removeListener(this.handleLocalResultStoreChange)}renderComponent(){const{render:e}=this.props;if(e)return e(this.stores.resultStore)}updateReducer(e){const{reducer:t,collectionContextStore:o}=e;c.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:t,collectionContextStore:o})}getCurrentResult(){const{collectionContextStore:e}=this.props,t=e.localResultStore.state,o=e.remoteResult.state,i=t&&"reducer"===t.type?t.reducerResults[this.reducerId]:void 0,n=o&&"reducer"===o.type?o.reducerResults[this.reducerId]:void 0;return this.getResultFromLocalAndRemote(i,n)}getResultFromLocalAndRemote(e,t){const{collectionContextStore:o,reducer:i}=this.props,r=o.reducers.state,a=o.remoteResult.state;if("aggregation"===i.type||"groups"===i.type){if(null!=a&&a.reducerResults[this.reducerId])return a.reducerResults[this.reducerId];return Boolean(a&&"reducer"===a.type&&n().find(a.reducerResults,((e,t)=>{const o=r[t];return Boolean(o&&"results"===o.reducer.type&&!o.reducer.searchQuery&&"results"===e.type&&e.hasMore&&n().isEqual(i.filter,o.reducer.filter))})))?e:t}if("results"===i.type){const i=o.wasCreatedThisSession.get();if((Boolean(a&&"reducer"===a.type&&a.reducerResults[this.reducerId])||i)&&e&&"results"===e.type){return{...e,hasMore:t&&"results"===t.type?t.hasMore:e.hasMore}}return t}throw(0,l.t1)(i)}}p.displayName="CollectionReducerRequest";const u=p},22323:(e,t,o)=>{o.d(t,{H:()=>Ss,Z:()=>ks});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(83355),c=o(4615),d=o(5366),p=o(50906),u=o(5149),m=o(96802),g=o(30149),h=o(12534),f=o(28187),v=o(34859),y=o(58421),b=o(36857),S=o(27788),w=o(1302),k=o(480),C=o(81954),_=o(24405),M=o(3779),T=o(77162),I=o(16956),P=o(31869),x=o(54281),B=o(61338),Z=o(33929),E=o(60709),R=o(29376),A=o(61766),D=o(80072),F=o(13005),L=o(42917),V=o(61053),N=o(31945),O=o(78140),U=o(44532),H=o(72495),z=o(69872);function W(e){window.__c={n:"CollectionSettingsViewDefaultPropertyPopup"};const{menuProps:t,property:o,defaultProperty:i,checkState:r,propertySchema:l,collectionContextStore:c,handleDefaultPropertySelect:d,handlePropertySelect:p}=e,u=(0,k.Fy)(),m=(0,C.VK)((()=>c.permissionScopes.state),[c]);return n()(N.Z,{popupType:u.isPhone?U.kQ.SlideUp:U.kQ.Popup,alignmentToOrigin:N.Z.Alignment.End,placementToOrigin:N.Z.Placement.Bottom,originGap:0,renderOrigin:e=>s.createElement(z.Z,a()({},t,e,{disabled:!m.canConfigureBlock,propertySchema:l,format:z.Z.DisplayFormat.Name,right:n()(j,{property:o,defaultProperty:i,checkState:r,collectionContextStore:c})})),render:e=>n()(K,{parent:e,property:o,collectionContextStore:c,handleDefaultPropertySelect:d,handlePropertySelect:p})})}function j(e){window.__c={n:"DefaultCheck"};const{property:t,defaultProperty:o,checkState:i,collectionContextStore:r}=e,a=(0,k.O7)(),s=(0,C.VK)((()=>{var e,t;return null===(e=r.collectionStore())||void 0===e||null===(t=e.getName())||void 0===t?void 0:t.toString()}),[r]),l=(0,_.yK)((e=>({defaultText:{color:e.mediumTextColor,fontSize:12,fontWeight:500,textTransform:"uppercase",marginRight:4}})),[]);return n()("div",{style:{display:"flex",justifyContent:"space-between"}},void 0,n()("div",{style:{...l.defaultText}},void 0,t===o&&n()(d.FormattedMessage,{defaultMessage:"Default",id:"database.viewSettings.setViewPropertyDefault.defaultProperty.tag",description:"Tag on the property list to show that this property has been set as the default for all views",values:{databaseName:s}})),i&&n()("div",{style:{...a.device.isPhone?{marginLeft:"auto",marginRight:20,minWidth:0,flexShrink:0}:{marginLeft:"auto",marginRight:12,minWidth:0,flexShrink:0},width:a.device.isPhone?16:14,flexShrink:0}},void 0,M.Z.thinCheck()))}function K(e){window.__c={n:"PropertySelectPopup"};const{parent:t,property:o,collectionContextStore:i,handleDefaultPropertySelect:r,handlePropertySelect:l}=e,c=(0,k.Fy)(),p=(0,C.VK)((()=>i.permissionScopes.state),[i]),u=(0,C.VK)((()=>{var e,t;return null===(e=i.collectionStore())||void 0===e||null===(t=e.getName())||void 0===t?void 0:t.toString()}),[i]);let m;return m=c.isPhone?{menuType:E.og.ActionSheet}:{menuType:E.og.Popup,width:300},s.createElement(O.Z,a()({},m,{footer:n()(H.Z,{topBorder:!0},void 0,p.canConfigureCollection&&s.createElement(s.Fragment,null,n()(L.Z,{isGray:!0,title:n()(d.FormattedMessage,{defaultMessage:"Set on all new {databaseName} views",id:"database.viewSettings.setViewPropertyDefault.allDefaultButton.title",description:"Title for setting this property as default for all views",values:{databaseName:u}}),onClick:()=>{r(o),t.close()}}),n()(L.Z,{title:n()(d.FormattedMessage,{id:"database.viewSettings.setViewPropertyDefault.setProperty.title",defaultMessage:"Set on this view",description:"Button title for setting this property to be only on this view"}),isGray:!0,onClick:()=>{l(o),t.close()}})))}))}var Y=o(68894),G=o(89728),X=o(65742),q=o(26647);function $(e){const{propertyName:t}=e,o=(0,_.yK)((e=>({dependenciesPreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112,paddingLeft:19},svgContainer:{position:"absolute",width:"100%",height:"100%"},svgArrowTheme:{stroke:e.accentColors.yellow[300],strokeWidth:X.lf},dependencyPropertyNamePreview:{fontSize:12,position:"absolute",background:e.buttonBackground,top:48,left:96},timelineItemPreview:{padding:4,margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderRadius:5,..."light"===e.mode?{boxShadow:e.buttonBoxShadow}:{boxShadow:e.lightBoxShadow},width:100,justifyContent:"center"}})),[]);return s.createElement(s.Fragment,null,n()(H.Z,{},void 0,n()("div",{style:o.dependenciesPreviewOutsideBorder},void 0,n()("svg",{style:o.svgContainer},void 0,n()(q.Z,{startPoint:{x:110,y:25},endPoint:{x:110,y:87},direction:q.n.right,style:o.svgArrowTheme,showArrowHead:!0}),n()(q.Z,{startPoint:{x:210,y:87},endPoint:{x:223,y:87},direction:q.n.right,style:o.svgArrowTheme,showArrowHead:!1}),n()("circle",{cx:223,cy:87,r:X.Wk,style:o.svgArrowTheme,fill:"#ffffff"})),n()("div",{style:o.dependencyPropertyNamePreview},void 0,t),n()("div",{style:{...o.timelineItemPreview,marginTop:10,marginLeft:10}},void 0,n()("span",{},void 0,"🌱")),n()("div",{style:{...o.timelineItemPreview,marginTop:34,marginLeft:111}},void 0,n()("span",{},void 0,"🌳")))))}var J=o(5210);function Q(e){const{propertyName:t,inversePropertyName:o}=e,i=(0,_.yK)((e=>({togglePreviewParentIcon:{color:e.regularIconColor,marginRight:"4"},togglePreviewChildIcon:{color:e.mediumIconColor,marginLeft:"24px",marginRight:"4"},togglePreviewRowWithDivider:{padding:"4px",margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderBottom:`1px solid ${e.regularDividerColor}`},togglePreviewRow:{padding:"4px",margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center"},togglePreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:"4px",alignItems:"center"}})),[]);return s.createElement(s.Fragment,null,n()(H.Z,{},void 0,n()("div",{style:i.togglePreviewOutsideBorder},void 0,n()("div",{style:i.togglePreviewRowWithDivider},void 0,n()(J.Z,{isSidebar:!1,open:!0,fill:!0,onClick:()=>{},style:i.togglePreviewParentIcon,disabled:!0}),n()("span",{},void 0,"🐔"),n()("div",{style:{marginLeft:"5px"}},void 0,o)),n()("div",{style:i.togglePreviewRowWithDivider},void 0,n()(J.Z,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:i.togglePreviewChildIcon,disabled:!0}),n()("span",{},void 0,"🐣"),n()("div",{style:{marginLeft:"5px"}},void 0,t)),n()("div",{style:i.togglePreviewRow},void 0,n()(J.Z,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:i.togglePreviewChildIcon,disabled:!0}),n()("span",{},void 0,"🐣"),n()("div",{style:{marginLeft:"5px"}},void 0,t)))))}const ee=(0,d.defineMessages)({subitemInputPlaceholder:{defaultMessage:"Sub-tasks…",id:"database.viewSettings.relationsPropertyTab.subitemInputPlaceholder",description:"Placeholder text for the property search input in nest menu"},timelineArrowsByInputPlaceholder:{defaultMessage:"Dependencies…",id:"database.viewSettings.relationsPropertyTab.timelineArrowsByInputPlaceholder",description:"Placeholder text for the property search input in dependencies arrow menu"}});const te=(0,d.injectIntl)((function(e,t){window.__c={n:"CollectionSettingsViewRelationsProperty"};const{collectionContextStore:o,collectionSettingsStore:i,formatSetting:r}=e,l=(0,k.Fy)(),c=(0,d.useIntl)(),p=(0,k.O7)(),m="collection_page_properties",[h]=(0,s.useState)("no_limit"),f="subitem"===r,v="timeline_arrows_by"===r,y=(0,C.VK)((()=>o.normalizedSchemaStore.state),[o]),b=(0,C.VK)((()=>o.collectionStore()),[o]),S=(0,C.VK)((()=>(null==b?void 0:b.getFormat())??{}),[b]),z=(0,C.VK)((()=>{var e;return f?null===(e=o.currentSubitemFormatStore.state)||void 0===e?void 0:e.property:v?o.currentArrowsByFormatStore.state:void 0}),[o,f,v]),j=(0,C.VK)((()=>{var e,t,i,n;return f?null===(e=o.collectionStore())||void 0===e||null===(t=e.getFormat())||void 0===t?void 0:t.collection_default_subitem:v?null===(i=o.collectionStore())||void 0===i||null===(n=i.getFormat())||void 0===n?void 0:n.collection_default_arrows_by:void 0}),[o,f,v]),K=(0,C.VK)((()=>o.permissionScopes.state),[o]),X=(0,C.VK)((()=>R.NA(o,y)),[o,y]),q=(0,C.VK)((()=>o.normalizedSchemaStore.state),[o]),J=(0,C.VK)((()=>{var e;const t=o.currentSubitemFormatStore.state,i=o.currentArrowsByFormatStore.state;let n;return f?n=t?y[t.property]:void 0:v&&(n=i?y[i]:void 0),null===(e=n)||void 0===e?void 0:e.name}),[o,y,f,v]),te=(0,C.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?R.m8(c,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:q,createUnique:!0,from:r}):c.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target",description:"Placeholder for relation name if no target database selected"})}),[o,q,c,r]),[oe,ie]=(0,s.useState)(J||te),ne=oe===te,re=(0,C.VK)((()=>{const e=o.currentSubitemFormatStore.state,t=o.currentArrowsByFormatStore.state;let i;if(f?i=e?y[e.property]:void 0:v&&(i=t?y[t]:void 0),i&&"relation"===i.type){var n;const e=i.property;return e?null===(n=y[e])||void 0===n?void 0:n.name:void 0}}),[o,y,f,v]),ae=(0,C.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?R.aI(c,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:r}):c.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database",description:"Placeholder for inverse relation name if no target database selected"})}),[o,c,r]),[se,le]=(0,s.useState)({hasInverseRelation:!0,inverseName:re,autoRelate:{enabled:!1}}),[ce,de]=(0,s.useState)(0===X.length),pe=(0,C.qz)(void 0,A.Z),ue=(0,C.Kw)(pe),me=(0,s.useCallback)((()=>R.NA(o,y)),[o,y]),ge=(0,s.useCallback)((e=>{if(e){const t=y[e];if(t&&"relation"===t.type){const e=t.property;if(e){const t=y[e];if(t&&se){const e=t.name;le({hasInverseRelation:null==se?void 0:se.hasInverseRelation,inverseName:e,autoRelate:null==se?void 0:se.autoRelate})}}ie(t.name)}}}),[y,se,ie]),he=(0,s.useCallback)((e=>{const{collectionViewStore:t,newProperty:o,transaction:i}=e;f?B.dR({collectionViewStore:t,propertyID:o,transaction:i}):v&&x.tF({collectionViewStore:t,newProperty:o,transaction:i})}),[f,v]),fe=(0,s.useCallback)((e=>{const{relationPropertyId:t,transaction:i}=e;f&&B.jA({collectionContextStore:o,relationPropertyId:t,transaction:i}),v&&x._p({collectionContextStore:o,relationPropertyId:t,transaction:i})}),[o,f,v]),ve=(0,s.useCallback)((e=>{const t=o.collectionViewStore();t&&(g.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:p,perform:o=>{he({collectionViewStore:t,newProperty:e,transaction:o}),fe({relationPropertyId:e,transaction:o})}}),ge(e),de(!1),u.E3({collectionSettingsStore:i}),T.wd({action:f?"update_default_subitem":"update_default_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:p,collectionContextStore:o}))}),[o,p,de,ge,i,f,he,fe]),ye=(0,s.useCallback)((e=>{const t=o.collectionViewStore();t&&(g.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:p,perform:o=>{he({collectionViewStore:t,newProperty:e,transaction:o})}}),ge(e),de(!1),u.E3({collectionSettingsStore:i}),T.wd({action:f?"update_subitem":"update_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:p,collectionContextStore:o}))}),[o,p,ge,i,f,he]),be=(0,s.useCallback)((()=>{w.default.afterNextFlush((()=>{de(!0),le({hasInverseRelation:!0,inverseName:ae,autoRelate:{enabled:!1}}),ie(te)}))}),[ae,te]),Se=(0,s.useCallback)((()=>{if(!se)return;const{hasInverseRelation:e,inverseName:t,autoRelate:n}=se,a=o.collectionStore(),s=a,l=o.collectionViewStore();a&&s&&(g.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:p,perform:i=>{const d=I.G3({environment:p,collectionStore:a,collectionViewArgs:l?{collectionViewStore:l,format:l.getFormat(),formatKey:m}:void 0,propertyType:"relation",transaction:i});return P.n7({environment:p,collectionContextStore:o,collectionStore:a,property:d,propertyName:oe,targetCollectionStore:s,hasInverseRelation:e,inverseName:t,autoRelate:n,propertyLimit:h,intl:c,transaction:i,from:r}),l&&(he({collectionViewStore:l,newProperty:d,transaction:i}),fe({relationPropertyId:d,transaction:i})),d}}),u.z$({collectionSettingsStore:i}),u.H4({collectionSettingsStore:i,item:{type:"main"}}),T._H({environment:p,collectionContextStore:o,from:r,property_type:"relation"}))}),[o,p,i,m,c,h,oe,se,r,he,fe]),we=(0,_.yK)((e=>({emptyStateText:{color:e.mediumTextColor,fontSize:14,margin:"0px 12px"},useExistingTitle:{fontSize:12,color:e.mediumTextColor,marginLeft:12,marginTop:12}})),[]);if(!b)return null;const ke=K.canConfigureCollection,Ce=(e,t,i,r)=>n()(W,{menuProps:e,property:t,defaultProperty:j,checkState:i,propertySchema:r,collectionContextStore:o,handleDefaultPropertySelect:ve,handlePropertySelect:ye});return s.createElement(F.ZP,a()({},e,{title:n()(d.FormattedMessage,f?{defaultMessage:"Sub-items",id:"database.viewSettings.subItemsTab.title",description:"Title for the sub-items menu"}:{defaultMessage:"Dependencies",id:"database.viewSettings.dependenciesTab.title",description:"Title for the dependencies menu"}),footer:n()(H.Z,{topBorder:X.length>0&&!ce},void 0,ke&&X.length>0&&!ce&&n()(L.Z,{icon:M.Z.plus,title:n()(d.FormattedMessage,{id:"database.viewSettings.subitemTab.newRelation",defaultMessage:"Create new relation",description:"Button that creates a new self relation on the current database"}),isGray:!0,onClick:be}),!ce&&s.createElement(s.Fragment,null,K.canConfigureBlock&&!K.canConfigureCollection?n()(L.Z,{title:n()(d.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.removeSubitemRelation.removeSubitemButton.title",defaultMessage:"Turn off for this view",description:"Button title for setting this relation to be toggled by on this view"}),isRed:!0,onClick:()=>ye(void 0)}):K.canConfigureBlock&&n()(N.Z,{popupType:l.isPhone?U.kQ.SlideUp:U.kQ.Popup,alignmentToOrigin:N.Z.Alignment.End,placementToOrigin:N.Z.Placement.Bottom,originGap:0,renderOrigin:e=>s.createElement(s.Fragment,null,!(!K.canConfigureBlock||!z)&&s.createElement(L.Z,a()({isGray:!0,icon:M.Z.trash,title:n()(d.FormattedMessage,f?{defaultMessage:"Turn off sub-items",id:"database.viewSettings.relationsPropertyTab.removeSubItemsButton.title",description:"Title for button that users can click to remove sub items"}:{defaultMessage:"Turn off dependencies",id:"database.viewSettings.relationsPropertyTab.removeDependenciesButton.title",description:"Title for button that users can click to remove dependencies"}),isRed:!0},e))),render:e=>{let t;return t=l.isPhone?{menuType:E.og.ActionSheet}:{menuType:E.og.Popup,width:300},s.createElement(O.Z,a()({},t,{footer:n()(H.Z,{topBorder:!0},void 0,K.canConfigureBlock&&n()(L.Z,{title:n()(d.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.removeRelation.removeRelationButton.title",defaultMessage:"Turn off for this view",description:"Button title for removing this relation setting for only this view"}),isRed:!0,onClick:()=>ye(void 0)}),K.canConfigureCollection&&n()(L.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Turn off for all new views",id:"database.viewSettings.relationsPropertyTab.removeRelation.removeAllDefaultButton.title",description:"Title for removing this relation as default for all new views"}),isRed:!0,onClick:()=>{ve(void 0)}}))}))}})))}),f&&n()(Q,{propertyName:oe||te,inversePropertyName:(null==se?void 0:se.inverseName)||ae}),v&&n()($,{propertyName:oe||te}),!ce&&n()("div",{style:we.useExistingTitle},void 0,n()(d.FormattedMessage,{defaultMessage:"Use an existing relation",id:"database.viewSettings.relationsPropertyTab.useExistingRelation.title",description:"Title above the relation picker to prompt user to choose an existing property for this setting."})),X.length>0&&!ce?n()("div",{style:{paddingBottom:"6px"}},void 0,n()(H.Z,{},void 0,n()(N.Z,{buttonPopupStore:pe,render:e=>{let t;return t=l.isPhone?{menuType:E.og.ActionSheet}:{menuType:E.og.Popup,width:300},s.createElement(O.Z,a()({},t,{footer:n()(V.Z,{schema:y,format:S,getProperties:me,onAccept:K.canConfigureBlock&&!K.canConfigureCollection?ye:()=>{},inputPlaceholder:Z.default.formatMessage(f?ee.subitemInputPlaceholder:ee.timelineArrowsByInputPlaceholder),currentProperty:z,defaultShowPropertyCount:5,renderProperty:K.canConfigureBlock&&!K.canConfigureCollection?void 0:Ce})}))},renderOrigin:e=>{var t;return s.createElement(L.Z,a()({title:n()(d.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.existingRelation",defaultMessage:"Property",description:"Button that opens the menu to see existing self-relations to select from"}),showChevron:!0,right:z?null===(t=y[z])||void 0===t?void 0:t.name:void 0,rotateChevron:ue.open,disabled:!1,icon:M.Z.typesRelation},e))},popupType:l.isPhone?U.kQ.SlideUp:U.kQ.Popup,alignmentToOrigin:N.Z.Alignment.End,placementToOrigin:N.Z.Placement.Bottom,originGap:0}))):ke&&s.createElement(s.Fragment,null,n()(H.Z,{},void 0,n()("div",{style:we.emptyStateText},void 0,n()(d.FormattedMessage,{defaultMessage:"Rename (optional)",id:"database.viewSettings.relationsPropertyTab.emptyStateDescription",description:"Message to prompt user to create a self-relation."}))),n()(H.Z,{},void 0,n()(Y.ZP,{value:oe,placeholder:oe,onChange:e=>ie(e.target.value),onBlur:()=>{},onSubmit:()=>{},focusInitial:!0,selectAll:!1})),n()(D.Z,{collectionContextStore:o,targetCollectionStore:b,property:void 0,buttonContents:n()(d.FormattedMessage,{defaultMessage:"Create",id:"database.viewSettings.relationsPropertyTab.createButton.title",description:"Button label when creating a new database relation property"}),temporaryInverseState:se,setTemporaryInverseState:le,isInitialPropertyName:ne,onSubmit:Se,from:r}),X.length>0&&n()("div",{style:{margin:"auto",textAlign:"center"}},void 0,n()(G.Z,{onClick:()=>{w.default.afterNextFlush((()=>{de(!1)}))},isGray:!0,style:{margin:"6px 12px 6px 12px",width:"auto"}},void 0,n()(d.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.newRelation",defaultMessage:"Use existing relation",description:"Button that creates a new self relation on the current database"})))))}));var oe=o(77719),ie=o(98742),ne=o(30874),re=o(52275),ae=o(9342),se=o(58032);function le(e){window.__c={n:"CollectionSettingsAccountPicker"};const{integration:t,collectionSettingsStore:o,collectionContextStore:i,onAccountSelect:r}=e,l=(0,_.yK)((()=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"}})),[]),c=(0,k.O7)(),p=(0,C.VK)((()=>{var e;return null===(e=i.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[i]),m=(0,C.VK)((()=>{const e=ne.Z.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]);return t&&p?s.createElement(F.ZP,a()({},e,{title:n()(d.FormattedMessage,{defaultMessage:"Choose an account",id:"collectionSettingsAccountPicker.title",description:"Collection settings menu title for menu that allows a user to choose which connected account they'd like to use."}),footer:ce({environment:c,integration:t,spaceId:p})}),n()("div",{style:l.settingsMenu},void 0,n()(ae.Z,{type:ae.i.Vertical,initialFocus:0,sections:[{key:"externalAuthentications",items:m.map((e=>({key:e.id,render:o=>n()(se.Z,{renderTooltip:()=>n()("span",{},void 0,e.account_name),placement:se.Z.Placement.Left,textWrap:!0,render:i=>s.createElement(re.Z,a()({},(0,ie.Z)(i||{},o),{title:e.account_name,icon:n()("img",{style:{width:18},src:t.info.icon}),focused:o.focused}))}),action:()=>{u.z$({collectionSettingsStore:o}),r(e)}}))),render:e=>s.createElement(H.Z,e)}]}))):null}function ce(e){window.__c={n:"renderFooter"};const t=e.environment.device.isMobileBrowser;return n()(H.Z,{topBorder:!0,children:t?void 0:de(e)})}function de(e){return window.__c={n:"connectAnotherAccountButton"},s.createElement(L.Z,a()({},e,{icon:M.Z.plus,title:n()(d.FormattedMessage,{id:"collectionSettingsAccountPicker.addAccount",defaultMessage:"Connect another account",description:"Button that allows users to add another account for the same integration."}),isGray:!0,onClick:async()=>{await oe.h({...e,from:"source_picker_connect_another_account"})}}))}var pe=o(6740);function ue(){const e=(0,s.useRef)(null),[t,o]=(0,s.useState)(!1),i=(0,s.useCallback)((()=>{const t=e.current;t&&o(function(e){try{return e.matches(":focus-within")}catch(t){return!1}}(t))}),[]),n=(0,s.useCallback)((t=>{e.current=t,i()}),[i]);return(0,s.useEffect)((()=>{const t=e.current;if(t){function e(){o(!0),i()}function n(){o(!1),i()}return t.addEventListener("focusin",e),t.addEventListener("focusout",n),()=>{t.removeEventListener("focusin",e),t.removeEventListener("focusout",n)}}}),[i]),(0,s.useEffect)((()=>{if(t)return document.addEventListener("pointerdown",i),document.addEventListener("keydown",i),()=>{document.removeEventListener("pointerdown",i),document.removeEventListener("keydown",i)}}),[t,i]),[n,t]}var me=o(77744),ge=o(97880),he=o(82990),fe=o(1533),ve=o(64921),ye=o(24457),be=o(29502),Se=o(73063);const we=(0,d.defineMessages)({automationSummaryCardMoreButtonAriaLabel:{defaultMessage:"More",description:"The aria label for the more menu button",id:"automations.AutomationSummaryCard.MoreActionsButton.ariaLabel"},automationSummaryCardMoreMenuEditTitle:{defaultMessage:"Edit",description:"The title for the edit menu item",id:"automations.AutomationSummaryCard.MoreActionsMenu.Edit.title"},automationSummaryCardMoreMenuDuplicateTitle:{defaultMessage:"Duplicate",description:"The title for the duplicate menu item",id:"automations.AutomationSummaryCard.MoreActionsMenu.Duplicate.title"},automationSummaryCardMoreMenuDisableTitle:{defaultMessage:"Disable",description:"The title for the disable menu item",id:"automations.AutomationSummaryCard.MoreActionsMenu.Disable.title"},automationSummaryCardMoreMenuDeleteTitle:{defaultMessage:"Delete",description:"The title for the delete menu item",id:"automations.AutomationSummaryCard.MoreActionsMenu.Delete.title"}});function ke(e){const{focused:t,style:o,onEdit:i,onDelete:r,onDuplicate:l,onDisable:c}=e,p=(0,d.useIntl)(),u=(0,C.qz)(void 0,A.Z),m=(0,be.d)();(0,s.useEffect)((()=>{t||u.setState({open:!1})}),[t,u]);const g=(0,_.yK)((e=>({iconButton:{background:e.contentBackground,border:`1px solid ${e.regularDividerColor}`,height:26,width:26,...o},iconButtonIcon:{width:16}})),[o]);return s.createElement(s.Fragment,null,n()(N.Z,{stopClickPropagation:!0,popupType:m,alignmentToOrigin:N.Z.Alignment.Center,placementToOrigin:N.Z.Placement.Bottom,originGap:0,renderOrigin:e=>s.createElement(Se.Z,a()({ariaLabel:p.formatMessage(we.automationSummaryCardMoreButtonAriaLabel),icon:M.Z.dots,iconStyle:g.iconButtonIcon,style:g.iconButton,hasBackground:!0},e)),render:e=>n()(Ce,{onClose:()=>e.close(),onEdit:i,onDelete:r,onDuplicate:l,onDisable:c}),buttonPopupStore:u}))}function Ce(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:i,onDuplicate:r,onDisable:l}=e,c=(0,d.useIntl)(),p=(0,ye.F)(),u=o?{action:()=>{t(),o()},key:"edit",render:e=>s.createElement(re.Z,a()({},e,{icon:M.Z.pencil({height:16,width:16}),title:c.formatMessage(we.automationSummaryCardMoreMenuEditTitle)}))}:void 0,m=r?{action:()=>{t(),r()},key:"duplicate",render:e=>s.createElement(re.Z,a()({},e,{icon:M.Z.duplicate({height:16,width:16}),title:c.formatMessage(we.automationSummaryCardMoreMenuDuplicateTitle)}))}:void 0,g=l?{action:()=>{t(),l()},key:"disable",render:e=>s.createElement(re.Z,a()({},e,{icon:M.Z.genericError({height:16,width:16}),title:c.formatMessage(we.automationSummaryCardMoreMenuDisableTitle)}))}:void 0,h=i?{action:()=>{t(),i()},key:"delete",render:e=>s.createElement(re.Z,a()({},e,{icon:M.Z.trash({height:16,width:16}),title:c.formatMessage(we.automationSummaryCardMoreMenuDeleteTitle)}))}:void 0;return s.createElement(O.Z,p,n()(ae.Z,{type:ae.i.Vertical,sections:[{items:[u,m,g,h].filter(ge.$K),key:"items",render:e=>s.createElement(H.Z,a()({enableActionSheetTitle:!0,topBorder:!0},e))}],initialFocus:0}))}function _e(e){window.__c={n:"AutomationSummaryCard"};const{actions:t,caption:o,focused:i,onClick:r,onDelete:a,title:l,triggers:c}=e,d=(0,s.useRef)(null),[p,u]=(0,pe.Z)(),[m,g]=ue(),h=(0,C.qz)(void 0,fe.Z),f=(0,C.VK)((()=>h.getState()),[h]).hovered||u||g,v=Be(),y=(0,_.yK)((e=>({wrap:{border:`1px solid ${e.regularDividerColor}`,borderRadius:8,display:"flex",flexDirection:"column",gap:15,padding:15,position:"relative"},moreButtonWrap:{display:f?"block":"none",position:"absolute",right:8,top:8},iconList:{display:"flex",flexWrap:"wrap",gap:5,listStyle:"none",margin:"0 30px 0 0",padding:0},body:{display:"flex",flexDirection:"column",gap:2},title:{...xe(2),fontSize:14,fontWeight:he.Z.fontWeight.medium,lineHeight:"18px"},caption:{...xe(2),color:e.accentColors.gray[500],fontSize:12,fontWeight:he.Z.fontWeight.regular,lineHeight:"18px",margin:0}})),[f]);(0,s.useEffect)((()=>{i&&null!==d.current&&d.current.focus()}),[i]);const b=(0,me.lq)(d,p,m),S=(e,t)=>{let o;return"property"===e.type?o=n()(Me,{icon:e.icon}):"page"===e.type?o=n()(Te,{icon:e.icon}):"misc"===e.type?o=n()(Ie,{icon:e.icon}):"person"===e.type?o=n()(Pe,{src:e.imageSrc}):(0,ge.t1)(e.type),n()("li",{},t,o)};return s.createElement(ve.Z,{onClick:r,ref:b,store:h,style:y.wrap},n()("header",{},void 0,n()("div",{style:y.moreButtonWrap},void 0,n()(ke,{focused:f,onDelete:a,onDisable:()=>{},onDuplicate:()=>{},onEdit:r})),n()("ul",{"aria-hidden":"true",style:y.iconList},void 0,c.map(((e,t)=>S(e,t))),c.length>0&&t.length>0&&n()("li",{},void 0,n()("div",{style:{...v.iconWrap}},void 0,M.Z.arrowRight({...v.icon,...v.iconArrow}))),t.map(((e,t)=>S(e,t))))),n()("div",{style:y.body},void 0,n()("div",{style:y.title},void 0,l),o&&n()("p",{style:y.caption},void 0,o)))}function Me(e){window.__c={n:"PropertyIcon"};const{icon:t}=e,o=Be();return n()("div",{"aria-hidden":"true",style:{...o.iconWrap,...o.iconPropertyWrap}},void 0,M.Z[t]({...o.icon,...o.iconProperty}))}function Te(e){window.__c={n:"PageIcon"};const{icon:t}=e,o=Be();return n()("div",{"aria-hidden":"true",style:{...o.iconWrap,...o.iconPageWrap}},void 0,M.Z[t]({...o.icon,...o.iconPage}))}function Ie(e){window.__c={n:"MiscIcon"};const{icon:t}=e,o=Be();return n()("div",{"aria-hidden":"true",style:{...o.iconWrap,...o.iconMiscWrap}},void 0,M.Z[t]({...o.icon,...o.iconMisc}))}function Pe(e){window.__c={n:"PersonIcon"};const{src:t}=e,o=Be();return n()("div",{"aria-hidden":"true",style:o.iconPersonWrap},void 0,n()("img",{src:t,style:o.iconPerson}))}function xe(e){return{display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:e}}function Be(){return(0,_.yK)((e=>({icon:{width:16},iconWrap:{borderRadius:6,padding:6},iconProperty:{fill:e.accentColors.blue[500]},iconPropertyWrap:{background:e.accentColors.blue[100]},iconPage:{fill:e.accentColors.green[500]},iconPageWrap:{background:e.accentColors.green[100]},iconMisc:{fill:e.accentColors.yellow[500]},iconMiscWrap:{background:e.accentColors.yellow[100]},iconPerson:{display:"block",width:"100%"},iconPersonWrap:{borderRadius:"50%",height:28,overflow:"hidden",width:28},iconArrow:{fill:e.accentColors.gray[500]}})),[])}const Ze=(0,d.defineMessages)({automationTabTitle:{defaultMessage:"Automations",description:"The title used on automation settings tab",id:"database.viewSettings.automationTab.title"},automationNewAutomationTitle:{defaultMessage:"New Automation",description:"The title used on the new automations button",id:"database.viewSettings.automationTab.newAutomationTitle"},automationLearnAutomationTitle:{defaultMessage:"Learn about automations",description:"The title used on the learn about automations button",id:"database.viewSettings.automationTab.learnAutomationTitle"}});function Ee(e){window.__c={n:"CollectionSettingsAutomationsView"};const{collectionContextStore:t,collectionSettingsStore:o}=e,i=(0,d.useIntl)(),r=(0,C.VK)((()=>{var e;return(null===(e=t.collectionStore())||void 0===e?void 0:e.getAutomationStores())||[]}),[t]),l=(0,C.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSchema()}),[t]),c=(0,s.useCallback)((()=>{u.H4({collectionSettingsStore:o,item:{type:"automationCreateSettings"}})}),[o]),p=(0,_.yK)((()=>({automationButtonList:{display:"flex",flexDirection:"column",gap:12,paddingBlockEnd:12,paddingInline:12}})),[]);return l?s.createElement(F.ZP,a()({},e,{footer:n()(H.Z,{topBorder:!0},void 0,n()(L.Z,{icon:M.Z.plus,onClick:c,title:i.formatMessage(Ze.automationNewAutomationTitle)}),n()(L.Z,{icon:M.Z.questionMark,title:i.formatMessage(Ze.automationLearnAutomationTitle)})),menuScrollerStyle:{flexGrow:1,marginBlockStart:6},title:i.formatMessage(Ze.automationTabTitle)}),n()("div",{style:p.automationButtonList},void 0,r.map(((e,t)=>n()(Ae,{collectionSettingsStore:o,focused:0===t,schema:l,automationStore:e},e.id))))):null}const Re={number:"typesNumber",person:"typesPerson",date:"typesDate",checkbox:"typesCheckbox",select:"typesSelect",multi_select:"typesMultipleSelect",status:"typesStatus",relation:"typesRelation",title:"typesTitle",text:"typesText",url:"typesUrl",email:"typesEmail",phone_number:"typesPhoneNumber"};function Ae(e){window.__c={n:"AutomationSummaryCardWrapper"};const{collectionSettingsStore:t,focused:o,schema:i,automationStore:r}=e,a=(0,d.useIntl)(),l=(0,C.VK)((()=>r.getTriggerStore().getValue()),[r]),c=(0,C.VK)((()=>r.getNameWithDefault(a)),[a,r]),p=(0,s.useCallback)((e=>{u.H4({collectionSettingsStore:t,item:{type:"automationEditSettings",automationId:e}})}),[t]),m=[];if("event"===(null==l?void 0:l.type)){const e=l.event.pagePropertiesEdited;if("some"in e)for(const t of e.some){var g;const e=null===(g=i[t.property])||void 0===g?void 0:g.type;e&&m.push({icon:Re[e],type:"property"})}}const h=(0,C.VK)((()=>{const e=r.getActionStores(),t=[];for(const n of e)if(n.isType("update_pages")){const e=n.getConfig();for(const n of(null==e?void 0:e.properties)||[]){var o;const e=null===(o=i[n])||void 0===o?void 0:o.type;e&&t.push({icon:Re[e],type:"property"})}}return t}),[i,r]);return n()(_e,{actions:h,caption:"Test caption",focused:o,onClick:()=>p(r.id),title:c,triggers:m},r.id)}var De=o(8848),Fe=o(31942),Le=o(59054),Ve=o(20270),Ne=o(64002),Oe=o(54642),Ue=o(43132),He=o(47307),ze=o(761),We=o(70764),je=o(75079),Ke=o(79315),Ye=o(64369);function Ge(e){window.__c={n:"CollectionSettingsAccountSelectionIndicator"};const{onClick:t,integration:o,accountName:i}=e,r=(0,_.yK)((e=>({accountSelection:{padding:"8px",borderTop:`1px solid ${e.regularDividerColor}`,cursor:"pointer"},accountSelectionLabel:{fontWeight:he.Z.fontWeight.medium,paddingLeft:4,paddingTop:4}})),[]);return n()("div",{style:r.accountSelection},void 0,n()("div",{onClick:t},void 0,n()(Ye.Z,{isSecondaryColor:!0,isSmall:!0,style:r.accountSelectionLabel},void 0,n()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.currentAccountSection.label",defaultMessage:"Connected to {integration}",description:"Label for section that shows the current connected account",values:{integration:o.name}})),n()(se.Z,{renderTooltip:()=>n()("span",{},void 0,i),placement:se.Z.Placement.Left,textWrap:!0,render:t=>s.createElement(re.Z,a()({showExtensionArrow:!0,focused:!1},(0,ie.Z)(t||{},e),{title:i,icon:n()("img",{style:{width:18},src:o.info.icon})}))})))}var Xe=o(5500),qe=o(1634),$e=o(31278);function Je(e){window.__c={n:"CollectionSettingsExternalAuthentication"};const{collectionContextStore:t,integration:o}=e,i=(0,_.Fg)(),r=(0,C.VK)((()=>t.collectionStore()),[t]),l=(0,C.VK)((()=>null==r?void 0:r.getIcon()),[r]),c=(0,k.O7)(),p=(0,C.VK)((()=>{var e;return null===(e=Ke.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),u=(0,_.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"},authenticationBody:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:"0px 16px 16px 16px",textAlign:"center"},settingsMenuSubHeading:{display:"inline",fontSize:14,margin:"4px 20px 20px 20px",color:e.mediumTextColor,textAlign:"center"},settingsMenuAuthenticationButton:{fontSize:14,height:32,color:e.regularInvertedTextColor}})),[]),{background:m,hoveredBackground:g,pressedBackground:h}=(0,Xe.dg)(o,i.mode);return s.createElement(F.ZP,a()({},e,{title:n()(d.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateHeader.title",description:"Header text to prompt user to authenticate an integration (e.g. GitHub)",values:{integration:o.name}})}),n()("div",{style:u.settingsMenu},void 0,n()("div",{style:u.authenticationBody},void 0,n()($e.Z,{disabled:!0,bucket:"secure",store:r,icon:l,size:40,isEmptyPage:!1,style:{marginBottom:6}}),n()("div",{style:u.settingsMenuSubHeading},void 0,n()(d.FormattedMessage,{defaultMessage:"Link your {integration} account for richer content previews and seamless imports.",id:"collectionSettingsCreateExternalViewPicker.authenticateBody.title",description:"Text to prompt user to authenticate an integration (e.g. GitHub)",values:{integration:o.name}})),n()(G.Z,{onClick:()=>{p&&(oe.h({environment:c,integration:o,spaceId:p,from:"placeholder_root_external_collection_view_block"}),qe.Z.reset())},style:{background:m,...u.settingsMenuAuthenticationButton},hoveredStyle:{background:g},pressedStyle:{background:h}},void 0,n()(d.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateButton.title",description:"Button title to authenticate a user with an integration (e.g. GitHub)",values:{integration:o.name}})))))}var Qe=o(55811),et=o(42922),tt=o(68785),ot=o(18647);function it(e){const{collectionSettingsStore:t,collectionContextStore:o,externalAuthentication:i}=e,n=(0,C.VK)((()=>o.collectionStore()),[o]),r=(0,C.VK)((()=>{if(!n)return;const e=n.getFormat().integration_id;return ne.Z.integrations.state.find((t=>t.id===e))}),[n]),l=(0,C.VK)((()=>!!r&&(0,We.NP)(r.id).length>0),[r]),c=(0,C.VK)((()=>{var e;return null===(e=Ke.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()}),[]);return n&&c&&r?s.createElement(s.Fragment,null,l?s.createElement(at,a()({},e,{collectionContextStore:o,collectionSettingsStore:t,integration:r,externalAuthentication:i})):s.createElement(Je,a()({},e,{collectionContextStore:o,collectionSettingsStore:t,integration:r}))):null}const nt=e=>{var t,o;return null===(t=e.integration.info)||void 0===t||null===(o=t.original_url_patterns)||void 0===o?void 0:o.filter((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))},rt=(0,d.defineMessages)({all:{id:"collectionSettingsCreateExternalViewPicker.filters.all",defaultMessage:"All",description:"Show all results"},issues:{id:"collectionSettingsCreateExternalViewPicker.filters.issues",defaultMessage:"Issues",description:"Show only Github/Version Control Host issues in results"},pull_requests:{id:"collectionSettingsCreateExternalViewPicker.filters.pullRequests",defaultMessage:"Pull Requests",description:"Show only Github/Version Control Host pull requests in results"},board:{id:"collectionSettingsCreateExternalViewPicker.filters.boards",defaultMessage:"Boards",description:"Show only JIRA boards in results"},project:{id:"collectionSettingsCreateExternalViewPicker.filters.projects",defaultMessage:"Projects",description:"Show only JIRA boards in results"},Releases:{id:"collectionSettingsCreateExternalViewPicker.filters.releases",defaultMessage:"Releases",description:"Show only Github/Version Control Host releases in results"},"Pull Request":{id:"collectionSettingsCreateExternalViewPicker.filters.PullRequests",defaultMessage:"Pull Requests",description:"Show only Github/Version Control Host pull requests in results"},Issues:{id:"collectionSettingsCreateExternalViewPicker.filters.Issues",defaultMessage:"Issues",description:"Show only Github/Version Control Host issues in results"}});function at(e){window.__c={n:"CollectionSettingsSourceSelection"};const{integration:t,collectionContextStore:o,collectionSettingsStore:i,externalAuthentication:r}=e,[l,c]=(0,s.useState)(""),m=(0,C.VK)((()=>{const e=ne.Z.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]),g=(0,C.VK)((()=>r||(m.length?m[0]:null)),[m,r]),[f,y]=(0,s.useState)(!1),[b,S]=(0,s.useState)(null),w=(0,_.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px"},settingsMenuSearchBox:{background:e.contentBackground,marginBottom:10},syncSourceButton:{width:"100%",display:"flex",justifyContent:"center"},noResults:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.mediumTextColor},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:De.ZP.white,background:De.ZP.blue,borderRadius:6,padding:10,boxShadow:e.largeLightBoxShadow,alignSelf:"center",maxWidth:"80%"},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},syncingData:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.mediumTextColor},filterContainer:{position:"relative",flexGrow:0,overflow:"hidden"},filterContainerScroller:{display:"flex",alignItems:"center",padding:"8px 12px"}})),[]),T=(0,C.VK)((()=>o.collectionStore()),[o]),I=(0,C.VK)((()=>o.collectionViewBlockStore()),[o]),P=(0,k.O7)(),[{value:x,status:B}]=(0,Le.r5)((async()=>{if(!g)return;const e=g.parent_id;return Oe.listExternalCollections(P,{bot_id:e})}),[P,g]),E="success"===(null==x?void 0:x.type)&&"data"in x.data?x.data.data:[],R="success"===(null==x?void 0:x.type)&&"error"in x.data?x.data.error:null,A=E.filter((e=>!b||e.type===b)),D=A.length?(0,Fe.ZP)(l,A,(e=>e.title)):[],L=Array.from(new Set(E.map((e=>e.type)))),V=nt({integration:t,url:l}),N=async e=>{if(y(!0),!T||!I)return;const r=e||l,a=nt({integration:t,url:r});if(!a)return y(!1),void He.showDialog({items:[{label:n()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information",description:"Button that allows users to copy debugging information that they can share with support"}),color:"blue",onAccept:()=>{Ue.RD({environment:P,stringValue:JSON.stringify({botId:null==g?void 0:g.parent_id,url:r},null,2),copiedMessage:Ue.tq.copiedToClipboard})}},{label:n()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close",description:"Button that closes the error dialog."}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:n()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source.",description:"Title message in the error dialog box when we failed to sync the source."})});const s=(0,We.NP)(t.id);await ze.UY({environment:P,url:r,botIds:s.map((e=>e.id)),externalCollectionStore:T,externalCollectionViewBlockStore:I});const{host:c}=(0,Ne.Qc)(r);p.trackSaveLinkPreview(P,{...(0,je.Pn)(o),integrationId:t.id,type:"collection",entity:a.name,domain:c||"",from:"external_picker_settings"}),u.wl({collectionSettingsStore:i,item:{type:"shareSyncedView",integrationName:t.name,integrationIcon:t.info.icon}}),y(!1)};if(!T||!I)return null;const O=L.length>1?n()("div",{style:w.filterContainer},void 0,n()(ot.Z,{type:v.Z.X,style:w.filterContainerScroller,showLeftRightOverlay:!1},void 0,n()(Qe.u,{title:n()("span",{},void 0,Z.default.formatMessage(rt.all)),on:!(0,ge.K0)(b),hideChevron:!0,onClick:e=>{(0,h.ZP)({event:e,context:h.Af.CollectionSettingsClick,callback:()=>{S(null)}})}},"all"),L.map((e=>n()(Qe.u,{title:n()("span",{},void 0,Z.default.formatMessage(rt[e])),on:b===e,hideChevron:!0,onClick:t=>{(0,h.ZP)({event:t,context:h.Af.CollectionSettingsClick,callback:()=>{S((t=>t===e?null:e))}})}},e))))):null,U=V?n()("div",{style:w.syncSourceButton},void 0,n()(et.Z,{isLarge:!0,onClick:e=>{(0,h.ZP)({event:e,context:h.Af.CollectionSettingsClick,callback:()=>{N()}})},disabled:!1},void 0,n()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.syncSourceButton.label",defaultMessage:"Sync Source",description:"Button for the user to click to start sync for URL provided (i.e. Github Pull Requests)"}))):null,z=V||E.length&&D.length?null:s.createElement(s.Fragment,null,n()("div",{style:w.noResults},void 0,n()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.noResults.text",defaultMessage:"No results",description:"Indicates that no available external sources were found for search term"})),n()("div",{style:w.suggestionBox},void 0,M.Z.info({marginRight:8,width:14,height:14}),n()(d.FormattedMessage,{defaultMessage:"Try different search or paste any {integration} URL",id:"collectionSettingsCreateExternalViewPicker.noResults.help",description:"Prompt the user to change search term or paste a URL to the external source (i.e. Github Pull Requests)",values:{integration:t.name}}))),W=E.length&&D.length?s.createElement(s.Fragment,null,n()(ae.Z,{type:ae.i.Vertical,initialFocus:0,sections:[{key:"collections",items:D.map((e=>({key:e.url,render:t=>n()(se.Z,{renderTooltip:()=>n()("span",{},void 0,e.title),placement:se.Z.Placement.Left,textWrap:!0,render:o=>s.createElement(re.Z,a()({},(0,ie.Z)(o||{},t),{title:e.title,icon:n()("img",{style:{width:18},src:e.icon}),caption:e.parent.title}))}),action:t=>{"stopPropagation"in t.event&&t.event.stopPropagation(),N(e.url)}}))),render:e=>s.createElement(H.Z,a()({},e,{disableMobilePadding:!0}))}]})):null,j="pending"===B||"idle"===B||f;if(!g||R&&(R.status===Ve.mQ.UNAUTHORIZED||R.status===Ve.mQ.FORBIDDEN))return n()(Je,{collectionContextStore:o,collectionSettingsStore:i,integration:t});const K="rejected"===B||"failed"===(null==x?void 0:x.type)||R,G=n()(Ge,{onClick:()=>{u.H4({collectionSettingsStore:i,item:{type:"selectAccountForExternalSource",integration:t,onAccountSelect:e=>{u.H4({collectionSettingsStore:i,item:{type:"createSyncedViewSource",externalAuthentication:e}})}}})},integration:t,accountName:g.account_name});return s.createElement(F.ZP,a()({},e,{footer:U||f?null:G,title:n()(d.FormattedMessage,{defaultMessage:"Select from {integration}",id:"collectionSettingsCreateExternalViewPicker.title",description:"Header text to prompt user to choose an integration source (e.g. GitHub Pull Requests)",values:{integration:t.name}}),header:!j&&"resolved"===B&&s.createElement(s.Fragment,null,n()(Y.ZP,{inputLeft:n()(Y.f_,{icon:M.Z.searchThick}),onSubmit:()=>{V&&N()},style:w.settingsMenuSearchBox,focusInitial:!0,value:l,onChange:e=>{c(e.target.value)},placeholder:"Search source or paste a link..."}),V?null:O)}),n()("div",{style:w.settingsMenu},void 0,K&&n()("div",{style:w.errorMessage},void 0,n()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.error.unknown",defaultMessage:"Something went wrong.",values:{integration:t.name},description:"Error message is an unknown error occurred."})),j&&n()("div",{style:w.syncingData},void 0,n()("span",{},void 0,n()(d.FormattedMessage,f?{id:"collectionSettingsCreateExternalViewPicker.settingUpSync",defaultMessage:"Setting up sync...",description:"Indicate to the user that we are setting up the synced database"}:{id:"collectionSettingsCreateExternalViewPicker.loadingData",defaultMessage:"Loading available sources...",description:"Indicates to the user that we are loading available sources to sync from 3rd party"})),n()(tt.Z,{style:{alignSelf:"center"}})),!j&&"resolved"===B&&s.createElement(s.Fragment,null,U,z,W)))}var st=o(26263),lt=o(67219),ct=o(64434),dt=o(9953),pt=o(75081),ut=o(12318),mt=o(26122);function gt(e){window.__c={n:"CollectionSettingsCreateTypedDB"};const t=(0,_.Fg)(),o=(0,k.O7)(),i=o.device,[r,l]=(0,s.useState)("custom"),[c,p]=(0,s.useState)(),m=(0,s.useMemo)((()=>new ut.default("")),[]),f=(0,s.useMemo)((()=>new st.Z),[]),v=(0,C.VK)((()=>{const t=e.collectionContextStore.collectionStore();if(t)return t.clone(f).getIcon()}),[e.collectionContextStore,f]);(0,s.useEffect)((()=>{var t;void 0===c&&p(null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.getType())}),[e.collectionContextStore,c]),(0,s.useEffect)((()=>{const e=o.defaultRecordCache.inMemoryRecordCache;return e.addCacheOverride(f),()=>{e.removeCacheOverride(f)}}),[o,f,e.collectionContextStore]);const y=(0,s.useCallback)((e=>{m.set(e)}),[m]),b=(0,s.useCallback)(((t,i)=>{const{collectionContextStore:n}=e,r=n.collectionViewStore(),a=n.collectionViewBlockStore();r&&a&&u.nr({environment:o,baseViewType:c,selectedDBType:i,collectionName:m.get(),collectionContextStore:n,collectionViewBlockStore:a,collectionViewStore:r,useTemporaryRecordCache:t,temporaryRecordCache:f})}),[e,c,o,m,f]);(0,s.useEffect)((()=>{b(!0,"custom")}),[b]);const S=(0,s.useCallback)((t=>{const{collectionContextStore:o}=e;l(t),b(!0,t),ct.Ip({collectionContextStore:o})}),[e,b]);const w=(0,s.useCallback)((t=>{var i;const n=null===(i=e.collectionContextStore.collectionStore())||void 0===i?void 0:i.getIconStore().clone(f);n&&g.createAndCommit({userAction:"SpacePermissionGroup.handleIconChange",environment:o,perform:e=>{dt.sO({store:n,value:t,transaction:e})}})}),[e.collectionContextStore,o,f]),T=(0,s.useCallback)((t=>{(0,h.ZP)({event:t,context:h.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:t}=e;He.showDialog({message:n()("span",{},void 0,n()(d.FormattedMessage,{defaultMessage:"Would you like to continue creating this database?",id:"collectionSettingsNewDatabase.confirmDialog.prompt",description:"Prompt for confirmation when leaving the database settings in the middle of creation"})),showCancel:!1,keepFocus:!1,items:[{label:n()(d.FormattedMessage,{defaultMessage:"Yes create {selectedType, select, custom {an {type}} other {a {type}}} database",values:{selectedType:r,type:"custom"===r?"empty":pt.GW[r]},id:"collectionSettingsNewDatabase.confirmDialog.affirmativeButton.label"}),color:"red",onAccept:()=>{b(!1,r),u.E3({collectionSettingsStore:t})}},{label:n()(d.FormattedMessage,{defaultMessage:"Cancel",id:"collectionSettingsNewDatabase.confirmDialog.cancel.label"}),color:"blue",onAccept:()=>{}}]})}})}),[e,r,b]),I=(0,s.useCallback)((()=>{o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(f);const{collectionContextStore:t,collectionSettingsStore:i}=e,n=t.collectionViewBlockStore(),r=t.collectionViewStore();void 0!==n&&void 0!==r&&(t.setContext({type:"collectionView",collectionViewBlockStore:n,collectionStore:void 0,collectionViewStore:r}),u.H4({collectionSettingsStore:i,item:{type:"createViewSource"}}))}),[o,e,f]);return s.createElement(F.ZP,a()({},e,{handleClose:T,title:n()(d.FormattedMessage,{defaultMessage:"New database",id:"database.viewSettings.createTypedDBTab.title",description:"Title for database settings panel to create new database"}),footer:n()(H.Z,{topBorder:!0},void 0,n()(L.Z,{icon:M.Z.contentSearch,isGray:!0,title:n()(d.FormattedMessage,{defaultMessage:"View an existing database",id:"database.viewSettings.createTypedDBTab.viewExistingDatabaseButton"}),onClick:I}),n()(L.Z,{icon:M.Z.save,isGray:!0,title:n()(d.FormattedMessage,{defaultMessage:"Import or sync from",id:"database.viewSettings.createTypedDB.importDatabaseButton"})}))}),n()(H.Z,{},void 0,n()(mt.Z,{initialValue:"",placeholder:pt.GW[r],inputStore:m,onBlur:y,onSubmit:y,iconButton:{icon:e=>n()($e.Z,{isEmptyPage:!0,disabled:!0,defaultIcon:pt.dx[r]({width:16,height:16,backfaceVisibility:void 0,marginRight:6}),icon:v,size:16}),onSubmit:w,includeEmojiTab:!0}})),n()("div",{style:{...!i.isMobile&&{width:"100%",paddingLeft:8,paddingRight:8},...i.isMobile&&{background:t.contentBackground,width:"100%",paddingTop:12,paddingBottom:12}}},void 0,n()("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"}},void 0,lt.bY.map((function(e){return n()(ht,{dbType:e,isCurrentType:r===e,onClick:()=>S(e)})}))),n()(et.Z,{style:{display:"flex",margin:"14px",height:32},onClick:function(){const{collectionSettingsStore:t}=e;b(!1,r),u.E3({collectionSettingsStore:t})}},void 0,n()(d.FormattedMessage,{defaultMessage:"Create database",id:"database.viewSettings.createTypedDB.createDatabase",description:"Create database of selected type"}))))}function ht(e){window.__c={n:"CollectionSettingsTypedDBButton"};const{dbType:t,onClick:o,isCurrentType:i}=e,r=(0,_.Fg)();return n()(ve.Z,{style:{display:"flex",width:"95%",height:45,flexGrow:0,flexShrink:0,fontSize:11,borderRadius:3,margin:6,padding:6,boxShadow:`0 0 0 1px ${r.regularDividerColor}`,color:r.mediumTextColor,fill:r.mediumTextColor,...i&&{boxShadow:`0 0 0 2px ${r.blueColor}`,color:r.blueColor,fill:r.blueColor,fontWeight:500}},disabled:i,onClick:o},void 0,n()("div",{},void 0,pt.dx[t]({...i&&{fill:r.blueColor,color:r.blueColor},width:17,height:17,marginBottom:4,marginTop:4,marginLeft:4})),n()("div",{style:{position:"relative",width:"100%",marginLeft:12}},void 0,n()("span",{style:{position:"absolute",fontSize:13,fontWeight:500}},void 0,pt.GW[t]),n()("span",{style:{position:"absolute",top:15,fontSize:12,marginTop:1}},void 0,pt.dX[t])))}var ft=o(79362),vt=o(98421),yt=o(6695),bt=o(72711),St=o(37181),wt=o(52821);function kt(e){return Object.keys(e).filter((t=>{var o;const i=null===(o=e[t])||void 0===o?void 0:o.type;return i&&Ct[i]}))}const Ct={status:!0,multi_select:!0,select:!0,person:!0,relation:!0,number:!0,date:!0,checkbox:!0,title:!0,text:!0,url:!0,email:!0,phone_number:!0,file:!1,button:!1,verification:!1,created_time:!1,last_edited_time:!1,created_by:!1,last_edited_by:!1,location:!1,auto_increment_id:!1,rollup:!1,formula:!1},_t={status:!0,multi_select:!0,select:!0,person:!1,relation:!1,number:!1,date:!1,checkbox:!1,title:!1,text:!1,url:!1,email:!1,phone_number:!1,file:!1,button:!1,verification:!1,created_time:!1,last_edited_time:!1,created_by:!1,last_edited_by:!1,location:!1,auto_increment_id:!1,rollup:!1,formula:!1};const Mt={status:!0,multi_select:!0,select:!0,person:!0,relation:!0,number:!0,date:!0,checkbox:!0,title:!0,text:!0,url:!0,email:!0,phone_number:!0,created_time:!0,last_edited_time:!0,created_by:!0,last_edited_by:!0,file:!1,button:!1,verification:!1,location:!1,auto_increment_id:!1,rollup:!1,formula:!1};var Tt=o(76205),It=o(1274),Pt=o(26825);function xt(e,t){if("initialize_state"===t.type)return t.data;if(e){if("update_name"===t.type)return{...e,name:t.name};if("update_source"===t.type)return{...e,sourcePointer:t.pointer};if("update_trigger"===t.type){const o=t.trigger,[i,n,...r]=e.triggers;if("page_added"===o.type)return{...e,triggers:[o,n,...r]};if("any_page_property_edited"===o.type)return{...e,triggers:[i,o]};if("property_changed"===o.type){const t=r.findIndex((e=>o.property===e.property));if(t<0)return{...e,triggers:[i,void 0,...r,o]};const n=r.slice(0,t),a=r.slice(t+1);return{...e,triggers:[i,void 0,...n,o,...a]}}return(0,ge.t1)(o)}if("remove_trigger"===t.type){const o=t.trigger,[i,n,...r]=e.triggers;if("page_added"===o.type)return{...e,triggers:[void 0,n,...r]};if("any_page_property_edited"===o.type)return{...e,triggers:[i,void 0,...r]};if("property_changed"===o.type){const t=r.findIndex((e=>o.property===e.property)),a=r.slice(0,t),s=r.slice(t+1);return{...e,triggers:[i,n,...a,...s]}}return(0,ge.t1)(o)}if("update_action"===t.type){const o=e.actions,i=o.findIndex((e=>t.action.id===e.id));if(i<0)return{...e,actions:[...o,t.action]};const n=o.slice(0,i),r=o.slice(i+1);return{...e,actions:[...n,t.action,...r]}}if("remove_action"===t.type){const o=e.actions,i=o.findIndex((e=>t.action.id===e.id)),n=o.slice(0,i),r=o.slice(i+1);return{...e,actions:[...n,...r]}}return(0,ge.t1)(t)}}function Bt(e){if(!e)return!1;const{name:t,triggers:o,actions:i}=e;if(!t.trim())return!1;const[n,r,...a]=o;return(void 0!==n||void 0!==r||0!==a.length)&&(0!==i.length&&i.every((e=>function(e){var t,o;if("slack_notification"===e.type)return!(null===(t=e.config)||void 0===t||!t.external_bot_id||null===(o=e.config)||void 0===o||!o.target);if("update_pages"===e.type){var i,n,r;const t=null===(i=e.config)||void 0===i||null===(n=i.properties)||void 0===n?void 0:n.length;return!!(null!==(r=e.config)&&void 0!==r&&r.target&&t&&t>0)}throw new Error(`isActionConfigComplete not implemented for ${e.type}`)}(e))))}function Zt(e){const{collectionStore:t}=e;if(!t)return!1;const o=t.pointer,i=t.getSpaceId();return(0,It.IC)({targetTriggerType:"notification_event",targetParentPointer:o,targetSpaceId:i}).every((e=>{let{pointer:o,minimumRequiredRole:i}=e;const n=t.getRecordRole(o);return!!n&&(0,Pt.yY)(n,i)}))}function Et(e){const{automationStore:t}=e,o=t.getMinimumFieldsForPermissions();if(!o)return!1;return(0,It.bM)(o).every((e=>{let{pointer:o,minimumRequiredRole:i}=e;const n=t.getRecordRole(o);return!!n&&(0,Pt.yY)(n,i)}))}function Rt(e){const{anyOptionCheckState:t,currentFilter:o,propertyId:i,updateCurrentState:n}=e;!0===t?n({type:"update_trigger",trigger:{type:"property_changed",property:i,filter:{operator:"changes_to_any"}}}):!1===t?n({type:"remove_trigger",trigger:{type:"property_changed",property:i,filter:{operator:"changes_to_any"}}}):"partial"===t?n({type:"update_trigger",trigger:{type:"property_changed",property:i,filter:o}}):(0,ge.t1)(t)}function At(e){const t=Dt(e);return(0,ge.$K)(t)}function Dt(e){var t;const{collectionViewStore:o,collectionSchema:i}=e,n=o.getPropertyFiltersStore().getValue()??[],r=null===(t=o.getQuery(i))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,Tt.OH)({propertyFilters:n,combinatorFilter:r,schema:i})},s=(0,Tt.SH)(a,(e=>{if((0,Tt.aN)(e)){const t=i[e.property];return!!t&&!Mt[t.type]}return!1}));if(s)return(0,Tt.aN)(s)?s.property:(0,Tt.Mm)(s)?s.timestamp:void 0}var Ft=o(77181),Lt=o(10161),Vt=o(13709);class Nt extends l.Z{constructor(){super(...arguments),this.handleFirstLoadLimitChange=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&(g.createAndCommit({userAction:"CollectionSettingsFirstLoadLimit.handleFirstLoadLimitChange",environment:this.environment,perform:t=>{m.FH({stores:[o],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),T.wd({environment:this.environment,collectionContextStore:t,action:"set_first_load_limit"}))}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=e.isFullScreen.get(),i=this.getCurrentViewType();if(!(t.collection_group_by||!o&&"calendar"!==i))return;const r=this.getCurrentFirstLoadLimit(),a=e.permissionScopes.state;return n()(Vt.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Load limit",id:"database.viewSettings.layoutTab.firstLoadLimitSetting"}),selectedKey:r,popupStyle:{minWidth:190},options:this.getFirstLoadLimitOptions(),onChange:this.handleFirstLoadLimitChange,disabled:!a.canConfigureBlock,icon:M.Z.arrowDown})}getFirstLoadLimitOptions(){return yt.jk.map((e=>({key:e,title:n()(d.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:e.limit},id:"database.viewSettings.layoutTab.limitPagesTitle"})})))}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getCurrentFirstLoadLimit(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state;return(0,yt.rx)(t.inline_collection_first_load_limit,Boolean(t.collection_group_by))}}Nt.displayName="CollectionSettingsFirstLoadLimit";const Ot=(0,d.injectIntl)(Nt);var Ut=o(96486),Ht=o.n(Ut),zt=o(14714),Wt=o(49865),jt=o(92918),Kt=o(33665),Yt=o(38769),Gt=o(75498),Xt=o(21269),qt=o(79131),$t=o(5145),Jt=o(28992),Qt=o(86825),eo=o(19387);class to extends l.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:ut.default.of(void 0),groupsLimit:ut.default.of(jt.XD)},this.handleHideEmptyGroupsClick=()=>{const{groupByKey:e,collectionContextStore:t,groupsFormatKey:o}=this.props,i=this.getGroupBy(),n=this.groupsDisplayStateStore.state;if(!n)return;const{currentGroups:r}=n,a=t.collectionViewStore();if(!i||!a)return;const s=!i.hideEmptyGroups;g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleHideEmptyGroupsClick",environment:this.environment,perform:n=>{if(s){const e=r.map((e=>!1===e.hidden?{...e,hidden:void 0}:e));Wt.A6({collectionContextStore:t,newGroups:e,groupsFormatKey:o,transaction:n})}m.FH({stores:[a],update:{[e]:{...i,hideEmptyGroups:s}},transaction:n})}}),T.wd({environment:this.environment,collectionContextStore:t,action:"toggle_hide_empty_groups"})},this.handleHideAllClick=()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=this.groupsDisplayStateStore.state;if(!o)return;const{currentGroups:i}=o,n=i.map((e=>({...e,hidden:!0})));this.stores.groupsLimit.set(jt.XD),g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleHideAllClick",environment:this.environment,perform:o=>{Wt.A6({collectionContextStore:e,newGroups:n,groupsFormatKey:t,transaction:o})}}),T.wd({environment:this.environment,collectionContextStore:e,action:"click_groups_hide_all"})},this.handleShowAllClick=()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=this.groupsDisplayStateStore.state;if(!o)return;const{currentGroups:i}=o,n=i.map((e=>({...e,hidden:!1})));this.stores.groupsLimit.set(jt.XD),g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleShowAllClick",environment:this.environment,perform:o=>{Wt.A6({collectionContextStore:e,newGroups:n,groupsFormatKey:t,transaction:o})}}),T.wd({environment:this.environment,collectionContextStore:e,action:"click_groups_show_all"})},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o,groupsFormatKey:i}=this.props,n=this.groupsDisplayStateStore.state;if(!n)return;const{currentGroups:r}=n,a=r.filter((t=>e.indexOf((0,zt.mD)(t))<0)),s=r.filter((t=>e.indexOf((0,zt.mD)(t))>=0)),l=Ht().sortBy(s,(t=>{const o=e.indexOf((0,zt.mD)(t));return o>=0?o:1/0})),c=t?[...a,...l]:[...l,...a];g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleGroupReorder",environment:this.environment,perform:e=>{Wt.A6({collectionContextStore:o,newGroups:c,groupsFormatKey:i,transaction:e})}}),p.trackConfigureView(this.environment,{view_type:this.getCurrentViewType(),action:t?"reorder_hidden_groups":"reorder_groups"})},this.handleToggleGroupVisibility=e=>{const{collectionContextStore:t,groupsFormatKey:o}=this.props,i=this.groupsDisplayStateStore.state;if(!i)return;const{currentGroups:n}=i,r=n.map((t=>(0,zt.ZH)(t,e)?{...e,hidden:!(0,zt.eF)(e)}:t));g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleToggleGroupVisibility",environment:this.environment,perform:e=>{Wt.A6({collectionContextStore:t,newGroups:r,groupsFormatKey:o,transaction:e})}}),T.wd({environment:this.environment,collectionContextStore:t,action:"toggle_group_visibility"})},this.handleSortTypeChange=e=>{const{collectionContextStore:t,groupByKey:o}=this.props,i=this.getGroupBy(),n=t.collectionViewStore();if(i&&n){if("formula"===i.type){const t={...i,groupBy:{...i.groupBy,sort:{type:e}}};g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleSortTypeChange",environment:this.environment,perform:e=>{m.FH({stores:[n],update:{[o]:t},transaction:e})}})}else g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleSortTypeChange",environment:this.environment,perform:t=>{m.FH({stores:[n],update:{[o]:{...i,sort:{type:e}}},transaction:t})}});T.wd({environment:this.environment,collectionContextStore:t,action:"update_group_sort"})}},this.handleTextGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:i}=this.props,n=this.getGroupBy(),r=t.collectionViewStore();if(!n||!r)return;const a=lo(n);if(a){if((0,zt.aB)(n))g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleTextGroupByTypeChange",environment:this.environment,perform:t=>{m.FH({stores:[r],update:{[o]:{...n,groupBy:e},[i]:void 0},transaction:t})}});else if("formula"===n.type){const t={...Ht().omit(a,"property"),groupBy:e},s={...n,groupBy:t};g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleTextGroupByTypeChange",environment:this.environment,perform:e=>{m.FH({stores:[r],update:{[o]:s,[i]:void 0},transaction:e})}})}T.wd({environment:this.environment,collectionContextStore:t,action:"update_text_group_by"})}},this.handleDateGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:i}=this.props,n=this.getGroupBy(),r=t.collectionViewStore();if(!n||!r)return;const a=so(n);if(a){if((0,zt.ib)(n))g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleDateGroupByTypeChange",environment:this.environment,perform:t=>{m.FH({stores:[r],update:{[o]:{...n,groupBy:e},[i]:void 0},transaction:t})}});else if("formula"===n.type){const t={...Ht().omit(a,"property"),type:"date",groupBy:e},s={...n,groupBy:t};g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleDateGroupByTypeChange",environment:this.environment,perform:e=>{m.FH({stores:[r],update:{[o]:s,[i]:void 0},transaction:e})}})}T.wd({environment:this.environment,collectionContextStore:t,action:"update_date_group_by"})}},this.handleStatusGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:i}=this.props,n=this.getGroupBy(),r=t.collectionViewStore();n&&r&&"status"===(null==n?void 0:n.type)&&(g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleStatusGroupByTypeChange",environment:this.environment,perform:t=>{m.FH({stores:[r],update:{[o]:{...n,groupBy:e},[i]:void 0},transaction:t})}}),T.wd({environment:this.environment,collectionContextStore:t,action:"update_status_group_by"}))},this.handleRemoveClick=()=>{const{collectionContextStore:e,groupByKey:t,groupsFormatKey:o}=this.props,i=e.collectionViewStore();i&&(g.createAndCommit({userAction:"CollectionSettingsViewGroup.handleRemoveClick",environment:this.environment,perform:e=>{m.FH({stores:[i],update:{[t]:void 0,[o]:void 0},transaction:e})}}),T.wd({environment:this.environment,collectionContextStore:e,action:"click_remove_grouping"}))},this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=e.normalizedFormatStore.state,i=e.normalizedSchemaStore.state,n=e.remoteRequestStore.state,r=this.getGroupBy();if(r)return(0,jt.ej)({groupBy:r,schema:i,format:o,filter:null==n?void 0:n.loader.filter,groupsFormatKey:t,limit:this.stores.groupsLimit.get()})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=this.getGroupBy();if(o)return(0,zt.Qq)({schema:t,groupBy:o})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupsFormatKey:t,collectionContextStore:o}=this.props,i=o.normalizedFormatStore.state,n=o.normalizedSchemaStore.state,r=o.collectionViewBlockStore(),a=this.getGroupBy(),s=this.stores.reducerResultStore.state;if(!a||!r||!s)return;const l=this.stores.groupsLimit.get(),c=this.schemaGroupsStore.state,d=s.results,p=s?s.total:0,u=(0,jt.Cz)({groupBy:a,schema:n,formatGroups:i[t]||[],schemaGroups:c,reducerResults:d,getRecordValue:r.getRecordValue,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),m=u.filter((e=>!(0,zt.eF)(e))).slice(0,l),g=u.filter((e=>(0,zt.eF)(e)));return{currentGroups:[...m,...g],visibleGroups:m,hiddenGroups:g,total:p}}),!0)}renderComponent(){const{collectionContextStore:e,groupByKey:t}=this.props,o=this.getGroupBy(),i=e.normalizedSchemaStore.state;return s.createElement(F.ZP,a()({},this.props,{title:this.renderTitle()}),n()(H.Z,{},void 0,this.renderPropertyMenuButton(o),o&&ro({groupBy:o,schema:i})&&this.renderTypeMenuButton(o),o&&this.renderSortMenuButton(o),o&&this.renderAutoHideButton(o),o&&"board_columns_by"===t&&this.renderColorColumnsOption()),o&&this.renderGroupSortListReducer(),n()(H.Z,{topBorder:!0},void 0,o&&this.canRemoveGrouping()&&n()(L.Z,{isGray:!0,icon:M.Z.trash,title:n()(d.FormattedMessage,{defaultMessage:"Remove grouping",id:"database.viewSettings.groupTab.removeButton.title"}),onClick:this.handleRemoveClick,isRed:!0}),n()(Xt.Z,{href:(0,Kt.UY)("guides.databaseGroup"),title:n()(d.FormattedMessage,{defaultMessage:"Learn about grouping",id:"database.viewSettings.groupTab.learnMoreButton.title"}),analyticsFrom:"view_settings_group"})))}renderTitle(){const{collectionSettingsStore:e}=this.props,t=(0,y.n)(e);if(t&&"group"===t.type)return"collection_group_by"===t.groupByKey&&"board"===this.getCurrentViewType()?n()(d.FormattedMessage,{defaultMessage:"Sub-group",id:"database.viewSettings.groupTab.subGroup.title"}):n()(d.FormattedMessage,{defaultMessage:"Group",id:"database.viewSettings.groupTab.group.title"})}renderPropertyMenuButton(e){const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:i,groupsFormatKey:r}=this.props,a=t.normalizedSchemaStore.state,s=e?a[e.property]:void 0;return n()(L.Z,{title:io(i,this.getCurrentViewType()),showChevron:!0,right:oo(s),onClick:()=>{T.wd({environment:this.environment,collectionContextStore:t,action:"click_group_by_property",original_view_type:void 0,property_type:null==s?void 0:s.type}),u.H4({collectionSettingsStore:o,item:{type:"groupByProperty",groupByKey:i,groupsFormatKey:r}})},disabled:!this.canConfigureBlock()})}renderTypeMenuButton(e){const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:i,groupsFormatKey:r}=this.props,a=t.normalizedSchemaStore.state,s=this.canConfigureBlock(),l="formula"===e.type?{...e.groupBy,property:e.property}:e;return(0,zt.ib)(l)?n()(Vt.Z,{title:ao({groupBy:l,schema:a}),popupStyle:{minWidth:190},selectedKey:l.groupBy,options:zt.z8.map((e=>({key:e,title:mo(e)}))),onChange:this.handleDateGroupByTypeChange,disabled:!s}):(0,zt.aB)(l)?n()(Vt.Z,{title:ao({groupBy:l,schema:a}),popupStyle:{minWidth:190},selectedKey:l.groupBy,options:zt.Kp.map((e=>({key:e,title:go(e)}))),onChange:this.handleTextGroupByTypeChange,disabled:!s}):"number"===l.type?n()(L.Z,{title:ao({groupBy:l,schema:a}),showChevron:!0,right:po({groupBy:l,schema:a}),onClick:()=>{u.H4({collectionSettingsStore:o,item:{type:"groupByNumber",groupByKey:i,groupsFormatKey:r}})},disabled:!s}):"status"===l.type?n()(Vt.Z,{title:ao({groupBy:l,schema:a}),popupStyle:{minWidth:190},selectedKey:l.groupBy,options:zt.vu.map((e=>({key:e,title:uo(e)}))),onChange:this.handleStatusGroupByTypeChange,disabled:!s}):void 0}renderSortMenuButton(e){const t=(0,zt.YG)(e);if(t.length<=1)return;const o=(0,zt.mu)(e);return n()(Vt.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.groupTab.sort"}),popupStyle:{minWidth:190},selectedKey:o.type,options:t.map((t=>({key:t,title:no(e,t)}))),onChange:this.handleSortTypeChange,disabled:!this.canConfigureBlock()})}renderAutoHideButton(e){return n()(Qt.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Hide empty groups",id:"database.viewSettings.groupTab.hideEmptyGroups"}),on:Boolean(e.hideEmptyGroups),focused:!1,onClick:this.handleHideEmptyGroupsClick,disabled:!this.canConfigureBlock(),textWrapperStyle:{opacity:1}})}renderColorColumnsOption(){return n()(Qt.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Color columns",id:"database.viewSettings.groupTab.colorColumns"}),on:!this.getDisableBoardColorColumns(),focused:!1,onClick:()=>{u.iN({environment:this.environment,collectionContextStore:this.props.collectionContextStore})},disabled:!this.canConfigureBlock(),textWrapperStyle:{opacity:1}})}renderGroupSortListReducer(){const{groupsFormatKey:e}=this.props,t=this.reducerStore.state,o=this.groupsDisplayStateStore.state;return t?n()(Gt.Z,{id:`group_menu_${e}`,reducer:t,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderGroupSortListSections(o)}):this.renderGroupSortListSections(o)}renderGroupSortListSections(e){const t=this.getGroupBy();if(!t)return;if(!e)return n()(H.Z,{topBorder:!0,disableMobileBorders:!0,noTextOverflow:!0},void 0,n()("div",{style:{marginTop:6,display:"flex",alignItems:"center",flexDirection:"column"}},void 0,n()(tt.Z,{})));const o="manual"===(0,zt.mu)(t).type&&!this.environment.device.isMobile&&this.canConfigureBlock(),i=this.stores.groupsLimit.get(),{total:r,hiddenGroups:a,visibleGroups:l}=e,c=Math.min(jt.kW,r-a.length-l.length),p=c>0?n()(re.Z,{disabled:!1,focused:!1,style:{color:this.theme.mediumTextColor},icon:M.Z.dots({width:14,height:14}),title:n()(d.FormattedMessage,{id:"database.groupMenu.loadMoreButton.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:c}}),onClick:()=>{this.stores.groupsLimit.set(i+jt.kW)}}):void 0;return s.createElement(s.Fragment,null,e.visibleGroups.length>0&&n()(H.Z,{topBorder:!0,noTextOverflow:!0,isTitleUppercase:!1,title:n()("span",{style:{alignSelf:"center"}},void 0,n()(d.FormattedMessage,{id:"database.groupMenu.visibleGroups",defaultMessage:"Visible groups"})),right:n()(G.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:this.handleHideAllClick,disabled:!this.canConfigureBlock()},void 0,n()(d.FormattedMessage,{id:"database.groupMenu.hideAllGroups",defaultMessage:"Hide all"}))},void 0,this.renderGroupSortList({displayState:e,groups:e.visibleGroups,canReorder:o,isHidden:!1}),p),e.hiddenGroups.length>0&&n()(H.Z,{topBorder:!1,noTextOverflow:!0,isTitleUppercase:!1,title:n()(d.FormattedMessage,{id:"database.groupMenu.hiddenGroups",defaultMessage:"Hidden groups"}),right:n()(G.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:this.handleShowAllClick,disabled:!this.canConfigureBlock()},void 0,n()(d.FormattedMessage,{id:"database.groupMenu.showAllGroups",defaultMessage:"Show all"}))},void 0,this.renderGroupSortList({displayState:e,groups:e.hiddenGroups,canReorder:o,isHidden:!0})))}renderGroupSortList(e){const{displayState:t,groups:o,canReorder:i,isHidden:r}=e;return i?n()(qt.ZP,{direction:"vertical",keys:o.map((e=>(0,zt.mD)(e))),renderKey:(e,n)=>{const r=o[n];return this.renderGroupSortListItem({displayState:t,groupFormat:r,canReorder:i})},onDrop:e=>{this.handleGroupReorder(e,r)},disabled:!this.canConfigureBlock()}):o.map((e=>n()(s.Fragment,{},(0,zt.mD)(e),this.renderGroupSortListItem({displayState:t,groupFormat:e,canReorder:i}))))}renderGroupSortListItem(e){const{collectionContextStore:t}=this.props,{displayState:o,groupFormat:i,canReorder:r}=e,a=t.normalizedSchemaStore.state,s=(0,zt.eF)(i),l=this.getGroupBy();if(l)return n()(Jt.Z,{disabled:!this.canConfigureBlock(),title:n()("div",{style:{display:"flex",alignItems:"center"}},void 0,r&&n()($t.ZP,{iconSize:12,style:{marginRight:3}}),n()(Yt.Z,{groupBy:l,groupFormat:i,currentGroups:o.currentGroups,schema:a,disabled:!0,isHiddenGroup:!1,style:{padding:0},collectionContextStore:t})),right:n()(Se.Z,{icon:s?M.Z.eyeHide:M.Z.eye,iconStyle:{width:16,height:16},isDarkIconColor:!s,onClick:()=>{this.handleToggleGroupVisibility(i)},disabled:!this.canConfigureBlock()}),textWrapperStyle:{opacity:1}})}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}canRemoveGrouping(){return this.canConfigureBlock()&&(0,jt._1)({viewType:this.getCurrentViewType(),groupByKey:this.props.groupByKey})}canConfigureBlock(){const{collectionContextStore:e}=this.props;return e.permissionScopes.state.canConfigureBlock}getDisableBoardColorColumns(){return(0,jt.h6)(this.environment,this.props.collectionContextStore)}}function oo(e){return e?n()(eo.Z,{propertySchema:e,showIcon:!1}):n()(d.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.groupTab.noGroupingSetMessage"})}function io(e,t){return n()(d.FormattedMessage,"collection_group_by"===e&&"board"===t?{defaultMessage:"Sub-group by",id:"database.viewSettings.groupTab.subGroupProperty"}:{defaultMessage:"Group by",id:"database.viewSettings.groupTab.groupProperty"})}function no(e,t){return"manual"===t?n()(d.FormattedMessage,{defaultMessage:"Manual",id:"database.viewSettings.groupTab.sortType.manual"}):"ascending"===t?(0,zt.ib)(e)||"formula"===e.type&&"date"===e.groupBy.type?n()(d.FormattedMessage,{defaultMessage:"Oldest first",id:"database.viewSettings.groupTab.sortType.chronological"}):(0,zt.aB)(e)||"relation"===e.type||"formula"===e.type&&"text"===e.groupBy.type?n()(d.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.viewSettings.groupTab.sortType.alphabetical"}):n()(d.FormattedMessage,{defaultMessage:"Ascending",id:"database.viewSettings.groupTab.sortType.ascending"}):"descending"===t?(0,zt.ib)(e)||"formula"===e.type&&"date"===e.groupBy.type?n()(d.FormattedMessage,{defaultMessage:"Newest first",id:"database.viewSettings.groupTab.sortType.reverseChronological"}):(0,zt.aB)(e)||"relation"===e.type||"formula"===e.type&&"text"===e.groupBy.type?n()(d.FormattedMessage,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.groupTab.sortType.reverseAlphabetical"}):n()(d.FormattedMessage,{defaultMessage:"Descending",id:"database.viewSettings.groupTab.sortType.descending"}):void(0,ge.t1)(t)}function ro(e){const{groupBy:t,schema:o}=e,i=o[t.property];if(!i||!(0,zt.LG)(i))return;let n;if("formula"===i.type){var r;const e=null===(r=i.formula)||void 0===r?void 0:r.result_type;if(!e)return;n=e}else n=i.type;return(0,zt.A1)(n)||(0,zt.HB)(n)||"number"===n||"status"===n?n:void 0}function ao(e){const t=ro(e);if(t)return(0,zt.A1)(t)?n()(d.FormattedMessage,{defaultMessage:"Date by",id:"database.viewSettings.groupByTypeTab.dateBy"}):(0,zt.HB)(t)?n()(d.FormattedMessage,{defaultMessage:"Text by",id:"database.viewSettings.groupByTypeTab.textBy"}):"number"===t?n()(d.FormattedMessage,{defaultMessage:"Number by",id:"database.viewSettings.groupByTypeTab.numberBy"}):"status"===t?n()(d.FormattedMessage,{defaultMessage:"Status by",id:"database.viewSettings.groupByTypeTab.statusBy",description:"Group by the status group or options"}):void 0}function so(e){return(0,zt.ib)(e)?e:"formula"===e.type&&"date"===e.groupBy.type?e.groupBy:void 0}function lo(e){return(0,zt.aB)(e)?e:"formula"===e.type&&"text"===e.groupBy.type?e.groupBy:void 0}function co(e){return"number"===e.type?e:"formula"===e.type&&"number"===e.groupBy.type?{...e.groupBy,property:e.property}:void 0}function po(e){const{groupBy:t}=e,o=ro(e);if(o)if((0,zt.A1)(o)){const e=so(t);if(e)return mo(e.groupBy)}else if((0,zt.HB)(o)){const e=lo(t);if(e)return go(e.groupBy)}else if("number"===o){const e=co(t);if(e)return n()(d.FormattedMessage,{defaultMessage:"{start} to {end}",id:"database.groupMenu.numberGroupBy.range",values:{start:e.start,end:e.end}})}}function uo(e){return"group"===e?n()(d.FormattedMessage,{defaultMessage:"Group",id:"database.groupMenu.statusGroupBy.group",description:"Group by the status group for a status property"}):"option"===e?n()(d.FormattedMessage,{defaultMessage:"Option",id:"database.groupMenu.statusGroupBy.option",description:"Group by the options inside all groups for a status property"}):void(0,ge.t1)(e)}function mo(e){return"relative"===e?n()(d.FormattedMessage,{defaultMessage:"Relative",id:"database.groupMenu.dateGroupBy.relative"}):"day"===e?n()(d.FormattedMessage,{defaultMessage:"Day",id:"database.groupMenu.dateGroupBy.day"}):"week"===e?n()(d.FormattedMessage,{defaultMessage:"Week",id:"database.groupMenu.dateGroupBy.week"}):"month"===e?n()(d.FormattedMessage,{defaultMessage:"Month",id:"database.groupMenu.dateGroupBy.month"}):"year"===e?n()(d.FormattedMessage,{defaultMessage:"Year",id:"database.groupMenu.dateGroupBy.year"}):void(0,ge.t1)(e)}function go(e){return"exact"===e?n()(d.FormattedMessage,{defaultMessage:"Exact",id:"database.groupMenu.textGroupBy.exact"}):"alphabet_prefix"===e?n()(d.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.groupMenu.textGroupBy.alphabetical"}):void(0,ge.t1)(e)}to.displayName="CollectionSettingsViewGroup";const ho=(0,d.injectIntl)(to);var fo=o(1136);function vo(e){window.__c={n:"CollectionSettingsNotification"};const{title:t,icon:o,style:i,children:r,showCloseButton:a,onClose:s}=e,l=(0,_.Fg)();return n()("div",{style:{padding:"12px 16px",margin:"4px 12px",fontSize:12,background:l.accentColors.orange[50],borderRadius:6,...i}},void 0,t&&n()("div",{style:{display:"flex",marginBottom:2}},void 0,o,n()("div",{style:{fontWeight:he.Z.fontWeight.medium,flexGrow:1}},void 0,t),a&&n()(ve.Z,{onClick:s,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16}},void 0,M.Z.closeSmall({width:14,fill:l.mediumTextColor}))),r)}function yo(e){window.__c={n:"ContentOnlyEditorEducationPill"};const{style:t}=e,o=(0,_.Fg)(),i=(0,k.MO)(),r=n()("div",{style:{marginTop:1}},void 0,M.Z.locked({width:14,marginRight:8,height:void 0})),a=n()(Ye.Z,{style:{color:o.regularTextColor,lineHeight:he.Z.lineHeight.UISmall.desktop},isSmall:!0},void 0,n()(d.FormattedMessage,{defaultMessage:"You're a content editor",id:"database.viewSettings.mainTab.contentOnlyEditorPill.title"}));return n()(vo,{icon:r,title:a,style:i?{backgroundColor:o.sidebarBackground,boxShadow:o.plainButtonBoxShadow,margin:void 0,borderRadius:void 0,...t}:{background:"rgba(196, 196, 196, 0.13)",margin:"8px 14px",...t},showCloseButton:!1},void 0,n()(Ye.Z,{style:{marginLeft:22},isSmall:!0,isMultiline:!0},void 0,n()(d.FormattedMessage,{defaultMessage:"Content editors can edit pages, but cannot change view and database settings.",id:"database.viewSettings.mainTab.contentOnlyEditorPill.subtitle"})))}var bo=o(74420),So=o(76798),wo=o(32662);const ko=16717824e5,Co=(0,d.defineMessages)({viewNamePlaceholderMessage:{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNamePlaceholder.title"}});class _o extends l.Z{constructor(){super(...arguments),this.handleViewNameSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(o.getName()!==e&&g.createAndCommit({userAction:"CollectionSettingsViewMain.handleViewNameSubmit",environment:this.environment,perform:t=>{ct.iG({collectionViewStore:o,update:{name:e},transaction:t})}}),T.wd({environment:this.environment,collectionContextStore:t,action:"rename",original_view_type:o.getType()}))},this.handleViewIconSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(g.createAndCommit({userAction:"CollectionSettingsViewMain.handleViewIconSubmit",environment:this.environment,perform:t=>{ct.Uy({collectionViewBlockStore:o,icon:e,transaction:t})}}),T.wd({environment:this.environment,collectionContextStore:t,action:"change_icon",icon:e}))},this.handleDuplicateClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t,intl:o}=this.props,i=e.collectionViewStore();i&&(u.zt({environment:this.environment,collectionContextStore:e,collectionViewStore:i,collectionSettingsStore:t,intl:o}),T.wd({environment:this.environment,collectionContextStore:e,action:"click_duplicate",original_view_type:i.getType()}))},this.handleCopyLinkClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();t&&(u.Ol({environment:this.environment,collectionContextStore:e,collectionViewStore:t}),T.wd({environment:this.environment,collectionContextStore:e,action:"click_copy_link",original_view_type:t.getType()}))},this.handleDeleteClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewStore();o&&(u.TT({environment:this.environment,collectionContextStore:e,collectionViewStore:o,collectionSettingsStore:t,from:"view_settings"}),T.wd({environment:this.environment,collectionContextStore:e,action:"click_delete",original_view_type:o.getType()}))},this.handleToggleLockClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();t&&(bt.bo({environment:this.environment,store:t,lock:!t.isLocked()}),T.wd({environment:this.environment,collectionContextStore:e,action:"click_toggle_lock"}))},this.shouldRenderSourceStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore(),i=e.collectionViewStore();if(!t||!o||!i)return!1;if(t.isSyncedCollection())return!0;return void 0===o.getCollectionViewSourceCollectionStore()}))}renderComponent(){const{device:e}=this.environment,{collectionContextStore:t,selectViewNameInitial:o}=this.props,i=t.collectionViewStore(),r=t.collectionViewBlockStore();if(!i||!r)return;if(!i.isDefined())return;const l=t.permissionScopes.state,c=i.getFormat().collection_view_icon,p=i.getType(),u=n()(H.Z,{title:e.isMobile&&n()(d.FormattedMessage,{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNameSection.title"})},void 0,n()(mt.Z,{initialValue:i.getName()||"",placeholder:Z.default.formatMessage(Co.viewNamePlaceholderMessage),onBlur:this.handleViewNameSubmit,onSubmit:this.handleViewNameSubmit,focusInitial:o,selectAll:o,disabled:!l.canConfigureBlock,iconButton:{icon:e=>n()(fo.F,{color:"gray",viewIcon:c,viewType:p,style:{marginRight:6}}),iconStyle:{fill:ft.Lr[this.theme.mode].gray},enforceIconColor:"gray",onSubmit:this.handleViewIconSubmit}}));return"page"===i.getType()?s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"View options",id:"database.viewSettings.mainTab.title"})}),u):s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"View options",id:"database.viewSettings.mainTab.title"})}),this.renderContentOnlyEditorEducationPill(),u,e.isMobile?n()(H.Z,{topBorder:!0},void 0,this.renderSource(),this.renderLayout(),this.renderProperties(),this.renderFilter(),this.renderSort(),this.renderGroup(),this.renderSubGroup(),this.renderSubitem(),this.renderArrowsBy(),n()(Ot,{collectionContextStore:t})):s.createElement(s.Fragment,null,n()(H.Z,{},void 0,this.renderSource(),this.renderLayout()),n()(H.Z,{topBorder:!0},void 0,this.renderProperties(),this.renderFilter(),this.renderSort(),this.renderGroup(),this.renderSubGroup(),this.renderSubitem(),this.renderArrowsBy(),n()(Ot,{collectionContextStore:t}))),n()(H.Z,{topBorder:!0},void 0,this.renderNotificationAction(),this.renderLockAction(),this.renderCopyLinkAction(),this.renderDuplicateAction(),this.renderDeleteAction()),r.getAppContainerBlockStore()&&n()(H.Z,{topBorder:!0},void 0,this.renderEditSettingsAction()))}renderContentOnlyEditorEducationPill(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(t&&"content_only_editor"===t.getRole())return n()(yo,{})}renderLockAction(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(!t)return;const o=t.getCollectionViewSourceCollectionStore(),i=t.isLocked();if(!(o?o.canEditCollection():t.canEditCollection()))return;const r=null==t?void 0:t.isCollectionViewPageWithContent();return n()(L.Z,{icon:i?M.Z.unlocked:M.Z.locked,title:this.getLockUnlockTitle(o,r,i),onClick:this.handleToggleLockClick})}getLockUnlockTitle(e,t,o){return n()(d.FormattedMessage,t?o?{defaultMessage:"Unlock wiki",id:"action.unlockWikiName.name",description:"Unlock a wiki database that was previously locked"}:{defaultMessage:"Lock wiki",id:"action.lockWikiName.name",description:"Lock a wiki database"}:e?o?{defaultMessage:"Unlock database",id:"database.viewSettings.mainTab.unlockDatabase.title"}:{defaultMessage:"Lock database",id:"database.viewSettings.mainTab.lockDatabase.title"}:o?{defaultMessage:"Unlock views",id:"database.viewSettings.mainTab.unlockViews.title"}:{defaultMessage:"Lock views",id:"database.viewSettings.mainTab.lockViews.title"})}renderCopyLinkAction(){return n()(L.Z,{icon:M.Z.link,title:n()(d.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.mainTab.copyLinkButton.title"}),onClick:this.handleCopyLinkClick})}renderDuplicateAction(){const{collectionContextStore:e}=this.props;if(e.permissionScopes.state.canConfigureBlock&&"collectionTypedView"!==e.contextType)return n()(L.Z,{icon:M.Z.duplicate,title:n()(d.FormattedMessage,{defaultMessage:"Duplicate view",id:"database.viewSettings.mainTab.duplicateButton.title"}),onClick:this.handleDuplicateClick})}renderGroup(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=this.getCurrentViewType(),i="board"===o?{groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}:{groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},r=e.normalizedSchemaStore.state,a=e.normalizedFormatStore.state[i.groupByKey],s=e.permissionScopes.state;return"calendar"!==o&&n()(L.Z,{icon:"board"===o?M.Z.groupByHorizontal:M.Z.groupByVertical,title:n()(d.FormattedMessage,{defaultMessage:"Group",id:"database.viewSettings.mainTab.groupButton.title"}),showChevron:!0,right:oo(a?r[a.property]:void 0),onClick:()=>{var n;T.wd({environment:this.environment,collectionContextStore:e,action:"click_group",original_view_type:o,property_type:a?null===(n=r[a.property])||void 0===n?void 0:n.type:void 0}),u.H4({collectionSettingsStore:t,item:a?{type:"group",...i}:{type:"groupByProperty",...i}})},disabled:!a&&!s.canConfigureBlock})}renderSubGroup(){const e=this.getCurrentViewType(),{collectionContextStore:t,collectionSettingsStore:o}=this.props,i=t.normalizedSchemaStore.state,r=t.normalizedFormatStore.state.collection_group_by,a={groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},s=t.permissionScopes.state;return"board"===e&&n()(L.Z,{icon:M.Z.groupByVertical,title:n()(d.FormattedMessage,{defaultMessage:"Sub-group",id:"database.viewSettings.mainTab.subGroupButton.title"}),showChevron:!0,right:oo(r?i[r.property]:void 0),onClick:()=>{var n;T.wd({environment:this.environment,collectionContextStore:t,action:"click_subgroup",original_view_type:e,property_type:r?null===(n=i[r.property])||void 0===n?void 0:n.type:void 0}),u.H4({collectionSettingsStore:o,item:r?{type:"group",...a}:{type:"groupByProperty",...a}})},disabled:!r&&!s.canConfigureBlock})}shouldShowSubItemsBadge(){const{currentUserSettingsStore:e}=Ke.default.state;if(!e||!e.isReady())return!1;const t=e.getSettings();return!(null!=t&&t.signup_time&&(null==t?void 0:t.signup_time)>ko)&&(null==t||!t.seen_sub_tasks_new)}renderSubitem(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionStore();if(null!=o&&o.isSyncedCollection())return;if("collectionTypedView"===e.contextType)return;const i=this.getCurrentViewType();if(!(0,Ft.e$)(i))return;const r=e.normalizedSchemaStore.state,a=e.currentSubitemFormatStore.state,s=a?r[a.property]:void 0,l=e.permissionScopes.state;return n()(L.Z,{icon:M.Z.nest,title:n()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,n()(d.FormattedMessage,{defaultMessage:"Sub-items",id:"database.viewSettings.mainTab.subitems.title",description:"Title for menu item in database view settings to create display related items as sub-items."}),n()(wo.Z,{size:2}),this.shouldShowSubItemsBadge()&&n()(bo.Z,{})),showChevron:!0,right:n()("span",{style:{...he.Z.textOverflowStyle}},void 0,(null==s?void 0:s.name)??n()(d.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.subitemTab.none",description:"Label when no subitem option is selected."})),onClick:()=>{T.wd({environment:this.environment,collectionContextStore:e,action:"click_subitem"}),u.H4({collectionSettingsStore:t,item:{type:"subitem"}});const{currentUserSettingsStore:o}=Ke.default.state;o&&g.createAndCommit({userAction:"collectionSettingsViewMain.setSeenSubItemsNewBadge",environment:this.environment,perform:e=>{St.d2({userSettingsStore:o,transaction:e,data:{seen_sub_tasks_new:!0}})}})},disabled:!a&&!l.canConfigureBlock})}shouldShowDependenciesBadge(){const{currentUserSettingsStore:e}=Ke.default.state;if(!e||!e.isReady())return!1;const t=e.getSettings();return!(null!=t&&t.signup_time&&(null==t?void 0:t.signup_time)>ko)&&(null==t||!t.seen_dependencies_new)}renderArrowsBy(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props;if("collectionTypedView"===e.contextType)return;if("timeline"!==this.getCurrentViewType())return;const o=e.normalizedSchemaStore.state,i=e.currentArrowsByFormatStore.state,r=i?o[i]:void 0,a=e.permissionScopes.state;return Lt.default.checkGate("dependency_date_shifting")?this.renderDependencies():n()(L.Z,{icon:M.Z.arrowsDiverging,title:n()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,n()(d.FormattedMessage,{defaultMessage:"Dependencies",id:"database.viewSettings.mainTab.dependencies.title",description:"Title for menu item in database view settings to render dependent items as dependency arrows."}),n()(wo.Z,{size:2}),this.shouldShowDependenciesBadge()&&n()(bo.Z,{})),showChevron:!0,right:n()("span",{style:{...he.Z.textOverflowStyle}},void 0,(null==r?void 0:r.name)??n()(d.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.arrowsByTab.none",description:"Label when no dependencies option is selected."})),onClick:()=>{T.wd({environment:this.environment,collectionContextStore:e,action:"click_timeline_arrows_by"}),u.H4({collectionSettingsStore:t,item:{type:"arrowsBy"}});const{currentUserSettingsStore:o}=Ke.default.state;o&&g.createAndCommit({userAction:"collectionSettingsViewMain.setSeenDependenciesNewBadge",environment:this.environment,perform:e=>{St.d2({userSettingsStore:o,transaction:e,data:{seen_dependencies_new:!0}})}})},disabled:!i&&!a.canConfigureBlock})}renderDependencies(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.normalizedSchemaStore.state,i=e.currentArrowsByFormatStore.state,r=i?o[i]:void 0,a=e.permissionScopes.state;return n()(L.Z,{icon:M.Z.redo,title:n()(d.FormattedMessage,{defaultMessage:"Dependencies",id:"database.viewSettings.mainTab.newDependencies.title",description:"Collection settings menu item to create and manage dependencies"}),right:n()(d.FormattedMessage,r?{id:"database.viewSettings.mainTab.dependencies.added",defaultMessage:"Added",description:"Collection settings menu item to create and manage dependencies - message when dependencies exist."}:{id:"database.viewSettings.mainTab.dependencies.none",defaultMessage:"None",description:"Collection settings menu item to create and manage dependencies - message when there are no dependencies."}),showChevron:!0,onClick:()=>{u.H4({collectionSettingsStore:t,item:{type:"dependencies",viewType:r?"edit":"setup"}})},disabled:!i&&!a.canConfigureBlock})}renderNotificationAction(){if(!(0,f.F6)())return;if(!function(e){return!!e&&(!!Zt({collectionStore:e})||e.getAutomationStores().length>0)}(this.props.collectionContextStore.collectionStore()))return;const{collectionSettingsStore:e}=this.props,t=this.props.collectionContextStore.aliveSlackAutomationCount.state;return n()(L.Z,{icon:M.Z.bell,title:n()(d.FormattedMessage,{defaultMessage:"Slack notifications",id:"database.viewSettings.mainTab.slackNotifications.title",description:"Collection settings menu item to configure slack notifications"}),right:t>0?s.createElement(s.Fragment,null,t.toString()):n()(d.FormattedMessage,{id:"database.viewSettings.mainTab.slackNotifications.none",defaultMessage:"None",description:"Collection settings menu item to configure slack notifications - message when there are no configured options yet."}),showChevron:!0,onClick:()=>{t>0?u.H4({collectionSettingsStore:e,item:{type:"slackAutomations"}}):u.H4({collectionSettingsStore:e,item:{type:"createSlackAutomation"}})}})}renderDeleteAction(){const{collectionContextStore:e}=this.props;if(!e.collectionViewBlockStore())return;return e.permissionScopes.state.canConfigureBlock&&"collectionTypedView"!==e.contextType?n()(L.Z,{icon:M.Z.trash,title:n()(d.FormattedMessage,{defaultMessage:"Delete view",id:"database.viewSettings.mainTab.deleteButton.title"}),isRed:!0,onClick:this.handleDeleteClick}):void 0}renderEditSettingsAction(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(!t)return;return e.permissionScopes.state.canConfigureBlock?n()(L.Z,{icon:M.Z.options,title:n()(d.FormattedMessage,{defaultMessage:"Edit {databaseName} settings",id:"CollectionSettingsViewMain.editSettings",values:{databaseName:n()(So.Z,{store:t,style:{display:"inline"}})},description:"Main menu for database view block settings"}),onClick:()=>{u.tS({environment:this.environment,store:t}),u.E3({collectionSettingsStore:e.settingsStore})}}):void 0}renderSource(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionStore(),i=e.collectionViewBlockStore();if(!o||!i)return;if(!this.shouldRenderSourceStore.state)return;const r=o.getIcon();return n()(L.Z,{icon:M.Z.folder,title:n()(d.FormattedMessage,{defaultMessage:"Source",id:"database.viewSettings.mainTab.sourceButton.title"}),showChevron:!0,right:s.createElement(s.Fragment,null,r&&n()($e.Z,{icon:r,isEmptyPage:!1,size:20,disabled:!0,style:{marginRight:4,opacity:.6}}),n()(So.Z,{store:o,style:{display:"inline",wordBreak:"break-word",...he.Z.textOverflowStyle}})),onClick:()=>{T.wd({environment:this.environment,collectionContextStore:e,action:"click_source"}),u.H4({collectionSettingsStore:t,item:{type:"source"}})}})}renderLayout(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewStore();if(!o)return;const i=o.getType();return i?n()(L.Z,{icon:M.Z.layoutPadded,isPadded:!0,title:n()(d.FormattedMessage,{defaultMessage:"Layout",id:"database.viewSettings.mainTab.layoutButton.title"}),showChevron:!0,right:wt.Bh[i],onClick:()=>{T.wd({environment:this.environment,collectionContextStore:e,action:"click_layout"}),u.H4({collectionSettingsStore:t,item:{type:"layout"}})}}):void 0}renderProperties(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=(e.normalizedFormatStore.state[(0,yt.oz)(this.getCurrentViewType())]||[]).filter((e=>Boolean(e.visible))).length;return n()(L.Z,{icon:M.Z.properties,title:n()(d.FormattedMessage,{defaultMessage:"Properties",id:"database.viewSettings.mainTab.propertiesButton.title"}),showChevron:!0,right:n()(d.FormattedMessage,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.mainTab.propertiesButton.propertiesShown.title",values:{propertiesShown:o}}),onClick:()=>{T.wd({environment:this.environment,collectionContextStore:e,action:"click_properties"}),u.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}})}})}renderFilter(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.permissionScopes.state,i=e.currentPropertyFiltersStore.state.length+(e.currentCombinatorFilterStore.state&&o.canConfigureBlock?1:0);return n()(L.Z,{icon:M.Z.filterCircled,title:n()(d.FormattedMessage,{defaultMessage:"Filter",id:"database.viewSettings.mainTab.filterButton.title"}),showChevron:!0,right:n()(d.FormattedMessage,i>0?{defaultMessage:"{numberOfFilters, plural, one {{numberOfFilters} filter} other {{numberOfFilters} filters}}",values:{numberOfFilters:i},id:"database.viewSettings.mainTab.filterButton.filters.title"}:{defaultMessage:"None",id:"database.viewSettings.mainTab.filterButton.noFilters.title"}),onClick:()=>{T.wd({environment:this.environment,collectionContextStore:e,action:"click_filters"}),0===i?u.H4({collectionSettingsStore:t,item:{type:"createFilter"}}):u.H4({collectionSettingsStore:t,item:{type:"filters"}})}})}renderSort(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.currentSortsStore.state.length;return n()(L.Z,{icon:M.Z.sortPadded,isPadded:!0,title:n()(d.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.mainTab.sortButton.title"}),showChevron:!0,right:n()(d.FormattedMessage,o>0?{defaultMessage:"{numberOfSorts, plural, one {{numberOfSorts} sort} other {{numberOfSorts} sorts}}",values:{numberOfSorts:o},id:"database.viewSettings.mainTab.sortButton.oneOrMoreSorts.title"}:{defaultMessage:"None",id:"database.viewSettings.mainTab.sortButton.noSorts.title"}),onClick:()=>{T.wd({environment:this.environment,collectionContextStore:e,action:"click_sort"}),0===o?u.H4({collectionSettingsStore:t,item:{type:"createSort"}}):u.H4({collectionSettingsStore:t,item:{type:"sort"}})}})}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}}_o.displayName="CollectionSettingsViewMain";const Mo=(0,d.injectIntl)(_o);class To extends l.Z{constructor(){super(...arguments),this.handleViewNameBlur=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&o.getName()!==e&&g.createAndCommit({userAction:"CollectionSettingsCreateView.handleViewNameBlur",environment:this.environment,perform:t=>{ct.iG({collectionViewStore:o,update:{name:e},transaction:t})}})},this.handleViewNameSubmit=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.handleViewNameBlur(e),u.wl({collectionSettingsStore:t,item:{type:"main"}}),T.wd({environment:this.environment,collectionContextStore:o,action:"rename"})},this.handleViewIconSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(g.createAndCommit({userAction:"CollectionSettingsCreateView.handleViewIconSubmit",environment:this.environment,perform:t=>{ct.Uy({collectionViewBlockStore:o,icon:e,transaction:t})}}),T.wd({environment:this.environment,collectionContextStore:t,action:"change_icon",icon:e}))}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,{device:o}=this.environment,i=e.collectionViewStore();if(!i)return;if(!i.isDefined())return;const r=i.getFormat().collection_view_icon,l=i.getType();return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.title"}),desktopWidth:290}),n()(H.Z,{},void 0,n()(mt.Z,{initialValue:"",placeholder:Z.default.formatMessage(Co.viewNamePlaceholderMessage),focusInitial:!o.isMobile||void 0,onBlur:this.handleViewNameBlur,iconButton:{icon:e=>n()(fo.F,{color:"gray",viewIcon:r,viewType:l,style:{marginRight:6}}),iconStyle:{fill:ft.Lr[this.theme.mode].gray},enforceIconColor:"gray",onSubmit:this.handleViewIconSubmit},onSubmit:this.handleViewNameSubmit})),n()(vt.Z,{collectionContextStore:e,collectionSettingsStore:t,showDoneButton:!o.isMobile}))}}To.displayName="CollectionSettingsCreateView";const Io=(0,d.injectIntl)(To);var Po=o(49670),xo=o(39068),Bo=o(78316);class Zo extends l.Z{renderComponent(){return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"Deleted properties",id:"database.viewSettings.propertyTab.deletedTitle",description:"Title text to view deleted properties from a database."})}),this.renderContent())}renderContent(){const{collectionContextStore:e}=this.props,t=e.normalizedDeletedSchemaStore.state,o=Object.entries(t).map((e=>{let[t,o]=e;if(o)return{propertyId:t,propertySchema:o}})).filter(ge.$K);if(0===o.length)return n()(H.Z,{},void 0,n()(Jt.Z,{title:n()(d.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.deletedPropertiesTab.noResults"})}));const{theme:i}=this;return n()(H.Z,{},void 0,o.map((e=>{let{propertyId:t,propertySchema:o}=e;return n()(Jt.Z,{title:n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()(xo.ZP,{type:o.type,icon:o.icon,size:16,theme:i,style:{fill:i.regularIconColor}}),n()("span",{style:{marginLeft:6,maxWidth:200,...he.Z.textOverflowStyle}},void 0,o.name)),right:s.createElement(s.Fragment,null,n()(Se.Z,{icon:M.Z.undo,iconStyle:{marginRight:2},onClick:()=>{this.handleRestoreDeletedPropertyClick(t)}}),n()(Se.Z,{icon:M.Z.trash,onClick:()=>{this.handlePermanentlyDeleteDeletedPropertyClick(t)}}))},t)})))}handleRestoreDeletedPropertyClick(e){const{formatKey:t,collectionSettingsStore:o,collectionContextStore:i,collectionPointer:r}=this.props,a=i.collectionStore();if(a){const i=Bo.D8({deletedSchema:a.getDeletedSchema(),property:e});if(i){var s;if("verification"===(null===(s=a.getDeletedSchema()[e])||void 0===s?void 0:s.type)){const e=a.getSchema();if(Object.keys(e).some((t=>{var o;return"verification"===(null===(o=e[t])||void 0===o?void 0:o.type)})))return void He.showDialog({message:n()(d.FormattedMessage,{id:"database.deletedPropertiesTab.cannotRestoreDuplicateProperty.modal.verification",defaultMessage:"You can only have one verification property.",description:"Text for a modal that tells the user they cannot restore a deleted verification property because their database already has one."}),showCancel:!1,keepFocus:!0,items:[{label:n()(d.FormattedMessage,{id:"database.deletedPropertiesTab.cannotRestoreDuplicateProperty.modal.dismissButton",defaultMessage:"Dismiss",description:"Dismiss button for a modal that tells the user they cannot restore a deleted property because one already exists on the database."}),onAccept:()=>{}}]})}g.createAndCommit({userAction:"CollectionSettingsDeletedProperties.handleRestoreDeletedPropertyClick",environment:this.environment,perform:e=>{ct.xO({environment:this.environment,collectionStore:a,update:i.updateSchema,transaction:e}),ct.$N({collectionStore:a,update:i.updateDeletedSchema,transaction:e})}}),u.z$({collectionSettingsStore:o}),u.H4({collectionSettingsStore:o,item:{type:"property",property:e,formatKey:t,collectionPointer:r}})}}}handlePermanentlyDeleteDeletedPropertyClick(e){He.showDialog({message:n()(d.FormattedMessage,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteProperty.modal.prompt",defaultMessage:"Are you sure you want to delete this property?"}),showCancel:!0,keepFocus:!0,items:[{label:n()(d.FormattedMessage,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:()=>{const t=this.props.collectionContextStore.collectionStore();t&&g.createAndCommit({userAction:"CollectionSettingsDeletedProperties.handlePermanentlyDeleteDeletedPropertyClick",environment:this.environment,perform:o=>{ct.$N({collectionStore:t,update:{[e]:null},transaction:o})}})}}]})}}Zo.displayName="CollectionSettingsDeletedProperties";const Eo=(0,d.injectIntl)(Zo);var Ro=o(52936);var Ao=o(11066);function Do(e){window.__c={n:"CollectionSettingsViewDependenciesMenu"};const{collectionContextStore:t,type:o,collectionSettingsStore:i,collectionStore:r}=e,l=(0,C.VK)((()=>{const e=r.getFormatStore().getKeyStore("dependency_date_shifting_config").getValue();return null==e?void 0:e.mode}),[r]),c=(0,C.VK)((()=>function(e){const{collectionContextStore:t,collectionStore:o}=e,i=o.getFormat().collection_default_arrows_by;return t.currentArrowsByFormatStore.state===i}({collectionStore:r,collectionContextStore:t})),[t,r]),p=function(){const e=(0,k.Fy)(),t=e.isMobile?he.Z.fontSize.UISmall.mobile:he.Z.fontSize.UISmall.desktop;return(0,_.yK)((e=>({captionText:{fontSize:t,color:e.mediumTextColor,fontWeight:he.Z.fontWeight.regular,margin:"0px 8px 6px 8px"},dateShiftingSectionCaption:{fontSize:t,fontWeight:he.Z.fontWeight.medium,color:e.mediumTextColor,margin:"6px 8px 6px 8px"},dateShiftingSectionButtons:{display:"flex"},addDependenciesButton:{width:"100%",marginTop:6},sectionMenuItemContainer:{paddingLeft:8,paddingRight:8,width:"100%"}})),[t])}(),m=(0,ye.F)({width:280});let g;return"edit"===o?g={key:"dependencies-action-buttons-section",items:[{key:"dependencies-advanced-settings-button",render:e=>n()(L.Z,{icon:M.Z.settings,isGray:!0,title:n()(d.FormattedMessage,{id:"collectionSettings.dependenciesView.advancedSettingsButton.label",defaultMessage:"Advanced settings",description:"Button to enter advanced settings view for dependencies."}),onClick:()=>{}}),action:()=>{}},{key:"dependencies-delete-button",render:e=>n()(L.Z,{icon:M.Z.trash,isRed:!0,isGray:!0,title:n()(d.FormattedMessage,{id:"collectionSettings.dependenciesView.deleteDependenciesButton.label",defaultMessage:"Delete dependencies",description:"Button to delete dependencies."}),onClick:()=>{}}),action:()=>{}}],render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0}))}:"setup"===o?g=function(e){const{styles:t,collectionSettingsStore:o}=e;return{key:"add-dependencies-button-section",items:[{key:"add-dependencies-button",render:()=>n()(et.Z,{style:t.addDependenciesButton,onClick:()=>{u.H4({collectionSettingsStore:o,item:{type:"arrowsBy"}})}},void 0,n()(d.FormattedMessage,{id:"collectionSettings.dependenciesView.addDependenciesButton.label",defaultMessage:"Add dependencies",description:"Label for the add dependencies button."})),action:()=>{}}],render:e=>s.createElement(H.Z,a()({},e,{style:t.sectionMenuItemContainer}))}}({styles:p,collectionSettingsStore:i}):(0,ge.t1)(o),s.createElement(O.Z,m,n()(ae.Z,{type:ae.i.Vertical,sections:Ht().compact([Fo(p),c&&Lo({styles:p,currentDateShiftingMode:l,collectionStore:r}),g]),initialFocus:0}))}function Fo(e){return{key:"dependencies-caption-section",items:[{key:"dependencies-caption",render:()=>n()("div",{style:e.captionText},void 0,n()(d.FormattedMessage,{id:"collectionSettings.dependenciesView.caption",defaultMessage:"Use dependencies to show tasks that are blocking — or blocked by — other tasks.",description:"Caption for the collection settings dependencies view."})),action:()=>{}}],render:t=>s.createElement(H.Z,a()({},t,{style:{...e.sectionMenuItemContainer,paddingTop:0}}))}}function Lo(e){const{styles:t,currentDateShiftingMode:o,collectionStore:i}=e;return{key:"dependencies-date-shifting-buttons-section",items:[{key:"date-shifting-section-caption",render:e=>n()("div",{style:t.dateShiftingSectionCaption},void 0,n()(d.FormattedMessage,{id:"collectionSettings.dependenciesView.dateShiftingSection.caption",defaultMessage:"Automatic date shifting",description:"Caption for the date shifting section."})),action:()=>{}},{key:"date-shifting-buttons-menu-item",render:e=>{const r=[...Ro.B,void 0].map((e=>n()(Vo,{title:No(e),dateShiftingMode:e,selectedDateShiftingMode:o,collectionStore:i},e??"none")));return n()("div",{style:t.dateShiftingSectionButtons},void 0,r)},action:()=>{}}],render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0,style:t.sectionMenuItemContainer}))}}function Vo(e){window.__c={n:"DateShiftButton"};const{dateShiftingMode:t,selectedDateShiftingMode:o,collectionStore:i,title:r}=e,a=(0,k.O7)(),s=t===o,l=(0,_.yK)((e=>({buttonStyles:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",flexGrow:1,flexBasis:0,flexShrink:0,fontSize:12,borderRadius:3,margin:6,padding:6,boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.mediumTextColor,fill:e.mediumTextColor,...s&&{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor,fill:e.blueColor,fontWeight:500}}})),[s]);return n()(Ao.Z,{style:l.buttonStyles,disabled:!1,onClick:()=>{s||function(e){const{environment:t,dateShiftingMode:o,collectionStore:i}=e,n=o,r=i.getSchema(),a=Object.keys(i.getSchema()).find((e=>{var t;return"date"===(null===(t=r[e])||void 0===t?void 0:t.type)}));if(!a)return;g.createAndCommit({environment:t,userAction:"CollectionSettingsViewDependenciesMenu.handleDateShiftingButtonClick",perform:e=>{n?dt.sW({store:i.getFormatStore().getKeyStore("dependency_date_shifting_config"),data:{mode:n,date_property:a},transaction:e}):dt.sW({store:i.getFormatStore(),data:{dependency_date_shifting_config:null},transaction:e})}})}({environment:a,dateShiftingMode:t,collectionStore:i})},onMouseMove:()=>{}},void 0,n()("div",{},void 0,r))}function No(e){return n()(d.FormattedMessage,"consume_gap"===e?{id:"collectionSettings.dependenciesView.dateShiftingButton.consumeGap.label",defaultMessage:"Consume buffer",description:"Label for the date shifting button for consume gap mode."}:"preserve_gap"===e?{id:"collectionSettings.dependenciesView.dateShiftingButton.preserveGap.label",defaultMessage:"Maintain buffer",description:"Label for the date shifting button for preserve gap mode."}:{id:"collectionSettings.dependenciesView.dateShiftingButton.doNotShift.label",defaultMessage:"Do not shift",description:"Label for the date shifting button when date shifting should not occur."})}function Oo(e){window.__c={n:"CollectionSettingsViewDependencies"};const{collectionSettingsStore:t,collectionContextStore:o,type:i}=e,r=(0,C.VK)((()=>o.collectionStore()),[o]);return r?n()(F.ZP,{title:n()(d.FormattedMessage,{defaultMessage:"Dependencies",id:"database.viewSettings.mainTab.dependencies.title",description:"Title for menu item in database view settings to render dependent items as dependency arrows."}),collectionContextStore:o,collectionSettingsStore:t,fullHeight:!0},void 0,n()(Do,{collectionContextStore:o,collectionSettingsStore:t,collectionStore:r,type:i})):null}var Uo=o(83319),Ho=o(3865),zo=o(45953),Wo=o(98963),jo=o(18844),Ko=o(6287),Yo=o(13493),Go=o(3815);const Xo=(0,d.defineMessages)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Are you sure you want to delete {automationName}?",description:"Confirmation description to remove an automation configuration from a database."},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete",description:"Confirmation message to remove an automation configuration from a database."}});function qo(e){const{environment:t,currentState:o,automationStore:i}=e,n=i.getSpaceId();o&&n&&g.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.saveAutomationFormState",perform:e=>{!function(e){const{automationStore:t,spaceId:o,currentState:i,transaction:n}=e,{name:r,sourcePointer:a,triggers:s,actions:l}=i,c=t.getKeyStore("properties");dt.sW({store:c,data:{name:r},transaction:n});const d=t.getTriggerStore().getKeyStore("event"),[p,u,...m]=s;let g;g=u?{type:"any"}:0===m.length?{type:"none"}:{type:"some",some:m};dt.sW({store:d,data:{source:{type:a.table,pointer:a},pagesAdded:Boolean(p),pagePropertiesEdited:g},transaction:n});const h=[];for(const f of l){const e=f.id,i={id:e,table:jo.Xj,spaceId:o};h.push(e);const r=Go.zq.createChildStore(t,i),a={...f,space_id:o,parent_table:Wo.cv,parent_id:t.id,alive:!0};dt.sO({store:r,value:a,transaction:n})}dt.sW({store:t,data:{action_ids:h},transaction:n})}({automationStore:i,spaceId:n,currentState:o,transaction:e})}})}function $o(e){const{environment:t,collectionStore:o,currentState:i}=e;if(!i)return;const n=o.getSpaceId();g.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.createAutomationFromFormState",perform:e=>{const t=(0,c.ZP)();g.applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t}},transaction:e});const r={id:t,table:Wo.cv,spaceId:n},a=Go.Mz.createChildStore(o,r),{name:s,sourcePointer:l,triggers:d,actions:p,triggerType:u}=i,[m,h,...f]=d;let v;v=h?{type:"any"}:0===f.length?{type:"none"}:{type:"some",some:f};const y=[];for(const o of p){const t=o.id,i={id:t,table:jo.Xj,spaceId:n};y.push(t);const r=Go.zq.createChildStore(a,i),s={...o,space_id:n,parent_table:Wo.cv,parent_id:a.id,alive:!0};dt.sO({store:r,value:s,transaction:e})}const b={id:t,space_id:n,parent_table:o.table,parent_id:o.id,alive:!0,status:"active",properties:{name:s},trigger:{id:(0,c.ZP)(),type:u,event:{source:{type:l.table,pointer:l},pagesAdded:Boolean(m),pagePropertiesEdited:v}},action_ids:y};dt.sO({store:a,value:b,transaction:e})}})}async function Jo(e){const{intl:t,environment:o,collectionStore:i,existingAutomationStore:n,parentCollectionId:r,triggerType:a,onDelete:s}=e,l=n.getNameWithDefault(t);await He.confirmUserAction({message:t.formatMessage(Xo.automationDeleteConfirmationMessage,{automationName:l}),acceptLabel:t.formatMessage(Xo.automationDeleteAcceptLabel)})&&(!function(e){const{environment:t,triggerType:o,collectionStore:i,existingAutomationStore:n,parentCollectionId:r}=e;g.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",perform:e=>{const t=i.getFormatStore().getKeyStore("automation_ids");g.applyOperation({store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:n.id}},transaction:e}),dt.sW({store:n,data:{alive:!1},transaction:e})}}),"notification_event"===o&&p.trackSlackNotificationDelete(t,{type:"granular",source:"collection_view_settings",collection_id:r})}({environment:o,triggerType:a,collectionStore:i,existingAutomationStore:n,parentCollectionId:r}),null==s||s())}var Qo=o(64964),ei=o(42402);function ti(e){const{automationPermissionScope:t,automationStatus:o,automationCreatorName:i,referencesIncompatibleCollectionViewFilter:r,onDelete:a,onResume:s}=e,l=ii();if("edit"===t){if("disabled"===o||"disabled_permissions"===o)return n()(oi,{icon:M.Z.warning(l.warningIcon),message:n()(d.FormattedMessage,{id:"AutomationSlackHeaderView.header.disabled.owner",defaultMessage:"This notification has been paused. <resumeAction>Resume notifications</resumeAction>",description:"Indicates that notifications have been paused for this automation. Prompts the owner of these notifications to resume them.",values:{resumeAction:e=>n()(ei.Z,{disableUnderline:!0,style:l.link,onClick:()=>{s()}},void 0,n()("br",{}),e)}})});if(r)return n()(oi,{icon:M.Z.warning(l.warningIcon),message:n()(d.FormattedMessage,{id:"AutomationSlackHeaderView.incompatibleCollectionViewFilter.owner",defaultMessage:"This rule may not work because the view has a non-supported filter.",description:"Caption for warning the user that the selected collection view has incompatible filters and may not work properly."})})}else{if("readonly"===t)return n()(oi,"active"===o?{icon:M.Z.personBadgeQuestionMark(l.personBadgeQuestionMark),message:n()(d.FormattedMessage,{id:"AutomationSlackHeaderView.active.readonly",defaultMessage:"Ask {automationCreatorName} to change these settings.",values:{automationCreatorName:i},description:"Caption for who added this Slack Notification Integration and can be asked to modify it. (e.g. Ask Jane Doe to change these settings.)"})}:{icon:M.Z.warning(l.warningIcon),message:n()(d.FormattedMessage,{id:"AutomationSlackHeaderView.disabled.readonly",defaultMessage:"This notification has been paused. Ask {automationCreatorName} to resume these notifications.",values:{automationCreatorName:i},description:"Caption for who added this Slack Notification Integration and can be asked to reenable it. (e.g. Ask Jane Doe to resume these notification.)"})});if("readonly_with_delete"===t)return n()(oi,"active"===o?{icon:M.Z.personBadgeQuestionMark(l.personBadgeQuestionMark),message:n()(d.FormattedMessage,{id:"AutomationSlackHeaderView.active.readonlyWithDelete",defaultMessage:"Ask {automationCreatorName} to change these settings, or <deleteAction>delete</deleteAction> when necessary.",values:{deleteAction:e=>n()(ei.Z,{disableUnderline:!0,style:l.link,onClick:()=>{a()}},void 0,e),automationCreatorName:i},description:"Caption for who added this Slack Notification Integration and can be asked to modify it. (e.g. Ask Jane Doe to change these settings.)"})}:{icon:M.Z.warning(l.warningIcon),message:n()(d.FormattedMessage,{id:"AutomationSlackHeaderView.disabled.readonlyWithDelete",defaultMessage:"This notification has been paused. Ask {automationCreatorName} to resume these notifications, or <deleteAction>delete</deleteAction> when necessary.",values:{deleteAction:e=>n()(ei.Z,{disableUnderline:!0,style:l.link,onClick:()=>{a()}},void 0,e),automationCreatorName:i},description:"Caption for who added this Slack Notification Integration and can be asked to reenable it. (e.g. Ask Jane Doe to resume these notification.)"})});(0,ge.t1)(t)}return null}function oi(e){window.__c={n:"AutomationSlackHeaderViewBase"};const{icon:t,message:o}=e,i=ii();return n()("div",{style:{paddingBlockEnd:10,paddingInline:12,display:"flex",flexDirection:"row",alignItems:"center",gap:8}},void 0,t,n()("div",{style:i.automationHeaderText},void 0,o))}function ii(){return(0,_.yK)((e=>({link:{color:e.blueColor},automationHeaderText:{color:e.lightTextColor,fontSize:12},personBadgeQuestionMark:{fill:e.mediumIconColor,width:16,height:"auto"},warningIcon:{color:e.accentColors.orange[400],width:16,height:"auto"}})),[])}function ni(e){window.__c={n:"AutomationEmptyStepButton"};const{icon:t,onClick:o,title:i}=e,r=(0,_.yK)((e=>({button:{alignItems:"center",background:e.accentColors.gray[30],border:`1px dashed ${e.accentColors.gray[100]}`,borderRadius:6,display:"flex",color:e.accentColors.gray[900],gap:6,justifyContent:"center",padding:16},iconWrap:{fill:e.accentColors.gray[600]},title:{fontSize:14,lineHeight:1.3}})),[]);return n()(ve.Z,{onClick:o,style:r.button},void 0,t&&n()("div",{"aria-hidden":"true",style:r.iconWrap},void 0,t),n()("div",{style:r.title},void 0,i))}var ri=o(68910),ai=o(49085);class si extends ai.Z{getInitialState(){return{stack:[]}}getCurrentTab(){return Ht().last(this.getState().stack)}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}}var li=o(43261),ci=o.n(li);const di=(0,d.defineMessages)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search for trigger…",description:"Search input placeholder for event trigger menu."},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added",description:"Menu item to represent an automation trigger where new pages added to the source will trigger the automation"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property",description:"Menu item to represent an automation trigger where any property edited within the source will trigger the automation"}});function pi(e){window.__c={n:"AutomationEventTriggerMenu"};const{automationTriggerActionMenuStore:t,collectionStore:o,currentState:i,updateCurrentState:r,onClose:l}=e,c=(0,_.Fg)(),p=(0,d.useIntl)(),{isMobile:u}=(0,k.Fy)(),[m,g]=s.useState(""),h=(0,C.VK)((()=>o.getSchema()),[o]),f=(0,C.VK)((()=>{const e=o.getFormat(),t=(0,yt.iB)(e,h,void 0,yt.j5.Page).collection_page_properties||[],i=kt(h);return Ht().sortBy(i,(e=>t.findIndex((t=>t.property===e))))}),[o,h]);let v;if(m){const e=new Map;let t=f.map((t=>{const o=h[t],i=o?`${o.name} ${wt.SO[o.type]}`:"";return e.set(t,i),i}));t=ci().filter(m,t).map((e=>{let{original:t}=e;return t})),v=f.filter((o=>t.includes(e.get(o)||"")))}else v=f;const y=(0,_.yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),b=n()(Y.ZP,{focus:!0,style:{marginTop:12,marginBottom:6},value:m,onChange:e=>{g(e.target.value)},placeholder:p.formatMessage(di.searchInputPlaceholder)});let S;S=u?{menuType:E.og.Modal,header:b}:{menuType:E.og.Popup,header:b,maxHeight:"50vh",width:266};const[w]=i.triggers,T=w?void 0:function(e){const{intl:t,searchInput:o,updateCurrentState:i,onClose:n,styles:r}=e,l=t.formatMessage(di.pageAddedCopy);if(!ci().test(o,l))return;return{key:"page_added_section",items:[{key:"page_added",action:()=>{i({type:"update_trigger",trigger:{type:"page_added"}}),n()},render:e=>s.createElement(re.Z,a()({},e,{icon:M.Z.plus(r.propertyIcon),title:l}))}],render:e=>s.createElement(H.Z,e)}}({intl:p,searchInput:m,updateCurrentState:r,onClose:l,styles:y}),I=(0,C.VK)((()=>function(e){const{automationTriggerActionMenuStore:t,showTopBorder:o,properties:i,collectionSchema:r,theme:l,formTriggerState:c,updateCurrentState:p,onClose:u,intl:m,searchInput:g,styles:h}=e,[,f,...v]=c,y=m.formatMessage(di.pagePropertiesEditedCopy),b=[f||!ci().test(g,y)?void 0:{key:"any_property_edited",action:async()=>{await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await He.confirmUserAction({message:n()(d.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?",description:"Confirmation dialogue when we detect a user is trying to add an incompatible trigger."}),description:n()(d.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers.",description:"Confirmation dialogue description when we detect a user is trying to add an incompatible trigger."}),acceptLabel:n()(d.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace",description:"Confirmation dialogue accept label description when we detect a user is trying to add an incompatible trigger and we'll replace the incompatible filters on confirm"})})}({hasSpecificPropertyChangedFilters:v.length>0})&&(p({type:"update_trigger",trigger:{type:"any_page_property_edited"}}),u())},render:e=>s.createElement(re.Z,a()({},e,{icon:M.Z.pencil(h.propertyIcon),title:y}))},...i.map((e=>{if(!v.find((t=>t.property===e)))return function(e){const{automationTriggerActionMenuStore:t,propertyId:o,collectionSchema:i,theme:r,updateCurrentState:l,onClose:c}=e,d=i[o];if(!d)return;const p=_t[d.type];return{key:o,action:()=>{p?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(l({type:"update_trigger",trigger:{type:"property_changed",property:o,filter:{operator:"changes_to_any"}}}),c())},render:e=>s.createElement(re.Z,a()({},e,{icon:n()(xo.ZP,{icon:d.icon,type:d.type,size:16,theme:r}),title:d.name,right:p?M.Z.chevronRight({marginLeft:6,width:12,height:"auto"}):void 0}))}}({propertyId:e,collectionSchema:r,theme:l,updateCurrentState:p,automationTriggerActionMenuStore:t,onClose:u})})).filter(ge.$K)].filter(ge.$K);if(0===b.length)return;return{key:"page_properties_edited_section",items:b,render:e=>s.createElement(H.Z,a()({},e,{topBorder:o,title:n()(d.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Page property edited",description:"Menu list section for specifying specific property updates for an automation trigger."})}))}}({automationTriggerActionMenuStore:t,showTopBorder:Boolean(T),properties:v,collectionSchema:h,theme:c,formTriggerState:i.triggers,updateCurrentState:r,onClose:l,searchInput:m,intl:p,styles:y})),[t,T,v,h,c,i,r,l,m,p,y]),P=s.useMemo((()=>{const e=[T,I].filter(ge.$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>s.createElement(re.Z,a()({},e,{disabled:!0,disabledFeedback:!0,title:n()(d.FormattedMessage,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results",description:"Fallback item when user search query on their properties yields no results"})}))}],render:e=>s.createElement(H.Z,e)}]:e}),[T,I]);return s.createElement(O.Z,S,n()(ae.Z,{type:ae.i.Vertical,sections:P,initialFocus:0}))}var ui=o(84619),mi=o(56723),gi=o(12508),hi=o(22084),fi=o(47082),vi=o(40721);const yi=(0,d.defineMessages)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step",description:"Screen reader label for back button icon"}});function bi(e){const{type:t,automationTriggerActionMenuStore:o,headerTitle:i,onClose:r,width:l,onDone:c}=e,p=(0,k.Fy)(),u=(0,d.useIntl)();let m;return m=p.isMobile?{menuType:E.og.Modal,title:i,left:n()(Se.Z,{ariaLabel:u.formatMessage(yi.backButtonAriaLabel),icon:M.Z.historyBack,onClick:()=>{1===o.getState().stack.length?r():o.popSettingsItem()}}),right:n()(vi.DoneMenuText,{}),onClickRight:()=>{null==c||c(),r()}}:{width:l??266,menuType:E.og.Popup,maxHeight:"50vh",header:n()(ki,{automationActionMenuStore:o,menuHeaderTitle:i,onDone:c})},"custom"===t?s.createElement(wi,a()({},e,{menuProps:m})):s.createElement(Si,a()({},e,{menuProps:m}))}function Si(e){window.__c={n:"AutomationActionDefaultMenu"};const{sections:t,menuProps:o}=e;return s.createElement(O.Z,o,n()(ae.Z,{type:ae.i.Vertical,initialFocus:0,sections:t}))}function wi(e){window.__c={n:"AutomationActionCustomMenu"};const{children:t,menuProps:o}=e;return s.createElement(O.Z,o,t)}function ki(e){window.__c={n:"BackToPreviousStepButton"};const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:i}=e,r=(0,d.useIntl)(),a=(0,C.VK)((()=>t.state.stack.length>1),[t]),s=(0,_.yK)((e=>({header:{display:"flex",alignItems:"center",marginTop:8,marginLeft:8,marginRight:8,color:e.mediumTextColor,fontWeight:he.Z.fontWeight.medium,fontSize:he.Z.fontSize.UISmall.desktop},iconButtonStyle:{marginRight:8,marginLeft:-2,height:22},iconButtonIconStyle:{width:16,height:16},doneButtonStyle:{marginLeft:"auto"}})),[]);return void 0!==o||a?n()("div",{style:s.header},void 0,a&&n()(Se.Z,{ariaLabel:r.formatMessage(yi.backButtonAriaLabel),icon:M.Z.arrowLeftThick,style:s.iconButtonStyle,iconStyle:s.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o,i&&n()(G.Z,{onClick:i,isBlue:!0,style:s.doneButtonStyle},void 0,n()(d.FormattedMessage,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done",description:"Button to save action or trigger configuration."}))):null}function Ci(e){window.__c={n:"AutomationSelectPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerActionMenuStore:i,propertySchema:r,propertyChangedFilter:l,onClose:c}=e,{isMobile:p,isAndroid:u}=(0,k.Fy)(),m=(0,d.useIntl)(),g=(0,C.VK)((()=>{if("changes_to_any"===l.operator){return(r.options??[]).map((e=>({type:"exact",value:e.value})))}return((0,Tt.dx)(l)||(0,Tt.NU)(l))&&(0,Tt.vR)(l)?Array.isArray(l.value)?l.value:[l.value]:[]}),[r,l]),[h,f]=s.useState(g),v=(0,C.VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let i=!1,n=!0;const r=t.options??[];for(const a of r){const e=o.some((e=>e.value===a.value));i||=e,n&&=e}return!!n||!!i&&"partial"}({propertySchema:r,selectedOptions:h})),[r,h]),y=s.useMemo((()=>(r.options??[]).map((e=>({type:"exact",value:e.value})))),[r]),b=s.useMemo((()=>"multi_select"===r.type?{operator:"enum_contains",value:h}:"select"===r.type?{operator:"enum_is",value:h}:(0,ge.t1)(r)),[r,h]),S=!0===v?[]:h.map((e=>e.value&&n()(hi.Z,{format:p?ui.l.Large:ui.l.Small,isSingle:!1,value:e.value,options:r.options??[],showRemoveButton:!0,onClickRemove:()=>{const t=Ht().without(h,e);f(t)}}))),[w,_]=s.useState(""),M=(0,mi.I4)({query:w,propertySchema:r,selectedValues:h,updateValue:e=>{_(""),f(e)},isMobile:p,styles:{}}),T=[{key:"search",items:[{key:"input",action:()=>{},render:e=>s.createElement(fi.Z,a()({},e,{focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:fi.Z.Format.FilterValue,tokens:S,placeholder:v?m.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption",description:"Input placeholder when user has 'Any option' selected"}):m.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder",description:"Input placeholder when there's no input yet."}),onRemoveLastToken:()=>{const e=h.slice(0,h.length-1);f(e)},onClearButtonClick:()=>{f([]),c()},value:w,onChange:e=>{_(e.target.value)},dontShowBorderBottom:u,showClearButton:!0}))}],render:e=>s.createElement(H.Z,e)},{key:"any",items:[{key:"any-option-item",action:()=>{!0===v?f([]):!1===v||"partial"===v?f(y):(0,ge.t1)(v),_("")},render:e=>s.createElement(re.Z,a()({},e,{icon:n()(gi.Z,{checked:v,size:14,onClick:e.onClick}),title:n()(d.FormattedMessage,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option",description:"Option to toggle if user wants to be notified about all edits to this property."})}))}],render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0}))},M.length>0?{key:"items",items:M,render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0}))}:void 0].filter(ge.$K);return n()(bi,{type:"default",automationTriggerActionMenuStore:i,onDone:()=>{Rt({anyOptionCheckState:v,propertyId:t,updateCurrentState:o,currentFilter:b}),c()},onClose:c,sections:T,headerTitle:n()(d.FormattedMessage,{id:"automations.propertyChangedFilterHeader.select.title",defaultMessage:"{propertyName} set to",description:"Header that shows the property name and indicates that the event will trigger when the property gets set to a particular value (e.g. Tags set to...)",values:{propertyName:r.name}})})}function _i(e){window.__c={n:"AutomationStatusPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerActionMenuStore:i,propertySchema:r,propertyChangedFilter:l,onClose:c}=e,{isMobile:p}=(0,k.Fy)(),u=(0,C.VK)((()=>{if("changes_to_any"===l.operator){return(r.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,Tt.r2)(l)&&(0,Tt.vR)(l)?Array.isArray(l.value)?l.value:[l.value]:[]}),[r,l]),[m,g]=s.useState(u),h=(0,C.VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e;let i=!1,n=!0;const r=t.groups??[],a=t.options??[];for(const s of r){const e=Mi({group:s,options:a,selectedStatusOptions:o});i||=!1!==e,n&&=!0===e}return!!n||!!i&&"partial"}({propertySchema:r,selectedStatusOptions:m})),[r,m]),f=s.useMemo((()=>(r.groups??[]).map((e=>({type:"is_group",value:e.name})))),[r]),v=(0,mi.Sm)({propertySchema:r,statusFilterValues:m,updateValue:e=>{g(e)},isMobile:p,styles:{}});return n()(bi,{type:"default",automationTriggerActionMenuStore:i,onDone:()=>{Rt({anyOptionCheckState:h,propertyId:t,updateCurrentState:o,currentFilter:{operator:"status_is",value:m}}),c()},onClose:()=>{c()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===h?g([]):!1===h||"partial"===h?g(f):(0,ge.t1)(h)},render:e=>s.createElement(re.Z,a()({},e,{icon:n()(gi.Z,{checked:h,size:14,onClick:e.onClick}),title:n()(d.FormattedMessage,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option",description:"Option to toggle if user wants to be notified about all edits to this property."})}))}],render:e=>s.createElement(H.Z,e)},{key:"items",items:v,render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0}))}],headerTitle:n()(d.FormattedMessage,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",description:"Header that shows the property name and indicates that the event will trigger when the property gets set to a particular value (e.g. Tags set to...)",values:{propertyName:r.name}})})}function Mi(e){const{group:t,options:o,selectedStatusOptions:i}=e,n=i.some((e=>"is_group"===e.type&&e.value===t.name)),r=o.filter((e=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)}));let a=!1,s=!0;for(const l of r){const e=i.some((e=>"is_option"===e.type&&e.value===l.value));a||=e,s&&=e}return!(!n&&!s)||!!a&&"partial"}function Ti(e){const{propertyId:t,automationTriggerActionMenuStore:o,collectionStore:i,currentState:r,updateCurrentState:a,onClose:s}=e,l=(0,C.VK)((()=>i.getSchema()),[i])[t],[c,d,...p]=r.triggers,u=p.find((e=>e.property===t))??{property:t,filter:{operator:"changes_to_any"}};if(!l)return null;return _t[l.type]?"multi_select"===l.type||"select"===l.type?n()(Ci,{propertyId:t,updateCurrentState:a,automationTriggerActionMenuStore:o,propertySchema:l,propertyChangedFilter:u.filter,onClose:s}):"status"===l.type?n()(_i,{propertyId:t,updateCurrentState:a,automationTriggerActionMenuStore:o,propertySchema:l,propertyChangedFilter:u.filter,onClose:s}):null:null}const Ii=(0,d.defineMessages)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search for action…",description:"Search input placeholder for event action menu."}}),Pi={status:!0,multi_select:!0,select:!0,person:!0,date:!0};function xi(e){window.__c={n:"AutomationEventActionMenu"};const{automationTriggerActionMenuStore:t,collectionStore:o,currentState:i,updateCurrentState:r,onClose:l}=e,c=(0,_.Fg)(),p=(0,d.useIntl)(),{isMobile:u}=(0,k.Fy)(),[m,g]=s.useState(""),h=(0,C.VK)((()=>o.getSchema()),[o]),f=(0,C.VK)((()=>{const e=o.getFormat(),t=(0,yt.iB)(e,h,void 0,yt.j5.Page).collection_page_properties||[],i=kt(h);return Ht().sortBy(i,(e=>t.findIndex((t=>t.property===e))))}),[o,h]);let v;if(m){const e=new Map;let t=f.map((t=>{const o=h[t],i=o?`${o.name} ${wt.SO[o.type]}`:"";return e.set(t,i),i}));t=ci().filter(m,t).map((e=>{let{original:t}=e;return t})),v=f.filter((o=>t.includes(e.get(o)||"")))}else v=f;const y=(0,ye.F)({width:260});y.header=n()(Y.ZP,{onChange:e=>{g(e.target.value)},placeholder:p.formatMessage(Ii.searchInputPlaceholder),style:{marginBlock:"12px 6px"},value:m}),u||(y.maxHeight="50vh");const b=void 0,S=(0,C.VK)((()=>function(e){const{automationTriggerActionMenuStore:t,showTopBorder:o,properties:i,collectionSchema:r,theme:l,formActionState:c,updateCurrentState:p,onClose:u}=e;return{key:"page_properties_edited_section",items:i.map((e=>{if(!c.some((t=>{var o,i;return!(!t||!function(e){return"update_pages"===e.type}(t)||1!==(null===(o=t.config)||void 0===o||null===(i=o.properties)||void 0===i?void 0:i.length))&&t.config.properties[0]===e})))return function(e){const{automationTriggerActionMenuStore:t,propertyId:o,collectionSchema:i,theme:r}=e,l=i[o];if(!l)return;if(!Pi[l.type])return;return{key:o,action:()=>{t.pushSettingsItem({propertyId:o,type:"eventActionProperty"})},render:e=>s.createElement(re.Z,a()({},e,{icon:n()(xo.ZP,{icon:l.icon,size:16,style:{fill:r.regularIconColor,marginRight:6},theme:r,type:l.type}),right:M.Z.chevronRight({marginInlineStart:6,width:12,height:"auto"}),title:l.name}))}}({propertyId:e,collectionSchema:r,theme:l,updateCurrentState:p,automationTriggerActionMenuStore:t,onClose:u})})).filter(ge.$K),render:e=>s.createElement(H.Z,a()({},e,{title:n()(d.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Page property edited",description:"Menu list section for specifying specific property updates for an automation trigger."}),topBorder:o}))}}({automationTriggerActionMenuStore:t,showTopBorder:Boolean(b),properties:v,collectionSchema:h,theme:c,formActionState:i.actions,updateCurrentState:r,onClose:l})),[t,b,v,h,c,i,r,l]),w=[b,S].filter(ge.$K);return s.createElement(O.Z,y,n()(ae.Z,{type:ae.i.Vertical,sections:w,initialFocus:0}))}var Bi=o(99036),Zi=o(82433),Ei=o(76218),Ri=o(93313);const Ai=(0,d.defineMessages)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",description:"Header title for the menu",id:"automations.eventActionProperty.menuHeaderTitle"}});function Di(e){var t;window.__c={n:"AutomationEventActionProperty"};const{actionId:o,automationContextStore:i,automationTriggerActionMenuStore:r,buttonPopupParent:a,collectionStore:l,currentState:c,onClose:p,propertyId:u,updateCurrentState:m}=e,g=(0,d.useIntl)(),h=(0,C.VK)((()=>l.getSchema()[u]),[l,u]),f=(0,s.useMemo)((()=>!!h&&("multi_select"===h.type||(0,Bi.en)(h)&&1!==h.limit)),[h]),v=(0,C.VK)((()=>{if(h)return(0,Ei.qW)({table:Ko.v,id:l.id,spaceId:l.getSpaceId()},u,h)}),[l,h,u]),y=(0,s.useMemo)((()=>{if(o&&c.actions.length>0){const i=c.actions.find((e=>e.id===o));var e,t;if(i&&"update_pages"===i.type)return null===(e=i.config)||void 0===e||null===(t=e.values)||void 0===t?void 0:t[u]}}),[o,c,u]),[b,S]=(0,s.useState)(y),w=(0,Ei.A6)(null==b||null===(t=b.value)||void 0===t?void 0:t.value),k=(0,s.useCallback)((e=>{const t=void 0===e?"replace":"append";m({action:{id:o,config:{properties:[u],target:{id:(0,Zi.Kd)({global:"button_page",source:"global"}),type:"variable"},values:{[u]:{action:t,value:e}}},type:"update_pages"},type:"update_action"}),p()}),[o,u,m,p]),_=(0,s.useCallback)((e=>{f?S({action:"append",value:e}):k(e)}),[k,f]),M=(0,s.useCallback)((()=>k(null==b?void 0:b.value)),[b,k]);if(!h||!v)return null;const T={type:"collection",collectionStore:l,property:u},I=n()(Fi,{onDoneClick:M,showDoneButton:f},void 0,g.formatMessage(Ai.menuHeaderTitle,{propertyName:h.name}));return n()(bi,{automationTriggerActionMenuStore:r,headerTitle:I,onClose:p,type:"custom",width:"100%"},void 0,n()(Ri.a,{actionId:o,context:T,contextStore:i,currentSimpleFormulaValueTokens:w,disabled:!1,menuHeader:null,onChange:_,parent:a,type:v,value:null==b?void 0:b.value}))}function Fi(e){window.__c={n:"MenuHeader"};const{children:t,onDoneClick:o,showDoneButton:i}=e,r=(0,_.yK)((()=>({menuHeader:{alignItems:"center",display:"flex",flex:1,height:24,justifyContent:"space-between",marginRight:12}})),[]);return n()("div",{style:r.menuHeader},void 0,n()("span",{},void 0,t),i&&n()(G.Z,{isBlue:!0,isSmall:!0,onClick:o},void 0,n()(d.FormattedMessage,{id:"automation.propertyChangedFilterHeader.doneButton",defaultMessage:"Done",description:"Button to save current configuration."})))}var Li=o(41892),Vi=o(68626),Ni=o(32161),Oi=o(18441);function Ui(e){window.__c={n:"AutomationSlackConnectToSlackView"};const{type:t,automationActionMenuStore:o,onClose:i}=e,r=ji(),l=(0,C.VK)((()=>{var e;return null===(e=Ke.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c=(0,C.VK)((()=>Ke.default.state.currentUserStore),[]),p=(0,C.VK)((()=>{if("connectToSlackReconnect"===t&&c)return(0,Go.Kv)(c,{table:Ni.P,id:e.externalBotId,spaceId:l}).getValue()}),[l,c,e,t]);let u,m=Wi({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!p)return null;const{accountName:e,organizationName:t}=(0,Oi.jg)(p);u=(0,Oi.jc)(p),m=Wi({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return n()(bi,{type:"custom",automationTriggerActionMenuStore:o,onClose:i},void 0,n()(H.Z,{},void 0,n()("div",{style:r.container},void 0,n()(zi,{}),n()("div",{style:r.connectToSlackBody},void 0,n()("div",{style:r.connectToSlackTitleText},void 0,function(e){if("connectToSlackDefault"===e)return n()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack",description:"Title for the connect to Slack view from notificationRuleSettingsSetupSlackView."});if("connectToSlackReconnect"===e)return n()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack",description:"Title for reconnecting Slack if an automation is disabled due to auth issues."});(0,ge.t1)(e)}(t)),n()("div",{style:r.connectToSlackDescriptionText},void 0,m)),s.createElement(Hi,a()({},e,{slackWorkspaceId:u})))))}function Hi(e){window.__c={n:"AuthActionButtons"};const{automationActionMenuStore:t,slackWorkspaceId:o}=e,i=(0,k.O7)(),r=ji(),a=(0,C.VK)((()=>{var e;return null===(e=Ke.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),s=(0,C.VK)((()=>ne.Z.integrations.state.find((e=>e.id===Xe.nO))),[]);return s&&a?n()("div",{style:r.buttonGroup},void 0,n()(et.Z,{style:r.connectToSlackButton,isLarge:!0,onClick:async()=>{const n=await oe.h({environment:i,integration:s,spaceId:a,from:"collection_view_settings",options:{slackWorkspaceId:o}});Vi.x.isFail(n)?t.replaceSettingsItem({type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?n.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:n.value.externalAuthentication}):t.replaceSettingsItem({type:"selectWorkspace"}):(0,ge.t1)(e))}},void 0,n()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect",description:"Button to connect to Slack."})),n()(G.Z,{style:r.cancelButton,isLarge:!0,onClick:()=>{t.popSettingsItem()}},void 0,n()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel",description:"Button to cancel connecting to Slack."}))):null}function zi(){window.__c={n:"SlackIcon"};const e=ji();return n()("div",{},void 0,n()("img",{src:Li.Z.images.externalIntegrations.slackIconPng,style:e.slackIcon}))}function Wi(e){const{viewType:t}=e;return"connectToSlackDefault"===t?n()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more.",description:"Description for the connect to Slack view from notificationRuleSettingsSetupSlackView."}):"connectToSlackReconnect"===t?n()(d.FormattedMessage,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',description:"Description for reconnecting Slack if an automation is disabled due to auth issues.",values:{accountName:e.accountName,hasOrganizationName:(0,ge.$K)(e.organizationName),organizationName:e.organizationName}}):void(0,ge.t1)(t)}function ji(){return(0,_.yK)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:he.Z.fontWeight.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.mediumTextColor},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.mediumTextColor,width:"100%",justifyContent:"center",fontWeight:he.Z.fontWeight.medium,fontSize:13,marginTop:8}})),[])}var Ki=o(88108);class Yi extends ai.Z{getStateForBot(e){return this.state[e]??{channels:{},fetching:!1,lastRefreshed:0}}updateStateForBot(e,t){this.setState({...this.state,[e]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const o=this.getStateForBot(e);this.setState({...this.state,[e]:{...o,channels:{...o.channels,...t}}})}}const Gi=new Yi;(0,Ki.exposeDebugValue)("ExternalNotificationChannelsStore",Gi);const Xi=Gi;var qi=o(33411);const $i=(0,d.defineMessages)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…",description:"Search placeholder text in channel selector for Slack Notification settings."}});function Ji(e){window.__c={n:"AutomationSlackSelectChannelView"};const{type:t,automationActionMenuStore:o,onChannelSelect:i,onClose:r}=e,l=(0,k.O7)(),{isMobile:c}=(0,k.Fy)(),p=(0,C.VK)((()=>ne.Z.completeSlackAuthentications.state),[]),u=e.currentExternalAuthentication??p[0],m="selectChannelUpdate"===e.type?e.currentNotificationChannel:"selectChannelNew"===e.type?void 0:(0,ge.t1)(e);s.useEffect((()=>{u&&async function(e){const{environment:t,botId:o,spaceId:i}=e,n=Xi.getStateForBot(o);if(n.fetching||Date.now()-n.lastRefreshed<15e3)return;let r;Xi.updateStateForBot(o,{fetching:!0,lastRefreshed:Date.now()});for(;;){const e=await Oe.getExternalNotificationChannels(t,{botId:o,spaceId:i,cursor:r});if("success"!==e.type){console.error(e.error);break}{const t={};for(const o of e.data.channels)t[o.id]=o;if(Xi.addChannelsForBot(o,t),r=e.data.cursor,!r)break}}Xi.updateStateForBot(o,{fetching:!1})}({environment:l,botId:u.id,spaceId:u.space_id})}),[l,u]);const[g,h]=s.useState(""),{loadedChannelsForAccount:f,isLoading:v}=(0,C.VK)((()=>{if(!u)return{loadedChannelsForAccount:[],isLoading:!1};const e=Xi.getStateForBot(u.id);return{loadedChannelsForAccount:Object.values(e.channels),isLoading:e.fetching}}),[u]),y=(0,C.VK)((()=>ne.Z.integrations.state.find((e=>e.id===Xe.nO))),[]),b=(0,C.VK)((()=>{var e;return null===(e=Ke.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),S=s.useCallback((e=>{"selectChannelUpdate"===t&&r(),i({channel:e,externalBotId:u.parent_id})}),[i,r,t,u]),w=(0,_.yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[]),T=s.useCallback((e=>{const{channel:t}=e;return{key:t.id,render:e=>s.createElement(re.Z,a()({},e,{icon:en({channel:t,styles:w.icon}),desktopIconStyle:{width:8},title:t.name,right:t.id===(null==m?void 0:m.id)&&M.Z.check(w.icon)})),action:()=>{S(t)}}}),[S,w.icon,m]),{publicChannels:I,privateChannels:P,personalChannels:x}=s.useMemo((()=>function(e){const t=[],o=[],i=[];for(const n of e)"public"===n.type?t.push(n):"private"===n.type?o.push(n):"me"===n.type?i.push(n):(0,ge.t1)(n.type);return{publicChannels:t,privateChannels:o,personalChannels:i}}(f)),[f]),B=s.useCallback((()=>I.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[I,T]),E=s.useCallback((()=>P.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[P,T]),R=s.useCallback((()=>x.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[x,T]),A=s.useCallback((()=>B().map((e=>{let{menuListItem:t,channelName:o}=e;if(Qi({channelName:o,query:g}))return t})).filter(ge.$K)),[B,g]),D=s.useCallback((()=>E().map((e=>{let{menuListItem:t,channelName:o}=e;if(Qi({channelName:o,query:g}))return t})).filter(ge.$K)),[E,g]),F=s.useCallback((()=>R().map((e=>{let{menuListItem:t,channelName:o}=e;if(Qi({channelName:o,query:g}))return t})).filter(ge.$K)),[R,g]),L=s.useCallback((()=>{const e=[],t=A(),o=D(),i=F();return i.length>0&&e.push({key:"personal-channels",render:e=>s.createElement(H.Z,a()({},e,{title:(0,Oi.jg)(u).organizationName})),items:i}),t.length>0&&e.push({key:"public-channels",render:e=>s.createElement(H.Z,a()({},e,{topBorder:i.length>0,title:0===i.length&&(0,Oi.jg)(u).organizationName})),items:t}),o.length>0&&e.push({key:"private-channels",render:e=>s.createElement(H.Z,a()({},e,{topBorder:t.length>0,title:0===i.length&&t.length>0&&(0,Oi.jg)(u).organizationName})),items:o}),e}),[A,D,F,u]);if(!u||!y)return null;const V=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>n()("div",{},void 0,s.createElement(Y.ZP,a()({},e,{inputLeft:n()(Y.f_,{icon:M.Z.searchThick}),inputRight:n()(qi.Z,{show:v,showDelay:500,showHold:300,render:e=>e&&n()(tt.Z,{style:{marginRight:2}})}),showClearButton:!0,placeholder:Z.default.formatMessage($i.channelSearchPlaceholder),focus:!c||void 0,value:g,onChange:e=>{h(e.target.value)}})))}],render:e=>s.createElement(H.Z,e)},...L()];return"selectChannelNew"===e.type&&V.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!b)return;const e=await oe.h({environment:l,integration:y,spaceId:b,from:"collection_view_settings"});if(Vi.x.isFail(e))return;const t=o.getState().stack;t.length<2||("selectWorkspace"===t[t.length-2].type?o.popSettingsItem():o.replaceSettingsItem({type:"selectWorkspace"}))},render:e=>s.createElement(re.Z,a()({},e,{icon:n()("img",{src:Li.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:n()(d.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account",description:"Menu item to authenticate with another Slack account"})}))}],render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0}))}),n()(bi,{type:"default",automationTriggerActionMenuStore:o,headerTitle:n()(d.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel",description:"Header for Slack channel notification picker"}),sections:V,onClose:r})}function Qi(e){const{channelName:t,query:o}=e;return 0===o.length||t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0}function en(e){const{channel:t,styles:o}=e;return"private"===t.type?M.Z.locked(o):"me"===t.type?M.Z.at(o):M.Z.typesNumber(o)}const tn=(0,d.defineMessages)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…",description:"Search placeholder text in workspace selector for Slack Notification settings."}});function on(e){window.__c={n:"AutomationSlackSelectWorkspaceView"};const{automationActionMenuStore:t,onClose:o}=e,i=(0,k.O7)(),{isMobile:r}=(0,k.Fy)(),l=(0,C.VK)((()=>{var e;return null===(e=Ke.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c=(0,C.VK)((()=>ne.Z.completeSlackAuthentications.state),[]),p=(0,C.VK)((()=>ne.Z.integrations.state.find((e=>e.id===Xe.nO))),[]),[u,m]=s.useState(""),g=(0,_.yK)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]),h=s.useCallback((e=>{t.pushSettingsItem({type:"selectChannelNew",currentExternalAuthentication:e})}),[t]);if(!p)return null;const f=Object.entries((0,Oi.YJ)(c,u)).map(((e,t)=>{let[o,i]=e;return{key:o,items:i.map((e=>{let{workspaceName:t,externalAuthentication:o}=e;return{key:o.id,action:()=>{h(o)},render:e=>s.createElement(re.Z,a()({},e,{title:t??n()(d.FormattedMessage,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace",description:"Placehold for Slack workspace name if we cannot find it for some reason."}),right:M.Z.chevronRight(g.chevronRight)}))}})),render:e=>s.createElement(H.Z,a()({},e,{title:o,topBorder:0!==t}))}}));return f.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>n()("div",{},void 0,s.createElement(Y.ZP,a()({},e,{inputLeft:n()(Y.f_,{icon:M.Z.searchThick}),showClearButton:!0,placeholder:Z.default.formatMessage(tn.workspaceSearchPlaceholder),focus:!r||void 0,value:u,onChange:e=>{m(e.target.value)}})))}],render:e=>s.createElement(H.Z,e)}),f.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!l)return;const e=await oe.h({environment:i,integration:p,spaceId:l,from:"collection_view_settings"});Vi.x.isFail(e)||t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:e.value.externalAuthentication})},render:e=>s.createElement(re.Z,a()({},e,{icon:n()("img",{src:Li.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:n()(d.FormattedMessage,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account",description:"Menu item to authenticate with another Slack account"})}))}],render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0}))}),n()(bi,{type:"default",automationTriggerActionMenuStore:t,headerTitle:n()(d.FormattedMessage,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace",description:"Title for Slack workspace dropdown"}),sections:f,onClose:o})}function nn(e){const{actionId:t,collectionStore:o,initialState:i,currentAutomationState:r,updateCurrentAutomationState:a,buttonPopupParent:l}=e,d=t??(0,c.ZP)(),p=(0,C.VK)((()=>{const e=new si;return e.setState({stack:[i]}),e}),[i]),u=(0,C.VK)((()=>p.getCurrentTab()),[p]),m=(0,C.VK)((()=>Ke.default.state.currentUserStore),[]),g=(0,C.VK)((()=>Ke.default.state.currentSpaceStore),[]),h=(0,C.VK)((()=>{if(!o)return;const e=o.getSpaceShardedPointer();return new ri.L({actions:[],parentPointer:e,type:"event",persisted:!1,intl:Z.default.getIntl(),parentRecordStore:o})}),[o]),f=s.useCallback((()=>{l.close()}),[l]);if(!(u&&g&&m&&h&&o&&r))return null;if("connectToSlackDefault"===u.type)return n()(Ui,{type:"connectToSlackDefault",automationActionMenuStore:p,onClose:f});if("connectToSlackReconnect"===u.type)return n()(Ui,{type:"connectToSlackReconnect",externalBotId:u.externalBotId,notificationAutomationStore:u.notificationAutomationStore,notificationActionConfigStore:u.notificationActionConfigStore,automationActionMenuStore:p,onClose:f});if("selectWorkspace"===u.type)return n()(on,{automationActionMenuStore:p,onClose:f});if("selectChannelNew"===u.type)return n()(Ji,{type:"selectChannelNew",currentExternalAuthentication:u.currentExternalAuthentication,automationActionMenuStore:p,onClose:f,onChannelSelect:e=>{let{channel:t,externalBotId:o}=e;a({type:"update_action",action:{id:(0,c.ZP)(),type:"slack_notification",config:{target:t,external_bot_id:o}}})}});if("selectChannelUpdate"===u.type)return n()(Ji,{type:"selectChannelUpdate",actionId:u.actionId,currentExternalAuthentication:u.currentExternalAuthentication,currentNotificationChannel:u.currentNotificationChannel,automationActionMenuStore:p,onClose:f,onChannelSelect:e=>{let{channel:t,externalBotId:o}=e;a({type:"update_action",action:{id:u.actionId,type:"slack_notification",config:{target:t,external_bot_id:o}}})}});if("eventTriggers"===u.type)return n()(pi,{automationTriggerActionMenuStore:p,collectionStore:o,currentState:r,updateCurrentState:a,onClose:f});if("propertyChangedFilter"===u.type)return n()(Ti,{propertyId:u.property,automationTriggerActionMenuStore:p,collectionStore:o,currentState:r,updateCurrentState:a,onClose:f});if("eventActions"===u.type)return n()(xi,{automationTriggerActionMenuStore:p,collectionStore:o,currentState:r,onClose:f,updateCurrentState:a});if("eventActionProperty"===u.type){if(!h)return null;const{propertyId:e}=u;return n()(Di,{actionId:d,automationContextStore:h,automationTriggerActionMenuStore:p,buttonPopupParent:l,collectionStore:o,currentState:r,onClose:f,propertyId:e,updateCurrentState:a})}return(0,ge.t1)(u)}function rn(e){const{availableActions:t,initialState:o,updateCurrentAutomationState:i,currentAutomationState:r,collectionStore:l}=e,c=(0,be.d)(),d=t[0];return l&&r?d&&"slack_notification"===d.type?n()(N.Z,{alignmentToOrigin:N.Z.Alignment.Center,placementToOrigin:N.Z.Placement.Bottom,forceInitialInbound:!0,popupType:c,render:e=>n()(an,{action:d,buttonPopupParent:e,updateCurrentAutomationState:i,currentAutomationState:r,collectionStore:l}),renderOrigin:e=>s.createElement(sn,a()({},e,{action:t[0]}))}):n()(N.Z,{alignmentToOrigin:N.Z.Alignment.Center,placementToOrigin:N.Z.Placement.Bottom,popupType:c,render:e=>n()(nn,{buttonPopupParent:e,collectionStore:l,currentAutomationState:r,initialState:o,updateCurrentAutomationState:i}),renderOrigin:e=>s.createElement(ln,e)}):n()(ln,{onClick:()=>{}})}function an(e){window.__c={n:"SingleActionMenu"};const{action:t,buttonPopupParent:o,currentAutomationState:i,updateCurrentAutomationState:r,collectionStore:a}=e;return"slack_notification"!==t.type?null:n()(nn,{initialState:t.initialMenuState,updateCurrentAutomationState:r,buttonPopupParent:o,currentAutomationState:i,collectionStore:a})}function sn(e){const{action:t,...o}=e;return"slack_notification"===t.type?s.createElement(ni,a()({},o,{title:n()(d.FormattedMessage,{id:"AutomationActionSelectMenu.actionTitle.slackNotification",defaultMessage:"Send Slack notification to…",description:"Title shown when the user is selecting an action to run for their automation."}),icon:M.Z.slackLogo({height:12,width:12})})):s.createElement(ln,o)}function ln(e){return window.__c={n:"DefaultActionButton"},s.createElement(ni,a()({},e,{icon:M.Z.plus({height:12,width:12}),title:n()(d.FormattedMessage,{id:"AutomationActionSelectButton.actionSection.addAction",defaultMessage:"Add action",description:"Placeholder prompt for adding actions to automation."})}))}var cn=o(37034),dn=o(45669);function pn(e){window.__c={n:"AutomationCollectionSelectMenu"};const{selectedSourcePointer:t,collectionContextStore:o,onSelect:i,disabled:r}=e,l=(0,k.Fy)().isMobile,c=(0,d.useIntl)(),[p,u]=s.useState(""),m=(0,C.VK)((()=>o.collectionStore()),[o]),g=(0,C.VK)((()=>o.collectionViewBlockStore()),[o]),h=(0,C.VK)((()=>g&&m?g.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===m.id})):[]),[g,m]),f=(0,C.VK)((()=>{if(!m||!t)return[];let e;"collection_view"===t.table&&(e=Go.Xr.createChildStore(m,t));return Ht().uniqBy([...h,e].filter(ge.$K),(e=>{let{id:t}=e;return t})).filter((e=>(0,Bo.D)(e,p)))}),[m,h,p,t]),v=[{key:"search",items:[{key:"search_item",action:()=>{},render:()=>n()(Y.ZP,{value:p,focus:!0,style:y.searchBar,textWrapperStyle:y.searchText,onChange:e=>u(e.target.value),placeholder:c.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})})}],render:e=>s.createElement(H.Z,e)},(0,C.VK)((()=>{if(m&&t&&(0,wt.r_)(m,p,c))return function(e){const{collectionStore:t,selectedSourcePointer:o,onSelect:i,isMobile:r,intl:l}=e,c=t.getIcon(),p=(0,cn.v)(t,l),u="collection"===o.table&&o.id===t.id,m=t.getSpaceShardedPointer();return{key:"collection",items:[{key:t.id,action:()=>{m&&i(m)},render:e=>s.createElement(re.Z,a()({},e,{icon:c&&n()($e.Z,{isEmptyPage:!1,size:r?18:16,disabled:!0,icon:c}),title:p,caption:n()(d.FormattedMessage,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Any page in {collectionName}",values:{collectionName:p},description:"User can simply configure the rule on the collection itself."}),right:u&&M.Z.check({width:12,height:"auto"})}))}],render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0}))}}({collectionStore:m,selectedSourcePointer:t,onSelect:i,isMobile:l,intl:c})}),[m,c,l,i,p,t]),function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>s.createElement(H.Z,a()({},e,{topBorder:!0}))}}({menuListItems:(0,C.VK)((()=>m&&g&&h&&t?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:i,selectedSourcePointer:r,onSelect:l,intl:c}=e,p=i.getSchema();return[...o.map((e=>{const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const u="collection_view"===r.table&&r.id===o.id,m=Dt({collectionViewStore:e,collectionSchema:p}),g=(0,ge.$K)(m),h=e.getType(),f=e.getFormat().collection_view_icon,v=e.getName(),y=(o,i)=>s.createElement(re.Z,a()({},o,i,{icon:n()(fo.F,{color:"lightGray",viewType:h,viewIcon:f}),title:n()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4}},void 0,n()(dn.Z,{collectionViewType:h,collectionViewName:v}),g&&u&&M.Z.warning({width:16,height:"auto"})),caption:n()(mn,{blockStore:t,collectionViewStore:e,intl:c,collectionSchema:p,referencesIncompatibleProperties:g}),right:u&&M.Z.check({width:12,height:"auto"}),disabled:g,disabledFeedback:g}));let b;if(g&&m){var i;const e=null===(i=p[m])||void 0===i?void 0:i.type,t=e?wt.SO[e]:void 0,o=n()(d.FormattedMessage,t?{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",description:"Tooltip message indicating the specific property type which causes this collection view filter to not be compatible with notifications.",values:{propertyTypeName:t}}:{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported",description:"Tooltip message indicating why this collection view filter is not compatible with notifications."});b=e=>n()(se.Z,{placement:se.Z.Placement.Right,renderTooltip:()=>o,render:t=>y(e,t)})}else b=y;return{key:e.id,action:()=>{l(o)},render:b}}}))].filter(ge.$K)}({blockStore:g,collectionStore:m,filteredCollectionViewStores:f,selectedSourcePointer:t,onSelect:i,intl:c}):[]),[g,m,h,f,c,i,t])})].filter(ge.$K),y=function(e){return(0,_.yK)((t=>({button:{marginTop:8},buttonPopup:{width:e?void 0:230},searchBar:{marginTop:8,marginBottom:8},searchText:{marginLeft:8,marginRight:8},buttonRight:{color:t.selectLightGray[500]}})),[e])}(l),b=(0,C.qz)(void 0,A.Z),S=(0,be.d)();return m?n()(N.Z,{alignmentToOrigin:N.Z.Alignment.End,placementToOrigin:N.Z.Placement.Bottom,popupType:S,style:y.buttonPopup,buttonPopupStore:b,render:e=>{let t;return t=l?{menuType:E.og.Modal,right:n()(vi.DoneMenuText,{}),onClickRight:()=>{e.close()}}:{menuType:E.og.Popup,width:230,maxHeight:"50vh"},s.createElement(O.Z,t,n()(ae.Z,{type:ae.i.Vertical,sections:v,initialFocus:0,onAccept:()=>{e.close()}}))},renderOrigin:e=>s.createElement(L.Z,a()({title:n()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in",description:"Header for option to select collection views for this automation."}),showChevron:!0,right:t&&n()(un,{pointer:t,collectionStore:m,intl:c}),rotateChevron:b.state.open,disabled:r,textWrapperStyle:{marginLeft:8}},e))}):null}function un(e){window.__c={n:"AutomationSourceCaption"};const{pointer:t,collectionStore:o,intl:i}=e,r=(0,_.yK)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4}})),[]),a=(0,C.VK)((()=>{if(t.table!==Ko.v)return Go.Xr.createChildStore(o,t)}),[o,t]),s=(0,C.VK)((()=>t.table===Yo.n&&a?(0,cn.v)(a,i):(0,cn.v)(o,i)),[o,a,i,t.table]),l=(0,C.VK)((()=>{if(t.table===Ko.v||!a)return!1;const e=o.getSchema();return(0,ge.$K)(Dt({collectionViewStore:a,collectionSchema:e}))}),[o,a,t.table]);return n()("div",{style:r.titleContainer},void 0,l&&M.Z.warning(r.warningIcon),s)}function mn(e){window.__c={n:"CollectionViewCaption"};const{blockStore:t,collectionViewStore:o,intl:i,collectionSchema:r,referencesIncompatibleProperties:a}=e,s=(0,C.VK)((()=>!o.getAlive()),[o]),l=(0,C.VK)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,cn.v)(e,i):void 0}),[t.id,o,i]),c=(0,C.VK)((()=>{const e=o.getQuery(r);return(0,Tt.OH)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:r}).reduce(((e,t)=>{if((0,Tt.aN)(t))return e+1;return e+(t.filters??[]).length}),0)}),[r,o]);return n()(d.FormattedMessage,a?{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported",description:"Caption when the view cannot be used for notifications because it's filter references an incompatible property type."}:s?{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",description:"Caption when the view cannot be found, most likely because it was deleted.",values:{emphasis:e=>n()("em",{},void 0,e)}}:l?{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",description:"Let's a user know that a rule was configured elsewhere.",values:{emphasis:e=>n()("em",{},void 0,e),externalParentBlockName:l}}:0===c?{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in view",description:"If there are no filters, show a preview that let's them know any page in this view will trigger notifications.."}:{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:c},description:"Gives a preview of number of filters on a collection view, e.g. `1 filter` or `2 filters`."})}const gn=(0,d.defineMessages)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More",description:"Accessibility label for button that opens a menu showing more actions for this trigger or action."}});function hn(e){window.__c={n:"AutomationBaseStepElement"};const{icon:t,onClick:o,title:i,caption:r,onEdit:a,onDelete:l,disabled:c}=e,{isMobile:d}=(0,k.Fy)(),[p,u]=(0,pe.Z)(),[m,g]=ue(),h=(0,C.qz)(void 0,fe.Z),f=(0,C.VK)((()=>h.getState()),[h]).hovered||u||g,v=(0,me.lq)(p,m),y=(0,C.qz)(void 0,A.Z),b=(0,_.yK)((e=>({button:{position:"relative"},moreButtonWrap:{display:f||d?"block":"none",position:"absolute",right:12,top:12},container:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",paddingTop:16,paddingBottom:16,paddingLeft:12,paddingRight:12,gap:8},title:{alignItems:"center",display:"flex",flexDirection:"row",gap:6},iconWrap:{flexShrink:0,alignSelf:"baseline",height:"24px",display:"flex",alignItems:"center"},iconStyle:{width:16,height:16,color:e.mediumIconColor},body:{flexShrink:1,fontSize:14,lineHeight:1.3,minWidth:0}})),[f,d]);return s.createElement(ve.Z,{onClick:()=>{null==o||o(y)},style:b.button,disabled:c,disabledFeedback:c,ref:v,focused:f,store:h},(a||l)&&n()("div",{style:b.moreButtonWrap},void 0,n()(fn,{onEdit:a,onDelete:l,disabled:c,buttonPopupStore:y})),n()("div",{style:b.container},void 0,n()("div",{style:b.title},void 0,t&&n()("div",{"aria-hidden":"true",style:b.iconWrap},void 0,t(b.iconStyle)),n()("div",{style:b.body},void 0,i)),r&&r))}function fn(e){const{onDelete:t,onEdit:o,disabled:i,buttonPopupStore:r}=e,l=(0,k.O7)(),{device:c}=l,p=(0,d.useIntl)(),u=(0,_.yK)((e=>({iconButton:{background:e.contentBackground,border:`1px solid ${e.regularDividerColor}`,height:26,width:26},iconButtonIcon:{width:14,height:14}})),[]);return s.createElement(s.Fragment,null,n()(N.Z,{buttonPopupStore:r,popupType:c.isMobile?U.kQ.SlideUp:U.kQ.Popup,alignmentToOrigin:N.Z.Alignment.Center,placementToOrigin:N.Z.Placement.Bottom,originGap:0,renderOrigin:e=>s.createElement(Se.Z,a()({},e,{disabled:i,ariaLabel:p.formatMessage(gn.moreLabel),icon:M.Z.dots,hasBackground:!0,iconStyle:u.iconButtonIcon,style:u.iconButton})),render:e=>n()(vn,{onClose:()=>e.close(),onEdit:o,onDelete:t})}))}function vn(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:i}=e,r=(0,ye.F)(),l=[o?{action:()=>{t(),o()},key:"edit",render:e=>s.createElement(re.Z,a()({},e,{icon:M.Z.pencil({height:16,width:16}),title:n()(d.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit",description:"Menu item title for editing the current action or trigger"})}))}:void 0,i?{action:()=>{t(),i()},key:"delete",render:e=>s.createElement(re.Z,a()({},e,{icon:M.Z.trash({height:16,width:16}),title:n()(d.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete",description:"Menu item title for deleting the current action or trigger"})}))}:void 0].filter(ge.$K);return s.createElement(O.Z,r,n()(ae.Z,{type:ae.i.Vertical,sections:[{items:l,key:"items",render:e=>s.createElement(H.Z,a()({enableActionSheetTitle:!0,topBorder:!0},e))}],initialFocus:0}))}function yn(e){window.__c={n:"AutomationAnyEditPropertyTrigger"};const{disabled:t,onDelete:o,onClick:i,propertySchema:r,onEdit:a}=e,s=(0,_.Fg)();return n()(hn,{disabled:t,onClick:i,icon:()=>n()(xo.ZP,{size:16,theme:s,icon:r.icon,type:r.type}),title:n()(d.FormattedMessage,{id:"automationTriggerList.propertyChangesToAny.title",defaultMessage:"<b>{propertyName}</b> is edited",description:"Represents that the automation will trigger when a specifc property is edited. (e.g. Status is edited)",values:{propertyName:r.name,b:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return n()("span",{style:{fontWeight:he.Z.fontWeight.semibold}},void 0,t)}}}),onEdit:a,onDelete:o})}var bn=o(85567),Sn=o(80951);const wn=5,kn=(0,d.defineMessages)({singleProperty:{defaultMessage:"{propertyName} set to {propertyValues}",description:"The title used when a single value has been set",id:"automations.automationStatusPropertyTrigger.singleProperty"}});function Cn(e){const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:l}=e;return"changes_to_any"===t.operator?n()(yn,{disabled:l,propertySchema:o,onClick:i,onDelete:r,onEdit:i}):s.createElement(_n,a()({},e,{filter:t}))}function _n(e){window.__c={n:"ParametrizableStatusPropertyTriggerFilter"};const{filter:t,limit:o=wn,propertySchema:i,onEdit:r,onDelete:a,disabled:s}=e,l=(0,d.useIntl)(),c=(0,_.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...he.Z.textOverflowStyle,fontWeight:he.Z.fontWeight.semibold}})),[]);if(!(0,Tt.vR)(t))return null;const p=t.value,u=i.name,m=Array.isArray(p)?p:[p],g=function(e){const{operatorValues:t,propertySchema:o}=e,i=o.groups||[];return t.map((e=>{if("is_group"!==e.type)return;const t=e.value;return i.find((e=>e.name===t))?n()("span",{},t,t):void 0})).filter(ge.$K)}({operatorValues:m,propertySchema:i}),h=function(e){const{limit:t,operatorValues:o,propertySchema:i}=e,r=i.groups||[],a=i.options||[],s=o.map((e=>{if("is_option"!==e.type)return;const t=e.value;if(void 0===t)return;const o=a.find((e=>e.value===t));if(void 0===o)return;const s=null==r?void 0:r.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(o.id)})),l=(0,Sn.JR)(o,s);return n()(hi.Z,{format:ui.l.Medium,isRound:!0,isSingle:!0,options:i.options??[],showColoredDot:l,showRemoveButton:!1,showEllipsis:!0,value:t},t)})).filter(ge.$K);let l;if(s.length>t){const e=s.length-t;l=[...s.slice(0,t),n()(bn.Z,{format:ui.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens")]}else l=s;return l}({limit:o,operatorValues:m,propertySchema:i}),f=l.formatList([...g,...h],{style:"long",type:"disjunction"}),v={propertyName:n()("span",{style:c.propertyName},void 0,u),propertyValues:Mn(f)};return n()(hn,{disabled:s,icon:M.Z.typesStatus,title:n()("div",{style:c.content},void 0,l.formatMessage(kn.singleProperty,v)),onEdit:r,onDelete:a,onClick:r})}function Mn(e){if(!Array.isArray(e))return[e];const t=[];for(const o of e)if("string"==typeof o&&" "!==o[0]){const e=t.pop();t.push(n()("div",{},void 0,e,o))}else t.push(o);return t}const Tn=(0,d.defineMessages)({selectPropertyTriggerTitle:{id:"automations.selectPropertyTrigger.title",defaultMessage:"{propertyName} set to {propertyValues}",description:"Title for which properties the user wants to configure for their trigger rule (e.g. Tags set to Arugula or Basil Pesto)."}});function In(e){const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:a}=e;if("changes_to_any"===t.operator)return n()(yn,{disabled:a,propertySchema:o,onClick:i,onEdit:i,onDelete:r});{const e={filter:t,propertySchema:o,onEdit:i,onDelete:r};return s.createElement(Pn,e)}}function Pn(e){window.__c={n:"ParametrizableSelectPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:a}=e,s=(0,d.useIntl)(),l=(0,_.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...he.Z.textOverflowStyle,fontWeight:he.Z.fontWeight.semibold}})),[]);if(!(0,Tt.vR)(t))return null;const c=t.value,p=o.name,u=function(e){const{operatorValues:t,propertySchema:o}=e,i=o.options??[],r=t.map((e=>{const t=i.find((t=>t.value===e.value));if(t)return n()(hi.Z,{format:ui.l.Medium,isSingle:!0,options:o.options??[],showRemoveButton:!1,value:t.value},t.id)})).filter(ge.$K);let a;const s=5;if(r.length>s){const e=r.length-s;a=[...r.slice(0,s),n()(bn.Z,{format:ui.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens")]}else a=r;return a}({operatorValues:Array.isArray(c)?c:[c],propertySchema:o}),m=s.formatList(u,{style:"long",type:"disjunction"}),g={propertyName:n()("span",{style:l.propertyName},void 0,p),propertyValues:Mn(m)};return n()(hn,{disabled:a,icon:xo.wG[o.type],title:n()("div",{style:l.content},void 0,s.formatMessage(Tn.selectPropertyTriggerTitle,g)),onClick:i,onEdit:i,onDelete:r})}function xn(e){window.__c={n:"AutomationTriggerList"};const{collectionStore:t,currentState:o,updateCurrentState:i,disabled:r}=e,a=(0,C.VK)((()=>null==t?void 0:t.getSchema()),[t]),l=s.useCallback((e=>{i({type:"remove_trigger",trigger:{type:"property_changed",property:e,filter:{operator:"changes_to_any"}}})}),[i]),c=(0,_.yK)((e=>({stepList:{border:`1px solid ${e.accentColors.gray[100]}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},semiBoldTitle:{fontWeight:he.Z.fontWeight.semibold},stepListDashedBorder:{borderStyle:"dashed"},stepItemWithBorderTop:{borderTop:`1px solid ${e.accentColors.gray[100]}`}})),[]),p=((null==o?void 0:o.triggers)??[]).map((e=>{if(e&&a&&t&&o){if("page_added"===e.type)return n()(hn,{disabled:r,onClick:e=>{e.setState({open:!0})},icon:M.Z.plus,title:n()("div",{style:c.semiBoldTitle},void 0,n()(d.FormattedMessage,{id:"automationTriggerList.pageAdded.title",defaultMessage:"Page added",description:"Represents that the automation will trigger when a page is added to configured source."})),onDelete:()=>{i({type:"remove_trigger",trigger:{type:"page_added"}})}});if("any_page_property_edited"===e.type)return n()(hn,{disabled:r,onClick:e=>{e.setState({open:!0})},icon:M.Z.pencil,title:n()("div",{style:c.semiBoldTitle},void 0,n()(d.FormattedMessage,{id:"automationTriggerList.anyPagePropertyEdited.title",defaultMessage:"Any page property edited",description:"Represents that the automation will trigger when a page in the configured source is edited."})),onDelete:()=>{i({type:"remove_trigger",trigger:{type:"any_page_property_edited"}})}});if("property_changed"!==e.type)return(0,ge.t1)(e);{const{property:s,filter:c}=e,d=a[s];if(!d)return;if("status"===d.type&&("changes_to_any"===c.operator||(0,Tt.r2)(c)))return n()(Bn,{property:s,collectionStore:t,currentState:o,updateCurrentState:i,renderOrigin:e=>{let{onClick:t}=e;return n()(Cn,{disabled:r,filter:c,propertySchema:d,onEdit:t,onDelete:()=>{l(s)}})}});if("select"===d.type&&("changes_to_any"===c.operator||(0,Tt.dx)(c)))return n()(Bn,{property:s,collectionStore:t,currentState:o,updateCurrentState:i,renderOrigin:e=>{let{onClick:t}=e;return n()(In,{disabled:r,filter:c,propertySchema:d,onEdit:t,onDelete:()=>{l(s)}})}});if("multi_select"===d.type&&("changes_to_any"===c.operator||(0,Tt.NU)(c)))return n()(Bn,{property:s,collectionStore:t,currentState:o,updateCurrentState:i,renderOrigin:e=>{let{onClick:t}=e;return n()(In,{disabled:r,filter:c,propertySchema:d,onEdit:t,onDelete:()=>{l(s)}})}});if("changes_to_any"===c.operator)return n()(yn,{disabled:r,onClick:e=>{e.setState({open:!0})},propertySchema:d,onDelete:()=>{l(s)}})}}})).filter(ge.$K);return n()("ul",{style:c.stepList},void 0,p.map(((e,t)=>n()("li",{style:0===t?{}:c.stepItemWithBorderTop},t,e))))}function Bn(e){window.__c={n:"AdvancedTriggerPopup"};const{renderOrigin:t,collectionStore:o,property:i,currentState:r,updateCurrentState:a}=e,s=(0,be.d)();return n()(N.Z,{popupType:s,renderOrigin:t,render:e=>n()(nn,{collectionStore:o,initialState:{type:"propertyChangedFilter",property:i},currentAutomationState:r,updateCurrentAutomationState:a,buttonPopupParent:e})})}const Zn=(0,d.defineMessages)({slackNonOwnerPrivateChannel:{id:"slackNotificationAction.slackTargetPersonalChannel.displayName",defaultMessage:"Private channel",description:"Name displayed for another user's personal Slack channel."}});function En(e){window.__c={n:"SlackNotificationAction"};const{automationId:t,actionId:o,config:i,currentAutomationState:r,updateCurrentAutomationState:l,collectionStore:c,currentUserIsOwner:p,disabled:u}=e,m=(0,be.d)(),g=null==i?void 0:i.target,h=(0,C.VK)((()=>ne.Z.completeSlackAuthentications.state.find((e=>(null==i?void 0:i.external_bot_id)===e.id))),[i]),f=(0,C.VK)((()=>{if(t)return Go.Mz.createChildStore(c,{id:t,table:Wo.cv,spaceId:c.getSpaceId()})}),[t,c]),v=(0,C.VK)((()=>{if(o&&f&&f.isTriggerType("notification_event"))return Go.zq.createChildStore(f,{id:o,table:jo.Xj,spaceId:c.getSpaceId()})}),[o,f,c]),y=(0,C.VK)((()=>"disabled_auth"===(null==f?void 0:f.getStatus())),[f]),b=(0,C.VK)((()=>{if(i&&h&&i.target)return f&&v&&i.external_bot_id&&y?{type:"connectToSlackReconnect",externalBotId:i.external_bot_id,notificationAutomationStore:f,notificationActionConfigStore:v}:{type:"selectChannelUpdate",actionId:o,currentExternalAuthentication:h,currentNotificationChannel:i.target}}),[o,v,f,i,h,y]),S=(0,_.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},caption:{fontSize:12,fontWeight:400,color:e.mediumTextColor},warningIcon:{width:12,height:"auto",color:e.accentColors.orange[400]}})),[]);return p?b&&g?n()(N.Z,{alignmentToOrigin:N.Z.Alignment.Center,placementToOrigin:N.Z.Placement.Bottom,popupType:m,render:e=>n()(nn,{initialState:b,updateCurrentAutomationState:l,buttonPopupParent:e,currentAutomationState:r,collectionStore:c}),renderOrigin:e=>s.createElement(hn,a()({},e,{disabled:u,onClick:()=>{e.onClick()},title:n()("div",{style:S.container},void 0,n()("div",{style:{fontWeight:500,marginRight:4}},void 0,n()(d.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify",description:"Title shown when the user is selecting an action to run for their automation."})),n()(An,{isUserAutomationOwner:p,channel:g})),icon:M.Z.slackLogo,caption:y&&n()("div",{style:S.container},void 0,M.Z.warning(S.warningIcon),n()("div",{style:S.caption},void 0,n()(d.FormattedMessage,{id:"SlackNotificationAction.caption.reconnectNeeded",defaultMessage:"Reconnect Slack to resume",description:"Message shown for Slack automation actions when users need to reauthenticate to Slack."}))),onEdit:()=>{e.onClick()},onDelete:()=>{l({type:"remove_action",action:{id:o,type:"slack_notification"}})}}))}):null:n()(hn,{disabled:!0,icon:M.Z.slackLogo,title:n()("div",{style:S.container},void 0,n()("div",{style:{fontWeight:500,marginRight:4}},void 0,n()(d.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify",description:"Title shown when the user is selecting an action to run for their automation."})),n()(An,{isUserAutomationOwner:p,channel:g}))})}const Rn={textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"};function An(e){const{channel:t,isUserAutomationOwner:o}=e;return t?"public"===t.type?n()(Dn,{channelName:t.name}):"private"===t.type?n()(Fn,{channelName:t.name,isUserAutomationOwner:o}):"me"===t.type?n()(Ln,{channelName:t.name,isUserAutomationOwner:o}):(0,ge.t1)(t.type):n()(Vn,{})}function Dn(e){return window.__c={n:"PublicSlackChannel"},n()("div",{style:Rn},void 0,`#${e.channelName}`)}function Fn(e){const{channelName:t,isUserAutomationOwner:o}=e,{isMobile:i}=(0,k.Fy)(),r=i?he.Z.fontSize.UISmall.mobile:he.Z.fontSize.UISmall.desktop;return o?s.createElement(s.Fragment,null,M.Z.locked({width:r,height:"auto"}),n()("div",{style:Rn},void 0,t)):n()(Vn,{})}function Ln(e){const{channelName:t,isUserAutomationOwner:o}=e;return o?n()("div",{style:Rn},void 0,`@${t}`):n()(Vn,{})}function Vn(){const{isMobile:e}=(0,k.Fy)(),t=(0,d.useIntl)(),o=e?he.Z.fontSize.UISmall.mobile:he.Z.fontSize.UISmall.desktop,i=t.formatMessage(Zn.slackNonOwnerPrivateChannel);return s.createElement(s.Fragment,null,M.Z.locked({width:o,height:"auto"}),n()("div",{style:Rn},void 0,i))}var Nn=o(42875),On=o(61784),Un=o(70203),Hn=o(75311);const zn=(0,d.defineMessages)({singleProperty:{defaultMessage:"Set {propertyName} to {propertyValue}",description:"The title used when a single value has been set",id:"automations.updateDatePropertyAction.singleProperty"}});function Wn(e){window.__c={n:"UpdateDatePropertyAction"};const{disabled:t,onClick:o,onDelete:i,propertySchema:r,value:a,valueContext:s}=e,l=(0,d.useIntl)(),c=(0,_.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...he.Z.textOverflowStyle,fontWeight:he.Z.fontWeight.semibold}})),[]),p={propertyName:n()("span",{style:c.propertyName},void 0,r.name),propertyValue:n()(jn,{value:a,valueContext:s})};return n()(hn,{disabled:t,icon:M.Z.typesDate,onClick:o,onDelete:i,title:n()("div",{style:c.content},void 0,l.formatMessage(zn.singleProperty,p))})}function jn(e){const{value:t,valueContext:o}=e,i=(0,d.useIntl)(),r=(0,C.VK)((()=>(0,Hn._)(o)),[o]),a=(0,C.VK)((()=>(0,Ei.A6)(null==t?void 0:t.value)),[t])[0],l=a&&(0,Ei.S3)(a)&&(0,Un.fp)(a)?(0,Un.Ot)(a):void 0;return l?(0,On.OB)({value:l,date_format:r.dateFormat,time_format:r.timeFormat,userTimeZone:(0,Nn.r)(),allowRelativeDates:!0,intl:i,shortenDateAndRange:!0,displayInUserTimezone:!1,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:i}=e;return(0,ge.$K)(o)?s.createElement(s.Fragment,null,n()(Kn,{value:i})," → ",n()(Kn,{value:o})):(0,ge.$K)(t)?s.createElement(s.Fragment,null,n()(Kn,{value:i})," → ",n()(Kn,{value:t})):n()(Kn,{value:i})}}):null}function Kn(e){window.__c={n:"AutomationDateToken"};const{value:t}=e,o=(0,_.Fg)();return n()(bn.Z,{backgroundColor:o.accentColors.gray[75],format:ui.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:{marginBlockEnd:4},value:t})}const Yn=5,Gn=(0,d.defineMessages)({multipleProperties:{defaultMessage:"Set {propertyName} to all of {propertyValues}",description:"The title used when multiple values have been set",id:"automations.updateMultiSelectPropertyAction.multiProperties"},singleProperty:{defaultMessage:"Set {propertyName} to {propertyValues}",description:"The title used when a single value has been set",id:"automations.updateMultiSelectPropertyAction.singleProperty"}});function Xn(e){window.__c={n:"UpdateMultiSelectPropertyAction"};const{disabled:t,limit:o=Yn,onClick:i,onDelete:r,propertySchema:a,value:s}=e,l=(0,C.VK)((()=>(0,Ei.A6)(null==s?void 0:s.value)),[s]),c=(0,d.useIntl)(),p=(0,_.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...he.Z.textOverflowStyle,fontWeight:he.Z.fontWeight.semibold}})),[]),u=a.name,m=function(e){const{limit:t,operatorValues:o,propertySchema:i}=e,r=i.options||[],a=o.map((e=>{if("string"!=typeof e)return;const t=e;return void 0!==r.find((e=>e.value===t))?n()(hi.Z,{format:ui.l.Medium,isSingle:!0,options:i.options??[],showRemoveButton:!1,showEllipsis:!0,style:{marginBlockStart:4},value:t},t):void 0})).filter(ge.$K);let s;if(a.length>t){const e=a.length-t;s=[...a.slice(0,t),n()(bn.Z,{format:ui.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:{marginBlockStart:4},value:`+${e}`},"More tokens")]}else s=a;return s}({limit:o,operatorValues:Array.isArray(l)?l:[l],propertySchema:a}),g=c.formatList(m,{style:"short",type:"disjunction"}),h={propertyName:n()("span",{style:p.propertyName},void 0,u),propertyValues:g},f=Array.isArray(g)&&g.length>1?Gn.multipleProperties:Gn.singleProperty;return n()(hn,{disabled:t,icon:M.Z.typesMultipleSelect,onClick:i,onDelete:r,title:n()("div",{style:p.content},void 0,c.formatMessage(f,h))})}var qn=o(66897),$n=o(92864);const Jn=(0,d.defineMessages)({multipleProperties:{defaultMessage:"Set {propertyName} to all of {propertyValue}",description:"The title used when multiple assignees have been set",id:"automations.updatePersonPropertyAction.multiProperties"},singleProperty:{defaultMessage:"Set {propertyName} to {propertyValue}",description:"The title used when a single assignee has been set",id:"automations.updatePersonPropertyAction.singleProperty"}});function Qn(e){var t;window.__c={n:"UpdatePersonPropertyAction"};const{collectionStore:o,disabled:i,onClick:r,onDelete:a,propertySchema:s,setPropertyValue:l}=e,c=(0,Sn.DW)({textValue:null===(t=l.value)||void 0===t?void 0:t.value,propertySchema:s}),p=(0,C.VK)((()=>c.map((e=>(0,qn.Hl)({pointer:e,getRecordValue:o.getRecordValue})))),[o,c]),u=(0,d.useIntl)(),m=(0,_.yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:1===p.length?"wrap":"nowrap",whiteSpace:"pre"},propertyName:{...he.Z.textOverflowStyle,fontWeight:he.Z.fontWeight.semibold},propertyValue:{...he.Z.textOverflowStyle,paddingBlockStart:4},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:4}})),[p]),g=s.name,h=function(e){const{actors:t,styles:o}=e;return 1===t.length?n()("div",{style:o.propertyValue},void 0,n()($n.ZP,{actor:t[0],showRemoveButton:!1,format:$n.ZP.Format.Medium,isSingle:!1})):n()("ul",{style:o.propertyValueList},void 0,t.map(((e,t)=>n()("li",{},t,n()("div",{style:o.propertyValue},t,n()($n.ZP,{actor:e,showRemoveButton:!1,format:$n.ZP.Format.Medium,isSingle:!1}))))))}({actors:p,styles:m}),f=p.length>1?Jn.multipleProperties:Jn.singleProperty,v={propertyName:n()("span",{style:m.propertyName},void 0,g),propertyValue:h};return n()(hn,{disabled:i,icon:M.Z.typesPerson,onClick:r,onDelete:a,title:n()("div",{style:m.content},void 0,u.formatMessage(f,v))})}const er=(0,d.defineMessages)({singleProperty:{defaultMessage:"Set {propertyName} to {propertyValue}",description:"The title used when a single value has been set",id:"automations.updateSelectPropertyAction.singleProperty"}});function tr(e){window.__c={n:"UpdateSelectPropertyAction"};const{disabled:t,onClick:o,onDelete:i,propertySchema:r,value:a}=e,s=(0,C.VK)((()=>(0,Ei.A6)(null==a?void 0:a.value)),[a]),l=(0,d.useIntl)(),c=(0,_.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...he.Z.textOverflowStyle,fontWeight:he.Z.fontWeight.semibold}})),[]),p=r.name,u=function(e){window.__c={n:"getPropertySelectValue"};const{operatorValue:t,propertySchema:o}=e;if("string"!=typeof t)return;const i=t,r=o.options||[];if(void 0===r.find((e=>e.value===i)))return;return n()(hi.Z,{format:ui.l.Medium,isSingle:!0,options:o.options??[],showRemoveButton:!1,value:i},i)}({operatorValue:s[0],propertySchema:r}),m={propertyName:n()("span",{style:c.propertyName},void 0,p),propertyValue:u};return n()(hn,{disabled:t,icon:M.Z.typesSelect,onClick:o,onDelete:i,title:n()("div",{style:c.content},void 0,l.formatMessage(er.singleProperty,m))})}const or=5,ir=(0,d.defineMessages)({multipleProperties:{defaultMessage:"Set {propertyName} to all of {propertyValues}",description:"The title used when multiple values have been set",id:"automations.updateStatusPropertyAction.multiProperties"},singleProperty:{defaultMessage:"Set {propertyName} to {propertyValues}",description:"The title used when a single value has been set",id:"automations.updateStatusPropertyAction.singleProperty"}});function nr(e){window.__c={n:"UpdateStatusPropertyAction"};const{disabled:t,limit:o=or,onClick:i,onDelete:r,propertySchema:a,value:s}=e,l=(0,C.VK)((()=>(0,Ei.A6)(null==s?void 0:s.value)),[s]),c=(0,d.useIntl)(),p=(0,_.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...he.Z.textOverflowStyle,fontWeight:he.Z.fontWeight.semibold}})),[]),u=a.name,m=function(e){const{limit:t,operatorValues:o,propertySchema:i}=e,r=i.groups||[],a=i.options||[],s=o.map((e=>{if("string"!=typeof e)return;const t=e,o=a.find((e=>e.value===t));if(void 0===o)return;const s=null==r?void 0:r.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(o.id)})),l=(0,Sn.JR)(o,s);return n()(hi.Z,{format:ui.l.Medium,isRound:!0,isSingle:!0,options:i.options??[],showColoredDot:l,showRemoveButton:!1,showEllipsis:!0,style:{marginBlockStart:4},value:t},t)})).filter(ge.$K);let l;if(s.length>t){const e=s.length-t;l=[...s.slice(0,t),n()(bn.Z,{format:ui.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:{marginBlockStart:4},value:`+${e}`},"More tokens")]}else l=s;return l}({limit:o,operatorValues:Array.isArray(l)?l:[l],propertySchema:a}),g=c.formatList(m,{style:"short",type:"disjunction"}),h={propertyName:n()("span",{style:p.propertyName},void 0,u),propertyValues:g},f=Array.isArray(g)&&g.length>1?ir.multipleProperties:ir.singleProperty;return n()(hn,{disabled:t,icon:M.Z.typesStatus,onClick:i,onDelete:r,title:n()("div",{style:p.content},void 0,c.formatMessage(f,h))})}function rr(e){const{collectionStore:t,disabled:o,formulaValueContext:i,onClick:r,propertySchema:a,setPropertyValue:s,onDelete:l}=e;return void 0===s.value?null:"person"===a.type?n()(Qn,{collectionStore:t,disabled:o,onClick:r,onDelete:l,propertySchema:a,setPropertyValue:s}):"status"===a.type?n()(nr,{disabled:o,onClick:r,onDelete:l,propertySchema:a,value:s.value}):"select"===a.type?n()(tr,{disabled:o,onClick:r,onDelete:l,propertySchema:a,value:s.value}):"multi_select"===a.type?n()(Xn,{disabled:o,onClick:r,onDelete:l,propertySchema:a,value:s.value}):"date"===a.type?n()(Wn,{disabled:o,onClick:r,onDelete:l,propertySchema:a,value:s.value,valueContext:i}):null}function ar(e){window.__c={n:"CollectionSettingsAutomationActionList"};const{automationId:t,collectionStore:o,currentAutomationState:i,updateCurrentAutomationState:r,currentUserIsOwner:l,disabled:c}=e,d=(0,be.d)(),p=(0,C.VK)((()=>null==o?void 0:o.getSchema()),[o]),u=(0,_.yK)((e=>({stepList:{border:`1px solid ${e.accentColors.gray[100]}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},stepListDashedBorder:{borderStyle:"dashed"},stepItemWithBorderTop:{borderTop:`1px solid ${e.accentColors.gray[100]}`}})),[]);if(!o||!p||!i)return null;const m=i.actions,g=[];for(const v of m)if("update_pages"===v.type){var h;const e=()=>{r({type:"remove_action",action:v})},t=v.config;if("variable"===(null==t||null===(h=t.target)||void 0===h?void 0:h.type)){const l=(0,Zi.MY)(t.target.id);if("global"===l.source&&"button_page"===l.global){var f;const l=(t.properties??[])[0],u=p[l],m=null===(f=t.values)||void 0===f?void 0:f[l];if(u&&m){const t={type:"collection",collectionStore:o,property:l};g.push(n()(N.Z,{alignmentToOrigin:N.Z.Alignment.End,placementToOrigin:N.Z.Placement.Bottom,popupType:d,render:e=>n()(nn,{actionId:v.id,buttonPopupParent:e,collectionStore:o,currentAutomationState:i,initialState:{propertyId:l,type:"eventActionProperty"},updateCurrentAutomationState:r}),renderOrigin:i=>s.createElement(rr,a()({},i,{collectionStore:o,disabled:c,formulaValueContext:t,onDelete:e,propertySchema:u,setPropertyValue:m}))}))}}}}else"slack_notification"===v.type&&g.push(n()(En,{automationId:t,actionId:v.id,config:v.config,collectionStore:o,currentAutomationState:i,updateCurrentAutomationState:r,currentUserIsOwner:l,disabled:c}));return n()("ul",{style:u.stepList},void 0,g.map(((e,t)=>{const o=0===t?void 0:u.stepItemWithBorderTop;return n()("li",{style:o},t,e)})))}var sr=o(3386);const lr=(0,d.defineMessages)({addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger",description:"Plus button icon - on click will open a menu to add more triggers."},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action",description:"Plus button icon - on click will open a menu to add more actions."}});function cr(e){window.__c={n:"CollectionSettingsEditAutomationView"};const{automationPermissionScope:t,automationId:o,collectionSettingsStore:i,collectionContextStore:r,isCreate:l,title:c,header:p,currentState:m,updateCurrentState:g,canSave:h,onSave:f,availableActions:v,currentUserIsOwner:y,onDelete:b,hasPendingChanges:S}=e,w=(0,d.useIntl)(),k=(0,C.VK)((()=>r.collectionStore()),[r]),T=(0,s.useMemo)((()=>({type:"eventTriggers"})),[]),I=(0,s.useMemo)((()=>({type:"eventActions"})),[]),P=function(){const e=4;return(0,_.yK)((t=>({automationSection:{display:"flex",flexDirection:"column",gap:e},automationSectionAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},automationSectionHeader:{alignItems:"center",display:"flex",flexDirection:"row"},automationSectionHeaderAction:{paddingBlockStart:36,position:"relative"},automationSectionTitle:{backgroundColor:t.contentBackground,color:t.lightTextColor,fontSize:12,lineHeight:1.3,position:"relative",fontWeight:he.Z.fontWeight.medium},automationSectionVerticalLine:{backgroundColor:t.accentColors.gray[100],bottom:-e,left:20,position:"absolute",top:0,width:2},wrap:{borderTop:`1px solid ${t.accentColors.gray[100]}`,paddingBlockStart:15,paddingBlockEnd:12,paddingInline:12}})),[])}(),x=(0,be.d)(),B="readonly_with_delete"===t||"edit"===t&&!l,Z="edit"===t,E=!!m&&m.triggers.filter(ge.$K).length>0,R=!!m&&m.actions.length>0,A=R&&"slack_notification"!==(null==m?void 0:m.actions[0].type)&&Z,D=s.useCallback((async()=>{if(!m)return;await dr({automationName:m.name,hasPendingChanges:S})&&u.z$({collectionSettingsStore:i})}),[m,S,i]),V=s.useCallback((async()=>{if(!m)return;await dr({automationName:m.name,hasPendingChanges:S})&&u.E3({collectionSettingsStore:i})}),[m,S,i]);return n()(sr.Z,{capture:!0,onEsc:V},void 0,n()(F.ZP,{title:c,collectionSettingsStore:i,collectionContextStore:r,handleBackArrowClick:D,handleClose:V,footer:B&&n()(H.Z,{topBorder:!0},void 0,n()(L.Z,{icon:M.Z.trash,title:n()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.delete",defaultMessage:"Delete",description:"Button to delete the automation"}),onClick:b})),fullHeight:!0,menuScrollerStyle:{flexGrow:1,marginBlockStart:6}},void 0,p,n()(ae.Z,{type:ae.i.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>s.createElement(Y.ZP,a()({style:{paddingBottom:8}},e,{value:(null==m?void 0:m.name)??"Loading...",onChange:e=>{const t=e.target.value;g({type:"update_name",name:t})},disabled:!Z}))},{key:"automation_source",action:()=>{},render:e=>n()(pn,{menuListItemProps:e,selectedSourcePointer:null==m?void 0:m.sourcePointer,collectionContextStore:r,onSelect:e=>{g({type:"update_source",pointer:e})},disabled:!Z})}],render:e=>s.createElement(H.Z,e)}]}),n()("div",{style:P.wrap},void 0,n()("section",{style:P.automationSection},void 0,n()("header",{style:P.automationSectionHeader},void 0,n()("div",{style:P.automationSectionTitle},void 0,n()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.triggerSection.title",defaultMessage:"When any of these occur",description:"Header of various automation triggers."})),n()("div",{style:{...P.automationSectionAdd,visibility:E&&Z?void 0:"hidden"}},void 0,n()(N.Z,{popupType:x,alignmentToOrigin:N.Z.Alignment.End,placementToOrigin:N.Z.Placement.Bottom,renderOrigin:e=>s.createElement(Se.Z,a()({},e,{ariaLabel:w.formatMessage(lr.addTriggerAriaLabel),icon:M.Z.plus})),render:e=>k&&m&&n()(nn,{collectionStore:k,initialState:T,currentAutomationState:m,updateCurrentAutomationState:g,buttonPopupParent:e})}))),E?n()(xn,{collectionStore:k,currentState:m,updateCurrentState:g,disabled:!Z}):n()(N.Z,{popupType:x,renderOrigin:e=>s.createElement(ni,a()({},e,{icon:M.Z.plus({height:12,width:12}),title:n()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.triggerSection.placeholder",defaultMessage:"Add trigger",description:"Placeholder prompt for adding triggers to automation."})})),render:e=>k&&m&&n()(nn,{collectionStore:k,initialState:T,currentAutomationState:m,updateCurrentAutomationState:g,buttonPopupParent:e})})),n()("section",{style:P.automationSection},void 0,n()("header",{style:{...P.automationSectionHeader,...P.automationSectionHeaderAction}},void 0,n()("div",{style:P.automationSectionVerticalLine}),n()("div",{style:P.automationSectionTitle},void 0,n()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.actionSection.title",defaultMessage:"Do this",description:"Header of various automation actions."})),n()("div",{style:{...P.automationSectionAdd,visibility:A?void 0:"hidden"}},void 0,n()(N.Z,{alignmentToOrigin:N.Z.Alignment.End,placementToOrigin:N.Z.Placement.Bottom,popupType:x,render:e=>k&&m&&n()(nn,{buttonPopupParent:e,collectionStore:k,currentAutomationState:m,initialState:I,updateCurrentAutomationState:g}),renderOrigin:e=>s.createElement(Se.Z,a()({},e,{ariaLabel:w.formatMessage(lr.addActionAriaLabel),icon:M.Z.plus}))}))),R?n()(ar,{automationId:o,collectionStore:k,currentAutomationState:m,updateCurrentAutomationState:g,currentUserIsOwner:y,disabled:!Z}):n()(rn,{availableActions:v,collectionStore:k,currentAutomationState:m,initialState:I,updateCurrentAutomationState:g})),Z&&n()("section",{style:{...P.automationSection,marginTop:24}},void 0,n()(et.Z,{onClick:f,disabled:!h},void 0,n()(d.FormattedMessage,l?{id:"collectionSettings.editAutomationView.createButton.label",defaultMessage:"Create",description:"Blue button to create a new automation."}:{id:"collectionSettings.editAutomationView.saveButton.label",defaultMessage:"Save",description:"Blue button to save an automation."}))))))}async function dr(e){const{automationName:t,hasPendingChanges:o}=e;return!o||await He.confirmUserAction({message:n()(d.FormattedMessage,{id:"automations.confirmDiscardChanges.message",defaultMessage:"{hasName, select, true {Are you sure you want to discard {automationName}?} other {Are you sure you want to discard this automation?}}",description:"Confirmation dialogue that appears if the user is trying to navigate away from their automation and have pending changes",values:{automationName:t,hasName:Boolean(t)}}),acceptLabel:n()(d.FormattedMessage,{id:"automations.confirmDiscardChanges.acceptLabel",defaultMessage:"Discard",description:"Confirmation button label that appears if the user is trying to navigate away from their automation and have pending changes"})})}function pr(e){window.__c={n:"CollectionSettingsEditSlackAutomationView"};const{collectionSettingsStore:t,collectionContextStore:o,...i}=e,r=s.useMemo((()=>i),[]),a=(0,k.O7)(),l=(0,d.useIntl)(),c=(0,C.VK)((()=>o.collectionStore()),[o]),m=(0,C.VK)((()=>Ke.default.state.currentUserStore),[]),[{value:h}]=(0,Le.r5)((async()=>{if("create"===r.type||!c)return;const{automationId:e,automationActionId:t}=r,o=c.getSpaceId(),i=Go.Mz.createChildStore(c,{id:e,table:Wo.cv,spaceId:o});if(!i.isTriggerType("notification_event"))return;const n=Go.zq.createChildStore(i,{id:t,table:jo.Xj,spaceId:o});return i.isDefined()||await i.load(),n.isDefined()||await n.load(),{automationStore:i,automationActionStore:n}}),[r,c]),f=(0,C.VK)((()=>{if("create"===r.type)return!0;if(!h||!m)return!1;const e=m.pointer,t=h.automationStore.getCreatedByPointer();return!(!e||!t)&&zo.dr.isEqual(e,t)}),[h,m,r]),v=(0,C.VK)((()=>"create"===r.type?function(e){const{collectionStore:t,currentUserStore:o,intl:i}=e;if(!t||!o)return;const n=o.getDisplayName(i),r=t.getSpaceShardedPointer();return{name:i.formatMessage(Ho.pQ.slackAutomationDefaultName,{hasCreatorName:Boolean(n),creatorName:n}),triggerType:"notification_event",sourcePointer:r,triggers:[void 0,void 0],actions:[]}}({collectionStore:c,currentUserStore:m,intl:l}):"update"===r.type?function(e){const{automationStore:t,automationActionStore:o,intl:i}=e;if(!t||!o)return;const n=t.getNameWithDefault(i),r=t.getEventConfiguration(),a=(null==r?void 0:r.source.type)===Yo.n||(null==r?void 0:r.source.type)===Ko.v?r.source.pointer:void 0,s=null!=r&&r.pagesAdded?{type:"page_added"}:void 0,l="any"===(null==r?void 0:r.pagePropertiesEdited.type)?{type:"any_page_property_edited"}:void 0,c="some"===(null==r?void 0:r.pagePropertiesEdited.type)?r.pagePropertiesEdited.some.map((e=>({type:"property_changed",...e}))):[];let d;if(o.isType("slack_notification")){const e=o.getType(),t=o.getConfig();e&&t&&(d={id:o.id,type:e,config:t})}const p=[s,l,...c];if(a&&d)return{name:n,triggerType:"notification_event",sourcePointer:a,triggers:p,actions:[d]}}({...h,intl:l}):void(0,ge.t1)(r)),[h,l,r,m,c]),[y,b]=s.useReducer(xt,v),[S,w]=s.useState(!1),_=(0,C.VK)((()=>ne.Z.completeSlackAuthentications.state),[]),M=(0,C.VK)((()=>0===_.length?{type:"connectToSlackDefault"}:1===_.length?{type:"selectChannelNew"}:{type:"selectWorkspace"}),[_.length]),T=(0,C.VK)((()=>"create"===r.type?"edit":h?function(e){const{automationStore:t,actionStore:o}=e,i=t.getMinimumFieldsForPermissions();return!!i&&(!!o.isDefined()&&(0,It.fz)({automationValue:i,actionValues:[{type:o.getType(),config:o.getConfig()}]}).every((e=>{let{pointer:o,minimumRequiredRole:i}=e;const n=t.getRecordRole(o);return!!n&&(0,Pt.yY)(n,i)})))}({automationStore:h.automationStore,actionStore:h.automationActionStore})?"edit":Et({automationStore:h.automationStore})?"readonly_with_delete":"readonly":"edit"),[h,r.type]),I=(0,C.VK)((()=>o.aliveSlackAutomationCount.state),[o]),P=(0,C.VK)((()=>null==h?void 0:h.automationStore.getStatus()),[null==h?void 0:h.automationStore]),x=(0,C.VK)((()=>{if(!h||!c)return!1;const e=null==y?void 0:y.sourcePointer;if(!e||e.table===Ko.v)return!1;return At({collectionViewStore:Go.Xr.createChildStore(c,e),collectionSchema:c.getSchema()})}),[c,null==y?void 0:y.sourcePointer,h]),B=(0,C.VK)((()=>{var e;if(h)return null===(e=h.automationStore.getOwnerStore())||void 0===e?void 0:e.getDisplayName(l)}),[l,h]),Z=!Ht().isEqual(v,y),E=s.useCallback((()=>{c&&y&&Z&&("create"===r.type?($o({environment:a,collectionStore:c,currentState:y}),Qo.oV({label:n()(d.FormattedMessage,{id:"automations.editSlackView.createdConfirmation",defaultMessage:"{automationName} created",description:"Snackbar feedback that appears after user creates their automation.",values:{automationName:y.name}})}),u.wl({collectionSettingsStore:t,item:{type:"slackAutomations"}})):"update"===r.type?(h&&qo({environment:a,automationStore:h.automationStore,currentState:y}),w(!1),Qo.oV({label:n()(d.FormattedMessage,{id:"automations.editSlackView.updatedConfirmation",defaultMessage:"{automationName} updated",description:"Snackbar feedback that appears after user updates their automation.",values:{automationName:y.name}})}),u.z$({collectionSettingsStore:t})):(0,ge.t1)(r))}),[c,y,a,t,Z,h,r]),R=s.useCallback((async()=>{h&&c&&await Jo({intl:l,environment:a,existingAutomationStore:h.automationStore,parentCollectionId:c.id,collectionStore:c,triggerType:"notification_event",onDelete:()=>{1===I?u.E3({collectionSettingsStore:t}):u.z$({collectionSettingsStore:t})}})}),[h,c,l,a,I,t]),A=s.useCallback((()=>{h&&c&&function(e){const{environment:t,existingAutomationStore:o,parentCollectionId:i}=e;g.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.reactivateNotificationAutomation",perform:e=>{dt.sW({store:o,data:{status:"active"},transaction:e})}}),p.trackSlackNotificationReactivate(t,{type:"granular",source:"collection_view_settings",collection_id:i})}({environment:a,existingAutomationStore:h.automationStore,parentCollectionId:c.id})}),[c,a,h]);s.useEffect((()=>{v&&!y&&b({type:"initialize_state",data:v})}),[v,y,b]);const D=Bt(y),F=S&&D;return n()(cr,{automationPermissionScope:T,automationId:"update"===r.type?r.automationId:void 0,header:P&&B&&n()(ti,{automationStatus:P,automationPermissionScope:T,automationCreatorName:B,referencesIncompatibleCollectionViewFilter:x,onDelete:R,onResume:A}),isCreate:"create"===i.type,title:"create"===i.type?n()(d.FormattedMessage,{id:"collectionSettings.createSlackAutomationView.title",defaultMessage:"New Slack notification",description:"Header of panel for when user is creating a new Slack Notification configuration"}):n()(d.FormattedMessage,{id:"collectionSettings.editSlackAutomationView.title",defaultMessage:"Slack notification",description:"Header of panel for when user is viewing or editing a Slack Notification configuration"}),currentUserIsOwner:f,triggerOperators:["any"],availableActions:[{type:"slack_notification",initialMenuState:M}],currentState:y,updateCurrentState:e=>{w(!0),b(e)},hasPendingChanges:Z,canSave:F,onSave:E,onDelete:R,collectionSettingsStore:t,collectionContextStore:o})}const ur=(0,d.defineMessages)({createStatusAutomationViewMenuTitle:{id:"collectionSettings.createStatusAutomationView.menuTitle",defaultMessage:"Create status automation",description:"Menu title for creating the status automation"},editStatusAutomationViewMenuTitle:{id:"collectionSettings.editStatusAutomationView.menuTitle",defaultMessage:"Edit status automation",description:"Menu title for editing the status automation"}});function mr(e){window.__c={n:"CollectionSettingsEditStatusAutomationView"};const{collectionSettingsStore:t,collectionContextStore:o,...i}=e,r=s.useMemo((()=>i),[]),a=(0,d.useIntl)(),l=(0,k.O7)(),c=(0,C.VK)((()=>o.collectionStore()),[o]),p=(0,C.VK)((()=>o.collectionViewStore()),[o]),m=(0,C.VK)((()=>Ke.default.state.currentUserStore),[]),[{value:g}]=(0,Le.r5)((async()=>{if("create"===r.type||!c)return;const{automationId:e}=r,t=c.getSpaceId(),o=Go.Mz.createChildStore(c,{id:e,table:Wo.cv,spaceId:t});if(!o.isTriggerType("event"))return;o.isDefined()||await o.load();const i=o.getActionStores(),n=await Promise.all(i.map((async e=>{const i=Go.zq.createChildStore(o,{id:e.id,table:jo.Xj,spaceId:t});return i.isDefined()||await i.load(),i})));return{automationStore:o,automationActionStores:n}}),[r,c]),h=(0,C.VK)((()=>{if("create"===r.type)return!0;if(!g||!m)return!1;const e=m.pointer,t=g.automationStore.getCreatedByPointer();return!(!e||!t)&&zo.dr.isEqual(e,t)}),[g,m,r]),f=(0,C.VK)((()=>"create"===r.type?function(e){const{collectionViewStore:t,currentUserStore:o,intl:i}=e;if(!t||!o)return;const n=o.getDisplayName(i),r=t.getSpaceShardedPointer();return{name:i.formatMessage(Ho.pQ.automationDefaultName,{hasCreatorName:Boolean(n),creatorName:n}),triggerType:"event",sourcePointer:r,triggers:[],actions:[]}}({collectionViewStore:p,currentUserStore:m,intl:a}):"update"===r.type?function(e){const{automationStore:t,automationActionStores:o,intl:i}=e;if(!t||!o)return;const n=t.getNameWithDefault(i),r=t.getEventConfiguration(),a=(null==r?void 0:r.source.type)===Yo.n||(null==r?void 0:r.source.type)===Ko.v?r.source.pointer:void 0,s=null!=r&&r.pagesAdded?{type:"page_added"}:void 0,l="any"===(null==r?void 0:r.pagePropertiesEdited.type)?{type:"any_page_property_edited"}:void 0,c="some"===(null==r?void 0:r.pagePropertiesEdited.type)?r.pagePropertiesEdited.some.map((e=>({type:"property_changed",...e}))):[],d=o.map((e=>{const t=e.getType(),o=e.getConfig();if(t&&o)return{id:e.id,type:t,config:o}})).filter(ge.$K),p=[s,l,...c];if(a)return{name:n,triggerType:"event",sourcePointer:a,triggers:p,actions:d}}({...g,intl:a}):void(0,ge.t1)(r)),[g,a,r,m,p]),[v,y]=s.useReducer(xt,f),[b,S]=s.useState(!1),w=s.useCallback((()=>{c&&v&&(Ht().isEqual(f,v)||("create"===r.type?$o({environment:l,collectionStore:c,currentState:v}):"update"===r.type?g&&qo({environment:l,automationStore:g.automationStore,currentState:v}):(0,ge.t1)(r)),S(!1))}),[c,v,l,f,g,r]);s.useEffect((()=>{f&&!v&&y({type:"initialize_state",data:f})}),[f,v,y]);const _=s.useCallback((async()=>{g&&c&&await Jo({intl:a,environment:l,existingAutomationStore:g.automationStore,parentCollectionId:c.id,collectionStore:c,triggerType:"event",onDelete:()=>{u.E3({collectionSettingsStore:t})}})}),[g,c,a,l,t]);if(!v||!c)return null;const M=Bt(v),T="create"===i.type,I=b&&M,P=T?a.formatMessage(ur.createStatusAutomationViewMenuTitle):a.formatMessage(ur.editStatusAutomationViewMenuTitle);return n()(cr,{automationPermissionScope:"edit",availableActions:[{type:"create_page"},{type:"update_pages"}],canSave:I,collectionContextStore:o,collectionSettingsStore:t,currentState:v,currentUserIsOwner:h,header:void 0,isCreate:T,onDelete:_,onSave:w,title:P,triggerOperators:["any"],updateCurrentState:e=>{S(!0),y(e)},hasPendingChanges:!1})}var gr=o(10107),hr=o(68882),fr=o(55332),vr=o(28020),yr=o(99417),br=o(96026),Sr=o(61519),wr=o(73420),kr=o(91839);const Cr=(0,d.defineMessages)({suggestedPromptItemsTitle:{defaultMessage:"Fill with...",id:"database.viewSettings.propertyTab.aiAutofill.suggestedPromptItemsTitle",description:"Menu section title above suggested pre-packaged AI actions for database properties in the Fill with Notion AI menu"},extractPromptSectionTitle:{defaultMessage:"Ask AI to extract...",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptSectionTitle",description:"Text above the input field for a custom Notion AI prompt used to fill a database property"},customPromptSectionTitle:{defaultMessage:"Ask AI to write...",id:"database.viewSettings.propertyTab.aiAutofill.customPromptSectionTitle",description:"Text above the input field for a custom Notion AI prompt used to fill a database property"},extractPromptInputPlaceholder:{defaultMessage:'e.g. "Due date", "Where does this candidate work?"',id:"database.viewSettings.propertyTab.aiAutofill.extractPromptInputPlaceholder",description:'Placeholder text for the input for the "Extract key info" Notion AI prompt used to fill a database property'},customPromptInputPlaceholder:{defaultMessage:"Tell AI what to generate from properties and content on this page...",id:"database.viewSettings.propertyTab.aiAutofill.customPromptInputPlaceholder",description:"Placeholder text for the input for a custom Notion AI prompt used to fill a database property"},removeAutofillButton:{defaultMessage:"Turn off fill with AI",id:"database.viewSettings.propertyTab.aiAutofill.removeAutofillButton",description:"Button to remove Fill with AI from a database property"},toggleFillWithAiSectionLabel:{defaultMessage:"Actions",id:"database.viewSettings.propertyTab.aiAutofill.actionsSectionLabel",description:"Text above the button that disables fill with AI setting"}});function _r(e){window.__c={n:"CollectionSettingsPropertyAiAutofill"};const{property:t,collectionContextStore:o,collectionSettingsStore:i}=e,r=(0,C.VK)((()=>o.normalizedSchemaStore.state[t]),[t,o.normalizedSchemaStore]),l=r&&(0,Bi.q3)(r),c=(0,k.O7)(),m=(0,_.Fg)(),h=(0,C.VK)((()=>{const e=o.collectionStore();return e&&(0,yr.mX)(c,br.Z.getMode(c,e),e)}),[c,o]);(0,s.useEffect)((()=>{var e,i;if("page"===o.getViewType())return;if(!1!==(null===(e=o.getPropertyFormat(t))||void 0===e?void 0:e.visible))return;const n=new st.Z;c.defaultRecordCache.inMemoryRecordCache.addCacheOverride(n);const r=null===(i=o.formatStore())||void 0===i?void 0:i.clone(n),a=o.getPropertyFormatKey();return r&&a&&g.createAndCommit({userAction:"CollectionSettingsPropertyAiAutofill.open",environment:c,perform:e=>{I.er({formatStore:r,formatKey:a,property:t,update:{visible:!0},transaction:e})}}),()=>{c.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(n)}}),[o,c,t]);const f=(0,s.useCallback)((()=>{const e=o.collectionStore();if(!e)return;const n=[];n.push({pointer:e.pointer,command:"set",path:["schema",t,"ai_inference"],args:void 0}),ct.HW({environment:c,collectionStore:e,performTransaction:t=>{for(const o of n)g.applyOperation({store:(0,Go.Kv)(e,o.pointer),operation:o,transaction:t})}}),u.z$({collectionSettingsStore:i})}),[c,t,i,o]);if(!r||!(0,Bi.qQ)(r))return null;const v=Ht().compact(Object.entries(yr.OE[r.type]).map((e=>{let i,[n,l]=e;if("summarize"===n)i={type:n};else if("extract"===n){var u,m;i={type:n,prompt:(null===(u=r.ai_inference)||void 0===u?void 0:u.type)===n?null===(m=r.ai_inference)||void 0===m?void 0:m.prompt:""}}else if("custom"===n){var f,v;i={type:n,prompt:(null===(f=r.ai_inference)||void 0===f?void 0:f.type)===n?null===(v=r.ai_inference)||void 0===v?void 0:v.prompt:""}}if(i)return{key:n,render:e=>{var t;const o=(null===(t=r.ai_inference)||void 0===t?void 0:t.type)===n;return s.createElement(re.Z,a()({},e,{checkState:o,title:s.createElement(d.FormattedMessage,l.name),icon:l.svg({width:16}),disabled:!h}))},action:()=>{const e=o.collectionStore();if(!e||!i)return;p.trackAiAutofillSettingsAction(c,{type:"set_ai_inference",ai_inference_type:i.type});const n=[];n.push({pointer:e.pointer,command:"set",path:["schema",t,"ai_inference"],args:i}),ct.HW({environment:c,collectionStore:e,performTransaction:t=>{for(const o of n)g.applyOperation({store:(0,Go.Kv)(e,o.pointer),operation:o,transaction:t})}})}}}))),y=[];return y.push({key:"suggested",render:e=>s.createElement(H.Z,a()({},e,{title:Z.default.formatMessage(Cr.suggestedPromptItemsTitle)})),items:v}),s.createElement(F.ZP,a()({},e,{title:n()(d.FormattedMessage,{defaultMessage:'Fill "{propertyName}" with AI',id:"database.viewSettings.propertyTab.aiAutofill.title",description:"Title for the settings menu to autofill a database property with Notion AI",values:{propertyName:r.name}})}),!h&&n()(H.Z,{style:{fontSize:13,borderRadius:6,background:m.accentColors.purple[50],color:m.accentColors.purple[500],margin:"8px 12px",padding:"8px 12px"}},void 0,n()(d.FormattedMessage,{defaultMessage:"You don't have permission to set up fill with AI on this database.",id:"database.viewSettings.propertyTab.aiAutofill.noSetupPermission",description:"Message shown when the user doesn't have permission to set up fill with AI on a database"})),n()(ae.Z,{type:ae.i.Vertical,sections:y,initialFocus:0}),n()(Tr,{environment:c,property:t,aiInference:l,collectionContextStore:o,isAutofillSetupEnabled:h}),n()(Sr.Z,{size:"8px",innerStyle:{borderColor:m.regularDividerColor},isHidden:c.device.isMobile}),n()(Mr,{environment:c,isAutofillSetupEnabled:h,collectionContextStore:o,propertySchema:r,property:t}),void 0!==l&&n()(H.Z,{topBorder:!0,title:c.device.isMobile&&Z.default.formatMessage(Cr.toggleFillWithAiSectionLabel)},void 0,n()(L.Z,{icon:M.Z.trash,isRed:!0,focused:!1,title:Z.default.formatMessage(Cr.removeAutofillButton),onClick:f,disabled:!h})))}function Mr(e){let{environment:t,isAutofillSetupEnabled:o,collectionContextStore:i,property:r,propertySchema:a}=e;window.__c={n:"TryOnThisViewActionSection"};const l=(0,_.Fg)(),[u,m]=(0,s.useState)((0,c.ZP)()),g=(0,s.useRef)((0,c.ZP)()),[h,f]=(0,s.useState)("fill_not_started"),v=(0,C.VK)((()=>{const e=i.contextType;if("collectionPage"===e)return{type:"page",candidateBlockStores:Ht().compact([(0,vr.np)()])};if("collectionTypedView"===e||"collectionView"===e)return{type:"collection",candidateBlockStores:i.groupsStore.getAllGroupStates()[0].resultsStore.getState().slice(0,5)};throw new Error(`Unexpected context type: ${e}`)}),[i]);if(t.device.isMobile)return null;if(!(0,Bi.q3)(a))return null;const y=(0,ge.Of)(v.candidateBlockStores);let b;b=y?"collection"===v.type?n()(d.FormattedMessage,{defaultMessage:"Updates the first {maxPages} pages. You can undo changes anytime.",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollectionDescription",description:"Description below the button to try a custom AI prompt to fill a database property",values:{maxPages:5}}):n()(d.FormattedMessage,{defaultMessage:'Updates "{propertyName}" on this page. You can undo changes anytime.',id:"database.viewSettings.propertyTab.aiAutofill.tryOnPageDescription",description:"Description below the button to try a custom AI prompt to fill a database property",values:{propertyName:a.name}}):n()(d.FormattedMessage,{defaultMessage:"Add more pages or remove filters to try AI on this view.",id:"database.viewSettings.propertyTab.tryAutofillDisabledDescription",description:"Description below a disabled button to try a custom AI prompt to fill a database property, with the reason why it's disabled"});const S={flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8};return n()(s.Fragment,{},void 0,n()("div",{style:{margin:"8px 12px"}},void 0,n()(wr.X2,{gap:8},void 0,n()(G.Z,{disabled:!o||!y,style:{...S,border:`1px solid ${l.accentColors.gray[100]}`,flexShrink:0,width:64,..."fill_not_started"===h&&{display:"none"}},onClick:()=>{var e;p.trackAiAutofillAction(t,{type:"undo_from_collection_settings",inference_id:u,collection_id:null===(e=i.collectionStore())||void 0===e?void 0:e.id,session_id:g.current}),fr.Yw(t,!1),f("fill_not_started")}},void 0,n()(d.FormattedMessage,{defaultMessage:"Undo",id:"database.viewSettings.propertyTab.aiAutofill.undoButton",description:"Button to undo previewing a custom AI prompt to fill a database property"})),n()(G.Z,{disabled:!o||!y,style:{...S,...o&&y&&(0,ge.Of)(v.candidateBlockStores)?{background:l.accentColors.purple[50],color:l.accentColors.purple[500]}:{background:l.accentColors.gray[50],color:l.accentColors.gray[400]}},hoveredStyle:{background:l.accentColors.purple[100]},pressedStyle:{background:l.accentColors.purple[200]},onClick:async()=>{if((0,ge.Of)(v.candidateBlockStores)){var e;const o=(0,c.ZP)();m(o),p.trackAiAutofillAction(t,{type:"generate_from_try_on_view_button",inference_id:o,collection_id:null===(e=i.collectionStore())||void 0===e?void 0:e.id,session_id:g.current}),f("fill_in_progress"),await hr.C({environment:t,stores:v.candidateBlockStores,property:r,propertySchema:a,userEventForAnalytics:"generate_from_try_on_view_button"}),f("fill_complete")}}},void 0,"fill_in_progress"===h?n()(kr.Z,{}):s.createElement(s.Fragment,null,M.Z.magicWand({width:16}),"collection"===v.type?n()(d.FormattedMessage,{defaultMessage:"Try on this view",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollection",description:"Button to try filling properties of some sample pages in a database with the selected AI prompt"}):n()(d.FormattedMessage,{defaultMessage:"Try on this page",id:"database.viewSettings.propertyTab.aiAutofill.tryOnPage",description:"Button to try filling a property on the current page with the selected AI prompt"}))))),n()("div",{style:{fontSize:12,color:l.accentColors.gray[400],margin:"4px 12px",marginBottom:8}},void 0,b))}function Tr(e){let{environment:t,property:o,aiInference:i,collectionContextStore:r,isAutofillSetupEnabled:a}=e;window.__c={n:"AiAutofillPromptInputMenuItem"};const l=function(e){if(e)switch(e.type){case"summarize":return;case"extract":return{aiInferenceType:e.type,sectionTitle:Cr.extractPromptSectionTitle,inputPlaceholder:Cr.extractPromptInputPlaceholder,value:e.prompt};case"custom":return{aiInferenceType:e.type,sectionTitle:Cr.customPromptSectionTitle,inputPlaceholder:Cr.customPromptInputPlaceholder,value:e.prompt};default:(0,ge.t1)(e)}}(i),c=(0,s.useCallback)((e=>{const i=r.collectionStore();if(!i)return;if(!l)return;const n=[];n.push({pointer:i.pointer,command:"set",path:["schema",o,"ai_inference"],args:{type:l.aiInferenceType,prompt:e.target.value}}),ct.HW({environment:t,collectionStore:i,performTransaction:e=>{for(const t of n)g.applyOperation({store:(0,Go.Kv)(i,t.pointer),operation:t,transaction:e})}})}),[t,o,r,l]);return l?n()(H.Z,{title:Z.default.formatMessage(l.sectionTitle),isInput:!0,style:{marginTop:-4}},void 0,n()(Y.ZP,{inputOuterStyle:{marginTop:t.device.isMobile?8:0},type:"text",value:l.value,onChange:c,placeholder:Z.default.formatMessage(l.inputPlaceholder),textarea:!0,disabled:!a})):null}var Ir=o(51127),Pr=o(21202),xr=o(90468),Br=o(29369),Zr=o(93959),Er=o(73352),Rr=o(29637);const Ar=(0,d.defineMessages)({upgradeButton:{id:"appTemplateUpgradeActions.upgradeConfirmationDialog.upgrade.label",defaultMessage:"Upgrade",description:"Confirm upgrading typed DB feature."},cancelUpgradeButton:{id:"appTemplateUpgradeActions.upgradeConfirmationDialog.cancelUpgrade.label",defaultMessage:"Don't upgrade",description:"Do not upgrade."}});async function Dr(e){const{environment:t,collectionViewBlockStore:o,collectionSettingsStore:i}=e,r=null==o?void 0:o.getFormat().app_config_uri,a=null==o?void 0:o.getParentStore();if(!o||r!==lt.TZ&&r!==lt.pz)return!1;const l=r===lt.TZ?o:await Ir.JN({environment:t,collectionViewBlockStore:o,databaseUri:lt.iS}),c=r===lt.pz?o:await Ir.JN({environment:t,collectionViewBlockStore:o,databaseUri:lt.p$});return!(!(l&&c&&a)||a.table!==xr.bx&&a.table!==Pr.iU&&a.table!==Br.e0)&&(He.showDialog({message:s.createElement(s.Fragment,null,n()("div",{},void 0,"Upgrade Existing Sprints to Latest?"),n()("div",{style:{fontSize:12,padding:8}},void 0,"This will update your Sprints Database, and change some existing views and properties.")),items:[{label:Z.default.formatMessage(Ar.upgradeButton),color:"red",onAccept:async()=>{await async function(e){const{environment:t,appParentStore:o,collectionViewBlockStore:i}=e,n=i.getFormat().app_uri_map,r=i.getCollectionStore();if(!n||!r)return;const a=await Fr(i,o),s=(0,Bi.oC)({format:r.getFormat(),space_id:r.getSpaceId(),schema:r.getSchema()});g.createAndCommit({userAction:"appTemplateActions.upgradeSprintsDatabaseFromV1ToV2",environment:t,perform:e=>{ct.Rm({environment:t,collectionStore:r,update:Lr[lt.p$](s,r.getFormat()),transaction:e}),a.forEach((t=>{const o=t.id,i=t.getFormat(),r=t.getQuery(s);n["notion://sprints/sprints_timeline_view"]===o?ct.iG({collectionViewStore:t,update:Lr["notion://sprints/sprints_timeline_view"](i,r),transaction:e}):n["notion://sprints/sprints_view"]===o&&ct.iG({collectionViewStore:t,update:Lr["notion://sprints/sprints_view"](i,r),transaction:e})}))}})}({environment:t,appParentStore:a,collectionViewBlockStore:c}),await async function(e){const{environment:t,appParentStore:o,collectionViewBlockStore:i}=e,n=i.getFormat().app_uri_map;if(!n)return;const r=await Fr(i,o);g.createAndCommit({userAction:"appTemplateActions.upgradeTasksDatabaseSprintsFeatureFromV1ToV2",environment:t,perform:e=>{r.forEach((t=>{const o=t.id,i=t.getFormat();if(n[lt.g3]===o){const o=Lr[lt.g3](i);ct.iG({collectionViewStore:t,update:o,transaction:e})}else n[lt.y$]===o&&ct.iG({collectionViewStore:t,update:Lr[lt.y$](i),transaction:e})}))}})}({environment:t,appParentStore:a,collectionViewBlockStore:l}),i.set({open:!1,stack:[]})}},{label:Z.default.formatMessage(Ar.cancelUpgradeButton),onAccept:()=>{}}],showCancel:!1,keepFocus:!0}),!0)}async function Fr(e,t){return await Promise.all(e.getCollectionViewPointers().map((async e=>{const o=Go.Xr.createChildStore(t,e);return await o.load(),o})))}const Lr={[lt.g3]:e=>({name:Z.default.formatMessage(Rr.sY.tasksCurrentSprintV2ViewName),format:{...e,property_filters:[...(e.property_filters??[]).filter((e=>e.filter.property!==lt.MM)),Rr.Aq]}}),[lt.y$]:e=>({format:{...e,property_filters:[...(e.property_filters??[]).filter((e=>e.filter.property!==lt.oG))],table_properties:[...(e.table_properties??[]).filter((e=>e.property!==lt.MM)),{property:lt.MM,visible:!1}]}}),[lt.p$]:(e,t)=>({schema:{...e,[lt.OQ]:Er.eK(Z.default.getIntl())[lt.OQ],[lt.LC]:Rr.X$,[lt.Os]:Rr.sU,[lt.Zb]:Er.eK(Z.default.getIntl())[lt.Zb]},format:{...t,app_uri_map:{...(null==t?void 0:t.app_uri_map)||{},[lt.OQ]:lt.OQ,[lt.LC]:lt.LC,[lt.Os]:lt.Os,[lt.Zb]:lt.Zb}}}),"notion://sprints/sprints_timeline_view":(e,t)=>({format:{...e,table_properties:[...(e.table_properties??[]).filter((e=>e.property!==lt.D1)),{width:147,visible:!1,property:lt.D1},{width:147,visible:!0,property:lt.Zb}],timeline_table_properties:[...(e.timeline_table_properties??[]).filter((e=>e.property!==lt.D1)),{width:132,visible:!1,property:lt.D1},{width:132,visible:!0,property:lt.Zb}],collection_group_by:{sort:{type:"ascending"},type:"status",groupBy:"group",property:lt.Zb}},query2:{...t??{},sort:[...(null==t?void 0:t.sort)??[],{property:lt.Zb,direction:"ascending"}]}}),"notion://sprints/sprints_view":(e,t)=>({format:{...e,table_properties:[...(e.table_properties??[]).filter((e=>e.property!==lt.D1)),{width:137,visible:!1,property:lt.D1},{width:137,visible:!0,property:lt.Zb},{width:75,visible:!0,property:lt.LC}],collection_group_by:{sort:{type:"ascending"},type:"status",groupBy:"group",property:lt.Zb}},query2:{...t??{},sort:[...(null==t?void 0:t.sort)??[],{property:lt.Zb,direction:"ascending"}]}})};var Vr=o(90559),Nr=o(10070),Or=o(87085),Ur=o(60442);function Hr(e){var t,o;window.__c={n:"PropertyTypeTooltip"};const{render:i,showDisabledTooltip:r,property:a,overrideCaption:l}=e;let c=a.description;if(l)c=l;else if(r){var d;c=null===(d=a.canOnlyAdminAuth)||void 0===d?void 0:d.disabledPropertyTooltipMessage}const p=null===(t=a.tooltipImage)||void 0===t?void 0:t.img,u=(null===(o=a.tooltipImage)||void 0===o?void 0:o.scale)||1,[m,g]=s.useState(!1),[h,f]=s.useState({width:0,height:0});return s.useEffect((()=>{if(p){const e=new Image;e.src=p,e.onload=()=>{f({width:e.width*u,height:e.height*u}),g(!0)}}}),[p,u]),n()(se.Z,{placement:se.Z.Placement.Left,disableTooltip:void 0===a.description,style:{whiteSpace:"break-spaces"},render:i,renderTooltip:()=>p&&m&&!r?n()(Ur.Z,{caption:c,imageURL:p,imageWidth:h.width,imageHeight:h.height}):n()("div",{},void 0,c)})}var zr=o(90403);function Wr(e){window.__c={n:"AiBadge"};const t=(0,_.Fg)();return n()(zr.Z,{style:{...e.style,color:t.aiPurpleColor,background:t.accentColors.purple[100]},content:n()(d.FormattedMessage,{id:"aiBadgeComponent.label",defaultMessage:"AI",description:"Label for AI pill shown next to AI properties."})})}var jr=o(14871),Kr=o(23223),Yr=o(95477);function Gr(e){return!!e&&Lt.default.checkGate("typed_db_improvements_surfacing_features")}var Xr=o(69834),qr=o(32363);var $r=o(33954),Jr=o(85644),Qr=o(12205);const ea=(0,d.defineMessages)({duplicateGithubPropertyTooltip:{defaultMessage:"A database can only have one GitHub Pull Requests property",id:"database.viewSettings.propertyTab.duplicateGithubProperty.tooltip"},wikiGithubPropertyTooltip:{defaultMessage:"A wiki cannot have a GitHub Pull Requests property",id:"database.viewSettings.propertyTab.wikiGithubProperty.tooltip",description:"Tooltip to explain that a wiki cannot have a GitHub PR property"},syncedDatabaseGithubPropertyTooltip:{defaultMessage:"A synced database cannot have a GitHub Pull Requests property",id:"database.viewSettings.propertyTab.syncedDatabaseGithubProperty.tooltip",description:"Tooltip to explain that a synced database cannot have a GitHub PR property"},newPill:{defaultMessage:"New",id:"database.viewSettings.newHighlightedFeature",description:"New pill in the property menu"}});function ta(e,t,o,i){const r=(0,_.Fg)(),l=(0,C.VK)((()=>{var t;return null===(t=e.collectionStore())||void 0===t?void 0:t.getSchema()}),[e]),c=(0,C.VK)((()=>e.collectionViewBlockStore()),[e]),d=s.useCallback((()=>{if(!(0,Jr.i)()||null==c||!c.isCollectionViewPageWithContent()||i&&"verification"!==i.type)return!1;for(const e in l){const t=l[e];if("verification"===(null==t?void 0:t.type))return!1;if((0,Sn.Kp)(t))return!1}return!0}),[i,l,c]);return{standardPropertyTypes:(0,C.VK)((()=>t.filter((e=>"button"!==e||(0,Kr.PN)())).filter((e=>"auto_increment_id"!==e||("local"===Yr.Z.env||Lt.default.checkGate("unique_id")))).filter((e=>"verification"!==e||d()))),[t,d]),renderStandardProperty:s.useCallback(((t,l)=>({key:t,render:o=>{var c;const d=(null==i?void 0:i.type)===t,p=function(e,t,o){if("auto_increment_id"===t){var i;const t=e.collectionStore(),n=null==t?void 0:t.isPageTreeCollection(),r=Boolean(null==t?void 0:t.isSyncedCollection());if(n)return Z.default.formatMessage($r.zU.wiki_forbidden_auto_increment_id_property);if(r)return Z.default.formatMessage($r.zU.synced_database_forbidden_auto_increment_id_property);if(null!=o&&o.type)return Z.default.formatMessage($r.zU.convert_to_auto_increment_id_property);const a=t&&t.getFormat(),s=t&&(null===(i=t.getSpaceStore())||void 0===i?void 0:i.id),l=t&&t.getSchema(),c=t&&t.getDeletedSchema();if(!(a&&s&&l&&c))return;if(t&&(0,Vr.cj)({format:a,space_id:s,schema:l,deleted_schema:c}))return Z.default.formatMessage($r.zU.duplicate_auto_increment_id_property)}}(e,t,i),u=void 0!==p,m=s.createElement(re.Z,a()({},o,{checkState:d,title:n()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,l??wt.SO[t],Gr(null===(c=e.collectionStore())||void 0===c?void 0:c.getSpaceId())&&"auto_increment_id"===t?n()(bo.Z,{}):null),icon:n()(xo.ZP,{type:t,icon:void 0,size:16,theme:r,style:{fill:r.regularIconColor}}),disabled:u,disabledFeedback:u}));return p?n()(se.Z,{placement:se.Z.Placement.Left,render:e=>s.createElement("div",e,m),renderTooltip:()=>p,style:{whiteSpace:"break-spaces"}}):m},action:()=>{o(t,l)}})),[i,e,r,o])}}function oa(e,t){const o=(0,k.O7)(),i=(0,d.useIntl)(),r=(0,C.VK)((()=>ne.Z.bots.state),[]),l=(0,C.VK)((()=>e.collectionStore()),[e]),c=(0,C.VK)((()=>null==l?void 0:l.getSchema()),[l]),p=(0,C.VK)((()=>null==l?void 0:l.isPageTreeCollection()),[l]),u=(0,C.VK)((()=>{if(void 0===t)return function(e){if(!e)return[];const t=Lt.default.checkGate("github_integration"),o=Lt.default.checkGate("connected_relation"),i=e.getFormat().app_config_uri===lt.iS,n=ne.Z.state;if(!n.loaded)return[];const r=n.integrations,a={};if(t&&!i){const e=r.find((e=>e.id===Xe.U9)),t=(0,Rr.GT)();var s;e&&(a[t.name]={name:t.name,pattern:Xr.x,integration:e,tooltipImage:{img:Li.Z.images.tooltips.properties.githubSyncPullStatusPng,scale:.5},description:t.description,canOnlyAdminAuth:{disabledPropertyTooltipMessage:null===(s=t.canOnlyAdminAuth)||void 0===s?void 0:s.disabledPropertyTooltipMessage}})}if(!o)return Object.values(a);for(const c of r)if(c.info.original_url_patterns&&c.id!==Xe.U9)for(const e of c.info.original_url_patterns){var l;null!==(l=e.additional_types)&&void 0!==l&&l.connectedRelation&&(a[e.name]||(a[e.name]={name:(0,qr.ni)({pattern:e,integration:c}),pattern:e,integration:c}))}return Object.values(a)}(l)}),[l,t]),m=(0,C.VK)((()=>Boolean(null==l?void 0:l.isSyncedCollection())),[l]),g=(0,Qr.J)();return{connectedRelationProperties:u,renderConnectedRelationProperty:s.useCallback((t=>{const l=t.integration.id,d=Boolean(r.find((e=>e.integration_id===l))),u=Boolean(t.canOnlyAdminAuth),h=Boolean(c&&(0,ge.qP)(c).find((e=>{let[t,o]=e;return o&&(0,Sn.Kp)(o)}))),f=t.integration.id===Xe.U9&&h||p||m;let v;f&&(h?v=i.formatMessage(ea.duplicateGithubPropertyTooltip):p?v=i.formatMessage(ea.wikiGithubPropertyTooltip):m&&(v=i.formatMessage(ea.syncedDatabaseGithubPropertyTooltip)));const y=(0,Sn.gi)(d,g,u,o.device.isMobile)||f;return{key:t.name,render:o=>n()(Hr,{showDisabledTooltip:y,property:t,overrideCaption:v,render:i=>{var r;return s.createElement(re.Z,a()({},o,i,{checkState:!1,title:n()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,t.name,Gr(null===(r=e.collectionStore())||void 0===r?void 0:r.getSpaceId())&&t.integration.id===Xe.U9?n()(bo.Z,{}):null),icon:n()("img",{src:t.integration.info.icon,alt:t.name,style:{width:16,height:16}}),disabled:y,disabledFeedback:y}))}}),action:async()=>{await Or.Jw({environment:o,connectedRelationProperty:t,collectionContextStore:e,intl:i})}}}),[r,c,p,m,g,o,i,e])}}const ia=(0,d.defineMessages)({searchPlaceholder:{defaultMessage:"Search or add new property",id:"database.viewSettings.propertyTypeSelect.searchPlaceholder"},suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.viewSettings.propertyTypeSection.suggested",description:"Suggested properties when creating new properties in databases"},connectedRelationSectionTitle:{defaultMessage:"Connected",id:"database.viewSettings.propertyTypeSection.connected",description:"Connected properties when creating new properties in databases"},typesSectionTitle:{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"},newProperty:{defaultMessage:"New property",id:"database.viewSettings.newProperty",description:"header for creating a new property on a database"},newPropertyWithDatabaseName:{defaultMessage:"New property on {databaseName}",id:"database.viewSettings.newPropertyOnDatabase",description:"Header for creating a new property on a database"},selectToAddNewProperty:{defaultMessage:"Select to add",id:"database.viewSettings.selectToAdd",description:"Menu item for adding a new property when selected"}});function na(e){window.__c={n:"CollectionSettingsPropertyType"};const t=(0,k.Fy)(),[o,i]=s.useState(""),{collectionContextStore:r,propertyTypes:l,onAccept:c,propertySchema:d}=e,p=(0,k.O7)(),u=(0,C.VK)((()=>{var e,t;return null==r||null===(e=r.collectionStore())||void 0===e||null===(t=e.getName())||void 0===t?void 0:t.toString()}),[r]),{connectedRelationProperties:m,renderConnectedRelationProperty:g}=oa(e.collectionContextStore,e.propertySchema),{standardPropertyTypes:h,renderStandardProperty:f}=ta(r,l,c,d),{suggestedProperties:v,renderSuggestedProperty:y}=function(e,t){const o=(0,k.O7)(),i=(0,_.Fg)(),r=(0,C.VK)((()=>e.collectionStore()),[e]),l=(0,C.VK)((()=>{if(r)return r.getParentBlockStore()}),[r]),c=(0,C.VK)((()=>ne.Z.bots.state),[]),d=(0,C.VK)((()=>{var e;if(!r)return;const t=null===(e=r.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,Zr.vi)(t):void 0}),[r]),p=(0,C.VK)((()=>{if(r&&l&&d&&void 0===t)return r.isDefined()?(0,Zr.K5)(d,{format:r.getFormat(),space_id:r.getSpaceId(),schema:r.getSchema()}):void 0}),[l,r,d,t]),u=(0,Qr.J)();return{suggestedProperties:p,renderSuggestedProperty:s.useCallback((t=>{const l=t.integrationId,p=Boolean(c.find((e=>e.integration_id===l))),m=Boolean(t.canOnlyAdminAuth),g=(0,Sn.gi)(p,u,m,o.device.isMobile),h=(t,o,l,c)=>{const d=Nr.aQ.deriveTypeUris((null==r?void 0:r.getSchema())??{},null==r?void 0:r.getPropertyMapping()),p=l.dependencies.find((e=>{var t;return"property"===e.type&&e.collectionUri===(null==r||null===(t=r.getFormat())||void 0===t?void 0:t.app_config_uri)&&!d.has(e.uri)})),u=l.dependencies.find((e=>"property"===e.type&&(0,Bi.q3)(e.propertySchema)));var m,h;if(p)return s.createElement(re.Z,a()({},t,{disabled:g,disabledFeedback:g,title:n()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,o,Gr(null===(m=e.collectionStore())||void 0===m?void 0:m.getSpaceId())&&u?n()(Wr,{}):null,Gr(null===(h=e.collectionStore())||void 0===h?void 0:h.getSpaceId())&&l.isNew?n()(bo.Z,{}):null),icon:n()(xo.ZP,{type:p.propertySchema.type,theme:i,icon:c,size:16,style:{fill:i.regularIconColor}})}))};return{key:t.name,render:i=>n()(Hr,{showDisabledTooltip:g,property:t,render:r=>{if((0,Zr.oX)(t))return h({...i,...r,onMouseEnter:e=>{var t,o;null===(t=r.onMouseEnter)||void 0===t||t.call(r,e),null===(o=i.onMouseEnter)||void 0===o||o.call(i,e)}},t.name,t,t.icon);{const l=Ht().compact(t.variants.map((e=>{const t=null==d?void 0:d.allFeatures.find((t=>t.uri===e));if(t&&(0,Zr.oX)(t))return t})));return n()(jr.Z,{items:l,getKey:e=>e.name,onSelect:async t=>{await Or.G0({environment:o,feature:t,collectionContextStore:e})},selectedItem:void 0,renderOrigin:e=>h({...i,...r,...e,onMouseEnter:e=>{var t,o;null===(t=r.onMouseEnter)||void 0===t||t.call(r,e),null===(o=i.onMouseEnter)||void 0===o||o.call(i,e)}},t.name,l[0],t.icon),renderItem:e=>s.createElement(re.Z,a()({},e,{title:e.value.name,shouldWrapCaption:!0,shouldWrapTitle:!0}))})}}}),action:async()=>{await Or.G0({environment:o,feature:t,collectionContextStore:e})}}}),[c,u,o,r,i,null==d?void 0:d.allFeatures,e])}}(e.collectionContextStore,e.propertySchema);s.useEffect((()=>{!async function(){const e=await Ir.DY(p,r);S(e)}()}),[r,p]);const[b,S]=(0,s.useState)(!1),w=s.useCallback((async()=>{await Dr({environment:p,collectionViewBlockStore:r.collectionViewBlockStore(),collectionSettingsStore:e.collectionSettingsStore})}),[r,p,e.collectionSettingsStore]),M=(0,s.useMemo)((()=>new Map(h.map((e=>[wt.SO[e],e])))),[h]);let T;if(""!==o){const e=(null==v?void 0:v.reduce(((e,t)=>(e[t.name]=y(t),e)),{}))||{},t=Array.from(M.keys()),i=(null==m?void 0:m.reduce(((e,t)=>(g&&(e[t.name]=g(t)),e)),{}))||{},n=ci().filter(o,Object.keys(e)).flatMap((t=>e[t.original])),r=ci().filter(o,t).flatMap((e=>{const t=M.get(e.original);return t?f(t):[]})),l=ci().filter(o,Object.keys(i)).flatMap((e=>i[e.original]));T=[],n.length&&T.push({key:"suggested",render:e=>s.createElement(H.Z,a()({},e,{title:Z.default.formatMessage(ia.suggestedSectionTitle)})),items:n}),r.length&&T.push({key:"search",render:e=>s.createElement(H.Z,a()({title:Z.default.formatMessage(ia.typesSectionTitle)},e)),items:r}),l.length&&T.push({key:"connected",render:e=>s.createElement(H.Z,a()({},e,{title:Z.default.formatMessage(ia.connectedRelationSectionTitle)})),items:l}),0===n.length&&0===r.length&&T.push({key:"custom",render:e=>s.createElement(H.Z,a()({},e,{title:Z.default.formatMessage(ia.selectToAddNewProperty)})),items:[f("text",o)]})}else{const e=(null==v?void 0:v.map((e=>y(e))))??[],t=h.map((e=>f(e))).filter(ge.$K),o=(null==m?void 0:m.map((e=>g&&g(e))).filter(ge.$K))??[];T=Ht().compact([e.length&&{key:"suggested",render:e=>s.createElement(H.Z,a()({},e,{title:Z.default.formatMessage(ia.suggestedSectionTitle)})),items:e},t.length&&{key:"properties",render:e=>s.createElement(H.Z,a()({},e,{title:Z.default.formatMessage(ia.typesSectionTitle)})),items:t},o.length&&{key:"connected",render:e=>s.createElement(H.Z,a()({},e,{title:Z.default.formatMessage(ia.connectedRelationSectionTitle)})),items:o}])}const I=n()(H.Z,{desktopStyle:{paddingTop:12,paddingBottom:4}},void 0,n()(Y.ZP,{focusInitial:!t.isMobile||void 0,focus:!t.isMobile||void 0,value:o,onChange:e=>{i(e.target.value)},placeholder:Z.default.formatMessage(ia.searchPlaceholder)}));return s.createElement(F.ZP,a()({},e,{title:t.isDesktop&&u?Z.default.formatMessage(ia.newPropertyWithDatabaseName,{databaseName:u}):Z.default.formatMessage(ia.newProperty)}),I,b&&n()(ve.Z,{style:{border:"1px solid #b3d4fc",borderRadius:5,margin:"3px 11px",padding:7,fontSize:14,color:"rgba(35, 131, 226, 1)",boxShadow:"2px 2px 3px 0px #b3d4fc",cursor:"pointer",marginTop:10},onClick:w},void 0,"🏃 New Sprints 💨",n()("div",{style:{fontSize:11}},void 0,"Upgrade V1 to V2!!!")),n()(ae.Z,{disableInitialScroll:!0,type:ae.i.Vertical,initialFocus:0,sections:T}))}var ra=o(71846);class aa extends l.Z{constructor(){super(...arguments),this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o,property:i,formatKey:n,collectionPointer:r}=this.props;if(!t.collectionStore())return;T.wd({environment:this.environment,collectionContextStore:t,action:"select_relation_source"});const{stack:a}=o.state,s=a[a.length-2];s&&"setupRelation"===s.type&&u.z$({collectionSettingsStore:o}),u.FK({collectionSettingsStore:o,item:{type:"setupRelation",property:i,formatKey:n,collectionPointer:r,targetCollectionPointer:e.pointer}})}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(t)return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.selectNewRelationSourceTab.title",description:"Database view options Sub-menu title when choosing relation target database"})}),n()(ra.Z,{collectionContextStore:e,onAccept:this.handleSourcePickerAccept,parentStore:t,context:ra.S.Relation}))}}aa.displayName="CollectionSettingsSelectRelationSource";const sa=(0,d.injectIntl)(aa);var la=o(71554),ca=o(79892);function da(e){window.__c={n:"CollectionSettingsSetupRelation"};const{collectionContextStore:t,collectionSettingsStore:o,property:i,formatKey:r,targetCollectionPointer:l,collectionPointer:c,from:p}=e,m=(0,C.VK)((()=>t.collectionStore()),[t]),h=(0,C.VK)((()=>{const e=t.collectionViewBlockStore();return function(e){const{targetCollectionPointer:t,collectionStore:o,collectionViewBlockStore:i}=e;if(!t)return;if(o&&o.pointer===t)return o;return i?Go.NW.createChildStore(i,t):void 0}({targetCollectionPointer:l,collectionStore:m,collectionViewBlockStore:e})}),[t,m,l]),f=(0,C.VK)((()=>i?R.KV(t,i):void 0),[t,i]),v=Boolean(m&&h&&m.id===h.id),y=Boolean("relation"===(null==f?void 0:f.type)&&f.connectedRelation),b=Boolean("subitem"===p),S=Boolean("timeline_arrows_by"===p),w=(0,C.VK)((()=>t.contextType),[t]),_=(0,k.O7)(),M=(0,d.useIntl)(),Z=(0,C.VK)((()=>{const e=null==m?void 0:m.getSchema();return void 0===(null==f?void 0:f.name)&&h&&e?R.m8(M,{targetCollectionStore:h,isSelfRelation:v,sourceSchema:e,createUnique:!0,from:p}):(null==f?void 0:f.name)||""}),[m,null==f?void 0:f.name,h,M,v,p]),[E,A]=(0,s.useState)(Z),[L,V]=(0,s.useState)("no_limit"),[N,O]=(0,s.useState)(b||S?{hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1}}:{hasInverseRelation:!1,inverseName:void 0,autoRelate:{enabled:!1}}),U=E===Z,z=(0,s.useCallback)((()=>{u.H4({collectionSettingsStore:o,item:{type:"selectRelationSource",property:i,formatKey:r,collectionPointer:c}})}),[o,i,r,c]),W=(0,s.useCallback)((()=>{if(!N)return;const{hasInverseRelation:e,inverseName:n,autoRelate:a}=N,s=t.collectionStore(),l=t.collectionViewStore();if(!s||!h)return;const{performResult:d}=g.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:_,perform:o=>{const c=i??I.G3({environment:_,collectionStore:s,collectionViewArgs:l&&r?{collectionViewStore:l,format:l.getFormat(),formatKey:r}:void 0,propertyType:"relation",transaction:o});return P.n7({environment:_,collectionContextStore:t,collectionStore:s,property:c,propertyName:E,targetCollectionStore:h,hasInverseRelation:e,inverseName:n,autoRelate:a,propertyLimit:L,intl:M,transaction:o,from:p}),"subitem"===p&&l?(B.dR({collectionViewStore:l,propertyID:c,transaction:o}),B.jA({collectionContextStore:t,relationPropertyId:c,transaction:o})):"timeline_arrows_by"===p&&l&&(x.tF({collectionViewStore:l,newProperty:c,transaction:o}),x._p({collectionContextStore:t,relationPropertyId:c,transaction:o})),c}});"subitem"===p||"timeline_arrows_by"===p?(u.z$({collectionSettingsStore:o}),u.H4({collectionSettingsStore:o,item:{type:"main"}})):u.qU({collectionSettingsStore:o,property:d,formatKey:r,collectionPointer:c}),T._H({environment:_,collectionContextStore:t,from:"collectionPage"===w?"page_properties":"view_settings",property_type:"relation"})}),[N,t,h,_,o,i,r,c,w,E,L,M,p]);return s.createElement(F.ZP,a()({},e,{title:n()(d.FormattedMessage,{defaultMessage:"New relation",id:"database.viewSettings.setupRelationTab.title",description:"Database view options menu title for creating relation property"})}),n()(H.Z,{},void 0,n()(Y.ZP,{value:E||"",placeholder:"Property name",onChange:e=>A(e.target.value),onBlur:()=>{},onSubmit:()=>{},focusInitial:!0,selectAll:!1})),n()(ca.Z,{isSelfRelation:v,collectionStore:h,showAs:"chevron",onClick:z,disabled:b}),!p&&n()(la.U,{selectedKey:L,propertyType:"relation",onChange:e=>V(e)}),h&&!y&&n()(D.Z,{collectionContextStore:t,targetCollectionStore:h,property:i,propertyName:E,buttonContents:n()(d.FormattedMessage,{defaultMessage:"Add relation",id:"database.viewSettings.setupRelationTab.addButton.title",description:"Button label when creating a new database relation property"}),temporaryInverseState:N,setTemporaryInverseState:O,isInitialPropertyName:U,onSubmit:W,from:p}),n()(H.Z,{},void 0,n()(Xt.Z,{href:(0,Kt.UY)("guides.relations"),title:n()(d.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})))}var pa=o(19889);function ua(e){window.__c={n:"AutomationCompactSummaryCard"};const{icon:t,title:o,caption:i,hasWarning:r,onEdit:a,onDelete:l}=e,[c,d]=(0,pe.Z)(),[p,u]=ue(),m=(0,C.qz)(void 0,fe.Z),g=(0,C.VK)((()=>m.getState()),[m]).hovered||d||u,h=(0,me.lq)(c,p),f=function(e){return(0,_.yK)((t=>({CompactAutomationSummaryCard:{background:t.cardContentBackground},buttonPosition:{position:"relative",paddingTop:8,paddingBottom:8},buttonBorder:{borderWidth:1,borderStyle:"solid",borderColor:t.outlineButtonBorder,borderRadius:8},warning:{width:16,height:"auto",color:t.accentColors.orange[400]},title:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:6},moreButtonWrap:{display:e?"block":"none",position:"absolute",right:8,top:8},hoveredStyle:{background:t.selectLightGray[100]},textOverflow:{textOverflow:"ellipsis",overflow:"hidden",minWidth:0,whiteSpace:"nowrap"}})),[e])}(g);return s.createElement(re.Z,{ref:h,focused:g,interactionStore:m,shouldWrapCaption:!0,buttonStyle:{...f.buttonPosition,...f.buttonBorder},hoveredStyle:f.hoveredStyle,title:n()("div",{},void 0,n()("header",{},void 0,n()("div",{style:f.moreButtonWrap},void 0,n()(ke,{focused:g,onEdit:a,onDelete:l}))),n()("div",{style:f.title},void 0,t,n()("div",{style:f.textOverflow},void 0,o),r&&M.Z.warning(f.warning))),caption:i,onClick:a})}var ma=o(62385);function ga(e){window.__c={n:"AutomationCreatorAttribution"};const{automationCreatorPointer:t}=e,o=(0,k.O7)(),i=(0,d.useIntl)(),r=(0,C.VK)((()=>t&&new Go.U6(o,{table:pa.KJ,id:t.id,spaceId:t.spaceId}).getDisplayName(i)),[t,o,i]);return n()(d.FormattedMessage,{id:"sendToSlack.automationCreatorCaption.label",defaultMessage:"Added by {automationCreatorName}",values:{automationCreatorName:r},description:"Caption for who added this Slack Notification Integration (e.g. Added by Jane Doe)"})}const ha=(0,d.defineMessages)({pausedNotifications:{id:"NotificationRulesViewMain.slackChannel.notificationsPaused",defaultMessage:"Paused •",description:"Indicates that notifications for this automation have been paused due to a permissions issue."},pagesAddedWithViewName:{id:"configureNotificationRuleMenu.sendToSlack.existingRule.createPageEventCaptionWithView",defaultMessage:"New pages{hasViewName, select, true { in {collectionViewName}} other {}}",description:"Caption for when rule receives only 'page added' events into their selected Slack channel for a specific view."},pagesEditedWithViewName:{id:"configureNotificationRuleMenu.sendToSlack.existingRule.updatePageEventCaptionWithView",defaultMessage:"Property edits{hasViewName, select, true { in {collectionViewName}} other {}}",description:"Caption for when rule receives only 'properties edited' events into their selected Slack channel for a specific view."},pagesAddedAndEditedWithViewName:{id:"configureNotificationRuleMenu.sendToSlack.existingRule.createdAndUpdatedEventCaptionWithView",defaultMessage:"New pages & edits{hasViewName, select, true { in {collectionViewName}} other {}}",description:"Caption for when rule receives both 'new page' and 'page property updated' events into their selected Slack channel for a specific view."},placeholder:{id:"database.viewSettings.notificationsTab.slack.placeholderCaption",defaultMessage:"None",description:"Placeholder caption when user needs to select which events they want to be notified about."}});function fa(e){var t;window.__c={n:"SlackAutomationCaption"};const{parentBlockStore:o,slackNotificationAutomation:i,currentUserId:r}=e,a={id:i.createdByPointer.id,table:i.createdByPointer.table},s=a.id===r&&a.table===pa.KJ,l=null===(t=i.trigger)||void 0===t?void 0:t.event,c=(0,d.useIntl)(),p=(0,C.VK)((()=>{if("collection_view"===l.source.type){const e=Go.Xr.createChildStore(o,l.source.pointer);return(0,cn.v)(e,c)}}),[o,l,c]),u=c.formatMessage(function(e){const t=Boolean(e.pagesAdded),o="none"!==e.pagePropertiesEdited.type;return t?o?ha.pagesAddedAndEditedWithViewName:ha.pagesAddedWithViewName:o?ha.pagesEditedWithViewName:ha.placeholder}(l),{hasViewName:Boolean(p),collectionViewName:p});return n()("div",{style:{overflow:"hidden",textOverflow:"ellipsis"}},void 0,function(e,t){if("disabled_permissions"!==e)return"";return t.formatMessage(ha.pausedNotifications)}(i.automationStatus,c),s?u:n()(ga,{automationCreatorPointer:a}))}function va(e){window.__c={n:"CollectionSettingsSlackAutomationsView"};const{collectionSettingsStore:t,collectionContextStore:o}=e,i=(0,d.useIntl)(),r=(0,C.VK)((()=>{var e;return null===(e=Ke.default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),l=(0,C.VK)((()=>o.collectionViewBlockStore()),[o]),c=(0,C.VK)((()=>o.collectionStore()),[o]),[p,m]=s.useState(!1),g=(0,C.VK)((()=>{if(!l||!c)return[];return c.getAutomationStores().map((e=>{const t=e.getModel();if(null==t||!t.getAlive())return;if(!e.isTriggerType("notification_event"))return;const o=e.getTrigger();if(!o)return;const n=Ht().first(e.getActionStores());if(!n||!n.isType("slack_notification"))return;const r=n.getConfig();if(!(0,Ho.E7)(r))return;const a=function(e){const{notificationTrigger:t,blockStore:o,collectionStore:i}=e,n=t.event;if(!("source"in n))return!1;if("collection_view"!==n.source.type)return!1;const r=Go.Xr.createChildStore(o,n.source.pointer),a=i.getSchema();return At({collectionViewStore:r,collectionSchema:a})}({notificationTrigger:o,blockStore:l,collectionStore:c});return{name:e.getNameWithDefault(i),trigger:o,config:r,createdByPointer:{id:t.getCreatedById(),table:t.getCreatedByTable()},notificationAutomationStore:e,notificationActionConfigStore:n,automationStatus:t.getStatus(),hasIncompatibleCollectionViewFilters:a,lastEditedTime:t.getLastEditedTime()}})).filter(ge.$K)}),[c,l,i]),h=[],f=[];for(const n of g)r&&zo.dr.isEqual(n.createdByPointer,{id:r,table:pa.KJ})?h.push(n):f.push(n);h.sort(((e,t)=>t.lastEditedTime-e.lastEditedTime)),f.sort(((e,t)=>t.lastEditedTime-e.lastEditedTime));let v=[];v=p?[...h,...f]:h.length>0?h:f;const y=g.length-v.length,b=(0,C.VK)((()=>Zt({collectionStore:c})),[c]),S=!p&&y>0,w=ya();return n()(F.ZP,{title:n()(d.FormattedMessage,{id:"collectionSettings.slackAutomationsView.header",defaultMessage:"Slack notifications",description:"Header for the list of configured Slack notifications for this database."}),collectionSettingsStore:t,collectionContextStore:o,fullHeight:!0,footer:b&&n()(H.Z,{topBorder:!0},void 0,n()(L.Z,{icon:M.Z.plus,isGray:!0,title:n()(d.FormattedMessage,{id:"collectionSettings.slackAutomationsView.createNew",defaultMessage:"New Slack notification",description:"Button to add a new slack automation."}),onClick:()=>{u.H4({collectionSettingsStore:t,item:{type:"createSlackAutomation"}})}}))},void 0,n()("div",{style:w.list},void 0,v.map((e=>s.createElement(ba,a()({},e,{key:e.notificationAutomationStore.id,blockStore:l,collectionStore:c,currentUserId:r,collectionContextStore:o,collectionSettingsStore:t})))),S&&n()(ma.Z,{style:w.showMoreButtonContainer,onClick:e=>{e.stopPropagation(),m(!0)}},void 0,n()("div",{style:w.showMoreButtonContent},void 0,n()(d.FormattedMessage,{id:"collectionSettings.slackAutomationsView.showMore",defaultMessage:"Show {number} more",description:"Button to show more automations from list.",values:{number:y}})))))}function ya(){return(0,_.yK)((e=>({slackIcon:{width:16,height:"auto"},list:{display:"flex",flexDirection:"column",padding:12,gap:8},showMoreButtonContent:{fontSize:12},showMoreButtonContainer:{marginLeft:4,marginRight:"auto"}})),[])}function ba(e){window.__c={n:"CardForAutomationStuff"};const{notificationAutomationStore:t,name:o,automationStatus:i,hasIncompatibleCollectionViewFilters:r,blockStore:a,collectionStore:l,currentUserId:c,collectionSettingsStore:p,collectionContextStore:m,notificationActionConfigStore:g}=e,h=(0,k.O7)(),f=(0,d.useIntl)(),v=ya(),y=(0,C.VK)((()=>m.aliveSlackAutomationCount.state),[m]),b=(0,C.VK)((()=>Et({automationStore:t})),[t]),S=s.useCallback((()=>{l&&Jo({intl:f,environment:h,collectionStore:l,existingAutomationStore:t,parentCollectionId:l.id,triggerType:"notification_event",onDelete:()=>{1===y&&u.E3({collectionSettingsStore:p})}})}),[f,h,l,t,y,p]);return n()(ua,{icon:M.Z.slackLogo(v.slackIcon),title:o,caption:a&&c&&n()(fa,{parentBlockStore:a,currentUserId:c,slackNotificationAutomation:e}),hasWarning:"active"!==i||r,onEdit:()=>{u.H4({collectionSettingsStore:p,item:{type:"editSlackAutomation",automationId:t.id,automationActionId:g.id}})},onDelete:b?S:void 0},t.id)}var Sa=o(27006),wa=o(63143),ka=o(10279),Ca=o(67669),_a=o(21115),Ma=o(78291),Ta=o(29551),Ia=o(46978);class Pa extends l.Z{constructor(){super(...arguments),this.storeTypes={restrictedStore:ut.default.of(!1)},this.handleContinue=()=>{const e=this.stores.restrictedStore.get(),{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore(),i=t.settingsStore;o&&(e&&this.restrictAccessToSyncedContent({environment:this.environment,store:o}),p.trackSetDatabaseSyncPermissions(this.environment,{type:e?"restrict":"share"}),u.E3({collectionSettingsStore:i}))}}renderComponent(){const{collectionSettingsStore:e,collectionContextStore:t,integrationName:o,integrationIcon:i}=this.props,{restrictedStore:r}=this.stores,l=t.collectionViewBlockStore();if(!l)return;const c=this.createComputedStore((()=>{const e=Ma.default.state.data?_a.CM(Ma.default.state.data):[],t=(0,wa.m8)(Ht().compact(e.map((e=>[e.userId,e.role])))),o=(0,Ca.YO)(l).map((e=>e.permissionItem));let i=!1,n=!1;for(const l of o)Sa.$D(l)?i=!0:Sa.ix(l)&&!Sa.Wi(l.role)&&(n=!0);const r=Ht().uniq(Ht().compact([...o.map((e=>"user_permission"===e.type?e.user_id:void 0)),...n?Object.keys(t):[]])),a=r.filter((e=>"none"!==t[e])).length,s=r.filter((e=>{const i=t[e],n=Boolean(o.filter(Sa.jg).find((t=>t.user_id===e)));return Boolean(i&&n&&!Sa.YX(i))})).length;return{numberOfGuests:s,numberOfUsers:a+s,isPublic:i}})),{numberOfGuests:p,numberOfUsers:m,isPublic:g}=c.state;if(!g&&1===m)return void u.E3({collectionSettingsStore:e});const h=n()("div",{style:this.getPromptTitleStyle()},void 0,n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.header",defaultMessage:"Share synced content with",description:"Title for synced content share menu"})),f=s.createElement(s.Fragment,null,0!==p?s.createElement(s.Fragment,null,n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithGuests",defaultMessage:"{numberOfUsers} people (including you {numberOfGuests, plural, one {and {numberOfGuests} guest} other {and {numberOfGuests} guests}})",description:"Indicates the number total users the content will be shared with including guests. Note: Modal is only shown if more than one person has access so people doesn't need singular case.",values:{numberOfUsers:m,numberOfGuests:p}})," "):s.createElement(s.Fragment,null,n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithoutGuests",defaultMessage:"{numberOfUsers} people (including you)",description:"Indicates the number total users the content will be shared with not including guests. Note: Modal is only shown if more than one person has access so people doesn't need singular case.",values:{numberOfUsers:m}})," "),g&&s.createElement(s.Fragment,null,n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.sharedWithPublic",defaultMessage:"and those with the link",description:"Indicates that the content will be shared via public link"})," "),n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.accessToIntegration",defaultMessage:"will get access to content synced from {integrationName}",description:"Indicates the external integration (JIRA, Github, etc) the content is synced with",values:{integrationName:o}})),v=n()(Ta.gq,{style:{marginTop:10}},void 0,n()(et.Z,{style:{flex:"0 0 100%"},isLarge:!0,onClick:this.handleContinue},void 0,n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.continueButton",defaultMessage:"Continue",description:"Acknowledge that the content will be shared based on choice"}))),y=n()(Ta.gq,{style:{paddingBottom:24},alignItems:"center",justifyContent:"center"},void 0,n()("img",{style:{width:40},src:i})),b=n()(ae.Z,{type:ae.i.Vertical,initialFocus:void 0,sections:[{key:"grant_permissions",items:[{key:"allow",action:()=>null,render:e=>s.createElement(re.Z,a()({},e,{textWrapperStyle:{textAlign:"left"},title:n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.title",defaultMessage:"Anyone on this page",description:"Indicates that anyone who has access to the page will have access to the synced content"}),shouldWrapCaption:!0,caption:f,icon:n()(Ia.Z,{isSelected:!r.get()}),onClick:()=>{r.set(!1)}}))},{key:"restrict",action:()=>null,render:e=>s.createElement(re.Z,a()({},e,{textWrapperStyle:{textAlign:"left"},title:n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.restrict.title",defaultMessage:"Only you",description:"Indicates that only you will have access to the synced content"}),shouldWrapCaption:!0,caption:n()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.restrict.caption",defaultMessage:"You'll need to share with others using the share menu",description:"Caption for restrict option"}),icon:n()(Ia.Z,{isSelected:r.get()}),onClick:()=>{r.set(!0)}}))}],render:e=>s.createElement(H.Z,e)}]});return s.createElement(F.ZP,this.props,n()(Ta.gq,{style:this.getInnerContainerStyle(),flexDirection:"column"},void 0,y,n()("div",{},void 0,h,b),v))}restrictAccessToSyncedContent(e){const{environment:t,store:o}=e,i=t.currentUser.id;i&&g.createAndCommit({userAction:"CollectionSettingsSyncedContentShare.restrictAccessToSyncedContent",environment:t,perform:e=>{ka.Pk({environment:t,store:o,shouldInherit:!1,transaction:e,permissionItem:{type:"user_permission",user_id:i,role:"editor"}})}})}getInnerContainerStyle(){return{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"0px 16px 16px 16px"}}getPromptTitleStyle(){return{color:this.theme.regularTextColor,fontWeight:he.Z.fontWeight.semibold,fontSize:14}}}Pa.displayName="CollectionSettingsSyncedContentShare";const xa=(0,d.injectIntl)(Pa);var Ba=o(30610),Za=o(97004);const Ea=(0,d.defineMessages)({inputPlaceholder:{defaultMessage:"Filter by…",id:"database.viewSettings.createFilterTab.inputPlaceholder"}});class Ra extends l.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{if(!e)return;const{collectionContextStore:t}=this.props,o=t.collectionViewStore(),i=this.suggestedFilters.state.find((t=>t.property===e));if(!i||!o)return;const n={id:(0,c.ZP)(),filter:i};Ba.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.get(),propertyFilters:{value:[...this.getPropertyFilters(),n]}}}),this.acceptAndOpenPropertyFilter(n)},this.handleCombinatorFilterClick=()=>{const{collectionContextStore:e}=this.props;if(!e.collectionViewStore())return;this.getCombinatorFilter()||Ba.iU({environment:this.environment,collectionContextStore:e,temporaryState:{...e.temporaryState.get(),combinatorFilter:{value:Tt.TI}}}),this.acceptAndOpenCombinatorFilter()},this.suggestedFilters=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=e.collectionViewStore();if(!o)return[];return(0,Za.qd)({schema:t,filters:this.getPropertyFilters(),getRecordValue:o.getRecordValue})}),!0)}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=this.suggestedFilters.state,i=this.getCombinatorFilter(),r=t.permissionScopes.state;return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"Add filter",id:"database.viewSettings.createFilterTab.title"}),footer:r.canConfigureBlock&&n()(H.Z,{topBorder:!0},void 0,n()(L.Z,{icon:i?M.Z.filter:M.Z.plus,isGray:!0,title:n()(d.FormattedMessage,i?{defaultMessage:"Advanced filter",id:"database.viewSettings.createFilterTab.advancedFilter.title"}:{defaultMessage:"Add advanced filter",id:"database.viewSettings.createFilterTab.addAdvancedFilter.title"}),right:i&&n()(d.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.viewSettings.createFilterTab.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=i.filters)||void 0===e?void 0:e.length)||1}}),onClick:this.handleCombinatorFilterClick}))}),n()(V.Z,{schema:t.normalizedSchemaStore.state,format:t.normalizedFormatStore.state,getProperties:()=>o.map((e=>e.property)),onAccept:this.handlePropertyAccept,inputPlaceholder:Z.default.formatMessage(Ea.inputPlaceholder),defaultShowPropertyCount:5}))}acceptAndOpenPropertyFilter(e){const{collectionContextStore:t,context:o}=this.props;if(T.wd({environment:this.environment,collectionContextStore:t,action:"create_property_filter"}),o===Ss.FilterBar||o===Ss.TopbarFilterPopup){this.closeMenuAndOpenFilterBar();const o=t.getFilterBarItemSettingsStore(e);u.wl({collectionSettingsStore:o,item:{type:"filter"}})}else if(o===Ss.ViewSettings){this.navigateToMainThenFilters();const o=t.getFilterOptionsItemSettingsStore(e);u.wl({collectionSettingsStore:o,item:{type:"filter"}})}}acceptAndOpenCombinatorFilter(){const{collectionContextStore:e,context:t}=this.props;T.wd({environment:this.environment,collectionContextStore:e,action:"create_combinator_filter"}),t===Ss.FilterBar||t===Ss.TopbarFilterPopup?(this.closeMenuAndOpenFilterBar(),u.wl({collectionSettingsStore:e.filterBarCombinatorFilterSettingsState,item:{type:"filter"}})):t===Ss.ViewSettings&&(this.navigateToMainThenFilters(),u.wl({collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsState,item:{type:"filter"}}))}closeMenuAndOpenFilterBar(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props;e.filtersBarOpen.set(!0),u.z$({collectionSettingsStore:t})}navigateToMainThenFilters(){const{collectionSettingsStore:e}=this.props;u.wl({collectionSettingsStore:e,item:{type:"main"}}),u.H4({collectionSettingsStore:e,item:{type:"filters"}})}getPropertyFilters(){const{collectionContextStore:e}=this.props;return e.currentPropertyFiltersStore.state}getCombinatorFilter(){const{collectionContextStore:e}=this.props;return e.currentCombinatorFilterStore.state}}Ra.displayName="CollectionSettingsViewCreateFilter";const Aa=(0,d.injectIntl)(Ra),Da=(0,d.defineMessages)({inputPlaceholder:{defaultMessage:"Sort by…",id:"database.viewSettings.createSortTab.inputPlaceholder"}});class Fa extends l.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{var t;if(!e)return;const{collectionContextStore:o,context:i,collectionSettingsStore:n}=this.props,r=o.collectionViewStore(),a=o.normalizedSchemaStore.state;if(!r||!a)return;const s=null===(t=a[e])||void 0===t?void 0:t.type;T.wd({environment:this.environment,collectionContextStore:o,action:"create_sort_accept",original_view_type:r.getType(),property_type:s});const l={property:e,direction:"ascending"},c=[...this.getSorts(),l];if(Ba.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.get(),sorts:{value:c}}}),i===Ss.TopbarSortPopup||i===Ss.FilterBar){o.filtersBarOpen.set(!0),u.z$({collectionSettingsStore:n});const{filterBarSortSettingsStore:e}=o;u.wl({collectionSettingsStore:e,item:{type:"sort"}})}else i===Ss.ViewSettings&&(u.wl({collectionSettingsStore:n,item:{type:"main"}}),u.H4({collectionSettingsStore:n,item:{type:"sort"}}))}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=this.getSorts();return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"New sort",id:"database.viewSettings.createSortTab.title"})}),n()(V.Z,{schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,getProperties:()=>Object.keys(t).filter((e=>!o.find((t=>t.property===e)))),onAccept:this.handlePropertyAccept,inputPlaceholder:Z.default.formatMessage(Da.inputPlaceholder),defaultShowPropertyCount:5}))}getSorts(){const{collectionContextStore:e}=this.props;return e.currentSortsStore.state}}Fa.displayName="CollectionSettingsViewCreateSort";const La=(0,d.injectIntl)(Fa);var Va=o(31775),Na=o(8982);class Oa extends l.Z{constructor(){super(...arguments),this.handleFilterChange=(e,t)=>{const{collectionContextStore:o}=this.props;if(je.tN("collections.update_filter_lag")){var i;const e=null===(i=o.remoteResult.state)||void 0===i?void 0:i.sizeHint;w.default.measureFlush((t=>{T.z1({environment:this.environment,from:"combinator_filter",collectionContextStore:o,time:t,did_trigger_fetch:o.isLoading.get(),sizeHintAtStart:e})}))}Ba.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.get(),combinatorFilter:{value:t}}}),T.wd({environment:this.environment,collectionContextStore:o,action:"update_combinator_filter"})},this.handleRemoveClick=()=>{const{collectionContextStore:e,context:t,collectionSettingsStore:o}=this.props;Ba.iU({environment:this.environment,collectionContextStore:e,temporaryState:{...e.temporaryState.get(),combinatorFilter:{value:void 0}}}),t===Ss.FilterBar&&u.E3({collectionSettingsStore:o}),T.wd({environment:this.environment,collectionContextStore:e,action:"delete_combinator_filter"})}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.normalizedSchemaStore.state,i=this.getFilter();if(!t||!i)return;const r=t.getType();return r?s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"Advanced filter",id:"database.viewSettings.filterTab.title"}),unconstrainedWidth:!0}),n()(Na.D,{},void 0,n()(Va.Pq,{index:0,level:0,combinatorFilter:i,schema:o,onChange:this.handleFilterChange,collectionViewType:r,collectionViewId:t.id,parentStore:t})),n()(H.Z,{topBorder:!0},void 0,n()(L.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Delete filter",id:"database.viewSettings.filterTab.deleteFilterButton.title"}),onClick:this.handleRemoveClick}))):void 0}getFilter(){const{collectionContextStore:e}=this.props;return e.currentCombinatorFilterStore.state}}Oa.displayName="CollectionSettingsViewFilter";const Ua=(0,d.injectIntl)(Oa);var Ha=o(28398),za=o(37709),Wa=o(58814);class ja extends l.Z{constructor(){super(...arguments),this.renderPropertyFilter=e=>{const{collectionContextStore:t}=this.props;return n()("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"}},void 0,this.canReorder()&&n()($t.ZP,{iconSize:12,style:{marginLeft:6,marginRight:6}}),n()(Qe.Z,{id:e.id,context:za.Pt.SettingsFilters,collectionContextStore:t,collectionSettingsStore:t.getFilterOptionsItemSettingsStore(e)},e.id))},this.handleFiltersDrop=e=>{const{collectionContextStore:t}=this.props;if(!t.collectionViewBlockStore())return;const o=t.currentPropertyFiltersStore.state,i=Ut.compact(e.map((e=>o.find((t=>t.id===e)))));Ba.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.get(),propertyFilters:{value:i}}}),T.wd({environment:this.environment,collectionContextStore:t,action:"reorder_filters"})},this.handleNewFilterClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;T.wd({environment:this.environment,collectionContextStore:t,action:"click_new_filter"}),u.H4({collectionSettingsStore:e,item:{type:"createFilter"}}),t.filtersBarOpen.set(!0)},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Za.yU)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,o=e.currentPropertyFiltersStore.state,i=o.map((e=>e.id)),r=e.permissionScopes.state,l=r.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"Filters",id:"database.viewSettings.filtersTab.title"}),footer:this.localStateHasChangesStore.state&&n()(H.Z,{topBorder:!0},void 0,this.renderSaveControl()),unconstrainedWidth:!0}),n()(H.Z,{desktopStyle:{paddingBottom:24}},void 0,(i.length>0||l)&&n()("div",{style:t.isMobile?{paddingTop:8,background:this.theme.contentBackground}:void 0},void 0,l&&this.renderCombinatorFilter(),this.canReorder()?n()(qt.ZP,{direction:"vertical",keys:i,renderKey:e=>{const t=i.indexOf(e);return this.renderPropertyFilter(o[t])},onDrop:this.handleFiltersDrop,disabled:!r.canConfigureBlock}):i.map((e=>{const t=i.indexOf(e);return this.renderPropertyFilter(o[t])}))),n()(re.Z,{focused:!1,icon:M.Z.plus({width:14,marginLeft:4,marginRight:4,fill:this.theme.mediumIconColor}),style:{color:this.theme.mediumTextColor},title:n()(d.FormattedMessage,{defaultMessage:"Add filter",id:"database.viewSettings.filtersTab.newFilter.title"}),onClick:this.handleNewFilterClick})))}renderCombinatorFilter(){const{collectionContextStore:e}=this.props;return n()("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"}},void 0,this.canReorder()&&n()($t.ZP,{iconSize:12,style:{marginLeft:6,marginRight:6,opacity:.4,cursor:void 0}}),n()(Wa.Z,{context:za.Pt.SettingsFilters,collectionContextStore:e,collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsState}))}renderSaveControl(){const{collectionContextStore:e}=this.props;return n()(Ha.ZP,{context:Ha.R1.SettingsFilters,collectionContextStore:e})}canReorder(){return!this.environment.device.isMobile}}ja.displayName="CollectionSettingsViewFilters";const Ka=(0,d.injectIntl)(ja);var Ya=o(74194);class Ga extends l.Z{constructor(){super(...arguments),this.storeTypes={inputValue:ut.default.of("")},this.handleChangeDebounced=Ht().debounce((e=>{void 0!==e&&this.props.onChange(e)}),300)}willMount(e){this.stores.inputValue.set(e.value.toString())}renderComponent(){const e=this.stores.inputValue.get();return n()(Ya.Z,{type:"number",value:e,inputClassName:"input-hide-arrows",style:{background:this.theme.contentBackground},onChange:e=>{const t=e.target.value,o=parseFloat(t);isNaN(o)?this.handleChangeDebounced(void 0):this.handleChangeDebounced(o),this.stores.inputValue.set(t)}})}}Ga.displayName="CollectionViewGroupMenuNumberInput";const Xa=Ga;class qa extends l.Z{renderComponent(){const{numberGroupBy:e,collectionContextStore:t,schema:o}=this.props,i=o[e.property];if(t.collectionStore()&&i)return s.createElement(s.Fragment,null,n()(H.Z,{topBorder:!1,disableMobileBorders:!0,title:n()(d.FormattedMessage,{id:"database.groupMenu.numberGroupRange",defaultMessage:"Group range",description:"The min and max value the range"}),isTitleUppercase:!1},void 0,n()("div",{style:{display:"flex",paddingLeft:14,paddingRight:14}},void 0,this.renderNumberGroupByKeyInput(e,"start"),n()("span",{style:{color:this.theme.mediumTextColor,margin:"0 8px"}},void 0,"–"),this.renderNumberGroupByKeyInput(e,"end"))),n()(H.Z,{topBorder:!1,disableMobileBorders:!0,title:n()(d.FormattedMessage,{id:"database.groupMenu.numberGroupSize",defaultMessage:"Group every",description:"The distance between groups"}),isTitleUppercase:!1},void 0,n()("div",{style:{paddingLeft:14,paddingRight:14}},void 0,this.renderNumberGroupByKeyInput(e,"size"),n()("span",{style:{color:this.theme.mediumTextColor,fontSize:12}},void 0,n()(Yt.Z,{groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start,end:e.start+e.size}}},schema:o,currentGroups:[],disabled:!0,isHiddenGroup:!1,style:this.getInlineNumberGroupValueStyle(),collectionContextStore:t}),", ",n()(Yt.Z,{groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start+e.size,end:e.start+2*e.size}}},schema:o,currentGroups:[],disabled:!0,isHiddenGroup:!1,style:this.getInlineNumberGroupValueStyle(),collectionContextStore:t}),", ..."))))}renderNumberGroupByKeyInput(e,t){return n()(Xa,{value:e[t],onChange:o=>{"size"===t&&o<=0&&(o=1),"start"===t&&o>e.end&&(o=e.end),"end"===t&&o<e.start&&(o=e.start),this.props.onChange({newNumberGroupBy:{...e,[t]:o}})}})}getInlineNumberGroupValueStyle(){return{display:"inline",paddingRight:0,paddingLeft:0}}}qa.displayName="CollectionViewNumberGroupMenu";const $a=(0,d.injectIntl)(qa);class Ja extends l.Z{renderComponent(){return s.createElement(F.ZP,a()({},this.props,{title:this.renderTitle()}),this.renderContent())}renderTitle(){const{collectionSettingsStore:e}=this.props,t=(0,y.n)(e);if(!t||"groupByNumber"!==t.type)return;const{collectionContextStore:o}=this.props,i=o.normalizedSchemaStore.state,n=o.normalizedFormatStore.state[t.groupByKey];return n?ao({groupBy:n,schema:i}):void 0}renderContent(){const{groupByKey:e,groupsFormatKey:t,collectionContextStore:o}=this.props,i=o.collectionViewStore(),r=o.normalizedSchemaStore.state,a=this.getGroupBy();if(!a||!i)return;const s=co(a);return s?n()($a,{numberGroupBy:s,disabled:!1,schema:r,onChange:n=>{if("number"===a.type)g.createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:this.environment,perform:o=>{m.FH({stores:[i],update:{[e]:n.newNumberGroupBy,[t]:void 0},transaction:o})}});else if("formula"===a.type){const o=Ut.omit(n.newNumberGroupBy,"property"),r={...a,groupBy:o};g.createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:this.environment,perform:o=>{m.FH({stores:[i],update:{[e]:r,[t]:void 0},transaction:o})}})}T.wd({environment:this.environment,collectionContextStore:o,action:"group_by_number_update",original_view_type:void 0,property_type:a.type})},collectionContextStore:o}):void 0}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}}Ja.displayName="CollectionSettingsViewGroupByNumber";const Qa=(0,d.injectIntl)(Ja);class es extends l.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:i,groupsFormatKey:n}=this.props,r=t.collectionViewStore(),a=t.normalizedSchemaStore.state;if(r){if(e){const o=a[e];if(!o||!(0,zt.LG)(o))return;const s=(0,zt.fw)(e,o);g.createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:this.environment,perform:e=>{m.FH({stores:[r],update:{[i]:s,[n]:void 0},transaction:e})}}),T.wd({environment:this.environment,collectionContextStore:t,action:"group_by_property_accept",original_view_type:void 0,property_type:o.type})}else g.createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:this.environment,perform:e=>{m.FH({stores:[r],update:{[i]:void 0,[n]:void 0},transaction:e})}}),T.wd({environment:this.environment,collectionContextStore:t,action:"group_by_property_accept"});u.wl({collectionSettingsStore:o,item:{type:"main"}}),u.H4({collectionSettingsStore:o,item:{type:"group",groupByKey:i,groupsFormatKey:n}})}},this.sortBySchemaName=(e,t)=>{var o,i;const n=null==e||null===(o=e[1])||void 0===o?void 0:o.name,r=null==t||null===(i=t[1])||void 0===i?void 0:i.name;return n&&r?n.localeCompare(r,void 0,{sensitivity:"base"}):n?1:r?-1:0}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=(0,y.n)(t),i=e.collectionViewBlockStore(),r=e.collectionViewStore();if(!i||!r||!o||"groupByProperty"!==o.type)return;const l=this.getGroupBy();return s.createElement(F.ZP,a()({},this.props,{title:io(o.groupByKey,this.getCurrentViewType())}),n()(V.Z,{schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,currentProperty:null==l?void 0:l.property,showNoneOption:this.canRemoveGrouping(),getProperties:()=>this.getGroupableProperties(),onAccept:this.handlePropertyAccept}))}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}getGroupableProperties(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state;return Object.entries(t).sort(this.sortBySchemaName).map((e=>e[0])).filter((e=>{const o=t[e];return o&&(0,zt.LG)(o)}))}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}canRemoveGrouping(){return(0,jt._1)({viewType:this.getCurrentViewType(),groupByKey:this.props.groupByKey})}}es.displayName="CollectionSettingsViewGroupByProperty";const ts=(0,d.injectIntl)(es);class os extends l.Z{renderComponent(){return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"Layout",id:"database.viewSettings.layoutTab.title"}),desktopWidth:290}),s.createElement(vt.Z,this.props))}}os.displayName="CollectionSettingsViewLayout";const is=(0,d.injectIntl)(os);var ns=o(75544),rs=o(41418);class as extends l.Z{constructor(){super(...arguments),this.handleSortChange=e=>{this.setSorts(e)},this.handleDeleteAllSortsClick=()=>{const{collectionSettingsStore:e,context:t}=this.props;t===Ss.FilterBar&&u.E3({collectionSettingsStore:e})},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Za.Mj)(e)}))}renderComponent(){const{collectionContextStore:e,context:t}=this.props,o=e.permissionScopes.state,i=t===Ss.ViewSettings&&this.localStateHasChangesStore.state,r=e.collectionViewStore();if(r)return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.sortTab.title"}),footer:i&&s.createElement(s.Fragment,null,n()("div",{style:{paddingTop:24}}),n()(H.Z,{topBorder:!0},void 0,this.renderSaveControl())),unconstrainedWidth:!0}),n()(rs.Z,{collectionViewStore:e.collectionViewStore(),schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,sorts:this.getSorts(),disabled:!o.canConfigureBlock,parentStore:r,onChange:this.handleSortChange,showDeleteAll:!0,onDeleteAll:this.handleDeleteAllSortsClick}))}renderSaveControl(){const{collectionContextStore:e}=this.props;return n()(Ha.ZP,{context:Ha.R1.SettingsSort,collectionContextStore:e})}getSorts(){const{collectionContextStore:e}=this.props;return e.currentSortsStore.state}setSorts(e){const{collectionContextStore:t}=this.props;t.collectionViewStore()&&Ba.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.get(),sorts:{value:e}}})}}as.displayName="CollectionSettingsViewSort";const ss=(0,d.injectIntl)(as);var ls=o(59753),cs=o(47425);var ds=o(15157),ps=o(32056),us=o(16402),ms=o(24039),gs=o(16354);class hs extends l.Z{constructor(e){super(e),this.storeTypes={nextSync:ut.default.of(void 0),uri:ut.default.of(void 0),botId:ut.default.of(void 0)},this.reducer={type:"aggregation",filter:void 0,aggregation:{aggregator:"count",property:"title"}},this.setNextSync=this.setNextSync.bind(this)}didMount(){const e=this.stores.uri.state,t=this.stores.botId.state;if(e&&t){const o=`${t}:${e}`,i=ds.Z.get({userId:this.environment.currentUser.id,key:o});this.setNextSync(i)}}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=t.collectionStore(),i=null==o?void 0:o.getFormatStore(),r=null==i?void 0:i.getKeyStore("uri").getValue(),l=null==i?void 0:i.getKeyStore("bot_id").getValue(),c=null==o||null===(e=o.pointer)||void 0===e?void 0:e.spaceId,p=Ke.default.state.currentSpaceStore,u=null==i?void 0:i.getKeyStore("original_url").getValue(),m=(0,qr.wY)(u,c),g=t.collectionViewBlockStore(),h=Lt.default.checkGate("free_tier_sync_database")||p&&!(0,cs.QM)(p.getSubscriptionTier());return this.stores.uri.set(r),this.stores.botId.set(l),s.createElement(s.Fragment,null,n()(H.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Source database",id:"database.viewSettings.syncedSourceTab.sourceDatabase",description:"Header for the database linked to this block"}),children:n()(se.Z,{placement:se.Z.Placement.Left,alignment:se.Z.Alignment.Center,renderTooltip:()=>g&&n()(ms.Z,{store:g,compactFormat:!0}),render:e=>s.createElement(Jt.Z,a()({},e,{title:m,icon:n()($e.Z,{disabled:!0,icon:null==o?void 0:o.getIcon(),isEmptyPage:!1,size:20,style:this.styles().menuItemIcon}),style:this.styles().menuItemTitle}))}),style:{paddingBottom:0}}),n()(H.Z,{},void 0,this.renderLimitMenuItem()),n()(H.Z,{topBorder:!0},void 0,h&&r&&l&&this.renderSyncButton({uri:r,botId:l}),n()(L.Z,{isGray:!0,title:n()(d.FormattedMessage,{defaultMessage:"Copy debugging information",id:"database.viewSettings.syncedSourceTab.copyDebugging",description:"Button to allow copying debugging information about a synced database."}),icon:M.Z.copy,onClick:()=>{const e={uri:r,botId:l,spaceId:c};Ue.RD({environment:this.environment,stringValue:JSON.stringify(e,null,2),copiedMessage:Ue.tq.copiedLinkToClipboard})}}),n()(gs.Z,{href:`${Yr.Z.domainBaseUrl}?target=connected_apps`},void 0,n()(L.Z,{icon:M.Z.settingsConnectedApps,title:n()(d.FormattedMessage,{defaultMessage:"Manage my connections",id:"database.viewSettings.syncedSourceTab.manageConnections",description:"Button to redirect user to My Connections tab in settings."}),isGray:!0})),n()(Xt.Z,{href:(0,Kt.UY)("guides.syncedDatabases"),title:n()(d.FormattedMessage,{defaultMessage:"Learn about synced databases",id:"database.viewSettings.syncedSourceTab.learnMoreButton.title.",description:"Button for users to learn more about synced databases in help center."}),analyticsFrom:"view_settings_source"})))}renderCountRowValue(e){const{collectionContextStore:t}=this.props;return n()(Gt.Z,{id:"table:uncategorized:title:count",collectionContextStore:t,reducer:this.reducer,render:t=>{const o=t.state;if(!o||"aggregation"!==o.type)return;if("number"!==o.aggregationResult.type)return;const i={...o.aggregationResult,value:o.aggregationResult.value&&Math.min(e,o.aggregationResult.value)};return(0,ps.uf)(i.value,"number_with_commas",this.props.intl)}})}renderLimitMenuItem(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=null==t?void 0:t.getFormatStore(),i="row_limit_exceeded"===(null==o?void 0:o.getKeyStore("sync_state").getKeyStore("syncing").getValue()),r=Ke.default.state.currentSpaceStore,a=this.createComputedStore((()=>{var e;return function(e){if(!e)return 2e4;const t=ls.kk.fromSpace(e),o=t.getSetting("database_sync_row_limit");return void 0!==o?o:(0,cs.QM)(t.getSubscriptionTier())?100:2e4}(null===(e=Ke.default.state.currentSpaceStore)||void 0===e?void 0:e.getModel())}));return n()(Jt.Z,{title:n()("span",{style:{display:"inline-flex",alignItems:"center"}},void 0,i&&r&&(0,cs.QM)(r.getSubscriptionTier())&&n()(se.Z,{placement:se.Z.Placement.Left,alignment:se.Z.Alignment.Center,renderTooltip:()=>n()(d.FormattedMessage,{id:"database.viewSettings.syncedSourceTab.limitFree.toolTip",defaultMessage:"Free Plans are limited to 1 synced database with up to 100 rows.",description:"Information about why a limit error has been reached."}),render:e=>s.createElement("div",e,M.Z.warning({fill:(0,De.fi)("orange",this.theme).fill,marginRight:14,width:12,alignSelf:"center"}))}),n()(d.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.syncedSourceTab.limit",description:"The maximum number of rows allowed"})),right:n()(d.FormattedMessage,{defaultMessage:"{value}/{limit} rows",id:"database.viewSettings.syncedSourceTab.limitRows",description:"Amount of rows used and the maximum allowed.",values:{value:this.renderCountRowValue(a.state),limit:(0,ps.uf)(a.state,"number_with_commas",this.props.intl)}}),style:this.styles().menuItem})}renderSyncButton(e){const{uri:t,botId:o}=e,i=this.stores.nextSync.state,r=!i||i<Date.now();return this.isSyncing()?n()(Jt.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Syncing",id:"database.viewSettings.syncedSourceTab.isSyncing",description:"Database is currently syncing."}),icon:M.Z.sync(this.styles().menuItemIcon,"sync-spinner"),style:this.styles().menuItem}):r?n()(L.Z,{isGray:!0,title:n()(d.FormattedMessage,{defaultMessage:"{message}",id:"database.viewSettings.syncedSourceTab.syncNow",description:"{description}",values:{message:this.syncButtonMessage().defaultMessage,description:this.syncButtonMessage().description}}),icon:M.Z.sync,onClick:async()=>{var e,n;const r=null===(e=this.props.collectionContextStore.collectionStore())||void 0===e?void 0:e.id,a=!0===(null===(n=this.props.collectionContextStore.collectionStore())||void 0===n?void 0:n.getFormat().stale);r&&await u.R0({environment:this.environment,uri:t,botId:o,collectionId:r,nextSync:i,setNextSync:this.setNextSync,isStale:a})}}):n()(Jt.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Sync available in {timeToNextSync}",id:"database.viewSettings.syncedSourceTab.syncNow.disabled",description:"Tells users when they can next press the sync database button.",values:{timeToNextSync:(0,us.hH)(Date.now(),i)}}),icon:M.Z.unsync(this.styles().menuItemIcon),style:this.styles().menuItem})}setNextSync(e){this.stores.nextSync.set(e)}isSyncing(){var e,t;const o=this.props.collectionContextStore,i=o.numberChildrenUnfurled.state,n=o.numberChildrenReceived.state,r=i/n,a=!0===(null===(e=o.collectionStore())||void 0===e||null===(t=e.getFormat().sync_state)||void 0===t?void 0:t.syncing),s=this.environment.device.isMobile;return i&&n&&r<1&&!s||a&&s}styles(){const e=this.environment.device.isMobile;return{menuItemTitle:{paddingLeft:e?4:8},menuItem:{color:this.theme.mediumTextColor,paddingLeft:e?4:8},menuItemIcon:{height:16,width:16,marginRight:2}}}syncButtonMessage(){const e=Ke.default.state.currentSpaceStore,t=e&&(0,cs.QM)(e.getSubscriptionTier());return{defaultMessage:t?"Clear and sync database":"Sync database",description:t?"Clears and refreshes the database ":"Refreshes the synced database."}}}hs.displayName="CollectionSettingsViewSyncedSource";const fs=(0,d.injectIntl)(hs);class vs extends l.Z{constructor(){super(...arguments),this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o}=this.props;g.createAndCommit({userAction:"CollectionSettingsViewSource.handleSourcePickerAccept",environment:this.environment,perform:o=>{ct.yc({environment:this.environment,collectionContextStore:t,collectionStore:e,transaction:o})}}),u.z$({collectionSettingsStore:o})}}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=Boolean(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewSourceCollectionStore()),i=t.collectionViewBlockStore();if(i)return s.createElement(F.ZP,a()({},this.props,{title:n()(d.FormattedMessage,{defaultMessage:"Source",id:"database.viewSettings.sourceTab.title"})}),o?n()(fs,{collectionContextStore:t}):n()(ra.Z,{collectionContextStore:t,parentStore:i,onAccept:this.handleSourcePickerAccept,context:ra.S.Source}))}}vs.displayName="CollectionSettingsViewSource";const ys=(0,d.injectIntl)(vs);var bs=o(72897);let Ss;!function(e){e[e.ViewSettings=0]="ViewSettings",e[e.FilterBar=1]="FilterBar",e[e.TopbarFilterPopup=2]="TopbarFilterPopup",e[e.TopbarSortPopup=3]="TopbarSortPopup",e[e.ViewBlock=4]="ViewBlock"}(Ss||(Ss={}));class ws extends l.Z{constructor(){super(...arguments),this.lastTab=void 0,this.renderMainTab=e=>{var t;if("main"!==e.type)return;const{collectionContextStore:o}=this.props;return s.createElement(Mo,a()({key:null===(t=o.collectionViewStore())||void 0===t?void 0:t.id,selectViewNameInitial:e.selectViewNameInitial},this.props))},this.renderPageViewTab=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(o)return s.createElement(F.ZP,a()({},this.props,{title:"Select page to display",children:n()("div",{style:{margin:12}},void 0,n()(Ya.Z,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{b.Z.setState({pageId:e.target.value})},onSubmit:e=>{const t=b.Z.state.pageId;t&&g.createAndCommit({userAction:"collectionSettings.pageView.selectPage",environment:this.environment,perform:e=>{m.FH({stores:[o],update:{page_pointer:{id:(0,c.Mt)(t),spaceId:e.spaceId,table:"block"}},transaction:e})}})}}))}))},this.renderCreateTypedDBTab=()=>s.createElement(gt,this.props),this.renderSourceTab=()=>s.createElement(ys,this.props),this.renderCreateViewSourceTab=()=>s.createElement(Po.Z,this.props),this.renderCreateExternalViewSourceTab=e=>{if("createSyncedViewSource"===e.type)return s.createElement(it,a()({},this.props,e))},this.renderSelectAccountForExternalViewSourceTab=e=>{if("selectAccountForExternalSource"===e.type)return s.createElement(le,a()({},this.props,e))},this.renderSyncedShareTab=e=>{if("shareSyncedView"===e.type)return s.createElement(xa,a()({},this.props,e))},this.renderPropertyTypeTab=e=>{if("propertyType"===e.type)return s.createElement(na,a()({},this.props,e))},this.renderPropertyAiAutofillTab=e=>{if("propertyAiAutofill"===e.type)return s.createElement(_r,a()({},this.props,e))},this.renderCreateViewTab=()=>s.createElement(Io,this.props),this.renderDuplicateExistingViewTab=()=>s.createElement(Uo.Z,this.props),this.renderPropertiesTab=e=>{if("properties"===e.type)return s.createElement(ns.Z,a()({},this.props,{timelineViewTab:e.timelineViewTab}))},this.renderPropertyTab=e=>{if("property"===e.type)return s.createElement(gr.ZP,a()({key:e.property},this.props,e))},this.renderDeletedPropertiesTab=e=>{if("deletedProperties"===e.type)return s.createElement(Eo,a()({},e,this.props))},this.renderSelectRelationSourceTab=e=>{if("selectRelationSource"===e.type)return s.createElement(sa,a()({},this.props,e))},this.renderSetupRelationTab=e=>{if("setupRelation"===e.type)return s.createElement(da,a()({},this.props,e))},this.renderLayoutTab=()=>s.createElement(is,this.props),this.renderGroupTab=e=>{if("group"===e.type)return s.createElement(ho,a()({},this.props,e))},this.renderGroupByPropertyTab=e=>{if("groupByProperty"===e.type)return s.createElement(ts,a()({},this.props,e))},this.renderGroupByNumberTab=e=>{if("groupByNumber"===e.type)return s.createElement(Qa,a()({},this.props,e))},this.renderSubitemTab=e=>{if("subitem"===e.type)return s.createElement(te,a()({},this.props,e,{formatSetting:"subitem"}))},this.renderArrowsByTab=e=>{if("arrowsBy"===e.type)return s.createElement(te,a()({},this.props,e,{formatSetting:"timeline_arrows_by"}))},this.renderDependencies=e=>{if("dependencies"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props;return n()(Oo,{collectionContextStore:t,collectionSettingsStore:o,type:e.viewType})},this.renderGithubConfigTab=e=>{if("githubConfig"===e.type)return s.createElement(S.Z,a()({},this.props,{property:e.property}))},this.renderFiltersTab=()=>s.createElement(Ka,this.props),this.renderFilterTab=e=>{if("filter"===e.type)return s.createElement(Ua,this.props)},this.renderCreateFilterTab=()=>s.createElement(Aa,this.props),this.renderCreateSortTab=()=>s.createElement(La,this.props),this.renderSortTab=()=>s.createElement(ss,this.props),this.renderAutomationSettingsTab=()=>s.createElement(Ee,this.props),this.renderAutomationCreateSettingsTab=e=>{if("automationCreateSettings"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props;return n()(mr,{collectionContextStore:t,collectionSettingsStore:o,type:"create"})},this.renderAutomationEditSettingsTab=e=>{if("automationEditSettings"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props,{automationId:i}=e;return n()(mr,{automationId:i,collectionContextStore:t,collectionSettingsStore:o,type:"update"})},this.renderSlackAutomationsTab=e=>{if(!(0,f.F6)())return;if("slackAutomations"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props;return n()(va,{collectionContextStore:t,collectionSettingsStore:o})},this.renderCreateSlackAutomationTab=()=>{if(!(0,f.F6)())return;const{collectionContextStore:e,collectionSettingsStore:t}=this.props;return n()(pr,{type:"create",collectionContextStore:e,collectionSettingsStore:t})},this.renderEditSlackAutomationTab=e=>{if(!(0,f.F6)())return;if("editSlackAutomation"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props,{automationId:i,automationActionId:r}=e;return n()(pr,{type:"update",automationId:i,automationActionId:r,collectionContextStore:t,collectionSettingsStore:o})},this.tabRenderers={main:this.renderMainTab,source:this.renderSourceTab,createViewSource:this.renderCreateViewSourceTab,createSyncedViewSource:this.renderCreateExternalViewSourceTab,selectAccountForExternalSource:this.renderSelectAccountForExternalViewSourceTab,shareSyncedView:this.renderSyncedShareTab,propertyType:this.renderPropertyTypeTab,propertyAiAutofill:this.renderPropertyAiAutofillTab,createView:this.renderCreateViewTab,duplicateExistingView:this.renderDuplicateExistingViewTab,properties:this.renderPropertiesTab,property:this.renderPropertyTab,deletedProperties:this.renderDeletedPropertiesTab,selectRelationSource:this.renderSelectRelationSourceTab,setupRelation:this.renderSetupRelationTab,layout:this.renderLayoutTab,group:this.renderGroupTab,groupByProperty:this.renderGroupByPropertyTab,subitem:this.renderSubitemTab,arrowsBy:this.renderArrowsByTab,githubConfig:this.renderGithubConfigTab,filters:this.renderFiltersTab,groupByNumber:this.renderGroupByNumberTab,filter:this.renderFilterTab,createFilter:this.renderCreateFilterTab,createSort:this.renderCreateSortTab,sort:this.renderSortTab,page:this.renderPageViewTab,createTypedDB:this.renderCreateTypedDBTab,automationSettings:this.renderAutomationSettingsTab,automationCreateSettings:this.renderAutomationCreateSettingsTab,automationEditSettings:this.renderAutomationEditSettingsTab,slackAutomations:this.renderSlackAutomationsTab,createSlackAutomation:this.renderCreateSlackAutomationTab,editSlackAutomation:this.renderEditSlackAutomationTab,dependencies:this.renderDependencies},this.handleClose=e=>{(0,h.ZP)({event:e,context:h.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:e}=this.props;u.E3({collectionSettingsStore:e})}})}}didMountOrUpdate(){const{collectionSettingsStore:e}=this.props,t=(0,y.n)(e),o=this.getCurrentViewType();t&&this.lastTab!==t&&p.trackViewSettings(this.environment,{view_type:o,menu:t.type}),this.lastTab=t}renderComponent(){var e,t;const{collectionSettingsStore:o}=this.props,i=(0,y.n)(o);if(i)return n()(bs.Z,{capture:!0,preventType:v.Z.Y},void 0,n()(sr.Z,{capture:!0,onEsc:this.handleClose},void 0,null===(e=(t=this.tabRenderers)[i.type])||void 0===e?void 0:e.call(t,i)))}getCurrentViewType(){const{collectionContextStore:e}=this.props;return e.getViewType()}}ws.displayName="CollectionSettings";const ks=(0,d.injectIntl)(ws)},49670:(e,t,o)=>{o.d(t,{V:()=>T,Z:()=>I});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(82990),p=o(5366),u=o(77162),m=o(5149),g=o(64434),h=o(94419),f=o(30149),v=o(93959),y=o(89014),b=o(12318),S=o(83319),w=o(13005),k=o(42917),C=o(71846),_=o(72495);class M extends l.Z{constructor(){super(...arguments),this.storeTypes={inputStore:b.default.of("")},this.handleNewCollectionClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t}=this.props;u.wd({environment:this.environment,collectionContextStore:e,action:"select_new_collection"});const o=this.stores.inputStore.get();m.E3({collectionSettingsStore:t});const i=e.collectionViewStore(),n=e.collectionViewBlockStore();i&&n&&m.nr({environment:this.environment,selectedDBType:"custom",collectionName:o,collectionContextStore:e,collectionViewBlockStore:n,collectionViewStore:i,useTemporaryRecordCache:!1,baseViewType:"table"})},this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o}=this.props;f.createAndCommit({userAction:"CollectionSettingsCreateViewSource.handleSourcePickerAccept",environment:this.environment,perform:o=>{g.yc({environment:this.environment,collectionContextStore:t,collectionStore:e,transaction:o});const i=t.collectionViewStore(),n=t.collectionViewBlockStore(),r=e.getParentBlockStore();i&&r&&null!=n&&n.isDefined()&&(0,v.h7)(n)&&h.BE({parent:r.getCollectionViewsStore(),insert:i,transaction:o})}}),T({collectionStore:e,collectionContextStore:t,collectionSettingsStore:o})}}renderComponent(){const{collectionContextStore:e}=this.props,{inputStore:t}=this.stores,o=e.collectionViewBlockStore(),i=e.collectionStore();if(!o)return;const r=e.getCollectionViewBlockSourceState(),l=t.state;return s.createElement(w.ZP,n()({},this.props,{title:a()(p.FormattedMessage,{defaultMessage:"Select data source",id:"database.viewSettings.createViewSourceTab.title"}),footer:"uninitialized"===r&&a()(_.Z,{topBorder:!0},void 0,a()(k.Z,{icon:c.Z.plus,isGray:!0,title:a()(p.FormattedMessage,l?{defaultMessage:"New database “{filterText}”",id:"database.viewSettings.createViewSourceTab.newCollectionWithNameButton.title",values:{filterText:a()("span",{style:{...d.Z.textOverflowStyle,fontWeight:d.Z.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"}},void 0,l)}}:{defaultMessage:"New database",id:"database.viewSettings.createViewSourceTab.newCollectionButton.title"}),onClick:this.handleNewCollectionClick}))}),a()(C.Z,{collectionContextStore:e,selectedCollectionStore:i,parentStore:o,onAccept:this.handleSourcePickerAccept,context:C.S.Source,inputStore:t}))}}async function T(e){const{collectionStore:t,collectionContextStore:o,collectionSettingsStore:i}=e,n=o.collectionViewBlockStore(),r=o.collectionViewStore(),a=t.getParentBlockStore();if(!n||!a||!r)return;await Promise.all([...a.getCollectionViewStores().map((e=>e.load())),...n.getCollectionViewStores().map((e=>e.load()))]);(0,S.g)({collectionStore:t,sourceCollectionViewBlockStore:a,currentCollectionViewBlockStore:n,currentCollectionViewStore:r,constraints:(0,y.x)(r.id)}).length>0?m.H4({collectionSettingsStore:i,item:{type:"duplicateExistingView"}}):m.H4({collectionSettingsStore:i,item:{type:"createView"}})}M.displayName="CollectionSettingsCreateViewSource";const I=(0,p.injectIntl)(M)},83319:(e,t,o)=>{o.d(t,{g:()=>D,Z:()=>F});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o(67294),c=o(83355),d=o(26263),p=o(3779),u=o(5366),m=o(77162),g=o(5149),h=o(64434),f=o(9953),v=o(30149),y=o(78316),b=o(33929),S=o(89014),w=o(29798),k=o(3815),C=o(12318),_=o(73657),M=o(13005),T=o(42917),I=o(1136),P=o(45669),x=o(52275),B=o(68894),Z=o(9342),E=o(72495);const R=(0,u.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a view…",id:"database.viewSettings.duplicateExistingViewTab.inputPlaceholder"}});class A extends c.Z{constructor(){super(...arguments),this.temporaryRecordCache=new d.Z,this.lastDuplicatedViewId=void 0,this.originalCollectionPointer=void 0,this.didAccept=!1,this.preselectedViewPointer=void 0,this.storeTypes={inputStore:C.default.of(""),menuListStore:w.Z,limitStore:C.default.of(!0)},this.handlePreviewCollectionView=e=>{this.duplicateViewSettings(e,!0)},this.handlePreviewCollectionViewDebounced=s.debounce(this.handlePreviewCollectionView,500),this.handleMenuListStoreChange=()=>{const e=this.stores.menuListStore.state,{device:t}=this.environment;if(void 0===e.focus.indexGlobal||t.isMobile)return;const o=this.getCurrentResult().viewStores[e.focus.indexGlobal];o&&this.handlePreviewCollectionViewDebounced(o)},this.handleDuplicateViewAccept=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),m.wd({environment:this.environment,collectionContextStore:o,action:"click_duplicate_view"}),this.duplicateViewSettings(e,!1),g.wl({collectionSettingsStore:t,item:{type:"main",selectViewNameInitial:!0}}),this.didAccept=!0},this.handleNewEmptyViewClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;m.wd({environment:this.environment,collectionContextStore:t,action:"click_new_empty_view"}),g.E3({collectionSettingsStore:e}),g.H4({collectionSettingsStore:e,item:{type:"createView"}}),this.didAccept=!0}}willMount(e){const{collectionContextStore:t}=e,{device:o}=this.environment,i=t.collectionStore(),n=t.collectionViewStore();if(!n)return;const r=(0,S.x)(n.id);this.preselectedViewPointer=null==r?void 0:r.viewPointer,this.originalCollectionPointer=null==i?void 0:i.pointer,this.environment.defaultRecordCache.inMemoryRecordCache.addCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.addListener(this.handleMenuListStoreChange);const{viewStores:a}=this.getCurrentResult(),[s]=a;!o.isMobile&&s&&this.duplicateViewSettings(s,!0)}willUnmount(){if(this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.removeListener(this.handleMenuListStoreChange),!this.didAccept){const{viewStores:e}=this.getCurrentResult(),t=this.lastDuplicatedViewId?e.find((e=>e.id===this.lastDuplicatedViewId)):e[0];if(!t)return;this.duplicateViewSettings(t,!1)}}renderComponent(){const{inputStore:e,menuListStore:t,limitStore:o}=this.stores,{device:i}=this.environment,r=e.state,{viewStores:c,showMore:d}=this.getCurrentResult(),m=s.compact(c.map((e=>{const t=e.getType(),o=e.getFormat().collection_view_icon;if(!t||"page"===t)return;const i=e.getName(),r=e.id;return{key:r,render:e=>{var s;return l.createElement(x.Z,n()({},e,{title:a()(P.Z,{collectionViewType:t,collectionViewName:i}),icon:a()(I.F,{color:"regular",viewIcon:o,viewType:t,style:{marginRight:6}}),checkState:(null===(s=this.preselectedViewPointer)||void 0===s?void 0:s.id)===r}))},action:()=>{this.handleDuplicateViewAccept(e)}}})));if(d>0){const e={key:"showMore",render:e=>l.createElement(x.Z,n()({},e,{icon:p.Z.dots({width:16,height:16,color:this.theme.mediumTextColor}),style:{color:this.theme.mediumTextColor},title:a()(u.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.duplicateExistingViewTab.showMore.title",values:{showMore:d}})})),action:()=>{o.set(!1)}};m.push(e)}return l.createElement(M.ZP,n()({},this.props,{title:a()(u.FormattedMessage,{defaultMessage:"Copy an existing view",id:"database.viewSettings.duplicateExistingViewTab.title"}),footer:a()(E.Z,{topBorder:!0},void 0,a()(T.Z,{icon:p.Z.plus,isGray:!0,title:a()(u.FormattedMessage,{defaultMessage:"New empty view",id:"database.viewSettings.duplicateExistingViewTab.newEmptyViewButton.title"}),onClick:this.handleNewEmptyViewClick}))}),(d>0||r)&&a()(E.Z,{},void 0,a()(B.ZP,{focusInitial:!i.isMobile||void 0,value:r,onChange:i=>{e.set(i.target.value),t.setState({focus:{section:0,indexLocal:0,indexGlobal:0}}),o.set(!0)},placeholder:b.default.formatMessage(R.inputPlaceholder),showClearButton:!0})),m.length>0&&a()(Z.Z,{type:Z.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>l.createElement(E.Z,e),items:m}],store:t}),0===m.length&&a()(_.Z,{caption:a()(u.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.duplicateExistingViewTab.noResultsTitle"})}))}getCurrentResult(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore(),o=e.collectionStore(),i=e.collectionViewStore();if(!t||!o||!i)return{viewStores:[],showMore:0};const{inputStore:n,limitStore:r}=this.stores,a=n.state,s=o.getParentBlockStore();if(!t||!s)return{viewStores:[],showMore:0};let l=D({collectionStore:o,sourceCollectionViewBlockStore:s,currentCollectionViewBlockStore:t,currentCollectionViewStore:i,constraints:(0,S.x)(i.id)}),c=0;return a?l=l.filter((e=>(0,y.D)(e,a))):r.state&&(c=l.length-7,l=l.slice(0,7)),{viewStores:l,showMore:c}}duplicateViewSettings(e,t){if(e.id===this.lastDuplicatedViewId&&t)return;this.lastDuplicatedViewId=e.id;const{collectionContextStore:o}=this.props,i=o.collectionViewStore(),n=e.getType();if(!i||!n)return;const r=e.getName(),a=e.getPageSort(),s=e.getFormat(),l=e.getKeyStore("query2").getValue();let c=i;t&&(c=i.clone(this.temporaryRecordCache)),v.createAndCommit({userAction:"CollectionSettingsDuplicateExistingView.duplicateViewSettings",environment:this.environment,perform:e=>{f.sW({store:c,data:{name:r,type:n,page_sort:a,format:{...s,collection_pointer:this.originalCollectionPointer},query2:l},transaction:e})}}),h.Ip({collectionContextStore:o})}}function D(e){const{collectionStore:t,sourceCollectionViewBlockStore:o,currentCollectionViewBlockStore:i,currentCollectionViewStore:n,constraints:r}=e;let a=s.uniqBy([...i.getCollectionViewStores(),...o.getCollectionViewStores()],(e=>e.id)).filter((e=>{var o;return(null===(o=e.getCollectionStore())||void 0===o?void 0:o.id)===t.id&&e.id!==n.id&&"page"!==e.getType()}));if(null!=r&&r.viewType&&(a=[...a.filter((e=>e.getType()===r.viewType)),...a.filter((e=>e.getType()!==r.viewType))]),null!=r&&r.viewPointer){const{id:e}=r.viewPointer,t=a.find((t=>t.pointer.id===e))||k.Xr.createChildStore(o,r.viewPointer);a=[t,...a.filter((t=>t.pointer.id!==e))]}return a}A.displayName="CollectionSettingsDuplicateExistingView";const F=(0,u.injectIntl)(A)},80072:(e,t,o)=>{o.d(t,{Z:()=>Z});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(3779),u=o(27006),m=o(5366),g=o(77162),h=o(12534),f=o(29376),v=o(25464),y=o(86825),b=o(58032);function S(e){const{temporaryAutoRelateState:t,handleAutoRelateToggle:o,collectionContextStore:i,targetCollectionStore:r,autoRelate:a,hasInverseRelation:l}=e,u=(0,c.VK)((()=>i.collectionStore()),[i]),g=(0,c.VK)((()=>Boolean(null==u?void 0:u.isSyncedCollection())),[u]),h=(0,c.VK)((()=>(null==u?void 0:u.getFormat().bot_id)||r.getFormat().bot_id),[u,r]),f=(0,c.VK)((()=>!!h&&(g||!g&&l)),[h,g,l]),S=(0,d.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),w=n()("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"}},void 0,n()(m.FormattedMessage,{defaultMessage:"Automatically Relate",id:"database.viewSettings.setupRelationTab.autoRelate.title",description:"Title for switch to enable auto-relations for this property."}),n()(b.Z,{render:e=>s.createElement("div",e,p.Z.help(S.helpIcon)),style:{width:200},placement:v.u.Bottom,textWrap:!0,renderTooltip:()=>n()(m.FormattedMessage,{defaultMessage:"Relations will automatically populate based on links found in page properties.",id:"database.viewSettings.setupRelationTab.autoRelateTooltip",description:"User facing tooltip explaining how auto-relations work."})}));return f?n()(y.Z,{title:w,on:t?t.enabled:!!a&&(null==a?void 0:a.enabled),focused:!1,onClick:()=>o(h),textWrapperStyle:{opacity:1}}):null}var w=o(82990),k=o(31278),C=o(76798),_=o(72495),M=o(64369);function T(e){window.__c={n:"CollectionSettingsRelationVisualizer"};const{collectionContextStore:t,targetCollectionStore:o,propertySchema:i,propertyName:r,temporaryInverseState:a,hasInverseRelation:l,inverseRelationName:p,isInitialPropertyName:u}=e,g=(0,m.useIntl)(),h=(0,c.VK)((()=>t.collectionStore()),[t]),v=a?a.hasInverseRelation:l,y=(0,c.VK)((()=>Boolean(h&&o.id===h.id)),[h,o]),b=(0,c.VK)((()=>{const e=a?a.inverseName:p;return e||(null!=h&&h.isDefined()?f.aI(g,{sourceCollection:h.getModel(),isSelfRelation:y,targetCollectionStore:o,createUnique:!0}):"")}),[h,g,p,y,a,o]),S=(0,c.VK)((()=>null!=h&&h.isDefined()?b===f.aI(g,{sourceCollection:h.getModel(),isSelfRelation:y,targetCollectionStore:o,createUnique:!1}):void 0),[h,g,b,y,o]),w=Boolean(!y&&u&&(!v||v&&S)),k=(0,d.yK)((e=>({preview:{background:e.inputBackground,marginLeft:14,marginRight:14,padding:w?"42px 12px":12,boxShadow:e.inputBoxShadow,borderRadius:3,display:"flex",flexDirection:"column",justifyContent:"center"},condensedView:{height:22,display:"flex",justifyContent:"center",alignItems:"center"},condensedProperties:{width:33,height:v?20:10,margin:"0px 12px",display:"flex",flexDirection:"column",justifyContent:"center"},databasesRow:{height:22}})),[w,v]);return h?n()(_.Z,{title:n()(M.Z,{isSmall:!0,isSecondaryColor:!0},void 0,n()(m.FormattedMessage,{defaultMessage:"Preview",id:"database.viewSettings.setupRelationTab.relationVisualizer.title",description:"Label for visual preview of relation property"})),disableMobileBorders:!0},void 0,n()("div",{style:k.preview},void 0,w?n()("div",{style:k.condensedView},void 0,n()(P,{collectionStore:h,condensedView:!0}),n()("div",{style:k.condensedProperties},void 0,n()(I,{propertyName:r||(null==i?void 0:i.name),condensedView:!0}),v&&n()(I,{propertyName:b,condensedView:!0,isInverse:!0})),n()(P,{collectionStore:o,condensedView:!0,isTarget:!0})):s.createElement(s.Fragment,null,n()(I,{propertyName:r||(null==i?void 0:i.name),bidirectional:y&&!v}),n()("div",{style:k.databasesRow},void 0,n()(P,{collectionStore:h}),n()(P,{collectionStore:o,isTarget:!0})),v&&n()(I,{propertyName:b,isInverse:!0})))):null}function I(e){const{propertyName:t,bidirectional:o,isInverse:i,condensedView:r}=e,a=(0,d.yK)((e=>({propertyLabel:{fontSize:12,wordBreak:"break-word",...w.Z.textOverflowStyle,maxWidth:200,alignSelf:"center",color:e.mediumTextColor,fill:e.mediumIconColor},arrow:{width:136,height:25,alignSelf:"center",transform:i?"rotate(180deg)":void 0,margin:i?"6px 12px 0px 6px":"0px 6px 6px 6px",opacity:.3,fill:e.regularIconColor},smallArrow:{height:8,paddingLeft:1,marginTop:i?2:void 0,display:"inherit",transform:i?"rotate(180deg)":void 0,opacity:.3,fill:e.regularIconColor}})),[i]),l=n()("div",{style:a.propertyLabel},void 0,t||"");return s.createElement(s.Fragment,null,!i&&!r&&l,r?p.Z.collectionRelationSmallArrowRight(a.smallArrow):o?p.Z.collectionSelfRelationArrow(a.arrow):p.Z.collectionRelationArrow(a.arrow),i&&!r&&l)}function P(e){window.__c={n:"RelationVisualizerDatabase"};const{collectionStore:t,condensedView:o,isTarget:i}=e,r=(0,c.VK)((()=>t.getIcon()),[t]),a=(0,d.yK)((e=>({wrapper:{display:"flex",alignItems:"center",padding:2,color:e.mediumTextColor,fill:e.mediumIconColor,position:o?void 0:"absolute",left:o?void 0:i?"72%":"28%",transform:o?void 0:"translate(-50%, 0)",width:"fit-content"},icon:{marginRight:4,width:12,height:12},title:{fontSize:12,wordBreak:"break-word",...w.Z.textOverflowStyle,maxWidth:100}})),[o,i]);return n()("div",{style:a.wrapper},void 0,r?n()(k.Z,{icon:r,isEmptyPage:!1,size:12,disabled:!0,style:a.icon}):p.Z.collectionTable(a.icon),n()(C.Z,{store:t,style:a.title}))}var x=o(42922),B=o(68894);function Z(e){const{collectionContextStore:t,property:o,propertyName:i,targetCollectionStore:r,onSubmit:a,buttonContents:w,isInitialPropertyName:k,temporaryInverseState:M,setTemporaryInverseState:I,from:P}=e,B=(0,l.O7)(),Z=(0,c.VK)((()=>o?f.KV(t,o):void 0),[t,o]),R=(0,c.VK)((()=>t.collectionStore()),[t]),A=(0,c.VK)((()=>Boolean(R&&R.id===r.id)),[R,r]),D=(0,c.VK)((()=>Boolean(o?f.OP(t,o,r):void 0)),[t,o,r]),F=(0,c.VK)((()=>{if("relation"!==(null==Z?void 0:Z.type))return"";const e=Z.property;if(!e||e===o)return"";const t=r.getRole();if(!t||!u.YX(t))return"";const i=r.getSchema()[e];return(null==i?void 0:i.name)||""}),[r,o,Z]),L=(0,c.VK)((()=>"relation"===(null==Z?void 0:Z.type)&&Z.autoRelate?Z.autoRelate:{enabled:!1}),[Z]),V=(0,c.VK)((()=>Boolean(f.gZ(r))),[r]),N=(0,c.VK)((()=>Boolean((null==R?void 0:R.getDatabaseType())&&o&&(null==R?void 0:R.isTypedProperty(o)))),[R,o]),O=(0,c.VK)((()=>t.contextType),[t]),U=(0,d.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),H=(0,s.useMemo)((()=>M?M.hasInverseRelation:D),[M,D]),z=(0,s.useMemo)((()=>M?M.inverseName:F),[M,F]),W=(0,s.useMemo)((()=>M?M.autoRelate:L),[M,L]),j=(0,s.useCallback)((()=>{const e=null!=R&&R.isSyncedCollection()?W:H?{enabled:!1}:W;I({hasInverseRelation:!H,inverseName:H?void 0:z,autoRelate:e}),o&&g.$q({environment:B,collectionContextStore:t,property:o,from:"collectionPage"===O?"page_properties":"view_settings",action:H?"relation_toggle_inverse_off":"relation_toggle_inverse_on",is_self_relation:A})}),[I,H,z,W,t,R,o,O,A,B]),K=(0,s.useCallback)((e=>{I({hasInverseRelation:!0,inverseName:e.target.value,autoRelate:W})}),[I,W]),Y=(0,s.useCallback)((e=>{const i=null!=W&&W.enabled?{enabled:!1}:{enabled:!0,bot_id:e};I({hasInverseRelation:H,inverseName:z,autoRelate:i}),o&&g.$q({environment:B,collectionContextStore:t,property:o,from:"collectionPage"===O?"page_properties":"view_settings",action:i.enabled?"auto_relation_toggle_on":"auto_relation_toggle_off"})}),[o,I,t,O,z,H,W,B]),G=(0,s.useCallback)((e=>{(0,h.ZP)({event:e,context:h.Af.CollectionSettingsClick,callback:a})}),[a]),X=n()("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"}},void 0,n()(m.FormattedMessage,A?{id:"database.viewSettings.setupRelationTab.selfRelation.reverse",defaultMessage:"Separate directions",description:"Toggle label for creating inverse self relation in database"}:{id:"database.viewSettings.setupRelationTab.relation.reverse",defaultMessage:"Show on {databaseName}",description:"Toggle label for showing inverse relation in target database",values:{databaseName:n()(C.Z,{style:{display:"inline"},store:r})}}),n()(b.Z,{render:e=>s.createElement("div",e,p.Z.help(U.helpIcon)),style:{width:200},placement:v.u.Bottom,textWrap:!0,renderTooltip:()=>n()(m.FormattedMessage,!V||N?{defaultMessage:"Cannot edit target database.",id:"database.viewSettings.setupRelationTab.inverseDisabledWarning.title",description:"User facing error message when unable to create or delete an inverse relation to database"}:A?{defaultMessage:"Create separate properties for each direction of a two-way relation. Useful for modeling Parent task/Sub-tasks, Blocked by/Blocking, and more.",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip.selfRelation",description:"Tooltip content explaining inverse self relation properties"}:{defaultMessage:"Create a property on {databaseName} showing backlinks to the current database",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip",description:"Tooltip content explaining inverse relation properties",values:{databaseName:n()(C.Z,{style:{display:"inline"},store:r})}})}));return s.createElement(s.Fragment,null,!(A&&D)&&!P&&n()(y.Z,{title:X,on:H,focused:!1,onClick:j,disabled:!V||A&&D||N,textWrapperStyle:{opacity:1}}),n()(E,{collectionContextStore:t,targetCollectionStore:r,isSelfRelation:A,temporaryInverseState:M,hasInverseRelation:D,inverseRelationName:F,disabled:!V||N,onChange:K,from:P}),n()(S,{handleAutoRelateToggle:Y,temporaryAutoRelateState:null==M?void 0:M.autoRelate,collectionContextStore:t,autoRelate:L,targetCollectionStore:r,hasInverseRelation:H}),(()=>{if("relation"!==(null==Z?void 0:Z.type))return!0;if(M){if(M.hasInverseRelation!==D)return!0;if(M.inverseName&&M.inverseName!==F)return!0;if(M.autoRelate&&M.autoRelate.enabled!==L.enabled)return!0}return!1})()&&n()(_.Z,{},void 0,n()(x.Z,{style:{display:"flex",margin:"6px 12px 0px 12px"},onClick:G},void 0,w)),"subitem"!==P&&"timeline_arrows_by"!==P&&n()(T,{propertySchema:Z,propertyName:i,collectionContextStore:t,targetCollectionStore:r,temporaryInverseState:M,hasInverseRelation:D,inverseRelationName:F,isInitialPropertyName:k}))}function E(e){window.__c={n:"CollectionSettingsInverseRelationName"};const{collectionContextStore:t,targetCollectionStore:o,isSelfRelation:i,temporaryInverseState:r,hasInverseRelation:s,inverseRelationName:l,disabled:d,onChange:p,from:u}=e,g=(0,m.useIntl)(),h=(0,c.VK)((()=>{const e=t.collectionStore();return null!=e&&e.isDefined()?f.aI(g,{sourceCollection:e.getModel(),isSelfRelation:i,targetCollectionStore:o,createUnique:!0,from:u}):g.formatMessage({id:"database.viewSettings.setupRelationTab.inverseRelationName.placeholder",defaultMessage:"Related to target",description:"Placeholder for inverse relation name if no target database selected"})}),[t,g,i,o,u]);return(r?r.hasInverseRelation:s)?n()(_.Z,{title:!u&&n()(M.Z,{isSmall:!0,isSecondaryColor:!0},void 0,n()(m.FormattedMessage,{defaultMessage:"Related property on {databaseName}",id:"database.viewSettings.setupRelationTab.inverseRelationNameInput.title",description:"Text field label for database relation property's inverse property name",values:{databaseName:n()(C.Z,{style:{display:"inline"},store:o})}}))},void 0,n()(B.ZP,{value:"subitem"!==u&&"timeline_arrows_by"!==u?(null==r?void 0:r.inverseName)||l:h,placeholder:h,onChange:p,onBlur:a().identity,onSubmit:a().identity,focusInitial:!1,selectAll:!1,disabled:d})):null}},21269:(e,t,o)=>{o.d(t,{Z:()=>d});var i=o(77094),n=o.n(i),r=(o(67294),o(480)),a=o(3779),s=o(50906),l=o(42917),c=o(16354);const d=function(e){window.__c={n:"CollectionSettingsLearnMoreButton"};const{title:t,href:o,analyticsFrom:i}=e,d=(0,r.O7)();return n()(c.Z,{href:o,onClick:()=>s.trackClickHelpButton(d,{from:i}),external:!0},void 0,n()(l.Z,{icon:a.Z.help,title:t,isGray:!0}))}},71554:(e,t,o)=>{o.d(t,{C:()=>h,U:()=>f});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(99036),l=o(5366),c=o(77162),d=o(64434),p=o(30149);function u(e,t){return"1"===e?n()(l.FormattedMessage,"relation"===t?{defaultMessage:"1 page",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.relation",description:"Restrict selection for this property type to only 1 page"}:{defaultMessage:"1 {type}",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne",description:"Restrict selection for this property type to only 1 value",values:{type:t}}):"no_limit"===e?n()(l.FormattedMessage,{defaultMessage:"No limit",id:"database.viewSettings.collectionPropertyLimitHelpers.noLimit",description:"No limitation enforced on how many values can be selected for this property type"}):void 0}function m(e,t){return{key:e,title:u(e,t)}}var g=o(13709);function h(e){window.__c={n:"CollectionSettingsLimitOptions"};const{property:t,propertySchema:o,collectionContextStore:i}=e,l=(0,a.O7)(),u=(0,r.useCallback)((e=>{const n=i.collectionStore();if(!n||!(0,s.en)(o))return;const r={...o,limit:Number(e)?1:void 0};p.createAndCommit({userAction:"CollectionSettingsLimitOptions.handleLimitChange",environment:l,perform:e=>{d.xO({environment:l,collectionStore:n,update:{[t]:r},transaction:e})}});const a=Number(e)?`${o.type}_toggle_limit_on`:`${o.type}_toggle_limit_off`;c.$q({environment:l,collectionContextStore:i,property:t,from:"view_settings",action:a})}),[i,l,t,o]);return(0,s.en)(o)?n()(f,{propertyType:o.type,selectedKey:o.limit?"1":"no_limit",onChange:u}):null}function f(e){window.__c={n:"CollectionSettingsLimitPickList"};const{propertyType:t,selectedKey:o,onChange:i}=e;return n()(g.Z,{title:n()(l.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.collectionPropertyLimitHelpers.limit",description:"Display name for the limit setting configured for different property types"}),selectedKey:o,popupStyle:{minWidth:190},options:[m("1",t),m("no_limit")],onChange:i})}},13005:(e,t,o)=>{o.d(t,{nJ:()=>k,j9:()=>C,ZP:()=>M});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(82990),p=o(5366),u=o(5149),m=o(12534),g=o(60709),h=o(13273),f=o(58421),v=o(64921),y=o(73063),b=o(36488),S=o(78140),w=o(40721);const k=290,C=400;class _ extends l.Z{constructor(){super(...arguments),this.handleBackArrowClick=()=>{if(this.props.handleBackArrowClick)return void this.props.handleBackArrowClick();const{collectionSettingsStore:e}=this.props;u.z$({collectionSettingsStore:e})},this.handleClose=e=>{this.props.handleClose?this.props.handleClose(e):(0,m.ZP)({event:e,context:m.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:e}=this.props;u.E3({collectionSettingsStore:e})}})},this.handleClickOutside=e=>{(0,h.jM)(e.target)||(0,h.al)(e.target)||this.handleClose(e)}}renderComponent(){const{children:e,footer:t,unconstrainedWidth:o,desktopWidth:i,title:r,collectionSettingsStore:l,fullHeight:d,menuScrollerStyle:p}=this.props,{device:u}=this.environment,m=l.get();if(!(0,f.n)(l))return;let h;if(u.isMobile)h={menuType:g.og.Modal,title:r,left:m.stack.length>1&&a()(y.Z,{icon:c.Z.historyBack,onClick:this.handleBackArrowClick}),right:a()(w.DoneMenuText,{}),onClickRight:this.handleClose};else{const e=o||i?void 0:k;h={menuType:g.og.Popup,minWidth:k,width:i,maxHeight:d?"calc(100% - 16px)":"50vh",...e&&{maxWidth:e},onClickOutside:this.handleClickOutside,scrollerStyle:{flexGrow:0,...p},header:this.renderHeader(),footer:t}}const v=s.createElement(s.Fragment,null,u.isMobile&&this.props.header,e,u.isMobile&&t);return d?s.createElement(S.Z,h,v):a()(b.Z,{capture:!0,allowMobileAutoScroll:!0,allowEsc:!0,render:e=>s.createElement(S.Z,n()({},h,e),v)})}renderHeader(){const{header:e,title:t,collectionSettingsStore:o,hideDesktopHeader:i}=this.props,n=o.get();return s.createElement(s.Fragment,null,i&&a()("div",{style:{height:6}}),!i&&a()("div",{style:{display:"flex",alignItems:"center",padding:"14px 16px 6px 16px",height:42}},void 0,n.stack.length>1&&a()(y.Z,{icon:c.Z.arrowLeftThick,style:{marginRight:8,marginLeft:-2,height:22},iconStyle:{width:16,height:16},onClick:this.handleBackArrowClick}),a()("span",{style:{flexGrow:1,fontWeight:d.Z.fontWeight.semibold,fontSize:14,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},void 0,t),a()(v.Z,{onClick:this.handleClose,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:this.theme.buttonHoveredBackground,width:18,height:18,flexShrink:0},hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,c.Z.closeSmall({width:14,fill:this.theme.mediumTextColor}))),e)}}_.displayName="CollectionSettingsMenu";const M=(0,p.injectIntl)(_)},42917:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(24405),l=o(8848),c=o(3779),d=o(52275);const p=function(e){window.__c={n:"CollectionSettingsMenuItem"};const{icon:t,title:o,caption:i,right:p,isRed:u,isGray:m,isOrange:g,isPadded:h,onClick:f,onMouseDown:v,onMouseEnter:y,onMouseLeave:b,disabled:S,showChevron:w,chevronStyle:k,rotateChevron:C,showDragHandle:_,focused:M,textWrapperStyle:T}=e,I=(0,a.O7)(),{isMobile:P}=I.device,x=(0,s.yK)((e=>({style:{color:m?e.mediumTextColor:g?"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[400]:e.regularTextColor,fill:m?e.mediumIconColor:g?"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[400]:e.regularIconColor,opacity:S?.4:void 0},redHoveredStyle:{color:l.ZP.red,fill:l.ZP.red},leftIconStyle:{width:24,height:h?24:P?18:16,marginRight:-2,...t===c.Z.dots&&{height:3}},rightStyle:{display:"flex",alignItems:"center",color:S?e.regularTextColor:e.lightTextColor,fill:S?e.regularIconColor:e.lightIconColor,flexShrink:0},rightIconStyle:{width:12,fill:e.lightIconColor,marginLeft:6,transition:"transform 200ms ease-in-out",...k},rightIconRotatedStyle:{transform:"rotate(90deg)"}})),[m,g,S,h,P,t,k]);return n()(d.Z,{icon:null==t?void 0:t(x.leftIconStyle),focused:M||!1,disabled:S,title:o,caption:i,desktopTitleStyle:{flexGrow:1,flexShrink:1},showDragHandle:_,buttonStyle:x.style,rightStyle:x.rightStyle,hoveredStyle:u?x.redHoveredStyle:void 0,ignoreLocalHoverState:!!S||void 0,right:r.createElement(r.Fragment,null,p,!S&&w&&c.Z.chevronRight({...x.rightIconStyle,...C&&x.rightIconRotatedStyle})),onClick:f,onMouseDown:v,onMouseEnter:y,onMouseLeave:b,textWrapperStyle:T})}},26122:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(5366),s=o(27153),l=o(12318),c=o(68894),d=o(23321);class p extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:l.default.of("")},this.handleBlur=()=>{this.props.onBlur(this.stores.inputStore.get())},this.handleSubmit=()=>{this.props.onSubmit(this.stores.inputStore.get())},this.showMediaPicker=e=>{if(!this.props.iconButton)return;const{intl:t}=this.props,{onSubmit:o,enforceIconColor:i,includeEmojiTab:n}=this.props.iconButton;s.$(this.environment,{originRect:e.target.getBoundingClientRect(),originGap:3,popupHeight:d.ZP.desktopIconPickerOnlyPopupHeight,popupWidth:d.ZP.desktopIconPickerOnlyPopupWidth,showArrow:!0,title:t.formatMessage({defaultMessage:"Icon",id:"mediaPicker.tabs.icon",description:"Icon tab heading"}),currentTab:"icon",tabs:n?[{type:"emoji",onChange:(e,t)=>{o(e),t&&t.keepVisible||s.Z()}},{type:"icon",enforceIconColor:i,onChange:(e,t)=>{o(e),t&&t.keepVisible||s.Z()}}]:[{type:"icon",enforceIconColor:i,onChange:(e,t)=>{o(e),t&&t.keepVisible||s.Z()}}],onDelete:()=>{o(),s.Z()}})}}willMount(e){super.willMount(e),this.stores.inputStore.set(e.initialValue)}willUnmount(){const{initialValue:e,onBlur:t}=this.props,o=this.stores.inputStore.get();e!==o&&t(o)}renderComponent(){const{placeholder:e,focusInitial:t,selectAll:o,disabled:i,inputOuterStyle:r,iconButton:a}=this.props,{inputStore:s}=this.stores,l=s.get();return n()(c.ZP,{focusInitial:t,selectAll:o,value:l,onChange:e=>{s.set(e.target.value)},onBlur:this.handleBlur,onSubmit:this.handleSubmit,placeholder:e,disabled:i,textWrapperStyle:{opacity:i?.7:void 0},inputOuterStyle:r,left:a&&n()(c.DO,{icon:a.icon,iconStyle:a.iconStyle,onClick:this.showMediaPicker})})}}p.displayName="CollectionSettingsNameInput";const u=(0,a.injectIntl)(p)},13709:(e,t,o)=>{o.d(t,{Z:()=>C});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(480),p=o(81954),u=o(65917),m=o(2911),g=o(60709),h=o(61766),f=o(42917),v=o(52275),y=o(31945),b=o(78140),S=o(9342),w=o(44532),k=o(72495);const C=function(e){let{icon:t,title:o,selectedKey:i,options:r,onChange:s,onClick:C,popupStyle:_,menuItemOptionsStyle:M,disabled:T,collectionContextStore:I,openButtonPopup:P}=e;window.__c={n:"CollectionSettingsPickListMenuItem"};const x=(0,d.Fy)(),B=r.find((e=>l().isEqual(e.key,i))),Z=(0,p.qz)(void 0,h.Z),E=(0,p.Kw)(Z);return(0,c.useEffect)((()=>{I&&P&&(Z.setState({...Z.state,open:P}),I.settingsStore.setState({...I.settingsStore.state,openButtonPopup:void 0})),B||u.log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,m.Ui)("Selected key is invalid.")})})),n()(y.Z,{popupType:x.isMobile?w.kQ.SlideUp:w.kQ.Popup,alignmentToOrigin:y.Z.Alignment.End,placementToOrigin:y.Z.Placement.Bottom,style:_,originGap:0,buttonPopupStore:Z,disabled:T,onClick:C,renderOrigin:e=>c.createElement(f.Z,a()({title:o,showChevron:!0,right:null==B?void 0:B.title,rotateChevron:E.open,disabled:T,icon:t},e)),render:e=>{let t;t=x.isMobile?{menuType:g.og.ActionSheet}:{menuType:g.og.Popup,width:250};const o=l().compact(r.map(((t,o)=>({key:o,render:e=>c.createElement(v.Z,a()({},e,{disabled:!1,title:t.title,icon:t.icon,caption:t.caption,body:t.body,style:M,checkState:l().isEqual(t.key,i)})),action:()=>{s(t.key),e.close()}}))));return c.createElement(b.Z,t,n()(S.Z,{type:S.i.Vertical,sections:[{key:0,render:e=>c.createElement(k.Z,a()({enableActionSheetTitle:!0},e)),items:o}],initialFocus:0}))}})}},10107:(e,t,o)=>{o.d(t,{mJ:()=>st,ZP:()=>lt,sY:()=>rt});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(62518),c=o(83355),d=o(1302),p=o(99036),u=o(80951),m=o(8848),g=o(39068),h=o(79362),f=o(3779),v=o(97880),y=o(5366),b=o(77162),S=o(16956),w=o(5149),k=o(64434),C=o(96802),_=o(30149),M=o(93959),T=o(16187),I=o(52821),P=o(78316),x=o(99417),B=o(75081),Z=o(33929),E=o(33665),R=o(77546),A=o(85644),D=o(67695),F=o(61766),L=o(10161),V=o(33846),N=o(3815),O=o(12318),U=o(52557),H=o(27788),z=o(480),W=o(81954),j=o(98963),K=o(9953),Y=o(68910),G=o(85631),X=o(68894),q=o(72495);function $(e){const{collectionContextStore:t,propertySchema:o,propertyId:i}=e,n=(0,z.O7)(),r=n.currentUser.id,l=(0,W.Kw)(t.permissionScopes),c=(0,W.VK)((()=>t.collectionStore()),[t]),d=(0,W.VK)((()=>o.automation_id&&c?N.Mz.createChildStore(c,{table:j.cv,id:o.automation_id,spaceId:c.getSpaceId()}):void 0),[c,o]),p=(0,W.VK)((()=>null==d?void 0:d.getTrigger()),[d]),u=(0,s.useMemo)((()=>{if(d)return new Y.L({type:"button_property",persisted:!0,automationStore:d,collectionContextStore:t,propertyId:i,propertySchema:o,intl:Z.default.getIntl(),parentRecordStore:d,currentUserId:r})}),[i,o,d,t,r]),m=(0,W.VK)((()=>(null==d?void 0:d.getNameStore().getValue())??""),[d]),g=(0,s.useCallback)((e=>{if(!d)return;const t=e.currentTarget.value;_.createAndCommit({userAction:"CollectionSettingsButtonOptions.setName",environment:n,perform:e=>{K.sO({store:d.getNameStore(),transaction:e,value:t})}})}),[d,n]);return c&&d&&p&&"button"===p.type&&u?s.createElement(s.Fragment,null,a()(q.Z,{topBorder:!0,title:a()(y.FormattedMessage,{id:"database.buttonProperty.label",defaultMessage:"Label",description:"Label for property button"})},void 0,a()(X.ZP,{disabled:!l.canConfigureCollection,placeholder:Z.default.formatMessage(J.inputPlaceholder),value:m,onChange:g})),a()(q.Z,{title:a()(y.FormattedMessage,{id:"database.buttonProperty.actions",defaultMessage:"Actions",description:"Actions for property button"})},void 0,a()(G.t,{contextStore:u,disabled:!l.canConfigureCollection,suppressErrors:!0,onActionAdded:()=>{}}),a()("div",{}))):null}const J=(0,y.defineMessages)({inputPlaceholder:{defaultMessage:"Type a name for this button...",id:"database.buttonProperty.label.inputPlaceholder",description:"Input placeholder for property button label"}});var Q=o(13991),ee=o(32918),te=o(11843),oe=o(13709);class ie extends c.Z{constructor(){super(...arguments),this.handleDateFormatChange=e=>{const{collectionContextStore:t,property:o}=this.props,i=t.collectionStore(),n=this.getPropertySchema();if(!i||!n)return;const r={...n,date_format:e};_.createAndCommit({userAction:"CollectionSettingsDateOptions.handleDateFormatChange",environment:this.environment,perform:e=>{k.xO({environment:this.environment,collectionStore:i,update:{[o]:r},transaction:e})}}),b.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"date_change_format"})},this.handleClockFormatChange=e=>{const{collectionContextStore:t,property:o}=this.props,i=t.collectionStore(),n=this.getPropertySchema();if(!i||!n)return;const r=this.getTimeFormatOptions()[e],a={...n,time_format:r};_.createAndCommit({userAction:"CollectionSettingsDateOptions.handleClockFormatChange",environment:this.environment,perform:e=>{k.xO({environment:this.environment,collectionStore:i,update:{[o]:a},transaction:e})}}),b.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"date_change_time_format"})},this.getTimeFormatOptions=()=>(0,te.E)(Q.SP).time}renderComponent(){const{intl:e}=this.props,t=this.getPropertySchema();if(!t)return;const o=t.date_format||ee.sF,i=t.time_format||ee.c_,n=this.getClockFormatFromTimeFormat(i);return s.createElement(s.Fragment,null,a()(oe.Z,{title:a()(y.FormattedMessage,{defaultMessage:"Date format",id:"database.viewSettings.dateOptions.dateFormat"}),selectedKey:o,popupStyle:{minWidth:190},options:ee.Zy.map((t=>({key:t,title:e.formatMessage(ee.fy[t])}))),onChange:this.handleDateFormatChange}),a()(oe.Z,{title:a()(y.FormattedMessage,{defaultMessage:"Time format",id:"database.viewSettings.dateOptions.timeFormat"}),selectedKey:n,popupStyle:{minWidth:190},options:ee.L7.map((t=>({key:t,title:e.formatMessage(ee.Fi[t])}))),onChange:this.handleClockFormatChange}))}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o)return"date"===o.type||"created_time"===o.type||"last_edited_time"===o.type?o:void 0}getClockFormatFromTimeFormat(e){const t=this.getTimeFormatOptions();for(const o in t)if(t[o]===e)return o;return"12h"}}ie.displayName="CollectionSettingsDateOptions";const ne=(0,y.injectIntl)(ie);function re(e){window.__c={n:"CollectionSettingsDefaultPersonPicker"};const{collectionContextStore:t,property:o,propertySchema:i}=e,n=(0,z.O7)(),r=(0,s.useCallback)((e=>{const r={...i,default:"created_by"===e?"created_by":void 0},a=t.collectionStore();if(!a)return;const s=[],l={pointer:a.pointer,command:"update",path:["schema",o],args:{default:e}};s.push(l),k.HW({environment:n,collectionStore:a,performTransaction:e=>{for(const t of s)_.applyOperation({store:(0,N.Kv)(a,t.pointer),operation:t,transaction:e})}}),_.createAndCommit({userAction:"CollectionSettingsDefaultPersonPicker.handleChange",environment:n,perform:e=>{k.xO({environment:n,collectionStore:a,update:{[o]:r},transaction:e})}})}),[t,n,o,i]);return a()(oe.Z,{title:a()(y.FormattedMessage,{defaultMessage:"Default",id:"CollectionSettingsDefaultPersonPicker.default.title",description:"Display text denoting the default person picker for a person database property that the property will fall back to if there is no person set"}),selectedKey:i.default?"created_by":"no_default",popupStyle:{minWidth:190},options:[{key:"no_default",title:a()(y.FormattedMessage,{defaultMessage:"No default",id:"CollectionSettingsDefaultPersonPicker.options.noDefault",description:"An option on the default person picker that will not set any default value on the property even if there's no value set"})},{key:"created_by",title:a()(y.FormattedMessage,{defaultMessage:"Created by",id:"CollectionSettingsDefaultPersonPicker.options.creator",description:"An option on the default person picker that will set the property value to be the creator of the block property if there's no value set"}),icon:f.Z.person({width:16})}],onChange:r})}var ae=o(21202),se=o(42917),le=o(31945),ce=o(44532),de=o(73240);class pe extends c.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:F.Z},this.renderPopup=e=>{const{collectionContextStore:t,property:o}=this.props,i=t.collectionStore();if(!i)return;const n=t.normalizedSchemaStore.state,r=Array.from(t.resultSet.get().values())[0],s=r?N.G.createChildStore(i,{table:ae.iU,id:r,spaceId:i.pointer.spaceId}).getValue():void 0,l=Boolean(i.getDatabaseType()&&i.isTypedProperty(o));return a()(de.default,{property:o,schema:n,analyticsFrom:"view_settings",exampleBlock:s,disabled:l,onChange:this.handleFormulaChange,onClickCancel:e.close})},this.handleFormulaChange=e=>{let{propertySchema:t,close:o}=e;const{collectionContextStore:i,property:n}=this.props,r=i.collectionStore();r&&(_.createAndCommit({userAction:"CollectionSettingsFormulaOptions.handleFormulaChange",environment:this.environment,perform:e=>{k.xO({environment:this.environment,collectionStore:r,update:{[n]:t},transaction:e})}}),o&&this.stores.buttonPopupStore.reset(),b.$q({environment:this.environment,collectionContextStore:i,property:n,from:"view_settings",action:"formula_edit"}))}}renderComponent(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores;return a()(le.Z,{popupType:e.isMobile?ce.kQ.SlideUp:ce.kQ.Popup,alignmentToOrigin:le.Z.Alignment.End,renderOrigin:e=>s.createElement(se.Z,n()({title:a()(y.FormattedMessage,{defaultMessage:"Formula",id:"database.viewSettings.formulaOptions.title"}),right:a()(y.FormattedMessage,{defaultMessage:"Edit",id:"database.viewSettings.formulaOptions.edit"}),showChevron:!0,rotateChevron:t.state.open},e)),render:this.renderPopup,buttonPopupStore:t})}}pe.displayName="CollectionSettingsFormulaOptions";const ue=(0,y.injectIntl)(pe);var me=o(21269),ge=o(71554),he=o(13005),fe=o(26122),ve=o(24405),ye=o(2032),be=o(34299),Se=o(32056),we=o(82990),ke=o(64921),Ce=o(74194),_e=o(85248),Me=o(78942),Te=o(24006),Ie=o(75173),Pe=o(9050);function xe(e){var t,o,i,r;window.__c={n:"NumberShowAsSection"};const l=(0,z.O7)(),c=(0,ve.Fg)(),[d,p]=s.useState({type:(null===(t=e.showAs)||void 0===t?void 0:t.type)??"number",color:(null===(o=e.showAs)||void 0===o?void 0:o.color)??"green",maxValue:"percent"===e.numberFormat?1:(null===(i=e.showAs)||void 0===i?void 0:i.maxValue)??100,showValue:(null===(r=e.showAs)||void 0===r?void 0:r.showValue)??!0}),[u,g]=s.useState(d.maxValue.toString()),h=c.blueColor,v=c.regularDividerColor,b={boxSizing:"content-box",height:36,flex:1,margin:1,boxShadow:`0 0 0 1px ${c.regularDividerColor}`,color:c.mediumTextColor,borderRadius:3,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",paddingLeft:12,paddingRight:12,paddingTop:6,paddingBottom:6,cursor:"pointer"},S={boxShadow:`0 0 0 2px ${c.blueColor}`,color:c.blueColor},w={height:20,marginBottom:4,width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},k={lineHeight:1,fontSize:12},C=[{key:"number",visual:a()("div",{style:{fontSize:16,fontWeight:we.Z.fontWeight.medium}},void 0,"42"),text:a()(y.FormattedMessage,{defaultMessage:"Number",id:"database.viewSettings.numberOptions.showAsNumber",description:"Select whether a number should be shown simply as a number"})},{key:"bar",visual:a()(_e.k,{percentage:50,filledColor:"bar"===(null==d?void 0:d.type)?h:v,unfilledColor:"bar"===(null==d?void 0:d.type)?c.accentColors.blue[50]:c.regularDividerColor,style:{width:"100%"}}),text:a()(y.FormattedMessage,{defaultMessage:"Bar",id:"database.viewSettings.numberOptions.showAsBar",description:"Select whether a number should be shown as a progress bar"})},{key:"ring",visual:a()(Me.e,{size:20,percentage:40,filledColor:"ring"===(null==d?void 0:d.type)?h:v,unfilledColor:"ring"===(null==d?void 0:d.type)?c.accentColors.blue[50]:c.accentColors.gray[100],style:{width:"100%"}}),text:a()(y.FormattedMessage,{defaultMessage:"Ring",id:"database.viewSettings.numberOptions.showAsRing",description:"Select whether a number should be shown as a ring"})}],_=a()("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginLeft:16,marginRight:16,marginTop:6,gap:12}},void 0,C.map((t=>{const o=((null==d?void 0:d.type)??"number")===t.key;return a()(ke.Z,{onClick:()=>{const o="number"===t.key?void 0:{...d,type:t.key};p((e=>({...e,type:t.key}))),e.onChange(o)},style:{...b,...o?S:{}}},void 0,a()("div",{style:w},void 0,t.visual),a()("div",{style:k},void 0,t.text))}))),M={display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:16,paddingRight:16,gap:16,height:28,width:"100%"},T=t=>{const o="number"===d.type?void 0:{type:d.type,color:d.color,maxValue:d.maxValue,showValue:d.showValue,...t};p((e=>({...e,...t}))),e.onChange(o)},I="number"!==d.type&&a()("div",{style:M},void 0,a()("div",{style:{flex:6,fontSize:14}},void 0,a()(y.FormattedMessage,{defaultMessage:"Color",id:"database.viewSettings.numberOptions.color",description:"Pick color for number property when shown as bar/ring"})),a()("div",{style:{display:"flex",flexWrap:"wrap",flex:6,gap:7}},void 0,a()(le.Z,{popupType:l.device.isMobile?le.Z.PopupType.SlideUp:le.Z.PopupType.Popup,renderOrigin:e=>s.createElement("div",n()({style:{width:"100%",display:"flex",justifyContent:"end"}},e),a()(Pe.Z,{color:d.color,focused:!1,buttonStyle:{width:"auto",marginLeft:0,marginRight:0,borderRadius:3,color:c.lightTextColor},style:{minHeight:36},right:f.Z.chevronDown({width:12,height:12})})),render:e=>{const t=m.AP.map((t=>a()(Pe.Z,{color:t,checkState:t===d.color,focused:!1,style:{width:"100%"},onClick:()=>{T({color:t}),e.close()}})));return a()("div",{style:{minWidth:150,paddingTop:8,paddingBottom:8}},void 0,t)}}))),P="number"!==d.type&&"percent"!==e.numberFormat&&a()("div",{style:M},void 0,a()("div",{style:{flex:6,fontSize:14}},void 0,a()(y.FormattedMessage,{defaultMessage:"Divide by",id:"database.viewSettings.numberOptions.divideBy",description:"Divide the value by this number for number property when shown as bar/ring"})),a()("div",{style:{flex:6}},void 0,a()(Ce.Z,{value:u,onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,"");g(t);const o=parseFloat(t);!isNaN(o)&&o>0&&T({maxValue:o})},inputStyle:{textAlign:"right"}}))),x="number"!==d.type&&a()("div",{style:M},void 0,a()("div",{style:{flex:6,fontSize:14}},void 0,a()(y.FormattedMessage,{defaultMessage:"Show number",id:"database.viewSettings.numberOptions.showValue",description:"Show the number value for number property when shown as bar/ring"})),a()("div",{style:{flex:6,display:"flex",justifyContent:"flex-end"}},void 0,a()(Te.Z,{on:d.showValue,onClick:()=>{T({showValue:!d.showValue})},disabled:!1}))),B=Boolean(I||P||x),Z=a()("div",{style:{backgroundColor:c.accentColors.gray[30],borderRadius:5,marginTop:B?12:0,marginLeft:B?14:0,marginRight:B?14:0,paddingTop:B?12:0,paddingBottom:B?12:0,maxHeight:B?1e3:0,transition:"max-height 0.5s ease-in-out",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",gap:8}},void 0,I,P,x);return a()(q.Z,{title:a()(y.FormattedMessage,{defaultMessage:"Show as",id:"database.viewSettings.numberPercentOptions.showAs",description:"Number property when format is percentage, can be shown with progress"}),topBorder:!0,disableMobileBorders:!0},void 0,_,Z,a()("div",{style:{marginTop:12,marginLeft:18,marginRight:18,fontSize:12,color:c.lightTextColor}},void 0,a()(y.FormattedMessage,{id:"database.CollectionSettings.NumberOptions.applyAllViews",defaultMessage:"Changes apply to all views showing this property.",description:"Message when number property showAs option is changed"})))}function Be(e){const t=(0,z.O7)(),o=(0,y.useIntl)(),i=(0,W.qz)(void 0,F.Z),r=(0,W.VK)((()=>{var t;const{collectionContextStore:o,property:i}=e,n=o.normalizedSchemaStore.state[i];if(n)return"number"===n.type||"formula"===n.type&&"number"===(null===(t=n.formula)||void 0===t?void 0:t.result_type)||"rollup"===n.type&&n.aggregation&&void 0!==(0,T.SD)(n.aggregation,void 0)?n:void 0}),[e]),l=(0,W.VK)((()=>{if("rollup"===(null==r?void 0:r.type)){if(!r.aggregation)return;const t=e.collectionContextStore.collectionStore();if(!t)return;const o=(0,be.gT)({property:e.property,schema:e.collectionContextStore.normalizedSchemaStore.state,getRecordValue:t.getRecordValue});if(!o)return;const{targetPropertySchema:i}=o;return(0,T.SD)(r.aggregation,"number"===i.type||"formula"===i.type?i.number_format:void 0)}return(null==r?void 0:r.number_format)??Se.dk}),[e.collectionContextStore,e.property,r]),c=o=>{const{collectionContextStore:i,property:n}=e,a=i.collectionStore();a&&r&&(_.createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:t,perform:e=>{k.xO({environment:t,collectionStore:a,update:{[n]:{...r,show_as:o}},transaction:e})}}),b.$q({environment:t,collectionContextStore:i,property:n,from:"view_settings",action:"number_change_show_as",number_show_as:(null==o?void 0:o.type)??"number"}))},d=t=>{const{collectionContextStore:o,property:i}=e,n=o.collectionStore(),r=o.normalizedSchemaStore.state;if(n)return a()(Ie.Z,{collectionStore:n,property:i,schema:r,onClose:t.close})};if(!r)return null;if(!l)return null;const p=((e,r)=>{const{device:l}=t;if("rollup"===e.type)return;const c=Se.dX.find((e=>e===r))??Se.dk;return a()(le.Z,{popupType:l.isMobile?ce.kQ.SlideUp:ce.kQ.Popup,alignmentToOrigin:le.Z.Alignment.End,renderOrigin:e=>s.createElement(se.Z,n()({title:a()(y.FormattedMessage,{defaultMessage:"Number format",id:"database.viewSettings.numberOptions.numberFormat"}),right:a()("span",{style:{...we.Z.textOverflowStyle}},void 0,(0,Se.Bo)(o,c)),showChevron:!0,rotateChevron:i.state.open},e)),render:d,buttonPopupStore:i})})(r,l),u=((e,t,o)=>a()(xe,{numberFormat:t,showAs:o,onChange:c},e))("rollup"===r.type?r.aggregation&&(0,ye.gu)(r.aggregation):r.number_format,l,r.show_as);return s.createElement(s.Fragment,null,p,u)}var Ze=o(31869),Ee=o(29376),Re=o(80072),Ae=o(79892);function De(e){const{collectionContextStore:t,property:o}=e,i=(0,z.O7)(),n=(0,y.useIntl)(),[r,l]=(0,s.useState)(void 0),c=(0,W.VK)((()=>t.collectionStore()),[t]),d=(0,W.VK)((()=>t.normalizedSchemaStore.state),[t]),u=(0,W.VK)((()=>Ee.KV(t,o)),[t,o]),m=u&&(0,p.NK)(u)?u.connectedRelation:void 0,g=(0,W.VK)((()=>function(e,t){if("relation"!==(null==t?void 0:t.type))return;const o=null==t?void 0:t.collection_pointer;return o&&e?N.NW.createChildStore(e,o):void 0}(t.collectionViewBlockStore(),u)),[t,u]),h=Boolean(g&&(null==c?void 0:c.id)===g.id),f=(0,W.VK)((()=>Boolean(g&&(null==u?void 0:u.name)===Ee.m8(n,{targetCollectionStore:g,isSelfRelation:h,sourceSchema:d,createUnique:!1}))),[u,n,g,h,d]),v=(0,W.VK)((()=>t.contextType),[t]),S=(0,s.useCallback)((()=>{if(!r)return;const{hasInverseRelation:e,inverseName:a,autoRelate:s}=r;_.createAndCommit({userAction:"CollectionSettingsRelationOptions.handleEditRelation",environment:i,perform:r=>{Ze.gy({environment:i,collectionContextStore:t,property:o,hasInverseRelation:e,inverseName:a,autoRelate:s,intl:n,transaction:r})}}),b.$q({environment:i,collectionContextStore:t,property:o,from:"collectionPage"===v?"page_properties":"view_settings",action:"relation_edit",is_self_relation:h,has_inverse:e,auto_relate:null==s?void 0:s.enabled}),l(void 0)}),[r,i,t,o,v,h,n]);return g?s.createElement(s.Fragment,null,a()(Ae.Z,{isSelfRelation:h,collectionStore:g,showAs:"link",disabled:!0}),u&&a()(ge.C,{collectionContextStore:t,propertySchema:u,property:o}),!Boolean(m)&&a()(Re.Z,{collectionContextStore:t,targetCollectionStore:g,property:o,buttonContents:a()(y.FormattedMessage,{defaultMessage:"Update relation",id:"database.viewSettings.editRelation.updateButton.title",description:"Button label to save edits to database relation property"}),temporaryInverseState:r,setTemporaryInverseState:l,isInitialPropertyName:f,onSubmit:S})):null}var Fe=o(71644),Le=o(47307),Ve=o(84619),Ne=o(25464),Oe=o(73456),Ue=o(22084);class He extends c.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:F.Z},this.handleClick=()=>{const{buttonPopupStore:e}=this.stores;e.setState({open:!0})},this.handleChange=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore();o&&k.HW({environment:this.environment,collectionStore:o,performTransaction:t=>{for(const i of e)_.applyOperation({store:(0,N.Kv)(o,i.pointer),operation:i,transaction:t})}})},this.handleClose=()=>{const{buttonPopupStore:e}=this.stores;e.setState({open:!1})}}renderComponent(){const{value:e,property:t,collectionContextStore:o,statusGroup:i,isDefault:n,disabled:r}=this.props,s=o.normalizedSchemaStore.state,l=o.collectionStore(),c=s[t],{buttonPopupStore:d}=this.stores;if(!c||!(0,p.cu)(c)&&"status"!==c.type||!l)return;const m=c.options||[],g=m.find((t=>t.value===e));if(!g)return;let h;return"status"===c.type&&(h=(c.groups??[]).find((e=>{var t;return null==e||null===(t=e.optionIds)||void 0===t?void 0:t.includes(g.id)}))),a()(Oe.Z,{open:d.state.open,origin:a()(se.Z,{showDragHandle:!0,showChevron:!0,disabled:r,rotateChevron:d.state.open,title:a()(Ue.Z,{format:this.environment.device.isMobile?Ve.l.Large:Ve.l.Medium,value:g.value,options:m,showRemoveButton:!1,isSingle:!0,isRound:"status"===c.type,showColoredDot:"status"===c.type?(0,u.JR)(g,h):void 0}),right:n?a()("span",{style:{fontSize:12,fontWeight:500}},void 0,"DEFAULT"):void 0,onClick:this.handleClick}),id:g.id,value:g.value,property:t,statusGroup:i,collectionId:l.id,schema:s,analyticsFrom:"view_settings",alignmentToOrigin:Ne.v.End,onChange:this.handleChange,onClose:this.handleClose})}}He.displayName="CollectionSettingsSelectOptionRow";const ze=(0,y.injectIntl)(He);var We=o(97180),je=o(52275),Ke=o(79131),Ye=o(73063),Ge=o(3386);class Xe extends c.Z{constructor(){super(...arguments),this.storeTypes={inputStore:V.Z,inputGroupIndexState:O.default.of(void 0)},this.handleNewOptionClick=e=>{this.stores.inputStore.setState({focus:!0,inputValue:""}),void 0!==e&&this.stores.inputGroupIndexState.set(e)},this.handleInputChange=e=>{const t=e.target.value.replace(/,/g,"");this.stores.inputStore.setState({focus:!0,inputValue:t})},this.handleInputBlur=()=>{this.stores.inputStore.setState({focus:!1,inputValue:""})},this.handleInputSubmit=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.collectionStore(),i=this.getPropertySchema();if(!i||!o)return;const n=i.options||[],r=this.stores.inputStore.state.inputValue;if(r){let e=(0,p.TL)(n);if("status"===i.type){var a;const t=null===(a=this.stores.inputGroupIndexState)||void 0===a?void 0:a.get();if(void 0!==t){var s,l;const o=null===(s=i.groups)||void 0===s||null===(l=s[t])||void 0===l?void 0:l.color;o&&(e=o)}}if(n.find((e=>e.value===r)))return Le.showErrorMessage(this.renderOptionAlreadyExistsMessage()),void this.handleInputBlur();const d={id:(0,Fe.ZP)(),value:r,color:e},u={pointer:o.pointer,command:"keyedObjectListBefore",path:["schema",t,"options"],args:{value:d}};let m;if("status"===i.type){var c;const e=null===(c=this.stores.inputGroupIndexState)||void 0===c?void 0:c.get();void 0!==e&&(m={pointer:o.pointer,command:"listBefore",path:["schema",t,"groups",e,"optionIds"],args:{id:d.id}})}k.HW({environment:this.environment,collectionStore:o,performTransaction:e=>{_.applyOperation({store:(0,N.Kv)(o,u.pointer),operation:u,transaction:e}),m&&_.applyOperation({store:(0,N.Kv)(o,m.pointer),operation:m,transaction:e})}})}this.stores.inputStore.setState({focus:!0,inputValue:""}),b.$q({environment:this.environment,collectionContextStore:e,property:t,from:"view_settings",action:"select_add_option"})},this.handleSelectDraggableListDrop=e=>{const{property:t,collectionContextStore:o}=this.props,i=o.normalizedSchemaStore.state,n=o.collectionStore();if(!n)return;const r=i[t];let a;if("status"===(null==r?void 0:r.type)){a=[[]];for(const t of e)t.startsWith("group-header-")?a.push([]):a[a.length-1].push(t)}else a=e;const s=(0,P.YL)({newOptions:a,collectionId:n.id,property:t,schema:i});s&&k.HW({environment:this.environment,collectionStore:n,performTransaction:e=>{for(const t of s)_.applyOperation({store:(0,N.Kv)(n,t.pointer),operation:t,transaction:e})}}),b.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"select_options_reorder"})}}renderComponent(){var e,t;const{collectionContextStore:o,property:i,disabled:n}=this.props,r=null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema(),l=null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri,c=this.getPropertySchema();if(!r||!c)return;const{inputStore:d,inputGroupIndexState:p}=this.stores,u=d.state,m=p.get();if("status"===c.type){const e=c.groups??[];if(0===e.length)return;const t=c.options??[],d=e.map((e=>{const o=t.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return{group:e,groupOptions:o}})),p=c.defaultOption,g=[...d[0].groupOptions.map((e=>e.value))];for(const{group:o,groupOptions:i}of d.slice(1))g.push({key:`group-header-${o.name}`,draggable:!1}),g.push(...i.map((e=>e.value)));const h=(0,M.Hw)(l,r,i)?{tooltipCaption:a()(y.FormattedMessage,{defaultMessage:"These options are core to the property and cannot be changed.",id:"database.viewSettings.selectOptions.disabledGroupMessage",description:"Explanation as to why the user can't change the status property options."})}:void 0,f=(r,l)=>{if(r.startsWith("group-header-")){const e=r.substring("group-header-".length),t=d.findIndex((t=>{let{group:o}=t;return o.name===e})),{group:o,groupOptions:i}=d[t];return this.renderSectionHeader(a()(We.r,{disableGroup:h,group:o,showIcon:!1}),!u.focus&&this.renderNewOptionButton((()=>this.handleNewOptionClick(t))),s.createElement(s.Fragment,null,m===t&&this.renderNewOptionInput(),!u.focus&&0===i.length&&this.renderNewOptionItem(t)),n)}{const s=t.find((e=>e.value===r));if(!s)return;const l=e.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(s.id)}));return a()(ze,{value:s.value,property:i,isDefault:s.value===p,statusGroup:l,collectionContextStore:o,disabled:n},s.value)}};return[this.renderSectionHeader(a()(We.r,{disableGroup:h,group:d[0].group}),!u.focus&&this.renderNewOptionButton((()=>this.handleNewOptionClick(0))),s.createElement(s.Fragment,null,0===m&&this.renderNewOptionInput(),!u.focus&&0===d[0].groupOptions.length&&this.renderNewOptionItem(0)),n),a()(Ke.ZP,{direction:"vertical",keys:g,renderKey:f,onDrop:this.handleSelectDraggableListDrop,disabled:n})]}{const e=c.options??[],t=e.map((e=>e.value));return[this.renderSectionHeader(a()(y.FormattedMessage,{defaultMessage:"Options",id:"database.viewSettings.selectOptions.title"}),!u.focus&&t.length>0&&this.renderNewOptionButton((()=>this.handleNewOptionClick())),this.renderNewOptionInput(),n),t.length>0&&a()(Ke.ZP,{direction:"vertical",keys:t,renderKey:t=>{const r=e.find((e=>e.value===t));if(r)return a()(ze,{value:r.value,property:i,isDefault:!1,statusGroup:void 0,collectionContextStore:o,disabled:n},r.value)},onDrop:this.handleSelectDraggableListDrop}),!u.focus&&0===t.length&&this.renderNewOptionItem()]}}renderSectionHeader(e,t,o,i){return a()(q.Z,{topBorder:!0,title:e,desktopTitleStyle:{height:20},right:!i&&t,style:{width:"100%",paddingBottom:0}},void 0,!i&&o)}renderNewOptionInput(){const{inputStore:e}=this.stores,t=e.state;if(t.focus)return a()(Ge.Z,{capture:!0,onEsc:this.handleInputBlur},void 0,a()(X.ZP,{value:t.inputValue,focus:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Type a new option…",id:"database.viewSettings.selectOptions.newSelectOption.inputPlaceholder"}),style:{marginTop:2,marginBottom:8},onChange:this.handleInputChange,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit}))}renderNewOptionItem(e){return a()(je.Z,{icon:f.Z.plus({width:14}),focused:!1,title:a()(y.FormattedMessage,{defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.noOptions"}),style:{width:"100%"},onClick:()=>this.handleNewOptionClick(e)})}renderNewOptionButton(e){if(this.getPropertySchema())return a()(Ye.Z,{icon:f.Z.plus,onClick:e,style:{width:20,height:20}})}renderOptionAlreadyExistsMessage(){return a()(y.FormattedMessage,{defaultMessage:"Option already exists.",id:"database.optionExistsAlreadyError.message"})}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o&&((0,p.cu)(o)||"status"===o.type))return o}}Xe.displayName="CollectionSettingsSelectOptions";const qe=(0,y.injectIntl)(Xe),$e=(0,y.defineMessages)({statusShowAsLabel:{id:"database.viewSettings.statusOptions.showAs",defaultMessage:"Show as",description:"Status property can be shown as either checkbox or the select options"},statusCheckboxLabel:{id:"database.viewSettings.statusOptions.showAs.checkbox",defaultMessage:"Checkbox",description:"Option to show status value as checkbox"},statusSelectLabel:{id:"database.viewSettings.statusOptions.showAs.select",defaultMessage:"Select",description:"Option to show status value as select option"}});class Je extends c.Z{constructor(){super(...arguments),this.handleShowAsChange=e=>{const{collectionContextStore:t,property:o}=this.props,i=t.formatStore();if(!i)return;const n=t.getPropertyFormatKey();n&&(_.createAndCommit({userAction:"CollectionSettingsStatusOptions.handleShowAsChange",environment:this.environment,perform:t=>{S.er({formatStore:i,formatKey:n,property:o,update:{statusShowAs:e,visible:!0},transaction:t})}}),b.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"status_change_format"}))},this.iconStyle={width:16,height:16,fill:this.theme.mediumIconColor}}renderComponent(){var e;const{collectionContextStore:t,property:o,disabled:i}=this.props;if(!this.getPropertySchema())return;const n=[{key:"checkbox",title:Z.default.formatMessage($e.statusCheckboxLabel),icon:f.Z.typesCheckbox(this.iconStyle)},{key:"select",title:Z.default.formatMessage($e.statusSelectLabel),icon:f.Z.typesSelect(this.iconStyle)}],r=(null===(e=t.getPropertyFormat(o))||void 0===e?void 0:e.statusShowAs)??"select";return a()(oe.Z,{title:Z.default.formatMessage($e.statusShowAsLabel),selectedKey:r,popupStyle:{minWidth:190},options:n,onChange:e=>this.handleShowAsChange(e),disabled:i})}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o&&"status"===o.type)return o}}Je.displayName="CollectionSettingsStatusOptions";const Qe=(0,y.injectIntl)(Je);var et=o(79676),tt=o(32662),ot=o(58032),it=o(64369),nt=o(18145);const rt=(0,y.defineMessages)({inputPlaceholder:{defaultMessage:"Property name",id:"database.viewSettings.propertyTab.propertyName",description:"Placeholder text for property name input"},autofillOffLabel:{defaultMessage:"Off",id:"database.viewSettings.propertyTab.autofillOffLabel",description:"Label for autofill off"},keptUpToDateWithNotionAITooltip:{defaultMessage:"Kept up-to-date with Notion AI",id:"database.tableHeaderCell.tooltipAiAutofillDescription",description:"Tooltip text indicating that Notion AI is automatically updating this property"}});class at extends c.Z{constructor(){super(...arguments),this.storeTypes={inputStore:O.default.of(""),propertyTypeButtonPopupStore:F.Z,newSelectOptionInputStore:V.Z},this.renderAutoIncrementId=()=>{const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"auto_increment_id"===o.type){var i;const n=null===(i=e.collectionStore())||void 0===i?void 0:i.getRecordKeyStore(),r=null==n?void 0:n.getRecordKey();return a()(U.Z,{uniqueIdProperty:{propertyId:t,propertySchema:o},prefixValue:r,collectionContextStore:e})}},this.renderLearnAboutRelationsMenuItem=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];let i;return i=(0,u.Kp)(o)?a()(me.Z,{href:(0,E.UY)("guides.githubRelation"),title:a()(y.FormattedMessage,{defaultMessage:"Learn about GitHub Pull Requests",id:"database.viewSettings.propertyTab.githubPrRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_github_pr_relation"}):a()(me.Z,{href:(0,E.UY)("guides.relations"),title:a()(y.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"}),a()(q.Z,{topBorder:!0},void 0,i)},this.handlePropertyTypeClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=this.getPropertySchema(),i=t.collectionStore();i&&w.H4({collectionSettingsStore:e,item:{type:"propertyType",propertySchema:o,propertyTypes:(0,I.TP)({isSyncedCollection:i.isSyncedCollection(),collectionContextStore:t}),onAccept:this.handlePropertyTypeAccept}})},this.handleAiAutofillClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t,property:o}=this.props,i=this.getPropertySchema();t.collectionStore()&&i&&w.H4({collectionSettingsStore:e,item:{type:"propertyAiAutofill",propertySchema:i,property:o}})},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,i=this.getCollectionStore();if(!i)return;const n=i.getSchema()[t];n&&n.name!==e&&(_.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyNameSubmit",environment:this.environment,perform:o=>{S.Bv({collectionStore:i,property:t,name:e,transaction:o})}}),b.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.handlePropertyIconSubmit=e=>{const{property:t,collectionContextStore:o}=this.props,i=this.getCollectionStore();i&&(_.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyIconSubmit",environment:this.environment,perform:o=>{S.OK({collectionStore:i,property:t,icon:e,transaction:o})}}),b.$q({environment:this.environment,collectionContextStore:o,property:t,icon:e,from:"view_settings",action:"change_icon"}))},this.handleToggleVisibilityClick=()=>{const{collectionContextStore:e,formatKey:t}=this.props,o=this.getPropertyFormat(),i=e.collectionViewStore(),n=this.getPropertySchema();if(!n)return;if(!(o&&i&&t&&n))return;const r=this.getPropertyFormats().map((e=>e.property===o.property?{...o,visible:!o.visible}:e));_.createAndCommit({userAction:"CollectionSettingsProperty.handleToggleVisibilityClick",environment:this.environment,perform:e=>{C.FH({stores:[i],update:{[t]:r},transaction:e})}}),b.wd({environment:this.environment,collectionContextStore:e,action:"toggle_property_visibility",original_view_type:i.getType(),property_type:n.type})},this.handleDuplicateClick=async()=>{const{property:e,collectionContextStore:t,collectionSettingsStore:o,formatKey:i,collectionPointer:n}=this.props,r=this.getPropertyFormats(),a=this.getSchema(),s=this.getCollectionStore(),l=t.collectionViewStore(),c=null==s?void 0:s.getSpaceId();if(!s||!c)return;const d=this.getPropertySchema();if(!d)return;const p=await(0,P.xy)({environment:this.environment,schema:a,property:e,properties:r,parentStore:s,spaceId:c});p&&(_.createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:this.environment,perform:e=>{k.xO({environment:this.environment,collectionStore:s,update:{[p.newProperty]:p.newPropertySchema},transaction:e}),p.automationUpdate&&k.Ki({environment:this.environment,collectionStore:s,update:p.automationUpdate,transaction:e}),i&&l&&C.FH({stores:[l],update:{[i]:p.newProperties},transaction:e})}}),w.FK({collectionSettingsStore:o,item:{type:"property",property:p.newProperty,formatKey:i,collectionPointer:n}}),b.wd({environment:this.environment,collectionContextStore:t,action:"duplicate_property",original_view_type:null==l?void 0:l.getType(),property_type:d.type}))},this.handleDeleteClick=async()=>{const{collectionContextStore:e,property:t}=this.props;await S.TI({environment:this.environment,collectionContextStore:e,property:t,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme})},this.handleDeleteAccept=()=>{const{property:e,collectionContextStore:t,collectionSettingsStore:o}=this.props,i=this.getPropertySchema(),n=this.getSchema(),r=this.getCollectionStore();b.wd({environment:this.environment,collectionContextStore:t,action:"delete_property",property_type:null==i?void 0:i.type}),i&&(r&&_.createAndCommitAsync({environment:this.environment,userAction:"CollectionSettingsProperty.handleDeleteAccept",waitForServerCommit:!1,perform:t=>S.yV({environment:this.environment,collectionStore:r,schema:n,property:e,transaction:t})}),w.z$({collectionSettingsStore:o}),b.y9({environment:this.environment,collectionContextStore:t,property_type:i.type,from:"view_settings",property:e}))},this.handleRollupPropertyMenuChange=e=>{const{property:t}=this.props,o=this.getCollectionStore();o&&_.createAndCommit({userAction:"CollectionSettingsProperty.handleRollupPropertyMenuChange",environment:this.environment,perform:i=>{k.xO({environment:this.environment,collectionStore:o,update:{[t]:e.propertySchema},transaction:i})}})},this.handlePropertyTypeAccept=e=>{const{property:t,collectionContextStore:o,collectionSettingsStore:i,formatKey:n,collectionPointer:r}=this.props,a=this.getCollectionStore();a&&(b.$q({environment:this.environment,collectionContextStore:o,property:t,new_property_type:e,from:"view_settings",action:"change_type"}),"relation"===e?w.H4({collectionSettingsStore:i,item:{type:"selectRelationSource",property:t,formatKey:n,collectionPointer:r}}):(_.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:this.environment,perform:o=>{S.LC({environment:this.environment,collectionStore:a,property:t,type:e,transaction:o})}}),w.z$({collectionSettingsStore:i})),this.stores.propertyTypeButtonPopupStore.reset())}}didMount(){d.default.afterNextFlush((()=>{d.default.afterNextFlush((()=>{this.scrollTableCellIntoView()}))}))}renderComponent(){const{theme:e}=this,{property:t,collectionContextStore:o,selectNameInitial:i,formatKey:r}=this.props,l=this.getPropertySchema(),c=this.getPropertyFormat();if(!l)return;const d=o.collectionStore();if(!d)return;const m=r&&("title"!==t||(0,P.XO)({viewType:this.getCurrentViewType(),format:o.normalizedFormatStore.state})),v=d.getDatabaseType(),b=Boolean(v&&d.isTypedProperty(t)),S=Boolean(v&&M.cR(v,t,d)),w=!(0,u.Kp)(l),k=(0,u.sh)({propertySchema:l,isTypedProperty:b}),C=I.Tr.includes(l.type)&&!(0,p.dx)(l),_=I.Tr.includes(l.type),T=m||C||_,R="collectionViewBlock"===o.contextType;return s.createElement(he.ZP,n()({},this.props,{title:a()(y.FormattedMessage,{defaultMessage:"Edit property",id:"database.viewSettings.propertyTab.title"}),unconstrainedWidth:R}),a()(q.Z,{},void 0,a()(fe.Z,{initialValue:l.name||"",placeholder:Z.default.formatMessage(rt.inputPlaceholder),onBlur:this.handlePropertyNameSubmit,onSubmit:this.handlePropertyNameSubmit,focusInitial:i,selectAll:i,inputStore:this.stores.inputStore,inputOuterStyle:R?{background:e.contentBackground}:void 0,iconButton:{icon:t=>a()(g.ZP,{type:l.type,icon:l.icon,size:16,theme:e,style:t}),iconStyle:{fill:h.Lr[e.mode].gray},enforceIconColor:"gray",onSubmit:this.handlePropertyIconSubmit}}),this.shouldShowDuplicateError()&&a()(st,{propertyName:this.stores.inputStore.get()})),a()(q.Z,{},void 0,w&&this.renderPropertyTypeMenuItem(k,v),(0,x.Zt)(this.environment)&&this.renderAiAutofillMenuItem(),(0,p.cu)(l)&&this.renderSelectOptions(l),"status"===l.type&&this.renderStatusOptions(l),"formula"===l.type&&this.renderFormulaOptions(),"rollup"===l.type&&this.renderRollupOptions(),("date"===l.type||"created_time"===l.type||"last_edited_time"===l.type)&&this.renderDateOptions(),"relation"===l.type&&this.renderRelationOptions(),"person"===l.type&&this.renderPersonOptions(),this.renderNumberOptions(),"auto_increment_id"===l.type&&this.renderAutoIncrementId()),"button"===l.type&&this.renderButtonOptions(),T&&a()(q.Z,{topBorder:!0},void 0,m&&c&&(null!=c&&c.visible?a()(se.Z,{icon:f.Z.eyeHidePadded,isPadded:!0,title:a()(y.FormattedMessage,{defaultMessage:"Hide in view",id:"database.viewSettings.propertyTab.hideInViewButton.title"}),onClick:this.handleToggleVisibilityClick}):a()(se.Z,{icon:f.Z.eyePadded,isPadded:!0,title:a()(y.FormattedMessage,{defaultMessage:"Show in view",id:"database.viewSettings.propertyTab.showInViewButton.title"}),onClick:this.handleToggleVisibilityClick})),C&&a()(se.Z,{icon:f.Z.duplicate,title:a()(y.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.viewSettings.propertyTab.duplicateButton.title"}),onClick:this.handleDuplicateClick}),_&&a()(se.Z,{isRed:!0,disabled:S,onClick:this.handleDeleteClick,icon:()=>S?a()(ot.Z,{placement:ot.Z.Placement.Left,renderTooltip:e=>(0,B.A7)(v,e),render:e=>s.createElement("div",n()({},e,{style:{display:"inline-flex"}}),f.Z.lockedFilled({width:14,marginLeft:4,marginRight:4}))}):f.Z.trash({width:14,marginLeft:4,marginRight:4}),title:a()(y.FormattedMessage,{defaultMessage:"Delete property",id:"database.viewSettings.propertyTab.deleteButton.title"}),caption:this.environment.device.isMobile&&S?(0,B.A7)(v):null})),"formula"===l.type&&a()(q.Z,{topBorder:!0},void 0,a()(me.Z,{href:(0,E.UY)("guides.formulas"),title:a()(y.FormattedMessage,{defaultMessage:"Learn about formulas",id:"database.viewSettings.propertyTab.formulas.learnMoreButton.title"}),analyticsFrom:"view_settings_property_formula"})),"relation"===l.type&&this.renderLearnAboutRelationsMenuItem(),"rollup"===l.type&&a()(q.Z,{topBorder:!0},void 0,a()(me.Z,{href:(0,E.UY)("guides.relations"),title:a()(y.FormattedMessage,{defaultMessage:"Learn about rollups",id:"database.viewSettings.propertyTab.rollups.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})))}renderPropertyTypeMenuItem(e,t){const{propertyTypeButtonPopupStore:o}=this.stores,i=this.getPropertySchema();if(!i)return;const{theme:r}=this;return a()(se.Z,{disabled:e,rotateChevron:o.state.open,title:a()(y.FormattedMessage,{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"}),showChevron:!0,right:s.createElement(s.Fragment,null,e?a()(ot.Z,{placement:ot.Z.Placement.Bottom,render:e=>s.createElement("div",e,f.Z.lockedFilled({width:14,fill:r.regularIconColor})),renderTooltip:e=>s.createElement(y.FormattedMessage,n()({},e,{defaultMessage:"This type is required for this property in {databaseType}.",id:"database.viewSettings.propertyTab.restrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{databaseType:(0,B.r1)(t)}}))}):a()(g.ZP,{type:i.type,icon:void 0,size:16,theme:r}),a()(tt.Z,{size:4}),a()("span",{style:{color:e?r.darkTextColor:void 0}},void 0,I.SO[i.type])),onClick:this.handlePropertyTypeClick})}renderAiAutofillMenuItem(){var e,t,o;const i=this.getPropertySchema();if(!i||!(0,p.qQ)(i))return;let n;return"summarize"===(null===(e=i.ai_inference)||void 0===e?void 0:e.type)?n=x.Dr.autofillSummary:"extract"===(null===(t=i.ai_inference)||void 0===t?void 0:t.type)?n=x.Dr.autofillExtract:"custom"===(null===(o=i.ai_inference)||void 0===o?void 0:o.type)?n=x.Dr.autofillCustom:void 0===i.ai_inference?n=rt.autofillOffLabel:(0,v.t1)(i.ai_inference),a()(se.Z,{title:a()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,a()(y.FormattedMessage,{defaultMessage:"Set up fill with AI",id:"database.viewSettings.propertyTab.aiAutofill.open",description:"Menu item to set up this property to be filled and updated with Notion AI"}),a()(et.Z,{style:{display:"inline-block"}})),showChevron:!0,right:Z.default.formatMessage(n),onClick:this.handleAiAutofillClick})}renderSelectOptions(e){const{collectionContextStore:t,property:o}=this.props;return a()(qe,{collectionContextStore:t,property:o,disabled:!1})}renderStatusOptions(e){var t;const{collectionContextStore:o,property:i}=this.props,n=M.Hw(null===(t=o.collectionStore())||void 0===t?void 0:t.getDatabaseType(),o.normalizedSchemaStore.state,i);return s.createElement(s.Fragment,null,n?null:a()(Qe,{collectionContextStore:o,property:i,disabled:n}),a()(qe,{collectionContextStore:o,property:i,disabled:n}))}renderRollupOptions(){const{property:e}=this.props,t=this.getCollectionStore(),o=this.getSchema();if(!t)return;const i=Boolean(t.getDatabaseType()&&t.isTypedProperty(e));return a()(nt.Z,{disabled:i,context:nt.t.ViewSettings,property:e,schema:o,analyticsFrom:"view_settings",parentStore:t,onChange:this.handleRollupPropertyMenuChange})}renderFormulaOptions(){const{collectionContextStore:e,property:t}=this.props;return a()(ue,{collectionContextStore:e,property:t})}renderDateOptions(){const{collectionContextStore:e,property:t}=this.props;return a()(ne,{collectionContextStore:e,property:t})}renderNumberOptions(){var e;const{collectionContextStore:t,property:o}=this.props,i=this.getPropertySchema();if(i)return"number"===i.type||"formula"===i.type&&"number"===(null===(e=i.formula)||void 0===e?void 0:e.result_type)||"rollup"===i.type&&i.aggregation&&void 0!==(0,T.SD)(i.aggregation,void 0)?a()(Be,{collectionContextStore:t,property:o}):void 0}renderRelationOptions(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];return(0,u.Kp)(o)?a()(H.Z,{collectionContextStore:e,property:t}):a()(De,{collectionContextStore:e,property:t})}renderPersonOptions(){const e=this.renderLimitOptions(),t=(L.default.checkGate("default_person_property")||(0,A.i)())&&this.renderDefaultPersonPicker();return s.createElement(s.Fragment,null,e,t)}renderDefaultPersonPicker(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"person"===o.type)return a()(re,{collectionContextStore:e,propertySchema:o,property:t})}renderButtonOptions(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"button"===o.type)return a()($,{collectionContextStore:e,propertySchema:o,propertyId:t})}renderLimitOptions(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o)return a()(ge.C,{collectionContextStore:e,propertySchema:o,property:t})}getCollectionStore(){const{collectionContextStore:e,collectionPointer:t}=this.props,o=e.collectionViewBlockStore();if(o)return N.NW.createChildStore(o,t)}getSchema(){var e;return(null===(e=this.getCollectionStore())||void 0===e?void 0:e.getSchema())||{}}getPropertySchema(e){const t=e||this.props,{property:o}=t;return this.getSchema()[o]}getPropertyFormat(){const{property:e}=this.props,t=this.getPropertyFormats();return null==t?void 0:t.find((t=>t.property===e))}getPropertyFormats(){const{formatKey:e,collectionContextStore:t}=this.props;if(!e)return[];return t.normalizedFormatStore.state[e]||[]}shouldShowDuplicateError(){const{property:e}=this.props,{inputStore:t}=this.stores,o=this.getSchema(),i=t.get(),n=Object.keys(o).find((t=>{var n;return t!==e&&(null===(n=o[t])||void 0===n?void 0:n.name)===i}));return Boolean(n)}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}scrollTableCellIntoView(){const{property:e,collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o||"table"!==o.getType())return;const i=D.Z.findTableHeaderCell(t,e);if(!i)return;const n=l.findDOMNode(i),r=l.findDOMNode(this);if(!n||!r)return;const a=(0,R.xH)(n);if(!a)return;const s=r.getBoundingClientRect(),c=n.getBoundingClientRect().right+20-s.left;a.scrollLeft=a.scrollLeft+c}}function st(e){return window.__c={n:"DuplicatePropertyError"},a()(it.Z,{isMultiline:!0,style:{paddingTop:8,marginLeft:16,marginRight:16,color:m.ZP.red,...e.styles}},void 0,a()(y.FormattedMessage,{id:"database.viewSettings.propertyTab.duplicatePropertyNameError",defaultMessage:"A property named {propertyName} already exists in this database.",values:{propertyName:e.propertyName}}))}at.displayName="CollectionSettingsProperty";const lt=(0,y.injectIntl)(at)},61053:(e,t,o)=>{o.d(t,{Z:()=>I});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(43261),l=o.n(s),c=o(96486),d=o(67294),p=o(83355),u=o(6695),m=o(3779),g=o(5366),h=o(52821),f=o(33929),v=o(29798),y=o(12318),b=o(73657),S=o(52275),w=o(68894),k=o(9342),C=o(72495),_=o(69872);const M=(0,g.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"},none:{defaultMessage:"None",id:"database.viewSettings.propertySelect.noneMessage"},remove:{defaultMessage:"Remove",id:"database.viewSettings.propertySelect.removeMessage",description:"Menu option to remove a database property from a list."}});class T extends p.Z{constructor(){super(...arguments),this.storeTypes={inputStore:y.default.of(""),menuListStore:v.Z,showAllProperties:y.default.of(!1)}}renderComponent(){const{currentProperty:e,showNoneOption:t,showRemoveOption:o,getProperties:i,onAccept:r,intl:s,inputPlaceholder:p,defaultShowPropertyCount:v,schema:y,format:_}=this.props,{device:T}=this.environment,{inputStore:I,menuListStore:P}=this.stores,x=I.get(),B=(0,u.iB)(_,y,void 0,u.j5.Page).collection_page_properties||[],Z=!v||this.stores.showAllProperties.get(),E=s.formatMessage(M.none),R=t?{key:"none",render:t=>d.createElement(S.Z,a()({},t,{checkState:!e,title:E})),action:()=>{r(void 0)}}:void 0,A=o?{key:"remove",render:e=>d.createElement(S.Z,a()({},e,{icon:m.Z.trash({width:16,fill:this.theme.mediumTextColor,marginLeft:4,marginRight:2}),title:s.formatMessage(M.remove)})),action:()=>{r(void 0)}}:void 0,D=i();let F=c.sortBy(D,(e=>B.findIndex((t=>t.property===e))));if(x){const e=new Map;let t=F.map((t=>{const o=y[t],i=o?`${o.name} ${h.SO[o.type]}`:"";return e.set(t,i),i}));t=l().filter(x,t).map((e=>{let{original:t}=e;return t})),F=F.filter((o=>t.includes(e.get(o)||"")))}else!Z&&v&&(F=F.slice(0,v));const L=c.compact([!x||l().test(x,E)?R:void 0,...F.map((e=>this.renderPropertyMenuItem(e)))]);if(!Z&&D.length>F.length&&!x){const e={key:"show_more",render:e=>d.createElement(S.Z,a()({},e,{icon:m.Z.dots({width:16,fill:this.theme.mediumTextColor,marginLeft:4,marginRight:2}),style:{color:this.theme.mediumTextColor},title:n()(g.FormattedMessage,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:D.length-F.length}})})),action:()=>{this.stores.showAllProperties.set(!0)}};L.push(e)}const V=[];return(!A||L.length>0)&&V.push({key:"input",comp:n()(C.Z,{},void 0,n()(w.ZP,{focusInitial:!T.isMobile||void 0,focus:!T.isMobile||void 0,value:x,onChange:e=>{I.set(e.target.value),P.setState({...P.state,focus:{section:0,indexLocal:0,indexGlobal:0}}),this.stores.showAllProperties.set(!1)},placeholder:p||f.default.formatMessage(M.inputPlaceholder)}))}),(L.length>0||A)&&V.push({key:"properties",comp:n()(k.Z,{type:k.i.Vertical,initialFocus:0,sections:[...L.length>0?[{key:"results",render:e=>d.createElement(C.Z,e),items:L}]:[],...A?[{key:"remove",render:e=>d.createElement(C.Z,a()({topBorder:L.length>0},e)),items:[A]}]:[]],store:P})}),0!==L.length||A||V.push({key:"noResults",comp:n()(b.Z,{caption:n()(g.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})}),d.createElement(d.Fragment,null,V.map((e=>{let{key:t,comp:o}=e;return n()(d.Fragment,{},t,o)})))}renderPropertyMenuItem(e){const{schema:t,currentProperty:o,onAccept:i,renderProperty:n}=this.props,r=t[e];if(!r)return;return{key:e,render:t=>{const i=e===o;return n?n(t,e,i,r):d.createElement(_.Z,a()({},t,{propertySchema:r,format:_.Z.DisplayFormat.Name,checkState:i}))},action:()=>{i(e)}}}}T.displayName="CollectionSettingsPropertySelectMenu";const I=(0,g.injectIntl)(T)},79892:(e,t,o)=>{o.d(t,{Z:()=>f});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(24405),c=o(82990),d=o(5366),p=o(84210),u=o(42917),m=o(84076),g=o(31278),h=o(76798);function f(e){window.__c={n:"CollectionSettingsRelationTarget"};const{isSelfRelation:t,collectionStore:o,showAs:i,disabled:f,onClick:v}=e,y=(0,s.VK)((()=>Boolean(o)),[o]),b=(0,s.VK)((()=>null==o?void 0:o.getIcon()),[o]),S=(0,s.VK)((()=>{if(t)return;const e=null==o?void 0:o.getParentBlockStore();return e&&(0,p.ZP)({store:e})}),[o,t]),w=(0,a.Fy)(),k=(0,l.yK)((e=>({linkBox:{display:"flex",alignItems:"center"},linkTitle:{color:e.regularTextColor,fontWeight:c.Z.fontWeight.semibold,fontSize:14,marginLeft:4*(w.isRetina?.5:1),wordBreak:"break-word",...c.Z.textOverflowStyle},chevronTitle:{display:"inline",wordBreak:"break-word",...c.Z.textOverflowStyle}})),[w]),C=n()(g.Z,{icon:b,isEmptyPage:!1,size:20,disabled:!0});return n()(u.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.editRelation.targetLink.title",description:"Database view options menu title to configure relation property target database"}),showChevron:"chevron"===i,onClick:v,disabled:f,right:t?n()(d.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title",description:"Relation target value for a self relation"}):"link"===i&&S?n()(m.Z,{href:S,innerStyle:k.linkBox},void 0,C,n()(h.Z,{store:o,underline:!0,style:k.linkTitle,maxLength:15})):y?r.createElement(r.Fragment,null,C,n()(h.Z,{store:o,style:k.chevronTitle})):n()(d.FormattedMessage,{defaultMessage:"No target",id:"database.viewSettings.editRelation.noTarget.title",description:"Placeholder menu value when a relation property hasn't selected a target database."})})}},28398:(e,t,o)=>{o.d(t,{R1:()=>V,ep:()=>O,ZP:()=>U});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o(67294),c=o(83355),d=o(76205),p=o(3779),u=o(97880),m=o(82990),g=o(5366),h=o(77162),f=o(30610),v=o(5149),y=o(30149),b=o(93959),S=o(97004),w=o(60709),k=o(98742),C=o(61766),_=o(12318),M=o(42917),T=o(30016),I=o(52275),P=o(31945),x=o(73063),B=o(78140),Z=o(28992),E=o(9342),R=o(89728),A=o(44532),D=o(72495),F=o(58032),L=o(95691);let V;!function(e){e[e.FilterBar=0]="FilterBar",e[e.SettingsFilters=1]="SettingsFilters",e[e.SettingsSort=2]="SettingsSort"}(V||(V={}));class N extends c.Z{constructor(){super(...arguments),this.storeTypes={showMore:_.default.of(!1),moreActionsButtonPopupStore:C.Z},this.renderSaveActionsPopup=e=>{const{device:t}=this.environment;let o;o=t.isMobile?{menuType:w.og.ActionSheet}:{menuType:w.og.Popup,width:250};const i=s.compact([t.isPhone&&{key:"reset",render:e=>l.createElement(I.Z,a()({},e,{disabled:!1,title:this.renderResetMessage()})),action:()=>{this.handleReset(e)}},{key:"newView",render:e=>l.createElement(I.Z,a()({},e,{disabled:!1,title:this.renderSaveAsNewViewMessage()})),action:()=>{this.handleSaveAsNewViewClick(e)}},this.shouldShowMergeIntoAdvancedFilter()&&{key:"merge",render:e=>n()(F.Z,{placement:F.Z.Placement.Left,style:{maxWidth:240,whiteSpace:void 0},renderTooltip:()=>n()("div",{},void 0,n()(O,{})),render:t=>l.createElement(I.Z,a()({},(0,k.Z)(e,t),{disabled:!1,title:this.renderMergeIntoAdvancedFilterMessage()}))}),action:()=>{this.handleMergeIntoCombinatorFilter(e)}}]);return l.createElement(B.Z,o,n()(E.Z,{type:E.i.Vertical,sections:[{key:0,render:e=>l.createElement(D.Z,a()({enableActionSheetTitle:!0},e)),items:i}],initialFocus:0}))},this.handleSaveInCurrentViewClick=()=>{const{collectionContextStore:e,context:t}=this.props,o=e.collectionViewStore();o&&(h.wd({environment:this.environment,collectionContextStore:e,action:"click_save_control_save_in_current_view"}),y.createAndCommit({userAction:"CollectionSettingsSaveControl.handleSaveInCurrentViewClick",environment:this.environment,perform:i=>{f.Ys({environment:this.environment,type:t===V.FilterBar?f.mO.All:t===V.SettingsFilters?f.mO.Filters:f.mO.Sorts,collectionContextStore:e,targetCollectionView:o,transaction:i})}}),f.RD({environment:this.environment,seen:!0}))},this.handleSaveAsNewViewClick=e=>{const{collectionContextStore:t,intl:o}=this.props;h.wd({environment:this.environment,collectionContextStore:t,action:"click_save_control_save_as_new_view"}),y.createAndCommit({userAction:"CollectionSettingsSaveControl.handleSaveAsNewViewClick",environment:this.environment,perform:e=>{f.k7({environment:this.environment,collectionContextStore:t,transaction:e,intl:o})}}),null==e||e.close()},this.handleMergeIntoCombinatorFilter=e=>{const{collectionContextStore:t,context:o}=this.props,i=(0,S.Pi)(t),n=t.currentPropertyFiltersStore.state.filter((e=>(0,b.EE)(e.id)));f.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.get(),propertyFilters:{value:n},combinatorFilter:{value:i}}});const r=o===V.FilterBar?t.filterBarCombinatorFilterSettingsState:t.filterOptionsCombinatorFilterSettingsState;v.wl({collectionSettingsStore:r,item:{type:"filter"}}),h.wd({environment:this.environment,collectionContextStore:t,action:"merge_filter_into_combinator"}),null==e||e.close()},this.handleReset=e=>{const{collectionContextStore:t,context:o}=this.props;h.wd({environment:this.environment,collectionContextStore:t,action:"click_save_control_reset"});const i=t.temporaryState.get(),n=o===V.SettingsFilters?{...i,propertyFilters:void 0,combinatorFilter:void 0}:o===V.SettingsSort?{...i,sorts:void 0}:void 0;f._x({environment:this.environment,collectionContextStore:t,temporaryState:n}),f.RD({environment:this.environment,seen:!0}),null==e||e.close()},this.handleMoreOptionsClick=()=>{const{collectionContextStore:e}=this.props;h.wd({environment:this.environment,collectionContextStore:e,action:"click_save_control_more_options_button"}),this.stores.showMore.set(!0)},this.handleSaveActionsPopupClick=()=>{const{collectionContextStore:e}=this.props;h.wd({environment:this.environment,collectionContextStore:e,action:"click_save_control_more_options_popup"}),f.RD({environment:this.environment,seen:!0})},this.changeCount=this.createComputedStore((()=>{const{collectionContextStore:e,context:t}=this.props,o=e.localStateDiffStore.state;return t===V.SettingsFilters?(o.filters.moved.length>0?1:0)+o.filters.added.length+o.filters.removed.length+o.filters.updated.length:0}))}renderComponent(){const{context:e,collectionContextStore:t,showHoverActionsStore:o}=this.props,{showMore:i}=this.stores,{device:r}=this.environment,s=t.permissionScopes.state;if(e===V.FilterBar)return r.isPhone?s.canConfigureBlock?l.createElement(l.Fragment,null,n()(R.Z,{isOrange:!0,hovered:!0,style:{flexGrow:1,justifyContent:"center",height:32,marginRight:8,fontWeight:m.Z.fontWeight.semibold},onClick:this.handleSaveInCurrentViewClick},void 0,this.renderSaveMessage()),n()(P.Z,{popupType:this.environment.device.isMobile?A.kQ.SlideUp:A.kQ.Popup,render:this.renderSaveActionsPopup,originGap:4,onClick:this.handleSaveActionsPopupClick,buttonPopupStore:this.stores.moreActionsButtonPopupStore,renderOrigin:e=>l.createElement(x.Z,a()({style:{width:32,height:32},iconStyle:{width:16},hovered:!0,icon:p.Z.dots},e))})):l.createElement(l.Fragment,null,n()(R.Z,{style:{flexGrow:1,justifyContent:"center",height:32,marginRight:8,fontWeight:m.Z.fontWeight.semibold},hovered:!0,isGray:!0,onClick:()=>this.handleReset()},void 0,this.renderResetMessage())):n()(T.Z,{isVisible:t.isFullScreen.get()||!o||o.state,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>n()("div",{style:{display:"flex",alignItems:"center",paddingTop:4}},void 0,n()(R.Z,{isGray:!0,onClick:()=>this.handleReset(),style:{lineHeight:1.1,fontSize:r.isMobile?16:14}},void 0,this.renderResetMessage()),s.canConfigureBlock&&n()(P.Z,{popupType:this.environment.device.isMobile?A.kQ.SlideUp:A.kQ.Popup,render:this.renderSaveActionsPopup,originGap:4,onClick:this.handleSaveActionsPopupClick,buttonPopupStore:this.stores.moreActionsButtonPopupStore,renderOrigin:e=>n()(L.Z,{title:this.renderSaveMessage(),color:"orange",onClick:this.handleSaveInCurrentViewClick,dropdownEvents:e,style:{marginLeft:6,marginRight:r.isMobile?8:void 0,fontSize:r.isMobile?16:14,height:r.isMobile?30:26}})}))});if(e===V.SettingsFilters||e===V.SettingsSort){const t=e===V.SettingsFilters;return l.createElement(l.Fragment,null,i.state&&s.canConfigureBlock&&(r.isMobile?n()(Z.Z,{style:{fontSize:12,color:this.theme.mediumTextColor},title:this.renderSaveExplanationMessage()}):n()("div",{style:{fontSize:12,color:this.theme.mediumTextColor,paddingLeft:14,paddingRight:14,paddingTop:8,paddingBottom:8,maxWidth:220}},void 0,this.renderSaveExplanationMessage())),s.canConfigureBlock&&n()(M.Z,{icon:p.Z.save,isOrange:!0,title:this.renderSaveMessage(),onClick:this.handleSaveInCurrentViewClick}),n()(M.Z,{icon:p.Z.undo,isGray:!0,title:n()(g.FormattedMessage,t?{defaultMessage:"Reset filters",id:"database.viewSettings.filterAndSortSaveControl.resetFilters"}:{defaultMessage:"Reset sorts",id:"database.viewSettings.filterAndSortSaveControl.resetSorts"}),onClick:()=>this.handleReset()}),s.canConfigureBlock&&!i.state&&n()(M.Z,{icon:p.Z.dots,isGray:!0,title:n()(g.FormattedMessage,{defaultMessage:"More options",id:"database.viewSettings.filterAndSortSaveControl.more"}),onClick:this.handleMoreOptionsClick}),s.canConfigureBlock&&i.state&&l.createElement(l.Fragment,null,n()(M.Z,{icon:p.Z.copyPadded,isPadded:!0,isGray:!0,title:this.renderSaveAsNewViewMessage(),onClick:()=>{this.handleSaveAsNewViewClick()}}),this.shouldShowMergeIntoAdvancedFilter()&&n()(F.Z,{placement:F.Z.Placement.Left,style:{maxWidth:240,whiteSpace:void 0},renderTooltip:()=>n()("div",{},void 0,n()(O,{})),render:e=>l.createElement(M.Z,a()({icon:p.Z.filter,isGray:!0,title:this.renderMergeIntoAdvancedFilterMessage(),onClick:()=>{this.handleMergeIntoCombinatorFilter()}},e))})))}(0,u.t1)(e)}renderSaveExplanationMessage(){const{context:e}=this.props,t=e===V.SettingsFilters;return n()(g.FormattedMessage,t?{defaultMessage:"{count, plural, one {{count} filter changed from what other people see} other {{count} filters changed from what other people see}}",id:"database.viewSettings.filterAndSortSaveControl.filter.caption",values:{count:this.changeCount.state}}:{defaultMessage:"Sort has been changed from what other people see",id:"database.viewSettings.filterAndSortSaveControl.sort.caption"})}renderSaveAsNewViewMessage(){return n()(g.FormattedMessage,{defaultMessage:"Save as new view",id:"database.filterBar.changesControl.saveAsNewView.title"})}renderMergeIntoAdvancedFilterMessage(){return n()(g.FormattedMessage,{defaultMessage:"Merge into advanced filter",id:"database.filterBar.changesControl.mergeIntoAdvancedFilter.title"})}renderResetMessage(){return n()(g.FormattedMessage,{defaultMessage:"Reset",id:"database.filterBar.changesControl.reset.title"})}renderSaveMessage(){return n()(g.FormattedMessage,{defaultMessage:"Save for everyone",id:"database.filterBar.changesControl.saveForEveryone.title"})}shouldShowMergeIntoAdvancedFilter(){const{collectionContextStore:e,context:t}=this.props,o=e.currentPropertyFiltersStore.state;return(t===V.FilterBar||t===V.SettingsFilters)&&Boolean(o.find((e=>(0,d.aN)(e.filter))))}}function O(){return window.__c={n:"MergeIntoAdvancedFilterTooltipText"},n()(g.FormattedMessage,{id:"database.filterValue.mergeIntoAdvancedFilter.tooltip",defaultMessage:"Use an advanced filter to group filter rules and use AND/OR conditions.",description:"What it means to merge into an advanced filter"})}N.displayName="CollectionSettingsSaveControl";const U=(0,g.injectIntl)(N)},71846:(e,t,o)=>{o.d(t,{S:()=>I,Z:()=>B});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(6287),p=o(5366),u=o(77162),m=o(31299),g=o(33929),h=o(29798),f=o(3815),v=o(12318),y=o(73657),b=o(52275),S=o(68894),w=o(9342),k=o(11470),C=o(77137),_=o(72495),M=o(58032),T=o(78948);let I;!function(e){e[e.Source=0]="Source",e[e.Relation=1]="Relation",e[e.Automation=2]="Automation"}(I||(I={}));const P=(0,p.defineMessages)({linkedInputPlaceholder:{defaultMessage:"Link to a database…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder",description:"Placeholder text to search databases to link to"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a database…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder",description:"Placeholder text to search databases to link to or create a new database"},automationInputPlaceholder:{id:"automations.databasePicker.automationInputPlaceholder",defaultMessage:"Select a database…",description:"Select a database to add to."}});class x extends l.Z{constructor(){super(...arguments),this.storeTypes={inputStore:v.default.of(""),limitStore:v.default.of(5),menuListStore:h.Z},this.performSearchCollections=async e=>{const{query:t,limit:o}=e,{collectionContextStore:i,parentStore:n,requireEditPermissions:r}=this.props,a=null==i?void 0:i.collectionViewBlockStore(),s=await m.RT({environment:this.environment,collectionViewBlockStore:a,parentStore:n,query:t,limit:o,requireEditPermissions:r});return{results:s.results,showMore:Math.max(0,s.total-s.results.length)}}}renderComponent(){const{collectionContextStore:e,selectedCollectionStore:t,context:o,parentStore:i}=this.props,{device:r}=this.environment,{limitStore:l,inputStore:u,menuListStore:h}=this.stores,v=u.get(),M="linked"===(null==e?void 0:e.getCollectionViewBlockSourceState())||o===I.Relation?P.linkedInputPlaceholder:o===I.Source?P.linkedOrSourceInputPlaceholder:P.automationInputPlaceholder;return s.createElement(s.Fragment,null,a()(_.Z,{},void 0,a()(S.ZP,{focusInitial:!r.isMobile||void 0,value:v,onChange:e=>{u.set(e.target.value),l.set(e.target.value?20:5),h.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:g.default.formatMessage(M),showClearButton:!0})),a()(C.Z,{request:{query:v,limit:l.get()},performRequest:this.performSearchCollections,debounce:m.vp,render:(r,u,m)=>{if(!u)return a()(_.Z,{},void 0,a()(T.Z,{}));const{results:g,showMore:v}=u,S=g.map((r=>{const a=f.NW.createChildStore(i,{table:d.v,id:r});return{key:r,render:i=>{var l;return s.createElement(k.Z,n()({},i,{checkState:t&&t.id===r,store:a,right:o===I.Relation&&(null==e||null===(l=e.collectionStore())||void 0===l?void 0:l.id)===r&&this.renderSelfDatabaseIconTooltip()}))},action:()=>{this.handleAcceptExistingCollection(a)}}}));if(v>0){const e={key:"showMore",render:e=>s.createElement(b.Z,n()({},e,{buttonStyle:{color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},icon:c.Z.dots({width:16,height:16}),title:a()(p.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title",values:{showMore:Math.min(v,20)}})})),action:()=>{l.set(l.get()+20)}};S.push(e)}return s.createElement(s.Fragment,null,g.length>0&&a()(w.Z,{type:w.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>s.createElement(_.Z,e),items:S}],store:h}),0===g.length&&a()(y.Z,{caption:a()(p.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResultsTitle"})}))}}))}renderSelfDatabaseIconTooltip(){return a()(M.Z,{renderTooltip:()=>a()(p.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettigs.searchCollections.thisDatabase.tooltip",description:"Tooltip label when selecting relation source that is the current database"}),render:e=>s.createElement("div",e,c.Z.info({width:14,height:14}))})}handleAcceptExistingCollection(e){const{collectionContextStore:t}=this.props;t&&u.wd({environment:this.environment,collectionContextStore:t,action:"select_existing_collection"});const{onAccept:o}=this.props;o(e)}}x.displayName="CollectionSettingsSearchCollections";const B=(0,p.injectIntl)(x)},98421:(e,t,o)=>{o.d(t,{Z:()=>se,v:()=>ae});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o(67294),c=o(83355),d=o(6906),p=o(99036),u=o(39068),m=o(6695),g=o(89837),h=o(4615),f=o(5366),v=o(50906),y=o(77162),b=o(5149),S=o(64434),w=o(96802),k=o(5978),C=o(50125),_=o(30149),M=o(28020),T=o(40863),I=o(33929);const P=(0,f.defineMessages)({none:{defaultMessage:"None",id:"database.viewPropertiesMenu.coverFormat.none"},page_content:{defaultMessage:"Page content",id:"database.viewPropertiesMenu.coverFormat.pageContent"},page_cover:{defaultMessage:"Page cover",id:"database.viewPropertiesMenu.coverFormat.pageCover"}}),x=(0,f.defineMessages)({small:{defaultMessage:"Small",id:"database.viewPropertiesMenu.coverSize.small"},medium:{defaultMessage:"Medium",id:"database.viewPropertiesMenu.coverSize.medium"},large:{defaultMessage:"Large",id:"database.viewPropertiesMenu.coverSize.large"}}),B=function(e){return e?"page_content"===e.type?I.default.formatMessage(P.page_content):"page_cover"===e.type?I.default.formatMessage(P.page_cover):void 0:I.default.formatMessage(P.none)},Z=e=>{switch(e){case"small":return I.default.formatMessage(x.small);case"medium":return I.default.formatMessage(x.medium);case"large":return I.default.formatMessage(x.large)}};var E=o(92918),R=o(52821),A=o(48543),D=o(65742),F=o(78316),L=o(84210),V=o(60709),N=o(33665),O=o(79315),U=o(61766),H=o(36857),z=o(88923),W=o(12318),j=o(21269),K=o(42917),Y=o(13709),G=o(61053),X=o(75544),q=o(42922),$=o(64921),J=o(31945),Q=o(74194),ee=o(78140),te=o(44532),oe=o(72495),ie=o(86825);class ne extends c.Z{constructor(){super(...arguments),this.storeTypes={hoveredType:W.default.of(void 0),timelineByButtonPopupStore:U.Z,timelineByEndButtonPopupStore:U.Z,calendarByButtonPopupStore:U.Z},this.renderViewTypeButton=e=>{const{intl:t,collectionContextStore:o}=this.props,i=this.getCurrentViewType(),n=o.permissionScopes.state,r=i===e,s=r||!n.canConfigureBlock;return a()($.Z,{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"calc(33% - 12px)",flexGrow:0,flexShrink:0,fontSize:11,borderRadius:3,margin:6,padding:6,boxShadow:`0 0 0 1px ${this.theme.regularDividerColor}`,color:this.theme.mediumTextColor,fill:this.theme.mediumTextColor,...r&&{boxShadow:`0 0 0 2px ${this.theme.blueColor}`,color:this.theme.blueColor,fill:this.theme.blueColor,fontWeight:500}},disabled:s,onClick:()=>{_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderViewTypeButton",environment:this.environment,perform:i=>{S.z2({environment:this.environment,collectionContextStore:o,newViewType:e,transaction:i,intl:t})}}),y.wd({environment:this.environment,collectionContextStore:o,action:"change_type",original_view_type:i})},onMouseMove:()=>{this.stores.hoveredType.set(e)}},void 0,R.aW[e]({width:void 0,height:20,marginBottom:4,marginTop:4}),a()("div",{},void 0,R.Bh[e]))},this.handleCoverFormatChange=e=>{const{collectionContextStore:t}=this.props,o=this.getCoverFormatKey(),i=t.collectionViewStore();o&&i&&(_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverFormatChange",environment:this.environment,perform:t=>{w.FH({stores:[i],update:{[o]:e},transaction:t})}}),y.wd({environment:this.environment,collectionContextStore:t,action:"update_cover_format"}))},this.handleCoverSizeFormatChange=e=>{const{collectionContextStore:t}=this.props,o=this.getCoverSizeFormatKey(),i=t.collectionViewStore();o&&i&&(_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverSizeFormatChange",environment:this.environment,perform:t=>{w.FH({stores:[i],update:{[o]:e},transaction:t})}}),y.wd({environment:this.environment,collectionContextStore:t,action:"toggle_cover_size_format"}))},this.handleCoverAspectFormatToggle=()=>{const{collectionContextStore:e}=this.props,t=this.getCoverAspectFormatKey(),o=e.collectionViewStore(),i=e.normalizedFormatStore.state;t&&o&&(_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverAspectFormatToggle",environment:this.environment,perform:e=>{w.FH({stores:[o],update:{[t]:"contain"===i[t]?"cover":"contain"},transaction:e})}}),y.wd({environment:this.environment,collectionContextStore:e,action:"toggle_cover_aspect_format"}))},this.handleShowCollectionTitleClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return;const o=!e.shouldShowSource.state;_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleShowCollectionTitleClick",environment:this.environment,perform:e=>{w.FH({stores:[t],update:{hide_linked_collection_name:!o},transaction:e})}}),y.wd({environment:this.environment,collectionContextStore:e,action:"toggle_show_collection_title"})},this.handleTableWrapCellsToggle=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return;const o=Boolean(e.normalizedFormatStore.state.table_wrap);C.qY({environment:this.environment,collectionViewStore:t,currentValue:o}),v.trackConfigureView(this.environment,{view_type:this.getCurrentViewType(),action:"set_first_load_limit"}),y.wd({environment:this.environment,collectionContextStore:e,action:"toggle_table_wrap_cells"})},this.handleTableVerticalLinesToggle=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return;const o=Boolean(e.normalizedFormatStore.state.hide_table_vertical_lines);C.AU({environment:this.environment,collectionViewStore:t,currentValue:o}),y.wd({environment:this.environment,collectionContextStore:e,action:"toggle_table_vertical_lines"})},this.handleTimelineSeparateDatesClick=()=>{const{collectionContextStore:e}=this.props,t=e.normalizedQueryStore.state,o=e.collectionViewStore(),i=null==t?void 0:t.timeline_by,n=null==t?void 0:t.timeline_by_end;if(!i||!o)return;const r=n?void 0:i;_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleTimelineSeparateDatesClick",environment:this.environment,perform:e=>{S.Es({collectionViewStore:o,update:{timeline_by_end:r??null},transaction:e})}}),y.wd({environment:this.environment,collectionContextStore:e,action:"toggle_timeline_separate_dates"})},this.handleOpenPeekModePicker=()=>{y.nS({environment:this.environment,collectionContextStore:this.props.collectionContextStore,from:"collection_view_settings"})},this.handleCalendarViewRangeOptionClick=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o)return;const{serverCommitResult:i}=_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleViewRangeOptionClick",environment:this.environment,perform:t=>{w.FH({stores:[o],update:{calendar_view_range:e},transaction:t})}}),n=M.AK.state,r=t.dateRangeStart.get(),a=t.dateRangeEnd.get(),{newDateRangeStart:s,newDateRangeEnd:l}=this.getNewDateRange({oldCalendarEnd:a,newViewRange:e,startOfWeekSetting:n});S.t5({dateRangeStart:s,dateRangeEnd:l,collectionContextStore:t}),i.then((()=>{y.wd({environment:this.environment,collectionContextStore:t,action:"update_calendar_view_range"})})).catch((()=>{S.t5({dateRangeStart:r,dateRangeEnd:a,collectionContextStore:t})}))},this.handlePeekModeFormatClick=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(o&&e&&(_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handlePeekModeFormatClick",environment:this.environment,perform:t=>{w.FH({stores:[o],update:{collection_peek_mode:e},transaction:t})}}),y.gl({environment:this.environment,collectionContextStore:t,peek_mode:e,from:"collection_view_settings"}),z.default.state.open&&z.default.state.collectionContextStore===t)){const{mainEditorCurrentBlockStore:t}=O.default.state,o="full_page"===e?(0,L.ZP)({store:z.default.state.target,fullyQualified:!1}):(0,F.mb)({store:z.default.state.target,mainEditorCurrentBlockStore:t,collectionContextStore:z.default.state.collectionContextStore,fullyQualified:!1,overridePeekMode:(0,z.getPeekModeFromCollectionPeekModeFormat)(e)});o&&k.navigate({environment:this.environment,url:o})}},this.handleViewTypeAreaMouseLeave=()=>{this.stores.hoveredType.set(void 0)},this.handleDoneClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;b.wl({collectionSettingsStore:e,item:{type:"main"}}),y.wd({environment:this.environment,collectionContextStore:t,action:"click_create_view_done"})}}renderComponent(){const{collectionContextStore:e,showDoneButton:t}=this.props,{hoveredType:o}=this.stores,{device:i}=this.environment,n=e.normalizedQueryStore.state,r=e.normalizedSchemaStore.state,s=e.normalizedFormatStore.state,c=e.isFullScreen.get(),d=e.isRootChild.get(),u=this.getCurrentViewType(),m=Boolean(this.getCoverFormatKey()),g="table"===u,h="table"===u,v=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,p.Lt)(t)})),y="timeline"===u&&v.length>0,b="timeline"===u&&v.length>1,S="timeline"===u&&Boolean(null==n?void 0:n.timeline_by_end),w="calendar"===u&&v.length>0,k="calendar"===u,C="board"===u,_=(0,D.d$)({environment:this.environment,isFullScreen:c,isRootChild:d}),M="timeline"===u&&Boolean(s.timeline_show_table)&&_,T="timeline"===u&&_,I=e.collectionViewBlockStore();if(!I)return;const P=I.getCollectionViewSourceCollectionStore(),x=!("collectionTypedView"===e.contextType||P&&c),B=e.permissionScopes.state,Z="page"===u;return l.createElement(l.Fragment,null,a()(oe.Z,{topBorder:!1,shouldShowBottomDivider:i.isMobile},void 0,a()("div",{style:{...!i.isMobile&&{width:"100%",paddingLeft:8,paddingRight:8},...i.isMobile&&{background:this.theme.contentBackground,width:"100%",paddingTop:12,paddingBottom:12}},onMouseLeave:this.handleViewTypeAreaMouseLeave},void 0,a()("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"}},void 0,["table","board","timeline","calendar","list","gallery"].map(this.renderViewTypeButton)),a()("div",{style:{color:this.theme.lightTextColor,fontSize:12,margin:"6px 8px 0px 8px"}},void 0,R.sN[o.get()||u]))),a()(oe.Z,{},void 0,x&&a()(ie.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.layoutTab.showDatabaseTitle.title"}),focused:!1,on:e.shouldShowSource.state,onClick:this.handleShowCollectionTitleClick,disabled:!B.canConfigureBlock,textWrapperStyle:{opacity:1}}),m&&this.renderCardSettings(),h&&this.renderTableVerticalLinesSetting(),g&&this.renderTableWrapCellsSetting(),Z&&this.renderPageViewSetting(),y&&this.renderTimelineBySetting(),S&&this.renderTimelineEndSetting(),b&&this.renderTimelineSeparateDatesSetting(),w&&this.renderCalendarBySetting(),k&&this.renderCalendarViewRangeSetting(),T&&a()(X.N,{collectionContextStore:e}),M&&this.renderTimelineTableProperties(),C&&this.renderBoardGroupByShortcuts(),this.renderPeekModeSetting()),t&&a()(oe.Z,{disableMobileBorders:!0},void 0,a()(q.Z,{style:{display:"flex",margin:"0 14px"},onClick:this.handleDoneClick},void 0,a()(f.FormattedMessage,{defaultMessage:"Done",id:"database.viewSettings.createViewTab.doneButton.title"}))),a()(oe.Z,{topBorder:!1},void 0,a()(j.Z,{href:(0,N.UY)("guides.databaseView"),title:a()(f.FormattedMessage,{defaultMessage:"Learn about views",id:"database.viewSettings.layoutTab.learnMoreButton.title"}),analyticsFrom:"view_settings_layout"})))}renderCardSettings(){const{device:e}=this.environment,{collectionContextStore:t}=this.props,o=this.getCoverFormat(),i=this.getCoverSizeFormat(),n=!e.isMobile||"board"===this.getCurrentViewType(),r=t.permissionScopes.state;return l.createElement(l.Fragment,null,a()(Y.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Card preview",id:"database.viewSettings.layoutTab.cardPreviewButtonTitle"}),selectedKey:o,popupStyle:{minWidth:190},options:this.getCoverFormatOptions(),onChange:this.handleCoverFormatChange,disabled:!r.canConfigureBlock}),n&&a()(Y.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Card size",id:"databdatabase.viewSettings.layoutTab.cardSizeButtonTitle"}),selectedKey:i,popupStyle:{minWidth:190},options:this.getCoverSizeFormatOptions(),onChange:this.handleCoverSizeFormatChange,disabled:!r.canConfigureBlock}),o&&a()(ie.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Fit image",id:"databdatabase.viewSettings.layoutTab.fitImageButtonTitle"}),on:"contain"===this.getCoverAspectFormat(),focused:!1,onClick:this.handleCoverAspectFormatToggle,disabled:!r.canConfigureBlock,textWrapperStyle:{opacity:1}}))}getCoverFormatOptions(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state;let o=Object.keys(t);o=s.sortBy(o,(e=>{const o=t[e];return o?o.name:""}));const{theme:i}=this,n=s.compact(o.map((e=>{const o=t[e];if(o&&"file"===o.type){return{key:{type:"property",property:e},title:o.name,icon:a()(u.ZP,{type:o.type,icon:o.icon,size:this.environment.device.isMobile?16:14,theme:i,style:{fill:i.regularIconColor}})}}})));return[...[void 0,{type:"page_cover"},{type:"page_content"}].map((e=>({key:e,title:B(e)}))),...n]}getCoverSizeFormatOptions(){return["small","medium","large"].map((e=>({key:e,title:Z(e)})))}renderTableVerticalLinesSetting(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state;return a()(ie.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Show vertical lines",id:"database.viewSettings.layoutTab.tableShowVerticalLines",description:"Switch button for toggling vertical lines in table."}),on:!Boolean(e.normalizedFormatStore.state.hide_table_vertical_lines),focused:!1,onClick:this.handleTableVerticalLinesToggle,disabled:!t.canConfigureBlock,textWrapperStyle:{opacity:1}})}renderTableWrapCellsSetting(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=e.permissionScopes.state;return a()(ie.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Wrap all columns",id:"database.viewSettings.layoutTab.tableWrapAllColumns",description:"Switch button for toggling cell wrap for all columns in table."}),on:Boolean(t.table_wrap),focused:!1,onClick:this.handleTableWrapCellsToggle,disabled:!o.canConfigureBlock,textWrapperStyle:{opacity:1}})}renderPageViewSetting(){const e=this.props.collectionContextStore.collectionViewStore();if(e)return a()("div",{style:{padding:5}},void 0,a()(Q.Z,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{H.Z.setState({pageId:e.target.value})},onSubmit:t=>{const o=H.Z.state.pageId;o&&_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderPageViewSettings",environment:this.environment,perform:t=>{w.FH({stores:[e],update:{page_pointer:{id:(0,h.Mt)(o),spaceId:t.spaceId,table:"block"}},transaction:t})}})}}))}renderTimelineBySetting(){var e,t;const{device:o}=this.environment,{collectionContextStore:i}=this.props,r=null===(e=i.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by,s=null===(t=i.normalizedQueryStore.state)||void 0===t?void 0:t.timeline_by_end,c=i.normalizedSchemaStore.state,d=i.collectionViewStore(),u=i.permissionScopes.state,m=i.collectionStore();if(!r||!d||!m)return;const g=c[r];return g?a()(J.Z,{popupType:o.isPhone?te.kQ.SlideUp:te.kQ.Popup,alignmentToOrigin:J.Z.Alignment.End,placementToOrigin:J.Z.Placement.Bottom,originGap:0,renderOrigin:e=>l.createElement(K.Z,n()({title:a()(f.FormattedMessage,s?{defaultMessage:"Start date",id:"database.viewSettings.layoutTab.timelineStartDate.title"}:{defaultMessage:"Show timeline by",id:"database.viewSettings.layoutTab.showTimelineByProperty.title"}),disabled:!u.canConfigureBlock,showChevron:!0,right:g.name},e)),render:e=>{let t;return t=o.isPhone?{menuType:V.og.ActionSheet}:{menuType:V.og.Popup,width:300},l.createElement(ee.Z,t,a()(G.Z,{schema:m.getSchema(),format:m.getFormat(),currentProperty:r,getProperties:()=>Object.keys(c).filter((e=>{const t=c[e];return t&&(0,p.Lt)(t)})),onAccept:t=>{t&&(_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderTimelineBySetting",environment:this.environment,perform:e=>{S.Es({collectionViewStore:d,update:{timeline_by:t},transaction:e})}}),e.close(),y.wd({environment:this.environment,collectionContextStore:i,action:"update_timeline_by",original_view_type:void 0,property_type:g[t].type}))}}))}}):void 0}renderTimelineEndSetting(){var e;const{device:t}=this.environment,{collectionContextStore:o}=this.props,i=null===(e=o.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by_end,r=o.normalizedSchemaStore.state,s=o.permissionScopes.state,c=o.collectionViewStore(),d=o.collectionStore();if(!i||!c||!d)return;const u=r[i];return u?a()(J.Z,{popupType:t.isPhone?te.kQ.SlideUp:te.kQ.Popup,alignmentToOrigin:J.Z.Alignment.End,placementToOrigin:J.Z.Placement.Bottom,originGap:0,renderOrigin:e=>l.createElement(K.Z,n()({title:a()(f.FormattedMessage,{defaultMessage:"End date",id:"database.viewSettings.layoutTab.timelineEndDate.title"}),showChevron:!0,right:u.name,disabled:!s.canConfigureBlock},e)),render:e=>{let n;return n=t.isPhone?{menuType:V.og.ActionSheet}:{menuType:V.og.Popup,width:300},l.createElement(ee.Z,n,a()(G.Z,{schema:d.getSchema(),format:d.getFormat(),currentProperty:i,getProperties:()=>Object.keys(r).filter((e=>{const t=r[e];return t&&(0,p.Lt)(t)})),onAccept:t=>{t&&(_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderTimelineEndSetting",environment:this.environment,perform:e=>{S.Es({collectionViewStore:c,update:{timeline_by_end:t},transaction:e})}}),e.close(),y.wd({environment:this.environment,collectionContextStore:o,action:"update_timeline_by_end",original_view_type:void 0,property_type:u[t].type}))}}))}}):void 0}renderTimelineSeparateDatesSetting(){const{collectionContextStore:e}=this.props,t=e.normalizedQueryStore.state,o=null==t?void 0:t.timeline_by_end,i=e.permissionScopes.state;return a()(ie.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Separate start and end dates",id:"database.viewSettings.layoutTab.timelineUseSeparateDates.title"}),focused:!1,on:Boolean(o),onClick:this.handleTimelineSeparateDatesClick,disabled:!i.canConfigureBlock,textWrapperStyle:{opacity:1}})}renderCalendarViewRangeSetting(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,o=this.getCalendarViewRange();return a()(Y.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Show calendar as",id:"database.viewSettings.layoutTab.showCalendarAs.title",description:"Displayed name for the menu option which configures if you view the calendar as a week or as a month"}),collectionContextStore:e,openButtonPopup:"peekModeFormat"===e.settingsStore.state.openButtonPopup,selectedKey:o,popupStyle:{minWidth:190},options:re(),onChange:this.handleCalendarViewRangeOptionClick,disabled:!t.canConfigureBlock})}renderCalendarBySetting(){var e;const{device:t}=this.environment,{collectionContextStore:o}=this.props,i=null===(e=o.normalizedQueryStore.state)||void 0===e?void 0:e.calendar_by,r=o.permissionScopes.state,s=o.normalizedSchemaStore.state,c=o.collectionViewStore(),d=o.collectionStore();if(!i||!c||!d)return;const u=s[i];return u?a()(J.Z,{popupType:t.isPhone?te.kQ.SlideUp:te.kQ.Popup,alignmentToOrigin:J.Z.Alignment.End,placementToOrigin:J.Z.Placement.Bottom,originGap:0,renderOrigin:e=>l.createElement(K.Z,n()({title:a()(f.FormattedMessage,{defaultMessage:"Show calendar by",id:"database.viewSettings.layoutTab.showCalendarByProperty.title"}),disabled:!r.canConfigureBlock,showChevron:!0,right:u.name},e)),render:e=>{let n;return n=t.isPhone?{menuType:V.og.ActionSheet}:{menuType:V.og.Popup,width:300},l.createElement(ee.Z,n,a()(G.Z,{schema:d.getSchema(),format:d.getFormat(),currentProperty:i,getProperties:()=>Object.keys(s).filter((e=>{const t=s[e];return t&&(0,p.Lt)(t)})),onAccept:t=>{t&&(_.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderCalendarBySetting",environment:this.environment,perform:e=>{S.Es({collectionViewStore:c,update:{calendar_by:t},transaction:e})}}),e.close(),y.wd({environment:this.environment,collectionContextStore:o,action:"update_calendar_by",original_view_type:void 0,property_type:u[t].type}))}}))}}):void 0}renderTimelineTableProperties(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=this.getCurrentViewType(),i=(e.normalizedFormatStore.state[(0,m.oz)(o)]||[]).filter((e=>Boolean(e.visible))).length,n=e.permissionScopes.state;return a()(K.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Table properties",id:"database.viewSettings.layoutTab.tablePropertiesButton.title"}),showChevron:!0,right:a()(f.FormattedMessage,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.layoutTab.propertiesButton.propertiesShown.title",values:{propertiesShown:i}}),onClick:()=>{b.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"table"}}),y.wd({environment:this.environment,collectionContextStore:e,action:"click_timeline_table_properties"})},disabled:!n.canConfigureBlock})}renderBoardGroupByShortcuts(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.normalizedFormatStore.state.board_columns_by,i=e.normalizedSchemaStore.state;if(!o)return;const n=e.permissionScopes.state,r=i[o.property];return r?l.createElement(l.Fragment,null,a()(K.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Group by",id:"database.viewSettings.layoutTab.boardGroupByButton.title"}),showChevron:!0,right:r.name,onClick:()=>{b.H4({collectionSettingsStore:t,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}}),y.wd({environment:this.environment,collectionContextStore:e,action:"click_board_group_by",original_view_type:void 0,property_type:r.type})},disabled:!n.canConfigureBlock}),a()(ie.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Color columns",id:"database.viewSettings.groupTab.colorColumns"}),on:!(0,E.h6)(this.environment,e),focused:!1,onClick:()=>{b.iN({environment:this.environment,collectionContextStore:e})},disabled:!n.canConfigureBlock,textWrapperStyle:{opacity:1}})):void 0}renderPeekModeSetting(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,o=this.getPeekModeFormat();return a()(Y.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Open pages in",id:"database.viewSettings.layoutTab.peekModeTitle",description:"Displayed name for the menu option which configures how sub-pages of a collection open"}),collectionContextStore:e,openButtonPopup:"peekModeFormat"===e.settingsStore.state.openButtonPopup,selectedKey:o,popupStyle:{minWidth:190},options:ae({currentViewType:this.getCurrentViewType(),theme:this.theme}),menuItemOptionsStyle:{paddingTop:8,paddingBottom:8},onClick:this.handleOpenPeekModePicker,onChange:this.handlePeekModeFormatClick,disabled:!t.canConfigureBlock})}getNewDateRange(e){const{newViewRange:t,oldCalendarEnd:o,startOfWeekSetting:i}=e;if("month"===t){const e=(0,g.IS)((0,g.kl)(o),i);return{newDateRangeStart:e,newDateRangeEnd:(0,g.V7)((0,g._)({date:e,monthsToAdd:1}),i)}}{const e=(0,g.IS)(o,i);return{newDateRangeStart:e,newDateRangeEnd:(0,g.V7)(e,i)}}}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getCoverFormatKey(){return R.DL[this.getCurrentViewType()]}getCoverFormat(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=this.getCoverFormatKey();if(o&&t)return t[o]}getCoverSizeFormatKey(){return R.oy[this.getCurrentViewType()]}getCoverSizeFormat(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=this.getCoverSizeFormatKey();if(o&&t){const e=t[o];if(e)return e}return m.PZ}getPeekModeFormat(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=this.getCurrentViewType();return(null==t?void 0:t.collection_peek_mode)||A.Ls[o]}getCalendarViewRange(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state;return(null==t?void 0:t.calendar_view_range)||"month"}getCoverAspectFormatKey(){return R._Y[this.getCurrentViewType()]}getCoverAspectFormat(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=this.getCoverAspectFormatKey();if(o&&t)return t[o]}}function re(){return["month","week"].map((e=>({key:e,title:I.default.formatMessage(T.Lh[e])})))}function ae(e){const{currentViewType:t,theme:o}=e,i=t?A.Ls[t]:void 0;return["side_peek","center_peek","full_page"].map((e=>({key:e,title:(0,A.LQ)(e),body:l.createElement(l.Fragment,null,(0,A.RI)(e),i&&t&&e===i&&a()("div",{style:{marginTop:2,fontWeight:500,color:o.blueColor}},void 0,a()(f.FormattedMessage,{defaultMessage:"Default for {view}",id:"database.viewPropertiesMenu.peekMode.defaultForView",description:"Specifies that this option is default for the given view",values:{view:(0,d.Z)(t)}}))),icon:(0,A.RO)(e)({width:16,fill:o.mediumTextColor})})))}ne.displayName="CollectionSettingsViewLayoutMenu";const se=(0,f.injectIntl)(ne)},75544:(e,t,o)=>{o.d(t,{N:()=>X,Z:()=>q});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(43261),l=o.n(s),c=o(96486),d=o(67294),p=o(83355),u=o(480),m=o(81954),g=o(99036),h=o(80951),f=o(39068),v=o(6695),y=o(3779),b=o(97880),S=o(82990),w=o(5366),k=o(77162),C=o(5149),_=o(87085),M=o(96802),T=o(30149),I=o(52821),P=o(65742),x=o(33929),B=o(33665),Z=o(29798),E=o(12318),R=o(73657),A=o(21269),D=o(13005),F=o(42917),L=o(52275),V=o(79131),N=o(5145),O=o(73063),U=o(68894),H=o(9342),z=o(89728),W=o(72495),j=o(86825),K=o(66957);const Y=(0,w.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertiesTab.inputPlaceholder"}});class G extends p.Z{constructor(){super(...arguments),this.storeTypes={inputStore:E.default.of(""),menuListStore:Z.Z},this.handleHideAllClick=e=>{const{collectionContextStore:t}=this.props;k.wd({environment:this.environment,collectionContextStore:t,action:"click_hide_all_properties"}),this.setAllPropertiesVisibility({formatKey:e,visibility:!1})},this.handleShowAllClick=e=>{const{collectionContextStore:t}=this.props;k.wd({environment:this.environment,collectionContextStore:t,action:"click_show_all_properties"}),this.setAllPropertiesVisibility({formatKey:e,visibility:!0})},this.handlePropertyReorder=e=>{const{formatKey:t,newPropertyKeys:o}=e,{collectionContextStore:i}=this.props,n=i.collectionViewStore();if(!n)return;const r=i.normalizedFormatStore.state[t]||[],a=o.indexOf("group-header-hidden-property"),s=[...c.compact(o.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const o=r.find((t=>t.property===e));if(o)return a>=0?{...o,visible:Boolean(t<a)}:o}))),...r.filter((e=>!o.includes(e.property)))];T.createAndCommit({userAction:"CollectionSettingsViewProperties.handlePropertyReorder",environment:this.environment,perform:e=>{M.FH({stores:[n],update:{[t]:s},transaction:e})}}),k.wd({environment:this.environment,collectionContextStore:i,action:"reorder_properties",original_view_type:n.getType()}),this.stores.menuListStore.reset()},this.handleTogglePropertyVisibility=e=>{var t,o;const{formatKey:i,propertyFormat:n}=e,{collectionContextStore:r}=this.props,a=r.collectionViewStore();if(!a)return;const s=(r.normalizedFormatStore.state[i]||[]).filter((e=>e.property!==n.property)),l={...n,visible:!n.visible},c=l.visible?[...s,l]:[l,...s];T.createAndCommit({userAction:"CollectionSettingsViewProperties.handleTogglePropertyVisibility",environment:this.environment,perform:e=>{M.FH({stores:[a],update:{[i]:c},transaction:e})}}),k.wd({environment:this.environment,collectionContextStore:r,action:"toggle_property_visibility",original_view_type:a.getType(),property_type:null===(t=a.getCollectionStore())||void 0===t||null===(o=t.getSchema()[l.property])||void 0===o?void 0:o.type}),this.clearInput()},this.handlePropertyClick=e=>{var t,o;const{collectionSettingsStore:i,collectionContextStore:n}=this.props,r=n.collectionStore();if(!r)return;const{formatKey:a,propertyFormat:s}=e;k.wd({environment:this.environment,collectionContextStore:n,action:"click_property",original_view_type:null==n||null===(t=n.collectionViewStore())||void 0===t?void 0:t.getType(),property_type:null===(o=r.getSchema()[s.property])||void 0===o?void 0:o.type}),C.H4({collectionSettingsStore:i,item:{type:"property",formatKey:a,property:s.property,collectionPointer:r.pointer}})},this.handleViewDeletedPropertiesClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=this.getCurrentPropertyFormatKey(),i=t.collectionStore();o&&i&&(k.wd({environment:this.environment,collectionContextStore:t,action:"click_deleted_properties"}),C.H4({collectionSettingsStore:e,item:{type:"deletedProperties",formatKey:o,collectionPointer:i.pointer}}))},this.handleNewPropertyClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();t&&(k.wd({environment:this.environment,collectionContextStore:e,action:"click_new_property"}),C.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",propertyTypes:(0,I.TP)({isSyncedCollection:t.isSyncedCollection(),collectionContextStore:e}),onAccept:(t,o)=>{_.Rl({environment:this.environment,propertyType:t,propertyName:o,collectionContextStore:e,from:"view_settings"})}}}))},this.handleTabChange=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;k.wd({environment:this.environment,collectionContextStore:o,action:0===e?"click_properties_tab_timeline":"click_properties_tab_table"}),C.FK({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:0===e?"timeline":"table"}}),this.clearInput()},this.handleShowTableClick=()=>{this.clearInput()}}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,{inputStore:o,menuListStore:i}=this.stores,r=o.get(),s=this.getCurrentViewType(),l=this.getCurrentPropertyFormatKey(),c=(0,P.d$)({environment:this.environment,isFullScreen:e.isFullScreen.get(),isRootChild:e.isRootChild.get()});return d.createElement(D.ZP,n()({},this.props,{title:a()(w.FormattedMessage,{defaultMessage:"Properties",id:"database.viewSettings.propertiesTab.title"}),header:a()(W.Z,{},void 0,a()(U.ZP,{focusInitial:!t.isMobile,value:r,showClearButton:!0,onChange:e=>{o.set(e.target.value),i.setState({...i.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:x.default.formatMessage(Y.inputPlaceholder)})),footer:this.renderFooter()}),"timeline"===s&&c&&this.renderTimelineControls(),l&&this.renderPropertyFormatList(l),a()(W.Z,{},void 0,this.renderDeletedProperties()))}renderTimelineControls(){const{timelineViewTab:e,collectionContextStore:t}=this.props,o="timeline"===e?0:1;return d.createElement(d.Fragment,null,a()(K.Z,{tabs:[a()(w.FormattedMessage,{defaultMessage:"Timeline",id:"database.viewSettings.propertiesTab.timelineProperties"}),a()(w.FormattedMessage,{defaultMessage:"Table",id:"database.viewSettings.propertiesTab.tableProperties"})],selectedIndex:o,onChange:this.handleTabChange}),"table"===e&&a()(W.Z,{},void 0,a()(X,{collectionContextStore:t,onClick:this.handleShowTableClick})))}renderPropertyFormatList(e){const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,i=t.normalizedFormatStore.state,r=t.normalizedSchemaStore.state,{inputStore:s}=this.stores,p=s.get();let u=i[e]||[];if(p){let e=u.map((e=>{const t=(0,h.Qm)({schema:r,property:e.property});return null==t?void 0:t.name}));e=l().filter(p,e).map((e=>{let{original:t}=e;return t})),u=u.filter((t=>{const o=r[t.property];return o&&o.name&&e.includes(o.name)}))}const m=u.filter((e=>Boolean(e.visible))),g=u.filter((e=>!Boolean(e.visible))),f="timeline_table_properties"===e?"table":this.getCurrentViewType();return d.createElement(d.Fragment,null,0===u.length&&a()(W.Z,{},void 0,a()(R.Z,{caption:a()(w.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertiesTab.noResults"})})),u.length>0&&a()(H.Z,{type:H.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:c.compact([m.length>0&&{key:"visible_and_hidden_properties",render:t=>d.createElement(W.Z,n()({},t,{noTextOverflow:!0,isTitleUppercase:!1,title:this.renderShownInViewMessage(f),desktopTitleStyle:{height:19},right:!p&&o.canConfigureBlock&&a()(z.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:()=>this.handleHideAllClick(e)},void 0,a()(w.FormattedMessage,{id:"database.viewSettings.propertiesTab.hideAllProperties",defaultMessage:"Hide all"})),children:this.renderPropertySortList({formatKey:e,visibleProperties:m,hiddenProperties:g,children:t.children})})),items:c.compact([...this.renderPropertySortListItems({formatKey:e,properties:m}),g.length>0&&{key:"group-header-hidden-property",render:t=>this.renderHiddenPropertySectionHeader({props:t,formatKey:e,children:d.createElement(d.Fragment,null)}),action:()=>{}},...this.renderPropertySortListItems({formatKey:e,properties:g})])},0===m.length&&g.length>0&&{key:"hidden_properties",render:t=>this.renderHiddenPropertySectionHeader({props:t,formatKey:e,children:this.renderPropertySortList({formatKey:e,visibleProperties:m,hiddenProperties:g,children:t.children})}),items:this.renderPropertySortListItems({formatKey:e,properties:g})}])}))}renderHiddenPropertySectionHeader(e){const{props:t,formatKey:o,children:i}=e,{collectionContextStore:r}=this.props,s=r.permissionScopes.state,{inputStore:l}=this.stores,c=l.get(),p="timeline_table_properties"===o?"table":this.getCurrentViewType();return d.createElement(W.Z,n()({},t,{noTextOverflow:!0,isTitleUppercase:!1,title:this.renderHiddenInViewMessage(p),desktopTitleStyle:{height:19},right:!c&&s.canConfigureBlock&&a()(z.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:()=>this.handleShowAllClick(o)},void 0,a()(w.FormattedMessage,{id:"database.viewSettings.propertiesTab.showAllProperties",defaultMessage:"Show all"})),style:{width:"100%",paddingBottom:0},children:i}))}renderFooter(){const{collectionContextStore:e,timelineViewTab:t}=this.props,o=e.permissionScopes.state,i="timeline"===this.getCurrentViewType()&&"table"===t&&!this.getTimelineShowTable(),n=o.canConfigureCollection&&!i;return a()(W.Z,{topBorder:!0},void 0,n&&a()(F.Z,{icon:y.Z.plus,title:a()(w.FormattedMessage,{id:"database.viewSettings.propertiesTab.newProperty",defaultMessage:"New property"}),isGray:!0,onClick:this.handleNewPropertyClick}),a()(A.Z,{href:(0,B.UY)("guides.databaseProperties"),title:a()(w.FormattedMessage,{defaultMessage:"Learn about properties",id:"database.viewSettings.propertiesTab.learnMoreButton.title"}),analyticsFrom:"view_settings_properties"}))}renderPropertySortList(e){const{formatKey:t,visibleProperties:o,hiddenProperties:i,children:n}=e,r=c.compact([...o.map((e=>e.property)),o.length>0&&i.length>0&&{key:"group-header-hidden-property",draggable:!1},...i.map((e=>e.property))]);return this.canReorder()?a()(V.ZP,{direction:"vertical",keys:r,renderKey:(e,t)=>n[t],onDrop:e=>{this.handlePropertyReorder({formatKey:t,newPropertyKeys:e})}}):n}renderPropertySortListItems(e){const{formatKey:t,properties:o}=e;return c.compact(o.map((e=>this.renderPropertySortListItem({formatKey:t,propertyFormat:e}))))}renderPropertySortListItem(e){var t;const{formatKey:o,propertyFormat:i}=e,{collectionContextStore:r}=this.props,s=null===(t=r.collectionStore())||void 0===t?void 0:t.isSyncedCollection(),l=r.permissionScopes.state,c=!i.visible,p=r.normalizedSchemaStore.state,u=(0,h.Qm)({schema:p,property:i.property}),m="title"!==i.property||this.primaryPropertyFormatAllowsHidingTitle(o),v=!l.canConfigureCollection||s&&((0,h.wl)(i.property)||(0,g.HF)(i.property));if(!u)return;const{theme:b}=this;return{key:i.property,render:e=>d.createElement(L.Z,n()({},e,{title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,this.canReorder()&&a()(N.ZP,{iconSize:12,style:{marginRight:8}}),a()(f.ZP,{type:u.type,icon:u.icon,size:16,theme:b,style:{fill:b.regularIconColor}}),a()("span",{style:{marginLeft:8,...S.Z.textOverflowStyle}},void 0,u.name)),right:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(O.Z,{icon:c?y.Z.eyeHide:y.Z.eye,iconStyle:{width:16,height:16},isDarkIconColor:!c,onClick:()=>{this.handleTogglePropertyVisibility({formatKey:o,propertyFormat:i})},disabled:!m||!l.canConfigureBlock}),!v&&y.Z.chevronRight({width:12,fill:b.lightTextColor,marginLeft:5}))})),action:()=>{v||this.handlePropertyClick({formatKey:o,propertyFormat:i})}}}renderShownInViewMessage(e){return"table"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in table",id:"database.viewSettings.propertiesTab.shownInTableTitle"}):"timeline"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in timeline",id:"database.viewSettings.propertiesTab.shownInTimelineTitle"}):"board"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in board",id:"database.viewSettings.propertiesTab.shownInBoardTitle"}):"list"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in list",id:"database.viewSettings.propertiesTab.shownInListTitle"}):"gallery"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in gallery",id:"database.viewSettings.propertiesTab.shownInGalleryTitle"}):"calendar"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in calendar",id:"database.viewSettings.propertiesTab.shownInCalendarTitle"}):"page"===e?null:void(0,b.t1)(e)}renderHiddenInViewMessage(e){return"table"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in table",id:"database.viewSettings.propertiesTab.hiddenInTableTitle"}):"timeline"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in timeline",id:"database.viewSettings.propertiesTab.hiddenInTimelineTitle"}):"board"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in board",id:"database.viewSettings.propertiesTab.hiddenInBoardTitle"}):"list"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in list",id:"database.viewSettings.propertiesTab.hiddenInListTitle"}):"gallery"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in gallery",id:"database.viewSettings.propertiesTab.hiddenInGalleryTitle"}):"calendar"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in calendar",id:"database.viewSettings.propertiesTab.hiddenInCalendarTitle"}):"page"===e?null:void(0,b.t1)(e)}renderDeletedProperties(){const{collectionContextStore:e}=this.props,t=e.normalizedDeletedSchemaStore.state,o=Object.keys(t).length;if(e.permissionScopes.state.canConfigureCollection&&o>0)return a()(F.Z,{icon:y.Z.trash,title:a()(w.FormattedMessage,{id:"database.viewSettings.propertiesTab.deletedProperties",defaultMessage:"Deleted properties"}),isGray:!0,onClick:this.handleViewDeletedPropertiesClick,right:o,showChevron:!0})}getCurrentPropertyFormatKey(){const e=this.getCurrentViewType(),t=this.getTimelineShowTable();if("timeline"===e){const{timelineViewTab:e}=this.props;return"timeline"===e?"timeline_properties":t?"timeline_table_properties":void 0}return(0,v.oz)(this.getCurrentViewType())}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}canReorder(){const{inputStore:e}=this.stores,t=e.get(),{collectionContextStore:o}=this.props,i=o.permissionScopes.state;return!this.environment.device.isMobile&&i.canConfigureBlock&&!t}setAllPropertiesVisibility(e){const{formatKey:t,visibility:o}=e,{collectionContextStore:i}=this.props,n=i.collectionViewStore();if(!n)return;const r=i.normalizedFormatStore.state[t]||[],a=r.filter((e=>Boolean(e.visible))),s=r.filter((e=>!Boolean(e.visible))),l=[...a.map((e=>({...e,visible:o}))),...s.map((e=>({...e,visible:o})))];T.createAndCommit({userAction:"CollectionSettingsViewProperties.setAllPropertiesVisibility",environment:this.environment,perform:e=>{M.FH({stores:[n],update:{[t]:l},transaction:e})}})}primaryPropertyFormatAllowsHidingTitle(e){const{collectionContextStore:t}=this.props,o=t.normalizedFormatStore.state,i=this.getCurrentViewType();return"board"===i?(0,v.Lw)(o.board_cover):"gallery"===i?(0,v.Lw)(o.gallery_cover):"timeline"===i&&("timeline_table_properties"===e||(0,v.vP)(Boolean(o.timeline_show_table),o.timeline_table_properties||[]))}getTimelineShowTable(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state;return Boolean(t.timeline_show_table)}clearInput(){this.stores.inputStore.reset()}}function X(e){window.__c={n:"TimelineShowTableSwitcher"};const{collectionContextStore:t,onClick:o}=e,i=(0,u.O7)(),n=(0,m.Kw)(t.normalizedFormatStore),r=Boolean(n.timeline_show_table),s=(0,m.Kw)(t.permissionScopes);return a()(j.Z,{title:a()(w.FormattedMessage,{defaultMessage:"Show table",id:"database.viewSettings.propertiesTab.showTable"}),on:r,focused:!1,onClick:()=>{const e=t.collectionViewStore();e&&(T.createAndCommit({userAction:"CollectionSettingsViewProperties.TimelineShowTableSwitcher",environment:i,perform:t=>{M.FH({stores:[e],update:{timeline_show_table:!r,timeline_table_properties:[{property:"name",visible:!0}]},transaction:t})}}),null==o||o(),k.wd({environment:i,collectionContextStore:t,action:"timeline_toggle_show_table"}))},disabled:!s.canConfigureBlock,textWrapperStyle:{opacity:1}})}G.displayName="CollectionSettingsViewProperties";const q=(0,w.injectIntl)(G)},41418:(e,t,o)=>{o.d(t,{Z:()=>V});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o(67294),c=o(83355),d=o(8848),p=o(3779),u=o(5366),m=o(50906),g=o(12534),h=o(33929),f=o(60709),v=o(31339),y=o(42917),b=o(61053),S=o(60246),w=o(52275),k=o(31945),C=o(14871),_=o(77498),M=o(62045),T=o(50542);class I extends c.Z{constructor(){super(...arguments),this.handleAccept=e=>{const{sort:t,collectionViewType:o}=this.props,i={...t,property:e};this.props.onChange(this.props.index,i),o&&m.trackConfigureView(this.environment,{view_type:o,action:"set_sort_property"})}}renderComponent(){const{schema:e,sort:t}=this.props,o=e[t.property];if(o)return a()(l.Fragment,{},void 0,this.renderPropertyDropdown(o),this.renderSortDirection())}renderPropertyDropdown(e){const{device:t}=this.environment,{disabled:o}=this.props;return a()(k.Z,{popupType:t.isMobile?k.Z.PopupType.SlideUp:k.Z.PopupType.Popup,renderOrigin:t=>l.createElement(T.Z,n()({},t,{propertySchema:e,disabled:o,textWrapperStyle:{opacity:1}})),render:e=>a()(_.Z,{isRelationProperty:!1,schema:this.props.schema,onAccept:this.handleAccept,onClose:e.close}),disabled:o})}renderSortDirection(){const{sort:e,index:t,onChange:o,collectionViewType:i,intl:r,disabled:a}=this.props,s=e.direction,c={menuTitle:r.formatMessage({id:"collectionSortMenuRow.sortDirectionSelectMenu.title",defaultMessage:"Sort",description:"Title of menu where users select sort order (Ascending or Descending)"}),items:[...S.C6],getKey:e=>e,selectedItem:s,disabled:a,onSelect:n=>{const r={...e,direction:n};o(t,r),i&&m.trackConfigureView(this.environment,{view_type:i,action:"set_sort_direction"})},renderItem:e=>l.createElement(w.Z,n()({title:I.sortDirectionMessage[e.value]},e)),renderOrigin:e=>l.createElement(M.Z,n()({},e,{placeholder:r.formatMessage({id:"collectionSortMenuRow.sortDirectionSelectMenu.placeholder",defaultMessage:"Empty",description:"Default placeholder for an empty sort direction (Ascending or Descending)"}),title:s&&I.sortDirectionMessage[s],disabled:a,desktopStyle:{opacity:1}}))};return l.createElement(C.Z,n()({key:"direction"},c,{mobileActionSheet:!0}))}}I.displayName="CollectionSortMenuRow",I.sortDirectionMessage={ascending:a()(u.FormattedMessage,{defaultMessage:"Ascending",id:"collectionSortMenuRow.sortDirectionSelectMenu.ascending",description:"Indicates that the database will be sorted by the selected property, in ascending order"}),descending:a()(u.FormattedMessage,{defaultMessage:"Descending",id:"collectionSortMenuRow.sortDirectionSelectMenu.descending",description:"Indicates that the database will be sorted by the selected property, in descending order"})};const P=(0,u.injectIntl)(I);var x=o(79131),B=o(73063),Z=o(78140),E=o(28992),R=o(44532),A=o(72495),D=o(58032);const F=(0,u.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.collectionSortMenu.inputPlaceholder",description:"Input placeholder to search for a database property."}});class L extends c.Z{constructor(){super(...arguments),this.handleDraggableListDrop=e=>{const{onChange:t}=this.props,{sorts:o}=this.props;t(s.compact(e.map((e=>o[parseInt(e)]))));const i=this.getCurrentViewType();i&&m.trackConfigureView(this.environment,{action:"reorder_sorts",view_type:i})},this.handleChangeSort=(e,t)=>{const{onChange:o}=this.props,{sorts:i}=this.props;o(i.map(((o,i)=>i===e?t:o)));const n=this.getCurrentViewType();n&&m.trackConfigureView(this.environment,{action:"update_sort",view_type:n})},this.handleDeleteSort=e=>{const{onChange:t}=this.props,{sorts:o}=this.props;t(o.filter(((t,o)=>o!==e)));const i=this.getCurrentViewType();i&&m.trackConfigureView(this.environment,{action:"delete_sort",view_type:i})},this.handleDeleteAllSortsClick=()=>{const{onChange:e,onDeleteAll:t}=this.props;e([]),null==t||t();const o=this.getCurrentViewType();o&&m.trackConfigureView(this.environment,{action:"delete_all_sorts",view_type:o})},this.handleNewPropertyAccept=e=>{var t;if(!e)return;const{schema:o,sorts:i,onChange:n}=this.props,r=null===(t=o[e])||void 0===t?void 0:t.type;n([...i,{property:e,direction:"ascending"}]);const a=this.getCurrentViewType();a&&m.trackConfigureView(this.environment,{action:"create_sort_accept",view_type:a,property_type:r})}}renderComponent(){const{device:e}=this.environment,{schema:t,format:o,sorts:i,showDeleteAll:r}=this.props,s=!!Object.keys(t).some((e=>!i.find((t=>t.property===e)))),c=r&&i.length>0;return l.createElement(l.Fragment,null,this.renderSorts(),(s||c)&&a()(A.Z,{},void 0,s&&a()(k.Z,{popupType:e.isMobile?R.kQ.SlideUp:R.kQ.Popup,renderOrigin:e=>l.createElement(y.Z,n()({icon:p.Z.plus,isGray:!0,title:a()(u.FormattedMessage,{id:"database.viewSettings.sortTab.newSort",defaultMessage:"Add sort"})},e)),render:n=>{let r;return r=e.isMobile?{menuType:f.og.ActionSheet}:{menuType:f.og.Popup,width:280},l.createElement(Z.Z,r,a()(b.Z,{schema:t,format:o,getProperties:()=>Object.keys(t).filter((e=>!i.find((t=>t.property===e)))),onAccept:e=>{this.handleNewPropertyAccept(e),n.close()},inputPlaceholder:h.default.formatMessage(F.inputPlaceholder),defaultShowPropertyCount:5}))}}),c&&a()(y.Z,{icon:p.Z.trash,isRed:!0,isGray:!0,title:a()(u.FormattedMessage,{id:"database.viewSettings.sortTab.deleteAllSorts",defaultMessage:"Delete sort"}),onClick:this.handleDeleteAllSortsClick})))}renderSorts(){const{device:e}=this.environment,{sorts:t}=this.props;if(e.isMobile)return t.map(((e,t)=>this.renderSort(e,t)));{const e=t.map(((e,t)=>t.toString()));return e.length>0&&a()("div",{style:{marginBottom:2}},void 0,a()(x.ZP,{direction:"vertical",keys:e,renderKey:e=>this.renderSort(t[parseInt(e)],parseInt(e)),onDrop:this.handleDraggableListDrop}))}}renderSort(e,t){const{device:o}=this.environment,{schema:i,disabled:n,parentStore:r}=this.props;return o.isMobile?a()(A.Z,{},t,a()(P,{index:t,sort:e,schema:i,parentStore:r,collectionViewType:this.getCurrentViewType(),onChange:this.handleChangeSort}),!n&&this.renderMobileDeleteButtonMenuItem(t)):a()(A.Z,{extraTopPadding:!0,desktopStyle:{padding:"8px 0 0 8px",width:"100%"}},t,a()(E.Z,{showDragHandle:!o.isMobile&&!n,title:a()("div",{style:{display:"flex",alignItems:"center",flexGrow:1,whiteSpace:"nowrap"},onMouseDown:g.$0},void 0,a()(P,{index:t,sort:e,schema:i,parentStore:r,collectionViewType:this.getCurrentViewType(),onChange:this.handleChangeSort})),right:!n&&this.renderDesktopDeleteButton(t)}))}renderMobileDeleteButtonMenuItem(e){return a()(w.Z,{title:a()("div",{style:{color:d.ZP.red}},void 0,a()(u.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.sortTab.mobileDeleteButtonTitle"})),icon:a()(v.Z,{icon:p.Z.trash,styles:{color:d.ZP.red}}),onClick:()=>this.handleDeleteSort(e),focused:!1})}renderDesktopDeleteButton(e){return a()(D.Z,{render:t=>l.createElement(B.Z,n()({icon:p.Z.collectionDeleteRule,onClick:()=>this.handleDeleteSort(e),style:{marginRight:-6}},t)),renderTooltip:()=>a()(u.FormattedMessage,{defaultMessage:"Remove sort rule",id:"database.sortMenu.deleteButtonTooltip"})})}getCurrentViewType(){const{collectionViewStore:e}=this.props;return null==e?void 0:e.getType()}}L.displayName="CollectionSortMenu";const V=(0,u.injectIntl)(L)},97180:(e,t,o)=>{o.d(t,{C:()=>p,r:()=>m});var i=o(77094),n=o.n(i),r=o(67294),a=o(24405),s=o(3779),l=o(5366),c=o(32662),d=o(58032);const p={"To-do":n()(l.FormattedMessage,{id:"database.statusProperty.groupName.todo",defaultMessage:"To-do",description:"The To-do group/status for status property"}),"In progress":n()(l.FormattedMessage,{id:"database.statusProperty.groupName.inProgress",defaultMessage:"In Progress",description:"The In Progress group/status for status property"}),Complete:n()(l.FormattedMessage,{id:"database.statusProperty.groupName.complete",defaultMessage:"Complete",description:"The Complete group/status for status property"})},u={"To-do":s.Z.statusTodoGroup,"In progress":s.Z.statusInProgressGroup,Complete:s.Z.statusCompleteGroup};function m(e){window.__c={n:"CollectionStatusGroupName"};const{group:t,disableGroup:o,style:i,showIcon:l,showColor:m}=e,g=(0,a.Fg)(),h=u[t.name]??s.Z.statusTodoGroup,f=t.color??"gray";return n()("div",{style:{...i,display:"inline-flex",alignItems:"center"}},void 0,l&&h({display:"inline-block",width:16,height:16,fill:m?g.accentColors[f][400]:g.mediumIconColor}),n()("span",{style:{paddingLeft:l?6:void 0,color:m?g.accentColors[f][500]:void 0}},void 0,p[t.name]??t.name),o?r.createElement(r.Fragment,null,n()(c.Z,{size:4}),n()(d.Z,{placement:d.Z.Placement.Bottom,render:e=>r.createElement("div",e,s.Z.lockedFilled({width:12})),renderTooltip:e=>r.createElement("div",e,o.tooltipCaption),disableTooltip:void 0===o.tooltipCaption})):null)}},34253:(e,t,o)=>{o.d(t,{Z:()=>ue});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(31942),u=o(3779),m=o(5366),g=o(50906),h=o(98834),f=o(5978),v=o(21325),y=o(30149),b=o(66890),S=o(66213),w=o(14976),k=o(75079),C=o(84210),_=o(33929),M=o(60709),T=o(33665),I=o(79315),P=o(33846),x=o(29798),B=o(3815),Z=o(13401),E=o(81870),R=o(47307),A=o(96802),D=o(3992),F=o(617),L=o(43250),V=o(98742),N=o(77907),O=o(17031),U=o(61766),H=o(96049),z=o(31792),W=o(24736),j=o(45669),K=o(93405),Y=o(31945),G=o(78140),X=o(9342),q=o(44532),$=o(31278),J=o(76798),Q=o(72495),ee=o(58032),te=o(34574);const oe=(0,m.defineMessages)({emptyPageTitle:{defaultMessage:"Empty",id:"database.templatePicker.emptyPageTitle"}});class ie extends d.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:z.Z,buttonPopupStore:U.Z},this.renderActionMenuPopup=e=>{const{device:t}=this.environment,o=!!this.props.templateStore&&(0,F.J5)({environment:this.environment,blocks:[this.props.templateStore],publicEditMode:void 0}),i={key:"section",render:e=>c.createElement(Q.Z,e),items:l().compact([this.props.templateStore&&{key:"repeatControl",render:(e,t)=>this.props.templateStore&&c.createElement(N.LazyRecurrenceConfigMenu,a()({},e,{templateStore:this.props.templateStore,parent:t})),action:this.handleRecurrence},this.props.isOverlay&&{key:"Set default",render:e=>c.createElement(K.Z,a()({},e,{title:n()(m.FormattedMessage,{defaultMessage:"Set as default",id:"database.collectionTemplatePickerItem.actionMenu.setAsDefault",description:"Action to set the template as the default"}),svg:u.Z.flag})),action:()=>this.handleSetAsDefault(e)},this.props.templateStore&&{key:"Edit",render:e=>c.createElement(K.Z,a()({},e,{title:n()(m.FormattedMessage,o?{defaultMessage:"Edit",id:"database.templatePickerItem.actionMenu.edit"}:{defaultMessage:"View",id:"database.templatePickerItem.actionMenu.view"}),svg:o?u.Z.rename:u.Z.eye})),action:this.handleEdit},{key:"Duplicate",render:e=>c.createElement(K.Z,a()({},e,{title:n()(m.FormattedMessage,{defaultMessage:"Duplicate",id:"database.templatePickerItem.actionMenu.duplicate"}),svg:u.Z.duplicate})),action:this.handleDuplicate},this.props.templateStore&&{key:"Delete",render:e=>c.createElement(K.Z,a()({},e,{disabled:!o,style:{opacity:o?1:.5},title:n()(m.FormattedMessage,{defaultMessage:"Delete",id:"database.templatePickerItem.actionMenu.delete"}),svg:u.Z.trash})),action:o?this.handleDelete:()=>{}}])};let r;return r=t.isMobile?{menuType:M.og.ActionSheet}:{menuType:M.og.Popup,width:230},c.createElement(G.Z,r,n()(X.Z,{type:X.i.Vertical,initialFocus:void 0,sections:[i]}))},this.handleRecurrence=()=>{g.trackRecurrenceMenuOpen(this.environment,{isConfigured:void 0!==this.props.recurrence})},this.handleEdit=()=>{var e,t;const{buttonPopupStore:o}=this.stores;this.props.templateStore&&(null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t),this.navigateToBlock(this.props.templateStore),o.reset(),g.trackCollectionTemplateAction(this.environment,{template_action:"edit"}))},this.handleDuplicate=()=>{var e,t;const{buttonPopupStore:o}=this.stores,{templateStore:i,collectionStore:n}=this.props;if(!i)return;null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t);const{performResult:r}=y.createAndCommit({userAction:"CollectionTemplatePickerItem.duplicatedStore",environment:this.environment,perform:e=>{const t=h.Zh({environment:this.environment,collectionStore:n,templateStore:i,transaction:e});if(i.getAutomationId()){const o=B.Mz.fromBlockStore(i),n=null==o?void 0:o.getRecurrence();o&&null!=o&&o.isActive()&&n&&D.createRecurrenceInner(e,this.environment,t,n)}return t}});r&&this.navigateToBlock(r),o.reset(),g.trackCollectionTemplateAction(this.environment,{template_action:"duplicate"})},this.handleDelete=async()=>{const{templateStore:e,collectionStore:t}=this.props;if(!e)return;await R.confirmUserAction({message:n()(m.FormattedMessage,{defaultMessage:"Are you sure you would like to delete this template?",id:"database.confirmDialog.templatePickerItem.deleteMessage"}),acceptLabel:n()(m.FormattedMessage,{defaultMessage:"Delete",id:"database.confirmDialog.templatePickerItem.deleteButton.label"})})&&(y.createAndCommit({userAction:"CollectionTemplatePickerItem.handleDelete",environment:this.environment,perform:o=>h.R5({collectionStore:t,templateStore:e,transaction:o})}),g.trackCollectionTemplateAction(this.environment,{template_action:"delete"}))},this.handleSetAsDefault=e=>{var t,o;const{collectionContextStore:i}=this.context,r=null==i?void 0:i.collectionStore(),a=null==i?void 0:i.collectionViewStore();if(!r||null==a||!a.isDefined())return;const s=null!==(t=this.props.templateStore)&&void 0!==t&&t.id?{template_page_id:null===(o=this.props.templateStore)||void 0===o?void 0:o.id}:"empty";R.showDialog({showCancel:!0,keepFocus:!1,message:n()(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.message",defaultMessage:"<span>Use “{pageName}” as default template when creating new pages?</span>",values:{span:e=>n()("span",{},void 0,e),pageName:this.props.templateStore?n()(J.Z,{store:this.props.templateStore,style:{display:"inline"}}):_.default.formatMessage(oe.emptyPageTitle)},description:"Prompt message for setting the default template"}),items:[{label:n()(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollection",defaultMessage:"For all views in “{databaseName}”",description:"Set the template as the default for the entire database",values:{databaseName:n()(J.Z,{store:r,style:{display:"inline"}})}}),onAccept:()=>{e.close(),y.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collection",perform:e=>{A.FH({stores:[r],update:{collection_default_template:s},transaction:e}),A.FH({stores:[a],update:{collection_view_default_template:s},transaction:e})}})}},{label:n()(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollectionView",defaultMessage:"Only on “{viewName}” view",description:"Set the template as the default for the current view only",values:{viewName:n()(j.Z,{collectionViewName:a.getName(),collectionViewType:a.getType()})}}),onAccept:()=>{e.close(),y.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collectionView",perform:e=>{A.FH({stores:[a],update:{collection_view_default_template:s},transaction:e})}})}}]})},this.handleMouseMove=()=>{H.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.getRecordModel=this.props.collectionStore.getRecordModel}get registries(){return[O.Z]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):f.navigate({environment:this.environment,url:e})}renderComponent(){var e;const{device:t}=this.environment,{templateStore:o,isMobile:i,isOverlay:r,focused:a,locked:s,canConfigureCollection:l,draggable:c}=this.props,{mouseStore:d,buttonPopupStore:p}=this.stores,u=(!s||s&&!c)&&l&&(d.state.mouseEntered||p.state.open||i||r),m=o?n()(J.Z,{store:o}):_.default.formatMessage(oe.emptyPageTitle),g=null==o||null===(e=o.getModel())||void 0===e?void 0:e.getRenderIcon({getRecordModel:this.getRecordModel});return n()(te.Z,{type:o?"custom_template":"empty_page",format:r?"collection-overlay":"page-menu-item",locked:s||!l||!c,icon:n()($.Z,{disabled:!0,icon:g,isEmptyPage:(null==o?void 0:o.isEmptyPage())??!0,size:t.isMobile&&r?24:20,isLarge:!r,style:{...!r&&{pointerEvents:"none",marginRight:10}},pageIconStyle:{...!r&&{fill:this.theme.lightIconColor}}}),title:m,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,right:u&&this.renderActionMenuButton(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,focused:a,isDefault:this.props.isDefault,recurrence:this.props.recurrence})}renderActionMenuButton(){const{isMobile:e,isOverlay:t}=this.props,{buttonPopupStore:o}=this.stores;return n()(ee.Z,{renderTooltip:()=>n()(m.FormattedMessage,{defaultMessage:"Edit this template",id:"database.templatePickerItem.editTemplate.tooltip"}),delayThreshold:300,render:i=>n()(Y.Z,{popupType:e?q.ZP.PopupType.SlideUp:q.ZP.PopupType.Popup,placementToOrigin:Y.Z.Placement.Right,originGap:12,buttonPopupStore:o,renderOrigin:o=>c.createElement(W.Z,a()({className:e||t?void 0:L.JiD,isMobile:e&&t,style:{...!t&&{marginRight:0}}},(0,V.Z)(i,o))),render:this.renderActionMenuPopup,onClick:()=>{g.trackCollectionTemplateAction(this.environment,{template_action:"open_menu"})}})})}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=I.default.state,o=t?(0,C.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1}):(0,C.ZP)({store:e,fullyQualified:!1});this.navigate(o)}}ie.displayName="CollectionTemplatePickerItem",ie.contextTypes={...d.w,...S.wK,...b.xm};const ne=ie;var re=o(44514),ae=o(79131),se=o(68894),le=o(28992),ce=o(40721);const de=(0,m.defineMessages)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…",description:"Placeholder text for search bar in collections template picker"}});class pe extends d.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:x.Z,templateInputStore:P.Z},this.handleTemplateFilterChange=e=>{const{templateInputStore:t}=this.stores;t.setState({...t.state,inputValue:e.currentTarget.value})},this.renderMenuList=(e,t,o)=>{var i;const{device:r}=this.environment,{canConfigureCollection:s,isOverlay:d}=this.props,{templateInputStore:p}=this.stores,u={key:"create-template",render:(e,t)=>this.renderNewButtonMenuItem(e),action:this.handleNewCollectionTemplateClick},m=null===(i=this.context.collectionContextStore)||void 0===i?void 0:i.defaultPageTemplateStore.state,g={key:"empty",render:(t,o)=>{if(0!==e.length&&""===p.state.inputValue)return c.createElement(ne,a()({},this.props,{templateStore:void 0,isMobile:this.environment.device.isMobile,locked:this.props.locked||!s,draggable:!0,isDefault:void 0===(null==m?void 0:m.id),onCancelClick:this.props.onCancelClick},t))},action:this.handleEmptyPageContinueClick};return n()(X.Z,{type:X.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:this.handleEmptyEnter,sections:l().compact([0!==e.length&&{key:"templates",render:t=>{const i=t.children.slice(0,t.children.length-1),s=t.children[t.children.length-1];return c.createElement(Q.Z,a()({},t,{disableDesktopPadding:!this.props.isOverlay,disableMobileBorders:!0,children:n()(c.Fragment,{},void 0,r.isMobile||this.props.locked||!this.props.canConfigureCollection?i.map(((e,t)=>i[t])):n()(ae.ZP,{direction:"vertical",keys:e,disabled:!o,renderKey:(t,o)=>i[e.indexOf(t)],onDrop:this.handleCollectionTemplatesReorder}),s)}))},items:[...t.map((e=>this.renderCollectionTemplatePageMenuItem(e,o))),g]},s?{key:"create-template",render:e=>c.createElement(Q.Z,a()({topBorder:d,disableDesktopPadding:!d,disableMobileBorders:!0},e)),items:[u]}:void 0])})},this.renderCollectionTemplatePageMenuItem=(e,t)=>{var o;const{device:i}=this.environment,{collectionStore:n,canConfigureCollection:r,locked:s}=this.props,l=null===(o=this.context.collectionContextStore)||void 0===o?void 0:o.defaultPageTemplateStore.state,d=B.Mz.fromBlockStore(e),p=null!=d&&d.isActive()?d.getRecurrence():void 0;return{key:e.id,render:o=>c.createElement(ne,a()({},o,{key:e.id,isOverlay:this.props.isOverlay,collectionStore:n,canConfigureCollection:r,templateStore:e,isMobile:i.isMobile,locked:s,onCancelClick:this.props.onCancelClick,draggable:t,isDefault:(null==l?void 0:l.id)===e.id,recurrence:p})),action:t=>{v.M_(this.environment)&&this.props.onTemplateClick({templateStore:e,isKeyboard:"keydown"===t.event.type})}}},this.handleEmptyPageContinueClick=e=>{const{collectionContextStore:t}=this.context;v.M_(this.environment)&&(this.props.onEmptyPageClick(),g.trackSelectTemplate(this.environment,{template_name:"empty",is_keyboard:"keydown"===e.event.type,...t&&(0,k.Pn)(t)}))},this.handleEmptyEnter=()=>{const{collectionStore:e}=this.props;var t,o;v.M_(this.environment)&&(this.props.onEmptyEnter(),g.trackSelectTemplate(this.environment,{template_name:"empty",is_keyboard:!0,collection_id:e.id,collection_view_id:null===(t=this.context.collectionContextStore)||void 0===t||null===(o=t.collectionViewStore())||void 0===o?void 0:o.id}))},this.handleNewCollectionTemplateClick=()=>{const{collectionStore:e}=this.props,{templateInputStore:t}=this.stores;if(v.M_(this.environment)){var o,i;const{performResult:n}=y.createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:this.environment,perform:o=>h.nx({environment:this.environment,collectionStore:e,transaction:o,title:t?t.state.inputValue:void 0})});n&&this.navigateToBlock(n),g.trackCreateCollectionTemplate(this.environment,{collection_id:e.id,collection_view_id:null===(o=this.context.collectionContextStore)||void 0===o||null===(i=o.collectionViewStore())||void 0===i?void 0:i.id})}},this.handleCollectionTemplatesReorder=e=>{const{collectionStore:t}=this.props,{menuListStore:o}=this.stores;o.unsetFocus(),y.createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:this.environment,perform:o=>h.$p({collectionStore:t,newTemplateIds:e,transaction:o})})}}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):f.navigate({environment:this.environment,url:e})}renderComponent(){const{device:e}=this.environment,{collectionStore:t,isOverlay:o}=this.props;let i=t.getTemplatePageStores();const{templateInputStore:r}=this.stores;if(!i.every((e=>e.isReady())))return;i=i.filter((e=>e.getAlive()));const s=i.map((e=>e.id));let l=this.renderMenuList(s,i,!0);const d=this.renderInputHeader();if(o){let t;t=e.isMobile?{menuType:M.og.Modal,title:n()(m.FormattedMessage,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:n()(ce.CancelMenuText,{}),onClickLeft:this.props.onCancelClick}:{menuType:M.og.Popup,width:360};let o=i,u=s;return s.length>6&&r.state.inputValue&&(o=(0,p.ZP)(r.state.inputValue,i,(e=>String(e.getProperties().title)??"")),u=o.map((e=>e.id)),l=this.renderMenuList(u,o,!1)),c.createElement(G.Z,a()({},t,{header:this.renderTitle()}),0===s.length&&n()(Q.Z,{},void 0,n()("div",{style:{fontSize:14,padding:e.isMobile?"12px 16px":"0 14px 3px 14px",color:this.theme.lightTextColor,wordBreak:"keep-all",...e.isMobile&&{background:this.theme.contentBackground,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}}},void 0,n()(m.FormattedMessage,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"}))),s.length>6?d:void 0,l)}return l}renderInputHeader(){const{device:e}=this.environment,t=!e.isMobile||void 0;return n()("div",{style:{margin:e.isMobile?0:"10px 0"}},void 0,n()(se.ZP,{value:this.stores.templateInputStore.state.inputValue,focusInitial:t,placeholder:_.default.formatMessage(de.filterPlaceholder),showClearButton:!0,inputLeft:n()(se.f_,{icon:u.Z.searchThick}),onChange:this.handleTemplateFilterChange,style:{...e.isAndroid&&{borderBottom:"none"}}}))}renderTitle(){if(this.environment.device.isMobile)return;const e=this.props.collectionStore.getNameStore().getValue(),t=e?(0,w.Xh)(e,this.props.collectionStore):n()(m.FormattedMessage,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return n()(le.Z,{style:{marginTop:6},title:n()(re.Q,{prefix:n()(m.FormattedMessage,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for",description:"Followed by the name of the database"}),viewName:t}),right:n()(E.Z,{helpButtonContext:"collection_templates_menu",href:(0,T.UY)("guides.databaseTemplates")})})}renderNewButtonMenuItem(e){const{isOverlay:t}=this.props,o=n()(m.FormattedMessage,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return t?c.createElement(Z.Z,a()({isBlue:this.environment.device.isDesktop,title:o},e)):c.createElement(te.Z,a()({title:o,icon:u.Z.plus({width:18,fill:this.theme.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:t?"collection-overlay":"page-menu-item",locked:this.props.locked},e))}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=I.default.state,o=t?(0,C.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1}):(0,C.ZP)({store:e,fullyQualified:!1});this.navigate(o)}}pe.displayName="CollectionTemplatePicker",pe.contextTypes={...S.wK,...d.w,...b.xm};const ue=pe},12022:(e,t,o)=>{o.d(t,{L:()=>rl,Z:()=>cl});var i,n=o(97464),r=o.n(n),a=o(77094),s=o.n(a),l=o(96486),c=o.n(l),d=o(67294),p=o(62518),u=o(83355),m=o(1302),g=o(6740),h=o(65669),f=o(67219),v=o(89665),y=o(42509),b=o(3779),S=o(15157),w=o(44615),k=o(29477),C=o(21202),_=o(13493),M=o(82990),T=o(51454),I=o(5366),P=o(50906),x=o(54642),B=o(51127),Z=o(26797),E=o(77162),R=o(49865),A=o(5149),D=o(98834),F=o(64434),L=o(87420),V=o(52989),N=o(5978),O=o(61045),U=o(87531),H=o(24677),z=o(98104),W=o(30149),j=o(66890),K=o(66213),Y=o(28020),G=o(93959),X=o(43250),q=o(97004),$=o(70764),J=o(75079),Q=o(65742),ee=o(78316),te=o(73744),oe=o(84210),ie=o(12534),ne=o(33929),re=o(10663),ae=o(39500),se=o(77546),le=o(45094),ce=o(472),de=o(2688),pe=o(79315),ue=o(61766),me=o(4926),ge=o(4787),he=o(58421),fe=o(7095),ve=o(88632),ye=o(10161),be=o(30874),Se=o(96049),we=o(28209),ke=o(31792),Ce=o(19671),_e=o(82136),Me=o(85844),Te=o(13023),Ie=o(88923),Pe=o(3815),xe=o(29026),Be=o(77794),Ze=o(12318),Ee=o(86671),Re=o(14714),Ae=o(71644),De=o(96802),Fe=o(92918),Le=o(17504);!function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"}(i||(i={}));const Ve=i;var Ne=o(21325),Oe=o(17311),Ue=o(2032),He=o(14248),ze=o(42875),We=o(47853),je=o(16187),Ke=o(60709),Ye=o(98742),Ge=o(75498),Xe=o(52275),qe=o(31945),$e=o(78140),Je=o(9342),Qe=o(40721),et=o(89728),tt=o(44532),ot=o(72495),it=o(58032),nt=o(95030);class rt extends u.Z{constructor(){super(...arguments),this.renderMenu=e=>{const{device:t}=this.environment;let o;return o=t.isMobile?{menuType:Ke.og.Modal,title:s()(I.FormattedMessage,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:s()(Qe.DoneMenuText,{}),onClickRight:e.close}:{menuType:Ke.og.Popup,width:200},d.createElement($e.Z,o,s()(Je.Z,{type:Je.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>d.createElement(ot.Z,e),items:this.getAggregationActions()}],onAccept:e.close}))},this.handleChangeAggregation=e=>{const{onChange:t,collectionContextStore:o}=this.props;t(e),E.wd({environment:this.environment,collectionContextStore:o,action:"board_change_aggregation"})},this.renderAggregationMenuItem=(e,t,o)=>s()(it.Z,{placement:tt.GI.Placement.Right,delayThreshold:0,render:e=>d.createElement(Xe.Z,r()({title:t},(0,Ye.Z)(e,o))),renderTooltip:()=>s()("div",{style:{width:140,whiteSpace:"normal"}},void 0,s()("img",{src:(0,We.D)(je.Sn[e]),style:{borderRadius:3,width:140,marginTop:4}}),je.BG[e])},o.key),this.reducerStore=this.createComputedStore((()=>{const{aggregation:e,schema:t,groupFormat:o}=this.props;if(e){return{type:"aggregation",filter:(0,He.zk)({schema:t,group:o,timeZone:(0,ze.r)()}),aggregation:e}}}))}renderComponent(){const{device:e}=this.environment;return s()(it.Z,{renderTooltip:()=>this.renderTooltipText(),render:t=>s()(qe.Z,{popupType:e.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,renderOrigin:e=>d.createElement(et.Z,r()({disabled:this.props.disabled,style:{fontWeight:M.Z.fontWeight.regular,color:this.props.color||this.theme.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0}},(0,Ye.Z)(t,e)),this.renderValue()),disabled:this.props.disabled,render:this.renderMenu})})}renderTooltipText(){const{aggregation:e,schema:t}=this.props;if(e){const o=je.VN[(0,Ue.OV)(e)];if((0,Ue.pK)(e)){const i=t[e.property];if(i){return`${o} in ${i.name}`}}return o}return s()(I.FormattedMessage,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}renderValue(){const{schema:e,aggregation:t,collectionContextStore:o,groupFormat:i}=this.props,n=this.reducerStore.state;if(t&&n)return s()(Ge.Z,{id:`board:${(0,Re.mD)(i)}`,collectionContextStore:o,reducer:n,render:o=>{const i=o.state;if(!i||"aggregation"!==i.type)return;let n;if((0,Ue.pK)(t)){const o=e[t.property];!o||"formula"!==o.type&&"number"!==o.type||(n=o.number_format)}return(0,je.Ol)({numberFormat:n,aggregationType:t.aggregator,userTimeZone:(0,ze.r)(),value:i.aggregationResult,roundDecimal:5})}})}getAggregationActions(){const e=[];for(const r of Ue.o5)e.push(this.createCountAggregationAction(r));const t=this.getDefaultProperties();if(t.length>0)for(const r of Ue.Sy)"show_unique"!==r&&e.push(this.getAggregationGroupAction(r,t));const o=this.getNumericProperties();if(o.length>0)for(const r of Ue.k$)e.push(this.getAggregationGroupAction(r,o));const i=this.getDateProperties();if(i.length>0)for(const r of Ue.f8)e.push(this.getAggregationGroupAction(r,i));const n=this.getCheckboxProperties();if(n.length>0)for(const r of Ue.gC)e.push(this.getAggregationGroupAction(r,n));return e}getAggregationGroupAction(e,t){const{device:o}=this.environment,i=je.VN[e],n=c().compact(t.map((t=>this.createPropertyAggregationAction(t,e))));return{key:e+i,render:(e,t)=>d.createElement(nt.Z,r()({},e,{onFocus:t.onFocus,renderOrigin:(e,t)=>d.createElement(Xe.Z,r()({},e,{ref:t,title:i})),renderExtension:(e,r)=>{let a;return a=o.isMobile?{menuType:Ke.og.Modal,title:i,right:s()(Qe.DoneMenuText,{}),onClickRight:r.close,...e}:{menuType:Ke.og.Popup,width:200,...e},d.createElement($e.Z,a,s()(Je.Z,{type:Je.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>d.createElement(ot.Z,e),items:n}],onAccept:t.onAccept}))}})),action:()=>null}}getDefaultProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ue.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}getNumericProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ue.O4)(o)}))}getDateProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ue.dN)(o)}))}getCheckboxProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ue.Mv)(o)}))}createCountAggregationAction(e){const t=je.VN[e];return{key:e,render:o=>this.renderAggregationMenuItem(e,t,o),action:()=>{this.handleChangeAggregation({aggregator:e})}}}createPropertyAggregationAction(e,t){const o=this.props.schema[e];if(!o)return;const i=o.name;return{key:`${e} ${t}`,render:e=>this.renderAggregationMenuItem(t,i,e),action:()=>{this.handleChangeAggregation({aggregator:t,property:e})}}}}rt.displayName="BoardAggregation";const at=rt;var st=o(70203);function lt(e){const{transaction:t,environment:o,resultsStore:i,collectionContextStore:n,isFullScreen:r,groupsPointer:a,insertAtIndex:s,from:l,transient:c}=e;n.searchQuery.get()&&F.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:r});const{coercionSucceeded:d,newStore:p}=R.IW({environment:o,collectionContextStore:n,groupsPointer:a,results:i.state,insertAtIndex:s||i.state.length,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:l});if(o.device.isMobile)N.navigateToBlock({environment:o,store:p});else if(d){const e=p.getBlockTitleStore();H.eP({environment:o,store:p}),z.NX({store:e}),F.Z5({store:p,transient:c})}else N.peekBlock({environment:o,store:p,peekMode:(0,ee.kr)(n.collectionViewStore()),resultsStore:i,collectionContextStore:n});P.trackCreateBlock(o,{from:l,type:"page",...(0,J.Pn)(n)})}var ct=o(52821);class dt extends u.Z{constructor(){super(...arguments),this.handleClick=()=>{var e,t;const{collectionContextStore:o,isFullScreen:i,groupsPointer:n}=this.props,r=null===(e=o.groupsStore.getGroupState(n))||void 0===e?void 0:e.resultsStore;if(!r)return;const a=null===(t=o.collectionStoresStore.state)||void 0===t?void 0:t[0];Ne.M_(this.environment)&&a&&W.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:this.environment,perform:e=>{lt({transaction:e,environment:this.environment,resultsStore:r,collectionContextStore:o,isFullScreen:i,groupsPointer:n,from:"board_group_add_item_bottom",transient:!1})}})}}renderComponent(){const e=this.theme.lightTextColor;return s()(et.Z,{icon:t=>b.Z.plus({...t,fill:this.props.color||e}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:this.props.color||e},onClick:this.handleClick,onMouseDown:ie.$0},void 0,s()(I.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}))}}dt.displayName="BoardGroupAddItemButton";const pt=dt;var ut=o(49085),mt=o(99036),gt=o(6695),ht=o(95182),ft=o(6404),vt=o(51365),yt=o(9953),bt=o(49616),St=o(68056),wt=o(65598),kt=o(19511),Ct=o(22294),_t=o(27724),Mt=o(24666),Tt=o(87636),It=o(89539),Pt=o(27531),xt=o(41432),Bt=o(80951),Zt=o(95538),Et=o(35328),Rt=o(83907),At=o(71669),Dt=o(81865);class Ft extends u.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t}=this.props,o=Pe.G.createChildStore(t,{table:C.iU,id:e}),i=(0,Rt.h)(o);if(i)return s()(Pt.D,{value:this.restrictedContentStore},void 0,s()(i,{store:o,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,Et.BX)(o),style:{fontSize:12,opacity:.8,pointerEvents:"none"},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))},e))},this.coverStore=this.createComputedStore((()=>{const{store:e}=this.props,t=(0,ee.NU)(e);return t.image?t.image:t.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e}=this.props,t=(0,ee.wK)(e);return t.image?void 0:t.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,o=[];if(c().isArray(t)){let i=0;for(;i<t.length;){let n=t[i],r=Pe.G.createChildStore(e,{table:C.iU,id:n});if(r.getType()===xt.Ti.numberedList){const a=[{blockId:n,idx:1}],s=[{id:n,format:void 0,depth:a.length-1,index:a[0].idx}];for(i+=1;i<t.length&&(n=t[i],r=Pe.G.createChildStore(e,{table:C.iU,id:n}),r.getType()===xt.Ti.numberedList);){{const e=r.getParentId();if(r.getParentId()===a[a.length-1].blockId)a.push({blockId:n,idx:1});else{let t=a[a.length-1].idx;for(;a.length>0&&a[a.length-1].blockId!==e;)t=a[a.length-1].idx,a.pop();a.push({blockId:n,idx:t+1})}s.push({id:n,format:void 0,depth:a.length-1,index:a[a.length-1].idx})}i+=1}o.push(s)}else i+=1}}return o}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?this.renderPageCover():"page_content"===e.type?this.renderPageContent():"property"===e.type?this.renderProperty(e.property):void 0}renderPageCover(){const{store:e}=this.props,t=e.getFormatStore().getKeyStore("page_cover").getValue();return t?s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(Dt.Z,{url:t,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:this.getCoverWidth(),onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),render:(e,t)=>{if(t)return s()(At.Z,{style:{...this.getImageStyle(),...this.getCoverStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()):this.props.isGallery?this.renderEmptyGalleryCover():void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state;if(e){if(!c().isArray(e))return s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(Dt.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:this.getCoverWidth(),render:(e,t)=>{if(t)return s()(At.Z,{style:{...this.getImageStyle(),...this.getPageContentImageStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder());if(e.length>0)return s()("div",{style:this.getContentWrapStyle()},void 0,t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock));if(this.props.isGallery)return this.renderEmptyGalleryCover()}else if(this.props.isGallery)return this.renderEmptyGalleryCover()}renderProperty(e){const{store:t}=this.props,o=(0,Bt.g)(t.getPropertyValue(e)).find((e=>(0,Zt.SR)({url:e.url})));return o?s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(Dt.Z,{onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),url:o.url,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:this.getCoverWidth(),render:(e,t)=>{if(t)return s()(At.Z,{style:{...this.getImageStyle(),...this.getCoverStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()):this.props.isGallery?this.renderEmptyGalleryCover():void 0}renderEmptyGalleryCover(){return s()("div",{style:{height:this.getCoverHeight()}})}renderImageBorder(){return s()("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${this.theme.regularDividerColor}`}})}get imagePosition(){const{coverPosition:e,store:t}=this.props;if((0,It.isNumber)(e))return e;if(t.getFormatStore().isDefined()){const{page_cover_position:e,card_cover_position:o}=t.getFormat();if((0,It.isNumber)(o))return o;if((0,It.isNumber)(e))return e}return.5}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const o of t)if(o.find((t=>t.id===e)))return o;return[]}getImageStyle(){return this.props.style||{}}getCoverHeight(){const{coverHeight:e,coverSizeFormat:t}=this.props;if(e)return e;switch(t){case"large":return Oe.Z.card.desktop.large.height;case"small":return Oe.Z.card.desktop.small.height;case"medium":default:return Oe.Z.card.desktop.medium.height}}getCoverWidth(){const{coverWidth:e,coverSizeFormat:t}=this.props;if(e)return e;switch(t){case"large":return Oe.Z.card.desktop.large.width;case"small":return Oe.Z.card.desktop.small.width;case"medium":default:return Oe.Z.card.desktop.medium.width}}getImageCoverWrapStyle(){return{height:this.getCoverHeight(),position:"relative",pointerEvents:"none",overflow:"hidden"}}getContentWrapStyle(){const{ThemeStore:e}=this.environment,t="dark"===e.state.mode;return{height:this.getCoverHeight(),pointerEvents:"none",overflow:"hidden",background:this.theme.collectionGalleryPreviewCardCover,boxShadow:t?"transparent":`inset 0 -1px 0 0 ${this.theme.regularDividerColor}`,padding:"8px 8px 0"}}getCoverStyle(){return{width:"100%",height:this.getCoverHeight(),objectPosition:"center",borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1}}getCoverAspectStyle(){const{coverAspectFormat:e}=this.props;return{objectFit:void 0===e?"cover":e}}getPageContentImageStyle(){return{...this.getCoverStyle(),objectPosition:"center center"}}}Ft.displayName="CollectionItemCover";const Lt=Ft;var Vt=o(75259),Nt=o(78030),Ot=o(64921),Ut=o(3386),Ht=o(84076),zt=o(31278),Wt=o(49914),jt=o(65187),Kt=o(25155);const Yt=(0,I.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock",description:"Default empty text for Gallery/Board Item with no title"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder",description:"Placeholder text when editing the title of a Gallery/Board Item"}});class Gt extends Ee.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:ke.Z,editModeStore:ut.Z},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:i,handleRepositionClick:n,handleSavePositionClick:a}=e;const{store:l,coverFormat:c,coverAspectFormat:p,collectionContextStore:u}=this.props,{device:m}=this.environment,{isMobile:g}=m,h=this.lastProxiedUrl&&c&&"contain"!==p,f=u.permissionScopes.state,v=l.canEdit()&&("collectionTypedView"===u.contextType||f.canEditContent);if(t&&!this.shouldShowActionButton.state)return;const y=Ie.default.state.open&&Ie.default.state.target.id===l.id,S=ee.kr(null==u?void 0:u.collectionViewStore()),w=(0,bt.X9)(S,!1);return s()(Tt.Z,{isVisible:t,position:"top"},void 0,h&&!o&&!g&&s()(Ot.Z,{style:Wt.Z.actionButtonStyle,onClick:e=>n(e,this.lastProxiedUrl)},void 0,s()(I.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition",description:"Reposition button for repositioning the cover/content of a Gallery/Board Item"})),h&&o&&!g&&s()(Ot.Z,{style:Wt.Z.actionButtonStyle,onClick:a},void 0,s()(I.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition",description:"Save button for repositioning the cover/content of a Gallery/Board Item"})),h&&o&&!g&&s()(Ot.Z,{style:Wt.Z.actionButtonStyle,onClick:i},void 0,s()(I.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel",description:"Cancel button for repositioning the cover/content of a Gallery/Board Item"})),this.shouldShowEditButton.state&&v&&!this.normalizedCardSelectionStore.state&&!f.isSyncedCollection&&s()(it.Z,{renderTooltip:()=>s()(I.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip",description:"Tooltip on edit button that prompts user to edit the card (title and other properties)"}),render:e=>d.createElement(Ot.Z,r()({style:Wt.Z.actionButtonStyle,onClick:()=>{this.handleEditButtonClick("click")}},e),b.Z.pencil({width:16,height:16}))}),this.normalizedCardSelectionStore.state&&!y&&s()(it.Z,{renderTooltip:()=>w.tooltip,render:e=>d.createElement(Ot.Z,r()({style:Wt.Z.actionButtonStyle,onClick:()=>{this.peekUrl.state&&(N.navigate({environment:this.environment,url:this.peekUrl.state}),this.disallowEmptyDelete())}},e),w.icon({width:14,height:14}))}),!o&&s()(it.Z,{renderTooltip:()=>s()(I.FormattedMessage,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip",description:"Tooltip appears when hovering over the action menu button for collection view card items."}),render:e=>d.createElement(Ot.Z,r()({style:Wt.Z.actionButtonStyle,onClick:this.handleActionButtonClick},e),b.Z.dots({width:14,height:14}))}))},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:i,collectionContextStore:n}=this.props,r=t.getAssociatedCollectionStore();if(!r)return;const a=this.normalizedCardSelectionStore.state,l="gallery"===this.getViewType()?Nt.C.GalleryView:Nt.C.Board;return s()(Vt.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:n.permissionScopes.state.isLocked,format:l,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:r,showIfEmpty:a,onEnter:this.handleBlockPropertyEsc,onEsc:this.handleBlockPropertyEsc,onBgClick:this.handleBlockPropertyEsc,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e)},this.renderDiscussionIndicator=()=>{const{store:e}=this.props,t=wt.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return s()("div",{style:this.getDiscussionIndicatorWrapStyle()},void 0,b.Z.speechBubble({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t)},this.handleFlushTemporaryPosition=e=>{let{imagePosition:t,reset:o}=e;W.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{De.bf({store:this.props.store,coverPosition:t,transaction:e}),o()}})},this.handleBlockEnter=()=>{const{store:e,onTextEnter:t}=this.props;t&&t(e)},this.handleBlockSpace=()=>{this.handleEditButtonClick("space")},this.handleEditButtonClick=e=>{const{store:t,collectionContextStore:o}=this.props,{editModeStore:i}=this.stores,n=(0,ct.JI)(t);H.eP({environment:this.environment,store:t}),z.NX({store:n}),F.Z5({store:t}),e&&P.trackCollectionItemEditModeEnter(this.environment,"board_item_edit_mode_enter",{...(0,J.Pn)(o),block_id:t.id,from:e,view_type:this.getViewType()}),i.setState("existing")},this.handleClick=e=>{this.normalizedCardSelectionStore.state?e.preventDefault():(this.props.handleOpenPeekPage(),this.disallowEmptyDelete())},this.handleActionButtonClick=e=>{const{collectionContextStore:t}=this.props;H.Ys({environment:this.environment,store:this.props.store}),ft.Qn({environment:this.environment,stores:_t.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actions:ht.Qi,analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:t}})},this.handleTextEnter=()=>{const{store:e,onTextEnter:t,onTextEsc:o,collectionContextStore:i}=this.props,{editModeStore:n}=this.stores;F.MO(),z.ZH(this.environment);e.canEdit()&&i.permissionScopes.state.canEditContent&&("new_empty"===n.state?o(e):"new"===n.state?t(e):H.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextEsc=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:i}=this.stores;F.MO();e.canEdit()&&o.permissionScopes.state.canEditContent&&("new_empty"===i.state?t(e):H.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=this.getShowProperties();o.length>0&&vt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:o[0],format:Nt.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleTrackTitlePropertyEdit=()=>{const e=this.getViewType();if(!e)return;const{store:t,collectionContextStore:o}=this.props;E.rv({environment:this.environment,collectionContextStore:o,block_id:t.id,property:"title",property_type:"text",from:e}),this.disallowEmptyDelete()},this.handleTextUntab=()=>{const e=this.getShowProperties(),t=c().findLast(e,((e,t)=>this.canOpenProperty(e)));t&&vt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:t,format:Nt.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleBlockPropertyEsc=()=>{vt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),H.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyDelete()},this.handleBlockPropertyTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state,i=this.getShowProperties(),n=o.isOpen?i.findIndex((e=>e===o.property)):-1,r=i.find(((e,t)=>t>n&&this.canOpenProperty(e)))||i.find(((e,t)=>!this.normalizedCardSelectionStore.state&&this.canOpenProperty(e)));r?m.default.afterNextFlush((()=>{vt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:r,format:Nt.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&m.default.afterNextFlush((()=>{this.handleEditButtonClick()})),vt.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleBlockPropertyUntab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state;if(!o.isOpen)return;const i=this.getShowProperties(),n=i.findIndex((e=>e===o.property)),r=c().findLast(i,((e,t)=>t<n&&this.canOpenProperty(e)))||c().findLast(i,((e,t)=>!this.normalizedCardSelectionStore.state&&this.canOpenProperty(e)));r?m.default.afterNextFlush((()=>{vt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:r,format:Nt.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&m.default.afterNextFlush((()=>{this.handleEditButtonClick()})),vt.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleMouseMove=()=>{if(!Se.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=(0,l.throttle)(this.handleMouseMove,100),this.handleMouseLeaveDebounced=(0,l.debounce)(this.handleMouseLeave,100),this.handleRecordIconChange=async e=>{const{store:t}=this.props,o=t.getIconStore();if(o){const{serverCommitResult:t}=W.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:this.environment,perform:t=>{yt.sO({store:o,value:e,transaction:t})}});await t}this.disallowEmptyDelete()},this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:i}=this.stores;"new_empty"!==i.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.getViewType=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();return null==t?void 0:t.getType()},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=kt.Z.state;return e.isActive&&e.store===this.props.store})),this.shouldShowEditButton=this.createComputedStore((()=>{const e=this.isEditingTitle.state,t=this.getVisibleProperties(),o=this.getShowProperties();return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitle=this.createComputedStore((()=>{var e;const t=Mt.default.state;return"editing"===t.mode&&(null===(e=(0,St.QY)(t.multiSelection))||void 0===e?void 0:e.store)===(0,ct.JI)(this.props.store)})),this.peekUrl=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=pe.default.state;return ee.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrl=this.createComputedStore((()=>{const{store:e}=this.props;return(0,oe.ZP)({store:e,fullyQualified:!1})})),this.shouldShowActionButton=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=Ct.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!Se.Z.state)),this.disallowEmptyDelete=()=>{const{editModeStore:e}=this.stores;"new_empty"===e.state&&(e.setState("new"),kt.Z.state.isActive&&kt.Z.setState({...kt.Z.state,transient:!1}))}}activate(){const e=this.peekUrl.state;e&&(this.props.handleOpenPeekPage(),N.navigate({environment:this.environment,url:e}))}willMount(){var e;const{editModeStore:t}=this.stores,o=Mt.default.state,i="editing"===o.mode&&(null===(e=(0,St.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,ct.JI)(this.props.store),n=kt.Z.state,r=n.isActive&&n.transient;i&&r?t.setState("new_empty"):i?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{store:t,schema:o,coverFormat:i,coverAspectFormat:n,coverWidth:r,coverHeight:a,coverSizeFormat:l,shouldShowTitle:c,colorStyle:d,onShiftEnter:p}=this.props,u=this.pageUrl.state,m=this.peekUrl.state,g=this.mouseIsEntered.state,h=this.normalizedCardSelectionStore.state,f=this.getViewType(),v=s()(Ht.Z,{style:{...this.getStyle(),position:g?"relative":"static",..."gallery"===f&&{height:"100%"}},innerStyle:{userSelect:h?void 0:"none",WebkitUserSelect:h?void 0:"none",height:"100%",..."board"===f&&{minHeight:40},..."gallery"===f&&{display:"flex",flexDirection:"column"}},hoveredStyle:{background:h?"transparent":(null==d?void 0:d.cardHoveredBackgroundColor)||this.theme.cardHoveredBackground},pressedStyle:{background:h?"transparent":(null==d?void 0:d.cardPressedBackgroundColor)||this.theme.cardPressedBackground},href:u,metaHref:e.isMobile?u:m,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.handleClick},void 0,s()(Kt.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:this.handleFlushTemporaryPosition,source:f,small:"small"===l,store:this.props.store,renderControl:this.renderControl},void 0,(e=>{let{imagePosition:c}=e;return i&&s()(Lt,{store:t,coverWidth:r,coverHeight:a,coverFormat:i,coverAspectFormat:n,coverSizeFormat:l,coverPosition:c,schema:o,isGallery:"gallery"===f,onLoadProxiedImage:e=>{this.lastProxiedUrl=e}})})),c&&this.renderTitle(),this.renderProperties(),this.renderDiscussionIndicator()),y=_t.default.state.stores.includes(t);return s()(Ut.Z,{capture:h,onEsc:()=>{F.MO(),this.disallowEmptyDelete()},onEnter:this.handleBlockEnter,onSpace:this.handleBlockSpace,onTab:this.handleBlockPropertyTab,onUntab:this.handleEditButtonClick},void 0,s()(Ut.Z,{capture:y,onShiftEnter:()=>{W.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{p({blocks:_t.default.state.stores,transaction:e})}})}},void 0,v))}renderTitle(){const{device:e}=this.environment,{store:t,collectionContextStore:o}=this.props,i=(0,ct.JI)(t),n=t.hasIcon()||!t.isEmptyPage(),r=t.hasError(),a=t.canEdit()&&o.permissionScopes.state.canEditContent,l=this.normalizedCardSelectionStore.state,c=this.getViewType(),d=s()(zt.Z,a?{disabled:!1,bucket:"secure",style:{...this.getRecordIconStyle(),...e.isMobile?Gt.mobileTitleIconStyle:Gt.desktopTitleIconStyle,..."board"===c&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:this.getRecordIconProgressStyle(),icon:t.getIcon(),store:t,onChange:this.handleRecordIconChange,size:e.isMobile?24:20,isEmptyPage:t.isEmptyPage()}:{disabled:!0,bucket:"secure",style:{...this.getRecordIconStyle(),...e.isMobile?Gt.mobileTitleIconStyle:Gt.desktopTitleIconStyle},progressContainerStyle:this.getRecordIconProgressStyle(),icon:t.getIcon(),store:t,size:e.isMobile?24:a?20:18,isEmptyPage:t.isEmptyPage()}),p=s()(jt.Z,{store:i,disabled:!l,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnter,onEsc:this.handleTextEsc,onTab:this.handleTextTab,onUntab:this.handleTextUntab,onChange:this.handleTrackTitlePropertyEdit,placeholder:l?ne.default.formatMessage(Yt.typeAName):ne.default.formatMessage(Yt.untitledBlock),style:{...e.isMobile?Gt.mobileTitleTextStyle:Gt.desktopTitleTextStyle,..."board"===c&&{flexGrow:1,padding:2},pointerEvents:l?void 0:"none",cursor:l?"text":void 0,..."gallery"===c&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline"});return s()("div",{style:this.getTitleWrapStyle()},void 0,(n||l)&&!r&&d,r&&b.Z.warning({fill:this.theme.accentColors.orange[500],width:e.isMobile?20:16,marginLeft:e.isMobile?2:4,marginRight:e.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),p)}renderProperties(){const e=this.getShowProperties();if(0!==e.length)return s()("div",{style:this.getPropertiesWrapStyle()},void 0,e.map(this.renderProperty))}canOpenProperty(e){const{schema:t}=this.props,o=t[e];return Boolean(o&&!mt.uk.includes(o.type))}getVisibleProperties(){const{format:e}=this.props;return(("board"===this.getViewType()?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}getShowProperties(){const{store:e,schema:t}=this.props,o=this.getVisibleProperties();if(!e.isDefined())return[];return o.filter((o=>{const i=this.normalizedCardSelectionStore.state&&"title"!==o.property;return gt.XU({block:e.getModel(),property:o.property,schema:t,getRecordModel:this.props.store.getRecordModel,userTimeZone:(0,ze.r)(),intl:ne.default.getIntl()})||i})).map((e=>e.property))}hasNoProperties(){return 0===this.getShowProperties().length}getStyle(){const{colorStyle:e}=this.props,t=this.getViewType();return{boxShadow:e?this.theme.selectTypeBoardBoxShadow:this.theme.lightBoxShadow,borderRadius:"board"===t?4:3,background:"board"===t?(null==e?void 0:e.cardBackgroundColor)||this.theme.boardItemDefaultBackground:this.theme.collectionGalleryPreviewCardBackground,overflow:"hidden",transition:"background 100ms ease-out",..."board"===t&&{marginBottom:Po}}}getRecordIconStyle(){return{..."board"===this.getViewType()&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}getRecordIconProgressStyle(){return{top:14,bottom:"unset",right:"unset",fontSize:12}}getTitleWrapStyle(){const e=this.getViewType();return{..."gallery"===e&&{width:"100%"},display:"flex",paddingTop:8,paddingLeft:"board"===e?6:10,paddingRight:10,paddingBottom:"gallery"===e&&this.hasNoProperties()?10:6,position:"relative"}}getDiscussionIndicatorWrapStyle(){const e=this.getViewType();return{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fill:this.theme.lightTextColor,fontWeight:M.Z.fontWeight.semibold,fontSize:12,paddingLeft:10,paddingRight:10,paddingBottom:8,..."gallery"===e&&{paddingTop:this.hasNoProperties()&&!this.props.shouldShowTitle?8:0}}}getPropertiesWrapStyle(){const{shouldShowTitle:e}=this.props,t=this.getViewType();return{paddingTop:e?0:8,paddingBottom:10,..."board"===t&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"},..."gallery"===t&&{paddingLeft:6}}}}Gt.desktopTitleIconStyle={float:"left",marginTop:2,marginRight:4,marginLeft:-2},Gt.mobileTitleIconStyle={float:"left",marginTop:0,marginRight:4,marginLeft:-2},Gt.desktopTitleTextStyle={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:M.Z.fontWeight.medium,width:"auto"},Gt.mobileTitleTextStyle={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:M.Z.fontWeight.medium,width:"auto"};const Xt=Gt;class qt extends Ee.Z{renderComponent(){return s()(Xt,{store:this.props.store,disabled:this.props.disabled,isFirstItem:this.props.isFirstItem,isLastItem:this.props.isLastItem,hideContent:this.props.hideContent,blockResizerStore:this.props.blockResizerStore,isQuickFind:this.props.isQuickFind,style:this.props.style,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag,numberedListCounterStore:this.props.numberedListCounterStore,bulletedListFormatStore:this.props.bulletedListFormatStore,format:this.props.format,schema:this.props.schema,coverFormat:this.props.coverFormat,coverAspectFormat:this.props.coverAspectFormat,coverSizeFormat:this.props.coverSizeFormat,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:this.props.shouldShowTitle,colorStyle:this.props.colorStyle,onTextEnter:this.props.onTextEnter,onTextEsc:this.props.onTextEsc,onShiftEnter:this.props.onShiftEnter,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isLast:this.props.isLast,handleOpenPeekPage:this.props.handleOpenPeekPage,collectionContextStore:this.props.collectionContextStore})}}const $t=qt;var Jt=o(73063);class Qt extends u.Z{renderComponent(){const{limit:e}=this.props;return s()(I.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:e.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}}Qt.displayName="FirstLoadLimitSelectOption";const eo=(0,I.injectIntl)(Qt);class to extends u.Z{renderComponent(){const{device:e}=this.environment,{currentLimit:t,onAccept:o,onClose:i,showTitle:n}=this.props,a=[{key:0,render:e=>d.createElement(ot.Z,r()({enableActionSheetTitle:!0,title:n&&s()(I.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"})},e)),items:c().compact(gt.jk.map(((e,i)=>({key:i,render:o=>d.createElement(Xe.Z,r()({},o,{disabled:!1,title:s()(eo,{limit:e}),checkState:c().isEqual(t,e)})),action:()=>o(e)}))))}];let l;return l=e.isMobile?{menuType:Ke.og.ActionSheet}:{menuType:Ke.og.Popup,width:200},d.createElement($e.Z,l,s()(Je.Z,{type:Je.i.Vertical,sections:a,onAccept:i,initialFocus:void 0}))}}to.displayName="FirstLoadLimitSelectMenu";const oo=(0,I.injectIntl)(to);class io extends u.Z{constructor(){super(...arguments),this.renderPopup=e=>s()(oo,{currentLimit:this.getCurrentFirstLoadLimit(),onAccept:this.handleFirstLoadLimitAccept,onClose:e.close,showTitle:!0}),this.handleFirstLoadLimitAccept=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o)return;const i=o.getType();i&&(W.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:this.environment,perform:t=>{De.FH({stores:[o],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),P.trackConfigureView(this.environment,{view_type:i,action:"set_first_load_limit"}))}}renderComponent(){const{device:e}=this.environment;return s()(qe.Z,{popupType:e.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,renderOrigin:e=>d.createElement(Jt.Z,r()({icon:b.Z.dots,style:{marginLeft:4,marginRight:4}},e)),alignmentToOrigin:qe.Z.Alignment.End,placementToOrigin:qe.Z.Placement.Bottom,originGap:8,render:this.renderPopup})}getCurrentFirstLoadLimit(){const{format:e}=this.props;return(0,gt.rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}}io.displayName="FirstLoadLimitActionButton";const no=io;class ro extends u.Z{constructor(){super(...arguments),this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupsPointer:o,incrementLimitsInRelatedGroups:i}=this.props,n=t.groupsStore.getGroupState(o);if(!n)return;const r=n.reducerResultStore.state;(0,ie.Wi)(e),H.ZH(this.environment),r&&t.groupsStore.incrementLimit({isFullScreen:this.props.isFullScreen,currentResultCount:r.blockIds.length,groupsPointer:n.groupsPointer,incrementLimitsInRelatedGroups:i}),P.trackInlineCollectionLoadMoreClick(this.environment)}}renderComponent(){const{style:e,store:t,format:o,collectionContextStore:i,groupsPointer:n}=this.props;if(i.groupsStore.getGroupState(n))return s()(Ot.Z,{onClick:this.handleLoadMoreClick,onMouseDown:ie.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:3,whiteSpace:"break-spaces",fontSize:14,...e}},void 0,b.Z.arrowDown(this.getLoadMoreButtonIconStyle()),s()("div",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})),t.canEdit()&&s()(no,{collectionContextStore:i,format:o}))}getLoadMoreButtonIconStyle(){return{width:14,height:14,marginLeft:4,marginRight:6,fill:this.theme.lightIconColor}}}ro.displayName="CollectionGroupLoadMoreButton";const ao=ro;var so=o(480),lo=o(81954),co=o(24405),po=o(76205),uo=o(59054),mo=o(95371),go=o(77181),ho=o(40150),fo=o(86486),vo=o(48543),yo=o(66094);class bo extends u.Z{constructor(){super(...arguments),this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e,{store:i,collectionContextStore:n,groupsPointer:r}=this.props,a=this.associatedCollectionStore.state;if(!a)return[];const s=this.resultsStore.state;return s?R.$T({environment:this.environment,collectionStore:a,collectionContextStore:n,groupsPointer:r,results:s.state,insertStores:t,store:i,before:!1,transaction:o}):[]},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e,{store:i,collectionContextStore:n,groupsPointer:r}=this.props,a=this.associatedCollectionStore.state;if(!a)return[];const s=this.resultsStore.state;return s?R.$T({environment:this.environment,collectionStore:a,collectionContextStore:n,groupsPointer:r,results:s.state,insertStores:t,store:i,before:!0,transaction:o}):[]},this.handleRemove=e=>{const{store:t,collectionContextStore:o,groupsPointer:i}=this.props,{transaction:n}=e;i.length>0&&R.BN({store:t,transaction:n,groupsPointer:i,collectionContextStore:o,environment:this.environment}),R.Od({store:t,transaction:n})},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:i}=e,{store:n,collectionContextStore:r,groupsPointer:a,subitemPath:s}=this.props,l=this.associatedCollectionStore.state;if(!l)return[];const c=this.resultsStore.state;if(!c)return[];J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:r,is_native_drop:!1,is_empty:!1})})),W.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:this.environment,perform:e=>{R.by({environment:this.environment,collectionStore:l,targetStore:n,droppedDirection:t,collectionContextStore:r,groupsPointer:a,droppedStores:o,results:c.state,duplicate:i,transaction:e,subitemPath:s})}})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{store:i,collectionContextStore:n,groupsPointer:r}=this.props,a=this.associatedCollectionStore.state;if(!a)return[];const s=this.resultsStore.state;if(!s)return[];J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:n,is_native_drop:!0,is_empty:!1})})),W.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:this.environment,perform:e=>{R.tQ({environment:this.environment,collectionStore:a,targetStore:i,droppedDirection:o,collectionContextStore:n,groupsPointer:r,files:t,results:s.state,transaction:e})}})},this.handleInsertRowBelow=e=>{let{transaction:t}=e;const{store:o,collectionContextStore:i,groupsPointer:n,subitemPath:r,blockPropertyValueOverlayStore:a,onSelectableInsertRowBelow:s}=this.props,l=this.associatedCollectionStore.state;if(!l)return[];const c=this.resultsStore.state;if(!c)return[];const d=R.yk({environment:this.environment,collectionContextStore:i,groupsPointer:n,results:c.state,store:o,before:!1,collectionStore:l,transaction:t,subitemPath:r,subitemInsertDirection:"below"});d&&s&&s(o,d),d&&a&&m.default.afterNextFlush((()=>{m.default.afterNextFlush((()=>{vt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:a,store:d,property:"title",format:Nt.C.Table,collectionContextStore:i})}))}))},this.handleOpenPeekPage=()=>{const{collectionContextStore:e,handleOpenPeekPage:t}=this.props,o=e.collectionViewStore();t&&t(),L.Xd({collectionContextStore:e,resultsStore:this.resultsStore.state});const i=null==o?void 0:o.getType();if(i){const e=null==o?void 0:o.getFormat().collection_peek_mode,t=e||vo.Ls[i];P.trackExpandBlock(this.environment,{is_peek:!0,from:i,peek_mode:t})}},this.canEditStore=this.createComputedStore((()=>this.props.store.canEdit())),this.associatedCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore())),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore})),this.shouldShowHighlightHalo=this.createComputedStore((()=>ee.Sc(this.props.store))),this.normalizedCollectionViewSelectionStore=this.createComputedStore((()=>{const e=kt.Z.state;return e.isActive&&e.store===this.props.store}))}renderComponent(){const{store:e,resultProps:t,resultComponent:o,collectionContextStore:i,canDrag:n,canDrop:r,getItemSelectableStyle:a,belowDropZoneMargin:l,analyticsName:c,disabled:p,direction:u,onSelectableEnter:m,disableScrollToRevealHorizontal:g,touchDragOnly:h,isLast:f,groupsPointer:v,toggleButton:y,subitemPath:b,disableSelectable:S}=this.props,w=!p&&this.canEditStore.state,k=this.props.shouldShowHoverMenu&&w,C=u!==_o.Vertical&&r,_=u!==_o.Vertical&&r,M=u===_o.Vertical&&r,T=d.createElement(o,{handleOpenPeekPage:this.handleOpenPeekPage,collectionContextStore:i,...t,store:e,key:e.id,isLast:f,toggleButton:y,subitemPath:b});return S?T:s()(yo.Z,{style:a?a(f):void 0,store:e,canSelect:w,shouldShowHalo:!this.normalizedCollectionViewSelectionStore.state,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,haloStyle:ee.pB(this.shouldShowHighlightHalo.state,this.theme),canDrag:n,canDropBelow:M,canDropLeft:C,canDropRight:_,canNativeDropBelow:M,canNativeDropLeft:C,canNativeDropRight:_,canDropOnto:r,canTriggerContextMenu:w,showBlockMenuInput:!0,shouldShowHoverMenu:k,shouldShowCommentMenu:!1,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,onRemove:this.handleRemove,canInsertAbove:r,canInsertBelow:r,onInsertRowBelow:this.handleInsertRowBelow,belowDropZoneMargin:l,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:c,shouldShowDropZone:r,dropzoneGap:this.props.dropzoneGap,onEnter:m,className:X.K4T,disableScrollToRevealHorizontal:g,touchDragOnly:h,groupsPointer:v},void 0,T)}}bo.displayName="CollectionGroupResultsItem";const So=bo;var wo=o(5210);function ko(e){const{store:t,collectionContextStore:o,subitemPath:i,nestedCreateSubitemButton:n,getItemSelectableStyle:a}=e,{currentSubitemFormatStore:l,searchQuery:c,subitemExpandedStore:p,subitemTreeStore:u}=o,m=(0,lo.VK)((()=>t.getAssociatedCollectionStore()),[t]),g=(0,lo.VK)((()=>i&&i.length>0?i:(0,mo.DY)(u.state.children,(e=>e.value.store===t))),[i,u,t]),h=g?(0,go.Af)(g.map((e=>e.value.store))):"",f=(0,lo.VK)((()=>p.get().get(h)),[p,h]),v=Boolean(null==f?void 0:f.isExpanded),y=(0,so.O7)(),b=(0,lo.VK)((()=>{const e=l.state,i=c.get();if(!e||i&&!y.device.isMobile||!m)return!1;return(0,go.kC)({store:t,collectionStore:m,subitemFormat:e,subitemPathKey:h,collectionContextStore:o,propertyFilters:o.currentPropertyFiltersStore.state,combinatorFilter:o.currentCombinatorFilterStore.state,currentUserId:y.currentUser.id}).length>0||v}),[l,v,m,c,t,h,o,y]),[S]=(0,lo.AF)(fo.default),w=S.isOpen&&S.currentStore===t,k=(0,lo.VK)((()=>{const e=(0,q.m1)({collectionContextStore:o,environment:y});if(e)return(0,po.q)(e)}),[o,y]),C=(0,lo.VK)((()=>{const e=l.state;if(!e||!m)return;const t=m.getSchema()[e.property];return void 0!==t&&(0,mt.p_)(t)?t:void 0}),[l,m]),_=(0,d.useCallback)((()=>{const e=p.get();if(v)e.delete(h),P.trackTableSubitemToggleClose(y,{...(0,J.Pn)(o),depth:(null==g?void 0:g.length)||0}),p.emit();else{e.set(h,{isExpanded:!0,limit:20}),P.trackTableSubitemToggleOpen(y,{...(0,J.Pn)(o),depth:(null==g?void 0:g.length)||0});const i=l.state;k&&e&&C&&i?(0,go.fd)({blockStore:t,subitemExpandedStore:p,subitemFormat:i,propertySchema:C,compiledFilter:k,pathKey:h,forceStoresToLoad:!1,visitedIds:new Set}).then((()=>{p.emit()})):p.emit()}}),[k,p,v,h,o,l,y,g,t,C]),M=(0,lo.VK)((()=>{const o=u.state;return o&&g?(0,go.Ns)(o).value.store===t:e.isLast}),[u,e.isLast,t,g]),T=(0,lo.VK)((()=>{var e;const o=t.getModel(),i=t.getRecordModel;if(!k||!o)return!0;const n=null===(e=t.getParentCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return k({block:o,getRecordModel:i,propertyMapping:n})}),[k,t]),I=(0,lo.VK)((()=>a&&!T?()=>({...a?a(M):{},...T?{}:{opacity:.5}}):a),[a,T,M]);(0,uo.r5)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel,i=l.state;if(!b||!e||!k||!C||!o||!i||T)return;(0,go.xb)({store:t,subitemFormat:i,propertySchema:C}).length>0||(await(0,go.fd)({blockStore:t,subitemExpandedStore:p,subitemFormat:i,propertySchema:C,compiledFilter:k,pathKey:h,forceStoresToLoad:!0,visitedIds:new Set}),p.emit())}),[b,k,l,T,h,t,p,C]);const x=(0,co.Fg)(),B=d.createElement(So,r()({},e,{isLast:M,getItemSelectableStyle:I,subitemPath:g,toggleButton:(b||w)&&s()(wo.Z,{isSidebar:!1,open:v,fill:!0,onClick:_,color:b?x.regularIconColor:x.mediumIconColor,style:{},disabled:g&&g.length>=go.F0})}));if(!v||!g||0===g.length||g.length>=go.F0)return B;const Z=g[g.length-1].children;return d.createElement(d.Fragment,null,B,Z.map((t=>{const o=t.value.store;return d.createElement(ko,r()({},e,{key:o.id,store:o,subitemPath:[...g,t]}))})),m&&n&&n({store:t,parentStore:m,subitemPath:g,indentLevel:g.length}),f&&Z.length>0&&Z.length===f.limit&&s()(Co,{collectionContextStore:e.collectionContextStore,pathKey:h,limit:f.limit,indentLevel:g.length}))}function Co(e){window.__c={n:"NestedTableLoadMoreButton"};const{collectionContextStore:t,pathKey:o,limit:i,indentLevel:n}=e,r=(0,d.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.get().set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),a=(0,so.O7)(),l=(0,lo.VK)((()=>(0,ee.fk)({environment:a,collectionContextStore:t})),[t,a]),c=(0,co.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:4+(0,ho.f2)({columnIndex:0,shouldShowBulkActionsToolbar:l,indentLevel:n+1}),fontSize:14,lineHeight:M.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground,left:0,right:0},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[n,l]);return s()(Ot.Z,{onClick:r,onMouseDown:ie.$0,style:c.button},void 0,b.Z.arrowDown(c.icon),s()("span",{style:c.label},void 0,s()(I.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})))}let _o;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(_o||(_o={}));class Mo extends u.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.renderResult=(e,t,o)=>{const i=t===o.length-1,{collectionContextStore:n,resultProps:r,resultComponent:a,groupsPointer:l,shouldShowHoverMenu:c,canDrag:d,disabled:p,format:u,getItemSelectableStyle:m,handleOpenPeekPage:g,belowDropZoneMargin:h,analyticsName:f,direction:v,onSelectableEnter:y,canDrop:b,disableScrollToRevealHorizontal:S,touchDragOnly:w,blockPropertyValueOverlayStore:k,onSelectableInsertRowBelow:C,disableSelectable:_,nestedCreateSubitemButton:M}=this.props;if(e.getAssociatedCollectionStore())return s()(ko,{getItemSelectableStyle:m,store:e,canDrag:d,resultProps:r,resultComponent:a,collectionContextStore:n,groupsPointer:l,shouldShowHoverMenu:c,canDrop:b&&!p,format:u,handleOpenPeekPage:g,belowDropZoneMargin:h,analyticsName:f,disabled:p,direction:v,dropzoneGap:this.props.dropzoneGap,onSelectableEnter:y,disableScrollToRevealHorizontal:S,touchDragOnly:w,isLast:i,subitemPath:[],blockPropertyValueOverlayStore:k,onSelectableInsertRowBelow:C,disableSelectable:_,nestedCreateSubitemButton:M},e.id)},this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:i}=e,{collectionContextStore:n,groupsPointer:r}=this.props,a=this.emptyDroppableIntoStore.state;if(!a)return;const s=n.collectionViewBlockStore();s&&(J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:n,is_native_drop:!1,is_empty:!0})})),W.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{R.by({environment:this.environment,collectionStore:a,targetStore:s,droppedDirection:t,collectionContextStore:n,groupsPointer:r,droppedStores:o,results:this.resultStores.state,duplicate:i,transaction:e})}}))},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:i,groupsPointer:n}=this.props,r=this.emptyDroppableIntoStore.state;if(!r)return;const a=i.collectionViewBlockStore();a&&(J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:i,is_native_drop:!0,is_empty:!0})})),W.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{R.tQ({environment:this.environment,collectionStore:r,targetStore:a,droppedDirection:o,collectionContextStore:i,groupsPointer:n,files:t,results:this.resultStores.state,transaction:e})}}))},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,i=e.groupsStore.getGroupState(t);if(!i)return;const n=i.currentLimit.get(),r=e.normalizedSchemaStore.state,a=c().compact(t.map((e=>(0,He.Ko)({schema:r,group:e,timeZone:(0,ze.r)()}))));return{type:"results",filter:a.length>0?{operator:"and",filters:a}:void 0,limit:n,loadContentCover:o}})),this.resultStores=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props;var o,i;return"collectionTypedView"===e.contextType?null===(o=e.groupsStore.getGroupState(t))||void 0===o||null===(i=o.resultsStore.state)||void 0===i?void 0:i[0].getAssociatedCollectionStore():e.collectionStore()}))}getNode(){return super.getNode()}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new Pe.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t}=this.props,o=this.props.emptyDroppableSize||"none",i=t===_o.Vertical;return d.createElement(d.Fragment,null,s()("div",{style:{...i?{height:o}:{width:o},...e}},void 0,this.renderEmptyDroppable()),this.resultStores.state.map(this.renderResult),this.renderReducerRequest())}renderReducerRequest(){const{collectionContextStore:e,groupsPointer:t,disableRequest:o}=this.props;if(o)return;const i=this.resultsReducerStore.state;if(!i)return;const n=e.groupsStore.getGroupState(t);return n?s()(Ge.Z,{id:t.length>0?`results:${t.map(Re.mD).join(":")}`:"collection_group_results",reducer:i,collectionContextStore:e,resultStore:n.reducerResultStore}):void 0}renderEmptyDroppable(){const{disabled:e,analyticsName:t,direction:o,onSelectableEnter:i,canDrop:n,groupsPointer:r}=this.props;if(this.instanceCollectionViewBlockStore){const a=o!==_o.Vertical&&(!e&&0===this.resultStores.state.length),l=o===_o.Vertical&&!e;return s()(yo.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!0,canDrag:!1,canDropLeft:n&&a,canNativeDropLeft:n&&a,canDropBelow:n&&l,canNativeDropBelow:n&&l,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:t,shouldShowDropZone:n,onEnter:i,groupsPointer:r,style:o===_o.Vertical?void 0:{width:"100%",height:"100%"}})}}}Mo.displayName="CollectionGroupResults";const To=Mo;var Io=o(43145);const Po=5;function xo(e){return e?8:12}class Bo extends u.Z{constructor(){super(...arguments),this.isReady=this.createComputedStore((()=>{const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return Boolean(null==o?void 0:o.reducerResultStore.state)})),this.handleGroupMouseDown=e=>{const{device:t}=this.environment;t.isMobile||(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{e.preventDefault(),V.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleGroupClick=e=>{(0,ie.ZP)({event:e,context:ie.Af.EditorClick,callback:()=>{}})},this.handleItemEnter=e=>{const{blocks:t,transaction:o}=e,{groupsPointer:i,collectionContextStore:n,isFullScreen:r}=this.props;if(0===t.length)return;const a=t[0];if(!Ne.M_(this.environment)||!n.collectionStore()||!n.shouldAllowNewItemCreation())return;const s=this.getResultsStore();if(!s)return;const l=s.state.findIndex((e=>e===a))+1;lt({transaction:o,environment:this.environment,resultsStore:s,collectionContextStore:n,isFullScreen:r,groupsPointer:i,insertAtIndex:l,from:"board_group_enter_add_item",transient:!0})},this.handleItemTextEnter=e=>{const{groupsPointer:t,collectionContextStore:o,isFullScreen:i}=this.props;if(!Ne.M_(this.environment)||!o.collectionStore())return this.handleItemTextEsc(e);const n=this.getResultsStore();if(!n)return;const r=n.state.findIndex((t=>t===e))+1;W.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:this.environment,perform:e=>{lt({transaction:e,environment:this.environment,resultsStore:n,collectionContextStore:o,isFullScreen:i,groupsPointer:t,insertAtIndex:r,from:"board_group_enter_add_item",transient:!0})}})},this.handleItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),i=e.getTitleStore();if(!i)return;if(st.Q(i.getValue()))H.Ys({environment:this.environment,store:e});else if(o){const{store:t,collectionContextStore:o}=this.props,i=this.getResultsStore();if(!i)return;const n=i.state.findIndex((t=>t===e))-1,r=o.collectionViewStore(),a=o.collectionViewBlockStore();if(r&&a&&P.trackDeleteNewlyCreatedBoardItem(this.environment,{...(0,J.Pn)(o),block_id:t.id}),W.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:this.environment,perform:t=>{R.Od({store:e,transaction:t})}}),n>=0){const e=i.state[n];H.Ys({environment:this.environment,store:e})}}},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o,groupsPointer:i}=this.props,n=t.isLoading.get(),r=t.groupsStore.getGroupState(i),a=null==r?void 0:r.reducerResultStore.get();e<ge.Z.incrementScrollOffset&&!n&&a&&a.hasMore&&t.groupsStore.incrementLimit({isFullScreen:o,currentResultCount:a.blockIds.length,groupsPointer:i,incrementLimitsInRelatedGroups:!1})},this.handleMouseMove=()=>{const e=c().last(this.props.groupsPointer);e&&this.props.hoveredGroupStore.get()!==e&&this.props.hoveredGroupStore.set(e)},this.colorStore=this.createComputedStore((()=>{const{groupsPointer:e,schema:t,format:o,collectionContextStore:i}=this.props,n=c().last(e);return(0,Fe.II)({environment:this.environment,groupFormat:n,schema:t,format:o,collectionContextStore:i,theme:this.theme})}),!0)}renderComponent(){var e;const{store:t,groupsPointer:o,collectionContextStore:i,disabled:n,format:r,schema:a,blockPropertyValueOverlayStore:l,isFullScreen:c}=this.props,p=i.groupsStore.getGroupState(o);if(!p)return;const u=this.isReady.state,m=this.getCoverFormat(),g=(0,ee.az)(i,c),h=p.reducerResultStore.state,f=i.permissionScopes.state,v=!n&&u&&i.shouldAllowNewItemCreation(),y=!n&&!f.isSyncedCollection,b=(0,ee.VM)({reducerResult:h,collectionContextStore:i,isFullScreen:c}),S=Boolean(r.collection_group_by);return s()("div",{style:this.getStyle(),onMouseDown:this.handleGroupMouseDown,onClick:this.handleGroupClick,className:X.GfL,onMouseMove:this.handleMouseMove},void 0,s()(To,{collectionContextStore:i,groupsPointer:o,format:r,canDrag:y,onSelectableEnter:this.handleItemEnter,resultProps:{format:r,schema:a,onTextEnter:this.handleItemTextEnter,onShiftEnter:this.handleItemEnter,coverFormat:m,coverAspectFormat:this.getCoverAspectFormat(),coverSizeFormat:this.getCoverSizeFormat(),shouldShowTitle:ct.K8(this.props.format,"board"),colorStyle:this.colorStore.state,onTextEsc:this.handleItemTextEsc,disabled:n,blockPropertyValueOverlayStore:l,collectionContextStore:i},canDrop:!0,resultComponent:$t,disabled:n,direction:_o.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:S?Po:3,analyticsName:"board",loadContentCover:m&&"page_content"===m.type}),b&&s()(ao,{groupsPointer:o,store:t,collectionContextStore:i,format:r,isFullScreen:c,incrementLimitsInRelatedGroups:!0}),v&&d.createElement(d.Fragment,null,b&&s()("div",{style:{width:"100%",borderTop:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),s()(pt,{groupsPointer:o,collectionContextStore:i,isFullScreen:c,color:null===(e=this.colorStore.state)||void 0===e?void 0:e.textColor})),!g&&s()(Io.Z,{onChange:this.handleScrollOffsetChange}))}getCoverFormat(){const{format:e}=this.props;return e?e.board_cover:void 0}getCoverAspectFormat(){const{format:e}=this.props;return e?e.board_cover_aspect:void 0}getCoverSizeFormat(){const{format:e}=this.props;return e?e.board_cover_size:void 0}getGalleryCardWidth(){const{format:e}=this.props;switch((e||{}).board_cover_size){case"large":return Oe.Z.card.desktop.large.width;case"small":return Oe.Z.card.desktop.small.width;case"medium":default:return Oe.Z.card.desktop.medium.width}}getStyle(){const{format:e}=this.props,t=this.isReady.state,o=this.colorStore.state,i=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:Po,paddingRight:Po,paddingBottom:Po,marginRight:10,boxSizing:"content-box",width:this.getGalleryCardWidth(),height:i?void 0:"max-content",...o&&t&&{backgroundColor:this.props.isInPeekRenderer?o.peekBackgroundColor:o.backgroundColor,...i?{borderRadius:5}:{borderBottomLeftRadius:5,borderBottomRightRadius:5}}}}getResultsStore(){const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}}Bo.displayName="BoardGroupResults";const Zo=(0,I.injectIntl)(Bo);var Eo=o(8848),Ro=o(47307),Ao=o(33846),Do=o(93405),Fo=o(9050);class Lo extends u.Z{constructor(){super(...arguments),this.storeTypes={inputStore:Ao.Z},this.handleSelectPropertyColorPickerChange=e=>{const{groupFormat:t,schema:o,collectionContextStore:i}=this.props,n=o[t.property];if(!n)return;if(!mt.cu(n))return;const r=i.collectionStore();if(!r)return;const a=t.value;if(a.type!==n.type)return;const s=(n.options||[]).map((t=>t.value===a.value?{...t,color:e}:t)),l={...n,options:s},c={...o,[t.property]:l};W.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:this.environment,perform:e=>{F.Rm({environment:this.environment,collectionStore:r,update:{schema:c},transaction:e})}}),P.trackConfigureView(this.environment,{view_type:this.getCurrentViewType(),action:"group_change_color"})},this.handleHide=()=>{const{groupFormat:e,collectionContextStore:t,groupsFormatKey:o,currentGroups:i}=this.props,n={...e,hidden:!0},r=(0,Fe.ar)(i,n);W.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:this.environment,perform:e=>{R.A6({collectionContextStore:t,newGroups:r,groupsFormatKey:o,transaction:e})}}),P.trackConfigureView(this.environment,{view_type:this.getCurrentViewType(),action:"hide_group"})},this.handleShow=()=>{const{groupFormat:e,collectionContextStore:t,groupsFormatKey:o,currentGroups:i,groupsLimitStore:n}=this.props,r={...e,hidden:!1},a=(0,Fe.nr)(i,r,n.get());W.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:this.environment,perform:e=>{R.A6({collectionContextStore:t,newGroups:a,groupsFormatKey:o,transaction:e})}}),P.trackConfigureView(this.environment,{view_type:this.getCurrentViewType(),action:"show_group"})},this.handleDelete=()=>{Ro.showDialog({message:s()(I.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage",description:"Confirmation dialog message when deleting a group."}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:this.handleDeleteAccept}]})},this.handleDeleteAccept=async()=>{const{collectionContextStore:e,currentGroups:t,groupFormat:o,groupsFormatKey:i,intl:n}=this.props,r=e.collectionStore();if(!r)return;const a=o.value;if("relation"===a.type&&(0,Re.RA)(a.value)){const e=Pe.G.createChildStore(r,{id:a.value.id,table:C.iU});await e.load();const t=e.getParentCollectionStore();await(null==t?void 0:t.load())}W.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:this.environment,perform:a=>{R.iE({environment:this.environment,collectionStore:r,property:o.property,groupFormat:o,currentGroups:t,groupsFormatKey:i,collectionContextStore:e,transaction:a,intl:n})}}),P.trackConfigureView(this.environment,{view_type:this.getCurrentViewType(),action:"delete_group"})}}renderComponent(){const{device:e}=this.environment,{parent:t}=this.props,o=c().compact([this.getGroupActionsSection(),this.getSelectColorSection()]);let i;return i=e.isMobile?{menuType:Ke.og.Modal,title:s()(I.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:s()(Qe.DoneMenuText,{}),onClickRight:t.close}:{menuType:Ke.og.Popup},d.createElement($e.Z,i,s()(Je.Z,{type:Je.i.Vertical,initialFocus:0,sections:o,onAccept:e=>{"string"==typeof e.key&&e.key.includes(Lo.colorActionKeyPrefix)||t.close()}}))}getGroupActionsSection(){const{groupFormat:e,collectionContextStore:t}=this.props,o=[],i=e.value,n=t.permissionScopes.state;(0,Re.eF)(e)?o.push({key:"show",render:e=>d.createElement(Do.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Show",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:b.Z.collectionShow})),action:this.handleShow}):o.push({key:"hide",render:e=>d.createElement(Do.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Hide",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:b.Z.collectionHide})),action:this.handleHide}),void 0!==i.value&&n.canEditContent&&!n.isSyncedCollection&&"collectionTypedView"!==t.contextType&&o.push({key:"delete",render:e=>d.createElement(Do.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:b.Z.trash})),action:this.handleDelete});return{key:"collection group",render:e=>d.createElement(ot.Z,e),items:o}}getSelectColorSection(){const{schema:e,groupFormat:t}=this.props,o=t.value;if(void 0===o.value)return;const i=e[t.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(o.type!==i.type)return;const n=(i.options||[]).find((e=>e.value===o.value));if(!n)return;return{key:"collection color section",render:e=>d.createElement(ot.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0})),items:Eo.AP.map((e=>({key:`${Lo.colorActionKeyPrefix}_${e}`,render:t=>d.createElement(Fo.Z,r()({},t,{color:e,checkState:n.color===e})),action:()=>{this.handleSelectPropertyColorPickerChange(e)}})))}}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}}Lo.displayName="CollectionGroupActionMenu",Lo.colorActionKeyPrefix="color";const Vo=(0,I.injectIntl)(Lo);var No=o(38769);class Oo extends u.Z{constructor(){super(...arguments),this.renderActionMenu=e=>{const{groupFormat:t,currentGroups:o,format:i,schema:n,collectionContextStore:r}=this.props;return s()(Vo,{parent:e,groupFormat:t,currentGroups:o,format:i,schema:n,collectionContextStore:r,groupsFormatKey:"board_columns",groupsLimitStore:r.boardColumnsLimit})},this.handleCollectionGroupValueChange=e=>{const{collectionContextStore:t,...o}=this.props,i=t.collectionStore();i&&(R.w$({...e,environment:this.environment,groupsFormatKey:"board_columns",collectionStore:i,collectionContextStore:t,...o}),E.wd({environment:this.environment,collectionContextStore:t,action:"rename_group"}))},this.handleAddItemClick=()=>{var e;const{device:t}=this.environment;if(!Ne.M_(this.environment))return;const{format:o,groupFormat:i,onAddItem:n,collectionContextStore:r,isFullScreen:a}=this.props,s=Boolean(o.collection_group_by);r.searchQuery.get()&&F.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:a});const l=null===(e=r.collectionStoresStore.state)||void 0===e?void 0:e[0],c=r.groupsStore.getGroupState(i);if(!l||!c)return;const d=c.resultsStore;W.createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:this.environment,perform:e=>{const{coercionSucceeded:o,newStore:a}=R.IW({environment:this.environment,collectionContextStore:r,groupsPointer:[i],results:d.state,insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:e,from:"board_group_header"});if(t.isMobile){const e=(0,oe.ZP)({store:a});this.navigate(e)}else if(o&&!s){const e=a.getBlockTitleStore();H.eP({environment:this.environment,store:a}),z.NX({store:e}),F.Z5({store:a})}else N.peekBlock({environment:this.environment,store:a,peekMode:(0,ee.kr)(r.collectionViewStore()),resultsStore:d,collectionContextStore:r});n&&n(a),P.trackCreateBlock(this.environment,{from:"board_group_add_item_top",type:"page",...(0,J.Pn)(r)})}})},this.handleAggregationChange=e=>{const{collectionContextStore:t,query:o}=this.props,i=t.collectionViewStore(),n={...o,aggregations:e?[e]:[]};i&&W.createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:this.environment,perform:e=>{F.iG({collectionViewStore:i,update:{query2:n},transaction:e})}})},this.handleMouseMove=()=>{this.props.hoveredGroupStore.get()!==this.props.groupFormat&&this.props.hoveredGroupStore.set(this.props.groupFormat)},this.colorStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o,collectionContextStore:i}=this.props;return(0,Fe.II)({environment:this.environment,groupFormat:e,schema:t,format:o,collectionContextStore:i,theme:this.theme})}),!0),this.isHoveredStore=this.createComputedStore((()=>(0,Re.ZH)(this.props.hoveredGroupStore.state,this.props.groupFormat)))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.navigate({environment:this.environment,url:e})}renderComponent(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state,i=t.shouldAllowNewItemCreation();return s()("div",{style:this.getStyle(),onMouseMove:this.handleMouseMove},void 0,this.renderValue(),this.renderAggregation(),s()("div",{style:{flexGrow:1}}),!e&&o.canConfigureBlock&&this.renderActionButton(),i&&this.renderAddButton())}renderAggregation(){const{disabled:e,query:t,schema:o,collectionContextStore:i,groupFormat:n}=this.props,r=t.aggregations?t.aggregations[0]:void 0,a=i.permissionScopes.state;return s()(at,{groupFormat:n,disabled:e||!a.canConfigureBlock,aggregation:r,schema:o,collectionContextStore:i,color:this.getTextColor(),onChange:this.handleAggregationChange})}renderValue(){const{groupFormat:e,schema:t,disabled:o,currentGroups:i,format:n,groupBy:r,collectionContextStore:a}=this.props,l=Uo(n),c=a.permissionScopes.state;if(a.groupsStore.getGroupState(e))return s()(No.Z,{groupBy:r,groupFormat:e,currentGroups:i,schema:t,disabled:o||!c.canConfigureBlock,isHiddenGroup:!1,onChange:this.handleCollectionGroupValueChange,style:{maxWidth:l-70},collectionContextStore:a})}renderActionButton(){const{device:e}=this.environment;return s()(qe.Z,{popupType:e.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,renderOrigin:e=>d.createElement(Jt.Z,r()({icon:b.Z.dots,iconStyle:{fill:this.getTextColor()},style:this.getIconButtonStyle()},e)),render:this.renderActionMenu})}renderAddButton(){var e;const{collectionContextStore:t,intl:o}=this.props,i=null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri,n=(0,f.hf)(i);return s()(it.Z,{renderTooltip:()=>s()(I.FormattedMessage,{defaultMessage:"Create new {newItemName}",values:{newItemName:o.formatMessage(n)},description:"Tooltip for a button that lets users add items to a board. The newItemName will be `page` by default, but if the collection is typed, it will be a name corresponding to the type of the collection (e.g. `doc`)",id:"database.boardView.actions.addNewItem.tooltip"}),render:e=>d.createElement(Jt.Z,r()({icon:b.Z.plus,onClick:this.handleAddItemClick,style:this.getIconButtonStyle(),iconStyle:{fill:this.getTextColor()}},e))})}getStyle(){const{hidden:e,format:t}=this.props,{device:o}=this.environment,i=Uo(t),n=this.colorStore.state,r=Boolean(t.collection_group_by);return{display:"flex",alignItems:"center",fontSize:14,width:i,paddingLeft:Po,paddingRight:Po,marginRight:10,marginBottom:e?4:0,boxSizing:"content-box",flexShrink:0,cursor:"pointer",...this.props.isPopup&&{padding:o.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:i},...n&&!e&&{backgroundColor:this.props.isInPeekRenderer?n.peekBackgroundColor:n.backgroundColor,...r?{borderRadius:5}:{borderTopLeftRadius:5,borderTopRightRadius:5}}}}getTextColor(){const e=this.colorStore.state;return!this.props.hidden&&e?e.textColor:this.theme.lightTextColor}getIconButtonStyle(){const{hidden:e}=this.props;if(!e)return{transition:"opacity 100ms ease-in-out",opacity:this.isHoveredStore.state?1:0}}}function Uo(e){switch((e||{}).board_cover_size){case"large":return Oe.Z.card.desktop.large.width;case"small":return Oe.Z.card.desktop.small.width;case"medium":default:return Oe.Z.card.desktop.medium.width}}Oo.displayName="BoardGroupHeader",Oo.contextTypes={...K.wK,...u.w};const Ho=Oo;class zo extends ut.Z{getInitialState(){return{searchQuery:"",limit:zo.defaultLimit}}}zo.defaultLimit=20,zo.loadMoreScrollOffset=200,zo.loadMoreIncrement=20;const Wo=zo;var jo=o(72087),Ko=o(21199),Yo=o(68894),Go=o(68785),Xo=o(43765),qo=o(37064);const $o=(0,I.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}});class Jo extends u.Z{constructor(){super(...arguments),this.createdStores=new Set,this.storeTypes={buttonPopupStore:ue.Z,boardHiddenGroupStore:Wo,requestStore:jo.Z},this.renderPopup=()=>{const{device:e}=this.environment,{groupFormat:t,schema:o,currentGroups:i,collectionContextStore:n,groupBy:a}=this.props;let l;l=e.isMobile?{menuType:Ke.og.Modal,title:s()(No.Z,{groupBy:a,groupFormat:t,currentGroups:i,schema:o,disabled:!0,isHiddenGroup:!0,collectionContextStore:n}),left:s()(qe.Z,{popupType:tt.kQ.SlideUp,renderOrigin:e=>d.createElement("div",e,b.Z.dots({width:18,height:18,color:this.theme.lightTextColor})),render:this.renderActionButtonPopup}),right:s()(Qe.DoneMenuText,{}),onClickRight:this.handlePopupClose,header:this.renderHeader()}:{menuType:Ke.og.Popup,header:this.renderHeader()};const c=this.reducerStore.state;if(c)return s()(qo.Z,{store:this.selectableBlockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:o}=e;return d.createElement($e.Z,r()({},l,o),s()(Ge.Z,{id:`board_hidden_group:${(0,Re.mD)(t)}`,reducer:c,collectionContextStore:n,resultStore:this.reducerResultStore(),render:this.renderResults}),s()(Io.Z,{onChange:this.handleScrollOffsetChange}))}})},this.renderResults=()=>{var e,t;const{device:o}=this.environment,{groupFormat:i,disabled:n,format:r,collectionContextStore:a,schema:l,blockPropertyValueOverlayStore:c}=this.props,d=null===(e=this.reducerResultStore())||void 0===e?void 0:e.state,p=null===(t=this.resultsStore())||void 0===t?void 0:t.state;return d&&p?0===p.length?s()(ot.Z,{},void 0,s()(Xo.Z,{title:s()(I.FormattedMessage,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})):s()("div",{style:{padding:o.isMobile?"8px 16px":"6px 14px 8px"}},void 0,s()(To,{collectionContextStore:a,groupsPointer:[i],format:r,canDrag:!n,onSelectableEnter:this.handleBoardItemEnter,disableRequest:!0,resultProps:{format:r,schema:l,disabled:n,coverFormat:this.getCoverFormat(),coverAspectFormat:this.getCoverAspectFormat(),coverSizeFormat:this.getCoverSizeFormat(),shouldShowTitle:ct.K8(this.props.format,"board"),colorStyle:void 0,blockPropertyValueOverlayStore:c,onTextEnter:this.handleBoardItemTextEnter,onTextEsc:this.handleBoardItemTextEsc,onShiftEnter:this.handleBoardItemEnter,collectionContextStore:a},resultComponent:$t,handleOpenPeekPage:Ie.default.isSidePeekOpen()?void 0:this.handlePopupClose,canDrop:!0,disabled:n,shouldShowHoverMenu:!1,direction:_o.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})):s()(ot.Z,{},void 0,s()(Xo.Z,{title:s()(Go.Z,{})}))},this.renderActionButtonPopup=e=>{const{groupFormat:t,currentGroups:o,format:i,schema:n,collectionContextStore:r}=this.props;if(r.collectionStore())return s()(Vo,{parent:e,groupFormat:t,currentGroups:o,format:i,schema:n,collectionContextStore:r,groupsFormatKey:"board_columns",groupsLimitStore:r.boardColumnsLimit})},this.handlePopupClose=()=>{this.stores.buttonPopupStore.setState({open:!1})},this.handleSearchInputChange=e=>{this.stores.boardHiddenGroupStore.setState({searchQuery:e.target.value,limit:Wo.defaultLimit}),this.clearSelectionIfBlockIsSelected()},this.handleSearchClearButtonClick=()=>{this.stores.boardHiddenGroupStore.reset(),this.clearSelectionIfBlockIsSelected()},this.handleButtonPopupClick=()=>{this.stores.boardHiddenGroupStore.reset(),this.clearSelectionIfBlockIsSelected()},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:i,groupFormat:n}=this.props,r=p.findDOMNode(this);r&&r instanceof Element&&W.createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:this.environment,perform:e=>R.BO({environment:this.environment,collectionContextStore:i,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e})})},this.handleBoardAggregationChange=e=>{const{collectionContextStore:t,query:o}=this.props,i=t.collectionViewStore(),n={...o,aggregations:e?[e]:[]};i&&W.createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:this.environment,perform:e=>{F.iG({collectionViewStore:i,update:{query2:n},transaction:e})}})},this.handleBoardGroupHeaderAddItem=e=>{this.createdStores.add(e)},this.handleScrollOffsetChange=e=>{var t,o;const{collectionContextStore:i}=this.props,{boardHiddenGroupStore:n}=this.stores,r=n.state,a=null===(t=this.reducerResultStore())||void 0===t||null===(o=t.get())||void 0===o?void 0:o.blockIds,s=i.isLoading.get();e<Wo.loadMoreScrollOffset&&!s&&a&&r.limit<=a.length&&n.setState({...r,limit:r.limit+Wo.loadMoreIncrement})},this.handleBoardItemEnter=e=>{const{blocks:t,transaction:o}=e,{groupFormat:i,collectionContextStore:n,isFullScreen:r}=this.props,a=n.groupsStore.getGroupState(i);if(!a)return;const s=a.resultsStore;if(t.length>0&&s.state.length>0){const e=t[0];if(!Ne.M_(this.environment)||!n.collectionStore()||!n.shouldAllowNewItemCreation())return;const a=s.state.findIndex((t=>t===e))+1;lt({transaction:o,environment:this.environment,resultsStore:s,collectionContextStore:n,isFullScreen:r,groupsPointer:[i],insertAtIndex:a,from:"board_group_enter_add_item",transient:!0})}},this.handleBoardItemTextEnter=e=>{const{collectionContextStore:t,isFullScreen:o,groupFormat:i}=this.props,n=this.resultsStore();if(!n)return;if(!Ne.M_(this.environment)||!t.collectionStore())return this.handleBoardItemTextEsc(e);const r=n.state.findIndex((t=>t===e))+1;W.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:this.environment,perform:e=>{lt({transaction:e,environment:this.environment,resultsStore:n,collectionContextStore:t,isFullScreen:o,groupsPointer:[i],insertAtIndex:r,from:"board_group_enter_add_item",transient:!0})}})},this.handleBoardItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),i=e.getTitleStore();if(st.Q(i.getValue()))return void H.Ys({environment:this.environment,store:e});if(!o)return;const n=this.resultsStore();if(!n)return;const r=n.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),s=t.collectionViewBlockStore();if(a&&s&&P.trackDeleteNewlyCreatedBoardItem(this.environment,{...(0,J.Pn)(t),block_id:e.id}),W.createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:this.environment,perform:t=>{R.Od({store:e,transaction:t})}}),r>=0){const e=n.state[r];H.Ys({environment:this.environment,store:e})}},this.reducerStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o}=this.props,{boardHiddenGroupStore:i}=this.stores,{searchQuery:n,limit:r}=i.state,a=(0,He.zk)({schema:t,group:e,timeZone:(0,ze.r)()});if(!a)return;return{type:"results",filter:a,limit:r,searchQuery:n,loadContentCover:Boolean(o&&o.board_cover&&"page_content"===o.board_cover.type)}}))}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new Pe.G(this.environment,{table:C.iU,id:t.id}))}renderComponent(){const{device:e}=this.environment,{groupBy:t,groupFormat:o,disabled:i,query:n,schema:a,currentGroups:l,collectionContextStore:c}=this.props,p=n.aggregations?n.aggregations[0]:void 0;return s()(yo.Z,{store:this.selectableBlockStore,canDropOnto:!i,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0},void 0,s()(qe.Z,{popupType:e.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,renderOrigin:e=>d.createElement(Ot.Z,r()({key:(0,Re.mD)(o),style:Jo.buttonStyle},e),s()(No.Z,{groupBy:t,groupFormat:o,currentGroups:l,schema:a,disabled:!0,isHiddenGroup:!0,collectionContextStore:c}),s()(at,{groupFormat:o,aggregation:p,schema:a,collectionContextStore:c,disabled:!0,onChange:this.handleBoardAggregationChange})),render:this.renderPopup,buttonPopupStore:this.stores.buttonPopupStore,onClick:this.handleButtonPopupClick}))}renderHeader(){const{device:e}=this.environment,{groupFormat:t,disabled:o,format:i,schema:n,query:a,currentGroups:l,collectionContextStore:c,isFullScreen:p,hoveredGroupStore:u,groupBy:m,isInPeekRenderer:g,intl:h}=this.props,{searchQuery:f}=this.stores.boardHiddenGroupStore.state;return s()(d.Fragment,{},void 0,!e.isMobile&&s()(Ho,{groupBy:m,currentGroups:l,groupFormat:t,query:a,schema:n,format:i,collectionContextStore:c,disabled:o||Boolean(f),hidden:!0,isPopup:!0,onAddItem:this.handleBoardGroupHeaderAddItem,isFullScreen:p,hoveredGroupStore:u,isInPeekRenderer:g,intl:h},(0,Re.mD)(t)),s()("div",{style:{margin:e.isMobile?0:"6px 0"}},void 0,s()(Ko.Z,{capture:!0,render:t=>d.createElement(Yo.ZP,r()({value:f,placeholder:ne.default.formatMessage($o.searchPlaceholder),autoFocus:!e.isMobile,showClearButton:!0,onChange:this.handleSearchInputChange,onClearButtonClick:this.handleSearchClearButtonClick},t))})))}clearSelectionIfBlockIsSelected(){_t.default.state.stores.length>0&&H.ZH(this.environment)}getCoverFormat(){const{format:e}=this.props;return e?e.board_cover:void 0}getCoverAspectFormat(){const{format:e}=this.props;return e?e.board_cover_aspect:void 0}getCoverSizeFormat(){const{format:e}=this.props;return e?e.board_cover_size:void 0}reducerResultStore(){const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}resultsStore(){const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}}Jo.displayName="BoardHiddenGroup",Jo.buttonStyle={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:3};const Qo=Jo;var ei=o(4615),ti=o(97880),oi=o(68500);class ii extends u.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ue.Z},this.renderPopup=()=>{const{schema:e,currentGroups:t,groupBy:o}=this.props;return s()(oi.Z,{groupFormat:void 0,groupBy:o,currentGroups:t,schema:e,onChange:this.handleEditMenuChange,onClose:this.handleEditMenuClose,parentStore:this.props.parentStore})},this.handleEditMenuChange=e=>{const{collectionContextStore:t,groupBy:o,schema:i,currentGroups:n,onAccept:r,groupsLimitStore:a}=this.props,{newGroupValue:s}=e,l=i[o.property],c=a.get();if(l&&(0,Re.LG)(l))if(E.wd({environment:this.environment,collectionContextStore:t,action:"board_add_group"}),this.stores.buttonPopupStore.reset(),mt.cu(l)){if(l.type!==s.type)return;if(void 0===s.value)return;const e=l.options||[],t={id:(0,ei.ZP)(),value:s.value,color:(0,mt.TL)(e)},a=[...e,t],d={...l,options:a},p={...i,[o.property]:d},u={property:o.property,value:s,hidden:!1};r({newGroups:(0,Fe.nr)(n,u,c),newSchema:p})}else if("person"===l.type||"relation"===l.type||(0,Re.HB)(l.type)){const t={property:o.property,value:s,hidden:!1};r({newGroups:(0,Fe.nr)(n,t,c),newPage:e.newPage})}else(0,Re.A1)(l.type)||"status"===l.type||"number"===l.type||"created_by"===l.type||"last_edited_by"===l.type||"formula"===l.type||"checkbox"===l.type||"location"===l.type||(0,ti.t1)(l.type)},this.handleEditMenuClose=()=>{this.stores.buttonPopupStore.reset()},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,Fe.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{groupBy:e,schema:t,type:o}=this.props,{buttonPopupStore:i}=this.stores,n=t[e.property];if(n&&(0,Re.LG)(n))return s()(qe.Z,{render:this.renderPopup,buttonPopupStore:i,popupType:this.environment.device.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,renderOrigin:e=>{return"default"===o?d.createElement(et.Z,r()({isLightGray:!0,icon:b.Z.plus,style:{display:"flex",height:28,marginBottom:4,width:"max-content",...this.props.style}},e),s()(I.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})):d.createElement(Jt.Z,r()({icon:e=>b.Z.plus({...e,fill:this.theme.mediumTextColor}),style:{width:35,background:null===(t=this.boardColorStore.state)||void 0===t?void 0:t.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:Po,paddingBottom:Po,marginRight:5,borderRadius:5,height:33,...this.props.style}},e));var t}})}}ii.displayName="CollectionAddGroupButton";const ni=ii;class ri extends u.Z{constructor(){super(...arguments),this.renderMenu=e=>{const{device:t}=this.environment;let o;return o=t.isMobile?{menuType:Ke.og.Modal,title:s()(I.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:s()(Qe.DoneMenuText,{}),onClickRight:e.close}:{menuType:Ke.og.Popup,width:200},d.createElement($e.Z,o,s()(Je.Z,{type:Je.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>d.createElement(ot.Z,e),items:this.getAggregationActions()}],onAccept:e.close}))},this.handleChangeAggregation=e=>{const{collectionContextStore:t,format:o,groupAggregationKey:i}=this.props,n=t.collectionViewStore();n&&W.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:this.environment,perform:t=>{F.iG({collectionViewStore:n,update:{format:{...o,[i]:e}},transaction:t})}}),P.trackConfigureView(this.environment,{view_type:this.getCurrentViewType(),action:"change_aggregation"})},this.renderAggregationMenuItem=(e,t,o)=>s()(it.Z,{placement:tt.GI.Placement.Right,delayThreshold:0,render:e=>d.createElement(Xe.Z,r()({title:t},(0,Ye.Z)(e,o))),renderTooltip:()=>s()("div",{style:{width:140,whiteSpace:"normal"}},void 0,s()("img",{src:(0,We.D)(je.Sn[e]),style:{borderRadius:3,width:140,marginTop:4}}),je.BG[e])},o.key),this.aggregationStore=this.createComputedStore((()=>{const{format:e,groupAggregationKey:t}=this.props;return e[t]||{aggregator:"count"}}),!0),this.reducerStore=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.aggregationStore.state;return{type:"aggregation",filter:(0,He.zk)({schema:e,group:t,timeZone:(0,ze.r)()}),aggregation:o}}))}renderComponent(){const{device:e}=this.environment;return s()(it.Z,{renderTooltip:()=>this.renderTooltipText(),render:t=>s()(qe.Z,{popupType:e.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,renderOrigin:e=>d.createElement(et.Z,r()({disabled:this.props.disabled,style:{fontWeight:M.Z.fontWeight.medium,color:this.theme.lightTextColor,height:24}},(0,Ye.Z)((0,Ye.Z)(t,e),{onClick:ie.Wi})),this.renderValue()),disabled:this.props.disabled,render:this.renderMenu})})}renderTooltipText(){const{schema:e}=this.props,t=this.aggregationStore.state,o=je.VN[(0,Ue.OV)(t)];if((0,Ue.pK)(t)){const i=e[t.property];if(i){return`${o} in ${i.name}`}}return o}renderValue(){const{schema:e,collectionContextStore:t,groupFormat:o}=this.props,i=this.aggregationStore.state,n=this.reducerStore.state;if(n)return s()(Ge.Z,{id:`group_aggregation:${(0,Re.mD)(o)}`,collectionContextStore:t,reducer:n,render:t=>{const o=t.state;if(!o||"aggregation"!==o.type)return;let n;if((0,Ue.pK)(i)){const t=e[i.property];!t||"formula"!==t.type&&"number"!==t.type||(n=t.number_format)}return(0,je.Ol)({numberFormat:n,aggregationType:i.aggregator,userTimeZone:(0,ze.r)(),value:o.aggregationResult,roundDecimal:5})}})}getAggregationActions(){const e=[];for(const r of Ue.o5)e.push(this.createCountAggregationAction(r));const t=this.getDefaultProperties();if(t.length>0)for(const r of Ue.Sy)"show_unique"!==r&&e.push(this.getAggregationGroupAction(r,t));const o=this.getNumericProperties();if(o.length>0)for(const r of Ue.k$)e.push(this.getAggregationGroupAction(r,o));const i=this.getDateProperties();if(i.length>0)for(const r of Ue.f8)e.push(this.getAggregationGroupAction(r,i));const n=this.getCheckboxProperties();if(n.length>0)for(const r of Ue.gC)e.push(this.getAggregationGroupAction(r,n));return e}getAggregationGroupAction(e,t){const{device:o}=this.environment,i=je.VN[e],n=c().compact(t.map((t=>this.createPropertyAggregationAction(t,e))));return{key:e+i,render:(e,t)=>d.createElement(nt.Z,r()({},e,{onFocus:t.onFocus,renderOrigin:(e,t)=>d.createElement(Xe.Z,r()({},e,{ref:t,title:i})),renderExtension:(e,r)=>{let a;return a=o.isMobile?{menuType:Ke.og.Modal,title:i,right:o.isPhone?s()(Qe.DoneMenuText,{}):void 0,onClickRight:r.close,...e}:{menuType:Ke.og.Popup,width:200,...e},d.createElement($e.Z,a,s()(Je.Z,{type:Je.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>d.createElement(ot.Z,e),items:n}],onAccept:t.onAccept}))}})),action:()=>null}}getDefaultProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ue.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}getNumericProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ue.O4)(o)}))}getDateProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ue.dN)(o)}))}getCheckboxProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Ue.Mv)(o)}))}createCountAggregationAction(e){const t=je.VN[e];return{key:e,render:o=>this.renderAggregationMenuItem(e,t,o),action:()=>{this.handleChangeAggregation({aggregator:e})}}}createPropertyAggregationAction(e,t){const o=this.props.schema[e];if(!o)return;const i=o.name;return{key:`${e} ${t}`,render:e=>this.renderAggregationMenuItem(t,i,e),action:()=>{this.handleChangeAggregation({aggregator:t,property:e})}}}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=null==t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}}ri.displayName="CollectionGroupAggregation";var ai=o(45697),si=o.n(ai),li=o(55010);function ci(e){const{element:t,container:o}=e,i=function(e){for(;;){const t=mi(e);if(!t)return e;e=t}}(o),{store:n}=i.stores,{containerMap:r}=n.state,a=r.get(o);a?a.add(t):r.set(o,new Set([t])),n.emit()}function di(e,t,o,i){return e<-i||e>t?0:e>=t-o-1?t-o+i-1:e+i}function pi(e,t,o,i){return e-i<0||e>t?0:e<o?o-t:e-t}function ui(e){const t=[];for(;;){const o=mi(e);if(!o)break;e=o,t.push(e)}return t}function mi(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function gi(e,t){for(const o in t)e.style[o]=t[o]||""}var hi=o(95477);class fi extends u.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;if(e)ci({element:this,container:e});else if("local"===hi.Z.env)throw new Error("Sticky element had no container.");const t=p.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&gi(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;if(e)!function(e){const{element:t,container:o}=e,{store:i}=o.stores,{containerMap:n}=i.state,r=n.get(o);r&&r.delete(t),i.emit()}({element:this,container:e});else if("local"===hi.Z.env)throw new Error("Sticky element had no container.");this.element=void 0}renderComponent(){if(this.props.children)return d.Children.only(this.props.children)}}fi.displayName="ComputedStickyElement",fi.contextTypes={computedStickyContainer:si().any,...u.w};const vi=fi;class yi extends u.Z{constructor(){super(...arguments),this.storeTypes={hovered:Ze.default.of(!1)},this.renderActionMenu=e=>{const{groupFormat:t,currentGroups:o,format:i,schema:n,collectionContextStore:r,groupsFormatKey:a}=this.props;return s()(Vo,{parent:e,groupFormat:t,currentGroups:o,format:i,schema:n,collectionContextStore:r,groupsLimitStore:r.groupsLimit,groupsFormatKey:a})},this.handleAddItemClick=()=>{const{groupFormat:e,collectionContextStore:t,isFullScreen:o,onGroupHeaderAddItem:i}=this.props,n=t.groupsStore.getGroupState(e);n&&Ne.M_(this.environment)&&(t.searchQuery.get()&&F.Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o}),W.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:this.environment,perform:o=>{const{coercionSucceeded:r,newStore:a}=R.IW({environment:this.environment,collectionContextStore:t,groupsPointer:[e],results:n.resultsStore?n.resultsStore.state:[],insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:"group_header"});i(a,r,this.props),P.trackCreateBlock(this.environment,{from:"group_add_item_top",type:"page",...(0,J.Pn)(t)})}}))},this.handleCollectionGroupValueChange=e=>{const t=this.props.collectionContextStore.collectionStore();t&&(R.w$({...e,environment:this.environment,collectionStore:t,...this.props}),P.trackConfigureView(this.environment,{view_type:this.getCurrentViewType(),action:"rename_group"}))},this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;H.ZH(this.environment);const i=!o.toggleStateStore.state;if(R.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:i,collectionContextStore:t}),!i){const e=p.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&m.default.afterNextFlush((()=>{(0,se.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleMouseMove=()=>{this.stores.hovered.set(!0)},this.handleMouseLeave=()=>{this.stores.hovered.set(!1)},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:i,groupFormat:n}=this.props,r=p.findDOMNode(this);r&&r instanceof Element&&W.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>R.BO({environment:this.environment,collectionContextStore:i,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e})})}}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new Pe.G(this.environment,{table:C.iU,id:t.id}))}renderComponent(){const{disabled:e,getComputedStickyStyle:t,isFullScreen:o,isRootChild:i,preventToggleBackground:n,groupFormat:r,collectionContextStore:a}=this.props,l=(0,Fe.ds)({device:this.environment.device,isFullScreen:o,isRootChild:i}),c=a.groupsStore.getGroupState(r);if(!c)return;const p=c.toggleStateStore.state,u=a.permissionScopes.state,m=a.shouldAllowNewItemCreation(),g=d.createElement(d.Fragment,null,this.renderValue(),this.renderAggregation(),!e&&u.canConfigureBlock&&this.renderActionButton(),m&&this.renderAddButton());return s()(vi,{position:Ve.Top,getComputedStyle:t},void 0,s()("div",{style:this.getStyle(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,s()("div",{style:this.getStickyWrapStyle(p)},void 0,l?s()("div",{style:{width:0,display:"flex",flexDirection:"row-reverse",paddingRight:2}},void 0,s()("div",{style:{display:"flex",alignItems:"center",background:n?this.theme.cardContentBackground:void 0,height:this.getHeight()}},void 0,this.renderToggleButton(c.toggleStateStore))):this.renderToggleButton(c.toggleStateStore),p?g:s()(yo.Z,{store:this.selectableBlockStore,canDropOnto:!e,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[r],style:{display:"flex",alignItems:"center",height:"100%"}},void 0,g)),this.props.children))}renderToggleButton(e){const t=e.state;return s()(wo.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:ie.$0,style:{flexShrink:0}})}renderValue(){const{groupFormat:e,schema:t,disabled:o,currentGroups:i,groupBy:n,collectionContextStore:r}=this.props,a=r.permissionScopes.state;return s()(No.Z,{groupBy:n,groupFormat:e,currentGroups:i,schema:t,disabled:o||!a.canConfigureCollection||a.isSyncedCollection,isHiddenGroup:!1,onChange:this.handleCollectionGroupValueChange,style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:r})}renderAggregation(){const{disabled:e,format:t,schema:o,collectionContextStore:i,groupFormat:n,groupAggregationKey:r}=this.props,a=i.permissionScopes.state;return s()(ri,{groupFormat:n,disabled:e||!a.canConfigureBlock,groupAggregationKey:r,format:t,schema:o,collectionContextStore:i})}renderActionButton(){const{device:e}=this.environment;return s()(qe.Z,{popupType:e.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,renderOrigin:e=>d.createElement(Jt.Z,r()({icon:b.Z.dots},e)),onClick:ie.Wi,render:this.renderActionMenu})}renderAddButton(){return s()(it.Z,{renderTooltip:()=>s()(I.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>d.createElement(Jt.Z,r()({icon:b.Z.plus,onClick:this.handleAddItemClick},e))})}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}getStyle(){var e;const t=(null===(e=this.props.collectionContextStore.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0,o=this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground;return{position:"relative",zIndex:T.sL,width:"100%",background:void 0===t?o:t,fontSize:14,...this.props.style}}getStickyWrapStyle(e){const{isFullScreen:t,isRootChild:o,paddingLeft:i}=this.props,{paddingTop:n,toggleClosedMarginBottom:r}=this.props;return{display:"flex",alignItems:"center",height:this.getHeight(),paddingTop:n,width:400,...this.props.stickyLeft&&{position:"sticky",left:t||o?i:0},...!e&&{marginBottom:r}}}getHeight(){return this.props.height||33}}yi.displayName="CollectionGroupHeader";const bi=yi;var Si=o(54087),wi=o.n(Si);class ki extends ut.Z{getInitialState(){return{containerMap:new Map}}}const Ci=ki;class _i extends u.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:Ci},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,wi()((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{!function(e){const{environment:t,container:o}=e,{device:i}=t,{store:n}=o.stores,{containerMap:r}=n.state,a=Array.from(r.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,li.Z)(e.element,t.element);throw new Error("Element not found")})),s=new Map;for(const l of a){const{element:e,scrollableAncestor:t}=l,o=r.get(l);if(!e||!t||!o)continue;const n=ui(l).reduce(((e,t)=>e+(s.get(t)||0)),0),a=t.getBoundingClientRect(),c=e.getBoundingClientRect(),d=a.height,p=Math.floor(a.top-c.top),u=Math.floor(a.top+d-c.top),m=Math.floor(c.height)+(l.props.isFullScreen&&!i.isSafari?me.Z.state:0),g=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,li.Z)(e.element,t.element);throw new Error("Element not found")}));let h=n,f=0;for(const i of g){if(!i.element)continue;const e=i.element.getBoundingClientRect(),t=h+e.height;i.props.position===Ve.Top&&(f+=e.height);const o=di(p,m,t,n),r=pi(u,m,t,f);if(i.props.position===Ve.Top){const e=0!==o,t=i.props.getComputedStyle?i.props.getComputedStyle(e):void 0;e?(i.element.style.transform=`translate3d(0, ${o}px, 0)`,i.element.style.bottom=""):(i.element.style.transform="",i.element.style.bottom=""),t&&gi(i.element,t)}else{const e=0!==r,t=i.props.getComputedStyle?i.props.getComputedStyle(e):void 0;if(e?(i.element.style.transform=`translate3d(0, ${r}px, 0)`,i.element.style.top=""):(i.element.style.transform="",i.element.style.top=""),t)for(const o in t)i.element.style[o]=t[o]||""}h=t}s.set(l,h)}}({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=c().throttle(this.handleScroll,100)}didMount(){!function(e){const{container:t,parentContainer:o}=e,i=o?o.stores.store:t.stores.store;i.state.containerMap.has(t)||i.state.containerMap.set(t,new Set),i.emit()}({container:this,parentContainer:mi(this)}),(0,se.Gf)(this.environment)&&this.attachEvents()}willUnmount(){!function(e){const{container:t,parentContainer:o}=e,i=o?o.stores.store:t.stores.store;i.state.containerMap.delete(t),i.emit()}({container:this,parentContainer:mi(this)}),(0,se.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return d.Children.only(this.props.children)}attachEvents(){const e=mi(this),t=p.findDOMNode(this);if(t){this.element=t;const o=(0,se.VW)(t);o&&(this.scrollableAncestor=o,e||((0,te.lj)(o,"scroll",this.handleScroll),(0,te.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const i=(0,se.Ez)(this.element);i&&(this.resizingAncestor=i,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,te.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,te.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}_i.displayName="ComputedStickyContainer",_i.contextTypes={computedStickyContainer:si().any,...u.w},_i.childContextTypes={computedStickyContainer:si().any,...u.w};const Mi=_i;class Ti extends u.Z{willMount(e){super.willMount(e);const{groupFormat:t,collectionContextStore:o}=this.props;R.V$({environment:this.environment,collectionContextStore:o,groupFormat:t})}renderComponent(){const{renderGroup:e,groupFormat:t,groupsDisplayState:o,disabled:i,groupsFormatKey:n,groupAggregationKey:r,format:a,schema:l,collectionContextStore:c,onGroupHeaderAddItem:p,renderHeader:u,getGroupStyle:m,stickyLeftHeader:g,ignoreAncestorStickyContainer:h,paddingLeft:f,isFullScreen:v,index:y,isRootChild:b,isInPeekRenderer:S,groupBy:w,isLast:k}=this.props,C=c.groupsStore.getGroupState(t);if(!C)return;const{toggleStateStore:_}=C,M=_.state,T={groupFormat:t,currentGroups:o.currentGroups,disabled:i,groupsFormatKey:n,groupAggregationKey:r,format:a,schema:l,collectionContextStore:c,isFullScreen:v,isInPeekRenderer:S,onGroupHeaderAddItem:p,stickyLeft:g,index:y,paddingLeft:f,isRootChild:b,groupBy:w};return s()(Mi,{ignoreAncestorContainer:h,renderEmitter:c.renderEmitter,isFullScreen:v},void 0,s()("div",{style:{width:"100%",position:"relative",...m?m({groupFormat:t,...o,index:y,isLast:k,toggleStateStore:_}):void 0}},void 0,u?u(T):d.createElement(bi,T),M&&e(t)))}}Ti.displayName="CollectionGroup";const Ii=Ti;class Pi extends u.Z{constructor(){super(...arguments),this.handleClick=()=>{const{groupsLimitStore:e}=this.props;e.set(e.get()+Fe.kW)},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,Fe.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{visibleGroups:e,total:t,hiddenGroups:o,type:i}=this.props,n=Math.min(Fe.kW,t-o.length-e.length);return"default"===i?s()(et.Z,{onClick:this.handleClick,onMouseDown:ie.$0,style:{height:30,marginTop:4,marginBottom:4,...this.props.style},icon:e=>b.Z.dots(e)},void 0,s()(I.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",description:"Text for button to load more group options indicating how many additional options can be shown",values:{loadMoreAmount:n}})):s()(et.Z,{onClick:this.handleClick,onMouseDown:ie.$0,style:{background:null===(r=this.boardColorStore.state)||void 0===r?void 0:r.backgroundColor,color:this.theme.mediumTextColor,fontWeight:M.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:10,borderRadius:5,width:90,...this.props.style}},void 0,s()("span",{style:{flexGrow:1}},void 0,s()(I.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",description:"Text for button to load more group options indicating how many additional options can be shown",values:{loadMoreAmount:n}})),b.Z.dots({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1}));var r}}Pi.displayName="CollectionGroupsLoadMoreButton";const xi=Pi;class Bi extends u.Z{constructor(){super(...arguments),this.handleClick=()=>{const{hiddenGroupsVisible:e}=this.props;e.set(!e.get())}}renderComponent(){const{hiddenGroups:e,hiddenGroupsVisible:t}=this.props,o=t.get();return s()(et.Z,{onClick:this.handleClick,onMouseDown:ie.$0,style:{height:30,marginBottom:4,...this.props.style},icon:e=>b.Z.chevronDown({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0},void 0,s()(I.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.length}}))}}Bi.displayName="CollectionHiddenGroupsButton";const Zi=Bi;class Ei extends u.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:Ze.default.of(void 0),hiddenGroupsVisible:Ze.default.of(!1)},this.renderResult=e=>{const{disabled:t,collectionContextStore:o,groupBy:i}=this.props,n=o.groupsLimit.get(),r=e.hiddenGroups.slice(0,Fe.ew),a=o.permissionScopes.state;return s()("div",{style:{position:"relative"}},void 0,this.renderGroups(e.visibleGroups),n<e.total-e.hiddenGroups.length&&this.renderGroupsLoadMoreButton(e),r.length>0&&d.createElement(d.Fragment,null,this.renderHiddenGroupsButton(r),this.stores.hiddenGroupsVisible.get()&&this.renderGroups(r)),!t&&!a.isLocked&&a.canConfigureBlock&&(0,Re.Wz)(i,a.canConfigureCollection)&&"collectionTypedView"!==o.contextType&&!(0,Bt.wl)(i.property)&&this.renderAddGroupButton())},this.renderGroup=(e,t,o)=>{const{renderGroup:i,disabled:n,groupsFormatKey:r,groupAggregationKey:a,format:l,schema:c,collectionContextStore:d,isFullScreen:p,onGroupHeaderAddItem:u,renderHeader:m,getGroupStyle:g,stickyLeftHeader:h,ignoreAncestorStickyContainer:f,paddingLeft:v,isRootChild:y,groupBy:b,isInPeekRenderer:S}=this.props,w=t===o.length-1;if(d.groupsStore.getGroupState(e))return s()(Ii,{groupBy:b,groupFormat:e,groupsDisplayState:this.groupsDisplayStateStore.state,disabled:n,groupsFormatKey:r,groupAggregationKey:a,format:l,schema:c,collectionContextStore:d,isFullScreen:p,isRootChild:y,renderGroup:i,onGroupHeaderAddItem:u,renderHeader:m,getGroupStyle:g,stickyLeftHeader:h,ignoreAncestorStickyContainer:f,paddingLeft:v,index:t,isLast:w,isInPeekRenderer:S},(0,Re.mD)(e))},this.handleGroupsChange=()=>{const{format:e,groupsFormatKey:t,collectionContextStore:o}=this.props,i=this.groupsDisplayStateStore.state.currentGroups;R.$D({environment:this.environment,format:e,groupsFormatKey:t,collectionContextStore:o,currentGroups:i})},this.handleGroupsChangeDebounced=c().debounce(this.handleGroupsChange,5e3),this.handleCollectionAddGroupButtonAccept=e=>{const{collectionContextStore:t,groupsFormatKey:o,groupBy:i,schema:n}=this.props,r=t.collectionStore();r&&R.tH({update:e,collectionContextStore:t,groupsFormatKey:o,collectionStore:r,environment:this.environment,groupBy:i,schema:n})},this.reducerStore=this.createComputedStore((()=>{const{groupBy:e,disableReducerRequest:t,schema:o,format:i,groupsFormatKey:n,collectionContextStore:r}=this.props,a=r.remoteRequestStore.state;if(!t)return(0,Fe.ej)({groupBy:e,schema:o,format:i,filter:null==a?void 0:a.loader.filter,groupsFormatKey:n,limit:r.groupsLimit.get()})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{schema:e,groupBy:t}=this.props;return(0,Re.Qq)({schema:e,groupBy:t})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupBy:t,groupsFormatKey:o,format:i,schema:n,collectionContextStore:r}=this.props,a=r.groupsLimit.get(),s=r.collectionViewBlockStore();if(!s)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const l=this.schemaGroupsStore.state,c=this.stores.reducerResultStore.state,d=c?c.results:void 0,p=c?c.total:0,u=(0,Fe.Cz)({groupBy:t,schema:n,formatGroups:i[o]||[],schemaGroups:l,reducerResults:d,getRecordValue:s.getRecordValue,relativeVariableResult:r.relativeVariableStore.state,viewAppConfigUri:null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),m=u.filter((e=>!(0,Re.eF)(e))).slice(0,a),g=u.filter((e=>(0,Re.eF)(e)));return{currentGroups:[...m,...g],visibleGroups:m,hiddenGroups:g,total:p}}),!0)}willMount(e){const{disableReducerRequest:t}=this.props;t||this.groupsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.groupsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced)}renderComponent(){const e=this.reducerStore.state,t=this.groupsDisplayStateStore.state;return e?s()(Ge.Z,{id:this.props.id,reducer:e,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderResult(t)}):this.renderResult(t)}renderGroups(e){return e.map(this.renderGroup)}renderGroupsLoadMoreButton(e){const{renderGroupsLoadMoreButton:t,collectionContextStore:o,schema:i}=this.props,{groupsLimit:n}=o;return t?t({visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:n,type:"default",schema:i,collectionContextStore:o}):s()("div",{style:{display:"flex"}},void 0,s()(xi,{visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:n,type:"default",schema:i,collectionContextStore:o}))}renderHiddenGroupsButton(e){const{renderHiddenGroupsButton:t}=this.props;return t?t({hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}):s()("div",{style:{display:"flex"}},void 0,s()(Zi,{hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}))}renderAddGroupButton(){const{schema:e,groupBy:t,renderAddGroupButton:o,collectionContextStore:i}=this.props,n=this.groupsDisplayStateStore.state.currentGroups;return o?o({groupBy:t,schema:e,currentGroups:n,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:i.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:i}):s()(ni,{groupBy:t,schema:e,currentGroups:n,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:i.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:i})}}Ei.displayName="CollectionGroups";const Ri=Ei;var Ai=o(79131);class Di extends Ee.Z{constructor(){super(...arguments),this.storeTypes={groupsResultStore:Ze.default.of(void 0),hoveredGroupStore:Ze.default.of(void 0)},this.renderGroupHeader=(e,t)=>{const{schema:o,collectionContextStore:i,format:n,query:r,disabled:a,isFullScreen:l,intl:c}=this.props;if(this.getGroupStateForGroupFormat(e)&&n.board_columns_by)return s()(Ho,{currentGroups:t,groupFormat:e,query:r,schema:o,format:n,groupBy:n.board_columns_by,collectionContextStore:i,hoveredGroupStore:this.stores.hoveredGroupStore,disabled:a,hidden:!1,isPopup:!1,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:l,intl:c},(0,Re.mD)(e))},this.subGroupMinWidth=()=>{const{format:e}=this.props;return this.columnsDisplayStateStore.state.visibleGroups.length*(Uo(e)+2*Po+10)},this.renderBoardHiddenGroupsButton=e=>s()("div",{style:{display:"flex",minWidth:this.subGroupMinWidth()}},void 0,d.createElement(Zi,e)),this.renderSubGroupHeader=e=>d.createElement(bi,r()({},e,{height:36,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle,style:{...e.style,minWidth:this.subGroupMinWidth()}})),this.renderHiddenGroup=e=>{const{collectionContextStore:t,query:o,schema:i,format:n,disabled:r,blockPropertyValueOverlayStore:a,isFullScreen:l,isInPeekRenderer:c,intl:d}=this.props,p=this.columnsDisplayStateStore.state.currentGroups;if(!this.getGroupStateForGroupFormat(e)||!n.board_columns_by)return;const u=t.permissionScopes.state;return s()(Qo,{query:o,schema:i,format:n,groupFormat:e,groupBy:n.board_columns_by,currentGroups:p,collectionContextStore:t,disabled:r||!this.canEdit()||!u.canEditContent,blockPropertyValueOverlayStore:a,isFullScreen:l,hoveredGroupStore:this.stores.hoveredGroupStore,isInPeekRenderer:c,intl:d},(0,Re.mD)(e))},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o}=this.props,i=this.columnsDisplayStateStore.state.currentGroups,n=i.filter((t=>e.indexOf((0,Re.mD)(t))<0)),r=i.filter((t=>e.indexOf((0,Re.mD)(t))>=0)),a=c().sortBy(r,(t=>{const o=e.indexOf((0,Re.mD)(t));return o>=0?o:1/0})),s=t?[...n,...a]:[...a,...n];W.createAndCommit({userAction:"Board.handleGroupReorder",environment:this.environment,perform:e=>{R.A6({collectionContextStore:o,newGroups:s,groupsFormatKey:"board_columns",transaction:e})}}),E.wd({environment:this.environment,collectionContextStore:o,action:t?"board_reorder_hidden_groups":"board_reorder_groups"})},this.handleCollectionAddGroupButtonAccept=e=>{const{collectionContextStore:t,schema:o,format:i}=this.props,n=t.collectionStore();if(!n)return;const r=i.board_columns_by;r&&R.tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:n,schema:o,groupBy:r,environment:this.environment})},this.handleEditorMouseDown=e=>{const{device:t}=this.environment;t.isMobile||(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{e.preventDefault(),V.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleGroupsChange=()=>{const{format:e,collectionContextStore:t}=this.props,o=this.columnsDisplayStateStore.state.currentGroups;R.$D({environment:this.environment,format:e,groupsFormatKey:"board_columns",collectionContextStore:t,currentGroups:o})},this.handleGroupsChangeDebounced=c().debounce(this.handleGroupsChange,5e3),this.handleGroupHeaderAddItem=e=>{const{collectionContextStore:t}=this.props,{device:o}=this.environment;o.isMobile?N.navigateToBlock({environment:this.environment,store:e}):N.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t})},this.handleMouseLeave=()=>{this.stores.hoveredGroupStore.set(void 0)},this.schemaGroupsStore=this.createComputedStore((()=>{const{format:e,schema:t}=this.props,o=e.board_columns_by;if(o)return(0,Re.Qq)({schema:t,groupBy:o})}),!0),this.groupsReducerStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,i=o.remoteRequestStore.state,n=e.board_columns_by;if(n)return(0,Fe.ej)({groupBy:n,schema:t,format:e,filter:null==i?void 0:i.loader.filter,groupsFormatKey:"board_columns",limit:o.boardColumnsLimit.get()})})),this.columnsDisplayStateStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,i=e.board_columns_by;if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const n=o.collectionViewBlockStore();if(!n)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const r=o.collectionViewStore(),a=o.boardColumnsLimit.get(),s=this.schemaGroupsStore.state,l=this.stores.groupsResultStore.state,c=l?l.results:void 0,d=l?l.total:0,p=(0,Fe.Cz)({groupBy:i,schema:t,formatGroups:e.board_columns||[],schemaGroups:s,reducerResults:c,getRecordValue:n.getRecordValue,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null==r?void 0:r.getFormat().app_config_uri}),u=p.filter((e=>!(0,Re.eF)(e))).slice(0,a),m=p.filter((e=>(0,Re.eF)(e)));return{currentGroups:[...u,...m],visibleGroups:u,hiddenGroups:m,total:d}}),!0),this.disableBoardColorColumnsStore=this.createComputedStore((()=>{const{schema:e,format:t,collectionContextStore:o}=this.props;return!Boolean((0,Fe.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t,collectionContextStore:o,theme:this.theme}))}),!0),this.getGroupHeaderComputedStickyStyle=e=>({background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,boxShadow:e?`0 1px 0 ${this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}`:void 0}),this.getGroupStyle=e=>({marginTop:4,...e.isLast&&{paddingBottom:12}})}willMount(){this.columnsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.columnsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced)}willMountOrUpdate(e){const{format:t,store:o,collectionContextStore:i}=e,n=i.collectionStore();if(!n)return;const r=i.permissionScopes.state;!t.board_columns_by&&o.isDefined()&&n.isDefined()&&r.canConfigureCollection&&r.canConfigureBlock&&this.updateOrCreateColumnsByProperty(e)}renderPersisted(){const{format:e}=this.props;return e.board_columns_by?this.renderBoard():s()("div",{style:this.getBoardStyle(),className:X.EGJ},void 0,s()(I.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a select property.",id:"database.boardView.missingSelectProperty"}))}renderBoard(){const{store:e,format:t,isFullScreen:o,collectionContextStore:i}=this.props,n=this.columnsDisplayStateStore.state,{visibleGroups:a,hiddenGroups:l}=n,c=t.collection_group_by;return this.renderBoardColumnsReducerRequest((()=>(0,Le.Z)((t=>s()(Mi,{isFullScreen:o,renderEmitter:i.renderEmitter},void 0,d.createElement("div",r()({style:this.getBoardStyle(),className:X.EGJ},t),s()(yo.Z,{style:this.getColumnsWrapStyle(),store:e,shouldShowHalo:!o,canSelect:!o,onMouseDown:this.handleEditorMouseDown,analyticsName:"board",onMouseLeave:this.handleMouseLeave},void 0,this.renderHeader(n),a.length>0&&s()("div",{},void 0,s()("div",{style:{height:34+xo(this.disableBoardColorColumnsStore.state)}}),c?this.renderBoardColumnsForGroups(c,a):this.renderBoardColumnsForGroup(void 0,a)),this.shouldRenderGroupsLoadMoreButton(n)&&s()("div",{style:{width:90,marginLeft:5,marginRight:5}}),this.shouldRenderAddGroupButton()&&s()("div",{style:{width:35,marginLeft:5,marginRight:5}}),l.length>0&&this.renderHiddenGroups(l))))))))}renderBoardColumnsReducerRequest(e){const{collectionContextStore:t}=this.props,o=this.groupsReducerStore.state;return o?s()(Ge.Z,{id:"board_columns",reducer:o,collectionContextStore:t,resultStore:this.stores.groupsResultStore,render:e}):e()}renderHeader(e){const{format:t,isFullScreen:o,isRootChild:i,collectionContextStore:n}=this.props,{hiddenGroups:r,visibleGroups:a,currentGroups:l}=e,c=a.map((e=>(0,Re.mD)(e))),d=t.board_columns_by;if(!d)return;const p=(0,Re.mu)(d),u=n.permissionScopes.state,m="manual"===p.type&&u.canConfigureBlock,g=(0,Fe.ds)({device:this.environment.device,isFullScreen:o,isRootChild:i});return s()(vi,{position:Ve.Top},void 0,s()("div",{style:this.getHeaderStyle()},void 0,g&&s()("div",{style:this.getHeaderSpacerStyle()}),m?s()(Ai.ZP,{direction:"horizontal",keys:c,renderKey:(e,t)=>this.renderGroupHeader(a[t],l),onDrop:e=>this.handleGroupReorder(e,!1)}):c.map(((e,t)=>this.renderGroupHeader(a[t],l))),this.shouldRenderGroupsLoadMoreButton(e)&&this.renderGroupsLoadMoreButton(e),this.shouldRenderAddGroupButton()&&this.renderAddGroupButton(),r.length>0&&s()("div",{style:this.getHiddenGroupsCaptionStyle()},void 0,s()(I.FormattedMessage,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"}))))}renderHiddenGroups(e){const{device:t}=this.environment,{collectionContextStore:o}=this.props,i=this.canEdit()&&!t.isMobile&&!o.permissionScopes.state.isLocked,n=e.slice(0,Fe.ew),r=n.map((e=>(0,Re.mD)(e)));return s()("div",{style:this.getHiddenGroupsWrapStyle()},void 0,n.length>0&&(i?s()(Ai.ZP,{direction:"vertical",keys:r,renderKey:(e,t)=>this.renderHiddenGroup(n[t]),onDrop:e=>this.handleGroupReorder(e,!0)}):s()("div",{},void 0,n.map(this.renderHiddenGroup))))}renderGroupsLoadMoreButton(e){const{collectionContextStore:t,schema:o}=this.props,i=t.boardColumnsLimit;return s()(xi,{visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:i,type:"board",schema:o,collectionContextStore:t})}renderAddGroupButton(){const{format:e,schema:t,collectionContextStore:o}=this.props;if(!e.board_columns_by)return;if("collectionTypedView"===o.contextType)return;const i=this.columnsDisplayStateStore.state.currentGroups;return s()(ni,{groupBy:e.board_columns_by,schema:t,currentGroups:i,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:o.boardColumnsLimit,parentStore:this.props.store,type:"board",collectionContextStore:o})}renderBoardColumnsForGroups(e,t){const{store:o,format:i,collectionContextStore:n,schema:r,disabled:a,isFullScreen:l,paddingLeft:c,isRootChild:d,isInPeekRenderer:p}=this.props;return s()(Ri,{store:o,id:"board_collection_groups",groupBy:e,groupsFormatKey:Re.Uh,groupAggregationKey:Re.dQ,format:i,schema:r,collectionContextStore:n,disabled:a,isFullScreen:l,isRootChild:d,paddingLeft:c,renderGroup:e=>this.renderBoardColumnsForGroup(e,t),renderHeader:this.renderSubGroupHeader,renderHiddenGroupsButton:this.renderBoardHiddenGroupsButton,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,stickyLeftHeader:!this.environment.device.isMobile,getGroupStyle:this.getGroupStyle,isInPeekRenderer:p})}renderBoardColumnsForGroup(e,t){return s()("div",{style:Ai.l8},void 0,t.map(((o,i)=>{const n=i===t.length-1;return this.renderGroupResults(e?[e,o]:[o],n)})))}renderGroupResults(e,t){const{store:o,collectionContextStore:i,isFullScreen:n,query:r,schema:a,format:l,disabled:c,blockPropertyValueOverlayStore:d}=this.props,p=0!==this.columnsDisplayStateStore.state.hiddenGroups.length;if(!i.groupsStore.getGroupState(e))return;const u=i.permissionScopes.state,m=this.canEdit()&&("collectionTypedView"===i.contextType||u.canEditContent);return s()(Zo,{store:o,hoveredGroupStore:this.stores.hoveredGroupStore,query:r,schema:a,format:l,groupsPointer:e,collectionContextStore:i,isFullScreen:n,isInPeekRenderer:this.props.isInPeekRenderer,disabled:c||!m,isLast:t&&!p,blockPropertyValueOverlayStore:d},(0,Re.KW)(e))}updateOrCreateColumnsByProperty(e){const{collectionContextStore:t,schema:o}=e,i=t.collectionStore();if(!i)return;const n=t.collectionViewStore();n&&W.createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:this.environment,perform:e=>{let t,r=ee.Se(o);if(!r){r=(0,Ae.ZP)();t={[r]:{name:this.props.intl.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}const a=(t||o)[r];a&&(0,Re.LG)(a)&&(De.FH({stores:[n],update:{board_columns_by:(0,Re.fw)(r,a)},transaction:e}),t&&F.xO({environment:this.environment,collectionStore:i,update:t,transaction:e}))}})}getGroupStateForGroupFormat(e){const{collectionContextStore:t}=this.props;return t.groupsStore.getGroupState([e])}shouldRenderGroupsLoadMoreButton(e){const{collectionContextStore:t}=this.props,{hiddenGroups:o,total:i}=e;return t.boardColumnsLimit.get()<i-o.length}shouldRenderAddGroupButton(){const{format:e,collectionContextStore:t}=this.props,o=e.board_columns_by,i=t.permissionScopes.state;return i.canConfigureBlock&&o&&(0,Re.Wz)(o,i.canConfigureCollection)&&!i.isSyncedCollection}getBoardStyle(){return{paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight,float:"left",minWidth:"100%"}}getHeaderStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,i=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),n=xo(this.disableBoardColorColumnsStore.state);return{position:"absolute",background:i,height:34+n,paddingTop:n,zIndex:T.LN,display:"flex",boxShadow:`-3px 0 0 ${i}`,minWidth:"100%"}}getColumnsWrapStyle(){return{display:"flex",position:"relative",flexGrow:1,paddingBottom:this.props.paddingBottom}}getHiddenGroupsWrapStyle(){return{width:220,flexShrink:0,marginTop:34+xo(this.disableBoardColorColumnsStore.state),marginLeft:12}}getHiddenGroupsCaptionStyle(){return{width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:this.theme.lightTextColor,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,marginLeft:20}}getHeaderSpacerStyle(){return{height:"calc(100% + 17px)",background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,width:20,marginLeft:-20,marginTop:-17}}}const Fi=(0,I.injectIntl)(Di);var Li=o(13991),Vi=o(32918),Ni=o(61784),Oi=o(89837),Ui=o(40863),Hi=o(77907),zi=o(95802),Wi=o(15723),ji=o(17746),Ki=o(50628),Yi=o(17126),Gi=o(6685),Xi=o(76798);class qi extends Ee.Z{constructor(){super(...arguments),this.handleDraggableDragMove=e=>{const{calendarBy:t}=this.props;Z.td({calendarStore:this.props.calendarStore,x:e.currentX,y:e.currentY,calendarBy:t})},this.handleDraggableDragEnd=()=>{const{calendarBy:e,schema:t}=this.props,o=t[e];o&&"date"===o.type&&W.createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:this.environment,perform:t=>{Z.fX({environment:this.environment,calendarStore:this.props.calendarStore,calendarBy:e,transaction:t})}})},this.handleDraggableDragCancel=()=>{Z.cQ({calendarStore:this.props.calendarStore})},this.handleInsertBelow=e=>{const{store:t,calendarBy:o,collectionContextStore:i,resultsStore:n}=this.props,r=i.collectionStore();return r?Z.QG({environment:this.environment,collectionStore:r,collectionContextStore:i,store:t,insertStores:e.insertStores,calendarBy:o,transaction:e.transaction,results:n.state}):[]},this.handleRemove=e=>{const{store:t,collectionContextStore:o}=this.props,{transaction:i}=e;o.collectionStore()&&R.Od({store:t,transaction:i})},this.shouldShowHighlightHalo=this.createComputedStore((()=>ee.Sc(this.props.store)))}activate(){const e=this.getPeekURL();e&&(this.props.handleOpenPeekPage(),N.navigate({environment:this.environment,url:e}))}renderComponent(){const{store:e,row:t,schema:o,format:i,disabled:n,calendarBy:r,collectionContextStore:a}=this.props,l=o[r];if(!l||!mt.Lt(l))return;const d="date"===l.type,p=this.getPageURL(),u=this.getPeekURL(),m=i.calendar_properties?i.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[],g=m.filter((t=>gt.XU({block:e.getModel(),property:t,schema:o,getRecordModel:this.props.store.getRecordModel,userTimeZone:(0,ze.r)(),intl:ne.default.getIntl()}))),h=g.concat(c().difference(m,g)),{start:f,end:v,startOfWeek:y,endOfWeek:b,startColumn:S,columnCount:w}=(0,Ui.du)({startUnixTimestampMS:this.props.start,endUnixTimestampMS:this.props.end,startOfWeekUnixTimestampMS:this.props.startOfWeek,endOfWeekUnixTimestampMS:this.props.endOfWeek}),k=f<y,C=v&&v>b,_=m.length+1,M=tn*_+2*Qi+2*en,T=Ji+M*t,I=!n&&!a.permissionScopes.state.isSyncedCollection;return s()(yo.Z,{store:e,style:{...qi.style,paddingLeft:k?0:6,paddingRight:C?0:6,width:C?`calc(100% / 7 * ${w} - 1px)`:`calc(100% / 7 * ${w})`,left:`calc(100% / 7 * ${S})`,height:M,top:T},canSelect:!n,shouldShowHalo:!0,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,haloStyle:{borderRadius:5,...ee.pB(this.shouldShowHighlightHalo.state,this.theme),marginTop:2,marginBottom:2,marginLeft:k?0:5,marginRight:C?0:5},canTriggerContextMenu:!n,showBlockMenuInput:!0,canDrag:I,onInsertAbove:this.handleInsertBelow,onInsertBelow:this.handleInsertBelow,onRemove:this.handleRemove,canInsertAbove:!n&&d,canInsertBelow:!n&&d,analyticsName:"calendar",shouldShowDropZone:!0,className:X.K4T},e.id,s()(Ht.Z,{style:{...this.getLinkStyle(),...k&&qi.buttonLeftBleedStyle,...C&&qi.buttonRightBleedStyle},innerStyle:this.getButtonStyle(),onClick:this.props.handleOpenPeekPage,href:p,metaHref:u},void 0,s()("div",{style:{...qi.startWrapStyle,...k&&{paddingLeft:12},...C&&{paddingRight:11},width:this.props.includeTime?100/w+"%":"100%"}},void 0,this.renderTitleRow(f,v,y,b,l,w)),s()("div",{style:{...qi.startWrapStyle,width:"100%",...k&&{paddingLeft:12}}},void 0,h.map((e=>this.renderProperty(e)))),!n&&d&&this.renderLeftDraggable(f,y),!n&&d&&this.renderRightDraggable(v,b)))}renderTitleRow(e,t,o,i,n,r){const{store:a,includeTime:l}=this.props,c=a.hasIcon()||!a.isEmptyPage(),d=a.hasError();return s()("div",{style:qi.titleRowWrapStyle},void 0,c&&!d&&s()(zt.Z,{disabled:!0,icon:a.getIcon(),isEmptyPage:a.isEmptyPage(),size:12,style:{flexShrink:0,marginRight:4,marginTop:2}}),d&&b.Z.warning({marginLeft:1,marginRight:5,width:10,fill:this.theme.accentColors.orange[500]}),s()(Xi.Z,{style:qi.titleStyle,store:a,enableHover:!0}),this.renderDiscussionIndicator(),l&&Yi.Xp.fromDateTimes(o,i).contains(e)&&s()("div",{style:this.getTimeStyle()},void 0,(0,Ni.xE)({dateTime:e,humanReadable:!1,timeFormat:this.getTimeFormat(n)})),this.renderEndTime(e,t,o,i,n,r))}renderDiscussionIndicator(){const{store:e}=this.props,t=wt.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return s()("div",{style:{display:"flex",alignItems:"center",color:this.theme.mediumTextColor,fontSize:12,marginLeft:4,flexShrink:0}},void 0,b.Z.speechBubble({width:12,height:12,marginRight:4,fill:this.theme.mediumIconColor}),t)}renderProperty(e){const{collectionContextStore:t,store:o,schema:i,disabled:n,blockPropertyValueOverlayStore:r}=this.props,a=o.getAssociatedCollectionStore();if(!a)return;return i[e]?s()(Vt.Z,{store:o,property:e,disabled:n||!o.canEdit(),locked:t.permissionScopes.state.isLocked,format:Nt.C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:a,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e):void 0}renderEndTime(e,t,o,i,n,r){const{includeTime:a}=this.props;if(a&&t&&Yi.Xp.fromDateTimes(o,i).contains(t)&&e.day!==t.day)return s()("div",{style:r>1?this.endTimeAbsoluteStyle():this.getEndTimeStyle()},void 0,s()(I.FormattedMessage,{defaultMessage:"ends {endTime}",id:"calendarItem.endsTime.message",description:"Message for when this calendar item ends. endTime is a translated message that represents the time of the item's end.",values:{endTime:(0,Ni.xE)({dateTime:t,humanReadable:!1,timeFormat:this.getTimeFormat(n)})}}))}renderLeftDraggable(e,t){const{store:o}=this.props;if(e>t)return s()(Gi.Z,{render:e=>d.createElement("div",r()({style:qi.leftDragHandleStyle},e)),onDraggableDragStart:()=>{Z.f$({calendarStore:this.props.calendarStore,target:o,direction:ji.t.Left})},onDraggableDragMove:this.handleDraggableDragMove,onDraggableDragEnd:this.handleDraggableDragEnd,onDraggableDragCancel:this.handleDraggableDragCancel})}renderRightDraggable(e,t){const{store:o}=this.props;if(!e||e&&e<t)return s()(Gi.Z,{render:e=>d.createElement("div",r()({style:qi.rightDragHandleStyle},e)),onDraggableDragStart:e=>{Z.f$({calendarStore:this.props.calendarStore,target:o,direction:ji.t.Right})},onDraggableDragMove:this.handleDraggableDragMove,onDraggableDragEnd:this.handleDraggableDragEnd,onDraggableDragCancel:this.handleDraggableDragCancel})}getTimeFormat(e){return"date"===e.type&&e.time_format?e.time_format:Vi.c_}getPeekURL(){const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=pe.default.state;return ee.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}getPageURL(){const{store:e}=this.props;return(0,oe.ZP)({store:e,fullyQualified:!1})}getLinkStyle(){return{height:"100%",background:this.theme.calendarItemBackground,borderTopLeftRadius:3,borderTopRightRadius:3,borderBottomLeftRadius:3,borderBottomRightRadius:3,boxShadow:this.theme.lightBoxShadow}}getButtonStyle(){return{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}}getTimeStyle(){return{color:this.theme.mediumTextColor,flexShrink:0,fontSize:10,marginLeft:4,height:14}}getEndTimeStyle(){return{marginLeft:"auto",paddingLeft:4,marginRight:4,color:this.theme.mediumTextColor,fontSize:10,whiteSpace:"nowrap",marginTop:-1}}endTimeAbsoluteStyle(){return{...this.getEndTimeStyle(),position:"absolute",right:4,top:6}}}qi.style={position:"absolute",paddingTop:3,paddingBottom:3},qi.buttonRightBleedStyle={borderTopRightRadius:0,borderBottomRightRadius:0},qi.buttonLeftBleedStyle={borderTopLeftRadius:0,borderBottomLeftRadius:0},qi.startWrapStyle={paddingLeft:6,paddingRight:6,overflow:"hidden"},qi.titleRowWrapStyle={display:"flex",alignItems:"center",height:20},qi.titleStyle={flexGrow:1,fontSize:12,fontWeight:M.Z.fontWeight.semibold},qi.leftDragHandleStyle={position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},qi.rightDragHandleStyle={position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"};const $i=qi,Ji=30,Qi=2,en=3,tn=20;class on extends Ee.Z{constructor(){super(...arguments),this.headerEl=void 0,this.root=void 0,this.verticalScrollableAncestor=void 0,this.storeTypes={calendarStore:ji.Z,resultStore:Ze.default.of(void 0)},this.handleHeaderMount=e=>{this.headerEl=e},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t}=this.props,o=t.isLoading.get(),i=this.shouldInfinitelyLoad();if(e<ge.Z.incrementScrollOffset&&!o&&i){const{collectionContextStore:e}=this.props,t=e.dateRangeStart.get(),o=e.dateRangeEnd.get(),i=(0,Oi.V7)((0,Oi._)({date:o,monthsToAdd:2}),Y.AK.state);F.t5({dateRangeStart:t,dateRangeEnd:i,collectionContextStore:e})}},this.handleScroll=()=>{if(!this.headerEl)return;if(!this.shouldInfinitelyLoad())return;const{calendarStore:e}=this.stores,t=e.state,o=this.headerEl.getBoundingClientRect();let i=[];t.dayStoreMap.forEach(((e,t)=>{i.push({store:e,timestamp:t})})),i=c().sortBy(i,(e=>{let{timestamp:t}=e;return t}));const n=i.find((e=>{let{store:t}=e;const i=zi.C.getRectFromStore(t);return Boolean(i&&i.top<=o.top+o.height&&i.top+i.height>=o.top+o.height)}));if(n){const o=(0,Oi.kl)((0,Oi.Xz)({date:(0,Oi.V7)(n.timestamp,Y.AK.state),daysToAdd:1}));o!==t.startingMonth&&e.setState({...e.state,startingMonth:o})}},this.handleScrollThrottled=c().throttle(this.handleScroll,100),this.handleMouseMove=e=>{const{calendarStore:t}=this.stores,o=t.state;if(!o.isDragging&&!Se.Z.state){const i=this.findHoveredDay(e.clientX,e.clientY);o.hoveredDay!==i&&t.setState({...o,hoveredDay:i})}},this.handleMouseMoveThrottled=c().throttle(this.handleMouseMove,50),this.handleTodayClick=()=>{const e=this.getCalendarViewRange(this.props.collectionContextStore),t="month"===e?(0,Oi.IS)((0,Oi.kl)(Date.now()),Y.AK.state):(0,Oi.IS)(Date.now(),Y.AK.state);this.setNewCalendarStart(t,e)},this.handleEditorMouseDown=e=>{const{device:t}=this.environment;t.isPhone||(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{e.preventDefault(),V.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[this.props.store],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})},this.handleOpenPeekPage=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();L.Xd({collectionContextStore:e,resultsStore:this.sortedResultsStore});const o=null==t?void 0:t.getFormat().collection_peek_mode,i=o||vo.Ls.calendar;P.trackExpandBlock(this.environment,{is_peek:!0,from:"calendar",peek_mode:i})},this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Ui.Ft)({collectionContextStore:e})}),!0),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return[];const o=this.stores.resultStore.get();return o?o.blockIds.map((e=>Pe.G.createChildStore(t,{id:e,table:C.iU}))):[]}),!0),this.weeksStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Ui.y$)({collectionContextStore:e,results:this.resultsStore.state,getRecordValue:this.getRecordValue,intl:this.props.intl})}),!0),this.sortedResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return o&&(null===(e=this.weeksStore.state)||void 0===e?void 0:e.flatMap((e=>e.items.map((e=>Pe.G.createChildStore(o,{table:C.iU,id:e.id}))))))||[]}),!0),this.getRecordValue=this.props.store.getRecordValue}willMount(e){super.willMount(e);const{collectionContextStore:t}=e;this.handleMount(t),Y.AK.addListener((()=>{this.handleMount(this.props.collectionContextStore)}))}willMountOrUpdate(e){super.willMountOrUpdate(e),Se.Z.state&&(this.stores.calendarStore.state.isDragging||this.stores.calendarStore.setState({...this.stores.calendarStore.state,hoveredDay:void 0}));const{query:t,collectionContextStore:o}=e,i=o.permissionScopes.state;!t.calendar_by&&i.canConfigureCollection&&i.canConfigureBlock&&this.updateOrCreateCalendarProperty(e)}didMountOrUpdate(){this.handleScrollThrottled(),this.root||(this.root=p.findDOMNode(this),this.root&&(this.verticalScrollableAncestor=(0,se.VW)(this.root),this.verticalScrollableAncestor&&te.lj(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),te.lj(this.root,"mousemove",this.handleMouseMoveThrottled)))}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&te.ZV(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),this.root&&te.ZV(this.root,"mousemove",this.handleMouseMoveThrottled)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.navigate({environment:this.environment,url:e})}renderPersisted(){const{device:e}=this.environment,{store:t,paddingBottom:o,paddingLeft:i,paddingRight:n,query:a,schema:l,collectionContextStore:c,isFullScreen:p}=this.props,{calendar_by:u}=a;if(!u)return this.renderMissingDateProperty();const m=l[u];if(!m||!mt.Lt(m))return this.renderMissingDateProperty();const g=this.reducerStore.state;if(!g)return;const h=this.getCalendarViewRange(c),f=this.weeksStore.state;return(0,Le.Z)((a=>s()(Ge.Z,{id:"calendar_results",resultStore:this.stores.resultStore,collectionContextStore:c,reducer:g,render:()=>s()(Mi,{isFullScreen:p},void 0,s()(Io.Z,{onChange:this.handleScrollOffsetChange},void 0,s()("div",{style:{paddingBottom:o,paddingLeft:i,paddingRight:n,minWidth:this.props.minWidth},className:X.c7X},void 0,d.createElement(yo.Z,r()({style:on.style,store:t,shouldShowHalo:!p,canSelect:!p,onMouseDown:this.handleEditorMouseDown,analyticsName:"calendar"},a),this.renderHeader(this.getCurrentlyViewedMonth(),h),s()("div",{style:e.isPhone?on.mobileHeaderSpacerStyle:on.headerSpacerStyle}),s()("div",{style:e.isPhone?on.mobileRowsWrapStyle:this.getRowsWrapStyle()},void 0,f&&f.map((t=>e.isPhone?this.renderMobileWeek(t.start,t.items,u,h):this.renderWeek(t.start,t.end,t.items,u,m,h))))))))})))}renderMissingDateProperty(){const{paddingBottom:e,paddingLeft:t,paddingRight:o}=this.props;return s()("div",{style:{paddingBottom:e,paddingLeft:t,paddingRight:o},className:X.c7X},void 0,s()(I.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a date property.",id:"database.calendarView.missingDateProperty"}))}renderHeader(e,t){const{device:o}=this.environment,{collectionContextStore:i}=this.props;return s()(vi,{position:Ve.Top},void 0,d.createElement("div",{style:o.isPhone?this.getHeaderMobileStyle():this.getHeaderStyle(),ref:this.handleHeaderMount},s()("div",{style:{display:"flex",height:42,alignItems:"center",marginBottom:2}},void 0,s()("div",{style:{fontWeight:M.Z.fontWeight.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:o.isPhone?16:14}},void 0,this.getHeaderText(t,e,Li.SP)),s()("div",{style:{flexGrow:1}}),s()(Jt.Z,{ariaLabel:this.props.intl.formatMessage({id:"database.calendarView.previousMonthButton.label",defaultMessage:"Previous Month",description:"Label for previous month button in calendar view"}),mobileFeedback:o.isMobile,icon:b.Z.chevronLeft,onClick:()=>this.handleCalendarClick("left",i)}),s()(et.Z,{isSmall:!0,onClick:this.handleTodayClick},void 0,s()(I.FormattedMessage,{defaultMessage:"Today",id:"database.calendarView.todayButton.label"})),s()(Jt.Z,{ariaLabel:this.props.intl.formatMessage({id:"database.calendarView.nextMonthButton.label",defaultMessage:"Next Month",description:"Label for next month button in calendar view"}),mobileFeedback:o.isMobile,icon:b.Z.chevronRight,onClick:()=>this.handleCalendarClick("right",i)})),s()("div",{style:{display:"flex",marginTop:o.isPhone?8:0,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`},className:X.GNl},void 0,(0,Ni.kv)(Y.AK.state,Li.SP).map((e=>{let[t,o]=e;return s()("div",{style:this.getWeekDayNameStyle()},t,o)})))))}renderWeek(e,t,o,i,n,r){const{collectionContextStore:a,format:l,schema:c,blockPropertyValueOverlayStore:d}=this.props,p=a.collectionViewStore();if(!p)return;const u=this.canEditCalendar(),{calendarStore:m}=this.stores,g=m.state,h=[...Array(7).keys()].map((t=>this.renderDay((0,Oi.Xz)({date:e,daysToAdd:t}),i,n,r))),f=[];let v=0;for(const _ of o){const o=Pe.G.createChildStore(p,{table:C.iU,id:_.id});g.isDragging&&g.target===o&&g.temporaryValue||f.push(s()($i,{collectionContextStore:a,store:o,startOfWeek:e,endOfWeek:t,start:_.start,end:_.end,row:_.row,includeTime:_.includeTime,format:l,schema:c,calendarBy:i,disabled:!u,calendarStore:m,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},o.id)),_.row>v&&(v=_.row)}const y=g.isDragging&&g.temporaryValue&&(0,Oi.Y_)(g.temporaryValue,(0,ze.r)());if(g.isDragging&&g.temporaryValue&&y&&(0,Vi.b8)(e,t,y.start,y.end)){const{target:n,temporaryValue:r}=g,p=o.find((e=>e.id===n.id));f.push(s()($i,{collectionContextStore:a,store:n,startOfWeek:e,endOfWeek:t,start:y.start,end:y.end,row:p?p.row:0,includeTime:"datetime"===r.type||"datetimerange"===r.type,format:l,schema:c,calendarBy:i,disabled:!u,calendarStore:m,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},n.id))}const b=(l.calendar_properties?l.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).length+1,S="week"===r?372:124,w=tn*b+2*Qi+2*en,k=Math.max((v+1)*w+Ji+4,S);return s()("div",{style:{...on.weekWrapStyle,height:k}},e.toString(),h,f)}renderDay(e,t,o,i){const{store:n,collectionContextStore:a}=this.props,{calendarStore:l}=this.stores,{dayStoreMap:c}=l.state,p=l.state,u="date"===o.type,g=a.shouldAllowNewItemCreation();let h=c.get(e);h||(h=new Pe.G(this.environment,n.pointer,{userId:n.userId,inMemoryRecordCache:n.inMemoryRecordCache}),c.set(e,h));const f=!p.isDragging&&p.hoveredDay===e,v=(0,Oi.Bn)({firstDate:e,secondDate:this.getCurrentlyViewedMonth()}),y=(0,Oi.Y3)(e),S=(0,Oi.LY)(e),w=!v&&!y&&"week"!==i,k=this.props.intl.formatMessage({defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"});return s()(yo.Z,{style:S?this.getWeekendDayStyle():this.getDayStyle(),store:h,canDropOnto:this.canEditCalendar()&&u,onSelectableDrop:o=>{W.createAndCommit({userAction:"Calendar.renderDay",environment:this.environment,perform:i=>{const n=a.collectionStore();n&&(J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:a,is_native_drop:!1,is_empty:!1})})),Z.JN({...o,environment:this.environment,startOfDay:e,calendarBy:t,collectionStore:n,collectionContextStore:a,results:this.resultsStore.state,transaction:i}))}})},onDoubleClick:()=>{this.canEditCalendar()&&Ne.M_(this.environment)&&g&&(this.createBlockInDay(e,t),P.trackCreateBlock(this.environment,{type:"page",from:"calendar_day_double_click",...(0,J.Pn)(a)}))},analyticsName:"calendar_day",shouldShowDropZone:!0},e.toString(),f&&u&&g&&this.canEditCalendar()&&s()(it.Z,{renderTooltip:()=>k,render:o=>d.createElement(Jt.Z,r()({ariaLabel:k,icon:b.Z.plus,showShadow:!0,hasBackground:!0,style:{position:"absolute",top:6,left:6,width:20,height:20},onClick:()=>{Ne.M_(this.environment)&&(this.createBlockInDay(e,t),P.trackCreateBlock(this.environment,{type:"page",from:"calendar_day_add_button",...(0,J.Pn)(a)}))}},(0,Ye.Z)(o,{onMouseDown:ie.$0})))}),s()("div",{style:{...y?this.getTodayNumberStyle():on.dayNumberStyle,...w&&{color:this.theme.lightTextColor}},className:X.irE},void 0,1!==(0,Oi.TE)(e)||y?(0,Oi.TE)(e):`${new Intl.DateTimeFormat(this.props.intl.locale,{month:"short",day:"numeric"}).format(new Date(e))} `))}renderMobileWeek(e,t,o,i){const n=[...Array(7).keys()].map((n=>{const r=(0,Oi.Xz)({date:e,daysToAdd:n});return this.renderMobileDay(r,(0,Oi.us)(r),t,o,i)}));return s()("div",{style:this.getMobileWeekStyle()},e.toString(),n)}renderMobileDay(e,t,o,i,n){const{collectionContextStore:a,query:l,format:c,schema:p,blockPropertyValueOverlayStore:u}=this.props,m=this.canEditCalendar(),g=o.find((o=>(0,Vi.b8)(e,t,o.start,o.end?o.end:void 0))),h=(0,Oi.TE)(e),f=(0,Oi.Bn)({firstDate:e,secondDate:this.getCurrentlyViewedMonth()}),v=(0,Oi.Y3)(e),y=!f&&!v&&"week"!==n;return s()(qe.Z,{popupType:qe.Z.PopupType.SlideUp,renderOrigin:e=>d.createElement(Ot.Z,r()({style:on.mobileDayButtonStyle},e),s()("div",{style:{...v?on.mobileTodayNumberStyle:on.mobileDayNumberStyle,...y&&{color:this.theme.lightTextColor}}},void 0,h),g&&s()("div",{style:this.getMobileDayEventDotStyle()})),render:t=>s()(Hi.LazyMobileCalendarDayMenu,{collectionContextStore:a,initialStartOfDay:e,format:c,schema:p,query:l,calendarBy:i,disabled:!m,onDismiss:t.close,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore})},h.toString())}handleCalendarClick(e,t){const o=(0,Oi.V7)(t.dateRangeStart.get(),Y.AK.state),i=this.getCalendarViewRange(this.props.collectionContextStore);if("month"===i){const t="left"===e?-1:1,n=(0,Oi.IS)((0,Oi.kl)((0,Oi._)({date:o,monthsToAdd:t})),Y.AK.state);this.setNewCalendarStart(n,i)}else{const o="left"===e?-7:7,n=(0,Oi.IS)((0,Oi.Xz)({date:t.dateRangeStart.get(),daysToAdd:o}),Y.AK.state);this.setNewCalendarStart(n,i)}}handleMount(e){const t=e.collectionViewStore();if(!t)return;const o=this.getCalendarViewRange(e),i=Y.AK.state,n=ji.Z.getLocalDateRangeStart({collectionViewId:t.id,currentUserId:this.environment.currentUser.id}),r=(0,Oi.IS)(n,i),a=(0,Oi.IS)((0,Oi.kl)(n),i),s="month"===o?a:r;this.stores.calendarStore.setState({...this.stores.calendarStore.state,startingMonth:a.valueOf()}),this.setNewCalendarStart(s,o)}getHeaderText(e,t,o){var i,n;const r=(0,Ni.Yx)(t,"month_year_long",o);if("month"===e)return r;const a=null===(i=this.weeksStore)||void 0===i||null===(n=i.state)||void 0===n?void 0:n[0];if(void 0===a)return"";if((0,Oi.Bn)({firstDate:a.start,secondDate:a.end}))return r;return`${(0,Ni.Yx)(a.start,(0,Oi.Xh)({firstDate:a.start,secondDate:a.end})?"month_short":"month_year_short",o)} - ${(0,Ni.Yx)(a.end,"month_year_short",o)}`}setDateRange(e,t){const{collectionContextStore:o}=this.props,{calendarStore:i}=this.stores;F.t5({dateRangeStart:e,dateRangeEnd:t,collectionContextStore:o}),i.setState({...i.state,startingMonth:(0,Oi.kl)((0,Oi.V7)(e,Y.AK.state))})}findHoveredDay(e,t){H.Ch();const{dayStoreMap:o}=this.stores.calendarStore.state,{selectableRectMap:i}=Ki.Z.state,n=Array.from(o.keys()),r=Array.from(o.values());for(const[a,s]of i.entries())if(s&&Wi.uh(s,e,t)&&r.indexOf(a.props.store)>=0)return n.find((e=>o.get(e)===a.props.store))}createBlockInDay(e,t){const{collectionContextStore:o}=this.props,{mainEditorCurrentBlockStore:i}=pe.default.state;W.createAndCommit({userAction:"Calendar.createBlockInDay",environment:this.environment,perform:n=>{const{newStore:r}=R.IW({environment:this.environment,collectionContextStore:o,groupsPointer:[],results:this.resultsStore.state,insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:n,from:"calendar"});Z.xD({type:"timestamp",environment:this.environment,store:r,propertyId:t,timestampMs:e,transaction:n});const a=ee.mb({store:r,mainEditorCurrentBlockStore:i,collectionContextStore:o})??(0,oe.ZP)({store:r});this.navigate(a),L.Xd({collectionContextStore:o,resultsStore:void 0})}})}setNewCalendarStart(e,t){const{collectionContextStore:o}=this.props,i=o.collectionViewStore();if(!i)return;const n=this.shouldInfinitelyLoad(),r=Y.AK.state,a=(0,Oi.V7)(e,r),s=(0,Oi.IS)(e,r);if(ji.Z.setLocalDateRangeStart({collectionViewId:i.id,dateRangeStart:"month"===t?a:s,currentUserId:this.environment.currentUser.id}),"month"===t){const t=n?(0,Oi.V7)((0,Oi._)({date:a,monthsToAdd:1}),r):(0,Oi.V7)((0,Oi.RN)(a),r);this.setDateRange(e,t),this.verticalScrollableAncestor&&n&&(this.verticalScrollableAncestor.scrollTop=0)}else"week"===t&&this.setDateRange(e,a)}shouldInfinitelyLoad(){const{device:e}=this.environment,{collectionContextStore:t}=this.props,o="month"===this.getCalendarViewRange(t);return this.props.isFullScreen&&!e.isMobile&&o}isInMonth(e){const{startOfDay:t,startOfMonth:o}=e;return(0,Oi.AD)({date:t,startOfMonth:o})}updateOrCreateCalendarProperty(e){const{schema:t}=e,{collectionContextStore:o}=this.props,i=o.collectionStore();if(!i)return;const n=o.collectionViewStore();n&&W.createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:this.environment,perform:e=>{let o,r=ee.PD(t);if(!r){r=(0,Ae.ZP)();o={[r]:{name:this.props.intl.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}F.Es({collectionViewStore:n,update:{calendar_by:r},transaction:e}),o&&F.xO({environment:this.environment,collectionStore:i,update:o,transaction:e})}})}canEditCalendar(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent}getHeaderStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{position:"absolute",left:0,right:0,background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),zIndex:T.VT}}getHeaderMobileStyle(){return{position:"absolute",left:0,right:0,background:this.theme.contentBackground,zIndex:T.VT}}getRowsWrapStyle(){return{boxShadow:`-1px 0 0 ${this.theme.tableDividerColor}`,marginTop:1,overflow:"hidden"}}getWeekDayNameStyle(){return{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,height:24,color:this.theme.lightTextColor}}getDayStyle(){return{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${this.theme.tableDividerColor}`,borderBottom:`1px solid ${this.theme.tableDividerColor}`,cursor:"default"}}getWeekendDayStyle(){return{...this.getDayStyle(),background:this.props.isInPeekRenderer?this.theme.cardSidebarBackground:this.theme.sidebarBackground}}getTodayNumberStyle(){return{position:"absolute",fontSize:14,top:4,right:4,height:24,width:24,lineHeight:"24px",borderRadius:"100%",textAlign:"center",color:Eo.ZP.white,background:this.theme.calendarTodayBackground}}getMobileWeekStyle(){return{display:"flex",boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}}getMobileDayEventDotStyle(){return{width:8,height:8,background:this.theme.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}}getCalendarViewRange(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_view_range").getValue())??"month"}getCurrentlyViewedMonth(){return this.shouldInfinitelyLoad()?this.stores.calendarStore.state.startingMonth:(0,Oi.kl)((0,Oi.V7)(this.props.collectionContextStore.dateRangeStart.get(),Y.AK.state))}}on.contextTypes={...K.wK,...u.w},on.style={position:"relative",paddingLeft:1},on.viewRangeSelectorButtonStyle={marginRight:6,paddingRight:6},on.headerSpacerStyle={height:66},on.mobileHeaderSpacerStyle={height:74},on.mobileRowsWrapStyle={},on.weekWrapStyle={position:"relative",display:"flex"},on.dayNumberStyle={position:"absolute",fontSize:14,top:4,right:10,height:24,lineHeight:"24px",textAlign:"right",transition:"color 100ms ease-out"},on.mobileDayButtonStyle={width:"100%",height:44,borderRadius:3},on.mobileDayNumberStyle={height:28,display:"flex",alignItems:"center",justifyContent:"center"},on.mobileTodayNumberStyle={height:28,width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",color:Eo.ZP.white,background:Eo.ZP.red,marginLeft:"auto",marginRight:"auto"},on.loadingSpinnerStyle={margin:"8px auto"};const nn=(0,I.injectIntl)(on);class rn extends ut.Z{getInitialState(){return{}}}const an=rn;class sn extends Ee.Z{renderComponent(){return s()(Xt,{store:this.props.store,disabled:this.props.disabled,isFirstItem:this.props.isFirstItem,isLastItem:this.props.isLastItem,hideContent:this.props.hideContent,blockResizerStore:this.props.blockResizerStore,isQuickFind:this.props.isQuickFind,style:this.props.style,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag,numberedListCounterStore:this.props.numberedListCounterStore,bulletedListFormatStore:this.props.bulletedListFormatStore,format:this.props.format,schema:this.props.schema,coverFormat:this.props.coverFormat,coverAspectFormat:this.props.coverAspectFormat,coverSizeFormat:this.props.coverSizeFormat,coverHeight:this.props.coverHeight,coverWidth:this.props.coverWidth,shouldShowTitle:this.props.shouldShowTitle,colorStyle:void 0,onTextEnter:this.props.onTextEnter,onTextEsc:this.props.onTextEsc,onShiftEnter:this.props.onShiftEnter,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isLast:this.props.isLast,handleOpenPeekPage:this.props.handleOpenPeekPage,collectionContextStore:this.props.collectionContextStore})}}const ln=sn;class cn extends u.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:an},this.selectableContainer=null,this.renderGroupHeader=e=>d.createElement(bi,r()({},e,{height:48,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle})),this.renderGroup=e=>{const{store:t,format:o,disabled:i,collectionContextStore:n,schema:r,blockPropertyValueOverlayStore:a,isFullScreen:l}=this.props,{collectionGalleryViewStore:c}=this.stores,p=this.isSingleColumnStore.state,u=this.isReady.state,m=this.getCoverFormat(),g=e?[e]:[],h=n.groupsStore.getGroupState(g);if(!h)return;const f=h.reducerResultStore.state,v=ee.VM({collectionContextStore:n,reducerResult:f,isFullScreen:l}),y=n.permissionScopes.state,b=y.isSyncedCollection,S=t.canEdit()&&("collectionTypedView"===n.contextType||y.canEditContent),w=u&&!i&&S&&!b,k=!i&&S&&!b;return s()("div",{style:{paddingBottom:e?16:void 0}},void 0,s()("div",{style:this.getGroupWrapStyle()},void 0,s()(To,{collectionContextStore:n,groupsPointer:g,format:o,canDrag:k,onSelectableEnter:this.handleItemEnter,resultProps:{format:o,schema:r,onTextEnter:this.handleItemTextEsc,onTextEsc:this.handleItemTextEsc,onShiftEnter:this.handleItemEnter,disabled:i,coverFormat:m,coverAspectFormat:this.getCoverAspectFormat(),coverSizeFormat:this.getCoverSizeFormat(),coverHeight:c.state.coverHeight,coverWidth:c.state.coverWidth,shouldShowTitle:ct.K8(this.props.format,"gallery"),blockPropertyValueOverlayStore:a,collectionContextStore:n},resultComponent:ln,canDrop:!0,disabled:i,shouldShowHoverMenu:!1,direction:p?_o.Vertical:_o.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:this.getEmptyDroppableStyle(),loadContentCover:m&&"page_content"===m.type}),w&&this.renderAddItemButton(g)),v&&d.createElement(d.Fragment,null,s()("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),s()(ao,{groupsPointer:g,store:t,collectionContextStore:n,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1})))},this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&this.setCardCoverWidth(o)},this.handleResizeDebounced=(0,l.debounce)(this.handleResize,1e3),this.handleResizeThrottled=(0,l.throttle)(this.handleResize,100),this.handleScrollOffsetChange=e=>{var t;const{collectionContextStore:o,isFullScreen:i}=this.props,n=o.isLoading.get(),r=null===(t=this.getDefaultResultStore())||void 0===t?void 0:t.get();e<ge.Z.incrementScrollOffset&&r&&!n&&null!=r&&r.hasMore&&o.groupsStore.incrementLimit({isFullScreen:i,currentResultCount:r.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1})},this.handleItemEnter=e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();H.eP({environment:this.environment,store:e}),z.NX({store:o}),F.Z5({store:e})}},this.handleItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),i=e.getTitleStore();if(!i)return;st.Q(i.getValue())?H.Ys({environment:this.environment,store:e}):o&&W.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:this.environment,perform:t=>{R.Od({store:e,transaction:t})}})},this.handleAddItemClick=e=>{if(!Ne.M_(this.environment))return;const{collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);o&&W.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:this.environment,perform:i=>{const{mainEditorCurrentBlockStore:n}=pe.default.state,{newStore:r}=R.IW({environment:this.environment,collectionContextStore:t,groupsPointer:e,results:o.resultsStore.state,insertAtIndex:o.resultsStore.state.length,coerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"gallery"}),a=ee.mb({store:r,mainEditorCurrentBlockStore:n,collectionContextStore:t})??(0,oe.ZP)({store:r});this.navigate(a),L.Xd({collectionContextStore:t,resultsStore:o.resultsStore}),P.trackCreateBlock(this.environment,{from:"list_view_add_item_bottom",type:"page",...(0,J.Pn)(t)})}})},this.handleGroupHeaderAddItem=e=>{if(this.environment.device.isMobile)N.navigateToBlock({environment:this.environment,store:e});else{const{collectionContextStore:t}=this.props;N.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t})}},this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=cn.singleColumnScreenWidth)),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getGroupStyle=e=>0===e.index?{}:{borderTop:`1px solid ${this.theme.tableDividerColor}`},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.contentBackground}`:void 0})}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.navigate({environment:this.environment,url:e})}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),this.setCardCoverWidth())}didMount(){this.setCardCoverWidth(),this.setCardCoverHeight(),(0,te.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,te.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,te.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,te.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:i,paddingRight:n,isFullScreen:a,collectionContextStore:l}=this.props,c=ee.az(l,a),p=t.collection_group_by;return(0,Le.Z)((t=>s()("div",{style:{paddingBottom:o,paddingLeft:i,paddingRight:n,minWidth:this.props.minWidth},className:X.sbt},void 0,d.createElement(yo.Z,r()({store:e,shouldShowHalo:!a,canSelect:!a,analyticsName:"gallery"},t,{ref:e=>this.selectableContainer=e}),p?this.renderGroups(p):this.renderGroup(void 0)),!c&&s()(Io.Z,{onChange:this.handleScrollOffsetChange}))))}renderGroups(e){const{store:t,format:o,collectionContextStore:i,schema:n,disabled:r,isFullScreen:a,paddingLeft:l,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(Ri,{store:t,id:"gallery_groups",groupBy:e,groupsFormatKey:Re.Uh,groupAggregationKey:Re.dQ,format:o,schema:n,collectionContextStore:i,disabled:r,isFullScreen:a,renderGroup:this.renderGroup,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,renderHeader:this.renderGroupHeader,getGroupStyle:this.getGroupStyle,paddingLeft:l,isRootChild:c,isInPeekRenderer:d})}renderAddItemButton(e){return s()(Ot.Z,{onClick:()=>this.handleAddItemClick(e),onMouseDown:ie.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:3,boxShadow:"dark"===this.theme.mode?`${this.theme.darkDividerColor} 0px 0px 0px 1px inset`:`${this.theme.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:40}},void 0,s()("div",{style:{display:"flex",alignItems:"center",marginLeft:-6}},void 0,b.Z.plus(this.getNewItemButtonIconStyle()),s()("div",{style:{color:this.theme.lightIconColor}},void 0,s()(I.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"}))))}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}setCardCoverWidth(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverWidth:e||this.getGalleryCardWidth()})}getCoverFormat(){const{format:e}=this.props;return e?e.gallery_cover:void 0}getCoverAspectFormat(){const{format:e}=this.props;return e?e.gallery_cover_aspect:void 0}getCoverSizeFormat(){const{format:e}=this.props;return e?e.gallery_cover_size:void 0}getGalleryCardWidth(){const{format:e}=this.props;switch((e||{}).gallery_cover_size){case"large":return Oe.Z.card.desktop.large.width;case"small":return Oe.Z.card.desktop.small.width;case"medium":default:return Oe.Z.card.desktop.medium.width}}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${X.K4T}`);if(t)return t.offsetWidth}}return this.getGalleryCardWidth()}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}getDefaultResultStore(){var e;const{collectionContextStore:t}=this.props;return null===(e=t.groupsStore.getGroupState([]))||void 0===e?void 0:e.reducerResultStore}getGroupWrapStyle(){const e=this.props.format.collection_group_by;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${this.isSingleColumnStore.state?"100%":`${this.getGalleryCardWidth()}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:e?1:16,paddingBottom:4}}getEmptyDroppableStyle(){return this.isSingleColumnStore.state?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}}getNewItemButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}}cn.displayName="CollectionGalleryView",cn.contextTypes={...K.wK,...u.w},cn.singleColumnScreenWidth=480;const dn=cn;var pn=o(6776);function un(e){const{environment:t,newStore:o,previousStore:i}=e;H.eP({environment:t,store:o}),F.Z5({store:o}),pn.Z.setState({store:o,editMode:"new",previousStore:i})}var mn=o(37190);class gn extends Ee.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:ke.Z},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:i,collectionContextStore:n}=this.props,r=t.getAssociatedCollectionStore();if(r)return s()(Vt.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:n.permissionScopes.state.isLocked,format:Nt.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:r,collectionViewStore:this.props.collectionContextStore.collectionViewStore(),showIfEmpty:this.isEditing.state,onBgClick:this.handleBlockPropertyExit,onEnter:this.handleBlockPropertyExit,onEsc:this.handleBlockPropertyExit,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,onClick:this.disallowEmptyItemDelete},e)},this.renderDiscussionIndicator=()=>{const{store:e}=this.props,t=wt.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return s()("div",{style:{display:"inline-flex",alignItems:"center",color:this.theme.lightTextColor,fontWeight:M.Z.fontWeight.semibold,fontSize:12,paddingLeft:10,paddingRight:10}},void 0,b.Z.speechBubble({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t)},this.handleOpenPeekPage=()=>{this.disallowEmptyItemDelete(),this.props.handleOpenPeekPage()},this.handleRecordIconChange=e=>{const{store:t}=this.props,o=t.getIconStore();o&&W.createAndCommit({userAction:"CollectionListViewItem.handleRecordIconChange",environment:this.environment,perform:t=>{yt.sO({store:o,value:e,transaction:t})}})},this.handleMouseMove=()=>{if(!Se.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=(0,l.throttle)(this.handleMouseMove,100),this.handleMouseLeaveDebounced=(0,l.debounce)(this.handleMouseLeave,100),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditing=this.createComputedStore((()=>{const e=kt.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditMode=this.createComputedStore((()=>{const e=pn.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.newItemPreviousStore=this.createComputedStore((()=>{const e=pn.Z.state;return e.store&&e.store.id===this.props.store.id?e.previousStore:void 0})),this.removeCollectionListViewItem=e=>{W.createAndCommit({userAction:"CollectionListViewItem.handleItemTextEsc",environment:this.environment,perform:t=>{R.Od({store:e,transaction:t})}})},this.disallowEmptyItemDelete=()=>{F.IH({store:this.props.store})},this.handleBlockPropertyExit=()=>{vt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),H.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyItemDelete()},this.handleTitleTab=()=>{const e=this.getNonEmptyProperties(),t=this.findFirstOpenableProperty(e);this.handleTitleTabShortcuts(t)},this.handleTitleUntab=()=>{const e=this.getNonEmptyProperties(),t=this.findLastOpenableProperty(e);this.handleTitleTabShortcuts(t)},this.handleBlockPropertyTab=()=>{const e=this.findNextOpenableProperty();this.handlePropertyTabShortcuts(e)},this.handleBlockPropertyUntab=()=>{const e=this.findPreviousOpenableProperty();this.handlePropertyTabShortcuts(e)},this.shouldCaptureKeyboard=this.createComputedStore((()=>_t.default.state.stores.length>0&&_t.default.state.stores[0].id===this.props.store.id))}activate(){const e=this.getPeekUrl();e&&(this.props.handleOpenPeekPage(),N.navigate({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditing.state&&"new"===this.newItemEditMode.state&&z.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),pn.Z.reset(),kt.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,i=this.renderToggleButton();return o?s()("div",{style:{display:"flex"}},void 0,i,s()(Ht.Z,{href:this.getBlockUrl(),metaHref:this.getPeekUrl(),external:!1,style:this.getTwoLineMobileWrapStyle(),innerStyle:{paddingRight:4,marginTop:10,marginBottom:10}},void 0,s()("div",{style:{display:"flex",alignItems:"center"}},void 0,this.renderTitle()),s()("div",{style:{display:"flex",alignItems:"center",paddingLeft:6,marginTop:4}},void 0,t.map(this.renderProperty)))):s()(Ut.Z,{capture:this.shouldCaptureKeyboard.state,onShiftEnter:this.props.onShiftEnter},void 0,s()("div",{style:{display:"flex"}},void 0,i,s()(Ht.Z,{href:this.getBlockUrl(),metaHref:this.getPeekUrl(),onClick:this.handleOpenPeekPage,external:!1,style:this.getInlineWrapStyle(this.isEditing.state?"multi":"single"),innerStyle:{display:"flex",alignItems:"center",paddingRight:4,userSelect:this.isEditing.state?void 0:"none",WebkitUserSelect:this.isEditing.state?void 0:"none"},hoveredStyle:{background:this.isEditing.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditing.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced},void 0,this.renderTitle(),t.map(this.renderProperty))))}renderTitle(){const{store:e,disabled:t,collectionContextStore:o,blockPropertyValueOverlayStore:i}=this.props,n=e.getAssociatedCollectionStore();if(!n)return;const{isSyncedCollection:r}=o.permissionScopes.state;return s()(Vt.Z,{store:e,property:r?" title":"title",disabled:t||!e.canEdit(),locked:o.permissionScopes.state.isLocked,format:Nt.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:n,collectionViewStore:o.collectionViewStore(),forceMouseEntered:this.mouseIsEntered.state,handleOpenPeekPage:this.handleOpenPeekPage,onTab:this.handleTitleTab,onUntab:this.handleTitleUntab})}renderToggleButton(){const{collectionContextStore:e,toggleButton:t,subitemPath:o}=this.props,i=e.currentSubitemFormatStore.state,n=(null==o?void 0:o.length)??0;if(!i)return;const r=Math.max((n-1)*go.Hw,0)+go.gY;return t?s()("div",{style:{paddingTop:4,display:"flex"}},void 0,s()("div",{style:{width:r}}),t):s()("div",{style:{minWidth:r+go.Hw}})}handlePropertyTabShortcuts(e){const{store:t,blockPropertyValueOverlayStore:o}=this.props;if(o.state.isOpen){if("title"===e){vt.xv({environment:this.environment,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();H.eP({environment:this.environment,store:t}),z.NX({store:e})}else e?(vt.xv({environment:this.environment,blockPropertyValueOverlayStore:o}),vt.bA({environment:this.environment,blockPropertyValueOverlayStore:o,store:t,property:e,format:Nt.C.ListView,collectionContextStore:this.props.collectionContextStore})):vt.xv({environment:this.environment,blockPropertyValueOverlayStore:o});this.disallowEmptyItemDelete()}}handleTitleTabShortcuts(e){e&&vt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:e,format:Nt.C.ListView,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyItemDelete()}findPreviousOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),i=t.isOpen?o.findIndex((e=>e===t.property)):-1,n=c().findLast(o,((e,t)=>t<i&&this.canOpenProperty(e)));return n||(this.isEditing.state?"title":this.findLastOpenableProperty(o))}findNextOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),i=t.isOpen?o.findIndex((e=>e===t.property)):-1,n=o.find(((e,t)=>t>i&&this.canOpenProperty(e)));return n||(this.isEditing.state?"title":this.findFirstOpenableProperty(o))}findLastOpenableProperty(e){return c().findLast(e,(e=>this.canOpenProperty(e)))}findFirstOpenableProperty(e){return e.find((e=>this.canOpenProperty(e)))}canOpenProperty(e){const{schema:t}=this.props,o=t[e];return Boolean(o&&!mt.uk.includes(o.type))}getNonEmptyProperties(){const{store:e,schema:t,showProperties:o}=this.props;return e.isDefined()?o.filter((o=>{const i="title"!==o&&this.isEditing.state;return!Bt.wV({property:o,schema:t,block:e.getModel(),getRecordModel:e.getRecordModel,userTimeZone:(0,ze.r)(),intl:ne.default.getIntl()})||i})):[]}getPeekUrl(){const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=pe.default.state;return ee.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}getBlockUrl(){return(0,oe.ZP)({store:this.props.store,fullyQualified:!1})}getInlineWrapStyle(e){return{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:3,..."single"===e?{height:30}:{minHeight:30}}}getTwoLineMobileWrapStyle(){return{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${this.theme.tableDividerColor}`}}getTitleWrapStyle(){const{device:e}=this.environment;return{display:"flex",marginRight:"auto",minWidth:e.isMobile?0:240}}getTitleStyle(){return{fontWeight:M.Z.fontWeight.medium,borderBottom:`1px solid ${this.theme.tableDividerColor}`,lineHeight:1.3}}}gn.iconStyle={marginLeft:2,marginRight:6};const hn=gn;function fn(e){window.__c={n:"CollectionNestedCreateSubitemButton"};const t=(0,so.O7)(),{store:o,collectionContextStore:i,disabled:n,groupsPointer:r,collectionStore:a,subitemPath:l,indentLevel:c,onSubitemCreate:p}=e,u=(0,lo.VK)((()=>(0,ee.fk)({environment:t,collectionContextStore:i})),[i,t]),m=(0,lo.VK)((()=>{var e;return"timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i]),g=(0,co.yK)((t=>({newRow:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:(0,ho.f2)({columnIndex:0,shouldShowBulkActionsToolbar:u,indentLevel:c+1})+8,fontSize:14,lineHeight:M.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${t.tableDividerColor}`,borderBottom:`1px solid ${t.tableDividerColor}`,background:t.contentBackground,left:0,right:0,...m&&{background:"none",borderTop:"none"},...e.styles},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[c,u,m,e.styles]),h=(0,lo.VK)((()=>{const e=i.permissionScopes.state,t=a.isSyncedCollection();return!n&&e.canEditContent&&!t}),[i,n,a]),f=(0,d.useCallback)((()=>{W.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:e=>{var n;const s=null===(n=i.groupsStore.getGroupState(r))||void 0===n?void 0:n.resultsStore,c=R.yk({environment:t,collectionContextStore:i,groupsPointer:r,results:(null==s?void 0:s.state)??[],store:o,before:!1,collectionStore:a,transaction:e,subitemPath:l,subitemInsertDirection:"into"});c&&p(c)}}),P.trackTableSubItemCreate(t)}),[i,t,r,a,o,l,p]);return h?s()(Ot.Z,{onClick:f,onMouseDown:ie.$0,style:g.newRow},void 0,b.Z.plus(g.newIcon),s()("span",{style:g.newText},void 0,s()(I.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem",description:"Button label for inserting a new nested sub-item into database view"}))):null}class vn extends u.Z{constructor(){super(...arguments),this.renderGroupHeader=e=>d.createElement(bi,r()({},e,{height:48,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle})),this.renderGroup=e=>{const{store:t,format:o,isFullScreen:i,disabled:n,collectionContextStore:r,schema:a,blockPropertyValueOverlayStore:l}=this.props,c=e?[e]:[],p=this.getShowProperties(),u=this.isReady.state,m=r.groupsStore.getGroupState(c);if(!m)return;const g=r.permissionScopes.state,h=m.reducerResultStore.state,f=g.isSyncedCollection,v=ee.VM({collectionContextStore:r,reducerResult:h,isFullScreen:i}),y=u&&!n&&t.canEdit()&&g.canEditContent&&!f,b=!n&&t.canEdit()&&g.canEditContent&&!f;return s()("div",{style:{paddingBottom:e?16:void 0}},void 0,s()(To,{collectionContextStore:r,groupsPointer:c,format:o,canDrag:b,resultProps:{schema:a,collectionViewBlockStore:this.props.store,showProperties:p,disabled:n,blockPropertyValueOverlayStore:l,collectionContextStore:r,onShiftEnter:()=>this.onItemShiftEnter(m)},canDrop:!0,resultComponent:hn,disabled:n,shouldShowHoverMenu:!0,direction:_o.Vertical,analyticsName:"list",getItemSelectableStyle:this.getItemSelectableStyle,emptyDroppableSize:0,onSelectableInsertRowBelow:this.onSelectableInsertRowBelow,nestedCreateSubitemButton:e=>{const{store:t,parentStore:o,subitemPath:i,indentLevel:a}=e;if(o)return s()(fn,{store:t,collectionStore:o,subitemPath:i,indentLevel:a,collectionContextStore:r,disabled:n,groupsPointer:c,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{F.Z5({store:e,transient:!1}),pn.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}}),v&&s()(ao,{groupsPointer:c,store:t,collectionContextStore:r,format:o,isFullScreen:i,incrementLimitsInRelatedGroups:!1}),y&&d.createElement(d.Fragment,null,v&&s()("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),this.renderAddItemButton(m)))},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,i=t.isLoading.get(),n=t.groupsStore.getGroupState([]);if(!n)return;const r=n.reducerResultStore.state;e<ge.Z.incrementScrollOffset&&r&&!i&&r.hasMore&&t.groupsStore.incrementLimit({isFullScreen:o,currentResultCount:r.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1})},this.handleAddItemClick=e=>{if(!Ne.M_(this.environment))return;const{collectionContextStore:t}=this.props;t.collectionStore()&&W.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:this.environment,perform:o=>{t.collectionStore()&&function(e){const{transaction:t,environment:o,results:i,resultsStore:n,collectionContextStore:r,isFullScreen:a,groupsPointer:s,insertAtIndex:l,from:c}=e;let d;r.searchQuery.get()&&F.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:a}),l>0&&(d=i[l]);const{newStore:p,coercionSucceeded:u}=R.IW({environment:o,collectionContextStore:r,groupsPointer:s,results:i,insertAtIndex:l,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:c});o.device.isMobile?N.navigateToBlock({environment:o,store:p}):u?un({environment:o,newStore:p,previousStore:d}):N.peekBlock({environment:o,store:p,peekMode:(0,ee.kr)(r.collectionViewStore()),resultsStore:n,collectionContextStore:r}),P.trackCreateBlock(o,{from:c,type:"page",...(0,J.Pn)(r)})}({transaction:o,environment:this.environment,results:e.resultsStore.state,resultsStore:e.resultsStore,collectionContextStore:t,isFullScreen:this.props.isFullScreen,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:"list_view_add_item_bottom"})}})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)N.navigateToBlock({environment:this.environment,store:e});else if(t)un({environment:this.environment,newStore:e,previousStore:void 0});else{const{collectionContextStore:t}=this.props,{groupFormat:i}=o,n=i?[i]:[],r=t.groupsStore.getGroupState(n);N.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t})}},this.onItemShiftEnter=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore();if(!o||!t.shouldAllowNewItemCreation())return;const i=_t.default.state.stores[0];if(!i)return;const n=t.subitemTreeStore.state,r=(0,mo.DY)(n.children,(e=>e.value.store===i));if(!r)return;const a=r?(0,go.Af)(r.map((e=>e.value.store))):"",s=t.subitemExpandedStore.get().get(a),l=Boolean(null==s?void 0:s.isExpanded);W.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:this.environment,perform:n=>{const a=R.yk({environment:this.environment,collectionContextStore:t,groupsPointer:e.groupsPointer,results:e.resultsStore.state,store:i,before:!1,collectionStore:o,transaction:n,subitemPath:r,subitemInsertDirection:l?"into":"below"});a&&un({environment:this.environment,newStore:a,previousStore:i})}}),P.trackCollectionItemEditModeEnter(this.environment,"list_item_edit_mode_enter",{...(0,J.Pn)(t),block_id:i.id,from:"shiftEnter",view_type:"list"})},this.onSelectableInsertRowBelow=(e,t)=>{un({environment:this.environment,newStore:t,previousStore:e})},this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getItemSelectableStyle=()=>vn.itemSelectableStyle,this.getGroupStyle=e=>0===e.index?{}:{borderTop:`1px solid ${this.theme.tableDividerColor}`},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.contentBackground}`:void 0})}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:i,paddingRight:n,isFullScreen:a,collectionContextStore:l}=this.props,c=ee.az(l,a),p=t.collection_group_by;return(0,Le.Z)((t=>s()("div",{style:{paddingBottom:o,paddingLeft:i,paddingRight:n,minWidth:this.props.minWidth},className:X.nM$},void 0,d.createElement(yo.Z,r()({store:e,shouldShowHalo:!a,canSelect:!a,analyticsName:"list",style:this.getWrapStyle()},t),p?this.renderGroups(p):this.renderGroup(void 0)),!c&&s()(Io.Z,{onChange:this.handleScrollOffsetChange}))))}renderGroups(e){const{store:t,format:o,collectionContextStore:i,schema:n,disabled:r,isFullScreen:a,paddingLeft:l,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(Ri,{store:t,id:"list_groups",groupBy:e,groupsFormatKey:Re.Uh,groupAggregationKey:Re.dQ,format:o,schema:n,collectionContextStore:i,disabled:r,isFullScreen:a,renderGroup:this.renderGroup,renderHeader:this.renderGroupHeader,getGroupStyle:this.getGroupStyle,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,paddingLeft:l,isRootChild:c,isInPeekRenderer:d,onSelectableInsertRowBelow:this.onSelectableInsertRowBelow})}renderAddItemButton(e){return d.createElement(Ot.Z,{onClick:()=>this.handleAddItemClick(e),onMouseDown:ie.$0,ref:e=>{e&&mn.registerElementForShadowCursor("db-new-in-list",e)},style:{display:"flex",alignItems:"center",height:30,borderRadius:3,fontSize:14}},b.Z.plus(this.getNewItemButtonIconStyle()),s()("div",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})))}getShowProperties(){const{format:e}=this.props;return(e.list_properties?e.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.navigate({environment:this.environment,url:e})}getWrapStyle(){const{format:e}=this.props;return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by?void 0:8,paddingBottom:4}}getNewItemButtonIconStyle(){return{width:14,height:14,marginLeft:4,marginRight:6,fill:this.theme.lightIconColor}}}vn.displayName="CollectionListView",vn.contextTypes={...K.wK,...u.w},vn.itemSelectableStyle={marginTop:1,marginBottom:1,borderRadius:3};const yn=vn;var bn=o(33665);class Sn extends ut.Z{getInitialState(){return{query:"",limit:20}}}const wn=Sn;var kn=o(81870),Cn=o(26909),_n=o(44514),Mn=o(45669),Tn=o(11470);const In=(0,I.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}});class Pn extends u.Z{constructor(){super(...arguments),this.storeTypes={store:wn,resultStore:Ze.default.of(void 0)},this.renderResults=()=>{const{collectionViewType:e}=this.props,{store:t}=this.stores,{query:o}=t.state,i=this.getCurrentResult(),n=s()(I.FormattedMessage,"calendar"===e?{defaultMessage:"Click to add to the calendar",id:"collectionNoDateMenu.addResultToCalendar.prompt"}:{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"});return i?i&&0===i.blockIds.length?s()(ot.Z,{title:n},void 0,s()(Xo.Z,{title:s()(I.FormattedMessage,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})):s()(Je.Z,{type:Je.i.Vertical,sections:[{key:"results",render:e=>d.createElement(ot.Z,r()({},e,{title:n})),items:this.getMenuListItems(i.blockIds)}],initialFocus:o?0:void 0}):s()(ot.Z,{title:n,loading:!0},void 0,s()(Xo.Z,{title:s()(I.FormattedMessage,{defaultMessage:"Loading…",id:"collectionNoDateMenu.loading.message"})}))},this.handleQueryChange=e=>{this.stores.store.setState({query:e.target.value,limit:Pn.loadMoreIncrement})},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t}=this.props,{store:o}=this.stores,i=this.getCurrentResult(),n=o.state.limit,r=t.isLoading.get();e<Pn.loadMoreScrollOffset&&i&&i.hasMore&&!r&&o.setState({...o.state,limit:n+Pn.loadMoreIncrement})},this.reducerStore=this.createComputedStore((()=>{const{property:e}=this.props,{store:t}=this.stores,{query:o,limit:i}=t.state;return{type:"results",filter:{operator:"and",filters:[{property:e,filter:{operator:"is_empty"}}]},limit:i,searchQuery:o}}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,{store:o,resultStore:i}=this.stores,{query:n}=o.state;return s()(Cn.ZP,{title:this.renderTitle(),onCancel:this.props.onClose,helpButton:s()(kn.Z,{helpButtonContext:"collection_no_date_menu",href:(0,bn.UY)("guides.databaseCalendar")}),desktopWidth:450},void 0,s()(ot.Z,{isInput:!0},void 0,s()(Yo.ZP,{placeholder:ne.default.formatMessage(In.searchPlaceholder),focus:!t.isMobile||void 0,focusAfterAnimation:!0,value:n,onChange:this.handleQueryChange})),s()(Ge.Z,{id:"no_date_results",reducer:this.reducerStore.state,collectionContextStore:e,render:this.renderResults,resultStore:i}),s()(Io.Z,{onChange:this.handleScrollOffsetChange}))}renderTitle(){const{noDateTotal:e}=this.props;return this.environment.device.isMobile?s()(I.FormattedMessage,{defaultMessage:"Pages with no date",id:"collectionNoDateMenu.mobileMenuTitle"}):s()(_n.Q,{prefix:s()(I.FormattedMessage,{defaultMessage:"{noDateTotal, plural, one {{noDateTotal} page with no date in} other {{noDateTotal} pages with no date in}}",id:"collectionNoDateMenu.pagesWithNoDateInPrefix",values:{noDateTotal:e}}),viewType:this.props.collectionViewType,viewName:s()(Mn.Z,{collectionViewName:this.props.collectionViewName,collectionViewType:this.props.collectionViewType})})}renderMenuListItem(e,t,o){const{device:i}=this.environment;return d.createElement(Tn.Z,r()({},e,{store:t,hidePath:!0,right:s()(Ht.Z,{href:o,innerStyle:{display:"flex",alignItems:"center",borderRadius:3,paddingLeft:i.isMobile?8:6,paddingRight:i.isMobile?8:6,height:i.isMobile?44:22},onClick:()=>{P.trackCollectionNoDateMenuView(this.environment)}},t.id,s()(I.FormattedMessage,{defaultMessage:"View",id:"collectionNoDateMenu.view.button.label"})),dontShrinkRight:!0}))}getMenuListItems(e){const{collectionStore:t,property:o}=this.props,i=e.map((e=>Pe.G.createChildStore(t,{table:C.iU,id:e}))).filter((e=>!Bt.Gl(e.getPropertyStore(o).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:t}=pe.default.state;if(!t)return;const o=(0,oe.ZP)({store:t,peekViewBlockId:e.id});return{key:e.id,render:t=>this.renderMenuListItem(t,e,o),action:()=>{this.props.onAddPage(e),P.trackCollectionNoDateMenuAdd(this.environment)}}}));return c().compact(i)}getCurrentResult(){return this.stores.resultStore.state}}Pn.displayName="CollectionNoDateMenu",Pn.loadMoreScrollOffset=200,Pn.loadMoreIncrement=20;const xn=Pn;var Bn=o(91007),Zn=o(43664),En=o(42858),Rn=o(58202),An=o(96620),Dn=o(13966),Fn=o(68709),Ln=o(30016),Vn=o(19387);function Nn(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const On=(0,I.defineMessages)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete",description:"Tooltip on the button that allows users to delete items from the bulk actions menu"}});function Un(e){window.__c={n:"CollectionsBulkActionsToolbar"};const t=(0,j.Y$)(),{marginLeft:o}=e,i=(0,so.O7)(),n=(0,lo.qz)(void 0,An.Z),a=(0,d.useRef)(null),[l,c]=(0,d.useState)(!1),p=(0,lo.VK)((()=>n.state.lastBlockPropertyValueOverlayCloseTime),[n]),u=(0,lo.VK)((()=>_t.default.state.stores.filter((e=>Rn.R.findBlockFromStore(e)))),[p]),m=u.length,g=(0,lo.VK)((()=>n.getNumberOfTextStoresBeingEdited()),[n]),h=(0,lo.VK)((()=>{var e;return!!(0,ee.fk)({environment:i,collectionContextStore:t})&&(g>0||u.length>=1&&(0,ee.v_)(u,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id))}),[t,i,g,u]),f=(0,co.yK)((e=>({inner:{position:"absolute",top:1,left:0+(o??0),display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:32},outer:{position:"sticky",top:0,left:0,zIndex:T.mJ,visibility:l?"visible":"hidden"},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...Nn(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[l,o]);return s()(Ln.Z,{isVisible:h,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:{stiffness:100,damping:10,precision:1e-4}},onAnimationEnd:e=>{e||c(!1)},render:()=>s()(Ko.Z,{capture:!0,render:e=>d.createElement("div",r()({ref:a},e,{style:f.outer}),s()(Fn.p,{allowSelectionWithin:!1},void 0,s()("div",{style:f.inner},void 0,s()(Hn,{selectedItemCount:m,collectionsBulkActionsToolbarStore:n}),s()(zn,{collectionsBulkActionsToolbarStore:n,selectedItems:u,marginLeft:o,setIsReadyToRender:c,outerContainerRef:a}),s()(it.Z,{renderTooltip:()=>s()("div",{},void 0,ne.default.formatMessage(On.delete)),render:e=>d.createElement(Jt.Z,r()({},e,{ariaLabel:ne.default.formatMessage(On.delete),icon:()=>b.Z.trash(f.trashButtonIcon),style:f.trashButton,hoveredStyle:f.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{P.trackBlockAction(i,{analyticsName:ht.sY.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page"}),await En.Qw({environment:i,blocks:u})}})),placement:it.Z.Placement.Top}),s()(Dn.Z,{store:u[0],fadeIn:!1,style:f.blockActionMenuButton,hoveredStyle:f.blockActionMenuButton,iconStyle:f.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0}}))))})})}function Hn(e){window.__c={n:"SelectedItemCountWidget"};const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,i=(0,so.O7)(),n=(0,lo.VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),r=(0,lo.VK)((()=>n>0?n:o),[n,o]),a=(0,co.yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Nn(e)}})),[]);return s()(Ot.Z,{style:a.button,onClick:()=>H.ZH(i)},void 0,s()(I.FormattedMessage,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",description:"Message in the multi-select toolbar that shows users how many total items in a database are selected",values:{itemsSelectedCount:r}}))}function zn(e){window.__c={n:"EditPropertyButtons"};const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:i,marginLeft:n,setIsReadyToRender:r}=e,a=(0,j.Y$)(),l=(0,lo.VK)((()=>a.normalizedSchemaStore.state),[a]),p=(0,d.useRef)(null),u=(0,lo.VK)((()=>{var e;const t=a.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=l[e.property];return e.visible&&t&&"title"!==t.type&&(0,ct.Sb)({propertySchema:t,property:e.property,blockStores:i,collectionSchema:l})})))??[]}),[a,l,i]).slice(0,6),m=(0,d.useRef)([]),[g,h]=(0,d.useState)(6),[f,v]=(0,d.useState)(!1);return(0,d.useEffect)((()=>{m.current.length>0&&m.current.forEach((e=>{var t,o;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(o=t.current)||void 0===o?void 0:o.getBoundingClientRect().right)??0)}))}),[m]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:i,marginLeft:n,setIsReadyToRender:r,setShowIconsOnly:a,setHiddenButtonsIndex:s}=e;(0,d.useEffect)((()=>{const e=c().debounce((()=>{var e,l,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,p=((null===(l=t.current)||void 0===l?void 0:l.getBoundingClientRect().width)??window.innerWidth)-(n??0),u=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,m=d-150;let g=i.current.findIndex((e=>e.rightEdge>m));g=-1!==g?g:6;let h=i.current.findIndex(((e,t)=>u+32*t>m));h=-1!==h?h:6;const f=g<2||p<=450;a(f),s(f?h:g),r(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[n,t,i,o,s,r,a])}({propertyButtonsContainerRef:p,propertyButtonRefs:m,outerContainerRef:t,marginLeft:n,setIsReadyToRender:r,setHiddenButtonsIndex:h,setShowIconsOnly:v}),d.createElement("div",{ref:p,style:{display:"flex"}},u.map(((e,t)=>{var i;let n=null===(i=m.current[t])||void 0===i?void 0:i.element;if(!n){const e=d.createRef();m.current[t]={element:e,rightEdge:0},n=e}const r=t>=g;return d.createElement("div",{ref:n,key:e.property},s()(Wn,{collectionsBulkActionsToolbarStore:o,schema:l,property:e.property,isHidden:r,showIconsOnly:f},e.property))})))}function Wn(e){window.__c={n:"EditPropertyButton"};const{property:t,schema:o,collectionsBulkActionsToolbarStore:i,isHidden:n,showIconsOnly:a}=e,l=(0,j.Y$)(),c=o[t],p=(0,so.O7)(),u=(0,lo.VK)((()=>!(l.permissionScopes.state.canEditContent||"collectionTypedView"===l.contextType)),[l]),m=(0,co.yK)((e=>({button:{display:n?"none":"flex",padding:8,...Nn(e)}})),[n]),g=(0,d.useRef)(null),h=(0,lo.qz)(void 0,ke.Z),f=(0,d.useCallback)((async e=>{var o,n;if(!g.current)return;const r=_t.default.state.stores;e.stopPropagation(),e.preventDefault();const a=null===(o=g.current)||void 0===o?void 0:o.getBoundingClientRect(),s=r[0].getAssociatedCollectionStore();l&&a&&s&&await Zn.zt({environment:p,store:r[0],additionalStores:r.slice(1),property:t,rect:a,format:Nt.C.Table,collectionStore:s,blockPropertyValueOverlayStore:Y._H(),collectionContextStore:l,statusShowAsCheckbox:"checkbox"===(null===(n=l.getPropertyFormat(t))||void 0===n?void 0:n.statusShowAs),mouseStore:h,preventClearSelection:!0,collectionsBulkActionsToolbarStore:i})}),[g,l,p,t,h,i]),v=(0,co.Fg)();return c?s()(it.Z,{renderTooltip:()=>c.name,render:e=>d.createElement(Ot.Z,r()({},e,{ariaLabel:c.name,ref:g,style:m.button,disabled:u,onClick:f}),s()(Vn.Z,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:c,hideName:a,showIcon:!0,property:t,iconStyle:{fill:v.regularTextColor}})),disableTooltip:!a,placement:it.Z.Placement.Top}):null}var jn=o(22323),Kn=o(49670),Yn=o(13005),Gn=o(34253),Xn=o(54281),qn=o(64815);class $n extends ut.Z{getInitialState(){return{}}}const Jn=$n;var Qn=o(96310),er=o(35431),tr=o(88108);class or extends er.Z{findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}}const ir=new or;(0,tr.exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",ir);var nr=o(20294),rr=o(55367),ar=o(26647);const sr={position:"absolute",left:0,top:0,zIndex:T.Gt,width:"100%",height:"100%",pointerEvents:"none"};function lr(e){window.__c={n:"CollectionTimelineDependencyRelationArrow"};const{startItem:t,endItem:o,endRelationPointer:i,timelineState:n,disabled:r,collectionContextStore:a,isFullScreen:l,isRootChild:c,isUserDrawnTemp:p,renderEmitter:u}=e,g=(0,so.O7)(),h=(0,nr.k)(),[f,v]=(0,d.useState)(!1),[y,b]=(0,d.useState)(null),[S,w]=(0,d.useState)(null),k=(0,d.useCallback)((e=>{b(e.get())}),[]),C=(0,d.useCallback)((e=>{w(e.get())}),[]),_=(0,d.useCallback)((()=>{m.default.afterNextFlush((()=>{h()}))}),[h]);(0,d.useEffect)((()=>(b(t.stores.node.get()),w(o?o.stores.node.get():null),t.stores.node.addListener(k),null==o||o.stores.node.addListener(C),null==u||u.addListener(_),a.filtersBarOpenStore.addListener(_),()=>{t.stores.node.removeListener(k),null==o||o.stores.node.removeListener(C),null==u||u.removeListener(_),a.filtersBarOpenStore.removeListener(_)})),[t,o,u,k,C,_,a.filtersBarOpenStore]);const M=(0,lo.VK)((()=>rr.ZP.state.isDragging&&rr.ZP.state.draggedStores.includes(t.props.store)),[t]),I=(0,lo.VK)((()=>o&&rr.ZP.state.isDragging&&rr.ZP.state.draggedStores.includes(o.props.store)),[o]),P=(0,lo.VK)((()=>{const e=rr.ZP.state;return e.isDragging?e.currentY-e.startY:0}),[]),x=y&&y.getBoundingClientRect().y+(M?P:0),B=(0,lo.VK)((()=>x&&t.itemPositionStore.state?{...t.itemPositionStore.state,top:x}:void 0),[t,x]),Z=S&&S.getBoundingClientRect().y+(I?P:0),E=(0,lo.VK)((()=>Z&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:Z}:void 0),[o,Z]),R=(0,lo.VK)((()=>void 0!==n.dragState.state),[n]),A=(0,lo.VK)((()=>void 0!==n.drawState.state),[n]),D=(0,lo.VK)((()=>n.hoveredItem.get()),[n.hoveredItem]),F=f&&!R&&!A,L=(0,d.useCallback)((()=>{i&&!r&&Xn.IL({dependency:{store:t.props.store,relationPointer:i},collectionContextStore:a,environment:g,timelineState:n,isFullScreen:l,isRootChild:c})}),[t,r,i,a,g,n,l,c]),V=(0,d.useCallback)((()=>{v(!0)}),[v]),N=(0,d.useCallback)((()=>{v(!1)}),[v]),O=(0,d.useCallback)((e=>{if(E)return s()(cr,{topOffset:e,endPosition:E,handleCloseButtonClick:L})}),[E,L]),U=D===t.props.store,H=o&&D===o.props.store,z=U||H||F?1:.5,W=(0,co.yK)((()=>({svgStyle:{zIndex:F?T.Gt:T.wx}})),[F]);return B?p?s()(dr,{startPosition:B,timelineState:n,collectionContextStore:a}):t!==o&&E?s()(pr,{collectionContextStore:a,startPosition:B,endPosition:E,strokeOpacity:z,svgStyle:W.svgStyle,handleMouseMove:V,handleMouseLeave:N,renderChildren:F?O:void 0}):null:null}function cr(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:i}=e,n=(0,co.Fg)();return d.createElement(d.Fragment,null,s()("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:i},void 0,b.Z.clearInput({background:"white",borderRadius:5,fill:n.accentColors.red[500],height:14,width:14})))}function dr(e){window.__c={n:"UserDrawnTempDependencyArrow"};const{startPosition:t,collectionContextStore:o,timelineState:i}=e,n=(0,lo.VK)((()=>{const e=i.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,i.drawState]);return n?s()(pr,{collectionContextStore:o,startPosition:t,endPosition:n,strokeOpacity:1}):null}function pr(e){window.__c={n:"DependencyArrowBase"};const{collectionContextStore:t,startPosition:o,endPosition:i,strokeOpacity:n,svgStyle:r,handleMouseMove:a,handleMouseLeave:l}=e,c=(0,co.Fg)(),[p,u]=(0,d.useState)(0),m=o.right,g=o.top+15-p,h=i.left-3,f=i.top+15-p,v=(0,lo.VK)((()=>(0,Q.H5)(t)&&o.right&&i.left?o.right<i.left?c.accentColors.yellow[300]:c.accentColors.red[300]:c.accentColors.gray[300]),[t,i.left,o.right,c]);return d.createElement("svg",{style:{...sr,...r},ref:e=>{e&&u(e.getBoundingClientRect().top)}},s()(ar.Z,{startPoint:{x:m,y:g},endPoint:{x:h,y:f},direction:ar.n.right,style:{stroke:v,strokeWidth:Q.lf,strokeOpacity:n},showArrowHead:!e.renderChildren,handleMouseMove:a,handleMouseLeave:l},void 0,e.renderChildren&&e.renderChildren(p)))}function ur(e){const{timelineState:t,collectionContextStore:o,disabled:i,isReady:n,isFullScreen:r,isRootChild:a,renderEmitter:l}=e,c=(0,d.useCallback)((()=>{t.drawState.set(void 0)}),[t.drawState]),p=(0,lo.VK)((()=>o.collectionViewBlockStore()),[o]),u=(0,lo.VK)((()=>o.settingsStore.state.open),[o]);if((0,d.useEffect)((()=>{var e;!u&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[u,t.drawState,c]),!n||!p)return null;const m=ir.findCollectionTimelineViewItems(p);return d.createElement(d.Fragment,null,m.map((e=>{const{store:n,groupFormat:c}=e.props,d=null==c?void 0:c.value,p=d?(0,Re.Hd)(d):"noGroup";return s()(mr,{startItem:e,timelineState:t,disabled:i,collectionContextStore:o,isFullScreen:r,isRootChild:a,renderEmitter:l},`${n.id}-${p}-${n.key}`)})))}function mr(e){const{startItem:t,timelineState:o,disabled:i,collectionContextStore:n,isFullScreen:r,isRootChild:a,renderEmitter:l}=e,{store:c,schema:p}=t.props,u=(0,lo.VK)((()=>o.drawState.get()),[o.drawState]),m=(0,lo.VK)((()=>(null==u?void 0:u.startStore)===c),[c,u]),g=(0,lo.VK)((()=>m&&!(null!=u&&u.tryToCompleteDrawnArrow)),[u,m]),h=(0,lo.VK)((()=>m&&u?u.temporaryDependencyRelationPointers:(0,Q.YE)(n,c,p)),[m,u,n,c,p]),f=(0,lo.VK)((()=>n.collectionViewBlockStore()),[n]);if(!f)return null;const v=ir.findCollectionTimelineViewItems(f);return d.createElement(d.Fragment,null,h.map((e=>{if(c.id===e.id)return null;const p=v.filter((t=>t.props.store.id===e.id));return d.createElement(d.Fragment,null,p.map((c=>{const d=c.props.store,p=c.props.groupFormat;return s()(lr,{startItem:t,endItem:c,endRelationPointer:e,timelineState:o,disabled:i,collectionContextStore:n,isFullScreen:r,isRootChild:a,renderEmitter:l},`${d.id}-${null==p?void 0:p.value.value}-${d.key}`)})))})),g&&s()(lr,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,collectionContextStore:n,isFullScreen:r,isRootChild:a}))}var gr=o(36488);class hr extends u.Z{constructor(){super(...arguments),this.renderZoomLevelMenu=e=>{const{zoomLevel:t,onChange:o}=this.props,{device:i}=this.environment,n=[{key:"calendar by section",render:e=>d.createElement(ot.Z,e),items:gt.H.map((t=>({key:t,render:e=>d.createElement(Xe.Z,r()({},e,{title:this.renderZoomLevelText(t)})),action:()=>{o(t),e.close()}})))}];return s()(gr.Z,{capture:!0,allowEsc:!0,render:o=>{let r;return r=i.isMobile?{menuType:Ke.og.Modal,title:s()(I.FormattedMessage,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:s()(Qe.DoneMenuText,{}),onClickRight:e.close,...o}:{menuType:Ke.og.Popup,width:180,...o},d.createElement($e.Z,r,s()(Je.Z,{type:Je.i.Vertical,sections:n,initialFocus:gt.H.indexOf(t)}))}})}}renderComponent(){const{zoomLevel:e}=this.props,{device:t}=this.environment;return s()(qe.Z,{popupType:t.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,renderOrigin:t=>d.createElement(et.Z,r()({isSmall:!0,isGray:!0},t),this.renderZoomLevelText(e),b.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.mediumIconColor})),originGap:8,render:this.renderZoomLevelMenu})}renderZoomLevelText(e){return"hours"===e?s()(I.FormattedMessage,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours",description:"Sets the timeline zoom level to hours."}):"day"===e?s()(I.FormattedMessage,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day",description:"Sets the timeline zoom level to day."}):"week"===e?s()(I.FormattedMessage,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week",description:"Sets the timeline zoom level to week."}):"bi_week"===e?s()(I.FormattedMessage,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week",description:"Sets the timeline zoom level to Bi-week."}):"month"===e?s()(I.FormattedMessage,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month",description:"Sets the timeline zoom level to month."}):"quarter"===e?s()(I.FormattedMessage,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter",description:"Sets the timeline zoom level to quarter."}):"year"===e?s()(I.FormattedMessage,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year",description:"Sets the timeline zoom level to year."}):void(0,ti.t1)(e)}}hr.displayName="CollectionTimelineViewZoomLevelButtonPopup";const fr=hr;var vr=o(33411);class yr extends u.Z{constructor(){super(...arguments),this.handleLeftArrowClick=()=>{const{timelineState:e,paddingLeft:t,format:o,isFullScreen:i,isRootChild:n,collectionContextStore:r}=this.props,a=e.zoomLevel.get(),s=(e.outerSizeObserver.rect.get().width-(0,Q.xI)({environment:this.environment,paddingLeft:t,format:o,isFullScreen:i,isRootChild:n}))/2,l=(0,Q.al)(e)-(0,Q.x2)(a,s);Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:a,centerTimestamp:l}),P.trackTimelineShiftTimeClick(this.environment,{...(0,Q.Ii)({environment:this.environment,collectionContextStore:r,timelineState:e,isFullScreen:i,isRootChild:n}),type:"left"})},this.handleRightArrowClick=()=>{const{timelineState:e,paddingLeft:t,format:o,isFullScreen:i,isRootChild:n,collectionContextStore:r}=this.props,a=e.zoomLevel.get(),s=(e.outerSizeObserver.rect.get().width-(0,Q.xI)({environment:this.environment,paddingLeft:t,format:o,isFullScreen:i,isRootChild:n}))/2,l=(0,Q.al)(e)+(0,Q.x2)(a,s);Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:a,centerTimestamp:l}),P.trackTimelineShiftTimeClick(this.environment,{...(0,Q.Ii)({environment:this.environment,collectionContextStore:r,timelineState:e,isFullScreen:i,isRootChild:n}),type:"right"})},this.handleTodayClick=()=>{const{timelineState:e,paddingLeft:t,format:o,collectionContextStore:i,isFullScreen:n,isRootChild:r}=this.props,a=e.zoomLevel.get(),s=(0,Q.bK)({timestamp:Date.now(),environment:this.environment,timelineState:e,paddingLeft:t,format:o});Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:a,centerTimestamp:s}),P.trackTimelineTodayClick(this.environment,(0,Q.Ii)({environment:this.environment,collectionContextStore:i,timelineState:e,isFullScreen:n,isRootChild:r}))},this.handleZoomLevelChange=e=>{const{timelineState:t,collectionContextStore:o,isFullScreen:i,isRootChild:n}=this.props;Xn.Nf({timelineState:t,environment:this.environment,zoomLevel:e,centerTimestamp:(0,Q.al)(t)}),P.trackTimelineZoomLevelUpdate(this.environment,(0,Q.Ii)({environment:this.environment,collectionContextStore:o,timelineState:t,isFullScreen:i,isRootChild:n}))},this.handleShowTableClick=()=>{const{format:e,timelineState:t,collectionContextStore:o,isFullScreen:i,isRootChild:n}=this.props,r=o.collectionViewStore();r&&(W.createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:this.environment,perform:t=>{const o=(0,Q.YP)(e,!0);De.FH({stores:[r],update:o,transaction:t})}}),P.trackTimelineToggleTableClick(this.environment,{...(0,Q.Ii)({environment:this.environment,collectionContextStore:o,timelineState:t,isFullScreen:i,isRootChild:n}),show:!0}))},this.currentScrolledSecondaryDisplayUnitStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,paddingLeft:o,showTable:i,isFullScreen:n}=this.props,r=e.zoomLevel.get(),{primaryDisplayUnit:a,secondaryDisplayUnit:s}=Q.BJ[r],l=e.scrollLeft.get(),{startTimestamp:c}=e.currentRange.get();if(void 0!==l){const e=c+(0,Q.x2)(r,l+t+(!i&&n?o:0));return(0,Q.DS)(Yi.ou.fromMillis(e),a).startOf(s).valueOf()}}))}renderComponent(){var e;const{timelineState:t,showTable:o,isFullScreen:i,isRootChild:n,isReady:a,collectionContextStore:l,isInPeekRenderer:c}=this.props,{device:p}=this.environment,u=t.zoomLevel.get(),{secondaryDisplayUnit:m}=Q.BJ[u],g=this.currentScrolledSecondaryDisplayUnitStore.state,h=(0,Q.d$)({environment:this.environment,isFullScreen:i,isRootChild:n}),f=l.permissionScopes.state,v=!o&&h&&f.canConfigureBlock,y=(null===(e=l.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(c?this.theme.cardContentBackground:this.theme.contentBackground),S=c?this.theme.cardContentBackgroundTransparent:this.theme.contentBackgroundTransparent;return s()(vi,{position:Ve.Top},void 0,s()("div",{style:this.getStyle()},void 0,g&&s()("div",{style:this.getCurrentScrolledSecondaryDisplayUnitStyle()},void 0,v&&s()(it.Z,{render:e=>d.createElement(et.Z,r()({isSmall:!0,onClick:this.handleShowTableClick,style:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:p.isIOS?0:1,height:22,fill:this.theme.lightIconColor}},e),b.Z.doubleChevronRight({width:14})),renderTooltip:()=>s()(I.FormattedMessage,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),s()("span",{style:{paddingLeft:v||this.environment.device.isPhone?0:i||o?16:2}},void 0,(0,Q.qG)(g,m)),!a&&!o&&this.renderLoadingSpinner(),s()("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${y} 20%, ${S} 100%)`}})),s()("div",{style:this.getControlBarRightStyle()},void 0,s()("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${y} 20%, ${S} 100%)`}}),s()(fr,{zoomLevel:u,onChange:this.handleZoomLevelChange}),s()(et.Z,{isSmall:!0,isGray:!0,onClick:this.handleLeftArrowClick,style:{marginLeft:4,paddingLeft:4,paddingRight:4}},void 0,b.Z.chevronLeft({width:12,fill:this.theme.mediumIconColor})),s()(et.Z,{isSmall:!0,onClick:this.handleTodayClick},void 0,s()(I.FormattedMessage,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today",description:"Scrolls the timeline to today."})),s()(et.Z,{isSmall:!0,isGray:!0,onClick:this.handleRightArrowClick,style:{paddingLeft:4,paddingRight:4}},void 0,b.Z.chevronRight({width:12,fill:this.theme.mediumIconColor})))))}renderLoadingSpinner(){return s()(vr.Z,{show:!0,showDelay:400,showHold:0,render:e=>e?s()(Go.Z,{style:{marginLeft:8,marginTop:1}}):void 0})}getStyle(){const{timelineState:e}=this.props,{outerSizeObserver:t}=e;return{position:"sticky",left:0,width:t.rect.get().width,zIndex:T.Qm,height:0}}getCurrentScrolledSecondaryDisplayUnitStyle(){var e;const{scrollerLeftOffset:t,paddingLeft:o,isFullScreen:i,showTable:n,collectionContextStore:r,isInPeekRenderer:a}=this.props,s=(null===(e=r.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(a?this.theme.cardContentBackground:this.theme.contentBackground);return{position:"absolute",top:1,left:0,paddingLeft:i&&!n?t+o:t,display:"flex",alignItems:"center",height:32,paddingTop:6+(this.environment.device.isMobile?2:0),background:s,fontSize:14,fontWeight:M.Z.fontWeight.medium}}getControlBarRightStyle(){var e;const{paddingRight:t,collectionContextStore:o,isInPeekRenderer:i}=this.props;return{position:"absolute",top:1,right:0,paddingRight:t,display:"flex",alignItems:"center",height:32,paddingTop:7,background:(null===(e=o.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(i?this.theme.cardContentBackground:this.theme.contentBackground)}}}yr.displayName="CollectionTimelineViewControlBar";const br=yr;class Sr extends u.Z{constructor(){super(...arguments),this.handleHideTableClick=()=>{const{format:e,collectionContextStore:t,isFullScreen:o,isRootChild:i,timelineState:n}=this.props,r=t.collectionViewStore();r&&(W.createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:this.environment,perform:t=>{const o=(0,Q.YP)(e,!1);De.FH({stores:[r],update:o,transaction:t})}}),P.trackTimelineToggleTableClick(this.environment,{...(0,Q.Ii)({environment:this.environment,collectionContextStore:t,timelineState:n,isFullScreen:o,isRootChild:i}),show:!1}))}}renderComponent(){const{device:e}=this.environment,{isGrouped:t}=this.props;return s()(it.Z,{render:o=>d.createElement(et.Z,r()({isSmall:!0,onClick:this.handleHideTableClick,style:{position:"absolute",top:t?e.isIOS?3:4:e.isIOS?7:8,right:t?6:8,zIndex:T.MC,fill:this.theme.lightIconColor}},o),b.Z.doubleChevronLeft({width:14})),renderTooltip:()=>s()(I.FormattedMessage,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})}}Sr.displayName="CollectionTimelineViewHideTableButton";const wr=(0,I.injectIntl)(Sr);var kr=o(24211);const Cr=22,_r=32;class Mr extends u.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()},this.activeRangeStore=this.createComputedStore((()=>{const{collectionContextStore:e,timelineState:t,query:o,schema:i,intl:n}=this.props,r=e.collectionStore();if(!r)return;const a=t.dragState.get(),s=t.zoomLevel.get(),l=t.hoveredItem.get(),d=t.dateRangePlaceholder.get(),{activeRangeType:p}=Q.BJ[s];if(!p)return;let u;if(a)u=a.temporaryValues.map((e=>(0,Q.XO)(e,"day")));else if(d.active)u=[(0,Q.XO)(d.date,"day")];else{const{stores:e}=_t.default.state,t=e.filter((e=>e.getParentCollectionId()===r.id)),a=c().uniq(c().compact([...t,l]));u=c().compact(a.map((e=>{const t=(0,Q.bk)({store:e,query:o,schema:i,intl:n});if(t)return(0,Q.XO)(t,"day")})))}const m=c().minBy(u,(e=>{let{start:t}=e;return t.valueOf()})),g=c().maxBy(u,(e=>{let{end:t}=e;return t.valueOf()}));return m&&g?{start:m.start.valueOf(),end:g.end.valueOf()}:void 0}),!0)}willMount(e){super.willMount(e)}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){const{timelineState:e}=this.props,t=e.zoomLevel.get(),o=Q.BJ[t],{primaryDisplayUnit:i,activeRangeType:n}=o,r=(0,Q.ST)(i),a=Yi.ou.now(),l=r?a.startOf("minute"):a.startOf("day"),c=a.startOf("minute"),{device:d}=this.environment;return s()(vi,{position:Ve.Top},void 0,s()("div",{style:this.getStyle()},void 0,s()("div",{style:{height:32,position:"relative",overflow:"hidden"}},void 0,!d.isPhone&&this.renderSecondaryIndicators()),s()("div",{style:{height:_r,position:"relative",overflow:"hidden"}},void 0,this.renderPrimaryIndicators(l),"highlight_days"===n&&this.renderActiveRange(),this.renderNowIndicator(l),"display_range"===n&&this.renderActiveRange()),this.renderNowCircle(c)))}renderPrimaryIndicators(e){const{timelineState:t}=this.props,o=t.zoomLevel.get(),{startTimestamp:i,endTimestamp:n}=t.currentRange.get(),r=Q.BJ[o],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:s}=r,l=s||0,c=this.getPrimaryDisplayUnitPosition(e,!1),d=c.left+l,p=c.left+c.width-l,u=[];let m=(0,Q.DS)(Yi.ou.fromMillis(i),a);for(;m.valueOf()<n;){const e=this.getPrimaryDisplayUnitPosition(m,!1),t=e.left+l,o=e.left+e.width-l;void 0!==s&&(d>=t&&d<=o||p>=t&&p<=o)||u.push(this.renderPrimaryIndicator(m,!1));m=(0,Q.Ip)(m,a)}return u}renderSecondaryIndicators(){const{timelineState:e}=this.props,t=e.zoomLevel.get(),{startTimestamp:o,endTimestamp:i}=e.currentRange.get(),n=Q.BJ[t],{primaryDisplayUnit:r,secondaryDisplayUnit:a}=n,s=[];let l=(0,Q.DS)(Yi.ou.fromMillis(o),a);for(;l.valueOf()<i;){s.push(this.renderSecondaryIndicator(l));const e=(0,Q.Ip)(l,a);l=(0,Q.xP)(e,r)}return s}renderActiveRange(){const{timelineState:e}=this.props,t=e.zoomLevel.get(),{startTimestamp:o,endTimestamp:i}=e.currentRange.get(),n=Q.BJ[t],{activeRangeType:r}=n,a=this.activeRangeStore.state;if(a){const e=(0,Q.DS)(Yi.ou.fromMillis(a.start),"day"),n=(0,Q.e$)(t,e.valueOf()-o);if("highlight_days"===r){const r=[];let l=Yi.ou.fromMillis(Math.max(e.valueOf(),(0,Q.DS)(Yi.ou.fromMillis(o),"day").valueOf()));for(;l.valueOf()<a.end&&l.valueOf()<i;){r.push(l);l=(0,Q.Ip)(l,"day")}const c=(0,Q.e$)(t,l.valueOf()-o)-n+8,p=r.map(((e,t)=>this.renderPrimaryIndicator(e,0===t||t===r.length-1)));return d.createElement(d.Fragment,null,s()("div",{style:{position:"absolute",left:n-4,width:c,marginTop:3,height:Cr,background:this.theme.timelineDarkerBackground,borderRadius:11}}),p)}{const i=(0,Q.DS)(Yi.ou.fromMillis(a.end),"day"),r=(0,Q.cK)(Yi.ou.fromMillis(a.end),"day"),l=(0,Q.e$)(t,i.valueOf()-o)-n+8;return s()("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:n-4,minWidth:l,marginTop:3,height:Cr,background:this.theme.timelineDarkerBackground,borderRadius:11,paddingLeft:6,paddingRight:6}},void 0,this.renderActiveDisplayRangeIndicator(e,e.valueOf()!==r.valueOf()?r:void 0,l))}}}renderPrimaryIndicator(e,t){const{timelineState:o}=this.props,i=o.zoomLevel.get(),{primaryDisplayUnit:n}=Q.BJ[i],{left:r,width:a}=this.getPrimaryDisplayUnitPosition(e,!1);return s()("div",{style:{position:"absolute",left:r,width:a,height:28,display:"flex",alignItems:"start",lineHeight:"28px"}},r,s()("div",{style:{fontSize:12,margin:"0 auto"}},void 0,this.formatPrimaryDisplayUnit(e,i,n,t)))}renderNowIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.get(),{primaryDisplayUnit:i}=Q.BJ[o],{left:n,width:r}=this.getPrimaryDisplayUnitPosition(e,!0);return s()("div",{style:{position:"absolute",left:n,width:r,height:28,display:"flex",alignItems:"center",fontWeight:500}},n,s()("div",{style:{fontSize:12,margin:"0 auto",display:"flex"}},void 0,this.formatNowIndicator(e,o,i)))}renderNowCircle(e){const{timelineState:t}=this.props,o=t.zoomLevel.get(),{startTimestamp:i}=t.currentRange.get(),n=Math.floor((0,Q.e$)(o,e.valueOf()-i));return s()("div",{style:{position:"absolute",left:n-3.5,top:Math.floor(60.5),width:7,height:7,background:this.theme.timelineRed,borderRadius:"100%"}})}renderSecondaryIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.get(),{startTimestamp:i}=t.currentRange.get(),{secondaryDisplayUnit:n}=Q.BJ[o],r=(0,Q.e$)(o,e.valueOf()-i);return s()("div",{style:{position:"absolute",left:r,height:_r,color:this.theme.regularTextColor,fontSize:14,fontWeight:M.Z.fontWeight.medium,verticalAlign:"middle",paddingTop:6+(this.environment.device.isMobile?2:0),display:"flex",alignItems:"center"}},r,(0,Q.EW)((0,kr.E2)(this.props.intl),e.valueOf(),n))}renderActiveDisplayRangeIndicator(e,t,o){return e&&t?o>=110?d.createElement(d.Fragment,null,s()("div",{style:this.getActiveDisplayRangeIndicatorStyle()},void 0,(0,Ni.Yx)(e.valueOf(),"month_day",Li.SP)),s()("div",{style:{flexGrow:1}}),s()("div",{style:this.getActiveDisplayRangeIndicatorStyle()},void 0,(0,Ni.Yx)(t.valueOf(),"month_day",Li.SP))):s()("div",{style:this.getActiveDisplayRangeIndicatorStyle()},void 0,(0,Ni.Yx)(e.valueOf(),"month_day",Li.SP)," – ",e.month===t.month?(0,Ni.Yx)(t.valueOf(),"day",Li.SP):(0,Ni.Yx)(t.valueOf(),"month_day",Li.SP)):s()("div",{style:this.getActiveDisplayRangeIndicatorStyle()},void 0,(0,Ni.Yx)(e.valueOf(),"month_day",Li.SP))}formatPrimaryDisplayUnit(e,t,o,i){const n=e.setLocale(Li.SP),r=(0,Q.xJ)(),a=i?this.theme.regularTextColor:this.theme.lightTextColor,l=i?this.theme.regularTextColor:this.theme.mediumTextColor,c=i?this.theme.mediumTextColor:this.theme.lightTextColor,p=n.toFormat("t").startsWith(n.toFormat("a"));if("fifteen_minutes"===o){if(r)return s()("span",{style:{color:a}},void 0,n.toFormat("H:mm"));{const e=s()("span",{style:{color:l,paddingRight:p?void 0:3}},void 0,n.toFormat("h:mm")),t=s()("span",{style:{color:c,paddingRight:p?3:void 0}},void 0,n.toFormat("a"));return p?d.createElement(d.Fragment,null,t,e):d.createElement(d.Fragment,null,e,t)}}if("hour"===o){if(r)return s()("span",{style:{color:a}},void 0,n.toFormat("H:mm"));{const e=s()("span",{style:{color:l,paddingRight:p?void 0:3}},void 0,n.toFormat("h")),t=s()("span",{style:{color:c,paddingRight:p?3:void 0}},void 0,n.toFormat("a"));return p?d.createElement(d.Fragment,null,t,e):d.createElement(d.Fragment,null,e,t)}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?d.createElement(d.Fragment,null,s()("span",{style:{color:c,paddingRight:3}},void 0,n.toFormat("ccccc")),s()("span",{style:{color:l,padding:"2px 7px"}},void 0,n.toFormat("d"))):s()("span",{style:{color:a}},void 0,n.toFormat("d"));(0,ti.t1)(o)}formatNowIndicator(e,t,o){const i=e.setLocale(Li.SP),n=(0,Q.ST)(o),r=(0,Q.xJ)();return n?r?s()("span",{style:{color:this.theme.timelineRed}},void 0,i.toFormat("H:mm")):s()("span",{style:{color:this.theme.timelineRed,paddingRight:3}},void 0,i.toFormat("t")):"week"===t||"bi_week"===t?d.createElement(d.Fragment,null,s()("span",{style:{color:this.theme.lightTextColor,paddingRight:3}},void 0,i.toFormat("ccccc")),s()("div",{style:{position:"relative"}},void 0,s()("div",{style:this.getNowIndicatorCircleStyle()}),s()("span",{style:{position:"relative",color:"white",padding:"2px 7px"}},void 0,i.toFormat("d")))):s()("div",{style:{position:"relative"}},void 0,s()("div",{style:this.getNowIndicatorCircleStyle()}),s()("span",{style:{position:"relative",color:"white",padding:"2px 7px"}},void 0,i.toFormat("d")))}getPrimaryDisplayUnitPosition(e,t){const{timelineState:o}=this.props,i=o.zoomLevel.get(),{startTimestamp:n}=o.currentRange.get(),{primaryDisplayUnit:r,primaryDisplayUnitAlignment:a}=Q.BJ[i],s=(0,Q.DS)(e,r),l=(0,Q.Ip)(e,r),c=(0,Q.e$)(i,s.valueOf()-n),d=(0,Q.e$)(i,e.valueOf()-n),p=(0,Q.e$)(i,l.valueOf()-n)-c,u=t?4:0;return{left:("range_start"===a?d-p/2:d)-u,width:p+2*u}}getStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{position:"absolute",left:0,top:0,width:"100%",background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),borderTop:t.viewIsFlushToTopbar()?`1px solid ${this.theme.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${this.theme.tableDividerColor}`}}getActiveDisplayRangeIndicatorStyle(){return{color:this.theme.regularTextColor,fontSize:12}}getNowIndicatorCircleStyle(){return{background:this.theme.timelineRed,width:22,height:22,borderRadius:11,position:"absolute",left:"calc(50% - 11px)",top:"calc(50% - 11px)"}}}Mr.displayName="CollectionTimelineViewTimeBar";const Tr=(0,I.injectIntl)(Mr);var Ir=o(97180),Pr=o(3072);class xr extends u.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ue.Z},this.handleClosePopup=()=>{this.stores.buttonPopupStore.setState({...this.stores.buttonPopupStore.state,open:!1})},this.handlePropertyAggregationMenuChange=e=>{const{property:t,onChange:o}=this.props;e?(o(t,{aggregator:e,property:t}),P.trackConfigureView(this.environment,{view_type:"table",action:"table_change_aggregation"})):(o(t,void 0),P.trackConfigureView(this.environment,{view_type:"table",action:"table_remove_aggregation"}))},this.reducerStore=this.createComputedStore((()=>{const{schema:e,groupFormat:t,collectionContextStore:o,property:i}=this.props,n=o.normalizedQueryStore.state,r=((null==n?void 0:n.aggregations)||[]).find((e=>e.property===i));if(!r)return;return{type:"aggregation",filter:t?(0,He.zk)({schema:e,group:t,timeZone:(0,ze.r)()}):void 0,aggregation:r}}))}renderComponent(){const{disabled:e,property:t,schema:o,collectionContextStore:i,groupFormat:n}=this.props,{device:a}=this.environment,{buttonPopupStore:l}=this.stores;return s()(qe.Z,{popupType:a.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,buttonPopupStore:l,disabled:e,renderOrigin:o=>{const a=this.reducerStore.state;return d.createElement(Ot.Z,r()({disabled:e,style:xr.buttonStyle},o),a?s()(Ge.Z,{id:`table:${(0,Re.mD)(n)}:${t}:${a.aggregation.aggregator}`,collectionContextStore:i,reducer:a,render:e=>this.renderButtonContent(e.state)}):this.renderButtonContent(void 0))},render:()=>s()(Pr.Z,{property:t,schema:o,onChange:this.handlePropertyAggregationMenuChange,onClose:this.handleClosePopup,source:"tableAggregation"})})}renderButtonContent(e){const{device:t}=this.environment,{buttonPopupStore:o}=this.stores,{schema:i,property:n,isHovered:r,disabled:a}=this.props,l=t.isMobile,c=this.reducerStore.state;if(c&&e&&"aggregation"===e.type){const{aggregationResult:t}=e;let o=je.v6[(0,Ue.OV)(c.aggregation)];(0,Ue.en)(c.aggregation.aggregator)&&(o=c.aggregation.aggregator.groupName in Ir.C?Ir.C[c.aggregation.aggregator.groupName]:c.aggregation.aggregator.groupName);const r=i[n];let a;!r||"formula"!==r.type&&"number"!==r.type||(a=r.number_format);const l=(0,je.Ol)({numberFormat:a,aggregationType:c.aggregation.aggregator,value:t,userTimeZone:(0,ze.r)(),roundDecimal:5});return[s()("span",{style:this.getAggregationTypeNameStyle()},"type",o),s()("span",{style:xr.valueStyle},"value",l)]}if(!a&&(l||r||o.state.open))return s()(Ln.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>s()("div",{style:{display:"flex",alignItems:"center"}},void 0,s()("span",{style:this.getPlaceholderStyle()},"placeholder",s()(I.FormattedMessage,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})),b.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))})}getAggregationTypeNameStyle(){return{fontSize:10,textTransform:"uppercase",letterSpacing:1,color:this.theme.mediumTextColor,marginTop:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}}getPlaceholderStyle(){return{marginBottom:2,color:this.theme.lightTextColor}}}xr.displayName="TableAggregation",xr.buttonStyle={display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto"},xr.valueStyle={display:"flex",alignItems:"center",height:"100%",fontSize:14};const Br=xr;class Zr extends u.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:ke.Z},this.renderAggregation=(e,t)=>{const{schema:o,disabled:i,collectionContextStore:n,showHoverActionsStore:r,groupFormat:a}=this.props,{mouseEntered:l}=this.stores.mouseStore.state,c=(0,ee.fk)({environment:this.environment,collectionContextStore:n});return s()("div",{style:{display:"flex",width:void 0!==e.width?e.width+(0===t&&c?ho.Xx:0):void 0}},e.property,s()(Br,{groupFormat:a,disabled:i,isHovered:(l||0===t&&!a&&r.state)&&!i,property:e.property,collectionContextStore:n,schema:o,onChange:this.handleTableAggregationChange}))},this.handleTableAggregationChange=(e,t)=>{const{collectionContextStore:o,query:i}=this.props,n=o.collectionViewStore();if(!n)return;let r=i.aggregations?[...i.aggregations]:[];const a=(i.aggregations||[]).findIndex((t=>t.property===e));r=a<0?c().compact([...r,t]):c().compact(r.map(((e,o)=>a===o?t:e)));const s={...i,aggregations:r};W.createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:this.environment,perform:e=>{F.iG({collectionViewStore:n,update:{query2:s},transaction:e})}})},this.captureEditorMouseDown=e=>{(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{}})},this.handleAggregationRowEnter=()=>{this.stores.mouseStore.enter()},this.handleAggregationRowLeave=()=>{this.stores.mouseStore.exit()}}renderComponent(){const{showPropertyFormatsStore:e}=this.props,t=e.state;return s()(vi,{position:Ve.Bottom},void 0,s()(Fn.p,{allowSelectionWithin:!1,style:this.getAggregationsRowStyle(),onMouseMove:this.handleAggregationRowEnter,onMouseLeave:this.handleAggregationRowLeave,onMouseDown:this.captureEditorMouseDown},void 0,t.map(this.renderAggregation)))}getAggregationsRowStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{display:"flex",position:"absolute",background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),zIndex:T.RJ,fontSize:14,height:Ra+(this.props.isFullScreen?me.Z.state:0)+1,minWidth:"100%",paddingRight:!this.props.disabled&&this.props.showRightActionsSpacer?32:0,clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,borderTop:`1px solid ${this.theme.tableDividerColor}`,...this.props.style}}}Zr.displayName="TableAggregationRow";const Er=Zr;var Rr=o(87085),Ar=o(73060);class Dr extends ut.Z{getInitialState(){return{}}}const Fr=Dr;var Lr=o(39068),Vr=o(79362),Nr=o(74446),Or=o(30610),Ur=o(16956),Hr=o(50125),zr=o(99417),Wr=o(75081),jr=o(29376),Kr=o(67695),Yr=o(26122),Gr=o(10107),Xr=o(79676),qr=o(28992),$r=o(86825),Jr=o(42402);function Qr(e){window.__c={n:"MultiSelectCheckbox"};const{checkedState:t,onClick:o,checkboxType:i,collectionContextStore:n}=e,r=(0,so.O7)(),a=(0,lo.qz)(void 0,ke.Z),l=(0,lo.VK)((()=>a.state.mouseEntered),[a]),c=(0,d.useRef)(null);(0,d.useEffect)((()=>{c.current&&(c.current.indeterminate="indeterminate"===t)}),[t]);const p=(0,lo.VK)((()=>rr.ZP.state.isDragging),[]),u=(0,d.useCallback)((e=>{o(e),E.Ac({environment:r,collectionContextStore:n,checkbox_type:i})}),[i,n,r,o]);return s()(Ln.Z,{isVisible:!0,animationStyle:{opacity:!1===t&&!l||p?0:1},render:()=>s()("label",{style:{marginRight:`${ho._n}px`,alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:"pointer",zIndex:1},onMouseEnter:()=>a.enter(),onMouseLeave:()=>a.exit(),onClick:ie.Wi,onMouseDown:ie.$0},void 0,s()("div",{style:{width:`${ho.bu}px`,height:`${ho.bu}px`,display:"flex",justifyContent:"center",alignItems:"center"}},void 0,d.createElement("input",{type:"checkbox",style:{width:ho.tA,height:ho.tA,cursor:"pointer",position:"relative",right:"2px"},ref:c,checked:!0===t,onChange:u})))})}class ea extends u.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ue.Z,resultStore:Ze.default.of(void 0)},this.renderPopup=e=>d.createElement(ta,r()({},this.props,{parent:e})),this.handleClick=()=>{z.ZH(this.environment),H.ZH(this.environment),F.wG()},this.handleContextMenu=e=>{this.environment.device.isMobile||(e.preventDefault(),(0,ie.ZP)({event:e,context:ie.Af.EditorContextMenu,callback:()=>{this.handleClick(),this.stores.buttonPopupStore.setState({open:!0})}}))},this.shouldShowMultiSelectCheckbox=()=>{const{columnIndex:e,collectionContextStore:t}=this.props;return(0,ee.fk)({environment:this.environment,collectionContextStore:t})&&0===e}}get registries(){return[Kr.Z]}renderComponent(){const{property:e,schema:t,disabled:o,collectionContextStore:i,renderSpacer:n,paddingTop:a,isLast:l,groupsPointer:c}=this.props,p=t[e],{device:u}=this.environment;if(!p)return;const m=i.permissionScopes.state;return d.createElement(d.Fragment,null,this.shouldShowMultiSelectCheckbox()&&s()(oa,{groupsPointer:c,collectionContextStore:i}),s()("div",{style:this.getStyle(),className:X.VMO,onContextMenu:this.handleContextMenu},void 0,s()(qe.Z,{popupType:u.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,disabled:!m.canConfigureBlock,originGap:1,alignmentToOrigin:qe.Z.Alignment.Start,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:t=>s()(it.Z,{renderTooltip:()=>s()("div",{},void 0,s()("div",{},void 0,p.name),(0,mt.q3)(p)&&s()("div",{style:{color:this.theme.accentColors.gray[200]}},void 0,d.createElement(I.FormattedMessage,Gr.sY.keptUpToDateWithNotionAITooltip))),delayThreshold:500,placement:it.Z.Placement.Right,render:i=>d.createElement(Ot.Z,r()({style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:a},disabled:o},(0,Ye.Z)(i,t)),n&&n(l),s()(Vn.Z,{propertySchema:p,showIcon:!0,showBadge:!0,style:{fontSize:14},property:e}))}),render:this.renderPopup,onClick:this.handleClick})))}getStyle(){const{width:e,disabled:t,isLast:o,disableCellRightBorder:i,collectionContextStore:n}=this.props,r=n.permissionScopes.state,a=(t||!r.canConfigureBlock||!r.canConfigureCollection)&&o;return{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:e,borderRight:i||a?void 0:`1px solid ${this.theme.regularDividerColor}`}}}ea.displayName="TableHeaderCell";class ta extends u.Z{constructor(){super(...arguments),this.storeTypes={propertyTypeButtonPopupStore:ue.Z,inputStore:Ze.default.of("")},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,i=o.collectionStore();if(!i)return;const n=i.getSchema()[t];(null==n?void 0:n.name)!==e&&(W.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:this.environment,perform:o=>{Ur.Bv({collectionStore:i,property:t,name:e,transaction:o})}}),E.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.handleHide=()=>{this.updatePropertyFormat({visible:!1})},this.getPropertyFormat=()=>{var e;const{format:t,formatKey:o,property:i}=this.props;return null===(e=t[o])||void 0===e?void 0:e.find((e=>e.property===i))},this.handleDelete=async()=>{const{collectionContextStore:e,property:t}=this.props;await Ur.TI({environment:this.environment,collectionContextStore:e,property:t,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme})},this.handleDeleteAccept=()=>{const{property:e,schema:t,collectionContextStore:o}=this.props,i=o.collectionStore();if(!i)return;W.createAndCommitAsync({environment:this.environment,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:o=>Ur.yV({environment:this.environment,collectionStore:i,schema:t,property:e,transaction:o})});const n=i.getSchema()[e];n&&E.y9({environment:this.environment,collectionContextStore:o,property_type:n.type,from:"table_column",property:e})},this.handleDuplicate=async()=>{const{property:e,collectionContextStore:t,formatKey:o}=this.props,i=this.getPropertyFormat(),n=t.collectionStore(),r=t.collectionViewStore(),a=t.normalizedFormatStore.state[o]||[],s=null==n?void 0:n.getSpaceId();if(!n||!s||!i)return;const l=n.getSchema(),c=l[e];if(!c)return;const d=await(0,ee.xy)({environment:this.environment,schema:l,property:e,properties:a,parentStore:n,spaceId:s});d&&(W.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:this.environment,perform:e=>{F.xO({environment:this.environment,collectionStore:n,update:{[d.newProperty]:d.newPropertySchema},transaction:e}),d.automationUpdate&&F.Ki({environment:this.environment,collectionStore:n,update:d.automationUpdate,transaction:e}),o&&r&&De.FH({stores:[r],update:{[o]:d.newProperties},transaction:e})}}),E.wd({environment:this.environment,collectionContextStore:t,action:"duplicate_property",original_view_type:null==r?void 0:r.getType(),property_type:c.type}))},this.handleAddFilter=()=>{const{property:e,collectionContextStore:t,schema:o}=this.props,i=t.currentPropertyFiltersStore.state,n=t.collectionStore(),r=(null==n?void 0:n.getRecordValue)??Nr.mF.constant(void 0);let a=i.find((t=>{let{filter:o}=t;return o.property===e}));if(!a){const n=(0,q.H_)({property:e,schema:o,getRecordValue:r});if(!n)return;const s={id:(0,ei.ZP)(),filter:n};t.filtersBarOpen.set(!0),Or.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.get(),propertyFilters:{value:[...i,s]}}}),a=s}if(!a)return;const s=t.getFilterBarItemSettingsStore(a);A.wl({collectionSettingsStore:s,item:{type:"filter"}}),F.n1({collectionContextStore:t})},this.handleSortAscending=()=>{this.createSort(!0)},this.handleSortDescending=()=>{this.createSort(!1)},this.handlePropertyIconSubmit=(e,t)=>{const{property:o,collectionContextStore:i}=this.props,n=i.collectionStore();n&&(W.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:this.environment,perform:t=>{Ur.OK({collectionStore:n,property:o,icon:e,transaction:t})}}),E.$q({environment:this.environment,collectionContextStore:i,property:o,icon:e,from:"table",action:"change_icon"}))}}willMountOrUpdate(e){const{property:t,schema:o,collectionContextStore:i}=e,n=o[t];if(n&&"relation"===n.type){const e=jr.ny(i,n);null==e||e.load()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:Ke.og.ActionSheet}:{menuType:Ke.og.Popup,minWidth:220};const o=this.getMenuSections(this.props.parent);return d.createElement($e.Z,t,s()(Je.Z,{type:Je.i.Vertical,initialFocus:void 0,sections:c().compact(o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>d.createElement(ot.Z,r()({},e,{topBorder:0!==t})),items:e}})))}))}shouldShowDuplicateError(){const{property:e,schema:t}=this.props,{inputStore:o}=this.stores,i=o.get(),n=Object.keys(t).find((o=>{var n;return o!==e&&(null===(n=t[o])||void 0===n?void 0:n.name)===i}));return Boolean(n)}getMenuSections(e){var t;const{property:o,schema:i,collectionContextStore:n,formatKey:a,allowHidingTitle:l,format:c}=this.props,{environment:p,theme:u}=this,{device:m}=p,g=i[o],h=n.permissionScopes.state,f=n.settingsStore,v=n.collectionViewStore(),y=n.collectionStore();if(!v||!g||!y)return[];const S=(0,Bt.wl)(o),w=Boolean((null===(t=this.getPropertyFormat())||void 0===t?void 0:t.wrap)||v.getFormat().table_wrap)&&"timeline"!==v.getType(),k=n.databaseType,C=Boolean(k&&G.cR(k,o,y)),_="title"===g.type,M=[];if(S&&"person"===g.type){const e=[];M.push(e),e.push({key:"synced_person",render:e=>d.createElement(qr.Z,r()({},e,{title:g.name||"",icon:b.Z.info({width:14}),caption:s()("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350}},void 0,s()(I.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return s()(Jr.Z,{href:(0,bn.UY)("guides.syncedContent")},void 0,t)}},description:"Note to direct users to the help center for synced people properties."}))})),action:()=>{}})}if(h.canConfigureCollection&&!S){const t=[];M.push(t),t.push({key:"rename",render:t=>s()(ot.Z,{},void 0,d.createElement(Yr.Z,r()({},t,{initialValue:g.name||"",placeholder:ne.default.formatMessage(Gr.sY.inputPlaceholder),focusInitial:!0,inputStore:this.stores.inputStore,onBlur:this.handlePropertyNameSubmit,onSubmit:t=>{this.handlePropertyNameSubmit(t),e.close()},iconButton:{icon:e=>s()(Lr.ZP,{type:g.type,icon:g.icon,size:16,theme:u,style:e}),iconStyle:{fill:Vr.Lr[u.mode].gray},enforceIconColor:"gray",onSubmit:this.handlePropertyIconSubmit}})),this.shouldShowDuplicateError()&&s()(Gr.mJ,{propertyName:this.stores.inputStore.get(),styles:m.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${u.regularDividerColor}`}:{}})),action:()=>{E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_rename"}),F.n1({collectionContextStore:n}),e.close()}}),t.push({key:"edit_property",render:e=>s()(it.Z,{placement:it.Z.Placement.Left,render:t=>d.createElement(Xe.Z,r()({disabled:void 0===y,title:s()(I.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:b.Z.options({width:14})},(0,Ye.Z)(e,t))),style:{whiteSpace:"normal"},renderTooltip:()=>s()(I.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{y&&(E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_edit"}),F.n1({collectionContextStore:n}),e.close(),A.r$({collectionContextStore:n,collectionSettingsStore:f}),A.H4({collectionSettingsStore:f,item:{type:"properties",timelineViewTab:"table"}}),A.H4({collectionSettingsStore:f,item:{type:"property",formatKey:a,property:o,collectionPointer:y.pointer}}))}}),(0,zr.Zt)(this.environment)&&(0,mt.qQ)(g)&&t.push({key:"autofill_with_ai",render:e=>s()(it.Z,{placement:it.Z.Placement.Left,render:t=>d.createElement(Xe.Z,r()({disabled:void 0===y,title:s()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,s()(I.FormattedMessage,{defaultMessage:"Set up fill with AI",id:"database.tableHeaderCell.autofillWithAI",description:"Menu item to set up the property associated with this table header to be filled and updated with Notion AI"}),s()(Xr.Z,{style:{display:"inline-block"}})),icon:b.Z.magicWand({width:14,color:u.accentColors.purple[400]})},(0,Ye.Z)(e,t))),style:{whiteSpace:"normal"},renderTooltip:()=>s()(I.FormattedMessage,{defaultMessage:"Keep this property up-to-date with Notion AI",id:"database.tableHeaderCell.autofillWithAITooltip",description:"Tooltip for menu item to configure AI autofill for the property associated with this table column"})}),action:()=>{y&&(e.close(),A.r$({collectionContextStore:n,collectionSettingsStore:f}),A.H4({collectionSettingsStore:f,item:{type:"properties",timelineViewTab:"table"}}),A.H4({collectionSettingsStore:f,item:{type:"property",formatKey:a,property:o,collectionPointer:y.pointer}}),A.H4({collectionSettingsStore:f,item:{type:"propertyAiAutofill",propertySchema:g,property:o}}))}})}if(h.canConfigureBlock){const t=[];M.push(t),t.push({key:"sort_asc",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:b.Z.arrowUp({width:14})})),action:()=>{E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_sort_asc"}),e.close(),this.handleSortAscending()}}),t.push({key:"sort_desc",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:b.Z.arrowDown({width:14})})),action:()=>{E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_sort_desc"}),e.close(),this.handleSortDescending()}}),t.push({key:"filter",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:b.Z.filter({width:14})})),action:()=>{E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_filter"}),e.close(),this.handleAddFilter()}})}const T=[];if(M.push(T),(l||"title"!==g.type)&&h.canConfigureBlock&&T.push({key:"hide",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:b.Z.eyeHidePadded({width:22,marginLeft:-4,marginRight:-4})})),action:()=>{E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_hide"}),e.close(),this.handleHide()}}),!ct.Tr.includes(g.type)||(0,mt.dx)(g)||!h.canConfigureCollection||S||_||T.push({key:"duplicate",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:b.Z.duplicate({width:14})})),action:async()=>{E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_duplicate"}),e.close(),await this.handleDuplicate()}}),ct.Tr.includes(g.type)&&h.canConfigureCollection&&!S&&!_&&T.push({key:"delete",render:e=>d.createElement(Xe.Z,r()({},e,{disabled:C,disabledFeedback:C,title:s()(I.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:this.environment.device.isMobile&&C?(0,Wr.A7)(k):null,icon:C?s()(it.Z,{placement:it.Z.Placement.Left,renderTooltip:e=>(0,Wr.A7)(k,e),render:e=>d.createElement("div",e,b.Z.lockedFilled({width:14}))}):b.Z.trash({width:14})})),action:async()=>{E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_delete"}),e.close(),await this.handleDelete()}}),h.canConfigureBlock&&"timeline"!==v.getType()){const e=[];M.push(e),e.push({key:"wrap_cell",render:e=>d.createElement($r.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn",description:"Switch toggle button for wrapping table column content."}),on:w})),action:()=>{Hr.K4({currentValue:w,environment:this.environment,property:o,collectionViewStore:v,format:c,formatKey:a}),E.wd({environment:this.environment,collectionContextStore:n,action:"table_header_wrap_column"})}})}return M}createSort(e){const{property:t,collectionContextStore:o,schema:i}=this.props;if(!i[t])return;const n=[{property:t,direction:e?"ascending":"descending"}];o.filtersBarOpen.set(!0),Or.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.get(),sorts:{value:n}}}),F.n1({collectionContextStore:o})}updatePropertyFormat(e){const{collectionContextStore:t,property:o,format:i,formatKey:n}=this.props,r=t.collectionViewStore();if(!r)return;const a=(i[n]||[]).map((t=>t.property===o?{...t,...e}:t)),s={...i,[n]:a};W.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:this.environment,perform:e=>{F.iG({collectionViewStore:r,update:{format:s},transaction:e})}})}}function oa(e){window.__c={n:"GroupSelectCheckbox"};const{groupsPointer:t,collectionContextStore:o}=e,i=(0,so.O7)(),n=(0,d.useCallback)((()=>(0,go.A7)(t[0],o)),[o,t]),r=(0,lo.VK)((()=>{const e=n(),t=e.length;if(0===t)return!1;const o=_t.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")}),[n]),a=(0,d.useCallback)((e=>{var t;const a=n(),s=_t.default.state.stores,l=(0,ho.vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:s;!1===r||"indeterminate"===r?H.Z5({environment:i,stores:c().union(l,a)}):!0===r&&H.Z5({environment:i,stores:c().without(l,...a)}),e.stopPropagation()}),[r,o,i,n]);return s()(Qr,{checkedState:r,onClick:a,checkboxType:"group",collectionContextStore:o})}ta.displayName="TableHeaderCellMenu";const ia=(0,I.injectIntl)(ea);var na=o(58299);class ra extends u.Z{constructor(){super(...arguments),this.resizeStartLeftFormat=void 0,this.storeTypes={mouseStore:ke.Z,resultStore:Ze.default.of(void 0)},this.handleDragStart=e=>{e.preventDefault(),this.resizeStartLeftFormat=this.props.leftFormat,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!0})},this.handleDragMove=e=>{const t=this.getNewFormat(e);t&&this.props.onTemporaryResize(t)},this.handleDragEnd=e=>{const t=this.getNewFormat(e);t&&this.props.onAccept(t),this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDragCancel=()=>{this.props.onCancel(),this.resizeStartLeftFormat=void 0,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDoubleClick=()=>{const e=this.stores.resultStore.state?this.stores.resultStore.state.blockIds:[],t=l.compact(e.map((e=>{const t=na.Z.findBlockPropertyValueByBlockId(e,this.props.leftFormat.property),o=null==t?void 0:t.getNode();if(o)return this.calculateMaxWidth(o)})));if(this.props.leftFormat.width){const e={...this.props.leftFormat,width:Math.min(800,Math.max(Math.max(...t),gt.nw(this.props.propertySchema,this.props.leftFormat)))};this.props.onAccept(e)}}}renderComponent(){const{device:e}=this.environment,{mouseEntered:t,mousePressed:o}=this.stores.mouseStore.state,i=(o||t)&&!e.isPhone;return s()("div",{style:ra.style,onMouseMove:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},void 0,s()(Gi.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>d.createElement("div",r()({style:i?this.getInnerActiveStyle():this.getInnerStyle(),onDoubleClick:this.handleDoubleClick},e))}))}getInnerStyle(){return{width:5,marginLeft:-3,marginTop:-1,height:this.props.height,transition:"background 200ms ease-out",background:Eo.ZP.blueWithAlpha(0),cursor:"col-resize"}}getInnerActiveStyle(){return{...this.getInnerStyle(),background:Eo.ZP.blueWithAlpha(.8)}}calculateMaxWidth(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const i=getComputedStyle(e);for(let a=0;a<i.length;a++){const e=i[a],o=i.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative"),t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const n=t.querySelectorAll("*");for(const a of n)a.style&&(a.style.pointerEvents="none",a.style.width="auto");document.body.appendChild(t);const r=t.getBoundingClientRect();return t.remove(),null!=r&&r.width?Math.ceil(r.width):void 0}getNewFormat(e){if(this.resizeStartLeftFormat&&this.resizeStartLeftFormat.width){const t=Math.max(this.resizeStartLeftFormat.width+e.diffX,gt.nw(this.props.propertySchema,this.props.leftFormat));return{...this.resizeStartLeftFormat,width:t}}}}ra.displayName="TableHeaderResizer",ra.style={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1};const aa=ra;var sa=o(81415);function la(e){window.__c={n:"LearnMoreLink"};const{href:t,style:o}=e,i=(0,co.yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return s()("a",{href:t,target:"_blank",style:{...i.default,...o}},void 0,b.Z.help({width:14,marginRight:4}),s()(I.FormattedMessage,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more",description:"Clicking on this will navigate the user to a link to provide more information"}))}var ca=o(71424);function da(e){window.__c={n:"WikiPropertiesOnboardingTooltip"};const{origin:t,propertyType:o}=e,i=(0,so.O7)();return s()(sa.U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return s()(I.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner",description:"Header text that shows in the onboarding flow on the Owner property of a wiki database to introduce users to the new property."});case"verification":return s()(I.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification",description:"Header text that shows in the onboarding flow on the Verification property of a wiki database to introduce users to the new property."});case"tags":return s()(I.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more",description:"Header text that shows in the onboarding flow on the Tags property of a wiki database to introduce users to the new property."});default:(0,ti.t1)(o)}}(),content:function(){switch(o){case"owner":return s()(I.FormattedMessage,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",description:"Text that shows in the wiki onboarding flow on the Owner property of a wiki database, describing the new property's functionality.",values:{bold:e=>s()("span",{style:{fontWeight:M.Z.fontWeight.semibold}},void 0,e)}});case"verification":return d.createElement(d.Fragment,null,s()(I.FormattedMessage,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty",description:"Text that shows in the wiki onboarding flow on the Verification property of a wiki database, describing the new property's functionality."}),s()(la,{href:(0,bn.UY)("guides.wikis"),style:{color:Eo.ZP.uiLightGray}}));case"tags":return d.createElement(d.Fragment,null,s()(I.FormattedMessage,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty",description:"Text that shows in the wiki onboarding flow on the Tags property."}),s()(la,{href:(0,bn.UY)("guides.databaseProperties"),style:{color:Eo.ZP.uiLightGray}}));default:(0,ti.t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,ti.t1)(o)}}(),onCloseClick:()=>{Ar.nX(i)},onPrimaryButtonClick:()=>Ar.Rg(i),onBackButtonClick:()=>Ar.FO(i),shouldDismissUponOutsideClick:!0,pointerLength:ca.EZ,pointerOffset:ca.FD,style:{width:ca.G5}})}class pa extends u.Z{constructor(){super(...arguments),this.storeTypes={tableHeaderRowStore:Fr,resultStore:Ze.default.of(void 0)},this.propertyRef=d.createRef(),this.renderHeaderRowCells=(e,t,o)=>{var i,n,r,a;const{device:l}=this.environment,{store:c,collectionContextStore:p,schema:u,query:m,resultStore:g,disabled:h,formatKey:v,disableCellRightBorder:y,renderSpacer:b,allowHidingTitle:S,paddingTop:w,groupFormat:k}=this.props,C=this.getCurrentFormat(),_=this.props.showPropertyFormatsStore.state[t],M=t===o.length-1,T=k?[k]:[],I=Ar.B1(),P=(null===(i=p.collectionStore())||void 0===i?void 0:i.getFormat().app_config_uri)===f.GZ&&c.isCollectionViewPageWithContent()&&c.id===(null===(n=p.collectionViewBlockStore())||void 0===n?void 0:n.id),x=P&&e===f.dE&&"owner"===I,B=P&&"verification"===(null===(r=u[e])||void 0===r?void 0:r.type)&&"verification"===I,Z=P&&"multi_select"===(null===(a=u[e])||void 0===a?void 0:a.type)&&"tags"===I,E=!l.isMobile&&(x||B||Z);return d.createElement("div",{key:e,style:this.getHeaderCellWrapStyle(),ref:E?this.propertyRef:void 0},E&&s()(da,{origin:this.propertyRef,propertyType:I}),_&&_.width&&s()(ia,{format:C,schema:u,query:m,property:e,width:_.width,collectionViewBlockStore:c,collectionContextStore:p,disabled:h,formatKey:v,isLast:M,disableCellRightBorder:y,allowHidingTitle:S,renderSpacer:b,paddingTop:w,columnIndex:t,resultStore:g,groupsPointer:T}),!h&&!l.isPhone&&s()(aa,{leftFormat:_,onTemporaryResize:this.handleTemporaryColumnResize,onAccept:this.handleColumnResizeAccept,onCancel:this.handleTemporaryColumnResizeCancel,height:this.props.height,propertySchema:u[e],resultStore:g}))},this.handleColumnReorder=e=>{const{collectionContextStore:t,formatKey:o}=this.props,i=t.collectionViewStore();if(!i)return;const n={...this.getCurrentFormat(),[o]:c().sortBy(this.getProperties(),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};W.createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:this.environment,perform:e=>{F.iG({collectionViewStore:i,update:{format:n},transaction:e})}}),E.wd({environment:this.environment,collectionContextStore:t,action:"table_reorder_columns"})},this.handleTemporaryColumnResize=e=>{this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:this.getNewResizeFormat(e)})},this.handleColumnResizeAccept=e=>{const{collectionContextStore:t,formatKey:o}=this.props,i=t.collectionViewStore();if(!i)return;const n={...this.getCurrentFormat(),[o]:this.getProperties().map((t=>t.property===e.property?e:t))};W.createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:this.environment,perform:e=>{F.iG({collectionViewStore:i,update:{format:n},transaction:e})}}),this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:void 0}),E.wd({environment:this.environment,collectionContextStore:t,action:"table_resize_columns"})},this.handleTemporaryColumnResizeCancel=()=>{this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:void 0})},this.handleAddColumnClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();t&&(z.ZH(this.environment),H.ZH(this.environment),F.wG(),E.wd({environment:this.environment,collectionContextStore:e,action:"click_new_property"}),A.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",propertyTypes:(0,ct.TP)({isSyncedCollection:t.isSyncedCollection(),collectionContextStore:e}),onAccept:(t,o)=>{Rr.Rl({environment:this.environment,collectionContextStore:e,propertyType:t,propertyName:o,from:"table"})}}}))},this.handleConfigureColumnsClick=()=>{const{collectionContextStore:e}=this.props;A.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),E.wd({environment:this.environment,collectionContextStore:e,action:"click_table_header_dot_menu"}),A.H4({collectionSettingsStore:e.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})},this.captureEditorMouseDown=e=>{(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{}})}}renderComponent(){const{disabled:e,showRightActions:t,disableHorizontalEdgeScroll:o,collectionContextStore:i}=this.props,n=this.props.showPropertyFormatsStore.state.map((e=>e.property)),r=i.permissionScopes.state;return s()(vi,{position:Ve.Top},void 0,s()("div",{style:this.getHeaderRowStyle()},void 0,e||!r.canConfigureBlock?s()("div",{style:Ai.l8},void 0,n.map(this.renderHeaderRowCells)):d.createElement(d.Fragment,null,s()(Ai.ZP,{direction:"horizontal",keys:n,renderKey:this.renderHeaderRowCells,onDrop:this.handleColumnReorder,disableHorizontalEdgeScroll:o})),!e&&t&&d.createElement(d.Fragment,null,this.renderAddColumnButton(),this.renderConfigureColumnsButton()),this.props.children))}renderAddColumnButton(){return s()(Ot.Z,{style:this.getAddColumnStyle(),onMouseDown:this.captureEditorMouseDown,onClick:this.handleAddColumnClick,className:X.V6y},void 0,s()("div",{style:pa.addColumnIconWrapStyle},void 0,b.Z.plus({width:12,fill:this.theme.mediumIconColor})))}renderConfigureColumnsButton(){return s()(Ot.Z,{style:this.getConfigureColumnsStyle(),onMouseDown:this.captureEditorMouseDown,onClick:this.handleConfigureColumnsClick,className:X.V6y},void 0,s()("div",{style:pa.addColumnIconWrapStyle},void 0,b.Z.dots({width:12,fill:this.theme.mediumIconColor})))}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.props.tableStore.state;return t||e}getNewResizeFormat(e){const{formatKey:t}=this.props;return{...this.getCurrentFormat(),[t]:this.getProperties().map((t=>t.property===e.property?e:t))}}getProperties(){const{formatKey:e}=this.props;return this.getCurrentFormat()[e]||[]}getHeaderCellWrapStyle(){return{display:"flex",position:"relative"}}getHeaderRowStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o,height:i,minWidth:n,disableTopBorder:r}=this.props,a=t.collectionViewStore();if(!a)return{};const s=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground);return{display:"flex",position:"absolute",background:s,zIndex:T.VT,height:i-1,color:this.theme.mediumTextColor,borderTop:r?void 0:`1px solid ${this.theme.tableDividerColor}`,boxShadow:`\n\t\t\t\t-3px 0 0 ${s},\n\t\t\t\t0 1px 0 ${this.theme.tableDividerColor}\n\t\t\t`,minWidth:n,left:"timeline"===a.getType()?void 0:0,right:"timeline"===a.getType()?void 0:0}}getAddColumnStyle(){return{display:"flex",justifyContent:"flex-start",width:32}}getConfigureColumnsStyle(){return{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}}}pa.displayName="TableHeaderRow",pa.contextTypes={...u.w,...j.xm},pa.addColumnIconWrapStyle={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};const ua=(0,I.injectIntl)(pa);class ma extends Ee.Z{constructor(){super(...arguments),this.renderRowSelectCheckbox=()=>{const{store:e,collectionContextStore:t}=this.props;return s()(ga,{store:e,collectionContextStore:t})},this.renderColumn=(e,t,o)=>{const{store:i,onPropertyTab:n,onPropertyUntab:r,onPropertyEnter:a,onPropertyClick:l,onPropertyEsc:c,onPropertyBgClick:d,onOpenProperty:p,schema:u,onPropertyContextMenu:m,disabled:g,blockPropertyValueOverlayStore:h,disableHorizontalEdgeScroll:f,disableCellBorderRight:v,disableLastCellBorderRight:y,collectionContextStore:b,subitemPath:S,onShiftEnter:w}=this.props,k=t===o.length-1,{width:C,property:_,wrap:M}=e,T=b.permissionScopes.state,I=i.getAssociatedCollectionStore();if(!I)return;const P=(null==S?void 0:S.length)??0,x=0!==t||void 0===C?C:C-(0,ho.lZ)({columnIndex:t,indentLevel:P}),B=this.renderToggleButton(t),Z=g||!this.canEditStore.state,E=T.isLocked||!T.canConfigureCollection||!T.canConfigureBlock,R=s()(Ut.Z,{capture:this.shouldCaptureKeyboard.state,onShiftEnter:w},void 0,s()(Vt.Z,{store:i,property:_,disabled:Z,locked:E,width:x,format:Nt.C.Table,onTab:n,onUntab:r,onEnter:a,onClick:()=>l(i,_,u),onEsc:c,onBgClick:d,onOpenProperty:p,forceMouseEntered:"title"===_&&this.canEditStore.state?this.isShowingHoverMenu.state:void 0,tableWrap:Boolean(this.tableWrapStore.state||M),shouldSetCellHeight:this.shouldSetCellHeightStore.state,onContextMenu:m,isLast:k,disableTableBorderRight:v||k&&y||Boolean(B),blockPropertyValueOverlayStore:h,disableHorizontalEdgeScroll:f,handleOpenPeekPage:this.props.handleOpenPeekPage,collectionStore:I,indentLevel:0===t&&S?S.length:void 0,collectionViewStore:b.collectionViewStore()},_));return B?s()("div",{style:{display:"flex",width:C,overflowX:"hidden",borderRight:v||k&&(y||Z||E)?"none":`1px solid ${this.theme.tableLightDividerColor}`}},void 0,B,R):R},this.shouldCaptureKeyboard=this.createComputedStore((()=>_t.default.state.stores.length>0&&_t.default.state.stores[0].id===this.props.store.id)),this.canEditStore=this.createComputedStore((()=>!this.props.disabled&&this.props.store.canEdit())),this.isShowingHoverMenu=this.createComputedStore((()=>{const{store:e}=this.props,t=fo.default.state;return Boolean(t.isOpen&&t.currentStore===e)})),this.tableWrapStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();return!!t&&Boolean(!this.props.disableTableWrap&&t.getFormat().table_wrap)})),this.shouldSetCellHeightStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();return Boolean("timeline"===(null==t?void 0:t.getType())||!this.tableWrapStore.state&&!this.props.propertyFormats.some((e=>e.wrap)))}))}activate(){const{collectionContextStore:e}=this.props,{mainEditorCurrentBlockStore:t}=pe.default.state,o=ee.mb({store:this.props.store,mainEditorCurrentBlockStore:t,collectionContextStore:e,fullyQualified:!1});o&&(this.props.handleOpenPeekPage(),N.navigate({environment:this.environment,url:o}))}renderPersisted(){const{collectionContextStore:e,propertyFormats:t,showRightActionsSpacer:o}=this.props;return s()(d.Fragment,{},void 0,this.renderRowSelectCheckbox(),t.map(this.renderColumn),this.canEditStore.state&&!e.permissionScopes.state.isLocked&&o&&this.renderRightActionsSpacer())}renderToggleButton(e){const{collectionContextStore:t,toggleButton:o,subitemPath:i}=this.props,n=t.currentSubitemFormatStore.state,r=(null==i?void 0:i.length)??0;if(e>0||!n)return;const a=Math.max((r-1)*go.Hw,0)+go.gY;return o?s()("div",{style:{paddingTop:4,display:"flex"}},void 0,s()("div",{style:{width:a}}),o):s()("div",{style:{minWidth:a+go.Hw}})}renderRightActionsSpacer(){return s()("div",{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}})}}function ga(e){window.__c={n:"RowSelectCheckbox"};const{store:t,collectionContextStore:o}=e,i=(0,so.O7)(),n=(0,lo.VK)((()=>_t.default.state.stores.some((e=>e===t))),[t]),r=(0,lo.VK)((()=>ee.fk({environment:i,collectionContextStore:o})),[o,i]),a=(0,d.useCallback)((e=>{var n;(0,ho.vg)({collectionViewBlockId:null===(n=o.collectionViewBlockStore())||void 0===n?void 0:n.id})?H.Z5({environment:i,stores:[t]}):H.Ys({environment:i,store:t,toggle:!0}),e.stopPropagation()}),[o,i,t]);return r?s()(Qr,{checkedState:n,onClick:a,checkboxType:"single_row",collectionContextStore:o}):null}const ha=ma;var fa,va=o(12137),ya=o(55061),ba=o(63143),Sa=o(11302),wa=o(39865),ka=o(4708),Ca=o(25464),_a=o(29370);!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down"}(fa||(fa={}));class Ma extends u.Z{constructor(){super(...arguments),this.rowsWrapEl=null,this.dragVerticalScrollableAncestor=void 0,this.dragHorizontalScrollableAncestor=void 0,this.dragStartScrollTop=void 0,this.dragStartScrollLeft=void 0,this.observer=void 0,this.storeTypes={dragAndFillStore:Ze.default.of(void 0)},this.handleDragStart=e=>{e.preventDefault();const t=this.normalizedTableSelectionStore.state;if(t&&this.isDragAndFillEnabled()){this.isInBottomRightCornerOfCell(e.currentX,e.currentY,null==t?void 0:t.end)&&this.stores.dragAndFillStore.set({...t})}this.dragVerticalScrollableAncestor=(0,se.VW)(p.findDOMNode(this)),this.dragVerticalScrollableAncestor&&(this.dragStartScrollTop=this.dragVerticalScrollableAncestor.scrollTop),this.dragHorizontalScrollableAncestor=(0,se.xH)(p.findDOMNode(this)),this.dragHorizontalScrollableAncestor&&(this.dragStartScrollLeft=this.dragHorizontalScrollableAncestor.scrollLeft)},this.handleDragMove=e=>{if(ae.X9()&&this.dragVerticalScrollableAncestor&&this.dragHorizontalScrollableAncestor&&!ba.z4(this.dragStartScrollTop)&&!ba.z4(this.dragStartScrollLeft)){const t=this.dragVerticalScrollableAncestor.scrollTop,o=this.dragHorizontalScrollableAncestor.scrollLeft,i=this.stores.dragAndFillStore.state,n=i?i.start:this.getCellPosition(e.startX+(this.dragStartScrollLeft-o),e.startY+(this.dragStartScrollTop-t)),r=this.getCellPosition(e.currentX,e.currentY);if(this.stores.dragAndFillStore.get()&&n.col!==r.col)return;this.setSelection({start:n,end:r})}},this.handleDragEnd=()=>{this.dragVerticalScrollableAncestor=void 0,this.dragStartScrollTop=void 0,this.dragAndFillCells()},this.handleDragCancel=()=>{this.dragVerticalScrollableAncestor=void 0,this.dragStartScrollTop=void 0,this.stores.dragAndFillStore.reset(),F.wG()},this.handleLeft=e=>{e.preventDefault&&e.preventDefault(),Ct.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Hr.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1,columnCount:this.getCurrentColumnCount()}),this.updateSelectionScroll(fa.Left))},this.handleRight=e=>{e.preventDefault&&e.preventDefault(),Ct.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Hr.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:this.getCurrentColumnCount(),rowCount:this.props.currentRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(fa.Right))},this.handleUp=e=>{e.preventDefault&&e.preventDefault(),Ct.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Hr.zJ({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(fa.Up))},this.handleDown=e=>{e.preventDefault&&e.preventDefault(),Ct.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Hr.DI({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,rowCount:this.props.currentRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(fa.Down))},this.handleEnter=e=>{e.preventDefault&&e.preventDefault(),Ct.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const i=this.props.currentRowsStore.state,n=i[o.start.row],r=this.props.showPropertyFormatsStore.state[o.start.col].property,a=t[r];if(a&&!this.props.disabled)if(mt.uk.includes(a.type)){if("checkbox"===a.type){const e=n.getPropertyStore(r),t=Bt.Ml(e.getValue()),a=i.slice(o.start.row,o.end.row+1);W.createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:this.environment,perform:e=>{for(const o of a)yt.sO({store:o.getPropertyStore(r),value:Bt._I(!t),transaction:e})}})}}else vt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:n,property:r,format:Nt.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,collectionContextStore:this.props.collectionContextStore}),F.wG()},this.handleTab=e=>{e.preventDefault(),Ct.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Hr.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:this.getCurrentColumnCount(),rowCount:this.props.currentRowsStore.state.length,shiftKey:!1}),this.updateSelectionScroll(fa.Right))},this.handleUntab=e=>{e.preventDefault(),Ct.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Hr.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:!1,columnCount:this.getCurrentColumnCount()}),this.updateSelectionScroll(fa.Left))},this.handleEsc=e=>{const{device:t}=this.environment;if(t.isMobile)return;e.preventDefault(),Ct.Z.setKeyboardMode(!0);const o=this.normalizedTableSelectionStore.state;if(F.wG(),o){const e=(0,ho.AV)(o),t=this.props.currentRowsStore.state.slice(e.minRow,e.maxRow+1);H.Z5({environment:this.environment,stores:t})}},this.handleMoveTo=e=>{e.preventDefault&&e.preventDefault(),Ct.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(F.wG(),t){const e=(0,ho.AV)(t),o=this.props.currentRowsStore.state.slice(e.minRow,e.maxRow+1);if(0===o.length)return;H.Z5({environment:this.environment,stores:o});const i=zi.C.getRectFromStore(o[0]);Sa.bA({environment:this.environment,blocks:o,originRect:i,moveToContext:"action_menu",needsConfirmation:!1})}},this.handleDelete=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state;t&&!this.props.disabled&&W.createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:this.environment,perform:e=>{Hr.NE({selection:t,schema:o,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.props.currentRowsStore.state,transaction:e})}})},this.handleCut=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,i=this.props.collectionContextStore.collectionViewBlockStore();i&&t&&!this.props.disabled&&W.createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:this.environment,perform:n=>{Hr.nA({selectionKey:{collectionViewBlockStore:i,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.props.currentRowsStore.state,event:e,transaction:n})}})},this.handleCopy=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,i=this.props.collectionContextStore.collectionViewBlockStore();i&&t&&Hr.qn({selectionKey:{collectionViewBlockStore:i,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.props.currentRowsStore.state,event:e})},this.handlePaste=e=>{const{collectionContextStore:t,groupFormat:o,schema:i,showPropertyFormatsStore:n,currentRowsStore:r}=this.props,a=this.normalizedTableSelectionStore.state,s=this.props.collectionContextStore.collectionViewBlockStore();s&&a&&!this.props.disabled&&W.createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:this.environment,perform:l=>{Hr.j0({environment:this.environment,collectionContextStore:t,selectionKey:{collectionViewBlockStore:s,groupFormat:o},selection:a,currentPropertyFormats:n.state,currentRows:r.state,event:e,transaction:l,schema:i})}})},this.handleCommandEnter=e=>{const{device:t}=this.environment,o=this.normalizedTableSelectionStore.state;if(t.isMobile||!o)return;const{collectionContextStore:i}=this.props,n=this.props.currentRowsStore.state[o.start.row],{mainEditorCurrentBlockStore:r}=pe.default.state,a=ee.mb({store:n,mainEditorCurrentBlockStore:r,collectionContextStore:i,fullyQualified:!1});a&&this.navigate(a)},this.handleShiftEnter=()=>{const{device:e}=this.environment;if(e.isMobile)return;const t=this.normalizedTableSelectionStore.state;if(!t)return;if(!Ne.M_(this.environment))return;const{collectionContextStore:o,groupFormat:i}=this.props;if(!o.shouldAllowNewItemCreation())return;const n=this.props.currentRowsStore.state,r=this.props.currentRowsStore.state[t.start.row],a=o.subitemTreeStore.state,s=(0,mo.DY)(a.children,(e=>e.value.store===r)),l="table_selection_overlay_shift_enter";if(s){const e=s?(0,go.Af)(s.map((e=>e.value.store))):"",a=o.subitemExpandedStore.get().get(e),c=Boolean(null==a?void 0:a.isExpanded),d=[...s].splice(0,s.length-1),p=d?(0,go.Af)(d.map((e=>e.value.store))):"",u=o.subitemExpandedStore.get().get(p),g=Boolean(null==u?void 0:u.isExpanded);if(c||g)W.createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:this.environment,perform:e=>{const t=o.collectionStore();if(!t)return;const a=R.yk({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],results:n,store:r,before:!1,collectionStore:t,transaction:e,subitemPath:s,subitemInsertDirection:g&&!c?"below":"into"});a&&this.props.blockPropertyValueOverlayStore&&m.default.afterNextFlush((()=>{m.default.afterNextFlush((()=>{vt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:a,property:"title",format:Nt.C.Table,collectionContextStore:o})}))}))}});else{const e={col:t.end.col,row:o.currentViewHasSort()?n.length:t.end.row+1};W.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const{coercionSucceeded:r,newStore:a}=R.IW({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],results:n,insertAtIndex:e.row,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:l});if(!r){const e=i?[i]:[],t=o.groupsStore.getGroupState(e);N.peekBlock({environment:this.environment,store:a,peekMode:ee.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o})}}}),m.default.afterNextFlush((()=>{this.setSelection({start:e,end:e})}))}}else{const e={col:t.end.col,row:o.currentViewHasSort()?n.length:t.end.row+1};W.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const{coercionSucceeded:r,newStore:a}=R.IW({environment:this.environment,collectionContextStore:o,groupsPointer:i?[i]:[],results:n,insertAtIndex:e.row,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:l});if(!r){const e=i?[i]:[],t=o.groupsStore.getGroupState(e);N.peekBlock({environment:this.environment,store:a,peekMode:ee.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o})}}}),m.default.afterNextFlush((()=>{this.setSelection({start:e,end:e})}))}this.updateSelectionScroll(fa.Down),vt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handleDuplicate=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;o&&o.start.col===o.end.col&&!this.props.disabled&&Ne.M_(this.environment)&&(e.preventDefault(),W.createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:o,start:o.start})}}))},this.handleCommandShiftEnter=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;if(o){const e=this.props.currentRowsStore.state[o.start.row],t=(0,oe.ZP)({store:e,fullyQualified:!1});N.navigateToExternalURL({environment:this.environment,url:t})}},this.handleKeypress=e=>{if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),Ct.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const i=this.props.currentRowsStore.state[o.start.row],n=this.props.showPropertyFormatsStore.state[o.start.col].property,r=t[n];r&&!this.props.disabled&&mt.ub.includes(r.type)&&e.key&&1===e.key.length&&(vt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:i,property:n,format:Nt.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,insertChar:e.key,collectionContextStore:this.props.collectionContextStore}),F.wG())},this.handlePropertyTab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),n=this.props.showPropertyFormatsStore.state,r={col:Math.min(i.col+1,n.length-1),row:i.row};this.setSelection({start:r,end:r}),this.updateSelectionScroll(fa.Right),vt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyUntab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),n={col:Math.max(i.col-1,0),row:i.row};this.setSelection({start:n,end:n}),this.updateSelectionScroll(fa.Left),vt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyEnter=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(!e.isOpen)return;const{store:t,property:o}=e,i=this.getCellPositionOfStore(t,o),n={col:i.col,row:i.row+1};m.default.afterNextFlush((()=>{this.shouldMoveSelectionToNextRow()&&this.setSelection({start:n,end:n})})),this.updateSelectionScroll(fa.Down),vt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handlePropertyClick=(e,t,o)=>{var i;const{device:n}=this.environment;if("checkbox"!==(null===(i=o[t])||void 0===i?void 0:i.type)||n.isMobile)F.wG();else{const o=this.getCellPositionOfStore(e,t);this.setSelection({start:o,end:o})}},this.dismissPropertyOverlay=e=>{const{device:t}=this.environment,o=this.props.blockPropertyValueOverlayStore.state;if(o.isOpen){const{store:i,property:n}=o,r=this.getCellPositionOfStore(i,n);t.isMobile?F.wG():this.shouldMoveSelectionToNextRow()&&this.setSelection({start:r,end:r}),this.updateSelectionScroll(fa.Down),vt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),null==e||e(o)}},this.handlePropertyBgClick=()=>{this.dismissPropertyOverlay()},this.handlePropertyEsc=()=>{this.dismissPropertyOverlay((e=>{const{isNewBlock:t,store:o}=e;t&&o.isEmptyTitle()&&o.isEmptyPage()&&W.createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:this.environment,perform:e=>{wa.y8({environment:this.environment,blocks:[o],transaction:e}),e.postSubmitCallbacks.push((e=>{if(!e){const e=this.props.collectionContextStore.collectionStore(),t=this.props.collectionContextStore.collectionViewBlockStore();P.trackBlockAction(this.environment,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:o.id,block_type:"page",collection_id:null==e?void 0:e.id,collection_view_id:null==t?void 0:t.id})}}))}})}))},this.handlePropertyOpenProperty=e=>{const t=this.props.blockPropertyValueOverlayStore.state;if(t.isOpen){const{store:o}=t;vt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:o,property:e,format:Nt.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,collectionContextStore:this.props.collectionContextStore})}},this.handlePropertyContextMenu=e=>{e.preventDefault();const t=this.props.currentRowsStore.state,o=this.normalizedTableSelectionStore.state,i=this.getCellPosition(e.clientX,e.clientY);let n=!1;if(o){const r=Math.min(o.start.row,o.end.row),a=Math.max(o.start.row,o.end.row);if(i.row>=r&&i.row<=a){const o=t.slice(r,a+1);o.length>0&&(H.Z5({environment:this.environment,stores:o}),H.Ys({environment:this.environment,store:o[0]}),ft.Qn({environment:this.environment,stores:_t.default.state.stores,left:e.clientX,top:e.clientY,actions:ht.Qi,showInput:!0,analyticsFrom:"content_block_menu"}),n=!0)}}if(!n){const o=t[i.row];o&&(H.Ys({environment:this.environment,store:o}),ft.Qn({environment:this.environment,stores:_t.default.state.stores,left:e.clientX,top:e.clientY,actions:ht.Qi,showInput:!0,analyticsFrom:"content_block_menu"}))}},this.handleRowSelectableEnter=e=>{const t=this.props.currentRowsStore.state,o=e.blocks.map((e=>t.indexOf(e))),i=c().min(o)||0,n=c().max(o)||0;i>=0&&n>=0&&this.setSelection({start:{col:0,row:i},end:{col:0,row:n}})},this.handleRowsWrapMount=e=>{this.rowsWrapEl=e},this.handleRowsObserverChange=()=>{this.selectionStartRectStore.recompute(),this.selectionEndRectStore.recompute()},this.normalizedTableSelectionStore=this.createComputedStore((()=>{const e=_a.Z.state,t=this.props.collectionContextStore.collectionViewBlockStore();if(!t)return;const{groupFormat:o}=this.props;if(!e.isActive||!(0,_a.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:o}))return;const i=this.getCurrentColumnCount(),n=this.props.currentRowsStore.state.length,{selection:r}=e;return{start:{col:(0,va.Z)(r.start.col,0,i-1),row:(0,va.Z)(r.start.row,0,n-1)},end:{col:(0,va.Z)(r.end.col,0,i-1),row:(0,va.Z)(r.end.row,0,n-1)}}}),!0),this.selectionStartRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.start)}),!0),this.selectionEndRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.end)}),!0)}willUnmount(){super.willUnmount(),this.observer&&this.observer.disconnect()}didMount(){super.didMount(),this.rowsWrapEl&&(this.observer=new MutationObserver(this.handleRowsObserverChange),this.observer.observe(this.rowsWrapEl,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.navigate({environment:this.environment,url:e})}renderComponent(){const e=this.props.render({onPropertyTab:this.handlePropertyTab,onPropertyUntab:this.handlePropertyUntab,onPropertyEnter:this.handlePropertyEnter,onPropertyClick:this.handlePropertyClick,onPropertyEsc:this.handlePropertyEsc,onPropertyBgClick:this.handlePropertyBgClick,onPropertyContextMenu:this.handlePropertyContextMenu,onOpenProperty:this.handlePropertyOpenProperty,onSelectableEnter:this.handleRowSelectableEnter});return s()(Ut.Z,{capture:void 0!==this.normalizedTableSelectionStore.state,onLeft:this.handleLeft,onRight:this.handleRight,onUp:this.handleUp,onDown:this.handleDown,onEnter:this.handleEnter,onTab:this.handleTab,onUntab:this.handleUntab,onEsc:this.handleEsc,onDelete:this.handleDelete,onBackspace:this.handleDelete,onCut:this.handleCut,onCopy:this.handleCopy,onPaste:this.handlePaste,onCommandEnter:this.handleCommandEnter,onShiftEnter:this.handleShiftEnter,onCommandShiftEnter:this.handleCommandShiftEnter,onDuplicate:this.handleDuplicate,onKeypress:this.handleKeypress,onMoveTo:this.handleMoveTo},void 0,s()(Gi.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,render:t=>d.createElement("div",r()({style:{position:"relative",minWidth:this.props.minWidth}},t,{ref:this.handleRowsWrapMount}),e,this.renderOverlay())}))}renderOverlay(){const e=this.normalizedTableSelectionStore.state,t=this.selectionStartRectStore.state,o=this.selectionEndRectStore.state,i=this.stores.dragAndFillStore.get(),{store:n,schema:r,currentRowsStore:a,showPropertyFormatsStore:l}=this.props;if(e&&t&&o){const c=Math.min(t.left,o.left),d=Math.min(t.top,o.top),p=Math.max(t.right,o.right),u=Math.max(t.top+t.height,o.top+o.height);return s()("div",{style:{position:"absolute",top:0,left:0,pointerEvents:i?"auto":"none",cursor:i?"ns-resize":void 0}},void 0,s()("div",{style:{position:"absolute",left:c,top:d,width:p-c,height:u-d,background:Eo.ZP.blueWithAlpha(.07)}}),s()("div",{style:{position:"absolute",left:t.left,top:t.top,width:t.width,height:t.height,boxShadow:this.theme.outlineBlueInputBoxShadow,borderRadius:3,padding:4,zIndex:T.xP}}),this.isDragAndFillEnabled()&&(e.start.col===e.end.col&&e.start.row===e.end.row||this.stores.dragAndFillStore.state)&&s()(Ia,{store:n,schema:r,selection:e,dragAndFillStore:this.stores.dragAndFillStore,currentRowsStore:a,showPropertyFormatsStore:l,selectionStartRectStore:this.selectionStartRectStore,rowsWrapRect:this.getRowsWrapRect()}))}}dragAndFillCells(){var e;const t=this.stores.dragAndFillStore.get();if(!t)return;const{start:o,end:i}=t;if(o.col!==i.col||o.row!==i.row)return;const{showPropertyFormatsStore:n,schema:r,collectionContextStore:a}=this.props,s=null===(e=r[n.state[o.col].property])||void 0===e?void 0:e.type;if("verification"===s)return;const l=this.normalizedTableSelectionStore.state;if(!l)return;W.createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:l,start:o})}});const c=Math.min(l.start.row,l.end.row),d=Math.max(l.start.row,l.end.row);s&&d!==c&&E.qm({environment:this.environment,collectionContextStore:a,property_type:s,num_rows:d-c}),this.stores.dragAndFillStore.reset()}shouldMoveSelectionToNextRow(){if(!(0,ka.zq)(this.environment))return!0;const e=this.props.blockPropertyValueOverlayStore.state;return!e.isOpen||0===e.additionalStores.length}isDragAndFillEnabled(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state;return!(e||!o.canEditContent)&&"on"===ye.default.getEligibleGroup({experimentId:"collection_table_drag_and_fill",defaultGroup:"control"})}setSelection(e){const t=this.props.collectionContextStore.collectionViewBlockStore();t&&Hr.Z5({environment:this.environment,selectionKey:{collectionViewBlockStore:t,groupFormat:this.props.groupFormat},selection:e})}getRowsWrapRect(){return this.rowsWrapEl?this.rowsWrapEl.getBoundingClientRect():void 0}getRowRect(e){const{rowsWrapEl:t}=this;if(!t)return;const o=zi.C.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}getCellPosition(e,t){const o=this.getRowsWrapRect();if(!o)return{col:0,row:0};const{currentRowsStore:i,showPropertyFormatsStore:n}=this.props,r=i.state,a=n.state,s=e-o.left,l=t-o.top;let c=0,d=0;for(let m=0;m<r.length;m++){const e=r[m],t=this.getRowRect(e);if(!t)return{col:0,row:0};if(d>=l)break;c=m,d+=t.height}c=Math.max(c,0),c=Math.min(c,r.length-1);let p=0,u=this.getXForFirstCellInRow();for(let m=0;m<a.length;m++){const e=a[m];if(u>=s)break;p=m,e.width&&(u+=e.width)}return p=Math.max(p,0),p=Math.min(p,a.length-1),{col:p,row:c}}isInBottomRightCornerOfCell(e,t,o){const i=this.getRowsWrapRect();if(!i)return!1;const{currentRowsStore:n,showPropertyFormatsStore:r}=this.props,a=n.state,s=r.state,l=e-i.left,c=t-i.top;let d=0;for(let g=0;g<=o.row;g++){const e=a[g],t=this.getRowRect(e);if(!t)return!1;d+=t.height}const p=Math.abs(d-c)<Ta;let u=this.getXForFirstCellInRow();for(let g=0;g<=o.col;g++){const e=s[g];e.width&&(u+=e.width)}const m=Math.abs(u-l);return p&&m<Ta}getCurrentColumnCount(){return this.props.showPropertyFormatsStore.state.length}getCellPositionOfStore(e,t){const o=this.props.currentRowsStore.state;return{col:this.props.showPropertyFormatsStore.state.findIndex((e=>e.property===t)),row:o.findIndex((t=>e===t))}}updateSelectionScroll(e){const t=this.normalizedTableSelectionStore.state;if(t){let o;o=e===fa.Down?t.start.row>t.end.row?t.start:t.end:e===fa.Up?t.start.row<t.end.row?t.start:t.end:e===fa.Right?t.start.col>t.end.row?t.start:t.end:t.start.col<t.end.row?t.start:t.end;const i=this.props.currentRowsStore.state[o.row],n=this.props.showPropertyFormatsStore.state[o.col].property,r=na.Z.findBlockPropertyValue(i,n),a=(null==r?void 0:r.getNode())??null;a&&O.bx({element:a,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:this.props.disableHorizontalEdgeScroll?void 0:{reveal:"closest"},scrollers:{verticalScroller:null==r?void 0:r.getContextVerticalScroller(),horizontalScroller:null==r?void 0:r.getContextHorizontalScroller()}})}}copyValuesToSelectionFromStart(e){const{transaction:t,selection:o,start:i}=e,{currentRowsStore:n,showPropertyFormatsStore:r}=this.props,a=n.state,s=r.state[i.col],l=a[i.row].getPropertyValue(s.property)||[],c=Math.min(o.start.row,o.end.row),d=Math.max(o.start.row,o.end.row);a.slice(c,d+1).forEach((e=>{e.pointer!==a[i.row].pointer&&yt.sO({store:e.getPropertyStore(s.property),value:l,transaction:t})}))}getXForFirstCellInRow(){const{collectionContextStore:e}=this.props;return(0,ee.fk)({environment:this.environment,collectionContextStore:e})?ho.Xx:0}getCellRect(e){const{rowsWrapEl:t}=this;if(!t)return;const{showPropertyFormatsStore:o,currentRowsStore:i}=this.props,n=o.state,r=i.state[e.row],a=this.getRowRect(r);if(!a)return;const s=t.getBoundingClientRect(),l=a.height,c=a.top-s.top-1,d=n[e.col].width||0,p=l+1;let u=this.getXForFirstCellInRow();for(let m=0;m<e.col;m++){const e=n[m];e.width&&(u+=e.width)}return new DOMRect(u-1,c,d+1,p)}}Ma.displayName="TableSelectionOverlay",Ma.contextTypes={...K.wK,...u.w};const Ta=10;function Ia(e){var t;window.__c={n:"DragAndFillHandle"};const{store:o,schema:i,selection:n,dragAndFillStore:a,currentRowsStore:l,showPropertyFormatsStore:c,selectionStartRectStore:p,rowsWrapRect:u}=e,m=(0,lo.VK)((()=>a.get()),[a]),g=(0,lo.VK)((()=>{const e=(null==m?void 0:m.start)||n.start;return c.state[e.col]}),[m,n,c]),h=(0,I.useIntl)(),f=(0,lo.VK)((()=>{if(!m||!g)return[];const{start:e}=m,t=l.state[e.row].getModel();return t?(0,ya.v4)({property:g.property,schema:i,block:t,getRecordValue:o.getRecordValue,userTimeZone:(0,ze.r)(),baseURL:void 0,intl:h}):""}),[l,m,h,g,i,o]),v=g?null===(t=i[g.property])||void 0===t?void 0:t.type:void 0,y=(0,lo.VK)((()=>p.state),[p]),b=(0,co.yK)((e=>({tooltipOrigin:{position:"absolute",left:y?y.left+y.width-Ta:void 0,top:y?y.top+y.height-Ta:void 0,width:Ta,height:1.5*Ta,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:y?y.left+y.width-5:void 0,top:y?y.top+y.height-5:void 0,width:9,height:9,border:`2px solid ${Eo.ZP.blueWithAlpha(.57)}`,transform:m?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",zIndex:T.xP},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...M.Z.textOverflowStyle}})),[m,y]);if(!y)return null;if(!v||mt.ZY(v)||"rollup"===v||"formula"===v||"verification"===v)return null;const S=u?new DOMRect(y.x+u.x+y.width-4,y.y+u.y+y.height-4,7,7):void 0;return s()(it.Z,{renderTooltip:()=>{const e=s()(I.FormattedMessage,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value",description:"Tooltip label when dragging a cell value across multiple cells."});return m?s()("div",{style:{display:"flex",flexDirection:"column"}},void 0,e,s()("div",{style:b.tooltipText},void 0,f)):e},delayThreshold:300,forceVisibleState:!!m||void 0,originRect:S,placement:Ca.u.Right,render:e=>d.createElement(d.Fragment,null,d.createElement("div",r()({},e,{style:b.tooltipOrigin})),s()("div",{style:b.tooltipCircle}))})}const Pa=Ma;class xa extends Ee.Z{constructor(){super(...arguments),this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,go.A7)(e,t)})),this.onItemShiftEnter=e=>{const{collectionContextStore:t,blockPropertyValueOverlayStore:o}=this.props,i=t.collectionStore();if(!i||!t.shouldAllowNewItemCreation())return;const n=_t.default.state.stores[0];if(!n)return;const r=t.subitemTreeStore.state,a=(0,mo.DY)(r.children,(e=>e.value.store===n));if(!a)return;const s=a?(0,go.Af)(a.map((e=>e.value.store))):"",l=t.subitemExpandedStore.get().get(s);Boolean(null==l?void 0:l.isExpanded)&&W.createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:this.environment,perform:r=>{const s=R.yk({environment:this.environment,collectionContextStore:t,groupsPointer:e.groupsPointer,results:e.resultsStore.state,store:n,before:!1,collectionStore:i,transaction:r,subitemPath:a,subitemInsertDirection:"into"});s&&o&&m.default.afterNextFlush((()=>{m.default.afterNextFlush((()=>{vt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:o,store:s,property:"title",format:Nt.C.Table,collectionContextStore:t})}))}))}})},this.handleAddRowClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,{device:i}=this.environment,n=o?[o]:[],r=e.groupsStore.getGroupState(n);if(!Ne.M_(this.environment)||!r)return;e.searchQuery.get()&&F.Ug({searchQuery:"",collectionContextStore:e,isFullScreen:t});const a=r.resultsStore.state;W.createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:this.environment,perform:t=>{const{coercionSucceeded:n,newStore:s}=R.IW({environment:this.environment,collectionContextStore:e,groupsPointer:o?[o]:[],results:a,insertAtIndex:a.length,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"table_group_results"});if(i.isMobile){const e=(0,oe.ZP)({store:s,fullyQualified:!1});this.navigate(e)}else{m.default.afterNextFlush((()=>{m.default.afterNextFlush((()=>{m.default.afterNextFlush((()=>{n?vt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:s,property:"title",format:Nt.C.Table,collectionContextStore:this.props.collectionContextStore}):N.peekBlock({environment:this.environment,store:s,peekMode:ee.kr(e.collectionViewStore()),resultsStore:r.resultsStore,collectionContextStore:e})}))}))}));const t=e.subitemTreeStore.state;P.trackCreateBlock(this.environment,{from:t.children?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",...(0,J.Pn)(e)})}}})},this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,i=t.groupsStore.getGroupState(o);if(!i)return;const n=i.reducerResultStore.state;(0,ie.Wi)(e),H.ZH(this.environment),n&&t.groupsStore.incrementLimit({isFullScreen:this.props.isFullScreen,currentResultCount:n.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}),P.trackInlineCollectionLoadMoreClick(this.environment)},this.groupStateStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=t?[t]:[];return e.groupsStore.getGroupState(o)})),this.showPropertyFormatsStore=this.createComputedStore((()=>this.getTableProperties().filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return this.showPropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0)+(e.permissionScopes.getState().canEditContent?32:0)})),this.getItemSelectableStyle=e=>({display:"flex",height:"calc(100% + 2px)",transform:"translateY(1px)",borderBottom:`1px solid ${e?"transparent":this.theme.tableDividerColor}`})}renderComponent(){const{collectionContextStore:e,isFullScreen:t}=this.props,o=this.groupStateStore.state;if(!o)return;const i=o.reducerResultStore.state,n=void 0!==i,r=ee.VM({collectionContextStore:e,reducerResult:i,isFullScreen:t});return d.createElement(d.Fragment,null,this.renderHeaderRow(o),s()("div",{style:{height:Za}}),this.renderRows(o),n&&0===(null==i?void 0:i.blockIds.length)&&this.renderEmptyTablePlaceholder(),s()("div",{style:{width:this.tableWidthStore.state}}),r&&this.renderLoadMoreButton(),this.shouldShowAddRowButton()&&this.renderAddRowButton(),this.renderAggregationRow(),s()("div",{style:{height:Ra}}))}renderHeaderRow(e){const{store:t,schema:o,query:i,disabled:n,collectionContextStore:r,minWidth:a,paddingBottom:l,isInPeekRenderer:c,blockPropertyValueOverlayStore:d,groupFormat:p}=this.props,u=r.viewIsFlushToTopbar(),m=r.permissionScopes.state,g=Boolean(p),h=u&&!g,f=Boolean(r.normalizedFormatStore.state.hide_table_vertical_lines);return s()(ua,{store:t,format:this.getCurrentFormat(),groupFormat:p,schema:o,query:i,collectionContextStore:r,isInPeekRenderer:c,minWidth:a,paddingBottom:l,blockPropertyValueOverlayStore:d,resultStore:e.reducerResultStore,showPropertyFormatsStore:this.showPropertyFormatsStore,showRightActions:m.canConfigureCollection&&m.canConfigureBlock,allowHidingTitle:!1,tableStore:this.props.tableStore,formatKey:"table_properties",disabled:n||!m.canConfigureCollection&&!m.canConfigureBlock,disableTopBorder:!h,disableCellRightBorder:!h||f,height:Za})}renderRows(e){const{device:t}=this.environment,{store:o,schema:i,query:n,disabled:r,collectionContextStore:a,minWidth:l,blockPropertyValueOverlayStore:c,groupFormat:d}=this.props,p=a.collectionViewStore();if(!p)return;const u=d?[d]:[],g=this.showPropertyFormatsStore.state,h=a.permissionScopes.state,f=this.canEditTable()&&t.isMobile&&!p.isSyncedCollection(),v=Boolean(a.normalizedFormatStore.state.hide_table_vertical_lines);return s()(Pa,{store:o,format:this.getCurrentFormat(),schema:i,query:n,collectionContextStore:a,minWidth:l,blockPropertyValueOverlayStore:c,showPropertyFormatsStore:this.showPropertyFormatsStore,currentRowsStore:this.allRowsStore,disabled:!this.canEditTable(),groupFormat:d,render:t=>s()(To,{collectionContextStore:a,groupsPointer:u,format:this.getCurrentFormat(),canDrag:f,resultProps:{schema:i,collectionContextStore:a,propertyFormats:g,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:r,blockPropertyValueOverlayStore:c,showRightActionsSpacer:h.canConfigureCollection,disableCellBorderRight:v,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:!1,disableTableWrap:!1,onShiftEnter:()=>this.onItemShiftEnter(e)},canDrop:!0,resultComponent:ha,disabled:r,direction:_o.Vertical,getItemSelectableStyle:this.getItemSelectableStyle,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:t.onSelectableEnter,blockPropertyValueOverlayStore:c,nestedCreateSubitemButton:e=>{const{store:t,parentStore:o,subitemPath:i,indentLevel:n}=e;if(o)return s()(fn,{store:t,collectionStore:o,subitemPath:i,indentLevel:n,collectionContextStore:a,disabled:r,groupsPointer:u,onSubitemCreate:e=>{c&&m.default.afterNextFlush((()=>{m.default.afterNextFlush((()=>{vt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:c,store:e,property:"title",format:Nt.C.Table,collectionContextStore:a})}))}))}})}})})}renderLoadMoreButton(){const{collectionContextStore:e,format:t}=this.props;return s()(Ot.Z,{onMouseDown:ie.$0,onClick:this.handleLoadMoreClick,style:{display:"flex",alignItems:"center",height:Ea+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:M.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"}},void 0,b.Z.arrowDown(this.getNewRowButtonIconStyle()),s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})),this.canEditTable()&&s()(no,{collectionContextStore:e,format:t}))}renderAggregationRow(){const{store:e,schema:t,query:o,disabled:i,collectionContextStore:n,showHoverActionsStore:r,minWidth:a,paddingBottom:l,isInPeekRenderer:c,blockPropertyValueOverlayStore:d,isFullScreen:p,groupFormat:u}=this.props,m=n.permissionScopes.state;return s()(Er,{store:e,groupFormat:u,disabled:i||!m.canConfigureBlock,format:this.getCurrentFormat(),schema:t,query:o,collectionContextStore:n,isInPeekRenderer:c,isFullScreen:p,minWidth:a,paddingBottom:l,blockPropertyValueOverlayStore:d,showPropertyFormatsStore:this.showPropertyFormatsStore,showRightActionsSpacer:m.canConfigureCollection,showHoverActionsStore:r,style:{...!this.isReady()&&{opacity:0,pointerEvents:"none",left:0,right:0}}})}renderEmptyTablePlaceholder(){const{collectionContextStore:e}=this.props,t=Boolean(e.currentCombinatorFilterStore.state||e.currentPropertyFiltersStore.state.length>0);return s()(Ot.Z,{onClick:this.handleAddRowClick,onMouseDown:ie.$0,disabled:!this.shouldShowAddRowButton(),style:{display:"flex",alignItems:"center",height:Ea+1,width:"100%",paddingLeft:8,fontSize:14,lineHeight:M.Z.lineHeight.UIRegular.desktop,background:this.theme.contentBackground,left:0,right:0,textAlign:"center",borderBottom:"1px solid transparent"}},void 0,this.shouldShowAddRowButton()?s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,t?{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters",description:"Prompt users to add a row if no filter results."}:{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder",description:"Prompt users to add a row if database is empty."})):s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,t?{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters",description:"Inform users that there are no filter results."}:{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder",description:"Inform users that database is empty."})))}renderAddRowButton(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,i=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground);return s()(Ot.Z,{onClick:this.handleAddRowClick,onMouseDown:ie.$0,style:{display:"flex",alignItems:"center",height:Ea,width:"100%",paddingLeft:8,fontSize:14,lineHeight:M.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${this.theme.tableDividerColor}`,background:i,left:0,right:0},className:X.tfM},void 0,b.Z.plus(this.getNewRowButtonIconStyle()),s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,{defaultMessage:"New",id:"database.tableView.addRowButton"})))}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.props.tableStore.state;return t||e}getTableProperties(){const e=this.getCurrentFormat();return e&&e.table_properties?e.table_properties:[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.navigate({environment:this.environment,url:e})}shouldShowAddRowButton(){const{collectionContextStore:e}=this.props;return Boolean(this.isReady()&&this.canEditTable()&&e.shouldAllowNewItemCreation())}isReady(){var e;return void 0!==(null===(e=this.groupStateStore.state)||void 0===e?void 0:e.reducerResultStore.state)}canEditTable(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state;return!!this.canEdit()&&(!t.isSyncedCollection&&t.canEditContent)}getNewRowButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}}xa.contextTypes={...K.wK,...u.w},xa.addColumnStyle={display:"flex",justifyContent:"flex-start",flexGrow:1,width:32};const Ba=(0,I.injectIntl)(xa),Za=34,Ea=32,Ra=32;class Aa extends Ee.Z{constructor(){super(...arguments),this.storeTypes={tableStore:Jn},this.renderGroupHeader=e=>d.createElement(bi,r()({},e,{height:42,paddingTop:8,toggleClosedMarginBottom:8,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle})),this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,i=t.isLoading.get(),n=t.groupsStore.getGroupState([]),r=null==n?void 0:n.reducerResultStore.state;e<ge.Z.incrementScrollOffset&&r&&!i&&r.hasMore&&t.groupsStore.incrementLimit({isFullScreen:o,currentResultCount:r.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)N.navigateToBlock({environment:this.environment,store:e});else{const{collectionContextStore:t}=this.props,{groupFormat:i}=o,n=i?[i]:[],r=t.groupsStore.getGroupState(n);N.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t})}},this.viewSettingsSidebarOpen=this.createComputedStore((()=>{var e;return this.props.collectionContextStore.settingsStore.get().open&&"sidebar"===(null===(e=this.props.viewSettingsPlacementStore)||void 0===e?void 0:e.get())})),this.getGroupStyle=e=>{const{collectionContextStore:t}=this.props,o=t.viewIsFlushToTopbar();return 0!==e.index||o?{borderTop:`1px solid ${this.theme.tableDividerColor}`}:{}},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}`:void 0})}renderPersisted(){const{store:e,paddingBottom:t,paddingLeft:o,paddingRight:i,isFullScreen:n,collectionContextStore:a,format:l}=this.props,c=ee.az(a,n),p=l.collection_group_by;return(0,Le.Z)((l=>{const u=d.createElement(yo.Z,r()({store:e,shouldShowHalo:!n,canSelect:!n,analyticsName:"table",style:{position:"relative"}},l),p?this.renderGroups(p):this.renderGroupResults(void 0));return s()("div",{style:{...Aa.style,paddingBottom:t,paddingLeft:o,paddingRight:i+(this.viewSettingsSidebarOpen.state?Yn.nJ+20:0)},className:X._so},void 0,p?u:s()(Mi,{renderEmitter:a.renderEmitter,isFullScreen:n},void 0,u),!c&&s()(Io.Z,{onChange:this.handleScrollOffsetChange}))}))}renderGroups(e){const{store:t,format:o,collectionContextStore:i,schema:n,disabled:r,isFullScreen:a,paddingLeft:l,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(Ri,{store:t,id:"table_groups",groupBy:e,groupsFormatKey:Re.Uh,groupAggregationKey:Re.dQ,format:o,schema:n,collectionContextStore:i,disabled:r,isFullScreen:a,renderGroup:e=>this.renderGroupResults(e),renderHeader:this.renderGroupHeader,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,stickyLeftHeader:!this.environment.device.isMobile,paddingLeft:l,getGroupStyle:this.getGroupStyle,isRootChild:c,isInPeekRenderer:d})}renderGroupResults(e){const{store:t,format:o,schema:i,query:n,collectionContextStore:r,showHoverActionsStore:a,isFullScreen:l,isInPeekRenderer:c,disabled:d,blockPropertyValueOverlayStore:p,minWidth:u,paddingBottom:m}=this.props;if(r.groupsStore.getGroupState(e?[e]:[]))return s()(Ba,{tableStore:this.stores.tableStore,groupFormat:e,store:t,format:o,schema:i,query:n,collectionContextStore:r,showHoverActionsStore:a,isFullScreen:l,isInPeekRenderer:c,disabled:d,blockPropertyValueOverlayStore:p,minWidth:u,paddingBottom:m})}}Aa.style={position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums"};const Da=(0,I.injectIntl)(Aa);class Fa extends u.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()}}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){return s()("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"}},void 0,this.renderWeekendIndicators(),this.renderVerticalDividers(),this.renderNowVerticalDivider())}renderWeekendIndicators(){const{timelineState:e}=this.props,t=e.zoomLevel.get(),{showWeekendIndicators:o}=Q.BJ[t];if(!o)return;const{startTimestamp:i,endTimestamp:n}=e.currentRange.get();let r=(0,Q.DS)(Yi.ou.fromMillis(i),"day");const a=[];for(;r.valueOf()<n;){6===r.weekday&&a.push(this.renderWeekendIndicator(r));r=(0,Q.Ip)(r,"day")}return a}renderWeekendIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.get(),{startTimestamp:i}=t.currentRange.get(),n=e.plus({day:2}).startOf("day"),r=(0,Q.e$)(o,e.valueOf()-i),a=(0,Q.e$)(o,n.valueOf()-i);return s()("div",{style:{position:"absolute",left:r,width:a-r,height:"100%",background:this.theme.timelineDarkerBackground}},e.valueOf())}renderVerticalDividers(){const{timelineState:e}=this.props,t=e.zoomLevel.get(),{verticalDividerUnit:o}=Q.BJ[t];if(!o)return;const{startTimestamp:i,endTimestamp:n}=e.currentRange.get(),r=[];let a=(0,Q.DS)(Yi.ou.fromMillis(i),o);for(;a.valueOf()<n;){r.push(this.renderVerticalDivider(a.valueOf()));a=(0,Q.Ip)(a,o)}return r}renderVerticalDivider(e){const{timelineState:t}=this.props,o=t.zoomLevel.get(),{startTimestamp:i}=t.currentRange.get(),n=(0,Q.e$)(o,e-i);return s()("div",{style:{position:"absolute",left:n,height:"100%",borderRight:`1px solid ${this.theme.regularDividerColor}`}},e)}renderNowVerticalDivider(){const{timelineState:e}=this.props,t=e.zoomLevel.get(),{startTimestamp:o}=e.currentRange.get(),i=Yi.ou.now().startOf("minute"),n=Math.floor((0,Q.e$)(t,i.valueOf()-o));return s()("div",{style:{position:"absolute",left:n,height:"100%",borderRight:`1px solid ${this.theme.timelineRed}`}})}}Fa.displayName="TimelineBackground";const La=Fa;class Va extends u.Z{constructor(){super(...arguments),this.handleRemove=e=>{const{store:t,collectionContextStore:o}=this.props,{transaction:i}=e;o.collectionStore()&&R.Od({store:t,transaction:i})},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:i}=e,{store:n,collectionContextStore:r,collectionStore:a,resultsStore:s,groupFormat:l}=this.props,c=r.subitemTreeStore.state,d=(0,mo.DY)(c.children,(e=>e.value.store===n));J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:r,is_native_drop:!1,is_empty:!1})})),W.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:this.environment,perform:e=>{R.by({environment:this.environment,collectionStore:a,targetStore:n,droppedDirection:t,collectionContextStore:r,groupsPointer:l?[l]:[],droppedStores:o,results:s.state,duplicate:i,transaction:e,subitemPath:d})}})},this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e,{store:i,collectionContextStore:n,collectionStore:r,resultsStore:a,groupFormat:s}=this.props;return R.$T({environment:this.environment,collectionStore:r,collectionContextStore:n,groupsPointer:s?[s]:[],results:a.state,insertStores:t,store:i,before:!1,transaction:o})},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e,{store:i,collectionContextStore:n,collectionStore:r,resultsStore:a,groupFormat:s}=this.props;return R.$T({environment:this.environment,collectionStore:r,collectionContextStore:n,groupsPointer:s?[s]:[],results:a.state,insertStores:t,store:i,before:!0,transaction:o})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:i,collectionStore:n,resultsStore:r,groupFormat:a}=this.props,s=i.collectionViewBlockStore();J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:i,is_native_drop:!0,is_empty:!1})})),s&&W.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:this.environment,perform:e=>{R.tQ({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:o,collectionContextStore:i,groupsPointer:a?[a]:[],files:t,results:r.state,transaction:e})}})}}renderComponent(){const{store:e}=this.props;return s()(yo.Z,{store:e,style:{width:"100%",height:Qn.Zv+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,onRemove:this.handleRemove,analyticsName:"timeline"},e.id)}}Va.displayName="CollectionTimelineViewDroppableRow";const Na=Va;class Oa extends u.Z{constructor(){super(...arguments),this.instanceStore=void 0,this.renderRowDropzoneSelectable=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,i=t.collectionStore();if(!i)return;const n=t.groupsStore.getGroupState(o);return n?s()(Na,{store:e,groupFormat:o,collectionStore:i,collectionContextStore:t,resultsStore:n.resultsStore,isLast:!1,handleOpenPeekPage:()=>{}},e.id):void 0},this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:i}=e,{groupFormat:n,collectionContextStore:r}=this.props,a=r.collectionStore();if(!a)return;const s=r.groupsStore.getGroupState(n);if(!s)return;const l=r.collectionViewBlockStore();J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:r,is_native_drop:!1,is_empty:!0})})),l&&W.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{R.by({environment:this.environment,collectionStore:a,targetStore:l,droppedDirection:t,collectionContextStore:r,groupsPointer:s.groupsPointer,droppedStores:o,results:s.resultsStore.state,duplicate:i,transaction:e})}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:i,groupFormat:n}=this.props,r=i.collectionStore();if(!r)return;const a=i.groupsStore.getGroupState(n);if(!a)return;const s=i.collectionViewBlockStore();J.tN("collections.drop_item_lag")&&m.default.measureFlush((e=>{E.ou({environment:this.environment,time:e,collectionContextStore:i,is_native_drop:!0,is_empty:!0})})),s&&W.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{R.tQ({environment:this.environment,collectionStore:r,targetStore:s,droppedDirection:o,collectionContextStore:i,groupsPointer:n?[n]:[],files:t,results:a.resultsStore.state,transaction:e})}})}}willMount(e){super.willMount(e),this.instanceStore=new Pe.G(this.environment,e.store.pointer)}renderComponent(){const{device:e}=this.environment,{groupFormat:t,canEdit:o,disabled:i,format:n,collectionContextStore:r}=this.props,a=r.groupsStore.getGroupState(t);if(!a)return;const l=r.permissionScopes.state,c=r.collectionStore(),p=r.collectionViewStore(),u=o&&l.canEditContent&&!l.isSyncedCollection&&e.isMobile&&!(null!=p&&p.isSyncedCollection());return d.createElement(d.Fragment,null,this.renderEmptyDroppable(),a&&c?s()(To,{collectionContextStore:r,groupsPointer:t?[t]:[],format:n,canDrag:u,disableRequest:!0,resultProps:{groupFormat:t,collectionStore:c,collectionContextStore:r,resultsStore:a.resultsStore,isLast:!1,handleOpenPeekPage:()=>{}},canDrop:!0,resultComponent:Na,disabled:i,direction:_o.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:e=>s()("div",{style:{width:"100%",height:Qn.Zv+1}})}):a.resultsStore.state.map(this.renderRowDropzoneSelectable))}renderEmptyDroppable(){if(this.instanceStore){const{canEdit:e}=this.props;return s()(yo.Z,{store:this.instanceStore,shouldShowDropZone:e,canDropBelow:e,canNativeDropBelow:e,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:"timeline",style:{width:"100%"}})}}}Oa.displayName="TimelineDropzoneSelectableGroupResults";const Ua=Oa;var Ha=o(42239);function za(e){window.__c={n:"TimelineItemDependencyDrawHandle"};const{store:t,schema:o,timelineState:i,dateValueStore:n,collectionContextStore:a,isFullScreen:l,isRootChild:c}=e,p=(0,d.useRef)(null),[u,m]=(0,d.useState)(!1),g=(0,so.O7)(),h=(0,lo.VK)((()=>{const e=i.drawState.get();if(e)return e.startStore===t}),[t,i.drawState]),f=(0,lo.VK)((()=>!h&&i.hoveredItem.get()===t&&!Se.Z.state),[h,t,i.hoveredItem]),v=(0,lo.VK)((()=>(0,Q.H5)(a)),[a]),y=(0,d.useCallback)((e=>{if(e.preventDefault(),!i.scrollLeft.state||!p.current)return;const n=(0,se.VW)(p.current);Xn.J4({timelineState:i,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:a,verticalScroller:n}),m(!1)}),[a,o,t,i]),b=(0,d.useCallback)((e=>{if(!p.current)return;const t=(0,se.VW)(p.current);Xn.mz({timelineState:i,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[i]),S=(0,d.useCallback)((()=>{W.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:g,perform:e=>{Xn.$o({timelineState:i,environment:g,transaction:e,collectionContextStore:a,isFullScreen:l,isRootChild:c})}})}),[g,i,a,l,c]),w=(0,d.useCallback)((e=>{Xn.x({timelineState:i,environment:g})}),[g,i]),k=(0,d.useCallback)((()=>{m(!0)}),[m]),C=(0,d.useCallback)((()=>{m(!1)}),[m]),_=(0,co.yK)((e=>({draggableStyle:{position:"absolute",top:0,right:-24,width:24,height:"100%",zIndex:1},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:v?e.accentColors.yellow[300]:e.accentColors.gray[300],strokeWidth:Q.lf}})),[v]),M=(0,d.useCallback)((e=>{if(!n.state)return;return d.createElement("div",r()({ref:p,style:_.draggableStyle},e),f&&d.createElement(d.Fragment,null,s()("div",{style:_.draggableSvgStyle},void 0,s()("svg",{style:{width:22,height:30},onMouseMove:k,onMouseLeave:C},void 0,s()(ar.Z,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},direction:ar.n.right,style:_.svgPathStyle,showArrowHead:u}),s()("circle",{cx:u?10+Q.S7:10,cy:14,r:u?Q.S7:Q.Wk,style:_.svgPathStyle,fill:"#ffffff"})))))}),[n,C,k,f,_,u]);return s()(Gi.Z,{render:M,onDraggableDragStart:y,onDraggableDragMove:b,onDraggableDragEnd:S,onDraggableDragCancel:w})}class Wa extends u.Z{constructor(){super(...arguments),this.storeTypes={hovered:Ze.default.of(!1)},this.renderDraggableInner=e=>{const{type:t,timelineState:o,dateValueStore:i}=this.props,n="left"===t,a=i.state,l=o.zoomLevel.get(),c=this.isActiveStore.state;if(a)return d.createElement("div",r()({style:n?Wa.leftDraggableStyle:Wa.rightDraggableStyle,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},e),c&&d.createElement(d.Fragment,null,s()("div",{style:n?this.getLeftDraggableIndicatorStyle():this.getRightDraggableIndicatorStyle()}),s()("span",{style:n?this.getLeftDraggableLabelStyle():this.getRightDraggableLabelStyle()},void 0,s()("span",{style:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,padding:4,borderRadius:4}},void 0,n?(0,Q.yk)(a,l):(0,Q.fc)(a,l)))))},this.handleLeftResizerDragStart=e=>{e.preventDefault();const{type:t,store:o,timelineState:i,query:n,schema:r,intl:a}=this.props;Xn.f$({timelineState:i,store:o,startX:e.startX,type:"left"===t?Q.px.LeftResizer:Q.px.RightResizer,query:n,schema:r,intl:a,environment:this.environment})},this.handleDraggableDragMove=e=>{const{timelineState:t}=this.props;Xn.td({timelineState:t,currentX:e.currentX})},this.handleDraggableDragEnd=()=>{const{timelineState:e,query:t,schema:o,intl:i,collectionContextStore:n,isFullScreen:r,isRootChild:a,type:s}=this.props;W.createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:this.environment,perform:n=>{Xn.fX({timelineState:e,query:t,schema:o,intl:i,environment:this.environment,transaction:n})}}),P.trackTimelineItemResize(this.environment,{...(0,Q.Ii)({environment:this.environment,collectionContextStore:n,timelineState:e,isFullScreen:r,isRootChild:a}),type:s})},this.handleDraggableDragCancel=e=>{const{timelineState:t}=this.props;Xn.cQ({timelineState:t,environment:this.environment})},this.handleMouseMove=()=>{this.stores.hovered.set(!0)},this.handleMouseLeave=()=>{this.stores.hovered.set(!1)},this.isActiveStore=this.createComputedStore((()=>{const{store:e,type:t,timelineState:o}=this.props,i=this.stores.hovered.get(),n=o.dragState.get();return n?n.stores[0]===e&&("left"===t?n.type===Q.px.LeftResizer:n.type===Q.px.RightResizer):i&&!Se.Z.state}))}renderComponent(){return s()(Gi.Z,{render:this.renderDraggableInner,onDraggableDragStart:this.handleLeftResizerDragStart,onDraggableDragMove:this.handleDraggableDragMove,onDraggableDragEnd:this.handleDraggableDragEnd,onDraggableDragCancel:this.handleDraggableDragCancel})}getLeftDraggableIndicatorStyle(){return{position:"absolute",left:Math.ceil(3.5)+1,top:6,borderRadius:3,width:3,bottom:6,background:this.theme.regularTextColor}}getRightDraggableIndicatorStyle(){return{position:"absolute",left:Math.floor(.5),top:6,borderRadius:3,width:3,bottom:6,background:this.theme.regularTextColor}}getLeftDraggableLabelStyle(){return{fontSize:12,position:"absolute",right:12,textAlign:"right",width:200,lineHeight:`${Qn.Zv}px`,pointerEvents:"none"}}getRightDraggableLabelStyle(){return{fontSize:12,position:"absolute",left:12,width:200,lineHeight:`${Qn.Zv}px`,pointerEvents:"none"}}}Wa.displayName="TimelineItemResizer",Wa.leftDraggableStyle={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},Wa.rightDraggableStyle={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};const ja=Wa,Ka=(0,I.defineMessages)({typeAName:{defaultMessage:"Type a name…",id:"timelineItem.itemName.placeholder"}});var Ya;!function(e){e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky"}(Ya||(Ya={}));class Ga extends u.Z{constructor(){super(...arguments),this.propertiesWrapEl=d.createRef(),this.renderProperty=(e,t)=>{const{showProperties:o,store:i,disabled:n,blockPropertyValueOverlayStore:r,clonedStore:a}=this.props,l=t===o.length-1,c=null==i?void 0:i.getAssociatedCollectionStore();if(c){if("title"===e)return this.renderTitle(l);if(i&&a)return s()(Vt.Z,{store:a,property:e,disabled:n||!i.canEdit(),locked:!1,format:Nt.C.Timeline,tableWrap:!1,isLast:l,blockPropertyValueOverlayStore:r,enablePointerEventsForInteractiveTypes:!0,collectionStore:c,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e)}},this.handleSelectableDragStart=e=>{e.preventDefault()},this.handleSelectableDragMove=e=>{const{store:t,timelineState:o,query:i,schema:n,intl:r}=this.props;t&&(o.dragState.get()||Xn.f$({timelineState:o,store:t,startX:e.startX,type:Q.px.ItemDrag,query:i,schema:n,intl:r,environment:this.environment}),Xn.td({timelineState:o,currentX:e.currentX}))},this.handleSelectableDragEnd=()=>{const{timelineState:e,query:t,schema:o,intl:i}=this.props;W.createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:this.environment,perform:n=>{Xn.fX({timelineState:e,query:t,schema:o,intl:i,environment:this.environment,transaction:n})}})},this.handleSelectableDragCancel=()=>{const{timelineState:e}=this.props;Xn.cQ({timelineState:e,environment:this.environment})},this.handleDateRangeButtonMouseMove=()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.get();(Se.Z.state||o)&&!this.isDrawingDependencyStore.state||this.environment.device.isPhone||t.hoveredItem.set(e)},this.handleDateRangeButtonMouseLeave=()=>{const{timelineState:e}=this.props,t=e.dragState.get();(Se.Z.state||t)&&!this.isDrawingDependencyStore.state||e.hoveredItem.set(void 0)},this.handleGetGhostElement=e=>{const t=zi.C.findSelectablesFromStore(e),o=c().compact(t.map((e=>e.getNode()))),i=c().compact(o.map((e=>e.closest(`.${X.o4s}`))))[0];if(i){const e=Ha.eN(i),t=e.cloned.querySelector(`.${X.ovr}`),o=e.cloned.querySelector(`.${X.z_z}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(Ha.eN)},this.handleTextEnterOrEsc=()=>{const{store:e}=this.props;e&&H.Ys({environment:this.environment,store:e})},this.handleAnimationStateChange=()=>{const{current:e}=this.propertiesWrapEl,t=this.animationStateStore.state;e&&t&&(e.style.position=t.position===Ya.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)},this.pageURLStore=this.createComputedStore((()=>{const{store:e}=this.props;if(e)return(0,oe.ZP)({store:e,fullyQualified:!1})})),this.peekURLStore=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=pe.default.state;if(e&&o)return ee.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.isHoveredStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props;return t.hoveredItem.get()===e})),this.isDrawingDependencyStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.drawState.get();return o&&o.startStore!==e})),this.editingTitleStore=this.createComputedStore((()=>{var e;const{store:t}=this.props,o=Mt.default.state;if("editing"!==o.mode)return!1;const i=null===(e=(0,St.QY)(o.multiSelection))||void 0===e?void 0:e.store;return t&&i&&i===t.getBlockTitleStore()})),this.animationStateStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,itemPositionStore:o}=this.props,i=o.state;if(i){const{left:o,right:n}=i,r=n-o;if(!(this.canPerformantlyUpdateOnScroll()&&r>50))return{position:Ya.Absolute,left:o};{const i=e.scrollLeft.get();if(void 0!==i){const e=i+t-o+21;if(e<0)return{position:Ya.Absolute,left:o};if(e>r)return{position:Ya.Absolute,left:n};if(e>0)return{position:Ya.Sticky,left:t+21}}}}})),this.passesFilterStore=this.createComputedStore((()=>{var e,t;const o=(0,q.m1)({collectionContextStore:this.props.collectionContextStore,environment:this.environment}),i=null===(e=this.props.store)||void 0===e?void 0:e.getModel(),n=null===(t=this.props.store)||void 0===t?void 0:t.getRecordModel;if(!o||!i||!n)return!0;return(0,po.q)(o)({block:i,getRecordModel:n,propertyMapping:void 0})})),this.shouldShowHighlightHalo=this.createComputedStore((()=>!!this.props.store&&ee.Sc(this.props.store)))}didMount(){super.didMount(),this.animationStateStore.addListener(this.handleAnimationStateChange),this.handleAnimationStateChange()}willUnmount(){super.willUnmount(),this.animationStateStore.removeListener(this.handleAnimationStateChange)}willUpdate(){this.animationStateStore.enqueueRecompute()}renderComponent(){const{itemPositionStore:e,store:t,timelineState:o,query:i,schema:n,dateValueStore:r,disabled:a,isDraggingViaTimelineItemStore:l,collectionContextStore:c,isFullScreen:p,isRootChild:u,intl:m}=this.props,g=e.state;if(!g)return;const{left:h,right:f,maskPercent:v}=g,y=this.isHoveredStore.state,b=this.pageURLStore.state,S=this.peekURLStore.state,w=!a&&(null==t?void 0:t.canEdit()),k=this.environment.device.isPhone,C=Math.max(f-h,10)+1,_=l.state,M=this.renderToggleButton(),T=this.passesFilterStore.state;return t&&!g.isPlaceholder?d.createElement(d.Fragment,null,s()(yo.Z,{style:this.getStyle(h,C,_,g,T),haloStyle:this.getHaloStyle(),className:X.ovr,store:t,canSelect:!0,shouldShowHalo:!0,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,canDrag:w,analyticsName:"timeline",onDraggableDragStart:this.handleSelectableDragStart,onDraggableDragMove:this.handleSelectableDragMove,onDraggableDragEnd:this.handleSelectableDragEnd,onDraggableDragCancel:this.handleSelectableDragCancel,canTriggerContextMenu:w,getGhostElement:this.handleGetGhostElement,disableScrollToReveal:!0,onMouseMove:this.handleDateRangeButtonMouseMove,onMouseLeave:this.handleDateRangeButtonMouseLeave,showBlockMenuInput:!0},void 0,M,s()(Ht.Z,{style:this.getLinkBoxStyle(),innerStyle:this.getLinkBoxInnerStyle(),onClick:this.props.handleOpenPeekPage,href:b,metaHref:S,hovered:y,ignoreLocalHoverState:!0}),w&&!k&&this.renderTimelineItemDependencyDrawHandle(),w&&!k&&s()(ja,{type:"left",store:t,query:i,schema:n,timelineState:o,dateValueStore:r,collectionContextStore:c,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:u,intl:m,resultStore:this.props.resultStore}),w&&!k&&s()(ja,{type:"right",store:t,query:i,schema:n,timelineState:o,dateValueStore:r,collectionContextStore:c,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:u,intl:m,resultStore:this.props.resultStore})),this.renderProperties(v,_,T)):d.createElement(d.Fragment,null,s()("div",{style:this.getStyle(h,C,_,g,T),className:X.ovr}),this.renderProperties(v,_,T))}renderToggleButton(){const{collectionContextStore:e,toggleButton:t}=this.props;if(e.currentSubitemFormatStore.state&&t)return s()("span",{style:{zIndex:1,paddingTop:3}},void 0,t)}renderTimelineItemDependencyDrawHandle(){const{store:e,isFullScreen:t,isRootChild:o}=this.props;if(e)return s()(za,{store:e,schema:this.props.schema,timelineState:this.props.timelineState,dateValueStore:this.props.dateValueStore,collectionContextStore:this.props.collectionContextStore,isFullScreen:t,isRootChild:o})}renderProperties(e,t,o){const{showProperties:i}=this.props;return s()("div",{style:this.getPropertiesWrapStyle(e,t,o)},void 0,d.createElement("div",{style:this.getPropertiesWrapInnerStyle(),ref:this.propertiesWrapEl,className:X.z_z},i.map(this.renderProperty)))}renderTitle(e){var t;const{store:o}=this.props,i=o?o.getIcon():void 0,n=null==o?void 0:o.hasError(),r=!o||o.isEmptyPage(),a=this.editingTitleStore.state,{parentStore:l,collectionContextStore:d}=this.props,p=d.currentSubitemFormatStore.state,u=p&&l?null===(t=l.getSchema()[p.property])||void 0===t?void 0:t.name:"";return s()("div",{style:{display:"flex",marginRight:e?0:10,fontSize:14,fontWeight:M.Z.fontWeight.medium,alignItems:"center"}},"title",i&&!n&&s()(zt.Z,{disabled:!0,icon:i,isEmptyPage:r,size:20,style:{marginLeft:2,marginRight:6}}),n&&b.Z.warning({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:this.theme.accentColors.orange[500]}),o&&!a&&s()(Xi.Z,{style:{whiteSpace:"nowrap",maxWidth:400},store:o}),a&&o&&s()(jt.Z,{store:o.getBlockTitleStore(),style:{whiteSpace:this.environment.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnterOrEsc,onEsc:this.handleTextEnterOrEsc,onTab:c().identity,placeholder:ne.default.formatMessage(Ka.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline"}),!o&&s()("span",{},void 0,s()(I.FormattedMessage,l&&u?{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",description:"Button label for inserting a new nested sub-item into database view",values:{propertyName:u}}:{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})))}canPerformantlyUpdateOnScroll(){return(0,Q.Tp)(this.environment)}getStyle(e,t,o,i,n){const r=this.theme.mode;return{position:"absolute",left:e,marginTop:1,marginBottom:1,width:t,height:Qn.Zv-2,borderRadius:4,display:"flex",..."light"===r?{background:i.isPlaceholder?this.theme.buttonHoveredBackground:this.theme.contentBackground,boxShadow:i.isPlaceholder?void 0:this.theme.buttonBoxShadow}:{background:this.props.isInPeekRenderer?this.theme.calendarItemBackground:this.theme.popoverBackground,boxShadow:i.isPlaceholder?void 0:this.theme.lightBoxShadow},...i.isPlaceholder&&{cursor:"crosshair"},...o&&{display:"none"},...!n&&{opacity:.5},zIndex:T.ov}}getPropertiesWrapStyle(e,t,o){return{width:"100%",WebkitMaskImage:e<1&&this.isHoveredStore.state?`linear-gradient(90deg, rgba(0,0,0,1) ${100*e}%, rgba(0,0,0,0.4) ${100*e}%)`:void 0,pointerEvents:"none",...t&&{display:"none"},zIndex:T.ov,opacity:o?1:.5}}getPropertiesWrapInnerStyle(){const{collectionContextStore:e,toggleButton:t}=this.props,o=e.currentSubitemFormatStore.state;return{display:"flex",height:Qn.Zv-2+1,paddingLeft:o&&t?24:6,width:800,overflow:"hidden"}}getHaloStyle(){return{borderRadius:4,...ee.pB(this.shouldShowHighlightHalo.state,this.theme)}}getLinkBoxStyle(){return{width:"100%",height:"100%",borderRadius:4}}getLinkBoxInnerStyle(){return{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:4}}}Ga.displayName="TimelineItemDateRange";const Xa=Ga;var qa;!function(e){e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined"}(qa||(qa={}));class $a extends u.Z{constructor(){super(...arguments),this.lastVisibilityState=qa.NotDefined,this.buttonRef=d.createRef(),this.wrapRef=d.createRef(),this.arrowButtonHovered=new Ze.default(!1),this.handleIsVisibleChange=()=>{const e=this.buttonRef.current,t=this.wrapRef.current;if(e&&t){const o=this.isVisibleStore.state,i=o===qa.VisibleInItem||o===qa.VisibleOutOfItem;e.style.opacity=""+(i?1:0),e.style.transform=`scale(${i?1:.3})`,t.style.pointerEvents=o===qa.VisibleOutOfItem?"":"none";this.lastVisibilityState!==qa.NotDefined&&o!==qa.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),this.lastVisibilityState=o}},this.handleClick=()=>{const{store:e,type:t,timelineState:o,dateValueStore:i,paddingLeft:n,format:r,collectionContextStore:a,isFullScreen:s,isRootChild:l}=this.props,c=i.state,d=o.zoomLevel.get(),{snapUnit:p}=Q.BJ[d],u=(0,Q.x2)(d,200);if(c)if("left"===t){const{start:e}=(0,Q.XO)(c,p),t=(0,Q.GK)({timestamp:e.valueOf(),environment:this.environment,timelineState:o,paddingLeft:n,format:r})-u;Xn.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}else{const{end:e}=(0,Q.XO)(c,p),t=(0,Q.PF)({timestamp:e.valueOf(),timelineState:o})+u;Xn.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}this.arrowButtonHovered.set(!1),H.Ys({environment:this.environment,store:e}),P.trackTimelineItemScrollArrowClick(this.environment,{...(0,Q.Ii)({environment:this.environment,collectionContextStore:a,timelineState:o,isFullScreen:s,isRootChild:l}),type:t})},this.handleMouseOver=()=>{this.environment.device.isPhone||Se.Z.state||this.arrowButtonHovered.set(!0)},this.handleMouseOut=()=>{this.environment.device.isPhone||this.arrowButtonHovered.set(!1)},this.isVisibleStore=this.createComputedStore((()=>{const{type:e,timelineState:t,scrollerLeftOffset:o,itemPositionStore:i,isDraggingViaTimelineItemStore:n}=this.props,r=i.state;if(r){const{left:i,right:a}=r;if(n.state)return qa.Hidden;const s=t.scrollLeft.get();if(void 0!==s){if("left"===e){const e=s+o;if(e-a>0)return qa.VisibleOutOfItem;if(e-i>0)return qa.VisibleInItem}else{const{outerSizeObserver:e}=t,o=s+e.rect.get().width;if(i-o>0)return qa.VisibleOutOfItem;if(a-o>0)return qa.VisibleInItem}return qa.Hidden}}return qa.NotDefined}))}didMount(){super.didMount(),this.isVisibleStore.addListener(this.handleIsVisibleChange),this.handleIsVisibleChange()}willUnmount(){super.willUnmount(),this.isVisibleStore.removeListener(this.handleIsVisibleChange)}willUpdate(){this.isVisibleStore.enqueueRecompute()}renderComponent(){const{type:e}=this.props,t=this.arrowButtonHovered.get(),o="left"===e?b.Z.collectionTimelineArrowLeft:b.Z.collectionTimelineArrowRight;return d.createElement("div",{style:this.getWrapStyle(),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:ie.$0,onClick:this.handleClick,ref:this.wrapRef},d.createElement("div",{style:this.getArrowStyle(),ref:this.buttonRef},o({height:6,fill:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground})),t&&this.renderDateRange())}renderDateRange(){const{dateValueStore:e,timelineState:t}=this.props,o=e.state;if(!o)return;const i=t.zoomLevel.get();return s()("span",{style:this.getDateRangeStyle()},void 0,(0,Q._Q)(o,i))}getWrapStyle(){const{type:e,scrollerLeftOffset:t,timelineState:o}=this.props,{outerSizeObserver:i}=o;return{position:"sticky",left:"left"===e?t:i.rect.get().width-220,width:220,height:Za-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===e?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",zIndex:T.fQ}}getArrowStyle(){const{type:e}=this.props;return{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:this.arrowButtonHovered.get()?this.theme.regularIconColor:this.theme.mediumIconColor,borderRadius:3,border:`1px solid ${this.theme.contentBackground}`,..."left"===e&&{marginLeft:8,marginRight:4},..."right"===e&&{marginRight:8,marginLeft:4}}}getDateRangeStyle(){return{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,pointerEvents:"none"}}}$a.displayName="TimelineScrollArrow";const Ja=$a;class Qa extends u.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.dateRangeRef=d.createRef(),this.storeTypes={node:Ze.default.of(null)},this.handleEditorMouseDown=e=>{this.environment.device.isMobile||(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{e.preventDefault(),V.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleMouseMove=e=>{const{timelineState:t,store:o,groupFormat:i,disabled:n,query:r,schema:a}=this.props,s=t.dragState.get(),l=t.drawState.get(),{horizontalScroller:c}=t,d=t.scrollLeft.get(),p=t.zoomLevel.get(),u=t.currentRange.get(),{snapUnit:m,getDateRangePlaceholderDuration:g}=Q.BJ[p];if(!l&&Se.Z.state||s||this.getPersistedDateValue()||!c||void 0===d||n)return;const h=c.getBoundingClientRect(),f=d+(e.clientX-h.left),v=(0,Q.x2)(p,f),y=Yi.ou.fromMillis(u.startTimestamp+v),b=(0,Q.DS)(y,m),S=(0,Q.DS)(g(y),m),w=(0,Oi.hT)(b.valueOf(),(0,ze.r)()),k=(0,Q.AZ)({startValue:w,snapUnit:m,desiredStart:b,desiredEnd:S});t.dateRangePlaceholder.set({active:!0,store:o,parentStore:this.parentCollectionStore.state,groupFormat:i,date:k,newTimelineItemProps:void 0,existingTimelineItemProps:{query:r,schema:a}})},this.handleMouseLeave=()=>{const{timelineState:e}=this.props;e.dateRangePlaceholder.set({active:!1})},this.handleClick=e=>{const{store:t,query:o,schema:i,timelineState:n,groupFormat:r,collectionContextStore:a}=this.props,s=n.dateRangePlaceholder.get(),l=a.groupsStore.getGroupState(r);if(l)if(s.active){const{date:e}=s;W.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:n=>{Xn.oP({environment:this.environment,store:t,query:o,schema:i,date:e,transaction:n})}}),n.dateRangePlaceholder.set({active:!1})}else{const{timelineState:o,collectionContextStore:i}=this.props,{horizontalScroller:n}=o,r=o.scrollLeft.get(),a=this.itemPositionStore.state,s=this.dateRangeRef.current;if(!n||void 0===r||!a||!s)return;const c=n.getBoundingClientRect(),d=r+(e.clientX-c.left),p=s.propertiesWrapEl.current;if(!p)return;const u=p.lastElementChild;if(!u)return;const m=r+(u.getBoundingClientRect().right-c.left);d>a.right&&d<=m&&(0,ie.ZP)({event,context:ie.Af.EditorClick,callback:()=>{(0,ae.X9)()||N.peekBlock({environment:this.environment,store:t,openInNew:te.DJ(e),peekMode:(0,ee.kr)(i.collectionViewStore()),resultsStore:l.resultsStore,collectionContextStore:i})}})}},this.onRefChange=e=>{this.stores.node.setState(e)},this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props,t=this.dateValueStore.state,o=this.placeholderDateStore.state;if(!t)return;const i=e.zoomLevel.get(),{snapUnit:n}=Q.BJ[i],{startTimestamp:r,endTimestamp:a}=e.currentRange.get(),{start:s,end:l}=(0,Q.XO)(t,n),c=l.valueOf()>r&&s.valueOf()<a,d=(0,Q.e$)(i,s.valueOf()-r)+2,p=Math.max(d,0),u=(0,Q.e$)(i,l.valueOf()-r)-2,m=(0,Q.e$)(i,a-r),g=Math.min(u,m),h=g/(0,Q.e$)(i,a-r);return{visible:c,isPlaceholder:Boolean(o),left:p,right:g,maskPercent:h}})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.shouldRenderScrollArrowsStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e&&!e.isPlaceholder)})),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,timelineState:t,groupFormat:o}=this.props,i=t.dateRangePlaceholder.get();if(i.active&&i.store===e&&!i.newTimelineItemProps&&(0,Re.ZH)(i.groupFormat,o))return i.date})),this.dateValueStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.get(),i=this.placeholderDateStore.state;if(i)return i;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return this.getPersistedDateValue()}),!0),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.get(),i=rr.ZP.state;return Boolean(o&&o.stores.includes(e)&&i.isDragging&&i.draggedStores.includes(e))})),this.parentCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore()))}get registries(){return[ir]}willMount(e){super.willMount(e),this.clonedStore=e.store.clone()}renderComponent(){var e;const{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:n,format:r,query:a,schema:l,blockPropertyValueOverlayStore:c,disabled:p,showProperties:u,showTable:m,collectionContextStore:g,isFullScreen:h,isRootChild:f,toggleButton:v,groupFormat:y}=this.props,b=this.shouldRenderDateRangeStore.state,S=this.shouldRenderScrollArrowsStore.state,w=Boolean(this.placeholderDateStore.state),k=null===(e=g.groupsStore.getGroupState(y))||void 0===e?void 0:e.reducerResultStore;if(k)return d.createElement(d.Fragment,null,s()("div",{style:{display:"flex",height:0}},void 0,S&&s()(Ja,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:n,format:r,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:g,isFullScreen:h,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:f,resultStore:k}),S&&s()(Ja,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:n,format:r,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:g,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:h,isRootChild:f,resultStore:k})),d.createElement("div",{style:this.getStyle(w,m),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick,className:X.o4s,ref:this.onRefChange},b&&d.createElement(Xa,{store:t,parentStore:this.parentCollectionStore.state,toggleButton:v,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:a,schema:l,timelineState:o,blockPropertyValueOverlayStore:c,disabled:p,showProperties:u,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:g,isFullScreen:h,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:f,intl:ne.default.getIntl(),ref:this.dateRangeRef,resultStore:k,handleOpenPeekPage:this.props.handleOpenPeekPage})))}getPersistedDateValue(){const{store:e,query:t,schema:o}=this.props;return(0,Q.bk)({store:e,query:t,schema:o,intl:ne.default.getIntl()})}getStyle(e,t){return{display:"flex",height:Qn.Zv+(e?2:1),width:"100%",...e&&{borderTop:`1px solid ${this.theme.regularDividerColor}`,marginBottom:-1},...e&&!t&&{borderBottom:`1px solid ${this.theme.regularDividerColor}`},cursor:"default"}}}Qa.displayName="CollectionTimelineViewItem";const es=Qa;class ts extends u.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.handleEditorMouseDown=e=>{this.environment.device.isMobile||(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{e.preventDefault(),V.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleMouseMove=e=>{var t;const{timelineState:o,store:i,parentStore:n,groupFormat:r,disabled:a,query:s,schema:l,isFullScreen:c,canEditTimelineItems:d,subitemPath:p,collectionContextStore:u}=this.props,m=o.drawState.get(),g=o.dragState.get(),{horizontalScroller:h}=o,f=o.scrollLeft.get(),v=o.zoomLevel.get(),y=o.currentRange.get(),{snapUnit:b,getDateRangePlaceholderDuration:S}=Q.BJ[v];if(!m&&Se.Z.state||g||!h||void 0===f||a)return;const w=null===(t=u.groupsStore.getGroupState(r))||void 0===t?void 0:t.resultsStore;if(!w)return;const k=h.getBoundingClientRect(),C=f+(e.clientX-k.left),_=(0,Q.x2)(v,C),M=Yi.ou.fromMillis(y.startTimestamp+_),T=(0,Q.DS)(M,b),I=(0,Q.DS)(S(M),b),P=(0,Oi.hT)(T.valueOf(),(0,ze.r)()),x=(0,Q.AZ)({startValue:P,snapUnit:b,desiredStart:T,desiredEnd:I});o.dateRangePlaceholder.set({active:!0,store:i,parentStore:n,groupFormat:r,date:x,newTimelineItemProps:{query:s,schema:l,resultsStore:w,isFullScreen:c,canEditTimelineItems:d,subitemPath:p},existingTimelineItemProps:void 0})},this.handleMouseLeave=()=>{const{timelineState:e}=this.props;e.dateRangePlaceholder.set({active:!1})},this.handleClick=e=>{var t;const{parentStore:o,query:i,schema:n,timelineState:r,isFullScreen:a,groupFormat:s,canEditTimelineItems:l,collectionContextStore:c,subitemPath:d}=this.props,p=r.dateRangePlaceholder.get(),u=null===(t=c.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(u&&p.active){const{date:e}=p,t=d?"timeline_add_parent_item_bottom":"timeline_add_item_bottom";W.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:r=>{Xn.mg({environment:this.environment,transaction:r,date:e,store:this.props.store,parentStore:o,query:i,schema:n,resultsStore:u,isFullScreen:a,groupFormat:s,canEditTimelineItems:l,collectionContextStore:c,subitemPath:d,from:t}),P.trackCreateBlock(this.environment,{from:t,type:"page",...(0,J.Pn)(c)})}}),r.dateRangePlaceholder.set({active:!1})}},this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props,t=this.dateValueStore.state,o=this.placeholderDateStore.state;if(!t)return;const i=e.zoomLevel.get(),{snapUnit:n}=Q.BJ[i],{startTimestamp:r,endTimestamp:a}=e.currentRange.get(),{start:s,end:l}=(0,Q.XO)(t,n),c=l.valueOf()>r&&s.valueOf()<a,d=(0,Q.e$)(i,s.valueOf()-r)+2,p=Math.max(d,0),u=(0,Q.e$)(i,l.valueOf()-r)-2,m=(0,Q.e$)(i,a-r),g=Math.min(u,m),h=g/(0,Q.e$)(i,a-r);return{visible:c,isPlaceholder:Boolean(o),left:p,right:g,maskPercent:h}})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>!1)),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,parentStore:t,timelineState:o,groupFormat:i}=this.props,n=o.dateRangePlaceholder.get();if(n.active&&n.store===e&&n.newTimelineItemProps&&n.parentStore===t&&(0,Re.ZH)(n.groupFormat,i))return n.date})),this.dateValueStore=this.createComputedStore((()=>{const e=this.placeholderDateStore.state;if(e)return e}),!0)}willMount(e){super.willMount(e),e.store&&(this.clonedStore=e.store.clone())}renderComponent(){var e;const{store:t,parentStore:o,timelineState:i,scrollerLeftOffset:n,query:r,schema:a,blockPropertyValueOverlayStore:l,disabled:c,showProperties:p,showTable:u,collectionContextStore:m,isFullScreen:g,isRootChild:h,toggleButton:f,groupFormat:v}=this.props,y=Boolean(this.placeholderDateStore.state),b=this.shouldRenderDateRangeStore.state,S=null===(e=m.groupsStore.getGroupState(v))||void 0===e?void 0:e.reducerResultStore,w=!t&&!b&&m.shouldAllowNewItemCreation();if(S)return d.createElement(d.Fragment,null,s()("div",{style:this.getStyle(y,u),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick,className:X.o4s},void 0,b&&s()(Xa,{store:o?void 0:t,parentStore:o,toggleButton:f,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:r,schema:a,timelineState:i,blockPropertyValueOverlayStore:l,disabled:c,showProperties:p,scrollerLeftOffset:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:m,isFullScreen:g,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:ne.default.getIntl(),resultStore:S,handleOpenPeekPage:()=>{}}),w&&this.renderAddRowIndicator()))}renderAddRowIndicator(){var e;const{parentStore:t,collectionContextStore:o}=this.props,i=o.currentSubitemFormatStore.state,n=i&&t?null===(e=t.getSchema()[i.property])||void 0===e?void 0:e.name:"";return s()("div",{style:this.getAddRowIndicatorWrapStyle()},void 0,s()("div",{style:this.getAddRowIndicatorStyle()},void 0,b.Z.plus(this.getNewRowIndicatorIconStyle()),s()("span",{style:{color:this.theme.mediumTextColor}},void 0,s()(I.FormattedMessage,t&&n?{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",description:"Button label for inserting a new nested sub-item into database view",values:{propertyName:n}}:{defaultMessage:"New",id:"database.timelineView.item.addRowButton"}))))}getStyle(e,t){let o=e?2:1;return this.props.parentStore&&(o=e?1:0),{display:"flex",height:Qn.Zv+o,width:"100%",...e&&{borderTop:`1px solid ${this.theme.regularDividerColor}`,marginBottom:-1},...e&&!t&&{borderBottom:`1px solid ${this.theme.regularDividerColor}`},cursor:"default"}}getNewRowIndicatorIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.mediumIconColor}}getAddRowIndicatorWrapStyle(){const{paddingLeft:e,isFullScreen:t,showTable:o}=this.props;return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}getAddRowIndicatorStyle(){return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:Ea,lineHeight:M.Z.lineHeight.UIRegular.desktop}}}ts.displayName="CollectionTimelineViewItemNew";const os=ts;class is extends u.Z{constructor(){super(...arguments),this.renderTimelineItem=e=>{const{timelineState:t,disabled:o,query:i,format:n,schema:r,collectionContextStore:a,blockPropertyValueOverlayStore:l,isFullScreen:c,isRootChild:d,groupFormat:p,paddingLeft:u,showTimelinePropertiesStore:m,scrollerLeftOffsetStore:g,showTable:h,canEditTimelineItems:f,isInPeekRenderer:v}=this.props;if(!a.groupsStore.getGroupState(p))return;const y=a.permissionScopes.state,b="collectionTypedView"===a.contextType||y.canEditContent;return s()(es,{store:e,disabled:o||!b,timelineState:t,schema:r,query:i,format:n,scrollerLeftOffset:g.state,paddingLeft:u,showProperties:m.state,blockPropertyValueOverlayStore:l,collectionContextStore:a,isFullScreen:c,showTable:h,isRootChild:d,groupFormat:p,canEditTimelineItems:f,isInPeekRenderer:v,handleOpenPeekPage:this.handleOpenPeekPage,isLast:!1},e.id)},this.handleOpenPeekPage=()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);if(!o)return;const i=e.collectionViewStore();L.Xd({collectionContextStore:e,resultsStore:o.resultsStore});const n=null==i?void 0:i.getFormat().collection_peek_mode,r=n||vo.Ls.timeline;P.trackExpandBlock(this.environment,{is_peek:!0,from:"timeline",peek_mode:r})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,schema:t,groupFormat:o,query:i,showTable:n}=this.props;if(!i.timeline_by)return;const r=e.groupsStore.getGroupState(o);if(!r)return;const a=r.currentLimit.get(),s=c().compact([o&&(0,He.Ko)({schema:t,group:o,timeZone:(0,ze.r)()}),!n&&{property:i.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:a}}))}renderComponent(){const{store:e,format:t,groupFormat:o,collectionContextStore:i,isFullScreen:n,paddingLeft:a,showTable:l}=this.props,c=i.groupsStore.getGroupState(o);if(!c)return;const p=o?[o]:[],u=this.resultsReducerStore.state,m=c.reducerResultStore.state,g=ee.VM({collectionContextStore:i,reducerResult:m,isFullScreen:n});return d.createElement(d.Fragment,null,u&&s()(Ge.Z,{id:p.length>0?`results:${p.map(Re.mD).join(":")}`:"timeline_results",reducer:u,collectionContextStore:i,resultStore:c.reducerResultStore}),this.renderCollectionGroupResults(),g&&s()("div",{style:{width:"100%"}},void 0,l?s()("div",{style:{height:33}}):s()(ao,{style:{position:"sticky",left:n?a:3,width:"max-content",height:33},groupsPointer:p,store:e,collectionContextStore:i,format:t,isFullScreen:n,incrementLimitsInRelatedGroups:!1})),d.createElement(ns,r()({},this.props,{store:void 0,indentLevel:0,handleOpenPeekPage:this.handleOpenPeekPage})))}renderCollectionGroupResults(){const{groupFormat:e,disabled:t,query:o,format:i,schema:n,blockPropertyValueOverlayStore:a,collectionContextStore:l,isFullScreen:c,isRootChild:p,showTable:u,canEditTimelineItems:m,scrollerLeftOffsetStore:g,timelineState:h,paddingLeft:f,showTimelinePropertiesStore:v,isInPeekRenderer:y}=this.props;if(!l.groupsStore.getGroupState(e))return;const b=l.permissionScopes.state,S="collectionTypedView"===l.contextType||b.canEditContent;return s()(To,{disableSelectable:!0,collectionContextStore:l,groupsPointer:e?[e]:[],format:i,canDrag:!1,disableRequest:!0,resultProps:{disabled:t||!S,timelineState:h,schema:n,query:o,format:i,scrollerLeftOffset:g.state,paddingLeft:f,showProperties:v.state,blockPropertyValueOverlayStore:a,collectionContextStore:l,isFullScreen:c,showTable:u,isRootChild:p,groupFormat:e,canEditTimelineItems:m,isInPeekRenderer:y,handleOpenPeekPage:this.handleOpenPeekPage,isLast:!1},canDrop:!1,resultComponent:es,disabled:!0,direction:_o.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:e=>d.createElement(ns,r()({},this.props,{store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:this.handleOpenPeekPage}))})}}function ns(e){window.__c={n:"AddRowTimelineItem"};const{store:t,parentStore:o,subitemPath:i,timelineState:n,disabled:r,query:a,format:l,schema:c,collectionContextStore:d,blockPropertyValueOverlayStore:p,isFullScreen:u,isRootChild:m,groupFormat:g,paddingLeft:h,showTimelinePropertiesStore:f,scrollerLeftOffsetStore:v,showTable:y,canEditTimelineItems:b,isInPeekRenderer:S,isReady:w,canEdit:k}=e,C=(0,lo.VK)((()=>d.groupsStore.getGroupState(g)),[d,g]),_=(0,lo.VK)((()=>d.permissionScopes.state),[d.permissionScopes]),M=(0,lo.VK)((()=>v.state),[v]),T=(0,lo.VK)((()=>f.state),[f]);return C&&w&&k&&!_.isSyncedCollection?s()(os,{store:t,disabled:r||!_.canEditContent,timelineState:n,schema:c,query:a,format:l,scrollerLeftOffset:M,paddingLeft:h,showProperties:T,blockPropertyValueOverlayStore:p,collectionContextStore:d,isFullScreen:u,showTable:y,isRootChild:m,groupFormat:g,canEditTimelineItems:b,isInPeekRenderer:S,parentStore:o,subitemPath:i}):null}is.displayName="TimelineItemGroupResults";const rs=(0,I.injectIntl)(is);class as extends u.Z{constructor(){super(...arguments),this.handleAddRowClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,{device:i}=this.environment,n=o?[o]:[],r=e.groupsStore.getGroupState(n);if(!Ne.M_(this.environment)||!r)return;e.searchQuery.get()&&F.Ug({searchQuery:"",collectionContextStore:e,isFullScreen:t});const a=r.resultsStore.state;W.createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:this.environment,perform:t=>{const{coercionSucceeded:n,newStore:r}=R.IW({environment:this.environment,collectionContextStore:e,groupsPointer:o?[o]:[],results:a,insertAtIndex:a.length,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"timeline_table_group_results"});if(i.isMobile){const e=(0,oe.ZP)({store:r,fullyQualified:!1});this.navigate(e)}else m.default.afterNextFlush((()=>{m.default.afterNextFlush((()=>{if(n)vt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r,property:"title",format:Nt.C.Table,collectionContextStore:e,disableHorizontalEdgeScroll:!0});else{const t=o?[o]:[],i=e.groupsStore.getGroupState(t);N.peekBlock({environment:this.environment,store:r,peekMode:(0,ee.kr)(e.collectionViewStore()),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:e})}}))}));P.trackCreateBlock(this.environment,{from:"timeline_add_item_bottom",type:"page",...(0,J.Pn)(e)})}})},this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,i=t.groupsStore.getGroupState(o);if(!i)return;const n=i.reducerResultStore.state;(0,ie.Wi)(e),H.ZH(this.environment),n&&t.groupsStore.incrementLimit({isFullScreen:this.props.isFullScreen,currentResultCount:n.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}),P.trackInlineCollectionLoadMoreClick(this.environment)},this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,go.A7)(e,t)})),this.getItemSelectableStyle=()=>({display:"flex",borderBottom:`1px solid ${this.theme.tableDividerColor}`,width:"fit-content"})}renderComponent(){const{groupFormat:e,isFullScreen:t,collectionContextStore:o,isReady:i,store:n,disabled:r,format:a,schema:l,isInPeekRenderer:c,paddingBottom:p,blockPropertyValueOverlayStore:u,query:m,showTablePropertyFormatsStore:g,showHoverActionsStore:h}=this.props,f=e?[e]:[],v=o.groupsStore.getGroupState(f);if(!v)return;const y=v.reducerResultStore.state,b=(0,ee.VM)({collectionContextStore:o,reducerResult:y,isFullScreen:t}),S=o.permissionScopes.state;return d.createElement(d.Fragment,null,this.renderTableHeaderRow(e),s()("div",{style:{height:(0,Q.vX)(Boolean(e)),width:0}}),i&&0===(null==y?void 0:y.blockIds.length)&&this.renderEmptyTablePlaceholder(),this.renderTableRows(e),b&&this.renderLoadMoreButton(),this.shouldShowAddRowButton()&&this.renderTableAddRowButton(),s()(Er,{groupFormat:e,style:this.getAggregationRowStyle(),store:n,disabled:r||!S.canConfigureBlock,format:a,schema:l,query:m,collectionContextStore:o,isInPeekRenderer:c,isFullScreen:t,minWidth:void 0,paddingBottom:p,blockPropertyValueOverlayStore:u,showPropertyFormatsStore:g,showHoverActionsStore:h,showRightActionsSpacer:!1}),(e||t)&&s()("div",{style:{height:Ra,width:0,marginBottom:e?Q.y1:void 0}}))}renderTableHeaderRow(e){const{store:t,format:o,schema:i,query:n,collectionContextStore:r,paddingBottom:a,isInPeekRenderer:l,blockPropertyValueOverlayStore:c,tableStore:d,showTablePropertyFormatsStore:p,timelineState:u,isFullScreen:m,isRootChild:g}=this.props;if(!r.groupsStore.getGroupState(e))return;const h=Boolean(e),f=r.permissionScopes.state,v=r.viewIsFlushToTopbar();return s()(ua,{store:t,format:o,schema:i,query:n,collectionContextStore:r,isInPeekRenderer:l,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:c,showPropertyFormatsStore:p,showRightActions:!1,allowHidingTitle:!0,tableStore:d,formatKey:"timeline_table_properties",disabled:!f.canConfigureCollection,disableHorizontalEdgeScroll:!0,height:(0,Q.vX)(h),paddingTop:h?0:Q.Ne-Q.pe,disableTopBorder:!v||h,disableCellRightBorder:!0,groupFormat:e},void 0,!h&&f.canConfigureBlock&&s()(wr,{isGrouped:!1,format:o,collectionContextStore:r,timelineState:u,isFullScreen:m,isRootChild:g}))}renderTableRows(e){const{device:t}=this.environment,{store:o,schema:i,query:n,disabled:r,collectionContextStore:a,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:c,canEdit:d,format:p}=this.props,u=a.collectionViewStore();if(!u)return;const g=e?[e]:[];if(!a.groupsStore.getGroupState(e))return;const h=c.state,f=!d&&t.isMobile&&!u.isSyncedCollection();return s()(Pa,{store:o,format:p,schema:i,query:n,collectionContextStore:a,minWidth:void 0,blockPropertyValueOverlayStore:l,showPropertyFormatsStore:c,currentRowsStore:this.allRowsStore,disabled:!d,disableHorizontalEdgeScroll:!0,groupFormat:e,render:e=>s()(To,{collectionContextStore:a,groupsPointer:g,disableRequest:!0,format:p,canDrag:f,resultProps:{schema:i,collectionContextStore:a,propertyFormats:h,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:r,blockPropertyValueOverlayStore:l,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableLastCellBorderRight:!0,disableTableWrap:!0,disableCellBorderRight:!1,onShiftEnter:()=>{}},resultComponent:ha,canDrop:!1,disabled:r,direction:_o.Vertical,getItemSelectableStyle:this.getItemSelectableStyle,shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:e.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:l,nestedCreateSubitemButton:e=>{const{store:t,parentStore:o,subitemPath:i,indentLevel:n}=e;if(o)return s()(fn,{store:t,collectionStore:o,subitemPath:i,indentLevel:n,collectionContextStore:a,disabled:r,groupsPointer:g,onSubitemCreate:e=>{l&&m.default.afterNextFlush((()=>{m.default.afterNextFlush((()=>{vt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:l,store:e,property:"title",format:Nt.C.Table,collectionContextStore:a,disableHorizontalEdgeScroll:!0})}))}))}})}})})}renderEmptyTablePlaceholder(){const{canEdit:e}=this.props;return s()(Ot.Z,{onClick:this.handleAddRowClick,onMouseDown:ie.$0,disabled:!e,style:{display:"flex",alignItems:"center",height:Ea,width:"100%",paddingLeft:8,fontSize:14,lineHeight:M.Z.lineHeight.UIRegular.desktop,background:this.theme.contentBackground,left:0,right:0,borderBottom:"1px solid transparent"}},void 0,s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,e?{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder",description:"Prompt user to add a row if empty."}:{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder",description:"Inform users that database is empty."})))}renderLoadMoreButton(){const{collectionContextStore:e,groupFormat:t,format:o,canEdit:i}=this.props,n=t?[t]:[];if(e.groupsStore.getGroupState(n))return s()(Ot.Z,{onMouseDown:ie.$0,onClick:this.handleLoadMoreClick,style:{display:"flex",alignItems:"center",height:Ea+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:M.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"}},void 0,b.Z.arrowDown(this.getTableNewRowButtonIconStyle()),s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})),i&&s()(no,{collectionContextStore:e,format:o}))}renderTableAddRowButton(){return s()(Ot.Z,{onClick:this.handleAddRowClick,style:this.getTableAddRowButtonStyle(),className:X.tfM,onMouseDown:ie.$0},void 0,b.Z.plus(this.getTableNewRowButtonIconStyle()),s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.addRowButton"})))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.navigate({environment:this.environment,url:e})}shouldShowAddRowButton(){const{collectionContextStore:e,isReady:t,canEdit:o}=this.props,i=e.permissionScopes.state;return Boolean(t&&o&&!i.isSyncedCollection)}getTableAddRowButtonStyle(){return{display:"flex",alignItems:"center",height:Ea,width:"100%",paddingLeft:8,fontSize:14,lineHeight:M.Z.lineHeight.UIRegular.desktop,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}}getTableNewRowButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}getAggregationRowStyle(){const{isReady:e,groupFormat:t,isFullScreen:o,paddingLeft:i}=this.props;return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:i},...o&&!t&&{left:i}}}}as.displayName="TimelineTableGroupResults",as.contextTypes={...K.wK,...u.w};const ss=(0,I.injectIntl)(as);class ls extends Ee.Z{constructor(){super(...arguments),this.widthEl=null,this.storeTypes={tableStore:Jn,hiddenGroupsVisible:Ze.default.of(!1),groupsReducerResultStore:Ze.default.of(void 0)},this.renderTableGroupHeader=e=>{const{format:t,collectionContextStore:o,isFullScreen:i,isRootChild:n}=this.props,a=o.permissionScopes.state;return d.createElement(bi,r()({},e,{height:Q.Zn-1,paddingTop:Q.xd,toggleClosedMarginBottom:Q.xd,getComputedStickyStyle:this.getTableGroupHeaderComputedStickyStyle,style:this.getGroupHeaderStyle(e.index)}),0===e.index&&a.canConfigureBlock&&s()(wr,{isGrouped:!0,format:t,collectionContextStore:o,timelineState:this.timelineState,isFullScreen:i,isRootChild:n})," ")},this.renderTableGroupResults=e=>{const{store:t,isFullScreen:o,schema:i,query:n,isInPeekRenderer:r,collectionContextStore:a,blockPropertyValueOverlayStore:l,showHoverActionsStore:c,paddingBottom:d,isRootChild:p,disabled:u}=this.props,m=this.isReady.state,g=this.getPaddingLeft();if(a.groupsStore.getGroupState(e))return s()(ss,{store:t,groupFormat:e,schema:i,query:n,isInPeekRenderer:r,timelineState:this.timelineState,collectionContextStore:a,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:this.showTablePropertyFormatsStore,showHoverActionsStore:c,tableStore:this.stores.tableStore,paddingLeft:g,paddingBottom:d,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:p,isReady:m,canEdit:this.canEditCollectionTimeline(),disabled:u&&this.canEditCollectionTimeline()})},this.renderTimelineItemGroupResults=e=>{const{store:t,isFullScreen:o,schema:i,query:n,isInPeekRenderer:r,collectionContextStore:a,blockPropertyValueOverlayStore:l,isRootChild:c,disabled:d}=this.props,p=this.isReady.state,u=this.getPaddingLeft();return s()(rs,{store:t,groupFormat:e,schema:i,query:n,isInPeekRenderer:r,timelineState:this.timelineState,collectionContextStore:a,blockPropertyValueOverlayStore:l,showTimelinePropertiesStore:this.showTimelinePropertiesStore,paddingLeft:u,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:c,isReady:p,canEdit:this.canEditCollectionTimeline(),disabled:d,showTable:this.showTableStore.state,canEditTimelineItems:this.canEditTimelineItemsStore.state,scrollerLeftOffsetStore:this.scrollerLeftOffsetStore})},this.renderTimelineItemGroupHeader=e=>{if(this.showTableStore.state)return;const t=this.timelineState.outerSizeObserver.rect.get().width;return s()("div",{style:{position:"sticky",left:0,width:t,height:Q.Zn,zIndex:T.sL}},void 0,d.createElement(bi,r()({},e,{style:{width:"100%",height:"100%",paddingLeft:this.props.isFullScreen?this.getPaddingLeft():32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},getComputedStickyStyle:this.getTimelineItemGroupHeaderStickyStyle,preventToggleBackground:this.props.isInPeekRenderer})))},this.renderTimelineItemHiddenGroupsButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return s()("div",{style:{width:"100%",height:34,display:"flex"}},void 0,d.createElement(Zi,r()({},e,{style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}})))},this.renderTimelineAddGroupButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t,collectionContextStore:o}=this.props;return"collectionTypedView"!==o.contextType?s()("div",{style:{width:"100%",height:32,display:"flex"}},void 0,d.createElement(ni,r()({},e,{style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}}))):void 0},this.renderTimelineGroupsLoadMoreButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return s()("div",{style:{width:"100%",height:38,display:"flex"}},void 0,d.createElement(xi,r()({},e,{style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}})))},this.renderRowDropzoneSelectableGroupResults=e=>{const{collectionContextStore:t,store:o,isFullScreen:i,format:n,disabled:r}=this.props;return s()(Ua,{store:o,groupFormat:e,collectionContextStore:t,isFullScreen:i,canEdit:this.canEditCollectionTimeline(),format:n,disabled:r&&this.canEditCollectionTimeline()})},this.renderDropzoneSelectableGroupHeader=()=>{},this.renderDropzoneSelectableHiddenGroupsButton=()=>{},this.renderDropzoneSelectableAddGroupButton=()=>{},this.renderDropzoneSelectableGroupsLoadMoreButton=()=>{},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,i=t.isLoading.get(),n=t.groupsStore.getGroupState([]);if(!n)return;const r=n.reducerResultStore.state;e<ge.Z.incrementScrollOffset&&r&&!i&&r.hasMore&&t.groupsStore.incrementLimit({isFullScreen:o,currentResultCount:r.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1})},this.handleHorizontalScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,savePreference:o}=e;if(!t)return;const i=t.scrollLeft,n=e.scrollLeft.get();this.environment.device.isIOS&&void 0!==n&&0===i&&n>Q.lx?t.scrollLeft=n:(o&&o(),e.scrollLeft.set(i),(0,Q.rr)(this.environment)?this.resetWindowForScrollDebounced():this.resetWindowForScroll())},this.resetWindowForScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o}=e;if(!t)return;const i=e.zoomLevel.get(),{startTimestamp:n,endTimestamp:r}=e.currentRange.get(),a=t.scrollLeft,s=o.rect.get().width,l=(0,Q.e$)(i,r-n),c=(0,Q.al)(e);if(a<Q.lx){const t=-(0,Q.x2)(i,Q.Ge);e.currentRange.set({startTimestamp:n+t,endTimestamp:r+t}),Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:i,centerTimestamp:c})}else if(a+s>l-Q.lx){const t=(0,Q.x2)(i,Q.Ge);e.currentRange.set({startTimestamp:n+t,endTimestamp:r+t}),Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:i,centerTimestamp:c})}},this.resetWindowForScrollDebounced=c().debounce(this.resetWindowForScroll,200),this.handleWidthElMount=e=>{if(this.widthEl=e,e){const{timelineState:t}=this,{outerSizeObserver:o}=t;o.observe(e);const i=(0,se.xH)(e);i&&(t.horizontalScroller=i,(0,te.lj)(i,"scroll",this.handleHorizontalScroll),t.outerSizeObserver.rect.addListener(this.scrollToCenteredTimestamp),this.scrollToCenteredTimestamp())}},this.handleTimelineElMount=e=>{if(e){const{timelineState:t}=this,{timelineSizeObserver:o}=t;o.observe(e)}},this.scrollToCenteredTimestamp=()=>{const{timelineState:e}=this,{startTimestamp:t,endTimestamp:o}=e.currentRange.get();Xn.KA({timelineState:e,centerTimestamp:(t+o)/2})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)N.navigateToBlock({environment:this.environment,store:e});else{const{collectionContextStore:t}=this.props,{groupFormat:i}=o,n=i?[i]:[],r=t.groupsStore.getGroupState(n);N.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t})}},this.showTablePropertyFormatsStore=this.createComputedStore((()=>this.getTimelineTableProperties().filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>this.showTableStore.state?this.showTablePropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0):0)),this.scrollerLeftOffsetStore=this.createComputedStore((()=>(0,Q.xI)({environment:this.environment,paddingLeft:this.getPaddingLeft(),format:this.props.format,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild}))),this.scrollPixelWidthStore=this.createComputedStore((()=>{const{timelineState:e}=this,t=e.zoomLevel.get(),{startTimestamp:o,endTimestamp:i}=e.currentRange.get();return(0,Q.e$)(t,i-o)})),this.showTimelinePropertiesStore=this.createComputedStore((()=>{const{format:e}=this.props;return(e.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))})),this.showTableStore=this.createComputedStore((()=>{const{format:e,isFullScreen:t,isRootChild:o}=this.props;return(0,Q.C1)({environment:this.environment,format:e,isFullScreen:t,isRootChild:o})})),this.canEditTimelineItemsStore=this.createComputedStore((()=>{const{query:e,schema:t}=this.props;return ee.D2({query:e,schema:t})})),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getTimelineItemGroupStyle=e=>{const t=this.showTableStore.state,o=this.getGroupPaddingState(e);let i=0,n=0;return o.groupHeader&&t&&(i+=Q.Zn-1),o.tableHeaderRow&&(i+=Q.pe),o.tableEmptyRow&&(i+=Ea),o.tableAggregationRow&&(n+=Ra),o.hiddenGroupsButton&&t&&(n+=34),o.groupsLoadMoreButton&&t&&(n+=38),o.addGroupButton&&t&&(n+=32),o.groupPaddingBottom&&(n+=Q.y1),o.extraGroupMarginBottom&&(n+=Q.xd+1),{paddingTop:i,paddingBottom:n,minHeight:Q.Zn,boxShadow:e.index>0&&(!t||o.tableHeaderRow)?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}},this.getRowDropzoneSelectableGroupStyle=e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=this.getGroupPaddingState(e);let o=0,i=0;return t.groupHeader&&(o+=Q.Zn),t.tableHeaderRow&&(o+=Q.pe),t.tableEmptyRow&&(o+=Ea),t.addItemRow&&(i+=Qn.Zv),t.loadMoreButton&&(i+=33),t.tableAggregationRow&&(i+=Ra),t.hiddenGroupsButton&&(i+=34),t.groupsLoadMoreButton&&(i+=38),t.groupPaddingBottom&&(i+=Q.y1),t.extraGroupMarginBottom&&(i+=Q.xd),t.addGroupButton&&(i+=32),t.dropZoneSelectableGroupExtraBottomPadding&&(i+=1),{paddingTop:o,paddingBottom:i}},this.getTableGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}),this.getTimelineItemGroupHeaderStickyStyle=e=>e?{background:this.theme.contentBackground,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`}:{background:"transparent",boxShadow:void 0}}get registries(){return super.registries.concat(qn.Z)}willMount(e){super.willMount(e),this.timelineState=(0,Q.Gz)({isFullScreen:e.isFullScreen,isRootChild:e.isRootChild});const{collectionContextStore:t}=e,o=t.collectionStore(),i=t.collectionViewStore();o&&i&&Xn.j2({timelineState:this.timelineState,environment:this.environment,collectionViewStore:i,collectionContextStore:t})}willMountOrUpdate(e){super.willMountOrUpdate(e);const{timelineState:t}=this,{query:o,collectionContextStore:i}=e;Se.Z.state&&t.hoveredItem.set(void 0);const n=i.collectionStore();if(!n)return;const r=i.permissionScopes.state;!o.timeline_by&&r.canConfigureCollection&&r.canConfigureBlock&&n.isDefined()&&this.updateOrCreateTimelineProperty(e)}didMountOrUpdate(){super.didMountOrUpdate();const e=this.timelineState,{collectionContextStore:t,isFullScreen:o,isRootChild:i}=this.props;P.trackTimelineView(this.environment,(0,Q.Ii)({environment:this.environment,collectionContextStore:t,timelineState:e,isFullScreen:o,isRootChild:i}));const n=e.drawState.get();if(null!=n&&n.tryToCompleteDrawnArrow){(0,Q.H5)(t)&&W.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:this.environment,perform:n=>{Xn.$o({timelineState:e,environment:this.environment,transaction:n,collectionContextStore:t,isFullScreen:o,isRootChild:i})}})}}willUnmount(){super.willUnmount();const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o,timelineSizeObserver:i}=e;o.destroy(),i.destroy(),e.destroyed=!0,t&&(0,te.ZV)(t,"scroll",this.handleHorizontalScroll)}customizeEdgeScrollRect(e){const t=this.scrollerLeftOffsetStore.state;return Wi.iL.from({...e,left:e.left+t,width:e.width-t})}addBlockToView(e){const{store:t,transaction:o}=e,{collectionContextStore:i}=this.props,n=i.collectionStore();if(n)return Xn.Fv({environment:this.environment,store:t,timelineState:this.timelineState,query:this.props.query,collectionStore:n,collectionContextStore:this.props.collectionContextStore,groupFormat:void 0,transaction:o})}renderPersisted(){const{store:e,isInPeekRenderer:t,paddingRight:o,isFullScreen:i,isRootChild:n,query:a,schema:l,format:c,collectionContextStore:p,disabled:u}=this.props,{timeline_by:m}=a;if(!m)return this.renderMissingDateProperty();const g=l[m];if(!g||!mt.Lt(g))return this.renderMissingDateProperty();const{timelineState:h}=this,f=this.scrollerLeftOffsetStore.state,v=this.showTableStore.state,y=this.getPaddingLeft(),b=ee.az(p,i),S=c.collection_group_by,w=p.viewIsFlushToTopbar(),k=(0,Le.Z)((m=>s()(Mi,{isFullScreen:i,renderEmitter:p.renderEmitter},void 0,d.createElement("div",r()({style:this.getStyle(v),className:X.kDE},m),s()(yo.Z,{store:e,analyticsName:"timeline",shouldShowHalo:!i,canSelect:!i},void 0,s()(La,{timelineState:h,isInPeekRenderer:this.props.isInPeekRenderer}),d.createElement("div",{style:{position:"absolute",width:"100%",zIndex:0,top:Q.Ne},ref:this.handleTimelineElMount},S?this.renderTimelineItemGroups(S):this.renderTimelineItemGroupResults(void 0),s()(ur,{timelineState:h,collectionContextStore:p,disabled:u,isReady:this.isReady.state,renderEmitter:p.renderEmitter,isFullScreen:i,isRootChild:n})),s()(Tr,{isInPeekRenderer:t,timelineState:h,query:a,schema:l,scrollerLeftOffset:f,collectionContextStore:p,showTable:v}),s()(br,{timelineState:h,isInPeekRenderer:t,paddingLeft:y,paddingRight:!i&&n?8:o,format:c,scrollerLeftOffset:f,isFullScreen:i,isRootChild:n,showTable:v,collectionContextStore:p,isReady:this.isReady.state}),v&&this.renderTable(S,y),s()("div",{style:{paddingTop:Q.Ne,pointerEvents:"none"}},void 0,S?this.renderRowDropzoneSelectableGroups(S):s()("div",{style:this.getRowDropzoneSelectableGroupStyle(void 0)},void 0,this.renderRowDropzoneSelectableGroupResults(void 0))),!b&&s()(Io.Z,{onChange:this.handleScrollOffsetChange}))))));return d.createElement(d.Fragment,null,d.createElement("div",{ref:this.handleWidthElMount}),!w&&s()("div",{style:{height:4}}),k)}renderMissingDateProperty(){return s()("div",{style:{paddingLeft:this.getPaddingLeft(),paddingRight:this.props.paddingRight}},void 0,s()(I.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a date property.",id:"database.timelineView.missingDateProperty"}))}renderTable(e,t){const{store:o,isFullScreen:i,collectionContextStore:n}=this.props;return s()("div",{style:{position:"sticky",left:0,height:0,width:this.tableWidthStore.state,zIndex:T.eU}},void 0,s()(yo.Z,{style:this.getTableSelectableStyle(t),store:o,shouldShowHalo:!1,canSelect:!i,analyticsName:"timeline"},void 0,e?this.renderTableGroups(e):s()(Mi,{isFullScreen:i,ignoreAncestorContainer:!0,renderEmitter:n.renderEmitter},void 0,s()("div",{},void 0,this.renderTableGroupResults(void 0)))))}renderTableGroups(e){const{store:t,format:o,collectionContextStore:i,schema:n,disabled:r,isFullScreen:a,paddingLeft:l,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(Ri,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:Re.Uh,groupAggregationKey:Re.dQ,format:o,schema:n,collectionContextStore:i,disabled:r,isFullScreen:a,renderGroup:this.renderTableGroupResults,renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,ignoreAncestorStickyContainer:!0,paddingLeft:l,isRootChild:c,isInPeekRenderer:d})}renderTimelineItemGroups(e){const{store:t,format:o,collectionContextStore:i,schema:n,disabled:r,isFullScreen:a,paddingLeft:l,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(Ri,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:Re.Uh,groupAggregationKey:Re.dQ,format:o,schema:n,collectionContextStore:i,disabled:r,isFullScreen:a,renderGroup:this.renderTimelineItemGroupResults,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderTimelineItemGroupHeader,getGroupStyle:this.getTimelineItemGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,renderHiddenGroupsButton:this.renderTimelineItemHiddenGroupsButton,renderAddGroupButton:this.renderTimelineAddGroupButton,renderGroupsLoadMoreButton:this.renderTimelineGroupsLoadMoreButton,paddingLeft:l,isRootChild:c,isInPeekRenderer:d})}renderRowDropzoneSelectableGroups(e){const{store:t,format:o,collectionContextStore:i,schema:n,disabled:r,isFullScreen:a,paddingLeft:l,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(Ri,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:Re.Uh,groupAggregationKey:Re.dQ,format:o,schema:n,collectionContextStore:i,disabled:r,isFullScreen:a,renderGroup:this.renderRowDropzoneSelectableGroupResults,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderDropzoneSelectableGroupHeader,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,renderHiddenGroupsButton:this.renderDropzoneSelectableHiddenGroupsButton,renderAddGroupButton:this.renderDropzoneSelectableAddGroupButton,renderGroupsLoadMoreButton:this.renderDropzoneSelectableGroupsLoadMoreButton,paddingLeft:l,isRootChild:c,isInPeekRenderer:d})}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.stores.tableStore.state;return t||e}getTimelineTableProperties(){const e=this.getCurrentFormat();return e&&e.timeline_table_properties?e.timeline_table_properties:[]}updateOrCreateTimelineProperty(e){const{schema:t}=e,{collectionContextStore:o}=this.props,i=o.collectionStore();if(!i)return;const n=o.collectionViewStore();if(!n)return;const r=(0,I.defineMessages)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});W.createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:this.environment,perform:e=>{let o,a=ee.HI(t);if(!a){a=(0,Ae.ZP)();o={[a]:{name:ne.default.formatMessage(r.date),type:"date"}}}F.Es({collectionViewStore:n,update:{timeline_by:a},transaction:e}),o&&F.xO({environment:this.environment,collectionStore:i,update:o,transaction:e})}})}canEditCollectionTimeline(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent&&!e.isSyncedCollection}isInlineFullWidth(){const{isRootChild:e,isFullScreen:t,format:o}=this.props;return(0,Q.fj)({environment:this.environment,isRootChild:e,isFullScreen:t,format:o})}getGroupPaddingState(e){const{groupFormat:t,currentGroups:o,visibleGroups:i,hiddenGroups:n,total:r}=e,{collectionContextStore:a,isFullScreen:s,disabled:l,format:c}=this.props,{hiddenGroupsVisible:d}=this.stores,p=c.collection_group_by,u=this.showTableStore.state,m=a.groupsStore.getGroupState(t),g=Boolean(t&&!(null!=m&&m.toggleStateStore.get())),h=this.isFirstNonCollapsedGroup(t,g,o),f=null==m?void 0:m.reducerResultStore.state,v=ee.VM({collectionContextStore:a,reducerResult:f,isFullScreen:s}),y=t===n[n.length-1],b=t===i[i.length-1],S=i.length<r,w=d.state?y:b,k=a.permissionScopes.state,C=w&&!l&&k.canConfigureBlock&&p&&(0,Re.Wz)(p,k.canConfigureCollection),_=f&&0===f.blockIds.length;return{groupHeader:Boolean(t&&(!u||!h)),tableHeaderRow:Boolean(u&&!g&&!h),tableAggregationRow:Boolean(u&&!g),addItemRow:Boolean(this.canEditCollectionTimeline()&&!g),hiddenGroupsButton:Boolean(b&&n.length>0),groupsLoadMoreButton:Boolean(b&&S),loadMoreButton:Boolean(!g&&v),groupPaddingBottom:Boolean(!g),tableEmptyRow:Boolean(u&&!g&&_),extraGroupMarginBottom:Boolean(u&&g),addGroupButton:Boolean(C),dropZoneSelectableGroupExtraBottomPadding:Boolean(!u)}}isFirstNonCollapsedGroup(e,t,o){const{collectionContextStore:i}=this.props;if(!e)return!0;const n=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<n){const t=i.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.get()}return!1}))}getPaddingLeft(){return this.isInlineFullWidth()?Q.Qw:this.props.paddingLeft}getStyle(e){const{isFullScreen:t,paddingBottom:o}=this.props,i=this.scrollPixelWidthStore.state,n=this.isReady.state;return{position:"relative",float:"left",minWidth:"100%",width:i,background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,...!t&&!e&&{borderBottom:`1px solid ${this.theme.tableDividerColor}`},...!n&&{minHeight:150},...t&&{paddingBottom:o},height:this.getComputedOuterHeight()}}getTableSelectableStyle(e){return{whiteSpace:"nowrap",background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,paddingLeft:e,borderRight:`1px solid ${this.theme.tableDividerColor}`,boxShadow:this.theme.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:this.tableWidthStore.state+e+1,height:this.getComputedOuterHeight()}}getComputedOuterHeight(){const{device:e}=this.environment,{paddingBottom:t,isFullScreen:o}=this.props,{timelineSizeObserver:i}=this.timelineState,n=i.rect.get().height,r=this.showTableStore.state;return n+t+(o?0:72)+(!o&&r?28:0)+(o&&e.isMobile?72:0)}getGroupHeaderStyle(e){const{collectionContextStore:t}=this.props,o=t.viewIsFlushToTopbar();return 0!==e||o?{borderTop:`1px solid ${this.theme.tableDividerColor}`}:{}}}ls.contextTypes={...K.wK,...u.w};const cs=ls;var ds=o(89086),ps=o(44862);class us extends u.Z{renderComponent(){const{store:e,titleStyle:t,actionButton:o,collectionContextStore:i}=this.props;return s()("div",{},void 0,s()("div",{style:{display:"flex"}},void 0,s()(Xi.Z,{store:e,style:t}),o),s()(ps.Z,{collectionStore:e,collectionContextStore:i}))}}us.displayName="CollectionHeader";const ms=us;var gs=o(40662);const hs=(0,I.defineMessages)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}});class fs extends u.Z{constructor(){super(...arguments),this.getIconSize=()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return 22;return t.isSyncedCollection()?58:22},this.renderActionsPopup=e=>{const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,i=t.collectionStore();if(!i)return;const n=i.isSyncedCollection(),a=l.compact([{key:"view",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:b.Z.alias(this.getSvgIconStyle())})),action:o=>{const i=this.getHref();if(!i)return;const n=te.DJ(o.event);N.navigate({environment:this.environment,url:i,openInNew:n}),n||e.close(),E.wd({environment:this.environment,collectionContextStore:t,action:"click_source_view"})}},o.canConfigureCollection&&!n&&{key:"edit_name",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:b.Z.pencil(this.getSvgIconStyle())})),action:()=>{z.mT({environment:this.environment,store:i.getNameStore(),canSelectAllBlocks:!1}),e.close(),E.wd({environment:this.environment,collectionContextStore:t,action:"click_source_edit_title"})}}]),c={key:"show_title",render:e=>d.createElement(Xe.Z,r()({},e,{icon:b.Z.eyeHidePadded(this.getSvgIconStyle(!0)),title:s()(I.FormattedMessage,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})})),action:()=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&(W.createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:this.environment,perform:e=>{De.FH({stores:[o],update:{hide_linked_collection_name:!0},transaction:e})}}),e.close(),E.wd({environment:this.environment,collectionContextStore:t,action:"click_source_hide_title"}))}};return s()(Je.Z,{type:Je.i.Vertical,sections:l.compact([{key:"actions",render:e=>d.createElement(ot.Z,e),items:a},o.canConfigureBlock&&{key:"show_title",render:e=>d.createElement(ot.Z,r()({},e,{topBorder:!0})),items:[c]}]),initialFocus:void 0})},this.handleRecordIconChange=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore();if(!o)return;const i=o&&o.getIconStore();i&&W.createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:this.environment,perform:t=>{yt.sO({store:i,value:e,transaction:t})}})},this.handleNameBlur=()=>{H.ZH(this.environment)},this.handleNameButtonClick=()=>{const{collectionContextStore:e}=this.props;E.wd({environment:this.environment,collectionContextStore:e,action:"click_collection_name_link_button"})},this.handleNameInputClick=()=>{const{collectionContextStore:e}=this.props;E.wd({environment:this.environment,collectionContextStore:e,action:"click_collection_name_input"})},this.isEditingName=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return!1;const o=t.getNameStore();return Boolean((0,ds.J5)(o))})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>{const{store:e}=this.props,t=Ie.default.state;return(0,ee.Ks)(e)||!(0,ee.en)(e)&&t.open&&t.isClosing}))}renderComponent(){var e;const{collectionContextStore:t,isFullScreen:o,canEdit:i}=this.props,n=t.collectionStore(),r=t.permissionScopes.state,a=t.collectionViewBlockStore();if(!n||!a)return;const l=Boolean((null===(e=n.getParentBlockStore())||void 0===e?void 0:e.id)===a.id),c=Boolean(n.isSyncedCollection()),d=this.isEditingName.state,p=this.isInFrameWhenSidePeekOpen.state,{WindowSizeStore:u}=this.environment,m=Math.min(Y.CC,u.state.width),g=(l||d)&&r.canConfigureCollection&&!c;return s()("div",{style:{...(o||p)&&(0,se.eA)(this.environment)&&{position:"sticky",left:0},paddingTop:8,boxSizing:p?"content-box":void 0,width:p?m:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"}},void 0,g?this.renderNameInput():this.renderLinkButton(),c&&s()("div",{style:{display:"flex"}},void 0,s()(gs.Z,{canEdit:i,store:a,buttonStyle:{margin:0}})))}renderActionButton(){const{showHoverActionsStore:e}=this.props;return s()(Ln.Z,{isVisible:!0,animationStyle:{opacity:e.state?1:0},render:()=>s()("div",{style:{display:"flex",alignItems:"center",marginLeft:4}},void 0,s()(qe.Z,{popupType:this.environment.device.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,render:this.renderActionsPopup,renderOrigin:e=>d.createElement(Jt.Z,r()({icon:b.Z.dots},e)),style:{width:240},originGap:4}))})}renderLinkButton(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore();if(t&&o)return s()(Ht.Z,{style:{width:"max-content",maxWidth:"100%",marginRight:4,...M.Z.textOverflowStyle},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:3},href:this.getHref(),onClick:this.handleNameButtonClick},void 0,this.renderIcon(!0),s()(ms,{actionButton:this.renderActionButton(),store:t,collectionContextStore:e,titleStyle:this.getTitleStyle()}))}renderNameInput(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore();if(t&&o)return s()("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4}},void 0,this.renderIcon(!1),s()(jt.Z,{store:t.getNameStore(),style:{...this.getTitleStyle(),marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:ne.default.formatMessage(hs.titlePlaceholder),onEnter:this.handleNameBlur,onEsc:this.handleNameBlur,onClick:this.handleNameInputClick,disableShiftEnter:!0,pasteBehavior:"inline"}),this.renderActionButton())}renderIcon(e){var t;const{collectionContextStore:o}=this.props,i=o.collectionStore(),n=o.collectionViewBlockStore();if(!i||!n)return;const r=i.getIcon(),a=Boolean((null===(t=i.getParentBlockStore())||void 0===t?void 0:t.id)===n.id);return r?s()("div",{style:{position:"relative",width:this.getIconSize()+2,height:this.getIconSize()+2,marginRight:4}},void 0,s()(zt.Z,e?{disabled:!0,bucket:"secure",store:i,icon:r,isEmptyPage:!1,style:this.getIconStyle(),size:this.getIconSize()}:{disabled:!1,bucket:"secure",store:i,icon:r,isEmptyPage:!1,style:this.getIconStyle(),size:this.getIconSize(),iconLoggingData:{recordTable:i.table,source:"inline_collection",block_type:n.getType(),collection_id:i.id},onChange:this.handleRecordIconChange}),!a&&b.Z.pageLinkIndicator({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===this.theme.mode?this.theme.regularTextColor:"#3E3C38",stroke:"dark"===this.theme.mode?this.theme.sidebarBackground:"white",strokeWidth:"dark"===this.theme.mode?"1.85px":"1.5px"})):!a&&s()("div",{style:{width:20,marginRight:4}},void 0,b.Z.alias({width:20}))}getHref(){const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return;const o=t.getParentBlockStore();return o?(0,oe.ZP)({store:o,fullyQualified:!1}):void 0}getTitleStyle(){return{fontWeight:M.Z.fontWeight.bold,fontSize:22}}getIconStyle(){return{width:this.getIconSize(),height:this.getIconSize(),marginRight:4}}getSvgIconStyle(e){return{width:24,height:e?24:16,fill:this.theme.regularIconColor}}}fs.displayName="CollectionViewBlockSource";const vs=(0,I.injectIntl)(fs);var ys=o(37709),bs=o(80503),Ss=o(31194);class ws extends u.Z{constructor(){super(...arguments),this.storeTypes={placementStore:Ze.default.of(void 0),headerRectStore:Ze.default.of(void 0),shouldScrollIntoViewStore:Ze.default.of(!1)},this.lastPlacement=void 0,this.justOpened=!1,this.renderMenu=e=>{const{collectionContextStore:t}=this.props;if(!this.stores.shouldScrollIntoViewStore.get())return s()(jn.Z,{context:jn.H.ViewSettings,collectionContextStore:t,collectionSettingsStore:t.settingsStore,fullHeight:e})},this.handleClose=e=>{(0,ie.ZP)({event:e,context:ie.Af.CollectionSettingsClick,callback:()=>{const{collectionContextStore:e}=this.props;A.E3({collectionSettingsStore:e.settingsStore})}})},this.captureMouseDown=e=>{(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{z.ZH(this.environment)}})},this.sidebarLayoutStore=this.createComputedStore((()=>{const e=this.props.headerSizeObserver.rect.get(),t=this.environment.WindowSizeStore.state.height,o=e.height-rl;return{maxHeight:t-(e.top+rl),moveUp:o}}))}willMountOrUpdate(e){const{collectionContextStore:t}=e,o=this.settingsOpen(),i=this.stores.placementStore.get();o&&!i&&this.props.headerSizeObserver.recompute();const n=this.props.headerSizeObserver.rect.get();if(o&&!i&&n){const e=this.getPlacement(n);this.stores.placementStore.set(e),this.justOpened=!0,this.lastPlacement=e}else this.justOpened=!1;o||this.stores.placementStore.set(void 0),this.justOpened&&(!t.isFullScreen.get()&&"popup"!==this.stores.placementStore.get()||Ie.default.isSidePeekOpen())&&this.stores.shouldScrollIntoViewStore.set(!0)}didMountOrUpdate(){const{collectionContextStore:e}=this.props,{shouldScrollIntoViewStore:t}=this.stores;if(t.get()){const o=e.collectionViewBlockStore();if(o){const t=Rn.R.findCollectionViewBlockFromStore(o);if(t){const o=p.findDOMNode(t);if(o){const t=o.getBoundingClientRect(),i=this.environment.WindowSizeStore.state.height-t.bottom,n=t.top;(i<Yn.j9||n<bs.Aj||e.isInPeekRenderer.get())&&((0,se.Wr)(o,{edgeDist:0,animate:!1}),this.props.headerSizeObserver.recompute())}}}t.set(!1)}}renderComponent(){const{paddingRight:e,collectionContextStore:t}=this.props,o=this.settingsOpen(),i=this.lastPlacement,n=t.isFullScreen.get(),a=t.viewIsFlushToTopbar(),l=this.getCurrentViewType(),c=("timeline"===l||"table"===l)&&a;if(i){if("sidebar"===i){const t=this.sidebarLayoutStore.state;if(!t)return;const{maxHeight:i,moveUp:a}=t;return s()(Ln.Z,{isVisible:o,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},springConfig:ks,render:()=>s()(gr.Z,{capture:o,allowMobileAutoScroll:!0,allowUndo:!0,render:t=>d.createElement("div",r()({style:{position:"absolute",top:(c?1:0)-a,right:-e,height:`calc(100% + ${a}px)`,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,borderLeft:`1px solid ${this.theme.tableDividerColor}`,paddingRight:e,zIndex:T.Nm,...n&&{height:i},...!n&&{maxHeight:i}},className:X.Dkf},(0,Ye.Z)({onMouseDown:this.captureMouseDown},t)),s()("div",{style:{display:"flex",height:"100%"}},void 0,s()("div",{style:{boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`}},void 0,this.renderMenu(!0)),s()("div",{style:{width:e}})))})})}return s()(tt.ZP,{popupType:this.environment.device.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,open:o,placementToOrigin:Ss.Iw.Bottom,alignmentToOrigin:Ss.lU.End,style:{marginTop:-1},origin:s()("div",{}),render:this.renderMenu,onDismiss:this.handleClose,originRect:this.props.headerSizeObserver.rect.get()})}}settingsOpen(){const{collectionContextStore:e}=this.props,t=e.settingsStore.get();return t.open&&!0!==t.hideSettingsPopup}getPlacement(e){const{collectionContextStore:t}=this.props;if(!this.settingsOpen())return;const o=(null==e?void 0:e.width)||0;return this.environment.device.isMobile||Ie.default.isSidePeekOpen()||!(t.isFullScreen.get()||o>600)?"popup":"sidebar"}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}}ws.displayName="CollectionViewSettingsPopup";const ks={translateX:{stiffness:120,damping:12,precision:.1},opacity:{stiffness:120,damping:10,precision:.001}},Cs=(0,I.injectIntl)(ws);let _s;class Ms{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;_s||(_s=document.createElement("div"),_s.style.position="absolute",_s.style.left="0",_s.style.top="0",_s.style.pointerEvents="none",_s.style.opacity="0",document.body.appendChild(_s)),c().forOwn(this.style,((e,t)=>{_s&&(_s.style[t]=e)})),_s.textContent=e;const o=_s.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}var Ts=o(1136),Is=o(29798),Ps=o(13401),xs=o(73657);class Bs extends u.Z{renderComponent(){const e=this.getMenuSections();return s()(Je.Z,{type:Je.i.Vertical,initialFocus:void 0,sections:l.compact(e.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>d.createElement(ot.Z,r()({},e,{topBorder:0!==t})),items:e}})))})}getMenuSections(){const{onClose:e,collectionContextStore:t,collectionViewStore:o,intl:i}=this.props,n=t.permissionScopes.state,a=t.collectionViewStore(),l=t.collectionViewBlockStore();if(!a||!l)return[];const c=a.id===o.id,p=[];if(p.push([]),n.canConfigureBlock){if(p[0].push({key:"rename",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:b.Z.rename(this.getSvgIconStyle(!1))})),action:()=>{E.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_rename"}),null==e||e(!0),c||F.f8({environment:this.environment,collectionContextStore:t,collectionViewId:o.id,isFullScreen:t.isFullScreen.get(),isRootChild:t.isRootChild.get(),isInPeekRenderer:t.isInPeekRenderer.get()}),A.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore,selectViewNameInitial:!0})}}),"page"===o.getType())return p;p[0].push({key:"edit",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:b.Z.options(this.getSvgIconStyle(!1))})),action:()=>{E.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_edit"}),null==e||e(!0),c||F.f8({environment:this.environment,collectionContextStore:t,collectionViewId:o.id,isFullScreen:t.isFullScreen.get(),isRootChild:t.isRootChild.get(),isInPeekRenderer:t.isInPeekRenderer.get()}),A.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore})}})}p.push([]),p[1].push({key:"copyLink",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:b.Z.link(this.getSvgIconStyle(!1))})),action:()=>{E.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_copy_link"}),A.Ol({environment:this.environment,collectionContextStore:t,collectionViewStore:o}),null==e||e(!1)}});return o.getFormat().hide_linked_collection_name&&n.canConfigureBlock&&p[1].push({key:"showDatabaseTitle",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle",description:"Show the database title in the current view"}),icon:b.Z.eyePadded(this.getSvgIconStyle(!0))})),action:()=>{E.wd({environment:this.environment,collectionContextStore:t,action:"click_source_show_title"}),W.createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:this.environment,perform:e=>{De.FH({stores:[o],update:{hide_linked_collection_name:!1},transaction:e})}}),null==e||e(!1)}}),p.push([]),n.canConfigureBlock&&p[2].push({key:"duplicate",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:b.Z.duplicate(this.getSvgIconStyle(!1))})),action:()=>{E.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_duplicate"}),A.zt({environment:this.environment,collectionContextStore:t,collectionViewStore:o,collectionSettingsStore:t.settingsStore,intl:i}),null==e||e(!0)}}),n.canConfigureBlock&&p[2].push({key:"delete",render:e=>d.createElement(Xe.Z,r()({},e,{title:s()(I.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:b.Z.trash(this.getSvgIconStyle(!1))})),action:async()=>{E.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_delete"});await A.TT({environment:this.environment,collectionContextStore:t,collectionViewStore:o,collectionSettingsStore:t.settingsStore,from:"view_action_menu"})&&(null==e||e(!1))}}),l.getAppContainerBlockStore()&&p.push([{key:"edit settings",render:e=>d.createElement(Xe.Z,r()({},e,{icon:b.Z.options(this.getSvgIconStyle(!1)),title:s()(I.FormattedMessage,{defaultMessage:"Edit {databaseName} settings",id:"CollectionViewActionMenu.editSettings",values:{databaseName:s()(Xi.Z,{store:l,style:{display:"inline"}})},description:"Main menu for database view block settings"})})),action:()=>{A.tS({environment:this.environment,store:l}),null==e||e(!0)}}]),p}getSvgIconStyle(e){return{width:24,height:e?24:16,fill:this.theme.regularIconColor}}}Bs.displayName="CollectionViewActionMenu";const Zs=(0,I.injectIntl)(Bs);class Es extends u.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ue.Z},this.renderActionMenu=()=>{const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:Ke.og.ActionSheet}:{menuType:Ke.og.Popup,width:220},d.createElement($e.Z,t,d.createElement(Zs,r()({},this.props,{onClose:this.handleClose})))},this.handleClose=e=>{this.stores.buttonPopupStore.setState({open:!1}),e&&this.props.onClose()}}renderComponent(){const{collectionViewStore:e,menuListItemProps:t}=this.props,o=e.getName(),i=e.getType(),n=e.getFormat().collection_view_icon;if(void 0!==i)return d.createElement(Xe.Z,r()({title:s()(Mn.Z,{collectionViewType:i,collectionViewName:o}),icon:s()(Ts.F,{color:"regular",viewIcon:n,viewType:i}),showDragHandle:this.showDragHandle(),right:this.renderActionsPopup(),rightStyle:{marginRight:8}},t))}renderActionsPopup(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores,{collectionContextStore:o}=this.props;if(o.permissionScopes.state.canConfigureBlock)return s()(qe.Z,{popupType:e.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,renderOrigin:e=>d.createElement(Jt.Z,r()({icon:b.Z.dots},e)),render:this.renderActionMenu,buttonPopupStore:t})}showDragHandle(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,{device:o}=this.environment;return!o.isMobile&&t.canConfigureBlock}}Es.displayName="CollectionViewSelectItem";const Rs=(0,I.injectIntl)(Es),As=(0,I.defineMessages)({suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.collectionViewSuggestedViews.suggestedTitle",description:"Suggested views for your database."}});function Ds(e,t){const o=(0,so.O7)(),i=(0,lo.VK)((()=>e.collectionViewBlockStore()),[e]),n=(0,lo.VK)((()=>e.collectionStore()),[e]),a=(0,lo.VK)((()=>{var e;if(!n)return;const t=null===(e=n.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,G.vi)(t):void 0}),[n]),l=d.useCallback((n=>{if(!i||!a)return;const r=i.getParentStore();if(!r||"block"!==r.table&&"space"!==r.table&&"team"!==r.table)return;if(1!==n.dependencies.length)return;const s=n.dependencies[0];W.createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:o,perform:l=>{B.aT({environment:o,appParentStore:r,appUri:a.uri,features:[{type:"simple",featureUri:n.uri}],appCollectionViewBlockStores:[i],createOrModify:"modify",transaction:l});const c=(i.getFormat().app_uri_map??{})[s.uri];F.f8({environment:o,collectionContextStore:e,collectionViewId:c,isFullScreen:e.isFullScreen.get(),isRootChild:e.isRootChild.get(),isInPeekRenderer:e.isInPeekRenderer.get()}),t()}}),E.xb({environment:o,collectionContextStore:e,view_type:s.value.type,view_config_uri:n.uri})}),[o,e,i,a,t]);return{renderSuggestedView:d.useCallback((e=>({key:e.uri,render:t=>s()(it.Z,{placement:it.Z.Placement.Left,render:i=>((e,t)=>{const i=e.dependencies[0];return d.createElement(Xe.Z,r()({title:i.value.name?i.value.name:"New View",icon:ct.aW[i.value.type]({width:o.device.isMobile?16:14,backfaceVisibility:void 0})},t))})(e,{...t,...i,onMouseEnter:e=>{var o,n;null===(o=i.onMouseEnter)||void 0===o||o.call(i,e),null===(n=t.onMouseEnter)||void 0===n||n.call(t,e)}}),renderTooltip:()=>e.description}),action:()=>{l(e)}})),[l,o])}}function Fs(e){window.__c={n:"CollectionViewSuggestedViews"};const t=(0,so.O7)().device,o=e.suggestedViews,{renderSuggestedView:i}=Ds(e.collectionContextStore,e.onClose),{collectionContextStore:n,onClose:r,onNewEmptyViewClick:a}=e,l=(0,lo.VK)((()=>n.permissionScopes.state),[n]),c=(null==o?void 0:o.map((e=>i(e))))??[],p=s()(Je.Z,{type:Je.i.Vertical,initialFocus:0,sections:[{key:"suggested_views",render:e=>d.createElement(ot.Z,e),items:c}]}),u=l.canConfigureBlock&&s()(ot.Z,{topBorder:!0},void 0,s()(Ps.Z,{title:s()(I.FormattedMessage,{defaultMessage:"New empty view",id:"database.collectionViewSuggestedViews.newEmptyViewTitle",description:"Text for button to indicate creating a new empty view for a database"}),onClick:()=>{a("CollectionViewSuggestedViews2.handleNewEmptyViewClick"),r()},focused:!1}));return s()(gr.Z,{capture:!0,allowEsc:!0,render:e=>{let o;return o=t.isMobile?{menuType:Ke.og.Modal,title:ne.default.formatMessage(As.suggestedSectionTitle),right:s()(Qe.DoneMenuText,{}),onClickRight:r,...e}:{menuType:Ke.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e},d.createElement($e.Z,o,c.length&&s()(ot.Z,{title:!t.isMobile&&ne.default.formatMessage(As.suggestedSectionTitle),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:2,marginBottom:2},style:{paddingBottom:0}},void 0,p),u)}})}class Ls extends u.Z{constructor(){super(...arguments),this.initialMenuListFocus=0,this.storeTypes={menuListStore:Is.Z,viewFilterQueryStore:Ze.default.of("")},this.renderViewsSection=e=>{if(this.isDraggable()){const t=this.getFilteredViewStores().map((e=>e.id));return d.createElement(ot.Z,r()({},e,{children:s()(Ai.ZP,{direction:"vertical",keys:t,renderKey:o=>e.children[t.indexOf(o)],onDrop:this.handleViewsDrop})}))}return d.createElement(ot.Z,e)},this.renderViewMenuItem=(e,t)=>{const{collectionContextStore:o,onClose:i}=this.props;return s()(Rs,{collectionContextStore:o,collectionViewStore:e,onClose:i,menuListItemProps:t})},this.handleViewClick=(e,t)=>{const o=this.props.collectionContextStore.collectionViewStore();o&&this.props.onViewClick({currentCollectionViewStore:o,newCollectionViewStore:e,openInNew:t}),this.setCurrentView(e,t),t||this.props.onClose()},this.handleCreateButtonClick=()=>{this.props.onAddViewClick("CollectionViewSelect2.handleCreateButtonClick"),this.props.onClose()},this.handleViewsDrop=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore();o&&(W.createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:this.environment,perform:t=>{F.Wu({collectionViewBlockStore:o,newViewIds:e,transaction:t})}}),this.stores.menuListStore.reset())},this.handleViewFilterQueryChange=e=>{this.stores.viewFilterQueryStore.set(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.filterView=e=>(0,ee.D)(e,this.stores.viewFilterQueryStore.state)}willMount(e){var t,o;const{collectionContextStore:i}=e,n=null===(t=i.collectionViewStore())||void 0===t?void 0:t.id,r=((null===(o=i.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===n));r>=0&&(this.initialMenuListFocus=r),this.stores.viewFilterQueryStore.set("")}renderComponent(){const{intl:e,collectionContextStore:t,onClose:o,onAddViewClick:i}=this.props,{device:n}=this.environment,a=t.permissionScopes.state,l=s()(Ps.Z,{title:s()(I.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),onClick:this.handleCreateButtonClick,focused:!1});return s()(gr.Z,{capture:!0,allowEsc:!0,render:c=>{var p,u;let m;m=n.isMobile?{menuType:Ke.og.Modal,title:this.renderMenuTitle(),right:s()(Qe.DoneMenuText,{}),onClickRight:this.props.onClose,...c}:{menuType:Ke.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...c};const g=a.canConfigureBlock&&s()(ot.Z,{topBorder:!0},void 0,this.props.suggestedViews&&this.props.suggestedViews.length?s()(qe.Z,{popupType:this.environment.device.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,alignmentToOrigin:qe.Z.Alignment.Center,placementToOrigin:qe.Z.Placement.Right,renderOrigin:e=>d.createElement(Ps.Z,r()({title:s()(I.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),focused:!1},e)),render:()=>s()(Fs,{collectionContextStore:t,suggestedViews:this.props.suggestedViews??[],onClose:o,onNewEmptyViewClick:i})}):l);return d.createElement($e.Z,r()({},m,{header:!n.isMobile&&!(null!==(p=t.collectionViewBlockStore())&&void 0!==p&&p.isCollectionViewPageWithContent())&&s()(Yo.ZP,{value:this.stores.viewFilterQueryStore.get(),focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:this.handleViewFilterQueryChange,placeholder:e.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}),footer:!n.isMobile&&g}),s()(ot.Z,{title:!n.isMobile&&!(null!==(u=t.collectionViewBlockStore())&&void 0!==u&&u.isCollectionViewPageWithContent)&&this.renderMenuTitle(),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:0,marginBottom:0}},void 0,this.renderMenuList()),this.stores.viewFilterQueryStore.get()&&0===this.getFilteredViewStores().length&&s()(xs.Z,{caption:s()(I.FormattedMessage,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),n.isMobile&&g)}})}renderMenuList(){const e=this.getFilteredViewStores();if(e.length>0)return s()(Je.Z,{type:Je.i.Vertical,initialFocus:this.initialMenuListFocus,sections:[{key:"views",render:this.renderViewsSection,items:e.map((e=>({key:e.id,render:t=>this.renderViewMenuItem(e,t),action:t=>{let{event:o}=t;this.handleViewClick(e,te.DJ(o))}})))}],store:this.stores.menuListStore})}renderMenuTitle(){return s()(I.FormattedMessage,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:this.getViewStores().length}})}setCurrentView(e,t){F.f8({environment:this.environment,collectionContextStore:this.props.collectionContextStore,collectionViewId:e.id,openInNew:t,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer}),E.wd({environment:this.environment,collectionContextStore:this.props.collectionContextStore,action:"click_view_in_dropdown",new_view_type:e.getType(),new_view_id:e.id})}getViewStores(){var e;const{collectionContextStore:t}=this.props;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}getFilteredViewStores(){return this.getViewStores().filter(this.filterView)}isDraggable(){return this.showDragHandle()&&""===this.stores.viewFilterQueryStore.state}showDragHandle(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,{device:o}=this.environment;return!o.isMobile&&t.canConfigureBlock}}Ls.displayName="CollectionViewSelect";const Vs=(0,I.injectIntl)(Ls);var Ns=o(14976),Os=o(26991);class Us extends u.Z{constructor(){super(...arguments),this.storeTypes={popupOpen:Ze.default.of(!1)},this.renderPopup=()=>{const{device:e}=this.environment;let t;return t=e.isPhone?{menuType:Ke.og.Modal,right:s()(Qe.DoneMenuText,{}),onClickRight:this.handleClose}:{menuType:Ke.og.Popup,minWidth:220},d.createElement($e.Z,t,d.createElement(Zs,r()({},this.props,{onClose:this.handleClose})))},this.handleClick=e=>{const{collectionViewStore:t,collectionContextStore:o}=this.props,i=o.collectionViewStore();if(!i)return;const n=te.DJ(e);this.props.onViewClick({currentCollectionViewStore:i,newCollectionViewStore:t,openInNew:n}),i.id===t.id?this.stores.popupOpen.set(!0):this.setCurrentView(t.id,n),E.wd({environment:this.environment,collectionContextStore:o,action:"click_view_tab",new_view_type:t.getType(),new_view_id:t.id})},this.handleContextMenu=e=>{e.preventDefault(),(0,ie.ZP)({event:e,context:ie.Af.EditorContextMenu,callback:()=>{this.stores.popupOpen.set(!0)}})},this.handleClose=()=>{this.stores.popupOpen.set(!1)}}renderComponent(){var e;const{collectionViewStore:t,collectionContextStore:o}=this.props,{popupOpen:i}=this.stores,{device:n}=this.environment,a=this.getCurrentCollectionViewStore();if(!t.isDefined()||!a)return;const l=t.getType(),c=t.getFormat().collection_view_icon,p=a.id===t.id,u=(null===(e=o.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||"none";return s()(tt.ZP,{popupType:n.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,alignmentToOrigin:tt.ZP.Alignment.Start,open:i.state,render:this.renderPopup,onDismiss:this.handleClose,origin:s()("div",{className:X.rTm,style:{display:"flex",alignItems:"center",background:u,height:"100%",...p&&{borderBottom:`2px solid ${this.theme.regularTextColor}`,paddingTop:2}},onContextMenu:this.handleContextMenu},void 0,s()(Hs,{collectionViewStore:t,render:e=>d.createElement(et.Z,r()({key:t.id,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:M.Z.fontWeight.medium,color:p?this.theme.regularTextColor:this.theme.mediumTextColor,maxWidth:Gs},hovered:i.get(),onClick:this.handleClick},e),s()(Ts.F,{color:p?"regular":"light",viewIcon:c,viewType:l,style:{marginRight:6}}),s()("span",{style:{...M.Z.textOverflowStyle,marginTop:1}},void 0,s()(zs,{collectionContextStore:o,collectionViewStore:t})))}))})}setCurrentView(e,t){const{collectionContextStore:o}=this.props;F.f8({environment:this.environment,collectionContextStore:o,collectionViewId:e,openInNew:t,isFullScreen:o.isFullScreen.get(),isRootChild:o.isRootChild.get(),isInPeekRenderer:o.isInPeekRenderer.get()})}getCurrentCollectionViewStore(){return this.props.collectionContextStore.collectionViewStore()}}function Hs(e){window.__c={n:"CollectionViewTabTooltip"};const t=(0,co.Fg)(),{collectionViewStore:o,render:i}=e,n=(0,lo.VK)((()=>o.getCollectionStore()),[o]),r=(0,lo.VK)((()=>null==n?void 0:n.getModel()),[n]),a=(0,lo.VK)((()=>o.getModel()),[o]);return a?s()(it.Z,{placement:it.Z.Placement.Bottom,alignment:it.Z.Alignment.Start,delayThreshold:800,render:i,renderTooltip:()=>d.createElement(d.Fragment,null,s()("div",{},void 0,(0,ee.Cc)({collectionViewName:a.getName(),collectionViewType:a.getType()})),n&&r&&s()("div",{style:{color:t.mediumInvertedTextColor}},void 0,s()(I.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",description:"Tooltip shown on hover of a collection view tab, describing the type of view (e.g. Board) and the name of the collection. We need to be very pedantic with the view enumerations here, since simply appending view to view type doesn't work for all languages (like German)",id:"collectionTabBar.viewTab.tooltip",values:{viewType:ct.Bh[a.getType()],collection:(0,Ns.Xh)(n.getName(),n)||r.getEmptyTitlePlaceholder({getRecordModel:n.getRecordModel,userTimeZone:(0,ze.r)(),intl:ne.default.getIntl()})}})))}):null}function zs(e){window.__c={n:"CollectionViewTabTitle"};const{collectionViewStore:t,collectionContextStore:o}=e,i=(0,lo.Kw)(o.settingsStore),n=c().last(i.stack),r=(0,lo.VK)((()=>o.collectionViewStore()),[o]),a=(0,lo.VK)((()=>t.getCollectionStore()),[t]),l=(0,lo.VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===f.g3&&null!=a&&a.isDefined()?{name:(0,Os.fz)(o,t,a.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,a,o]);return!l||r&&r.id===t.id&&i.open&&n&&("duplicateExistingView"===n.type||"createViewSource"===n.type||"createView"===n.type)?s()(I.FormattedMessage,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):s()(Mn.Z,{collectionViewName:l.name,collectionViewType:l.type})}Us.displayName="CollectionViewTab";const Ws=(0,I.injectIntl)(Us);var js=o(78454);function Ks(e){window.__c={n:"WikiHomeOnboardingTooltip"};const{origin:t}=e,o=(0,so.O7)();return s()(sa.U,{origin:t,placementToOrigin:"bottom",header:s()(I.FormattedMessage,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!",description:"Header text that shows in the onboarding flow on the Home tab of a wiki database to introduce users to their converted wiki."}),content:s()(I.FormattedMessage,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content",description:"Text that describes shows in the wiki onboarding flow on the Home tab of a wiki, describing the new wiki features."}),onCloseClick:()=>{Ar.Rg(o)},shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:ca.EZ,pointerOffset:ca.rK,style:{width:ca.G5}})}function Ys(e){window.__c={n:"WikiViewsOnboardingTooltip"};const{origin:t}=e,o=(0,so.O7)();return s()(sa.U,{origin:t,placementToOrigin:"right",header:s()(I.FormattedMessage,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views",description:"Header text that shows in the onboarding flow on the database views dropdown menu of a wiki database to introduce users to their converted wiki."}),content:s()(I.FormattedMessage,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",description:"Text that shows in the wiki onboarding flow on the views dropdown menu of a wiki, describing the various views.",values:{bold:e=>s()("span",{style:{fontWeight:M.Z.fontWeight.semibold}},void 0,e)}}),onCloseClick:()=>{Ar.Rg(o)},pointerPosition:"50%",pointerLength:ca.EZ,pointerOffset:ca.FD,shouldDismissUponOutsideClick:!0,style:{width:ca.G5}})}const Gs=220;class Xs extends u.Z{constructor(){super(...arguments),this.viewSelectContainerSizeObserver=new Be.E({throttleMs:200}),this.viewIdWidthEstimatorMap=new Map,this.homeViewRef=d.createRef(),this.viewsDropdownRef=d.createRef(),this.storeTypes={buttonPopupStore:ue.Z},this.renderViewsPopup=(e,t)=>{var o;const{collectionContextStore:i}=this.props,{device:n}=this.environment,r=i.isFullScreen.get(),a=i.isRootChild.get(),l=i.isInPeekRenderer.get(),c=(null===(o=i.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===f.GZ;return d.createElement(d.Fragment,null,!n.isMobile&&"views"===Ar.B1()&&c&&s()(Ys,{origin:this.viewsDropdownRef}),d.createElement("div",{ref:this.viewsDropdownRef},s()(Vs,{collectionContextStore:i,onAddViewClick:this.handleAddViewClick,suggestedViews:t,onClose:e.close,isFullScreen:r,isRootChild:a,isInPeekRenderer:l,onViewClick:this.props.onViewClick})))},this.renderViewTab=e=>{const{collectionContextStore:t,onViewClick:o}=this.props;return s()(Ws,{collectionContextStore:t,collectionViewStore:e,onViewClick:o})},this.handleViewSelectContainerMount=e=>{e&&this.viewSelectContainerSizeObserver.observe(e)},this.handleViewTabsDrop=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore();o&&W.createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:this.environment,perform:t=>{F.Wu({collectionViewBlockStore:o,newViewIds:e,transaction:t})}})},this.renderSuggestedViewsPopup=(e,t)=>{const{collectionContextStore:o}=this.props;return s()(Fs,{collectionContextStore:o,suggestedViews:t,onClose:e.close,onNewEmptyViewClick:this.handleAddViewClick})},this.handleAddViewClick=e=>{const{collectionContextStore:t}=this.props;W.createAndCommit({userAction:e,environment:this.environment,perform:e=>{F.ME({environment:this.environment,collectionContextStore:t,transaction:e})}}),E.xb({environment:this.environment,collectionContextStore:t,view_type:"table"})},this.handleMoreViewsClick=()=>{const{collectionContextStore:e}=this.props;E.wd({environment:this.environment,collectionContextStore:e,action:"click_views_dropdown"})},this.renderStateStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,showHoverActionsStore:o}=this.props,{device:i}=this.environment,n=this.getViewStores(),r=this.showViewTabsStore.state,a=(null==r?void 0:r.length)||0,s=n.length-a,l=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent())||i.isPhone||r&&(0===a||1===a&&n.length>1)?"dropdown":s>0?"someTabsNotVisible":"allTabsVisible",c=t.isFullScreen.get()||o.state;return{showMoreViewsButton:"someTabsNotVisible"===l||"dropdown"===l,showAddViewButton:this.shouldAttemptToShowAddViewButton()&&"allTabsVisible"===l,addViewButtonAnimatedIn:c,viewSelectState:l,moreViewsCount:s}})),this.showViewTabsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=this.getViewStores(),o=e.collectionViewStore();if(!o)return;let i=this.viewSelectContainerSizeObserver.rect.get().width-100-(this.shouldAttemptToShowAddViewButton()?105:0);const n=[],r=this.measureViewTabWidth(o);if(!(r<i))return n;n.push(o),i-=r;for(const l of t)if(l.id!==o.id){const e=this.measureViewTabWidth(l);if(!(e<i))break;n.push(l),i-=e}const a=n.filter((e=>e.id!==o.id)),s=t.findIndex((e=>e.id===o.id));return a.splice(s,0,o),a}))}willUnmount(){super.willUnmount(),this.viewSelectContainerSizeObserver.destroy()}renderComponent(){const e=this.renderStateStore.state,t=this.getSuggestedViewsForTypedDB();return d.createElement("div",{style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1},ref:this.handleViewSelectContainerMount},this.renderViewTabs(),e.showMoreViewsButton&&s()(qe.Z,{popupType:this.environment.device.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,render:e=>this.renderViewsPopup(e,t),renderOrigin:e=>this.renderViewSelectButton(e),onClick:this.handleMoreViewsClick}),e.showAddViewButton&&s()(Ln.Z,{isVisible:!0,animationStyle:{opacity:e.addViewButtonAnimatedIn?1:0},render:()=>t&&t.length?s()(qe.Z,{popupType:qe.Z.PopupType.Popup,alignmentToOrigin:js.v2.Center,render:e=>this.renderSuggestedViewsPopup(e,t),renderOrigin:e=>d.createElement(Jt.Z,r()({className:X.rVO,icon:b.Z.plus},e))},"suggested-views"):s()(Jt.Z,{className:X.rVO,icon:b.Z.plus,onClick:()=>this.handleAddViewClick("CollectionViewTabBar.handleAddViewClick")})}))}renderViewSelectButton(e){var t;const{collectionContextStore:o}=this.props,{device:i}=this.environment,n=this.renderStateStore.state,a=this.getCurrentCollectionViewStore();if(!a)return;if(!a.isDefined())return;const l=(null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri)===f.GZ&&"page"===a.getType();if("dropdown"===n.viewSelectState){const t=a.getType(),n=a.getFormat().collection_view_icon;return d.createElement(d.Fragment,null,!i.isMobile&&l&&"home"===Ar.B1()&&s()(Ks,{origin:this.homeViewRef}),s()(Hs,{collectionViewStore:a,render:i=>d.createElement(et.Z,r()({ref:this.homeViewRef,style:{display:"flex",alignItems:"center",fontSize:M.Z.fontSize.UIRegular.desktop,fontWeight:M.Z.fontWeight.semibold,color:this.theme.regularTextColor,maxWidth:Gs}},e,i),s()(Ts.F,{color:"regular",viewType:t,viewIcon:n,style:{marginRight:6}}),s()("span",{style:{...M.Z.textOverflowStyle,marginRight:6,marginTop:1}},void 0,s()(zs,{collectionContextStore:o,collectionViewStore:a})),b.Z.chevronDown({marginTop:2,width:10,height:10,fill:this.theme.lightIconColor}))}))}return"someTabsNotVisible"===n.viewSelectState?d.createElement(et.Z,r()({style:{display:"flex",alignItems:"center",fontSize:M.Z.fontSize.UIRegular.desktop,color:this.theme.mediumTextColor}},e),s()("span",{style:{marginTop:1}},void 0,s()(I.FormattedMessage,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:n.moreViewsCount}}))):void 0}renderViewTabs(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,o=this.showViewTabsStore.state,i=this.renderStateStore.state;if(o&&"dropdown"!==i.viewSelectState)return t.canConfigureBlock?s()(Ai.ZP,{direction:"horizontal",keys:o.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const t=o.find((t=>t.id===e));if(t)return this.renderViewTab(t)},onDrop:this.handleViewTabsDrop}):o.map(this.renderViewTab)}shouldAttemptToShowAddViewButton(){const{collectionContextStore:e,isPlaceholderExternalCollectionStore:t}=this.props;return e.permissionScopes.state.canConfigureBlock&&!t.state}measureViewTabWidth(e){const t=e.getName(),o=e.getType();if(!o)return 0;let i=this.viewIdWidthEstimatorMap.get(e.id);i||(i=new Ms({style:{fontSize:`${M.Z.fontSize.UIRegular.desktop}px`,fontWeight:M.Z.fontWeight.medium}}),this.viewIdWidthEstimatorMap.set(e.id,i));const n=(0,ee.Cc)({collectionViewName:t,collectionViewType:o}),r=i.measure(n);return Math.min(40+r.width,Gs)}getViewStores(){var e;return(null===(e=this.getCurrentCollectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}getCurrentCollectionViewBlockStore(){return this.props.collectionContextStore.collectionViewBlockStore()}getCurrentCollectionViewStore(){return this.props.collectionContextStore.collectionViewStore()}getSuggestedViewsForTypedDB(){const e=this.props.collectionContextStore.collectionStore(),t=this.props.collectionContextStore.collectionViewBlockStore();if(!e||!t)return;const o=e.getFormat().app_config_uri,i=o?(0,G.vi)(o):void 0;return i?(0,G.AG)(i,e,t):void 0}}Xs.displayName="CollectionViewTabBar";const qs=(0,I.injectIntl)(Xs);var $s=o(35127),Js=o(42922),Qs=o(74194),el=o(18647),tl=o(76745),ol=o(22789),il=o(57079),nl=o(95691);const rl=40,al=(0,I.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"},openAutomationsSettingsButtonTooltip:{defaultMessage:"Create or view an automation",description:"Tooltip message for the automation button",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create or view an automation",description:"Aria label for the automation button",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},openFullscreenPageButtonTooltip:{defaultMessage:"Open as full page",description:"Tooltip message for the open fullscreen page button in a collection block",id:"database.collectionViewBlock.openFullscreenPageButton.tooltip"}});class sl{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t)=>{let o=!0;this.didEmit||(this.didEmit=!0,o=!1),this.lastValue===t?o=!1:this.lastValue=t,o&&this.onEmit()},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=de.Z.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&de.Z.removeListener(this.listener,this.environment)}}class ll extends Ee.Z{constructor(){super(...arguments),this.isCollectionViewBlock=!0,this.collectionContextStore=new ge.Z(this.environment),this.headerSizeObserver=new Be.E,this.headerEl=null,this.horizontalScrollerEl=null,this.timelineViewRef=d.createRef(),this.parentNode=void 0,this.subscriptions=new Map,this.collectionTypeChangeSubscription=void 0,this.queuedCollectionEmit=!1,this.syncStateTimeout=void 0,this.switchViewMetric=void 0,this.storeTypes={collectionContextStore:ge.Z,mouseStore:ke.Z,headerMouseStore:ke.Z,focusStore:Ze.default.of(!1),noDateResultStore:Ze.default.of(void 0),templateButtonPopupStore:ue.Z,filterBarSettingsStore:Ze.default.of({open:!1,stack:[]}),createFilterButtonPopupStore:ue.Z,createFilterSettingsStore:Ze.default.of({open:!1,stack:[]}),filterBarCreateFilterSettingsStore:Ze.default.of({open:!1,stack:[]}),createSortSettingsStore:Ze.default.of({open:!1,stack:[]}),viewSettingsPlacementStore:Ze.default.of(void 0),saveControlMoreActionsButtonPopupStore:ue.Z},this.renderCreateFilterPopup=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores;return s()(jn.Z,{context:jn.H.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderCreateSortPopup=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;return s()(jn.Z,{context:jn.H.TopbarSortPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderViewSettings=()=>{const e=this.isInPeekRenderer(),t=(0,ee.Ks)(this.props.store)?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state;if(t)return d.createElement(Cs,r()({collectionContextStore:this.collectionContextStore,headerSizeObserver:this.headerSizeObserver,placementStore:this.stores.viewSettingsPlacementStore,isInPeekRenderer:e},t))},this.renderTemplatesPopup=()=>{const{collectionContextStore:e}=this,{store:t}=this.props,o=e.collectionStore();if(o){if(ve.Z.state.online){const i=e.permissionScopes.state;return s()(Gn.Z,{isOverlay:!0,collectionStore:o,canConfigureCollection:i.canConfigureCollection,onEmptyPageClick:this.handleTemplateEmptyPageClick,onEmptyEnter:this.handleTemplateEmptyPageClick,onTemplateClick:this.handleTemplateClick,onCancelClick:this.handleTemplateCancelClick,locked:t.isLocked()})}return s()("div",{style:{fontSize:14,color:this.theme.mediumTextColor,width:280,padding:8}},void 0,s()(I.FormattedMessage,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"}))}},this.renderNoDatePopup=e=>{const{collectionContextStore:t}=this,o=this.noDateTotal.state,i=t.collectionStore(),n=t.collectionViewStore(),r=this.getNoDateProperty();if(!i||!n||!r)return;const a=n.getType(),l=n.getName();return!n.isDefined()||"timeline"!==a&&"calendar"!==a?void 0:s()(xn,{collectionStore:i,collectionViewId:n.id,property:r,onClose:e.close,onAddPage:this.handleNoDateAddPage,collectionViewType:a,collectionViewName:l,collectionContextStore:t,noDateTotal:o})},this.handleViewSettingsClick=e=>{(0,ie.ZP)({event:e,context:ie.Af.CollectionSettingsClick,callback:this.handleViewSettingsClickInner}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_view_settings"}),this.projManagementTooltipTourComplete()},this.handleViewSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.get().open,i=(0,he.n)(t);o&&"main"===(null==i?void 0:i.type)?A.E3({collectionSettingsStore:t}):A.r$({collectionContextStore:e,collectionSettingsStore:t})},this.handleViewAutomationSettingsClick=e=>{(0,ie.ZP)({event:e,context:ie.Af.CollectionAutomationSettingsClick,callback:this.handleViewAutomationSettingsClickInner})},this.handleViewAutomationSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.get().open,i=(0,he.n)(t);o&&"automationSettings"===(null==i?void 0:i.type)?A.E3({collectionSettingsStore:t}):(A.r$({collectionContextStore:e,collectionSettingsStore:t}),A.wl({collectionSettingsStore:t,item:{type:"automationSettings"}}))},this.handleViewClick=e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:i}=e;if(t.id!==o.id&&!i){const e=t.getType(),i=o.getType();var n;if(e&&i)this.switchViewMetric={from:e,to:i,startTime:performance.now(),sizeHintAtStart:null===(n=this.collectionContextStore.remoteResult.state)||void 0===n?void 0:n.sizeHint}}},this.handleFilterClick=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores,o=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0,i=e.currentPropertyFiltersStore.state,n=e.filtersBarOpenStore.state;n||i.length>0||o?e.filtersBarOpen.set(!n):A.wl({collectionSettingsStore:t,item:{type:"createFilter"}}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_filter"})},this.handleSortClick=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;this.hasSort.state?(e.filtersBarOpen.set(!0),A.wl({collectionSettingsStore:e.filterBarSortSettingsStore,item:{type:"sort"}})):A.wl({collectionSettingsStore:t,item:{type:"createSort"}}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_sort"})},this.handleCreateFilterPopupDismiss=()=>{const{createFilterSettingsStore:e}=this.stores;A.E3({collectionSettingsStore:e})},this.handleCreateSortPopupDismiss=()=>{const{createSortSettingsStore:e}=this.stores;A.E3({collectionSettingsStore:e})},this.handleCollectionEmit=()=>{var e;if(Me.Z.state.isVisible){if(!Ie.default.isMiniOrCenterPeekOpen()||null!==(e=Ie.default.peekTarget.state)&&void 0!==e&&e.uiContains(this.props.store))return this.throttledRefetch({src:"msg"});this.queuedCollectionEmit=!0}else this.queuedCollectionEmit=!0},this.handleRefetch=async e=>{const t=ye.default.getEligibleGroup({experimentId:"collection_client_refetch_throttle_time_ms",defaultGroup:"control"}),o="control"===t?1e3:parseInt(t);await Promise.all([F.dj(this.environment,this.collectionContextStore,e),(0,k.Vs)(o)])},this.throttledRefetch=(0,h.Z)((e=>this.handleRefetch({...e,queuedTimestamp:Date.now()}))),this.handlePageVisibilityChange=()=>{this.shouldRefetch()&&(this.queuedCollectionEmit=!1,this.throttledRefetch({src:"page_show"}))},this.handlePeekViewChange=()=>{this.shouldRefetch()&&(this.queuedCollectionEmit=!1,this.throttledRefetch({src:"exit_peek"}))},this.shouldRefetch=()=>{if(!Ie.default.isMiniOrCenterPeekOpen()&&Me.Z.state.isVisible&&this.queuedCollectionEmit)return!0},this.handleHeaderMount=e=>{e&&this.headerSizeObserver.observe(e),this.headerEl=e},this.handleHorizontalScrollerMount=e=>{e&&(this.horizontalScrollerEl=e)},this.handleEditorMouseDown=e=>{const{device:t}=this.environment,o=this.getCurrentCollectionViewStore();if(!o||t.isMobile)return;const i=o.getType();i&&(0,ie.ZP)({event:e,context:ie.Af.EditorMouseDown,callback:()=>{e.preventDefault(),V.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===i||"table"===i})}})},this.handleEditorClick=(e,t)=>{(0,ie.ZP)({event:e,context:ie.Af.EditorClick,callback:()=>{if(this.isInPeekRenderer()||L.E5(this.environment),"page"===t&&!ae.X9()){const{clientX:t,clientY:o,target:i}=e;m.default.afterNextFlush((()=>{W.createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:this.environment,perform:e=>{z.jh(this.environment,{x:t,y:o,target:i instanceof Element?i:void 0},e)}})}))}}})},this.handleFocusIn=e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,g.E)(t)&&this.stores.focusStore.setState(!0)},this.handleFocusOut=()=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=()=>{Se.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleHeaderMouseMove=()=>{Se.Z.state||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleLoadedStoreChange=()=>{if(!this.isLoadedStore.state||!this.componentIsMounted||this.collectionContextStore.wasCreatedThisSession.get()||!this.isFullScreen())return;const e=this.environment.RouterStore.state;let t;if("page"===e.route.name&&(t=e.route.mobileData),ce.default.initialRenderCompleted){if(ce.default.lastNavigationTime&&ce.default.lastNavigationTimePerformance&&!ce.default.lastNavigationRenderCompleted){const e=ce.default.lastNavigationTime,o=ce.default.lastNavigationTimePerformance;ce.default.setLastNavigationRenderCompleted(),m.default.afterNextFlush((()=>{var i,n;ce.default.lastNavigationTime&&ce.default.emit(this.environment,{type:"navigation_database_render",startDateTime:e,startPerformanceTime:o},{is_push:(null===(i=t)||void 0===i?void 0:i.isPush)??!1,collectionViewType:null===(n=this.collectionContextStore.collectionViewStore())||void 0===n?void 0:n.getType()})}))}}else ce.default.setInitialRenderCompleted(),m.default.afterNextFlush((()=>{var e,o;ce.default.emit(this.environment,{type:"initial_database_render",startDateTime:ce.default.appStartTime,startPerformanceTime:ce.default.appStartTimePerformance},{is_push:(null===(e=t)||void 0===e?void 0:e.isPush)??!1,collectionViewType:null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType()})}))},this.handleSearchButtonClick=()=>{this.collectionContextStore.searchOpen.set(!0),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_search"})},this.handleSearchQueryChange=e=>{F.Ug({searchQuery:e.target.value,collectionContextStore:this.collectionContextStore,isFullScreen:Boolean(this.props.isFullScreen)}),P.trackCollectionSearch(this.environment,{view_type:this.getCurrentViewType()})},this.handleSearchBlur=()=>{this.collectionContextStore.searchQuery.get()||this.handleClearSearch()},this.handleSearchKeyDown=e=>{27===e.keyCode&&this.handleClearSearch()},this.handleClearSearch=()=>{this.collectionContextStore.searchQuery.set(""),this.collectionContextStore.searchOpen.set(!1)},this.handleAddItemClick=()=>{W.createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:this.environment,perform:e=>{this.createItem({transaction:e,coerce:!0,from:"cvb_add_item"})}}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_new_item"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplatesDropdownClick=()=>{E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_templates_dropdown"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplateClick=e=>{W.createAndCommit({userAction:"CollectionViewBlock.handleTemplateClick",environment:this.environment,perform:t=>{const o=this.createItem({transaction:t,coerce:!1,from:"cvb_template"});D.ob({title:"template",environment:this.environment,store:o,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"collection_view_block"})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateEmptyPageClick=()=>{W.createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:this.environment,perform:e=>{this.createItem({transaction:e,coerce:!1,from:"cvb_template_empty_page"})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateCancelClick=()=>{this.stores.templateButtonPopupStore.reset()},this.handleSetSourceClick=()=>{const{collectionContextStore:e}=this,t=e.settingsStore;this.isPlaceholderExternalCollectionStore.state?A.NG({collectionSettingsStore:t}):(A.r$({collectionContextStore:e,collectionSettingsStore:t}),E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_select_data_source"}))},this.handleNoDateAddPage=e=>{const{collectionContextStore:t}=this,o=this.getCollectionStore(),i=this.getCurrentCollectionViewStore(),n=this.timelineViewRef.current;if(!i||!o)return;if(!i.isDefined())return;const{performResult:r}=W.createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:this.environment,perform:r=>"calendar"===i.getType()?Z.Fv({environment:this.environment,store:e,collectionStore:o,collectionContextStore:t,startDayOfWeek:Y.AK.state,results:this.getDefaultResults(),transaction:r}):n?n.addBlockToView({store:e,transaction:r}):void 0});r&&H.Z5({environment:this.environment,stores:[r]})},this.handleOpenAsPageClick=()=>{P.trackOpenCollectionAsPage(this.environment,{view_type:this.getCurrentViewType()})},this.handleNoDateButtonClick=()=>{E.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_no_date"})},this.initializeSyncStatePolling=async()=>{if(this.isSyncingStore.state){const e=this.getCollectionStore(),t=null==e?void 0:e.getFormat().uri,o=null==e?void 0:e.getFormat().bot_id,i=null==e?void 0:e.id;if(!t||!o||!i)return;await this.pollSyncState({uri:t,botId:o,collectionId:i})}},this.pollSyncState=async e=>{const t=await x.getExternalCollectionSyncState(this.environment,e);if("success"===t.type&&t.data.result){const o=t.data.result,i=this.collectionContextStore.numberChildrenReceived,n=this.collectionContextStore.numberChildrenUnfurled;i.set(o.numberChildrenReceived),n.set(o.numberChildrenUnfurled),n.state/i.state<1&&(this.syncStateTimeout=setTimeout((async()=>{await this.pollSyncState(e)}),1e4))}},this.subscribeToCollection=e=>{if(this.subscriptions.has(e))return;const t=new sl(this.environment,(0,w.jY)(e),this.handleCollectionEmit);t.subscribe(),this.subscriptions.set(e,t)},this.subscribeToTypeChanges=()=>{const e=this.collectionContextStore.contextType,t=this.collectionContextStore.databaseType;if("collectionTypedView"!==e||!t||this.collectionTypeChangeSubscription)return;const o=new sl(this.environment,(0,w.JY)({spaceId:this.props.store.getSpaceId(),databaseType:t}),this.handleCollectionEmit);o.subscribe(),this.collectionTypeChangeSubscription=o},this.isSyncingStore=this.createComputedStore((()=>{var e;const t=this.getCollectionStore(),o=null==t?void 0:t.isSyncedCollection(),i=!0===(null==t||null===(e=t.getFormat().sync_state)||void 0===e?void 0:e.syncing),n=this.environment.device.isMobile;return Boolean(o&&i&&!n)})),this.shouldRestrictHeaderWidthForMarginComments=()=>this.isRootOrDirectChild()&&!(0,ee._5)(this.props.store)&&this.marginCommentsVisible.state,this.shouldRenderOptions=()=>void 0!==this.collectionContextStore.collectionStore()||"collectionTypedView"===this.collectionContextStore.contextType,this.shouldRestrictWidthForMarginComments=this.createComputedStore((()=>{const e=this.getCurrentCollectionViewStore(),t=null==e?void 0:e.getType();return this.shouldRestrictHeaderWidthForMarginComments()&&t&&(ee.bu.has(t)||"timeline"===t&&this.collectionContextStore.collectionStore()&&!(0,Q.C1)({environment:this.environment,format:this.collectionContextStore.normalizedFormatStore.state,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild()}))})),this.isPlaceholderExternalCollectionStore=this.createComputedStore((()=>{const e=this.getCollectionStore();return!!e&&(0,y.OY)(e.getValue())})),this.getExternalIntegrationId=this.createComputedStore((()=>{const e=this.getCollectionStore();if(e)return e.getFormat().integration_id})),this.leftRightPadding=this.createComputedStore((()=>{const{store:e,isFullScreen:t,overridePaddingLeft:o,overridePaddingRight:i}=this.props,n=(0,ee.Bs)({environment:this.environment,store:e,isFullScreen:t,sizeObserver:this.headerSizeObserver});n&&void 0!==o&&(n.paddingLeft=o),n&&void 0!==i&&(n.paddingRight=i);const r=this.shouldRestrictWidthForMarginComments.state;return n&&r&&(n.paddingRight+=(0,re.gC)(this.environment,(0,ee.en)(e),this.isInFrameWhenSidePeekOpen.state)),n})),this.isLoadedStore=this.createComputedStore((()=>{const{localResultStore:e}=this.collectionContextStore;return Boolean(this.collectionContextStore.remoteResult.get()&&e.state)})),this.leftRightMargin=this.createComputedStore((()=>{if(!this.isRootOrDirectChild()||!this.marginCommentsVisible.state||!(0,ee._5)(this.props.store)||this.props.store.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};const e=re.QB/2;return{marginLeft:e,marginRight:-e}})),this.noDateTotal=this.createComputedStore((()=>{if(this.noDateReducerStore.state){const e=this.stores.noDateResultStore.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}return 0})),this.noDateReducerStore=this.createComputedStore((()=>{const e=this.getNoDateProperty();if(e){return{type:"aggregation",filter:{operator:"and",filters:[{property:e,filter:{operator:"is_empty"}}]},aggregation:{aggregator:"count"}}}})),this.hasAppliedFilter=this.createComputedStore((()=>(0,q.RL)(this.collectionContextStore).length>0)),this.hasSort=this.createComputedStore((()=>{const{collectionContextStore:e}=this;return e.currentSortsStore.state.length>0})),this.showHoverActionsStore=this.createComputedStore((()=>{const{device:e}=this.environment,{mouseStore:t,headerMouseStore:o,focusStore:i,createSortSettingsStore:n,createFilterSettingsStore:r,filterBarCreateFilterSettingsStore:a,saveControlMoreActionsButtonPopupStore:s}=this.stores,{collectionContextStore:l}=this,c=this.isFullScreen(),d=i.get(),p=l.settingsStore.get().open,u=l.searchOpen.get(),m=n.get().open,g=r.get().open,h=a.get().open,f=l.filterBarSortSettingsStore.get().open,v=Array.from(l.filterBarItemSettingsStoreMap.values()),y=s.state.open,b=v.some((e=>e.get().open));return Boolean(t.state.mouseEntered||o.state.mouseEntered||d||c||e.isMobile||p||b||m||g||h||u||y||f)})),this.showCompactDesktopHeaderStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.headerSizeObserver.rect.get();return!e.isMobile&&t.width&&t.width<400})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>(0,ee.Ks)(this.props.store)))}insertBlocks(e,t){const o=this.getCollectionStore();if(o)for(const i of e)R.mp({environment:this.environment,store:i,collectionStore:o,collectionContextStore:this.collectionContextStore,coerce:!0,groupsPointer:[],results:this.getDefaultResults(),transaction:t});return[]}handleCreated(){H.ZH(this.environment),m.default.afterNextFlush((()=>{const{collectionContextStore:e}=this,t=e.collectionStore(),o=e.collectionViewBlockStore(),i=e.settingsStore;if(!o)return;const n=o.getCollectionViewSourceCollectionStore();if(this.isPlaceholderExternalCollectionStore.state)A.NG({collectionSettingsStore:i});else if(n)F.W1({environment:this.environment,collectionContextStore:e});else if(t)A.r$({collectionContextStore:e,collectionSettingsStore:i}),(0,Kn.V)({collectionStore:t,collectionContextStore:e,collectionSettingsStore:i});else{const t=ye.default.checkGate("typed_db_creation");A.r$({collectionContextStore:e,collectionSettingsStore:i}),t?A.wl({collectionSettingsStore:i,item:{type:"createTypedDB"}}):A.wl({collectionSettingsStore:i,item:{type:"createViewSource"}})}}))}willMount(e){super.willMount(e),this.trackRenderTime({isFirstRender:!0}),this.isLoadedStore.addListener(this.handleLoadedStoreChange),this.handleLoadedStoreChange()}willMountOrUpdate(e){super.willMountOrUpdate(e);const{store:t}=e,o=t.id,{collectionContextStore:i}=this,n=this.collectionContextStore.collectionViewStore(),r=this.collectionContextStore.collectionStore(),a=this.environment.currentUser.id,s=n?n.id:void 0,l=r?r.id:void 0,c=this.getViewStores().map((e=>e.id)),d=this.getDefaultCollectionViewStore(),p=S.Z.get({userId:a,key:ge.Z.getLocalViewPreferenceKey(o)});let u;if(e.viewId&&c.indexOf(e.viewId)>=0?u=e.viewId:n&&c.indexOf(n.id)>=0?u=n.id:p&&c.indexOf(p)>=0?u=p:d&&c.indexOf(d.id)>=0&&(u=d.id),u){const e=Pe.Xr.createChildStore(t,{table:_.n,id:u}),n=e.getCollectionStore(),r=!n||n.isDefined();e.isDefined()&&r&&(u!==p&&S.Z.set({userId:a,key:ge.Z.getLocalViewPreferenceKey(o),value:u}),(u!==s||n&&n.id!==l)&&F.mc({environment:this.environment,collectionViewBlockStore:t,collectionViewStore:e,collectionStore:n,collectionContextStore:i,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild(),isInPeekRenderer:this.isInPeekRenderer()}))}const m=i.collectionStore();if(m){m.getTemplatePageStores().map((e=>e.getValue()))}this.isSyncingStore.addListener(this.initializeSyncStatePolling),this.ensureStoreListeners()}willUpdate(){this.trackRenderTime({isFirstRender:!1})}didMount(){super.didMount(),Me.Z.addListener(this.handlePageVisibilityChange),Ie.default.addListener(this.handlePeekViewChange);const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.collectionStore();if(e&&t){const o=e.getType();o&&P.trackDatabaseVisit(this.environment,{collection_id:t.id,collection_view_id:e.id,collection_view_block_id:this.props.store.id,type:o,is_full_screen:this.isFullScreen(),is_peek:this.isInPeekRenderer(),peek_mode:Ie.default.state.mode})}if(e&&"collectionTypedView"===this.collectionContextStore.contextType){const t=this.collectionContextStore.databaseType,o=we.Z.state.userHomePageId,i=e.getType();t&&i&&P.trackTypeAggregatedDatabaseVisit(this.environment,{collection_view_id:e.id,collection_view_block_id:this.props.store.id,type:i,databaseType:t,is_my_tasks:o===this.props.store.id})}}didMountOrUpdate(){const e=this.getCollectionStore();var t;(e&&this.subscribeToCollection(e.id),this.collectionContextStore.remoteCollectionIds.addListener((e=>e.state.forEach((e=>this.subscribeToCollection(e))))),this.subscribeToTypeChanges(),this.parentNode)||(this.parentNode=null===(t=p.findDOMNode(this))||void 0===t?void 0:t.parentElement,this.parentNode&&((0,te.lj)(this.parentNode,"focusin",this.handleFocusIn),(0,te.lj)(this.parentNode,"focusout",this.handleFocusOut),(0,te.lj)(this.parentNode,"mousemove",this.handleMouseMove),(0,te.lj)(this.parentNode,"mouseleave",this.handleMouseLeave)))}didUpdate(e){this.trackSwitchViewLag()}willUnmount(){super.willUnmount();const{collectionContextStore:e}=this;F.ob({collectionContextStore:e}),this.unsubscribeAll(),this.headerSizeObserver.destroy(),Me.Z.removeListener(this.handlePageVisibilityChange),Ie.default.removeListener(this.handlePeekViewChange),this.isLoadedStore.removeListener(this.handleLoadedStoreChange),this.parentNode&&((0,te.ZV)(this.parentNode,"focusin",this.handleFocusIn),(0,te.ZV)(this.parentNode,"focusout",this.handleFocusOut),(0,te.ZV)(this.parentNode,"mousemove",this.handleMouseMove),(0,te.ZV)(this.parentNode,"mouseleave",this.handleMouseLeave)),this.isSyncingStore.removeListener(this.initializeSyncStatePolling),clearTimeout(this.syncStateTimeout)}renderPersisted(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=this.getCollectionStore(),i=e.normalizedSchemaStore.state,n=e.normalizedQueryStore.state,r=e.normalizedFormatStore.state,a=this.isFullScreen();if(!(t&&i&&n&&r))return;const l=t.getType();if(!l)return;if(o&&!o.isDefined())return;if(this.isCollectionViewOfExternalCollectionWithoutExternalObjectId())return s()(j.L1,{value:this.collectionContextStore},void 0,d.createElement(Fn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,onClick:this.handleEditorClick,ref:this.handleHeaderMount},s()(yo.Z,{store:this.props.store,shouldShowHoverMenu:!0,analyticsName:this.collectionViewTypeToAnalyticsType(l),shouldShowHalo:!this.isFullScreen(),canSelect:!this.isFullScreen()},void 0,s()(tl.Z,{store:this.props.store,style:{width:"auto"},disabled:!1}))));const c=(0,le.$3)(this.environment)-Y.CC,p=this.isInFrameWhenSidePeekOpen.state&&!this.props.isFullScreen&&!(0,ee._5)(this.props.store)&&c>0,u=d.createElement(el.Z,{type:(0,Y.p5)({environment:this.environment,isFullScreen:this.isFullScreen()}),className:X.x9t,onMouseDown:this.handleEditorMouseDown,preventType:O.Q7(this.environment),onClick:e=>this.handleEditorClick(e,l),style:this.getScrollerStyle(l,r,p?c/2:void 0),ref:this.handleHorizontalScrollerMount},this.renderView(o,t,l,i,n,r)),m={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state},g=a?d.createElement(d.Fragment,null,s()("div",{style:{position:"sticky",height:0,left:0,zIndex:T.Nm}},void 0,this.renderViewSettings()),s()(Fn.p,{allowSelectionWithin:!0,style:{...m,position:"relative"}},void 0,u)):s()(Fn.p,{allowSelectionWithin:!0,style:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state,...p&&{marginLeft:-c/2}}},void 0,s()("div",{style:{position:"relative"}},void 0,u,this.renderViewSettings()));return s()(j.L1,{value:this.collectionContextStore},void 0,this.renderMultiSelectToolbar(),this.renderHeader(l),g,this.renderBottomBorderForViewSettings())}renderHeader(e){var t,o,i;const{device:n}=this.environment,{store:r,disableHoverMenu:a}=this.props,l=this.isFullScreen(),c=this.noDateReducerStore.state,p=this.showHoverActionsStore.state,u=this.showCompactDesktopHeaderStore.state,m=null===(t=fe.Z.state)||void 0===t?void 0:t.collectionSettingsStore.state.open,g=this.leftRightPadding.state,h=(null===(o=this.collectionContextStore.collectionViewBlockStore())||void 0===o?void 0:o.isCollectionViewPageWithContent())&&"page"===(null===(i=this.collectionContextStore.collectionViewStore())||void 0===i?void 0:i.getType()),f=this.shouldShowProjManagementTooltipTour()&&!Ie.default.state.open?s()(Bn.Z,{origin:this.renderViewSettingsButton(),isFirstTooltip:!1,phase:"click_view_settings",alignment:"bottom"}):this.renderViewSettingsButton();return d.createElement(Fn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount},g&&s()(yo.Z,{store:r,shouldShowCopyLinkButton:r.isLocked(),shouldShowHoverMenu:!a&&this.canEdit()&&!l,analyticsName:this.collectionViewTypeToAnalyticsType(e)},void 0,n.isPhone?s()("div",{style:this.getHeaderStyle()},void 0,this.renderViewTabBar(),!this.props.hideHeaderActions&&s()(Ln.Z,{isVisible:!0,animationStyle:{opacity:p?1:0},render:()=>s()("div",{style:{display:"flex",alignItems:"center"}},void 0,this.renderLoadingSpinner(),this.renderFullScreenButton(),this.renderAutomationSettingsButton(),f,this.renderAddItemButton())})):s()("div",{style:this.getHeaderStyle()},void 0,this.renderViewTabBar(),!m&&!this.props.hideHeaderActions&&s()(Ln.Z,{isVisible:!0,animationStyle:{opacity:p?1:0},render:()=>s()("div",{style:{display:"flex",alignItems:"center",gap:2}},void 0,this.renderLoadingSpinner(),!u&&this.renderLockIndicator(),!u&&this.renderNoDateButton(),!u&&"page"!==e&&this.renderFilterButton(),!u&&"page"!==e&&this.renderSortButton(),this.renderAutomationSettingsButton(),!u&&"page"!==e&&this.renderSearch(),h&&this.renderPageViewSearch(),this.renderFullScreenButton(),f,this.renderAddItemButton())})),c&&s()(Ge.Z,{id:"no_date_count",collectionContextStore:this.collectionContextStore,reducer:c,resultStore:this.stores.noDateResultStore})),s()("div",{style:this.getHeaderPositioningStyle()},void 0,this.renderSource(),this.renderFilterBar()))}renderLockIndicator(){const{device:e}=this.environment,{store:t}=this.props;if(!this.isFullScreen()&&!e.isPhone&&t.canEditCollection())return s()(ol.Z,{store:t,isMobile:!1,isInlineCollection:!0,disableTooltip:!0,buttonStyle:{marginLeft:4,marginRight:4}})}renderViewTabBar(){return s()(qs,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,isPlaceholderExternalCollectionStore:this.isPlaceholderExternalCollectionStore,onViewClick:this.handleViewClick})}renderFullScreenButton(){const{store:e}=this.props;if(this.isFullScreen())return;const t=(0,oe.ZP)({store:e,fullyQualified:!1}),o=ne.default.formatMessage(al.openFullscreenPageButtonTooltip);return s()(it.Z,{renderTooltip:()=>o,render:e=>d.createElement(Jt.Z,r()({ariaLabel:o,href:t,onClick:this.handleOpenAsPageClick,icon:b.Z.openAsPageThick,style:this.getTopbarIconButtonStyle(),iconStyle:{fill:this.theme.mediumTextColor,width:16}},e))})}renderAutomationSettingsButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=null==t?void 0:t.getType(),i=e.settingsStore,n=i.get().open,a=e.permissionScopes.state,l=(0,he.n)(i),c="automationSettings"===(null==l?void 0:l.type);if("page"!==o&&(a.canEditContent||"collectionTypedView"===e.contextType)&&ye.default.checkGate("status_automations")&&!this.isPlaceholderExternalCollectionStore.state)return s()(it.Z,{renderTooltip:()=>ne.default.formatMessage(al.openAutomationsSettingsButtonTooltip),render:e=>d.createElement(Jt.Z,r()({ariaLabel:ne.default.formatMessage(al.openAutomationsSettingsButtonAriaLabel),className:X.RIA,icon:b.Z.gift,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:14,fill:this.theme.mediumTextColor},hovered:n&&c,onClick:this.handleViewAutomationSettingsClick},e))})}renderViewSettingsButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=null==t?void 0:t.getType(),i=e.settingsStore,n=i.get().open,a=e.permissionScopes.state,l=(0,he.n)(i),c="automationSettings"!==(null==l?void 0:l.type);if("page"!==o&&(a.canEditContent||"collectionTypedView"===e.contextType)&&!this.isPlaceholderExternalCollectionStore.state)return s()(it.Z,{renderTooltip:()=>s()(I.FormattedMessage,{defaultMessage:"Edit view layout, grouping and more...",id:"database.collectionViewBlock.openViewSettingsButton.tooltip"}),render:e=>d.createElement(Jt.Z,r()({className:X.xvU,icon:b.Z.dots,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:3,fill:this.theme.mediumTextColor},hovered:n&&c,onClick:this.handleViewSettingsClick},e))})}renderFilterButton(){const{device:e}=this.environment,{createFilterSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return s()(tt.ZP,{popupType:e.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,open:t.state.open,origin:this.renderFilterButtonOrigin(),onDismiss:this.handleCreateFilterPopupDismiss,originGap:4,render:this.renderCreateFilterPopup})}renderFilterButtonOrigin(){const e=this.hasAppliedFilter.state;return s()(et.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleFilterClick},void 0,s()(I.FormattedMessage,{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}))}renderSortButton(){const{device:e}=this.environment;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const{createSortSettingsStore:t}=this.stores;return s()(tt.ZP,{popupType:e.isMobile?qe.Z.PopupType.SlideUp:qe.Z.PopupType.Popup,open:t.state.open,origin:this.renderSortButtonOrigin(),onDismiss:this.handleCreateSortPopupDismiss,originGap:4,render:this.renderCreateSortPopup})}renderSortButtonOrigin(){const e=this.hasSort.state;return s()(et.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleSortClick},void 0,s()(I.FormattedMessage,{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}))}renderSearch(){const{collectionContextStore:e}=this;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const t=e.searchOpen.get(),o=e.searchQuery.get();return d.createElement(d.Fragment,null,s()(Jt.Z,{icon:b.Z.collectionSearch,iconStyle:{width:14,height:void 0,fill:this.theme.mediumTextColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSearchButtonClick}),s()(Ln.Z,{isVisible:t,animationStyle:{width:150,opacity:1},enterAnimationStyle:{width:0,opacity:0},exitAnimationStyle:{width:0,opacity:0},render:()=>s()(gr.Z,{capture:t,allowEsc:!0,render:e=>d.createElement("div",e,s()("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"}},void 0,s()(Qs.Z,{style:this.getSearchInputStyle(),format:Qs.Z.Format.Transparent,value:o,onChange:this.handleSearchQueryChange,placeholder:ne.default.formatMessage(al.searchInputPlaceholder),focusInitial:t,showClearButton:!0,onBlur:this.handleSearchBlur,onCancel:this.handleClearSearch,onClick:ie.Wi,onClearButtonClick:this.handleClearSearch,onKeyDown:this.handleSearchKeyDown})))})}))}renderPageViewSearch(){var e;const t=this.getCurrentCollectionViewStore();if("page"!==(null==t?void 0:t.getType()))return null;const o=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return o?s()(et.Z,{style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:M.Z.fontWeight.medium,color:this.theme.mediumTextColor},onClick:()=>{U.Kf({environment:this.environment,analyticsFrom:"wiki-home-collection-view"}),xe.ZP.updateFilters({ancestors:[o]})}},void 0,b.Z.collectionSearch({width:14,fill:this.theme.mediumIconColor,marginRight:6}),s()(I.FormattedMessage,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search",description:"Button to open the search modal for page view."})):null}renderAddItemButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore();if("page"===(null==t?void 0:t.getType())||this.isPlaceholderExternalCollectionStore.state||!e.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const o="collectionTypedView"===e.contextType?s()(I.FormattedMessage,{defaultMessage:"New {singleItemName}",id:"collectionViewBlock.action.newItem.typedDatabaseTitle",description:"The text on a button used to add new typed items to a typed database. singleItemName would be something like [task, project] or similar.",values:{singleItemName:ne.default.formatMessage((0,v.hf)(e.databaseType))}}):s()(I.FormattedMessage,{defaultMessage:"New",id:"collectionViewBlock.action.newItem.nonTypedDatabaseTitle",description:"The text on a button used to add new pages to a database"}),i={marginLeft:8,fontSize:14,height:28};if("collectionTypedView"===e.contextType)return s()(Js.Z,{onClick:this.handleAddItemClick,style:i},void 0,o);const n=e=>s()(nl.Z,{title:o,color:"blue",onClick:this.handleAddItemClick,dropdownEvents:e,style:i,className:X.sqL});return s()(qe.Z,{popupType:this.environment.device.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,render:this.renderTemplatesPopup,originGap:4,onClick:this.handleTemplatesDropdownClick,renderOrigin:e=>this.shouldShowProjManagementTooltipTour()?s()(Bn.Z,{origin:n(e),isFirstTooltip:!0,phase:"create_a_task",alignment:"bottom"}):n(e),buttonPopupStore:this.stores.templateButtonPopupStore})}renderNoDateButton(){const e=this.noDateTotal.state,{collectionContextStore:t}=this,o=t.permissionScopes.state;if(t.collectionStore()&&0!==e&&o.canEditContent)return s()(qe.Z,{popupType:this.environment.device.isMobile?tt.kQ.SlideUp:tt.kQ.Popup,render:this.renderNoDatePopup,onClick:this.handleNoDateButtonClick,renderOrigin:t=>d.createElement(et.Z,r()({isGray:!0,style:this.getTopbarActionButtonStyle(!1)},t),s()(I.FormattedMessage,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:e}}))})}renderFilterBar(){const{collectionContextStore:e}=this,t=e.filtersBarOpenStore.state,o=this.getCurrentCollectionViewStore();if("page"!==(null==o?void 0:o.getType())){if(!t){const t=e.getCompleteSprintButtonContext.state;if(!t)return;return s()("div",{style:{display:"flex",marginTop:9}},void 0,s()("div",{style:{flex:1}}),s()($s.v,{collectionContextStore:e,completeSprintAutomationContext:t}))}return s()(ys.ZP,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,createFilterSettingsStore:this.stores.filterBarCreateFilterSettingsStore,saveControlMoreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}}renderSource(){if(!this.isPlaceholderExternalCollectionStore.state)return this.collectionContextStore.shouldShowSource.state?s()(vs,{store:this.props.store,collectionContextStore:this.collectionContextStore,isFullScreen:this.isFullScreen(),showHoverActionsStore:this.showHoverActionsStore,canEdit:this.canEdit()}):void 0}renderView(e,t,o,i,n,a){const{store:l}=this.props,{mouseStore:c}=this.stores,{collectionContextStore:p}=this,u=!this.canEdit();"rendered"!==pe.default.state.renderPhase&&pe.default.setState({...pe.default.state,renderPhase:"rendered"});const m=this.isFullScreen(),{mouseEntered:g}=c.state,h=this.isInPeekRenderer(),f=this.getBlockPropertyValueOverlayStore(),v=this.isRootOrDirectChild();let y=this.leftRightPadding.state;if(y){if(!e&&"collectionTypedView"!==this.collectionContextStore.contextType)return this.renderNoSourcePlaceholder(o);if(this.isPlaceholderExternalCollectionStore.state)return this.renderNoSourceExternalCollectionPlaceholder(o);if("table"===o)return d.createElement(Da,r()({key:t.id,schema:i,format:a,query:n,store:l,collectionContextStore:p,showHoverActionsStore:this.showHoverActionsStore,isFullScreen:m,isInPeekRenderer:h,mouseEntered:g},y,{minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:u,blockPropertyValueOverlayStore:f,isRootChild:v,viewSettingsPlacementStore:this.stores.viewSettingsPlacementStore}));if("board"===o)return d.createElement(Fi,r()({key:t.id,schema:i,format:a,query:n,store:l,collectionContextStore:p,isFullScreen:m,isInPeekRenderer:h},y,{paddingBottom:this.getPaddingBottom(o),disabled:u,blockPropertyValueOverlayStore:f,isRootChild:v}));if("page"===o){const e=t.getFormat().page_pointer,o=p.settingsStore;if(!e)return s()("div",{style:{fontSize:17,fontWeight:M.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginTop:20,display:"inline-block",width:"100%"}},void 0,s()(I.FormattedMessage,{defaultMessage:"No page specified",id:"collectionViewBlock.noPagePlaceholder.title",description:"Text shown as default when users create a new page view on a database, explaining that no page has been specified to be shown in the view"}),s()("div",{style:{fontSize:11}},void 0,s()(Ot.Z,{onClick:()=>A.r$({collectionContextStore:p,collectionSettingsStore:o})},void 0,"Enter a page ID to continue")));const i=this.createComputedStore((()=>{const t=(0,Y.np)();return(null==t?void 0:t.id)===e.id?t:Pe.G.createChildStore(l,{table:e.table,id:e.id})})),n=(0,Y.ui)(this.environment);return s()(il.Z,{context:_e.S.CollectionPageView,store:i.state,paddingBottom:il.Z.paddingBottom(this.environment),paddingLeft:n,paddingRight:n,pageCoverHeight:0,disabled:this.props.store.isLocked()||this.props.disabled,loadingContainerStore:void 0})}return"calendar"===o?d.createElement(nn,r()({key:t.id,schema:i,format:a,query:n,store:l,collectionContextStore:p,isFullScreen:m,isInPeekRenderer:h},y,{minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:u,blockPropertyValueOverlayStore:f,isRootChild:v})):"list"===o?(this.isInFrameWhenSidePeekOpen.state&&(y={...y,paddingRight:24}),d.createElement(yn,r()({key:t.id,schema:i,format:a,query:n,store:l,collectionContextStore:p,isFullScreen:m,isInPeekRenderer:h,mouseEntered:g},y,{minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:u,blockPropertyValueOverlayStore:f,isRootChild:v}))):"gallery"===o?d.createElement(dn,r()({key:t.id,schema:i,format:a,query:n,store:l,collectionContextStore:p,isFullScreen:m,isInPeekRenderer:h,mouseEntered:g},y,{minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:u,blockPropertyValueOverlayStore:f,isRootChild:v})):"timeline"===o?d.createElement(cs,r()({key:t.id,schema:i,format:a,query:n,store:l,collectionContextStore:p,isFullScreen:m,isRootChild:v,isInPeekRenderer:h,mouseEntered:g,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:u,blockPropertyValueOverlayStore:f,showHoverActionsStore:this.showHoverActionsStore,ref:this.timelineViewRef},y)):void 0}}renderNoSourcePlaceholder(e){const t=this.isFullScreen(),o=this.collectionContextStore.permissionScopes.state,i=this.collectionContextStore.settingsStore.get().open,n={display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"};return s()("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:t?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"}},void 0,s()("div",{style:{paddingRight:i?Yn.nJ:void 0}},void 0,b.Z.folderUnknownLarge({height:48,fill:this.theme.lightIconColor,margin:"0 auto"}),s()("div",{style:{fontSize:17,fontWeight:M.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2}},void 0,s()(I.FormattedMessage,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"})),o.canConfigureBlock&&s()("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,color:this.theme.lightTextColor}},void 0,s()(I.FormattedMessage,{defaultMessage:"<button>Select a data source</button> to continue",id:"collectionViewBlock.setSourceButton.title",values:{button:e=>s()(Ot.Z,{style:n,onClick:this.handleSetSourceClick},void 0,e)}}))))}renderNoSourceExternalCollectionPlaceholder(e){var t;const o=this.isFullScreen(),i=this.collectionContextStore.permissionScopes.state,n=this.collectionContextStore.settingsStore.get().open,r={display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"},a=this.getExternalIntegrationId.state,l=be.Z.integrations.state.find((e=>e.id===a)),c=!(this.environment.device.isMobileBrowser&&this.isPlaceholderExternalCollectionStore.state&&!this.isUserAuthenticated());if(l)return s()("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:o?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"}},void 0,s()("div",{style:{paddingRight:n?Yn.nJ:void 0,display:"flex",flexDirection:"column",alignItems:"center"}},void 0,s()(zt.Z,{icon:null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.getIcon(),size:48,disabled:!0,isEmptyPage:!1}),s()("div",{style:{fontSize:17,fontWeight:M.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2}},void 0,s()(I.FormattedMessage,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",description:"Title for prompting the user to add an external integration source, e.g. GitHub.",values:{integrationName:l.name}})),i.canConfigureBlock&&s()("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:this.theme.lightTextColor}},void 0,c&&s()(I.FormattedMessage,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",description:"Button text for prompting the user to add an external integration source, e.g. GitHub.",values:{integrationName:l.name,button:e=>s()(Ot.Z,{style:r,onClick:this.handleSetSourceClick},void 0,e)}}))))}renderLoadingSpinner(){const e=this.collectionContextStore.shouldShowSpinner.state;return s()(vr.Z,{show:e,showDelay:500,showHold:100,render:e=>e?s()("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4}},void 0,s()(Go.Z,{style:{width:14,height:14}})):void 0},"loading-spinner")}renderBottomBorderForViewSettings(){const{collectionContextStore:e}=this;if(e.settingsStore.get().open&&"sidebar"===this.stores.viewSettingsPlacementStore.state)return s()("div",{style:{...this.leftRightPadding.state,...this.leftRightMargin.state,borderTop:`1px solid ${this.theme.tableDividerColor}`,height:12}})}renderMultiSelectToolbar(){if((0,ee.fk)({environment:this.environment,collectionContextStore:this.collectionContextStore})){var e;const t=(null===(e=this.leftRightPadding.state)||void 0===e?void 0:e.paddingLeft)??0,o=this.leftRightMargin.state.marginLeft??0;return s()(Un,{marginLeft:t+o})}}unsubscribeAll(){for(const e of this.subscriptions.values())e.unsubscribe();this.collectionTypeChangeSubscription&&this.collectionTypeChangeSubscription.unsubscribe()}isCollectionViewOfExternalCollectionWithoutExternalObjectId(){var e;const t=null===(e=this.getCollectionStore())||void 0===e?void 0:e.getValue();return Boolean(t&&(0,y.Ev)(t))}isUserAuthenticated(){const e=this.collectionContextStore.collectionStore();if(!e)return!1;const t=e.getFormat().integration_id,o=be.Z.integrations.state.find((e=>e.id===t));return!(!t||!o)&&(0,$.NP)(t).length>0}createItem(e){const{transaction:t,coerce:o,from:i}=e,{collectionContextStore:n}=this,{newStore:r}=R.IW({environment:this.environment,collectionContextStore:n,groupsPointer:[],results:this.getDefaultResults(),insertAtIndex:0,coerce:o,initializeDefaultTemplate:o,transaction:t,from:i});N.peekBlock({environment:this.environment,store:r,peekMode:(0,ee.kr)(n.collectionViewStore()),resultsStore:void 0,collectionContextStore:n});const a=n.subitemTreeStore.state;return P.trackCreateBlock(this.environment,{from:a.children?"collection_view_new_parent_item":"collection_view_new_item",type:"page",...J.Pn(n)}),r}getViewStores(){const{store:e}=this.props;return e.getCollectionViewStores()}getCurrentCollectionViewStore(){return this.collectionContextStore.collectionViewStore()}getDefaultCollectionViewStore(){var e;const t=this.getViewStores();if(null!==(e=t[0])&&void 0!==e&&e.isDefined())return t[0]}getCollectionStore(){return this.collectionContextStore.collectionStore()}getMinWidth(){const{store:e}=this.props,{device:t}=this.environment,o=t.isPhone,i=this.isFullScreen(),n=this.getCurrentViewType(),r=("gallery"===n||("calendar"===n||"list"===n)&&i)&&this.isInFrameWhenSidePeekOpen.state,a=(0,le.ll)(this.environment,this.isInPeekRenderer()),s=Ie.default.state;return i||this.isRootOrDirectChild()?o?`calc(100% - ${2*(0,Y.ui)(this.environment)}px - ${a}px)`:this.isInPeekRenderer()?`calc(100% - ${2*Ie.PeekModePadding.horizontal[s.mode]}px - ${a}px)`:this.isInFrameWhenSidePeekOpen.state?(0,le.$3)(this.environment)+(r?(0,le.vJ)(this.environment):0):i?`calc(100% - ${2*(0,Y.CP)(this.environment)}px - ${a}px)`:(0,ee._5)(e)?`calc(100% - ${2*(0,Y.ui)(this.environment)}px - ${a}px)`:Y.CC-2*(0,Y.ui)(this.environment)-a:`calc(100% - ${a}px)`}isInPeekRenderer(){return(0,ee.en)(this.props.store)}getBlockPropertyValueOverlayStore(){return this.isInPeekRenderer()?Te.Z:Ce.Z}resetLeftScrollAfterFlush(){m.default.afterNextFlush((()=>{var e;const t=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();if(t){t.scrollLeft=0;const e=se.xH(t);e&&(e.scrollLeft=0)}}))}isFullScreen(){return Boolean(this.props.isFullScreen)}getDefaultResults(){const e=this.collectionContextStore.localResultStore.state,t=this.getCollectionStore();if(t&&e&&"reducer"===e.type){const o=c().find(e.reducerResults,(e=>"results"===e.type));if(o)return o.blockIds.map((e=>Pe.G.createChildStore(t,{id:e,table:C.iU})))}return[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):N.navigate({environment:this.environment,url:e})}getCurrentViewType(){var e;const{collectionContextStore:t}=this,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getNoDateProperty(){const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.normalizedQueryStore.state;if(!e||!t)return;const o=e.getType();return"timeline"===o&&t.timeline_by?t.timeline_by:"calendar"===o&&t.calendar_by?t.calendar_by:void 0}ensureStoreListeners(){const{collectionContextStore:e}=this,{store:t}=this.props;e.blockIsPrivateStore.state;for(const o of t.getCollectionViewStores())o.getValue()}getScrollerStyle(e,t,o){const{store:i}=this.props,n=this.isFullScreen(),r=this.isRootOrDirectChild(),a=Ie.default.isSidePeekClosing.state?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state,s=this.getPaddingBottom(e),l=this.collectionContextStore.settingsStore.get().open;return{flexGrow:1,flexShrink:0,...i.isLocked()&&{cursor:"default"},..."timeline"===e&&this.collectionContextStore.collectionStore()&&!n&&!(0,Q.fj)({environment:this.environment,isFullScreen:n,isRootChild:r,format:t})&&a&&{marginLeft:a.paddingLeft,marginRight:a.paddingRight,marginBottom:s},...l&&!n&&"sidebar"===this.stores.viewSettingsPlacementStore.get()&&{minHeight:Yn.j9},...this.isInFrameWhenSidePeekOpen.state?{position:"sticky",left:0,paddingLeft:o,width:(0,le.$3)(this.environment)}:{}}}getPaddingBottom(e){return this.props.isFullScreen?"timeline"===e?96:180:"timeline"===e||"gallery"===e?0:me.Z.state}getHeaderWrapStyle(){const e=this.leftRightPadding.state,t=(0,le.$3)(this.environment),o=(0,ee._5)(this.props.store)||this.isFullScreen()?t:Math.min(Y.CC,t),i=this.isInFrameWhenSidePeekOpen.state&&!Ie.default.isSidePeekOpening.state;return{minHeight:rl,paddingLeft:null==e?void 0:e.paddingLeft,paddingRight:i?0:null==e?void 0:e.paddingRight,flexShrink:0,...(this.isFullScreen()||i)&&{position:"sticky",zIndex:86,left:0,width:i&&e?o-(e.paddingLeft/2??0):void 0},...this.props.store.isLocked()&&{cursor:"default"},...this.leftRightMargin.state}}getHeaderStyle(){const{collectionContextStore:e}=this,t=this.getCurrentViewType(),o=e.viewIsFlushToTopbar();return{display:"flex",alignItems:"center",height:rl,boxShadow:("timeline"===t||"table"===t)&&o?void 0:`inset 0 -1px 0 ${this.theme.tableDividerColor}`,...this.getHeaderPositioningStyle()}}getHeaderPositioningStyle(){const e=this.leftRightPadding.state;return{left:null==e?void 0:e.paddingLeft,width:"100%"}}getSearchInputStyle(){return{fontSize:14,lineHeight:1,paddingRight:4,color:this.theme.regularTextColor,marginBottom:1}}getTopbarActionButtonStyle(e){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:e?this.theme.blueColor:this.theme.mediumTextColor,fontWeight:M.Z.fontWeight.regular,lineHeight:1,borderRadius:3}}getTopbarIconButtonStyle(){return{display:"flex",alignItems:"center",fontSize:14,height:28,width:28,padding:6,color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor,fontWeight:M.Z.fontWeight.regular,lineHeight:1,borderRadius:3}}collectionViewTypeToAnalyticsType(e){return"page"===e?"page_view":e}shouldShowProjManagementTooltipTour(){if(this.environment.device.isMobile)return!1;const e=pe.default.state.currentSpaceStore;if(!e||e.getCreatedTime()<G.VL)return!1;const t=this.collectionContextStore.collectionViewBlockStore();return(null==t?void 0:t.getFormat().app_config_uri)===f.TZ&&(0,G.Z0)()}projManagementTooltipTourAssignToSomeone(){const e=pe.default.state.currentUserSettingsStore,t=pe.default.state.currentSpaceStore;e&&t&&B.uR({environment:this.environment,requiredCurrPhase:"create_a_task",nextPhase:"assign_to_someone",currentUserSettingsStore:e,currentSpaceStore:t})}projManagementTooltipTourComplete(){const e=pe.default.state.currentUserSettingsStore,t=pe.default.state.currentSpaceStore;e&&t&&B.uR({environment:this.environment,requiredCurrPhase:"click_view_settings",nextPhase:"complete",currentUserSettingsStore:e,currentSpaceStore:t})}trackRenderTime(e){let{isFirstRender:t}=e;J.tN("collections.collection_view_block_render")&&m.default.measureFlush((e=>{E.bV({environment:this.environment,collectionContextStore:this.collectionContextStore,time:e,is_first_render:t})}))}trackSwitchViewLag(){if(this.switchViewMetric){if(J.tN("collections.switch_view_lag")){const{from:e,to:t,startTime:o,sizeHintAtStart:i}=this.switchViewMetric;m.default.afterNextFlush((()=>{E.iP({environment:this.environment,collectionContextStore:this.collectionContextStore,time:performance.now()-o,from:e,to:t,did_trigger_fetch:this.collectionContextStore.isLoading.get(),sizeHintAtStart:i})}))}this.switchViewMetric=void 0}}}ll.displayName="CollectionViewBlock",ll.contextTypes={...K.wK,...u.w};const cl=ll},37709:(e,t,o)=>{o.d(t,{Pt:()=>K,NV:()=>G,fw:()=>X,ZP:()=>q});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o(67294),c=o(83355),d=o(480),p=o(3779),u=o(51454),m=o(5366),g=o(77162),h=o(30610),f=o(5149),v=o(64434),y=o(55332),b=o(24677),S=o(64964),w=o(98104),k=o(97004),C=o(13273),_=o(34859),M=o(61766),T=o(12318),I=o(22323),P=o(28398),x=o(58814),B=o(55811),Z=o(82990),E=o(31945),R=o(44532);class A extends c.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:T.default.of({open:!1,stack:[]})},this.renderPopup=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;return a()(I.Z,{context:I.H.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleClick=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;g.wd({environment:this.environment,collectionContextStore:e,action:"click_sort"}),f.wl({collectionSettingsStore:t,item:{type:"sort"}})},this.handlePopupDismiss=e=>{if(e&&(0,C.yT)(e.target))return;const{collectionSettingsStore:t}=this.stores;f.E3({collectionSettingsStore:t})}}willUnmount(){f.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores;return a()(R.ZP,{popupType:e.isMobile?E.Z.PopupType.SlideUp:E.Z.PopupType.Popup,open:t.state.open,origin:this.renderOrigin(),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderOrigin(){const{collectionContextStore:e}=this.props,t=e.currentSortsStore.state,o=e.localStateDiffStore.state,i=t[0],n=e.permissionScopes.state,r=e.normalizedSchemaStore.state,s=i?r[i.property]:void 0;let l;return l=1===t.length?i&&"descending"===i.direction?p.Z.arrowDownThick({width:12,marginRight:4,fill:this.theme.blueColor}):p.Z.arrowUpThick({width:12,marginRight:4,fill:this.theme.blueColor}):p.Z.arrowsUpDownThick({width:16,marginRight:4,fill:this.theme.blueColor}),a()(B.u,{on:!0,hasDiff:Boolean(n.canConfigureBlock&&o.sorts),icon:l,title:a()("span",{style:{marginTop:-1,maxWidth:220,...Z.Z.textOverflowStyle}},void 0,1===t.length&&s?s.name:a()(m.FormattedMessage,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:t.length}})),onClick:this.handleClick})}}A.displayName="CollectionViewFilterBarSort";const D=(0,m.injectIntl)(A);var F=o(35127),L=o(30016),V=o(37601),N=o(79131),O=o(21199),U=o(1743),H=o(74194),z=o(89728),W=o(18647),j=o(6854);let K;!function(e){e[e.FilterBar=0]="FilterBar",e[e.SettingsFilters=1]="SettingsFilters"}(K||(K={}));class Y extends c.Z{constructor(){super(...arguments),this.storeTypes={createFilterSettingsStore:T.default.of({open:!1,stack:[]}),saveControlMoreActionsButtonPopupStore:M.Z},this.renderPropertyFilter=e=>{const{collectionContextStore:t}=this.props;return a()(B.Z,{id:e.id,context:K.FilterBar,collectionContextStore:t,collectionSettingsStore:t.getFilterBarItemSettingsStore(e)},e.id)},this.renderViewSettingsPopup=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;return a()(I.Z,{context:I.H.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleNewFilterPopupClick=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;g.wd({environment:this.environment,collectionContextStore:e,action:"click_new_filter"}),f.wl({collectionSettingsStore:t,item:{type:"createFilter"}})},this.handlePopupDismiss=e=>{const{createFilterSettingsStore:t}=this.stores;e&&(0,C.yT)(e.target)||f.E3({collectionSettingsStore:t})},this.handleSearchClick=()=>{const{collectionContextStore:e}=this.props;w.ZH(this.environment),b.ZH(this.environment),v.wG(),e.searchOpen.set(!0),e.searchQuery.set(""),g.wd({environment:this.environment,collectionContextStore:e,action:"click_mobile_search"})},this.handleSearchQueryChange=e=>{const{collectionContextStore:t}=this.props;t.searchQuery.set(e.target.value)},this.handleSearchBlur=()=>{const{collectionContextStore:e}=this.props;e.searchQuery.get()||this.handleSearchClearButtonClick()},this.handleSearchClearButtonClick=()=>{const{collectionContextStore:e}=this.props;e.searchOpen.set(!1),e.searchQuery.set("")},this.handleFiltersDrop=e=>{const{collectionContextStore:t}=this.props;if(!t.collectionViewBlockStore())return;const o=t.currentPropertyFiltersStore.state,i=s.compact(e.map((e=>o.find((t=>t.id===e)))));h.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.get(),propertyFilters:{value:i}}}),g.wd({environment:this.environment,collectionContextStore:t,action:"reorder_filters"})},this.handleClick=e=>{const{collectionContextStore:t}=this.props;t.filtersBarOpen.set(!0)},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,k.Nq)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.context.environment,{isPhone:o}=t,i=o&&e.searchOpen.get(),n=e.currentPropertyFiltersStore.state,r=e.currentSortsStore.state,s=this.localStateHasChangesStore.state,c=this.props.collectionContextStore.shouldShowSource.state?8:12,d=e.filterBarSortSettingsStore.get().open,p=r.length>0||d,m=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return a()("div",{style:{width:"100%",zIndex:u._Y},onClick:this.handleClick},void 0,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,i&&this.renderMobileSearchInput(),!i&&a()("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"}},void 0,a()(W.Z,{type:_.Z.X,style:{display:"flex",alignItems:"center",paddingTop:c,paddingBottom:t.isPhone?12:8},showLeftRightOverlay:!t.isPhone},void 0,o?l.createElement(l.Fragment,null,this.renderMobileSearchButton(),p&&this.renderSort(),p&&!t.isPhone&&this.renderDivider(),m&&this.renderCombinatorFilter(),this.renderPropertyFilters(n),this.renderAddFilterButton()):l.createElement(l.Fragment,null,p&&this.renderSort(),p&&!t.isPhone&&this.renderDivider(),m&&this.renderCombinatorFilter(),this.renderPropertyFilters(n),this.renderAddFilterButton()))),a()("div",{style:{flexGrow:1}}),!o&&s&&this.renderSaveControl(),!o&&this.renderCompleteSprintButton()),o&&!i&&a()("div",{style:{display:"flex",alignItems:"center",marginBottom:4}},void 0,s&&this.renderSaveControl(),this.renderCompleteSprintButton()))}renderSaveControl(){const{collectionContextStore:e,showHoverActionsStore:t}=this.props;return a()(P.ZP,{context:P.R1.FilterBar,collectionContextStore:e,showHoverActionsStore:t,moreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}renderPropertyFilters(e){const{collectionContextStore:t}=this.props;if(t.permissionScopes.state.canConfigureBlock){const t=e.map((e=>e.id));return a()(N.ZP,{direction:"horizontal",keys:t,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:t=>{const o=e.find((e=>e.id===t));if(o)return this.renderPropertyFilter(o)},style:{display:"flex",flexShrink:0},onDrop:this.handleFiltersDrop})}return e.map(this.renderPropertyFilter)}renderCombinatorFilter(){const{collectionContextStore:e}=this.props;return a()(x.Z,{context:K.FilterBar,collectionSettingsStore:e.filterBarCombinatorFilterSettingsState,collectionContextStore:e})}renderSort(){const{collectionContextStore:e}=this.props;return a()(D,{collectionContextStore:e,collectionSettingsStore:e.filterBarSortSettingsStore},"sort")}renderDivider(){return a()("div",{style:{borderRight:`1px solid ${this.theme.regularDividerColor}`,height:24,marginRight:12,marginLeft:8}})}renderAddFilterButton(){const{showHoverActionsStore:e}=this.props,t=this.stores.createFilterSettingsStore.state.open,o=e.state||t;return a()(R.ZP,{open:t,popupType:this.environment.device.isMobile?R.kQ.SlideUp:R.kQ.Popup,origin:a()(L.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>a()(z.Z,{icon:p.Z.plus,isSmall:!0,isLightGray:!0,hovered:t,onClick:this.handleNewFilterPopupClick,style:{fontSize:14}},void 0,a()(m.FormattedMessage,{defaultMessage:"Add filter",id:"database.filterBar.addButton.title"}))}),render:this.renderViewSettingsPopup,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:this.handlePopupDismiss})}renderCompleteSprintButton(){const{collectionContextStore:e}=this.props,t=e.getCompleteSprintButtonContext.state;if(t)return a()(F.v,{collectionContextStore:e,completeSprintAutomationContext:t})}renderMobileSearchInput(){const{collectionContextStore:e,intl:t}=this.props,o=e.searchQuery.get();return a()(U.Z,{capture:!0},void 0,a()(O.Z,{capture:!0,render:e=>l.createElement("div",n()({},e,{style:{width:"100%",paddingTop:this.environment.device.isMobile?8:12,paddingBottom:6}}),a()(B.u,{wrapStyle:{width:"100%"},innerStyle:{width:"100%"},icon:p.Z.collectionSearch({width:14,fill:this.theme.mediumIconColor,marginRight:6}),hideChevron:!0,title:l.createElement(l.Fragment,null,a()(H.Z,{format:H.B.Transparent,value:o,placeholder:t.formatMessage({defaultMessage:"Type to search…",id:"database.filterBar.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onBlur:this.handleSearchBlur,onClearButtonClick:this.handleSearchClearButtonClick,showClearButton:!0,focus:!this.environment.device.isIOS||void 0,focusInitial:!0,inputStyle:{height:"100%"}}),a()(V.Z,{show:!0}))}))}))}renderMobileSearchButton(){return a()(B.u,{wrapStyle:{display:"flex",alignItems:"center"},icon:p.Z.collectionSearch({width:14,fill:this.theme.mediumIconColor,marginRight:6}),hideChevron:!0,title:a()("span",{style:{marginTop:-1,color:this.theme.mediumTextColor}},void 0,a()(m.FormattedMessage,{defaultMessage:"Search",id:"database.filterBar.search.title"})),onClick:this.handleSearchClick},"search")}}function G(){return window.__c={n:"SaveChangesSnackbarLabel"},a()(m.FormattedMessage,{defaultMessage:"Changes saved for everyone.",id:"database.filterBar.saved.title"})}function X(e){window.__c={n:"SaveChangesSnackbarUndoButton"};const{collectionContextStore:t,temporaryState:o}=e,i=(0,d.O7)();return a()(j.Pn,{onClick:()=>{y.Yw(i,!0),S.rN(),h.iU({environment:i,collectionContextStore:t,temporaryState:o})}},void 0,a()(m.FormattedMessage,{defaultMessage:"Undo",id:"database.filterBar.undo.title"}))}Y.displayName="CollectionViewFilterBar";const q=(0,m.injectIntl)(Y)},58814:(e,t,o)=>{o.d(t,{Z:()=>b});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(3779),s=o(82990),l=o(5366),c=o(77162),d=o(30610),p=o(5149),u=o(13273),m=o(12318),g=o(22323),h=o(55811),f=o(31945),v=o(44532);class y extends r.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:m.default.of({open:!1,stack:[]})},this.renderPopup=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;return n()(g.Z,{context:g.H.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleClick=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;this.getFilter()&&(p.wl({collectionSettingsStore:t,item:{type:"filter"}}),c.wd({environment:this.environment,collectionContextStore:e,action:"click_combinator_filter"}))},this.handlePopupDismiss=e=>{var t;if(e&&(0,u.yT)(e.target))return;const{collectionContextStore:o}=this.props,{collectionSettingsStore:i}=this.stores;p.E3({collectionSettingsStore:i});const n=this.getFilter();n&&0===(null===(t=n.filters)||void 0===t?void 0:t.length)&&d.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.get(),combinatorFilter:{value:void 0}}})},this.hasFilterDiff=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.localStateDiffStore.state;return Boolean(t.combinatorFilter)}))}willUnmount(){p.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores;return n()(v.ZP,{popupType:e.isMobile?f.Z.PopupType.SlideUp:f.Z.PopupType.Popup,open:t.state.open,origin:this.renderOrigin(),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderOrigin(){var e;const{environment:t}=this,o=this.getFilter();if(o)return n()(h.u,{icon:a.Z.filter({width:void 0,height:t.device.isMobile?14:12,fill:this.theme.blueColor,marginRight:6}),title:n()("span",{style:this.getTitleStyle()},void 0,n()(l.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=o.filters)||void 0===e?void 0:e.length)||0}})),on:!0,hasDiff:this.hasFilterDiff.state,onClick:this.handleClick},"combinator")}getFilter(){return this.props.collectionContextStore.currentCombinatorFilterStore.state}getTitleStyle(){return{maxWidth:180,...s.Z.textOverflowStyle}}}y.displayName="CollectionViewFilterBarCombinatorFilter";const b=(0,l.injectIntl)(y)},55811:(e,t,o)=>{o.d(t,{u:()=>$,Z:()=>Q});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(1302),d=o(480),p=o(24405),u=o(76205),m=o(39068),g=o(3779),h=o(82990),f=o(5366),v=o(77162),y=o(30610),b=o(5149),S=o(93959),w=o(97004),k=o(13273),C=o(12318),_=o(56723),M=o(37709),T=o(96486),I=o.n(T),P=o(15070),x=o(99036),B=o(32918),Z=o(76725),E=o(23014),R=o(21202),A=o(77420),D=o(6287),F=o(19889),L=o(97880),V=o(7928),N=o(17335),O=o(29376),U=o(3815),H=o(76798),z=o(89845);class W extends l.Z{constructor(){super(...arguments),this.renderSeparator=e=>a()("span",{style:{whiteSpace:"pre"}},e,a()(f.FormattedMessage,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,propertyFilter:t,parentStore:o}=this.props,i=e[t.property];if(i&&(0,x.p_)(i))return(0,O.ke)(i,o)}))}renderComponent(){const{valueOnly:e,propertyFilter:t,style:o}=this.props,{filter:i}=t,n=(0,u.ul)(i)?i.subfilter:i,r=(0,u.h6)(n)&&!(0,u.mv)(i),s={...o,maxWidth:void 0};return a()("span",{style:(0,u.gE)(n)?s:o},void 0,a()(f.FormattedMessage,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:e?void 0:this.renderPropertyName(),colonSeparator:e||r?void 0:":",filterOperator:this.renderFilterOperator(),propertyValue:this.renderValue()}}))}renderPropertyName(){const{propertyFilter:e,schema:t}=this.props,o=t[e.property];if(o)return a()("span",{style:{fontWeight:h.Z.fontWeight.medium}},void 0,o.name)}renderFilterOperator(){const{propertyFilter:e}=this.props,{filter:t}=e,o=(0,u.ul)(t)?t.subfilter:t;if((0,u.Ly)(o))return"string_contains"===o.operator||"string_is"===o.operator?void 0:"string_does_not_contain"===o.operator||"string_is_not"===o.operator?this.renderNotOperatorMessage():(0,N.WC)(o.operator);if((0,u.h6)(o))return(0,N.WC)(o.operator);if((0,u.XA)(o)){if("checkbox_is_not"===o.operator)return this.renderNotOperatorMessage()}else{if((0,u.dx)(o))return"enum_is"===o.operator?void 0:"enum_is_not"===o.operator?this.renderNotOperatorMessage():(0,N.WC)(o.operator);if((0,u.NU)(o))return"enum_contains"===o.operator?void 0:"enum_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,N.WC)(o.operator);if((0,u.r2)(o))return"status_is"===o.operator?void 0:"status_is_not"===o.operator?this.renderNotOperatorMessage():(0,N.WC)(o.operator);if((0,u.e)(o))return"relation_contains"===o.operator?void 0:"relation_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,N.WC)(o.operator);if((0,u.Gb)(o))return"person_contains"===o.operator?void 0:"person_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,N.WC)(o.operator);if((0,u.Mp)(o)){if("location_is"===o.operator)return;if("location_is_not"===o.operator)return this.renderNotOperatorMessage()}else if((0,u.gE)(o)){if("date_is"===o.operator)return;if("date_is_after"===o.operator)return a()(f.FormattedMessage,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===o.operator)return a()(f.FormattedMessage,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===o.operator)return a()(f.FormattedMessage,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===o.operator)return a()(f.FormattedMessage,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,u.TQ)(o))return(0,N.WC)(o.operator);{const e=o.value;if(!e.value||"exact"!==e.type||!(0,B.gR)(e.value))return(0,N.ip)(e);if(e.value.start_date&&e.value.end_date)return;if(e.value.start_date)return a()(f.FormattedMessage,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(e.value.end_date)return a()(f.FormattedMessage,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,u.Jw)(o))return"verification_is"===o.operator?void 0:"verification_is_not"===o.operator?this.renderNotOperatorMessage():(0,N.WC)(o.operator);(0,L.t1)(o)}}}renderNotOperatorMessage(){return a()(f.FormattedMessage,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}renderValue(){const{propertyFilter:e,schema:t,intl:o,parentStore:i}=this.props,{filter:n}=e,r=(0,u.ul)(n)?n.subfilter:n;if((0,u.vR)(r))if((0,u.Ly)(r)||(0,u.h6)(r)){const e=r.value.value;if(void 0!==e)return a()("span",{},void 0,e)}else if((0,u.XA)(r)){const e=r.value.value;if(!0===e)return a()("span",{},void 0,a()(f.FormattedMessage,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"}));if(!1===e)return a()("span",{},void 0,a()(f.FormattedMessage,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"}))}else{if((0,u.dx)(r)||(0,u.NU)(r)){const e=(0,u.dx)(r)?(0,u.mg)(r):(0,u.qC)(r),t=I().compact(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return a()("span",{},void 0,(0,Z.Z)(t,this.renderSeparator))}if((0,u.r2)(r)){const e=(0,u.wB)(r),t=I().compact(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return a()("span",{},void 0,(0,Z.Z)(t,this.renderSeparator))}if((0,u.e)(r)){const e=(0,u.YO)(r),t=I().compact(e.map((e=>{if(!e.value)return;const t=e.type;if("exact"===t){const t=U.G.createChildStore(i,{table:R.iU,id:e.value});return a()(H.Z,{style:{display:"inline"},store:t})}if("relative"===t){var o,n;const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;return a()("span",{},void 0,null===(o=E.qB[t])||void 0===o||null===(n=o[e.value.variable])||void 0===n?void 0:n.formattedMessage)}(0,L.t1)(t)})));return(0,Z.Z)(t,this.renderSeparator)}if((0,u.Gb)(r)){const e=(0,u.R8)(r),t=I().compact(e.map((e=>{if("relative"===e.type)return a()("span",{},void 0,a()(f.FormattedMessage,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"}));if(e.value){const t=e.value;if(t.table===F.KJ){const e=U.t1.createChildStore(i,{table:t.table,id:t.id});return a()("span",{},void 0,(0,V.Nz)(o,e.getModel()))}if(t.table===A.cZ){const e=U.t1.createChildStore(i,{table:t.table,id:t.id});return a()("span",{},void 0,(0,P.Mh)(e.getModel()))}}})));return(0,Z.Z)(t,this.renderSeparator)}if((0,u.Mp)(r)){const e=(0,u.u0)(r),t=I().compact(e.map((e=>{if(e.value){const t=e.value,o=U.t1.createChildStore(i,{table:D.v,id:t});return a()(H.Z,{style:{display:"inline"},store:o})}})));return(0,Z.Z)(t,this.renderSeparator)}if((0,u.gE)(r)){const o=t[e.property],i=(o&&"date"===o.type?o.date_format:void 0)||B.sF;let n;if("exact"===r.value.type){const e=r.value;if(e.value)if((0,B.J_)(e.value))n=e.value;else if((0,B.gR)(e.value)){const t=(0,B.Gc)(e.value);t&&(n=t.value)}}else if(!(0,u.TQ)(r))return(0,N.x)(r.value);if(n)return a()(z.Z,{style:{display:"inline"},value:n,dateFormat:i,shortenDateAndRange:!0})}else{if((0,u.Jw)(r)){const e=(0,u.fl)(r).filter((e=>{let{value:t}=e;return Boolean(t)})).map(N.cq);if(0===e.length)return;return a()("span",{},void 0,(0,Z.Z)(e,this.renderSeparator))}(0,L.t1)(r)}}}}W.displayName="CollectionViewFilterValue";const j=(0,f.injectIntl)(W);var K=o(64921),Y=o(31945),G=o(44532),X=o(58032);class q extends l.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:C.default.of({open:!1,stack:[]})},this.renderPopup=()=>{var e,t;const{collectionContextStore:o}=this.props,i=this.getFilter();if(!i)return;const n=i.filter,r=o.normalizedSchemaStore.state,s=o.collectionViewStore(),l=o.permissionScopes.state;if(!s)return;const c=null==o||null===(e=o.collectionStore())||void 0===e||null===(t=e.getSchema()[i.filter.property])||void 0===t?void 0:t.type;return a()(_.ZP,{collectionViewId:s.id,propertyFilter:n,schema:r,parentStore:s,onChange:e=>this.handleValueChange(e,c),onClose:this.handleFilterValueMenuClose,onDelete:this.handleDeleteFilter,onAddToCombinatorFilter:this.handleAddToCombinatorFilter,context:_.Qv.PropertyFilter,allowAddingToCombinatorFilter:l.canConfigureBlock,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0})},this.handleClick=()=>{var e,t;const{collectionContextStore:o}=this.props,{collectionSettingsStore:i}=this.stores,n=this.getFilter();n&&(b.wl({collectionSettingsStore:i,item:{type:"filter"}}),v.wd({environment:this.environment,collectionContextStore:o,action:"click_property_filter",original_view_type:void 0,property_type:null==o||null===(e=o.collectionStore())||void 0===e||null===(t=e.getSchema()[n.filter.property])||void 0===t?void 0:t.type}))},this.handleValueChange=(e,t)=>{var o;const{collectionContextStore:i}=this.props,n=this.getFilter();if(!n)return;const r=null===(o=i.remoteResult.state)||void 0===o?void 0:o.sizeHint;c.default.measureFlush((e=>{v.z1({environment:this.environment,from:"property_filter",property_type:t,collectionContextStore:i,time:e,did_trigger_fetch:i.isLoading.get(),sizeHintAtStart:r})}));const a=n.filter,s=i.currentPropertyFiltersStore.state.map((t=>{if(t.id===n.id){return{...n,filter:{...a,filter:e}}}return t}));y.iU({environment:this.environment,collectionContextStore:i,temporaryState:{...i.temporaryState.get(),propertyFilters:{value:s}}}),v.wd({environment:this.environment,collectionContextStore:i,action:"update_property_filter",original_view_type:void 0,property_type:t})},this.handlePopupDismiss=e=>{if(e&&(0,k.yT)(e.target))return;const{collectionSettingsStore:t}=this.stores;b.E3({collectionSettingsStore:t})},this.handleFilterValueMenuClose=()=>{const{collectionSettingsStore:e}=this.stores;b.E3({collectionSettingsStore:e})},this.handleDeleteFilter=()=>{var e,t;const{collectionContextStore:o}=this.props,i=this.getFilter();if(!i)return;const n=o.currentPropertyFiltersStore.state.filter((e=>e.id!==i.id));y.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.get(),propertyFilters:{value:n}}}),v.wd({environment:this.environment,collectionContextStore:o,action:"delete_property_filter",original_view_type:void 0,property_type:null==o||null===(e=o.collectionStore())||void 0===e||null===(t=e.getSchema()[i.filter.property])||void 0===t?void 0:t.type})},this.handleAddToCombinatorFilter=()=>{var e,t;const{collectionContextStore:o,context:i}=this.props,n=this.getFilter();if(!n)return;const{combinatorFilter:r,propertyFilters:a}=(0,w.Gz)(o,n);y.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.get(),propertyFilters:{value:a},combinatorFilter:{value:r}}});const s=i===M.Pt.FilterBar?o.filterBarCombinatorFilterSettingsState:o.filterOptionsCombinatorFilterSettingsState;b.wl({collectionSettingsStore:s,item:{type:"filter"}}),v.wd({environment:this.environment,collectionContextStore:o,action:"merge_filter_into_combinator",property_type:null==o||null===(e=o.collectionStore())||void 0===e||null===(t=e.getSchema()[n.filter.property])||void 0===t?void 0:t.type})},this.hasFilterDiff=this.createComputedStore((()=>{const{id:e,collectionContextStore:t}=this.props,o=t.localStateDiffStore.state;return o.filters.updated.includes(e)||o.filters.added.includes(e)}))}willUnmount(){b.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores,o=this.getFilter(),i=Boolean(o&&(0,S.EE)(o.id));return a()(G.ZP,{popupType:e.isMobile?Y.Z.PopupType.SlideUp:Y.Z.PopupType.Popup,open:t.state.open,origin:i?this.renderReadOnlyOrigin():this.renderOrigin(void 0,!1),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderReadOnlyOrigin(){return a()(X.Z,{placement:X.Z.Placement.Left,render:e=>this.renderOrigin(e,!0),renderTooltip:()=>a()(f.FormattedMessage,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter can’t be deleted on this view.",description:"We show this tooltip when the filter cannot be deleted on the view because of the database type."})})}renderOrigin(e,t){const{collectionContextStore:o}=this.props,{device:i}=this.environment,r=this.getFilter(),l=o.normalizedSchemaStore.state,c=o.collectionViewStore();if(!c||!r)return;const d=r.filter,p=!(0,u.Oo)(d),g=l[d.property],{theme:h}=this;return s.createElement($,n()({icon:g&&a()(m.ZP,{type:g.type,icon:g.icon,size:i.isMobile?18:16,theme:h,style:{fill:p?h.blueColor:h.mediumIconColor,marginRight:6}}),title:p?a()(j,{propertyFilter:d,schema:l,style:this.getTitleStyle(),parentStore:c}):a()("span",{style:this.getTitleStyle()},void 0,null==g?void 0:g.name),key:r.id,on:p,hasDiff:this.hasFilterDiff.state,onClick:this.handleClick,disabled:t,hideChevron:t},e))}getFilter(){const{id:e,collectionContextStore:t}=this.props;return t.currentPropertyFiltersStore.state.find((t=>t.id===e))}getTitleStyle(){return{maxWidth:180,...h.Z.textOverflowStyle}}}function $(e){window.__c={n:"CollectionViewFilterPill"};const{icon:t,title:o,on:i,hasDiff:n,wrapStyle:r,innerStyle:s,hideChevron:l}=e,c=(0,p.Fg)(),u=(0,d.O7)();return a()("div",{style:{borderRadius:14,marginRight:6,display:"inline-flex",...n&&{position:"relative"},...r}},void 0,a()(K.Z,{disabled:e.disabled,style:J(Boolean(i),c,s,u.device.isMobile),hoveredStyle:i?{background:c.outlineBlueButtonHoveredBackground}:void 0,pressedStyle:i?{background:c.outlineBlueButtonPressedBackground}:void 0,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick},void 0,t,o,!l&&g.Z.chevronDown({width:10,marginLeft:4,marginTop:1,fill:i?c.blueColor:c.lightIconColor})),n&&a()("div",{style:{position:"absolute",top:-2,right:-2,background:"dark"===c.mode?c.accentColors.orange[500]:c.accentColors.orange[300],border:`1px solid ${c.contentBackground}`,width:9,height:9,borderRadius:9}}))}function J(e,t,o,i){return{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:i?28:24,lineHeight:i?"28px":"24px",padding:"0 8px",border:`1px solid ${t.outlineButtonBorder}`,color:t.mediumTextColor,...e&&{color:t.blueColor,border:`1px solid ${t.filterPillBorder}`,background:t.filterPillBackground},...o}}q.displayName="CollectionViewFilterBarPropertyFilter";const Q=(0,f.injectIntl)(q)},1136:(e,t,o)=>{o.d(t,{F:()=>d});var i=o(77094),n=o.n(i),r=(o(67294),o(480)),a=o(24405),s=o(62760),l=o(79362),c=o(52821);function d(e){const{device:t}=(0,r.O7)(),o=(0,a.Fg)(),{color:i,viewIcon:d,viewType:p,size:u,style:m}=e,g=(e=>({regular:e.regularTextColor,light:e.mediumTextColor,gray:l.Lr[e.mode].gray,lightGray:e.lightTextColor}))(o)[i];return p?d?n()(s.Z,{style:{fill:g,backfaceVisibility:void 0,...m},size:u??(t.isMobile?18:16),theme:o,icon:d}):c.aW[p]({width:u??(t.isMobile?18:16),height:u??(t.isMobile?18:16),backfaceVisibility:void 0,fill:g,...m}):null}},26909:(e,t,o)=>{o.d(t,{cn:()=>g,l0:()=>h,fg:()=>f,ZP:()=>y});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(60709),d=o(36488),p=o(78140),u=o(28992),m=o(40721);const g=8,h=8,f=32;class v extends l.Z{renderComponent(){const{device:e}=this.environment;return a()(d.Z,{capture:!0,allowEsc:!0,allowUndo:!0,render:t=>{let o;return o=e.isMobile?{menuType:c.og.Modal,title:this.props.title,right:a()(m.DoneMenuText,{}),onClickRight:this.props.onCancel,...t}:{menuType:c.og.Popup,...this.props.desktopMinWidth&&{minWidth:this.props.desktopMinWidth},...this.props.desktopMaxWidth&&{maxWidth:this.props.desktopMaxWidth},...this.props.desktopWidth&&{width:this.props.desktopWidth},...t},s.createElement(p.Z,n()({},o,{header:this.renderHeading()}),this.props.children)}})}renderHeading(){if(!this.environment.device.isMobile)return a()(u.Z,{style:v.headingStyle,title:this.props.title,right:this.props.helpButton})}}v.displayName="CollectionViewMenu",v.headingStyle={height:f+g-2,paddingTop:g-2};const y=v},44514:(e,t,o)=>{o.d(t,{Q:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(82990)),a=o(52821);const s={...r.Z.textOverflowStyle,position:"absolute",left:0,right:0,top:0,bottom:0},l={marginLeft:4,fontWeight:r.Z.fontWeight.semibold};function c(e){window.__c={n:"CollectionViewMenuTitle"};const{prefix:t,viewName:o,viewType:i}=e;return n()("div",{style:{position:"relative",width:"100%"}},void 0," ",n()("div",{style:s},void 0,t,i&&a.aW[i]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),n()("span",{style:l},void 0,o)))}},45669:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=o(67294),a=o(5366),s=o(78316),l=o(62896);const c=function(e){let{collectionViewName:t,collectionViewType:o}=e;return window.__c={n:"CollectionViewTitleText"},t?n()(l.Z,{},void 0,t):"page"===o?n()(a.FormattedMessage,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled",description:"Shown for untitled pages in a database page view"}):r.createElement(a.FormattedMessage,s.b1[o])}},35127:(e,t,o)=>{o.d(t,{v:()=>Ae});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(5366),u=o(99036),m=o(67219),g=o(21202),h=o(77420),f=o(19889),v=o(70203),y=o(97880);class b{}b.text=e=>new k(e),b.mentionDate=e=>new _(e),b.mentionUser=e=>new M(e),b.mentionBot=e=>new M(e),b.mentionPage=e=>new M(e),b.mentionTemplateVariable=e=>new T(e),b.mentionFormulaContextVariable=e=>new I(e),b.mentionFormulaPagePropertyVariable=e=>new P(e),b.equation=e=>new C(e),b.concat=e=>new S(e);class S{constructor(e){this.build=()=>{const e=[];for(const t of this.tokens){const o=t.build();e.push(o[0])}return e},this.tokens=e}}class w{constructor(e){this.styles={},this.highlight=void 0,this.bold=()=>(this.styles[v.GK.Bold]=!0,this),this.italic=()=>(this.styles[v.GK.Italic]=!0,this),this.strike=()=>(this.styles[v.GK.Strike]=!0,this),this.code=()=>(this.styles[v.GK.Code]=!0,this),this.underline=()=>(this.styles[v.GK.Underline]=!0,this),this.color=e=>(this.highlight=e,this),this.build=()=>{const e=[];for(const t of(0,y.Yd)(this.styles))e.push([t]);return this.highlight&&e.push([v.GK.Highlight,this.highlight]),this.onBuild(e)},this.onBuild=e}}class k extends w{constructor(e){super((t=>{if(this.url&&t.unshift(v.ed(this.url)),t.length>0){return[[e,t]]}return[[e]]})),this.url=void 0,this.link=e=>(this.url=e,this)}}class C extends w{constructor(e){super((t=>[v.qZ(e,t)]))}}class _ extends w{constructor(e){super((t=>{let o;"date"in e?o=this.getDateAnnotationData(e.date):"time"in e?o=this.getTimeAnnotationData(e.time):(0,y.t1)(e);const i=v.pZ(o);return[v.YC(i,t)]})),this.getDateString=e=>e.toISOString().split("T")[0],this.getTimeString=e=>e.toISOString().split("T")[1].slice(0,5)}getDateAnnotationData(e){if(Array.isArray(e)){const[t,o]=e;return{type:"daterange",start_date:this.getDateString(t),end_date:this.getDateString(o)}}return{type:"date",start_date:this.getDateString(e)}}getTimeAnnotationData(e){if(Array.isArray(e)){const[t,o]=e;return{type:"datetimerange",start_date:this.getDateString(t),start_time:this.getTimeString(t),end_date:this.getDateString(o),end_time:this.getTimeString(o),time_zone:"Etc/GMT"}}return{type:"datetime",start_date:this.getDateString(e),start_time:this.getTimeString(e),time_zone:"Etc/GMT"}}}class M extends w{constructor(e){super((t=>{let o;return e.table===f.KJ?o=v.tE(e.id):e.table===h.cZ?o=v.Cb(e.id):e.table===g.iU?o=v.$0(e.id,e.spaceId):(0,y.t1)(e),[v.YC(o,t)]}))}}class T extends w{constructor(e){super((t=>{const o=v.WB({type:e});return[v.YC(o,t)]}))}}class I extends w{constructor(e){super((t=>{const o=v._Q(e);return[v.YC(o,t)]}))}}class P extends w{constructor(e){super((t=>{const o=v.kb(e);return[v.YC(o,t)]}))}}var x=o(82433),B=o(4615),Z=o(23014),E=o(6287);const R=(0,p.defineMessages)({nextSprintName:{id:"structuredAutomations.createNextSprint.nextSprintName",defaultMessage:"Sprint",description:"When creating a new sprint automatically for a user for project management, this will be the default name."}});function A(e){const{createNextSprintActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:i,intl:n,spaceId:r,getCurrentSprintActionId:a,sprintStatusPropertyId:s,sprintUniqueIdPropertyId:l}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:z({actionId:a,sprintCollectionPointer:o,sprintUniqueIdPropertyId:l,incrementBy:1,intl:n})},action:"replace"},[s]:{value:{type:"simple",value:[[`"${i}"`]]},action:"replace"}},properties:["title",s],collection:o},space_id:r}}function D(e){const{getCurrentSprintActionId:t,sprintCollectionPointer:o,sprintCollectionSchema:i,spaceId:n}=e;return{id:t,type:"query_collection",config:{filter:Z.qB[m.p$].current.reducer.getCombinatorFilter(i),collection:o},space_id:n}}function F(e){const{getLargestUniqueIdSprintActionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:i,spaceId:n}=e;return{id:t,type:"query_collection",config:{filter:void 0,collection:o,sort:[{property:i,direction:"descending"}],limit:1},space_id:n}}function L(e){const{createFutureSprintActionId:t,sprintCollectionPointer:o,sprintStatusFutureOptionName:i,intl:n,spaceId:r,getLargestUniqueIdSprintActionId:a,sprintStatusPropertyId:s,sprintUniqueIdPropertyId:l,incrementBy:c}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:z({actionId:a,sprintCollectionPointer:o,sprintUniqueIdPropertyId:l,intl:n,incrementBy:c})},action:"replace"},[s]:{value:{type:"simple",value:[[`"${i}"`]]},action:"replace"}},properties:["title",s],collection:o},space_id:r}}function V(e){const{updateFutureSprintToNextActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:i,sprintStatusFutureOptionName:n,spaceId:r,sprintStatusPropertyId:a,sprintUniqueIdPropertyId:s}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:a,filter:{operator:"status_is",value:{type:"is_option",value:n}}}]},sort:[{property:s,direction:"ascending"}],limit:1},values:{[a]:{value:{type:"simple",value:[[`"${i}"`]]},action:"replace"}},properties:[a]},space_id:r}}function N(e){const{moveIncompleteTasksActionId:t,createNextSprintActionId:o,taskCollectionPointer:i,taskStatusCompleteGroupName:n,spaceId:r,nextSprintInput:a,taskStatusPropertyId:s,taskSprintRelationPropertyId:l}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:i,filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is_not",value:{type:"is_group",value:n}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:l}]}},properties:[l],values:{[l]:{value:{type:"simple",value:"pointer"===a.type?b.mentionPage(a.pointer).build():b.mentionFormulaContextVariable({id:(0,x.Kd)({source:"action",action_id:o,action_output_type:"page"})}).build()},action:"replace"}}},space_id:r}}function O(e){const{moveIncompleteTasksToBacklogActionId:t,taskCollectionPointer:o,taskStatusCompleteGroupName:i,spaceId:n,taskStatusPropertyId:r,taskSprintRelationPropertyId:a}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:r,filter:{operator:"status_is_not",value:{type:"is_group",value:i}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:a}]}},properties:[a],values:{[a]:{value:void 0,action:"remove"}}},space_id:n}}function U(e){const{updateCurrentSprintToPastActionId:t,getCurrentSprintActionId:o,sprintStatusPastOptionName:i,spaceId:n,sprintStatusPropertyId:r}=e;return{id:t,type:"update_pages",config:{target:{id:(0,x.Kd)({source:"action",action_id:o,action_output_type:"pages"}),type:"variable"},values:{[r]:{value:{type:"simple",value:[[`"${i}"`]]},action:"replace"}},properties:[r]},space_id:n}}function H(e){const{updateNextSprintToCurrentActionId:t,createNextSprintActionId:o,sprintStatusCurrentOptionName:i,spaceId:n,nextSprintInput:r,sprintStatusPropertyId:a}=e;return{id:t,type:"update_pages",config:{target:"pointer"===r.type?{type:"page",page:r.pointer}:{id:(0,x.Kd)({source:"action",action_id:o,action_output_type:"page"}),type:"variable"},values:{[a]:{value:{type:"simple",value:[[`"${i}"`]]},action:"replace"}},properties:[a]},space_id:n}}function z(e){const{actionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:i,incrementBy:n,intl:r}=e;return b.concat([b.text(`joinText(" ", "${r.formatMessage(R.nextSprintName)}", _toPlainText(`),b.mentionFormulaContextVariable({id:(0,x.Kd)({source:"action",action_id:t,action_output_type:"pages"})}),b.text(".first()."),b.mentionFormulaPagePropertyVariable({collection:o,property:i}),b.text(`+${n}))`)]).build()}var W=o(76205),j=o(42875),K=o(3779),Y=o(89837),G=o(29477),X=o(68626),q=o(82990),$=o(82993),J=o(64434),Q=o(60709),ee=o(29376),te=o(10161),oe=o(75498),ie=o(52275),ne=o(31945),re=o(68785),ae=o(78140),se=o(9342),le=o(63296),ce=o(72495),de=o(1800),pe=o(59054),ue=o(21768),me=o(31299),ge=o(70219),he=o(58484),fe=o(3815),ve=o(75259),ye=o(78030),be=o(36488),Se=o(74194),we=o(84076),ke=o(31278),Ce=o(76798);const _e=(0,p.defineMessages)({noResults:{id:"completeSprintButton.selectSprintPickerMenu.noResults.label",defaultMessage:"No results",description:"Label when user has no results after searching."}});function Me(e){window.__c={n:"SelectSprintPickerMenu"};const{collectionStore:t,compiledNextSprintFilter:o,compiledFutureSprintFilter:i,previewProperties:r,onSelect:d,onCreateNew:u,searchInputPlaceholder:m,menuItemSectionHeader:g}=e,h=(0,p.useIntl)(),f=(0,l.O7)(),{isMobile:v}=(0,l.Fy)(),[b,S]=s.useState(""),[{value:w}]=(0,pe.r5)((async()=>await Pe({environment:f,searchQuery:"",collectionStore:t})),[f,t]),k=(0,c.VK)((()=>xe({compiledFilter:o,pageStores:w})),[o,w]),C=(0,c.VK)((()=>xe({compiledFilter:i,pageStores:w})),[i,w]),_=s.useMemo((()=>k.length>0?k:C),[k,C]),[{value:M}]=(0,pe.r5)((async()=>(await Pe({environment:f,searchQuery:b,collectionStore:t})).filter((e=>_.find((t=>t.id===e.id))))),[f,b,t,_]),T=(0,c.VK)((()=>new he.Z),[]),I=Te(),P=0===_.length&&""===b,x=(0,c.VK)((()=>{if(P)return[{key:"empty",render:e=>s.createElement(ie.Z,n()({},e,{icon:K.Z.plus(I.icon),style:I.row,title:a()(p.FormattedMessage,{id:"completeSprintButton.selectSprintPickerMenu.createNewSprint.label",defaultMessage:"Create a new sprint",description:"Label to prompt user to create a sprint if we find they have no future sprints"})})),action:()=>{u()}}];return(""===b?_:M??[]).map((e=>function(e){const{collectionStore:t,pageStore:o,previewProperties:i,onSelect:r,blockPropertyValueOverlayStore:l}=e,c=o.getIcon();return{key:o.id,action:()=>{const e=o.getSpaceShardedPointer();e&&r(e)},render:e=>s.createElement(ie.Z,n()({},e,{icon:c&&a()(ke.Z,{disabled:!0,icon:c,isEmptyPage:!1,size:20}),title:a()("div",{style:{display:"flex",maxHeight:22,alignItems:"center"}},void 0,i.map((e=>"title"===e.property?a()(Ce.Z,{store:o}):a()(ve.Z,{store:o,property:e.property,disabled:!1,locked:!1,format:ye.C.Relation,tableWrap:!1,blockPropertyValueOverlayStore:l,collectionStore:t},e.property))).filter(y.$K))}))}}({pageStore:e,collectionStore:t,previewProperties:r,onSelect:d,blockPropertyValueOverlayStore:T})))}),[t,r,T,d,u,b,P,_,M,I.icon,I.row]);let B;B=v?{menuType:Q.og.ActionSheet}:{menuType:Q.og.Popup,header:a()(Ie,{searchQuery:b,setSearchQuery:S,collectionStore:t,placeholder:m}),maxHeight:"50vh",width:350};const Z=""!==b&&0===x.length,E=P||Z?h.formatMessage(_e.noResults):g;return a()(be.Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowUndo:!0,allowTabUntab:!0,render:()=>s.createElement(ae.Z,B,a()(se.Z,{type:se.i.Vertical,initialFocus:0,sections:[{key:"filtered-collection-section",items:x,render:e=>s.createElement(ce.Z,n()({},e,{title:E}))}]}))})}function Te(){return(0,d.yK)((e=>({regular:{color:e.mediumTextColor,whiteSpace:"nowrap",marginLeft:4},headerWrap:{display:"flex",width:"100%",position:"relative",zIndex:2,padding:"6px 10px",fontSize:14,background:e.inputBackground,boxShadow:`\n\t\t\t\t\t0 1px 0 ${e.darkDividerColor}\n\t\t\t\t`},recordTitle:{fontWeight:q.Z.fontWeight.semibold,fontSize:14,marginLeft:4},searchIcon:{fill:e.mediumIconColor,width:14,height:14,marginRight:10},icon:{width:16,fill:e.mediumIconColor,marginRight:4,marginLeft:-2},row:{fontSize:14,minHeight:32,color:e.mediumTextColor}})),[])}function Ie(e){window.__c={n:"Header"};const{searchQuery:t,setSearchQuery:o,placeholder:i,collectionStore:n}=e,r=(0,l.O7)(),s=(0,c.VK)((()=>n.getIcon()),[n]),d=(0,ge.b)(r),u=(0,c.VK)((()=>{const e=n.getParentId();if(!e)return;const t=fe.G.createChildStore(n,{table:g.iU,id:e}),o=n.isDefined()?d(n.getSpaceId()):void 0;return(0,de.Z)({pageId:t.id,pageModel:t.getModel(),baseUrl:o})}),[d,n]),m=Te();return a()("div",{style:m.headerWrap},void 0,a()(Se.Z,{style:{flexGrow:1},value:t,placeholder:i,forceShowClearButton:Boolean(t),focus:!0,onChange:e=>{o(e.target.value)},onClearButtonClick:()=>{o("")},format:Se.B.Transparent}),a()("div",{style:{display:"flex",marginLeft:10,alignItems:"center"}},void 0,a()(p.FormattedMessage,{id:"searchFilteredCollectionMenu.targetDatabase.title",defaultMessage:"<regular>In</regular> {databaseWithIcon}",description:"Title for menu that enables users to search in a database. The word 'in' appears as regular text, and the database appears as clickable page link. This message indicates what database is being searched, for example: 'In [🎒Tasks]'",values:{regular:e=>a()("span",{style:m.regular},void 0,e),databaseWithIcon:a()(we.Z,{href:u,style:{marginLeft:4},innerStyle:{display:"flex"}},void 0,a()(ke.Z,{disabled:!0,icon:s,isEmptyPage:!1,size:20}),a()(Ce.Z,{store:n,underline:!0,style:m.recordTitle}))}})))}async function Pe(e){const{environment:t,searchQuery:o,collectionStore:i}=e,{results:n}=await me.df({environment:t,query:o,collectionId:i.id,limit:20,spaceId:i.getSpaceId(),excludeTemplates:!0,source:"filtered_collection_menu",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!0,ignoresHighlight:!0});return n.map((e=>fe.G.createChildStore(i,{id:e,table:g.iU,spaceId:i.getSpaceId()})))}function xe(e){const{pageStores:t,compiledFilter:o}=e;return t&&0!==t.length?t.filter((e=>{const t=e.getModel();if(t)return!e.isTemplate()&&o({block:t,getRecordModel:ue.o.fromGetRecordValueFn(e.getRecordValue),propertyMapping:void 0})})):[]}const Be=(0,p.defineMessages)({searchInputPlaceholder:{id:"completeSprintAutomationButton.searchInputPlaceholder.title",defaultMessage:"Select sprint",description:"Search input placeholder for when user wants to select their next sprint."},keepInThisSprintHeader:{id:"completeSprintAutomationButton.menuItemSectionHeader.keepInThisSprint.title",defaultMessage:"Select next sprint…",description:"User prompt for section header with looking at the list of next sprint options."},incompleteTasksPlaceholder:{id:"completeSprintAutomationButton.menuItemSectionHeader.incompleteTasksPlaceholder.title",defaultMessage:"Select action for incomplete tasks",description:"User prompt for section header when selecting what do with the users incomplete tasks"},incompleteTasksHeader:{id:"completeSprintAutomationButton.menuItemSectionHeader.incompleteTasks.title",defaultMessage:"{numIncompleteTasks, plural, one {1 incomplete task} other {{numIncompleteTasks} incomplete tasks}}",description:"User prompt for section header informs the user number of incomplete tasks"}});function Ze(e){const{collectionContextStore:t,completeSprintAutomationContext:o,completedTasksInCurrentSprint:i}=e,r=(0,l.O7)(),u=(0,l.Fy)(),g=(0,p.useIntl)(),h=r.currentUser.id,{sprintCollectionSchema:f,sprintCollectionStore:v}=o,y=(0,c.VK)((()=>te.default.checkGate("proj_management_sprints")),[]),[b,S]=s.useState(!1),w=(0,c.VK)((()=>function(e){const{sprintCollectionSchema:t,intl:o,currentUserId:i}=e,n=Z.qB[m.p$].next.reducer.getCombinatorFilter(t);if(!n)return;return(0,W.q)({filter:n,context:{schema:t,userId:i,userTimeZone:(0,j.r)(),userStartOfWeek:(0,Y.aN)(),relativeVariableResult:void 0,intl:o}})}({sprintCollectionSchema:f,intl:g,currentUserId:h})),[h,f,g]),k=(0,c.VK)((()=>function(e){var t;const{sprintCollectionStore:o,sprintCollectionSchema:i,intl:n,currentUserId:r}=e,a=o.getPropertyMapping();if(!a)return;const s=a[m.Zb],l=i[s];if("status"!==(null==l?void 0:l.type))return;const c=null===(t=l.options)||void 0===t?void 0:t.find((e=>e.id===m.eH));if(!c)return;const d={operator:"status_is",value:{type:"is_option",value:c.value}},p={operator:"and",filters:[{property:s,filter:d}]};return(0,W.q)({filter:p,context:{schema:i,userId:r,userTimeZone:(0,j.r)(),userStartOfWeek:(0,Y.aN)(),relativeVariableResult:void 0,intl:n}})}({sprintCollectionStore:v,sprintCollectionSchema:f,intl:g,currentUserId:h})),[h,v,f,g]),C=e=>a()("div",{style:e},void 0,a()(re.Z,{})),_=function(e){const{isPhone:t}=e;return(0,d.yK)((e=>({icon:{fill:e.accentColors.blue[400]},button:{height:26,marginLeft:8,fontWeight:q.Z.fontWeight.medium,...t&&{flexGrow:1}}})),[t])}({isPhone:u.isPhone});return y&&w&&k?s.createElement(s.Fragment,null,a()(ne.Z,{popupType:u.isMobile?ne.Z.PopupType.SlideUp:ne.Z.PopupType.Popup,alignmentToOrigin:ne.Z.Alignment.End,placementToOrigin:ne.Z.Placement.Bottom,render:e=>a()(Ee,{buttonPopupParent:e,collectionContextStore:t,completedTasksInCurrentSprint:i,completeSprintAutomationContext:o,compiledNextSprintFilter:w,compiledFutureSprintFilter:k,setIsLoading:S}),renderOrigin:e=>s.createElement(le.Z,n()({},e,{iconStyle:_.icon,icon:b?C:K.Z.checkedRoundedCheckmark,style:_.button,disabled:b,disabledFeedback:b}),a()(p.FormattedMessage,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label",description:"Button user can press on their tasks 'current sprint' view to mark the current sprint as complete."}))})):null}function Ee(e){const{buttonPopupParent:t,compiledNextSprintFilter:o,compiledFutureSprintFilter:i,collectionContextStore:n,completeSprintAutomationContext:r,completedTasksInCurrentSprint:d,setIsLoading:g}=e,h=(0,p.useIntl)(),f=(0,l.O7)(),v=(0,c.VK)((()=>{const e=null==d?void 0:d.split("/");if(!e||2!==e.length)return;const t=Number(e[0]);return{numIncompleteTasks:Number(e[1])-t}}),[d]),b=(0,c.VK)((()=>(0,ee.U1)({collectionStore:r.taskCollectionStore,property:m.oG}).filter((e=>e.visible&&("title"===e.property||r.sprintCollectionSchema[e.property])))),[r]),S=null==v?void 0:v.numIncompleteTasks,w=void 0!==S?h.formatMessage(Be.incompleteTasksHeader,{numIncompleteTasks:S}):void 0,[k,C]=s.useState({type:"select_next_sprint"}),_=s.useCallback((async(e,o)=>{if(t.close(),!e||!o)return;g(!0);const i=function(e){var t,o,i,n,r,a,s,l,c,d,p,g;const{sprintCollectionValue:h,nextSprintInput:f,intl:v}=e,b=h.space_id,S={id:h.id,table:E.v,spaceId:b},w=(0,B.ZP)(),k=(0,B.ZP)(),C=(0,B.ZP)(),_=(0,B.ZP)(),M=(0,B.ZP)(),T=(0,B.ZP)(),I=(0,B.ZP)(),P=(0,u.oC)(h),x=null===(t=h.format)||void 0===t||null===(o=t.app_uri_map)||void 0===o?void 0:o[m.Zb];if(!x)return{error:{message:`${m.Zb} not found.`}};const Z=null===(i=h.format)||void 0===i||null===(n=i.app_uri_map)||void 0===n?void 0:n[m.OQ];if(!Z)return{error:{message:`${m.OQ} not found.`}};const R=P[x];if(!R||"status"!==R.type)return{error:{message:`${m.Zb} not found.`}};const z=null===(r=R.options)||void 0===r||null===(a=r.find((e=>e.id===m.J1)))||void 0===a?void 0:a.value,W=null===(s=R.options)||void 0===s||null===(l=s.find((e=>e.id===m.SF)))||void 0===l?void 0:l.value,j=null===(c=R.options)||void 0===c||null===(d=c.find((e=>e.id===m.YE)))||void 0===d?void 0:d.value,K=null===(p=R.options)||void 0===p||null===(g=p.find((e=>e.id===m.eH)))||void 0===g?void 0:g.value;if(!(z&&W&&j&&K))return{error:{message:`Could not find required options for ${m.Zb}.`}};const Y="pointer"===f.type?1:2;if("complete_sprint"===e.type)return{value:[F({getLargestUniqueIdSprintActionId:T,sprintCollectionPointer:S,sprintUniqueIdPropertyId:Z,spaceId:b}),D({getCurrentSprintActionId:w,sprintCollectionPointer:S,sprintCollectionSchema:P,spaceId:b}),..."pointer"===f.type?[]:[A({createNextSprintActionId:I,getCurrentSprintActionId:w,sprintCollectionPointer:S,sprintStatusNextOptionName:j,intl:v,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z})],U({updateCurrentSprintToPastActionId:k,getCurrentSprintActionId:w,sprintStatusPastOptionName:z,sprintStatusPropertyId:x,spaceId:b}),H({updateNextSprintToCurrentActionId:C,createNextSprintActionId:I,nextSprintInput:f,sprintStatusCurrentOptionName:W,sprintStatusPropertyId:x,spaceId:b}),L({createFutureSprintActionId:M,sprintCollectionPointer:S,sprintStatusFutureOptionName:K,getLargestUniqueIdSprintActionId:T,intl:v,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z,incrementBy:Y}),V({updateFutureSprintToNextActionId:_,sprintCollectionPointer:S,sprintStatusNextOptionName:j,sprintStatusFutureOptionName:K,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z})]};if("complete_sprint_and_move_incomplete_tasks_to_next_sprint"===e.type){var G,X,q,$,J,Q;const{taskCollectionValue:t}=e,o={id:t.id,table:E.v,spaceId:t.space_id},i=(0,B.ZP)(),n=null===(G=t.format)||void 0===G||null===(X=G.app_uri_map)||void 0===X?void 0:X[m.fp];if(!n)return{error:{message:`${m.fp} not found.`}};const r=null===(q=t.format)||void 0===q||null===($=q.app_uri_map)||void 0===$?void 0:$[m.oG];if(!r)return{error:{message:`${m.oG} not found.`}};const a=(0,u.oC)(t)[n];if(!a||"status"!==a.type)return{error:{message:`${m.fp} not found.`}};const s=null===(J=a.groups)||void 0===J||null===(Q=J.find((e=>e.id===m.uS)))||void 0===Q?void 0:Q.name;return s?{value:[F({getLargestUniqueIdSprintActionId:T,sprintCollectionPointer:S,sprintUniqueIdPropertyId:Z,spaceId:b}),D({getCurrentSprintActionId:w,sprintCollectionPointer:S,sprintCollectionSchema:P,spaceId:b}),..."pointer"===f.type?[]:[A({createNextSprintActionId:I,getCurrentSprintActionId:w,sprintCollectionPointer:S,sprintStatusNextOptionName:j,intl:v,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z})],N({moveIncompleteTasksActionId:i,createNextSprintActionId:I,nextSprintInput:f,taskCollectionPointer:o,taskStatusCompleteGroupName:s,spaceId:b,taskStatusPropertyId:n,taskSprintRelationPropertyId:r}),U({updateCurrentSprintToPastActionId:k,getCurrentSprintActionId:w,sprintStatusPastOptionName:z,spaceId:b,sprintStatusPropertyId:x}),H({updateNextSprintToCurrentActionId:C,createNextSprintActionId:I,nextSprintInput:f,sprintStatusCurrentOptionName:W,spaceId:b,sprintStatusPropertyId:x}),L({createFutureSprintActionId:M,sprintCollectionPointer:S,sprintStatusFutureOptionName:K,getLargestUniqueIdSprintActionId:T,intl:v,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z,incrementBy:Y}),V({updateFutureSprintToNextActionId:_,sprintCollectionPointer:S,sprintStatusNextOptionName:j,sprintStatusFutureOptionName:K,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z})]}:{error:{message:`Could not find required group for ${m.fp}.`}}}if("complete_sprint_and_move_incomplete_tasks_to_backlog"===e.type){var ee,te,oe,ie,ne,re;const{taskCollectionValue:t}=e,o={id:t.id,table:E.v,spaceId:t.space_id},i=(0,B.ZP)(),n=null===(ee=t.format)||void 0===ee||null===(te=ee.app_uri_map)||void 0===te?void 0:te[m.fp];if(!n)return{error:{message:`${m.fp} not found.`}};const r=null===(oe=t.format)||void 0===oe||null===(ie=oe.app_uri_map)||void 0===ie?void 0:ie[m.oG];if(!r)return{error:{message:`${m.oG} not found.`}};const a=(0,u.oC)(t)[n];if(!a||"status"!==a.type)return{error:{message:`${m.fp} not found.`}};const s=null===(ne=a.groups)||void 0===ne||null===(re=ne.find((e=>e.id===m.uS)))||void 0===re?void 0:re.name;return s?{value:[F({getLargestUniqueIdSprintActionId:T,sprintCollectionPointer:S,sprintUniqueIdPropertyId:Z,spaceId:b}),D({getCurrentSprintActionId:w,sprintCollectionPointer:S,sprintCollectionSchema:P,spaceId:b}),..."pointer"===f.type?[]:[A({createNextSprintActionId:I,getCurrentSprintActionId:w,sprintCollectionPointer:S,sprintStatusNextOptionName:j,intl:v,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z})],O({moveIncompleteTasksToBacklogActionId:i,taskCollectionPointer:o,taskStatusCompleteGroupName:s,spaceId:b,taskStatusPropertyId:n,taskSprintRelationPropertyId:r}),U({updateCurrentSprintToPastActionId:k,getCurrentSprintActionId:w,sprintStatusPastOptionName:z,spaceId:b,sprintStatusPropertyId:x}),H({updateNextSprintToCurrentActionId:C,createNextSprintActionId:I,nextSprintInput:f,sprintStatusCurrentOptionName:W,spaceId:b,sprintStatusPropertyId:x}),L({createFutureSprintActionId:M,sprintCollectionPointer:S,sprintStatusFutureOptionName:K,getLargestUniqueIdSprintActionId:T,intl:v,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z,incrementBy:Y}),V({updateFutureSprintToNextActionId:_,sprintCollectionPointer:S,sprintStatusNextOptionName:j,sprintStatusFutureOptionName:K,spaceId:b,sprintStatusPropertyId:x,sprintUniqueIdPropertyId:Z})]}:{error:{message:`Could not find required group for ${m.fp}.`}}}return(0,y.t1)(e.type)}({type:e,sprintCollectionValue:r.sprintCollectionValue,taskCollectionValue:r.taskCollectionValue,nextSprintInput:o,intl:h});if(X.x.isFail(i))throw new Error(i.error.message);await $.oS({environment:f,store:r.blockStore,clientContext:{type:"structured_automation",persisted:!1,intl:h,parentRecordStore:r.blockStore,actions:i.value,parentPointer:r.blockStore.getSpaceShardedPointer()}}),await Promise.all([J.dj(f,n,{src:"complete_sprint_automation",queuedTimestamp:Date.now()}),(0,G.Vs)(1e3)]),g(!1)}),[r,n,f,h,g,t]),M=s.useCallback((e=>{0===S?_("complete_sprint",e):C({type:"select_incomplete_task_action",nextSprintInput:e})}),[_,S]);return"select_next_sprint"===k.type?a()(Me,{blockStore:r.blockStore,collectionStore:r.sprintCollectionStore,compiledNextSprintFilter:o,compiledFutureSprintFilter:i,searchInputPlaceholder:h.formatMessage(Be.searchInputPlaceholder),menuItemSectionHeader:h.formatMessage(Be.keepInThisSprintHeader),previewProperties:b,onSelect:e=>{M({type:"pointer",pointer:e})},onCreateNew:()=>{M({type:"actionId"})}}):"select_incomplete_task_action"===k.type?a()(Re,{onActionSelect:e=>{_(e,k.nextSprintInput)},title:w}):(0,y.t1)(k)}function Re(e){window.__c={n:"AutomationActionOptionsMenu"};const{onActionSelect:t,title:o}=e,{isMobile:i}=(0,l.Fy)(),r=(0,p.useIntl)();let c;return c=i?{menuType:Q.og.ActionSheet}:{menuType:Q.og.Popup,maxHeight:"50vh",minWidth:230},s.createElement(ae.Z,c,a()(se.Z,{type:se.i.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:[{key:"move_to_next_sprint",action:()=>{t("complete_sprint_and_move_incomplete_tasks_to_next_sprint")},render:e=>s.createElement(ie.Z,n()({},e,{title:a()(p.FormattedMessage,{id:"completeSprintAutomationButton.moveToNextSprintItem.title",defaultMessage:"Move incomplete tasks to next sprint",description:"Option in 'Complete Sprint' action dropdown to move incomplete tasks to the next sprint."})}))},{key:"keep_in_this_sprint",action:()=>{t("complete_sprint")},render:e=>s.createElement(ie.Z,n()({},e,{title:a()(p.FormattedMessage,{id:"completeSprintAutomationButton.keepInThisSprintItem.title",defaultMessage:"Keep incomplete tasks in this sprint",description:"Option in 'Complete Sprint' action dropdown that keeps incomplete tasks in current sprint."})}))},{key:"move_to_backlog",action:()=>{t("complete_sprint_and_move_incomplete_tasks_to_backlog")},render:e=>s.createElement(ie.Z,n()({},e,{title:a()(p.FormattedMessage,{id:"completeSprintAutomationButton.moveToBacklogItem.title",defaultMessage:"Move incomplete tasks to backlog",description:"Option in 'Complete Sprint' action dropdown to move incomplete tasks to the backlog (not assigned to any sprint)."})}))}],render:e=>s.createElement(ce.Z,n()({},e,{title:o||r.formatMessage(Be.incompleteTasksPlaceholder)}))}]}))}function Ae(e){window.__c={n:"CompleteSprintAutomationButton"};const{collectionContextStore:t,completeSprintAutomationContext:o}=e,i=(0,c.VK)((()=>{var e,t;const i=o.taskCollectionStore.getPropertyMapping(),n=null==i?void 0:i[m.oG];if(!n)return;const r=null==i?void 0:i[m.fp],a=o.taskCollectionStore.getSchema()[r];if(!r||!a||"status"!==a.type)return;const s=null===(e=a.groups)||void 0===e||null===(t=e.find((e=>(null==e?void 0:e.id)===m.uS)))||void 0===t?void 0:t.name;return s?{type:"aggregation",filter:{operator:"and",filters:[{property:n,filter:{operator:"relation_contains",value:[{type:"relative",value:{type:"builtin",variable:"current"}}]}}]},aggregation:{aggregator:{operator:"count_per_group",groupName:s},property:r}}:void 0}),[o]);return i?a()(oe.Z,{id:"complete_sprint_automation_completed_tasks",collectionContextStore:t,reducer:i,render:e=>{var i,n;const r="text"===(null===(i=e.state)||void 0===i?void 0:i.aggregationResult.type)?null===(n=e.state)||void 0===n?void 0:n.aggregationResult.value:void 0;return a()(Ze,{collectionContextStore:t,completeSprintAutomationContext:o,completedTasksInCurrentSprint:r})}}):a()(Ze,{collectionContextStore:t,completeSprintAutomationContext:o,completedTasksInCurrentSprint:void 0})}},49312:(e,t,o)=>{o.d(t,{b:()=>u,Z:()=>_});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=(o(67294),o(62518)),l=o(83355),c=o(1302),d=o(14976),p=o(97880);let u,m;function g(e){const{device:t,e:o,action:i,onSubmit:n}=e;if(i===m.Submit)n&&n(o);else if(i===m.Newline){if(!t.isIOS)return;o.preventDefault&&o.preventDefault(),document.execCommand("insertLineBreak")}else(0,p.t1)(i)}!function(e){e.Inline="Inline",e.InlineWrap="InlineWrap",e.Textarea="Textarea"}(u||(u={})),function(e){e.Submit="Submit",e.Newline="Newline"}(m||(m={}));var h=o(73744),f=o(72133),v=o(49085);class y extends v.Z{getInitialState(){return{}}}const b=y;var S=o(24666),w=o(29595),k=o(3386);class C extends l.Z{constructor(){super(...arguments),this.storeTypes={store:b},this.handleWindowMouseDown=e=>{const t=s.findDOMNode(this);t&&!t.contains(e.target)&&this.props.onBlur&&this.props.onBlur()},this.handleEsc=e=>{this.handleKeyEvent(),this.props.onCancel&&this.props.onCancel(e)},this.handleShiftEnter=e=>{const{device:t}=this.environment;t.isIOS&&!("shiftKey"in e)?g({device:t,e,action:m.Newline}):this.handleEnter(e)},this.handleEnter=e=>{const{type:t,onSubmit:o}=this.props,{device:i}=this.environment;if(this.getDisabled())return;g({device:i,e,action:function(e){const{device:t,type:o,e:i}=e;return o===u.Inline?m.Submit:o===u.InlineWrap?t.isPhone?m.Submit:"altKey"in i&&i.altKey||"shiftKey"in i&&i.shiftKey?m.Newline:m.Submit:o===u.Textarea?m.Newline:void(0,p.t1)(o)}({device:i,type:t,e}),onSubmit:o})},this.handleLeft=e=>{this.getDisabled()||(this.handleKeyEvent(),this.props.onLeft&&this.props.onLeft(e))},this.handleRight=e=>{this.getDisabled()||(this.handleKeyEvent(),this.props.onRight&&this.props.onRight(e))},this.handleKeyEvent=()=>{c.default.afterNextFlush((()=>{this.saveSerializedTextSelection()}))},this.getDisabled=()=>!!this.props.disabled||!this.props.focus,this.getHtml=()=>{const e=a().escape(this.props.value+(this.props.value.length>0?"\n":""));return this.props.getHtml?this.props.getHtml(e):e},this.getSelection=()=>{const e=this.stores.store.state.selection;return e&&{type:"contain",selection:e}},this.handleMutation=e=>{let{newValue:t}=e;this.saveSerializedTextSelection(),this.props.onChange(t)},this.saveSerializedTextSelection=()=>{const{store:e}=this.stores,t=d.Ut(this.environment,f.get());t&&(a().isEqual(t.selection,e.state.selection)||this.stores.store.setState({selection:t.selection}),t.forceEmitSelectionStore&&S.default.emit())}}willMount(e){super.willMount(e),h.lj(window,"mousedown",this.handleWindowMouseDown)}willMountOrUpdate(e){super.willMountOrUpdate(e);const{store:t}=this.stores;e.focus&&!t.state.selection&&(e.selectAll?t.setState({selection:{startIndex:0,endIndex:e.value.length}}):t.setState({selection:{startIndex:e.value.length,endIndex:e.value.length}}))}willUnmount(){super.willUnmount(),h.ZV(window,"mousedown",this.handleWindowMouseDown)}renderComponent(){const{type:e}=this.props;return n()(k.Z,{capture:!this.getDisabled(),onDelete:this.handleKeyEvent,onBackspace:this.handleKeyEvent,onEnter:this.handleEnter,onShiftEnter:this.handleShiftEnter,onCommandEnter:this.handleKeyEvent,onCommandShiftEnter:this.handleKeyEvent,onUp:this.handleKeyEvent,onDown:this.handleKeyEvent,onLeft:this.handleLeft,onRight:this.handleRight,onTab:this.handleKeyEvent,onUntab:this.handleKeyEvent,onSelectAll:this.handleKeyEvent,onToggleBold:this.handleKeyEvent,onToggleItalics:this.handleKeyEvent,onToggleStrike:this.handleKeyEvent,onToggleCode:this.handleKeyEvent,onUndo:this.handleKeyEvent,onRedo:this.handleKeyEvent,onEsc:this.handleEsc,onCut:this.handleKeyEvent,onCopy:this.handleKeyEvent,onPaste:this.handleKeyEvent,onKeypress:this.handleKeyEvent,onHome:this.handleKeyEvent,onEnd:this.handleKeyEvent,onGoToBeginningOfLine:this.handleKeyEvent,onGoToEndOfLine:this.handleKeyEvent,onGoForwardOneChar:this.handleKeyEvent,onGoBackwardOneChar:this.handleKeyEvent},void 0,n()(w.Z,{style:{...this.props.style,whiteSpace:"pre-wrap"},placeholder:this.props.placeholder,placeholderStyle:this.props.placeholderStyle,spellCheck:!1,autoCorrect:this.props.autoCorrect,autoCapitalize:this.props.autoCapitalize,getDisabled:this.getDisabled,getHtml:this.getHtml,getSelection:this.getSelection,onMutation:this.handleMutation,suppressNewlineEvents:e===u.Inline}))}}C.displayName="ContentEditableInput",C.Type=u;const _=C},29595:(e,t,o)=>{o.d(t,{Z:()=>b});var i=o(97464),n=o.n(i),r=o(67294),a=o(83355),s=o(18466),l=o(1302),c=o(80357),d=o(97880),p=o(14976),u=o(46150),m=o(62619),g=o(45162),h=(o(60846),o(72133)),f=o(24666);let v=!1;class y extends a.Z{constructor(e){super(e),this.root=null,this.ownNodeIsComposing=!1,this.testDiv=document.createElement("div"),this.shouldDisableContentEditableForMobile=!1,this.handleRootMount=e=>{this.root=e},this.handleTextSelectionEditingStoreForMobile=()=>{this.shouldDisableContentEditableForMobile=!f.default.isEditingStore.state,this.root&&this.updateContentEditableAttribute(this.root)},this.handleCompositionStart=()=>{const{device:e}=this.environment;e.isAndroid||(this.ownNodeIsComposing=!0,this.props.onCompositionStart&&this.props.onCompositionStart())},this.handleCompositionEnd=()=>{const{device:e}=this.environment;e.isAndroid||(this.ownNodeIsComposing=!1,this.handleInput(),this.props.onCompositionEnd&&this.props.onCompositionEnd())},this.handleBeforeInput=e=>{const{suppressNewlineEvents:t}=this.props;if(!m.kA(e))throw new Error("Invalid event");var o;if(t&&("insertLineBreak"!==e.inputType&&"insertParagraph"!==e.inputType||e.preventDefault(),this.environment.device.isAndroid&&"insertCompositionText"===e.inputType&&null!==(o=e.data)&&void 0!==o&&o.endsWith("\n")&&e.target===this.root)){var i;v;const e=()=>{var t;this.delegateMutation({insertedLine:!0,deletedLine:!1,newValue:this.getText(),multiSelection:void 0,isComposing:this.isComposing}),null===(t=this.root)||void 0===t||t.removeEventListener("input",e)};null===(i=this.root)||void 0===i||i.addEventListener("input",e)}},this.handleSelect=e=>{this.delegateSelection("contain")},this.handleClick=e=>{var t,o;3===e.nativeEvent.detail&&(p.TQ(this.environment.device),this.delegateSelection("contain")),null===(t=(o=this.props).onClick)||void 0===t||t.call(o,e)},this.handleInput=this.handleInput.bind(this)}get isComposing(){var e;return Boolean(this.ownNodeIsComposing||(null===(e=this.contentEditableContext)||void 0===e?void 0:e.isComposing()))}get registries(){var e;return[null===(e=this.contentEditableContext)||void 0===e?void 0:e.contentEditableLeafRegistry]}getText(){return p.n$(this.environment,this.root)}delegateSelection(e){var t,o;this.isComposing||(null===(t=(o=this.props).onSelect)||void 0===t||t.call(o,{endpoint:e,component:this}))}delegateMutation(e){this.handleMutation(e)}delegateBeforeInput(e){this.handleBeforeInput(e)}delegateKeyDown(e){var t,o;null===(t=(o=this.props).onKeyDown)||void 0===t||t.call(o,e)}delegateCompositionEnd(e){var t,o;null===(t=(o=this.props).onCompositionEnd)||void 0===t||t.call(o)}getNode(){return this.root}willMount(){this.environment.device.isMobile&&this.props.disableContentEditableWhenNotEditingTextOnMobile&&(this.shouldDisableContentEditableForMobile=s.Z.withListenerIgnored((()=>!f.default.isEditingStore.state)),f.default.isEditingStore.addListener(this.handleTextSelectionEditingStoreForMobile))}willMountOrUpdate(e){this.selection=e.getSelection(),this.disabled=e.getDisabled(),this.html=e.getHtml()}didMount(){this.updateContainer(!0),this.root&&m.OW&&this.root.addEventListener("beforeinput",this.handleBeforeInput)}didUpdate(){this.updateContainer(!1)}willUnmount(){this.environment.device.isMobile&&this.props.disableContentEditableWhenNotEditingTextOnMobile&&f.default.isEditingStore.removeListener(this.handleTextSelectionEditingStoreForMobile),this.root&&m.OW&&this.root.removeEventListener("beforeinput",this.handleBeforeInput)}updateContentEditableAttribute(e){const t=e.getAttribute("contenteditable");this.disabled||this.shouldDisableContentEditableForMobile?"false"!==t&&this.mutateDOM((function(){e.contentEditable="false"})):"true"!==t&&this.mutateDOM((function(){e.contentEditable="true"}))}updateContainer(e){var t;const{device:o}=this.environment;if(null===(t=this.contentEditableContext)||void 0===t||t.contentEditableLeafRegistry.register(this),this.root&&(this.updateContentEditableAttribute(this.root),!this.isComposing)){if(e)this.root.innerHTML=this.html;else{this.previousHtml!==this.html&&(this.previousHtml=this.html,this.testDiv.innerHTML=this.html);const e=this.root.innerHTML,t=this.testDiv.innerHTML;e!==t&&(this.root.innerHTML=this.html)}if(this.disabled)return;if(h.isMouseSelecting())return;if(this.selection)switch(this.selection.type){case"start":case"end":{var i;null===(i=this.contentEditableContext)||void 0===i||i.tryEnableMultiSelection();const e=p.bD(this.root,this.selection.index),t={endpoint:this.selection.type,onlyIfEqual:this.contentEditableContext,position:e};h.setDOMEndpoint(t,this.environment.device),this.updateSelectionEndpoint(t);break}case"contain":{const e=p.lw(this.root,this.selection.selection.startIndex,this.selection.selection.endIndex),t=h.get();p.Dn(t,e)||(o.isAndroid&&document.activeElement!==this.root&&this.root.focus(),h.set(e,o));break}default:(0,d.t1)(this.selection)}else if(!e){const e=h.get(),t=!o.isAndroid||s.Z.withListenerIgnored((()=>"empty"===f.default.state.mode));e&&e.commonAncestorContainer&&m.UG(e.commonAncestorContainer)&&this.root.contains(e.commonAncestorContainer)&&t&&h.clear(this.environment)}}}updateSelectionEndpoint(e){const t=h.get(),o=h.getIncompleteDOMEndpoint();if(t&&o===e)switch(e.endpoint){case"start":return void h.setDOMEndpoint({endpoint:"end",onlyIfEqual:this.contentEditableContext,position:{container:t.endContainer,offset:t.endOffset}},this.environment.device);case"end":return void h.setDOMEndpoint({endpoint:"start",onlyIfEqual:this.contentEditableContext,position:{container:t.startContainer,offset:t.startOffset}},this.environment.device);default:(0,d.t1)(e.endpoint)}}renderComponent(){const{onContextMenu:e,onKeyDown:t,onDoubleClick:o,onMouseDown:i,onTouchStart:a,placeholder:s,onBlur:l,onFocus:d,onMouseOver:p,onMouseOut:m}=this.props,h=Boolean(!this.html),f=(!(0,g.ri)(this.environment.device)||!(0,g.Aw)(this.environment))&&this.props.spellCheck;return r.createElement("div",n()({ref:this.handleRootMount},(0,c.iv)(this.props.className,h&&this.props.placeholderStyle?this.props.placeholderStyle:this.props.style,!this.disabled&&"notranslate"),{onCompositionStart:this.handleCompositionStart,onCompositionEnd:this.handleCompositionEnd,onInput:this.handleInput,spellCheck:f,autoCorrect:this.props.autoCorrect,autoCapitalize:this.props.autoCapitalize,onSelect:this.handleSelect,onClick:this.handleClick,onBlur:l,onFocus:d,onContextMenu:e,onKeyDown:t,onDoubleClick:o,onMouseDown:i,onTouchStart:a,onMouseOver:p,onMouseOut:m,placeholder:s},u.GF))}handleMutation(e){this.props.onMutation&&this.props.onMutation(e),l.default.flush()}handleInput(){this.handleMutation({newValue:this.getText(),insertedLine:!1,isComposing:this.isComposing})}}y.displayName="ContentEditableLeaf";const b=y},61134:(e,t,o)=>{o.d(t,{O:()=>Y});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(27537),l=o.n(s),c=o(96486),d=o(67294),p=o(60177),u=o(45060);const m={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0};class g{constructor(e){this.node=void 0,this.onMutations=void 0,this.unlockedFor=new Set,this.isLocked=!1,this.longRenderWarningTimeout=void 0,this.observer=void 0,this.isObserving=!1,this.queue=[],this.setNode=e=>{this.mutate((()=>{this.node=e||void 0}))},this.unlockForRender=e=>{this.unlockedFor.add(e),this.isLocked&&this.isObserving&&this.startLongRenderWarning(),this.stopObservingAndHandleMutations()},this.onMutations=e.onMutations,this.observer="undefined"==typeof MutationObserver?void 0:new MutationObserver((e=>{this.queue.push(...e),this.stopObservingAndHandleMutations(),this.startObserving()}))}mutate(e){const t={displayName:"DOMLock.mutate()"};try{return this.unlockForRender(t),e()}finally{this.lockAfterRender(t)}}lockAfterRender(e){this.unlockedFor.delete(e),this.isLocked&&0===this.unlockedFor.size&&(this.stopLongRenderWarning(),this.startObserving())}lock(e){this.isLocked=!0,this.lockAfterRender(e)}unlock(e){this.stopLongRenderWarning(),this.isLocked=!1,this.unlockForRender(e)}startObserving(){if(this.isObserving)return;const e=this.node;var t;e&&(null===(t=this.observer)||void 0===t||t.observe(e,m),this.isObserving=!0)}stopObservingAndHandleMutations(){if(this.observer&&this.isObserving){const e=this.queue.concat(this.observer.takeRecords());this.queue.length=0,this.observer.disconnect(),this.isObserving=!1,e.length>0&&this.onMutations(e)}}startLongRenderWarning(){if(this.longRenderWarningTimeout)return;const e=Date.now();this.longRenderWarningTimeout=window.setInterval((()=>{(0,u.XY)([`DOMLock: still unlocked after ${Date.now()-e}ms for ${this.unlockedFor.size} components:`,this.unlockedFor,this])}),1e3)}stopLongRenderWarning(){this.longRenderWarningTimeout&&(window.clearInterval(this.longRenderWarningTimeout),this.longRenderWarningTimeout=void 0)}}function h(e,t){switch(e.type){case"attributes":if(e.target instanceof Element&&e.attributeName)return t&&(0,u.XY)(["Reverting mutation of attribute",e.attributeName,`from "${e.oldValue}" -> "${e.target.getAttribute(e.attributeName)}"`,"in component",(0,u.Hc)(e.target),e]),null===e.oldValue?void e.target.removeAttribute(e.attributeName):void e.target.setAttribute(e.attributeName,e.oldValue);break;case"characterData":return t&&(0,u.XY)(["Reverting mutation of characterData",`"${e.oldValue}" -> "${e.target.textContent}"`,"in component",(0,u.Hc)(e.target),e]),void(e.target.textContent=e.oldValue);case"childList":{t&&(0,u.XY)(["Reverting mutation of childList","in component",(0,u.Hc)(e.target),e]);let o=0;for(o=e.removedNodes.length-1;o>=0;o--)e.target.insertBefore(e.removedNodes[o],e.nextSibling);for(o=e.addedNodes.length-1;o>=0;o--){const t=e.addedNodes[o];t.parentNode&&t.parentNode.removeChild(t)}return}}console.error("DOMLock: unable to revert mutation",e)}var f=o(480),v=o(81954),y=o(24405),b=o(41432),S=o(80357),w=o(44805),k=o(97880),C=o(62134),_=o(98104),M=o(95477),T=o(14976),I=o(46150),P=o(62619),x=o(72133);const B=["initial","keyDown","compositionStart","beforeInput","compositionUpdate","domMutations","input","compositionEnd","keyUp"],Z={keyDown:"keyUp",beforeInput:"input",input:"domMutations",domMutations:"input",compositionStart:"compositionEnd"},E={compositionUpdate:"beforeInput"};class R{constructor(){this.flowData=new Map,this.nextFlow=new A,this.currentFlow=void 0,this.previousFlow=void 0,this.listeners=new Set,this.handleSelectionChange=()=>{this.nextFlow.beforeRange=x.toStaticRange(x.get())},this.handleKeyDown=e=>{this.advanceToPhase("keyDown").keyDown=e,this.emitUpdate(),this.endIfComplete()},this.handleCompositionStart=e=>{this.advanceToPhase("compositionStart").compositionStart=e,this.emitUpdate(),this.endIfComplete()},this.handleBeforeInput=e=>{var t;if(!(0,P.kA)(e))return;const o=(null===(t=e.getTargetRanges)||void 0===t?void 0:t.call(e))||[];this.advanceToPhase("beforeInput").beforeInput={event:e,targetRanges:o},this.emitUpdate(),this.endIfComplete()},this.handleCompositionUpdate=e=>{this.advanceToPhase("compositionUpdate").compositionUpdate=e,this.emitUpdate()},this.handleInput=e=>{this.advanceToPhase("input").input=e,this.emitUpdate(),this.endIfComplete()},this.handleCompositionEnd=e=>{this.advanceToPhase("compositionEnd").compositionEnd=e,this.emitUpdate(),this.endIfComplete()},this.handleKeyUp=e=>{this.advanceToPhase("keyUp").keyUp=e,this.emitUpdate(),this.endFlow()},this.handleMutations=e=>{let{currentFlow:t}=this;t&&!t.domMutations||(t=this.advanceToPhase("initial")),t.domMutations={afterPhase:t.phase,mutations:e},this.emitUpdate(),this.endIfComplete()}}attachEventListeners(e){const{div:t,document:o}=e;return o.addEventListener("selectionchange",this.handleSelectionChange),t.addEventListener("input",this.handleInput),t.addEventListener("keydown",this.handleKeyDown),t.addEventListener("keyup",this.handleKeyUp),t.addEventListener("beforeinput",this.handleBeforeInput),t.addEventListener("compositionstart",this.handleCompositionStart),t.addEventListener("compositionupdate",this.handleCompositionUpdate),t.addEventListener("compositionend",this.handleCompositionEnd),()=>{o.removeEventListener("selectionchange",this.handleSelectionChange),t.removeEventListener("input",this.handleInput),t.removeEventListener("keydown",this.handleKeyDown),t.removeEventListener("keyup",this.handleKeyUp),t.removeEventListener("beforeinput",this.handleBeforeInput),t.removeEventListener("compositionstart",this.handleCompositionStart),t.removeEventListener("compositionupdate",this.handleCompositionUpdate),t.removeEventListener("compositionend",this.handleCompositionEnd)}}onInputFlowChange(e){return this.listeners.add(e),()=>this.listeners.delete(e)}isComposing(){var e;return this.currentFlow&&!this.currentFlow.isPhase("initial")?this.currentFlow.isComposing():(null===(e=this.previousFlow)||void 0===e?void 0:e.isComposing())||!1}reset(){this.nextFlow=new A,this.currentFlow=void 0,this.previousFlow=void 0,this.flowData=new Map}getCurrentFlow(){const e=this.currentFlow;if(!e)return;return{flow:e,data:this.getData(e)}}getData(e){const t=this.flowData.get(e);if(t)return t;const o={};return this.flowData.set(e,o),o}endIfComplete(){const{currentFlow:e}=this;e&&e.isComplete()&&this.endFlow()}emitUpdate(){const{currentFlow:e}=this;if(e){const t={type:"update",flow:e,data:this.getData(e)};this.listeners.forEach((e=>e(t)))}}endFlow(){const{currentFlow:e}=this;if(e){const t=this.previousFlow;this.previousFlow=e,this.currentFlow=void 0;const o={type:"end",flow:e,data:this.getData(e)};this.listeners.forEach((e=>e(o))),t&&this.flowData.delete(t)}}advanceToPhase(e){return this.currentFlow&&this.currentFlow.canTransitionToPhase(e)||(this.endFlow(),this.currentFlow=this.nextFlow,this.nextFlow=new A),this.currentFlow.phase=e,this.currentFlow}}class A{constructor(){this.phase="initial",this.beforeRange=x.toStaticRange(x.get()),this.initial=void 0,this.keyDown=void 0,this.compositionStart=void 0,this.beforeInput=void 0,this.compositionUpdate=void 0,this.input=void 0,this.compositionEnd=void 0,this.domMutations=void 0,this.keyUp=void 0}isPhase(e){return this.phase===e}hasEvents(){return Boolean(this.compositionStart||this.compositionEnd||this.compositionUpdate||this.keyDown||this.keyUp||this.beforeInput||this.input)}isComposing(){var e,t;switch(this.phase){case"compositionStart":case"compositionUpdate":return!0;case"compositionEnd":return!1;case"beforeInput":return Boolean(null===(e=this.beforeInput)||void 0===e?void 0:e.event.isComposing);case"input":case"keyDown":case"keyUp":return Boolean(null===(t=this[this.phase])||void 0===t?void 0:t.isComposing);case"initial":return!1;default:(0,k.t1)(this.phase)}}transitionToPhase(e,t){return!!this.canTransitionToPhase(e)&&(this.phase=e,this[e]=t,!0)}canTransitionToPhase(e){return!this[e]&&(E[this.phase]===e||1===function(e,t){const o=B.indexOf(e),i=B.indexOf(t),n=o-i;if(n<0)return-1;if(n>0)return 1;return 0}(e,this.phase))}isComplete(){for(const[e,t]of(0,k.qP)(Z))if(this[e]&&!this[t])return!1;return!0}getTargetRanges(){var e;const t=null===(e=this.beforeInput)||void 0===e?void 0:e.targetRanges;return null!=t&&t.length?t:this.beforeRange?[this.beforeRange]:[]}}var D=o(68056),F=o(45162),L=o(55010),V=o(35431),N=o(59730);let O,U;O=Symbol.iterator;class H{constructor(e){if(this.leftToRight=new Map,this.rightToLeft=new Map,e)for(const[t,o]of e)this.assoc(t,o)}assoc(e,t){const o=[];if(this.leftToRight.has(e)){const t=this.leftToRight.get(e);o.push((()=>this.rightToLeft.delete(t)))}if(this.rightToLeft.has(t)){const e=this.rightToLeft.get(t);o.push((()=>this.leftToRight.delete(e)))}for(const i of o)i();return this.leftToRight.set(e,t),this.rightToLeft.set(t,e),this}getLeft(e){return this.leftToRight.get(e)}getRight(e){return this.rightToLeft.get(e)}hasLeft(e){return this.leftToRight.has(e)}hasRight(e){return this.rightToLeft.has(e)}deleteLeft(e){if(this.leftToRight.has(e)){const t=this.leftToRight.get(e);return this.leftToRight.delete(e),this.rightToLeft.delete(t),!0}return!1}deleteRight(e){if(this.rightToLeft.has(e)){const t=this.rightToLeft.get(e);return this.leftToRight.delete(t),this.rightToLeft.delete(e),!0}return!1}*[O](){for(const[e,t]of this.leftToRight)yield[e,t]}}U=Symbol.iterator;class z{constructor(e,t,o){if(this.leftName=void 0,this.rightName=void 0,this.biMap=void 0,e===t)throw new N.D3("NamedBiMap left and right names are equal",{data:{name:e}});if(this.leftName=e,this.rightName=t,this.biMap=new H,o)for(const[i,n]of o)this.biMap.assoc(i,n)}assoc(e){const t=e[this.leftName],o=e[this.rightName];return this.biMap.assoc(t,o),this}get(e){if(this.leftName in e){const t=e[this.leftName];return this.biMap.getLeft(t)}if(this.rightName in e){const t=e[this.rightName];return this.biMap.getRight(t)}throw new N.D3("NamedBiMap.get fallthrough should never occur",{data:e})}delete(e){if(this.leftName in e){const t=e[this.leftName];return this.biMap.deleteLeft(t)}if(this.rightName in e){const t=e[this.rightName];return this.biMap.deleteRight(t)}throw new N.D3("NamedBiMap.delete fallthrough should never occur",{data:e})}has(e){if(this.leftName in e){const t=e[this.leftName];return this.biMap.hasLeft(t)}if(this.rightName in e){const t=e[this.rightName];return this.biMap.hasRight(t)}throw new N.D3("NamedBiMap.has fallthrough should never occur",{data:e})}[U](){return this.biMap[Symbol.iterator]()}}class W extends V.Z{constructor(){super(...arguments),this.nodeMap=new z("node","component",new H)}register(e){const t=super.register(e),o=e.getNode();return o?this.nodeMap.assoc({node:o,component:e}):this.nodeMap.delete({component:e}),t}unregister(e){super.unregister(e),this.nodeMap.delete({component:e})}getByDOMOrder(){const e=Array.from(this.nodeMap.biMap.rightToLeft.entries());return e.sort(((e,t)=>{const o=e[1],i=t[1];return(0,L.Z)(o,i)})),e.map((e=>{let[t,o]=e;return{node:o,leaf:t}}))}getParentContentEditableLeaf(e){const t=(0,I.X1)(e),o=t&&this.nodeMap.get({node:t});if(t&&o)return{node:t,leaf:o}}}var j=o(3815),K=o(24666);function Y(e){window.__c={n:"ContentEditableRoot"};const{children:t,style:o,displayName:i}=e,r=!e.disabled,s=(0,d.useRef)(null),u=(0,d.useRef)(0),[m,P]=(0,d.useState)(null),B=(0,d.useRef)(!1),Z=(0,d.useRef)(!1),[E]=(0,d.useState)((()=>function(e){return`${e}-${$++}`}(i))),A=(0,d.useRef)(void 0),L=(0,d.useRef)({displayName:E}),[V]=(0,d.useState)((()=>new R)),[N]=(0,d.useState)((()=>new W)),[O]=(0,d.useState)((()=>new g({onMutations(e){V.handleMutations(e)}}))),U=(0,d.useRef)(!1),H=(0,d.useCallback)((e=>{U.current!==e&&(U.current=e,O.mutate((()=>{var t,o;e?null===(t=s.current)||void 0===t||t.setAttribute(I.HM,"true"):null===(o=s.current)||void 0===o||o.removeAttribute(I.HM)})))}),[O]),z=(0,d.useRef)(!1),Y=(0,d.useCallback)((e=>{z.current!==e&&(z.current=e,O.mutate((()=>{var t,o;e?null===(t=s.current)||void 0===t||t.setAttribute(I._F,"true"):null===(o=s.current)||void 0===o||o.removeAttribute(I._F)})))}),[O]),Q=(0,d.useCallback)((e=>{s.current=e,O.setNode(e),P(e)}),[O]),ee=(0,f.O7)(),te=(0,v.VK)((()=>(0,F.Aw)(ee)),[ee]);(0,d.useEffect)((()=>{if(m&&te)return V.attachEventListeners({div:m,document:window.document})}),[V,te,m]);const{isFirefox:oe,isAndroid:ie}=ee.device;(0,d.useEffect)((()=>{const e=e=>{var t;const o=x.get(),i=(0,F.Zb)({range:o,contentEditableLeafRegistry:N,allowInvisibleEndSelection:!0,constraintToContentEditableRootNode:s.current||void 0}),n=K.default.state,r="editing"===n.mode?n.multiSelection:void 0;return{leafs:i,multiSelection:ie&&e.isPhase("beforeInput")&&(!r||(0,D.iG)(r))&&x.isExpanded(o)?null===(t=(0,F.fx)({range:o,contentEditableLeafRegistry:N,allowInvisibleEndSelection:!0}))||void 0===t?void 0:t.multiSelection:r,range:x.toStaticRange(o)}};return V.onInputFlowChange((t=>{Y(V.isComposing());const{flow:o,type:i,data:n}=t;if("end"!==i){if("update"!==i||!o.isPhase("beforeInput")&&n.target||(n.target=e(o)),"update"===i&&o.domMutations&&!n.handledMutations){var r,a;n.handledMutations=!0;const t=o.domMutations.mutations,i=n.target||e(o),m=!oe||i.multiSelection&&(0,D.iG)(i.multiSelection)?null===(r=i.leafs)||void 0===r?void 0:r.start:G(N,s.current),g=null===(a=i.leafs)||void 0===a?void 0:a.start,f=null==m?void 0:m.leaf.getText();X("onMutations",n,f,o,m);const v=o.hasEvents(),y=M.Z.isLocalhost||!v;let b=!1,S=!1,w=!1;for(let e=t.length-1;e>=0;e--){const o=t[e];q(o,m);const i=(0,I.xp)(o.target),n=(0,I.X1)(o.target);if(i===s.current){if((v||"attributes"!==o.type||"style"!==o.attributeName)&&("attributes"!==o.type||"dir"!==o.attributeName))if(m){if("childList"===o.type){const e=Array.from(o.removedNodes);S||=e.some(I.eD)||e.some(I.C7);const t=Array.from(o.addedNodes);w||=t.some(I.eD)}if(n&&n===m.node){switch(o.type){case"attributes":h(o,y);continue;case"characterData":case"childList":break;default:(0,k.t1)(o.type)}b=!0}else h(o,y)}else h(o,y)}else X("allowed mutation on interior region",i,o)}if(g&&(b||S)){var c,d,p,u;if("string"!=typeof f)throw new Error("focusedLeafText must be string");const e=null===(c=o.beforeInput)||void 0===c?void 0:c.event,t=null===(d=o.keyDown)||void 0===d?void 0:d.keyCode,i="enter"!==(void 0!==t&&l()(t))&&("insertLineBreak"===(null==e?void 0:e.inputType)||"insertParagraph"===(null==e?void 0:e.inputType)||"insertCompositionText"===(null==e?void 0:e.inputType)&&(null==e||null===(p=e.data)||void 0===p?void 0:p.endsWith("\n"))||w),r={multiSelection:null===(u=n.target)||void 0===u?void 0:u.multiSelection,newValue:f,deletedLine:S,insertedLine:i,isComposing:V.isComposing()};X("delegateMutation",r),g.leaf.delegateMutation(r)}}}else X("flow ended",n,o)}))}),[N,V,ie,oe,Y]),(0,d.useEffect)((()=>{const e=s.current;e&&te&&B.current&&O.mutate((()=>{r?e.contentEditable="true":e.removeAttribute("contentEditable")}))}),[r,te,O]);const ne=(0,d.useCallback)((()=>{const e=s.current;return!(!e||!te)&&(B.current?("always"===te&&H(!0),!1):(O.mutate((()=>{r?e.contentEditable="true":e.removeAttribute("contentEditable"),(0,F.ri)(ee.device)&&(e.spellcheck=!1)})),O.lock(L.current),B.current=!0,H("gesture"===te),X("enableMultiSelection"),!0))}),[O,te,H,ee.device,r]),re=(0,d.useCallback)((()=>{const e=s.current;return!(!B.current||!e)&&("always"===te?(H(!1),!1):!V.isComposing()&&(O.unlock(L.current),e.removeAttribute("contenteditable"),H(!1),X("disableMultiSelection"),B.current=!1,!0))}),[O,te,H,V]);(0,d.useEffect)((()=>{let e=x.get();function t(){var t;const o=null===(t=x.get())||void 0===t?void 0:t.cloneRange(),i=e;e=o;const n=s.current;n&&x.isExpanded(o)&&!x.isExpanded(i)&&(0,I.xp)(o.commonAncestorContainer)===n&&(0,I.X1)(o.commonAncestorContainer)&&ne()&&(n.focus(),x.isExpanded(x.get())||x.set(o,ee.device))}return document.addEventListener("selectionchange",t),()=>document.removeEventListener("selectionchange",t)}),[ne,ee.device]);const ae=(0,d.useCallback)((function(){const e=x.get();if(!x.isExpanded(e)&&re()&&e){const t=G(N,s.current,e);t&&t.node&&t.node instanceof HTMLElement&&t.node.focus(),x.set(e,ee.device)}}),[N,re,ee.device]),se=(0,d.useMemo)((()=>c.debounce(ae,50)),[ae]),{KeyboardShortcutStackStore:le}=ee,ce=(0,d.useRef)(),de=(0,d.useCallback)((function(e){const t=s.current;if(!t)return;if(!B.current)return;if("contextmenu"===e.nativeEvent.type)return;const o=x.get();if(X("onSelect (react selection)",x.toStaticRange(o)),!(ce.current&&o&&x.areRangesEqual(o,ce.current))){if(ce.current=x.toStaticRange(o),o){const i=o.startContainer===t&&0===o.startOffset&&o.endContainer===t&&0===o.endOffset,n=ye.current&&o.startContainer===ye.current&&Se.current&&o.endContainer===Se.current,r=ee.device.isIOS&&ee.device.isMobileNative&&e.timeStamp-u.current>500&&function(e,t,o){if(!e.collapsed||0!==e.startOffset)return!1;const i=(0,F.Zb)({range:e,contentEditableLeafRegistry:t,allowInvisibleEndSelection:!0,constraintToContentEditableRootNode:o}),n=t.getByDOMOrder()[0];return Boolean(n&&i&&i.start.leaf===n.leaf)}(o,N,t);if(i||n||r)return X("onSelect: propagateShortcut selectAll"),void C.dJ({KeyboardShortcutStackStore:le},new KeyboardEvent("keydown"),"selectAll")}if(o&&(x.isExpanded(o)||"always"===te)&&(0,I.xp)(o.commonAncestorContainer)===t){if(Z.current)return void(A.current=e);const t=G(N,s.current,o);t&&(X("onSelect: delegateSelection",t),t.leaf.delegateSelection("start"))}x.isExpanded(o)||se()}}),[te,N,se,le,ee]);(0,d.useEffect)((()=>{if(te&&!r){function e(){const e=x.get(),t=s.current;if(!t||!e)return;const o=(0,F.fx)({contentEditableLeafRegistry:N,range:e,allowInvisibleEndSelection:!0});o&&(0,I.xp)(e.commonAncestorContainer)===t&&_.NA({...o,readOnly:!0})}return document.addEventListener("selectionchange",e),()=>document.removeEventListener("selectionchange",e)}}),[te,r,N]);const pe=(0,d.useCallback)((()=>{Z.current=!0,A.current=void 0}),[]),ue=(0,d.useCallback)((e=>{const t=A.current;if(Z.current=!1,A.current=void 0,u.current=e.timeStamp,t){const e=G(N,s.current);X("handleTouchEnd: delegateSelection",e),null==e||e.leaf.delegateSelection("start")}}),[N]),me=(0,d.useCallback)((e=>{if(u.current=e.timeStamp,!B.current)return;const t=G(N,s.current);X("handleKeyDown: delegateKeyDown",t),null==t||t.leaf.delegateKeyDown(e)}),[N]);(0,d.useEffect)((()=>{const e=s.current;if(e)return e.addEventListener("beforeinput",t),()=>e.removeEventListener("beforeinput",t);function t(e){if(!B.current)return;const t=G(N,s.current);null==t||t.leaf.delegateBeforeInput(e)}}),[N]);const ge=(0,d.useCallback)((()=>{const e=s.current;if(!e)return;const t=function(){document.removeEventListener("selectionchange",t);const o=x.get();if(null!=o&&o.collapsed&&(0,I.xp)(o.commonAncestorContainer)===e){const e=(0,I.X1)(o.commonAncestorContainer),t=o.startContainer,i=o.startOffset;if(e&&t&&(0,T.x9)(e,t,i)){const n=e.getElementsByClassName(w.$A)[0];n&&(X("Move collapsed selection before EOL marker",{parentLeafNode:e,caretContainer:t,caretOffset:i}),o.setStartBefore(n),o.setEndBefore(n),x.set(o,ee.device))}}};document.addEventListener("selectionchange",t)}),[ee.device]);(0,d.useEffect)((()=>{"always"!==te||B.current||ne()}),[ne,te]);const he=(0,d.useCallback)((()=>{const e=x.get();return!x.isExpanded(e)&&re()}),[re]),fe=(0,d.useCallback)((()=>!ie&&Boolean(V.isComposing())),[V,ie]),ve=(0,y.yK)((e=>({div:{caretColor:e.regularTextColor,...o},whenContentEditable:{WebkitUserModify:"read-write-plaintext-only"}})),[o]),ye=(0,d.useRef)(null),be=d.createElement("span",{style:J,ref:ye}),Se=(0,d.useRef)(null),we=d.createElement("span",{style:J,ref:Se}),ke=(0,d.useCallback)((()=>{if(!x.get()&&"editing"===K.default.state.mode){const e=K.default.state.multiSelection.start.store;if(e instanceof j.G){const t=e.getType();if(t===b.Ti.linkToPage||t===b.Ti.linkToCollection)return}_.ZH(ee)}}),[ee]),Ce=(0,d.useCallback)((()=>{!s.current||x.get()&&"empty"!==K.default.state.mode||s.current.blur()}),[]);return d.createElement("div",n()({onBlur:ee.device.isIOS?ke:void 0,onFocus:ee.device.isIOS?Ce:void 0,onTouchStart:te?pe:void 0,onTouchEnd:te?ue:void 0,onTouchCancel:te?ue:void 0,onKeyDown:te?me:void 0,onCompositionEnd:te?function(e){if(!B.current)return;const t=G(N,s.current);null==t||t.leaf.delegateCompositionEnd(e)}:void 0,ref:Q},(0,S.iv)(ve.div,{whenContentEditable:ve.whenContentEditable}),{onMouseDown:ge,onSelect:de},I.GZ),a()(p.c1,{id:E,tryEnableMultiSelection:ne,tryDisableMultiSelection:he,isComposing:fe,domLock:O,contentEditableLeafRegistry:N},void 0,be,t,we))}function G(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.get();const i=(0,F.Zb)({range:o,contentEditableLeafRegistry:e,allowInvisibleEndSelection:!0,constraintToContentEditableRootNode:t||void 0});if(i)return i.start}function X(){}function q(e){const t={};if(t.type=e.type,t.target=e.target,t.targetIsText=e.target.nodeType===Node.TEXT_NODE,t.targetIsLeaf=(0,I.eD)(e.target),e.addedNodes.length){const o=Array.from(e.addedNodes);t.added=o,t.addedALeaf=o.some(I.eD),t.addedAText=o.some((e=>e.nodeType===Node.TEXT_NODE))}if(e.removedNodes.length){const o=Array.from(e.removedNodes);t.removed=o,t.removedALeaf=o.some(I.eD),t.removedAText=o.some((e=>e.nodeType===Node.TEXT_NODE))}"characterData"===e.type&&(t.newChars=e.target.textContent,t.oldChars=e.oldValue),t.mutation=e;for(var o=arguments.length,i=new Array(o>1?o-1:0),n=1;n<o;n++)i[n-1]=arguments[n]}let $=0;const J={height:"1px",width:"1px"}},68709:(e,t,o)=>{o.d(t,{p:()=>u});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(60177),c=o(80357),d=o(46150);const p={WebkitUserSelect:"none",userSelect:"none",pseudoSelection:{background:"transparent"}},u=s.forwardRef(((e,t)=>{const{allowSelectionWithin:o,style:i,className:r,...u}=e,m=(0,l.Dl)(),g=s.createElement("div",a()({ref:t,contentEditable:!1},(0,c.iv)(r,!o&&p,i),d.G0,u));return m?n()(l.c1,{void:!0},void 0,g):g}));u.displayName="ContentEditableVoid"},10182:(e,t,o)=>{o.d(t,{Z:()=>x});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(86658),u=o(53028),m=o(5366),g=o(92108),h=o(43250),f=o(60709),v=o(61893),y=o(31194),b=o(52275),S=o(31945),w=o(78140),k=o(9342),C=o(89728),_=o(72495),M=o(24006),T=o(64369);function I(e){let{hasDismissButton:t,onDismiss:o}=e;window.__c={n:"CookieConsentMenu"};const i=(0,l.O7)(),r=(0,d.Fg)(),c=(0,m.useIntl)(),[y,b]=(0,s.useState)(!1);(0,s.useEffect)((()=>()=>{t||y&&g.qo()}),[c,y,t]);const S=[{key:"trackingTypes",render:e=>s.createElement(_.Z,n()({},e,{topBorder:0!==e.index})),items:u.m4.map((e=>({key:e,render:t=>a()(P,{menuListItemProps:t,trackingType:e,setShowReloadOnMenuClose:b,isNativeiOSApp:i.device.isMobileNative&&i.device.isIOS}),action:()=>g.Nh(i,e)})))}];return a()(w.Z,{className:h.N7t,menuType:f.og.Popup,width:260},void 0,a()("div",{style:{display:"flex",alignItems:"center",paddingTop:t?4:0}},void 0,t&&s.createElement(s.Fragment,null,a()(T.Z,{isSmall:!0,isMultiline:!0,style:{width:"80%",paddingLeft:14}},void 0,a()("b",{},void 0,s.createElement(m.FormattedMessage,p.ze.customizeCookiesHeader))),a()(C.Z,{style:{float:"right",marginLeft:-8,paddingLeft:8,paddingRight:8,color:r.blueColor},onClick:()=>{g.OM(i,v.Z.getPermission()),o&&o()}},void 0,s.createElement(m.FormattedMessage,p.ze.cookieDismissButtonLabel)))),a()(k.Z,{type:k.i.Vertical,initialFocus:void 0,sections:S}))}function P(e){window.__c={n:"TrackingTypeToggle"};const{menuListItemProps:t,trackingType:o,setShowReloadOnMenuClose:i,isNativeiOSApp:r}=e,{title:u,caption:h,subtitle:f}=(0,p.G_)(o,r),[{permission:y}]=(0,c.AF)(v.Z),S=(0,d.Fg)(),w=(0,l.O7)();return s.createElement(b.Z,n()({},t,{title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()("div",{style:{marginRight:0}},void 0,s.createElement(m.FormattedMessage,u))),caption:a()("div",{},void 0,f&&a()("div",{},void 0,a()("span",{style:{color:S.errorText}},void 0,s.createElement(m.FormattedMessage,f))),a()("div",{},void 0,a()("span",{style:{color:S.mediumTextColor}},void 0,s.createElement(m.FormattedMessage,h)))),shouldWrapCaption:!0,right:a()("div",{style:{display:"flex",width:"100%",alignItems:"center",cursor:"pointer"}},void 0,a()(M.Z,{on:y[o],disabled:"necessary"===o,onClick:()=>{i(!0),g.Nh(w,o)}}))}))}const x=function(e){let{renderOrigin:t,hasDismissButton:o,onDismiss:i}=e;return window.__c={n:"CookieConsentButtonPopup"},a()(S.Z,{popupType:S.Z.PopupType.Popup,placementToOrigin:y.Iw.Bottom,alignmentToOrigin:y.lU.Start,renderOrigin:t,render:()=>a()(I,{hasDismissButton:o,onDismiss:i})})}},84015:(e,t,o)=>{o.d(t,{_:()=>m});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(26825),d=o(5366),p=o(44758),u=o(28992);function m(e){window.__c={n:"CumulativeBotBlockRoleTooltip"};const{role:t}=e,o=(0,d.useIntl)(),{device:i}=(0,l.O7)(),r=(0,p.zq)(t);return s.createElement(u.Z,n()({},e,{title:o.formatMessage((0,c.Gx)(t,void 0).label),shouldWrapCaption:!0,style:i.isMobile?{padding:"12px 4px"}:{padding:4,marginTop:2,marginBottom:2},captionStyle:{marginTop:4},caption:a()("div",{},void 0,r)}))}},43700:(e,t,o)=>{o.d(t,{Z:()=>y});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(5366),p=o(61766),u=o(31194),m=o(31945),g=o(89728),h=o(6318);const f=(0,d.defineMessages)({hideSimpleLabel:{id:"customizePageMenuVisibilitySelect.hideSimple.label",defaultMessage:"Hide",description:"Title for the option to hide information"},hideLabel:{id:"customizePageMenuVisibilitySelect.hide.label",defaultMessage:"Always hide"},hidePageLabel:{id:"customizePageMenuVisibilitySelect.off.label",defaultMessage:"Off"},showLabel:{id:"customizePageMenuVisibilitySelect.show.label",defaultMessage:"Always show"},showPageLabel:{id:"customizePageMenuVisibilitySelect.expanded.label",defaultMessage:"Expanded"},hideIfEmptyLabel:{id:"customizePageMenuVisibilitySelect.hideIfEmpty.label",defaultMessage:"Hide when empty"},collapsedLabel:{id:"customizePageMenuVisibilitySelect.collapsed.label",defaultMessage:"Show in popover"},defaultLabel:{id:"customizePageMenuVisibilitySelect.default.label",defaultMessage:"Default"},minimalLabel:{id:"customizePageMenuVisibilitySelect.minimal.label",defaultMessage:"Minimal"},sectionLabel:{id:"customizePageMenuVisibilitySelect.section.label",description:"When the property name is clicked, shows an option to show the relation as a page section",defaultMessage:"As page section"},propertyLabel:{id:"customizePageMenuVisibilitySelect.property.label",description:"When the property name is clicked, shows an option to show the relation as a property",defaultMessage:"As property"}});class v extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:p.Z}}renderComponent(){const{device:e}=this.environment;return n()(m.Z,{popupType:e.isMobile?m.Z.PopupType.SlideUp:m.Z.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>s.createElement(g.Z,a()({style:{color:this.theme.mediumTextColor,paddingRight:0,height:this.environment.device.isMobile?32:22},disabled:this.props.locked},e),v.getVisibilityLabel(this.props.visibility,this.props.showAsMenu),c.Z.chevronDown({width:10,marginLeft:4,marginRight:4,fill:this.theme.lightIconColor})),placementToOrigin:u.Iw.Bottom,onClose:this.props.onClose,render:e=>s.createElement(h.Z,a()({},this.props,{onClose:e.close}))})}static getVisibilityLabel(e,t){switch(e){case"hide":return s.createElement(d.FormattedMessage,f.hideLabel);case"show":return s.createElement(d.FormattedMessage,f.showLabel);case"hide_if_empty":return s.createElement(d.FormattedMessage,f.hideIfEmptyLabel);case"section_hide":return t?s.createElement(d.FormattedMessage,f.propertyLabel):s.createElement(d.FormattedMessage,f.hidePageLabel);case"section_show":return s.createElement(d.FormattedMessage,f.showPageLabel);case"section_collapsed":return s.createElement(d.FormattedMessage,f.collapsedLabel);case"inline":return t?s.createElement(d.FormattedMessage,f.sectionLabel):s.createElement(d.FormattedMessage,f.defaultLabel);case"minimal":return s.createElement(d.FormattedMessage,f.minimalLabel)}}}v.displayName="CustomizePageMenuVisibilitySelect";const y=v},6318:(e,t,o)=>{o.d(t,{Z:()=>S});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(6695),d=o(3779),p=o(5366),u=o(11599),m=o(60709),g=o(52275),h=o(78140),f=o(9342),v=o(72495),y=o(43700);class b extends l.Z{constructor(){super(...arguments),this.renderMenuItem=e=>{const{device:t}=this.environment;return{key:e,render:o=>s.createElement(g.Z,n()({},o,{textWrapperStyle:{marginRight:0},title:a()("div",{style:{display:"flex",alignItems:"center",width:150}},void 0,a()("div",{},void 0,y.Z.getVisibilityLabel(e,this.props.showAsMenu))),right:this.props.visibility===e?a()("div",{style:{width:t.isMobile?16:14}},void 0,d.Z.check()):void 0})),action:()=>{if("page"===this.props.type){const t=e;this.props.onSelect(t)}if("relation_property"===this.props.type){const t=e;this.props.onSelect(t)}else if("property"===this.props.type){const t=e;this.props.onSelect(t)}this.props.onClose&&this.props.onClose()}}}}renderComponent(){const{device:e}=this.environment,t=[{key:"visibilityLevels",render:e=>s.createElement(v.Z,n()({},e,{topBorder:0!==e.index})),items:"page"===this.props.type||"relation_property"===this.props.type?this.getPageOrPropertyVisibilityLevels().map((e=>this.renderMenuItem(e))):this.getPropertyVisibilityLevels().filter((e=>"property"!==this.props.type||"hide_if_empty"!==e||u.kq({propertySchema:this.props.propertySchema}))).map((e=>this.renderMenuItem(e)))}];let o;return o=e.isMobile?{menuType:m.og.Modal,title:a()(p.FormattedMessage,{id:"customizePageMenuVisibilitySelect.mobile.title",defaultMessage:"Select visibility"}),right:a()(p.FormattedMessage,{id:"customizePageMenuVisibilitySelect.mobile.doneButton.label",defaultMessage:"Done"}),onClickRight:()=>this.props.onClose&&this.props.onClose()}:{menuType:m.og.Popup,width:"auto",maxWidth:360},s.createElement(h.Z,o,a()(f.Z,{type:f.i.Vertical,initialFocus:void 0,sections:t}))}getPageOrPropertyVisibilityLevels(){return"page"!==this.props.type&&"relation_property"!==this.props.type?[]:this.props.visibilityLevels?this.props.visibilityLevels:c.Sn}getPropertyVisibilityLevels(){return c.AX}}b.displayName="CustomizePageMenuVisibilitySelectMenuItem";const S=b},89845:(e,t,o)=>{o.d(t,{Z:()=>b});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(13991),d=o(8848),p=o(42875),u=o(3779),m=o(61784),g=o(89837),h=o(63143),f=o(5366),v=o(58032);class y extends l.Z{constructor(){super(...arguments),this.reminderTimer=void 0}willMountOrUpdate(){this.createReminderTimer()}willUnmount(){this.clearReminderTimer()}createReminderTimer(){const e=this.props.value;if(!e)return;const t=g.KR(e,(0,p.r)());if(!t)return;const o=t.valueOf(),i=o-Date.now();i<0||i>h.A0||this.reminderTimer&&this.reminderTimer.timestamp===o||(this.reminderTimer&&clearTimeout(this.reminderTimer.timer),this.reminderTimer={timestamp:o,timer:setTimeout(this.enqueueForceUpdate,i)})}clearReminderTimer(){this.reminderTimer&&(clearTimeout(this.reminderTimer.timer),this.reminderTimer=void 0)}renderComponent(){const e=this.props.value;if(!e)return;const t=g.NK(e,(0,p.r)(),c.SP);let o;if(e.reminder){const t=g.Nm(e,(0,p.r)());o=t?{color:this.theme.errorText}:{color:d.ZP.blue}}return a()(v.Z,{renderTooltip:()=>s.createElement(s.Fragment,null,this.props.tooltipHeader,a()("div",{style:this.getTooltipStyle()},void 0,this.getTooltipFormattedTime(t.start),t.end?` → ${this.getTooltipFormattedTime(t.end)}`:"")),render:t=>s.createElement("div",n()({style:{...this.props.style,...o}},t),(0,m.ZV)({value:e,date_format:this.props.dateFormat,time_format:this.props.timeFormat,userTimeZone:(0,p.r)(),allowRelativeDates:!0,intl:this.props.intl,shortenDateAndRange:this.props.shortenDateAndRange,displayInUserTimezone:this.props.displayInUserTimezone}),e.reminder&&u.Z.alarmClock({display:"inline-block",width:"1em",marginLeft:6,marginRight:2,paddingBottom:4,verticalAlign:"middle"})),placement:this.props.tooltipPlacement})}getTooltipFormattedTime(e){return(0,m.ZW)(e,"medium_with_time")}getTooltipStyle(){return this.props.tooltipHeader?{color:this.theme.mediumInvertedTextColor}:{}}}y.displayName="DateBox";const b=(0,f.injectIntl)(y)},66653:(e,t,o)=>{o.d(t,{Z:()=>C});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(32918),u=o(89837),m=o(16953),g=o(97880),h=o(5366),f=o(17335),v=o(80084),y=o(67950),b=o(74194),S=o(68894),w=o(58032);class k extends d.Z{constructor(){super(...arguments),this.storeTypes={store:y.Z},this.renderInput=()=>{const{device:e}=this.environment,{store:t,hideClearButton:o,focused:i,value:n,...r}=this.props,s=e.isMobile&&"relative"!==(null==n?void 0:n.type)?"date":"text",l="date"===s?b.Z.Format.Transparent:b.Z.Format.Large,d=e.isMobile?void 0:i;return c.createElement(S.ZP,a()({},r,{type:s,format:l,left:this.renderMobilePlaceholder(s),showClearButton:this.showClearButton(),focus:d,onFocus:this.handleFocus,onClearButtonClick:this.handleClear,onChange:this.handleChange,onSubmit:this.handleSubmit,onBlur:this.handleBlur,value:this.getInputValue(),disableInput:"relative"===(null==n?void 0:n.type)},this.getInputStyles()))},this.handleFocus=e=>{const{onFocus:t}=this.props,{store:o}=this.stores;o.setState({...o.state,edited:!1}),t&&t(e)},this.handleClear=()=>{const{onClearButtonClick:e,onUpdate:t}=this.props,{store:o}=this.stores;o.setState({...o.state,edited:!0,temporary:"",error:void 0});const i=this.validateCurrent();i&&t(i),o.setState({...o.state,edited:!1}),e&&e()},this.handleChange=e=>{const{device:t}=this.environment,{store:o}=this.stores;o.setState({...o.state,edited:!0,temporary:e.target.value||""}),t.isAndroid&&this.handleBlur()},this.handleSubmit=e=>{const{onUpdate:t,onSubmit:o}=this.props,{store:i}=this.stores,n=this.validateCurrent();n&&(t(n),n.error?i.setState({...i.state,edited:!1,error:n.error}):i.reset()),o&&o(e,n)},this.handleBlur=e=>{const{onUpdate:t,onBlur:o}=this.props,{store:i}=this.stores,n=this.validateCurrent();n?(t(n),n.error?i.setState({...i.state,edited:!1,error:n.error}):i.reset()):i.setState({...i.state,edited:!1}),e&&o&&o(e)},this.styles={menuItem:{marginBottom:this.environment.device.isMobile?1:8},inputWrapper:{borderRadius:3,height:28,paddingRight:this.showClearButton()?8:0,position:"relative"},inputEditRegion:{width:this.showClearButton()?"calc(100% - 14px)":"100%"},inputEditRegionMobile:{padding:"2px 6px",position:"relative"},placeholder:{position:"absolute",left:this.environment.device.isIpad?26:12,top:this.environment.device.isIpad?void 0:"50%",transform:"translateY(-50%)"},tooltipOriginGap:-8}}didUpdate(e){const{store:t}=this.stores;l().isEqual(e.value,this.props.value)||t.reset()}renderComponent(){const e=this.styles,t=this.getError();return t?n()(w.Z,{renderTooltip:()=>t,forceVisibleState:!0,placement:w.Z.Placement.Left,render:this.renderInput,originGap:e.tooltipOriginGap}):this.renderInput()}getDateFormat(){const{device:e}=this.environment;return e.isMobile?"YYYY-MM-DD":this.props.desktopDateFormat??p.sF}renderMobilePlaceholder(e){const{placeholder:t,value:o}=this.props,i=this.styles,r=this.getThemeColors();if("date"===e&&!o)return n()("div",{style:{...i.placeholder,...r.placeholder}},void 0,t)}getInputValue(){const{device:e}=this.environment,{value:t,intl:o}=this.props,{store:i}=this.stores;if(t&&"relative"===t.type)return(0,f.x)(t);const n=t&&"date"!==t.type?u.Id(t):t;return e.isMobile?n?v.p6(n,o,this.getDateFormat()):"":i.state.temporary||i.state.edited?i.state.temporary:n?v.p6(n,o,this.getDateFormat()):""}getError(){const{store:e}=this.stores,{intl:t}=this.props;if(e.state.error)switch(e.state.error){case y.B.INVALID_DATE:return t.formatMessage({id:"dateInputError.invalidDateError.tooltip",defaultMessage:"Invalid date"});case y.B.INVALID_RANGE:return t.formatMessage({id:"dateInputError.invalidDateRangeError.tooltip",defaultMessage:"Invalid range"});default:(0,g.t1)(e.state.error)}}validateCurrent(){const{validate:e}=this.props,t=this.parseCurrentValue();if(t)return e?e(t):t}parseCurrentValue(){const{store:e}=this.stores;if(!e.state.edited)return;if(!e.state.temporary)return{value:void 0};const t=(0,m.parseDateValueWithInputFormat)(e.state.temporary,this.environment.device.isMobile?u.Iq:this.getDateFormat(),this.props.intl);return t?{value:{type:"date",start_date:t}}:{error:y.B.INVALID_DATE}}showClearButton(){const{device:e}=this.environment,{hideClearButton:t}=this.props;return!!e.isMobile||!t}getInputStyles(){const{device:e}=this.environment,{inputStyle:t,inputOuterStyle:o,style:i}=this.props,n=this.styles;return{style:{...n.menuItem,...i,marginRight:0},inputOuterStyle:{...this.getInputBorders(),...n.inputWrapper,...o},inputStyle:{...n.inputEditRegion,...e.isMobile&&n.inputEditRegionMobile,...t}}}getInputBorders(){const{disabled:e,focused:t}=this.props,o=this.getThemeColors(),i=this.getError();if(!e)return i?o.inputError:t?o.inputFocused:o.inputDefault}getThemeColors(){return{inputDefault:{background:this.theme.inputBackground,boxShadow:this.theme.inputBoxShadow},inputFocused:{background:this.theme.inputBackground,boxShadow:this.theme.outlineBlueInputBoxShadow},inputError:{background:this.theme.inputBackground,boxShadow:this.theme.outlineRedInputBoxShadow},placeholder:{color:this.theme.lightTextColor}}}}k.displayName="DateInputMenuItem";const C=(0,h.injectIntl)(k)},41209:(e,t,o)=>{o.d(t,{Z:()=>b});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(480),c=o(76205),d=o(17335),p=o(33929),u=o(60709),m=o(52275),g=o(31945),h=o(78140),f=o(9342),v=o(44532),y=o(72495);function b(e){window.__c={n:"DateOrRangeFilterOperatorValueMenu"};const{filterValue:t,renderOrigin:o,buttonPopupStore:i}=e,r=(0,l.O7)(),b=e=>"relative"===e.filter.type&&"custom"===e.filter.value?p.default.formatMessage(d.HL[e.filter.value]):"date"===e.type?(0,d.x)(e.filter):(0,d.ip)(e.filter);return n()(g.Z,{popupType:r.device.isMobile?v.kQ.SlideUp:v.kQ.Popup,buttonPopupStore:i,render:()=>{let o;o=r.device.isMobile?{menuType:u.og.ActionSheet}:{menuType:u.og.Popup};const l="date"===e.type?(()=>{const e=c.tO;return[...e.filter((e=>"relative"===e.type)),...e.filter((e=>"exact"===e.type))]})().map((o=>({key:"relative"===o.type?o.value:o.type,render:e=>s.createElement(m.Z,a()({},e,{title:b({type:"date",filter:o}),checkState:o.type===t.type&&(void 0===o.value||o.value===t.value)})),action:()=>{e.onUpdate(o),i.setState({open:!1})}}))):(()=>{const e=(0,c.v8)();return[...e.filter((e=>"relative"===e.type)),...e.filter((e=>"exact"===e.type))]})().map((o=>({key:(0,c.eX)(o),render:e=>s.createElement(m.Z,a()({},e,{title:b({type:"daterange",filter:o}),checkState:o.type===t.type&&(void 0===o.value||o.value===t.value)})),action:()=>{e.onUpdate(o),i.setState({open:!1})}})));return s.createElement(h.Z,o,n()(f.Z,{type:f.i.Vertical,sections:[{key:"filterOperators",render:e=>s.createElement(y.Z,a()({disableMobilePadding:!0},e)),items:l}],initialFocus:void 0}))},renderOrigin:o,style:{width:240},originGap:2,placementToOrigin:g.Z.Placement.Bottom,alignmentToOrigin:g.Z.Alignment.Center,disabled:e.disabled})}},93289:(e,t,o)=>{o.d(t,{Z:()=>l});var i=o(77094),n=o.n(i),r=o(67294),a=o(13991),s=o(77907);const l=function(e){let{firstDayOfWeek:t,value:o,selectValue:i=!0,onChange:l,disabledDays:c}=e;window.__c={n:"DatePicker"};const d=(0,r.useMemo)((()=>new Date(o)),[o]),[p,u]=(0,r.useState)(d),m=(0,r.useRef)(o);(0,r.useLayoutEffect)((()=>{m.current!==o&&(u(new Date(o)),m.current=o)}),[o]);const g=(0,r.useCallback)((e=>{l(e.getTime())}),[l]);return n()(s.LazyDayPicker,{locale:a.SP,className:"notion-calendar-picker",numberOfMonths:1,weekStartsOn:t,modifiers:i?{value:d}:{},showOutsideDays:!0,fixedWeeks:!0,onDayClick:g,onMonthSelected:u,disabled:c,month:p})}},83264:(e,t,o)=>{o.d(t,{Z:()=>B});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(76205),d=o(42875),p=o(89837),u=o(97880),m=o(5366),g=o(28020),h=o(33929),f=o(60709),v=o(80084),y=o(67950),b=o(41558),S=o(78140),w=o(40721),k=o(72495),C=o(64369),_=o(66653),M=o(41209),T=o(46945),I=o(14390);const P=(0,m.defineMessages)({startingMessage:{defaultMessage:"Starting",id:"search.dateRangeMenu.startingMessage"},endingMessage:{defaultMessage:"Ending",id:"search.dateRangeMenu.endingMessage"}});class x extends l.Z{constructor(){super(...arguments),this.storeTypes={store:b.Z},this.renderInputs=()=>{const{value:e,relativeRangePopupStore:t,onUpdateRelativeFilter:o}=this.props;if(t&&o){const i="type"in e?e:{type:"exact",value:void 0};return a()(M.Z,{type:"daterange",filterValue:i,onUpdate:o,renderOrigin:e=>"exact"===i.type?this.renderStartEnd(e):"relative"!==i.type||"surrounding"!==i.value&&"custom"!==i.value?void 0:this.renderRelativePicker(e,o,i),disabled:"exact"===i.type,buttonPopupStore:t})}return this.renderStartEnd()},this.renderRelativePicker=(e,t,o)=>a()("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexWrap:this.environment.device.isMobile?"wrap":void 0,marginBottom:12}},void 0,a()("div",{style:{width:"92%",marginLeft:10,marginRight:10}},void 0,a()(I.b,{onUpdate:t,filter:o}))),this.renderStartEnd=e=>{const{value:t,disabled:o,allowRelativeRangeFilter:i}=this.props,{store:r}=this.stores,l=r.getFocus(),c=this.getRangeBounds(),d="type"in t?{starting:void 0,ending:void 0}:t;return s.createElement("div",n()({},e,{style:{display:"flex",flexDirection:i&&!this.environment.device.isMobile?"row":"column",alignItems:"center",width:this.environment.device.isMobile?void 0:280}}),a()(_.Z,{disabled:o,placeholder:this.environment.device.isMobile?void 0:h.default.formatMessage(P.startingMessage),focused:"starting"===l,value:d.starting,validate:this.validateStart,onUpdate:this.handleUpdateStart,onFocus:()=>this.handleFocus("starting"),onSubmit:this.handleStartSubmit,inputElementAttributes:c?{max:c.latestValidStarting}:void 0,inputOuterStyle:this.styles.firstDateInput,textWrapperStyle:i&&!this.environment.device.isMobile?{marginRight:2}:{},desktopDateFormat:i?"YYYY/MM/DD":void 0}),a()(_.Z,{disabled:o,placeholder:this.environment.device.isMobile?void 0:h.default.formatMessage(P.endingMessage),focused:"ending"===l,value:d.ending,validate:this.validateEnd,onUpdate:this.handleUpdateEnd,onFocus:()=>this.handleFocus("ending"),onSubmit:this.handleEndSubmit,inputElementAttributes:c?{min:c.earliestValidEnding}:void 0,textWrapperStyle:i&&!this.environment.device.isMobile?{marginLeft:2}:{},desktopDateFormat:i?"YYYY/MM/DD":void 0}))},this.renderCalendar=()=>{const{device:e}=this.environment,{value:t,onUpdate:o}=this.props,{store:i}=this.stores,n=this.styles,r=this.getThemeColors(),s={...n.pickerSection,...e.isMobile&&n.pickerSectionMobile,...e.isMobile&&r.pickerSectionMobile},l="type"in t?this.convertToDateRangeFilter(t):t;return a()(k.Z,{style:n.calendarWrapper},void 0,a()("div",{style:s},void 0,a()(T.Z,{value:l,store:i,onUpdate:o,validate:this.validateField,readonly:"type"in t}),"type"in t&&a()(C.Z,{isSmall:!0,style:{marginLeft:4,marginTop:4}},void 0,a()(m.FormattedMessage,{id:"collectionFilterMenu.dateRangeFilter.relativeDateRangeFilter.description",defaultMessage:"Filter will update with the current date",description:"Filter will change everyday based on the current date"}))))},this.handleFocus=e=>{const{store:t}=this.stores;t.setState({...t.state,focus:e})},this.handleUpdateStart=e=>{const{onUpdate:t}=this.props;e.error||t({value:{starting:e.value}})},this.handleUpdateEnd=e=>{const{onUpdate:t}=this.props;e.error||t({value:{ending:e.value}})},this.handleStartSubmit=(e,t)=>{const{store:o}=this.stores;t&&t.error||o.setState({...o.state,focus:"ending"})},this.handleEndSubmit=(e,t)=>{const{onDismiss:o}=this.props;t&&t.error||o&&o(e)},this.validateStart=e=>{const t=this.validateField("starting",e);return t.error?t:{value:t.value.starting}},this.validateEnd=e=>{const t=this.validateField("ending",e);return t.error?t:{value:t.value.ending}},this.validateField=(e,t)=>{const{value:o}=this.props;if("type"in o)return{value:{starting:void 0,ending:void 0}};if(t.error)return t;const i=t.value&&"date"!==t.value.type?p.Id(t.value):t.value;return this.validateRange({...o,[e]:i})},this.validateRange=e=>{if(e.starting&&e.ending){const t=p.OQ.notionDateToLuxon(e.starting);return p.OQ.notionDateToLuxon(e.ending)>=t?{value:e}:{error:y.B.INVALID_RANGE}}return{value:e}},this.getMenuProps=()=>{const{device:e}=this.environment,{onDismiss:t,title:o}=this.props;if(e.isMobile){return{menuType:f.og.Modal,title:o,right:a()(w.DoneMenuText,{}),onClickRight:t,header:this.renderInputs()}}return{menuType:f.og.Popup,onClickOutside:t}},this.styles={calendarWrapper:{display:"flex",justifyContent:"center",alignItems:"center"},pickerSection:{paddingLeft:16,paddingRight:16},pickerSectionMobile:{paddingTop:16,paddingBottom:8},firstDateInput:{marginTop:2}}}renderComponent(){const{disableMenuWrap:e,hideDateInputMenuItems:t}=this.props,{device:o}=this.environment;return e?s.createElement(s.Fragment,null,!t&&this.renderInputs(),this.renderCalendar()):s.createElement(S.Z,this.getMenuProps(),!o.isMobile&&!t&&this.renderInputs(),this.renderCalendar())}convertToDateRangeFilter(e){return"custom"===e.value?this.calculateDateRangeFromCustomRelativeFilter(e.direction,e.count,e.unit):"surrounding"===e.value?this.calculateDateRangeFromSurroundingRelativeFilter(e.unit):this.convertToDateRangeFilterLegacy(e)}convertToDateRangeFilterLegacy(e){switch(e.value){case"this_week":return{starting:this.startOfWeek((0,d.r)()),ending:this.endOfWeek((0,d.r)())};case"the_past_month":return{starting:p.dj((0,d.r)()),ending:p.Lg((0,d.r)())};case"the_past_week":return{starting:p.Oo((0,d.r)()),ending:p.Lg((0,d.r)())};case"the_past_year":return{starting:p.b8((0,d.r)()),ending:p.Lg((0,d.r)())};case"the_next_month":return{starting:p.Lg((0,d.r)()),ending:p.nD((0,d.r)())};case"the_next_week":return{starting:p.Lg((0,d.r)()),ending:p.Kq((0,d.r)())};case"the_next_year":return{starting:p.Lg((0,d.r)()),ending:p.NJ((0,d.r)())};default:(0,u.t1)(e)}}calculateDateRangeFromSurroundingRelativeFilter(e){const{start:t,end:o}=(0,c.je)(e,(0,d.r)(),g.AK.state);return{starting:p.ME(t),ending:p.ME(o)}}calculateDateRangeFromCustomRelativeFilter(e,t,o){const i=(0,c.Fo)(e,t,o,(0,d.r)());switch(e){case"past":return{starting:p.ME(i),ending:p.Lg((0,d.r)())};case"future":return{starting:p.Lg((0,d.r)()),ending:p.ME(i)};default:(0,u.t1)(e)}}getRangeBounds(){const{value:e,intl:t}=this.props;if("type"in e)return;return{earliestValidEnding:e.starting&&v.p6(e.starting,t,"YYYY-MM-DD"),latestValidStarting:e.ending&&v.p6(e.ending,t,"YYYY-MM-DD")}}startOfWeek(e){return{type:"date",start_date:p.em(Date.now(),p.aN(),e).toFormat(p.Iq)}}endOfWeek(e){return{type:"date",start_date:p.gQ(Date.now(),p.aN(),e).toFormat(p.Iq)}}getThemeColors(){return{pickerSectionMobile:{background:this.theme.popoverBackground,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}}}}x.displayName="DateRangeMenu";const B=(0,m.injectIntl)(x)},46945:(e,t,o)=>{o.d(t,{Z:()=>h});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(13991),s=o(8848),l=o(42875),c=o(89837),d=o(82990),p=o(28020),u=o(77907),m=o(13854);class g extends r.Z{constructor(){super(...arguments),this.currentDate=void 0,this.handleDayClick=e=>{const{disabled:t,store:o,dateTimeStore:i,value:n,validate:r,onUpdate:a,readonly:s}=this.props;if(t||s)return;const l=o.getFocus(),d=c.OQ.toPersistedDate(e.valueOf()),p="starting"===l?"ending":"starting",u=n[p];if(u&&d.start_date===u.start_date)o.setState({...o.state,focus:p}),i&&i.setState({...i.state,focus:m.yO[p]});else{const e=r(l,{value:d});if(a(e.error?e:{value:{[l]:e.value[l]}}),o.setState({...o.state,hovered:void 0}),i&&i.setState({...i.state,hovered:void 0}),e.error)return;"starting"!==l||n.ending||(o.setState({...o.state,focus:"ending"}),i&&i.setState({...i.state,focus:m.yO.ending}))}},this.handleDayMouseEnter=e=>{const{disabled:t,store:o,dateTimeStore:i,value:n,readonly:r}=this.props,a=o.getFocus(),s=c.OQ.jsDateToLuxon(e);if(!t&&!r)if("starting"===a&&n.ending&&!n.starting){c.OQ.notionDateToLuxon(n.ending)>=s&&(o.setState({...o.state,hovered:e}),i&&i.setState({...i.state,hovered:e}))}else if("ending"===a&&n.starting&&!n.ending){c.OQ.notionDateToLuxon(n.starting)<=s&&(o.setState({...o.state,hovered:e}),i&&i.setState({...i.state,hovered:e}))}},this.handleMonthChange=e=>{const{store:t,dateTimeStore:o}=this.props;t.setState({...t.state,displayMonth:c.OQ.jsDateToLuxon(e)}),o&&o.setState({...o.state,displayMonth:c.OQ.jsDateToLuxon(e)})},this.styles={monthControl:{position:"absolute",top:0,right:0,display:"flex"},selectedRange:{backgroundColor:s.ZP.blueWithAlpha(.15)},active:{backgroundColor:s.ZP.blue,color:s.ZP.white},inactive:{backgroundColor:s.ZP.blueWithAlpha(.43)},disabled:{pointerEvents:"none"},today:{fontWeight:d.Z.fontWeight.regular}}}renderComponent(){const{readonly:e}=this.props,t=this.getDisplayMonth();return n()(u.LazyDayPicker,{className:"notion-calendar-picker",defaultMonth:t,month:t,numberOfMonths:1,weekStartsOn:this.getFirstDayOfWeek(),locale:a.SP,showOutsideDays:!0,fixedWeeks:!0,onDayClick:this.handleDayClick,onDayMouseEnter:this.handleDayMouseEnter,onMonthSelected:this.handleMonthChange,modifiers:this.getModifiers(),modifiersStyles:this.getModifiersStyles(),disabled:!!e||void 0})}getCurrentDate(){if(!this.currentDate){const e=c.Lg((0,l.r)());this.currentDate=c.OQ.notionDateToJsDate(e)}return this.currentDate}getDisplayMonth(){const{value:e,store:t}=this.props;if(t.state.displayMonth)return t.state.displayMonth.toJSDate();if("starting"===t.getFocus()){if(e.starting)return c.OQ.notionDateToJsDate(e.starting);if(e.ending)return c.OQ.notionDateToJsDate(e.ending)}if("ending"===t.getFocus()){if(e.ending)return c.OQ.notionDateToJsDate(e.ending);if(e.starting)return c.OQ.notionDateToJsDate(e.starting)}return this.getCurrentDate()}getFirstDayOfWeek(){return p.AK.state}getModifiers(){const{store:e,disabled:t,value:o}=this.props,i=this.getDisabledModifier(),{hovered:n}=e.state;if(t)return{disabled:i};if(o.starting&&o.ending){const e=c.OQ.notionDateToJsDate(o.starting),t=c.OQ.notionDateToJsDate(o.ending);return{range:{from:e,to:t},start:e,end:t,disabled:i}}if(o.starting){const e=c.OQ.notionDateToJsDate(o.starting);return{range:n&&{from:e,to:n},start:e,end:n,disabled:i,selected:[e,n]}}if(o.ending){const e=c.OQ.notionDateToJsDate(o.ending);return{range:n&&{from:n,to:e},start:n,end:e,disabled:i,selected:[e,n]}}}getDisabledModifier(){const{value:e,disabled:t,store:o}=this.props;if(t)return e=>!0;const i=e=>"ending"===o.getFocus()&&{before:e},n=e=>"starting"===o.getFocus()&&{after:e};if(e.starting&&e.ending){const t=c.OQ.notionDateToJsDate(e.starting),o=c.OQ.notionDateToJsDate(e.ending);return i(t)||n(o)}if(e.starting){return i(c.OQ.notionDateToJsDate(e.starting))}if(e.ending){return n(c.OQ.notionDateToJsDate(e.ending))}return!1}getModifiersStyles(){const{store:e}=this.props,t=this.styles,o=this.getThemeColors(),i=e.getFocus(),n=t.selectedRange,r={...t.disabled,...o.disabled},a={...t.today,...o.today};return{range:n,start:"starting"===i?t.active:t.inactive,end:"ending"===i?t.active:t.inactive,disabled:r,today:a}}getThemeColors(){return{disabled:{color:this.theme.lightTextColor},today:{color:s.ZP.white}}}}g.displayName="DateRangePicker";const h=g},97812:(e,t,o)=>{o.d(t,{Z:()=>J});var i=o(77094),n=o.n(i),r=o(67294),a=o(13991),s=o(41892),l=o(8848),c=o(3779),d=o(89101),p=o(82990),u=o(5366),m=o(43250),g=o(34859),h=o(64921),f=o(16354),v=o(89728),y=o(18647),b=o(97464),S=o.n(b),w=o(480),k=o(81954),C=o(19889),_=o(97880),M=o(7928),T=o(84823),I=o(70782),P=o(33929),x=o(60709),B=o(79315),Z=o(52275),E=o(78140),R=o(9342),A=o(44532),D=o(72495),F=o(64369),L=o(45653);function V(){window.__c={n:"DeveloperIntegrationsAccountSwitcher"};const e=(0,w.O7)(),[t,o]=(0,r.useState)(!1),i=()=>o(!1),a=(0,k.VK)((()=>B.default.state.currentUserStore),[]),s=(0,k.VK)((()=>a?e.currentUser.loggedInUserIds.map((e=>a.getRecordValue({table:C.KJ,id:e}))).filter(_.$K):[]),[a,e]),l=(0,k.VK)((()=>null==a?void 0:a.getValue()),[a]);return l?n()(A.ZP,{popupType:A.kQ.Popup,origin:n()(N,{onClick:()=>o(!0),currentUserValue:l}),render:()=>n()(O,{users:s,currentUserId:l.id,onClose:i}),placementToOrigin:A.ZP.Placement.Bottom,alignmentToOrigin:A.ZP.Alignment.End,onDismiss:i,open:t}):null}function N(e){window.__c={n:"ClosedSwitcherBubble"};const{onClick:t,currentUserValue:o}=e;return n()("div",{style:{marginLeft:18}},void 0,n()(h.Z,{onClick:t,style:{borderRadius:"100%"}},void 0,n()(L.Z,{userValue:o,size:32})))}function O(e){window.__c={n:"OpenedSwitcherMenu"};const t=(0,w.O7)(),{users:o,currentUserId:i,onClose:a}=e;return n()(E.Z,{menuType:x.og.Popup},void 0,n()(R.Z,{type:R.i.Vertical,initialFocus:void 0,sections:[{key:"developer-integration-accounts",items:o.map((e=>({key:e.id,action:async()=>{const o=await I.x({environment:t,newCurrentUserId:e.id});T.A1(o),a()},render:t=>r.createElement(U,S()({},t,{user:e,isLoggedIn:e.id===i}))}))),render:e=>r.createElement(D.Z,e)}]}))}const U=r.forwardRef(((e,t)=>{const{user:o,isLoggedIn:i,...a}=e,s=P.default.getIntl();return r.createElement(Z.Z,S()({},a,{ref:t,title:n()(F.Z,{className:"notranslate"},void 0,(0,M.Nz)(s,o)),icon:n()(L.Z,{userValue:o,size:28}),caption:n()(F.Z,{isSmall:!0},void 0,o.email),right:i&&c.Z.thinCheck({width:12,height:12})}))}));var H=o(70043),z=o(51454),W=o(38381),j=o(74194),K=o(22346);function Y(){window.__c={n:"DeveloperIntegrationsDialog"};const e=(0,k.Kw)(W.Z);return n()(K.Z,{open:e.open,overlayZIndex:z.Wd,onDismiss:()=>{W.Z.reset()},preventHideChildrenWhileOpening:!0,innerStyle:{overflow:"hidden",borderRadius:3,padding:"24px 32px",width:336,fontSize:16,boxShadow:H.Z.frontDialogShadow,background:l.ZP.white},render:()=>r.createElement(G,e)})}function G(e){window.__c={n:"DialogContent"};const[t,o]=r.useState(""),[i,a]=r.useState(!1);if(!e.open)return null;const{title:s,message:c,onConfirm:d}=e,m=o=>{const{deleteIntegrationIfConfirmationInputMatch:i}=o;e.isDestructive&&e.deleteMatchText!==t?a(!0):i&&(d(),W.Z.reset())};return n()("div",{style:{display:"flex",flexDirection:"column"}},void 0,n()("div",{style:{fontSize:16,fontWeight:p.Z.fontWeight.semibold}},void 0,s),n()("div",{style:{fontSize:14,color:l.ZP.frontTextMedium,margin:"8px 0 16px"}},void 0,c),e.isDestructive&&n()("div",{style:{marginBottom:12}},void 0,n()(j.Z,{autoFocus:!0,placeholder:e.deleteMatchText,value:t,onChange:t=>{const n=t.target.value;i&&e.deleteMatchText===n&&a(!1),o(n)},onSubmit:()=>m({deleteIntegrationIfConfirmationInputMatch:!1})}),i&&n()("div",{style:{marginTop:4,color:l.ZP.frontRed,fontSize:12}},void 0,e.deleteMatchError)),n()("div",{style:{display:"flex"}},void 0,n()(h.Z,{onClick:()=>{W.Z.reset()},style:{...q.button,border:`1px solid ${l.ZP.uiLightBorder}`,marginRight:8,fontSize:15}},void 0,n()(u.FormattedMessage,{id:"developerIntegration.confirmationModal.cancelLabel",defaultMessage:"Cancel"})),n()(X,{onSubmit:()=>m({deleteIntegrationIfConfirmationInputMatch:!0}),isWarning:e.isDestructive||e.isWarning,confirmationMessage:e.confirmationMessage})))}function X(e){window.__c={n:"ConfirmationButton"};const{onSubmit:t,confirmationMessage:o,isWarning:i}=e;return n()(h.Z,{onClick:t,style:{...q.button,background:i?l.ZP.frontPrimaryButtonBackground:l.ZP.blue,color:l.ZP.white,fontSize:15},hoveredStyle:{backgroundColor:i?l.ZP.frontPrimaryButtonBackgroundHovered:l.ZP.frontBlueButtonHoveredBackground},pressedStyle:{backgroundColor:i?l.ZP.frontPrimaryButtonBackgroundPressed:l.ZP.frontBlueButtonPressedBackground}},void 0,o)}const q={button:{padding:6,borderRadius:3,flex:1,textAlign:"center"}};var $=o(36360);function J(e){window.__c={n:"DeveloperIntegrationsContainer"};const{className:t,title:o,subtitle:i,onNavigateBack:r,navigateBackMessage:a,children:l,icon:p,sideContent:b,innerContainerStyles:S}=e,w=(0,u.useIntl)();return n()($.Z,{title:w.formatMessage({id:"developerIntegrationsLayout.document.title",defaultMessage:"My integrations | Notion Developers"})},void 0,n()(y.Z,{className:t,style:Q.scroller,type:g.Z.Y},void 0,n()(Y,{}),n()("div",{className:m.rIs,style:Q.topBar},void 0,n()("div",{},void 0,n()(f.Z,{href:d._j.developerPortal,external:!0},void 0,n()("img",{src:s.Z.images.integrations.notionDevsLogoGaSvg}))),n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()(f.Z,{style:{display:"flex",marginLeft:-6},href:d._j.developerPortal,external:!0},void 0,n()(v.Z,{icon:c.Z.alias,isSmall:!0},void 0,"View documentation")),n()(V,{}))),n()("div",{style:{...Q.innerContainer,...S}},void 0,n()("div",{style:{display:"flex",justifyContent:"space-between",marginTop:80,marginBottom:80}},void 0,n()("div",{style:{display:"flex",flexDirection:"column",width:"66%",justifyContent:"center"}},void 0,n()(h.Z,{style:{...Q.button,...!r&&{display:"none"}},onClick:r},void 0,n()("div",{style:{...Q.buttonContent,fontSize:20}},void 0,c.Z.historyBack(Q.arrowIcon),n()("div",{style:{marginLeft:12}},void 0,a||n()(u.FormattedMessage,{id:"developerIntegrationsLayout.backButton.label",defaultMessage:"My integrations"})))),n()("div",{style:Q.header},void 0,o),n()("div",{style:Q.subtitle},void 0,i)),n()("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"center",flex:1}},void 0,p)),b?n()("div",{style:Q.gridContainer},void 0,n()("div",{style:Q.leftColumn},void 0,b),n()("div",{style:Q.rightColumn},void 0,l)):l),n()("footer",{style:Q.footerContainer},void 0,n()("section",{style:Q.footerColophon},void 0,n()("h1",{style:Q.footerLogo},void 0,n()("img",{src:s.Z.images.integrations.notionFooterLogoSvg})),n()("h6",{style:Q.footerCopy},void 0,"The all-in-one workspace for your notes, tasks, wikis, and databases."),n()("h6",{style:Q.footerCopy},void 0,"©2021 Notion Labs, Inc."),n()(f.Z,{external:!0,href:d._j.termsAndPrivacy,style:Q.footerLink},void 0,"Terms & Privacy")),n()("nav",{style:{...Q.footerNav,gridColumnStart:7}},void 0,n()("h5",{style:Q.footerSectionHeader},void 0,"Developers"),n()(f.Z,{external:!0,href:"https://developers.notion.com/docs",style:Q.footerLink},void 0,"Guides"),n()(f.Z,{external:!0,href:"https://developers.notion.com/reference",style:Q.footerLink},void 0,"API Reference"),n()(f.Z,{external:!0,href:d._j.myIntegrations,style:Q.footerLink},void 0,"My integrations"),n()(f.Z,{external:!0,href:"https://developers.notion.com/page/frequently-asked-questions",style:Q.footerLink},void 0,"FAQs"),n()(f.Z,{external:!0,href:d._j.developerTerms,style:Q.footerLink},void 0,"Developer terms")),n()("nav",{style:Q.footerNav},void 0,n()("h5",{style:Q.footerSectionHeader},void 0,"Notion"),n()(f.Z,{external:!0,href:d._j.product,style:Q.footerLink},void 0,"Product"),n()(f.Z,{external:!0,href:d._j.teams,style:Q.footerLink},void 0,"Teams"),n()(f.Z,{external:!0,href:d._j.enterprise,style:Q.footerLink},void 0,"Enterprise"),n()(f.Z,{external:!0,href:d._j.blog,style:Q.footerLink},void 0,"Blog"),n()(f.Z,{external:!0,href:d._j.careers,style:Q.footerLink},void 0,"Careers")),n()("nav",{style:Q.footerNav},void 0,n()("h5",{style:Q.footerSectionHeader},void 0,"Social"),n()(f.Z,{external:!0,href:"https://notionup.typeform.com/to/dSurQQp2Q",style:Q.footerLink},void 0,"Developer newsletter"),n()(f.Z,{external:!0,href:"http://twitter.com/notionapi",style:Q.footerLink},void 0,"Twitter")))))}const Q={footerLink:{color:l.ZP.frontTextMedium,cursor:"pointer",textDecoration:"none",display:"block",marginBottom:4},footerColophon:{gridColumn:"auto/span 3"},footerNav:{gridColumn:"auto/span 2",marginBottom:16},footerLogo:{margin:"0 auto 20px",fontSize:0,display:"block"},footerSectionHeader:{fontFamily:p.Z.getCompositeFontFamily(a.SP).mono,fontWeight:p.Z.fontWeight.medium,margin:"0 auto 8px",marginBottom:"1.1em",fontSize:15},footerCopy:{fontSize:15,fontWeight:p.Z.fontWeight.regular,lineHeight:"1.5em",color:l.ZP.frontTextMedium,margin:"0 auto 8px",marginBottom:"1.1em"},footerContainer:{padding:"70px 30px",alignItems:"flex-start",justifyItems:"flex-start",flex:"1 0 auto",zIndex:999,width:"100%",maxWidth:1160,boxSizing:"border-box",margin:"0 auto",borderTop:`1px solid ${l.ZP.dividerColor}`,display:"grid",gridTemplateColumns:"repeat(12,1fr)",columnGap:16,gap:16},scroller:{height:"100vh",background:l.ZP.frontCreamBackground},innerContainer:{margin:"auto",width:914},topBar:{maxWidth:1100,height:60,margin:"0 auto",display:"flex",alignItems:"center",marginTop:13,marginBottom:10,justifyContent:"space-between"},header:{fontWeight:p.Z.fontWeight.bold,fontFamily:p.Z.getCompositeFontFamily(a.SP).sans,fontSize:50,color:l.ZP.frontText,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},subtitle:{fontWeight:p.Z.fontWeight.regular,fontSize:24,color:l.ZP.frontTextMedium,letterSpacing:"0.015em"},button:{display:"inline-flex",color:l.ZP.frontTextMedium,borderRadius:3,padding:6,fontSize:15,width:"fit-content"},buttonContent:{display:"flex",alignItems:"center"},arrowIcon:{width:20,height:20},gridContainer:{display:"grid",gridTemplateColumns:"180px auto",paddingBottom:120,gap:60},leftColumn:{gridColumnStart:1,gridColumnEnd:2},rightColumn:{gridColumnStart:2,gridColumnEnd:3}}},31568:(e,t,o)=>{o.r(t),o.d(t,{default:()=>X,developerIntegrationsTableToFilterType:()=>$});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(63123),c=o(41892),d=o(8848),p=o(59054),u=o(3779),m=o(77420),g=o(9844),h=o(97880),f=o(82990),v=o(63143),y=o(5366),b=o(50906),S=o(54642),w=o(43250);function k(e){const{ids:t,table:o,userStore:i}=e,n=[];for(const r of t){const e=i.getRecordValue({id:r,table:o});if(e){const t={table:o,value:e};n.push(t)}}return C(n)}function C(e){return e.slice().sort(((e,t)=>t.value.created_at-e.value.created_at))}var _=o(77907),M=o(79315),T=o(10161),I=o(97122),P=o(89728),x=o(70043),B=o(84823),Z=o(64921),E=o(31278),R=o(97464),A=o.n(R),D=o(60709),F=o(38381),L=o(3815),V=o(52275),N=o(78140),O=o(9342),U=o(44532),H=o(72495);function z(e){window.__c={n:"DeveloperIntegrationCardPopup"};const{recordWithTable:t}=e,o=t.value.name||"",i=(0,a.O7)(),l=(0,s.VK)((()=>M.default.state.currentUserStore),[]),[c,p]=r.useState(!1),[m,g]=(0,s.AF)(F.Z);if(!l)return null;const h=(0,L.Kv)(l,{id:t.value.id,table:t.table});return n()(U.ZP,{popupType:U.ZP.PopupType.Popup,open:c,placementToOrigin:U.ZP.Placement.Bottom,alignmentToOrigin:U.ZP.Alignment.End,onDismiss:()=>p(!1),origin:n()(Z.Z,{onClick:()=>{p(!0),b.trackDeveloperIntegrationsOpenCardDropdownClick(i,{table:h.table})},style:{padding:"3px 6px",borderRadius:3}},void 0,u.Z.dots({width:18,height:18})),render:()=>n()(N.Z,{menuType:D.og.Popup},void 0,n()(O.Z,{type:O.i.Vertical,initialFocus:0,sections:[{key:"integration-card-dropdown",items:[{key:"delete-integration",action:()=>{b.trackDeveloperIntegrationsDeleteClick(i,{table:h.table}),g({open:!0,title:n()(y.FormattedMessage,{id:"developerIntegrationCardDropdown.delete.confirmationTitle",defaultMessage:"Delete {integrationName}?",values:{integrationName:o}}),message:n()(y.FormattedMessage,{id:"developerIntegrationCardDropdown.delete.confirmationMessage",defaultMessage:"This public integration will be deactivated and removed from all workspaces it has been added to. To confirm, type in the name of this integration."}),confirmationMessage:n()(y.FormattedMessage,{id:"developerIntegration.confirmationModal.deleteLabel",defaultMessage:"Delete"}),onConfirm:async()=>{await B.uU({environment:i,recordStore:h})},isDestructive:!0,deleteMatchText:o,deleteMatchError:n()(y.FormattedMessage,{id:"developerIntegrationCardDropdown.delete.confirmationError",defaultMessage:"Input did not match integration name."})})},render:e=>r.createElement(V.Z,A()({},e,{title:n()(y.FormattedMessage,{id:"developerIntegrationCard.dropdown.delete",defaultMessage:"Delete this integration"}),style:{color:d.ZP.frontRed}}))}],render:e=>r.createElement(H.Z,e)}]}))})}function W(e){window.__c={n:"DeveloperIntegrationCard"};const{recordWithTable:t}=e,o=(0,a.O7)(),i=t.table===g.K2?t.value.info.tagline||n()(y.FormattedMessage,{id:"developerIntegrationCard.integrationTagline.placeholder",defaultMessage:"Public integration."}):n()(y.FormattedMessage,{id:"developerIntegrationCard.botTagline.placeholder",defaultMessage:"Internal integration."}),s=t.table===g.K2?t.value.info.icon:t.value.icon,l=(0,r.useMemo)((()=>({id:t.value.id,table:t.table})),[t]),c=(0,r.useCallback)((()=>{B.V2(o,l)}),[o,l]);return n()(Z.Z,{style:Y.containerCard,onClick:c},void 0,n()("div",{style:Y.innerDetailsContainer},void 0,n()(E.Z,{disabled:!0,icon:s?{pointer:l,icon:s}:void 0,title:t.value.name,isEmptyPage:!1,size:48,isLarge:!0,useInvertedColors:!0}),n()("div",{style:Y.name},void 0,t.value.name),n()("div",{style:Y.tagline},void 0,i)),n()("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,n()(P.Z,{onClick:c,style:{...Y.blueButton,padding:8,marginLeft:-8,fontSize:15}},void 0,n()(y.FormattedMessage,{id:"developerIntegrationsList.viewIntegration.buttonText",defaultMessage:"View integration"})),n()(z,{recordWithTable:t})))}function j(e){window.__c={n:"AddNewIntegrationCard"};const{onClick:t}=e;return n()(Z.Z,{onClick:t,style:{...Y.containerCard,...Y.addNewCard}},void 0,u.Z.plus({width:24,height:24,color:d.ZP.mediumIconColor}),n()("div",{style:{height:12}}),n()(y.FormattedMessage,{id:"developerIntegrationCard.placeholderCard.label",defaultMessage:"Create new integration"}))}function K(){return window.__c={n:"PlaceholderCard"},n()(Z.Z,{style:{...Y.containerCard,boxShadow:"none",background:"rgba(0,0,0,0.02)",border:"none"}},void 0,n()("div",{style:Y.innerDetailsContainer},void 0,n()("div",{style:{...Y.placeholderGradient,opacity:.7,width:48,height:48,borderRadius:4}}),n()("div",{style:{...Y.name,...Y.placeholderGradient,opacity:.7,width:"50%",height:24}})))}const Y={containerCard:{boxShadow:x.Z.frontCardShadow,border:`1px solid ${d.ZP.blackWithAlpha(.1)}`,background:d.ZP.white,height:240,width:320,borderRadius:5,padding:24,paddingTop:28,display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between"},addNewCard:{background:"transparent",boxShadow:void 0,alignItems:"center",justifyContent:"center",color:d.ZP.frontTextLight,fill:d.ZP.frontTextLight},innerDetailsContainer:{width:"100%"},name:{fontWeight:f.Z.fontWeight.semibold,fontSize:18,marginTop:12,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},tagline:{lineHeight:"24px",fontSize:14,color:d.ZP.frontTextLight,maxHeight:72,overflow:"hidden"},blueButton:{padding:0,background:void 0,color:d.ZP.blue,fill:d.ZP.blue},placeholderGradient:{backgroundColor:"rgba(0,0,0,0.05)"}};var G=o(97812);function X(){window.__c={n:"DeveloperIntegrationsList"};const e=(0,a.O7)(),[t,o]=r.useState(!1),[i,l]=r.useState([]),[c,d]=r.useState([]),f=(0,s.VK)((()=>M.default.state.currentUserStore),[]),[x,B]=r.useState("all"),Z=(0,s.VK)((()=>T.default.checkGate("developer_integration_form_redesign")),[]);(0,r.useEffect)((()=>{l([]),d([])}),[e.currentUser.id]);const E=(0,r.useCallback)((e=>{const{id:t,table:o}=e;o===m.cZ?d((e=>e.includes(t)?e:e.concat(t))):o===g.K2?l((e=>e.includes(t)?e:e.concat(t))):(0,h.t1)(o)}),[]),R=(0,r.useCallback)((()=>{o(!0),b.trackDeveloperIntegrationsNewClick(e)}),[e]);(0,r.useEffect)((()=>{b.trackDeveloperIntegrationSiteVisit(e)}),[e]);const[{status:A,error:D,value:F}]=(0,p.r5)((async()=>{const t=await S.getDeveloperBotsAndIntegrations(e,{});if("success"===t.type)return t.data;if("failed"===t.type)throw t.error;return(0,h.t1)(t)}),[e]),L=null==F?void 0:F.integrationIds;(0,r.useEffect)((()=>{L&&l((e=>(0,v.jj)([...e,...L])))}),[L]);const V=null==F?void 0:F.botIds;(0,r.useEffect)((()=>{V&&d((e=>(0,v.jj)([...e,...V])))}),[V]);const N=(0,s.VK)((()=>f?k({ids:i,table:g.K2,userStore:f}):[]),[f,i]).filter((e=>{let{value:t}=e;return t.alive})),O=(0,s.VK)((()=>f?k({ids:c,table:m.cZ,userStore:f}):[]),[f,c]).filter((e=>{let{value:t}=e;return t.alive})),U={all:r.useMemo((()=>C([...N,...O])),[N,O]),internal:O,public:N}[x];return t?n()(Z?_.LazyDeveloperIntegrationCreateV2:_.LazyDeveloperIntegrationsCreate,{onClose:()=>o(!1),onSuccess:E}):n()(G.Z,{className:w.pg$,title:n()(y.FormattedMessage,{id:"developerIntegrationsList.title",defaultMessage:"My integrations"}),subtitle:n()(y.FormattedMessage,{id:"developerIntegrationsList.subtitle",defaultMessage:"Create, review, and edit development info and credentials."}),icon:n()(Q,{}),sideContent:r.createElement(r.Fragment,null,n()(I.h,{onClick:R,styles:{marginBottom:12,width:"100%"}},void 0,u.Z.plus({width:16,height:16,fill:"white"}),n()("div",{style:{marginLeft:8}},void 0,n()(y.FormattedMessage,{id:"developerIntegrationsList.addNewButton.label",defaultMessage:"New integration"}))),n()("div",{style:{marginTop:8}},void 0,q.map((t=>n()("div",{},t,n()(P.Z,{onClick:()=>{B(t),b.trackDeveloperIntegrationsFilterClick(e,{type:t})},isSmall:!0,style:{...te.filterButton,...t===x&&te.selectedFilterButton}},void 0,J[t]))))))},void 0,n()(ee,{isLoading:!f||"pending"===A||"idle"===A,error:D,integrationOrBotRecords:U,onCreateNewClick:R}))}const q=["all","internal","public"],$={[m.cZ]:"internal",[g.K2]:"public"},J={all:n()(y.FormattedMessage,{id:"developerIntegrationsList.allFilter.label",defaultMessage:"View all"}),internal:n()(y.FormattedMessage,{id:"developerIntegrationsList.internalFilter.label",defaultMessage:"Internal"}),public:n()(y.FormattedMessage,{id:"developerIntegrationsList.publicFilter.label",defaultMessage:"Public"})};function Q(){return window.__c={n:"FunkyIcon"},n()("img",{alt:"Funky build icon",src:c.Z.images.integrations.funkyManagementIconPng,style:{height:130,width:130}})}function ee(e){window.__c={n:"CardGrid"};const{isLoading:t,error:o,integrationOrBotRecords:i,onCreateNewClick:a}=e,{status:s}=(0,l.V)({value:i,validateLoaded:e=>e.length>0});return o?n()("div",{style:te.error},void 0,o.message):n()("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gridAutoRows:"auto",gap:28,minHeight:508}},void 0,"pending"===s||t?r.createElement(r.Fragment,null,n()(K,{}),n()(K,{}),n()(K,{})):r.createElement(r.Fragment,null,i.map((e=>n()(W,{recordWithTable:e},e.value.id))),n()(j,{onClick:a})))}const te={filterButton:{fontSize:15,height:28,marginTop:4,color:d.ZP.frontTextLight,width:"100%"},selectedFilterButton:{color:d.ZP.frontText,fontWeight:f.Z.fontWeight.medium},error:{color:d.ZP.frontRed}}},36360:(e,t,o)=>{o.d(t,{Z:()=>r});var i=o(83355);class n extends i.Z{willMount(e){document.title=e.title}willUpdate(e){document.title=e.title}renderComponent(){return this.props.children}}n.displayName="DocumentTitle";const r=n},79931:(e,t,o)=>{o.d(t,{v:()=>ce,Z:()=>pe});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(13991),u=o(40902),m=o(66897),g=o(17215),h=o(41432),f=o(15070),v=o(99036),y=o(80951),b=o(8848),S=o(63144),w=o(83212),k=o(14215),C=o(6695),_=o(38297),M=o(42875),T=o(3779),I=o(59753),P=o(26825),x=o(27006),B=o(98459),Z=o(21202),E=o(77420),R=o(70279),A=o(90468),D=o(29369),F=o(19889),L=o(70203),V=o(97880),N=o(82990),O=o(7928),U=o(5366),H=o(33929),z=o(77505),W=o(30874),j=o(3815),K=o(12318),Y=o(2456),G=o(15884),X=o(31278);class q extends d.Z{constructor(){super(...arguments),this.renderEdit=()=>{const{edit:e,formatProperty:t}=this.props;if("page_icon"===t){const o=e.block_data.before.block_value.format&&e.block_data.before.block_value.format[t],i=e.block_data.after.block_value.format&&e.block_data.after.block_value.format[t];return this.renderPageIconUpdatedEdit(o,i)}"is_placeholder"!==t&&(0,V.t1)(t)},this.renderPageIconUpdatedEdit=(e,t)=>{const{edit:o}=this.props;if(e||t)return c.createElement(c.Fragment,null,a()("div",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fontSize:12,lineHeight:1,marginBottom:8}},void 0,T.Z.random({width:12,height:12,marginRight:6}),a()(U.FormattedMessage,{id:"editFormatDiff.pageIcon.label",defaultMessage:"Page Icon",description:"Label in an edit for an updated page icon."})),a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(X.Z,{disabled:!0,isEmptyPage:!1,size:20,icon:e?{pointer:{table:Z.iU,id:o.block_data.before.block_value.id},icon:e}:void 0}),a()("div",{style:{padding:"0px 8px"}},void 0,T.Z.historyForward({width:14,height:14,fill:this.theme.mediumIconColor})),a()(X.Z,{disabled:!0,isEmptyPage:!1,size:20,icon:t?{pointer:{table:Z.iU,id:o.block_data.after.block_value.id},icon:t}:void 0})))}}renderComponent(){return this.renderEdit()||null}}q.displayName="EditFormatDiff";const $=q;var J=o(63867),Q=o(75561),ee=o(67266),te=o.n(ee),oe=o(5242),ie=o.n(oe),ne=o(15095);let re;function ae(e){const{before:t,after:o}=e,i={count:0,encoding:{},decoding:{},annotationEncoding:{},annotationDecoding:{}},n=e=>{const t=i.encoding[e];if(t)return t;{const t=String.fromCharCode(i.count);return i.count++,i.encoding[e]=t,i.decoding[t]=e,t}},r=e=>{const t=te()(e),o=i.annotationEncoding[t];if(o)return o;{const o=String.fromCharCode(i.count);return i.count++,i.annotationEncoding[t]=o,i.annotationDecoding[o]=e,o}},a=e=>l().flatten(L.lz(e).map((e=>{const t=ne.p4(e[0]).map(n);if(L.km(e)){const o=L.hD(e),i=L.I$(o);i&&(t[0]=r({type:"mention",value:i}),o.forEach((e=>{L.ZA(e)||L.ku(e)||L.QV(e)||(t.unshift(r({type:"start",value:e})),t.push(r({type:"end",value:e})))})))}else if(L.Yr(e)){const o=L.hD(e),i=L.Ap(o);if(i){t[0]=r({type:"equation",value:i});for(const e of o)L.ZA(e)||L.ku(e)||L.QV(e)||(t.unshift(r({type:"start",value:e})),t.push(r({type:"end",value:e})))}}else if(L.AJ(e)){L.hD(e).forEach((e=>{t.unshift(r({type:"start",value:e})),t.push(r({type:"end",value:e}))}))}return t}))).join("");if(i.count>65535)throw new Error("This string has way too many different characters.");const s=function(e,t){const o=new(ie())({timeout:2,editCost:6}),i=o.main(t,e);return o.cleanupSemantic(i),i}(a(o),a(t)),c=[];let d=[];return s.forEach((e=>{let[t,o]=e;o.split("").forEach((e=>{if(i.decoding[e]){const o=i.decoding[e];t===re.added?c.push([o,[...d,["+"]]]):t===re.removed?c.push([o,[...d,["-"]]]):t===re.same&&c.push([o,d])}else{const o=i.annotationDecoding[e];if(t===re.added)if("mention"===o.type)c.push([L.qy,[...d,["+"],o.value]]);else if("start"===o.type)d=[...d,o.value];else if("end"===o.type)d=d.filter((e=>!l().isEqual(e,o.value)));else if("equation"===o.type){const e=L.xe(o.value),t=L.qZ(e,[...d,["+"]]);c.push(t)}else(0,V.t1)(o);else if(t===re.removed){if("mention"===o.type)c.push([L.qy,[...d,["-"],o.value]]);else if("equation"===o.type){const e=L.xe(o.value),t=L.qZ(e,[...d,["-"]]);c.push(t)}}else if(t===re.same)if("mention"===o.type)c.push([L.qy,[...d,o.value]]);else if("start"===o.type)d=[...d,o.value];else if("end"===o.type)d=d.filter((e=>!l().isEqual(e,o.value)));else if("equation"===o.type){const e=L.xe(o.value),t=L.qZ(e,d);c.push(t)}else(0,V.t1)(o)}}))})),L.Zx(c)}!function(e){e[e.removed=-1]="removed",e[e.added=1]="added",e[e.same=0]="same"}(re||(re={}));class se extends d.Z{renderComponent(){const{type:e}=this.props.propertySchema;return"text"===e||"title"===e?this.renderTextDiff():this.renderArrowPropertyDiff()}renderTextDiff(){const e=ae({before:this.props.beforeValue.value,after:this.props.afterValue.value});return this.renderProperty({value:e,spaceId:this.props.beforeValue.spaceId})}renderArrowPropertyDiff(){const{beforeValue:e,afterValue:t}=this.props;return a()("div",{style:se.arrowDiffWrapStyle},void 0,this.renderProperty(e),this.renderArrow(),this.renderProperty(t))}renderProperty(e){return a()(J.Z,{value:e,propertySchema:this.props.propertySchema,rootStore:this.props.rootStore})}renderArrow(){return a()("div",{style:{padding:"0px 8px"}},void 0,T.Z.historyForward({width:14,height:14,fill:this.theme.mediumIconColor}))}}se.displayName="PropertyDiff",se.arrowDiffWrapStyle={display:"inline-flex",alignItems:"center"};const le=se;class ce{static getLabelStyle(e){return{fontSize:12,lineHeight:1,paddingTop:8,color:e.lightTextColor}}static getUserHeaderStyle(e){return{fontSize:12,color:e.mediumTextColor}}static getRoleStyle(){return{fontSize:14,whiteSpace:"nowrap"}}}ce.wrapStyle={display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:1,overflow:"hidden",fontSize:14,minHeight:29},ce.headerStyle={fontWeight:N.Z.fontWeight.semibold},ce.subHeaderStyle={fontWeight:N.Z.fontWeight.semibold},ce.subSubHeaderStyle={fontWeight:N.Z.fontWeight.semibold},ce.permissionStyle={display:"flex",flexDirection:"column",minHeight:28,paddingTop:4,paddingBottom:4},ce.groupStyle={display:"flex",alignItems:"center",minHeight:28,fontSize:14,paddingTop:4,paddingBottom:4},ce.permissionTypeWrapStyle={display:"flex",alignItems:"center",fontSize:14,marginRight:6,whiteSpace:"nowrap"},ce.diffWrapStyle={display:"flex",alignItems:"center"},ce.addedStyle={color:b.ZP.blue,backgroundColor:b.ZP.blueWithAlpha(.14)},ce.deletedStyle={opacity:.4,marginBottom:6,textDecoration:"line-through"};class de extends d.Z{constructor(){super(...arguments),this.storeTypes={isEditHovered:K.default.of(!1)},this.renderProperty=(e,t,o)=>a()(Y.KX,{value:e,propertySchema:t,labeled:o,rootStore:this.props.rootStore}),this.renderBlockProperty=(e,t,o,i)=>a()(Y.Tl,{blockValue:e,prop:t,labeled:o,schema:i,intl:this.props.intl,rootStore:this.props.rootStore}),this.renderBlockEditProperty=(e,t,o)=>{const i=this.getBlockSchema(e)[t],n="block-changed"===e.type?e.block_data.after.block_value:e.block_data.block_value,r=(0,Y.SX)(n,t);if(i)return this.renderProperty({value:r,spaceId:(0,B.CG)(n.space_id)},i,o)},this.renderBlockEditPropertyDiff=(e,t,o)=>{const i=this.getBlockSchema(e),n=i[t];if(!n)return;const r=(0,Y.SX)(e.block_data.before.block_value,t),s=y.wV({property:t,schema:i,block:I.kk.fromBlock(e.block_data.before.block_value),getRecordModel:this.getRecordModel,userTimeZone:(0,M.r)(),intl:this.props.intl}),l=(0,Y.SX)(e.block_data.after.block_value,t),c=n.type;return s&&"text"!==c&&"title"!==c?this.renderProperty({value:l,spaceId:(0,B.CG)(e.block_data.after.block_value.space_id)},n,o):a()(Y.Hq,{labeled:o,name:n.name,type:n.type,icon:n.icon},void 0,a()(le,{propertySchema:n,beforeValue:{value:r,spaceId:(0,B.CG)(e.block_data.before.block_value.space_id)},afterValue:{value:l,spaceId:(0,B.CG)(e.block_data.after.block_value.space_id)},rootStore:this.props.rootStore}))},this.renderBlockPropertyEditDiff=e=>{const{labeled:t,propertySchema:o,beforeValue:i,afterValue:n,spaceId:r}=e,s=""===L.Q(i),l=o.type,c=(0,B.CG)(r);return s&&"text"!==l&&"title"!==l?this.renderProperty({value:n,spaceId:c},o,t):a()(Y.Hq,{labeled:t,name:o.name,type:o.type,icon:o.icon},void 0,a()(le,{propertySchema:o,beforeValue:{value:i,spaceId:c},afterValue:{value:n,spaceId:c},rootStore:this.props.rootStore}))},this.getRecordValue=this.props.rootStore.getRecordValue,this.getRecordModel=this.props.rootStore.getRecordModel}renderComponent(){return this.renderEdit()||null}renderEdit(){if("comment-edit"===this.props.type){const{edit:e,discussionLocation:t}=this.props;switch(e.type){case"comment-created":return this.renderCommentCreatedEdit(e,t);case"comment-changed":return this.renderCommentChangedEdit(e);case"comment-deleted":return this.renderCommentDeletedEdit(e,t);default:(0,V.t1)(e)}}const{edit:e}=this.props;switch(e.type){case"block-created":return this.renderBlockCreatedEdit(e.block_data.block_value);case"block-deleted":return this.renderBlockDeletedEdit(e.block_data.block_value);case"block-changed":return this.renderBlockChangedEdit(e);case"block-property-changed":return this.renderBlockPropertyChangedEdit(e);case"collection-property-changed":return this.renderCollectionPropertyChangedEdit(e);case"collection-changed":return this.renderCollectionChangedEdit(e);case"collection-created":return this.renderCollectionCreatedEdit(e);case"mention-created":return this.renderMentionCreated(e);case"permission-created":return this.renderPermissionCreated(e);case"permission-changed":return this.renderPermissionChanged(e);case"permission-deleted":return this.renderPermissionDeleted(e);case"permission-restriction-created":case"permission-restriction-deleted":return this.renderPermissionInheritanceChanged(e);case"permission-group-created":return this.renderPermissionGroupCreated(e);case"permission-group-changed":return this.renderPermissionGroupChanged(e);case"permission-group-deleted":return this.renderPermissionGroupDeleted(e);case"reminder-created":return this.renderReminderCreated(e);case"permission-group-mention-created":return this.renderPermissionGroupMentionCreated(e);case"permission-group-mention-deleted":case"mention-deleted":return null;default:(0,V.t1)(e)}}renderBlockChanged(e){switch(e.block_data.after.block_value.type){case h.Ti.text:return this.renderTextBlockChanged(e);case h.Ti.header:return this.renderHeaderBlockChanged(e);case h.Ti.subHeader:return this.renderSubHeaderBlockChanged(e);case h.Ti.subSubHeader:return this.renderSubSubHeaderBlockChanged(e);case h.Ti.toggle:return this.renderToggleBlockChanged(e);case h.Ti.bulletedList:return this.renderBulletedListBlockChanged(e);case h.Ti.numberedList:return this.renderNumberedListBlockChanged(e);case h.Ti.quote:return this.renderQuoteBlockChanged(e);case h.Ti.factory:return this.renderFactoryBlockChanged(e);case h.Ti.equation:return this.renderEquationBlockChanged(e);case h.Ti.toDo:return this.renderTodoBlockChanged(e);case h.Ti.code:return this.renderCodeBlockChanged(e);case h.Ti.bookmark:return this.renderBookmarkBlockChanged(e);case h.Ti.page:return this.renderPageBlockChanged(e);case h.Ti.collectionView:case h.Ti.collectionViewPage:return this.renderCollectionBlockChanged(e);case h.Ti.image:return this.renderImageBlockChanged(e);case h.Ti.embed:return this.renderEmbedBlockChanged(e,"embed");case h.Ti.framer:return this.renderEmbedBlockChanged(e,"framer");case h.Ti.tweet:return this.renderEmbedBlockChanged(e,"tweet");case h.Ti.gist:return this.renderEmbedBlockChanged(e,"gist");case h.Ti.drive:return this.renderDriveBlockChanged(e);case h.Ti.maps:return this.renderEmbedBlockChanged(e,"maps");case h.Ti.invision:return this.renderEmbedBlockChanged(e,"invision");case h.Ti.video:return this.renderEmbedBlockChanged(e,"video");case h.Ti.audio:return this.renderEmbedBlockChanged(e,"audio");case h.Ti.file:return this.renderEmbedBlockChanged(e,"file");case h.Ti.callout:return this.renderCalloutBlockChanged(e);case h.Ti.whimsical:return this.renderEmbedBlockChanged(e,"whimsical");case h.Ti.miro:return this.renderEmbedBlockChanged(e,"miro");case h.Ti.abstract:return this.renderEmbedBlockChanged(e,"abstract");case h.Ti.mixpanel:return this.renderEmbedBlockChanged(e,"mixpanel");case h.Ti.sketch:return this.renderEmbedBlockChanged(e,"sketch");case h.Ti.replit:return this.renderEmbedBlockChanged(e,"replit");case h.Ti.excalidraw:return this.renderEmbedBlockChanged(e,"excalidraw");case h.Ti.tableRow:return this.renderSimpleTableRowBlockChanged(e);case h.Ti.hex:return this.renderEmbedBlockChanged(e,"hex");case h.Ti.hex:return this.renderEmbedBlockChanged(e,"deepnote");case h.Ti.externalObjectInstance:return this.renderExternalObjectInstanceBlockChanged(e)}}renderBlockCreatedEdit(e){const t=a()(Y.ZP,{blockValue:e,rootStore:this.props.rootStore,created:!0});if(t)switch(e.type){case h.Ti.quote:case h.Ti.video:case h.Ti.code:case h.Ti.equation:case h.Ti.file:case h.Ti.bookmark:case h.Ti.factory:return a()("div",{style:ce.wrapStyle},void 0,t);case h.Ti.table:return;case h.Ti.tableRow:return e.properties&&(0,V.Yd)(e.properties).length>0?a()("div",{style:{...ce.wrapStyle,...ce.addedStyle}},void 0,t):void 0;default:return a()("div",{style:{...ce.wrapStyle,...ce.addedStyle}},void 0,t)}}renderBlockDeletedEdit(e){const t=a()(Y.ZP,{rootStore:this.props.rootStore,blockValue:e,deleted:!0});if(t)switch(e.type){case h.Ti.quote:case h.Ti.video:case h.Ti.code:case h.Ti.equation:case h.Ti.file:case h.Ti.bookmark:case h.Ti.factory:return a()("div",{},void 0,a()("div",{style:ce.getLabelStyle(this.theme)},void 0,a()(U.FormattedMessage,{defaultMessage:"Deleted",id:"edit.blockDeletedEditStyles.factoryLabel",description:"Label in an edit update for a deleted block."})),a()("div",{style:{...ce.wrapStyle}},void 0,t));case h.Ti.table:return;case h.Ti.tableRow:return e.properties&&(0,V.Yd)(e.properties).length>0?a()("div",{style:{...ce.wrapStyle,...ce.deletedStyle}},void 0,t):void 0;default:return a()("div",{},void 0,a()("div",{style:ce.getLabelStyle(this.theme)},void 0,a()(U.FormattedMessage,{defaultMessage:"Deleted",id:"edit.blockDeletedEditStyles.defaultLabel",description:"Default label in an edit update for a deleted block."})),a()("div",{style:{...ce.wrapStyle,...ce.deletedStyle}},void 0,t))}}renderBlockChangedEdit(e){const t=this.renderBlockChanged(e);if(t)return a()("div",{style:ce.wrapStyle},void 0,t)}renderBlockPropertyChangedEdit(e){return a()("div",{},void 0,Object.entries(e.property_updates).map((t=>{let[o,i]=t;const n=e.filtered_block_schema[o],r=i.before?i.before.value:[],s=i.after?i.after.value:[],l=this.renderBlockPropertyEditDiff({labeled:!0,propertySchema:n,beforeValue:r,afterValue:s,spaceId:e.space_id});if(l)return a()("div",{style:ce.wrapStyle},void 0,l)})))}renderCheckbox(e){return a()("div",{style:{marginRight:6,marginTop:3}},void 0,this.renderBlockProperty(e,"checked",!1))}renderEditTitle(e){return this.renderBlockEditProperty(e,"title",!1)}renderEditTitleDiff(e){return this.renderBlockEditPropertyDiff(e,"title",!1)}renderTextBlockChanged(e){return this.renderEditTitleDiff(e)}renderCalloutBlockChanged(e){return a()(w.Z,{title:a()(U.FormattedMessage,{defaultMessage:"Callout",id:"edit.calloutBlockChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e))}renderExternalObjectInstanceBlockChanged(e){const t=t=>{const o=e.block_data[t].block_value,i=I.kk.fromBlock(o);return i.isType("external_object_instance")?g.$F(H.default.getIntl(),i,I.om.fromRecordMap(W.Z.getIntegrationsAsRecordMap())):null};return a()(w.Z,{title:c.createElement(U.FormattedMessage,g.V1.editLabel),theme:this.theme},void 0,a()("div",{style:ce.deletedStyle},void 0,t("before")),a()("div",{},void 0,t("after")))}renderHeaderBlockChanged(e){return a()("div",{style:ce.headerStyle},void 0,this.renderEditTitleDiff(e))}renderSubHeaderBlockChanged(e){return a()("div",{style:ce.subHeaderStyle},void 0,this.renderEditTitleDiff(e))}renderSubSubHeaderBlockChanged(e){return a()("div",{style:ce.subSubHeaderStyle},void 0,this.renderEditTitleDiff(e))}renderToggleBlockChanged(e){return a()(Y.ZD,{},void 0,this.renderEditTitleDiff(e))}renderBulletedListBlockChanged(e){return a()("ul",{style:{margin:0,paddingLeft:28}},void 0,a()("li",{},void 0,this.renderEditTitleDiff(e)))}renderNumberedListBlockChanged(e){return a()("ol",{style:{margin:0,paddingLeft:28}},void 0,a()("li",{},void 0,this.renderEditTitleDiff(e)))}renderQuoteBlockChanged(e){return a()(w.Z,{title:a()(U.FormattedMessage,{defaultMessage:"Quote",id:"edit.quoteBlockChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e))}renderFactoryBlockChanged(e){return a()(w.Z,{title:a()(U.FormattedMessage,{defaultMessage:"Template Button",id:"edit.templateButtonBlockChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e))}renderEquationBlockChanged(e){return a()(w.Z,{title:a()(U.FormattedMessage,{defaultMessage:"Equation",id:"edit.equationBlockChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e))}renderTodoBlockChanged(e){const t=u.j4({before:e.block_data.before.block_value,after:e.block_data.after.block_value,property:"checked"});return a()("div",{style:{display:"inline-flex"}},void 0,t?a()("div",{style:{marginRight:6,marginTop:3,lineHeight:1}},void 0,this.renderBlockEditPropertyDiff(e,"checked",!1)):this.renderCheckbox(e.block_data.after.block_value),this.renderEditTitleDiff(e))}renderCodeBlockChanged(e){return u.j4({before:e.block_data.before.block_value,after:e.block_data.after.block_value,property:"language"})?a()(w.Z,{title:this.getCodeTitle(e.block_data.after.block_value),theme:this.theme},void 0,a()("span",{style:{fontFamily:N.Z.getCompositeFontFamily(p.SP).mono,fontSize:12,tabSize:2}},void 0,this.renderEditTitle(e)),this.renderBlockEditPropertyDiff(e,"language",!0)):a()(w.Z,{title:this.getCodeTitle(e.block_data.after.block_value),theme:this.theme},void 0,a()("span",{style:{fontFamily:N.Z.getCompositeFontFamily(p.SP).mono,fontSize:12,tabSize:2}},void 0,this.renderEditTitle(e)))}renderCaptionChanged(e){return this.propertyChanged(e,"caption")&&this.renderBlockEditPropertyDiff(e,"caption",!1)}renderEmbedBlockChanged(e,t){const{intl:o}=this.props,i=this.propertyChanged(e,"source")&&a()(w.Z,{title:g.xg(o,t),theme:this.theme},void 0,this.renderSource(e.block_data.after.block_value),this.renderBlockEditPropertyDiff(e,"source",!1));return a()(c.Fragment,{},void 0,i,a()("div",{style:{marginBottom:i?4:0}},void 0,this.renderCaptionChanged(e)))}renderImageBlockChanged(e){const t=this.getSource(e.block_data.before.block_value),o=this.getSource(e.block_data.after.block_value),i=t!==o&&a()("div",{style:{marginTop:4,marginBottom:4}},void 0,a()("div",{style:{...ce.getLabelStyle(this.theme),marginBottom:4}},void 0,a()(U.FormattedMessage,{defaultMessage:"Updated",id:"edit.imageBlockChanged.updatedTitle"})),o&&a()(Y.xP,{src:o,permissionRecord:{table:Z.iU,id:e.block_id}}));return a()(c.Fragment,{},void 0,i,a()("div",{style:{marginBottom:i?4:0}},void 0,this.renderCaptionChanged(e)))}renderComment(e){let{commentValue:t,discussionLocation:o,showEditedBadge:i}=e;if(!t.created_by_table||!t.created_by_id)return;if("comment-edit"!==this.props.type)return;const n=this.getRecordValue({table:t.created_by_table,id:t.created_by_id,spaceId:t.space_id}),r=n&&{table:t.created_by_table,value:n},s=r?(0,m.$4)(this.props.intl,r):a()(U.FormattedMessage,{defaultMessage:"Unknown author",id:"edit.unknownAuthor.label"}),l=t.text&&a()(J.Z,{propertySchema:{type:"text",name:""},value:{spaceId:t.space_id,value:t.text},rootStore:this.props.rootStore}),c=t.content&&t.content.length>0&&t.content.map((e=>{const o=this.getRecordValue({table:"block",id:e,spaceId:t.space_id});return o&&a()(Y.ZP,{blockValue:o,rootStore:this.props.rootStore})})).filter(V.$K),d=j.t1.createChildStore(this.props.rootStore,{table:R.x_,id:t.id,spaceId:(0,B.CG)(this.props.rootStore.pointer.spaceId)}),p=0===d.getUserVisibleReactions().length,u=this.stores.isEditHovered;return a()("div",{style:{...p&&{position:"relative"}},onMouseEnter:()=>u.set(!0),onMouseLeave:()=>u.set(!1)},void 0,a()("div",{style:{...ce.getLabelStyle(this.theme),marginBottom:2}},void 0,s),l,c,a()("div",{style:{...p&&{position:"absolute",top:0,right:0}}},void 0,a()(G.Z,{parentStore:d,discussionLocation:o,keepVisible:u.get(),onClick:this.props.onReactionClick})),i&&a()("span",{style:{color:this.theme.mediumTextColor,paddingLeft:4}},void 0,a()(U.FormattedMessage,{id:"edit.editedBadge",description:"Badge marking that a comment has been edited",defaultMessage:"(edited)"})))}renderCommentDiff(e){var t,o;const{before:i,after:n}=e;if(!n.created_by_table||!n.created_by_id)return;const r=this.getRecordValue({table:n.created_by_table,id:n.created_by_id,spaceId:n.space_id}),s=r&&{table:n.created_by_table,value:r},l=s?(0,m.$4)(this.props.intl,s):a()(U.FormattedMessage,{defaultMessage:"Unknown author",id:"edit.unknownAuthorCommentDiff.label"}),d=i.text&&n.text&&a()(le,{propertySchema:{type:"text",name:""},beforeValue:{value:i.text||[],spaceId:i.space_id},afterValue:{value:n.text||[],spaceId:n.space_id},rootStore:this.props.rootStore}),p=null===(t=n.content)||void 0===t?void 0:t.filter((e=>{var t;return!(null!==(t=i.content)&&void 0!==t&&t.includes(e))})),u=null===(o=i.content)||void 0===o?void 0:o.filter((e=>{var t;return!(null!==(t=n.content)&&void 0!==t&&t.includes(e))})),g=a()(c.Fragment,{},void 0,null==u?void 0:u.map((e=>{const t=this.getRecordValue({table:Z.iU,id:e,spaceId:n.space_id});return t&&this.renderBlockDeletedEdit(t)})),null==p?void 0:p.map((e=>{const t=this.getRecordValue({table:Z.iU,id:e,spaceId:n.space_id});return t&&a()(Y.ZP,{blockValue:t,rootStore:this.props.rootStore})})));return a()("div",{},void 0,a()("div",{style:{...ce.getLabelStyle(this.theme),marginBottom:2}},void 0,l),d,g)}renderCollectionPropertyChangedDiff(e){if(!e||!e.before||!e.after)return;const{before:t,after:o}=e,i=y.IQ({before:t,after:o});if(!i)return;const{newOptions:r,modifiedOptions:s,removedOptions:l}=i;if([r,s,l].every((e=>0===e.length)))return;const d=e=>{let{option:t,strikethrough:o=!1}=e;const i=(0,b.KR)(this.theme,null==t?void 0:t.color);return c.createElement(Q.Z,n()({},i,{strikethrough:o}),t.value)};return a()(Y.Hq,{labeled:!0,name:o.name,icon:o.icon,type:o.type},void 0,a()("div",{style:{display:"flex",flexDirection:"column",rowGap:4}},void 0,r.length>0&&a()("div",{style:{display:"inline-flex",alignItems:"center",columnGap:4}},void 0,a()(U.FormattedMessage,{defaultMessage:"Added",id:"Edit.renderCollectionPropertyChangedDiff.addedProperty",description:"Text to be shown in the activity feed for when an option for a property value is added"}),r.map((e=>a()("span",{},e.id,d({option:e}))))),l.length>0&&a()("div",{style:{display:"inline-flex",alignItems:"center",columnGap:4}},void 0,a()(U.FormattedMessage,{defaultMessage:"Removed",id:"Edit.renderCollectionPropertyChangedDiff.removedProperty",description:"Text to be shown in the activity feed for when an option for a property value is removed"}),l.map((e=>a()("span",{},e.id,d({option:e,strikethrough:!0}))))),s.length>0&&a()("div",{style:{display:"flex",flex:1,flexDirection:"row"}},void 0,a()("span",{},void 0,a()(U.FormattedMessage,{defaultMessage:"Edited",id:"Edit.renderCollectionPropertyChangedDiff.editedProperty",description:"Text to be shown in the activity feed for when an option for a property value is edited"})),a()("div",{style:{display:"flex",flexDirection:"column"}},void 0,s.map((e=>a()("span",{style:{display:"inline-flex",alignItems:"center"}},e.before.id,a()("span",{style:{marginLeft:4}},void 0,d({option:e.before,strikethrough:!0})),a()("span",{style:{padding:"0px 8px"}},void 0,T.Z.historyForward({width:10,height:10,fill:this.theme.mediumIconColor})),d({option:e.after}))))))))}renderCollectionDescriptionChangedDiff(e,t){if(!t||!t.before&&!t.after)return;const o=t.before&&t.before.description||[],i=t.after&&t.after.description||[];return a()(Y.Hq,{labeled:!0,name:a()(U.FormattedMessage,{defaultMessage:"Description",id:"edit.descriptionPropertyChanged.label"}),icon:void 0,type:"text"},void 0,a()(le,{propertySchema:{type:"text",name:""},beforeValue:{value:o,spaceId:e},afterValue:{value:i,spaceId:e},rootStore:this.props.rootStore}))}renderCollectionDescriptionCreatedDiff(e){if(e)return a()(Y.Hq,{labeled:!0,name:a()(U.FormattedMessage,{defaultMessage:"Description",id:"edit.descriptionPropertyCreated.label"}),type:"text",icon:void 0},void 0,a()(le,{propertySchema:{type:"text",name:""},beforeValue:{value:[],spaceId:e.spaceId},afterValue:e,rootStore:this.props.rootStore}))}renderBookmarkBlockChanged(e){const t=(this.propertyChanged(e,"title")||this.propertyChanged(e,"source"))&&a()(w.Z,{title:a()(U.FormattedMessage,{defaultMessage:"Bookmark",id:"edit.bookmarkBlockPropertyChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e),this.renderBlockEditPropertyDiff(e,"link",!0));return a()(c.Fragment,{},void 0,t,this.propertyChanged(e,"caption")&&a()("div",{style:{marginBottom:t?4:0}},void 0,this.renderCaptionChanged(e)))}renderDriveBlockChanged(e){const t=(0,C.v0)(e.block_data.before.block_value),o=e.block_data.after.block_value,i=t!==(0,C.v0)(o);return a()(c.Fragment,{},void 0,i&&"drive"===o.type&&a()(Y.ZP,{blockValue:o,rootStore:this.props.rootStore}))}renderPageBlockChanged(e){const t=u.OS({before:e.block_data.before.block_value,after:e.block_data.after.block_value,schema:e.block_schema}),o=u.B9({before:e.block_data.before.block_value,after:e.block_data.after.block_value});return a()("div",{},void 0,t.map(((t,o,i)=>a()("div",{},t,this.renderBlockEditPropertyDiff(e,t,!0)))),o.map(((o,i,n)=>{const r=0===t.length&&0===i,s=i===n.length-1;return a()("div",{style:{marginTop:r?6:10,marginBottom:s?0:6}},o,a()($,{formatProperty:o,edit:e}))})))}renderCollectionBlockChanged(e){return null}renderSimpleTableRowBlockChanged(e){const t=e.block_data.before.block_value,o=e.block_data.after.block_value,i=u.Yr({before:t,after:o});return a()("div",{style:{display:"flex",alignItems:"stretch",flexDirection:"column"}},void 0,i.map((e=>{const i=t.properties&&e in t.properties?t.properties[e]:void 0,n=o.properties&&e in o.properties?o.properties[e]:void 0,r=z.f7({environment:this.environment,cellValue:i,spaceId:t.space_id,parentStore:this.props.rootStore,theme:this.theme}),s=z.f7({environment:this.environment,cellValue:n,spaceId:o.space_id,parentStore:this.props.rootStore,theme:this.theme});return a()("div",{style:{display:"flex",border:`1px solid ${this.theme.tableDividerColor}`,overflowWrap:"anywhere",width:"max-content",maxWidth:"100%",verticalAlign:"top",lineHeight:N.Z.lineHeight.UIRegular.desktop,padding:4,marginBottom:4}},void 0,a()("span",{style:{...ce.deletedStyle,marginBottom:void 0}},void 0,r),i&&n&&T.Z.historyForward({width:12,height:12,fill:this.theme.mediumIconColor,alignSelf:"center",margin:4}),a()("span",{style:{...ce.addedStyle}},void 0,s))})))}renderSource(e){const t=this.getSource(e);return a()("span",{style:{wordBreak:"break-word"}},void 0,t)}renderPermissionCreated(e){return a()("div",{style:{...ce.permissionStyle,...ce.addedStyle,marginTop:3,marginBottom:3}},void 0,a()("div",{},void 0,this.renderPermissionTarget(e)),a()("div",{},void 0,this.renderPermissionRole(e.permission_data)))}renderPermissionDeleted(e){return a()("div",{style:{...ce.permissionStyle,...ce.deletedStyle}},void 0,a()("div",{},void 0,this.renderPermissionTarget(e)),a()("div",{},void 0,this.renderPermissionRole(e.permission_data)))}renderPermissionChanged(e){return a()("div",{style:ce.permissionStyle},void 0,a()("div",{},void 0,this.renderPermissionTarget(e)),a()("div",{},void 0,a()("div",{style:ce.diffWrapStyle},void 0,this.renderPermissionRole(e.permission_data.before),a()("div",{style:{padding:"0px 8px"}},void 0,T.Z.historyForward({width:14,height:14})),this.renderPermissionRole(e.permission_data.after))))}renderPermissionInheritanceChanged(e){var t;return((null===(t=e.permission_data)||void 0===t?void 0:t.calculated_changes)||[]).map(((t,o)=>{let[i,n]=t;const r={timestamp:e.timestamp,space_id:e.space_id,type:"permission-changed",permission_data:{before:i,after:n}};return a()(c.Fragment,{},`inheritance-change-${o}`,this.renderPermissionChanged(r))}))}renderPermissionGroupCreated(e){const t=e.permission_group_data.user_ids||[],o=l().compact(t.map((e=>this.getRecordValue({table:F.KJ,id:e}))));if(0!==o.length)return a()("div",{},void 0,o.map((e=>a()("div",{style:{...ce.groupStyle,...ce.addedStyle,marginTop:3,marginBottom:3}},e.id,(0,O.Nz)(this.props.intl,e)))))}renderPermissionGroupDeleted(e){const t=e.permission_group_data.user_ids||[],o=l().compact(t.map((e=>this.getRecordValue({table:F.KJ,id:e}))));if(0!==o.length)return a()("div",{},void 0,o.map((e=>a()("div",{style:{...ce.groupStyle,...ce.deletedStyle}},e.id,(0,O.Nz)(this.props.intl,e)))))}renderPermissionGroupChanged(e){const t=e.permission_group_data.before.user_ids||[],o=e.permission_group_data.after.user_ids||[],i=(0,k.E)(t,o),n=l().compact(i.created.map((e=>this.getRecordValue({table:F.KJ,id:e})))),r=l().compact(i.deleted.map((e=>this.getRecordValue({table:F.KJ,id:e}))));if(0!==n.length||0!==r.length)return a()("div",{},void 0,n.map((e=>a()("div",{style:{...ce.groupStyle,...ce.addedStyle,marginTop:3,marginBottom:3}},e.id,(0,O.Nz)(this.props.intl,e)))),r.map((e=>a()("div",{style:{...ce.groupStyle,...ce.deletedStyle}},e.id,(0,O.Nz)(this.props.intl,e)))))}renderPermissionRole(e){const t=e.role??"none",o=(0,P.kD)(t,void 0);return o?a()("div",{style:ce.getRoleStyle()},void 0,this.props.intl.formatMessage(o)):void 0}renderPermissionTarget(e){const t="permission-changed"===e.type?e.permission_data.after:e.permission_data;if((0,x.jg)(t)){const e=this.getRecordValue({table:F.KJ,id:t.user_id}),o=(0,O.Nz)(this.props.intl,e);return a()("div",{style:ce.permissionTypeWrapStyle},void 0,a()("div",{style:ce.getUserHeaderStyle(this.theme)},void 0,o))}if((0,x.ix)(t)){const t=this.getRecordValue({table:A.bx,id:e.space_id}),o=t?t.name:a()(U.FormattedMessage,{defaultMessage:"Unknown",id:"edit.unknownSpacePermissionTarget.label"});return a()("div",{style:ce.permissionTypeWrapStyle},void 0,a()("div",{style:ce.getUserHeaderStyle(this.theme)},void 0,o))}if((0,x.$D)(t))return a()("div",{style:ce.permissionTypeWrapStyle},void 0,a()("div",{style:ce.getUserHeaderStyle(this.theme)},void 0,a()(U.FormattedMessage,{defaultMessage:"Published link",id:"edit.publishToWebPermissionTarget.label"})));if((0,x.hV)(t)){const o=this.getRecordValue({table:A.bx,id:e.space_id}),i=(o&&o.permission_groups||[]).find((e=>e.id===t.group_id)),n=i&&i.name||a()(U.FormattedMessage,{defaultMessage:"Deleted group",id:"edit.deletedPermissionGroup.label"});return a()("div",{style:ce.permissionTypeWrapStyle},void 0,a()("div",{style:ce.getUserHeaderStyle(this.theme)},void 0,n))}if((0,x.FB)(t)){const o=this.getRecordValue({table:E.cZ,id:t.bot_id,spaceId:e.space_id}),i=(0,f.Mh)(o);return a()("div",{style:ce.permissionTypeWrapStyle},void 0,a()("div",{style:ce.getUserHeaderStyle(this.theme)},void 0,i))}if((0,x.zU)(t)){const o=this.getRecordValue({table:D.e0,id:t.team_id,spaceId:e.space_id});let i=a()(U.FormattedMessage,{defaultMessage:"Members of an unknown teamspace",id:"edit.teamMemberPermissionChanged.unknownTeam",description:"Label for modal showing that members of an unknown teamspace will get different permissions access than before"});return null!=o&&o.name&&(i=a()(U.FormattedMessage,{defaultMessage:"Members of {teamName}",id:"edit.teamMemberPermissionChanged.knownTeam",description:"Label for modal showing that members of the given teamspace will get different permissions access than before",values:{teamName:o.name}})),a()("div",{style:ce.permissionTypeWrapStyle},void 0,a()("div",{style:ce.getUserHeaderStyle(this.theme)},void 0,i))}if((0,x.LW)(t)){const o=this.getRecordValue({table:D.e0,id:t.team_id,spaceId:e.space_id});let i=a()(U.FormattedMessage,{defaultMessage:"Owners of an unknown teamspace",id:"edit.teamOwnerPermissionChanged.unknownTeam",description:"Label for modal showing that owners of an unknown teamspace will get different permissions access than before"});return null!=o&&o.name&&(i=a()(U.FormattedMessage,{defaultMessage:"Owners of {teamName}",id:"edit.teamOwnerPermissionChanged.knownTeam",description:"Label for modal showing that owners of the given teamspace will get different permissions access than before",values:{teamName:o.name}})),a()("div",{style:ce.permissionTypeWrapStyle},void 0,a()("div",{style:ce.getUserHeaderStyle(this.theme)},void 0,i))}}renderCommentCreatedEdit(e,t){const o=this.getRecordValue({table:R.x_,id:e.comment_id,spaceId:e.space_id}),i=Boolean(e.comment_data&&o&&(0,S.P)(I.kk.fromValue(R.x_,e.comment_data),I.kk.fromValue(R.x_,o)));if(o)return a()("div",{style:ce.wrapStyle},void 0,this.renderComment({commentValue:o,discussionLocation:t,showEditedBadge:i}))}renderCommentChangedEdit(e){return a()("div",{style:ce.wrapStyle},void 0,this.renderCommentDiff(e.comment_data))}renderCommentDeletedEdit(e,t){const o=this.getRecordValue({table:R.x_,id:e.comment_id,spaceId:e.space_id}),i=e.comment_data||o;if(i)return a()("div",{style:{...ce.wrapStyle,...ce.deletedStyle}},void 0,this.renderComment({commentValue:i,discussionLocation:t,showEditedBadge:!1}))}renderCollectionPropertyChangedEdit(e){const t=this.renderCollectionPropertyChangedDiff(e.collection_property_data);return t?a()("div",{style:{...ce.wrapStyle,paddingTop:6,paddingBottom:4}},void 0,t):null}renderCollectionChangedEdit(e){return a()("div",{style:ce.wrapStyle},void 0,this.renderCollectionDescriptionChangedDiff(e.space_id,e.collection_data))}renderCollectionCreatedEdit(e){var t;const o=null===(t=e.collection_data)||void 0===t?void 0:t.description;return a()("div",{style:ce.wrapStyle},void 0,this.renderCollectionDescriptionCreatedDiff(o&&{value:o,spaceId:e.space_id}))}renderMentionCreated(e){return this.renderBlockOrProperty({blockId:e.mentioned_block_id,property:e.mentioned_property})}renderPermissionGroupMentionCreated(e){return this.renderBlockOrProperty({blockId:e.mentioned_block_id,property:e.mentioned_property})}renderReminderCreated(e){return this.renderBlockOrProperty({blockId:e.reminder_block_id,property:e.reminder_property})}renderBlockOrProperty(e){const t=this.getRecordValue({table:Z.iU,id:e.blockId});if(t){const o=(0,_.ky)({block:t,getRecordValue:this.getRecordValue});if(o){const i=v.oC(o),n=this.renderBlockProperty(t,e.property,!0,i);if(n)return a()("div",{style:{...ce.wrapStyle}},void 0,n)}else{const e=a()(Y.ZP,{blockValue:t,rootStore:this.props.rootStore});if(e)return a()("div",{style:ce.wrapStyle},void 0,e)}}}getBlockSchema(e){return e.block_schema?v.a5(e):v.Kc(this.props.intl)}getCodeTitle(e){const t=e&&e.properties&&e.properties.language;if(!t)return a()(U.FormattedMessage,{defaultMessage:"Code",id:"edit.codeBlockChanged.label"});const o=y.Sj(t,v.fG);return a()(U.FormattedMessage,{defaultMessage:"Code - {codeLanguage}",values:{codeLanguage:o},id:"edit.codeBlockWithLanguageChanged.label"})}getSource(e){const t=e&&e.properties&&e.properties.source;return y.zB(t)}hasProperty(e,t){return Boolean(e&&e.properties&&e.properties[t])}propertyChanged(e,t){return!l().isEqual(e.block_data.before.block_value&&e.block_data.before.block_value.properties&&e.block_data.before.block_value.properties[t],e.block_data.after.block_value&&e.block_data.after.block_value.properties&&e.block_data.after.block_value.properties[t])}}de.displayName="Edit";const pe=(0,U.injectIntl)(de)},63867:(e,t,o)=>{o.d(t,{Z:()=>F});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(80951),u=o(8848),m=o(32918),g=o(3779),h=o(59753),f=o(74446),v=o(98459),y=o(21202),b=o(77420),S=o(19889),w=o(97880),k=o(82990),C=o(5366),_=o(14976),M=o(17731),T=o(3815),I=o(39111),P=o(29302),x=o(89845),B=o(75561),Z=o(81954),E=o(70693),R=o(4308);function A(e){window.__c={n:"EditVerificationProperty"};const{textValue:t,getUserValue:o,getRecordValue:i}=e,n=(0,C.useIntl)(),r=(0,c.useMemo)((()=>{const e=p._w(t);return e?R.WN(e):{type:"none"}}),[t]),s=(0,Z.VK)((()=>{if("none"===r.type)return;const e=r.actorPointer;return e.table===S.KJ?{table:e.table,value:o(e.id)}:{table:e.table,value:i(e)}}),[r,o,i]);if("none"===r.type)return a()("span",{},void 0,n.formatMessage(R.X3.none));if(!s)return null;const l=s.table===S.KJ?a()(P.Z,{userValue:s.value,inline:!0,style:{display:"inline-flex",alignItems:"baseline"},avatarSize:18,avatarMarginRight:3}):a()(I.Z,{botModel:s.value&&h.kk.fromValue(s.table,s.value),style:{display:"inline-flex",alignItems:"baseline"}});return"verified"===r.type&&r.isIndefinite?a()("div",{},void 0,n.formatMessage(R.X3.verifiedIndefinitely,{actor:l})):a()("div",{},void 0,n.formatMessage(R.X3.verifiedUntil,{actor:l,datetime:E.nK({dateTime:r.dateTimeRange.end,intl:n,displayInUserTimezone:!0})}))}class D extends d.Z{constructor(){super(...arguments),this.renderRelation=(e,t)=>{const o=this.getPageTitle(e),{disableStyleAnnotations:i=!1,disableDateStyleAnnotations:n=!1}=this.props;return a()("div",{style:{maxWidth:180,...k.Z.textOverflowStyle}},t,_.IY({environment:this.environment,textValue:{value:o,spaceId:(0,v.CG)(e.spaceId)},parentStore:this.props.rootStore,disableHover:!0,disableStyleAnnotations:i,disableDateStyleAnnotations:n,disabled:!0,theme:this.theme,emojiType:(0,M.e_)(this.environment),katex:this.environment.KatexStore.getKatex(),formulaValueTypes:[]}))},this.getUserValue=e=>T.U6.createChildStore(this.props.rootStore,{table:S.KJ,id:e}).getValue(),this.getRecordValue=f.mF.fromMonomorphicFunctionUnsafe((e=>this.getBlockStore(e.id).getRecordValue(e))),this.getRecordModel=h.om.fromGetRecordValueFn(this.getRecordValue),this.getRenderableTextValue=()=>{const{value:e,propertySchema:t}=this.props;if("text"===t.type||"title"===t.type)return e.value;if("relation"===t.type){const e=this.getRelationValue();if(!e)return;const t=e.map(this.getPageTitle);return l().flatten(t)}},this.getPageTitle=e=>{const t=this.getBlockValue(e.id);return t&&(0,p.wS)(t,"title")||[]}}willMountOrUpdate(){const{propertySchema:e}=this.props;"text"!==e.type&&"title"!==e.type&&"relation"!==e.type||this.environment.KatexStore.loadIfNeeded(this.getRenderableTextValue)}renderComponent(){const{value:e}=this.props,t=this.props.propertySchema.type;return"checkbox"!==t&&0===e.value.length?this.renderEmptyProperty():"text"===t?this.renderTextProperty():"checkbox"===t?this.renderCheckboxProperty():"multi_select"===t?this.renderMultiSelectProperty():"select"===t?this.renderSelectProperty():"status"===t?this.renderStatusProperty():"person"===t?this.renderPersonProperty():"number"===t?this.renderNumberProperty():"date"===t?this.renderDateProperty():"url"===t?this.renderUrlProperty():"file"===t?this.renderFileProperty():"email"===t?this.renderEmailProperty():"phone_number"===t?this.renderPhoneNumberProperty():"title"===t?this.renderTextProperty():"created_time"===t?this.renderDateProperty():"created_by"===t?this.renderPersonProperty():"relation"===t?this.renderRelationProperty():"auto_increment_id"===t?this.renderNumberProperty():"verification"===t?this.renderVerificationProperty():"formula"===t||"rollup"===t||"last_edited_by"===t||"last_edited_time"===t||"button"===t||"location"===t?null:void(0,w.t1)(t)}renderEmptyProperty(){return a()("div",{style:{color:this.theme.mediumTextColor,fontSize:12}},void 0,a()(C.FormattedMessage,{defaultMessage:"Empty",id:"editProperty.emptyProperty.label"}))}renderTextProperty(){const{value:e,disableStyleAnnotations:t=!1,disableDateStyleAnnotations:o=!1}=this.props,i=_.IY({environment:this.environment,textValue:e,parentStore:this.props.rootStore,disableStyleAnnotations:t,disableDateStyleAnnotations:o,disableHover:!0,disabled:!0,theme:this.theme,emojiType:(0,M.e_)(this.environment),katex:this.environment.KatexStore.getKatex(),formulaValueTypes:[]});return a()("span",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"}},void 0,i)}renderCheckboxProperty(){const e=p.Ml(this.props.value.value);return a()("div",{style:{width:16,height:16,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,backgroundColor:e?u.ZP.blue:u.ZP.transparent}},void 0,e?this.getCheckedIcon():this.getUncheckedIcon())}renderMultiSelectProperty(){const e=this.props.propertySchema.options||[],t=p.Ak(this.props.value.value);return a()("div",{style:{display:"inline-flex"}},void 0,t.map(((t,o,i)=>{const r=e.find((e=>e.value===t)),a=i.length-1===o,s=(0,u.KR)(this.theme,null==r?void 0:r.color),l=t??_.Xh(this.props.value.value,this.props.rootStore);return c.createElement(B.Z,n()({},s,{key:o,rightMargin:!a}),l)})))}renderSelectProperty(){const e=this.props.propertySchema.options||[],t=p.Sj(this.props.value.value,e),o=t??_.Xh(this.props.value.value,this.props.rootStore),i=e.find((e=>e.value===t)),n=(0,u.KR)(this.theme,null==i?void 0:i.color);return a()("div",{style:{display:"inline-flex"}},void 0,c.createElement(B.Z,n,o))}renderStatusProperty(){const e=this.props.propertySchema,t=p.yp(this.props.value.value,e),o=t??_.Xh(this.props.value.value,this.props.rootStore),i=(e.options??[]).find((e=>e.value===t)),n=(0,u.KR)(this.theme,null==i?void 0:i.color);return a()("div",{style:{display:"inline-flex"}},void 0,c.createElement(B.Z,n,o))}renderPersonProperty(){const e=p.DW({textValue:this.props.value.value,propertySchema:this.props.propertySchema}),t=[];return e.forEach(((o,i)=>{const n=e.length-1===i;if(o.table===S.KJ){const e=o.id,r=this.getUserValue(e);t.push(a()("div",{style:{marginTop:4,marginRight:n?0:8}},i,a()(P.Z,{userValue:r,inline:!0,avatarSize:18,style:{fontSize:12},avatarShouldShowShadow:!0})))}else{const e=o.id,r=this.getRecordModel({table:b.cZ,id:e,spaceId:o.spaceId});t.push(a()("div",{style:{marginTop:4,marginRight:n?0:8}},i,a()(I.Z,{botModel:r})))}})),a()("div",{style:{display:"inline-flex"}},void 0,t)}renderNumberProperty(){const e=p.VY(this.props.value.value);return a()("div",{},void 0,e)}renderDateProperty(){const e=this.props.propertySchema,t=p.Gl(this.props.value.value);return a()(x.Z,{value:t,dateFormat:e.date_format||m.sF,timeFormat:e.time_format||m.c_})}renderUrlProperty(){return p.zB(this.props.value.value)}renderFileProperty(){const e=p.g(this.props.value.value);return a()("div",{style:{display:"inline-flex"}},void 0,e.map(((e,t,o)=>{const i=o.length-1===t;return a()(B.Z,{rightMargin:!i},t,e.url)})))}renderEmailProperty(){const e=p.zB(this.props.value.value);return a()("div",{},void 0,e)}renderPhoneNumberProperty(){const e=p.zB(this.props.value.value);return a()("div",{},void 0,e)}renderRelationProperty(){let e=this.getRelationValue();if(!e)return;if(e.length>5){const t=e.slice(5).length;return e=e.slice(0,5),a()("div",{},void 0,e.map(this.renderRelation),a()("div",{style:{maxWidth:180,color:this.theme.mediumTextColor}},void 0,a()(C.FormattedMessage,{defaultMessage:"{leftoverCountNumber} more",id:"editProperty.relationEditedProperties.moreCount.label",description:"Indicates how many other (unshown) properties were edited on this relation property update.",values:{leftoverCountNumber:t}})))}return a()("div",{},void 0,e.map(this.renderRelation))}renderVerificationProperty(){return a()(A,{textValue:this.props.value.value,getUserValue:this.getUserValue,getRecordValue:this.getRecordValue})}getBlockStore(e){return T.G.createChildStore(this.props.rootStore,{table:y.iU,id:e})}getBlockValue(e){return this.getBlockStore(e).getValue()}getRelationValue(){if("relation"===this.props.propertySchema.type)return p.j$({relationValue:p.rq(this.props.value.value),getRecordValue:this.getRecordValue,propertySchema:this.props.propertySchema})}getCheckedIcon(){return g.Z.check({fill:u.ZP.white,width:12,height:12})}getUncheckedIcon(){return g.Z.checkboxSquare()}}D.displayName="EditProperty";const F=D},75561:(e,t,o)=>{o.d(t,{Z:()=>a});var i=o(77094),n=o.n(i),r=(o(67294),o(82990));function a(e){window.__c={n:"EditPropertyBadge"};const{children:t,textColor:o,backgroundColor:i,rightMargin:a,strikethrough:s}=e;return n()("div",{style:{backgroundColor:i,color:o,display:"inline-flex",alignItems:"center",fontSize:12,height:18,paddingLeft:8,paddingRight:8,borderRadius:3,marginRight:a?4:0,textDecoration:s?"line-through":void 0}},void 0,n()("span",{style:{...r.Z.textOverflowStyle}},void 0,t))}},93262:(e,t,o)=>{o.d(t,{Z:()=>N});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(83355),c=o(1302),d=o(70203),p=o(97880),u=o(42239),m=o(87420),g=o(52989),h=o(55332),f=o(24677),v=o(98104),y=o(84064),b=o(14976),S=o(12534),w=o(28314),k=o(98742),C=o(39500),_=o(45162),M=o(72133),T=o(89086),I=o(28685),P=o(95802),x=o(15723),B=o(55367),Z=o(22294),E=o(88923),R=o(69784),A=o(27724),D=o(24666),F=o(6685),L=o(3386);class V extends l.Z{constructor(){super(...arguments),this.isSelected=!1,this.shouldEditOnClick=!0,this.shouldDisableMultiSelectionOnDragEnd=!1,this.contentEditableLeafRef=s.createRef(),this.wrapperRef=s.createRef(),this.handleKeyDown=e=>{e.metaKey||e.ctrlKey||e.altKey||Z.Z.setKeyboardMode(!0)},this.handleDragStart=e=>{const t=this.getContextClosestSelectableStore();e.shiftKey&&!this.isEditing.state&&t?(e.preventDefault(),f.Ys({environment:this.environment,store:t,toggle:f.ji(this.environment),selectBetween:f.OS()}),this.shouldEditOnClick=!1):this.shouldEditOnClick=!0},this.handleDragMove=e=>{if(B.ZP.state.isDragging)u.td(this.environment,{currentX:e.currentX,currentY:e.currentY});else if(e.shiftKey)C.X9()&&u.f$(this.environment,{startX:e.startX,startY:e.startY,stores:A.default.state.stores,isNativeDrag:!1,getGhostElement:void 0});else if(!R.Z.state.isActive){if(!this.props.canSelectionDrag)return;const o=this.getNode();if(!o)return;const i=x.jn(o.getBoundingClientRect(),V.minDragDist);if(x.uh(i,e.currentX,e.currentY))return;var t;if((0,_.Aw)(this.environment))return void("mouse"===e.device&&null!==(t=this.contentEditableContext)&&void 0!==t&&t.tryEnableMultiSelection()&&(this.shouldDisableMultiSelectionOnDragEnd=!0));this.shouldEditOnClick=!1,g.AI({environment:this.environment,target:e.target,startX:e.startX,startY:e.startY,showSelectionRect:!1,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}},this.handleDragEnd=e=>{var t;this.shouldDisableMultiSelectionOnDragEnd&&(null===(t=this.contentEditableContext)||void 0===t||t.tryDisableMultiSelection(),this.shouldDisableMultiSelectionOnDragEnd=!1);B.ZP.state.isDragging?u.fX({environment:this.environment,shiftKey:e.shiftKey,optionKey:e.optionKey,commandKey:e.commandKey,analyticsFrom:"page_content"}):v.aJ()},this.handleClick=e=>{const{device:t}=this.environment;(0,S.ZP)({event:e,context:S.Af.EditorClick,callback:()=>{if(this.props.onClick&&this.props.onClick(e),e.defaultPrevented)return;const o=A.default.getDefaultContainerFromTarget(e.target);if(!E.default.isSidePeekOpen()||null!=o&&o.isPeekRenderer()||m.E5(this.environment),this.shouldEditOnClick){const o=this.getContextClosestSelectableStore();if(o?f.eP({environment:this.environment,store:o}):(f.Af({stores:[]}),f.$Y({environment:this.environment,phase:A.SelectionPhase.Selected,preventClearEditingText:!0})),t.isMobile&&!this.isEditing.state&&!this.isPartOfSelection.state){const t=this.getNode();if(t){let o;if(this.mutateDOM((()=>{t.classList.add("editor-force-select"),o=M.rangeFromPoint(e.clientX,e.clientY),t.classList.remove("editor-force-select")})),o){const e=this.getTextSelectionFromRange(o);e&&(v.Z5({store:this.props.store,selection:e.selection}),e.forceEmitSelectionStore&&D.default.emit())}}}this.saveSerializedTextSelectionAfterFlush()}else this.shouldEditOnClick=!0}})},this.handleDragCancel=e=>{B.ZP.state.isDragging&&(u.cQ(this.environment),f.ZH(this.environment))},this.handleContextMenu=e=>{this.props.onContextMenu&&(0,S.ZP)({event:e,context:S.Af.EditorContextMenu,callback:()=>{var t,o;if(null===(t=(o=this.props).onContextMenu)||void 0===t||t.call(o,e),!e.defaultPrevented)return"unhandled"}}),this.isEditing.state&&(0,S.ZP)({event:e,context:S.Af.EditorContextMenu,callback:()=>{this.saveSerializedTextSelectionAfterFlush()}})},this.handleDoubleClick=e=>{(0,S.ZP)({event:e,context:S.Af.EditorDoubleClick,callback:()=>{}})},this.handleSelect=e=>{const{device:t}=this.environment;t.isMobile?this.handleMobileSelect(e):this.handleDesktopSelect(e)},this.handleMobileSelect=e=>{if(!this.props.disabled){if(!M.get())return;const t=this.getContextClosestSelectableStore();this.isEditing.state||f.eP({environment:this.environment,store:t}),this.saveSerializedTextSelection(e),c.default.flush()}},this.handleDesktopSelect=e=>{this.props.disabled||!this.isEditing.state&&"contain"===e.endpoint||this.saveSerializedTextSelection(e)},this.defaultShortcutHandlers={onEsc:e=>{if(this.props.disabled)return;if(e.preventDefault(),(0,_.Aw)(this.environment)){const e="empty"!==D.default.state.mode&&D.default.state.multiSelection,t=e&&(0,_.tp)({multiSelection:e,filterCommonAncestors:!0,focus:void 0});if(t)return void f.Z5({environment:this.environment,...t})}const t=this.getContextClosestSelectableStore();if(t){const e=P.C.findSelectableFromStore(t);e&&e.props.canSelect&&f.Z5({environment:this.environment,stores:[t]})}},onUp:e=>{var t;this.props.disabled||((0,_.Aw)(this.environment)?v.N3({environment:this.environment,topBottomPadding:this.props.topBottomPadding,event:e,contentEditableLeafRegistry:null===(t=this.contentEditableContext)||void 0===t?void 0:t.contentEditableLeafRegistry}):v.zJ({environment:this.environment,store:this.props.store,topBottomPadding:this.props.topBottomPadding,event:e}))},onDown:e=>{var t;this.props.disabled||((0,_.Aw)(this.environment)?v.FG({environment:this.environment,topBottomPadding:this.props.topBottomPadding,event:e,contentEditableLeafRegistry:null===(t=this.contentEditableContext)||void 0===t?void 0:t.contentEditableLeafRegistry}):v.DI({environment:this.environment,store:this.props.store,topBottomPadding:this.props.topBottomPadding,event:e}))},onLeft:e=>{if(!this.props.disabled){var t;if((0,_.Aw)(this.environment))return v.AL({environment:this.environment,event:e,contentEditableLeafRegistry:null===(t=this.contentEditableContext)||void 0===t?void 0:t.contentEditableLeafRegistry});v.e2({environment:this.environment,store:this.props.store,event:e})}},onRight:e=>{if(!this.props.disabled){var t;if((0,_.Aw)(this.environment))return v.D1({environment:this.environment,event:e,contentEditableLeafRegistry:null===(t=this.contentEditableContext)||void 0===t?void 0:t.contentEditableLeafRegistry});v.FC({environment:this.environment,store:this.props.store,event:e})}},onSelectAll:e=>{if(!this.props.disabled){var t;if(e.preventDefault(),(0,_.Aw)(this.environment))return v.UV({environment:this.environment,store:this.props.store,canSelectAllBlocks:this.props.canSelectAllBlocks,contentEditableContextId:null===(t=this.contentEditableContext)||void 0===t?void 0:t.id});v.mT({environment:this.environment,store:this.props.store,canSelectAllBlocks:this.props.canSelectAllBlocks})}},onUndo:e=>{e.preventDefault(),h.Yw(this.environment)},onRedo:e=>{e.preventDefault(),h.KX(this.environment)},onGoToBeginningOfLine:e=>{this.setTextSelectionAfterFlush("start",e.shiftKey)},onGoToEndOfLine:e=>{this.setTextSelectionAfterFlush("end",e.shiftKey)}},this.saveSerializedTextSelectionAfterFlush=()=>{c.default.afterNextFlush((()=>{this.saveSerializedTextSelection()}))},this.setTextSelectionAfterFlush=(e,t)=>{const o=D.default.state;"empty"!==o.mode&&c.default.afterNextFlush((()=>{const{start:i,end:n}=o.multiSelection;switch(e){case"start":{const e=i.store.getValue();if(!e)return;const o=d.Oq(e,"\n").reverse().find((e=>{let{endIndex:t}=e;return t<=i.index})),r=(null==o?void 0:o.endIndex)??0,a={store:i.store,index:r};v.NA({multiSelection:{start:a,end:t?n:a}});break}case"end":{const e=(0,T.x0)(n.store);if(!e)return;const o=i.store.getValue();if(!o)return;const r=d.Oq(o,"\n").find((e=>{let{startIndex:t}=e;return t>=n.index})),a=(null==r?void 0:r.startIndex)??e.endIndex,s={store:n.store,index:a};v.NA({multiSelection:{start:t?i:s,end:s}});break}default:(0,p.t1)(e)}}))},this.isPartOfSelection=this.createComputedStore((()=>(0,T.ZZ)(this.props.store)),!1,"isPartOfSelection"),this.isEditing=this.createComputedStore((()=>(0,T.J5)(this.props.store)),!1,"isEditing")}get registries(){return[I.E]}getContentEditableLeaf(){return this.contentEditableLeafRef.current||void 0}getNode(){return this.wrapperRef.current?this.wrapperRef.current:this.contentEditableLeafRef.current?this.contentEditableLeafRef.current.getNode():super.getNode()}didMountOrUpdate(){this.isEditing.state?this.isSelected||(this.isSelected=!0,this.props.onSelected&&this.props.onSelected()):this.isSelected&&(this.isSelected=!1,this.clearBrowserSelection(),this.props.onDeselected&&this.props.onDeselected())}willUnmount(){if(this.isSelected){this.isSelected=!1,this.props.onDeselected&&this.props.onDeselected();const e=this.isEditing.state;c.default.afterNextFlush((()=>{const t=I.E.findEditableWithStore(this.props.store),o=this.isEditing.state;e&&o&&!this.componentIsMounted&&!t&&v.ZH(this.environment)}))}}shouldComponentUpdate(e){return!0}getContextClosestSelectable(){var e;return null===(e=this.context.selectable)||void 0===e?void 0:e.closestSelectable}getContextClosestSelectableStore(){var e,t,o;return null===(e=this.context.selectable)||void 0===e||null===(t=e.closestSelectable)||void 0===t||null===(o=t.props)||void 0===o?void 0:o.store}renderComponent(){const{disabled:e,disableUpDownArrows:t,disableEnter:o}=this.props,i=this.isEditing.state;return n()(L.Z,{capture:i&&!e,onDelete:this.getShortcutHandler("onDelete"),onDeleteToEndOfLine:this.getShortcutHandler("onDeleteToEndOfLine"),onBackspace:this.getShortcutHandler("onBackspace"),onEnter:o?void 0:this.getShortcutHandler("onEnter"),onShiftEnter:this.getShortcutHandler("onShiftEnter"),onCommandEnter:this.getShortcutHandler("onCommandEnter"),onCommandShiftEnter:this.getShortcutHandler("onCommandShiftEnter"),onUp:t?void 0:this.getShortcutHandler("onUp"),onDown:t?void 0:this.getShortcutHandler("onDown"),onLeft:this.getShortcutHandler("onLeft"),onRight:this.getShortcutHandler("onRight"),onCommandLeft:this.getShortcutHandler("onCommandLeft"),onCommandRight:this.getShortcutHandler("onCommandRight"),onTab:this.getShortcutHandler("onTab"),onUntab:this.getShortcutHandler("onUntab"),onSelectAll:this.getShortcutHandler("onSelectAll"),onToggleUnderline:this.getShortcutHandler("onToggleUnderline"),onToggleHighlight:this.getShortcutHandler("onToggleHighlight"),onToggleBold:this.getShortcutHandler("onToggleBold"),onToggleItalics:this.getShortcutHandler("onToggleItalics"),onToggleStrike:this.getShortcutHandler("onToggleStrike"),onToggleCode:this.getShortcutHandler("onToggleCode"),onUndo:this.getShortcutHandler("onUndo"),onRedo:this.getShortcutHandler("onRedo"),onEsc:this.getShortcutHandler("onEsc"),onCut:this.getShortcutHandler("onCut"),onCopy:this.getShortcutHandler("onCopy"),onPaste:this.getShortcutHandler("onPaste"),onKeypress:this.getShortcutHandler("onKeyPress"),onMoveUp:this.getShortcutHandler("onMoveUp"),onMoveDown:this.getShortcutHandler("onMoveDown"),onHome:this.saveSerializedTextSelectionAfterFlush,onEnd:this.saveSerializedTextSelectionAfterFlush,onGoToBeginningOfLine:this.getShortcutHandler("onGoToBeginningOfLine"),onGoToEndOfLine:this.getShortcutHandler("onGoToEndOfLine"),onGoForwardOneChar:this.saveSerializedTextSelectionAfterFlush,onGoBackwardOneChar:this.saveSerializedTextSelectionAfterFlush},void 0,this.renderDraggable())}renderDraggable(){const e=this.isEditing.state;return n()(F.Z,{disabled:this.props.disableDrag,onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,cursor:"text",render:t=>this.props.render((0,k.Z)(t,{leafRef:this.contentEditableLeafRef,wrapperRef:this.wrapperRef,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onKeyDown:this.handleKeyDown,onDoubleClick:this.handleDoubleClick}),this.handleSelect,Boolean(e)),enableAndroidContextMenu:this.props.disabled,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll})}getShortcutHandler(e){const t=this.props[e],o=this.defaultShortcutHandlers[e];return t??o}getTextSelectionFromRange(e){return(0,b.Ut)(this.environment,e)}saveSerializedTextSelection(e){const t=M.get();if((0,_.Aw)(this.environment)){var o;const e=(0,_.fx)({contentEditableLeafRegistry:null===(o=this.contentEditableContext)||void 0===o?void 0:o.contentEditableLeafRegistry,range:t,allowInvisibleEndSelection:(0,w.yA)().shift});return e?void v.bc({environment:this.environment,...e,readOnly:"infer",focus:void 0}):void 0}const i=this.getTextSelectionFromRange(t);if(i){const e="empty"!==D.default.state.mode&&(0,_.xI)("Editable",D.default.state.multiSelection);if(e&&e.store===this.props.store&&a().isEqual(e.selection,i.selection)&&!i.forceEmitSelectionStore)return;v.Z5({store:this.props.store,selection:i.selection,readOnly:this.props.disabled}),i.forceEmitSelectionStore&&D.default.emit()}}clearBrowserSelection(){this.props.clearBrowserSelection()}}V.displayName="Editable",V.minDragDist=20,V.contextTypes={...y.Tf,...l.w};const N=V},49914:(e,t,o)=>{o.d(t,{Z:()=>kt});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(62518),p=o(18466),u=o(13991),m=o(6740),g=o(41432),h=o(8848),f=o(95538),v=o(3779),y=o(30845),b=o(70203),S=o(82990),w=o(64002),k=o(5366),C=o(95182),_=o(50906),M=o(54564),T=o(47307),I=o(72747),P=o(96802),x=o(27153),B=o(7476),Z=o(42858),E=o(24677),R=o(98104),A=o(30149),D=o(95477),F=o(28020),L=o(43250),V=o(41232),N=o(33929),O=o(98742),U=o(17504),H=o(65598),z=o(472),W=o(68859),j=o(61766),K=o(88632),Y=o(80796),G=o(49085);class X extends G.Z{getInitialState(){return{hovered:!1,focused:!1,isInFrame:!1}}}const q=X;var $=o(27411),J=o(69784),Q=o(12318),ee=o(83355),te=o(12534),oe=o(96049),ie=o(43593),ne=o(97880),re=o(34809),ae=o(33665),se=o(16354),le=o(64369);function ce(e,t){if(e&&e instanceof re.G){let o=t||e.data.url;return w.j3(o)&&(o=w.O_({relativeUrl:o,baseUrl:D.Z.domainBaseUrl})),e.data.offline?w.j3(e.data.url)||e.data.url.startsWith(D.Z.domainBaseUrl)?{type:"offline"}:{type:"unknown",source:o}:{type:"http",source:o,statusCode:e.data.status}}}function de(e,t){const o=e.error,i=t||e.src;if(o)return o.code===o.MEDIA_ERR_DECODE||o.code===o.MEDIA_ERR_SRC_NOT_SUPPORTED?{type:"unsupported_content_type",extension:i&&(0,ie.mD)(i)}:o.code===o.MEDIA_ERR_NETWORK?{type:"offline"}:void 0}function pe(){return window.__c={n:"unknownFileExtension"},a()(k.FormattedMessage,{id:"embedError.extension.unknown",defaultMessage:"unknown",description:"Used in other error messages if the file extension (eg, .txt) cannot be determined"})}function ue(e){switch(e){case"audio":return(0,ae.UY)("guides.audioFaqs");case"video":return(0,ae.UY)("guides.videosFaqs");case"image":return(0,ae.UY)("guides.imagesFaqs");default:return(0,ae.UY)("guides.embedsFaqs")}}class me extends ee.Z{didMount(){_.trackEmbedClientError(this.environment,{embedType:this.props.family})}renderComponent(){const{style:e,error:t,family:o,isSmall:i}=this.props,n={background:this.theme.embedPlaceholderBackground,cursor:"default",...e||{},position:"absolute",top:0,bottom:0,left:0,right:0,display:"flex",alignContent:"center",alignItems:"center",justifyContent:i?"flex-start":"center",padding:i?"7px 14px":"0.5em 1em",textAlign:"center",flexDirection:i?"row":"column",overflow:"hidden"},r=i?25:48,s=i?"0px 14px 0 0":"0 0 14px 0",l=function(e,t){return"image"===t?"unsupported_content_type"===e.type?a()(k.FormattedMessage,{defaultMessage:"This image format ({extension}) can't be played on this device.",id:"embedError.image.unsupportedContentType",values:{extension:e.extension||pe()}}):"offline"===e.type?a()(k.FormattedMessage,{defaultMessage:"Go online to view this image",id:"embedError.image.offline"}):"unknown"===e.type?a()(k.FormattedMessage,{defaultMessage:"This image couldn't be loaded.",id:"embedError.image.unknown"}):404===e.statusCode?a()(k.FormattedMessage,{defaultMessage:"This image couldn't be found.",id:"embedError.image.notFound"}):401===e.statusCode||403===e.statusCode?a()(k.FormattedMessage,{id:"embedError.image.permissionDenied",defaultMessage:"Permission denied."}):a()(k.FormattedMessage,{defaultMessage:"This image couldn't be loaded.",id:"embedError.image.serverError"}):"audio"===t?"unsupported_content_type"===e.type?a()(k.FormattedMessage,{defaultMessage:"This audio format ({extension}) can't be played on this device.",id:"embedError.audio.unsupportedContentType",values:{extension:e.extension||pe()}}):"offline"===e.type?a()(k.FormattedMessage,{defaultMessage:"Go online to view this audio",id:"embedError.audio.offline"}):"unknown"===e.type?a()(k.FormattedMessage,{defaultMessage:"This audio couldn't be loaded.",id:"embedError.audio.unknown"}):404===e.statusCode?a()(k.FormattedMessage,{defaultMessage:"This audio couldn't be found.",id:"embedError.audio.notFound"}):401===e.statusCode||403===e.statusCode?a()(k.FormattedMessage,{id:"embedError.audio.permissionDenied",defaultMessage:"Permission denied."}):a()(k.FormattedMessage,{defaultMessage:"This audio couldn't be loaded.",id:"embedError.audio.serverError"}):"video"===t?"unsupported_content_type"===e.type?a()(k.FormattedMessage,{defaultMessage:"This video format ({extension}) can't be played on this device.",id:"embedError.video.unsupportedContentType",values:{extension:e.extension||pe()}}):"offline"===e.type?a()(k.FormattedMessage,{defaultMessage:"Go online to view this video",id:"embedError.video.offline"}):"unknown"===e.type?a()(k.FormattedMessage,{defaultMessage:"This video couldn't be loaded.",id:"embedError.video.unknown"}):404===e.statusCode?a()(k.FormattedMessage,{defaultMessage:"This video couldn't be found.",id:"embedError.video.notFound"}):401===e.statusCode||403===e.statusCode?a()(k.FormattedMessage,{id:"embedError.video.permissionDenied",defaultMessage:"Permission denied."}):a()(k.FormattedMessage,{defaultMessage:"This video couldn't be loaded.",id:"embedError.video.serverError"}):"file"===t?"unsupported_content_type"===e.type?a()(k.FormattedMessage,{defaultMessage:"This file format ({extension}) can't be played on this device.",id:"embedError.file.unsupportedContentType",values:{extension:e.extension||pe()}}):"offline"===e.type?a()(k.FormattedMessage,{defaultMessage:"Go online to view this file",id:"embedError.file.offline"}):"unknown"===e.type?a()(k.FormattedMessage,{defaultMessage:"This file couldn't be loaded.",id:"embedError.file.unknown"}):404===e.statusCode?a()(k.FormattedMessage,{defaultMessage:"This file couldn't be found.",id:"embedError.file.notFound"}):401===e.statusCode||403===e.statusCode?a()(k.FormattedMessage,{id:"embedError.file.permissionDenied",defaultMessage:"Permission denied."}):a()(k.FormattedMessage,{defaultMessage:"This file couldn't be loaded.",id:"embedError.file.serverError"}):"embed"===t?"unsupported_content_type"===e.type?a()(k.FormattedMessage,{defaultMessage:"This embed format ({extension}) can't be played on this device.",id:"embedError.embed.unsupportedContentType",values:{extension:e.extension||pe()}}):"offline"===e.type?a()(k.FormattedMessage,{defaultMessage:"Go online to view this embed",id:"embedError.embed.offline"}):"unknown"===e.type?a()(k.FormattedMessage,{defaultMessage:"This embed couldn't be loaded.",id:"embedError.embed.unknown"}):404===e.statusCode?a()(k.FormattedMessage,{defaultMessage:"This embed couldn't be found.",id:"embedError.embed.notFound"}):401===e.statusCode||403===e.statusCode?a()(k.FormattedMessage,{id:"embedError.embed.permissionDenied",defaultMessage:"Permission denied."}):a()(k.FormattedMessage,{defaultMessage:"This embed couldn't be loaded.",id:"embedError.embed.serverError"}):void(0,ne.t1)(t)}(t,o);return a()("div",{style:n},void 0,function(e){switch(e){case"image":return v.Z.imageError;case"audio":case"video":return v.Z.playbackError;default:return v.Z.genericError}}(o)({fill:this.theme.lightTextColor,width:r,height:r,margin:s}),a()(le.Z,{isSecondaryColor:!0,isMultiline:!i,style:{margin:s}},void 0,a()("div",{style:{display:i?"inline-block":"block",marginRight:i?"14px":void 0}},void 0,l),"offline"!==t.type&&a()(se.Z,{style:{display:"inline",pointerEvents:"auto",cursor:"auto",borderBottom:`1px solid ${this.theme.lightTextColor}`},href:ue(o),external:!0,onClick:()=>{_.trackClickHelpButton(this.environment,{from:"embed_error"})}},void 0,a()(k.FormattedMessage,{defaultMessage:"Learn more",id:"embedError.learnMore"}))),!i&&"http"===t.type&&a()(le.Z,{isSmall:!0,isSecondaryColor:!0},void 0,function(e){window.__c={n:"formatHttpError"};const{source:t,statusCode:o}=e,i=w.Qc(t).hostname;return a()(k.FormattedMessage,{defaultMessage:"{hostname} (Error {statusCode})",id:"embedError.hostnameAndStatusCode",description:"Displays the hostname and the HTTP status code number",values:{hostname:i,statusCode:o}})}(t)),!i&&"unknown"===t.type&&t.source&&a()(le.Z,{isSmall:!0,isSecondaryColor:!0},void 0,w.Qc(t.source).hostname))}}me.displayName="EmbedErrorBox";const ge=me;var he=o(35021);let fe=null;class ve extends ee.Z{constructor(){super(...arguments),this.storeTypes={error:Q.default.of(void 0)},this.onPlay=e=>{fe&&fe.pause(),fe=e.currentTarget},this.onPause=e=>{fe===e.currentTarget&&(fe=null)},this.onError=e=>{const t=de(e.currentTarget,this.props.source);t&&this.stores.error.set(t)}}renderComponent(){const{contentWrapStyle:e,source:t,handleEmbedComp:o}=this.props;return a()("div",{style:e,onMouseDown:te.$0,onTouchStart:te.$0},void 0,a()("div",{style:this.getStyle()},void 0,c.createElement("audio",{ref:e=>o(e),style:this.getStyle(),controls:!0,preload:"none",onError:this.onError,onPlay:this.onPlay,onPause:this.onPause,src:t}),this.renderError()))}renderError(){const e=this.stores.error.get();if(e)return a()(ge,{family:"audio",error:e,isSmall:!0})}getStyle(){const{contentStyle:e}=this.props;return{...e,pointerEvents:oe.Z.state?"none":"auto",position:"relative"}}}ve.displayName="AudioBox",ve.containerStyle={position:"relative",borderColor:h.ZP.contentBorder,borderRadius:3,borderWidth:1,borderStyle:"solid"};const ye={render:function(e){window.__c={n:"renderAudio"};const{contentStyle:t,contentWrapStyle:o,handleEmbedComp:i}=e;return a()(he.Z,{url:e.source,permissionRecord:e.store.pointer,useS3Url:e.useS3Url,render:(e,n,r)=>r?n?a()(ve,{contentStyle:t,contentWrapStyle:o,source:n,handleEmbedComp:i}):void 0:a()("div",{})})},resizable:!1,hideActions:!0,rendererType:"audio"};var be=o(86671),Se=o(13966),we=o(70518),ke=o(68709),Ce=o(64921),_e=o(31945),Me=o(89728),Te=o(58032),Ie=o(480),Pe=o(81954),xe=o(24405),Be=o(73959),Ze=o(77907),Ee=o(27724),Re=o(21199),Ae=o(1743);function De(e){window.__c={n:"DrawingBox"};const t=(0,Ie.O7)(),o=(0,Pe.VK)((()=>(0,Be.iZ)(e.store)),[e.store]),i=(0,xe.yK)((t=>({sizer:{height:e.height,display:"flex",borderRadius:3,paddingTop:2,paddingLeft:10,paddingRight:10,paddingBottom:10},border:{display:"flex",flex:1,margin:2,padding:3,boxShadow:o?t.outlineBlueInputBoxShadow:void 0,outline:`1px solid ${t.regularDividerColor}`,transition:"box-shadow 0.1s ease-in-out",willChange:"box-shadow",borderRadius:3},ignoreClickArea:{flex:1,position:"relative"}})),[o,e.height]),r=(0,c.useCallback)((()=>{R.ZH({device:t.device}),E.Z5({environment:t,stores:[e.store],phase:Ee.SelectionPhase.Editing})}),[t,e.store]),s=(0,c.useCallback)((t=>c.createElement("div",n()({},t,{style:i.ignoreClickArea,className:"notion-disable-webkit-user-select"}),c.createElement(Ze.LazyTldrawAdapter,n()({},e,{isEditing:o})))),[i.ignoreClickArea,e,o]);return a()("div",{style:i.sizer,onPointerDown:r},void 0,a()("div",{style:i.border},void 0,a()(Ae.Z,{capture:o,allowEsc:!0},void 0,a()(Re.Z,{capture:!0,render:s}))))}const Fe={render:e=>c.createElement(De,e),resizable:!0,hideActions:!0,rendererType:"drawing"};var Le=o(86329),Ve=o(29477);let Ne=0;function Oe(e){const t=Ve.UZ(),o=document.createElement("script");o.type="text/javascript";const i=function(){const e="notion_jsonp_callback_"+Ne;return Ne++,e}();window[i]=e=>{delete window[i],o.parentNode&&o.parentNode.removeChild(o),t.resolve(e)};const n=w.SK(e,{callback:i});return o.src=n,o.onerror=e=>{delete window[i],o.parentNode&&o.parentNode.removeChild(o),t.reject(e)},document.head&&document.head.appendChild(o),t.promise}class Ue extends G.Z{getInitialState(){return{loading:!0,error:!1,html:void 0}}}const He=Ue;var ze=o(68785),We=o(33411);class je extends ee.Z{constructor(){super(...arguments),this.storeTypes={store:He}}async didMount(){const e=`https://gist.github.com/${this.getGistId()}.json`;try{const o=await Oe(e);this.stores.store.setState({loading:!1,error:!1,html:o.div});if(!document.querySelector(`link[href="${o.stylesheet}"]`)){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=o.stylesheet,document.head&&document.head.appendChild(t)}}catch(o){this.stores.store.setState({loading:!1,error:!0,html:void 0})}}renderComponent(){return a()("div",{},void 0,a()(Re.Z,{capture:!0,render:e=>c.createElement("div",n()({},e,{ref:this.props.handleEmbedComp,style:this.getStyle()}),this.renderGist())}))}renderGist(){return a()(We.Z,{show:this.stores.store.state.loading,showDelay:1e3,showHold:500,render:e=>e||this.stores.store.state.loading?a()("div",{style:{marginBottom:"1em"}},void 0,a()("div",{style:{display:"inline-flex",alignItems:"center",opacity:e?1:0,...je.loadingStyle}},void 0,a()(ze.Z,{}),a()("div",{style:{marginLeft:8}},void 0,a()(k.FormattedMessage,{defaultMessage:"Loading gist",description:"A gist is a Github term that doesn't need to be translated.",id:"githubGistRenderer.loading.message"})))):this.stores.store.state.error?a()("div",{style:{marginBottom:"1em"}},void 0,a()("div",{style:je.loadingStyle},void 0,a()(k.FormattedMessage,{defaultMessage:"Error loading gist",description:"A gist is a Github term that doesn't need to be translated.",id:"githubGistRenderer.errorLoading.message"}))):a()("div",{dangerouslySetInnerHTML:{__html:this.stores.store.state.html}})})}getStyle(){return this.stores.store.state.html?{width:"100%",marginBottom:"-1em",overflowY:"auto",height:"100%",pointerEvents:oe.Z.state?"none":"auto"}:{width:"100%",marginBottom:"-1em"}}getGistId(){const{source:e}=this.props,{pathname:t}=w.Qc(e);return(t||"").split("/").pop()}}je.displayName="GistBox",je.loadingStyle={userSelect:"none",padding:"6px 10px",borderRadius:3,border:"1px solid #dddddd",fontSize:14,width:"100%"};const Ke={render:function(e){window.__c={n:"renderGist"};const{source:t,handleEmbedComp:o}=e;return a()(je,{source:t,handleEmbedComp:o})},renderFullScreen:void 0,resizable:!0,embedGhost:!0,hideActions:!0};var Ye=o(40056),Ge=o(51428),Xe=o(77137);const qe=e=>{let{url:t,metadata:o}=e;window.__c={n:"IFramePreviewRenderer"};const i=(0,xe.yK)((e=>({previewWrapper:{display:"flex",flexDirection:"column",border:`1px solid ${e.darkDividerColor}`,borderRadius:"3px",height:"100%"},previewImageArea:{flex:1,backgroundColor:e.embedPlaceholderBackground},previewInfoArea:{padding:"0.75em 1em",backgroundColor:e.regularInvertedTextColor,display:"flex",flexDirection:"column",gap:"0.25em"},previewTitle:{fontWeight:S.Z.fontWeight.medium,color:e.darkTextColor},previewUrl:{display:"flex",alignItems:"center",gap:"0.75em"},previewUrlText:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:e.lightTextColor},previewUrlFavicon:{width:"1.25em",height:"1.25em"}})),[]),n=null!=o&&o.images&&o.images.length>0?o.images[0].url:void 0;return a()("div",{style:i.previewWrapper},void 0,a()("div",{style:i.previewImageArea},void 0,n?a()($e,{imageUrl:n}):a()(Je,{})),a()("div",{style:i.previewInfoArea},void 0,(null==o?void 0:o.title)&&a()("div",{style:i.previewTitle},void 0,o.title),a()("div",{style:i.previewUrl},void 0,(null==o?void 0:o.favicon_url)&&a()("img",{style:i.previewUrlFavicon,src:o.favicon_url}),a()("div",{style:i.previewUrlText},void 0,t))))},$e=e=>{let{imageUrl:t}=e;window.__c={n:"EmbedPreviewArea"};const o=(0,xe.yK)((e=>({wrapper:{display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",height:"100%",backgroundSize:"cover",backgroundImage:`url(${t})`},pill:{backgroundColor:e.accentColors.gray[800],color:e.accentColors.gray[50],borderRadius:"99em",padding:"0.5em 1em",margin:"1em",display:"flex",alignItems:"center",gap:"0.75em",fontWeight:S.Z.fontWeight.medium},playButton:{width:"1em",height:"1em",fill:e.accentColors.gray[50]}})),[t]);return a()("div",{style:o.wrapper},void 0,a()("div",{style:o.pill},void 0,v.Z.play(o.playButton),a()("span",{},void 0,a()(k.FormattedMessage,{defaultMessage:"Load embed",id:"iFramePreview.pillLabel"}))))},Je=()=>{window.__c={n:"ImagelessArea"};const e=(0,xe.yK)((e=>({wrapper:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:e.mediumTextColor,height:"100%"},message:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:"0.75em",fontWeight:S.Z.fontWeight.medium},playButtonWrapper:{backgroundColor:e.mediumTextColor,borderRadius:"2em",width:"2.5em",height:"2.5em",display:"flex",justifyContent:"center",alignItems:"center"},playButton:{marginLeft:"0.1em",width:"1em",height:"1em",fill:e.embedPlaceholderBackground}})),[]);return a()("div",{style:e.wrapper},void 0,a()("div",{style:e.message},void 0,a()("div",{style:e.playButtonWrapper},void 0,v.Z.play(e.playButton)),a()("span",{},void 0,a()(k.FormattedMessage,{defaultMessage:"Tap to load embed",id:"iFramePreview.imagelessAreaLabel"}))))};class Qe extends ee.Z{constructor(){super(...arguments),this.renderPreviewContent=(e,t,o)=>{if(o)return a()(qe,{url:this.props.source,metadata:t})},this.peformPreviewRequest=async e=>(0,Ye.W4)(this.environment,e)}renderComponent(){const e={request:this.props.source,performRequest:this.peformPreviewRequest,render:this.renderPreviewContent};return c.createElement(Xe.Z,e)}}Qe.displayName="IFramePreview";const et={render:function(e){window.__c={n:"renderIFrame"};const{disabled:t,contentStyle:o,contentWrapStyle:i,handleFullScreen:n,handleEmbedComp:r,height:s,preserveScale:l,isFullWidth:d,source:p}=e;return a()(he.Z,{url:p,permissionRecord:e.store.pointer,useS3Url:e.useS3Url,render:(p,u,m)=>m?a()("div",{style:i,onClick:t?n:void 0,onMouseDown:te.$0},void 0,a()("div",{style:{position:"relative"}},void 0,u&&c.createElement(Ge.Z,{ref:e=>r(e),source:u,height:s,style:o,preserveScale:l,isFullWidth:d,background:!0,renderPreview:()=>a()(Qe,{source:(0,Ye.cJ)(e)})}))):a()("div",{})})},embedGhost:!0,renderFullScreen:function(e){window.__c={n:"renderFullScreenIFrame"};const{height:t,source:o,contentStyle:i}=e;return a()(he.Z,{url:o,permissionRecord:e.store.pointer,useS3Url:e.useS3Url,render:(e,n)=>a()(Ge.Z,{source:o,isFullWidth:!0,isFullHeight:!0,height:t,style:i,background:!0})})},resizable:!0};var tt=o(10517),ot=o.n(tt),it=o(54642),nt=o(59488),rt=o(24042),at=o(71669),st=o(32854),lt=o(81865);class ct extends ee.Z{constructor(){super(...arguments),this.storeTypes={error:Q.default.of(void 0)},this.previousImageURL=void 0,this.previousSourceURL=void 0,this.signedOriginalURL=void 0,this.useNativeLightbox=(0,nt.Y)("supportsMobileImageLightbox"),this.getSignedOriginalUrlIfNecessary=(e,t)=>{this.useNativeLightbox&&e&&this.environment.mobileNative&&(this.signedOriginalURL&&e===this.previousSourceURL||(this.previousSourceURL=e,it.getSignedFileUrl(this.environment,{url:e,download:!1,downloadName:"image",permissionRecord:t.pointer},Boolean(rt.Z.state.isNotionProtocolBugFixed)).then((e=>{this.signedOriginalURL=e}))))},this.renderURL=(e,t)=>{const o=t||this.previousImageURL;this.previousImageURL=t;const{isFullScreen:i}=this.props,n=ce(e,void 0)||this.stores.error.get();return i?this.renderFullScreen(n,o):this.renderInline(n,o)},this.handleClickWithoutPropagation=e=>{e.stopPropagation(),this.props.handleFullScreen()},this.onImageError=async(e,t)=>{const o=ie.E$(this.props.source,D.Z.secureFileS3.url)?t:this.props.source;if(t){const e=await(0,re.Z)({url:t,environment:this.environment,method:"HEAD",format:"text"});if("failed"===e.type){const t=ce(e.error,o);if(t)return void this.stores.error.set(t)}}this.stores.error.set({type:"unknown",source:o})}}renderComponent(){const{store:e,dataURL:t,source:o,isFullWidth:i,dragging:n,blockWidth:r,isFullScreen:s}=this.props;if(t)return this.renderURL(void 0,t);this.getSignedOriginalUrlIfNecessary(o,e);const l=i&&!n?void 0:r,c=window.innerWidth,d=l?Math.min(l,window.innerWidth):window.innerWidth;return a()(lt.Z,{url:o,width:s?c:d,render:this.renderURL,isAuthenticated:!0,permissionRecord:e.pointer},`width-${this.props.contentStyle.width}`)}renderInline(e,t){const{progressPercent:o,disabled:i,isLoading:n,contentStyle:r,contentWrapStyle:s,handleFullScreen:l,handleEmbedComp:d,isFullWidth:p,isRootChild:u,height:m,inlineContentStyle:g,blockLocation:h,imageBoxRef:f}=this.props,v=I.qC(h),y=this.useNativeLightbox?()=>{var e;if(_.trackFileOpenAttempt(this.environment,{from:"embedded_block_click",type:"image"}),!t)return;const o=0===t.indexOf("https:")?t:`${D.Z.domainBaseUrl}${t}`;null===(e=this.environment.mobileNative)||void 0===e||e.showLightBox({items:[{type:"image",previewUrl:ot()(o),originalUrl:ot()(this.signedOriginalURL??o)}],startingIndex:0,from:"embedded_block_click"}),E.ZH(this.environment),R.sD()}:void 0,b=this.environment.mobileNative&&this.useNativeLightbox&&!1===(null==t?void 0:t.startsWith("data:")),S=b?y:v?void 0:l,w=v?this.handleClickWithoutPropagation:void 0,k=b?y:w,C=v?this.handleClickWithoutPropagation:l;return c.createElement("div",{ref:e=>d(e),style:s,onClick:i&&!b?C:void 0},a()("div",{},void 0,c.createElement(at.Z,{ref:f,src:t,isFullScreen:!1,style:{...r,...g},placeholderStyle:this.getPlaceholderStyle(),onDoubleClick:S,onClick:k,height:p&&u?m:void 0,capMaxHeight:p&&u,onError:this.onImageError}),e&&a()(ge,{error:e,family:"image"}),n&&a()("div",{style:at.Z.loadingContainerStyle},void 0,a()(ze.Z,{style:{width:16,height:16,marginRight:4}}),a()("div",{style:{minWidth:30,textAlign:"right"}},void 0,a()(st.Z,{percentage:o})))))}renderFullScreen(e,t){const{contentStyle:o}=this.props,i=Math.min(500,window.innerWidth-50);return a()("div",{style:{alignSelf:"center",margin:0,position:"relative",minWidth:e?i:void 0}},void 0,a()("div",{},void 0,a()(at.Z,{src:t,isFullScreen:!0,style:{...o,background:this.theme.contentBackground},placeholderStyle:this.getPlaceholderStyle(),capMaxHeight:!1,onError:this.onImageError}),e&&a()(ge,{error:e,family:"image"})))}getPlaceholderStyle(){const{isFullWidth:e,isRootChild:t,aspectRatio:o,height:i}=this.props,n={};return e&&t||!o?i&&(n.height=i,n.background=h.ZP.contentGrayBackground):(n.height=0,n.paddingBottom=100*o+"%",n.background=h.ZP.contentGrayBackground),n}}ct.displayName="EmbedImageRenderer";const dt={render:e=>c.createElement(ct,n()({},e,{isFullScreen:!1})),renderFullScreen:e=>c.createElement(ct,n()({},e,{isFullScreen:!0})),resizable:!0};const pt={render:function(e){window.__c={n:"renderInvision"};const{disabled:t,contentStyle:o,contentWrapStyle:i,handleFullScreen:n,source:r,handleEmbedComp:s,height:l}=e;return a()("div",{style:i,onClick:t?n:void 0},void 0,a()("div",{style:{position:"relative"}},void 0,c.createElement(Ge.Z,{ref:e=>s(e),source:r,height:l,style:o,background:!1,renderPreview:()=>a()(Qe,{source:(0,Ye.cJ)(e)})})))},renderFullScreen:function(e){window.__c={n:"renderFullScreenInvision"};const{source:t,height:o,contentStyle:i}=e;return a()(Ge.Z,{source:t,isFullWidth:!0,height:o,style:i,background:!0})},resizable:!0};var ut=o(35868),mt=o(37770);function gt(e){window.__c={n:"TweetBox"};const{handleEmbedComp:t,source:i,fullScreen:r}=e,s=(0,xe.Fg)(),l=(0,xe.yK)((e=>({main:{width:r?520:"100%",minWidth:"100%",pointerEvents:"auto",margin:r?"-10px auto":"-10px 0"},loading:{userSelect:"none",borderRadius:3,border:"1px solid #dddddd",fontSize:14,width:"100%",padding:"6px 10px"}})),[r]),p=(0,c.useCallback)((async e=>{if(!e)return;const{pathname:t}=w.Qc(i),o=(t||"").split("/")[3],n={dnt:!0,lang:"en",width:"100%",theme:"dark"===s.mode?"dark":"light"};if(o&&window.twttr){e.innerHTML="";if(await window.twttr.widgets.createTweetEmbed(o,e,n))return}d.render(a()("div",{style:l.loading},void 0,"Error loading tweet"),e)}),[i,l.loading,s.mode]);return a()("div",{style:{display:"flex"}},void 0,a()("div",{style:{marginLeft:"auto",marginRight:"auto",maxWidth:420,minWidth:0,width:"100%"}},void 0,a()(Re.Z,{capture:!0,render:e=>c.createElement("div",n()({},e,{ref:e=>e&&t(e),style:l.main}),a()(mt.Z,{fetch:()=>o.e(898).then(o.bind(o,22062)),loading:e=>e&&a()("div",{style:{display:"inline-flex",alignItems:"center",...l.loading}},void 0,a()(ze.Z,{}),a()("div",{style:{marginLeft:8}},void 0,a()(k.FormattedMessage,{id:"tweetRenderer.loadingTweet.message",defaultMessage:"Loading Tweet"}))),render:()=>c.createElement("div",{ref:p})}))})))}const ht={render:function(e){window.__c={n:"renderTweet"};const{source:t,handleEmbedComp:o}=e;return a()(gt,{source:t,handleEmbedComp:o,fullScreen:!1})},renderFullScreen:function(e){window.__c={n:"renderTweetFullScreen"};const{source:t,handleEmbedComp:o}=e;return a()(gt,{source:t,handleEmbedComp:o,fullScreen:!0})},resizable:!1,embedGhost:!0,hideActions:!0};class ft extends ee.Z{constructor(){super(...arguments),this.storeTypes={played:Q.default.of(!1),error:Q.default.of(void 0)},this.handlePlay=e=>{this.stores.played.set(!0)},this.handlePause=e=>{const{device:t}=this.environment;t.isMobile&&this.stores.played.set(!1)},this.handleEnded=e=>{const{device:t}=this.environment;t.isAndroid&&document.fullscreenElement&&document.exitFullscreen()},this.handleLoadStart=e=>{const{device:t}=this.environment;t.isIOS&&this.video&&this.video.pause()},this.handleError=e=>{const t=de(e.currentTarget,this.props.source);t&&this.stores.error.set(t)},this.handleRef=e=>{this.props.handleEmbedComp(e),this.video=e},this.handlePlayVideo=e=>{this.video&&(0,te.ZP)({event:e,context:te.Af.EditorClick,callback:()=>{this.video.play()}})}}renderComponent(){const{store:e,source:t,contentWrapStyle:o,handleFullScreen:i,aspectRatio:n,height:r,handleEmbedComp:s,isFullWidth:l,preserveScale:d,mediaType:p,useS3Url:u}=this.props;return a()(he.Z,{url:t,permissionRecord:e.pointer,useS3Url:u,render:(e,u,m)=>{if(!m)return a()("div",{});const g=ce(e,void 0)||this.stores.error.get();return u?"video"===p||(0,f.xL)({url:t})?a()("div",{style:o,onMouseDown:te.$0},void 0,a()("div",{style:{position:"relative"},onDoubleClick:i},void 0,this.renderVideo(u),g&&this.renderError(g),this.renderOverlay())):a()("div",{style:o,onDoubleClick:i},void 0,a()("div",{style:{position:"relative"}},void 0,c.createElement(Ge.Z,{ref:e=>s(e),source:u,height:r,style:this.getContentStyle(),isFullWidth:l,preserveScale:d,aspectRatio:n,background:!0}))):void 0}})}renderPlayButton(){const{device:e}=this.environment;return e.isFirefox||e.isMobile?null:a()(vt,{})}getContentStyle(){const{isFullWidth:e,isRootChild:t,preserveScale:o,height:i}=this.props,n={...this.props.contentStyle};return e&&t&&o&&(n.height=i),this.stores.played.get()||(n.pointerEvents="none"),I.qC(this.props.blockLocation)&&(n.maxHeight=240),n.backgroundColor=this.theme.embedPlaceholderBackground,n}renderVideo(e){return c.createElement("video",{ref:this.handleRef,style:this.getContentStyle(),autoPlay:this.environment.device.isIOS,playsInline:!0,controls:!0,preload:"metadata",onPause:this.handlePause,onPlay:this.handlePlay,onEnded:this.handleEnded,onLoadStart:this.handleLoadStart,onError:this.handleError,src:e})}renderError(e){return a()(ge,{family:"video",error:e})}renderOverlay(){return this.stores.played.get()||this.stores.error.get()?null:a()("div",{onClick:this.handlePlayVideo,style:ft.overlayStyle},void 0,this.renderPlayButton())}}function vt(e){return window.__c={n:"PlayButton"},a()("div",{style:{...ft.buttonContainerStyle,...e.style}},void 0,a()("div",{style:ft.buttonTriangleStyle}))}ft.displayName="VideoRenderer",ft.overlayStyle={position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},ft.buttonContainerStyle={position:"relative",height:70,width:70,borderWidth:3,borderStyle:"solid",borderColor:h.ZP.uiBlack,borderRadius:70},ft.buttonTriangleStyle={position:"absolute",left:"50%",top:"50%",transform:"translate(-30%, -50%)",height:0,width:0,borderStyle:"solid",borderColor:h.ZP.uiBlack,borderRightWidth:0,borderLeftWidth:24.5,borderTopWidth:16.1,borderBottomWidth:16.1,borderTopColor:h.ZP.transparent,borderBottomColor:h.ZP.transparent};const yt={render:e=>c.createElement(ft,e),resizable:!0,embedGhost:!0},bt=(0,k.defineMessages)({embedButtonText:{defaultMessage:"Embed link",id:"embedBlock.embedButton.label"},embedCaption:{defaultMessage:"Works with links of PDFs, Google Drive, Google Maps, CodePen…",id:"embedBlock.linkPrompt.caption",description:"Caption for the user to upload or embed a file."},pastePrompt:{defaultMessage:"Paste in https://…",id:"embedBlock.pastePrompt"},validLink:{defaultMessage:"Please enter a valid link.",id:"embedBlock.invalidLinkError.message"},embedTitle:{defaultMessage:"Embed",id:"embedBlock.embedTab.title"}}),St={tweet:ht,gist:Ke,video:yt,image:dt,audio:ye,invision:pt,mixpanel:et,maps:et,drive:et,framer:et,figma:et,loom:et,typeform:et,codepen:et,embed:et,pdf:ut.Z,whimsical:et,miro:et,abstract:et,sketch:et,excalidraw:et,replit:et,hex:et,deepnote:et,drawing:Fe};class wt extends be.Z{constructor(){super(...arguments),this.embedComp=null,this.embedContainerWidth=new Q.default(0),this.imageBoxRef=c.createRef(),this.isStoreNavigableAncestorLocked=this.createComputedStore((()=>this.props.store.isNavigableAncestorLocked())),this.getImageDimensions=()=>{var e;return null===(e=this.imageBoxRef.current)||void 0===e?void 0:e.getImageDimensions()},this.openMenu=()=>{const{device:e}=this.environment;if(!this.props.disableMediaMenu&&this.canEdit()){const{popupWidth:t,maxHeight:o}=this.props,i=this.props.mediaMenuCurrentTab||"embed",n=(this.props.mediaMenuTabs||[{type:"embed"},{type:"file",fileUpload:!0,imageUpload:e.isAndroid,videoUpload:e.isAndroid}]).map((e=>this.createTabFromDefinition(e))),r=d.findDOMNode(this);if(r&&r instanceof Element){const e=r.getBoundingClientRect();x.$(this.environment,{originRect:e,originGap:0,isSmallWidth:!1,showArrow:!0,currentTab:i,tabs:n,title:N.default.formatMessage(bt.embedTitle),...t?{popupWidth:t}:{},...o?{maxHeight:o}:{}})}}},this.replace=()=>{this.openMenu();const e=this.props.store.getType();e&&_.trackEmbedBlockAction(this.environment,{type:"replace",block_type:e,block_id:this.props.store.id})},this.caption=()=>{this.handleEditCaption()},this.getFullScreenNodeRect=()=>{const{isFullWidth:e,aspectRatio:t}=this.getDimensions();if(this.embedComp){const o=d.findDOMNode(this.embedComp);if(o&&o instanceof Element){const i=o.getBoundingClientRect();return e&&t?{...l().toPlainObject(i),width:i.width,height:i.width*t}:i}}},this.renderFullScreenNode=()=>{const e=this.getSource(),t=this.getRendererBySource(this.getSource());if(!e)return;const o=this.getRenderArgs({source:e});return t&&t.renderFullScreen?t.renderFullScreen(o):void 0},this.storeTypes={embedBlockStore:q,blockResizerStore:W.Z,alignmentPopupStore:j.Z},this.renderAlignmentButtons=()=>c.createElement(c.Fragment,null,a()(Ce.Z,{style:{...wt.actionButtonStyle,...this.getAlignmentButtonStyle("left"),borderRight:"none"},hoveredStyle:{...wt.hoveredActionButtonStyle,opacity:1},onClick:()=>this.handleAlignment("left")},void 0,this.getAlignmentIcon("left")),a()("span",{style:{borderRight:`1px solid ${h.ZP.whiteWithAlpha(.2)}`}}),a()(Ce.Z,{style:{...wt.actionButtonStyle,...this.getAlignmentButtonStyle("center"),borderRight:"none"},hoveredStyle:{...wt.hoveredActionButtonStyle,opacity:1},onClick:()=>this.handleAlignment("center")},void 0,this.getAlignmentIcon("center")),a()("span",{style:{borderRight:`1px solid ${h.ZP.whiteWithAlpha(.2)}`}}),a()(Ce.Z,{style:{...wt.actionButtonStyle,...this.getAlignmentButtonStyle("right"),borderRight:"none"},hoveredStyle:{...wt.hoveredActionButtonStyle,opacity:1},onClick:()=>this.handleAlignment("right")},void 0,this.getAlignmentIcon("right"))),this.handleEditCaption=()=>{const e=this.props.store.getPropertyStore("caption");E.eP({environment:this.environment,store:this.props.store}),R.NX({store:e});const t=this.props.store.getType();t&&_.trackEmbedBlockAction(this.environment,{type:"caption",block_type:t,block_id:this.props.store.id})},this.handleMouseEnter=e=>{Y.Z.state.isDragging||J.Z.state.isActive||this.stores.embedBlockStore.setState({...this.stores.embedBlockStore.state,hovered:!0})},this.handleMouseLeave=e=>{Y.Z.state.isDragging||J.Z.state.isActive||this.stores.embedBlockStore.setState({...this.stores.embedBlockStore.state,hovered:!1})},this.handleFocus=e=>{const t=e.target;t instanceof HTMLElement&&(0,m.E)(t)&&this.stores.embedBlockStore.setState({...this.stores.embedBlockStore.state,focused:!0})},this.handleBlur=e=>{this.stores.embedBlockStore.setState({...this.stores.embedBlockStore.state,focused:!1})},this.handleFullScreen=()=>{Z.dK({blocks:[this.props.store],blockLocationOfTargetBlock:this.props.blockLocation});const e=this.props.store.getType();e&&_.trackEmbedBlockAction(this.environment,{type:"full_screen",block_type:e,block_id:this.props.store.id})},this.handleAlignment=e=>{const t=this.getActionableStoreData(),{alignmentPopupStore:o}=this.stores;o.reset(),t&&A.createAndCommit({userAction:"EmbedBlock.handleAlignment",environment:this.environment,perform:o=>{P.hc({environment:this.environment,store:t,alignment:e,transaction:o})}});const i=this.props.store.getType(),n=this.props.store.getFormat(),r=n.block_alignment,a=n.block_width,s=n.block_height,l=this.props.store.isRootOrDirectChild()?"center":"left";i&&_.trackEmbedBlockAction(this.environment,{type:"alignment",block_type:i,block_id:this.props.store.id,block_alignment:e,block_height:s,block_width:a,previous_alignment:r,default_alignment:l}),E.Jy()},this.handleOriginalClick=()=>{const e=this.getActionableStoreData();if(e){I.qL(this.environment,{store:e,from:"view_original"});const t=e.getType();t&&_.trackEmbedBlockAction(this.environment,{type:"original",block_type:t,block_id:this.props.store.id})}},this.handleDownload=()=>{const e=this.getActionableStoreData();if(e){I.TH({environment:this.environment,store:e});const t=e.getType();t&&_.trackEmbedBlockAction(this.environment,{type:"download",block_type:t,block_id:this.props.store.id})}},this.handleUpload=e=>{const t=this.getActionableStoreData();if(t){const o=F.qQ(this.environment);I.cT({environment:this.environment,store:t,file:e,pageWidth:o,preferredType:t.getType()})}},this.fileUploadStore=this.createComputedStore((()=>$.default.getKeyState($.default.getBlockKey(this.props.store.id)))),this.getContainerStyle=e=>{const t={display:"flex"};return I.qC(this.props.blockLocation)&&(t.display="inline-flex",t.maxHeight=240),"audio"===e.rendererType&&(t.display="flex"),t}}handleCreated(){this.openMenu()}edit(){this.openMenu()}embed(e){this.embedSource(e)}async handleRemoveBlockFromComment(){return!!this.props.onRemoveBlockFromComment&&(await this.props.onRemoveBlockFromComment(this.props.store),!0)}activate(){this.getRendererBySource(this.getSource())?this.handleFullScreen():this.replace()}canRenderFullScreen(){const e=this.getRendererBySource(this.getSource());return!(!e||!e.renderFullScreen)}renderPersisted(){const e=this.getSource(),t=this.fileUploadStore.state;return t&&t.dataURL?this.renderSource(t.dataURL):e?this.renderSource(e):this.renderPlaceholder()}renderSource(e){const{device:t}=this.environment,o=this.canEdit(),{preserveScale:i,isFullWidth:r}=this.getDimensions(),s=this.isRootOrDirectChild(),l=this.getRendererBySource(e);if(l){const{resizable:d}=l,p=o&&d&&!this.props.disableResizers,u=p&&(!i||r&&s),m=p&&s,g=u&&!r,h=g&&s,{Left:f,Right:v}=we.bZ,{Vertical:y,Horizontal:b,Corner:S}=we.IS;return(0,U.Z)((o=>c.createElement(ke.p,n()({allowSelectionWithin:!0,ref:t=>{t&&(this.attachGhost(t,e),this.embedContainerWidth.set(t.getBoundingClientRect().width))}},o),this.embedContainerWidth.state&&a()("div",{style:this.getContainerStyle(l)},void 0,a()("div",{className:L.QSt,style:{position:"relative",overflow:d?"hidden":"visible",flexGrow:1},onFocus:this.handleFocus,onBlur:this.handleBlur,onMouseLeave:this.handleMouseLeave,onMouseEnter:this.handleMouseEnter},void 0,this.renderEmbed(e),m&&this.renderResizer("LeftResizer",b,f,i),p&&this.renderResizer("RightResizer",b,v,i),g&&this.renderResizer("RightCornerResizer",S,v,i),h&&this.renderResizer("LeftCornerResizer",S,f,i),u&&this.renderResizer("BottomResizer",y,null,i),!this.props.disableActions&&this.renderActions(e),this.props.disableActions&&this.props.showExpandButton&&l.renderFullScreen&&this.renderExpandButton(),this.props.contentBelowSource),!r&&!t.isMobile&&this.renderDiscussion()),this.renderCaption())))}}renderPlaceholder(){const{device:e}=this.environment,t=!K.Z.state.online,o=e.isMobile||this.stores.embedBlockStore.state.hovered,i=this.fileUploadStore.state;return a()("div",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,style:this.getPlaceholderContainerStyle()},void 0,a()(Le.Z,{style:this.getContentWrapStyle(),disabled:!this.canEdit()||t,iconSvg:this.props.iconSvg||v.Z.compass,right:o&&this.canEdit()&&this.renderBlockMenuActionButton(!0),onClick:this.openMenu,isLoading:Boolean(i),progressPercent:i?i.progressPercent:0,file:i?i.file:void 0,name:i?i.name:void 0,size:i?i.size:void 0},void 0,this.props.children||a()(k.FormattedMessage,{defaultMessage:"Embed anything (PDFs, Google Docs, Google Maps, Spotify…)",id:"embedBlock.embedAnything.placeholder"})),this.renderDiscussion())}renderEmbed(e){const t=this.getRendererBySource(e);if(t){const o=this.getRenderArgs({source:e});return t.render(o)}}renderBlockMenuActionButton(e){const{blockLocation:t}=this.props,o=I.qC(t),i=o?C.qq:C.Qi;return a()(Se.Z,{store:this.props.store,fadeIn:!!e,iconStyle:e?void 0:{fill:h.ZP.white},blockMenuActions:i,hideFilterActionsInput:o,hoveredStyle:wt.hoveredActionButtonStyle,tooltipContent:a()(k.FormattedMessage,{defaultMessage:"More actions",description:"Text in a tooltip for a button that when clicked shows more actions",id:"embedBlock.actionButton.tooltip.blockActionMenu"})})}renderExpandButton(){return a()(Me.Z,{style:{position:"absolute",right:12,top:12,background:this.theme.buttonBackground},icon:e=>v.Z.expand({...e,width:16,height:16}),hoveredStyle:{background:this.theme.buttonHoveredBackground},pressedStyle:{background:this.theme.buttonPressedBackground},onClick:this.handleFullScreen},void 0,a()(k.FormattedMessage,{id:"embedBlock.expandFullScreen.button.label",defaultMessage:"Expand"}))}renderActions(e){const{device:t}=this.environment,{blockLocation:o}=this.props,{isFullWidth:i,width:r,isPageWidth:s}=this.getDimensions();if(!this.props.store.canEdit())return;const l=this.props.store.isExternalObjectInstanceBlockStore(),d=this.getRendererBySource(e),p=this.shouldHideActions(),u=this.fileUploadStore.state,m=this.stores.blockResizerStore.state.dragging,f=I.qC(o),y=!t.isMobile&&!f&&!l,b=r&&!s&&!i&&!t.isPhone&&!f,S=!t.isMobile&&(null==d?void 0:d.renderFullScreen)&&l;if(!(u||m||d&&d.hideActions)){const e=H.Xp(this.props.store,{recursivelyLoadAllDiscussions:!1});if(this.isStoreNavigableAncestorLocked.state)return a()("div",{style:this.getActionsStyle()},void 0,a()(Ce.Z,{style:wt.actionButtonStyle,hoveredStyle:wt.hoveredActionButtonStyle,onClick:this.handleOriginalClick},void 0,a()(k.FormattedMessage,{defaultMessage:"View original",id:"embedBlock.viewOriginalLink.button.label"})));if(p)return a()("div",{style:this.getActionsStyle()},void 0,this.renderBlockMenuActionButton());{const o=300,i=Te.Z.Placement.Top;let r;const s=this.props.store.getType();return r=(0,g.VB)(s)?a()(Te.Z,{renderTooltip:()=>a()(k.FormattedMessage,{defaultMessage:"Download",description:"Text in a tooltip for a button that when clicked downloads an image, video, or other file",id:"embedBlock.actionButton.tooltip.download"}),placement:i,delayThreshold:o,render:e=>c.createElement(Ce.Z,n()({},e,{style:wt.actionButtonStyle,hoveredStyle:wt.hoveredActionButtonStyle,onClick:this.handleDownload}),v.Z.download({width:14,height:14,marginRight:0,fill:h.ZP.white}))}):a()(Te.Z,{renderTooltip:()=>a()(k.FormattedMessage,{defaultMessage:"Original",description:"Text in a tooltip for a button that when clicked opens the original version of the embeded content in a new window",id:"embedBlock.actionButton.tooltip.original"}),placement:i,delayThreshold:o,render:e=>c.createElement(Ce.Z,n()({},e,{style:wt.actionButtonStyle,hoveredStyle:wt.hoveredActionButtonStyle,onClick:this.handleOriginalClick}),v.Z.alias({width:14,height:14,marginRight:0,fill:h.ZP.white}))}),a()("div",{style:this.getActionsStyle()},void 0,!f&&!l&&a()(Te.Z,{renderTooltip:()=>a()(k.FormattedMessage,{defaultMessage:"Comment",description:"Text in a tooltip for a button that when clicked adds a comment to an image",id:"embedBlock.actionButton.tooltip.comment"}),placement:i,delayThreshold:o,render:o=>c.createElement(Ce.Z,n()({},o,{style:{...wt.actionButtonStyle,...t.isMobile&&{paddingLeft:8,paddingRight:8}},hoveredStyle:wt.hoveredActionButtonStyle,onClick:()=>{E.ZH(this.environment),e>0?M.Ib({environment:this.environment,blockStore:this.props.store,analyticsFrom:"embed_menu",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}):B.yw({environment:this.environment,blockStore:this.props.store})}}),v.Z.speechBubble({width:14,height:14,marginRight:e>0?4:0,fill:h.ZP.white}),e>0&&e)}),b&&a()(Te.Z,{renderTooltip:()=>a()(k.FormattedMessage,{defaultMessage:"Align",description:"Text in a tooltip for a button that when clicked opens a menu to set the alignment of an image (left, center, right)",id:"embedBlock.actionButton.tooltip.align"}),placement:i,delayThreshold:o,render:e=>a()(_e.Z,{popupType:_e.Z.PopupType.Popup,buttonPopupStore:this.stores.alignmentPopupStore,originGap:1,renderOrigin:t=>c.createElement(Ce.Z,n()({style:wt.actionButtonStyle,hoveredStyle:wt.hoveredActionButtonStyle},(0,O.Z)(t,e)),this.getAlignmentIcon(this.getBlockAlignment()),v.Z.chevronDown({width:8,fill:h.ZP.white,marginLeft:4})),borderRadius:3,render:this.renderAlignmentButtons,popupWrapStyle:{background:wt.actionButtonBackground(this.environment),display:"flex"}})}),y&&a()(Te.Z,{renderTooltip:()=>a()(k.FormattedMessage,{defaultMessage:"Caption",description:"Text in a tooltip for a button that when clicked adds a caption to an image",id:"embedBlock.actionButton.tooltip.caption"}),placement:i,delayThreshold:o,render:e=>c.createElement(Ce.Z,n()({},e,{style:wt.actionButtonStyle,hoveredStyle:wt.hoveredActionButtonStyle,onClick:this.handleEditCaption}),v.Z.caption({width:14,height:14,marginRight:0,fill:h.ZP.white}))}),S&&a()(Te.Z,{renderTooltip:()=>a()(k.FormattedMessage,{defaultMessage:"Expand",description:"Text in a tooltip for a button that when clicked expands image to fullscreen",id:"embedBlock.actionButton.tooltip.expand"}),placement:i,delayThreshold:o,render:e=>c.createElement(Ce.Z,n()({},e,{style:wt.actionButtonStyle,hoveredStyle:wt.hoveredActionButtonStyle,onClick:this.handleFullScreen}),v.Z.expand({width:14,height:14,marginRight:0,fill:h.ZP.white}))}),!t.isMobile&&r,this.renderBlockMenuActionButton())}}}getAlignmentIcon(e){const t={width:14,height:14,marginRight:0,fill:h.ZP.white};return wt.alignmentIconMap[e](t)}renderResizer(e,t,o,i){const n={position:"absolute"},{Vertical:r,Horizontal:s,Corner:l}=we.IS,{Left:c,Right:d}=we.bZ;let p;return t===r||t===l?n.bottom=wt.resizerOffset:t===s&&(n.top=wt.resizerOffset),o===c?n.left=wt.resizerOffset:o===d&&(n.right=wt.resizerOffset),p=t===l?v.Z.cornerResize({stroke:h.ZP.whiteWithAlpha(.5),fill:h.ZP.blackWithAlpha(.65),width:wt.cornerResizeSize,height:wt.cornerResizeSize,transition:`opacity ${wt.transition}`,opacity:this.shouldShowResizer()?1:0,position:"relative",bottom:3,left:o===c?3:-3,transform:o===c?"rotate(90deg)":"none"}):a()("div",{style:this.getResizerInnerStyle(t)}),a()(we.ZP,{store:this.props.store,preserveScale:i,resizerType:t,resizerAlignment:o,resizeComponent:this,blockResizerStore:this.stores.blockResizerStore,resizeHorizontally:!0,resizeVertically:!0,disabled:!1},e,a()("div",{style:{...this.getResizeStyle(t,o),...n}},void 0,p))}createTabFromDefinition(e){switch(e.type){case"embed":const t=this.props.embedButtonText||N.default.formatMessage(bt.embedButtonText);return{type:"embed",caption:this.props.mediaMenuEmbedCaption||N.default.formatMessage(bt.embedCaption),buttonText:t,inputPlaceholder:this.props.urlInputPlaceholder||N.default.formatMessage(bt.pastePrompt),onChange:e=>{const t=(0,w.D5)(e);y.B(t,"url")?(x.Z(),this.embedSource(t)):T.showErrorMessage(N.default.formatMessage(bt.validLink))}};case"file":return{type:"file",fileUpload:Boolean(e.fileUpload),imageUpload:Boolean(e.imageUpload),videoUpload:Boolean(e.videoUpload),onUpload:this.handleUpload};case"unsplash":return{type:"unsplash",onChange:e=>{let{url:t}=e;x.Z(),this.embedSource(t)}};case"giphy":return{type:"giphy",onChange:e=>{let{url:t}=e;x.Z(),this.embedSource(t)}}}}shouldShowResizer(){const{device:e}=this.environment,{hovered:t}=this.stores.embedBlockStore.state,{isMobile:o}=e;return!o&&t}attachGhost(e,t){const o=this.getRendererBySource(t);e&&o&&o.embedGhost&&this.mutateDOM((()=>e.setAttribute("embed-ghost","")))}shouldHideActions(){const{block_width:e}=this.props.store.getFormat(),{temporaryWidth:t}=this.stores.blockResizerStore.state;return void 0!==t?t<=wt.minWidthForActions:void 0!==e&&e<=wt.minWidthForActions}getDimensions(){const{block_height:e,block_width:t,block_preserve_scale:o,block_full_width:i,block_page_width:n,block_aspect_ratio:r}=this.props.store.getFormat(),{dragging:a,temporaryHeight:s,temporaryWidth:l,temporaryFullWidth:c,temporaryPageWidth:d}=this.stores.blockResizerStore.state,p=a?l:t??this.embedContainerWidth.state,u=a?s:e,m=Boolean(a?c:i),g=Boolean(a?d:n),h=Boolean(this.props.preserveScale||o);return{blockWidth:t,blockHeight:e,width:p,height:this.props.store.isExternalObjectInstanceBlockStore()&&"image"!==this.props.mediaType?u||f.QA:u,dragging:a,preserveScale:h,isFullWidth:m,isPageWidth:g,aspectRatio:r}}getSource(){return this.props.source||wt.getEmbedSourceFromBlockStore(this.props.store)}static getEmbedSourceFromBlockStore(e){const t=e.getProperties(),o=null==t?void 0:t.source,i=b.Q(o),{display_source:n}=e.getFormat();return(0,f.Z8)(n||i)}getRenderArgs(e){const{source:t}=e,o=this.fileUploadStore.state,{blockWidth:i,blockHeight:n,width:r,height:a,dragging:s,preserveScale:l,isFullWidth:c,isPageWidth:d,aspectRatio:p}=this.getDimensions(),u=this.isRootOrDirectChild(),{device:m}=this.environment;return{store:this.props.store,source:t,blockWidth:i,blockHeight:n,aspectRatio:p,width:r,height:a,dragging:s,preserveScale:l,isFullWidth:c,isPageWidth:d,isRootChild:u,dataURL:o?o.dataURL:void 0,disabled:!this.canEdit(),contentStyle:this.getContentStyle(),contentWrapStyle:this.getContentWrapStyle(),isLoading:Boolean(o),progressPercent:o?o.progressPercent:0,handleFullScreen:this.handleFullScreen,handleEmbedComp:e=>this.embedComp=e,inlineContentStyle:this.props.inlineContentStyle,blockLocation:this.props.blockLocation,mediaType:this.props.mediaType,imageBoxRef:this.imageBoxRef,useS3Url:m.isIOS&&m.isMobileNative}}getRendererBySource(e){var t,o;return wt.getRenderer(e,null===(t=this.fileUploadStore.state)||void 0===t?void 0:t.dataURL,this.props.mediaType??(null===(o=this.getActionableStoreData())||void 0===o?void 0:o.getType()))}static hasRendererForStore(e){return p.Z.withListenerIgnored((()=>Boolean(wt.getRenderer(wt.getEmbedSourceFromBlockStore(e),void 0,e.getType()))))}static getRenderer(e,t,o){if(t)return St.image;if(e){if(e.startsWith("data:")||e.startsWith("<img"))return;const t=(0,f.Dz)({url:e,baseUrl:D.Z.domainBaseUrl,publicDomainName:D.Z.publicDomainName,preferredType:o});if("embed"!==t)return St[t]}return o&&e?St[o]:et}embedSource(e){const t=this.getActionableStoreData();if(!t)return;const o=F.qQ(this.environment);_.trackUrlPaste(this.environment,{pastedText:e,source:"embed_block_menu"});const i=z.default.createMetric("embed_render_complete");I.I(this.environment,{source:e,isDataURL:!1,store:t,pageWidth:o,preferredType:t.getType(),metric:i})}getActionableStoreData(){if("external_object_instance"!==this.props.store.getType()||(0,V.Xg)())return this.props.store}static actionButtonBackground(e){const{device:t}=e;return t.isMobile?h.ZP.blackWithAlpha(.3):h.ZP.blackWithAlpha(.6)}getPlaceholderContainerStyle(){const e={display:"flex"};return I.qC(this.props.blockLocation)&&(e.borderWidth=1,e.borderColor=this.theme.regularDividerColor,e.marginBottom=10,e.borderRadius=3),e}getContentWrapStyle(){const e={position:"relative"};return this.canEdit()&&(e.cursor="pointer"),this.props.centerWrappedContent&&(e.display="flex",e.justifyContent="center",e.alignItems="center",e.minHeight=220),e}getContentStyle(){const{dragging:e}=this.stores.blockResizerStore.state;return{display:"block",pointerEvents:e?"none":"auto",width:"100%"}}getResizeStyle(e,t){const o={position:"absolute",pointerEvents:this.shouldShowResizer()?"auto":"none",display:"flex",alignItems:"center",justifyContent:"center"};return t===we.bZ.Right?o.right=0:t===we.bZ.Left&&(o.left=0),e===we.IS.Horizontal?(o.top=0,o.zIndex=1,o.height="100%",o.width=wt.resizerWidth,o.cursor="col-resize"):e===we.IS.Vertical?(o.bottom=0,o.zIndex=1,o.width="100%",o.height=wt.resizerWidth,o.cursor="row-resize"):e===we.IS.Corner&&(o.zIndex=2,o.bottom=0,o.width=o.height=wt.cornerResizeSize,t===we.bZ.Left?o.cursor="nesw-resize":t===we.bZ.Right&&(o.cursor="nwse-resize")),o}getResizerInnerStyle(e){const{ThemeStore:t}=this.environment,o=t.state.mode,i={opacity:this.shouldShowResizer()?1:0,transition:wt.transition,borderRadius:20,background:h.se[o].black.alpha(.6).css(),border:`1px solid ${h.ZP.whiteWithAlpha(.9)}`};return e===we.IS.Horizontal?(i.width=6,i.height=48,i.maxHeight="50%"):e===we.IS.Vertical&&(i.height=6,i.width=48,i.maxWidth="50%"),i}getActionsStyle(){const{device:e}=this.environment,{focused:t,hovered:o}=this.stores.embedBlockStore.state,{isMobile:i}=e;return{position:"absolute",top:4,right:4,borderRadius:3,color:h.ZP.white,fill:h.ZP.white,fontSize:11.5,background:wt.actionButtonBackground(this.environment),display:"flex",whiteSpace:"nowrap",height:26,maxWidth:"calc(100% - 16px)",overflow:"hidden",pointerEvents:t||o||i?"auto":"none",opacity:t||o||i?1:0,transition:e.isSafari?void 0:wt.transition,fontFamily:S.Z.getCompositeFontFamily(u.SP).sans,zIndex:2}}getBlockAlignment(){const{block_alignment:e}=this.props.store.getFormat(),t=this.isRootOrDirectChild();return e||(t?"center":"left")}getAlignmentButtonStyle(e){let t=.6;return this.getBlockAlignment()===e&&(t=1),{width:26,height:26,opacity:t}}}wt.minWidthForActions=230,wt.alignmentIconMap={left:v.Z.alignLeft,center:v.Z.alignCenter,right:v.Z.alignRight},wt.resizerWidth=15,wt.resizerOffset=0,wt.cornerResizeSize=20,wt.actionButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",padding:"4px 6px",borderRight:`1px solid ${h.ZP.whiteWithAlpha(.2)}`},wt.hoveredActionButtonStyle={background:"rgba(255, 255, 255, 0.055)"},wt.centerPromptStyle={color:h.ZP.white,fontSize:14,fontFamily:S.Z.getCompositeFontFamily(u.SP).sans,padding:"0.3em 1.5em 0.3em",background:h.ZP.blackWithAlpha(.4),borderRadius:3},wt.transition="opacity 300ms ease-in";const kt=wt},86329:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(3779),s=o(68709),l=o(64921),c=o(68785),d=o(32854),p=o(40148);class u extends r.Z{renderComponent(){return this.props.isLoading?this.renderLoading():n()(s.p,{allowSelectionWithin:!1,style:this.getBackgroundStyle()},void 0,n()(l.Z,{onClick:this.props.onClick,disabled:this.props.disabled},void 0,n()(p.Z,{style:{background:void 0,...this.props.style},iconSvg:this.props.iconSvg||a.Z.compass,right:this.props.right},void 0,this.props.children)))}renderLoading(){const{file:e,name:t,size:o,progressPercent:i}=this.props;let r;return r=e?n()("div",{},"FileLoadingSpinner",t,n()("div",{style:p.Z.smallButtonStyle},void 0,n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()("div",{},void 0,o," ","–"," "),n()(c.Z,{style:{marginLeft:3,marginRight:3}}),n()(d.Z,{percentage:i})))):n()("div",{},"LoadingSpinner",n()(c.Z,{style:{marginLeft:3,marginRight:3}})),n()(p.Z,{style:this.props.style,iconSvg:this.props.iconSvg},void 0,r)}getBackgroundStyle(){return{background:this.theme.embedPlaceholderBackground,width:"100%",borderRadius:3}}}u.displayName="EmbedPlaceholder",u.captionStyle=p.Z.captionStyle;const m=u},38797:(e,t,o)=>{o.d(t,{tg:()=>P,Nm:()=>x,II:()=>B,pq:()=>Z,ZP:()=>D});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(8848),u=o(20039),m=o(15095),g=o(54153),h=o(5366),f=o(50906),v=o(17731),y=o(70177),b=o(33929),S=o(78609),w=o(29798),k=o(73657),C=o(9342),_=o(43145),M=o(72495),T=o(79920);const I=["💡","👉","☝","👌","🔑","🚧","⚠️","🔥","📌","✂️","❓","🚫","⛔","⏰","☎️","🚨","♻️","✅","🔒","📎","📖","🗣","➡️","📢","🛠","⚙"],P=9,x=2,B=12,Z=16,E=(0,h.defineMessages)({noResults:{defaultMessage:"No results",id:"emojiPicker.noResults.message"}});var R=!1;class A extends d.Z{constructor(){super(...arguments),this.filter="",this.splitFilter=[],this.storeTypes={menuListStore:w.Z},this.insertEmoji=e=>{this.props.onSubmit(e),this.addToRecentEmojis(e),this.props.iconLoggingData&&f.trackIconActions(this.environment,"pick_emoji",{icon:e,...this.props.iconLoggingData})},this.createCategory=e=>{let t=[];if(t="recent"===e.id?S.Z.state.recentEmojis||[]:"callout"===e.id?I:u.Mq[e.id],this.filter&&(t=this.filterAndSortEmojis(t)),0!==t.length)return{key:e.id,items:t.map((e=>this.getTonedEmojiIfSkinToneSet(e))).map(this.createListItem),render:t=>a()(M.Z,{isTitleUppercase:!0,title:e.title},t.key,a()("div",{style:this.getEmojiSectionWrapStyle()},void 0,t.children))}},this.createListItem=e=>{const t=m.Hk(e),o=void 0===(0,v.sg)()?m.yS(e):[];return{key:e,action:()=>{0===o.length&&this.insertEmoji(e)},render:i=>c.createElement(T.Z,n()({},i,{emoji:e,tooltip:t,variations:o,insertEmoji:this.insertEmoji}))}},this.removeSkinToneModifierIfSkinToneSet=e=>void 0===(0,v.sg)()?e:m.Gb(e),this.getTonedEmojiIfSkinToneSet=e=>{var t;const o=(0,v.sg)(),i=void 0!==o&&0!==o,n=null===(t=u.cv[e])||void 0===t?void 0:t.variations;return(null==n?void 0:n.length)===u.tN&&i?n[o-1]:e},this.handleScroll=e=>{if(e<A.loadMoreCategoryEdgeDistance){const{loadEmojiCount:e}=S.Z.state,t=Math.max(this.getNumIconsPerRow()*this.getNumRowsPerPage(),this.getAllSectionsEmojiCount());S.Z.setState({...S.Z.state,loadEmojiCount:Math.min(t,e+this.getNumIconsPerRow()*this.getNumRowsPerPage())})}}}willMount(e){super.willMount(e),S.Z.setState({...S.Z.state,loadEmojiCount:this.getNumIconsPerRow()*this.getNumRowsPerPage()}),S.Z.cleanupSkinTonedRecents((0,v.sg)()),this.loadEmojiData()}didUpdate(e){const{menuListStore:t}=this.stores;e.filter!==this.props.filter&&t.setState({...t.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}renderComponent(){const{menuListStore:e}=this.stores,t=this.getVisibleSections(this.getAllSections()),o=this.environment.device.isDesktop&&t.length>0?0:void 0;return 0===t.length&&(this.props.onNoResults&&this.props.onNoResults(),t.push({key:"no results",items:[{key:"no results",action:()=>{},render:(e,t)=>c.createElement(k.Z,n()({},e,{caption:b.default.formatMessage(E.noResults)}))}],render:e=>c.createElement(M.Z,e)})),a()("div",{style:A.wrapStyle},void 0,a()("div",{style:{flexGrow:1}},void 0,c.createElement(C.Z,n()({},this.getMenuListProps(),{store:e,initialFocus:o,sections:t,disableMouseLeaveBlur:!0,disableKeyboardArrowWrap:!0,unfocusOnScroll:this.environment.device.isMobile}))),a()(_.Z,{onChange:this.handleScroll}))}getNumIconsPerRow(){var e,t,o,i,n,r;const{device:a,WindowSizeStore:s}=this.environment;return a.isPhone?(window.innerWidth-s.getSafePaddingLeftPx(A.phonePaddingLeft)-s.getSafePaddingRightPx(A.phonePaddingRight))/T.Z.mobileButtonSize:a.isTablet?P:null!==(e=this.props)&&void 0!==e&&null!==(t=e.menuRef)&&void 0!==t&&null!==(o=t.current)&&void 0!==o&&o.offsetWidth?((null===(i=this.props)||void 0===i||null===(n=i.menuRef)||void 0===n||null===(r=n.current)||void 0===r?void 0:r.offsetWidth)-2*A.desktopPopupPaddingHorizontal)/T.Z.desktopButtonSize:12}getNumRowsPerPage(){return this.environment.device.isMobile?Z:B}async loadEmojiData(){await(0,y.L)(),this.loadUniqueKeywords()}loadUniqueKeywords(){if(!R){for(const e of Object.values(u.cv)){const t=null==e?void 0:e.keywords;e&&t&&(e.uniqueKeywords=l().uniq(t.flatMap((e=>e.split(" ")))))}R=!0}}addToRecentEmojis(e){const t=g.Z.get(S.W),o=l().uniq(l().union([this.removeSkinToneModifierIfSkinToneSet(e)],m.p4(t))),i=l().take(o,x*this.getNumIconsPerRow());g.Z.set(S.W,i.join("")),S.Z.setState({...S.Z.state,recentEmojis:i})}getAllSections(){this.filter=m.rJ(this.props.filter)??"",this.splitFilter=this.filter?this.filter.split(" ").filter(Boolean):[];const e=l().compact(this.getCategories().map(this.createCategory));return this.props.filter&&this.filter?this.getEmojiItemCount(e)>this.getNumIconsPerRow()*this.getNumRowsPerPage()/2?e:this.createFilteredSection():e}getAllSectionsEmojiCount(){const e=this.getAllSections();let t=0;for(const o of e)t+=o.items.length;return t}getEmojiItemCount(e){let t=0;for(const o of e)t+=o.items.length;return t}getVisibleSections(e){const{loadEmojiCount:t}=S.Z.state,o=[];let i=0;for(const n of e){if(!(i+n.items.length<=t)){o.push({...n,items:n.items.slice(0,t-i)});break}o.push(n),i+=n.items.length}return o}getCategories(){return l().compact([!this.props.filter&&{id:"recent",title:a()(h.FormattedMessage,{id:"emojiPicker.section.recent",defaultMessage:"Recent"})},this.props.isCallout?{id:"callout",title:a()(h.FormattedMessage,{id:"emojiPicker.section.callout",defaultMessage:"Callout"})}:void 0,{id:"People & Body",title:a()(h.FormattedMessage,{id:"emojiPicker.section.people",defaultMessage:"People"})},{id:"Animals & Nature",title:a()(h.FormattedMessage,{id:"emojiPicker.section.animals",defaultMessage:"Animals and nature"})},{id:"Food & Drink",title:a()(h.FormattedMessage,{id:"emojiPicker.section.food",defaultMessage:"Food and drink"})},{id:"Activities",title:a()(h.FormattedMessage,{id:"emojiPicker.section.activity",defaultMessage:"Activity"})},{id:"Travel & Places",title:a()(h.FormattedMessage,{id:"emojiPicker.section.travel",defaultMessage:"Travel and places"})},{id:"Objects",title:a()(h.FormattedMessage,{id:"emojiPicker.section.objects",defaultMessage:"Objects"})},{id:"Symbols",title:a()(h.FormattedMessage,{id:"emojiPicker.section.symbols",defaultMessage:"Symbols"})},{id:"Flags",title:a()(h.FormattedMessage,{id:"emojiPicker.section.flags",defaultMessage:"Flags"})}])}filterAndSortEmojis(e){const{filter:t,splitFilter:o}=this,i=l().compact(e.map((e=>{const i=u.cv[e],n=i&&i.keywords||[],r=t.length<3||t.includes(" ")?n:n.map((e=>e.replaceAll(" ",""))),a=r.findIndex((e=>e===`:${t}`));if(-1!==a)return[100-a,e];const s=r.findIndex((e=>e===t));if(-1!==s)return[10*(10-s),e];const l=r.findIndex((e=>e.startsWith(t)));if(-1!==l)return[10-l,e];if(o.length>1){const t=i&&i.uniqueKeywords||[];if(o.every((e=>t.find((t=>t.startsWith(e))))))return[o.length,e]}return r.some((e=>e.includes(t)))?[1,e]:void 0})));return l().sortBy(i,(e=>-e[0])).map((e=>e[1]))}createFilteredSection(){const e=this.filterAndSortEmojis(l().flatten(this.getCategories().map((e=>u.Mq[e.id]))));return 0===e.length?[]:[{key:"search-results",items:e.map((e=>this.getTonedEmojiIfSkinToneSet(e))).map(this.createListItem),render:e=>a()(M.Z,{},e.key,a()("div",{style:this.getEmojiSectionWrapStyle()},void 0,e.children))}]}getMenuListProps(){return{type:C.i.Grid,itemsPerRow:this.getNumIconsPerRow(),renderRow:(e,t)=>a()("div",{style:A.rowStyle},t,e)}}getEmojiSectionWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",flexWrap:"wrap",alignItems:"flex-start",...e.isPhone?{background:this.theme.popoverBackground,paddingTop:10,paddingBottom:10,paddingLeft:t.getSafePaddingLeftCSS(A.phonePaddingLeft),paddingRight:t.getSafePaddingRightCSS(A.phonePaddingRight),boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}:{background:p.ZP.transparent,paddingLeft:e.isTablet?A.tabletPopupPaddingHorizontal:A.desktopPopupPaddingHorizontal,paddingRight:e.isTablet?A.tabletPopupPaddingHorizontal:A.desktopPopupPaddingHorizontal}}}}A.displayName="EmojiPicker",A.loadMoreCategoryEdgeDistance=100,A.desktopPopupPaddingHorizontal=12,A.tabletPopupPaddingHorizontal=9,A.desktopPopupWidth=12*T.Z.desktopButtonSize+2*A.desktopPopupPaddingHorizontal,A.desktopPopupHeight=356,A.desktopEmojiPickerOnlyPopupWidth=A.desktopPopupWidth,A.desktopEmojiPickerOnlyPopupHeight=270,A.phonePaddingLeft=10,A.phonePaddingRight=2,A.wrapStyle={display:"flex",flexDirection:"column"},A.rowStyle={display:"flex"};const D=A},79920:(e,t,o)=>{o.d(t,{Z:()=>k});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(20039),d=o(17731),p=o(98742),u=o(61766),m=o(64921),g=o(31945),h=o(92059),f=o(1743),v=o(3386),y=o(9342),b=o(58032),S=o(43001);class w extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:u.Z},this.renderEmojiWithVariations=()=>{const{emoji:e,focused:t}=this.props,{buttonPopupStore:o}=this.stores;return a()(v.Z,{capture:t,onEnter:this.handleOpenMenu,onEsc:this.handleCloseMenu},e,a()(g.Z,{buttonPopupStore:o,popupType:g.Z.PopupType.Popup,renderOrigin:e=>this.renderSingleEmoji(e),render:this.renderVariationMenu}))},this.renderSingleEmoji=e=>{const{emoji:t,focused:o,onClick:i,onMouseEnter:r,tooltip:l}=this.props,{fontSize:c}=this.getButtonStyles();return a()(b.Z,{allowHover:Boolean(l),renderTooltip:()=>l,closeDelay:0,disableTooltip:!l,render:l=>s.createElement(m.Z,n()({key:t,focused:o,onClick:i},(0,p.Z)(e||{},(0,p.Z)({onMouseEnter:r},l)),{ignoreLocalHoverState:!0,style:this.styles.emojiButton}),a()(h.Z,{size:c,char:t}))})},this.renderVariationMenu=e=>{const{emoji:t,variations:o,insertEmoji:i}=this.props,r=(o&&o.length>0?[t,...o]:[t]).map(((t,r)=>({key:t,action:n=>{e.close(),(null==o?void 0:o.length)===c.tN&&(0,S.W)({environment:this.environment,skinTone:r}),i(t,r)},render:e=>s.createElement(w,n()({},this.props,e,{emoji:t,variations:void 0}))})));return a()(f.Z,{capture:!0,allowEsc:!0},void 0,a()(y.Z,{type:y.i.Horizontal,initialFocus:0,sections:[{key:"variations",render:this.renderVariationWrapper,items:r}]}))},this.renderVariationWrapper=e=>s.createElement("div",n()({style:this.styles.variationMenu},e)),this.handleOpenMenu=e=>{e.preventDefault();const{buttonPopupStore:t}=this.stores;t.setState({...t.state,open:!0})},this.handleCloseMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState({...e.state,open:!1})},this.styles={emojiButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,...this.getButtonStyles()},variationMenu:{display:"flex",padding:4}}}renderComponent(){const{variations:e}=this.props;return void 0===(0,d.sg)()&&e&&e.length>0?this.renderEmojiWithVariations():this.renderSingleEmoji()}getButtonStyles(){const{device:e}=this.environment;return e.isMobile?{width:w.mobileButtonSize,height:w.mobileButtonSize,fontSize:w.mobileFontSize}:{width:w.desktopButtonSize,height:w.desktopButtonSize,fontSize:w.desktopFontSize}}}w.displayName="EmojiPickerMenuItem",w.desktopButtonSize=32,w.desktopFontSize=24,w.mobileButtonSize=44,w.mobileFontSize=32;const k=w},43001:(e,t,o)=>{o.d(t,{Z:()=>M,W:()=>T});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(20039),p=o(5366),u=o(30149),m=o(37181),g=o(98742),h=o(79315),f=o(61766),v=o(78609),y=o(31945),b=o(1743),S=o(68894),w=o(3386),k=o(9342),C=o(58032),_=o(79920);function M(){window.__c={n:"EmojiPickerSkinTonePicker"};const e=(0,c.VK)((()=>{var e,t,o;return null===(e=h.default.state)||void 0===e||null===(t=e.currentUserSettingsStore)||void 0===t||null===(o=t.getSettings())||void 0===o?void 0:o.emoji_picker_skin_tone}),[]),t=(0,l.O7)(),[,,o]=(0,c.AF)(void 0,f.Z);return a()(w.Z,{capture:!0,onEnter:()=>o.setState({open:!0}),onEsc:()=>o.setState({open:!1})},void 0,a()(C.Z,{renderTooltip:()=>a()(p.FormattedMessage,{defaultMessage:"Select skin tone",id:"emojiPickerSkinTonePicker.selectSkinTone",description:"Button in Emoji picker, that when pressed, lets the user select a default skin tone for their emoji, so they don't have to select a skin tone each time."}),placement:C.Z.Placement.Bottom,render:i=>s.createElement(y.Z,n()({buttonPopupStore:o,popupType:y.Z.PopupType.Popup,preventBlockRenderQueueOnEnter:!0,renderOrigin:t=>s.createElement(S.DO,n()({icon:()=>a()("div",{style:{paddingRight:6}},void 0,void 0!==e?d.YN[e]:"✋"),style:{fontSize:20}},(0,g.Z)(t,i))),render:o=>function(e){window.__c={n:"renderSkinToneMenu"};const{parent:t,environment:o,currentSkinTone:i}=e,r=d.YN.map(((e,i)=>({key:e,action:()=>{t.close(),T({environment:o,skinTone:i})},render:t=>s.createElement(_.Z,n()({},t,{insertEmoji:()=>{},emoji:e,variations:void 0,tooltip:void 0}))})));return a()(b.Z,{capture:!0,allowEsc:!0},void 0,a()(k.Z,{type:k.i.Horizontal,initialFocus:i,sections:[{key:"variations",render:e=>s.createElement("div",n()({style:{display:"flex",padding:4}},e)),items:r}]}))}({parent:o,environment:t,currentSkinTone:e})},i))}))}function T(e){const{environment:t,skinTone:o}=e,{currentUserSettingsStore:i}=h.default.state;i&&(void 0!==o&&v.Z.cleanupSkinTonedRecents(o),u.createAndCommit({userAction:"mediaPicker.setEmojiSkinTone",environment:t,perform:e=>{m.d2({userSettingsStore:i,transaction:e,data:{emoji_picker_skin_tone:o}})}}))}},3702:(e,t,o)=>{o.d(t,{Z:()=>P});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(13991),u=o(8848),m=o(3779),g=o(7091),h=o(70203),f=o(82990),v=o(5366),y=o(50906),b=o(83631),S=o(33665),w=o(49312),k=o(42922),C=o(36488),_=o(16354),M=o(44532),T=o(22492);class I extends d.Z{constructor(){super(...arguments),this.input=c.createRef(),this.renderPopup=()=>{const{isOpen:e}=this.props,t=this.getThemeColors(),o={...this.styles.popupInputForm,...t.popupInputForm},i=a()("div",{style:o},void 0,this.renderInput(),this.renderPopupSubmitButton());return a()(C.Z,{capture:e,allowEsc:!0,render:()=>this.getPopupType()===M.ZP.PopupType.SlideUp?a()(c.Fragment,{},void 0,this.renderMobilePreview(),i):a()(c.Fragment,{},void 0,i,this.renderEquationError())})},this.handleInputChange=e=>{const{isOpen:t,onChange:o,displayMode:i}=this.props;t&&o(e,b.by({environment:this.environment,equation:e,displayMode:i}))},this.handleSubmit=e=>{const{isOpen:t,disabled:o,error:i,onSubmit:n,onDismiss:r}=this.props;e.preventDefault&&e.preventDefault(),o||t&&(i||(n(),r()))},this.getHighlightedHtml=e=>{const{Prism:t}=this.props;return t.highlight(l().unescape(e),t.languages[g.PrismLanguages.latex],g.PrismLanguages.latex)},this.styles={popup:{width:400,display:"flex",flexDirection:"column"},popupInputForm:{display:"flex",alignItems:"center",padding:"8px 10px",width:"100%"},mobilePreview:{padding:"4px 8px",height:80,display:"flex",alignItems:"center",justifyContent:"center"},mobilePreviewValue:{overflow:"auto"},equationInput:{fontFamily:f.Z.getCompositeFontFamily(p.SP).mono,fontSize:14,marginRight:8,flex:1,wordBreak:"break-word",maxHeight:"50vh",overflow:"auto"},equationInputBlock:{minHeight:60},equationInputSlideUp:{height:100},submitButton:{alignSelf:"flex-start"},enterIcon:{height:14,width:14,fill:"currentColor",marginLeft:6,marginTop:2},errorContainer:{color:u.ZP.redWithAlpha(.8),fontSize:12,padding:"8px 10px"},errorLabel:{fontWeight:600},learnMoreLink:{display:"inline",textDecoration:"underline"}}}didMount(){this.environment.KatexStore.loadIfNeeded((()=>[(0,h.qZ)("")]))}getSelection(){if(!this.input)return;if(!this.input.current)return;const e=this.input.current.getSelection();return"contain"===(null==e?void 0:e.type)?e.selection:void 0}renderComponent(){const{isOpen:e,onDismiss:t,origin:o,originRect:i,originGap:n,popupStyle:r}=this.props,s=this.getPopupType();return a()(M.ZP,{popupType:s,open:e,origin:o,originRect:i,originGap:n,keepFocus:s===M.ZP.PopupType.SlideUp,onDismiss:t,style:{...this.styles.popup,...r},render:()=>this.renderPopup()})}renderInput(){const{disabled:e,isOpen:t,equationValue:o,onLeft:i,onRight:r,onDismiss:a,displayMode:s}=this.props,l=this.getThemeColors(),d=this.getPopupType()===M.ZP.PopupType.SlideUp,p=!e&&!d,u=d?{type:w.b.Textarea}:{type:w.b.InlineWrap,onSubmit:this.handleSubmit},m={...this.styles.equationInput,..."block"===s&&this.styles.equationInputBlock,...d&&this.styles.equationInputSlideUp},g={...m,...l.equationInputPlaceholder};return c.createElement(w.Z,n()({ref:this.input},u,{disabled:e,focus:t,selectAll:p,value:o||"",placeholder:this.getPlaceholderEquation(),getHtml:this.getHighlightedHtml,onChange:this.handleInputChange,onCancel:a,onLeft:i,onRight:r,placeholderStyle:g,style:m,autoCorrect:"off",autoCapitalize:"off"}))}getPlaceholderEquation(){const{displayMode:e}=this.props;return"block"===e?"|x| = \\begin{cases}             \n  x, &\\quad x \\geq 0 \\\\           \n -x, &\\quad x < 0             \n\\end{cases}":"E = mc^2"}renderPopupSubmitButton(){const{error:e,disabled:t}=this.props;if(!t)return a()(k.Z,{onClick:this.handleSubmit,disabled:t||Boolean(e),style:this.styles.submitButton},void 0,a()(v.FormattedMessage,{defaultMessage:"Done",id:"equationInput.submitButton.label",description:"Button to submit the equation input field, and update the selected text to the new equation value"}),m.Z.enter(this.styles.enterIcon))}renderEquationError(){if(!this.props.isOpen)return;const{error:e}=this.props,t=this.getPopupType()===M.ZP.PopupType.Popup;if(!e)return;const o=e.message.replace("KaTeX parse error: ",""),i={...this.styles.errorContainer,...t&&this.getThemeColors().errorContainerDesktop};return a()("div",{role:"alert",style:i},void 0,a()("span",{style:this.styles.errorLabel},void 0,a()(v.FormattedMessage,{defaultMessage:"Invalid equation:",id:"equationInput.inputError.label",description:"Label preceding the error message returned by the equation parser"}))," ",o,". ",a()(_.Z,{href:(0,S.UY)("guides.equations"),external:!0,onClick:()=>{y.trackClickHelpButton(this.environment,{from:"equation_input"})},style:this.styles.learnMoreLink},void 0,a()(v.FormattedMessage,{defaultMessage:"Learn more",id:"equationInput.inputError.learnMore",description:"Link to help center guide on equations"})))}renderMobilePreview(){const{equationValue:e,error:t,displayMode:o}=this.props;if(e)return a()("div",{style:this.styles.mobilePreview},void 0,t?this.renderEquationError():a()(T.Z,"block"===o?{display:o,equation:e,style:this.styles.mobilePreviewValue,theme:this.theme}:{display:o,equation:e,style:this.styles.mobilePreviewValue,theme:this.theme,index:0,isTemporary:!1}))}getPopupType(){const{device:e}=this.environment,t=e.isPhone&&e.isIOS&&e.isMobileBrowser;return e.isPhone&&!t?M.ZP.PopupType.SlideUp:M.ZP.PopupType.Popup}getThemeColors(){return{popupInputForm:{background:this.theme.inputBackground},errorContainerDesktop:{boxShadow:`0 -1px ${this.theme.lightDividerColor}`},equationInputPlaceholder:{color:this.theme.lightTextColor}}}}I.displayName="EquationInputPopup";const P=I},22492:(e,t,o)=>{o.d(t,{Z:()=>g});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(83355),c=o(98923),d=o(5366),p=o(83631),u=o(77907);class m extends l.Z{didMount(){super.didMount(),p.bc()}renderComponent(){return n()(u.DependencyConsumer,{dependency:u.deps.katex},void 0,(e=>s.createElement(c.MW,a()({katex:e},this.props))))}}m.displayName="EquationValue";const g=(0,d.injectIntl)(m)},79603:(e,t,o)=>{o.d(t,{mS:()=>U,Ub:()=>z,Pp:()=>W});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(480),p=o(81954),u=o(24405),m=o(8848),g=o(33728),h=o(12174),f=o(3779),v=o(82990),y=o(5366),b=o(57400),S=o(95477),w=o(60709),k=o(79315),C=o(10161),_=o(7339),M=o(52275),T=o(31945),I=o(36488),P=o(74194),x=o(68785),B=o(78140),Z=o(9342),E=o(63296),R=o(74136),A=o(89728),D=o(72495),F=o(64369),L=o(27386),V=o(23189),N=o(40235);const O="janus";function U(){var e;if("local"===S.Z.env)return!0;const t=null===(e=k.default.state.currentUserStore)||void 0===e?void 0:e.getEmail();return"makenotion.com"===(0,g.Gd)(t??"")||"on"===C.default.getGroup(O)}function H(e){return[...C.default.getExperiments(),...e?h.l4.map((e=>({experimentId:e,experimentVersion:1,group:C.default.getEligibleGroup({experimentId:e,defaultGroup:h.nb}),groups:[...(0,h._n)(e),"control",h.nb],fromStatsig:!0,statsigOption:"EXPERIMENT"}))):[],...e?h.b2.map((e=>({experimentId:e,experimentVersion:1,group:C.default.checkGate(e).toString(),groups:["true","false"],fromStatsig:!0,statsigOption:"FEATUREGATE"}))):[]]}function z(e){window.__c={n:"ExperimentSettings"};const t=(0,d.O7)(),[o,i]=(0,c.useState)(""),[r,s]=(0,c.useState)(void 0),g="production"!==S.Z.env&&C.default.isStatsigEnabled(),k=(0,p.VK)((()=>r?[]:H(g).filter((e=>e.experimentId!==O&&(!o||0===o.length||e.experimentId.includes(o)))).sort(((e,t)=>e.experimentId>t.experimentId?1:-1))),[o,g,r]),{device:I}=t,L=I.isMobile,U=(0,u.yK)((e=>({containerStyle:{width:"100%"},headerContainerStyle:{display:"flex",alignItems:"flex-start",cursor:"pointer",width:"100%",flexWrap:"wrap"},headerLabelStyle:{marginTop:2,marginBottom:12,padding:2,flex:1},filterContainerStyle:{paddingBottom:"12px"},resetButtonContainerStyle:{paddingBottom:"12px"},tableExperimentIDHeaderStyle:{width:"auto"},tableExperimentGroupHeaderStyle:{width:"auto",textAlign:"right"},experimentInfo:{display:"flex",flexDirection:L?"column":"row"},experimentId:{marginRight:5,maxWidth:L?215:300,...v.Z.textOverflowStyle},experimentGroupContainerStyle:{width:"100%",display:"flex",justifyContent:"flex-end"},experimentGroupButtonStyle:{overflowX:"hidden",justifyContent:"left"},experimentGroup:{maxWidth:L?90:300,...v.Z.textOverflowStyle},experimentGroupButtonChevronStyle:{width:10,marginLeft:4,fill:e.lightIconColor},experimentGroupButtonCheckContainerStyle:{width:L?16:14}})),[L]);return a()("div",{style:U.containerStyle},void 0,a()(V.Z,{large:!0,style:{fontSize:16,fontWeight:500}},void 0,"Experiments"),a()("div",{style:U.headerContainerStyle},void 0,a()(F.Z,{isSmall:!0,isMultiline:!0,style:U.headerLabelStyle},void 0,"Toggle experiments for yourself. This only works for experiments that are based on userId or deviceId. For debugging statsig experiments in production, or statsig experiments on the server-side, you should go to console.statsig.com."),a()("div",{style:U.resetButtonContainerStyle},void 0,a()(E.Z,{isSmall:!0,onClick:()=>{s({reset:!0}),_.C.removeAllLocalOverrides(),b.Of(t).then((()=>{s(void 0)}))}},void 0,null!=r&&r.reset?a()(x.Z,{}):"Reset to defaults"))),a()("div",{style:U.filterContainerStyle},void 0,a()(P.Z,{placeholder:"Filter by experiment ID or Feature Gate Name...",value:o,showClearButton:!0,autoCapitalize:"off",autoComplete:"off",onChange:e=>{i(e.target.value)}})),a()(N.Z,{columns:[{key:"name",header:"Experiment ID or Feature Gate Name",style:U.tableExperimentIDHeaderStyle},{key:"group",header:"Group",style:U.tableExperimentGroupHeaderStyle}],rows:k.map((e=>{const o=e.group,i=g&&"fromStatsig"in e&&e.fromStatsig,d=i&&"FEATUREGATE"===e.statsigOption,p=i&&"EXPERIMENT"===e.statsigOption;return{key:i?`statsig:${e.experimentId}`:e.experimentId,columns:[a()("div",{style:U.experimentInfo},void 0,a()("span",{style:U.experimentId},void 0,e.experimentId),i&&a()(R.Z,{},void 0,`Statsig ${e.statsigOption}`)),a()("div",{style:U.experimentGroupContainerStyle},void 0,a()(T.Z,{popupType:I.isMobile?T.Z.PopupType.SlideUp:T.Z.PopupType.Popup,renderOrigin:t=>c.createElement(A.Z,n()({},t,{key:e.experimentId,style:U.experimentGroupButtonStyle}),a()("span",{style:U.experimentGroup},void 0,o??"unknown"),f.Z.chevronDown(U.experimentGroupButtonChevronStyle)),render:u=>{let g;g=I.isMobile?{menuType:w.og.Modal,title:e.experimentId,right:a()(y.FormattedMessage,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:u.close}:{menuType:w.og.Popup,width:250};const v=e.groups.map((g=>({key:g,action:o=>{let i;i=p?new Promise((t=>{_.C.updateLocalOverrideConfig(e.experimentId,g),t(g)})):d?new Promise((t=>{_.C.updateLocalOverrideGate(e.experimentId,g),t(g)})):b.BX(t,e.experimentId,g),s({experimentId:e.experimentId,group:g}),i.then((()=>{s(void 0),l().delay((()=>{u.close()}),1e3)}))},render:(t,s)=>{const l=i&&g===h.nb;return c.createElement(M.Z,n()({},t,{title:g,right:r&&r.experimentId===e.experimentId&&r.group===g?a()("div",{style:U.experimentGroupButtonCheckContainerStyle},void 0,a()(x.Z,{})):g!==o||r?void 0:a()("div",{style:U.experimentGroupButtonCheckContainerStyle},void 0,f.Z.check()),disabled:l,style:{...l&&{color:m.ZP.mediumTextColor}}}))}})));return c.createElement(B.Z,g,a()(Z.Z,{type:Z.i.Vertical,initialFocus:void 0,sections:[{key:e.experimentId,render:e=>c.createElement(D.Z,e),items:v}]}))}}))]}}))}))}function W(e){window.__c={n:"ExperimentSettingsSection"};const t=(0,u.yK)((e=>({headerLabelStyle:{marginTop:2,width:"80%"},PlainButtonStyle:{marginTop:12,marginBottom:4}})),[]);return a()("div",{},void 0,a()(V.Z,{},void 0,"Experiments"),a()(F.Z,{isSmall:!0,isMultiline:!0,style:t.headerLabelStyle},void 0,"Locally toggle experiments."),a()(T.Z,{popupType:T.Z.PopupType.SlideUp,renderOrigin:e=>c.createElement(E.Z,n()({},e,{isLarge:!0,style:t.PlainButtonStyle}),"View Experiments"),render:e=>{const t={menuType:w.og.Modal,whiteBackground:!0,title:"Experiments",right:a()(y.FormattedMessage,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:e.close};return a()(I.Z,{capture:!0,allowEsc:!0,render:()=>c.createElement(B.Z,t,a()(L.Z,{disableScroller:!0},void 0,a()(z,{})))})}}))}},95030:(e,t,o)=>{o.d(t,{Z:()=>y});var i=o(77094),n=o.n(i),r=o(67294),a=o(62518),s=o(480),l=o(98742),c=o(3386),d=o(44532);const p=()=>{const[e,t]=r.useState({x:0,y:0});return r.useEffect((()=>{const e=e=>{t({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[]),e},u=e=>{let{x:t,mouseX:o}=e;return o>t?void 0:-Math.max(t-o,10)+"px"},m=e=>{let{x:t,width:o,mouseX:i}=e;return i>t?-Math.max(i-(t+o),10)+"px":void 0},g=e=>{let{x:t,width:o,mouseX:i}=e;return i>t?`${Math.max(i-(t+o),10)}px`:`${Math.max(t-i,10)}px`},h=e=>{let{x:t,y:o,height:i,mouseX:n,mouseY:r}=e;return n>t?`polygon(0% 0%, 0% 100%, 100% ${100*(r-o)/i}%)`:`polygon(100% 0%, 0% ${100*(r-o)/i}%, 100% 100%)`};function f(e){window.__c={n:"ExtensionMenuSafeArea"};const{x:t=0,y:o=0,height:i=0,width:r=0}=e.el.getBoundingClientRect()||{},{x:a,y:s}=p(),l={x:t,y:o,height:i,width:r,mouseX:a,mouseY:s},c={right:m(l),left:u(l),height:i,width:g(l),clipPath:h(l)};return n()("div",{style:{cursor:"pointer",position:"absolute",top:0,...c}})}function v(e,t){let{onClick:o,renderOrigin:i,renderExtension:p,...u}=e;window.__c={n:"ExtensionMenuItem"};const{disableDefaultClick:m,onFocus:g,focused:h,openOnFocus:v}=u,y=(0,s.Fy)(),[b,S]=(0,r.useState)(!1),w=(0,r.useRef)(null),k=(0,r.useRef)(null),C=(0,r.useRef)(null),_=(0,r.useRef)(null),M=(0,r.useCallback)((()=>{C.current&&window.clearTimeout(C.current),_.current&&window.clearTimeout(_.current),C.current=null,_.current=null}),[]),T=(0,r.useCallback)((()=>{M(),b||S(!0)}),[b,M]),I=(0,r.useCallback)((()=>{M(),b&&S(!1)}),[b,M]),P=(0,r.useCallback)((e=>{M(),b||(e&&e.preventDefault&&e.preventDefault(),C.current=window.setTimeout(T,120))}),[b,M,T]),x=(0,r.useCallback)((()=>{M(),b&&(_.current=window.setTimeout(I,100))}),[b,I,M]),B=(0,r.useCallback)((()=>{g(),T()}),[g,T]),Z=(0,r.useCallback)((e=>{P()}),[P]),E=(0,r.useCallback)((e=>{g(),P()}),[g,P]),R=(0,r.useCallback)((e=>{if(y.isPhone)return;const t=a.findDOMNode(w.current);b&&t&&!t.contains(e.target)&&I()}),[b,I,y.isPhone]),A=(0,r.useCallback)((e=>{13===e.keyCode&&b&&I()}),[b,I]);(0,r.useEffect)((()=>{if(!Boolean(m))return window.addEventListener("click",R),()=>{window.removeEventListener("click",R)}}),[m,R]),(0,r.useEffect)((()=>(window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)})),[A]);const D=(0,r.useRef)(h);(0,r.useEffect)((()=>{v&&!D.current&&h?P():h||x(),D.current=h}),[h,v,P,x]);const F={...(0,l.Z)({onMouseEnter:Z,onClick:B},u),showExtensionArrow:!0};return n()(c.Z,{capture:h,onEnter:b?void 0:P,onRight:P,onLeft:b?x:void 0,onEsc:b?x:void 0},void 0,r.createElement(d.ZP,{popupType:y.isPhone?d.ZP.PopupType.SlideUp:d.ZP.PopupType.Popup,open:b,origin:i(F,t),placementToOrigin:d.ZP.Placement.Right,alignmentToOrigin:d.ZP.Alignment.Center,originGap:0,disableMouseCapture:!0,preventBlockRenderQueueOnEnter:!0,preventScaleTransition:!y.isPhone,preventCaptureEsc:!0,ref:w,render:()=>r.createElement(r.Fragment,null,k.current&&n()(f,{el:k.current}),r.createElement("div",{ref:k},p({onMouseEnter:E},{close:x}))),style:{overflow:"visible"},trapFocus:!0}))}const y=r.forwardRef(v)},40662:(e,t,o)=>{o.d(t,{Z:()=>q});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(81954),d=o(24405),p=o(8848),u=o(3779),m=o(5500),g=o(82990),h=o(5366),f=o(95182),v=o(50906),y=o(77719),b=o(42858),S=o(30149),w=o(761),k=o(70764),C=o(41232),_=o(33929),M=o(79315),T=o(30874),I=o(31194),P=o(1634),x=o(64921),B=o(31945),Z=o(51077),E=o(89728),R=o(480),A=o(43132),D=o(47307),F=o(5978),L=o(60709),V=o(33665),N=o(52275),O=o(78140),U=o(9342),H=o(72495);const z=(0,h.defineMessages)({copiedDebuggingInfo:{id:"externalObjectBlock.errorDropdown.copiedDebuggingInfo",defaultMessage:"Copied to clipboard.",description:"Displays in tiny modal after clicking 'copy debugging info' to let the user know the information is copied to their clipboard."}});function W(e){window.__c={n:"ExternalObjectInstanceErrorMenu"};const{state:t,store:o,onUpdate:i,onReplace:r,onAuthenticate:l,onRemove:m,description:g,statusCode:f,errorDescription:y,isInlineMenu:b}=e,{userHasBotForIntegration:S,pattern:w,integration:k,botIds:C,originalUrl:_}=t,T=(0,R.Fy)(),I=(0,R.O7)(),P=(0,d.yK)((e=>({menuIcon:{fill:e.regularIconColor,width:16},redThemeColor:(0,p.fi)("red",e)})),[]),x=(0,c.VK)((()=>{var e;return Boolean(null===(e=M.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit())}),[]),B=(0,c.VK)((()=>o.isExternalObjectInstanceBlockStore()),[o]);let E;E=T.isMobile?{menuType:L.og.ActionSheet}:{menuType:L.og.Popup,minWidth:220};const W={key:"remove",render:e=>s.createElement(N.Z,n()({title:a()(h.FormattedMessage,{defaultMessage:"Remove",id:"unfurling.errorOptions.removeAction.title"}),style:{color:P.redThemeColor.color},icon:u.Z.trash({fill:P.redThemeColor.fill,width:16})},e)),action:()=>{null==m||m()}},j={key:"replace",render:e=>s.createElement(N.Z,n()({title:a()(h.FormattedMessage,{defaultMessage:"Change URL",id:"unfurling.errorOptions.replace.title"}),icon:u.Z.sync(P.menuIcon)},e)),action:()=>{r()}},K={key:"update",render:e=>s.createElement(N.Z,n()({title:a()(h.FormattedMessage,{defaultMessage:"Try again",id:"unfurling.errorOptions.tryAgainAction.title"}),icon:u.Z.sync(P.menuIcon)},e)),action:()=>{null==i||i()}},Y={key:"authenticate",render:e=>s.createElement(N.Z,n()({title:a()(h.FormattedMessage,S?401===f?{defaultMessage:"Re-authenticate account",id:"unfurling.errorOptions.authenticateAction.reAuthenticate.title",description:"Prompt for user to re-connect their third-party account"}:b?{defaultMessage:"Connect a different account",id:"unfurling.errorOptions.authenticateAction.alreadyAuthenticatedCompact.title",description:"Prompt for user to connect a different third-party account"}:{defaultMessage:"Connect a different {integration} account",id:"unfurling.errorOptions.authenticateAction.alreadyAuthenticated.title",values:{integration:k.name}}:{defaultMessage:"Connect {integration} account",id:"unfurling.errorOptions.authenticateAction.notAuthenticated.title",values:{integration:k.name}}),icon:a()(Z.Z,{type:"image_url",imageURL:k.icon,size:16})},e)),action:()=>{null==l||l()}},G=[{key:"learn",render:e=>s.createElement(N.Z,n()({title:a()(h.FormattedMessage,{defaultMessage:"Learn more about this error",id:"unfurling.errorOptions.learnMore.title"}),icon:u.Z.helpButtonGuide(P.menuIcon)},e)),action:()=>{D.showDialog({items:[{label:a()(h.FormattedMessage,{id:"externalObjectInstanceBlockErrorDropdown.dialogItem.reviewGuide",defaultMessage:"View guide"}),color:"blue",onAccept:()=>{F.navigateToExternalURL({environment:I,url:(0,V.UY)("guides.unfurling")}),v.trackOpenLinkPreviewHelpGuide(I,{integrationId:k.id,entity:null==w?void 0:w.name,statusCode:f})}},{label:a()(h.FormattedMessage,{id:"externalObjectInstanceBlockErrorDropdown.dialogItem.copyDebugData",defaultMessage:"Copy debugging information",description:"When a link preview fails, the user can click this button to copy debugging information to their clipboard to send to support."}),color:void 0,onAccept:()=>{const e={statusCode:f,integrationId:k.id,botIds:C,url:_,debugMessage:y};A.RD({environment:I,stringValue:JSON.stringify(e,null,2),copiedMessage:z.copiedDebuggingInfo})}}],showCancel:!0,keepFocus:!1,message:g})}}];return x&&("error"===t.type?G.push(j):("placeholder"===t.type?G.push(j):G.push(K),B&&G.push(Y))),m&&G.push(W),s.createElement(O.Z,E,a()(U.Z,{type:U.i.Vertical,initialFocus:b?void 0:0,sections:[{key:0,render:e=>s.createElement(H.Z,n()({},e,{disableDesktopPadding:b,title:a()(h.FormattedMessage,{defaultMessage:"Try these options",id:"unfurling.errorOptions.menuTitle"})})),items:G}]}))}var j=o(69255);class K extends l.Z{constructor(){super(...arguments),this.renderComponent=()=>{var e;const t=this.stateStore.state;if(!t)return;const{integration:o,action:i}=t,{r,g:l,b:c}=o.accentColor,d=`rgba(${r},${l},${c},${this.isInDarkMode()?.6:1})`,u=Boolean(null===(e=M.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()),m={state:t,store:this.props.store,onUpdate:()=>{this.handleUpdateClick({from:"external_object_instance_block_error_dropdown"})},onAuthenticate:()=>{this.handleAuthenticateClick({from:"external_object_instance_block_error_dropdown"})},onReplace:()=>{var e,t;null===(e=(t=this.props).openPlaceholderMenu)||void 0===e||e.call(t)}},g={...m,onRemove:()=>{this.handleRemove()}};return s.createElement(s.Fragment,null,"authenticate"===i&&(0,k.sw)(this.environment)&&u&&a()(E.Z,{icon:e=>a()(Z.Z,{type:"image_url",imageURL:o.accentIcon,size:20,style:{...e,width:16,height:16,marginRight:8,marginLeft:2}}),onClick:()=>this.handleAuthenticateClick({from:"external_object_instance_block"}),style:{...this.getActionButtonStyle(),background:d,fontSize:14,height:32,paddingRight:12,color:this.isInDarkMode()?this.theme.regularTextColor:this.theme.regularInvertedTextColor},hoveredStyle:{background:(0,p._j)(d,.4)},pressedStyle:{background:(0,p._j)(d,.9)}},void 0,a()(h.FormattedMessage,{defaultMessage:"Connect to {integration} to update",id:"unfurling.authenticateButton.title",values:{integration:t.integration.name}})),"update"===i&&this.renderUpdateAction(),"error"===i&&(this.props.isHoverPreview?s.createElement(X,m):s.createElement(G,n()({},g,{style:this.getActionButtonStyle()}))),!i&&this.props.renderDefaultAction?this.renderDefaultAction():null)},this.handleAuthenticateClick=e=>{var t,o,i,n;let{from:r}=e;const a=null===(t=this.stateStore.state)||void 0===t?void 0:t.originalUrl,{currentSpaceStore:s}=M.default.state;if(!s)return;const l=null===(o=(0,C.GQ)(a,s.id))||void 0===o?void 0:o.integration;l&&a&&(y.h({environment:this.environment,integration:l,spaceId:s.id,unfurlUrl:a,externalObjectInstanceBlockId:this.props.store.id,from:r}),P.Z.reset(),null===(i=(n=this.props).postActionCallback)||void 0===i||i.call(n))},this.handleUpdateClick=e=>{var t,o,i;let{from:n}=e;const r=null===(t=M.default.state.currentSpaceStore)||void 0===t?void 0:t.id;r&&(w.qK({environment:this.environment,from:n,store:this.props.store,spaceId:r,bypassCache:"external_object_instance_block_error_dropdown"===n}),null===(o=(i=this.props).postActionCallback)||void 0===o||o.call(i))},this.stateStore=this.createComputedStore((()=>(0,C._l)({store:this.props.store,isInDarkMode:this.isInDarkMode(),canEdit:this.props.canEdit,currentUserId:this.environment.currentUser.id,showAction:this.props.forceActionForUIDoc})),!0)}renderDefaultAction(){const e=this.environment,{isMobile:t}=e.device,o={blocks:[this.props.store],environment:e,publicEditMode:void 0};return a()(B.Z,{popupType:t?B.Z.PopupType.SlideUp:B.Z.PopupType.Popup,renderOrigin:e=>s.createElement(x.Z,n()({},e,{mobileFeedback:t,style:{display:"flex",alignItems:"center",justifyContent:"center",width:t?36:28,height:t?36:28,borderRadius:3,flexShrink:0,opacity:"shown"===this.props.renderDefaultAction?1:0,...this.getActionButtonStyle()}}),u.Z.dots({width:t?18:14,color:this.theme.mediumIconColor})),placementToOrigin:I.Iw.Bottom,render:e=>{return a()(j.Z,{titleForReloadMenuOption:a()(h.FormattedMessage,{id:"linkPreview.reload",defaultMessage:"Reload preview",description:"Menu option to reload link preview block"}),store:this.props.store,onAccept:()=>e.close(),extraSecondaryItems:[(t=f.OH,{key:t.key,render:(e,i)=>t.render(e,o,{onFocus:i.onFocus}),action:e=>{let{event:i}=e;return t.action(o,i)}})]});var t}})}renderUpdateAction(){const e=a()(E.Z,{onClick:()=>this.handleUpdateClick({from:"external_object_instance_block"}),style:this.getActionButtonStyle(),icon:e=>u.Z.sync({...e})},void 0,a()(h.FormattedMessage,{defaultMessage:"Update",id:"unfurling.updateButton.title"}));return this.props.isHoverPreview?s.createElement(s.Fragment,null,a()("div",{style:{display:"flex",alignItems:"center",fontSize:g.Z.fontSize.UIRegular.desktop,marginBottom:4}},void 0,u.Z.info({width:18,height:18,marginRight:6}),a()("span",{},void 0,a()(h.FormattedMessage,{defaultMessage:"This link preview is out-of-date.",id:"unfurling.updateButton.header",description:"Message that a link-preview is out of date and should be updated."}))),e):e}handleRemove(){var e,t;S.createAndCommit({userAction:"ExternalObjectInstanceAction.handleRemove",environment:this.environment,perform:e=>{b.Cl({environment:this.environment,blocks:[this.props.store],transaction:e})}});const o=this.stateStore.state;var i;o&&v.trackRemoveLinkPreviewWithError(this.environment,{integrationId:o.integration.id,entity:null===(i=o.pattern)||void 0===i?void 0:i.name});null===(e=(t=this.props).postActionCallback)||void 0===e||e.call(t)}isInDarkMode(){return"dark"===this.environment.ThemeStore.state.mode}getActionButtonStyle(){return{marginRight:4,color:this.theme.mediumTextColor,...this.props.buttonStyle}}}function Y(e){const t=(0,c.VK)((()=>{var t,o;return e.isCollectionView()?null===(t=e.getCollectionViewCollectionStore())||void 0===t||null===(o=t.getFormat().error)||void 0===o?void 0:o.status_code:e.getFormatStore().getKeyStore("error").getKeyStore("status_code").getValue()}),[e]),o=(0,c.VK)((()=>{let t;var o;e.isCollectionView()?t=null===(o=e.getCollectionViewCollectionStore())||void 0===o?void 0:o.getFormat().bot_id:t=e.getFormat().bot_id;const i=T.Z.bots.state.find((e=>e.id===t));if(i)return(0,m.s9)(i.integration_id)}),[e]),{message:i,description:n}=s.useMemo((()=>(0,k.xt)(t,o)),[t,o]);return{statusCode:t,message:i,description:n}}function G(e){window.__c={n:"ErrorPopupButton"};const{onAuthenticate:t,onReplace:o,onUpdate:i,state:r,store:l,onRemove:c,style:m}=e,g=(0,d.yK)((e=>({orangeThemeColor:(0,p.fi)("orange",e),dropdownIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),{statusCode:h,message:f,description:v}=Y(l);return a()(B.Z,{popupType:B.Z.PopupType.Popup,originGap:4,renderOrigin:e=>s.createElement(E.Z,n()({style:m,icon:e=>u.Z.warning({...e,fill:g.orangeThemeColor.fill})},e),a()("span",{},void 0,_.default.formatMessage(f)),u.Z.chevronDown(g.dropdownIcon)),render:e=>a()(W,{state:r,store:l,onUpdate:i?()=>{i(),e.close()}:void 0,onAuthenticate:t?()=>{t(),e.close()}:void 0,onReplace:()=>{o(),e.close()},onRemove:c?()=>{c(),e.close()}:void 0,statusCode:h,errorDescription:v.description,description:_.default.formatMessage(v,{integrationName:r.integration.name,statusCode:h})})})}function X(e){window.__c={n:"ErrorInlineMenu"};const{onAuthenticate:t,onReplace:o,onUpdate:i,state:n,store:r,onRemove:s}=e,l=(0,d.yK)((e=>({orangeThemeColor:(0,p.fi)("orange",e)})),[]),{statusCode:c,message:m,description:h}=Y(r);return a()("div",{style:{alignSelf:"stretch"}},void 0,a()("div",{style:{display:"flex",alignItems:"center",fontSize:g.Z.fontSize.UIRegular.desktop,fontWeight:g.Z.fontWeight.medium,marginBottom:4}},void 0,u.Z.warning({width:18,height:18,marginRight:6,fill:l.orangeThemeColor.fill}),a()("span",{},void 0,_.default.formatMessage(m))),a()("div",{style:{margin:"0 -14px"}},void 0,a()(W,{state:n,store:r,onUpdate:i,onAuthenticate:t,onReplace:o,onRemove:s,statusCode:c,errorDescription:h.description,description:_.default.formatMessage(h,{integrationName:n.integration.name,statusCode:c}),isInlineMenu:!0})))}K.displayName="ExternalObjectInstanceAction";const q=K},76745:(e,t,o)=>{o.d(t,{Z:()=>R});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(8848),p=o(76725),u=o(97880),m=o(82990),g=o(44876),h=o(761),f=o(41232),v=o(6398),y=o(68859),b=o(49085);class S extends b.Z{getInitialState(){return{error:!1,loading:!1}}}const w=S;var k=o(1533),C=o(86671),_=o(68709),M=o(51077),T=o(71669),I=o(84076),P=o(68785),x=o(81865),B=o(49914),Z=o(40662);class E extends C.Z{constructor(){super(...arguments),this.origin=c.createRef(),this.storeTypes={interactionStore:k.Z,externalObjectTokenStore:w,blockResizerStore:y.Z},this.renderSubheaderIconAttribute=e=>{if((0,g.li)(e)){const t=e.values[0];return a()(x.Z,{isAuthenticated:!1,url:t,width:32,render:(e,t)=>a()(T.Z,{src:t,height:12,placeholderLoadedStyle:{width:12,height:12,marginRight:4}})})}if((0,g.hW)(e)){const t=e.values[0],o=t?`rgb(${t.r},${t.g},${t.b})`:"gray",{colorName:i,shade:n}=(0,d.lL)(o);return a()("div",{style:{width:12,height:12,marginRight:4,background:this.theme.accentColors[i][n],borderRadius:3}})}},this.renderSubheaderAttribute=e=>c.createElement(v.ox,n()({},e,{store:this.props.store})),this.stateStore=this.createComputedStore((()=>(0,f._l)({store:this.props.store,isInDarkMode:this.isInDarkMode(),canEdit:this.canEdit(),currentUserId:this.environment.currentUser.id,showAction:this.props.forceActionForUIDoc})),!0)}renderPersisted(){const e=this.stateStore.state;if(!e)return this.renderShimmerState();const t=(0,f.y6)(this.props.store);if("error"===e.type&&(null==t||!t.integration_id))return this.renderShimmerState();const{renderConfig:o}=e;return a()(_.p,{allowSelectionWithin:!0},void 0,o.previewAttributes&&(0,u.Of)(o.previewAttributes)?this.renderEmbedPreview({attributes:o.previewAttributes,state:e}):this.renderLinkBox(e))}renderLinkBox(e){var t;const{originalUrl:o,renderConfig:i,integration:r,updating:s}=e,{store:l}=this.props,d="placeholder"===e.type,u="error"===e.type,m=this.stores.interactionStore.state.hovered||this.environment.device.isMobile,g=o&&(0,f.pI)(o,l.pointer.spaceId);return c.createElement(I.Z,n()({ref:this.origin,interactionStore:this.stores.interactionStore,style:{flexGrow:1,minWidth:0,...(d||u)&&{background:this.theme.embedPlaceholderBackground}},innerStyle:this.getStyle({hasPreview:Boolean(i.previewAttributes)})},d||u?{onClick:()=>{const e=this.getPlaceholderNode();e&&this.openLinkEmbedMenu(e)}}:{href:g,external:!0}),a()("div",{style:{display:"flex",alignSelf:"start",height:32,width:32,marginRight:12,marginLeft:4,marginTop:3,marginBottom:3,position:"relative"}},void 0,this.renderBlockIcon(i,r.icon)),a()("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:1,flexShrink:1,overflow:"hidden"}},void 0,a()("div",{style:{display:"flex",alignItems:"baseline",fontSize:14}},void 0,(0,p.Z)((null===(t=i.headerAttributes)||void 0===t?void 0:t.map(((e,t)=>c.createElement(v.ox,n()({key:`attribute-${t}`},e,{store:this.props.store,style:0===t?this.getTitleStyle():{}})))))||[],(e=>a()("span",{style:{marginRight:6}},`spacer-${e}`))),(s||this.stores.externalObjectTokenStore.state.loading)&&a()(P.Z,{style:{marginLeft:6}})),i.bodyAttribute&&a()(v.hx,{attribute:i.bodyAttribute}),a()("div",{style:{display:"flex",alignItems:"center",color:this.theme.mediumTextColor,fontSize:12}},void 0,i.subheaderIcon&&this.renderSubheaderIconAttribute(i.subheaderIcon),i.subheaderAttributes&&(0,p.Z)(i.subheaderAttributes.map(this.renderSubheaderAttribute),(e=>a()("span",{style:{marginLeft:3,marginRight:3}},e,"•"))))),a()(Z.Z,{canEdit:this.canEdit(),forceActionForUIDoc:this.props.forceActionForUIDoc,store:this.props.store,renderDefaultAction:m?"shown":"invisible",buttonStyle:i.bodyAttribute?{alignSelf:"flex-start",marginTop:4}:{},openPlaceholderMenu:()=>{const e=this.getPlaceholderNode();e&&this.openLinkEmbedMenu(e)}}))}renderShimmerState(){var e;return a()(I.Z,{href:null===(e=this.stateStore.state)||void 0===e?void 0:e.originalUrl,external:!0,style:{flexGrow:1,minWidth:0},innerStyle:this.getStyle()},void 0,this.renderShimmerbox({width:38,height:38}),a()("div",{style:{display:"flex",flexDirection:"column",flexGrow:1}},void 0,this.renderShimmerbox({width:"50%",height:14,margin:4}),this.renderShimmerbox({width:"40%",height:12,margin:4})))}renderBlockIcon(e,t){const o=l().uniqBy(e.icons||[],(e=>`${e.type}:${e.values[0].toString()}`));return o.length>=2?a()("div",{style:{width:32,height:32}},void 0,a()(v.lf,{attribute:o[0],isSmall:!0}),a()(v.lf,{attribute:o[1],isSmall:!0,style:{position:"absolute",bottom:0,right:2}}),a()(M.Z,{type:"image_url",imageURL:t,size:16,style:{position:"absolute",bottom:-3,right:-3},imageStyle:this.getAvatarSubIconStyle()})):1===o.length?c.createElement(c.Fragment,null,a()(v.lf,{attribute:o[0],isSmall:!1}),a()(M.Z,{type:"image_url",imageURL:t,size:16,style:{position:"absolute",bottom:-2,right:-2},imageStyle:this.getAvatarSubIconStyle()})):a()(M.Z,{type:"image_url",imageURL:t,size:38})}renderEmbedPreview(e){const{attributes:t}=e,o=t[0],{values:i,mimeType:r}=o,s=i[0];let l;"image/*"===r?l="image":"audio/*"===r?l="audio":"video/*"===r?l="video":"application/pdf"===r?l="pdf":"text/html"===r?l="embed":(0,u.t1)(r);const d="image"===l||"pdf"===l||"embed"===l,p=this.props.store;return p.isExternalObjectInstanceBlockStore()?a()("div",{style:{overflow:"hidden",borderRadius:"3px 3px 0px 0px",border:`1px solid ${this.theme.darkDividerColor}`,borderBottom:void 0,position:"relative"}},void 0,c.createElement(B.Z,n()({store:p,source:s,showExpandButton:d,mediaType:l},(0,f.Xg)()?{disabled:!1,preserveScale:"image"===l,blockResizerStore:this.stores.blockResizerStore}:{disabled:!0,preserveScale:!0,disableActions:!0,..."image"===l&&{centerWrappedContent:!0}},{contentBelowSource:this.renderLinkBox(e.state)}))):void 0}renderShimmerbox(e){return a()("div",{style:{overflow:"hidden",position:"relative",background:this.theme.selectLightGray[30],...e}},void 0,a()("div",{style:{position:"absolute",height:"100%",width:"100%",zIndex:1,animation:"shimmer 1s infinite",background:`linear-gradient(to right, ${this.theme.selectLightGray[30]} 0%, ${this.theme.selectLightGray[50]} 20%, ${this.theme.selectLightGray[30]} 40%, ${this.theme.selectLightGray[30]} 100%)`}}))}isInDarkMode(){return"dark"===this.environment.ThemeStore.state.mode}handleCreated(){const e=this.getPlaceholderNode();e&&this.openLinkEmbedMenu(e)}getPlaceholderNode(){var e,t;if("placeholder"===(null===(e=this.stateStore.state)||void 0===e?void 0:e.type)||"error"===(null===(t=this.stateStore.state)||void 0===t?void 0:t.type)){const e=this.origin.current;if(e&&e instanceof Element)return e}}openLinkEmbedMenu(e){var t;const o=(0,f.y6)(this.props.store);h.os({originRect:e.getBoundingClientRect(),environment:this.environment,externalObjectInstanceBlockStore:this.props.store,placeholderIntegrationId:null==o?void 0:o.integration_id,integration:null===(t=this.stateStore.state)||void 0===t?void 0:t.integration,externalObjectTokenStore:this.stores.externalObjectTokenStore})}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{hasPreview:t}=e;return{display:"flex",alignItems:"center",border:`1px solid ${this.theme.darkDividerColor}`,borderRadius:t?"0px 0px 3px 3px":3,padding:6,...this.getBlockColorStyle(),...this.props.style}}getAvatarSubIconStyle(){return{filter:`\n\t\t\t\tdrop-shadow(0px 0px 1px ${this.theme.contentBackground})\n\t\t\t\tdrop-shadow(0px 0px 1px ${this.theme.contentBackground})\n\t\t\t\tdrop-shadow(0px 0px 1px ${this.theme.contentBackground})\n\t\t\t`}}getTitleStyle(){return{fontWeight:m.Z.fontWeight.medium,...m.Z.textOverflowStyle,color:this.theme.regularTextColor}}}const R=E},69255:(e,t,o)=>{o.d(t,{Z:()=>w});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(3779),p=o(77420),u=o(5500),m=o(95182),g=o(761),h=o(60709),f=o(30874),v=o(93405),y=o(78140),b=o(9342),S=o(72495);const w=function(e){window.__c={n:"ExternalObjectInstanceBlockMenu"};const{titleForReloadMenuOption:t,store:o,onAccept:i,extraSecondaryItems:r}=e,w=(0,l.O7)(),k={blocks:[o],environment:w,publicEditMode:void 0},C=[];var _;return(0,c.VK)((()=>{const e=o.getFormat().bot_id,t=f.Z.getBotsAsRecordMap();if(e&&!0===f.Z.state.loaded){const o=t.get({table:p.cZ,id:e});if(o&&o.integration_id&&o.integration_id===u.U9)return!1}return!0}),[o])&&C.push({key:0,render:e=>s.createElement(S.Z,e),items:[{key:"reload external instance object",render:e=>s.createElement(v.Z,a()({},e,{title:t,svg:d.Z.sync})),action:()=>{o&&(o.isExternalObjectInstanceBlockStore()||o.isExternalObjectInstancePageBlockStore())&&g.qK({environment:w,from:"page_more_menu",store:o,spaceId:o.getSpaceId()})}}]}),C.push({key:1,render:e=>s.createElement(S.Z,e),items:[...r,(_=m.IK,{key:_.key,render:(e,t)=>_.render(e,k,{onAccept:i,onFocus:t.onFocus}),action:e=>{let{event:t}=e;return _.action(k,t)}})]}),n()(y.Z,{menuType:h.og.Popup},void 0,n()(b.Z,{type:b.i.Vertical,initialFocus:void 0,onAccept:i,sections:C}))}},69721:(e,t,o)=>{o.d(t,{Z:()=>E});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=(o(67294),o(62518)),l=o(49271),c=o(43593),d=o(3779),p=o(70203),u=o(82990),m=o(5366),g=o(50906),h=o(72747),f=o(62365),v=o(27153),y=o(24677),b=o(98104),S=o(30149),w=o(33929),k=o(27411),C=o(31792),_=o(86671),M=o(13966),T=o(64921),I=o(64369),P=o(86329),x=o(78454);const B=(0,m.defineMessages)({fileTitle:{defaultMessage:"File",id:"fileBlock.fileTab.title"},embedButtonText:{defaultMessage:"Embed link",id:"fileBlock.embedButton.label"},embedFilePrompt:{defaultMessage:"Paste a file link…",id:"fileBlock.linkPrompt.placeholder",description:"Placeholder prompt for the user to upload or embed a file."},embedCaption:{defaultMessage:"Works with links of PDFs, Google Drive, Google Maps, CodePen…",id:"fileBlock.linkPrompt.caption",description:"Caption for the user to upload or embed a file."}});class Z extends _.Z{constructor(){super(...arguments),this.caption=()=>{this.handleEditCaption()},this.storeTypes={mouseStore:C.Z},this.handleEditCaption=()=>{const e=this.props.store.getPropertyStore("caption");y.eP({environment:this.environment,store:this.props.store}),b.NX({store:e})},this.handleOpenMenu=()=>{const{device:e}=this.environment;if(this.canEdit()){const t=s.findDOMNode(this);if(t&&t instanceof Element){const o=t.getBoundingClientRect();v.$(this.environment,{originRect:o,originGap:0,isSmallWidth:!0,showArrow:!0,title:w.default.formatMessage(B.fileTitle),currentTab:"file",tabs:[{type:"file",fileUpload:!0,imageUpload:e.isAndroid,videoUpload:e.isAndroid,onUpload:this.handleUpload},{type:"embed",buttonText:w.default.formatMessage(B.embedButtonText),inputPlaceholder:w.default.formatMessage(B.embedFilePrompt),caption:w.default.formatMessage(B.embedCaption),onChange:e=>{v.Z(),S.createAndCommit({userAction:"FileBlock.handleOpenMenu",environment:this.environment,perform:t=>{f.v({store:this.props.store,source:e,name:void 0,size:void 0,transaction:t})}}),g.trackUrlPaste(this.environment,{pastedText:e,source:"file_block_menu"})}}]})}}},this.handleMouseEnter=e=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=e=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleClick=()=>{h.qL(this.environment,{store:this.props.store,from:"embedded_block_click"})},this.handleUpload=e=>{const{store:t}=this.props;S.createAndCommit({userAction:"FileBlock.handleUpload",environment:this.environment,perform:e=>{f.v({store:this.props.store,source:void 0,name:void 0,size:void 0,transaction:e})}}),f.c({environment:this.environment,store:t,file:e})},this.fileUploadStore=this.createComputedStore((()=>k.default.getKeyState(k.default.getBlockKey(this.props.store.id))))}handleCreated(){this.edit()}edit(){this.handleOpenMenu()}activate(){this.handleOpenMenu()}replace(){this.handleOpenMenu()}renderPersisted(){const e=this.getSource();return e?this.renderFile(e):this.renderUploader()}renderFile(e){const{device:t}=this.environment,o=this.props.store.getProperties(),i=p.Jc(o&&o.title),r=p.Jc(o&&o.size),a=(this.stores.mouseStore.state.mouseEntered||t.isMobile)&&this.canEdit()&&n()(M.Z,{style:{marginRight:4},store:this.props.store,fadeIn:!0});return n()("div",{},void 0,n()("div",{onMouseMove:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,style:{display:"flex"}},void 0,n()(T.Z,{style:this.getStyle(),onClick:this.handleClick},void 0,n()(x.ZP,{style:Z.innerStyle,left:d.Z.file(),leftStyle:Z.fileIconStyle,alignment:x.v2.Center,right:a},void 0,n()("div",{style:{display:"flex",alignItems:"baseline"}},void 0,n()("div",{style:{...u.Z.textOverflowStyle}},void 0,c.rF({title:i,source:e})),r&&n()(I.Z,{isSmall:!0,style:{marginLeft:6,whiteSpace:"nowrap"}},void 0,r)))),this.renderDiscussion()),this.renderCaption())}renderUploader(){const{device:e}=this.environment,{disabled:t}=this.props,o=this.fileUploadStore.state;return n()("div",{onMouseMove:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1}),style:{display:"flex"}},void 0,n()(P.Z,{disabled:t,iconSvg:d.Z.file,right:(this.stores.mouseStore.state.mouseEntered||e.isMobile)&&this.canEdit()&&n()(M.Z,{store:this.props.store,fadeIn:!0}),isLoading:Boolean(o),progressPercent:o?o.progressPercent:0,file:o?o.file:void 0,name:o?o.name:void 0,size:o?o.size:void 0,onClick:this.handleOpenMenu},void 0,n()(m.FormattedMessage,{defaultMessage:"Upload or embed a file",id:"fileBlock.uploadOrEmbed.placeholder"})),this.renderDiscussion())}getSource(){const e=this.props.store.getProperties(),t=e&&e.source,o=p.Q(t),{display_source:i}=this.props.store.getFormat();return i||o}getStyle(){return{flexGrow:1,minWidth:0,borderRadius:3,...a().omit(this.getBlockColorStyle(),["fontSize","lineHeight"])}}}Z.innerStyle={paddingTop:l.ZD.paddingTop,paddingBottom:l.ZD.paddingBottom,paddingLeft:l.ZD.paddingLeft},Z.fileIconStyle={width:"1.35em",height:"1.35em"};const E=Z},26673:(e,t,o)=>{o.r(t),o.d(t,{default:()=>T});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(5366),d=o(3297),p=o(97977),u=o(28020),m=o(60709),g=o(38755),h=o(79315),f=o(89256),v=o(52275),y=o(31945),b=o(78140),S=o(9342),w=o(40721),k=o(44532),C=o(31278),_=o(72495);class M extends l.Z{constructor(){super(...arguments),this.renderPopup=()=>{const{device:e}=this.environment,t=f.Z.state;if(!t.open)return;const{currentUserRootStore:o}=h.default.state;if(!o)return;const i=[{key:"spaces",render:t=>s.createElement(_.Z,n()({title:e.isMobile?void 0:a()(c.FormattedMessage,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.chooseWorkspace.menuItem.title"}),isTitleUppercase:!0},t)),items:M.getSpaceViewMenuItems(this.environment,t.store)},{key:"logout",render:e=>s.createElement(_.Z,n()({},e,{topBorder:!0})),items:[{key:"logout",action:()=>p.logout(this.environment),render:e=>{const{currentUserStore:t}=h.default.state;let o="";if(t){const e=t.getEmail();e&&(o=e)}return s.createElement(v.Z,n()({caption:a()(c.FormattedMessage,{defaultMessage:"Log out ({email})",id:"duplicatePagePopup.buttonMenuItem.logoutButton.label",values:{email:o}})},e))}}]}];let r;return r=e.isMobile?{menuType:m.og.Modal,title:a()(c.FormattedMessage,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.choooseWorkspaceMobileMenu.title"}),right:a()(w.CancelMenuText,{}),onClickRight:d.sC}:{menuType:m.og.Popup},s.createElement(b.Z,r,a()(S.Z,{type:S.i.Vertical,sections:i,initialFocus:1}))}}renderComponent(){const{device:e}=this.environment;return a()(k.ZP,{popupType:e.isMobile?y.Z.PopupType.SlideUp:y.Z.PopupType.Popup,open:f.Z.state.open,render:this.renderPopup,originGap:8,onDismiss:d.sC,originRect:f.Z.state.originRect,enableRounding:!0})}}M.displayName="ForkPagePopup",M.getSpaceViewMenuItems=(e,t)=>{const{device:o}=e,{currentUserRootStore:i}=h.default.state;if(!i)return[];const r=u.o(i),l=[];for(const c of r){const i=c.getSpaceStore();if(i){const r=(0,g.rn)(e,i),p=(0,g.Wd)(e,i);l.push({key:c.id,action:async()=>{await d.DK({environment:e,store:t,spaceStore:i,spaceViewStore:c,isPrivate:!0,context:"public_page_duplicate_multiple_workspace"})},render:e=>s.createElement(v.Z,n()({title:r,icon:a()(C.Z,{icon:p,isEmptyPage:!1,title:r,size:o.isMobile?24:20,disabled:!0})},e))})}}return l};const T=M},73240:(e,t,o)=>{o.r(t),o.d(t,{default:()=>le});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(99036),u=o(8848),m=o(84682),g=o(18955),h=o(91905),f=o(42875),v=o(82990),y=o(5366),b=o(50906),S=o(62134),w=o(66890),k=o(75079),C=o(60709),_=o(33665),M=o(77907),T=o(34859),I=o(79315),P=o(49085);class x extends P.Z{getInitialState(){return{value:"",html:"",query:""}}}const B=x;var Z=o(29798),E=o(48019),R=o(78140),A=o(40721),D=o(18647),F=o(72495),L=o(13991),V=o(76725);class N extends d.Z{renderDescription(){const{entry:e}=this.props;if(e){const{descriptionMessage:t,fallbackDescription:o}=e;if(t)return c.createElement(y.FormattedMessage,t);if(o)return o}return null}renderComponent(){const{entry:e}=this.props;if(e){const{name:t,examples:o}=e,i=(0,g.EP)(this.props.Prism,(o||[]).join("\n")),n=this.renderSyntax();return a()("div",{},void 0,a()("h1",{style:N.headerStyle},void 0,t),a()("p",{style:N.textStyle},void 0,this.renderDescription()),a()("p",{style:N.textStyle},void 0,a()("b",{},void 0,a()(y.FormattedMessage,{id:"database.formula.syntaxSection.title",defaultMessage:"Syntax",description:"Title of the section describing the syntax of a formula component. For example, for sqrt this title appears above 'sqrt(number)', and appears alongside the Examples section."}))),a()("pre",{style:this.getCodeStyle()},void 0,(0,V.Z)(n,(e=>a()("br",{},`sep:${e}`)))),o&&o.length>0&&a()("p",{style:N.textStyle},void 0,a()("b",{},void 0,a()(y.FormattedMessage,{id:"database.formula.examplesSection.title",defaultMessage:"Examples",description:"Title of the section listing examples of the syntax of a formula component. For example, for sqrt this title appears above 'sqrt(144) == 12', and appears alongside the Syntax section."}))),a()("pre",{style:this.getCodeStyle(),dangerouslySetInnerHTML:{__html:i}}))}return a()("div",{})}renderSyntax(){const{entry:e}=this.props;if(!e)return[];const{name:t,category:o}=e;return o===h.WD.property?[a()("span",{},0,"prop(",JSON.stringify(t),")")]:o===h.WD.constant?[a()("span",{},0,t)]:o===h.WD.function?this.getFunctionSyntax(e):o===h.WD.operator?this.getOperatorSyntax(e):[]}getFunctionSyntax(e){const{name:t}=e;return N.getSignatureNames(e).map(((e,o)=>{let{variadic:i,arity:n}=e;return i?a()("span",{},o,t,"(",a()("i",{},void 0,i),"...)"):a()("span",{},o,t,"(",(0,V.Z)(n.map(((e,t)=>a()("i",{},t,e))),(e=>a()("span",{},`sep:${e}`,","," "))),")")}))}getOperatorSyntax(e){const{operator:t}=e;return l().compact(N.getSignatureNames(e).map(((e,o)=>{let{arity:i}=e;if(1===i.length){const[e]=i;return a()("span",{},-o-1,t," ",a()("i",{},void 0,e))}if(2===i.length){const[e,n]=i;return a()("span",{},-o-1,a()("i",{},void 0,e)," ",t," ",a()("i",{},void 0,n))}if(3===i.length){const[e,t,n]=i;return a()("span",{},-o-1,a()("i",{},void 0,e)," ","? ",a()("i",{},void 0,t)," ",": ",a()("i",{},void 0,n))}})).concat(this.getFunctionSyntax(e)))}static getSignatureNames(e){const{name:t,signatures:o}=e;return"if"===t?[{arity:["boolean","value","value"]}]:"format"===t||"unaryPlus"===t?[{arity:["value"]}]:"equal"===t||"unequal"===t?[{arity:["value","value"]}]:o.map((e=>{let{arity:t,variadic:o}=e;return{variadic:o?N.typeNameMap[o]:void 0,arity:t?l().compact(t.map((e=>N.typeNameMap[e]))):[]}}))}getCodeStyle(){return{paddingTop:6,paddingBottom:8,paddingLeft:10,paddingRight:10,overflowX:"scroll",background:this.theme.sidebarBackground,borderRadius:3,fontSize:13,margin:0,fontFamily:v.Z.getCompositeFontFamily(L.SP).mono,lineHeight:1.4}}}N.displayName="FormulaDocumentation",N.typeNameMap={checkbox:"boolean",number:"number",text:"text",date:"date"},N.headerStyle={fontSize:20,margin:0,lineHeight:1,marginTop:4,marginBottom:12},N.textStyle={whiteSpace:"normal",marginTop:8,marginBottom:8,fontSize:13,lineHeight:1.4};const O=(0,M.withDependency)(M.deps.prismjs,((e,t)=>c.createElement(N,n()({},t,{Prism:e}))));var U=o(39068),H=o(3779),z=o(64921),W=o(52275),j=o(31945),K=o(28992);class Y extends d.Z{renderComponent(){const{entry:{name:e}}=this.props;return a()(W.Z,{focused:this.props.focused,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,icon:a()("div",{style:{...U.f,...this.environment.device.isMobile&&{marginLeft:14}}},void 0,this.renderPropertyIcon()),title:e,right:this.renderDocumentationButtonPopup(),style:{...!this.environment.device.isMobile&&{paddingLeft:8,paddingRight:8}},desktopIconStyle:{marginLeft:0}})}renderDocumentationButtonPopup(){const{device:e}=this.environment;if(this.environment.device.isMobile)return a()(j.Z,{popupType:e.isMobile?j.Z.PopupType.SlideUp:j.Z.PopupType.Popup,renderOrigin:e=>c.createElement(z.Z,n()({mobileFeedback:!0,style:{width:16,height:16}},e),H.Z.typesUnknownType({fill:this.theme.mediumIconColor})),render:t=>{let o;return o=e.isMobile?{menuType:C.og.Modal,title:a()(y.FormattedMessage,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title",description:"In this context, documentation refers to the documentation popup for formulas property values in databases."}),right:a()(A.DoneMenuText,{}),onClickRight:t.close}:{menuType:C.og.Popup},c.createElement(R.Z,o,a()(F.Z,{},void 0,a()(K.Z,{title:a()(O,{entry:this.props.entry}),style:{paddingTop:10,paddingBottom:16}})))}})}renderPropertyIcon(){const{entry:e}=this.props,{theme:t}=this;if(e.category===h.WD.property||e.category===h.WD.constant){const{resultType:o}=e;return a()(U.ZP,{type:o,icon:void 0,size:16,theme:t})}if(e.category===h.WD.function||e.category===h.WD.operator){const{signatures:[{resultType:o}]}=e;return a()(U.ZP,{type:o,icon:void 0,size:16,theme:t})}}}Y.displayName="FormulaEntryMenuItem",Y.contextTypes={...C.mw,...d.w};const G=Y;var X=o(63143),q=o(52821),$=o(45023),J=o(33929),Q=o(72133),ee=o(42922),te=o(3386),oe=o(58032);const ie=(0,y.defineMessages)({placeholder:{id:"database.formula.placeholder",defaultMessage:"Type a formula"}});class ne extends d.Z{constructor(){super(...arguments),this.updateTimer=void 0,this.latestSelectionRange=void 0,this.storeTypes={store:B},this.handleSelectionChange=()=>{const e=Q.get();e&&this.input.contains(e.commonAncestorContainer)&&(this.latestSelectionRange=e)},this.handleInputMount=e=>this.input=e,this.handleInput=e=>{const{target:{textContent:t}}=e;this.updateValue(t),X.z4(this.updateTimer)&&(this.updateTimer=window.setTimeout((()=>this.executeUpdate()),ne.delay))},this.handlePaste=e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)},this.handleKeyUp=e=>{this.updateSelection()},this.handleClick=e=>{this.updateSelection()},this.handleKeyDown=e=>{(0,$.Z)(this.environment,e,"command+enter")&&(this.handleAccept(),e.stopPropagation())},this.getStyle=()=>({flexGrow:1,position:"relative",minWidth:0,...this.props.inputContainerStyle})}insertEntry(e){var t,o;const{value:i}=this.stores.store.state,{name:n}=e,r=ne.getCompletion(e),a=(null===(t=this.latestSelectionRange)||void 0===t?void 0:t.startOffset)??0;let s=a,l=(null===(o=this.latestSelectionRange)||void 0===o?void 0:o.endOffset)??0;const c=g.wo(i,a);if(c){const[e,t]=c,o=i.slice(e,t).toLowerCase();o!==r.toLowerCase().slice(0,t-e)&&o!==n.toLowerCase().slice(0,t-e)||(s=e,l=t)}this.input.focus();const d=this.input.firstChild||this.input,p=document.createRange();p.setStart(d,s),p.setEnd(d,l),Q.set(p,this.environment.device),s<l&&document.execCommand("delete",!1),document.execCommand("insertText",!1,r);const u=(l+r.length)/(this.input&&this.input.textContent&&this.input.textContent.length||0)*this.container.scrollWidth;u>this.container.scrollLeft+this.container.offsetWidth&&(this.container.scrollLeft=u-this.container.offsetWidth)}handleAccept(){this.updateTimer&&(window.clearTimeout(this.updateTimer),this.updateTimer=void 0);const{value:e}=this.stores.store.state;if(""===e.trim())this.props.onSubmit();else{const{formula:t,error:o}=this.updateFormula(e);o||this.props.onSubmit(t)}}willMount(e){super.willMount(e);const{formula:t,schema:o}=e,i=this.props.formulaStringHelpers.formulaToString(t,o);this.updateValue(i)}didMount(){const{device:e}=this.environment,{value:t}=this.stores.store.state;if(this.input&&(this.input.textContent=t,e.isMobile||this.input.focus(),t)){const e=document.getSelection();this.input.firstChild&&e.collapse(this.input.firstChild,t.length),this.container.scrollLeft=this.container.scrollWidth-this.container.offsetWidth}document.addEventListener("selectionchange",this.handleSelectionChange)}willUnmount(){document.removeEventListener("selectionchange",this.handleSelectionChange)}renderComponent(){const{device:e}=this.environment,{disabled:t}=this.props,{command:o}=S.fg(this.environment),{html:i}=this.stores.store.state;return a()("div",{style:this.getWrapStyle()},void 0,c.createElement("div",{ref:e=>{e&&(this.container=e)},style:this.getStyle()},a()(te.Z,{capture:!t,onLeft:l().identity,onRight:l().identity,onSelectAll:l().identity,onRedo:l().identity,onUndo:l().identity,onToggleBold:l().identity,onToggleItalics:l().identity,onToggleCode:l().identity,onCut:l().identity,onCopy:l().identity,onPaste:l().identity,onKeypress:l().identity,onDelete:l().identity,onBackspace:l().identity},void 0,c.createElement("div",{ref:this.handleInputMount,contentEditable:!t,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onClick:this.handleClick,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,onInput:this.handleInput,onPaste:this.handlePaste,style:this.getInputStyle()})),a()("div",{style:this.getOverlayStyle(),dangerouslySetInnerHTML:{__html:i}})),!e.isMobile&&!t&&a()(oe.Z,{renderTooltip:()=>a()("div",{},void 0,a()("span",{},void 0,a()(y.FormattedMessage,{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"}))," ",a()("span",{style:{color:this.theme.mediumInvertedTextColor}},void 0,o,"+Enter")),render:t=>c.createElement(ee.Z,n()({disabled:Boolean(this.stores.store.state.error),onClick:()=>this.handleAccept(),style:{height:24,padding:"0 8px",alignSelf:"flex-end",marginRight:6,marginBottom:4,...e.isMobile&&{marginRight:12}}},t),a()(y.FormattedMessage,{id:"database.formula.doneButton.label",defaultMessage:"Done",description:"Label for button that confirms changes to a formula."}))}))}updateValue(e){const t=""===e.trim()?this.props.disabled?"":J.default.formatMessage(ie.placeholder):g.EP(this.props.Prism,e);this.stores.store.setState({...this.stores.store.state,html:t,value:e})}updateSelection(){const e=document.getSelection().anchorOffset,{value:t}=this.stores.store.state,o=g.wo(t,e),i=o?t.slice(o[0],o[1]):"";i!==this.stores.store.state.query&&this.stores.store.setState({...this.stores.store.state,query:i})}updateFormula(e){const{schema:t,property:o}=this.props;if(""===e.trim())return{error:void 0,formula:void 0,type:void 0};{const i=this.props.formulaStringHelpers.stringToFormula({str:e,property:o,schema:t,intl:J.default.getIntl(),propertyTypeDisplayName:q.SO});if(i&&"error"===i.type){const{message:e}=i;return{formula:void 0,error:e,type:void 0}}return{formula:i,error:void 0,type:void 0}}}executeUpdate(){const{value:e}=this.stores.store.state,{error:t,formula:o}=this.updateFormula(e);!t&&o&&this.props.onChange(o),this.updateTimer=void 0,this.stores.store.setState({...this.stores.store.state,error:t})}static getCompletion(e){const{category:t,name:o}=e;return t===h.WD.property?`prop(${JSON.stringify(o)})`:t===h.WD.constant?o:`${o}(`}getWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flex:"none",background:this.theme.inputBackground,minHeight:33,borderTopLeftRadius:3,borderTopRightRadius:3,...this.props.disabled&&{background:this.theme.contentBackground,borderRadius:3},...e.isMobile&&{borderBottom:`1px solid ${this.theme.regularDividerColor}`,background:this.theme.popoverBackground,minHeight:44,paddingLeft:t.state.paddingLeftCSS,paddingRight:t.state.paddingRightCSS},...this.props.wrapStyle}}getOverlayStyle(){const{device:e}=this.environment,{value:t}=this.stores.store.state;return{...e.isMobile?ne.mobileInputStyle:ne.desktopInputStyle,zIndex:0,...""===t.trim()&&{color:this.theme.mediumTextColor},position:void 0}}getInputStyle(){const{device:e}=this.environment,t=e.isSafari||e.isChrome?"WebkitTextFillColor":"color";return{...e.isMobile?ne.mobileInputStyle:ne.desktopInputStyle,border:"none",background:"none",[t]:""===this.stores.store.state.value?this.theme.regularTextColor:u.ZP.transparent,caretColor:this.theme.regularTextColor,zIndex:1,width:"100%"}}}ne.displayName="FormulaInput",ne.delay=0,ne.desktopInputStyle={alignItems:"center",position:"absolute",minWidth:"100%",minHeight:32,margin:0,padding:0,paddingLeft:10,paddingRight:8,paddingTop:8,fontSize:13,fontFamily:v.Z.getCompositeFontFamily(L.SP).mono,wordWrap:"break-word"},ne.mobileInputStyle={alignItems:"center",position:"absolute",minWidth:"100%",minHeight:44,margin:0,paddingLeft:16,paddingRight:0,paddingTop:12,paddingBottom:12,fontSize:14,fontFamily:v.Z.getCompositeFontFamily(L.SP).githubMono};const re=ne;var ae=o(74523);class se extends d.Z{constructor(){super(...arguments),this.storeTypes={formulaInputStore:B,menuListStore:Z.Z},this.state={filteredSections:[]},this.handleFilteredSectionsChange=e=>{l().isEqual(e.map((e=>e.key)),this.state.filteredSections.map((e=>e.key)))||this.setState({filteredSections:e})}}renderComponent(){const{device:e}=this.environment,{schema:t,property:o,disabled:i}=this.props,{error:n}=this.stores.formulaInputStore.state,{formula:r}=t[o],s=a()(c.Fragment,{},void 0,a()(M.DependencyConsumer,{dependency:M.deps.prismjs},void 0,(e=>a()(M.DependencyConsumer,{dependency:M.deps.formulaStringHelpers},void 0,(n=>c.createElement(re,{ref:e=>{e&&(this.formulaInput=e)},Prism:e,formulaStringHelpers:n,store:this.stores.formulaInputStore,formula:r,schema:t,property:o,disabled:i,onChange:e=>this.handleInputChange(e),onSubmit:e=>this.handleInputSubmit(e),wrapStyle:{overflow:"hidden"},inputContainerStyle:{maxHeight:"45vh",overflow:"scroll"}}))))),e.isMobile&&this.renderStatus());let l;return l=e.isMobile?{menuType:C.og.Modal,title:a()(y.FormattedMessage,{id:"database.mobileFormulaModal.title",defaultMessage:"Formula"}),left:a()(A.CancelMenuText,{}),right:n?void 0:a()(y.FormattedMessage,{id:"database.mobileFormulaModal.saveButton.label",defaultMessage:"Save"}),onClickLeft:this.props.onClickCancel,onClickRight:()=>this.formulaInput.handleAccept(),header:s}:{menuType:C.og.Popup,width:580,height:i?"none":void 0,disableScroller:!0,header:s,footer:this.renderStatus(),scrollerStyle:{display:"flex"}},c.createElement(R.Z,l,!i&&this.renderContent())}renderContent(){const{device:e}=this.environment,t=this.getLibrary(),o=this.getFocusedEntry(t);return e.isMobile?a()(E.Z,{initialFocus:0,context:{blocks:[],environment:this.environment,publicEditMode:void 0},filter:this.stores.formulaInputStore.state.query,sections:this.renderSections(t),menuListStore:this.stores.menuListStore,onFilteredSectionsChange:this.handleFilteredSectionsChange}):a()("div",{style:{display:"flex",flexGrow:1,boxShadow:`\n\t\t\t\t\t\t\tinset 0 1px 0 ${this.theme.regularDividerColor},\n\t\t\t\t\t\t\tinset 0 -1px 0 ${this.theme.regularDividerColor}\n\t\t\t\t\t\t`,maxHeight:295}},void 0,a()(D.Z,{type:T.Z.Y,style:{width:180,flexGrow:0,flexShrink:0}},void 0,a()(E.Z,{initialFocus:0,context:{blocks:[],environment:this.environment,publicEditMode:void 0},filter:this.stores.formulaInputStore.state.query,sections:this.renderSections(t),menuListStore:this.stores.menuListStore,disableMouseLeaveBlur:!0,onFilteredSectionsChange:this.handleFilteredSectionsChange})),a()(D.Z,{type:T.Z.Y,style:{padding:12,boxShadow:`inset 1px 0 0 ${this.theme.regularDividerColor}`,flexGrow:1}},void 0,a()(O,{entry:o})))}renderStatus(){const{device:e}=this.environment,{disabled:t}=this.props,{command:o}=S.fg(this.environment),{error:i}=this.stores.formulaInputStore.state;return i?a()("div",{style:e.isMobile?this.getMobileStatusWrapStyle():this.getDesktopStatusWrapStyle()},void 0,a()("span",{style:{...e.isMobile&&se.mobileStatusStyle,...se.errorStatusStyle}},void 0,i),!e.isMobile&&this.renderLearnMoreLink()):e.isMobile?a()("div",{style:this.getMobileStatusWrapStyle()},void 0,a()("span",{style:se.mobileStatusStyle},void 0,a()(y.FormattedMessage,{defaultMessage:"No errors.",id:"database.formula.mobileNoErrors.message"}))):t?void 0:a()("div",{style:this.getDesktopStatusWrapStyle()},void 0,a()("span",{},void 0,a()(y.FormattedMessage,{id:"database.formula.keyboardShortcutHint",defaultMessage:"{commandEnter} to accept",description:'Caption that describes keyboard shortcut to confirm changes to a formula and close the formula editor. Appears as "⌘+Enter to accept." on Mac, Ctrl+Enter on Windows.',values:{commandEnter:a()("span",{style:{fontWeight:v.Z.fontWeight.medium}},void 0,o,"+Enter")}})),this.renderLearnMoreLink())}renderLearnMoreLink(){return a()("div",{style:{marginLeft:"auto"}},void 0,a()(ae.Z,{title:a()("span",{style:{fontSize:v.Z.fontSize.UISmall.desktop}},void 0,a()(y.FormattedMessage,{defaultMessage:"Learn more about formulas",id:"formulaPropertyMenu.learnMore.button.label"})),href:(0,_.UY)("guides.formulas"),analyticsFrom:"formula_property_menu"}))}renderSections(e){return e.map((e=>({key:e.key,title:this.props.intl.formatMessage(e.titleMessage),render:e=>c.createElement(F.Z,n()({},e,{desktopTitleStyle:{paddingLeft:8,paddingRight:8}})),actions:e.entries.map(((e,t)=>({key:this.getEntryKey(e,t),displayName:e.name,analyticsName:e.name,searchName:e.name,render:t=>c.createElement(G,n()({},t,{entry:e})),action:()=>{this.formulaInput.insertEntry(e)},closeParentMenu:!1})))})))}handleUpdate(e,t){const{onChange:o,schema:i,property:n,analyticsFrom:r}=this.props;if(e&&"error"===e.type);else{const a=i[n];o({propertySchema:{...a,formula:e},close:t}),a&&b.trackConfigureProperty(this.environment,{...(0,k.Pn)(this.context.collectionContextStore),property_type:a.type,action:"formula_edit",from:r})}}getLibrary(){const{schema:e,property:t,exampleBlock:o,intl:i}=this.props,n=Object.keys(e).filter((o=>{const i=e[o];return!(o===t||i&&p.rX.includes(i.type))})).map((t=>{const n=e[t];if(!n)throw new Error("Property not found.");const{name:r}=n,a=o?m.Qs({property:t,schema:e,block:o,getRecordValue:this.getRecordValue,userTimeZone:(0,f.r)(),intl:i,depth:0,resultCache:{}}):void 0;return{name:r,category:h.WD.property,fallbackDescription:i.formatMessage({id:"database.formula.property.description",defaultMessage:"Returns the {propertyName} property for each entry."},{propertyName:r}),resultType:g.z6(n),examples:a?[`prop(${JSON.stringify(r)}) == ${JSON.stringify(a)}`]:[]}}));return[h.jQ(h.WD.property,n),...h.ZY]}getFocusedEntry(e){var t,o;const{focus:{section:i,indexLocal:n}}=this.stores.menuListStore.state,r="number"==typeof i&&"number"==typeof n?null===(t=this.state.filteredSections[i])||void 0===t||null===(o=t.actions[n])||void 0===o?void 0:o.key:void 0;if(void 0!==r)for(const a of e)for(const[e,t]of a.entries.entries())if(this.getEntryKey(t,e)===r)return t}getEntryKey(e,t){return`${e.name} ${t}`}getDesktopStatusWrapStyle(){return{display:"flex",flex:"none",alignItems:"center",fontSize:12,paddingLeft:8,paddingRight:8,height:30,color:this.theme.mediumTextColor}}getMobileStatusWrapStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",flex:"none",alignItems:"center",fontSize:14,height:28,color:this.theme.mediumTextColor,background:this.theme.popoverBackground,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,paddingLeft:e.state.paddingLeftCSS,paddingRight:e.state.paddingRightCSS}}get getRecordValue(){return I.default.getCurrentBlockValueFn()}handleInputChange(e){this.handleUpdate(e,!1)}handleInputSubmit(e){this.handleUpdate(e,!0)}}se.displayName="FormulaPropertyMenu",se.contextTypes={...d.w,...w.xm},se.mobileStatusStyle={paddingLeft:16,paddingRight:16},se.errorStatusStyle={color:u.ZP.redWithAlpha(.8),...v.Z.textOverflowStyle};const le=(0,y.injectIntl)(se)},2700:(e,t,o)=>{o.d(t,{Z:()=>Ze});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(82540),u=o(41432),m=o(80503),g=o(97880),h=o(51454),f=o(5366),v=o(50906),y=o(77162),b=o(47678),S=o(20073),w=o(61045),k=o(3898),C=o(45441),_=o(28020),M=o(43250),T=o(78316),I=o(99417),P=o(67074),x=o(52533),B=o(67669),Z=o(66430),E=o(45010),R=o(45094),A=o(77907),D=o(34859),F=o(79315),L=o(88632),V=o(24042),N=o(73329),O=o(17903),U=o(19111),H=o(56638),z=o(82136),W=o(88923),j=o(96026),K=o(87956),Y=o(7755),G=o(13991),X=o(480),q=o(81954),$=o(24405),J=o(27848),Q=o(95538),ee=o(3779),te=o(21202),oe=o(90468),ie=o(29369),ne=o(82990),re=o(54885),ae=o(51127),se=o(5299),le=o(88428),ce=o(30149),de=o(93959),pe=o(54258),ue=o(3815),me=o(42922),ge=o(64921),he=o(62896),fe=o(68785),ve=o(57079),ye=o(75272);function be(e){var t;const{collectionViewBlockStore:o}=e,i=(0,X.O7)(),n=(0,$.yK)((e=>({overlay:{position:"absolute",top:0,left:0,overflow:"visible",height:"100vh",width:"100%",zIndex:h.mJ,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:e.sidebarBackground,borderLeft:`1px solid ${e.lightDividerColor}`},welcome:{maxWidth:375,minWidth:320,maxHeight:"100%",flex:1,display:"flex",flexDirection:"column",alignItems:"stretch",marginLeft:"10%",marginRight:"10%",padding:"64px 16px"},welcomeLogo:{height:48,width:48},welcomeTitle:{marginTop:24,color:e.regularTextColor,fontFamily:ne.Z.getHeaderFontFamily({locale:G.SP}),fontWeight:ne.Z.fontWeight.bold,fontSize:28,flex:0,display:"flex",flexDirection:"row",alignItems:"center"},welcomeSubtitle:{marginTop:6,fontSize:18,color:e.mediumTextColor,fontWeight:400,flex:0},presets:{marginTop:32,marginBottom:32,gap:12,display:"flex",flexDirection:"column"},presetSelected:{background:"dark"===e.mode?e.popoverBackground:e.buttonBackground,boxShadow:e.outlineBlueInputBoxShadow},presetSelectedCheckmark:{width:24,height:24,color:e.blueButtonBackground,opacity:0,transform:"scale(0.8)",transition:"all 0.2s ease"},presetSelectedCheckmarkShown:{opacity:1,transform:"scale(1)"},preset:{display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start",padding:"16px 14px 16px 16px",background:"dark"===e.mode?e.accentColors.gray[200]:e.buttonBackground,borderRadius:7,boxShadow:e.elevatedButtonBoxShadow,cursor:"pointer",transition:"box-shadow 0.1s ease, background 0.1s ease"},scroller:{overflow:"auto",padding:4},presetHovered:{background:"dark"===e.mode?e.accentColors.gray[200]:e.accentColors.gray[30]},presetTextContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"flex-start",flex:1},presetIcon:{flexShrink:0,marginTop:2,marginBottom:2,width:20,height:20,marginRight:12},presetTitle:{color:e.regularTextColor,fontWeight:ne.Z.fontWeight.medium,fontSize:14,marginBottom:1},presetSubtitle:{color:e.mediumTextColor,fontWeight:ne.Z.fontWeight.regular,fontSize:14},previewContainer:{flex:1,overflow:"auto",height:"70%",borderRadius:"8px 0 0 8px",border:e.lightDividerColor,boxShadow:e.largeLightBoxShadow,background:e.popoverBackground},previewImage:{width:"100%",height:"100%"},actionButton:{flex:0,zIndex:h.mJ+1},hamburgerButton:{position:"absolute",zIndex:h.mJ+1,margin:5}})),[]),[r,s]=c.useState(!1),l=(0,q.VK)((()=>{const e=o.getFormatStore().getKeyStore("app_config_uri").getValue();if(!e)return;return(0,de.ED)(e)}),[o]),[d,p]=c.useState(void 0);c.useEffect((()=>{p(o.getFormatStore().getKeyStore("app_template_preset").getValue())}),[o,p]);const u=(0,q.VK)((()=>{var e;return(null==l||null===(e=l.presets)||void 0===e?void 0:e.filter((e=>"core"===e.type)))??[]}),[null==l?void 0:l.presets]),[m,g]=c.useState(d);c.useEffect((()=>{g(d)}),[d,g]),c.useEffect((()=>{if(l){re.XE(i,{app_uri:l.uri});const{inAppCalloutStore:e}=F.default.state;return e.canShow("better_template_initialization")?e.updateCalloutStatus({calloutId:"better_template_initialization",visible:!0}):e.updateCalloutStatus({calloutId:"better_template_initialization",visible:!1}),()=>{e.updateCalloutStatus({calloutId:"better_template_initialization",visible:!1})}}}),[l,i]);const v=c.useMemo((()=>null==l?void 0:l.presets.find((e=>e.uri===d))),[l,d]),y=c.useMemo((()=>{if(l&&v&&l.uri===J.xc)return(0,pe.L)(v)}),[l,v]),b=c.useMemo((()=>{if(!l)return;const t={};return l.presets.forEach((o=>{var i;const n=l.uri===J.xc?(0,pe.L)(o):null===(i=o.previews)||void 0===i?void 0:i.find((e=>"previewRootId"in e));n&&(t[o.uri]=ue.G.createChildStore(e.collectionViewBlockStore,{id:n.previewRootId,table:te.iU,spaceId:n.spaceId}))})),t}),[l,e.collectionViewBlockStore]),S=(0,q.VK)((()=>{const e=(0,_.ui)(i);return{left:e,right:e,bottom:ve.Z.paddingBottom(i),coverHeight:ve.Z.defaultPageCoverHeight(i)}}),[i]),w=(0,q.VK)((()=>{var e;const t=null==v||null===(e=v.previews)||void 0===e?void 0:e.find((e=>"url"in e&&!(0,Q.xL)(e)));if(t&&"url"in t)return t.url}),[null==v?void 0:v.previews]),k=(0,q.VK)((()=>i.device.isPhone),[i]),C=(0,q.VK)((()=>!!i.device.isMobileBrowser||!i.device.isMobileNative&&!(0,R.in)(i)),[i]);return c.useEffect((()=>{"rendered"!==F.default.state.renderPhase&&F.default.setState({...F.default.state,renderPhase:"rendered"})}),[]),l?c.createElement(c.Fragment,null,C&&a()("div",{style:n.hamburgerButton},void 0,a()(ye.Z,{})),a()("div",{style:n.overlay},void 0,a()("div",{style:n.welcome},void 0,a()("div",{style:n.scroller},void 0,a()("div",{style:n.welcomeLogo},void 0,a()("img",{src:l.logo,style:{height:"100%",width:"100%"}})),a()("div",{style:n.welcomeTitle},void 0,l.welcomeTitle??a()(f.FormattedMessage,{id:"apps.AppInitializationOverlay.welcomeTitle.default",defaultMessage:"Welcome to {appName}",description:"Welcome message for a database in the app",values:{appName:l.name}})),a()("div",{style:n.welcomeSubtitle},void 0,l.welcomeSubtitle??""),a()("div",{style:n.presets},void 0,u.map((e=>{var t;const o=null!==(t=e.icon)&&void 0!==t&&t.startsWith("/")?a()("img",{src:e.icon,style:{height:"100%",width:"100%"}}):a()(he.Z,{},void 0,e.icon??"");return a()(ge.Z,{style:{height:"auto",...n.preset,...d===e.uri?n.presetSelected:{}},disabled:r,hoveredStyle:n.presetHovered,onClick:()=>{p(e.uri),re.d_(i,{preset_uri:e.uri})},onMouseEnter:i.device.isMobile?void 0:()=>g(e.uri),onMouseLeave:i.device.isMobile?void 0:()=>g(d)},void 0,a()("div",{style:n.presetIcon},void 0,o),a()("div",{style:n.presetTextContainer},void 0,a()("div",{style:n.presetTitle},void 0,e.name),a()("div",{style:n.presetSubtitle},void 0,e.description)),a()("div",{},void 0,ee.Z.checkmark({...n.presetSelectedCheckmark,...d===e.uri?n.presetSelectedCheckmarkShown:void 0})))})))),a()("div",{style:{padding:`0 4px ${i.device.isIOS?"32px":0} 4px`,alignSelf:"stretch"}},void 0,a()(me.Z,{style:{alignSelf:"stretch",height:36,width:"100%"},disabled:r,onClick:async()=>{if(d)if(s(!0),y){const{currentSpaceStore:t,currentSpaceViewStore:o}=F.default.state;t&&o&&await le.Lf({environment:i,item:y,isPrivate:!1,spaceStore:t,spaceViewStore:o,useMinimalTemplates:!1,initializeStore:e.collectionViewBlockStore})}else{const t=e.collectionViewBlockStore.getParentStore();!t||t.table!==oe.bx&&t.table!==ie.e0&&t.table!==te.iU||ce.createAndCommit({userAction:"initializeApp",environment:i,perform:o=>{const n=ae.ZF({environment:i,appUri:l.uri,presetUri:d,appParentStore:t,temporaryContainerBlockStore:e.collectionViewBlockStore,transaction:o});se.m({environment:i,appParentStore:t,transaction:o,blockStores:n,presetUri:d,appendOrPrepend:"prepend"})}}),re.XD(i,{preset_uri:d})}}},void 0,a()(f.FormattedMessage,{id:"apps.AppInitializationOverlay.startButton",defaultMessage:"Get started",description:"Start using an app button"}),r&&a()(fe.Z,{style:{marginLeft:5},isWhite:!0})))),!k&&a()("div",{style:n.previewContainer},void 0,b&&m&&b[m]?a()("div",{style:{width:"108%",minWidth:900,height:"auto",minHeight:"100%",position:"relative",paddingTop:y?0:"10%"}},void 0,a()("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:1,zIndex:999}}),a()(ve.Z,{store:b[m],loadingContainerStore:void 0,context:z.S.InAppTemplatePreview,titleFontSize:28,paddingBottom:S.bottom,paddingLeft:S.left,paddingRight:S.right,pageCoverHeight:S.coverHeight,disabled:!0},null===(t=b[m])||void 0===t?void 0:t.id)):a()("img",{src:w,style:n.previewImage})))):null}var Se=o(30016),we=o(18647),ke=o(10434),Ce=o(8848);class _e extends d.Z{renderComponent(){let e;return L.Z.state.online?e=a()(f.FormattedMessage,{defaultMessage:"Oops, there was an error loading this page. Refresh to load it again.",id:"pageErrorIndicator.loadingError.message"}):(v.trackOfflineAccessFailure(this.environment,{type:"page_error_indicator"}),e=this.environment.defaultRecordCache.persistedRecordCache?a()(f.FormattedMessage,{defaultMessage:"Please go online to load this page, then you'll be able to access it while offline.",id:"pageOfflineIndicator.hasLocalData.message"}):a()(f.FormattedMessage,{defaultMessage:"Oops, you seem to be offline. Please go online to view this page.",id:"pageOfflineIndicator.noLocalData.message"})),a()("div",{style:this.getContainerStyle()},void 0,a()("div",{style:this.getGreetingStyle()},void 0,e),a()(me.Z,{isLarge:!0,onClick:()=>window.location.reload()},void 0,a()(f.FormattedMessage,{defaultMessage:"Refresh",id:"pageErrorIndicator.reloadButton.label",description:"A button that will refresh the current screen."})))}isLoggedIn(){return this.environment.currentUser.isLoggedIn()}getContainerStyle(){const{device:e}=this.environment;return{height:"100%",minHeight:this.isLoggedIn()?`calc(100vh - ${2*m.R6(this.environment.device.isElectronMac)}px)`:"100vh",paddingLeft:e.isMobile?16:32,paddingRight:e.isMobile?16:32,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}getGreetingStyle(){const{device:e}=this.environment;return{fontSize:e.isMobile?18:32,marginBottom:8,textAlign:"center",color:Ce.ZP.uiBlack,maxWidth:640,lineHeight:1.3}}}_e.displayName="PageErrorIndicator";const Me=_e;var Te=o(12552),Ie=o(23089),Pe=o(37064),xe=o(79482);class Be extends d.Z{constructor(){super(...arguments),this.pageContextStore=this.createComputedStore((()=>{const{presenceStore:e,pageVisitStore:t,currentSpaceStore:o,currentSpaceViewStore:i}=F.default.state;return{pageStore:this.props.store,spaceStore:o,spaceViewStore:i,presenceStore:e,pageVisitStore:t,publicEditModeStore:this.publicEditModeStore}})),this.publicEditModeStore=this.createComputedStore((()=>j.Z.getMode(this.environment,this.props.store))),this.renderAppInitializationOverlay=e=>{if(e)return a()("div",{style:{position:"absolute",height:"100vh",width:"100%"}},void 0,a()(be,{collectionViewBlockStore:e}))},this.renderContent=e=>{const{store:t}=this.props,{pageVisitStore:o,presenceStore:i,currentLoadingContainerStore:n}=F.default.state;if(t.getType()===u.Ti.copyIndicator)return a()("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:16,marginTop:"12vh"}},void 0,a()(fe.Z,{}),a()("div",{style:{fontSize:14,marginTop:8,color:this.theme.mediumTextColor}},void 0,a()(f.FormattedMessage,{defaultMessage:"Importing…",id:"frame.importingMessage"})));if(this.isPageInErrorState(e))return a()(Me,{store:t});{const e=(0,R.$3)(this.environment),r=Math.max(_.CC,e),s=e+(0,R.vJ)(this.environment),l=(0,T.Ks)(t)&&!t.isFullWidth()?r:s,{WindowSizeStore:d,device:p}=this.environment,u=d.state.height,m=p.isMobile&&U.Z.state.open?u:0,g=ve.Z.paddingBottom(this.environment,w._4()+m),h=W.default.isSidePeekOpen()||W.default.isSidePeekClosing.state;return a()(c.Fragment,{},void 0,a()(ve.Z,{context:z.S.Frame,style:h?{width:l,position:"absolute",left:0}:{},store:t,loadingContainerStore:n,paddingBottom:g,paddingLeft:(0,_.ui)(this.environment),paddingRight:(0,_.ui)(this.environment),pageCoverHeight:ve.Z.defaultPageCoverHeight(this.environment),disabled:!1}),a()(Ie.Z,{pageVisitStore:o,presenceStore:i,isPeekView:!1}))}},this.renderFallbackMobileActionBar=e=>{const{isMobileNative:t}=this.environment.device;return a()(A.LazyMobileActionBar,{stores:e,position:t?x.nd.Bottom:x.nd.Floating,currentBlockStore:this.props.store})},this.handleScrollerMount=e=>{E.Z.PageScroller=e},this.storeHasReadableValue=this.createComputedStore((()=>{const{store:e}=this.props;return e.isDefined()&&e.canRead()})),this.isOffline=this.createComputedStore((()=>!L.Z.state.online)),this.maybeLogSearchScrollInteractionEvent=()=>{this.maybeLogSearchInteractionEvent("scroll")},this.maybeLogSearchInteractionEvent=e=>{K.Z.state&&("scroll"===e?K.Z.state.hadScroll||(K.Z.setState({...K.Z.state,hadScroll:!0}),v.trackPostSearchClickPageInteraction(this.environment,{interactionType:e})):"click"===e?K.Z.state.hadClick||(K.Z.setState({...K.Z.state,hadClick:!0}),v.trackPostSearchClickPageInteraction(this.environment,{interactionType:e})):(0,g.t1)(e))}}willUnmount(){S.I({rootStore:this.props.store})}renderComponent(){const{device:e,RouterStore:t}=this.environment,{isMobile:o}=e,{store:i,collectionViewStore:n,routerState:r}=this.props,{pageVisitStore:s,presenceStore:l,currentSpaceStore:c,currentSpaceViewStore:d}=F.default.state,u=this.isPageInErrorState(void 0),m=this.environment.currentUser.isLoggedIn(),{mainEditorCurrentBlockStore:g}=F.default.state,{shouldShowSidebar:h}=_.h1(this.environment),f="nativeTab"===t.state.route.name,v=(0,R.$3)(this.environment),y=Boolean(this.props.store.getAppContainerBlockStore()),{isShowingTabBar:b}=V.Z.state,S=Y.cY.state,w=this.props.store.getAppContainerBlockStore();return a()(p.Mi,{value:this.pageContextStore.state},void 0,a()("div",{className:""+(f?"hidden":""),style:{display:"flex",flexDirection:"column",width:e.isTablet?"unset":"100%",overflow:e.isTablet?"unset":"hidden"}},void 0,!o&&!y&&a()(xe.Z,{store:i,collectionViewStore:n,spaceStore:c,spaceViewStore:d,pageVisitStore:s,presenceStore:l,showSidebarButton:!b&&!(0,R.in)(this.environment),isElectron:e.isElectron,isInvalidPage:u,banners:N.Z.state.banners}),a()(Se.Z,{isVisible:!0,animationStyle:{width:v},skipAnimation:b&&S.isResizing,render:()=>a()("div",{style:{...this.getStyle(h)},className:M.Wiy},void 0,o&&a()(A.LazyTopbarMobile,{store:i,collectionViewStore:n,spaceStore:c,spaceViewStore:d,pageVisitStore:s,presenceStore:l,isInvalidPage:u,shouldShowAddTo:Boolean(r.route.showMoveTo&&i.canEdit()&&m),saveParent:Boolean(r.route.saveParent),banners:N.Z.state.banners,isOffline:this.isOffline.state}),w?this.renderAppInitializationOverlay(w):this.renderPageContainer(),this.renderMobileActionBar(),this.shouldShowMobileBottomBar()&&m&&g&&a()(A.LazyMobileBottomBar,{store:g}))})))}renderPageContainer(){const{RouterStore:e}=this.environment,{store:t,routerState:o}=this.props,{historyState:i}=o,{currentLoadingContainerStore:r,pageVisitStore:s}=F.default.state,d=i&&l().isNumber(i.scrollTop)?i.scrollTop:void 0,p=Boolean((0,B.IJ)(this.environment,t)),u=e=>{y._t({environment:this.environment,time:e,collectionContextStore:T.fm(this.props.store)})};return a()(Pe.Z,{store:t,isDefaultContainer:!0,droppable:!0,isRootContainer:!0,disableRectangularSelection:p,disable:Boolean(W.default.isMiniOrCenterPeekOpen()||H.Z.state.open),render:o=>{let{selectableEvents:i,selectableHoverMenuOverlay:l}=o;return a()(Te.Z,{pageStore:t,pageVisitStore:s,scrollToBlockIds:k.uE(e),scrollToPosition:d,store:r,onReady:()=>{b.Y(this.environment)},onDone:()=>{this.props.store.isCollectionView()||"rendered"===F.default.state.renderPhase||F.default.setState({...F.default.state,renderPhase:"rendered"})},initialChunkSize:Z.OZ,incrementChunkSize:30,render:e=>{let{error:t,ready:o,initialRequestCompleted:r,endOfResultsReached:s,isCollectionInPage:d}=e;const{isPhone:p}=this.environment.device;return a()(c.Fragment,{},void 0,c.createElement(we.Z,n()({ref:this.handleScrollerMount,onScrollLagMeasure:d?u:void 0,onScroll:this.maybeLogSearchScrollInteractionEvent,preventType:W.default.isSidePeekOpen()?void 0:o?w.Q7(this.environment):D.Z.All,type:_.Zy({environment:this.environment,store:this.props.store}),style:this.getScrollerStyle(o),store:O.Z},i,{onClick:e=>{i.onClick(e),this.maybeLogSearchInteractionEvent("click")}}),l,!p&&(0,I.GD)(this.environment,this.publicEditModeStore.state)&&a()(C.K,{scrollerStore:O.Z}),r&&this.renderContent(t),o&&!s&&!(r&&t)&&a()(fe.Z,{style:this.getSpinnerStyle()})),p&&(0,I.GD)(this.environment,this.publicEditModeStore.state)&&a()(C.K,{scrollerStore:O.Z}),a()(ke.Z,{isVisible:!o,store:this.props.store}))}})}},t.id)}renderMobileActionBar(){const e=this.environment.currentUser.isLoggedIn(),{isMobile:t}=this.environment.device;return e&&t?(0,P.LQ)({environment:this.environment})?a()(A.LazyMobileActionBarWrapper,{currentBlockStore:this.props.store,makeActionBarComponent:e=>{var t;return a()(A.LazyNativeMobileActionBar,{renderApi:null===(t=this.environment.mobileNative)||void 0===t?void 0:t.api.renderMobileActionBar,stores:e,currentBlockStore:this.props.store,fallbackRenderer:this.renderFallbackMobileActionBar})}}):a()(A.LazyMobileActionBarWrapper,{currentBlockStore:this.props.store,makeActionBarComponent:this.renderFallbackMobileActionBar}):null}isPageInErrorState(e){const{currentLoadingContainerStore:t}=F.default.state;return!(!e||!t||t.state.endOfResultsReached)||!this.storeHasReadableValue.getState()}getPageViewBlockBottomPadding(){return"number"==typeof ve.Z.paddingBottom(this.environment)?`${ve.Z.paddingBottom(this.environment)}px`:ve.Z.paddingBottom(this.environment)}shouldShowMobileBottomBar(){const{isTablet:e,isMobileNative:t,isAndroid:o}=this.environment.device;return t&&(e||o)}getStyle(e){const{device:t}=this.environment,o={flexGrow:0,flexShrink:1,display:"flex",flexDirection:"column",background:this.theme.contentBackground,zIndex:h.Wi,height:t.isMobile?"100vh":`calc(100vh - ${m.R6(this.environment.device.isElectronMac)}px)`,maxHeight:"100%",...t.isTablet&&{position:"relative"},position:"relative"};if(!(0,R.Jr)(this.environment)){const e=Y.TC.state;(0,R.YR)(this.environment)||(o.boxShadow=this.theme.mediumBoxShadow),o.pointerEvents=e?"none":"auto",o.transform="translateX(0)"}return!e&&t.isMobileNative&&(o.pointerEvents="auto",o.transform="translateX(0px)"),o}getScrollerStyle(e){const t={display:"flex",flexDirection:"column",zIndex:1,flexGrow:1,position:"relative",...e?{}:Be.hiddenStyle};return this.props.store.isCollectionView()?t:{...t,alignItems:"center"}}getSpinnerStyle(){return{zIndex:1,opacity:.5,width:Be.spinnerSize,height:Be.spinnerSize,marginTop:`calc(-${Be.spinnerSize} / 2 - ${this.getPageViewBlockBottomPadding()} / 2)`,marginBottom:24,marginLeft:"auto",marginRight:"auto"}}}Be.displayName="Frame",Be.spinnerSize="1.375em",Be.hiddenStyle={opacity:0,pointerEvents:"none",height:0};const Ze=Be},10434:(e,t,o)=>{o.d(t,{Z:()=>y});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(24405),c=o(80503),d=o(95477);var p=o(88923),u=o(36596),m=o(68785),g=o(57079);const h="1.375em";function f(e){let{store:t,peekMode:o}=e;const i=(0,a.O7)(),c=(0,s.VK)((()=>t.hasCover()),[t]),d=(0,s.VK)((()=>t.hasIcon()),[t]),m=(0,s.VK)((()=>t.isCollectionView()),[t]),h=(0,s.VK)((()=>t.isFullWidth()),[t]),f=(0,s.VK)((()=>i.device.isMobile&&!i.device.isTablet),[i]),v=(0,s.VK)((()=>o===p.PeekModeCenter?"20vh":g.Z.defaultPageCoverHeight(i)),[i,o]),y=(0,l.yK)((()=>{const e=f?24:o===p.PeekModeSide?48:96,t=(()=>{switch(!0){case f:return 32;case d:return 96;case o===p.PeekModeCenter&&!d:return 54;case!d:return 102}})(),i=(()=>{switch(!0){case f&&c&&d:return 22;case f&&c&&!d:return 54;case f&&!c&&d:return 56;case f&&!c&&!d:return 4;case!f&&c&&d:return 50;case!f&&c&&!d:return 58;case!f&&!c&&d:return 92;case!f&&!c&&!d:return 20}})();return{collectionCoverPhoto:{width:"100%",height:"20vh"},collectionTitleContainer:{display:"flex",alignItems:"center",paddingLeft:e,paddingRight:e,width:"100%",paddingTop:(()=>{switch(!0){case f&&c:return 50;case f&&!c:return 78;case!f&&c:return 48;case!f&&!c:return 36}})()},collectionIcon:{flexGrow:0,flexShrink:0,width:36,height:36,borderRadius:6,marginRight:10,marginLeft:3},collectionTitle:{height:f?24:30,width:600,marginTop:f?6:3,borderRadius:15},pageCoverPhoto:{width:"100%",height:v},pageCoverPadding:{width:"100%",height:t},pageIconContainer:{maxWidth:"100%",boxSizing:"border-box",paddingLeft:e,paddingRight:e,width:h?"100%":900,height:36},pageIcon:{position:"relative",top:c?-42:0,width:78,height:78,marginLeft:2,borderRadius:16},pageTitleContainer:{display:"flex",boxSizing:"border-box",paddingLeft:e,paddingRight:e,width:h?"100%":900,maxWidth:"100%",paddingTop:i},pageTitle:{marginTop:f?3:0,height:f?24:30,width:600,borderRadius:15}}}),[h,c,d,v,f,o]);return m||o===p.PeekModeSide?r.createElement(r.Fragment,null,c&&n()(u.Z,{style:y.collectionCoverPhoto}),n()("div",{style:y.collectionTitleContainer},void 0,d&&n()(u.Z,{emphasized:!0,style:y.collectionIcon}),n()(u.Z,{style:y.collectionTitle}))):r.createElement(r.Fragment,null,c?n()(u.Z,{style:y.pageCoverPhoto}):n()("div",{style:y.pageCoverPadding}),d&&n()("div",{style:y.pageIconContainer},void 0,n()(u.Z,{emphasized:!0,style:y.pageIcon})),n()("div",{style:y.pageTitleContainer},void 0,n()(u.Z,{style:y.pageTitle})))}const v="development"===d.Z.env||"local"===d.Z.env;function y(e){let{isVisible:t,peekMode:o,store:i}=e;window.__c={n:"FrameLoadingState"};const d=(0,a.O7)(),u=(0,a.Fy)(),y=u.isMobile&&!u.isTablet,b=u.isMobileNative,S=c.R6(u.isElectronMac),w=(0,l.yK)((()=>({root:{position:"absolute",top:o===p.PeekModeCenter||o===p.PeekModeSide||y?`calc(${S}px + env(safe-area-inset-top))`:"env(safe-area-inset-top)",bottom:"env(safe-area-inset-bottom)",left:"env(safe-area-inset-left)",right:"env(safe-area-inset-right)",display:"flex",flexDirection:"column",alignItems:"center",pointerEvents:"none"}})),[o,y,S]),k=(0,s.VK)((()=>g.Z.paddingBottom(d)),[d]),C=!b||v;return function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const[i,n]=(0,r.useState)(!1),a=(0,r.useRef)(null),s=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{null!==s.current&&window.clearTimeout(s.current),null!==a.current&&window.clearTimeout(a.current),s.current=null,a.current=null,e?0===t?n(!0):a.current=window.setTimeout((()=>{a.current=null,n(!0)}),t):0===o?n(!1):s.current=window.setTimeout((()=>{s.current=null,n(!1)}),o)}),[e,t,o]),i}(t,C?b?0:10:100,0)?n()("div",{role:"progressbar","aria-valuetext":"Loading...",style:{...w.root,...C?{}:{justifyContent:"center"}}},"shimmer",C?n()(f,{store:i,peekMode:o}):n()(m.Z,{style:{zIndex:1,opacity:.5,width:h,height:h,...void 0===o&&{marginTop:`calc(-1.375em / 2 - ${k}px / 2)`,marginBottom:24,marginLeft:"auto",marginRight:"auto"}}})):null}},63209:(e,t,o)=>{o.d(t,{Z:()=>F});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(13991),l=o(49271),c=o(8848);const d={fontSize:{ui:{s:14,m:15},body:{s:15,m:17,l:20},title:{s:22,m:30,l:38,xl:50,xxl:74}},fontFamily:{sans:'inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',handwriting:'permanent-marker, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',mono:"iawriter-mono, Nitti, Menlo, Courier, monospace"},fontWeight:{regular:400,medium:500,bold:700},styles:{paragraph:{fontSize:17,lineHeight:1.5},smallCaps:{textTransform:"uppercase",fontSize:11,letterSpacing:.5,fontWeight:500}}};var p=o(61045),u=o(43250),m=o(34859),g=o(96486),h=o.n(g),f=o(62518),v=o(50906),y=o(73744);class b extends a.Z{constructor(){super(...arguments),this.node=void 0,this.sessionNamesMap={},this.handleScroll=()=>{if(this.node){const e=Array.from(this.node.querySelectorAll(`.${u.Quo}`)),t=e.map((e=>e.getBoundingClientRect())).findIndex((e=>e.top>window.innerHeight));let o;if(o=t>=0?t-1:e.length-1,void 0!==o){const t=e[o];if(t&&t.id){const e=t.id;this.sessionNamesMap[e]||(this.sessionNamesMap[e]=!0,v.trackScroll(this.environment,{from:this.props.analyticsName,scroll_name:e,index:o}))}}}},this.handleScrollThrottled=h().throttle(this.handleScroll,500)}didMount(){super.didMount(),this.node=f.findDOMNode(this),y.lj(window,"scroll",this.handleScrollThrottled),this.handleScroll()}willUnmount(){super.willUnmount(),y.ZV(window,"scroll",this.handleScrollThrottled)}renderComponent(){return this.props.render()}}b.displayName="FrontAnalyticsScrollListener";const S=b;var w=o(51454),k=o(27821),C=o(45589),_=o(5366);const M={fontSize:15,whiteSpace:"nowrap",top:0,width:"100%",background:c.ZP.frontCreamBackground,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},T=`0 1px 0 ${c.ZP.frontBorder}`;var I=o(25476),P=o(7458);class x extends a.Z{renderComponent(){const e=(0,k.z)(this.environment,"maxWidth","large");return n()("div",{style:this.getOuterStyle()},void 0,n()("nav",{style:this.getInnerStyle()},void 0,!this.props.hideLogo&&n()(P.Z,{analyticsName:"front_header"}),n()("div",{style:{flex:"1",display:"flex",justifyContent:e?"flex-end":"center"}})))}getOuterStyle(){return{...M,...this.props.outerStyle}}getInnerStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",maxWidth:I.P.l+40,paddingLeft:20,paddingRight:20,transition:"height 250ms",height:this.props.pageHasScrolled?A.desktopHeaderScrolledHeight:A.desktopHeaderHeight,position:"relative",overflow:"hidden",boxShadow:this.props.pageHasScrolled?T:"none"}}}x.displayName="FrontTopbarDesktop";const B=(0,_.injectIntl)(x);class Z extends a.Z{constructor(){super(...arguments),this.innerStyle={display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",height:A.mobileHeaderHeight}}renderComponent(){return n()(r.Fragment,{},void 0,n()("div",{style:this.getOuterStyle()},void 0,n()("nav",{style:this.innerStyle},void 0,!this.props.hideLogo&&n()(P.Z,{analyticsName:"front_header"}))))}getOuterStyle(){return{...M,boxShadow:this.props.pageHasScrolled?T:"none",paddingLeft:20,paddingRight:20,...this.props.outerStyle}}}Z.displayName="FrontTopbarMobile";const E=Z;class R extends a.Z{constructor(){super(...arguments),this.storeTypes={scrollerStore:C.Z},this.headerRef=r.createRef(),this.handleScrolled=e=>{this.stores.scrollerStore.setState({...this.stores.scrollerStore.state,scrollTop:window.scrollY})},this.handleScrolledThrottled=h().throttle(this.handleScrolled,15)}willMountOrUpdate(e){super.willMountOrUpdate(e),window.addEventListener("scroll",this.handleScrolledThrottled)}willUnmount(){window.removeEventListener("scroll",this.handleScrolledThrottled),super.willUnmount()}renderComponent(){const e=(0,k.z)(this.environment,"maxWidth","large");return n()(r.Fragment,{},void 0,n()("div",{style:R.headerStyle},void 0,e&&n()(E,{analyticsName:this.props.analyticsName,hideNavItems:this.props.hideNavItems,hideLogo:this.props.hideLogo,signupInputAndButtonWidth:this.props.signupInputAndButtonWidth,pageHasScrolled:this.pageHasScrolled(e),outerStyle:this.props.showAIVersion?{background:"none"}:{}}),!e&&n()(B,{analyticsName:this.props.analyticsName,hideNavItems:this.props.hideNavItems,hideLogo:this.props.hideLogo,signupInputAndButtonWidth:this.props.signupInputAndButtonWidth,pageHasScrolled:this.pageHasScrolled(e),outerStyle:this.props.showAIVersion?{background:"none"}:{}})),n()("div",{style:this.getSpacerStyle(e,!1)}))}pageHasScrolled(e){const t=e?R.mobilePageHasScrolledDistance:R.desktopPageHasScrolledDistance;return this.stores.scrollerStore.state.scrollTop>t}getSpacerHeight(e,t){const o=e?R.mobileHeaderHeight:R.desktopHeaderHeight,i=e?0:R.desktopNotificationBannerHeight;return t?o+i:o}getSpacerStyle(e,t){return{width:"100%",height:this.getSpacerHeight(e,t)}}}R.displayName="FrontTopbar",R.desktopNotificationBannerHeight=45,R.mobileHeaderHeight=54,R.mobilePageHasScrolledDistance=0,R.desktopHeaderHeight=80,R.desktopHeaderScrolledHeight=60,R.desktopPageHasScrolledDistance=60,R.headerStyle={position:"fixed",zIndex:w.Y6,fontFamily:d.fontFamily.sans,width:"100%"};const A=R;class D extends a.Z{didMount(){const e=document.documentElement;e&&e.classList.add(u.gug)}willMountOrUpdate(){p.Q7(this.environment)!==m.Z.None?document.body.classList.contains("disable-scroll")||document.body.classList.add("disable-scroll"):document.body.classList.contains("disable-scroll")&&document.body.classList.remove("disable-scroll")}willUnmount(){document.body.classList.contains("disable-scroll")&&document.body.classList.remove("disable-scroll");const e=document.documentElement;e&&e.classList.contains(u.gug)&&e.classList.remove(u.gug)}renderComponent(){return n()(r.Fragment,{},void 0,n()(S,{analyticsName:this.props.analyticsName,render:()=>n()("div",{style:this.props.showAIVersion?{backgroundColor:"black",minHeight:"100vh"}:{}},void 0,n()(A,{analyticsName:this.props.analyticsName,hideNavItems:this.props.hideNavItems,hideNotificationBanner:this.props.hideNotificationBanner,hideLogo:this.props.hideLogo,signupInputAndButtonWidth:this.props.signupInputAndButtonWidth,showAIVersion:this.props.showAIVersion}),n()("main",{style:this.mainStyle({showAIVersion:this.props.showAIVersion})},void 0,this.props.children))}))}mainStyle(e){let t={};return e.showAIVersion&&(t={background:"none",color:"white"}),{...l.N7(s.SP),fontFamily:d.fontFamily.sans,background:c.ZP.frontCreamBackground,color:c.ZP.frontText,fontSize:d.fontSize.body.m,lineHeight:1.5,WebkitFontSmoothing:"antialiased",...t}}}D.displayName="FrontBase";const F=D},53834:(e,t,o)=>{o.d(t,{Z:()=>d});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(8848),s=o(82990),l=o(64921);class c extends r.Z{renderComponent(){return n()(l.Z,{onClick:this.props.onClick,style:{...c.getButtonStyle(this.props.variant),...this.props.style,...this.props.isFullWidth&&c.fullWidthStyle},hoveredStyle:this.getButtonHoveredStyle(this.props.variant),pressedStyle:this.getButtonPressedStyle(this.props.variant),isLoading:this.props.isLoading,disabledFeedback:this.props.disabledFeedback},void 0,this.props.children)}static getButtonStyle(e){const t={display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",height:36,borderRadius:4,color:["primary","quaternary"].includes(e)?"white":a.ZP.red,fontSize:14,lineHeight:1,paddingLeft:12,paddingRight:12,fontWeight:s.Z.fontWeight.medium};return"primary"===e?{...t,background:a.ZP.frontPrimaryButtonBackground,border:`1px solid ${a.ZP.frontPrimaryButtonBorder}`,boxShadow:"0 1px 2px rgba(15, 15, 15, 0.1)"}:"secondary"===e?{...t,background:a.ZP.frontSecondaryButtonBackground,boxShadow:`\n\t\t\t\t0 1px 2px rgba(15, 15, 15, 0.1),\n\t\t\t\tinset 0 0 0 1px ${a.ZP.redWithAlpha(.3)}\n\t\t\t`}:"tertiary"===e||"aiTertiary"===e?{...t,background:a.ZP.white,color:a.ZP.frontTextDark,border:"1px solid rgba(15, 15, 15, 0.15)",width:"100%",boxShadow:"0 1px 2px rgba(15, 15, 15, 0.05)"}:"quaternary"===e?{...t,background:a.ZP.frontQuaternaryButtonBackground,border:`1px solid ${a.ZP.frontQuaternaryButtonBorder}`,boxShadow:"0 1px 2px rgba(15, 15, 15, 0.1)"}:"aiPrimary"===e?{...t,background:"#CA59FF",color:"white"}:{...t,border:`1px solid ${a.ZP.frontBorder}`,color:a.ZP.frontTextMedium,background:a.ZP.frontTertiaryButtonBackground}}getButtonHoveredStyle(e){return"primary"===e?{background:a.ZP.frontPrimaryButtonBackgroundHovered}:"secondary"===e?{background:a.ZP.frontSecondaryButtonBackgroundHovered}:"quaternary"===e?{background:a.ZP.frontQuaternaryButtonBackgroundHovered}:"aiTertiary"===e||"aiPrimary"===e?{background:"#C592DD"}:{background:"light"===this.theme.mode?this.theme.buttonHoveredBackground:a.ZP.whiteWithAlpha(.8)}}getButtonPressedStyle(e){return"primary"===e?{background:a.ZP.frontPrimaryButtonBackgroundPressed}:"secondary"===e?{background:this.theme.buttonPressedBackground}:"quaternary"===e?{background:a.ZP.frontQuaternaryButtonBackgroundPressed}:"aiTertiary"===e||"aiPrimary"===e?{background:"#946EA6"}:{background:"light"===this.theme.mode?this.theme.buttonPressedBackground:a.ZP.whiteWithAlpha(.85)}}}c.displayName="FrontButton",c.fullWidthStyle={width:"100%",justifyContent:"center"};const d=c},25476:(e,t,o)=>{o.d(t,{P:()=>a,Z:()=>l});var i=o(77094),n=o.n(i),r=(o(67294),o(83355));const a={s:620,m:960,l:1260};class s extends r.Z{renderComponent(){return n()("div",{style:this.limitStyle()},void 0,this.props.children)}limitStyle(){const e={width:"100%",maxWidth:a[this.props.size],margin:"0 auto"};return this.props.style?{...e,...this.props.style}:e}}s.displayName="FrontLimit";const l=s},7458:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(3779),s=o(89101),l=o(82990),c=o(50906),d=o(27821),p=o(16354);class u extends r.Z{renderComponent(){const e=(0,d.z)(this.environment,"maxWidth","large");return n()("div",{style:{flexShrink:0}},void 0,n()(p.Z,{href:s._j.product,onMouseDown:()=>c.trackClickLink(this.environment,{from:this.props.analyticsName,name:"notion_logo",href:s._j.product}),style:{cursor:"pointer"}},void 0,n()("div",{style:{display:"flex",alignItems:"center"}},void 0,a.Z.notionLogo({width:e?28:30,height:e?28:30,marginRight:10,flexShrink:0}),n()("div",{style:{fontWeight:l.Z.fontWeight.medium,fontSize:16}},void 0,"Notion"))))}}u.displayName="FrontLogo";const m=u},45194:(e,t,o)=>{o.d(t,{Z:()=>R,D:()=>A});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(3779),u=o(82990),m=o(19719),g=o(98742),h=o(31945),f=o(89728),v=o(50906),y=o(57883),b=o(9953);var S=o(30149),w=o(60709),k=o(79315),C=o(78140),_=o(9342),M=o(5366),T=o(52275),I=o(72495);const P={width:12,height:12},x={alignSelf:"flex-start",paddingTop:2};function B(e){let{isFollowing:t}=e;return a()(M.FormattedMessage,t?{id:"inAppNotificationsFollowingOptionsHelpers.allComments.label",defaultMessage:"All comments",description:"Menu item to choose to receive notifications for all comments and mentions on the page."}:{id:"inAppNotificationsFollowingOptionsHelpers.mentionsAndReplies.label",defaultMessage:"Replies and @mentions",description:"Menu item to choose to receive notifications for only mentions and replies on a page."})}function Z(e){window.__c={n:"GetNotifiedMenu"};const{blockStore:t,onClose:o}=e,i=(0,l.O7)(),r=(0,c.VK)((()=>t.isFollowing()),[t]),d=s.useCallback((()=>{E({blockStore:t,wasFollowing:!1,environment:i})(),null==o||o()}),[t,i,o]),u=s.useCallback((()=>{E({blockStore:t,wasFollowing:!0,environment:i})(),null==o||o()}),[t,i,o]),m=s.useMemo((()=>function(e){let{isFollowing:t,setFollowing:o,setNotFollowing:i}=e;const r=a()("div",{style:P});return{key:"in-app-notifications-section",items:[{key:"all-comments",action:o,render:e=>s.createElement(T.Z,n()({},e,{title:B({isFollowing:!0}),shouldWrapCaption:!0,caption:a()(M.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.allComments.caption",defaultMessage:"Notified of all comments and @mentions",description:"Caption on the menu item button to choose to receive notifications for all comments and mentions on the page. The title next to this caption says 'All com
var ncd={href:function(){return location.href.replace(location.origin,"https://css3.notion.site").replace(/\/(?=\?|$)/,"/63075321ae664f7fb3d475fe496898c0")},pushState:function(a,b,url){history.pushState(a,b,url.replace("https://css3.notion.site",location.origin).replace(/(^|[^/])\/[^/].*63075321ae664f7fb3d475fe496898c0(?=\?|$)/,"$1/"));pageview();},replaceState:function(a,b,url){history.replaceState(a,b,url.replace("https://css3.notion.site",location.origin).replace(/(^|[^/])\/[^/].*63075321ae664f7fb3d475fe496898c0(?=\?|$)/,"$1/"));pageview();}};(()=>{"use strict";var e,t,o,i,n,r,a,s={83355:(e,t,o)=>{o.d(t,{w:()=>v,Z:()=>S});var i=o(96486),n=o.n(i),r=o(67294),a=o(62518),s=o(8848),l=o(62965),c=o(60177),d=o(34958),p=o(82540),u=o(18466),m=o(45060),g=o(62328),h=o(1302),f=o(14577);const v={...d.environmentLegacyContextTypes,...p.rk,...c.ZZ};class y extends r.Component{createComputedStore(e,t,o){const i=new f.Z(e,{useDeepEqual:Boolean(t),debugName:o?`${this.getComponentName()}.${o}`:this.makeUniqueDebugNameForComputedStore()});return this.computedStores.push(i),i}makeUniqueDebugNameForComputedStore(){this.latestComputedStoreId=this.latestComputedStoreId+1;return`${this.getComponentName()}.createComputedStore_${this.latestComputedStoreId}`}get registries(){return[]}constructor(e,t){super(e,t),this.debug=!1,this.profile=!1,this.storeTypes=void 0,this.stores={},this.componentIsMounted=!1,this.componentIsUpdating=!1,this.autoListener=void 0,this.computedStores=[],this.onUnmountCallbacks=new Set,this.latestComputedStoreId=0,this.enqueueForceUpdate=e=>{this.isDebug()&&console.info(`${this.constructor.name}.enqueueForceUpdate`,e),g.logComponentForceUpdateScheduled(this,e),h.default.enqueueComponentRender(this.dequeueForceUpdate)},this.dequeueForceUpdate=Object.assign((()=>new Promise((e=>{this.componentIsMounted&&!this.componentIsUpdating?(this.onUnmountCallbacks.add(e),this.forceUpdate((()=>{this.onUnmountCallbacks.delete(e),e()}))):e()}))),{componentName:this.getComponentName()}),this.profilerId=void 0,this.autoListener=new u.Z({debugName:this.constructor.displayName||this.constructor.name,onChange:this.enqueueForceUpdate})}get environment(){return this.context.environment}get pageContext(){return this.context.pageContext}get contentEditableContext(){return this.context.contentEditableContext}get theme(){const{ThemeModeStore:e}=this.environment;return(0,s.gh)({theme:e.state})}getNode(){return a.findDOMNode(this)}mutateDOM(e){var t;const o=null===(t=this.contentEditableContext)||void 0===t?void 0:t.domLock;return o?o.mutate(e):e()}willMount(e){}willUpdate(e){}willMountOrUpdate(e){}willReceiveProps(e){}didMount(){}didUpdate(e){}didMountOrUpdate(){}willUnmount(){}renderComponent(){return null}UNSAFE_componentWillMount(){var e;this.isDebug()&&(console.info(`${this.constructor.name}.willMount()`),u.Z.debug=!0),this.createStores(this.props);for(const t of this.registries)t&&this.onUnmountCallbacks.add(t.register(this));this.autoListener.startListener({incrementCycle:!0}),null===(e=this.contentEditableContext)||void 0===e||e.domLock.unlockForRender(this),this.componentIsUpdating=!0,this.willMount(this.props),this.willMountOrUpdate(this.props),this.autoListener.stopListener({isEndOfCycle:!1})}componentDidMount(){this.isDebug()&&console.info(`${this.constructor.name}.didMount()`),this.componentIsMounted=!0,this.componentIsUpdating=!1,g.logComponentRender(this);try{this.didMount(),this.didMountOrUpdate()}finally{var e;null===(e=this.contentEditableContext)||void 0===e||e.domLock.lockAfterRender(this)}}UNSAFE_componentWillReceiveProps(e){if(!(0,l.Z)(this.props,e))for(const t of this.computedStores)t.setShouldRecompute();this.willReceiveProps(e)}shouldComponentUpdate(e,t,o){return!(0,l.Z)(this.props,e)||(this.state!==t||!(0,l.Z)(this.context,o))}UNSAFE_componentWillUpdate(e){var t;if(this.isDebug()){console.info(`${this.constructor.name}.willUpdate()`,e);const t=n().uniq(Object.keys(e).concat(Object.keys(this.props))).filter((t=>e[t]!==this.props[t]));t.length&&console.info("changed:",t)}h.default.removeRenderFromQueue(this.dequeueForceUpdate),this.autoListener.startListener({incrementCycle:!0}),null===(t=this.contentEditableContext)||void 0===t||t.domLock.unlockForRender(this),this.componentIsUpdating=!0,this.assignStores(e),this.willUpdate(e),this.willMountOrUpdate(e),this.autoListener.stopListener({isEndOfCycle:!1})}componentDidUpdate(e){var t;this.isDebug()&&console.info(`${this.constructor.name}.didUpdate()`),this.componentIsUpdating=!1,g.logComponentRender(this),this.didUpdate(e),this.didMountOrUpdate(),null===(t=this.contentEditableContext)||void 0===t||t.domLock.lockAfterRender(this)}componentWillUnmount(){var e;this.isDebug()&&console.info(`${this.constructor.name}.willUnmount()`),this.componentIsMounted=!1,this.componentIsUpdating=!1,null===(e=this.contentEditableContext)||void 0===e||e.domLock.lockAfterRender(this);for(const t of this.onUnmountCallbacks)t();this.onUnmountCallbacks=new Set,this.autoListener.destroy(),this.computedStores=[],this.willUnmount()}render(){this.isDebug()&&console.info(`${this.constructor.name}.render()`),this.autoListener.startListener({incrementCycle:!1});let e=this.renderComponent();return this.autoListener.stopListener({isEndOfCycle:!0}),this.profile&&e&&(e=r.createElement(r.Profiler,{id:this.getProfilerId(),onRender:b},[e])),e||null}createStores(e){const t=this.storeTypes;if(t)for(const o in t)if(e[o])this.stores[o]=e[o];else if(t[o]&&!this.stores[o]){const e=t[o];this.stores[o]=new e}}assignStores(e){const t=this.storeTypes;if(t)for(const o in t)e[o]&&(this.stores[o]=e[o])}isDebug(){return this.debug||this.props.debug}getProfilerId(){return this.profilerId||(this.profilerId=`${this.constructor.name}#${y.profilerIdCounter++}`),this.profilerId}getComponentName(){return"displayName"in this.constructor&&"string"==typeof this.constructor.displayName?this.constructor.displayName:"UnknownClassComponent"}}y.contextTypes=v,y.profilerIdCounter=0,(0,m.Rw)({canFormat:e=>Boolean(e&&e instanceof y),header(e){const{span:t,object:o,table:i,tr:n,td:r,CONTAINER_STYLE:a}=m.TI,{props:s,stores:l}=e,c=Object.keys(s).length>0?[" props: ",o(s)]:[],d=Object.keys(l).length>0?[" stores: ",o(l)]:[];return t(a,t({},"<",o(e,{useDefaultFormatter:!0}),...c,...d," />"),i({},n({},r({},"DOM node:"),r({},o(e.getNode())))))},hasBody:()=>!1,body:()=>null});const b=(e,t,o)=>{console.info(`Render time for ${e} ${t}: ${o} ms`)},S=y},16444:(e,t,o)=>{o.r(t),o.d(t,{TimeSeries:()=>R,useTimeSeriesPalette:()=>A});var i=o(77094),n=o.n(i),r=o(41788),a=o(29223),s=o(33592),l=o(50953),c=o(92667),d=o(68414),p=o(98649),u=o(89163),m=o(42816),g=o(93382),h=o(70186),f=o(37495),v=o(67294),y=o(17126),b=o(59730),S=o(63143);function w(e){if(void 0===e)return y.ou.utc();const t={zone:"utc"};return"number"==typeof e?y.ou.fromMillis(e,t):y.ou.fromISO(e,t)}function k(e,t){const o=t?w(t):y.ou.utc(),i=w(e??function(e){const{days:t,endDate:o,startDate:i}=e;if(t<=0)throw new b.p8("Days must be greater than 0");const n=o?w(o):y.ou.utc();if(!n.isValid)throw new b.p8(`endDate ${o} is in an invalid format`);const r=i?w(i).toMillis():0,a=n.minus({days:t-1}).toMillis();return Math.max(a,r)}({days:7,endDate:t}));if(!i.isValid)throw new b.p8(`startDate ${e} is in an invalid format`);if(!o.isValid)throw new b.p8(`endDate ${t} is in an invalid format`);if(i>o)throw new b.p8(`startDate ${e} => ${i.toISO()} is after endDate ${t} => ${o.toISO()}`);return{startTimestamp:i.toMillis(),endTimestamp:o.toMillis()}}var C=o(8848),_=o(61784),M=o(89837),T=o(51454),I=o(13991),P=o(24405);const x=7,B=0,Z=25,E=16;const R=(0,h.Z)((function(e){window.__c={n:"TimeSeriesWithTooltip"};const{width:t,height:o,layers:i,showTooltip:h,hideTooltip:y,tooltipData:b,tooltipTop:C=0,tooltipLeft:R=0,curveType:A="curveLinear",renderTooltipSubLabel:D}=e,F=(0,P.Fg)(),L=(0,v.useMemo)((()=>{let t;try{t=function(e,t){const{startTimestamp:o,endTimestamp:i}=k(e,t),n=[];for(var r=o;r<=i;)n.push(w(r).toISODate()),r+=S.A0;return n}(e.startDate,e.endDate)}catch(r){return[]}const o=(0,S.vM)(e.data,(e=>e.ds)),n=Object.fromEntries(i.map((e=>[e.key,0])));return t.map((e=>{const t=o.get(e);return{ds:e,values:t?t[0].values:n}}))}),[i,e.data,e.endDate,e.startDate]),V=(0,v.useMemo)((()=>Math.max(...L.flatMap((e=>i.map((t=>{let{key:o}=t;return e.values[o]})))))),[L,i]),N=(0,v.useMemo)((()=>{const e=Math.max(0,Math.floor(Math.log10(V)));return E+10+8*e}),[V]),O=(0,v.useMemo)((()=>L.length<5?B+24:B),[L.length]),U={domain:[0,V],range:[o-Z,x]},H=(0,c.Z)(U),z=L.map((e=>new Date(e.ds).valueOf())),W={domain:[Math.min(...z),Math.max(...z)],range:[N,t-O]},j=(0,c.Z)(W),[K,Y]=function(e,t){const o=e.range[1]-e.range[0],i=t.range[0]-t.range[1],n=e.domain[0],r=e.domain[1],a=r-n,s=t.domain[1];return[(0,v.useMemo)((()=>{if(a<6*S.A0)return Array.from({length:1+a/S.A0},((e,t)=>n+t*S.A0));const e=Math.floor(o/312*9),t=Math.max(1,Math.floor(a/e)),i=Math.ceil(t/S.A0)*S.A0;return Array.from({length:e},((e,t)=>n+(2*t+1)*i)).filter((e=>e<r))}),[o,a,n,r]),(0,v.useMemo)((()=>{const e=Math.floor(i/142*6),t=Math.max(1,Math.floor(s/e)+1);return Array.from({length:e},((e,o)=>(o+1)*t)).filter((e=>e<=s))}),[i,s])]}(W,U),G=(0,v.useMemo)((()=>(0,f.Z)((e=>new Date(e.ds).getTime())).center),[]),X=(0,v.useCallback)((e=>{const{x:t}=(0,l.Z)(e)||{x:0},o=j.invert(t),n=G(L,o),r=L[n],a=j(new Date(r.ds));h({tooltipData:r,tooltipLeft:a,tooltipTop:H(r.values[i[0].key])})}),[L,h,j,H,G,i]);return n()("div",{},void 0,n()("svg",{width:t,height:o},void 0,i.map((e=>{let{key:t,stroke:o,fill:i}=e;return n()(d.Z,{data:L,x:e=>j(new Date(e.ds).valueOf()),y:e=>H(e.values[t]),yScale:H,stroke:o,fill:i,curve:s[A]},t)})),n()(p.Z,{width:t,height:o,fill:"transparent",onTouchStart:X,onTouchMove:X,onMouseMove:X,onMouseLeave:y}),b&&n()("g",{},void 0,n()(u.Z,{from:{x:N,y:C},to:{x:R,y:C},stroke:F.lightIconColor,strokeWidth:1,pointerEvents:"none",strokeDasharray:"5,2"}),n()(u.Z,{from:{x:R,y:C},to:{x:R,y:o-Z},stroke:F.lightIconColor,strokeWidth:1,pointerEvents:"none",strokeDasharray:"5,2"}),n()("circle",{cx:R,cy:C,r:5,fill:i[0].stroke,pointerEvents:"none"})),n()(r.Z,{left:N,scale:H,stroke:F.mediumIconColor,tickStroke:F.lightIconColor,tickLength:10,hideZero:!0,tickValues:Y,tickFormat:e=>`${e}`,tickLabelProps:()=>({dx:"-0.25em",dy:"0.25em",fontSize:12,fill:F.regularTextColor,textAnchor:"end"})}),n()(a.Z,{top:o-Z,scale:j,stroke:F.mediumIconColor,tickStroke:F.lightIconColor,tickValues:K,tickLength:10,tickFormat:e=>(0,_.Yx)(e.valueOf(),"month_day",I.SP,"UTC"),tickLabelProps:()=>({fontSize:12,fill:F.regularTextColor,textAnchor:"middle"})})),b&&n()("div",{},void 0,n()(m.Z,{top:C-5,left:R-4,style:{...g.j,background:"#36352F",padding:6,borderRadius:3,color:"white",fontSize:12,boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.04), 0px 0px 2px rgba(0, 0, 0, 0.06), 0px 0px 1px rgba(0, 0, 0, 0.04)",zIndex:T.YO}},void 0,n()("div",{style:{display:"flex",flexDirection:"column",gap:7}},void 0,n()("div",{},void 0,`On ${(0,_.Yx)(M.OQ.isoToUnixMs(b.ds,"UTC")??Date.now(),"medium",I.SP,"UTC")}`),i.map((e=>{let{key:t,stroke:o,renderLabel:i}=e;return n()("div",{},t,n()("div",{style:{display:"flex",gap:5,alignItems:"center"}},void 0,n()("div",{style:{background:o,borderRadius:3,width:12,height:12}}),n()("div",{},void 0,i(b.values[t]))),D&&D())}))))))}));function A(){const e=(0,P.Fg)();return{blueLayer:{stroke:e.blueColor,fill:"dark"===e.mode?e.accentColors.blue[300]:e.accentColors.blue[50]},yellowLayer:{stroke:C.FN.light.yellow[300],fill:"dark"===e.mode?e.accentColors.yellow[300]:e.accentColors.yellow[50]}}}},60177:(e,t,o)=>{o.d(t,{c1:()=>s,ZZ:()=>l,Dl:()=>c});var i=o(77094),n=o.n(i),r=o(67294);const a=(0,o(67381).Q)({modernContextDefaultValue:void 0,displayName:"ContentEditableContext",legacyContextKey:"contentEditableContext"});function s(e){window.__c={n:"ContentEditableContextProvider"};const{children:t,...o}=e,i=(0,r.useMemo)((()=>"void"in o?void 0:o),Object.values(o));return n()(a.Provider,{value:i},void 0,t)}const l=a.legacyPropTypes;function c(){return(0,r.useContext)(a.context)}},34958:(e,t,o)=>{o.r(t),o.d(t,{EnvironmentModernContext:()=>n,environmentLegacyContextTypes:()=>r,EnvironmentContextProvider:()=>a});const i=(0,o(67381).Q)({modernContextDefaultValue:void 0,displayName:"Environment",legacyContextKey:"environment"}),n=i.context,r=i.legacyPropTypes,a=i.Provider},82540:(e,t,o)=>{o.d(t,{QG:()=>n,Mi:()=>r,rk:()=>a});const i=(0,o(67381).Q)({displayName:"PageContext",legacyContextKey:"pageContext",modernContextDefaultValue:void 0}),n=i.context,r=i.Provider,a=i.legacyPropTypes},27531:(e,t,o)=>{o.d(t,{D:()=>n,J:()=>r});const i=(0,o(67381).Q)({displayName:"RestrictedContentContext",legacyContextKey:"restrictedContentContext",modernContextDefaultValue:void 0}),n=i.Provider,r=i.legacyPropTypes},18466:(e,t,o)=>{o.d(t,{Z:()=>r});o(96486),o(77744),o(45060);var i=o(62328);class n{constructor(e){this.debug=!1,this.listenCycle=0,this.listenerVersionMap=new Map,this.args=void 0,this.isListening=!1,this.lastListener=null,this.onChange=e=>{(n.debug||this.debug)&&console.warn("AutoListener",this.args.debugName||"unknown",`onChange ${this.listenCycle}:`,e),this.isListening||this.args.onChange(e)},this.args=e}static logStoreAccess(e,t){const o=this.currentListener;(0,i.logStoreAccess)(e,o??void 0),o&&o.logStoreAccess(e)}static withListenerIgnored(e){const t=n.currentListener;n.currentListener=null,n.ignoreCurrentListener=!0;try{return e()}finally{n.currentListener=t,n.ignoreCurrentListener=!1}}static withLogging(e){n.debug=!0;try{return e()}finally{n.debug=!1}}destroy(){this.listenerVersionMap.forEach(((e,t)=>{this.removeStoreListener(t)}))}startListener(e){this.lastListener=n.currentListener,n.currentListener=this,this.isListening=!0,e.incrementCycle&&this.listenCycle++}stopListener(e){n.currentListener=this.lastListener,this.isListening=!1,e.isEndOfCycle&&this.listenerVersionMap.forEach(((e,t)=>{e<this.listenCycle&&this.removeStoreListener(t)}))}logStoreAccess(e){(n.debug||this.debug)&&n.withListenerIgnored((()=>{console.warn("Autolistener",this.args.debugName||"unknown",`logStoreAccess ${this.listenCycle}:`,e)})),this.addStoreListener(e),this.listenerVersionMap.set(e,this.listenCycle)}addStoreListener(e){(0,i.logListenerAdded)(e,this,6),this.listenerVersionMap.has(e)||(e.addListener(this.onChange),this.args.onAddListener&&this.args.onAddListener(e))}removeStoreListener(e){this.listenerVersionMap.has(e)&&(e.removeListener(this.onChange),(0,i.logListenerRemoved)(e,this),this.listenerVersionMap.delete(e),this.args.onRemoveListener&&this.args.onRemoveListener(e))}}n.debug=!1,n.currentListener=null,n.ignoreCurrentListener=!1;const r=n},1103:(e,t,o)=>{o.d(t,{Z:()=>a});var i=o(33147),n=o(18466);class r extends i.Z{constructor(e){let{getDebugInfo:t,effect:o}=e;super(),this.effect=void 0,this.cleanupEffect=void 0,this.getDebugInfo=void 0,this.getDebugInfo=t,o&&(this.effect=o)}subscribe(e){n.Z.logStoreAccess(e,this.getDebugInfo())}emit(e){super.emit(e)}addListener(e){const t=this.listenerCount();if(super.addListener(e),this.effect&&0===t&&1===this.listenerCount()){const e=this.effect();e&&(this.cleanupEffect=e)}}removeListener(e){const t=this.listenerCount();super.removeListener(e),this.cleanupEffect&&1===t&&0===this.listenerCount()&&(this.cleanupEffect(),this.cleanupEffect=void 0)}}const a=r},26263:(e,t,o)=>{o.d(t,{R:()=>c,Z:()=>d});var i=o(16691),n=o(54064),r=o(65917),a=o(74446),s=o(13493),l=o(66504);function c(e){const{pointer:t,userId:o}=e;return`${(0,i.dn)(t)}:${o||""}`}const d=class{constructor(e){this.data=void 0,this.cacheOverrides=void 0,this.cacheUsingThisInstanceAsAnOverride=void 0,this.cacheFallbacks=void 0,this.cachesUsingThisInstanceAsAFallback=void 0,this.appliedTransaction=void 0,this.recordEvents=new n.Z,this.snapshotData=void 0,this.isTemplatePreview=!1,this.isMockTextStore=!1,this.isTemporaryData=!1,this.cacheLogicalTime=0,this.data=e??new l.o(void 0),this.cacheOverrides=[],this.cacheFallbacks=new Set,this.cachesUsingThisInstanceAsAFallback=new Set,this.appliedTransaction=!1}getEntry(e,t){for(const i of this.cacheOverrides)if(i!==t){const t=i.getEntry(e,this);if(t)return t}const o=this.data.get(e);if(o)return{pointer:e.pointer,userId:e.userId,value:o};if(this.cacheUsingThisInstanceAsAnOverride&&this.cacheUsingThisInstanceAsAnOverride!==t)return this.cacheUsingThisInstanceAsAnOverride.getEntry(e,this);for(const i of this.cacheFallbacks)if(i!==t){const t=i.getEntry(e,this);if(t)return t}}getRecord(e){const t=this.getEntry(e);if(t)return t.value}recordHasTemporaryData(e){if(this.isTemporaryData&&this.data.get(e))return!0;for(const t of this.cacheOverrides){if(!t.isTemporaryData)continue;if(t.getEntry(e,this))return!0}for(const t of this.cacheFallbacks){if(!t.isTemporaryData)continue;if(t.getEntry(e,this))return!0}return!1}recordHasOverride(e){for(const t of this.cacheOverrides){if(t.getEntry(e,this))return!0}return!1}makeGetRecordValueFn(e){return a.mF.fromMonomorphicFunctionUnsafe((t=>{const o=this.getRecord({pointer:t,userId:e});if(o&&o.value)return o.value}))}makeGetRecordRoleFn(e){return t=>{const o=this.getRecord({pointer:t,userId:e});if(o&&o.role)return o.role}}getRole(e){const t=this.getRecord(e);if(t&&t.role)return t.role}getVersion(e){const t=this.getRecord(e);return t&&t.value&&t.value.version?t.value.version:0}setRecord(e,t){if(!(e.pointer.table!==s.n||t&&t.value&&t.value.type)){const o=this.data.get(e);r.log({level:"warning",from:"InMemoryRecordCache",type:"undefinedViewType",error:{stack:(new Error).stack},data:{miscDataToConvertToString:{current:o,new:t}}})}this.cacheLogicalTime++,t?this.data.set(e,t):this.deleteRecord(e)}deleteRecord(e){this.cacheLogicalTime++,this.data.delete(e)}addCacheOverride(e){this.cacheLogicalTime++,this.cacheOverrides.push(e),e.cacheUsingThisInstanceAsAnOverride=this,e.emitAll()}removeCacheOverride(e){this.cacheLogicalTime++,this.cacheOverrides=this.cacheOverrides.filter((t=>t!==e)),e.emitAll(),e.cacheUsingThisInstanceAsAnOverride=void 0}addCacheFallback(e){this.cacheLogicalTime++,this.cacheFallbacks.add(e),e.cachesUsingThisInstanceAsAFallback.add(this)}removeCacheFallback(e){this.cacheLogicalTime++,this.cacheFallbacks.delete(e),e.cachesUsingThisInstanceAsAFallback.delete(this)}forEachRecord(e,t){for(const{pointer:o,value:i,userId:n}of this.data)i&&"none"!==i.role&&n===e&&t(o,i)}emitAll(){for(const{pointer:e}of this.data)this.emitRecord(e,[])}clearCache(){this.cacheLogicalTime++,this.emitAll(),this.appliedTransaction=!1,this.data=new l.o(void 0)}addListenerToRecord(e,t){const o=(0,i.dn)(e);this.recordEvents.addListener(o,t)}removeListenerToRecord(e,t){const o=(0,i.dn)(e);this.recordEvents.removeListener(o,t)}emitRecord(e,t){this.cacheLogicalTime++;const o=(0,i.dn)(e);this.recordEvents.emit(o,t),this.cacheUsingThisInstanceAsAnOverride&&this.cacheUsingThisInstanceAsAnOverride.emitRecord(e,t);for(const i of this.cachesUsingThisInstanceAsAFallback)i.emitRecord(e,t)}hasListener(e){const t=(0,i.dn)(e);return this.recordEvents.listenerCount(t)>0}}},1302:(e,t,o)=>{o.r(t),o.d(t,{default:()=>c});var i=o(96486),n=o.n(i),r=o(54087),a=o.n(r),s=o(2911);const l=!1;const c=new class{constructor(){this.pauseCount=0,this.renderIsQueued=!1,this.computedStoreQueue=new Set,this.computedStoreQueueDebugNameCounters=new Map,this.componentRenderQueue=new Set,this.flushQueue=new Set,this.renderRemovedQueue=new Set,this.currentlyRendering=new Set,this.unstable_batchedUpdates=void 0,this.componentRenderTracker=void 0,this.storeRecomputeTracker=void 0,this.maybeInstrumentStoreRecompute=e=>{if(void 0===this.storeRecomputeTracker||!this.storeRecomputeTracker.shouldTrackThisRecompute())return void e();const t=performance.now();e();const o=performance.now()-t,{storeRecomputeTracker:{trackRecompute:i}}=this,{debugName:n}=e;this.afterNextFlush((()=>{i(n,o)}))},this.processRenderQueueCallback=async e=>{if(!this.renderRemovedQueue.has(e))try{this.currentlyRendering.add(e),await this.maybeInstrumentComponentRender(e)}catch(t){this.throttledLog({level:"error",from:"RenderQueue",type:"componentRender",error:(0,s.Ui)(t)})}finally{this.currentlyRendering.delete(e)}},this.maybeInstrumentComponentRender=async e=>{if(void 0===this.componentRenderTracker||!this.componentRenderTracker.shouldTrackThisRender())return void(await e());const t=performance.now();await e();const o=performance.now()-t,{componentRenderTracker:{trackRender:i}}=this,{componentName:n}=e;this.afterNextFlush((()=>{i({componentName:n,renderTime:o})}))},this.throttledLog=n().throttle((e=>{console.info(e)}),5e3),this.flush=this.flush.bind(this)}isPaused(){return this.pauseCount>0}enqueueComputedStoreRecompute(e){this.computedStoreQueue.add(e),this.enqueueFlush()}enqueueComponentRender(e){this.componentRenderQueue.add(e),this.enqueueFlush()}setComponentRenderTracker(e){this.componentRenderTracker=e}setStoreRecomputeTracker(e){this.storeRecomputeTracker=e}enqueueFlush(){this.renderIsQueued||0!==this.pauseCount||(this.renderIsQueued=!0,this.flushAfterAnimationFrame())}flushAfterAnimationFrame(){document.hidden?Promise.resolve().then(this.flush):a()(this.flush)}removeRenderFromQueue(e){this.renderRemovedQueue.add(e)}afterNextFlush(e){return new Promise((t=>{this.flushQueue.add((()=>{e&&e(),t()})),this.enqueueFlush()}))}measureFlush(e){const t=performance.now();this.afterNextFlush((()=>{e(performance.now()-t)}))}pause(){this.afterNextFlush((()=>{this.pauseCount++}))}unpause(){this.pauseCount--,0!==this.pauseCount||this.renderIsQueued||(this.renderIsQueued=!0,this.flushAfterAnimationFrame())}async flush(){this.unstable_batchedUpdates||(this.unstable_batchedUpdates=(await Promise.resolve().then(o.t.bind(o,62518,19))).unstable_batchedUpdates);const e=this.unstable_batchedUpdates;let t=0,i=0;new Map;performance.now();do{for(;this.computedStoreQueue.size>0;){const e=this.computedStoreQueue;this.computedStoreQueue=new Set;performance.now();for(const t of e)try{this.maybeInstrumentStoreRecompute(t)}catch(n){this.throttledLog({level:"error",from:"RenderQueue",type:"computedStoreRecompute",error:(0,s.Ui)(n)})}l,t+=e.size}const o=this.componentRenderQueue;let r;this.componentRenderQueue=new Set,this.renderRemovedQueue.clear(),e((()=>{r=Promise.all(Array.from(o.values()).map(this.processRenderQueueCallback))})),await r,i+=o.size;const a=this.flushQueue;this.flushQueue=new Set;for(const e of a)try{e()}catch(n){this.throttledLog({level:"error",from:"RenderQueue",type:"afterNextFlush",error:(0,s.Ui)(n)})}}while(this.componentRenderQueue.size>0||this.flushQueue.size>0||this.computedStoreQueue.size>0);this.renderIsQueued=!1}}},55010:(e,t,o)=>{o.d(t,{Z:()=>i});function i(e,t){if(!e&&!t)return 0;if(!t)return-1;if(!e)return 1;const o=e.compareDocumentPosition(t);return 4==(4&o)?-1:2==(2&o)?1:0}},67381:(e,t,o)=>{o.d(t,{Q:()=>l});var i=o(77094),n=o.n(i),r=o(45697),a=o.n(r),s=o(67294);function l(e){const t=(0,s.createContext)(e.modernContextDefaultValue);t.displayName=e.displayName;const o={[e.legacyContextKey]:a().any};class i extends s.Component{getChildContext(){return{[e.legacyContextKey]:this.props.value}}render(){return n()(t.Provider,{value:this.props.value},void 0,this.props.children)}}return i.displayName=`${e.displayName}.UnifiedProvider`,i.childContextTypes=o,{Provider:i,Consumer:t.Consumer,context:t,legacyPropTypes:o,get legacyContextType(){throw new TypeError("This should only be used at the type level")}}}},45060:(e,t,o)=>{o.d(t,{yX:()=>a,Hc:()=>s,XY:()=>c,TI:()=>p,Rw:()=>u});var i=o(88108),n=o(29477),r=o(97880);async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"magenta";const i=e=>e===1/0?3e3:e===-1/0?-3e3:e,r=e.width||(e.right??e.left)-e.left||50,a=e.height||(e.bottom??e.top)-e.top||50,s=window.document.createElement("DIV");s.style.position="absolute",s.style.zIndex="20000",s.style.top=`${i(e.top)}px`,s.style.left=`${i(e.left)}px`,s.style.minWidth=`${i(r)}px`,s.style.minHeight=`${i(a)}px`,s.style.border=`1px solid ${o}`,s.style.background=o,s.style.font="10px monaco",s.style.opacity="0.3",s.style.pointerEvents="none",s.style.userSelect="none",s.textContent=t,window.document.body.appendChild(s),await(0,n.Vs)(1e3),s.remove()}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=Object.keys(e).find((e=>e.startsWith("__reactInternalInstance$"))),i=e[o];if(!i)return;if(i._currentElement){let e=i._currentElement._owner;for(let o=0;o<t;o++)e=e._currentElement._owner;return e._instance}const n=e=>{let t=e.return;for(;"string"==typeof t.type;)t=t.return;return t};let r=n(i);for(let a=0;a<t;a++)r=n(r);return r.stateNode}function l(e){return"string"==typeof e?[e]:e}function c(e,t){const o=["%c NOTION%c WARNING %c","background: black; color: white;","background: black; color: orange","font-weight: normal",...l(e)];if(t){console.groupCollapsed(...o);for(const e of t)console.log(...l(e));console.trace(),console.groupEnd()}else console.warn(...o)}(0,i.exposeDebugValue)("debugDrawRect",a),(0,i.exposeDebugValue)("debugReactComponentFromDOMNode",s);const d=e=>function(t){for(var o=arguments.length,i=new Array(o>1?o-1:0),n=1;n<o;n++)i[n-1]=arguments[n];return g([e,t,...i.filter(r.$K)])},p={CONTAINER_STYLE:{style:"background: hsla(0, 0%, 50%, 0.05); padding: 0px 3px; border-radius: 3px;"},div:d("div"),span:d("span"),ol:d("ol"),li:d("li"),table:d("table"),tr:d("tr"),td:d("td"),object:(e,t)=>void 0!==e?g(["object",{object:e,config:t}]):"undefined",tiny:e=>e&&"object"==typeof e?Array.isArray(e)?"[…]":"{…}":p.object(e),objectSummary:function(e){let{asJSON:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{asJSON:!1};const{span:o,tiny:i,object:n}=p;if(!e||"object"!=typeof e)return n(e);if(t)try{const t=JSON.stringify(e),i=t.slice(0,50),r=i.length<t.length?"…":void 0;return o({},n(e)," ",i,r)}catch(l){}if(Array.isArray(e)){const t=e.slice(0,3);return o({},n(e)," [",...t.map(((e,n)=>o({},i(e),n===t.length-1?void 0:", "))),t.length<e.length?", …":void 0,"]")}const r=Object.entries(e),a=r.slice(0,4),s=a.map(((e,t)=>{let[n,r]=e;return o({},n,": ",i(r),t===a.length-1?void 0:", ")}));return o({},n(e)," {",...s,a.length<r.length?", …":void 0,"}")},countUniques(e){if(0===e.length)return p.object(e);if(1===e.length)return p.object(e[0]);const t=new Map;e.forEach((e=>{const o=t.get(e)??0;t.set(e,o+1)}));const o=Array.from(t).map((e=>{let[t,o]=e;return{value:t,count:o}})).sort(((e,t)=>t.count-e.count));return p.autoTable({rows:o,header:!1})},autoTable(e){const{rows:t,header:o}=e,i={style:"vertical-align: top"},n={style:"padding: 2px 0.25em; font-weight: bold; border-bottom: 1px solid #000"},a={style:"white-space: pre; border-bottom: 1px solid #000"},s=p,l=Array.isArray(o)?o:"object"==typeof o?(0,r.Yd)(o):(0,r.Yd)(t[0]);return s.table(s.CONTAINER_STYLE,!1!==o?s.tr(i,...l.map((e=>"object"!=typeof o||Array.isArray(o)?s.td(n,String(e)):s.td(n,o[e])))):void 0,...t.map((e=>s.tr(i,...l.map((t=>s.td(a,s.object(e[t]))))))))}};function u(e){if("undefined"!=typeof window){const t=window.devtoolsFormatters||[];t.unshift(function(e){const{canFormat:t,header:o,body:i,hasBody:n}=e;return{header(e,i){try{return null!=i&&i.useDefaultFormatter?null:t(e)?o(e,i):null}catch(n){throw console.error("DevTools Formatter.header() error",n),n}},hasBody(e,o){try{return(null==o||!o.useDefaultFormatter)&&!!t(e)&&n(e,o)}catch(i){throw console.error("DevTools Formatter.hasBody() error",i),i}},body(e,t){try{return i(e,t)}catch(o){throw console.error("DevTools Formatter.body() error",o),o}}}}(e)),window.devtoolsFormatters=t}}const m=Symbol("DevToolsHyperscriptPassthrough");function g(e){const t=e;return t&&(t[m]=!0),t}u({canFormat:e=>Boolean(e&&"object"==typeof e&&m in e),header:e=>e,hasBody:()=>!1,body:()=>null})},38026:(e,t,o)=>{o.d(t,{s:()=>r,A:()=>s});var i=o(97880),n=o(14577);function r(e,t){const o=new Map,r=new Set,s={nodes:[],edges:[]},l=new Map;let c=0;function d(e){let t=e;return r.has(t)&&(t=`${t}_${++c}`),r.add(t),t}function p(e){let t=o.get(e.value);return t||(t=function(e){var t;let r,s=null===(t=e.value.constructor)||void 0===t?void 0:t.name;s||(s="Unknown"),"component"===e.kind?("debugName"in e.value&&(s=e.value.debugName),r={type:"component",id:d(s),label:s}):"store"===e.kind?e.value instanceof n.Z?(e.value.debugName&&(s=e.value.debugName),r={type:"computedstore",id:d(s),label:s}):r={type:"store",id:d(s),label:s}:(0,i.t1)(e);for(const o of a)o(r,e.value,(e=>{l.set(r,e)}));return o.set(e.value,r),r}(e)),t}for(const[i,n]of e.entries())for(const e of n)s.edges.push({from:p({kind:"store",value:i}).id,to:p({kind:"component",value:e}).id});for(const[i,n]of t.entries())for(const e of n)s.edges.push({from:p({kind:"store",value:i}).id,to:p({kind:"store",value:e}).id});for(const[i,n]of l.entries()){const e=o.get(n);e&&(i.parentUIStoreId=e.id)}return s.nodes=Array.from(o.values()),s}const a=[];function s(e){a.push(e)}},62328:(e,t,o)=>{o.r(t),o.d(t,{INTERNAL_TESTING_USE_ONLY__getStateLog:()=>F,captureStack:()=>f,getForceUpdateCauses:()=>W,getSerializedDebugGraph:()=>z,isRecording:()=>D,logComponentForceUpdateScheduled:()=>T,logComponentRender:()=>I,logListenerAdded:()=>P,logListenerRemoved:()=>x,logStoreAccess:()=>M,logStoreCreated:()=>C,logStoreEmit:()=>k,logStoreSet:()=>_,logTypingLag:()=>B,renderLatestGraph:()=>$,resume:()=>R,runWithTimer:()=>S,startRecordingReactivityLog:()=>Z,stop:()=>E,toggleRecordingInputLatency:()=>A,updateReactivityRecordingOptions:()=>L});var i=o(96486),n=o.n(i),r=o(97880);function a(e,t){const o=new Set,i=['  graph [rankdir = "LR"];'],a=new Map,s=new Map;for(const n of e.nodes){const e=[];let l=n.label;if("store"===n.type){if(t&&n.recordStoreDetails){const{id:e}=n.recordStoreDetails;let t=a.get(e);if(t||(t={id:e,table:n.recordStoreDetails.table,nodes:[]},a.set(e,t)),n.recordStoreDetails.table!==t.table)throw new Error("Huh, didn't expect that to happen");if(n.blockStoreDetails){const e=n.blockStoreDetails.type;if(t.blockType){if(t.blockType!==e)throw new Error("Hmm this data is weird")}else t.blockType=e;o.add(n.id)}s.set(n.id,`"${e}":"${n.id}"`),t.nodes.push(n);continue}if(n.recordStoreDetails){const e=n.recordStoreDetails;n.blockStoreDetails?(l=`${l}: ${e.table} ${e.id} (${n.blockStoreDetails.type} block)`,o.add(n.id)):e.path.length>0&&(l=`${l} path: ${e.path.join(".")}`)}e.push("shape=box")}else"computedstore"===n.type?e.push("shape=diamond"):"component"===n.type?e.push("shape=ellipse"):"unknown"===n.type?e.push("shape=tripleoctagon"):(0,r.t1)(n.type);e.push(`label="${l}"`),i.push(`  "${n.id}" [${e.join(",")}];`)}for(const[r,l]of a.entries()){const e=["shape=record"];for(const i of l.nodes){let e=i.label;i.recordStoreDetails&&i.recordStoreDetails.path.length&&(e=`${e}: ${i.recordStoreDetails.path.join(".")}`),i.label=e}const t=n().orderBy(l.nodes,["label"]).map((e=>`<${e.id}> ${e.label}`)).join("|");let o=`${l.table} ${l.id}`;l.blockType&&(o+=` (${l.blockType} block)`);const a=`<__title> ${o}|${t}`;e.push(`label="${a}"`),i.push(`  "${r}" [${e.join(",")}];`)}if(!t)for(const n of e.nodes)n.parentUIStoreId&&i.push(`  "${n.parentUIStoreId}" -> "${n.id}" [style=dotted];`);for(const{from:n,to:r}of e.edges){const e=s.get(n)??`"${n}"`,t=[];o.has(n)&&t.push("color=red"),i.push(`  ${e} -> "${r}" [${t.join(",")}];`)}return`digraph G {\n${i.join("\n")}\n}`}var s=o(63143),l=o(14577),c=o(45060),d=o(38026),p=o(1302);const u=30,m=/webpack-internal:\/+/g,g=/node_modules\//g,h=/\(<anonymous>\)/g;function f(e){if(!b.captureStacks)return;const t=Error.stackTraceLimit;try{var o;Error.stackTraceLimit=25;const n=new Error("capture stack frame");let r=((null===(o=n.stack)||void 0===o?void 0:o.replace(m,"").split("\n"))||[]).slice(e).map((e=>e.trim()));for(let e=r.length-1;e>=0;e--)if(i=r[e],!Boolean(i.match(g)||i.match(h))){const t=r.length-(e+1);r=r.slice(0,e+1),t>0&&r.push(`(Omitted ${t} framework frames in node_modules)`);break}return r.join("\n")}finally{Error.stackTraceLimit=t}var i}class v{constructor(){this.isActive=!1,this.captureStacks=!0,this.log=[],this.inputEvents=[],this.storeEmits=[],this.componentForceUpdates=[],this.componentRenders=[],this.storeListeners=new Map,this.latestPerformanceDebugGraph=void 0}}let y,b=new v;function S(e,t){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];function i(){console.info("Starting perf"),Z({captureStacks:o}),setTimeout((()=>{p.default.afterNextFlush((()=>{console.info("Stopping perf"),E(),console.info("Store emits:"),K(),console.info("Component force updates:"),G(),console.info("Component renders:"),X(),console.info("Why components rendered after stores changed:"),console.info("  To fix, remove either codepath"),j(),console.info("Input latency:"),Y()}))}),t)}0===e?i():setTimeout(i,e)}function w(e){return b.isActive&&b.log.push(e),e}function k(e){b.isActive&&b.storeEmits.push(w({type:"store.emit",store:e,storeName:J(e),stack:f(3)}))}function C(e,t){b.isActive&&w({type:"store.created",store:e,state:t,stack:f(0)})}function _(e,t){b.isActive&&w({type:"store.set",store:e,state:t,stack:f(4)})}function M(e,t){b.isActive&&w({type:"store.access",store:e,listener:t,stack:f(0)})}function T(e,t){b.isActive&&b.componentForceUpdates.push(w({type:"component.forceUpdate",component:e,componentName:"componentName"in e?e.componentName:e.constructor.displayName||e.constructor.name,store:t,storeName:null==t?void 0:t.constructor.name,stack:f(2)}))}function I(e){b.isActive&&b.componentRenders.push(w({type:"component.render",componentName:e.constructor.displayName||e.constructor.name,stack:f(2)}))}function P(e,t,o){if(b.isActive){const i=w({type:"store.listeners.added",store:e,listener:t,stack:f(o)});let n=b.storeListeners.get(e);n||(n=new Map,b.storeListeners.set(e,n)),n.has(t)||n.set(t,i.stack)}}function x(e,t){if(b.isActive){w({type:"store.listeners.removed",store:e,listener:t,stack:f(0)});const o=b.storeListeners.get(e);if(!o)return;o.delete(t),0===o.size&&b.storeListeners.delete(e)}}function B(e,t){b.isActive&&function(e){b.isActive&&b.inputEvents.push(e)}({type:"input.latency",metricType:e,timeMs:t})}function Z(e){b=new v,b.captureStacks=e.captureStacks,b.isActive=!0}function E(){b.isActive=!1}function R(){b.isActive=!0}function A(){if(b.isActive)return clearTimeout(y),y=void 0,E(),void Y();console.info(`Recording input latency for ${s.hM}ms (press Ctrl+Alt+Command+M again to end)`),Z({captureStacks:!1}),clearTimeout(y),y=window.setTimeout((()=>{E()}),s.hM)}function D(){return b.isActive}function F(){if(!b.isActive)throw new Error("performanceHelpers.start() must be called before getStateLog()");return b.log.slice()}function L(e){if(!b.isActive)throw new Error("performanceHelpers.start() must be called before getStateLog()");b.captureStacks=e.captureStacks}function V(e,t){return`${t}\n\nComputedStore listener:\n${e}`}function N(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return function*(){const o=e.autoListener;for(const[i,n]of b.storeListeners){if(t.has(i))continue;if(!n.has(o))continue;t.add(i);const r=b.storeEmits.find((e=>e.store===i));if(!r)continue;const a=n.get(o);yield{computedStore:e,store:i,storeEmit:r,listenStack:a,seen:t}}}()}function O(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;for(const{store:i}of N(e,o)){let n=t.get(i);n||(n=new Set,t.set(i,n)),n.add(e),i instanceof l.Z&&O(i,t,o)}}function U(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;const o=new Map;for(const{store:i,listenStack:n,storeEmit:r}of N(e,t))if(i instanceof l.Z){const e=U(i,t);for(const[t,i]of e.entries()){let e=n;e&&i.stack&&(e=V(e,i.stack)),o.set(t,{stack:e,deepEmit:r})}}else o.set(i,{stack:n,deepEmit:r});return o}function*H(){for(const t of b.componentForceUpdates){var e;const{component:o,store:i}=t;if(!i)continue;const n="autoListener"in o?o.autoListener:o,r=q(n,o),a=(null===(e=b.storeListeners.get(i))||void 0===e?void 0:e.get(n))||`No listen stack available for listener ${r}`,s=b.storeEmits.find((e=>e.store===i));s&&(yield{forceUpdate:t,component:o,store:i,listenStack:a,storeEmit:s})}}function z(){const e=new Map,t=new Map;for(const{component:o,store:i}of H()){let n=t.get(i);n||(n=new Set,t.set(i,n)),n.add(o),i instanceof l.Z&&O(i,e)}return(0,d.s)(t,e)}function W(){const e=new Map;for(const t of H()){const{store:o,forceUpdate:i}=t;let{listenStack:n,storeEmit:r}=t;if(r.store instanceof l.Z){const e=U(r.store);for(const[t,o]of e){r={type:"store.emit",store:o.deepEmit.store,stack:o.stack&&r.stack?`${o.stack}\n\nThen ComputedStore emitted:\n${r.stack}`:void 0,storeName:`${o.deepEmit.storeName} via ${r.storeName}`},o.stack&&(n=V(n,o.stack));break}}e.set(i,{listeningTo:o,listenStack:n,emitted:r})}return e}function j(){const e=W(),t=n().groupBy(b.componentForceUpdates,(t=>{var o;const i=e.get(t);return`${(null==i||null===(o=i.emitted)||void 0===o?void 0:o.stack)||t.stack}:${null==i?void 0:i.listenStack}`})),o=c.TI,i=(0,r.qP)(t).map((t=>{let[,i]=t;const n=e.get(i[0]),r=i.length,a=i.map((e=>e.componentName)),s=i.map((e=>(null==n?void 0:n.emitted.storeName)||e.storeName||"(unknown)")),l=(null==n?void 0:n.listenStack)||"(unknown)",c=(null==n?void 0:n.emitted.stack)||i[0].stack;return{Count:r,Components:o.countUniques(a),Stores:o.countUniques(s),ListenStack:o.div({},l),EmitStack:o.div({},c)}})).sort(((e,t)=>t.Count-e.Count)),a=i.slice(0,10),s={Count:"Count",Components:"Component",Stores:"Store",ListenStack:o.div({},o.div({},"ListenStack"),o.div({style:"white-space: auto"},"One (of possibly many) reason(s) why this component is subscribed to this store")),EmitStack:o.div({},o.div({},"EmitStack"),o.div({style:"white-space: auto"},"One (of possibly many) trigger(s) that caused the component's listener on this store to be woken up"))};console.info(o.autoTable({rows:a,header:s})),a.length<i.length&&(console.groupCollapsed(`+ ${i.length-10} more updates with causes`),console.info(o.autoTable({rows:i.slice(10),header:s})),console.groupEnd());const l=z();b.latestPerformanceDebugGraph=l,console.log('Performance debug graph (visualize this with "__console.performanceHelpers.renderLatestGraph()" or "notion ts-node src/tools/renderPerformanceDebugGraph.ts"):',l)}function K(){const e={};n().each(b.storeEmits,(t=>{let{storeName:o}=t;e[o]||(e[o]=0),e[o]++}));const t=n().map(e,((e,t)=>({storeName:t,emitCount:e}))),o=n().sortBy(t,(e=>{let{emitCount:t}=e;return-1*t})),i=n().slice(o,0,u);console.table(i),t.length>u&&console.info(`+ ${t.length-u} more updates`)}function Y(){const e=n().groupBy(b.inputEvents,(e=>e.metricType)),t=Object.entries(e).map((e=>{let[t,o]=e;const i=o.map((e=>e.timeMs)),r=n().sortBy(i);return{type:t,count:i.length,min:r[0],max:r[r.length-1],mean:parseFloat(n().mean(i).toFixed(2)),p50:r[Math.floor(.5*r.length)],p75:r[Math.floor(.75*r.length)],p95:r[Math.floor(.95*r.length)]}}));console.table(n().sortBy(t,"type"))}function G(){const e=c.TI,t=n().groupBy(b.componentForceUpdates,(e=>e.stack)),o=Object.entries(t),i=n().sortBy(o,(e=>{let[t,o]=e;return-o.length})),r=i.map((t=>{let[o,i]=t;const n=i.length,r=i.map((e=>e.componentName)),a=i.map((e=>e.storeName));return{Count:n,Components:e.countUniques(r),Stores:e.countUniques(a),StoreUpdateStack:e.div({},o)}}));console.log(c.TI.autoTable({rows:r,header:!0})),i.length>u&&console.info(`+ ${i.length-u} more updates`),console.info("Note: an 'undefined' storeName means the component updated for some reason other than a store emit.")}function X(){const e={};n().each(b.componentRenders,(t=>{let{componentName:o}=t;e[o]||(e[o]=0),e[o]++}));const t=n().map(e,((e,t)=>({componentName:t,renderCount:e}))),o=n().sortBy(t,(e=>{let{renderCount:t}=e;return-1*t})),i=n().slice(o,0,u);console.table(i),t.length>u&&console.info(`+ ${t.length-u} more updates`)}function q(e,t){return"debugName"in e?e.debugName:`${e.constructor.name} of ${"debugName"in t?t.debugName:t.constructor.name}`}function $(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!b.latestPerformanceDebugGraph)throw new Error("No latest performance debug graph exists! Please use runWithTimer() first.");{const t=a(b.latestPerformanceDebugGraph,e);window.open(`https://dreampuf.github.io/GraphvizOnline/#${encodeURIComponent(t)}`,"_blank")}}function J(e){return e.debugName?e.debugName:e.constructor.name}},13991:(e,t,o)=>{o.d(t,{bg:()=>r,SP:()=>p,sY:()=>c,_j:()=>d});var i=o(24211),n=o(54153);const r="locale",a={locale:i.al,messages:{},routes:{}};function s(){const e=window.document.querySelector("#messages"),t=window.document.querySelector("#routes");return e?{value:{locale:e.dataset.locale||i.al,messages:JSON.parse(e.innerHTML),routes:t&&JSON.parse(t.innerHTML)||{}}}:{error:!0}}let l=a;if("undefined"!=typeof window&&"undefined"!=typeof navigator){const e=Boolean(window.__isElectron);if(/ReactNative/.test(navigator.userAgent)||/MobileNative/.test(navigator.userAgent)){const e=function(){const e=s();if(e.error)return e;const t="ko"===e.value.locale.split("-")[0];for(const o of window.navigator.languages){const i=o.split("-")[0];if(t){if("en"===i)return{value:a};if("ko"===i)return e}if(e.value.locale.toLowerCase()===o.toLowerCase())return e}for(const o of window.navigator.languages){const t=o.split("-")[0];if(e.value.locale.split("-")[0].toLowerCase()===t.toLowerCase())return e}return{error:!0}}();e.error||(l=e.value)}else if(e){const e=function(e,t){if(e.error)return{value:a};if(t===e.value.locale)return e;if("en-US"===t)return{value:a};for(const o of window.navigator.languages){const t=o.split("-")[0];if("en"===t)return{value:a};if(e.value.locale.split("-")[0]===t)return e}return{error:!0}}(s(),n.Z.get("preferredLocale"));e.error||(l=e.value)}else{const e=s();e.error||(l=e.value)}}const{messages:c,routes:d}=l,p=l.locale},74725:(e,t,o)=>{o.d(t,{O:()=>n});var i=o(67294);function n(e){let{closeHandler:t,ref:o,active:n,excludedSelectors:r,ignoreKeydown:a}=e;const s=(0,i.useRef)(void 0);(0,i.useEffect)((()=>{if(n){const e=e=>{0===e.button&&e.target instanceof Node?s.current=e.target:s.current=void 0},i=e=>{const i=o.current,n=e.target,a=s.current;if(s.current=void 0,i&&n){for(const e of r||[]){const t=document.querySelectorAll(e);for(let e=0;e<t.length;++e){if(t[e].contains(n))return}}a&&(i===a||i.contains(a))||i===n||i.contains(n)||t()}},n=e=>{a||"Esc"!==e.key&&"Escape"!==e.key||t()};return window.addEventListener("mousedown",e),window.addEventListener("click",i),window.addEventListener("keydown",n),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("click",i),window.removeEventListener("keydown",n)}}}),[t,o,n,r,a])}},22571:(e,t,o)=>{o.d(t,{O:()=>r});o(79180);var i=o(67294),n=o(62456);function r(){return(0,i.useMemo)(a,[])}function a(){return(0,n.wv)(window)?window[n.gY][n.Ij]:"UnknownFunctionComponent"}},480:(e,t,o)=>{o.d(t,{O7:()=>a,Fy:()=>s,MO:()=>l});var i=o(67294),n=o(34958),r=o(81954);function a(){const e=(0,i.useContext)(n.EnvironmentModernContext);if(!e)throw new Error("No ClientEnvironment provided.");return e}function s(){const e=a();return(0,r.VK)((()=>({...e.device})),[e.device])}function l(){const e=a();return(0,r.VK)((()=>e.device.isPhone),[e.device])}},6740:(e,t,o)=>{o.d(t,{E:()=>r,Z:()=>a});var i=o(67294);let n;function r(e){try{return function(){if(void 0===n)try{n=!(!CSS||!CSS.supports)&&CSS.supports("selector(:focus-visible)")}catch{n=!1}return n}()?e.matches(":focus-visible"):e.matches(":focus")}catch(t){return!1}}function a(){const e=(0,i.useRef)(null),[t,o]=(0,i.useState)(!1),[n,a]=(0,i.useState)(!1),s=(0,i.useCallback)((()=>{const t=e.current;t&&a(r(t))}),[]),l=(0,i.useCallback)((t=>{e.current=t,s()}),[s]);return(0,i.useEffect)((()=>{const t=e.current;if(t){function e(){o(!0),s()}function i(){o(!1),s()}return t.addEventListener("focus",e),t.addEventListener("blur",i),()=>{t.removeEventListener("focus",e),t.removeEventListener("blur",i)}}}),[s]),(0,i.useEffect)((()=>{if(t)return document.addEventListener("pointerdown",s),document.addEventListener("keydown",s),()=>{document.removeEventListener("pointerdown",s),document.removeEventListener("keydown",s)}}),[t,s]),[l,n]}},88464:(e,t,o)=>{o.d(t,{Z:()=>n});var i=o(67294);function n(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,i.useCallback)((e=>{for(const o of t)"function"==typeof o?o(e):null!=o&&(o.current=e)}),[t])}},33125:(e,t,o)=>{o.d(t,{c:()=>n});var i=o(67294);function n(e,t,o){const n=(0,i.useMemo)(t,o);(0,i.useLayoutEffect)((()=>e.register(n)),[n,e])}},20294:(e,t,o)=>{o.d(t,{k:()=>d});var i=o(67294),n=o(1674),r=o(40107),a=o(63143),s=o(62328),l=o(1302),c=o(22571);function d(){const[e,t]=(0,i.useState)(0);(0,i.useDebugValue)(e);const o=(0,r.t)(),d=(0,i.useRef)(new Set),p=(0,i.useCallback)((()=>new Promise((e=>{o()?(n.T.log("dequeueRerender"),d.current.add(e),t((e=>e+1))):e()}))),[o]),u=(0,i.useCallback)((function(){for(const e of d.current)try{e()}finally{d.current.delete(e)}}),[]);(0,i.useLayoutEffect)(u),(0,i.useEffect)((()=>u),[u]);const m=(0,c.O)(),g=(0,i.useRef)({debugName:"useEnqueueRender",componentName:m});return(0,i.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{store:t}=e,o=e.componentInfo||g.current;n.T.log("enqueueRender",null==o?void 0:o.debugName,t),s.logComponentForceUpdateScheduled(o,t),l.default.enqueueComponentRender((0,a.xt)(p,"componentName",o.componentName))}),[p])}Symbol("first render")},81954:(e,t,o)=>{o.d(t,{VK:()=>v,SI:()=>g,qz:()=>h,Kw:()=>f,AF:()=>y});var i=o(67294),n=o(1674),r=o(66673),a=o(18466),s=o(62328),l=o(14577),c=o(62456),d=o(22571);function p(e,t){const o=function(e){const t=(0,d.O)();if((0,c.wv)(window)){const o=window[c.gY].indexByHook||{},i=o[e]||1,n=`${t}.${e}_${i}`;return o[e]=i+1,window[c.gY].indexByHook=o,n}return`${t}.${e}`}(t);return e||o}var u=o(20294);const m=function(){};function g(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{useDeepEqual:n}=o,a=p(o.debugName,"useComputedStoreInstance");(0,i.useDebugValue)(a);const s=(0,i.useCallback)(e,t),c=(0,i.useRef)();c.current||(c.current=new l.Z(s,{useDeepEqual:Boolean(n),debugName:a}),c.current.addListener(m));const d=c.current;return(0,i.useEffect)((()=>(d.addListener(m),()=>d.removeListener(m))),[d]),(0,r.wr)(t,r.Ds)&&d.updateStoreInstance(s,Boolean(n)),d}function h(e,t){const o=(0,i.useRef)();if(e)return o.current=void 0,e;if(!t)throw new Error("useStore: no store instance, and no store constructor");return o.current||(o.current=new t),o.current}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=(0,d.O)(),r=p(t.debugName,"useStoreState"),l=(0,i.useMemo)((()=>({debugName:r,componentName:o})),[r,o]),c=(0,u.k)(),m=(0,i.useRef)(!1),g=(0,i.useCallback)((function(e){n.T.log("useSubscription listener called",{debugName:l.debugName,disabled:m.current},e),m.current||c({componentInfo:l,store:e})}),[c,l]);(0,i.useEffect)((()=>(e.addListener(g),n.T.log("useStoreState: addListener",l.debugName,e),()=>{n.T.log("useStoreState: removeListener",l.debugName,e),e.removeListener(g),(0,s.logListenerRemoved)(e,l)})),[e,l,g]),m.current=!0;try{(0,s.logListenerAdded)(e,l,3);const t=a.Z.withListenerIgnored((()=>e.state));return(0,i.useDebugValue)(t),t}finally{m.current=!1}}function v(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=p(o.debugName,"useComputedStore");(0,i.useDebugValue)(n);const r=g(e,t,{...o,debugName:n});return f(r,{debugName:n})}function y(e,t){const o=h(e,t);(0,i.useDebugValue)(o.constructor.name);return[f(o),(0,i.useCallback)((e=>"function"==typeof e?o.update(e):o.setState(e)),[o]),o]}},24405:(e,t,o)=>{o.d(t,{Fg:()=>s,yK:()=>l,EM:()=>c});var i=o(67294),n=o(8848),r=o(480),a=o(81954);function s(){const e=(0,r.O7)(),t=(0,a.Kw)(e.ThemeModeStore);return(0,i.useDebugValue)(t),(0,n.gh)({theme:t})}function l(e,t){const o=s(),n=(0,i.useMemo)((()=>e(o)),[o,...t]);return(0,i.useDebugValue)(n),n}function c(e){return e}},63123:(e,t,o)=>{o.d(t,{V:()=>n});var i=o(67294);function n(e){const{value:t,validateLoaded:o}=e,n=e.waitTimeInMs||500,[r,a]=(0,i.useState)(!0),s=(0,i.useRef)(),l=void 0!==t&&(!o||r&&o(t));return(0,i.useEffect)((()=>(s.current=window.setTimeout((()=>{a(!1),s.current=void 0}),n),()=>{s.current&&(clearTimeout(s.current),s.current=void 0)})),[n]),(0,i.useEffect)((()=>{l&&s.current&&(a(!1),clearTimeout(s.current),s.current=void 0)}),[l]),void 0!==t&&l?{status:"resolved",value:t}:r?{status:"pending",value:void 0}:{status:"rejected",value:void 0,error:new Error("Reached end of timeout before value became defined.")}}},35431:(e,t,o)=>{o.d(t,{Z:()=>a});var i=o(55010),n=o(76796);class r extends n.B{getMembersByDOMOrder(e){let{filter:t}=e;return super.filter(t).sort(((e,t)=>(0,i.Z)(e.getNode(),t.getNode())))}}const a=r},76796:(e,t,o)=>{o.d(t,{B:()=>i});class i{constructor(){this.members=new Set}register(e){return this.members.add(e),()=>this.unregister(e)}unregister(e){this.members.delete(e)}getSize(){return this.members.size}hasMembers(){return this.getSize()>0}find(e){for(const t of this.members)if(e(t))return t}filter(e){const t=[];for(const o of this.members)e(o)&&t.push(o);return t}forEach(e){this.members.forEach(e)}}},97477:(e,t,o)=>{o.d(t,{IE:()=>m,rn:()=>g,j2:()=>u,FB:()=>h});var i=o(33646),n=o(82742),r=o(92876),a=o(96569),s=(o(96486),o(65917)),l=o(2911);const c={local:0,development:1,staging:1,production:.1};function d(e){if((e=e.replace(/([0-9A-Za-z\-]+)-([0-9a-f]+)/g,(function(e){return`[REDACTED]-${arguments.length<=2?void 0:arguments[2]}`}))).startsWith("/api/")){return new URL(e,"https://example.com").pathname}return e}function p(e,t){if(e&&"object"==typeof e)for(const o of t){const t=e[o];"string"==typeof t&&(e[o]=d(t))}}function u(e,t){n.S1({dsn:"https://704fe3b1898d4ccda1d05fe1ee79a1f7@o324374.ingest.sentry.io/5741876",beforeSend(e){const t=function(e){const{request:t}=e;return t&&(p(t,["url"]),p(t.headers,["Referer"])),e}(e);return t},beforeBreadcrumb(e,t){const o=function(e){return"http"===e.type?p(e.data,["url"]):"navigation"===e.category&&p(e.data,["from","to"]),e}(e);return o},environment:e.env,release:e.version,attachStacktrace:!0,tracesSampler:()=>t(e.env),integrations:[new i.jK.GlobalHandlers({onerror:!0,onunhandledrejection:!1}),new a.gE],sampleRate:c[e.env]}),r.e((t=>{t.setExtra("clientVersion",e.version)}))}function m(e,t){return r.Tb(e,t)}function g(e,t){const{from:o,type:i,data:n}=t;let r="error is not an Error, bypassing Sentry";e instanceof Error&&(r=m(e,{tags:{from:o,type:i}})),s.log({level:"error",from:o,type:i,error:(0,l.Ui)(e),data:n,sentryEventId:r})}function h(e){r.e((t=>t.setTransactionName(e)))}},87997:(e,t,o)=>{o.r(t),o.d(t,{CurrentUser:()=>i});class i{constructor(e){this._id=void 0,this._loggedInUserIds=void 0,this._adminUserId=void 0,this.args=e,this._id=null==e?void 0:e.id,this._loggedInUserIds=(null==e?void 0:e.loggedInUserIds)||[],this._adminUserId=null==e?void 0:e.adminUserId}get id(){return this._id}get loggedInUserIds(){return this._loggedInUserIds}get adminUserId(){return this._adminUserId}isLoggedIn(){var e;return Boolean(null===(e=this.args)||void 0===e?void 0:e.id)}}},14577:(e,t,o)=>{o.d(t,{Z:()=>f});var i=o(96486),n=o(88108),r=o(1674),a=o(62965),s=o(97880),l=o(63143),c=o(18466),d=o(1103),p=o(45060),u=o(62328),m=o(1302);const g={};(0,n.exposeDebugValue)("getComputedStore",(e=>g[e]));class h{constructor(e,t){this.debug=!1,this.debugName=void 0,this.computeFn=void 0,this.autoListener=void 0,this.autoPublisher=void 0,this.hasListeners=!1,this.shouldRecompute=!1,this.useDeepEqual=!1,this.recomputeSchedule=void 0,this.handleChange=()=>{"lazy"===this.recomputeSchedule?(this.setShouldRecompute(),m.default.enqueueComputedStoreRecompute((0,l.xt)(this.recomputeState,"debugName",this.debugName))):"eager"===this.recomputeSchedule?this.recomputeState():(0,s.t1)(this.recomputeSchedule)},this.recomputeState=()=>{this.shouldRecompute=!1;const e=this.lastState;this.hasListeners&&this.autoListener.startListener({incrementCycle:!0}),(h.debug||this.debug)&&console.time(`${this.debugName} recompute`);const t=this.computeFn();(h.debug||this.debug)&&console.timeEnd(`${this.debugName} recompute`),this.hasListeners&&this.autoListener.stopListener({isEndOfCycle:!0}),(this.useDeepEqual?(0,i.isEqual)(e,t):(0,a.Z)(e,t))?(h.debug||this.debug)&&r.T.log("ComputedStore.recomputeState unchanged",this.debugName,this):((h.debug||this.debug)&&r.T.log("ComputedStore.recomputeState emit",this.debugName,this),this.lastState=t,this.emit())},this.computeFn=e,this.debugName=t.debugName,this.autoListener=new c.Z({onChange:this.handleChange,debugName:this.debugName}),this.autoPublisher=new d.Z({getDebugInfo:()=>({hasListeners:this.hasListeners,lastState:this.lastState}),effect:()=>(this.hasListeners=!0,this.recomputeState(),()=>{this.hasListeners=!1,this.autoListener.destroy()})}),this.useDeepEqual=Boolean(t.useDeepEqual),(h.debug||this.debug)&&(g[this.debugName]=this),this.recomputeSchedule=(null==t?void 0:t.recomputeSchedule)??"lazy"}getState(){return this.autoPublisher.subscribe(this),this.hasListeners?(this.shouldRecompute&&this.recomputeState(),this.lastState):this.computeFn()}get state(){return this.getState()}addListener(e){this.autoPublisher.addListener(e)}removeListener(e){this.autoPublisher.removeListener(e)}emit(){u.logStoreEmit(this),this.autoPublisher.emit(this)}listenerCount(){return this.autoPublisher.listenerCount()}updateStoreInstance(e,t){const o=Boolean(t);this.useDeepEqual===o&&this.computeFn===e||((h.debug||this.debug)&&r.T.log("ComputedStore.updateStoreInstance changed",this.debugName),this.computeFn=e,this.useDeepEqual=o,this.setShouldRecompute())}setShouldRecompute(){this.shouldRecompute=!0}enqueueRecompute(){this.handleChange()}recompute(){this.recomputeState()}}h.debug=!1;const f=h;(0,p.Rw)({canFormat:e=>Boolean(e&&e instanceof h),header(e){const{span:t,object:o,objectSummary:i,CONTAINER_STYLE:n}=p.TI,r=e.lastState;return t(n,o(e,{useDefaultFormatter:!0}),"(",r&&"object"==typeof r?i(r):o(r),")")},hasBody:()=>!1,body:()=>null})},53809:(e,t,o)=>{o.d(t,{D:()=>d});var i=o(96486),n=o.n(i),r=o(56164),a=o(1103),s=o(97477);const l="notion_test_local_storage_key",c="notion_123";class d{constructor(e){let{key:t,namespace:o,important:i,trackingType:p}=e;if(this.lru=void 0,this.key=void 0,this.autoPublisher=new a.Z({getDebugInfo:()=>this.lru.get(this.key,{disableLRU:!0}),effect:()=>(window.addEventListener("storage",this.handleStorage),()=>{window.removeEventListener("storage",this.handleStorage)})}),this._canPersistToLocalStorage=void 0,this.canPersistToLocalStorage=()=>{if(void 0===this._canPersistToLocalStorage){let e;try{this.lru.set(l,c),e=this.lru.get(l,{disableLRU:!0}),e&&this.lru.remove(l)}catch{}this._canPersistToLocalStorage=e===c}return this._canPersistToLocalStorage},this.handleStorage=e=>{if("string"!=typeof e.key)return;if(this.lru.parseRawKeyToOwnedKey(e.key)===this.key){if(null===e.newValue&&e.oldValue)return void this.emit();if(e.newValue&&null===e.oldValue)return void this.emit();if(null===e.oldValue&&null===e.newValue)return;if(e.newValue&&e.oldValue)try{const t=JSON.parse(e.oldValue).value,o=JSON.parse(e.newValue).value;n().isEqual(t,o)||this.emit()}catch{(0,s.rn)(new Error("Malformed value(s) found in localStorage"),{from:"LocalStorageKeyStore",type:"ParseError",data:{key:e.key,oldValue:e.oldValue,newValue:e.newValue}})}}},d.keysWithStores.has(`${o}:${t}`))throw new Error("Please create only one LocalStorageKeyStore per key.");d.keysWithStores.add(`${o}:${t}`),this.key=t,this.lru=new r.ZP(o,i,p)}getState(){return this.autoPublisher.subscribe(this),this.lru.get(this.key)}get state(){return this.getState()}setState(e){const t=this.lru.get(this.key,{disableLRU:!0});n().isEqual(t,e)||(void 0!==e?this.lru.set(this.key,e):this.lru.remove(this.key),this.emit())}emit(){this.autoPublisher.emit(this)}addListener(e){this.autoPublisher.addListener(e)}removeListener(e){this.autoPublisher.removeListener(e)}static reset_TEST_ONLY(){d.keysWithStores=new Set([])}}d.keysWithStores=new Set([])},49085:(e,t,o)=>{o.d(t,{Z:()=>d});var i=o(96486),n=o.n(i),r=o(62965),a=o(1103),s=o(45060),l=o(62328);class c{constructor(){this.debug=!1,this.instanceState=void 0,this.autoPublisher=new a.Z({getDebugInfo:()=>this.instanceState}),this.instanceState=this.getInitialState(),l.logStoreCreated(this,this.instanceState)}getState(){return this.autoPublisher.subscribe(this),this.instanceState}get state(){return this.getState()}setState(e){(0,r.Z)(this.instanceState,e)||(this.instanceState=e,l.logStoreSet(this,e),this.emit())}reset(){this.setState(this.getInitialState())}update(e){this.setState(e(this.state))}emit(){l.logStoreEmit(this),this.debug&&console.warn("emit:",n().cloneDeep(this)),this.autoPublisher.emit(this)}addListener(e){this.autoPublisher.addListener(e)}removeListener(e){this.autoPublisher.removeListener(e)}listenerCount(){return this.autoPublisher.listenerCount()}waitUntil(e){return e()?Promise.resolve():new Promise((t=>{const o=()=>{e()&&(this.removeListener(o),t())};this.addListener(o)}))}getInitialState(){return{}}}const d=c;(0,s.Rw)({canFormat:e=>Boolean(e&&e instanceof c),header(e){const{span:t,object:o,objectSummary:i,CONTAINER_STYLE:n}=s.TI,r=e.instanceState;return t(n,o(e,{useDefaultFormatter:!0}),"(",r&&"object"==typeof r?i(r):o(r),")")},hasBody:()=>!1,body:()=>null})},27328:(e,t,o)=>{o.d(t,{Xk:()=>l,F9:()=>c,Gt:()=>d,w_:()=>p,Os:()=>u});var i=o(96486),n=o(65917),r=o(89101),a=o(64002),s=o(49085);class l extends s.Z{constructor(){super(...arguments),this.previousState=void 0}getInitialState(){let e;try{switch(location.pathname){case"/nativetab/search":e="search";break;case"/nativetab/updates":e="updates";break;default:e="home"}}catch{e="home"}return{activeTab:e,tabs:{home:{rootPage:{type:"native",id:"home"},pages:[{type:"web",route:{name:"root"},url:"/"}],nativeRootPageOverrideEnabled:!0},search:{rootPage:{type:"web",route:{name:"nativeTab",tab:"search",spaceId:void 0},url:`${r.VP.nativeTab}/search`},pages:[]},updates:{rootPage:{type:"web",route:{name:"nativeTab",tab:"updates",spaceId:void 0},url:`${r.VP.nativeTab}/updates`},pages:[]},addPage:{rootPage:{type:"web",route:{name:"new"},url:r.VP.newPage},pages:[]}}}}getPreviousState(){return this.previousState}setupWithNativeSearch(){const e=(0,i.cloneDeep)(this.state);e.tabs.search.rootPage={type:"native",id:"search"},this.setState(e)}updateWithWebPage(e){const{page:t,action:o,updateMobileTabbedRouterArgs:r}=e,{url:a,route:s}=t,l=(null==r?void 0:r.silenceErrors)||!1;this.debug&&console.info(`TabbedRouterStore.updateWithWebPage ${o} ${s.name} ${a} clearNativeRootPageOverride: ${null==r?void 0:r.clearNativeRootPageOverride}`);const c=(0,i.cloneDeep)(this.state),d=c.tabs[c.activeTab];switch(o){case"pop":const e=(0,i.findLastIndex)(d.pages,(e=>this.isWebPageEqual({page:e,otherRoute:s,otherUrl:a})));if(-1!==e&&e!==d.pages.length-1)d.pages=d.pages.slice(0,e+1);else if("web"===d.rootPage.type&&this.isWebPageEqual({page:d.rootPage,otherRoute:s,otherUrl:a}))d.pages=[];else{if("web"===d.rootPage.type?d.pages=d.pages.slice(0,-1):"native"===d.rootPage.type&&(d.pages.length>=1?d.pages=d.pages.slice(0,-1):d.nativeRootPageOverrideEnabled=!0),l)break;const e=`Unhandled pop - ${a} ${JSON.stringify(s)} is not in pages nor the rootPage`;this.debug&&console.error(`TabbedRouterStore.updateWithWebPage - ${e}`),n.log({level:"error",from:"TabbedRouterStore",type:"updateWithPage",error:{message:e}})}break;case"replace":const t=d.rootPage;switch(t.type){case"web":d.pages=[],t.redirectedTo={route:s,url:a};break;case"native":const e=d.pages.length>0?d.pages[0]:void 0;d.pages=e?[{...e,redirectedTo:{route:s,url:a}}]:[{type:"web",route:s,url:a}]}break;case"push":const o=c.tabs[c.activeTab].pages;if(o.length>0&&this.isWebPageEqual({page:o[o.length-1],otherUrl:a,otherRoute:s}))break;const r=o.filter((e=>{var t,o;if(null!==(t=e.redirectedTo)&&void 0!==t&&t.route){var i;if("root"===(null===(i=e.redirectedTo)||void 0===i?void 0:i.route.name))return!1}else{if("root"===e.route.name)return!1;if("onboarding"===e.route.name)return!1;var n;if(null!==(o=e.redirectedTo)&&void 0!==o&&o.route&&"onboarding"===(null===(n=e.redirectedTo)||void 0===n?void 0:n.route.name))return!1}return!0}));r.push({type:"web",route:s,url:a}),c.tabs[c.activeTab].pages=r}("onboarding"===t.route.name||Boolean(null==r?void 0:r.clearNativeRootPageOverride))&&(d.nativeRootPageOverrideEnabled=void 0);const u=p(this.state);this.setState(c);const m=p(this.state);if(!l&&"replace"!==o&&(0,i.isEqual)(u,m)){const e=`topPage is the same. Web page ${o} ${s.name} ${a}`;this.debug&&console.error(`TabbedRouterStore.updateWithWebPage - ${e}`),n.log({level:"error",from:"TabbedRouterStore",type:"updateWithWebPage",error:{message:e}})}}updateWithNativePage(e){const{page:t,clearPages:o,navigationAction:n,navigationSource:r}=e,a=(0,i.cloneDeep)(this.state);a.navigationAction=n,a.navigationSource=r;const s=a.tabs[a.activeTab],l=s.rootPage;this.debug&&console.info(`TabbedRouterStore.updateWithNativePage ${t.id}`),"native"===l.type&&l.id===t.id&&(s.nativeRootPageOverrideEnabled=!0,o&&(s.pages=[]),this.setState(a))}canGoBack(){return Boolean(u(this.state))}canGoForward(){return!1}setState(e){(0,i.isEqual)(this.state,e)||(this.previousState=this.state,this.instanceState=e,this.emit())}isWebPageEqual(e){const{page:t,otherUrl:o,otherRoute:i}=e;if(this.isRouteEqual(t.route,i))return!0;if(d(t)===o)return!0;if(t.redirectedTo){if(this.isRouteEqual(t.redirectedTo.route,i))return!0;if(t.redirectedTo.url===o)return!0}}isRouteEqual(e,t){if(e.name!==t.name)return!1;let o,n;if("nativeTab"===e.name){const o=t;return e.tab===o.tab&&((!o.spaceId||!e.spaceId||o.spaceId===e.spaceId)&&e.tab===o.tab)}return o=e,n=t,(0,i.isEqual)(o,n)}}function c(e){const t=p(e),o={tab:e.activeTab,type:t.type,route:{name:"native"===t.type?t.id:t.route.name}},i="web"===t.type?t.route:null;return null!==i&&"blockId"in i&&(o.route.block_id=i.blockId),o}function d(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;if(!t&&e.redirectedTo)return e.redirectedTo.url;const i=a.T1(e.url),n=o||e.queryParams;return n?a.SK(i,n):i}function p(e){const t=e.tabs[e.activeTab];return t.pages.length>0?"native"===t.rootPage.type&&t.nativeRootPageOverrideEnabled?t.rootPage:t.pages[t.pages.length-1]:t.rootPage}function u(e){const t=e.tabs[e.activeTab];return t.nativeRootPageOverrideEnabled&&"native"===t.rootPage.type?void 0:t.pages.length>0?t.pages.length>1?t.pages[t.pages.length-2]:t.rootPage:void 0}},20475:(e,t,o)=>{o.d(t,{Z:()=>n});var i=o(49085);class n extends i.Z{getInitialState(){return{mode:"light"}}}},69615:(e,t,o)=>{o.d(t,{g:()=>a,j:()=>s});var i=o(96486),n=o.n(i),r=o(49085);const a=44;class s extends r.Z{constructor(e,t){if(super(),this.environment=void 0,this.measureEl=void 0,this.fullWindowEl=void 0,this.window=void 0,this.updateWindowSize=()=>{this.setState(this.getCurrentState())},this.updateWindowSizeDebounced=n().debounce(this.updateWindowSize,300),this.shouldUseCSSEnv=n().once((()=>{const{device:e}=this.environment,t="undefined"!=typeof CSS&&void 0!==CSS.supports&&CSS.supports("padding","env(safe-area-inset-top)"),o=e.isIOS&&e.isMobileBrowser&&!e.isSafari;return t&&!o})),this.window=t,this.environment=e,this.environment.device.isMobileBrowser){const e=this.window.document.createElement("div");e.style.position="fixed",e.style.height="100vh",e.style.top="0px",e.style.pointerEvents="none",this.window.document.body.appendChild(e),this.fullWindowEl=e}const o=this.window.document.createElement("div");this.window.document.body.appendChild(o),this.measureEl=o,this.window.addEventListener("resize",this.updateWindowSizeDebounced),this.updateWindowSize()}getSafePaddingTopCSS(e){return`calc(${e}px + ${this.state.paddingTopCSS})`}getSafePaddingLeftCSS(e){return`calc(${e}px + ${this.state.paddingLeftCSS})`}getSafePaddingRightCSS(e){return`calc(${e}px + ${this.state.paddingRightCSS})`}getSafePaddingBottomCSS(e){return`calc(${e}px + ${this.state.paddingBottomCSS})`}getSafePaddingTopPx(e){return e+this.state.paddingTop}getSafePaddingLeftPx(e){return e+this.state.paddingLeft}getSafePaddingRightPx(e){return e+this.state.paddingRight}getSafePaddingBottomPx(e){return e+this.state.paddingBottom}isLandscape(){return this.state.width===this.state.largestDimension}isPortrait(){return!this.isLandscape()}getCurrentState(){const{device:e}=this.environment,t=e.isIOS?this.window.document.documentElement.clientWidth:this.window.innerWidth,o=e.isIOS?this.window.document.documentElement.clientHeight:this.window.innerHeight,i=this.state&&this.state.largestDimension?this.state.largestDimension:0,n=Math.max(this.window.innerWidth,this.window.innerHeight,i);let r,a,s,l,c,d,p,u;if(this.shouldUseCSSEnv()&&this.measureEl?(a="env(safe-area-inset-top)",this.measureEl.style.width=a,r=this.measureEl.offsetWidth):(a="0px",r=0),this.shouldUseCSSEnv()&&this.measureEl?(l="env(safe-area-inset-left)",this.measureEl.style.width=l,s=this.measureEl.offsetWidth):(l="0px",s=0),this.shouldUseCSSEnv()&&this.measureEl?(d="env(safe-area-inset-right)",this.measureEl.style.width=d,c=this.measureEl.offsetWidth):(d="0px",c=0),e.isMobileBrowser&&this.fullWindowEl?(p=this.fullWindowEl.getBoundingClientRect().height-this.window.innerHeight,u=`${p}px`):this.shouldUseCSSEnv()&&this.measureEl?(u="env(safe-area-inset-bottom)",this.measureEl.style.width=u,p=this.measureEl.offsetWidth):(u="0px",p=0),e.isMobileBrowser){this.window.document.body.style.height=`${window.innerHeight}px`;const e=this.window.document.querySelector("html");e&&(e.style.height=`${window.innerHeight}px`);const t=this.window.document.querySelector("body");t&&(t.style.height=`${window.innerHeight}px`);const o=this.window.document.querySelector("#notion-app");o&&o instanceof HTMLElement&&(o.style.height=`${window.innerHeight}px`)}return{width:t,height:o,paddingLeft:s,paddingTop:r,paddingBottom:p,paddingRight:c,paddingTopCSS:a,paddingLeftCSS:l,paddingRightCSS:d,paddingBottomCSS:u,largestDimension:n}}}},96323:(e,t,o)=>{o.d(t,{vE:()=>B,Xp:()=>Z,Ll:()=>R,JX:()=>A,w_:()=>D,cK:()=>V,LK:()=>N,xI:()=>U,F0:()=>z,xj:()=>K,sH:()=>G,NZ:()=>q,Hh:()=>J,nX:()=>Q,lA:()=>ee});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(480),p=o(81954),u=o(24405),m=o(41432),g=o(8848),h=o(3779),f=o(5366),v=o(97880),y=o(73928),b=o(42858),S=o(30149),w=o(63594),k=o(72495),C=o(617),_=o(99417),M=o(40959),T=o(16772),I=o(27724),P=o(62967);const x=(0,f.defineMessages)({notionAI:{defaultMessage:"Notion AI",id:"completions.completionActions.AIAssist",description:"Label for Notion's artificial intelligence powered assisted writing feature"},more:{defaultMessage:"See more",id:"completions.completionActions.more",description:"Label of button for user to view more menu items"},alternativeUiString:{defaultMessage:"{text}",id:"completions.completionActions.alternativeUiString",description:"Label of highly experimental menu item that doesn't need to be localized yet"},aiSummaryBlockDisplayName:{defaultMessage:"Summary",id:"completions.completionActions.aiSummaryBlockDisplayName",description:"Label for the menu item to create an AI powered summary block"},aiActionItemsBlockDisplayName:{defaultMessage:"Action items",id:"completions.completionActions.aiActionItemsBlockDisplayName",description:"Label for the menu item to create an AI powered action items block"},aiFreePromptBlockDisplayName:{defaultMessage:"Custom AI block",id:"completions.completionActions.aiFreePromptBlockDisplayName",description:"Label for the menu item to create an AI powered custom block"}}),B=[C.J5,C.ff(C.fI),e=>(0,_.GD)(e.environment,e.publicEditMode),C.ff(C.OX)],Z=[...B,e=>{const{blocks:t}=e;return t.some((e=>{const t=e.getType();return void 0!==t&&_.d5[t]}))}];function E(e){return function(t){return c.createElement(k.Z,n()({},t,{title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,h.Z.sparkles({width:16,height:16,marginRight:4}),a()("div",{},void 0,t.title)),right:e}))}}const R=.5;function A(){const e={selectionType:"cursor",isPageEmpty:!C.IC()},t=(0,_.up)(e),o=l().flatten((0,_.pv)(t,e).map((e=>{let[t,o]=e;return o})));return{maxActionsBeforeMore:w.Z.state?3:1,actions:o.map((e=>q({prompt:e,validators:B,type:"cursor",from:"slash_menu",sortScoreMultiplier:.75}))).filter(v.$K)}}function D(){const{maxActionsBeforeMore:e,actions:t}=A();return(0,P.$J)({key:"completions",title:x.notionAI,render:E(),actions:F(t,e)})}function F(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;const o=[];if(o.push(...e.slice(0,t)),e.length>t){const i=(0,P.$J)({key:"more actions",render:e=>c.createElement(k.Z,e),actions:e.slice(t)});o.push((0,P.MV)({key:"more",displayName:x.more,analyticsName:"Completions - more",validators:B,svg:()=>a()(Q,{}),subActions:()=>[i],collapseSubActionsIntoParent:!0,width:350}))}return o}function L(){return window.__c={n:"leftWriteIcon"},a()(ee,{svg:h.Z.pencil,svgFill:g.FN.light.purple[500]})}function V(e){const{key:t,name:o,analyticsName:i,textToInsert:n,onUpdatePromptState:r,right:a,renderTooltip:s,showEllipsis:l}=e,c=o.length>1e3?`${o.slice(0,1e3)}…`:o;return(0,P.PH)({key:t,analyticsName:`Completions - insert text into prompt - ${i}`,...(d=l?`${c}…`:c,{displayName:x.alternativeUiString,displayNameInterpolatedValues:{text:d}}),validators:[],closeParentMenu:!1,svg:L,action(){r({insertText:n??o,analyticsName:i})},right:a??Y("updatePrompt"),renderTooltip:s});var d}function N(e){const{from:t,type:o,onUpdatePromptState:i}=e;function n(e){return V({key:`completions.${e.key}`,name:(0,_.t8)(e),analyticsName:e.key,textToInsert:(0,_.$W)(e),onUpdatePromptState:i,showEllipsis:!0})}const r="cursor"===o?{selectionType:o,isPageEmpty:!C.IC()}:{selectionType:o},a=(0,_.up)(r),s=(0,_.pv)(a,r),l=[];for(const[d,p]of s){const e=[];for(const r of p)"helpMeDraft"!==r.key&&"helpMeEdit"!==r.key&&"helpMeWrite"!==r.key&&("translate"===r.key?e.push(W(r,B,o,t)):"changeTone"===r.key?e.push(j(r,B,o,t)):r.steps?e.push(n(r)):e.push(q({prompt:r,validators:B,type:o,from:t})));const i=(0,P.$J)({key:`completions.${d}`,title:(0,_.Mh)(d,"cursor"===o?"page":"selection"),render:e=>c.createElement(k.Z,e),actions:F(e.filter(v.$K),7)});l.push(i)}return"cursor"===o&&l.push((0,P.$J)({key:"completions.aiBlocks",title:_.Dr.aiBlocks,render:e=>c.createElement(k.Z,e),actions:M.O5.map((e=>function(e){const t=M.Hc[e.aiBlockType],{displayName:o,svg:i}=O[e.aiBlockType];return(0,P.PH)({key:`completions.aiBlocks.${t.key}`,analyticsName:`Completions - ${t.key}`,closeParentMenu:!0,svg:i,displayName:o,validators:B,action:e=>{let{environment:o}=e;S.createAndCommit({userAction:"completionActions.createAiBlockAction",environment:o,perform:e=>{b.at({environment:o,selection:I.default.state.stores,createBlockItem:t,analyticsFrom:"ai_prompt",transaction:e})}})}})}({aiBlockType:e})))})),l}const O={[m.MF.aiSummaryBlock]:{displayName:x.aiSummaryBlockDisplayName,svg:()=>a()(te,{svg:h.Z.assistSummarize})},[m.MF.aiActionItemsBlock]:{displayName:x.aiActionItemsBlockDisplayName,svg:()=>a()(te,{svg:h.Z.assistFindActionItems})},[m.MF.aiFreePromptBlock]:{displayName:x.aiFreePromptBlockDisplayName,svg:()=>a()(te,{svg:h.Z.sparkles})}};function U(e){return(0,P.$J)({key:"completions",title:x.notionAI,render:E(),actions:H(e)})}function H(e){const{store:t,from:o}=e,i=[];for(const n of _.fA){if("helpMeWrite"===n.key)continue;const e=q({prompt:n,validators:B,type:"aiBlock",from:o,store:t});e&&i.push(e)}return i}function z(e){const{environment:t,inputValue:o,store:i}=e,n=(0,_.qB)({customPrompt:o,isPageEmpty:!1});y.iJ({environment:t,store:i,prompt:n,additionalContext:{prompt:o}})}function W(e,t,o,i){const{key:n,name:r,svg:s,svgFill:l,steps:d}=e;if("translate"!==n||!d||1!==d.length||"language"!==d[0].key||"dropdown"!==d[0].type)return;const p=d[0].dropdownOptions.map((n=>{let{key:r,name:a}=n;return(0,P.PH)({key:`completions.translate.${r}`,analyticsName:`Completions - translate - ${r}`,displayName:a,validators:t,closeParentMenu:!0,right:Y("submitPrompt"),action:t=>{let{environment:n}=t;$({environment:n,prompt:e,from:i,type:o,additionalContext:{language:r}})}})})),u=(0,P.$J)({key:"translate language actions",render:e=>c.createElement(k.Z,e),actions:p}),m=s?()=>a()(ee,{svg:s,svgFill:l}):void 0;return(0,P.MV)({key:"translate",displayName:r,analyticsName:`Completions - ${n}`,validators:t,svg:m,subActions:()=>[u]})}function j(e,t,o,i){const{key:n,name:r,svg:s,svgFill:l,steps:d}=e;if("changeTone"!==n||!d||1!==d.length||"tone"!==d[0].key||"dropdown"!==d[0].type)return;const p=d[0].dropdownOptions.map((n=>{let{key:r,name:a}=n;return(0,P.PH)({key:`completions.changeTone.${r}`,analyticsName:`Completions - changeTone - ${r}`,displayName:a,validators:t,closeParentMenu:!0,right:Y("submitPrompt"),action:t=>{let{environment:n}=t;$({environment:n,prompt:e,from:i,type:o,additionalContext:{tone:r}})}})})),u=(0,P.$J)({key:"changeTone tone actions",render:e=>c.createElement(k.Z,e),actions:p}),m=s?()=>a()(ee,{svg:s,svgFill:l}):void 0;return(0,P.MV)({key:"changeTone",displayName:r,analyticsName:`Completions - ${n}`,validators:t,svg:m,subActions:()=>[u]})}function K(e){const{focused:t,type:o}=e,i=(0,d.O7)(),n=(0,p.VK)((()=>i.device.isPhone),[i]),r=(0,u.yK)((e=>({iconStyle:{width:14,height:14,fill:e.mediumIconColor,opacity:!n&&t?1:0},containerStyle:{width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center"}})),[t,n]);switch(o){case"submitPrompt":return a()("div",{style:r.containerStyle},void 0,h.Z.enter(r.iconStyle));case"updatePrompt":return a()("div",{style:r.containerStyle},void 0,h.Z.upLeftArrow(r.iconStyle));default:(0,v.t1)(o)}}function Y(e){return t=>a()(K,{type:e,focused:t.focused})}function G(e){const{customPrompt:t,execute:o}=e;return(0,P.PH)({analyticsName:"Completions - execute current prompt input",key:"explicitFreeFormAction",displayName:_.Dr.genericHelpMeWrite,displayNameInterpolatedValues:{filter:t},svg:L,right:Y("submitPrompt"),validators:[],closeParentMenu:!1,renderTooltip:P.zz,action(){o()}})}const X=e=>(0,_.L3)(e.environment);function q(e){const{prompt:t,validators:o,type:i,from:n,store:r,sortScoreMultiplier:s}=e,{key:l,name:c}=t;if("translate"===l&&("textSelection"===i||"blockSelection"===i||"cursor"===i))return W(t,o,i,n);if("changeTone"===l&&("textSelection"===i||"blockSelection"===i||"cursor"===i))return j(t,o,i,n);const d=function(e){const{svg:t,svgFill:o}=e;return t?()=>a()(ee,{svg:t,svgFill:o}):void 0}(t),p=[...o];return t.requiresContent?p.push(C.IC):t.requiresNoContent&&p.push(C.ff(C.IC)),t.isNewModel&&p.push(X),(0,P.PH)({key:`completions.${l}`,analyticsName:`Completions - ${l}`,displayName:c,fuzzySearchKeywords:t.fuzzySearchKeywords,validators:p,closeParentMenu:!0,svg:d,right:Y("submitPrompt"),sortScoreMultiplier:s,action:e=>{let{environment:o}=e;$({environment:o,prompt:t,type:i,from:n,store:r})}})}function $(e){const{environment:t,prompt:o,type:i,from:n,store:r,additionalContext:a}=e;if("textSelection"===i)y.IV({environment:t,prompt:o,from:n,additionalContext:a});else if("blockSelection"===i)y.z0({environment:t,prompt:o,from:n,additionalContext:a});else if("cursor"===i){if(o.preferToNeverInsertTextAtCursor)return void y.mE({environment:t,prompt:o,from:n,additionalContext:a});y.lx({environment:t,prompt:o,from:n,additionalContext:a})}else"aiBlock"===i?r&&y.iJ({environment:t,store:r,prompt:o,additionalContext:a}):(0,v.t1)(i)}function J(e){const{inputValue:t,from:o,mode:i,environment:n}=e;switch(i){case"edit":return void function(e){const{customPrompt:t,from:o,environment:i}=e,n=(0,_.sB)(t);"closedWithContext"===T.default.state.type&&T.default.state.context&&y.Tg({environment:i,context:T.default.state.context,prompt:n,additionalContext:{prompt:t},from:o,skipInitialForm:!0})}({environment:n,customPrompt:t,from:o});case"write":const e=(0,_.wq)(t);if(e){const{prompt:t,additionalContext:i}=e,r=(0,_.FD)();if(!r)return;return void y.Tg({environment:n,context:r,prompt:t,additionalContext:i,from:o,skipInitialForm:!0})}return void function(e){const{environment:t,customPrompt:o,from:i}=e,n=(0,_.qB)({customPrompt:o,isPageEmpty:!C.IC()}),r=(0,_.FD)();r&&y.Tg({environment:t,context:r,prompt:n,additionalContext:{prompt:o},from:i,skipInitialForm:!0})}({environment:n,customPrompt:t,from:o})}(0,v.t1)(i)}function Q(){const e=(0,u.Fg)();return h.Z.dots({width:12,marginLeft:2,marginRight:2,fill:e.mediumIconColor})}function ee(e){window.__c={n:"BoxedIcon"};const t=(0,u.yK)((t=>({box:{height:e.fixedWidth?22:void 0,width:e.fixedWidth?22:void 0,display:"flex",alignItems:"center",justifyContent:"center",...e.boxStyles},icon:{height:16,width:16,fill:e.svgFill??(0,g.gh)({theme:"light"}).regularIconColor}})),[e]);return a()("div",{style:t.box},void 0,e.svg(t.icon))}function te(e){window.__c={n:"AiBlockIcon"};const t=(0,u.yK)((e=>({box:{background:e.accent.purple.background,width:24,height:24,borderRadius:3},icon:{fill:e.accent.purple.icon}})),[]);return a()(ee,{svg:e.svg,svgFill:t.icon.fill,boxStyles:t.box})}},62967:(e,t,o)=>{o.d(t,{zz:()=>y,PH:()=>S,$J:()=>w,MV:()=>k});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(93405),c=o(48019),d=o(52275),p=o(78140),u=o(40721),m=o(58032),g=o(95030),h=o(33929),f=o(60709),v=o(98742);const y=e=>{let{title:t}=e;return t},b={maxWidth:400,whiteSpace:"pre-wrap"};function S(e){const{key:t,displayName:o,displayNameInterpolatedValues:i,analyticsName:r,fuzzySearchKeywords:c,svg:d,validators:p,shortcuts:u,sortScoreMultiplier:g,closeParentMenu:f,action:y,subActions:S,collapseSubActionsIntoParent:w,nativeRender:k,alwaysShowInSearch:C,right:_,renderTooltip:M}=e,T=o?h.default.formatMessage(o,i):void 0,I=c||o,P=c?h.default.formatMessage(c):T,x=I?P===I.defaultMessage?P:`${P} ${I.defaultMessage}`:void 0,B=e.render??((t,o,i)=>{const r=(e.contextualDisplayName?e.contextualDisplayName(o):void 0)||T;return n()(m.Z,{render:e=>s.createElement(l.Z,a()({},(0,v.Z)(t,e),{title:r,svg:d,shortcuts:u,right:"function"==typeof _?_(t,o,i):_})),renderTooltip:()=>n()("div",{style:b},void 0,null==M?void 0:M({title:r})),disableTooltip:!M,placement:m.Z.Placement.Right})});return{key:`action ${t}`,displayName:T,analyticsName:r,searchName:x,validators:p,shortcuts:u,sortScoreMultiplier:g,action:y,subActions:S,collapseSubActionsIntoParent:w,closeParentMenu:f,render:B,nativeRender:k,alwaysShowInSearch:C}}function w(e){const{key:t,title:o,overrideSearchTitle:i,render:n,actions:r}=e,a=o?h.default.formatMessage(o):void 0,s=i||o,l=s&&h.default.formatMessage(s);return{key:t,title:a,searchTitle:s?l===s.defaultMessage?l:`${l} ${s.defaultMessage}`:void 0,render:n,actions:r}}function k(e){const{key:t,displayName:o,displayNameInterpolatedValues:i,analyticsName:r,validators:m,shortcuts:h,subActions:v,collapseSubActionsIntoParent:y,svg:b,icon:w,right:k,width:C}=e,_=S({key:`extension ${t}`,displayName:o,displayNameInterpolatedValues:i,analyticsName:r,validators:m,shortcuts:h,subActions:v,collapseSubActionsIntoParent:y,closeParentMenu:!0,action:()=>{},render:(e,t,o)=>s.createElement(g.Z,a()({},e,{renderOrigin:(e,t)=>b?s.createElement(l.Z,a()({},e,{title:_.displayName,svg:b,shortcuts:h,right:k,ref:t})):s.createElement(d.Z,a()({},e,{title:_.displayName,icon:w,right:k,ref:t})),onFocus:o.onFocus,renderExtension:(e,i)=>{let r;return r=t.environment.device.isPhone?{menuType:f.og.Modal,right:n()(u.DoneMenuText,{}),onClickRight:i.close,...e}:{menuType:f.og.Popup,width:C??220,...e},s.createElement(p.Z,r,n()(c.Z,{initialFocus:0,context:t,sections:v(t),onAccept:o.onAccept}))}}))});return _}},95182:(e,t,o)=>{o.d(t,{lV:()=>Hl,Vm:()=>Rs,Sw:()=>Ns,Qi:()=>fl,Gy:()=>yl,j8:()=>gl,qq:()=>ml,IK:()=>Dr,pD:()=>rl,RP:()=>pl,dB:()=>Sl,wg:()=>Nl,qu:()=>nl,sY:()=>nn,vC:()=>Ol,Oq:()=>vl,yT:()=>hl,G9:()=>kl,iD:()=>wl,TB:()=>Dl,rz:()=>Es,b4:()=>Vs,te:()=>Us,gH:()=>Ps,OH:()=>cl});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(27537),l=o.n(s),c=o(96486),d=o.n(c),p=o(67294),u=o(62328),m=o(1302),g=o(13991),h=o(14577),f=o(41892),v=o(41432),y=o(17397),b=o(8848),S=o(86658),w=o(6695),k=o(3779),C=o(15157),_=o(98459),M=o(89101),T=o(70203),I=o(97880),P=o(82990),x=o(64002),B=o(5366),Z=o(50906),E=o(19719),R=o(54642),A=o(27724),D=o(44886),F=o(61045),L=o(24677);var V=o(6404),N=o(51365),O=o(43132),U=o(22858),H=o(54281),z=o(64434),W=o(61338),j=o(79257),K=o(47307),Y=o(42239),G=o(54532),X=o(84908),q=o(72747),$=o(4727),J=o(36280),Q=o(70630),ee=o(3297),te=o(96802),oe=o(51118),ie=o(96313),ne=o(65770),re=o(45990),ae=o(94419),se=o(97977),le=o(27153),ce=o(47798),de=o(91376),pe=o(11302),ue=o(7476),me=o(95489),ge=o(72711),he=o(19785),fe=o(87420),ve=o(9953),ye=o(43008),be=o(52771),Se=o(360),we=o(55332),ke=o(5978),Ce=o(87531),_e=o(42858),Me=o(74647),Te=o(36432),Ie=o(8713),Pe=o(80984),xe=o(95477),Be=o(71935),Ze=o(15356),Ee=o(30149);const Re=(0,B.defineMessages)({somethingWentWrong:{defaultMessage:"Something went wrong.",id:"slackActions.dialogError.loginWithSlack.errorMessage"},titleMessage:{defaultMessage:"Slack login",id:"slackActions.loginPopupModal.title"},removeIntegrationMessage:{id:"slackIntegrationButton.removeIntegrationConfirmationDialog.prompt",defaultMessage:"Are you sure you want to remove Slack integration?"},removeIntegrationConfirmationLabel:{id:"slackIntegrationButton.removeIntegrationConfirmationDialog.removeButton.label",defaultMessage:"Remove"}});const Ae=async e=>{let{environment:t,blockId:o,intl:i}=e;Z.trackAddSlackIntegration(t),await async function(e){const{environment:t,blockId:o,intl:i}=e,n=(0,Be.eC)(t);let r=(0,Pe.GD)(xe.Z.domainBaseUrl,{blockId:o,authType:n,userId:t.currentUser.id});if(r=n.redirectToAuth?r:await(0,Be.HU)(t,r),t.device.isElectron)return void X.openExternalUrl(r);const a=await Ze.M(t,{width:530,height:530,url:r,titleMessage:Re.titleMessage});if(!a)return void K.showErrorMessage(i.formatMessage(Re.somethingWentWrong));const s=(0,Pe.Wj)({url:a,isMobile:t.device.isMobile,baseUrl:xe.Z.domainBaseUrl,publicDomainName:xe.Z.publicDomainName,protocol:xe.Z.protocol,currentUrl:ncd.href()});"slackAuthCallback"===s.name&&ke.handleSlackAuthCallback({route:s,environment:t})}({environment:t,blockId:o,intl:i})},De=(e,t,o)=>{K.showDialog({message:o.formatMessage(Re.removeIntegrationMessage),showCancel:!0,keepFocus:!0,items:[{label:o.formatMessage(Re.removeIntegrationConfirmationLabel),color:"red",onAccept:()=>{Z.trackRemoveSlackIntegration(e),Ee.createAndCommit({userAction:"slackActions.handleRemoveSlackIntegration",environment:e,perform:e=>{ve.sW({store:t,data:{enabled:!1},transaction:e})}})}}]})};var Fe=o(64964),Le=o(29974),Ve=o(21325),Ne=o(50125),Oe=o(57688),Ue=o(993),He=o(98724),ze=o(35822),We=o(29373),je=o(91791),Ke=o(65598),Ye=o(58202);function Ge(e){return Ye.R.find((t=>t instanceof je.Z&&t.props.store===e))}var Xe=o(63113),qe=o(761),$e=o(70782),Je=o(29919),Qe=o(92022),et=o(41216),tt=o(83355),ot=o(25666),it=o(47853),nt=o(60709),rt=o(98742),at=o(52275),st=o(73420),lt=o(71669),ct=o(58032);class dt extends tt.Z{renderComponent(){return n()("div",{style:{alignSelf:"center",marginBottom:!1===this.props.margin?0:8,padding:"1px 3px",background:this.theme.redBadgeBackground,color:b.ZP.white,borderRadius:3,marginLeft:!1===this.props.margin?0:6,fontSize:9,lineHeight:1.3,textTransform:"uppercase",fontWeight:P.Z.fontWeight.semibold,letterSpacing:.5}},void 0,n()(B.FormattedMessage,{id:"newBadge.label",defaultMessage:"New"}))}}dt.displayName="FrontNewBadge";const pt=dt;var ut=o(60442);let mt;!function(e){e[e.Insert=0]="Insert",e[e.TurnInto=1]="TurnInto"}(mt||(mt={}));class gt extends tt.Z{constructor(){super(...arguments),this.renderMenuItem=e=>p.createElement(at.Z,a()({},(0,rt.Z)(e||{},this.props),{right:this.props.selected&&n()("div",{style:{width:14,padding:"1px 1px"}},void 0,k.Z.check()),title:n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()("span",{style:{marginRight:6}},void 0,this.props.title),!this.props.selected&&"new"===this.props.badge&&n()(pt,{margin:!1}),!this.props.selected&&"ai"===this.props.badge&&n()("div",{style:{color:b.FN.light.purple[500]}},void 0,n()(st.X2,{gap:4,alignItems:"center"},void 0,k.Z.sparkles({fill:b.FN.light.purple[500],width:14,height:14}),n()(B.FormattedMessage,{id:"blockMenuItem.aiBadge",defaultMessage:"AI",description:"Badge for AI blocks"})))),icon:this.createIconWithThumbnail((0,it.D)(this.props.thumbnail)||ot.T),caption:this.isInsertFormat()&&this.props.description})),this.renderTooltip=()=>{const e=this.props.tooltipPhoto?(0,it.D)(this.props.tooltipPhoto):void 0;return n()(ut.Z,{imageURL:e,imageWidth:e?140:void 0,imageHeight:100,caption:this.props.description})}}renderComponent(){return this.environment.device.isMobile?this.renderMenuItem():n()(ct.Z,{renderTooltip:this.renderTooltip,placement:ct.Z.Placement.Right,delayThreshold:0,render:e=>this.renderMenuItem(e)})}createIconWithThumbnail(e){const t=this.isInsertFormat();return n()(lt.Z,{src:e,style:{display:"block",width:t?46:22,height:t?46:22,borderRadius:3,flexGrow:0,flexShrink:0,boxShadow:this.theme.borderBoxShadow,background:b.ZP.white}})}isInsertFormat(){return this.props.format===mt.Insert}}gt.displayName="BlockMenuItem",gt.Format=mt,gt.contextTypes={...nt.mw,...tt.w};const ht=gt;var ft=o(79727),vt=o(78030),yt=o(10182),bt=o(93405),St=o(31278),wt=o(72495),kt=o(24006),Ct=o(86825),_t=o(24405),Mt=o(74420);function Tt(e){let{menuListItemProps:t,title:o,caption:i,icon:r,disabled:s,tooltipText:l,showNewBadge:c}=e;window.__c={n:"CreateFromPageMenuItem"};const d=(0,_t.yK)((()=>({menuItem:{WebkitBackfaceVisibility:"hidden"},caption:{whiteSpace:"pre-wrap"}})),[]);return n()(ct.Z,{placement:ct.Z.Placement.Right,textWrap:!1,disableTooltip:!l,renderTooltip:()=>l,render:e=>p.createElement(bt.Z,a()({},(0,rt.Z)(t,e),{style:d.menuItem,title:o,caption:i,captionStyle:i?d.caption:void 0,svg:r,shortcuts:[],disabled:s,disabledFeedback:s,right:c&&n()(Mt.Z,{})}))})}var It=o(38797),Pt=o(480),xt=o(64921),Bt=o(64369);function Zt(e,t){let{id:o,caption:i,focused:r,isActive:s,onClick:l,onMouseDown:c,onMouseEnter:d,onMouseLeave:u,role:m,style:g,tooltip:h,ignoreLocalHoverState:f,disallowTabbing:v}=e;window.__c={n:"FontMenuItem"};const y=(0,Pt.Fy)(),S=(0,_t.yK)((()=>({optionItem:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:34,justifyContent:"flex-end"},button:{width:"100%",...y.isMobile?{padding:16,paddingTop:20,transition:"color 300ms, border 300ms",lineHeight:1}:{padding:6,paddingTop:10,borderRadius:3,transition:"color 300ms, border 300ms",lineHeight:1},justifyContent:"center",color:s?b.ZP.blue:"inherit"}})),[s,y]);return n()(ct.Z,{renderTooltip:()=>h,placement:ct.Z.Placement.Bottom,delayThreshold:80,render:e=>{const s=(0,rt.Z)(e,{onMouseEnter:d,onMouseLeave:u}),{onMouseDown:h,...b}=s;return p.createElement(xt.Z,a()({},b,{id:o,role:m,ref:t,mobileFeedback:y.isMobile,onClick:l,onMouseDown:s.onMouseDown||c,hovered:r,style:S.button,ignoreLocalHoverState:f,disallowTabbing:v,className:"notranslate"}),n()("div",{style:S.optionItem},void 0,n()("div",{style:{...g,height:25}},void 0,"Ag"),n()(Bt.Z,{isSmall:!0,style:{marginTop:4}},void 0,i)))}})}const Et=p.forwardRef(Zt);class Rt extends tt.Z{constructor(){super(...arguments),this.desktopStyle={display:"flex",justifyContent:"space-between",marginLeft:14,marginRight:14}}renderComponent(){return p.createElement(wt.Z,this.props,n()("div",{style:this.environment.device.isMobile?this.getMobileStyle():this.desktopStyle},void 0,this.props.children))}getMobileStyle(){return{display:"flex",justifyContent:"space-around",boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,background:this.theme.popoverBackground}}}Rt.displayName="FontSectionMenuItem",Rt.contextTypes={...nt.mw,...tt.w};const At=Rt;var Dt=o(88295),Ft=o(12318),Lt=o(95030),Vt=o(66527);class Nt extends tt.Z{constructor(){super(...arguments),this.storeTypes={autocompleteQuery:Ft.default.of("")},this.renderOrigin=e=>p.createElement(bt.Z,a()({},e,{title:p.createElement(B.FormattedMessage,this.props.title),svg:k.Z.pageEmpty,shortcuts:[]})),this.renderExtension=(e,t)=>{const{blocksToTransform:o,onAccept:i,...n}=this.props;return p.createElement(Vt.Z,a()({},n,{targets:this.props.blocksToTransform,isAddTo:!0,isCreateIn:!0,isTurnIntoPage:!0,parentBlockId:void 0,onAccept:async e=>{i&&i(),t.close(),await Dt.Hk(this.environment,{createInValue:e,blocksToTransform:o})},onCancel:t.close,autocompleteQuery:this.stores.autocompleteQuery.state,onAutocompleteQueryChange:this.handleAutocompleteQueryChange,onMouseEnter:e.onMouseEnter,desktopWidth:400,captureSelection:!0,restoreSelection:!0}))},this.handleAutocompleteQueryChange=e=>{this.stores.autocompleteQuery.setState(e)}}renderComponent(){return p.createElement(Lt.Z,a()({},this.props,{disableDefaultClick:!0,renderOrigin:this.renderOrigin,renderExtension:this.renderExtension}))}}Nt.displayName="NewPageInMenu";const Ot=Nt;var Ut=o(69872),Ht=o(16472),zt=o(81954),Wt=o(84210),jt=o(28187),Kt=o(76798),Yt=o(42402);function Gt(e){return(0,zt.VK)((()=>{var t;return{isDefined:e.isDefined(),channel:null===(t=e.getKeyStore("channel").getValue())||void 0===t?void 0:t.replace(/^#/,"")}}),[e])}function Xt(){return window.__c={n:"renderConnectSlackTooltip"},n()(ut.Z,{imageURL:f.Z.images.tooltips.pageUpdates.slackPng,imageHeight:100,caption:n()(B.FormattedMessage,{defaultMessage:"Connect a Slack channel to get updates about this page and pages within it.",id:"topbar.updatesButton.slackIntegrationButton.tooltip"})})}const qt=()=>n()(ut.Z,{imageURL:f.Z.images.tooltips.pageUpdates.slackPng,imageHeight:100,caption:n()(B.FormattedMessage,{defaultMessage:"Disconnect a Slack channel to stop getting updates about this page and pages within it.",id:"topbar.updatesButton.slackIntegrationButton.disconnectTooltip"})}),$t=(0,p.forwardRef)((function(e,t){const{blockStore:o,...i}=e,{blockStore:r,slackIntegrationStore:s}=(0,jt.Jk)(o),{isDefined:l,channel:c}=Gt(s),d=(0,zt.VK)((()=>(0,Wt.ZP)({store:r})),[r]);return l?n()(ct.Z,{placement:ct.Z.Placement.Left,render:e=>p.createElement(bt.Z,a()({},(0,rt.Z)(e,i),{svg:k.Z.slackLogo,title:c,caption:p.createElement(p.Fragment,null,n()(B.FormattedMessage,{defaultMessage:"Based on",id:"topbar.updatesButton.slackIntegrationButton.activeTitle"})," ",n()(Yt.Z,{href:d},void 0,n()(Kt.Z,{store:r,style:{display:"inline"}}))),ref:t})),renderTooltip:qt}):null})),Jt=(0,p.forwardRef)((function(e,t){const{blockStore:o,...i}=e,{slackIntegrationStore:r}=(0,zt.VK)((()=>(0,jt.Jk)(o)),[o]),{isDefined:s,channel:l}=Gt(r);return s?p.createElement(ct.Z,{placement:ct.Z.Placement.Left,render:e=>p.createElement(bt.Z,a()({svg:k.Z.slackLogo,title:l,caption:n()(B.FormattedMessage,{defaultMessage:"Connected to Slack channel",id:"topbar.updatesButton.slackIntegrationButton.connectedCaption"})},(0,rt.Z)(e,i))),renderTooltip:qt,ref:t}):null}));var Qt=o(27006),eo=o(77420),to=o(39248),oo=o(74181),io=o(21202),no=o(15070),ro=o(79315),ao=o(70301);class so extends tt.Z{renderComponent(){const{bot:e}=this.props,{currentUserRootStore:t}=ro.default.state;if(e&&t)return p.createElement(at.Z,a()({},this.props,{icon:n()(ao.Z,{botValue:e}),title:(0,no.Mh)(e)}))}}so.displayName="BotMenuItem",so.contextTypes={...nt.mw,...tt.w};const lo=so;var co=o(68894),po=o(68785),uo=o(28992),mo=o(43765),go=o(84015),ho=o(26825),fo=o(48019),vo=o(78140),yo=o(40721);const bo=(0,p.forwardRef)((function(e,t){const{context:o,parent:i,isSharedDirectly:r,botStore:s,botPermissionSourcePage:l,originConnectionLabel:c,...d}=e,u=(0,Pt.O7)(),m=(0,zt.VK)((()=>ro.default.state.currentSpaceStore),[]),g=o.blocks[0],h=(0,zt.VK)((()=>g.canAdmin()&&(null==m?void 0:m.canRead())),[g,m]),{botCapabilities:f,botName:v,botModel:y}=(0,zt.VK)((()=>({botCapabilities:s.getCapabilities(),botName:s.getName(),botModel:s.getModel()})),[s]);return p.createElement(Lt.Z,a()({},d,{key:s.id,renderOrigin:e=>p.createElement(at.Z,a()({},e,{title:c,icon:n()(ao.Z,{botModel:y,showActiveDot:!0,style:{position:"relative"}})})),renderExtension:(e,t)=>{let a;return a=u.device.isPhone?{menuType:nt.og.Modal,right:n()(yo.DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:nt.og.Popup,width:220,...e},p.createElement(vo.Z,a,n()(fo.Z,{context:o,initialFocus:0,onAccept:i.onAccept,sections:[So({isSharedDirectly:r,botCapabilities:f,botPermissionSourcePage:l}),...h?[wo({isSharedDirectly:r,botId:s.id,botName:v})]:[]]}))},onFocus:i.onFocus,focused:d.focused,openOnFocus:!1,ref:t}))}));function So(e){const{botCapabilities:t,isSharedDirectly:o,botPermissionSourcePage:i}=e,n=(0,ho.uH)(t);return{key:"active connection capabilities section",render:e=>p.createElement(wt.Z,a()({},e,{topBorder:!1})),actions:[...o?[]:[Ko(i)],Yo(n)]}}function wo(e){const{isSharedDirectly:t,botId:o,botName:i}=e;return{key:"active connection disconnect section",render:e=>p.createElement(wt.Z,e),actions:t?[Go(o,i)]:[Xo(o)]}}var ko=o(59753),Co=o(9844),_o=o(31299),Mo=o(41623),To=o(3815);const Io=(0,p.forwardRef)((function(e,t){const{context:o,parent:i,alreadyConnectedIntegrationIds:r,alreadyConnectedBotIds:s,originButtonLabel:l,...c}=e,d=o.blocks[0],u=(0,Pt.O7)(),m=(0,zt.VK)((()=>ro.default.state.currentSpaceStore),[]),g=(0,zt.VK)((()=>null==m?void 0:m.getBotSettingsStore().getValue()),[m]),h=(0,zt.VK)((()=>null!=g&&g.integration_restrictions&&null!=g&&g.integration_approval_statuses?Object.keys(g.integration_approval_statuses):[]),[g]),[f,v]=(0,p.useState)(""),[y,b]=(0,p.useState)({status:"loading"});return(0,p.useEffect)((()=>{Promise.all([async function(e){return await _o.RF({environment:u,query:e})}(f),async function(e){return await _o.sC({query:e,environment:u,spaceId:null==m?void 0:m.id,botSettings:g})}(f)]).then((e=>{let[t,o]=e;const i=new Set,n=function(e){const{alreadyConnectedBotIds:t,botValues:o,environment:i}=e,n=[];for(const r of o){const e=r.id;!t.has(e)&&(0,Mo.O)(i,ko.kk.fromValue(eo.cZ,r))&&n.push(r)}return n}({alreadyConnectedBotIds:s,botValues:t,environment:u}).map((e=>(e.integration_id&&i.add(e.integration_id),{table:eo.cZ,value:e})));let a=o.map((e=>{if(m){const t=To.t1.createChildStore(m,{id:e,table:Co.K2}),o=t.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:o}=e;return o(t)}));if(o&&!(0,oo.VM)(o)){return{table:Co.K2,value:o}}}})).filter(I.$K).filter((e=>!(i.has(e.value.id)||r.has(e.value.id))));if(oo.Cb.name.toLowerCase().includes(f.toLowerCase())){const e={table:"legacy_integration",value:oo.Cb};a=[...a,e]}const l=[...n,...a].sort(((e,t)=>{var o,i;const n=null===(o=e.value.name)||void 0===o?void 0:o.toLowerCase(),r=null===(i=t.value.name)||void 0===i?void 0:i.toLowerCase();return n&&r?n<r?-1:n>r?1:0:0}));b({results:l,status:"ready"})})).catch((e=>b({status:"error"})))}),[f,m,s,g,h,u,r,d]),p.createElement(Lt.Z,a()({},c,{renderOrigin:(e,t)=>p.createElement(bt.Z,a()({},e,{ref:t,title:l,svg:k.Z.plus})),renderExtension:(e,t)=>{const i=u.device.isMobile?{menuType:nt.og.Modal,right:n()(yo.DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:nt.og.Popup,width:220,...e},r=u.device.isMobile?{menuType:nt.og.Modal,topbarStyle:{height:0}}:{menuType:nt.og.Popup,width:220,maxHeight:"16vh",...e},s=Boolean(d.canAdmin()&&(null==m?void 0:m.canRead()));return p.createElement(vo.Z,a()({},i,{onClick:e=>{e.stopPropagation()}}),n()(fo.Z,{initialFocus:0,context:o,onAccept:()=>{Z.trackOpenMoreConnectionsMenu(u)},sections:[...s?[Po(f,v),""===f?xo({searchResults:y,resultsMenuProps:r}):Bo({searchResults:y,resultsMenuProps:r})]:[],Zo(s,oo.Cb)]}))},onFocus:i.onFocus,focused:c.focused,openOnFocus:!0,ref:t}))}));function Po(e,t){return{key:"search connections section",render:e=>p.createElement(wt.Z,a()({},e,{isInput:!0})),actions:[No(e,t)]}}function xo(e){const{searchResults:t,resultsMenuProps:o}=e,i=new Set;return{key:"search initial connections section",render:e=>p.createElement(vo.Z,o,p.createElement(wt.Z,a()({},e,{isInput:!0,topBorder:!1,style:{margin:0,paddingTop:0,paddingBottom:0}}))),actions:[..."ready"===t.status?t.results.map((e=>"bot"===e.table?(e.value.integration_id&&i.add(e.value.integration_id),Uo(e.value)):Jo(e)?(0,jt.F6)()&&!(0,jt.SG)()?void 0:zo(e.value):Ho(e.value))).filter(I.$K):"loading"===t.status?[Vo()]:[Oo()]]}}function Bo(e){const{searchResults:t,resultsMenuProps:o}=e;let i=[];return i="error"===t.status?[Oo()]:"loading"===t.status?[Vo()]:"ready"===t.status&&t.results.length>0?t.results.map((e=>e.table===eo.cZ?Uo(e.value):Jo(e)?(0,jt.F6)()&&!(0,jt.SG)()?void 0:zo(e.value):Ho(e.value))).filter(I.$K):[{key:"connections search error",displayName:Ro.default.formatMessage(Fo.connectionNoSearchResultsLabel),analyticsName:Fo.connectionNoSearchResultsLabel.defaultMessage,searchName:Fo.connectionNoSearchResultsLabel.defaultMessage,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5,Lo],render:e=>n()(mo.Z,{title:Ro.default.formatMessage(Fo.connectionNoSearchResultsLabel)}),action:()=>{}}],{key:"connections search results",render:e=>p.createElement(vo.Z,o,p.createElement(wt.Z,a()({},e,{topBorder:!1}))),actions:i}}function Zo(e,t){const o=e,i=!(0,jt.F6)()||(0,jt.SG)();return{key:"manage connections section",render:t=>p.createElement(wt.Z,a()({},t,{style:{marginTop:e?6:0}})),actions:[...!o&&i?[zo(t)]:[],{key:"manage connections",displayName:Ro.default.formatMessage(Fo.manageConnectionsLabel),analyticsName:Fo.manageConnectionsLabel.defaultMessage,searchName:Fo.manageConnectionsLabel.defaultMessage,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5,Eo.ff(Eo.tq)],render:e=>p.createElement(bt.Z,a()({},e,{title:Ro.default.formatMessage(Fo.manageConnectionsLabel),svg:k.Z.settings})),action:()=>{de.r({currentTab:"connected_apps"})}}]}}var Eo=o(617),Ro=o(33929),Ao=o(76463),Do=o(10279);const Fo=(0,B.defineMessages)({connectionLoadingLabel:{id:"topbar.connectionsSection.connectionLoading.label",defaultMessage:"Connections loading…",description:"A placeholder for the connections that are loading."},connectionSearchPlaceholderLabel:{id:"topbar.connectionsSection.topbarMoreConnectionsSubMenu.label",defaultMessage:"Search for connections...",description:"Search for connections."},connectionSearchErrorLabel:{id:"topbar.connectionsSection.connectionSearchError.label",defaultMessage:"Something went wrong",description:"A placeholder for a search result error message."},connectionNoSearchResultsLabel:{id:"topbar.connectionsSection.noSearchResults.label",defaultMessage:"No results",description:"A message for no search results."},connectionSearchResultLabel:{id:"topbar.connectionsSection.connectionSearchResult.label",defaultMessage:"{name}",description:"A search result that allows user to add connection to the page."},slackEmptyLabel:{id:"topbar.connectionSection.slackEmpty.label",defaultMessage:"Slack",description:"Add the Slack connection to this page."},slackConnectedLabel:{id:"topbar.connectionSection.slackConnected.label",defaultMessage:"Connected to Slack channel",description:"The Slack connection has been added to this page."},manageConnectionsLabel:{id:"topbar.connectionsSection.manageConnections.label",defaultMessage:"Manage connections",description:"A button that opens up the connected apps page in settings."},addConnectionsLabel:{id:"topbar.connectionsSection.addConnections.label",defaultMessage:"Add connections",description:"A button that opens a submenu that allows users to search connections."},fromParentPageLabel:{id:"topbar.connectionsSection.fromParenPage.label",defaultMessage:"From",description:"A label informing users where the connection was originally installed and inherited from."},capabilitiesLabel:{id:"topbar.connectionsSection.capabilities.label",defaultMessage:"Capabilities",description:"Information about an active connection's capabilities."},disconnectLabel:{id:"topbar.connectionSection.disconnectIntegration.label",defaultMessage:"Disconnect",description:"A button that removes a connection's access to current page."},disconnectConfirmationLabel:{id:"topbar.connectionSection.disconnectIntegrationConfirmation.label",defaultMessage:"{botName} will be removed from this page and all child pages. Continue?",description:"A confirmation message for users removing a connection from their page."},restrictionLabel:{id:"topbar.connectionSection.restrictIntegration.label",defaultMessage:"Restrict",description:"A button that removes a connection's access to current page and prevents it from inheriting parent permissions."},restrictionConfirmationLabel:{id:"topbar.connectionSection.restrictIntegrationConfirmation.label",defaultMessage:"Are you sure you want to remove this permission and restrict access? This page will no longer share settings from the parent page.",description:"A message for users restricting access to their page."},restrictionAcceptLabel:{id:"topbar.connectionSection.restrictAccept.label",defaultMessage:"Restrict access",description:"Confirmation button label."},connectionLabel:{id:"topbar.connectionSection.connectionIntegration.label",defaultMessage:"{connectionName}",description:"A suggested or active connection on the page."},connectionBotConfirmlabel:{id:"topbar.connectionSection.connectBotConfirmation.label",defaultMessage:"{botName} will have access to this and all child pages. Continue?",description:"A confirmation message for users adding a bot connection to their page."},connectionIntegrationConfirmlabel:{id:"topbar.connectionSection.connectIntegrationConfirmation.label",defaultMessage:"{integrationName} is developed by a third party partner and you will be redirected outside of Notion to authorize this connection. Continue?",description:"A confirmation message for users adding an integration connection to their page."}}),Lo=Eo.ff(Eo.xD([Eo.tq,Eo.ff(Eo.xD([Eo.zz,Eo.J5]))]));function Vo(){return{key:"connections loading",displayName:Ro.default.formatMessage(Fo.connectionLoadingLabel),analyticsName:Fo.connectionLoadingLabel.defaultMessage,searchName:Fo.connectionLoadingLabel.defaultMessage,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5,Lo],render:e=>p.createElement(uo.Z,a()({},e,{icon:n()(po.Z,{}),title:Ro.default.formatMessage(Fo.connectionLoadingLabel)})),action:()=>{}}}function No(e,t){return{key:"search connections input",analyticsName:Fo.connectionSearchPlaceholderLabel.defaultMessage,displayName:Ro.default.formatMessage(Fo.connectionSearchPlaceholderLabel),searchName:Fo.connectionSearchPlaceholderLabel.defaultMessage,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5,Lo],render:()=>n()(co.ZP,{value:e,onChange:e=>t(e.target.value),placeholder:Ro.default.formatMessage(Fo.connectionSearchPlaceholderLabel),focus:!0}),action:()=>{}}}function Oo(){return{key:"connections search error",displayName:Ro.default.formatMessage(Fo.connectionSearchErrorLabel),analyticsName:Fo.connectionSearchErrorLabel.defaultMessage,searchName:Fo.connectionSearchErrorLabel.defaultMessage,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5,Lo],render:e=>n()(mo.Z,{title:Ro.default.formatMessage(Fo.connectionSearchErrorLabel)}),action:()=>{}}}function Uo(e){const{id:t,name:o}=e,i=Ro.default.formatMessage(Fo.connectionSearchResultLabel,{name:o});return{key:`${t}`,displayName:i,analyticsName:i,searchName:o,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5,Lo],render:(t,o)=>p.createElement(lo,a()({},t,{bot:e,focused:t.focused,onClick:async()=>{await qo(o.blocks[0],o.environment,e)},ref:t.ref})),action:async t=>{await qo(t.blocks[0],t.environment,e)}}}function Ho(e){const{id:t,name:o,info:i}=e,n=Ro.default.formatMessage(Fo.connectionLabel,{connectionName:o});return{key:`${t}`,displayName:n,analyticsName:n,searchName:o,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5,Lo,Eo.ff(Eo.tq)],render:e=>p.createElement(at.Z,a()({},e,{title:n,icon:p.createElement("img",{src:i.icon,style:{width:18,height:"auto"},ref:e.ref})})),action:async t=>{let{environment:o}=t;e.id!==oo.T0&&await async function(e,t){const{id:o,name:i}=e,n=await K.confirmUserAction({message:Ro.default.formatMessage(Fo.connectionIntegrationConfirmlabel,{integrationName:i})}),r=(0,to.E)(o);n&&ke.navigateToExternalURL({environment:t,url:r,targetSelf:!1})}(e,o)}}}function zo(e){const t=Ro.default.formatMessage(Fo.slackEmptyLabel);return{key:"slack empty",displayName:t,analyticsName:Fo.slackEmptyLabel.defaultMessage,searchName:t,closeParentMenu:!0,validators:[Eo.Gg,Eo.J5,Eo.YP,Eo.tJ,Eo.OF,Eo.ff(Eo.Fx)],render:o=>n()(ct.Z,{placement:ct.Z.Placement.Left,render:i=>p.createElement(at.Z,a()({},(0,rt.Z)(i,o),{title:t,icon:n()("img",{src:e.info.icon,style:{height:18}})})),renderTooltip:Xt}),action:e=>{var t,o;Ae({environment:e.environment,blockId:null===(t=e.blocks)||void 0===t||null===(o=t[0])||void 0===o?void 0:o.id,intl:Ro.default.getIntl()})}}}function Wo(){const e=Ro.default.formatMessage(Fo.slackConnectedLabel);return{key:"slack connected inherited",displayName:e,analyticsName:Fo.slackConnectedLabel.defaultMessage,searchName:e,closeParentMenu:!0,validators:[Eo.Gg,Eo.J5,Eo.ur,Eo.ff(Eo.Fx)],render:(e,t,o)=>p.createElement($t,a()({blockStore:t.blocks[0]},e)),action:e=>{}}}function jo(){const e=Ro.default.formatMessage(Fo.slackConnectedLabel);return{key:"slack connected on block",displayName:e,analyticsName:Fo.slackConnectedLabel.defaultMessage,searchName:e,closeParentMenu:!0,validators:[Eo.Gg,Eo.J5,Eo.Rd,Eo.ff(Eo.Fx)],render:(e,t,o)=>p.createElement(Jt,a()({blockStore:t.blocks[0]},e)),action:e=>{const{slackIntegrationStore:t}=(0,jt.Jk)(e.blocks[0]);De(e.environment,t,Ro.default.getIntl())}}}function Ko(e){const t=Ro.default.formatMessage(Fo.fromParentPageLabel);return{key:"from parent page",displayName:t,analyticsName:t,searchName:t,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5],action:()=>{},render:(t,o)=>{let{blocks:i}=o;const r=i[0],a=To.G.createChildStore(r,{table:io.iU,id:e.blockId});return n()($o,{parentBlockStore:a})}}}function Yo(e){const t=Ro.default.formatMessage(Fo.capabilitiesLabel);return{key:"capabilities",displayName:t,analyticsName:t,searchName:t,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5],action:()=>{},render:()=>n()(go._,{role:e})}}function Go(e,t){const o=Ro.default.formatMessage(Fo.disconnectLabel);return{key:"disconnect integration",displayName:o,analyticsName:o,searchName:Fo.disconnectLabel.defaultMessage,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5],action:async o=>{let{blocks:i,environment:n}=o;const r=i[0];await async function(e,t,o,i){await K.confirmUserAction({message:Ro.default.formatMessage(Fo.disconnectConfirmationLabel,{botName:i})})&&Ao.RN({botId:o,store:e,environment:t})}(r,n,e,t)},render:e=>p.createElement(bt.Z,a()({},e,{svg:k.Z.disconnect,title:o,focused:!0}))}}function Xo(e){const t=Ro.default.formatMessage(Fo.disconnectLabel),o=Ro.default.formatMessage(Fo.restrictionLabel);return{key:"restrict page from permission model",displayName:o,analyticsName:o,searchName:Fo.restrictionLabel.defaultMessage,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5],action:async t=>{let{blocks:o,environment:i}=t;const n=o[0];await async function(e,t,o){if(await K.confirmUserAction({message:Ro.default.formatMessage(Fo.restrictionConfirmationLabel),acceptLabel:Ro.default.formatMessage(Fo.restrictionAcceptLabel)})){const i={type:"bot_permission",role:"none",bot_id:e};Ee.createAndCommit({userAction:"TopbarMoreConnections.restrictPagePermissions",environment:o,perform:e=>{Do.Pk({environment:o,store:t,permissionItem:i,shouldInherit:!0,transaction:e})}})}}(e,n,i)},render:e=>p.createElement(bt.Z,a()({},e,{svg:k.Z.disconnect,title:t,focused:!0}))}}async function qo(e,t,o){await K.confirmUserAction({message:Ro.default.formatMessage(Fo.connectionBotConfirmlabel,{botName:o.name})})&&Ao.v2({botValue:o,store:e,environment:t})}function $o(e){window.__c={n:"FromParentPageMenuItem"};const{parentBlockStore:t}=e,o=(0,zt.VK)((()=>t.getIcon()),[t]),i=(0,zt.VK)((()=>t.isEmptyPage()),[t]),r=(0,Pt.O7)(),s=(0,_t.Fg)(),[l,c]=(0,p.useState)("transparent"),d=r.device.isMobile?{fontSize:14,paddingLeft:4}:{fontSize:12,paddingLeft:4};return p.createElement(mo.Z,a()({},e,{title:n()("span",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start"}},void 0,n()(B.FormattedMessage,{id:"topbar.connectionSection.parentPage.label",defaultMessage:"From",description:"A label indicating to users which parent page the connection was originally installed on."}),n()("span",{style:{display:"flex",alignItems:"center",padding:2,borderRadius:2,marginLeft:2,cursor:"pointer",backgroundColor:l,color:s.regularTextColor,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},onClick:()=>{ke.navigateToBlock({environment:r,store:t})},onMouseEnter:()=>{c(s.selectLightGray[100])},onMouseLeave:()=>{c("transparent")},onMouseDown:()=>{c(s.selectLightGray[200])},onMouseUp:()=>{c(s.selectLightGray[100])}},void 0,n()(St.Z,{disabled:!0,icon:o,isEmptyPage:i,size:12,style:{margin:"0px 2px"}}),n()(Kt.Z,{store:t}))),textWrapperStyle:d}))}function Jo(e){return"legacy_integration"===e.table&&e.value.id===oo.Cb.id}var Qo=o(67669);function ei(e,t,o){const i=function(e){var t;const o=e.blocks[0],i=(0,Qo.YO)(o).filter((0,I.AO)((e=>(0,Qt.FB)(e.permissionItem)?{true:{...e,permissionItem:e.permissionItem}}:{false:e})));if(0===i.length)return{status:"no bots"};const n=new Map,r=null===(t=ro.default.state.currentSpaceStore)||void 0===t?void 0:t.id,a=i.map((e=>{let{from:t,permissionItem:i}=e;const a=To.t1.createChildStore(o,{table:eo.cZ,id:i.bot_id,spaceId:r});if("block"===t.table)return n.set(i.bot_id,t),a})).filter(I.$K);if(a.every((e=>e.isReady())))return{status:"ready",botStores:a.filter((t=>t.isDefined()&&Boolean((0,Mo.O)(e.environment,t.getModel())))),botIdToSharedPageIds:n};return{status:"loading"}}(e),{status:n}=i;if("no bots"===n||"loading"===n)return i;{const{botStores:e,botIdToSharedPageIds:n}=i;return{status:"ready",botActions:e.map((e=>{if(e.isDefined()){const i=e.getIntegrationId();i&&t.add(i);const r=n.get(e.id);if(r)return o.add(e.id),function(e){const{botStore:t,botPermissionSourcePage:o}=e,{id:i}=t,n=t.getName(),r=Ro.default.formatMessage(Fo.connectionLabel,{connectionName:n});return{key:`${i}`,displayName:r,analyticsName:r,searchName:r,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5],action:()=>{},render:(e,i,n)=>{const s=i.blocks[0].id===o.blockId;return p.createElement(bo,a()({},e,{context:i,parent:n,isSharedDirectly:s,botStore:t,botPermissionSourcePage:o,originConnectionLabel:r}))}}}({botStore:e,botPermissionSourcePage:r})}})).filter(I.$K)}}}function ti(e){const t=new Set,o=new Set,i=ei(e,t,o),n=function(e,t){const o=Ro.default.formatMessage(Fo.addConnectionsLabel);return{key:"add connections action",displayName:o,analyticsName:Fo.addConnectionsLabel.defaultMessage,searchName:Fo.addConnectionsLabel.defaultMessage,closeParentMenu:!1,validators:[Eo.Gg,Eo.J5,Lo],action:()=>{},render:(i,n,r)=>p.createElement(Io,a()({},i,{context:n,parent:r,alreadyConnectedIntegrationIds:e,alreadyConnectedBotIds:t,originButtonLabel:o}))}}(t,o);if("no bots"===i.status)return{loadingAction:[],connectedActions:[],searchSubMenu:n};if("loading"===i.status)return{loadingAction:[Vo()],connectedActions:[],searchSubMenu:n};{const{botActions:e}=i;return{loadingAction:[],connectedActions:e,searchSubMenu:n}}}function oi(e){const{loadingAction:t,connectedActions:o,searchSubMenu:i}=ti(e);return{key:"topbar connections",render:e=>p.createElement(wt.Z,a()({},e,{topBorder:!0,title:n()(B.FormattedMessage,{id:"topbar.connectionSection.label",defaultMessage:"Connections",description:"A section of the top bar menu where a user can see their active connections and add more connections."})})),actions:[...t,...[Wo(),jo()],...o,i]}}var ii=o(64536),ni=o(42115),ri=o(28020),ai=o(93959),si=o(46888),li=o(43250),ci=o(15010),di=o(52821),pi=o(78316),ui=o(80025),mi=o(99417),gi=o(40959),hi=o(21969),fi=o(92783),vi=o(67074),yi=o(68056),bi=o(33665),Si=o(41984),wi=o(45094),ki=o(77505),Ci=o(38755),_i=o(15517),Mi=o(8323),Ti=o(23537),Ii=o(89086),Pi=o(88632),xi=o(10161),Bi=o(52689),Zi=o(47593),Ei=o(85526),Ri=o(30496),Ai=o(88923),Di=o(96026),Fi=o(70935),Li=o(7755),Vi=o(62213),Ni=o(11689),Oi=o(43339),Ui=o(24666),Hi=o(66708),zi=o(62820),Wi=o(7011),ji=o(21884),Ki=o(96323),Yi=o(62967),Gi=o(70279);const Xi=(0,B.defineMessages)({openInFullPage:{id:"action.navigation.openInFullPage",defaultMessage:"Open in full page",description:"Navigate to the page and open it in full page"},openInSidePeek:{id:"action.navigation.openInSidePeek",defaultMessage:"Open in side peek",description:"Open the page in the side peek"},openInNewTab:{id:"action.openInNewTab.name",defaultMessage:"Open in new tab"},openInNewWindow:{id:"action.openInNewWindow.name",defaultMessage:"Open in new window"}}),qi=e=>{var t;const o=e.blocks[0];if(!o)return!1;if(null!==(t=o.getModel())&&void 0!==t&&t.isNavigableBlock())return!0;if(o.isType("alias")){var i;const e=null===(i=o.getAliasTargetStore())||void 0===i?void 0:i.getModel();if((null==e?void 0:e.table)===io.iU&&null!=e&&e.isNavigableBlock())return!0}return!1},$i=(0,Yi.PH)({key:"open in full page",displayName:Xi.openInFullPage,analyticsName:Xi.openInFullPage.defaultMessage,svg:k.Z.peekModeFull,validators:[Eo.U7,qi,Eo.QL("side_peek_anywhere"),e=>Ai.default.isSidePeekOpen()],closeParentMenu:!0,action:e=>{const t=e.blocks[0],o=t.getAliasTargetStore()??t;if(o.table===Gi.x_)return;const i=(0,Wt.ZP)({store:o});ke.navigate({environment:e.environment,url:i})}}),Ji=(0,Yi.PH)({key:"open side peek",displayName:Xi.openInSidePeek,analyticsName:Xi.openInSidePeek.defaultMessage,svg:k.Z.peekModeSide,shortcuts:["openInSidePeek"],validators:[Eo.U7,qi,Eo.QL("side_peek_anywhere")],closeParentMenu:!0,action:e=>{var t;const o=e.blocks[0];if(!(null===(t=ro.default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.id))return;const i=o.getAliasTargetStore()??o;if(i.table===Gi.x_)return;const n=(0,Wt.ZP)({store:i,openInSidePeek:!0,peekViewBlockId:i.id,peekMode:"s"});ke.navigate({environment:e.environment,url:n})}}),Qi=(0,Yi.PH)({key:"navigate to page in new tab",analyticsName:"Navigate to page in new tab",displayName:Xi.openInNewTab,svg:k.Z.alias,validators:[Eo.U7,Eo.DF,Eo.ff(Eo.vj),Eo.ff(Eo.tq),Eo.ff(Eo.K5)],shortcuts:["commandShiftEnter"],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;ge.ru({environment:o,blocks:t,openInNew:"tab"})}}),en=(0,Yi.PH)({key:"navigate to page in new window",analyticsName:"Navigate to page in new window",displayName:Xi.openInNewWindow,svg:k.Z.alias,validators:[Eo.U7,Eo.DF,Eo.tY,Eo.ff(Eo.vj),Eo.ff(Eo.tq),Eo.ff(Eo.K5)],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;ge.ru({environment:o,blocks:t,openInNew:"window"})}}),tn=(0,Yi.PH)({key:"go up one page",analyticsName:"Go up one page",displayName:void 0,validators:[Eo.Tx],shortcuts:["peekUp"],closeParentMenu:!0,action:()=>ke.goUpInPeekMode()}),on=(0,Yi.PH)({key:"go down one page",analyticsName:"Go down one page",displayName:void 0,validators:[Eo.Tx],shortcuts:["peekDown"],closeParentMenu:!0,action:()=>ke.goDownInPeekMode()}),nn=(0,B.defineMessages)({slackLoadingLabel:{id:"topbar.updatesButton.slackIntegrationButton.loading",defaultMessage:"Loading…"},slackEmptyLabel:{id:"topbar.updatesButton.slackIntegrationButton.title",defaultMessage:"Connect Slack channel"},slackConnectedLabel:{id:"topbar.updatesButton.slackIntegrationButton.connectedCaption",defaultMessage:"Connected to Slack channel"},mentionPersonTitle:{id:"action.mentionPerson.title",defaultMessage:"Mention a person"},mentionPersonDescription:{id:"action.mentionPerson.description",defaultMessage:"Ping someone so they get a notification."},mentionPageTitle:{id:"action.mentionPage.title",defaultMessage:"Mention a page"},mentionPageDescription:{id:"action.mentionPage.description",defaultMessage:"Mention a page and place in text."},insertEmojiTitle:{id:"action.insertEmoji.title",defaultMessage:"Emoji"},insertEmojiDescription:{id:"action.insertEmoji.description",defaultMessage:"Search for an emoji to place in text."},insertInlineEquationTitle:{id:"action.insertInlineEquation.title",defaultMessage:"Inline equation"},insertInlineEquationKeywords:{id:"action.insertInlineEquation.fuzzySearchKeyword",description:"Keywords used when filtering action menus via fuzzy search: these keywords identify token type for inserting inline equations typeset with LaTeX.",defaultMessage:"LaTeX Math Inline Equation $"},insertInlineEquationDescription:{id:"action.insertInlineEquation.description",defaultMessage:"Insert mathematical symbols in text."},fixLegacyTransclusion:{id:"action.fixLegacyTransclusion.name",defaultMessage:"Fix legacy transclusion",description:"Action used to fix a buggy block in Notion. Will generally only be shown to Notion employees on dev."},dateOrReminderTitle:{id:"action.dateOrReminder.title",defaultMessage:"Date or reminder"},dateOrReminderDescription:{id:"action.dateOrReminder.description",defaultMessage:"Insert a date or reminder in text."},moveToName:{id:"action.moveTo.name",defaultMessage:"Move to"},turnPageIntoWikiCaption:{id:"action.turnPageIntoWiki.caption",defaultMessage:"Organize by owner, tags, verification, and more",description:"Caption for a menu item that will change the current page into a wiki"},turnPageIntoWikiFullName:{id:"action.turnPageIntoWiki.fullName",defaultMessage:"Turn into wiki",description:"Label for a menu item that will change the current page into a wiki"},turnPageIntoWikiName:{id:"action.turnPageIntoWiki.name",defaultMessage:"Wiki",description:"Label for a menu item that will change the current page into a wiki"},undoTurnPageIntoWikiName:{id:"action.undoTurnPageIntoWiki.name",defaultMessage:"Undo wiki",description:"Label for an item in a menu that will change the current page from a wiki back into a normal page"},enterName:{id:"action.enter.name",defaultMessage:"Enter"},deleteName:{id:"action.delete.name",defaultMessage:"Delete"},duplicateName:{id:"action.duplicate.name",defaultMessage:"Duplicate"},duplicateToPrivateName:{id:"action.duplicateToPrivate.name",defaultMessage:"Duplicate to Private",description:"Label in the menu for duplicating a page into the user's Private section. Note that there is limited space in the menu, so this should be as short as possible."},commentName:{id:"action.comment.name",defaultMessage:"Comment"},foregroundColorGrayKeywords:{id:"action.foregroundColor.gray.fuzzySearchKeyword",defaultMessage:"Grey Gray"},backgroundColorGrayKeywords:{id:"action.backgroundColor.gray.fuzzySearchKeyword",defaultMessage:"Grey Gray background Greybackground Graybackground"},foregroundColorBrownKeywords:{id:"action.foregroundColor.brown.fuzzySearchKeyword",defaultMessage:"Brown"},backgroundColorBrownKeywords:{id:"action.backgroundColor.brown.fuzzySearchKeyword",defaultMessage:"Brown background Brownbackground"},foregroundColorOrangeKeywords:{id:"action.foregroundColor.orange.fuzzySearchKeyword",defaultMessage:"Orange"},backgroundColorOrangeKeywords:{id:"action.backgroundColor.orange.fuzzySearchKeyword",defaultMessage:"Orange background Orangebackground"},foregroundColorYellowKeywords:{id:"action.foregroundColor.yellow.fuzzySearchKeyword",defaultMessage:"Yellow"},backgroundColorYellowKeywords:{id:"action.backgroundColor.yellow.fuzzySearchKeyword",defaultMessage:"Yellow background Yellowbackground"},foregroundColorTealKeywords:{id:"action.foregroundColor.teal.fuzzySearchKeyword",defaultMessage:"Teal green"},backgroundColorTealKeywords:{id:"action.backgroundColor.teal.fuzzySearchKeyword",defaultMessage:"Teal green background Tealbackground Greenbackground"},foregroundColorBlueKeywords:{id:"action.foregroundColor.blue.fuzzySearchKeyword",defaultMessage:"Blue"},backgroundColorBlueKeywords:{id:"action.backgroundColor.blue.fuzzySearchKeyword",defaultMessage:"Blue background Bluebackground"},foregroundColorPurpleKeywords:{id:"action.foregroundColor.purple.fuzzySearchKeyword",defaultMessage:"Purple"},backgroundColorPurpleKeywords:{id:"action.backgroundColor.purple.fuzzySearchKeyword",defaultMessage:"Purple background Purplebackground"},foregroundColorPinkKeywords:{id:"action.foregroundColor.pink.fuzzySearchKeyword",defaultMessage:"Pink"},backgroundColorPinkKeywords:{id:"action.backgroundColor.pink.fuzzySearchKeyword",defaultMessage:"Pink background Pinkbackground"},foregroundColorRedKeywords:{id:"action.foregroundColor.red.fuzzySearchKeyword",defaultMessage:"Red"},backgroundColorRedKeywords:{id:"action.backgroundColor.red.fuzzySearchKeyword",defaultMessage:"Red background Redbackground"},backgroundColorDefaultKeywords:{id:"action.backgroundColor.default.fuzzySearchKeyword",defaultMessage:"Default Black White"},basicBlocksSection:{id:"action.section.basicBlocks",defaultMessage:"Basic blocks"},inlineSection:{id:"action.section.inline",defaultMessage:"Inline"},databaseSection:{id:"action.section.database",defaultMessage:"Database"},mediaSection:{id:"action.section.media",defaultMessage:"Media"},embedsSection:{id:"action.section.embeds",defaultMessage:"Embeds"},syncedDatabasesSection:{id:"action.section.syncedDatabases",defaultMessage:"Synced Databases",description:"Section to show external sources available to create synced databases in Notion (e.g. GitHub etc.)"},advancedBlocksSection:{id:"action.section.advancedBlocks",defaultMessage:"Advanced blocks"},aiBlocksSection:{id:"action.section.aiBlocks",defaultMessage:"AI blocks",description:"Section for AI-powered Notion blocks"},turnIntoSection:{id:"action.section.turnInto",defaultMessage:"Turn into"},actionsSection:{id:"action.section.actions",defaultMessage:"Actions"},colorSection:{id:"action.section.color",defaultMessage:"Color"},backgroundSection:{id:"action.section.background",defaultMessage:"Background"},backgroundSectionKeywords:{id:"action.section.background.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords help find any actions that modifies the background color of text.",defaultMessage:"Color Background"},textColorSection:{id:"action.section.textColor",defaultMessage:"Text Color",description:"Shown when a user is updating the text color of their block."},backgroundColorSection:{id:"action.section.backgroundColor",defaultMessage:"Background Color",description:"Shown when a user is updating the background color of their block."},fontStyleSection:{id:"action.section.fontStyle",defaultMessage:"Style"},duplicateToName:{id:"action.duplicateTo.name",defaultMessage:"Duplicate to"},leaveName:{id:"action.leave.name",defaultMessage:"Leave"},syncPageName:{id:"action.syncPage.name",defaultMessage:"Save for offline"},resyncPageName:{id:"action.resyncPage.name",defaultMessage:"Refresh offline data"},unsyncPageName:{id:"action.unsyncPage.name",defaultMessage:"Remove from offline"},lockPageName:{id:"action.lockPage.name",defaultMessage:"Lock page"},unlockPageName:{id:"action.unlockPageName.name",defaultMessage:"Unlock page"},lockDatabaseName:{id:"action.lockDatabaseName.name",defaultMessage:"Lock database"},unlockDatabaseName:{id:"action.unlockDatabaseName.name",defaultMessage:"Unlock database"},lockDatabaseViewsName:{id:"action.lockDatabaseViewsName.name",defaultMessage:"Lock views"},unlockDatabaseViewsName:{id:"action.unlockDatabaseViews.name",defaultMessage:"Unlock views",description:"Unlock a database view that was previously locked"},lockWikiName:{id:"action.lockWikiName.name",defaultMessage:"Lock wiki",description:"Lock a wiki database"},unlockWikiName:{id:"action.unlockWikiName.name",defaultMessage:"Unlock wiki",description:"Unlock a wiki database that was previously locked"},addtoFavoritesName:{id:"action.addtoFavorites.name",defaultMessage:"Add to Favorites"},removefromFavoritesName:{id:"action.removefromFavorites.name",defaultMessage:"Remove from Favorites"},renameName:{id:"action.rename.name",defaultMessage:"Rename"},edit:{id:"action.edit.name",defaultMessage:"Edit"},quickFindName:{id:"action.quickFind.name",defaultMessage:"Quick find"},searchName:{id:"action.search.name",defaultMessage:"Search"},undoName:{id:"action.undo.name",defaultMessage:"Undo"},redoName:{id:"action.redo.name",defaultMessage:"Redo"},copyLinktoViewName:{id:"action.copyLinktoView.name",defaultMessage:"Copy link to view"},whatIsNotionName:{id:"action.whatIsNotion.name",defaultMessage:"What is Notion?"},createNotionPageName:{id:"action.createNotionPage.name",defaultMessage:"Create your own Notion page",description:"A prompt for a visitor to create a new page in Notion"},openinMacAppName:{id:"action.openinMacApp.name",defaultMessage:"Open in Mac app"},openinWindowsAppName:{id:"action.openinWindowsApp.name",defaultMessage:"Open in Windows app"},zoomInName:{id:"action.zoomIn.name",defaultMessage:"Zoom in"},zoomOutName:{id:"action.zoomOut.name",defaultMessage:"Zoom out"},resetZoomName:{id:"action.resetZoom.name",defaultMessage:"Reset zoom"},openiniOSAppName:{id:"action.openiniOSApp.name",defaultMessage:"Open in iOS app"},openinAndroidAppName:{id:"action.openinAndroidApp.name",defaultMessage:"Open in Android app"},copyLinkName:{id:"action.copyLink.name",defaultMessage:"Copy link to block"},blockSelectionCompletionName:{id:"action.blockSelectionCompletionName.name",defaultMessage:"Ask AI",description:"Trigger completion when the user selects blocks."},copyLinksName:{id:"action.copyLinks.name",defaultMessage:"Copy links to all"},copyLinkNavigableTypeName:{id:"action.copyLinkNavigableType.name",defaultMessage:"Copy link"},copyFormattedLinkNavigableTypeName:{id:"action.copyFormattedLinkNavigableType.name",defaultMessage:"Copy linked title",description:"Describes a copy action to copy a link to the current page as an html linked string for pasting into rich text editors and applications."},copyDirectLinkName:{id:"action.copyDirectLink.name",defaultMessage:"Copy link to original"},copyLinkToCurrentPageSnackBarMessage:{id:"action.copyLinkToCurrentPage.snackBarMessage",defaultMessage:"Link to current page copied to clipboard"},alignmentName:{id:"action.alignment.name",defaultMessage:"Align",description:"Section name for setting the alignment of a block such as an image. For example, left align, center align, right align."},editPageName:{id:"action.editPage.name",defaultMessage:"Edit"},commentPageName:{id:"action.commentPage.name",defaultMessage:"Comment"},duplicatePageName:{id:"action.duplicatePage.name",defaultMessage:"Duplicate page"},backtoNotionName:{id:"action.backtoNotion.name",defaultMessage:"Back to Notion"},signUpOrLogInName:{id:"action.signUpOrlogIn.name",defaultMessage:"Sign up or log in"},loginName:{id:"action.logIn.name",defaultMessage:"Log in",description:"An action for a user to access their account"},pasteName:{id:"action.paste.name",defaultMessage:"Paste"},moveUpName:{id:"action.moveUp.name",defaultMessage:"Move up"},moveDownName:{id:"action.moveDown.name",defaultMessage:"Move down"},insertBelowName:{id:"action.insertBelow.name",defaultMessage:"Insert below"},fullScreenName:{id:"action.fullScreen.name",defaultMessage:"Full screen"},viewOriginalName:{id:"action.viewOriginal.name",defaultMessage:"View original"},downloadName:{id:"action.download.name",defaultMessage:"Download"},replaceName:{id:"action.replace.name",defaultMessage:"Replace"},configureName:{id:"action.configure.name",defaultMessage:"Configure"},unsyncTransclusionReferenceName:{id:"action.unsyncTransclusionReference.name",defaultMessage:"Unsync"},unsyncTransclusionReferenceFuzzySearch:{id:"action.unsyncTransclusionReference.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords identify unsyncing a synced block instance",defaultMessage:"Unsync ungroup"},unsyncTransclusionContainerName:{id:"action.unsyncTransclusionContainerName.name",defaultMessage:"Unsync all"},unsyncTransclusionContainerFuzzySearch:{id:"action.unsyncTransclusionContainer.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords identify unsyncing a synced block container",defaultMessage:"Unsync all ungroup"},captionName:{id:"action.caption.name",defaultMessage:"Caption"},fontDefaultName:{id:"action.setPageFont.default.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords identify the button that toggles the default font for the whole page.",defaultMessage:"Font Default"},fontDefaultCaption:{id:"action.setPageFont.default.caption",defaultMessage:"Default"},fontDefaultTooltip:{id:"action.setPageFont.default.tooltip",defaultMessage:"The default sans-serif workhorse"},fontSerifName:{id:"action.setPageFont.serif.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords identify the button that toggles the serif font for all text on the page.",defaultMessage:"Font Serif"},fontSerifCaption:{id:"action.setPageFont.serif.caption",defaultMessage:"Serif"},fontSerifTooltip:{id:"action.setPageFont.serif.tooltip",defaultMessage:"Good for publishing"},fontMonoName:{id:"action.setPageFont.mono.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords identify the button that toggles the monospaced font for all text on the page.",defaultMessage:"Font Mono"},fontMonoCaption:{id:"action.setPageFont.mono.caption",defaultMessage:"Mono"},fontMonoTooltip:{id:"action.setPageFont.mono.tooltip",defaultMessage:"Good for drafting and notes"},fontSmallTextKeywords:{id:"action.fontSmallText.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords identify the button that toggles the smaller font for all text on the page.",defaultMessage:"Font Small Text"},fontSmallTextLabel:{id:"action.fontSmallText.label",defaultMessage:"Small text"},customizePageLabel:{id:"action.customizePage.label",defaultMessage:"Customize page"},propertyVisibilityLabel:{id:"action.propertyVisibility.label",defaultMessage:"Toggle property visibility"},databaseLockLabel:{id:"action.databaseLock.label",defaultMessage:"Database lock"},fullWidthLabel:{id:"action.fullWidth.label",defaultMessage:"Full width"},wrapCodeKeywords:{id:"action.wrapCode.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords identify the setting for code blocks that toggles word wrapping at the end of lines.",defaultMessage:"Wrap Code"},wrapCodeLabel:{id:"action.wrapCode.label",defaultMessage:"Wrap code"},wrapCellsName:{id:"action.wrapAllColumns.name",defaultMessage:"Wrap all columns",description:"Switch button to toggle cell wrapping for all columns in table."},mergewithCSVName:{id:"action.mergewithCSV.name",defaultMessage:"Merge with CSV"},turnintoPageName:{id:"action.turnintoPage.name",defaultMessage:"Turn into page"},turnintoInlineName:{id:"action.turnintoInline.name",defaultMessage:"Turn into inline"},createLinkName:{id:"action.createLink.name",defaultMessage:"Create link"},createEquationName:{id:"action.createEquation.name",defaultMessage:"Create equation"},exportName:{id:"action.export.name",defaultMessage:"Export"},exportCaption:{id:"action.export.caption",defaultMessage:"PDF, HTML, Markdown"},importName:{id:"action.import.name",defaultMessage:"Import"},pageHistoryName:{id:"action.pageHistory.name",defaultMessage:"Page history"},showDeletedPagesName:{id:"action.showDeletedPages.name",defaultMessage:"Show deleted pages"},clearDateName:{id:"action.clearDate.name",defaultMessage:"Clear date"},editPropertyName:{id:"action.editProperty.name",defaultMessage:"Edit property"},editIconName:{id:"action.editIcon.name",description:"Name of action to edit the icon of selected blocks",defaultMessage:"Icons"},filterName:{id:"action.filter.name",defaultMessage:"Filter"},sortName:{id:"action.sort.name",defaultMessage:"Sort"},legacyGroupByName:{id:"action.legacyGroupBy.name",defaultMessage:"Group by",description:"Allow user to group table cells together based on a property"},groupByName:{id:"action.groupBy.name",defaultMessage:"Group"},subGroupByName:{id:"action.subGroupBy.name",defaultMessage:"Sub-group"},propertiesName:{id:"action.properties.name",defaultMessage:"Properties"},templatesName:{id:"action.templates.name",defaultMessage:"Templates"},calendarByName:{id:"action.calendarBy.name",defaultMessage:"Calendar by"},timelineByName:{id:"action.timelineBy.name",defaultMessage:"Timeline by"},noDateName:{id:"action.noDate.name",defaultMessage:"No date"},openasPageName:{id:"action.openasPage.name",defaultMessage:"Open as page"},highlightName:{id:"action.highlight.name",defaultMessage:"Highlight"},turnIntoName:{id:"action.turnInto.name",defaultMessage:"Turn into"},newPageInName:{id:"action.newPageIn.name",defaultMessage:"Turn into page in"},colorName:{id:"action.color.name",defaultMessage:"Color"},languageModeName:{id:"action.languageMode.name",description:"Set the language for a code block's syntax highlighting",defaultMessage:"Set language"},boldName:{id:"action.bold.name",defaultMessage:"Bold"},italicName:{id:"action.italic.name",defaultMessage:"Italic"},strikeThroughName:{id:"action.strikeThrough.name",defaultMessage:"Strike-through"},underlineName:{id:"action.underline.name",defaultMessage:"Underline"},darkModeName:{id:"action.darkMode.name",defaultMessage:"Dark mode"},openAsPageName:{id:"action.openAsPage.name",defaultMessage:"Open as page"},openAllTogglesName:{id:"action.openAllToggles.name",defaultMessage:"Open all toggles"},toggleRecordingInputLatencyName:{id:"action.toggleRecordingInputLatency.name",defaultMessage:"Toggle recording input latency",description:"A menu option to toggle recording typing metrics"},lastUsedHighlightTitle:{id:"action.lastUsedHighlight.title",defaultMessage:"Last used"},lastUsedHighlightKeywords:{id:"action.lastUsedHighlight.fuzzySearchKeywords",description:"Keywords used when filtering menus via fuzzy search: these keywords identify the setting that applies the last text color formatting setting that the user used.",defaultMessage:"Color last used"},shareLinkName:{id:"action.shareLink.name",defaultMessage:"Share link"},joinOrCreateWorkspace:{id:"sidebarSwitcherMultiAccount.singleAccountMenu.joinOrCreateWorkspace.label",defaultMessage:"Join or create workspace"},logOut:{id:"sidebarSwitcherMultiAccount.singleAccountMenu.logOut.label",defaultMessage:"Log out"},unpinName:{id:"action.unpin.name",defaultMessage:"Remove from sidebar"},createTeamFromPageCaption:{id:"action.createTeamFromPage.caption",defaultMessage:"Space for your team to customize permissions and collaborate",description:"Caption to creating teamspace from page."},createTeamFromPageFullName:{id:"action.createTeamFromPage.fullName",defaultMessage:"Turn into teamspace",description:"Sidebar action for turning a page into a teamspace."},createTeamFromPageName:{id:"action.createTeamFromPage.name",defaultMessage:"Teamspace",description:"Sidebar action for turning a page into a teamspace."},reportPageName:{id:"action.reportPage.name",defaultMessage:"Report page"},quoteSize:{id:"action.quoteSize.name",defaultMessage:"Quote size"},quoteSizeSection:{id:"action.section.quoteSize",defaultMessage:"Quote size"},quoteSizeDefault:{id:"action.quoteSize.default",defaultMessage:"Default"},quoteSizeLarge:{id:"action.quoteSize.large",defaultMessage:"Large"},listFormat:{id:"action.listFormat.name",defaultMessage:"List format"},listFormatNumbers:{id:"action.listFormat.numbers.name",defaultMessage:"Numbers"},listFormatLetters:{id:"action.listFormat.letters.name",defaultMessage:"Letters"},listFormatDefault:{id:"action.listFormat.letters.default",defaultMessage:"Default"},listFormatRoman:{id:"action.listFormat.letters.roman",defaultMessage:"Roman numerals"},listFormatDisc:{id:"action.listFormat.disc.name",defaultMessage:"Disc"},listFormatCircle:{id:"action.listFormat.circle.name",defaultMessage:"Circle"},listFormatSquare:{id:"action.listFormat.square.name",defaultMessage:"Square"},listFormatSection:{id:"action.listFormat.sectionName",defaultMessage:"List format"},searchPlaceholder:{defaultMessage:"Search for a language…",id:"codeBlock.searchPrompt"},showCodePreviewSection:{id:"action.codePreviewSection.name",description:"Set the view type for code preview",defaultMessage:"Show in block"},showCodePreviewFormat:{id:"action.showCodePreviewFormat.name",description:"Show only preview and hide code",defaultMessage:"Preview"},showOnlyCodeFormat:{id:"action.showOnlyCodeFormat.name",description:"Show only code and hide preview",defaultMessage:"Code"},showSplitViewFormat:{id:"action.showSplitViewFormat.name",description:"Show code and preview",defaultMessage:"Split"},simpleTableColumnSection:{id:"action.section.simpleTableColumn",defaultMessage:"Column"},simpleTableInsertColumnLeft:{id:"action.insertColumnLeft.title",defaultMessage:"Insert Left"},simpleTableInsertColumnRight:{id:"action.insertColumnRight.title",defaultMessage:"Insert Right"},simpleTableInsertRowAbove:{id:"action.insertRowAbove.title",defaultMessage:"Insert Above"},simpleTableInsertRowBelow:{id:"action.insertRowBelow.title",defaultMessage:"Insert Below"},simpleTableClearContents:{id:"action.clearContents.title",defaultMessage:"Clear Contents"},turnSimpleTableIntoCollection:{id:"action.turnIntoCollection.title",defaultMessage:"Turn into database"},turnCollectionIntoSimpleTable:{id:"action.turnintoSimpleTable.name",defaultMessage:"Turn into simple table"},simpleTableHeaderColumn:{id:"action.rowHeader.title",description:"Enable or disable row headers for simple tables",defaultMessage:"Header column"},simpleTableHeaderRow:{id:"action.columnHeader.title",description:"Enable or disable column header for simple tables",defaultMessage:"Header row"},pageUpdates:{id:"action.pageUpdates.title",defaultMessage:"Page updates"},workAtNotion:{id:"action.workAtNotion.name",defaultMessage:"Work at Notion"},reloadPreview:{id:"action.reloadPreview",defaultMessage:"Reload preview",description:"Menu option to reload a link preview"},turnPreviewIntoMention:{id:"action.turnPreviewIntoMention",defaultMessage:"Turn into mention",description:"Menu option to turn a link preview into an inline link preview mention"},reloadSyncedPage:{id:"action.reloadSyncedPage",defaultMessage:"Sync page",description:"Menu option to reload page in synced database."},doNotHavePermissionToMoveBlock:{id:"action.doNotHavePermissionToMoveBlock",defaultMessage:"You do not have permission to move this page.",description:"Pop up error message for when user tries to move a page they cannot."},isLockedTopLevelTeamPage:{id:"action.isLockedTopLevelTeamPage",defaultMessage:"This teamspace has its sidebar locked. You must be a teamspace owner to move this page.",description:"Pop up error message for when user tries to move a locked top level teamspace page."},copyPublicApiObject:{id:"action.copyPublicApiObject",defaultMessage:"Copy API object (Dev)",description:"Button to copy what the page/database looks like in the public API. For internal use only; no need to translate."},suggestedSlashMenuSection:{id:"slashMenu.suggestedSection.title",defaultMessage:"Suggested",description:"Section title for suggested slash menu commands."},more:{defaultMessage:"See more",id:"slashMenu.more.title",description:"See more slash menu commands."}}),rn=(0,B.defineMessages)({ABAP:{id:"action.languageMode.abap",defaultMessage:"ABAP",description:"the ABAP programming language option in the code block language picker, used for syntax highlighting"},Agda:{id:"action.languageMode.agda",defaultMessage:"Agda",description:"the Agda programming language option in the code block language picker, used for syntax highlighting"},Arduino:{id:"action.languageMode.arduino",defaultMessage:"Arduino",description:"the Arduino programming language option in the code block language picker, used for syntax highlighting"},Assembly:{id:"action.languageMode.nasm",defaultMessage:"Assembly",description:"the Assembly programming language option in the code block language picker, used for syntax highlighting"},Bash:{id:"action.languageMode.bash",defaultMessage:"Bash",description:"the Bash programming language option in the code block language picker, used for syntax highlighting"},BASIC:{id:"action.languageMode.basic",defaultMessage:"Basic",description:"the Basic programming language option in the code block language picker, used for syntax highlighting"},BNF:{id:"action.languageMode.bnf",defaultMessage:"BNF",description:"the BNF programming language option in the code block language picker, used for syntax highlighting"},C:{id:"action.languageMode.c",defaultMessage:"C",description:"the C programming language option in the code block language picker, used for syntax highlighting"},"C#":{id:"action.languageMode.csharp",defaultMessage:"C#",description:"the C# programming language option in the code block language picker, used for syntax highlighting"},"C++":{id:"action.languageMode.cplusplus",defaultMessage:"C++",description:"the C++ programming language option in the code block language picker, used for syntax highlighting"},Clojure:{id:"action.languageMode.clojure",defaultMessage:"Clojure",description:"the Clojure programming language option in the code block language picker, used for syntax highlighting"},CoffeeScript:{id:"action.languageMode.coffeescript",defaultMessage:"CoffeeScript",description:"the CoffeeScript programming language option in the code block language picker, used for syntax highlighting"},Coq:{id:"action.languageMode.coq",defaultMessage:"Coq",description:"the Coq programming language option in the code block language picker, used for syntax highlighting"},CSS:{id:"action.languageMode.css",defaultMessage:"CSS",description:"the CSS programming language option in the code block language picker, used for syntax highlighting"},Dart:{id:"action.languageMode.dart",defaultMessage:"Dart",description:"the Dart programming language option in the code block language picker, used for syntax highlighting"},Dhall:{id:"action.languageMode.dhall",defaultMessage:"Dhall",description:"the Dhall programming language option in the code block language picker, used for syntax highlighting"},Diff:{id:"action.languageMode.diff",defaultMessage:"Diff",description:"the Diff programming language option in the code block language picker, used for syntax highlighting"},Docker:{id:"action.languageMode.docker",defaultMessage:"Docker",description:"the Docker programming language option in the code block language picker, used for syntax highlighting"},EBNF:{id:"action.languageMode.ebnf",defaultMessage:"EBNF",description:"the EBNF programming language option in the code block language picker, used for syntax highlighting"},Elixir:{id:"action.languageMode.elixir",defaultMessage:"Elixir",description:"the Elixir programming language option in the code block language picker, used for syntax highlighting"},Elm:{id:"action.languageMode.elm",defaultMessage:"Elm",description:"the Elm programming language option in the code block language picker, used for syntax highlighting"},Erlang:{id:"action.languageMode.erlang",defaultMessage:"Erlang",description:"the Erlang programming language option in the code block language picker, used for syntax highlighting"},"F#":{id:"action.languageMode.fsharp",defaultMessage:"F#",description:"the F# programming language option in the code block language picker, used for syntax highlighting"},Flow:{id:"action.languageMode.flow",defaultMessage:"Flow",description:"the Flow programming language option in the code block language picker, used for syntax highlighting"},Fortran:{id:"action.languageMode.fortran",defaultMessage:"Fortran",description:"the Fortran programming language option in the code block language picker, used for syntax highlighting"},Gherkin:{id:"action.languageMode.gherkin",defaultMessage:"Gherkin",description:"the Gherkin programming language option in the code block language picker, used for syntax highlighting"},GLSL:{id:"action.languageMode.glsl",defaultMessage:"GLSL",description:"the GLSL programming language option in the code block language picker, used for syntax highlighting"},Go:{id:"action.languageMode.go",defaultMessage:"Go",description:"the Go programming language option in the code block language picker, used for syntax highlighting"},GraphQL:{id:"action.languageMode.graphql",defaultMessage:"Graphql",description:"the Graphql programming language option in the code block language picker, used for syntax highlighting"},Groovy:{id:"action.languageMode.groovy",defaultMessage:"Groovy",description:"the Groovy programming language option in the code block language picker, used for syntax highlighting"},Haskell:{id:"action.languageMode.haskell",defaultMessage:"Haskell",description:"the Haskell programming language option in the code block language picker, used for syntax highlighting"},HTML:{id:"action.languageMode.html",defaultMessage:"HTML",description:"the HTML programming language option in the code block language picker, used for syntax highlighting"},Idris:{id:"action.languageMode.idris",defaultMessage:"Idris",description:"the Idris programming language option in the code block language picker, used for syntax highlighting"},Java:{id:"action.languageMode.java",defaultMessage:"Java",description:"the Java programming language option in the code block language picker, used for syntax highlighting"},JavaScript:{id:"action.languageMode.javascript",defaultMessage:"JavaScript",description:"the JavaScript programming language option in the code block language picker, used for syntax highlighting"},JSON:{id:"action.languageMode.json",defaultMessage:"JSON",description:"the JSON programming language option in the code block language picker, used for syntax highlighting"},Julia:{id:"action.languageMode.julia",defaultMessage:"Julia",description:"the Julia programming language option in the code block language picker, used for syntax highlighting"},Kotlin:{id:"action.languageMode.kotlin",defaultMessage:"Kotlin",description:"the Kotlin programming language option in the code block language picker, used for syntax highlighting"},LaTeX:{id:"action.languageMode.latex",defaultMessage:"LaTeX",description:"the LaTeX programming language option in the code block language picker, used for syntax highlighting"},Less:{id:"action.languageMode.less",defaultMessage:"LESS",description:"the LESS programming language option in the code block language picker, used for syntax highlighting"},Lisp:{id:"action.languageMode.lisp",defaultMessage:"Lisp",description:"the Lisp programming language option in the code block language picker, used for syntax highlighting"},LiveScript:{id:"action.languageMode.livescript",defaultMessage:"LiveScript",description:"the LiveScript programming language option in the code block language picker, used for syntax highlighting"},"LLVM IR":{id:"action.languageMode.llvm",defaultMessage:"LLVM IR",description:"the LLVM IR programming language option in the code block language picker, used for syntax highlighting"},Lua:{id:"action.languageMode.lua",defaultMessage:"Lua",description:"the Lua programming language option in the code block language picker, used for syntax highlighting"},Makefile:{id:"action.languageMode.makefile",defaultMessage:"Makefile",description:"the Makefile programming language option in the code block language picker, used for syntax highlighting"},Markdown:{id:"action.languageMode.markdown",defaultMessage:"Markdown",description:"the Markdown programming language option in the code block language picker, used for syntax highlighting"},Markup:{id:"action.languageMode.markup",defaultMessage:"Markup",description:"the Markup programming language option in the code block language picker, used for syntax highlighting"},MATLAB:{id:"action.languageMode.matlab",defaultMessage:"MATLAB",description:"the MATLAB programming language option in the code block language picker, used for syntax highlighting"},Mathematica:{id:"action.languageMode.mathematica",defaultMessage:"Mathematica",description:"the Mathematica programming language option in the code block language picker, used for syntax highlighting"},Mermaid:{id:"action.languageMode.mermaid",defaultMessage:"Mermaid",description:"the Mermaid programming language option in the code block language picker, used for syntax highlighting"},Nix:{id:"action.languageMode.nix",defaultMessage:"Nix",description:"the Nix programming language option in the code block language picker, used for syntax highlighting"},"Objective-C":{id:"action.languageMode.objectiveC",defaultMessage:"Objective-C",description:"the Objective-C programming language option in the code block language picker, used for syntax highlighting"},OCaml:{id:"action.languageMode.ocaml",defaultMessage:"OCaml",description:"the OCaml programming language option in the code block language picker, used for syntax highlighting"},Pascal:{id:"action.languageMode.pascal",defaultMessage:"Pascal",description:"the Pascal programming language option in the code block language picker, used for syntax highlighting"},Perl:{id:"action.languageMode.perl",defaultMessage:"Perl",description:"the Perl programming language option in the code block language picker, used for syntax highlighting"},PHP:{id:"action.languageMode.php",defaultMessage:"PHP",description:"the PHP programming language option in the code block language picker, used for syntax highlighting"},"Plain Text":{id:"action.languageMode.plaintext",defaultMessage:"Plain Text",description:"the Plain Text option in the code block language picker, used for syntax highlighting"},PowerShell:{id:"action.languageMode.powershell",defaultMessage:"Powershell",description:"the Powershell programming language option in the code block language picker, used for syntax highlighting"},Prolog:{id:"action.languageMode.prolog",defaultMessage:"Prolog",description:"the Prolog programming language option in the code block language picker, used for syntax highlighting"},Protobuf:{id:"action.languageMode.protobuf",defaultMessage:"Protobuf",description:"the Protobuf programming language option in the code block language picker, used for syntax highlighting"},PureScript:{id:"action.languageMode.purescript",defaultMessage:"PureScript",description:"the PureScript programming language option in the code block language picker, used for syntax highlighting"},Python:{id:"action.languageMode.python",defaultMessage:"Python",description:"the Python programming language option in the code block language picker, used for syntax highlighting"},R:{id:"action.languageMode.r",defaultMessage:"R",description:"the R programming language option in the code block language picker, used for syntax highlighting"},Racket:{id:"action.languageMode.racket",defaultMessage:"Racket",description:"the Racket programming language option in the code block language picker, used for syntax highlighting"},Reason:{id:"action.languageMode.reason",defaultMessage:"Reason",description:"the Reason programming language option in the code block language picker, used for syntax highlighting"},Ruby:{id:"action.languageMode.ruby",defaultMessage:"Ruby",description:"the Ruby programming language option in the code block language picker, used for syntax highlighting"},Rust:{id:"action.languageMode.rust",defaultMessage:"Rust",description:"the Rust programming language option in the code block language picker, used for syntax highlighting"},Sass:{id:"action.languageMode.sass",defaultMessage:"Sass",description:"the Sass programming language option in the code block language picker, used for syntax highlighting"},Scala:{id:"action.languageMode.scala",defaultMessage:"Scala",description:"the Scala programming language option in the code block language picker, used for syntax highlighting"},Scheme:{id:"action.languageMode.scheme",defaultMessage:"Scheme",description:"the Scheme programming language option in the code block language picker, used for syntax highlighting"},Scss:{id:"action.languageMode.scss",defaultMessage:"SCSS",description:"the SCSS programming language option in the code block language picker, used for syntax highlighting"},Shell:{id:"action.languageMode.shell",defaultMessage:"Shell",description:"the Shell programming language option in the code block language picker, used for syntax highlighting"},Solidity:{id:"action.languageMode.solidity",defaultMessage:"Solidity",description:"the Solidity programming language option in the code block language picker, used for syntax highlighting"},SQL:{id:"action.languageMode.sql",defaultMessage:"SQL",description:"the SQL programming language option in the code block language picker, used for syntax highlighting"},Swift:{id:"action.languageMode.swift",defaultMessage:"Swift",description:"the Swift programming language option in the code block language picker, used for syntax highlighting"},TOML:{id:"action.languageMode.toml",defaultMessage:"TOML",description:"the TOML programming language option in the code block language picker, used for syntax highlighting"},TypeScript:{id:"action.languageMode.typescript",defaultMessage:"TypeScript",description:"the TypeScript programming language option in the code block language picker, used for syntax highlighting"},"VB.Net":{id:"action.languageMode.vbdotnet",defaultMessage:"VB.Net",description:"the VB.Net programming language option in the code block language picker, used for syntax highlighting"},Verilog:{id:"action.languageMode.verilog",defaultMessage:"Verilog",description:"the Verilog programming language option in the code block language picker, used for syntax highlighting"},VHDL:{id:"action.languageMode.vhdl",defaultMessage:"VHDL",description:"the VHDL programming language option in the code block language picker, used for syntax highlighting"},"Visual Basic":{id:"action.languageMode.visualbasic",defaultMessage:"Visual Basic",description:"the Visual Basic programming language option in the code block language picker, used for syntax highlighting"},WebAssembly:{id:"action.languageMode.webassembly",defaultMessage:"WebAssembly",description:"the WebAssembly programming language option in the code block language picker, used for syntax highlighting"},XML:{id:"action.languageMode.xml",defaultMessage:"XML",description:"the XML programming language option in the code block language picker, used for syntax highlighting"},YAML:{id:"action.languageMode.yaml",defaultMessage:"YAML",description:"the YAML programming language option in the code block language picker, used for syntax highlighting"},"Java/C/C++/C#":{id:"action.languageMode.cstyle",defaultMessage:"Java/C/C++/C#"}});function an(e){return"key"in e}function sn(e){return"clipboardData"in e}const ln=[Eo.J5,Eo.ff(Eo.fI),Eo.FS];function cn(e){return(0,Yi.PH)({...e,validators:ln,closeParentMenu:!0,action:t=>{let{environment:o,blocks:i}=t;Ee.createAndCommit({userAction:"actionRegistry.createAnnotationAction",environment:o,perform:t=>{Ue.Du({environment:o,blocks:i,annotation:e.annotation,transaction:t})}})}})}function dn(e){return t=>{C.Z.set({userId:t.environment.currentUser.id,key:Ht.Z.localSizePreferenceKey,value:e}),Ee.createAndCommit({userAction:"actionRegistry.createQuoteSizeAction",environment:t.environment,perform:o=>{te.FH({stores:t.blocks,update:{quote_size:e},transaction:o})}})}}const pn=e=>!Eo.KL(e)||Eo.D(e)&&Eo.EC(e);function un(e,t,o,i){return{key:`insert ${e.key}`,displayName:e.displayName,analyticsName:e.analyticsName,searchName:e.searchName,render:t=>p.createElement(ht,a()({},t,e,{title:e.displayName,format:ht.Format.Insert},o)),closeParentMenu:!0,validators:[t=>!e.shouldShow||e.shouldShow(t)],action:o=>{let{environment:i}=o;Ee.createAndCommit({userAction:"actionRegistry.createInsertAction",environment:i,perform:o=>{_e.at({environment:i,selection:A.default.state.stores,createBlockItem:e,analyticsFrom:t,transaction:o})}})},nativeRender:t=>({thumbnail:e.thumbnail}),sortScoreMultiplier:i}}const mn=[Eo.J5,Eo.ff(Eo.fI),Eo.ro("numbered_list"),Eo.J8("numbered_list")],gn=[Eo.J5,Eo.ff(Eo.fI),Eo.ro("bulleted_list"),Eo.J8("bulleted_list")],hn=[Eo.J5,Eo.ff(Eo.fI),Eo.XQ,Eo.YB,Eo.ff(Eo.O4),Eo.IZ],fn=[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.z2],vn=[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.EJ],yn=[Eo.J5,Eo.ff(Eo.fI),Eo.Eo,Eo.ro("code"),Eo.ff(Eo.O4)];function bn(e){switch(e){case"default":return nn.backgroundColorDefaultKeywords;case"gray":return nn.foregroundColorGrayKeywords;case"gray_background":return nn.backgroundColorGrayKeywords;case"brown":return nn.foregroundColorBrownKeywords;case"brown_background":return nn.backgroundColorBrownKeywords;case"orange":return nn.foregroundColorOrangeKeywords;case"orange_background":return nn.backgroundColorOrangeKeywords;case"yellow":return nn.foregroundColorYellowKeywords;case"yellow_background":return nn.backgroundColorYellowKeywords;case"teal":return nn.foregroundColorTealKeywords;case"teal_background":return nn.backgroundColorTealKeywords;case"blue":return nn.foregroundColorBlueKeywords;case"blue_background":return nn.backgroundColorBlueKeywords;case"purple":return nn.foregroundColorPurpleKeywords;case"purple_background":return nn.backgroundColorPurpleKeywords;case"pink":return nn.foregroundColorPinkKeywords;case"pink_background":return nn.backgroundColorPinkKeywords;case"red":return nn.foregroundColorRedKeywords;case"red_background":return nn.backgroundColorRedKeywords;default:return(0,I.t1)(e)}}function Sn(e,t,o){const i=o||(0,ui.qf)(e),n=(0,Yi.PH)({key:`color ${t||e}`,displayName:i,analyticsName:i.defaultMessage,fuzzySearchKeywords:bn(e),validators:hn,action:t=>{let{blocks:o,environment:i}=t;"default"!==e&&Bi.Z.setHighlightColor(e),Ee.createAndCommit({userAction:"actionRegistry.createBlockColorAction",environment:i,perform:t=>{(0,b.jS)(e)||(He.V$({environment:i,annotationType:"h",blocks:o,transaction:t}),te.FH({stores:Array.from((0,si.c)(o)),update:{block_color:void 0},transaction:t})),te.FH({stores:o,update:{block_color:"default"===e?void 0:e},transaction:t})}}),i.device.isMobile||L.ZH(i)},closeParentMenu:!0,render:t=>p.createElement(et.Z,a()({},t,{color:e,overrideDisplayName:n.displayName})),nativeRender:o=>{let{environment:i}=o;return Cn(i,e,t)}});return n}function wn(e,t,o,i){const n=i||(0,ui.qf)(e),r=(0,Yi.PH)({key:`color ${o||e}`,displayName:n,analyticsName:n.defaultMessage,fuzzySearchKeywords:bn(e),validators:"column"===t?fn:vn,action:t=>{let{blocks:o,environment:i}=t;Ee.createAndCommit({userAction:"actionRegistry.createSimpleTableColorAction",environment:i,perform:t=>{Ie.vk(i,e,t)}})},closeParentMenu:!0,render:t=>p.createElement(et.Z,a()({},t,{color:e,overrideDisplayName:r.displayName})),nativeRender:t=>{let{environment:i}=t;return Cn(i,e,o)}});return r}function kn(e,t,o){const i=o||(0,ui.qf)(e),n=(0,Yi.PH)({key:`color ${t||e}`,displayName:i,analyticsName:i.defaultMessage,fuzzySearchKeywords:bn(e),validators:hn,action:async t=>{let{blocks:o,environment:i}=t;var n;vi.y6(i)&&await(null===(n=i.NativeMobileActionBarStore)||void 0===n?void 0:n.clearNativeActionMenuAndRestoreSelectionIfNecessary());He.mX({environment:i,annotationType:"h"}),"default"!==e&&(Bi.Z.setHighlightColor(e),He.aS({environment:i,annotation:["h",Bi.Z.state.color]}),Z.trackRichTextMenuClick(i,{action:"h",color:Bi.Z.state.color}))},closeParentMenu:!0,render:t=>p.createElement(et.Z,a()({},t,{color:e,overrideDisplayName:n.displayName})),nativeRender:o=>{let{environment:i}=o;return Cn(i,e,t)}});return n}function Cn(e,t,o){const i=e.device.isAndroid?(0,b.gh)({theme:"light"}):(0,b.gh)({theme:e.ThemeStore.state.mode}),n=(0,b.fi)(t,i);let r,a,s;const l="default"!==t;t.includes("background")||null!=o&&o.includes("background")?(r="background",a=l?"square.fill":"square",s="textBackgroundColor"):(r="color",a="character",s="textColor");const c=r in n?n[r]:void 0,d=c&&(0,b.J1)(c);return{sfProGlyphName:a,localImageIdentifier:s,imageTintColor:l?d:void 0}}const _n=[Eo.J5,Eo.ff(Eo.p1),Eo.AK,Eo.ff(Eo.YG)];const Mn=(0,Yi.PH)({key:"delete block",displayName:nn.deleteName,analyticsName:nn.deleteName.defaultMessage,svg:k.Z.trash,validators:[Eo.or([Eo.xD([Eo.lA,Eo.M]),Eo.xD([Eo.k5,Eo.KE,Eo.ff(Eo.sR)])]),Eo.ff(Eo.fI),Eo.ff(Eo.Vf),Eo.ff(Eo.oY),Eo.ff(Eo.P9(v.Ti.externalObjectInstancePage)),Eo.vd],shortcuts:["delete","backspace"],closeParentMenu:!0,action:async e=>{let{blocks:t,environment:o}=e;await _e.Qw({environment:o,blocks:t})}}),Tn=(0,Yi.PH)({key:"delete block without shortcuts",displayName:nn.deleteName,analyticsName:nn.deleteName.defaultMessage,svg:k.Z.trash,validators:[Eo.k5,Eo.KE,Eo.ff(Eo.sR),Eo.ff(Eo.P9(v.Ti.externalObjectInstancePage)),Eo.vd],closeParentMenu:!0,action:async e=>{let{blocks:t,environment:o}=e;await _e.Qw({environment:o,blocks:t})}}),In=(0,Yi.PH)({key:"duplicate",displayName:nn.duplicateName,analyticsName:nn.duplicateName.defaultMessage,svg:k.Z.duplicate,validators:[Eo.DF,Eo.J5,Eo.KE,Eo.xk,Eo.ff(Eo.P9(v.Ti.externalObjectInstancePage))],shortcuts:["duplicate"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const o=ri.np();if(!o)return;const i=o.getParentCollectionStore();i&&Ve.M_(t)&&Ee.createAndCommit({userAction:"actionRegistry.duplicateToCollection",environment:t,perform:e=>{const[n,r]=G.Qi({environment:t,store:o,addCopyName:(0,Si.Z)(o),transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!o.isInsideTemplate(),targetSpaceId:(0,_.CG)(i.pointer.spaceId),baseUrl:xe.Z.domainBaseUrl,publicDomainName:xe.Z.publicDomainName,preferDuplicateLocation:"local"});he.zw({childStore:n,parentStore:i,transaction:e}),o.isTemplate()&&ae.R3({parent:i.getTemplatePagesStore(),append:n,transaction:e}),ke.navigateToBlock({environment:t,store:n})}})}}),Pn=[Eo.ff(Eo.P9(v.Ti.externalObjectInstancePage)),Eo.ff(Eo.K5),Eo.or([Eo.ff(Eo.Rg),Eo.f7]),Eo.J5,Eo.ff((e=>e.blocks.some((e=>e.isDefined()&&(0,ai.h7)(e))))),Eo.vd],xn=(0,Yi.PH)({key:"duplicate",displayName:nn.duplicateName,analyticsName:nn.duplicateName.defaultMessage,svg:k.Z.duplicate,validators:[Eo.M,Eo.ff(Eo.sR),Eo.ff(Eo.cW),Eo.or([Eo.O4,Eo.ff(Eo.fI)]),...Pn],shortcuts:["duplicate"],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;Ve.M_(o)&&(Ee.createAndCommit({userAction:"actionRegistry.duplicateToSelection",environment:o,perform:e=>{_e.yt({environment:o,blocks:t,transaction:e,preferDuplicateLocation:"local"})},transactionTooBigFallback:e=>{_e.yt({environment:o,blocks:t,transaction:e,preferDuplicateLocation:"server"})}}),m.default.afterNextFlush((()=>{F.Zv()})))}}),Bn=(0,Yi.PH)({key:"duplicate",displayName:nn.duplicateName,analyticsName:nn.duplicateName.defaultMessage,svg:k.Z.duplicate,validators:[Eo.U7,Eo.KE,Eo.ff(Eo.xk),...Pn],shortcuts:["duplicate"],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;if(!Ve.M_(o))return;const i=t[0].getParentStore();"block"!==(null==i?void 0:i.table)&&"team"!==(null==i?void 0:i.table)&&"space"!==(null==i?void 0:i.table)||ee.VE({environment:o,store:t[0],newParent:i})}}),Zn=(0,Yi.PH)({key:"fixLegacyTransclusion",displayName:nn.fixLegacyTransclusion,analyticsName:nn.fixLegacyTransclusion.defaultMessage,svg:k.Z.sync,validators:[Eo.sz,Eo.U7,...xn.validators||[]],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;ne.fixLegacyTransclusion({environment:o,store:t[0]})}}),En=(0,Yi.PH)({key:"duplicate into private",displayName:nn.duplicateToPrivateName,analyticsName:nn.duplicateToPrivateName.defaultMessage,svg:k.Z.duplicate,validators:[Eo.ff(Eo.sR),Eo.DF,Eo.J5,Eo.ff(Eo.nJ),Eo.or([Eo.cW,Eo.ff(Eo.KE),Eo.b1])],closeParentMenu:!0,action:async e=>{let{blocks:t,environment:o}=e;if(!Ve.M_(o))return;const i=t[0],n=ro.default.state.currentSpaceStore,r=ro.default.state.currentSpaceViewStore;n&&r&&await ee.DK({environment:o,store:i,spaceStore:n,spaceViewStore:r,isPrivate:!0,context:"duplicate_to_private_space"})}}),Rn=(0,Yi.MV)({key:"duplicate to workspace",displayName:nn.duplicateToName,analyticsName:nn.duplicateToName.defaultMessage,svg:k.Z.duplicate,validators:[Eo.DF,Eo.nJ,Eo.zz,Eo.ff(Eo.KE),Eo.Jl],subActions:e=>{let{blocks:t,environment:o}=e;const{currentUserRootStore:i}=ro.default.state;if(!i)return[];const r=t[0],s=ri.o(i),l=[];for(const c of s){const e=c.getSpaceStore();if(e){const t=(0,Ci.rn)(o,e),i=(0,Ci.Wd)(o,e);l.push({key:c.id,displayName:t||"",analyticsName:"Duplicate to workspace",searchName:t||"",closeParentMenu:!0,action:async()=>{await ee.DK({environment:o,store:r,spaceStore:e,spaceViewStore:c,isPrivate:!0,context:"duplicate_to_another_space"})},render:(e,o)=>{let{environment:r}=o;return p.createElement(at.Z,a()({title:t,icon:n()(St.Z,{icon:i,isEmptyPage:!1,title:t,size:r.device.isMobile?24:20,disabled:!0})},e))}})}}return[(0,Yi.$J)({key:"duplicate-to",render:e=>p.createElement(wt.Z,e),actions:l})]}}),An=(0,Yi.PH)({key:"leave shared page",displayName:nn.leaveName,analyticsName:nn.leaveName.defaultMessage,svg:k.Z.logout,validators:[Eo.cW,Eo.zl,Eo.ff(Eo.uq)],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;Ee.createAndCommit({userAction:"actionRegistry.leaveSharedPage",environment:o,perform:e=>{Me.leaveBlocks({environment:o,blocks:t,transaction:e})}})}}),Dn=(0,Yi.PH)({key:"remove pinned shared page",displayName:nn.unpinName,analyticsName:nn.unpinName.defaultMessage,svg:k.Z.pinStrikethrough,validators:[Eo.cW,Eo.uq],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;const{currentSpaceViewStore:i,currentUserSettingsStore:n}=ro.default.state;i&&n&&(Ee.createAndCommit({userAction:"actionRegistry.removePinnedSharedPage",environment:o,perform:e=>{for(const r of t)Me.unpinSharedPage({environment:o,transaction:e,spaceViewStore:i,userSettingsStore:n,store:r})}}),Z.trackOutlinerSectionUnpin(o,{type:"shared",from:"sidebar_dropdown_menu"}))}});const Fn=(e,t)=>(0,Yi.PH)({key:"turn page into team",displayName:t,analyticsName:nn.createTeamFromPageFullName.defaultMessage,svg:k.Z.loop,validators:e,closeParentMenu:!0,render:(e,o)=>{const i=function(e){const{block:t,environment:o}=e;if(!o.currentUser.id)return;return 0===T.Q(t.getTitleValue()).length?n()(B.FormattedMessage,{defaultMessage:"Cannot turn page without a title into a Teamspace",id:"sidebar.turnPageIntoTeamButton.missingTitleDisabledTooltip",description:"Tells the user they can't turn a page into a teamspace if it doesn't have a title"}):"private"!==(0,Ti.Pr)(t).accessLevel||(0,Mi.Rs)()?void 0:n()(B.FormattedMessage,{defaultMessage:"Only Business Plans and above can turn a private page into a Teamspace",id:"sidebar.turnPageIntoTeamButton.privateTeamsOnlyOnBusinessPlansAndAboveDisabledTooltip",description:"Tells the user they can't turn a private page into a teamspace if they're not on a business plan or higher"})}({environment:o.environment,block:o.blocks[0]});return n()(Tt,{menuListItemProps:e,title:p.createElement(B.FormattedMessage,t),caption:n()(B.FormattedMessage,{defaultMessage:nn.createTeamFromPageCaption.defaultMessage,id:nn.createTeamFromPageCaption.id,description:nn.createTeamFromPageCaption.description}),disabled:Boolean(i),tooltipText:i,icon:k.Z.settingsWorkspace})},action:e=>{let{blocks:t,environment:o}=e;const i=t[0];Oe.VG({environment:o,page:i})}}),Ln=Fn([Eo.xD([Eo.jp,Eo.ff(Eo.KS)])],nn.createTeamFromPageFullName),Vn=Fn([Eo.jp],nn.createTeamFromPageName),Nn=(0,Yi.MV)({key:"turn into teamspace or wiki",displayName:nn.turnIntoSection,analyticsName:nn.turnIntoSection.defaultMessage,svg:k.Z.loop,validators:[Eo.jp,Eo.KS],subActions:()=>[(0,Yi.$J)({key:"turn into teamspace or wiki",render:e=>p.createElement(wt.Z,e),actions:[Vn,ys]})],width:300}),On=(0,Yi.PH)({key:"add to favorites",displayName:nn.addtoFavoritesName,analyticsName:nn.addtoFavoritesName.defaultMessage,svg:k.Z.star,validators:[Eo.jl,Eo.DF,Eo.U7,Eo.ff(Eo.UI),Eo.ff(Eo.xD([Eo.uq,Eo.cW]))],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;const{currentSpaceViewStore:i}=ro.default.state;if(i){const e=t[0];Ee.createAndCommit({userAction:"actionRegistry.addToFavorites",environment:o,perform:t=>{Me.bookmarkPage({spaceViewStore:i,store:e,transaction:t})}})}}}),Un=(0,Yi.PH)({key:"remove from favorites",displayName:nn.removefromFavoritesName,analyticsName:nn.removefromFavoritesName.defaultMessage,svg:k.Z.unstar,validators:[Eo.UI,Eo.U7,Eo.ff(Eo.xD([Eo.uq,Eo.cW]))],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;const{currentSpaceViewStore:i}=ro.default.state;i&&Ee.createAndCommit({userAction:"actionRegistry.removeFromFavorites",environment:o,perform:e=>{Me.unbookmarkPage({spaceViewStore:i,store:t[0],transaction:e})}})}}),Hn=(0,Yi.PH)({key:"rename page",displayName:nn.renameName,analyticsName:nn.renameName.defaultMessage,svg:k.Z.rename,validators:[Eo.YZ,Eo.k5,Eo.U7,Eo.DF,Eo.ff(Eo.Nn),Eo.ff(Eo.j2("table")),Eo.ff(Eo.p1),Eo.ff(Eo.Vw),Eo.ff(Eo.P9(v.Ti.externalObjectInstancePage)),Eo.ff(Eo.K5)],shortcuts:["rename"],closeParentMenu:!0,action:e=>{const{blocks:t,originRect:o}=e;if(t.length>0)return be.$({blockStore:t[0],originRect:o})}}),zn=(0,Yi.PH)({key:"rename file",displayName:nn.renameName,analyticsName:nn.renameName.defaultMessage,svg:k.Z.rename,validators:[Eo.J5,Eo.U7,Eo.$H,Eo.ff(Eo.j2("table"))],shortcuts:["rename"],closeParentMenu:!0,action:e=>{const{blocks:t,originRect:o}=e;if(t.length>0)return ye.g({blockStore:t[0],originRect:o})}}),Wn=(0,Yi.PH)({key:"quick find",displayName:nn.quickFindName,analyticsName:nn.quickFindName.defaultMessage,validators:[Eo.lv],shortcuts:["quickFind"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ce.Kf({environment:t,analyticsFrom:"keyboard-shortcut"})}}),jn=(0,Yi.PH)({key:"quick find (alternative)",displayName:nn.quickFindName,analyticsName:nn.quickFindName.defaultMessage,validators:[Eo.lv,Eo.ff(Eo.xD([Eo.D,Eo.KL]))],shortcuts:["openLinkMenu"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ce.Kf({environment:t,analyticsFrom:"keyboard-shortcut-command-k"})}}),Kn=(0,Yi.PH)({key:"toggle all updates",displayName:void 0,analyticsName:"toggleAllUpdates",validators:[Eo.jl],shortcuts:["toggleAllUpdates"],closeParentMenu:!0,action:e=>{const t=!zi.Z.state.open;zi.Z.setState({open:t}),t?E.GP({environment:e.environment,forceRestartSession:!0,from:"keyboard-shortcut"}):E.nI(e.environment)}}),Yn=(0,Yi.PH)({key:"toggle all teams",displayName:void 0,analyticsName:"toggleAllTeams",validators:[Eo.jl,Ti.bq],shortcuts:["toggleAllTeams"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return Oe.tn(t,{from:"sidebar_browse_team_item"})}}),Gn=(0,Yi.PH)({key:"open share menu",displayName:void 0,analyticsName:"openShareMenu",validators:[Eo.jl],shortcuts:["openShareMenu"],closeParentMenu:!0,action:()=>{Hi.Z.setState({...Hi.Z.state,open:!0})}}),Xn=(0,Yi.PH)({key:"search",displayName:nn.searchName,analyticsName:nn.searchName.defaultMessage,validators:[Eo.jl,Eo.d],shortcuts:["search"],closeParentMenu:!0,action:()=>{const e=Ai.default.isCenterPeekOpen();X.inPageSearch.start(e)}}),qn=(0,Yi.PH)({key:"mobile undo",displayName:nn.undoName,analyticsName:nn.undoName.defaultMessage,svg:k.Z.undo,validators:[Eo.jl,Eo.Mn,Eo.ff(Eo.Eo)],closeParentMenu:!0,action:e=>{let{environment:t}=e;return we.Yw(t)}}),$n=(0,Yi.PH)({key:"mobile redo",displayName:nn.redoName,analyticsName:nn.redoName.defaultMessage,svg:k.Z.redo,validators:[Eo.Mn,Eo.ff(Eo.Eo)],closeParentMenu:!0,action:e=>{let{environment:t}=e;return we.KX(t)}}),Jn=(0,Yi.PH)({key:"undo",displayName:nn.undoName,analyticsName:nn.undoName.defaultMessage,svg:k.Z.undo,validators:[Eo.jl,Eo.ff(Eo.tq),Eo.ff(Eo.P9(v.Ti.externalObjectInstancePage))],shortcuts:["undo"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return we.Yw(t)}}),Qn=(0,Yi.PH)({key:"redo",displayName:nn.redoName,analyticsName:nn.redoName.defaultMessage,svg:k.Z.redo,validators:[],shortcuts:["redo"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return we.KX(t)}}),er=(0,Yi.PH)({key:"up",analyticsName:"Up",displayName:void 0,validators:[],shortcuts:["up"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;if(t&&an(t))return t.metaKey||t.ctrlKey?L.w5(o):void L.zJ({environment:o,shiftKey:Boolean(t&&t.shiftKey),altKey:Boolean(t&&t.altKey)})}}),tr=(0,Yi.PH)({key:"left",analyticsName:"Left",displayName:void 0,validators:[],shortcuts:["left"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;t&&an(t)&&L.e2(o)}}),or=(0,Yi.PH)({key:"down",analyticsName:"Down",displayName:void 0,validators:[],shortcuts:["down"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;if(t&&an(t))return t.metaKey||t.ctrlKey?L.hn(o):void L.DI({environment:o,shiftKey:Boolean(t&&t.shiftKey),altKey:Boolean(t&&t.altKey)})}}),ir=(0,Yi.PH)({key:"right",analyticsName:"Right",displayName:void 0,validators:[],shortcuts:["right"],closeParentMenu:!0,action:e=>{let{environment:t}=e;L.FC(t)}}),nr=(0,Yi.PH)({key:"context menu",analyticsName:"Context menu",displayName:void 0,validators:[Eo.KH,Eo.ff(Eo.fI)],shortcuts:["commandSlash"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const{stores:o}=A.default.state;V.$Z({environment:t,stores:o,actions:fl,analyticsFrom:"command_slash_menu"})}}),rr=(0,Yi.PH)({key:"ai prompt menu",analyticsName:"ai_prompt_menu",displayName:void 0,validators:[...Ki.vE,Eo.FS],shortcuts:["commandJ"],closeParentMenu:!0,action:e=>{let{environment:t}=e;(0,Qe.hr)({from:"keyboard_shortcut",environment:t})}}),ar=(0,Yi.PH)({key:"indent",analyticsName:"Indent",displayName:void 0,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.Eo,Eo.ff(Eo.AK)],shortcuts:["tab"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.indent",environment:t,perform:e=>{!function(e){const t=A.default.state.stores;if(t.length>0){const o=D.WY({environment:e.environment,blocks:t,transaction:e.transaction});o&&L.Z5({environment:e.environment,stores:o})}}({environment:t,transaction:e})}})}}),sr=(0,Yi.PH)({key:"subitemIndent",analyticsName:"Toggle By Indent",displayName:void 0,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.Eo,Eo.AK,Eo.ZD,Eo.v_],shortcuts:["tab"],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;Ee.createAndCommit({userAction:"actionRegistry.subitemIndent",environment:o,perform:e=>{W.wA({environment:o,transaction:e,blocks:t,action:"indentSelfAndSubtree"})}})}}),lr=(0,Yi.PH)({key:"unindent",analyticsName:"Unindent",displayName:void 0,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.Eo,Eo.ff(Eo.AK)],shortcuts:["untab"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.unindent",environment:t,perform:e=>{!function(e){const t=A.default.state.stores;if(t.length>0){const o=D.rB({environment:e.environment,blocks:t,transaction:e.transaction});o&&L.Z5({environment:e.environment,stores:o})}}({environment:t,transaction:e})}})}}),cr=(0,Yi.PH)({key:"subitemUnindent",analyticsName:"Toggle By Unindent",displayName:void 0,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.Eo,Eo.AK,Eo.ZD,Eo.v_],shortcuts:["untab"],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;Ee.createAndCommit({userAction:"actionRegistry.subitemUnindent",environment:o,perform:e=>{W.wA({environment:o,transaction:e,blocks:t,action:"unindentSelf"})}})}}),dr=(0,Yi.PH)({key:"escape",analyticsName:"Escape",displayName:void 0,validators:[],shortcuts:["esc"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Y.cQ(t),L.ZH(t),Te.V(),fe.jG(t)}}),pr=(0,Yi.PH)({key:"select all",analyticsName:"Select all",displayName:void 0,validators:[],shortcuts:["selectAll"],closeParentMenu:!0,action:e=>{let{environment:t}=e;L.td(t)}}),ur=(0,Yi.PH)({key:"cut",analyticsName:"Cut",displayName:void 0,validators:[Eo.J5,Eo.ff(Eo.fI)],shortcuts:["cut"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;t&&sn(t)&&O.by({environment:o,event:t})}}),mr=(0,Yi.PH)({key:"copy",analyticsName:"Copy",displayName:void 0,validators:[],shortcuts:["copy"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;t&&sn(t)&&O.JG({environment:o,event:t})}}),gr=(0,Yi.PH)({key:"block selection completion",displayName:nn.blockSelectionCompletionName,analyticsName:nn.blockSelectionCompletionName.defaultMessage,svg:k.Z.sparkles,shortcuts:["commandJ"],validators:Ki.Xp,closeParentMenu:!0,action:(e,t)=>{const{environment:o}=e;(0,Qe.hr)({from:"block_action_menu",environment:o})}}),hr=(0,Yi.PH)({key:"copy link to block",displayName:nn.copyLinkName,analyticsName:nn.copyLinkName.defaultMessage,svg:k.Z.link,shortcuts:["copyLinkToBlock"],validators:[Eo.jl,Eo.U7,Eo.ff(Eo.DF)],closeParentMenu:!0,action:(e,t)=>{O.Hs({...e,event:t})}}),fr=(0,Yi.PH)({key:"copy link to page",displayName:nn.copyLinkNavigableTypeName,analyticsName:nn.copyLinkNavigableTypeName.defaultMessage,svg:k.Z.link,validators:[Eo.jl,Eo.U7,Eo.DF],closeParentMenu:!0,action:(e,t)=>{O.Hs({...e,event:t})}}),vr=(0,Yi.PH)({key:"copy links to blocks",displayName:nn.copyLinksName,analyticsName:nn.copyLinksName.defaultMessage,svg:k.Z.link,validators:[Eo.jl,Eo.EC],closeParentMenu:!0,action:(e,t)=>{O.Dw({...e,event:t})}}),yr=(0,Yi.PH)({key:"copy link to block non-desktop",displayName:nn.copyLinkNavigableTypeName,analyticsName:nn.copyLinkNavigableTypeName.defaultMessage,svg:k.Z.link,shortcuts:["copyCurrentPageLinkifiedBlockTitle"],validators:[Eo.jl,Eo.U7,Eo.ff(Eo.d)],closeParentMenu:!0,action:(e,t)=>{O.Hs({...e,event:t})}}),br=((0,Yi.PH)({key:"copy link to view",displayName:nn.copyLinktoViewName,analyticsName:nn.copyLinktoViewName.defaultMessage,svg:k.Z.link,validators:[Eo.U7],closeParentMenu:!0,action:(e,t)=>{let{environment:o,blocks:i}=e;O.Hs({environment:o,blocks:i,event:t})}}),(0,Yi.PH)({key:"What is Notion?",displayName:nn.whatIsNotionName,analyticsName:nn.whatIsNotionName.defaultMessage,svg:k.Z.notionLogo,validators:[Eo.ff(Eo.jl),Eo.ff(Eo.tY)],closeParentMenu:!0,action:async e=>{let{environment:t}=e;await ke.publicPageTopBarAction(t,{utmContent:"what_is_notion",nextRoute:M._j.product})}})),Sr=(0,x.SK)(M._j.signup,{try_notion_cta:"mobile"}),wr=(0,Yi.PH)({key:"Create Notion Page",displayName:nn.createNotionPageName,analyticsName:nn.createNotionPageName.defaultMessage,svg:k.Z.notionLogo,validators:[Eo.ff(Eo.jl),Eo.ff(Eo.tY)],closeParentMenu:!0,action:e=>{let{environment:t}=e;ke.navigateOnBaseUrl({environment:t,url:Sr})}}),kr=(0,Yi.PH)({key:"open in mac app",displayName:nn.openinMacAppName,analyticsName:nn.openinMacAppName.defaultMessage,svg:k.Z.notionLogo,validators:[Eo.U7,Eo.ff(Eo.tY),Eo.ff(Eo.tq),Eo.V5],closeParentMenu:!0,action:(e,t)=>{let{blocks:o,environment:i}=e;const n=(0,Wt.ZP)({store:o[0],fullyQualified:!1});ke.openInNativeApp({url:(0,hi.W)(n),environment:i})}}),Cr=(0,Yi.PH)({key:"open in windows app",displayName:nn.openinWindowsAppName,analyticsName:nn.openinWindowsAppName.defaultMessage,svg:k.Z.notionLogo,validators:[Eo.U7,Eo.ff(Eo.tY),Eo.ff(Eo.tq),Eo.ED],closeParentMenu:!0,action:(e,t)=>{let{blocks:o,environment:i}=e;const n=(0,Wt.ZP)({store:o[0],fullyQualified:!1});ke.openInNativeApp({url:(0,hi.W)(n),environment:i})}}),_r=(0,Yi.PH)({key:"zoom in",displayName:nn.zoomInName,analyticsName:nn.zoomInName.defaultMessage,validators:[Eo.d],shortcuts:["zoomIn"],closeParentMenu:!0,action:()=>{X.zoomIn()}}),Mr=(0,Yi.PH)({key:"zoom out",displayName:nn.zoomOutName,analyticsName:nn.zoomOutName.defaultMessage,validators:[Eo.d],shortcuts:["zoomOut"],closeParentMenu:!0,action:()=>{X.zoomOut()}}),Tr=(0,Yi.PH)({key:"zoom reset",displayName:nn.resetZoomName,analyticsName:nn.resetZoomName.defaultMessage,validators:[Eo.d],shortcuts:["zoomReset"],closeParentMenu:!0,action:()=>{X.zoomReset()}}),Ir=(0,Yi.PH)({key:"open in ios app",displayName:nn.openiniOSAppName,analyticsName:nn.openiniOSAppName.defaultMessage,svg:k.Z.notionLogo,validators:[Eo.U7,Eo.ff(Eo.tY),Eo.gn],closeParentMenu:!0,action:(e,t)=>{let{blocks:o,environment:i}=e;const n=(0,Wt.ZP)({store:o[0],fullyQualified:!1});ke.openInNativeApp({url:n,environment:i})}}),Pr=(0,Yi.PH)({key:"open in android app",displayName:nn.openinAndroidAppName,analyticsName:nn.openinAndroidAppName.defaultMessage,svg:k.Z.notionLogo,validators:[Eo.U7,Eo.ff(Eo.tY),Eo.Dt],closeParentMenu:!0,action:(e,t)=>{let{blocks:o,environment:i}=e;const n=(0,Wt.ZP)({store:o[0],fullyQualified:!1});ke.openInNativeApp({url:n,environment:i})}});function xr(){const{mainEditorCurrentBlockStore:e}=ro.default.state;return Ai.default.state.open&&Ai.default.state.target||e}const Br=(0,Yi.PH)({key:"copy link to current page",displayName:nn.copyLinkNavigableTypeName,analyticsName:nn.copyLinkNavigableTypeName.defaultMessage,svg:k.Z.link,validators:[Eo.d],shortcuts:["copyLinkToCurrentPage"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;const i=xr();i&&(O.Hs({environment:o,blocks:[i],event:t}),Fe.oV({label:Ro.default.formatMessage(nn.copyLinkToCurrentPageSnackBarMessage)}))}}),Zr=(0,Yi.PH)({key:"copy linkified page title to current page",displayName:nn.copyFormattedLinkNavigableTypeName,analyticsName:nn.copyFormattedLinkNavigableTypeName.defaultMessage,svg:k.Z.link,validators:[],shortcuts:["copyCurrentPageLinkifiedBlockTitle"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;const i=xr();i&&O.VG({environment:o,blocks:[i],event:t})}}),Er=(0,Yi.PH)({key:"ios share link",displayName:nn.shareLinkName,analyticsName:nn.shareLinkName.defaultMessage,svg:k.Z.iOSShare,validators:[Eo.U7,Eo.Fx,Eo.gn],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;const i=t[0],n=i.getNavigableBlockStore();if(n){const e=(0,Wt.ZP)({store:n,scrollToBlockId:n.id===i.id?void 0:i.id,fullyQualified:!0});o.mobileNative&&o.mobileNative.share(e)}}}),Rr=(0,Yi.PH)({key:"android share link",displayName:nn.shareLinkName,analyticsName:nn.shareLinkName.defaultMessage,svg:k.Z.androidShare,validators:[Eo.U7,Eo.Fx,Eo.Dt],closeParentMenu:Er.closeParentMenu,action:Er.action}),Ar=(0,Yi.PH)({key:"copy link",displayName:nn.copyLinkName,analyticsName:nn.copyLinkName.defaultMessage,svg:k.Z.link,shortcuts:["copyLinkToBlock"],validators:[Eo.jl,Eo.U7,Eo.ff(Eo.Fx),Eo.ff(Eo.DF)],closeParentMenu:!0,action:(e,t)=>{O.Hs({...e,event:t})}}),Dr=(0,Yi.PH)({key:"copy direct link to content housed within block",displayName:nn.copyDirectLinkName,analyticsName:nn.copyDirectLinkName.defaultMessage,svg:k.Z.globe2,validators:[Eo.jl,Eo.U7,Eo.ff(Eo.KJ),Eo.ff(Eo.Fx),Eo.or([Eo.Cj,Eo.$H,Eo.P9(v.Ti.bookmark),Eo.P9(v.Ti.externalObjectInstance),Eo.P9(v.Ti.externalObjectInstancePage),Eo.K5,Eo.p5])],closeParentMenu:!0,action:(e,t)=>{O.IK({...e,event:t})}}),Fr=(0,Yi.PH)({key:"copy public API object",displayName:nn.copyPublicApiObject,analyticsName:nn.copyPublicApiObject.defaultMessage,validators:[Eo.U7,Eo.QL("public_api_dev_mode")],shortcuts:[],closeParentMenu:!1,svg:k.Z.copy,action:async e=>{let{environment:t,blocks:o}=e;const i=await R.getPublicApiObject(t,{id:o[0].id});let n;n="success"===i.type?JSON.stringify(i.data,void 0,2):JSON.stringify(i.error,void 0,2),O.RD({environment:t,stringValue:n,copiedMessage:O.tq.copiedApiObjectToClipboard})}}),Lr=(0,Yi.PH)({key:"edit page",displayName:nn.editPageName,analyticsName:nn.editPageName.defaultMessage,svg:k.Z.pencil,validators:[Eo.U7,Eo.DF,Eo.Zk,Eo.ff(Eo.eM)],closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;t.currentUser.isLoggedIn()?K.showDialog({showCancel:!0,keepFocus:!1,message:n()(B.FormattedMessage,{defaultMessage:"When you start editing, your name, email and photo will be visible to the page owners.",id:"action.startPublicEditDialog.message"}),items:[{label:n()(B.FormattedMessage,{defaultMessage:"Continue",id:"action.startPublicEditDialog.continueLabel"}),color:"blue",onAccept(){Di.Z.setState({editing:!0})}}]}):((0,_i.Hr)({currentUserId:t.currentUser.id,blockId:o[0].id}),ke.navigateOnBaseUrl({environment:t,url:M._j.login}))}}),Vr=(0,Yi.PH)({key:"comment page",displayName:nn.commentPageName,analyticsName:nn.commentPageName.defaultMessage,svg:k.Z.speechBubbleThin,validators:[Eo.U7,Eo.DF,Eo.RF,Eo.ff(Eo.jl)],closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;(0,_i.Hr)({currentUserId:t.currentUser.id,blockId:o[0].id}),ke.navigateOnBaseUrl({environment:t,url:M._j.login})}}),Nr=(0,Yi.PH)({key:"duplicate page",displayName:nn.duplicatePageName,analyticsName:nn.duplicatePageName.defaultMessage,svg:k.Z.duplicate,validators:[Eo.U7,Eo.tq,Eo.DF,Eo.S4],closeParentMenu:!0,action:e=>{let{blocks:t,originRect:o,environment:i}=e;ee.S({environment:i,store:t[0],originRect:o})}}),Or=(0,Yi.PH)({key:"back to my content",displayName:nn.backtoNotionName,analyticsName:nn.backtoNotionName.defaultMessage,svg:k.Z.notionLogo,validators:[Eo.jl,Eo.tq],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;const{currentUserRootStore:i,currentUserSettingsStore:n}=ro.default.state;i&&n&&Le.L5({environment:o,userRootStore:i,userSettingsStore:n})}}),Ur=(0,Yi.PH)({key:"log in",displayName:nn.signUpOrLogInName,analyticsName:nn.signUpOrLogInName.defaultMessage,svg:k.Z.loginArrow,validators:[Eo.ff(Eo.jl)],closeParentMenu:!0,action:async e=>{let{environment:t}=e;await ke.publicPageTopBarAction(t,{utmContent:"sign_up_or_log_in",nextRoute:M._j.login})}}),Hr=(0,Yi.PH)({key:"log in",displayName:nn.loginName,analyticsName:nn.loginName.defaultMessage,svg:k.Z.loginArrow,validators:[Eo.ff(Eo.jl)],closeParentMenu:!0,action:async e=>{let{environment:t}=e;ke.navigateOnBaseUrl({environment:t,url:M._j.login,extraSearchParams:await ke.generatePartnerStackPathParam(t)})}}),zr=(0,Yi.PH)({key:"paste",displayName:nn.pasteName,analyticsName:nn.pasteName.defaultMessage,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.ry,Eo.jl],shortcuts:["paste"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;t&&sn(t)&&Ee.createAndCommit({userAction:"actionRegistry.paste",environment:o,perform:e=>{O.v({environment:o,event:t,disableEmbedMenu:!0,transaction:e,onPasteFiles:O.AL})}})}}),Wr=(0,Yi.PH)({key:"move up",displayName:nn.moveUpName,analyticsName:nn.moveUpName.defaultMessage,validators:[Eo.J5,Eo.Eo,Eo.ff(Eo.AK)],shortcuts:["moveUp"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.moveUp",environment:t,perform:e=>{!async function(e){const t=D.A1({transaction:e.transaction,blocks:A.default.state.stores});t&&(L.Z5({environment:e.environment,stores:t}),await m.default.afterNextFlush(),F.Zv())}({environment:t,transaction:e})}})}}),jr=(0,Yi.PH)({key:"move down",displayName:nn.moveDownName,analyticsName:nn.moveDownName.defaultMessage,validators:[Eo.J5,Eo.Eo,Eo.ff(Eo.AK)],shortcuts:["moveDown"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.moveDown",environment:t,perform:e=>{!async function(e){const t=D.vi({transaction:e.transaction,blocks:A.default.state.stores});t&&(L.Z5({environment:e.environment,stores:t}),await m.default.afterNextFlush(),F.Zv())}({environment:t,transaction:e})}})}}),Kr=(0,Yi.PH)({key:"insert below",displayName:nn.insertBelowName,analyticsName:nn.insertBelowName.defaultMessage,svg:k.Z.arrowDown,validators:[Eo.J5,Eo.Eo,Eo.tq],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;Ee.createAndCommit({userAction:"actionRegistry.insertBelow",environment:o,perform:e=>{_e.ZJ({environment:o,blocks:t,transaction:e})}})}}),Yr=(0,Yi.PH)({key:"comment",displayName:nn.commentName,analyticsName:nn.commentName.defaultMessage,svg:k.Z.speechBubbleThin,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.XQ,Eo.ff(Eo.DF),Eo.ff(Eo.F6),Eo.or([Eo.U7,Eo.KL]),Eo.ff(Eo.OX)],shortcuts:["comment"],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;const i=t[0],n=null==i?void 0:i.getModel();if(i){const e="editing"===Ui.default.state.mode&&Ui.default.state.multiSelection;if(e&&!(0,yi.iG)(e)&&(e.start.store.id===i.id||null!=n&&n.isType("table")&&"properties"===e.start.store.path[0]&&e.start.store.path[1]&&(i.getFormatStore().getKeyStore("table_block_column_order").getValue()??[]).includes(String(e.start.store.path[1]))))ue.WD({environment:o,blockStore:i,multiSelection:e});else if(i.isDefined()&&null!=n&&n.isType(v.eh)){const e=i.getTitleStore(),t=e&&(0,Ii.x0)(e);if(e&&t&&t.endIndex>0){const n={startIndex:0,endIndex:t.endIndex};ue.WD({environment:o,blockStore:i,multiSelection:(0,yi.TD)({store:e,selection:n}),rect:Ye.R.getRect(i)})}}else ue.yw({environment:o,blockStore:i})}}}),Gr=(0,Yi.PH)({key:"full screen",displayName:nn.fullScreenName,analyticsName:nn.fullScreenName.defaultMessage,svg:k.Z.fullscreen,validators:[Eo.U7,Eo.Cj,Eo.IT,Eo.ff(Eo.D)],shortcuts:["space"],closeParentMenu:!0,action:e=>_e.dK(e)}),Xr=(0,Yi.PH)({key:"view original",displayName:nn.viewOriginalName,analyticsName:nn.viewOriginalName.defaultMessage,svg:k.Z.alias,validators:[Eo.U7,Eo.or([Eo.Cj,Eo.xD([Eo.$H,Eo.ff(Eo.KJ)])])],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;q.qL(o,{store:t[0],from:"view_original"})}}),qr=(0,Yi.PH)({key:"download source",displayName:nn.downloadName,analyticsName:nn.downloadName.defaultMessage,svg:k.Z.download,validators:[Eo.U7,Eo.or([Eo.$H,Eo.Cj]),Eo.or([Eo.VB,Eo.KJ]),Eo.ff(Eo.Fx)],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;q.TH({environment:o,store:t[0]})}}),$r=(0,Yi.PH)({key:"replace source",displayName:nn.replaceName,analyticsName:nn.replaceName.defaultMessage,svg:k.Z.replace,validators:[Eo.J5,Eo.U7,Eo.or([Eo.$H,Eo.Cj])],closeParentMenu:!0,action:e=>{let{blocks:t}=e;q.x1({store:t[0]})}}),Jr=(0,Yi.PH)({key:"configure",displayName:nn.configureName,analyticsName:nn.configureName.defaultMessage,svg:k.Z.settings,validators:[Eo.J5,Eo.U7,Eo.zX],closeParentMenu:!0,action:e=>_e.jQ(e)}),Qr=(0,Yi.PH)({key:"unsyncTransclusionReference",displayName:nn.unsyncTransclusionReferenceName,analyticsName:nn.unsyncTransclusionReferenceName.defaultMessage,fuzzySearchKeywords:nn.unsyncTransclusionReferenceFuzzySearch,svg:k.Z.unsync,validators:[Eo.J5,Eo.FY,Eo.U7],shortcuts:["ungroup"],closeParentMenu:!0,action:e=>{!async function(e){const{environment:t,store:o}=e,i=o.getRecordStoreUIParent(),n=o.getTransclusionReferenceTargetStore();if(!i||!(0,Ke.dz)(i)||!n)return;const r=Ge(n);r&&await r.confirmUnsyncTransclusionReference()&&Ee.createAndCommit({userAction:"transclusionActions.unsyncTransclusionReference",environment:t,perform:e=>{const r=n.getContentStores().map((o=>{const[i,n]=G.Qi({environment:t,store:o,addCopyName:!1,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,targetSpaceId:(0,_.CG)(o.pointer.spaceId),baseUrl:xe.Z.domainBaseUrl,publicDomainName:xe.Z.publicDomainName,preferDuplicateLocation:"local"});return i})),a=d().clone(r).reverse().map((t=>{const{child:n}=ae.BE({parent:i,insert:t,after:o,transaction:e});return n}));_e.Od({store:o,transaction:e}),L.Z5({environment:t,stores:a})}})}({environment:e.environment,store:e.blocks[0]})}}),ea=(0,Yi.PH)({key:"unsyncTransclusionContainer",displayName:nn.unsyncTransclusionContainerName,analyticsName:nn.unsyncTransclusionContainerName.defaultMessage,fuzzySearchKeywords:nn.unsyncTransclusionContainerFuzzySearch,svg:k.Z.unsync,validators:[Eo.J5,Eo.P9(v.Ti.transclusionContainer),Eo.U7],shortcuts:["ungroup"],closeParentMenu:!0,action:e=>{!async function(e){const{environment:t,store:o}=e,i=Ge(o),n=o.getRecordStoreUIParent();if(!n||!(0,Ke.dz)(n)||!i)return;if(!(await i.confirmUnsyncTransclusionContainer()))return;const r=o.getContentStores();Ee.createAndCommit({userAction:"transclusionActions.unsyncTransclusionContainer",environment:t,canUndo:!1,perform:e=>{const i=r.map((o=>{const[i,n]=G.Qi({environment:t,store:o,addCopyName:!1,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,targetSpaceId:(0,_.CG)(o.pointer.spaceId),baseUrl:xe.Z.domainBaseUrl,publicDomainName:xe.Z.publicDomainName,preferDuplicateLocation:"local"});return i})),a=d().clone(i).reverse().map((t=>{const{child:i}=ae.BE({parent:n,insert:t,after:o,transaction:e});return i}));_e.Od({store:o,transaction:e}),L.Z5({environment:t,stores:a}),e.postSubmitCallbacks.push((async e=>{e||await R.deleteBlocks(t,{blocks:[{id:o.id,spaceId:(0,_.CG)(o.pointer.spaceId)}],permanentlyDelete:!1})}))}})}({environment:e.environment,store:e.blocks[0]})}}),ta=(0,Yi.PH)({key:"caption",displayName:nn.captionName,analyticsName:nn.captionName.defaultMessage,svg:k.Z.caption,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.U7,Eo.W2,Eo.or([Eo.l$("source"),Eo.l$("link"),Eo.P9("code")])],shortcuts:["caption"],closeParentMenu:!0,action:e=>_e.VJ(e)});function oa(e){return(0,Yi.PH)({key:`font ${e.font||"default"}`,displayName:e.displayName,analyticsName:e.displayName.defaultMessage,validators:[Eo.or([Eo.ff(Eo.YG),Eo.f7]),Eo.J5],render:(t,o,i)=>{const n=o.blocks[0].getFormat().page_font,r=e.font===n||!e.font&&!n;return p.createElement(Et,a()({},t,{isActive:r,font:e.font,tooltip:e.tooltip,style:e.style,caption:e.caption}))},closeParentMenu:!1,action:(t,o)=>{let{blocks:i,environment:n}=t;Ee.createAndCommit({userAction:"actionRegistry.createFontAction",environment:n,perform:t=>{te.FH({stores:i,update:{page_font:e.font},transaction:t}),Z.trackChangeFontType(n,{type:e.font||"default"})}})}})}const ia=oa({displayName:nn.fontDefaultName,caption:p.createElement(B.FormattedMessage,nn.fontDefaultCaption),font:void 0,tooltip:p.createElement(B.FormattedMessage,nn.fontDefaultTooltip),style:{fontSize:24,fontFamily:P.Z.getCompositeFontFamily(g.SP).sans,position:"relative",top:-2}}),na=oa({displayName:nn.fontSerifName,caption:p.createElement(B.FormattedMessage,nn.fontSerifCaption),font:"serif",tooltip:p.createElement(B.FormattedMessage,nn.fontSerifTooltip),style:{fontSize:25,fontFamily:P.Z.getCompositeFontFamily(g.SP).serif}}),ra=oa({displayName:nn.fontMonoName,caption:p.createElement(B.FormattedMessage,nn.fontMonoCaption),font:"mono",tooltip:p.createElement(B.FormattedMessage,nn.fontMonoTooltip),style:{fontSize:26,fontFamily:P.Z.getCompositeFontFamily(g.SP).mono,position:"relative",top:-3,letterSpacing:-1}}),aa=(0,Yi.$J)({key:"font section",title:nn.fontStyleSection,render:e=>p.createElement(At,e),actions:[ia,na,ra]});function sa(e){return(0,Yi.PH)({key:`format ${e.key}`,displayName:e.displayName,analyticsName:e.displayName.defaultMessage,validators:e.validators,render:(t,o,i)=>{let{blocks:r,environment:s}=o;const l=r[0].getFormat(),c=Boolean(l[e.property]),{isMobile:d}=s.device;return p.createElement(Ct.Z,a()({},t,{title:e.label,icon:e.svg?n()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},void 0,e.svg({width:d?20:17,height:d?20:17})):void 0,on:c}))},closeParentMenu:!1,action:t=>{let{environment:o,blocks:i}=t;Ee.createAndCommit({userAction:"actionRegistry.createFormatAction",environment:o,perform:t=>{const n=i[0],r=n.getFormat(),a=!Boolean(r[e.property]);te.FH({stores:[n],update:{[e.property]:a},transaction:t}),e.afterAction(a,o)}})}})}const la=sa({key:"small text",displayName:nn.fontSmallTextKeywords,label:Ro.default.formatMessage(nn.fontSmallTextLabel),property:"page_small_text",validators:[Eo.ff(Eo.tq),Eo.or([Eo.ff(Eo.YG),Eo.f7]),Eo.J5],afterAction:(e,t)=>Z.trackChangeFontSize(t,{type:e?"small":"large"})}),ca=(0,Yi.PH)({key:"page lock",displayName:nn.lockPageName,analyticsName:nn.lockPageName.defaultMessage,svg:k.Z.locked,validators:[Eo.ff(Eo.YG),Eo.J5,Eo.ff(Eo.p1)],closeParentMenu:!1,action:(e,t)=>{let{blocks:o,environment:i}=e;const n=o[0];ge.bo({environment:i,store:n,lock:!0})}}),da=(0,Yi.PH)({key:"page unlock",displayName:nn.unlockPageName,analyticsName:nn.unlockPageName.defaultMessage,svg:k.Z.unlocked,validators:[Eo.ff(Eo.YG),Eo.J5,Eo.p1],closeParentMenu:!1,action:(e,t)=>{let{blocks:o,environment:i}=e;const n=o[0];ge.bo({environment:i,store:n,lock:!1})}}),pa=(0,Yi.PH)({key:"database lock",displayName:nn.lockDatabaseName,analyticsName:nn.lockDatabaseName.defaultMessage,svg:k.Z.locked,validators:[Eo.YG,Eo.pl,Eo.ff(Eo.f7),Eo.k5,Eo.ff(Eo.p1)],closeParentMenu:!1,action:e=>{let{blocks:t,environment:o}=e;const i=t[0];ge.bo({environment:o,store:i,lock:!0})}}),ua=(0,Yi.PH)({key:"database unlock",displayName:nn.unlockDatabaseName,analyticsName:nn.unlockDatabaseName.defaultMessage,svg:k.Z.unlocked,validators:[Eo.YG,Eo.pl,Eo.ff(Eo.f7),Eo.k5,Eo.p1],closeParentMenu:!1,action:e=>{let{blocks:t,environment:o}=e;const i=t[0];ge.bo({environment:o,store:i,lock:!1})}}),ma=(0,Yi.PH)({key:"wiki lock",displayName:nn.lockWikiName,analyticsName:nn.lockWikiName.defaultMessage,svg:k.Z.locked,validators:[Eo.YG,Eo.pl,Eo.f7,Eo.k5,Eo.ff(Eo.p1)],closeParentMenu:!1,action:e=>{let{blocks:t,environment:o}=e;const i=t[0];ge.bo({environment:o,store:i,lock:!0})}}),ga=(0,Yi.PH)({key:"wiki unlock",displayName:nn.unlockWikiName,analyticsName:nn.unlockWikiName.defaultMessage,svg:k.Z.unlocked,validators:[Eo.YG,Eo.pl,Eo.f7,Eo.k5,Eo.p1],closeParentMenu:!1,action:e=>{let{blocks:t,environment:o}=e;const i=t[0];ge.bo({environment:o,store:i,lock:!1})}}),ha=(0,Yi.PH)({key:"database views lock",displayName:nn.lockDatabaseViewsName,analyticsName:nn.lockDatabaseViewsName.defaultMessage,svg:k.Z.locked,validators:[Eo.YG,Eo.ff(Eo.pl),Eo.k5,Eo.ff(Eo.p1)],closeParentMenu:!1,action:(e,t)=>{let{blocks:o,environment:i}=e;const n=o[0];ge.bo({environment:i,store:n,lock:!0})}}),fa=(0,Yi.PH)({key:"database views unlock",displayName:nn.unlockDatabaseViewsName,analyticsName:nn.unlockDatabaseViewsName.defaultMessage,svg:k.Z.unlocked,validators:[Eo.YG,Eo.ff(Eo.pl),Eo.k5,Eo.p1],closeParentMenu:!1,action:(e,t)=>{let{blocks:o,environment:i}=e;const n=o[0];ge.bo({environment:i,store:n,lock:!1})}}),va=(0,Yi.PH)({key:"property visibility",displayName:nn.propertyVisibilityLabel,analyticsName:nn.propertyVisibilityLabel.defaultMessage,svg:k.Z.eyeHide,shortcuts:["togglePropertyVisibility"],validators:[Eo.J5,Eo.ff(Eo.YG)],closeParentMenu:!0,action:e=>{Ei.Z.setState({...Ei.Z.state,forceShowProperties:!Ei.Z.state.forceShowProperties})}}),ya=(0,Yi.PH)({key:"customize page",displayName:nn.customizePageLabel,analyticsName:nn.customizePageLabel.defaultMessage,svg:k.Z.customizePage,validators:[Eo.U_,Eo.ff(Eo.YG)],closeParentMenu:!0,render:e=>p.createElement(bt.Z,a()({},e,{title:p.createElement(B.FormattedMessage,nn.customizePageLabel),svg:k.Z.customizePage,shortcuts:[]})),action:e=>{j.bA({originRect:e.originRect})}}),ba=sa({key:"full width",displayName:nn.fullWidthLabel,label:Ro.default.formatMessage(nn.fullWidthLabel),property:"page_full_width",validators:[Eo.ff(Eo.Mn),Eo.ff(Eo.YG),Eo.J5],afterAction:(e,t)=>Z.trackChangePageWidth(t,{type:e?"full_width":"default_width"})}),Sa=(0,Yi.PH)({key:"slack loading",analyticsName:nn.slackLoadingLabel.defaultMessage,closeParentMenu:!1,displayName:nn.slackLoadingLabel,validators:[Eo.Gg,Eo.J5,Eo.ff(Eo.tJ)],render:e=>n()(ct.Z,{placement:ct.Z.Placement.Left,render:t=>p.createElement(bt.Z,a()({},(0,rt.Z)(t,e),{disabled:!0,svg:k.Z.connect,title:n()(B.FormattedMessage,{defaultMessage:"Loading…",id:"topbar.updatesButton.slackIntegrationButton.loading"})})),renderTooltip:Xt}),action:e=>{}}),wa=(0,Yi.PH)({key:"slack empty",analyticsName:nn.slackEmptyLabel.defaultMessage,closeParentMenu:!0,displayName:nn.slackEmptyLabel,validators:[Eo.Gg,Eo.J5,Eo.tJ,Eo.OF,Eo.YP,Eo.ff(Eo.Fx)],render:e=>n()(ct.Z,{placement:ct.Z.Placement.Left,render:t=>p.createElement(bt.Z,a()({},(0,rt.Z)(t,e),{svg:k.Z.connect,title:p.createElement(B.FormattedMessage,nn.slackEmptyLabel)})),renderTooltip:Xt}),action:e=>{var t,o;Ae({environment:e.environment,blockId:null===(t=e.blocks)||void 0===t||null===(o=t[0])||void 0===o?void 0:o.id,intl:Ro.default.getIntl()})}}),ka=(0,Yi.PH)({key:"slack connected inherited",analyticsName:nn.slackConnectedLabel.defaultMessage,closeParentMenu:!0,displayName:nn.slackConnectedLabel,validators:[Eo.Gg,Eo.J5,Eo.ur],render:(e,t,o)=>p.createElement($t,a()({blockStore:t.blocks[0]},e)),action:e=>{}}),Ca=(0,Yi.PH)({key:"slack connected on block",analyticsName:nn.slackConnectedLabel.defaultMessage,closeParentMenu:!0,displayName:nn.slackConnectedLabel,validators:[Eo.Gg,Eo.J5,Eo.Rd],render:(e,t,o)=>p.createElement(Jt,a()({blockStore:t.blocks[0]},e)),action:e=>{const{slackIntegrationStore:t}=(0,jt.Jk)(e.blocks[0]);De(e.environment,t,Ro.default.getIntl())}}),_a=sa({key:"code wrap",displayName:nn.wrapCodeKeywords,label:Ro.default.formatMessage(nn.wrapCodeLabel),property:"code_wrap",validators:[Eo.U7,Eo.P9("code")],afterAction:(e,t)=>{C.Z.set({userId:t.currentUser.id,key:ft.Z.localCodeWrapPreferenceKey,value:e})}}),Ma=(0,Yi.PH)({key:"work at notion",analyticsName:nn.workAtNotion.defaultMessage,closeParentMenu:!0,displayName:nn.workAtNotion,validators:[Eo.P9("code"),Eo.vM],action:()=>{window&&window.open(M._j.careers)}}),Ta=[Eo.J5,Eo.ff(Eo.fI),Eo.ro("quote")],Ia=(0,Yi.MV)({key:"quote size",displayName:nn.quoteSize,analyticsName:nn.quoteSize.defaultMessage,svg:k.Z.quote,validators:Ta,subActions:()=>[Is]}),Pa=(0,Yi.MV)({key:"number format",displayName:nn.listFormat,analyticsName:nn.listFormat.defaultMessage,svg:k.Z.properties,validators:mn,subActions:()=>[zs]}),xa=(0,Yi.MV)({key:"bulleted format",displayName:nn.listFormat,analyticsName:nn.listFormat.defaultMessage,svg:k.Z.properties,validators:gn,subActions:()=>[js]}),Ba=[Eo.jl,Eo.or([Eo.xD([Eo.U7,Eo.Cj,Eo.k6]),Eo.xD([Eo.P9(v.Ti.text),Eo.QL("text_align")])])],Za=(0,Yi.MV)({key:"alignment",displayName:nn.alignmentName,analyticsName:nn.alignmentName.defaultMessage,svg:k.Z.alignLeft,validators:Ba,subActions:()=>[Zs]});function Ea(e){const t=Ye.R.findCollectionViewBlockFromStore(e);if(!t)return;return t.collectionContextStore.collectionViewStore()}const Ra=(0,Yi.PH)({key:"format wrap all columns",displayName:nn.wrapCellsName,analyticsName:nn.wrapCellsName.defaultMessage,validators:[Eo.dM("table"),Eo.J5,Eo.ff(Eo.fI),Eo.ff(Eo.JF)],render:(e,t,o)=>{let{blocks:i,environment:r}=t;const s=Ea(i[0]),l=s&&s.getFormat(),c=Boolean(l&&Boolean(l.table_wrap));return p.createElement(at.Z,a()({},e,{title:Ro.default.formatMessage(nn.wrapCellsName),right:n()(kt.Z,{on:c,onClick:e.onClick})}))},closeParentMenu:!1,action:(e,t)=>{let{environment:o,blocks:i}=e;const n=Ea(i[0]);if(!n)return;const r=n.getFormat(),a=Boolean(r.table_wrap),s=!a;Ne.qY({environment:o,collectionViewStore:n,currentValue:a}),Z.trackChangeTableWrap(o,{type:s?"wrap":"clip",is_fullscreen:!0})}}),Aa=(0,Yi.$J)({key:"page style",render:e=>p.createElement(wt.Z,e),actions:[la,ba]}),Da=((0,Yi.$J)({key:"table style",render:e=>p.createElement(wt.Z,e),actions:[Ra]}),(0,Yi.PH)({key:"enter",displayName:nn.enterName,analyticsName:nn.enterName.defaultMessage,validators:[Eo.J5,Eo.ff(Eo.fI)],shortcuts:["enter"],closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;Ee.createAndCommit({userAction:"actionRegistry.enter",environment:t,perform:e=>{_e.mp({blocks:o,transaction:e})}})}})),Fa=(0,Yi.PH)({key:"activate",analyticsName:"Activate",displayName:void 0,validators:[Eo.J5,Eo.nW],shortcuts:["commandEnter"],closeParentMenu:!0,action:e=>_e.QZ(e)}),La=(0,Yi.PH)({key:"open tab",analyticsName:"open tab",displayName:void 0,validators:[Eo.fy],shortcuts:["commandEnter"],closeParentMenu:!0,action:e=>_e.Ah(e)}),Va=(0,Yi.PH)({key:"toggle sidebar",analyticsName:"Toggle sidebar",displayName:void 0,validators:[],shortcuts:["toggleSidebar"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return Me.setExpand({environment:t,isExpanded:!Li.gV.state})}}),Na=(0,Yi.PH)({key:"toggle favorite",analyticsName:"Toggle favorite",displayName:void 0,validators:[Eo.jl],shortcuts:["toggleFavorite"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const{currentSpaceViewStore:o}=ro.default.state,i=xr();if(!o||!i)return;const n=(0,fi.Z)({spaceViewStore:o,pageId:i.id})?Me.unbookmarkPage:Me.bookmarkPage;Ee.createAndCommit({userAction:"actionRegistry.toggleFavorite",environment:t,perform:e=>n({spaceViewStore:o,store:i,transaction:e})})}}),Oa=(0,Yi.PH)({key:"open page updates",analyticsName:"Open page updates",displayName:nn.pageUpdates,svg:k.Z.bell,validators:[Eo.RF,Eo.tq],closeParentMenu:!0,action:()=>{Ri.Z.setState({open:!0})}}),Ua=(0,Yi.PH)({key:"toggle update sidebar",analyticsName:"Toggle update sidebar",displayName:void 0,validators:[],shortcuts:["toggleUpdateSidebar"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return Me.setUpdateExpand({environment:t,isExpanded:!(0,wi.Sx)(t),from:"keyboard_default"})}}),Ha=(0,Yi.PH)({key:"toggle both sidebars",analyticsName:"Toggle both sidebars",displayName:void 0,validators:[],shortcuts:["toggleBothSidebars"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Me.toggleBothSidebars(t)}}),za=(0,Yi.PH)({key:"open comments tab in update sidebar",analyticsName:"Open comments tab in update sidebar",displayName:void 0,validators:[],shortcuts:["openCommentsTabInUpdateSidebar"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Me.setUpdateExpand({environment:t,isExpanded:!0,from:"keyboard_comments"}),Me.setUpdateSidebarTab(Wi.gY.Comments)}}),Wa=(0,Yi.PH)({key:"open updates tab in update sidebar",analyticsName:"Open updates tab in update sidebar",displayName:void 0,validators:[],shortcuts:["openUpdatesTabInUpdateSidebar"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Me.setUpdateExpand({environment:t,isExpanded:!0,from:"keyboard_updates"}),Me.setUpdateSidebarTab(Wi.gY.Updates)}}),ja=(0,Yi.PH)({key:"merge with csv",displayName:nn.mergewithCSVName,analyticsName:nn.mergewithCSVName.defaultMessage,svg:k.Z.import,validators:[Eo.YG,Eo.k5,Eo.Gg,Eo.YZ,Eo.ff(Eo.fI),Eo.ff(Eo.JF),Eo.ff(Eo.K5)],closeParentMenu:!0,action:e=>{let{blocks:[t],environment:o}=e;z.mS({environment:o,store:t})}}),Ka=(0,Yi.PH)({key:"view collection view as page",displayName:nn.turnintoPageName,analyticsName:nn.turnintoPageName.defaultMessage,svg:k.Z.loop,validators:[Eo.vj,Eo.ff(Eo.O4),Eo.k5,Eo.ff(Eo.b4),Eo.ff(Eo.fI),Eo.ff(Eo.K5)],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;return Ee.createAndCommit({userAction:"actionRegistry.turnCollectionViewIntoCollectionViewPage",environment:o,perform:e=>{Xe.Cj({environment:o,blocks:t,blockType:"collection_view_page",transaction:e})}})}}),Ya=(0,Yi.PH)({key:"view collection view inline",displayName:nn.turnintoInlineName,analyticsName:nn.turnintoInlineName.defaultMessage,svg:k.Z.loop,validators:[Eo.Mg,Eo.ff(Eo.O4),Eo.k5,Eo.ff(Eo.b4),Eo.ff(Eo.f7),Eo.IZ],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;return Ee.createAndCommit({userAction:"actionRegistry.viewCollectionViewInline",environment:o,perform:e=>{Xe.Cj({environment:o,blocks:t,blockType:"collection_view",transaction:e}),L.ZH(o)}})}}),Ga=(0,Yi.PH)({key:"turn into simple table",displayName:nn.turnCollectionIntoSimpleTable,analyticsName:nn.turnCollectionIntoSimpleTable.defaultMessage,svg:k.Z.loop,validators:[Eo.vj,Eo.dM("table"),Eo.ff(Eo.O4),Eo.k5,Eo.ff(Eo.b4),Eo.TK,Eo.iJ,Eo.ff(Eo.K5)],closeParentMenu:!0,action:async e=>{let{blocks:t,environment:o}=e;const i=t[0],n=await ki.ZB({environment:o,collectionViewBlockStore:i});Ee.createAndCommit({userAction:"actionRegistry.turnCollectionIntoSimpleTable",environment:o,perform:e=>{Ie.sR({environment:o,collectionViewBlockStore:i,pageStores:n,transaction:e}),L.ZH(o),Ie.MO()}})}}),Xa=(0,Yi.PH)({key:"turn into collection",displayName:nn.turnSimpleTableIntoCollection,analyticsName:nn.turnSimpleTableIntoCollection.defaultMessage,svg:k.Z.loop,validators:[Eo.J5,Eo.ff(Eo.b4),Eo._n,Eo.XQ,Eo.ff(Eo.US)],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;return Ee.createAndCommit({userAction:"actionRegistry.turnSimpleTableIntoCollection",environment:o,perform:e=>{Ie.Fv({simpleTableStore:t[0],transaction:e}),L.ZH(o),Ie.MO()}})}}),qa=sa({key:"simple table header column",displayName:nn.simpleTableHeaderColumn,label:Ro.default.formatMessage(nn.simpleTableHeaderColumn),property:"table_block_row_header",svg:k.Z.tableHeaderColumn,validators:[Eo.J5,Eo.ff(Eo.b4),Eo.W5,Eo.p4],afterAction:(e,t)=>{}}),$a=sa({key:"simple table header row",displayName:nn.simpleTableHeaderRow,label:Ro.default.formatMessage(nn.simpleTableHeaderRow),property:"table_block_column_header",svg:k.Z.tableHeaderRow,validators:[Eo.J5,Eo.ff(Eo.b4),Eo.W5,Eo.zO],afterAction:(e,t)=>{}}),Ja=(0,Yi.PH)({key:"open link annotation menu",displayName:nn.createLinkName,analyticsName:nn.createLinkName.defaultMessage,validators:[Eo.D,Eo.KL,Eo.U4,Eo.ry],shortcuts:["openLinkMenu"],closeParentMenu:!0,action:()=>re.dz({type:"focusOnly",focus:!0})}),Qa=(0,Yi.PH)({key:"open equation annotation menu",displayName:nn.createEquationName,analyticsName:nn.createEquationName.defaultMessage,validators:[Eo.D,Eo.ff(Eo.or([Eo.Kh,Eo.T2,Eo.QY,Eo.DU]))],shortcuts:["openEquationMenu"],closeParentMenu:!0,action:e=>J.qn({environment:e.environment,analyticsFrom:"input_keyboard_shortcut"})}),es=(0,Yi.PH)({key:"exit app",analyticsName:"Exit app",displayName:void 0,validators:[Eo.ff(Eo.NW),Eo.Dt],shortcuts:["backbutton"],closeParentMenu:!0,action:e=>{let{environment:t}=e;if(t.mobileNative)if((0,bi.__)(t)){const{TabbedRouterStore:e}=t;"home"!==e.state.activeTab?ke.navigateToTab({environment:t,tab:"home",navigationAction:"pop",navigationSource:"mobile-back-navigation"}):t.mobileNative.exitApp()}else t.mobileNative.exitApp();else if(/Cordova/.test(navigator.userAgent)){const e=window;e.navigator.app&&e.navigator.app.exitApp&&e.navigator.app.exitApp()}}}),ts=(0,Yi.PH)({key:"command left",analyticsName:"Go back",displayName:void 0,validators:[Eo.NW,Eo.ff(Eo.D)],shortcuts:["commandLeft"],closeParentMenu:!0,action:(e,t)=>ke.back(e.environment)}),os=(0,Yi.PH)({key:"command right",analyticsName:"Go forward",displayName:void 0,validators:[Eo.vy,Eo.ff(Eo.D)],shortcuts:["commandRight"],closeParentMenu:!0,action:()=>ke.forward()}),is=(0,Yi.PH)({key:"go back",analyticsName:"Go back",displayName:void 0,validators:[Eo.NW],shortcuts:["goBack","backbutton"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return ke.back(t)}}),ns=(0,Yi.PH)({key:"go forward",analyticsName:"Go forward",displayName:void 0,validators:[Eo.vy],shortcuts:["goForward"],closeParentMenu:!0,action:()=>ke.forward()}),rs=(0,Yi.PH)({key:"go up",analyticsName:"Go up",displayName:void 0,validators:[()=>ke.canGoUp()],shortcuts:["goUp"],closeParentMenu:!0,action:e=>{let{environment:t}=e;return ke.up(t)}}),as=(0,Yi.PH)({key:"switch spaces pre tabs",analyticsName:"Switch spaces pre tabs",displayName:void 0,validators:[Eo.d,Eo.ff(Eo.Vc)],shortcuts:["switchSpacesPreTabs"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;if(!t||!an(t))return;t.preventDefault();const i=parseInt(l()(t.keyCode)),{currentUserRootStore:n,currentUserSettingsStore:r}=ro.default.state;n&&r&&(Le.Yi({environment:o,index:i-1,userRootStore:n,userSettingsStore:r}),Z.trackSpaceSwitcherSelectSpace(o))}}),ss=(0,Yi.PH)({key:"switch spaces post tabs",analyticsName:"Switch spaces post tabs",displayName:void 0,validators:[Eo.d,Eo.Vc],shortcuts:["switchSpacesPostTabs"],closeParentMenu:!0,action:(e,t)=>{let{environment:o}=e;if(!t||!an(t))return;t.preventDefault();const i=parseInt(l()(t.keyCode)),{currentUserRootStore:n,currentUserSettingsStore:r}=ro.default.state;n&&r&&(Le.Yi({environment:o,index:i-1,userRootStore:n,userSettingsStore:r}),Z.trackSpaceSwitcherSelectSpace(o))}}),ls=(0,Yi.PH)({key:"open settings",analyticsName:"Open settings",displayName:void 0,validators:[Eo.d,Eo.ED],shortcuts:["settings"],closeParentMenu:!0,action:e=>{de.r()}}),cs=(0,Yi.PH)({key:"new page",analyticsName:"New page",displayName:void 0,validators:[Eo.RO,Eo.jl,Eo.or([Eo.d,Eo.Fx])],shortcuts:["newPage"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Me.quickAddPage({environment:t,from:"cmd_n"})}}),ds=(0,Yi.PH)({key:"export block",displayName:nn.exportName,analyticsName:nn.exportName.defaultMessage,validators:[Eo.Gg,Eo.jl,Eo.Kb],closeParentMenu:!0,render:e=>p.createElement(bt.Z,a()({},e,{svg:k.Z.file,title:p.createElement(B.FormattedMessage,nn.exportName),caption:p.createElement(B.FormattedMessage,nn.exportCaption)})),action:e=>{let{blocks:t,environment:o}=e;const i=Q.aO(t[0]);if(!i.isDefined())return;let n=!0;const r=(0,pi.fm)(t[0]);if(r){const e=null==r?void 0:r.collectionStore();null!=e&&e.isPageTreeCollection()&&(n=!1)}Q.q$({environment:o,root:{id:i.id,table:"block",spaceId:i.getSpaceId()},isCollectionViewExportTypeSupported:n})}}),ps=(0,Yi.PH)({key:"action report page",displayName:nn.reportPageName,analyticsName:nn.reportPageName.defaultMessage,validators:[Eo.Gg,Eo.iK,Eo.Id],closeParentMenu:!0,render:e=>p.createElement(bt.Z,a()({},e,{style:{color:b.ZP.red},svg:k.Z.reportPage,title:p.createElement(B.FormattedMessage,nn.reportPageName)})),action:e=>{let{blocks:t,environment:o}=e;Se.l()}}),us=(0,Yi.PH)({key:"open import modal",displayName:nn.importName,analyticsName:nn.importName.defaultMessage,svg:k.Z.import,validators:[Eo.Gg,Eo.YZ,Eo.J5,Eo.ff(Eo.YG),Eo.ff(Eo.P9(v.Ti.externalObjectInstancePage))],closeParentMenu:!0,action:e=>{let{blocks:t}=e;Zi.Z.setState({open:!0,pageStore:t[0]})}}),ms=(0,Yi.PH)({key:"turn into type",displayName:nn.turnIntoName,analyticsName:nn.turnIntoName.defaultMessage,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.XQ,Eo.wF],shortcuts:["turnIntoType"],closeParentMenu:!0,action:(e,t)=>{let{blocks:o,environment:i}=e;if(!t||!an(t))return;t.preventDefault();const n=parseInt(l()(t.keyCode)),r=v.PH[n];Ee.createAndCommit({userAction:"actionRegistry.turnIntoTypeViaKeyboard",environment:i,perform:e=>{Xe.Cj({environment:i,blocks:o,blockType:r,transaction:e})}})}}),gs=(0,Yi.PH)({key:"move to",displayName:nn.moveToName,analyticsName:nn.moveToName.defaultMessage,svg:k.Z.moveTo,shortcuts:["moveTo"],validators:[...pe.z1()],closeParentMenu:!0,render:(e,t)=>{let o;const i=Eo.zz(t),r=Eo.b1(t);i?r&&(o=p.createElement(B.FormattedMessage,nn.isLockedTopLevelTeamPage)):o=n()(B.FormattedMessage,{id:"blockMenu.moveTo.disabled.fullAccess.reason",defaultMessage:'You need "Full access" to this page to move it',description:"Explains to the user why the move to option is disabled and directs them to getting full access."});const s=Boolean(o);return n()(ct.Z,{placement:ct.Z.Placement.Right,textWrap:!0,style:{maxWidth:240},disableTooltip:!s,renderTooltip:()=>o,render:t=>p.createElement(bt.Z,a()({},(0,rt.Z)(e,t),{svg:k.Z.moveTo,title:p.createElement(B.FormattedMessage,nn.moveToName),disabled:s,disabledFeedback:s,shortcuts:["moveTo"]}))})},action:e=>{if(!Eo.vd(e))return Fe.oV({label:Ro.default.formatMessage(nn.isLockedTopLevelTeamPage)}),void Z.trackMoveToError(e.environment,{type:"locked_top_level_team"});if(!Eo.lQ(e))return Fe.oV({label:Ro.default.formatMessage(nn.doNotHavePermissionToMoveBlock)}),void Z.trackMoveToError(e.environment,{type:"no_permission"});let t=[];const o=ro.default.state.mainEditorCurrentBlockStore,i=ri.np();e.blocks.length>0&&e.blocks[0]!==o?t=e.blocks:i&&(t=[i]),pe.bA({environment:e.environment,blocks:t,originRect:e.originRect,moveToContext:"action_menu",needsConfirmation:Fi.Z.isInBulkSelectSession()})}}),hs=(e,t)=>(0,Yi.PH)({key:"turn page into wiki",displayName:t,analyticsName:nn.turnPageIntoWikiFullName.defaultMessage,svg:k.Z.loop,validators:e,closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;"bottom_right"===xi.default.getEligibleGroup({experimentId:"wiki_education_convert_modal",defaultGroup:"control"})?ji.E.setState({showConvertTooltip:!1,forceShow:!0}):Ee.createAndCommit({userAction:"actionRegistry.turnIntoAction.wiki",environment:t,perform:e=>{Je.Y({environment:t,blocks:o,transaction:e,source:"page_menu"})}})},render:e=>n()(Tt,{menuListItemProps:e,title:p.createElement(B.FormattedMessage,t),disabled:!1,icon:k.Z.loop,showNewBadge:!0,caption:p.createElement(B.FormattedMessage,nn.turnPageIntoWikiCaption)})}),fs=hs([Eo.xD([Eo.KS,Eo.ff(Eo.jp)])],nn.turnPageIntoWikiFullName),vs=hs([Eo.KS],nn.turnPageIntoWikiFullName),ys=hs([Eo.KS],nn.turnPageIntoWikiName),bs=(0,Yi.PH)({key:"undo turn page into wiki",displayName:nn.undoTurnPageIntoWikiName,analyticsName:nn.undoTurnPageIntoWikiName.defaultMessage,svg:k.Z.undo,validators:[Eo.U7,Eo.U_,Eo.ff(Eo.p1),Eo.f7,Eo.QL("wiki_database")],closeParentMenu:!0,action:async e=>{let{environment:t,blocks:o}=e;await K.confirmUserAction({message:n()("div",{style:{textAlign:"center"}},void 0,n()(B.FormattedMessage,{defaultMessage:"Are you sure you want to turn <bold>{pageName}</bold> back into a normal page?",id:"action.undoTurnIntoWiki.message",description:"Confirmation dialog message that prompts users when they try to convert their wiki database back to a normal page.",values:{pageName:T.Q(o[0].getTitleValue()),bold:e=>n()("span",{style:{fontWeight:P.Z.fontWeight.semibold}},void 0,e)}})),description:n()("div",{style:{textAlign:"center"}},void 0,n()(B.FormattedMessage,{defaultMessage:"This will remove properties like owners and verification from your pages",id:"action.undoTurnIntoWiki.description",description:"Confirmation dialog description explaining what will happen when users convert their wiki database back to a normal page."}))})&&Ee.createAndCommit({userAction:"actionRegistry.undoTurnIntoAction.wiki",environment:t,perform:e=>{Je.Cq({environment:t,blocks:o,transaction:e,source:"page_menu"})}})}}),Ss=(0,Yi.PH)({key:"move page to",displayName:nn.moveToName,analyticsName:nn.moveToName.defaultMessage,shortcuts:["moveTo"],validators:[],closeParentMenu:!0,action:e=>{let{environment:t,publicEditMode:o}=e;const{mainEditorCurrentBlockStore:i}=ro.default.state;if(!i)return;const n=gs.validators||[],r=document.querySelector(`.${li.mSZ}`);if(!r)return;const a={environment:t,blocks:[i],originRect:r.getBoundingClientRect(),publicEditMode:o};n.every((e=>e(a)))&&gs.action(a)}}),ws=(0,Yi.PH)({key:"action page history",displayName:nn.pageHistoryName,analyticsName:nn.pageHistoryName.defaultMessage,svg:k.Z.versionHistory,validators:[Eo.or([Eo._T,Eo.k5]),Eo.Gg,Eo.DF,Eo.jl],closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;return oe.jN({environment:t,blockStore:o[0],from:"topbar"})},render:(e,t)=>{let{onClick:o,key:i,...r}=e,{environment:s}=t;return n()(ni.Z,{requireUpgradeToTier:!1,analyticsName:"history_modal",onClick:o,alwaysAllowClick:!0,render:(e,t)=>p.createElement(bt.Z,a()({},(0,rt.Z)(r,e),{title:Ro.default.formatMessage(nn.pageHistoryName),svg:k.Z.versionHistory,dontShrinkRight:!0,right:t})),renderUpgradeTooltip:()=>{}},i)}}),ks=(0,Yi.PH)({key:"open page trash",displayName:nn.showDeletedPagesName,analyticsName:nn.showDeletedPagesName.defaultMessage,svg:k.Z.showDeletedPages,validators:[Eo.J5,Eo.oY,Eo.jl,Eo.ff(Eo.nJ)],closeParentMenu:!0,action:()=>{Ni.Z.setState({open:!0}),Oi.Z.setState({...Oi.Z.state,currentTab:"in_current_page"})}}),Cs=(0,Yi.PH)({key:"clear date",displayName:nn.clearDateName,analyticsName:nn.clearDateName.defaultMessage,svg:k.Z.timeBy,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.or([Eo.j2("timeline"),Eo.j2("calendar")])],closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;const i=(0,pi.fm)(o[0]);if(!i)return;const n=null==i?void 0:i.collectionViewStore();if(!n)return;const r=i.normalizedSchemaStore.state;Ee.createAndCommit({userAction:"actionRegistry.clearDate",environment:t,perform:e=>{H.k2({stores:o,collectionViewStore:n,schema:r,transaction:e})}})}}),_s=(0,Yi.PH)({key:"edit icon",displayName:nn.editIconName,analyticsName:nn.editIconName.defaultMessage,svg:k.Z.editPageIcon,validators:[Eo.EC,Eo.J5,Eo.ff(Eo.fI),Eo.QL("icons_bulk_edit"),Eo.lr],closeParentMenu:!0,action:e=>{let{environment:t,originRect:o,blocks:i}=e;const r=(e,o)=>{i.forEach((o=>{const i=o.getIconStore();i&&Ee.createAndCommit({userAction:"actionRegistry.editIcon",environment:t,perform:t=>{ve.sO({store:i,value:e,transaction:t})}})})),o&&o.keepVisible||le.Z()},a=i.find((e=>e.hasIcon())),s=i.every((e=>e.isType("callout"))),l=[{type:"emoji",title:n()(B.FormattedMessage,{defaultMessage:"Emojis",id:"recordIcon.emojiTab.title"}),onChange:r},{type:"icon",title:n()("div",{style:{display:"flex",gap:4}},void 0,n()(B.FormattedMessage,{defaultMessage:"Icons",id:"recordIcon.iconTab.title",description:"Icon tab heading"})),onChange:r}];le.$(t,{recordIconLoggingData:{source:"bulk_block_selection"},originGap:4,originRect:o,popupWidth:It.ZP.desktopPopupWidth,popupHeight:It.ZP.desktopPopupHeight,isSmallWidth:!1,title:Ro.default.getIntl().formatMessage({defaultMessage:"Page icon",id:"recordIcon.emojiModalMenu.title"}),onDelete:a?()=>{i.forEach((e=>{const o=e.getIconStore();o&&Ee.createAndCommit({userAction:"actionRegistry.editIcon",environment:t,perform:e=>{ve.sO({store:o,value:void 0,transaction:e})}})})),le.Z()}:void 0,currentTab:"emoji",isCallout:s,tabs:l,disableClearSelection:!0})}}),Ms=(0,Yi.MV)({key:"edit property",displayName:nn.editPropertyName,analyticsName:nn.editPropertyName.defaultMessage,svg:k.Z.properties,validators:_n,subActions:e=>{let{blocks:t}=e;const o=t[0];if(!o)return[];const i=o.getAssociatedCollectionStore();if(i){const e=i.getSchema(),o=i.getFormat(),n=w.iB(o,e,void 0,w.j5.Collection);if(n.collection_page_properties){n.collection_page_properties.unshift({property:"title"});return[{key:0,title:void 0,render:e=>p.createElement(wt.Z,e),actions:d().compact(n.collection_page_properties.map((o=>{const i=e[o.property];if(i&&(0,di.Sb)({propertySchema:i,property:o.property,blockStores:t,collectionSchema:e}))return function(e){const{property:t,propertySchema:o}=e,i=o.name;return{key:`Edit Property ${i} ${t}`,displayName:i,analyticsName:"Edit property",searchName:i,validators:_n,closeParentMenu:!0,action:(e,i)=>{let{blocks:n,originRect:r,environment:a}=e;"checkbox"===o.type?Ee.createAndCommit({userAction:"actionRegistry.createEditPropertyAction",environment:a,perform:e=>{N.vO({stores:n,property:t,transaction:e})}}):r&&N.bA({environment:a,store:n[0],additionalStores:n.slice(1),property:t,format:vt.C.Page,rect:{...d().toPlainObject(r),width:200},preventClearSelection:!0,blockPropertyValueOverlayStore:ri._H(),collectionContextStore:(0,pi.fm)(n[0])})},render:e=>p.createElement(Ut.Z,a()({},e,{propertySchema:o,format:Ut.Z.DisplayFormat.Name}))}}({property:o.property,propertySchema:i})})))}]}}return[]}}),Ts=((0,Yi.PH)({key:"open add item menu",displayName:nn.templatesName,analyticsName:nn.templatesName.defaultMessage,svg:k.Z.templates,validators:[Eo.YG,Eo.J5,Eo.ff(Eo.O4),Eo.ff(Eo.fI)],closeParentMenu:!0,action:e=>{let{blocks:t}=e;return _e.eJ({blocks:t,method:"openAddItemMenu"})}}),(0,Yi.PH)({key:"open collection as page",displayName:nn.openasPageName,analyticsName:nn.openasPageName.defaultMessage,svg:k.Z.openAsPage,validators:[Eo.vj,Eo.ff(Eo.O4),Eo.ff(Eo.LH)],closeParentMenu:!0,action:e=>_e.YP(e)})),Is=(0,Yi.$J)({key:"quote size actions",title:nn.quoteSizeSection,render:e=>p.createElement(wt.Z,e),actions:[(0,Yi.PH)({key:"quote size default",displayName:nn.quoteSizeDefault,analyticsName:nn.quoteSizeDefault.defaultMessage,validators:Ta,closeParentMenu:!0,action:dn(void 0)}),(0,Yi.PH)({key:"quote size large",displayName:nn.quoteSizeLarge,analyticsName:nn.quoteSizeLarge.defaultMessage,validators:Ta,closeParentMenu:!0,action:dn("large")})]}),Ps=(0,Yi.$J)({key:"turn into actions",title:nn.turnIntoSection,render:e=>p.createElement(wt.Z,e),actions:[...(0,I.Yd)(v.Zi),...Object.values(v.MF)].map((e=>function(e){const t=gi.Hc[e],o=v.zH[e];return{key:`turn into ${e}`,displayName:t.displayName,analyticsName:t.analyticsName,searchName:t.searchName,validators:d().compact([Eo.J5,o?void 0:Eo.wF,Eo.XQ,"transclusion_container"===e?Eo.xD([Eo.ff(Eo.wT),pn]):void 0,(0,v.sX)(e)?e=>1===e.blocks.length:void 0,(0,v.UW)(e)?e=>!1:void 0,"column_list"===e?e=>{if(!e.blocks)return!1;const t=e.blocks.length;if(t<2||t>5)return!1;const o=e.blocks[0].getParentBlockStore();if(!o)return!1;const i=e.blocks.map((e=>{const t=e.getParentBlockStore();return(null==t?void 0:t.id)!==o.id?-1:o.getRenderableContentIds().indexOf(e.id)}));for(let n=0;n<i.length;n++)if(n>0&&i[n-1]+1!==i[n])return!1;return!0}:void 0,(0,v.Fx)(e)?()=>!0:void 0,"mermaid_code_block"===e?()=>!1:void 0]),shortcuts:"transclusion_container"===e?["group"]:void 0,closeParentMenu:!0,action:t=>{let{environment:o,blocks:i}=t;Ee.createAndCommit({userAction:`actionRegistry.turnIntoAction.${e}`,environment:o,perform:t=>{Xe.Cj({environment:o,blocks:i,blockType:e,transaction:t})}})},render:(e,o)=>{const i=function(e,t){const o=e.blocks[0];if(!o)return!1;const i=o.getType()===t.blockType;if(i&&("header"===t.blockType||"sub_header"===t.blockType||"sub_sub_header"===t.blockType)){const e=o.getFormat().toggleable;return!(e&&!t.key.includes("toggle")||!e&&t.key.includes("toggle"))}return i}(o,t);return p.createElement(ht,a()({},e,t,{title:t.displayName,format:ht.Format.TurnInto,selected:i}))},nativeRender:e=>({thumbnail:t.thumbnail})}}(e)))}),xs=(0,B.defineMessages)({leftAlign:{id:"action.alignment.left.name",defaultMessage:"Left",description:"One of three options for setting the alignment of an image. The other options are 'Right' and 'Center'"},centerAlign:{id:"action.alignment.center.name",defaultMessage:"Center",description:"One of three options for setting the alignment of an image. The other options are 'Right' and 'Left'"},rightAlign:{id:"action.alignment.right.name",defaultMessage:"Right",description:"One of three options for setting the alignment of an image. The other options are 'Left' and 'Center'"}}),Bs=e=>t=>{Ee.createAndCommit({userAction:"actionRegistry.createAlignmentFormatAction",environment:t.environment,perform:o=>{if(t.blocks&&t.blocks.length>0)for(const i of t.blocks)te.hc({environment:t.environment,store:i,alignment:e,transaction:o})}})},Zs=(0,Yi.$J)({key:"alignment format actions",title:nn.alignmentName,render:e=>p.createElement(wt.Z,e),actions:[(0,Yi.PH)({key:"alignment format left",displayName:xs.leftAlign,analyticsName:"Align left",validators:Ba,closeParentMenu:!0,svg:k.Z.alignLeft,action:Bs("left")}),(0,Yi.PH)({key:"alignment format center",displayName:xs.centerAlign,analyticsName:"Align center",validators:Ba,closeParentMenu:!0,svg:k.Z.alignCenter,action:Bs("center")}),(0,Yi.PH)({key:"alignment format right",displayName:xs.rightAlign,analyticsName:"Align right",validators:Ba,closeParentMenu:!0,svg:k.Z.alignRight,action:Bs("right")})]}),Es=(0,Yi.$J)({key:"text color actions",title:nn.colorSection,render:e=>p.createElement(wt.Z,e),actions:b.CY.map((e=>Sn(e)))}),Rs=(0,Yi.$J)({key:"background color actions",title:nn.backgroundSection,overrideSearchTitle:nn.backgroundSectionKeywords,render:e=>p.createElement(wt.Z,e),actions:[Sn("default","default background",ui.mF.backgroundColorDefault),...b._K.map((e=>Sn(e)))]}),As=(0,Yi.$J)({key:"simple table column background color actions",title:nn.backgroundSection,overrideSearchTitle:nn.backgroundSectionKeywords,render:e=>p.createElement(wt.Z,e),actions:[wn("default","column","default background",ui.mF.backgroundColorDefault),...b._K.map((e=>wn(e,"column")))]}),Ds=(0,Yi.$J)({key:"simple table column text color actions",title:nn.colorSection,overrideSearchTitle:nn.colorSection,render:e=>p.createElement(wt.Z,e),actions:[...b.CY.map((e=>wn(e,"column")))]}),Fs=(0,Yi.$J)({key:"simple table row background color actions",title:nn.backgroundSection,overrideSearchTitle:nn.backgroundSectionKeywords,render:e=>p.createElement(wt.Z,e),actions:[wn("default","row","default background",ui.mF.backgroundColorDefault),...b._K.map((e=>wn(e,"row")))]}),Ls=(0,Yi.$J)({key:"simple table row text color actions",title:nn.colorSection,overrideSearchTitle:nn.colorSection,render:e=>p.createElement(wt.Z,e),actions:[...b.CY.map((e=>wn(e,"row")))]}),Vs=(0,Yi.$J)({key:"text color selection actions",title:nn.colorSection,render:e=>p.createElement(wt.Z,e),actions:b.CY.map((e=>kn(e)))}),Ns=(0,Yi.$J)({key:"background color selection actions",title:nn.backgroundSection,overrideSearchTitle:nn.backgroundSectionKeywords,render:e=>p.createElement(wt.Z,e),actions:[Sn("default","default background",ui.mF.backgroundColorDefault),...b._K.map((e=>kn(e)))]}),Os=(0,Yi.$J)({key:"code block languageMode actions",title:nn.languageModeName,render:e=>p.createElement(wt.Z,e),actions:y.X0.map((e=>(0,Yi.PH)({key:`set language ${e} action`,displayName:rn[e],analyticsName:`set language ${e}`,validators:yn,closeParentMenu:!0,action:t=>{let{environment:o,blocks:i}=t;C.Z.set({userId:o.currentUser.id,key:ft.Z.localLanguagePreferenceKey,value:e}),Ee.createAndCommit({userAction:"actionRegistry.languageModeActions",environment:o,perform:t=>{U.E({language:e,blocks:i,transaction:t})}})},render:t=>p.createElement(at.Z,a()({},t,{title:e}))})))}),Us=(0,Yi.$J)({key:"toggle last highlight",title:nn.lastUsedHighlightTitle,overrideSearchTitle:nn.lastUsedHighlightKeywords,render:e=>p.createElement(wt.Z,e),actions:[(0,Yi.PH)({key:"toggle highlight action",displayName:nn.highlightName,analyticsName:nn.highlightName.defaultMessage,validators:hn,shortcuts:["toggleHighlight"],closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;const i=Bi.Z.state.color;Ee.createAndCommit({userAction:"actionRegistry.toggleLastUsedHighlight",environment:t,perform:e=>{const t=d().every(o.map((e=>{const t=e.getFormat();return t&&t.block_color===i})))?void 0:i;te.FH({stores:o,update:{block_color:t},transaction:e})}})},render:e=>{const t=Bi.Z.state.color;return p.createElement(et.Z,a()({},e,{color:t,shortcuts:["toggleHighlight"]}))}})]}),Hs=e=>t=>{Ee.createAndCommit({userAction:"actionRegistry.createListFormatAction",environment:t.environment,perform:o=>{te.FH({stores:t.blocks,update:{list_format:e},transaction:o})}})},zs=(0,Yi.$J)({key:"text color actions",title:nn.listFormatSection,render:e=>p.createElement(wt.Z,e),actions:[(0,Yi.PH)({key:"list format default",displayName:nn.listFormatDefault,analyticsName:nn.listFormatDefault.defaultMessage,validators:mn,closeParentMenu:!0,action:Hs(void 0)}),(0,Yi.PH)({key:"list format numbers",displayName:nn.listFormatNumbers,analyticsName:nn.listFormatNumbers.defaultMessage,validators:mn,closeParentMenu:!0,action:Hs("numbers")}),(0,Yi.PH)({key:"list format letters",displayName:nn.listFormatLetters,analyticsName:nn.listFormatLetters.defaultMessage,validators:mn,closeParentMenu:!0,action:Hs("letters")}),(0,Yi.PH)({key:"list format roman numerals",displayName:nn.listFormatRoman,analyticsName:nn.listFormatRoman.defaultMessage,validators:mn,closeParentMenu:!0,action:Hs("roman")})]}),Ws=e=>t=>{Ee.createAndCommit({userAction:"actionRegistry.createBulletListFormatAction",environment:t.environment,perform:o=>{te.FH({stores:t.blocks,update:{bullet_list_format:e},transaction:o})}})},js=(0,Yi.$J)({key:"bullet list format actions",title:nn.listFormatSection,render:e=>p.createElement(wt.Z,e),actions:[(0,Yi.PH)({key:"list format default",displayName:nn.listFormatDefault,analyticsName:nn.listFormatDefault.defaultMessage,validators:gn,closeParentMenu:!0,action:Ws(void 0)}),(0,Yi.PH)({key:"list format disc",displayName:nn.listFormatDisc,analyticsName:nn.listFormatDisc.defaultMessage,validators:gn,closeParentMenu:!0,action:Ws("disc")}),(0,Yi.PH)({key:"list format circle",displayName:nn.listFormatCircle,analyticsName:nn.listFormatCircle.defaultMessage,validators:gn,closeParentMenu:!0,action:Ws("circle")}),(0,Yi.PH)({key:"list format square",displayName:nn.listFormatSquare,analyticsName:nn.listFormatSquare.defaultMessage,validators:gn,closeParentMenu:!0,action:Ws("square")})]}),Ks=(0,Yi.PH)({key:"new page in section",displayName:nn.newPageInName,analyticsName:nn.newPageInName.defaultMessage,closeParentMenu:!0,svg:k.Z.pageEmpty,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.ff(Eo.P9("page")),Eo.XQ,Eo.wF],render:(e,t,o)=>{const{onFocus:i,onAccept:n}=o;return p.createElement(Ot,a()({},e,{title:nn.newPageInName,blocksToTransform:t.blocks,onFocus:i,onAccept:n?()=>n(Ks,t,void 0):void 0}))},action:()=>{}}),Ys=(0,Yi.MV)({key:"turn into section",displayName:nn.turnIntoName,analyticsName:nn.turnIntoName.defaultMessage,svg:k.Z.loop,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.wF,Eo.XQ,Eo.IZ],subActions:()=>[{key:0,title:void 0,render:e=>p.createElement(wt.Z,e),actions:Ps.actions}]}),Gs=(0,Yi.MV)({key:"color section",displayName:nn.colorName,analyticsName:nn.colorName.defaultMessage,svg:k.Z.blockColor,validators:hn,subActions:()=>[Us,Es,Rs]}),Xs=(0,Yi.MV)({key:"languageMode section",displayName:nn.languageModeName,analyticsName:nn.languageModeName.defaultMessage,validators:yn,subActions:()=>[Os]}),qs=(0,Yi.PH)({key:"show code",displayName:nn.showOnlyCodeFormat,analyticsName:nn.showOnlyCodeFormat.defaultMessage,svg:k.Z.codeOnly,validators:[],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;U.p({environment:o,blocks:t,previewFormat:"code"})}}),$s=(0,Yi.PH)({key:"show preview on code block",displayName:nn.showCodePreviewFormat,analyticsName:nn.showCodePreviewFormat.defaultMessage,svg:k.Z.codePreviewOnly,validators:[],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;U.p({environment:o,blocks:t,previewFormat:"preview"})}}),Js=(0,Yi.PH)({key:"show code and preview",displayName:nn.showSplitViewFormat,analyticsName:nn.showSplitViewFormat.defaultMessage,svg:k.Z.splitView,validators:[],closeParentMenu:!0,action:e=>{let{blocks:t,environment:o}=e;U.p({environment:o,blocks:t,previewFormat:"split_view"})}}),Qs=[cn({key:"toggle bold",displayName:nn.boldName,analyticsName:nn.boldName.defaultMessage,shortcuts:["toggleBold"],annotation:["b"]}),cn({key:"toggle italics",displayName:nn.italicName,analyticsName:nn.italicName.defaultMessage,shortcuts:["toggleItalics"],annotation:["i"]}),cn({key:"toggle strike",displayName:nn.strikeThroughName,analyticsName:nn.strikeThroughName.defaultMessage,shortcuts:["toggleStrike"],annotation:["s"]}),cn({key:"toggle underline",displayName:nn.underlineName,analyticsName:nn.underlineName.defaultMessage,shortcuts:["toggleUnderline"],annotation:[T.GK.Underline]})],el=(0,Yi.PH)({key:"toggle dark mode",displayName:nn.darkModeName,analyticsName:nn.darkModeName.defaultMessage,validators:[],shortcuts:["toggleDarkMode"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const o="light"===t.ThemeStore.state.mode?"dark":"light";t.device.isElectron&&Z.trackToggleThemeMode(t,{mode:o}),ze.I6(o),ze.h0(t,{mode:o,usingSystemTheme:!1})}}),tl=(0,Yi.PH)({key:"open peek view as page",displayName:nn.openAsPageName,analyticsName:nn.openAsPageName.defaultMessage,validators:[Eo.Tx],shortcuts:["commandEnter"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ai.default.peekTarget.state&&ke.navigateToBlock({environment:t,store:Ai.default.peekTarget.state})}}),ol=(0,Yi.PH)({key:"toggle all toggles",displayName:nn.openAllTogglesName,analyticsName:nn.openAllTogglesName.defaultMessage,validators:[],shortcuts:["toggleAllToggles"],closeParentMenu:!0,action:e=>{let{environment:t}=e;const o=ri.np();o&&We.X_(t,o)}}),il=(0,Yi.PH)({key:"cookie settings",displayName:S.ze.cookieSettingsLabel,analyticsName:S.ze.cookieSettingsLabel.defaultMessage,validators:[Eo.ff(Eo.tY)],closeParentMenu:!1,render:e=>n()(yt.Z,{hasDismissButton:!1,renderOrigin:t=>{const{onClick:o,...i}=e;return p.createElement(bt.Z,a()({},i,t,{title:Ro.default.formatMessage(S.ze.cookieSettingsLabel),svg:k.Z.settings,shortcuts:[]}))}}),action:()=>{}});function nl(e){return(0,Yi.PH)({key:"join or create a workspace",displayName:nn.joinOrCreateWorkspace,analyticsName:nn.joinOrCreateWorkspace.defaultMessage,svg:k.Z.squarePlus,validators:[],closeParentMenu:!0,action:t=>{let{environment:o}=t;Vi.Z.reset(),o.currentUser.id!==e?$e.x({environment:o,newCurrentUserId:e}).then((e=>{me.xN(e)})):me.xN(o)}})}function rl(e){return(0,Yi.PH)({key:"log out of a single account",displayName:nn.logOut,analyticsName:nn.logOut.defaultMessage,svg:k.Z.circleCross,validators:[],closeParentMenu:!0,action:t=>{let{environment:o}=t;const{online:i}=Pi.Z.state;i&&(se.logoutSingleAccount({environment:o,userId:e}),Z.trackSpaceSwitcherLogoutClick(o))}})}const al=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return[Eo.J5,Eo.ff(Eo.fI),Eo.ff(Eo.nJ),Eo.U7,e?Eo.or([Eo.ro("external_object_instance"),Eo.p5]):Eo.ro("external_object_instance"),Eo.ff(Eo.HB)]},sl=(0,Yi.PH)({key:"reload link preview",displayName:nn.reloadPreview,analyticsName:nn.reloadPreview.defaultMessage,svg:k.Z.sync,validators:al(!1),closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;if(0===o.length)return;const i=o[0];i.isExternalObjectInstanceBlockStore()&&qe.qK({environment:t,from:"page_more_menu",store:i,spaceId:i.getSpaceId()})}}),ll=(0,Yi.PH)({key:"reload synced page",displayName:nn.reloadSyncedPage,analyticsName:nn.reloadSyncedPage.defaultMessage,svg:k.Z.sync,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.ff(Eo.nJ),Eo.U7,Eo.ro("external_object_instance_page")],closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;if(0===o.length)return;const i=o[0];i.isExternalObjectInstancePageBlockStore()&&qe.qK({environment:t,from:"page_more_menu",store:i,spaceId:i.getSpaceId(),bypassCache:!0})}}),cl=(0,Yi.PH)({key:"turn preview into mention",displayName:nn.turnPreviewIntoMention,analyticsName:nn.turnPreviewIntoMention.defaultMessage,svg:k.Z.loop,validators:al(!0),closeParentMenu:!0,action:e=>{let{environment:t,blocks:o}=e;0!==o.length&&Ee.createAndCommit({userAction:"actionRegistry.turnPreviewIntoMention",environment:t,perform:e=>{o[0].isType("alias")?ie.az({block:o[0],transaction:e}):qe.sz({environment:t,block:o[0],transaction:e})}})}});function dl(e){return e.actions.map((t=>({...t,searchName:[e.title,t.displayName].filter(Boolean).join(" ")})))}function pl(e,t){const o=[];for(const i of e){const e=i.actions.filter(t);e.length>0&&o.push({...i,actions:e})}return o}const ul=(0,Yi.$J)({key:"mobile revision actions",render:e=>p.createElement(wt.Z,e),actions:[qn,$n]}),ml=[{key:"block in comment menu primary",render:e=>p.createElement(wt.Z,e),actions:[Mn,Xr,qr]}],gl=[{key:"code preview actions block",render:e=>p.createElement(wt.Z,a()({isTitleUppercase:!1},e)),title:Ro.default.formatMessage(nn.showCodePreviewSection),actions:[qs,$s,Js]}],hl=[{key:"page mention context menu primary",render:e=>p.createElement(wt.Z,a()({isTitleUppercase:!1},e)),actions:[$i,Ji,Qi,en,fr,hr]}],fl=[ul,{key:"block menu primary",render:e=>p.createElement(wt.Z,e),actions:[gr,Mn,xn,Zn,Ys,Ks,Kr,Fr]},{key:"block menu navigation",render:e=>p.createElement(wt.Z,e),actions:[Dr,Ts,Qi,en,$i,Ji,hr,fr,vr]},{key:"block menu secondary",render:e=>p.createElement(wt.Z,e),actions:[Gr,Xr,qr,$r,Jr,Qr,ea,Xa,Hn,zn,Ms,Cs,Ya,Ka,Ga,ja,pa,ua,ha,fa,ma,ga,sl,cl,ll,gs,On]},{key:"block menu comment",render:e=>p.createElement(wt.Z,e),actions:[Yr,ta]},{key:"block menu color",render:e=>p.createElement(wt.Z,a()({},e,{topBorder:!0})),actions:[Gs,_s]},{key:"code block menu style",render:e=>p.createElement(wt.Z,e),actions:[_a,Xs,Ma]},{key:"block menu quote",render:e=>p.createElement(wt.Z,e),actions:[Ia]},{key:"block menu number",render:e=>p.createElement(wt.Z,e),actions:[Pa]},{key:"block menu bullet",render:e=>p.createElement(wt.Z,e),actions:[xa]},{key:"block alignment",render:e=>p.createElement(wt.Z,e),actions:[Za]}],vl=[ul,{key:"outliner primary actions",render:e=>p.createElement(wt.Z,e),actions:[Dn,Tn,An,On,Un,xn,En,Rn,hr,fr,vr,Dr,Hn]},{key:"outliner move actions",render:e=>p.createElement(wt.Z,e),actions:[gs]},{key:"turn page into teamspace or wiki",render:e=>p.createElement(wt.Z,e),actions:[Nn,Ln,fs]}],yl=[{key:"outliner bulk primary actions",render:e=>p.createElement(wt.Z,e),actions:[]},{key:"outliner bulk move actions",render:e=>p.createElement(wt.Z,e),actions:[gs]}],bl=(0,Yi.$J)({key:"pageHistory",render:e=>p.createElement(wt.Z,e),actions:[Oa,Jn,ws,ii.pageAnalyticsMenu,ks,Tn]}),Sl=((0,Yi.$J)({key:"slack actions",render:e=>p.createElement(wt.Z,e),actions:[Sa,wa,ka,Ca]}),function(e){return[aa,Aa,ul,(0,Yi.$J)({key:"topbar move or turn into actions",render:e=>p.createElement(wt.Z,e),actions:[vs,gs]}),(0,Yi.$J)({key:"topbar database edit lock",render:e=>p.createElement(wt.Z,e),actions:[pa,ua,ha,fa,ma,ga,bs]}),(0,Yi.$J)({key:"topbar page edit lock",render:e=>p.createElement(wt.Z,e),actions:[ya,ca,da]}),(0,Yi.$J)({key:"topbar primary actions",render:e=>p.createElement(wt.Z,e),actions:[On,Un,Br,yr,In,Bn,En,kr,Cr,Ir,Pr,ps,Fr]}),bl,(0,Yi.$J)({key:"topbar import actions",render:e=>p.createElement(wt.Z,e),actions:[us,ds,ja]}),oi(e)]}),wl=[(0,Yi.$J)({key:"page",render:e=>p.createElement(wt.Z,e),actions:[wr,Xn,Hr,Lr,Vr,Nr,Ar,fr,Er,Rr,Or,ps,il]})],kl=[(0,Yi.$J)({key:"page",render:e=>p.createElement(wt.Z,e),actions:[br,Lr,Vr,Nr,Ar,fr,Er,Rr]}),(0,Yi.$J)({key:"user",render:e=>p.createElement(wt.Z,e),actions:[Or,Ur]}),(0,Yi.$J)({key:"report page actions",render:e=>p.createElement(wt.Z,e),actions:[ps,il]})],Cl=(0,Yi.PH)({key:"insert column left",displayName:nn.simpleTableInsertColumnLeft,analyticsName:nn.simpleTableInsertColumnLeft.defaultMessage,svg:k.Z.arrowLeft,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.z2],shortcuts:[],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.insertColumnLeft",environment:t,perform:e=>{Ie.uM({environment:t,transaction:e})}})}}),_l=(0,Yi.PH)({key:"insert column right",displayName:nn.simpleTableInsertColumnRight,analyticsName:nn.simpleTableInsertColumnRight.defaultMessage,svg:k.Z.arrowRight,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.z2],shortcuts:[],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.insertColumnRight",environment:t,perform:e=>{Ie.xy({environment:t,transaction:e})}})}}),Ml=(0,Yi.PH)({key:"duplicate columns",displayName:nn.duplicateName,analyticsName:nn.duplicateName.defaultMessage,svg:k.Z.duplicate,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.z2],shortcuts:["duplicate"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.duplicateColumns",environment:t,perform:e=>{Ie.Hh({transaction:e})}})}}),Tl=(0,Yi.PH)({key:"delete columns",displayName:nn.deleteName,analyticsName:nn.deleteName.defaultMessage,svg:k.Z.trash,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.OT,Eo.z2],shortcuts:["delete","backspace"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.deleteColumns",environment:t,perform:e=>{Ie.ih({environment:t,transaction:e})}}),Ie.MO()}}),Il=(0,Yi.PH)({key:"clear column contents",displayName:nn.simpleTableClearContents,analyticsName:nn.simpleTableClearContents.defaultMessage,svg:k.Z.clearInput,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.z2],shortcuts:[],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.clearColumnContents",environment:t,perform:e=>{Ie.WO({environment:t,transaction:e})}}),Ie.MO()}}),Pl=(0,Yi.MV)({key:"set column color",displayName:nn.colorName,analyticsName:nn.colorName.defaultMessage,svg:k.Z.blockColor,validators:fn,subActions:()=>[{key:0,title:Ro.default.formatMessage(nn.textColorSection),render:e=>p.createElement(wt.Z,e),actions:Ds.actions},{key:1,title:Ro.default.formatMessage(nn.backgroundColorSection),render:e=>p.createElement(wt.Z,e),actions:As.actions}]}),xl=(0,Yi.PH)({key:"insert row above",displayName:nn.simpleTableInsertRowAbove,analyticsName:nn.simpleTableInsertRowAbove.defaultMessage,svg:k.Z.arrowUp,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.EJ],shortcuts:[],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.insertRowAbove",environment:t,perform:e=>{Ie.co({environment:t,transaction:e})}})}}),Bl=(0,Yi.PH)({key:"insert row below",displayName:nn.simpleTableInsertRowBelow,analyticsName:nn.simpleTableInsertRowBelow.defaultMessage,svg:k.Z.arrowDown,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.EJ],shortcuts:[],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.insertRowBelow",environment:t,perform:e=>{Ie.Qs({environment:t,transaction:e})}})}}),Zl=(0,Yi.PH)({key:"duplicate rows",displayName:nn.duplicateName,analyticsName:nn.duplicateName.defaultMessage,svg:k.Z.duplicate,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.EJ],shortcuts:["duplicate"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.duplicateRows",environment:t,perform:e=>{Ie.Fi({environment:t,transaction:e})}})}}),El=(0,Yi.PH)({key:"delete rows",displayName:nn.deleteName,analyticsName:nn.deleteName.defaultMessage,svg:k.Z.trash,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.W3,Eo.EJ],shortcuts:["delete","backspace"],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.deleteRows",environment:t,perform:e=>{Ie.M5({transaction:e})}}),Ie.MO()}}),Rl=(0,Yi.PH)({key:"clear row contents",displayName:nn.simpleTableClearContents,analyticsName:nn.simpleTableClearContents.defaultMessage,svg:k.Z.clearInput,validators:[Eo.J5,Eo.ff(Eo.fI),Eo.W5,Eo.EJ],shortcuts:[],closeParentMenu:!0,action:e=>{let{environment:t}=e;Ee.createAndCommit({userAction:"actionRegistry.clearRowContents",environment:t,perform:e=>{Ie.WO({environment:t,transaction:e})}}),Ie.MO()}}),Al=(0,Yi.MV)({key:"set row color",displayName:nn.colorName,analyticsName:nn.colorName.defaultMessage,svg:k.Z.blockColor,validators:vn,subActions:()=>[{key:0,title:Ro.default.formatMessage(nn.textColorSection),render:e=>p.createElement(wt.Z,e),actions:Ls.actions},{key:1,title:Ro.default.formatMessage(nn.backgroundColorSection),render:e=>p.createElement(wt.Z,e),actions:Fs.actions}]}),Dl=[(0,Yi.$J)({key:"column section",render:e=>p.createElement(wt.Z,e),actions:[qa,Pl,Cl,_l,Ml,Il,Tl]}),(0,Yi.$J)({key:"row section",render:e=>p.createElement(wt.Z,e),actions:[$a,Al,xl,Bl,Zl,Rl,El]})],Fl=[...[{key:"mentionPerson",title:nn.mentionPersonTitle,thumbnail:f.Z.images.blocks.mentionPersonPng,description:nn.mentionPersonDescription,tooltipPhoto:f.Z.images.tooltips.blocks.mentionPersonPng,action:e=>{let{environment:t}=e;ce.lZ(t,{user:!0,bot:!1,date:!1,page:!1,createPage:!1,reminder:!1,templateVariable:!0,group:!1})}},{key:"mentionPage",title:nn.mentionPageTitle,thumbnail:f.Z.images.blocks.mentionPagePng,description:nn.mentionPageDescription,tooltipPhoto:f.Z.images.tooltips.blocks.mentionPagePng,action:e=>{let{environment:t}=e;ce.lZ(t,{user:!1,bot:!1,date:!1,reminder:!1,page:!0,createPage:!1,templateVariable:!1,group:!1})}},{key:"dateOrReminder",title:nn.dateOrReminderTitle,thumbnail:f.Z.images.blocks.mentionDatePng,description:nn.dateOrReminderDescription,tooltipPhoto:f.Z.images.tooltips.blocks.mentionTimePng,action:e=>{let{environment:t}=e;ce.lZ(t,{user:!1,bot:!1,date:!0,reminder:!0,page:!1,createPage:!1,templateVariable:!0,group:!1})}}].map((e=>(0,Yi.PH)({key:`insert ${e.key}`,displayName:e.title,analyticsName:"Insert mention",render:t=>p.createElement(ht,a()({},t,{title:Ro.default.formatMessage(e.title),thumbnail:e.thumbnail,tooltipPhoto:e.tooltipPhoto,description:Ro.default.formatMessage(e.description),format:ht.Format.Insert})),validators:[Eo.YZ],closeParentMenu:!0,action:t=>{let{environment:o}=t;return e.action({environment:o})},nativeRender:t=>({thumbnail:e.thumbnail})}))),(0,Yi.PH)({key:"insert emoji",displayName:nn.insertEmojiTitle,analyticsName:nn.insertEmojiTitle.defaultMessage,validators:[Eo.YZ],closeParentMenu:!0,render:e=>p.createElement(ht,a()({},e,{title:Ro.default.formatMessage(nn.insertEmojiTitle),description:Ro.default.formatMessage(nn.insertEmojiDescription),thumbnail:f.Z.images.blocks.inlineEmojiPng,tooltipPhoto:f.Z.images.tooltips.blocks.inlineEmojiPng,format:ht.Format.Insert})),action:e=>{let{environment:t}=e;return $.jZ(t)},nativeRender:e=>({thumbnail:f.Z.images.blocks.inlineEmojiPng})}),(0,Yi.PH)({key:"insert inline equation",displayName:nn.insertInlineEquationTitle,analyticsName:nn.insertInlineEquationTitle.defaultMessage,fuzzySearchKeywords:nn.insertInlineEquationKeywords,validators:[Eo.YZ],closeParentMenu:!0,render:e=>p.createElement(ht,a()({},e,{title:Ro.default.formatMessage(nn.insertInlineEquationTitle),description:Ro.default.formatMessage(nn.insertInlineEquationDescription),thumbnail:f.Z.images.blocks.inlineEquationPng,tooltipPhoto:f.Z.images.tooltips.blocks.inlineEquationPng,format:ht.Format.Insert})),action:e=>{let{environment:t}=e;return J.qn({environment:t,analyticsFrom:"slash_menu"})},nativeRender:e=>({thumbnail:f.Z.images.blocks.inlineEquationPng})})];function Ll(){const{currentUserSettingsStore:e}=ro.default.state;if(!e)return[];const t=(0,ci.e2)(e);if(!("number"==typeof t&&t<7))return[];switch(xi.default.getEligibleGroup({experimentId:"suggested_section_slash_menu",defaultGroup:"control"})){case"with_ai":const{actions:e}=(0,Ki.JX)(),t=(0,Yi.$J)({key:"more actions",render:e=>p.createElement(wt.Z,e),actions:e.slice(1)});return d().compact([(0,Ki.NZ)({prompt:{...mi.It,requiresContent:!1},validators:Ki.vE,type:"cursor",from:"slash_menu"}),...gi.gu.map((e=>un(e,"slash_menu",{format:mt.TurnInto}))),(0,Yi.MV)({key:"more",displayName:nn.more,analyticsName:"Completions - more",validators:Ki.vE,svg:()=>n()(Ki.nX,{}),subActions:()=>[t],collapseSubActionsIntoParent:!0})]);case"without_ai":return d().compact([...[...gi.gu,gi.Hc[v.Ti.embed]].map((e=>un(e,"slash_menu",{format:mt.TurnInto})))]);case"control":default:return[]}}function Vl(e){return new h.Z((()=>{const t=e.isMobileNative?[]:["control"!==xi.default.getEligibleGroup({experimentId:"suggested_section_slash_menu",defaultGroup:"control"})?(0,Yi.$J)({key:"suggested",title:nn.suggestedSlashMenuSection,render:e=>p.createElement(wt.Z,a()({},e,{title:n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()("div",{},void 0,p.createElement(B.FormattedMessage,nn.suggestedSlashMenuSection)))})),actions:Ll()}):(0,Ki.w_)()],o=(i=t,[...i,(0,Yi.$J)({key:"Insert Basic Blocks",title:nn.basicBlocksSection,render:e=>p.createElement(wt.Z,e),actions:gi.c2.map((e=>un(e,"slash_menu")))}),(0,Yi.$J)({key:"Insert Media",title:nn.mediaSection,render:e=>p.createElement(wt.Z,e),actions:gi.iy.map((e=>un(e,"slash_menu")))}),(0,Yi.$J)({key:"Insert Database New",title:nn.databaseSection,render:e=>p.createElement(wt.Z,e),actions:gi.dd.map((e=>un(e,"slash_menu")))}),(0,Yi.$J)({key:"Insert AI Blocks",title:nn.aiBlocksSection,render:e=>p.createElement(wt.Z,e),actions:gi.D8.map((e=>un(e,"slash_menu",void 0,Ki.Ll)))}),(0,Yi.$J)({key:"Insert Advanced Blocks",title:nn.advancedBlocksSection,render:e=>p.createElement(wt.Z,e),actions:gi.ER.map((e=>un(e,"slash_menu")))}),(0,Yi.$J)({key:"Insert Inline",title:nn.inlineSection,render:e=>p.createElement(wt.Z,e),actions:Fl}),(0,Yi.$J)({key:"Insert Embeds",title:nn.embedsSection,render:e=>p.createElement(wt.Z,e),actions:(0,gi.iO)().map((e=>un(e,"slash_menu")))}),(0,Yi.$J)({key:"Insert Synced Databases",title:nn.syncedDatabasesSection,render:e=>p.createElement(wt.Z,e),actions:gi.KT.state.map((e=>un(e,"slash_menu")))})]);var i;var r,s;return{insertActions:o,slashActions:(r=o,[...r,Ps,(0,Yi.$J)({key:"slash actions",title:nn.actionsSection,render:e=>p.createElement(wt.Z,e),actions:(s=pl(fl,(e=>!(e.subActions||"string"==typeof e.key&&e.key.match(/new page in section/)))),s.reduce(((e,t)=>[...e,...t.actions]),[]))}),Es,Rs])}}),{debugName:"insertAndSlashActionsStore"})}const Nl=Vl({isMobileNative:!1}),Ol=Vl({isMobileNative:!0});const Ul=(0,Yi.PH)({key:"toggle recording input latency",displayName:nn.toggleRecordingInputLatencyName,analyticsName:nn.toggleRecordingInputLatencyName.defaultMessage,validators:[],shortcuts:["toggleRecordingInputLatency"],closeParentMenu:!0,action:()=>{u.toggleRecordingInputLatency()}}),Hl=[ol,Wn,jn,Mn,xn,Gr,Da,Fa,La,Qi,en,Jr,Qr,ea,Xr,qr,$r,Hn,zn,Yr,ta,qn,$n,Jn,Qn,Xn,ar,sr,cr,lr,pr,dr,Wr,jr,ur,mr,zr,er,tr,or,ir,nr,rr,hr,gr,fr,Dr,Ja,Qa,es,is,ns,ts,os,_r,Mr,Tr,rs,gs,Ss,as,ss,Br,Zr,ms,tn,on,Va,Ha,Ua,za,Wa,Ts,Ms,Cs,ja,us,Ka,Ya,Ga,_a,ls,cs,el,tl,va,Ma,Ul,Na,Kn,Yn,Gn,Fr,...Qs,...dl(Ps),...dl(Es),...dl(Rs),...dl(Os),...dl(Us),...dl(Zs)]},7512:(e,t,o)=>{o.d(t,{A:()=>g,t:()=>h});var i=o(5366),n=o(33929),r=o(79315),a=o(39218),s=o(50906),l=o(54642),c=o(47307),d=o(92625),p=o(97977),u=o(9953);const m=(0,i.defineMessages)({deletingAccount:{id:"accountActions.deletingAccount.loadingMessage",defaultMessage:"Deleting your account…"},noUserError:{id:"accountActions.deletingAccount.noUserToDeleteMessage",defaultMessage:"No account to delete."}}),g=function(e){const{userStore:t,data:o,transaction:i}=e,n={};"name"in o&&o.name&&(n.name=o.name),"profilePhoto"in o&&(n.profile_photo=o.profilePhoto),0!==Object.keys(n).length&&u.sW({store:t,data:n,transaction:i})};async function h(e){d.j({message:m.deletingAccount});const t=e.currentUser.id,{currentUserRootStore:o,currentUserStore:i}=r.default.state;if(!o||!i||!t)return d.x(),void c.showErrorMessage(n.default.formatMessage(m.noUserError));s.trackDeleteUser(e),await l.deleteUser(e,{}),await a.transactionQueue.clearForUser(t),p.logoutSingleAccount({environment:e,userId:t}),d.x()}},16287:(e,t,o)=>{o.d(t,{A:()=>l,h:()=>c});var i=o(96486),n=o.n(i),r=o(89837),a=o(98459),s=o(54642);async function l(e,t){const{store:o,activityIds:i,spaceId:r,filterActivityTypes:l,filterDateRange:c,navigableBlockId:p,collectionId:u}=t,m=n().first(i),g=await s.getActivityLog(e,{spaceId:r,navigableBlock:p?{id:p,spaceId:(0,a.CG)(void 0)}:void 0,collection:u?{id:u,spaceId:(0,a.CG)(void 0)}:void 0,endingBeforeId:m,limit:20,activityTypes:l,...d(c)});if("failed"===g.type)throw g.error;const h=g.data.activityIds;o.update((e=>({...e,shouldLoadNewerActivities:!1,activityIds:h.concat(i)})))}async function c(e,t){const{store:o,activityIds:i,spaceId:r,filterActivityTypes:l,filterDateRange:c,navigableBlockId:p,collectionId:u}=t,m=n().last(i),g=await s.getActivityLog(e,{spaceId:r,navigableBlock:p?{id:p,spaceId:(0,a.CG)(void 0)}:void 0,collection:u?{id:u,spaceId:(0,a.CG)(void 0)}:void 0,startingAfterId:m,limit:20,activityTypes:l,...d(c)});if("failed"===g.type)throw g.error;const h=g.data.activityIds;o.update((e=>({...e,shouldLoadOlderActivities:!1,activityIds:i.concat(h),hasOlderActivities:h.length>=20})))}function d(e){var t,o;const i=null!==(t=e.ending)&&void 0!==t&&t.start_date?r.OQ.isoToUnixMs(e.ending.start_date):void 0;return{startingAfterTimeMs:null!==(o=e.starting)&&void 0!==o&&o.start_date?r.OQ.isoToUnixMs(e.starting.start_date):void 0,endingBeforeTimeMs:i?r.Xz({date:i,daysToAdd:1}):void 0}}},77671:(e,t,o)=>{o.d(t,{N:()=>p,B:()=>u});var i=o(12955),n=o(34809),r=o(15517),a=o(39218),s=o(47307),l=o(97977),c=o(5978);function d(e,t,o){return(0,n.Z)({environment:e,url:`/__admin/${t}`,method:"POST",data:o,format:"json"})}async function p(e,t){return d(e,"loginAsUser",t)}async function u(e){if(!(await i.getGhostAdminUserId(e)))return void l.actuallyLogoutAndDeleteAllLocalData(e);if("success"===(await async function(e,t){return d(e,"logoutAsUser",t)}(e,{})).type){const t=e.currentUser.id;return t&&(await a.transactionQueue.clearForUser(t),r.ZL(t)),c.navigate({environment:e,url:"/__admin"}),void location.reload()}s.showMessage({message:"There was an issue logging back in to your admin account. Logging out fully.",onAccept:()=>{l.actuallyLogoutAndDeleteAllLocalData(e)}})}},52229:(e,t,o)=>{o.d(t,{k:()=>p});var i=o(41432),n=o(4615),r=o(21202),a=o(70279),s=o(95477),l=o(98165),c=o(3815),d=o(9953);function p(e){const{environment:t,parentBlock:o,targetStore:p,transaction:u}=e;if(!p.isDefined())throw new Error("Target store was not defined.");if(!o.isDefined())throw new Error("Parent block store was not defined.");const m=(0,n.ZP)(),g=p instanceof c.G;let h;if(!g){if(l.Dg(p)&&p.isDefined()){const e=p.getParentStore(),t=null==e?void 0:e.getParentStore();var f;if(null!=e&&e.isDefined())h=null==t||null===(f=t.getModel())||void 0===f?void 0:f.getRenderUrl({getRecordModel:p.getRecordModel,baseUrl:s.Z.domainBaseUrl,discussionId:e.id})}}const v={id:m,type:i.Ti.alias,format:{alias_pointer:{table:g?r.iU:a.x_,id:p.id,spaceId:p.getSpaceId()},comment_alias_url:h},parent_id:o.id,parent_table:"block",alive:!0,space_id:o.getSpaceId()};return d.ae({environment:t,table:"block",value:v,inMemoryRecordCache:o.inMemoryRecordCache,transaction:u}),c.G.createChildStore(o.getContentStore(),{table:r.iU,id:m,spaceId:o.getSpaceId()})}},50906:(e,t,o)=>{o.r(t),o.d(t,{identifyNewUser:()=>N,identifyCurrentUser:()=>O,deidentifyCurrentUser:()=>U,trackExperimentExposure:()=>H,trackDownloadDesktopApp:()=>z,trackDownloadMobileApp:()=>W,trackDownloadiOSApp:()=>j,trackDownloadAndroidApp:()=>K,trackDownloadWebClipper:()=>Y,trackConfirmSignupInput:()=>G,trackClickLink:()=>X,trackBrowseMoreTemplatesLink:()=>q,trackToggleTemplateSection:()=>$,trackOpenTypeform:()=>J,trackFrontTogglePricingTerm:()=>Q,trackScroll:()=>ee,trackFrontPageReferralSignupClick:()=>te,trackPageVisit:()=>oe,trackPartnerStackPartnerId:()=>ie,trackVisit:()=>ne,trackDatabaseVisit:()=>re,trackTypeAggregatedDatabaseVisit:()=>ae,trackPageVisitWithRelationToSyncedDatabase:()=>se,trackDatabaseVisitWithRelationToSyncedDatabase:()=>le,trackPageError:()=>ce,trackReorderWorkspaces:()=>de,trackMultiAccountAddOrCreateAccount:()=>pe,trackContentClassificationProceed:()=>ue,trackOnboardingDialogError:()=>me,trackOnboardingError:()=>ge,trackOnboardingShow:()=>he,trackOnboardingCopyLinkInvite:()=>fe,trackOnboardingClose:()=>ve,trackOnboardingSkip:()=>ye,trackOnboardingInviteSend:()=>be,trackOnboardingUploadSpaceIcon:()=>Se,trackOnboardingStage:()=>we,trackOnboardingDebugStageRender:()=>ke,trackServersideOnboarding:()=>Ce,trackOnboardingJoinSpaceClick:()=>_e,trackOnboardingInviteClick:()=>Me,trackOnboardingInviteAttempt:()=>Te,trackOnboardingUploadProfilePhoto:()=>Ie,trackOnboardingJoinSpace:()=>Pe,trackOnboardingCreateSpace:()=>xe,trackOnboardingPlanTypeSelect:()=>Be,trackOnboardingPersonaSelect:()=>Ze,trackOnboardingRoleSelect:()=>Ee,trackOnboardingUseCasesSelect:()=>Re,trackOnboardingCompanySizeSelect:()=>Ae,trackOnboardingCompanySurveyAction:()=>De,trackOnboardingPersonaSurveyAction:()=>Fe,trackNotionTopbarClickEvent:()=>Le,trackOnboardingUserTypeSelect:()=>Ve,trackGettingStartedPageCreate:()=>Ne,trackOnboardingComplete:()=>Oe,trackOnboardingTooltipsComplete:()=>Ue,trackProjManagementOnboardingTooltipShow:()=>He,trackProjManagementOnboardingTooltipDismiss:()=>ze,trackOnboardingTeamInviteEmailEntered:()=>We,trackOnboardingTeamInviteAddMoreClicked:()=>je,trackOnboardingBulkInvitesRendered:()=>Ke,trackLandingPageVisit:()=>Ye,trackCustomerIoInAppCalloutShow:()=>Ge,trackCustomerIoInAppCalloutSuppress:()=>Xe,trackCustomerIoInAppCalloutDismiss:()=>qe,trackCustomerIoInAppCalloutError:()=>$e,trackPersonaCollectionStep:()=>Je,trackPersonaCollectionAction:()=>Qe,trackClickImportButton:()=>et,trackImportSourceAuth:()=>tt,trackImportSourceInput:()=>ot,trackOpenImportModal:()=>it,trackAuthIntegration:()=>nt,trackIntegrationSelectAll:()=>rt,trackIntegrationDeselectAll:()=>at,trackIntegrationSelectItem:()=>st,trackIntegrationDeselectItem:()=>lt,trackImportIntegration:()=>ct,trackRemoveIntegration:()=>dt,trackPromptAuthIntegration:()=>pt,trackOpenGoogleDriveFilePicker:()=>ut,trackPickGoogleDriveFile:()=>mt,trackEmbedGoogleDriveFile:()=>gt,trackUrlPaste:()=>ht,trackLinkEditAction:()=>ft,trackLinkTitleEditAction:()=>vt,trackPricingGridButtonClick:()=>yt,trackContactSalesClick:()=>bt,trackAddOnDiscountPopupSeen:()=>St,trackAddOnDiscountPopupDismissed:()=>wt,trackSubscriptionUpgradeModalOpen:()=>kt,trackSubscriptionUpgradeModalBillingIntervalUpdated:()=>Ct,trackSubscriptionUpgradeModalAddOnFeaturesUpdated:()=>_t,trackSubscriptionUpgradeModalApplyCreditUpdated:()=>Mt,trackSubscriptionUpgradeModalUpgradeAccepted:()=>Tt,trackCreditsInputToggled:()=>It,trackUpgradeSubscriptionClick:()=>Pt,trackUpgradeSubscriptionFailed:()=>xt,trackUpgradeSubscriptionFailedPayment:()=>Bt,trackSubscriptionUpgradeModalPaymentMethodUpdated:()=>Zt,trackSubscriptionUpgradeModalAddressFormUpdated:()=>Et,trackSubscriptionUpgradeModalDismissed:()=>Rt,trackStripeErrorMessage:()=>At,trackCouponCodeEntered:()=>Dt,trackCreateSubscription:()=>Ft,trackSubscriptionChanged:()=>Lt,trackSubscriptionUpdatePlan:()=>Vt,trackSubscriptionUpdateBilling:()=>Nt,trackEnterpriseSalesContact:()=>Ot,trackEnterpriseSalesContactOpened:()=>Ut,trackEnterpriseSalesContactDismissed:()=>Ht,trackEnterpriseSalesContactUpdated:()=>zt,trackSubscriptionApplyCredit:()=>Wt,trackCancelSubscription:()=>jt,trackChurnSurvey:()=>Kt,trackDeleteWorkspaceAttempt:()=>Yt,trackChurnSurveyClose:()=>Gt,trackClickUpgradeInfoButton:()=>Xt,trackPlanCtaClick:()=>qt,trackApproachingBlockLimit:()=>$t,trackReachBlockLimit:()=>Jt,trackClickTeamTryForFree:()=>Qt,trackClickTeamCancelPlan:()=>eo,trackWorkspaceInviteCopyLink:()=>to,trackCurrentlySubscribed:()=>oo,trackPlansEarnCreditClick:()=>io,trackReferralInvite:()=>no,trackReferralTweetClick:()=>ro,trackReferralCopyLinkClick:()=>ao,trackActivateReferral:()=>so,trackApplyCreditClick:()=>lo,trackCreditItemActionClick:()=>co,trackInvitedByCreditClick:()=>po,trackTimelineWarningClick:()=>uo,trackTimelineWarningCloseClick:()=>mo,trackTimelineWarningShow:()=>go,trackSidebarPromoClick:()=>ho,trackInvitedByCreditCloseClick:()=>fo,trackSidebarPromoCloseClick:()=>vo,trackStudentPlanPromptClick:()=>yo,trackStudentPlanPromptCloseClick:()=>bo,trackSidebarCreateAccountPromptClick:()=>So,trackSidebarCreateAccountPromptCloseClick:()=>wo,trackOnboardingDesktopAppDownloadClick:()=>ko,trackCreateBlock:()=>_o,trackOpenPeekAsPage:()=>Mo,trackPeekArrowNavigation:()=>To,trackCloseSidePeek:()=>Io,trackTeamWorkspaceCTAAccountSwitcherClick:()=>Po,trackSelectTemplate:()=>xo,trackDesktopAppSignupBrowserVisit:()=>Bo,trackTemplateModalPersonaSelection:()=>Zo,trackTemplateModalOpen:()=>Eo,trackTemplateModalItemClick:()=>Ro,trackGetTemplateClick:()=>Ao,trackTemplateModalAccept:()=>Do,trackCreateCollectionTemplate:()=>Fo,trackActivateCollectionTemplate:()=>Lo,trackCollectionTemplateAction:()=>Vo,trackEditBlockText:()=>No,trackTodoBlockCheck:()=>Oo,trackToggleBlockToggle:()=>Uo,trackEmbedBlockAction:()=>Ho,trackEmbedBlockResize:()=>zo,trackEquationBlockEdit:()=>Wo,trackBlockAction:()=>jo,trackOpenBlockMenu:()=>Ko,trackOpenBlockMenuUnderTeam:()=>Yo,trackOpenSlashMenu:()=>Go,trackDownloadFile:()=>Xo,trackFileOpenAttempt:()=>qo,trackDuplicateTemplate:()=>$o,trackDuplicateTemplateAttempt:()=>Jo,trackOpenEmbedMenu:()=>Qo,trackEmbedMenuSelection:()=>ei,trackUrlTurnedBookmark:()=>ti,trackEmbedType:()=>oi,trackEmbedRender:()=>ii,trackEmbedClientError:()=>ni,trackConfigureTemplateButton:()=>ri,trackChangeFontType:()=>ai,trackChangeFontSize:()=>si,trackChangePageWidth:()=>li,trackClickAddMenu:()=>ci,trackMoveTo:()=>di,trackMoveToMenuOpen:()=>pi,trackAddEditorPermissionToEnsureUndoMove:()=>ui,trackEditLockToggle:()=>mi,trackRichTextMenuClick:()=>gi,trackUpdatePageSectionVisibility:()=>hi,trackExpandBlock:()=>fi,trackChangeTableWrap:()=>vi,trackCollectionItemEditModeEnter:()=>yi,trackDeleteNewlyCreatedBoardItem:()=>bi,trackEditBlockProperty:()=>Si,trackClickBlockPropertyUrl:()=>wi,trackCreateProperty:()=>ki,trackConfigureProperty:()=>Ci,trackDeleteProperty:()=>_i,trackCreateView:()=>Mi,trackConfigureView:()=>Ti,trackCollectionsOpenPeekModePicker:()=>Ii,trackPageOpenPeekModePicker:()=>Pi,trackCollectionsUpdatePeekModeFormat:()=>xi,trackPageUpdatePeekModeFormat:()=>Bi,trackViewSettings:()=>Zi,trackDeleteView:()=>Ei,trackCollectionActionBarClick:()=>Ri,trackCollectionSearch:()=>Ai,trackOpenCollectionViewSelect:()=>Di,trackOpenCollectionAsPage:()=>Fi,trackCollectionNoDateMenuAdd:()=>Li,trackCollectionNoDateMenuView:()=>Vi,trackRelationDatabaseClick:()=>Ni,trackTimelineView:()=>Oi,trackTimelineZoomLevelUpdate:()=>Ui,trackTimelineTodayClick:()=>Hi,trackTimelineShiftTimeClick:()=>zi,trackTimelineToggleTableClick:()=>Wi,trackTimelineItemScrollArrowClick:()=>ji,trackTimelineItemResize:()=>Ki,trackTimelineDependencyArrowDrawn:()=>Yi,trackTimelineDependencyArrowDeleted:()=>Gi,trackTableSubitemToggleOpen:()=>Xi,trackTableSubitemToggleClose:()=>qi,trackTableSubItemCreate:()=>$i,trackInlineCollectionLoadMoreClick:()=>Ji,trackRelationShowAs:()=>Qi,trackRelationReorder:()=>en,trackRelationAddBlock:()=>tn,trackRelationRemoveBlock:()=>on,trackRelationCreateBlock:()=>nn,trackRelationCustomizeDisplayedProperties:()=>rn,trackRelationSectionLinkButton:()=>an,trackRelationNavigateBlock:()=>sn,trackRelationUpdatePropertyVisibility:()=>ln,trackConfigureRollupRelation:()=>cn,trackConfigureRollupTargetProperty:()=>dn,trackConfigureRollupAggregation:()=>pn,trackCollectionTableDragAndFill:()=>un,trackCreateSpace:()=>mn,trackJoinSpace:()=>gn,trackLeaveSpace:()=>hn,trackDeleteSpace:()=>fn,trackEditorDrag:()=>vn,trackEditorClickSelectionMenu:()=>yn,trackOpenMentionMenu:()=>bn,trackInsertMentionFromMentionMenu:()=>Sn,trackMentionMenuAbandon:()=>wn,trackMentionUser:()=>kn,trackMentionGroup:()=>Cn,trackHoverMentionGroup:()=>_n,trackMentionDate:()=>Mn,trackMentionPage:()=>Tn,trackInlineEquationEdit:()=>In,trackSetReminder:()=>Pn,trackResizeColumn:()=>xn,trackResetColumnSizes:()=>Bn,trackCreateColumnList:()=>Zn,trackInsertColumn:()=>En,trackEditorDragNearEdgeScroll:()=>Rn,trackTransformTextBlockFilter:()=>An,trackUnicodeFilter:()=>Dn,trackAnnotationFilter:()=>Fn,trackKeyboardAnnotation:()=>Ln,trackLinkFilter:()=>Vn,trackEmailInvite:()=>Nn,trackUpdateEmail:()=>On,trackUpdatePagePermission:()=>Un,trackUpdateSpacePermission:()=>zn,trackUpdateTeamPermission:()=>Wn,trackTeamRoleUpdateForIndividualUser:()=>jn,trackConvertGuestToMember:()=>Kn,trackRemoveGuest:()=>Yn,trackPermissionGroupCreate:()=>Gn,trackPermissionsSettingsTabClick:()=>Xn,trackPermissionGroupRename:()=>qn,trackPermissionGroupSetIcon:()=>$n,trackPermissionGroupAddMembers:()=>Jn,trackPermissionGroupRemoveMember:()=>Qn,trackPermissionGroupDelete:()=>er,trackPermissionGroupReorder:()=>tr,trackToggleAllowSearchEngineIndexing:()=>or,trackSetExpirationTimeOnPublicPage:()=>ir,trackToggleAllowDuplicate:()=>nr,trackRestrictPermissions:()=>rr,trackRestorePermissions:()=>ar,trackSetDatabaseSyncPermissions:()=>sr,trackWidenPermission:()=>lr,trackRequestAccess:()=>cr,trackGrantAccess:()=>dr,trackChangeGrantAccessLevel:()=>pr,trackIgnoreAccessRequest:()=>ur,trackToggleRequestAccessSecuritySetting:()=>mr,trackInviteTyped:()=>gr,trackInviteSelectTarget:()=>hr,trackInviteChangeRole:()=>fr,trackAbandonPermissionsInvite:()=>vr,trackOpenShareWorkspaceInvite:()=>yr,trackClickShareWorkspace:()=>br,trackClickMembershipRequest:()=>Sr,trackClickViewAllRequests:()=>wr,trackResolveMembershipRequest:()=>kr,trackClickInvitePeople:()=>Cr,trackOpenGuestMembershipRequestModal:()=>_r,trackRenderGuestMembershipRequestEntryPoint:()=>Mr,trackSidebarExpand:()=>Tr,trackSidebarUnexpand:()=>Ir,trackBookmark:()=>Pr,trackUnbookmark:()=>xr,trackOpenSettings:()=>Br,trackToggleSettingsTab:()=>Zr,trackUploadProfilePhoto:()=>Er,trackNameChanged:()=>Rr,trackDeleteAccountClicked:()=>Ar,trackDeleteAccountConfirmed:()=>Dr,trackLogOutFromActiveSessions:()=>Fr,trackChangePasswordClick:()=>Lr,trackRemovePasswordClick:()=>Vr,trackLocaleChanged:()=>Nr,trackInviteLinkUpdated:()=>Or,trackAllowedEmailDomainChange:()=>Ur,trackOpenTrash:()=>Hr,trackToggleTrashTab:()=>zr,trackRestoreTrashPage:()=>Wr,trackDeleteTrashPage:()=>jr,trackOpenBreadcrumbCurrentPageMenu:()=>Kr,trackClickBreadcrumbCurrentPageScrollToTop:()=>Yr,trackClickBreadcrumbMoveTo:()=>Gr,trackOpenPageShare:()=>Xr,trackOpenPageShareInvite:()=>qr,trackOpenSpaceInvite:()=>$r,trackOpenMoreMenu:()=>Jr,trackOpenMoreConnectionsMenu:()=>Qr,trackOpenPublicMoreMenu:()=>ea,trackConfirmAppUpdate:()=>ta,trackExport:()=>oa,trackExportFailed:()=>ia,trackClickOutlinerItem:()=>na,trackCreatePageInTeam:()=>ra,trackClickOutlinerTeamNewPage:()=>aa,trackOutlinerItemToggle:()=>sa,trackOutlinerTeamToggle:()=>la,trackOutlinerSectionToggle:()=>ca,trackClickNestedChildPage:()=>da,trackClickDesktopNavigator:()=>pa,trackOpenSpaceSwitcher:()=>ua,trackSpaceSwitcherSelectSpace:()=>ma,trackSpaceSwitcherLogoutClick:()=>ga,trackToggleThemeMode:()=>ha,trackDeleteUser:()=>fa,trackOutlinerSectionPin:()=>va,trackOutlinerSectionUnpin:()=>ya,trackOpenSupportChat:()=>ba,trackClickHelp:()=>Sa,trackClickHelpItem:()=>wa,trackClickHelpButton:()=>ka,trackTapMobileActionBarItem:()=>Ca,trackActionBarScroll:()=>_a,trackOpenMobileSidebar:()=>Ma,trackTapMobileBottomBarItem:()=>Ta,trackMobileAddToMenuAccept:()=>Ia,trackMobileNavigation:()=>Pa,trackOpenNotificationSettingsFromAllUpdates:()=>xa,trackOpenAllUpdates:()=>Ba,trackOpenPageUpdates:()=>Za,trackClickUpdate:()=>Ea,trackSetPushNotification:()=>Ra,trackFollowPage:()=>Aa,trackUnfollowPage:()=>Da,trackOpenEmojiMenu:()=>Fa,trackMediaPicker:()=>La,trackIconActions:()=>Va,trackOpenBlockDiscussionMenu:()=>Na,trackOpenReplyDiscussionMenu:()=>Oa,trackCloseReplyDiscussionMenu:()=>Ua,trackOpenNewBlockDiscussion:()=>Ha,trackOpenNewInlineDiscussion:()=>za,trackCreateBlockDiscussion:()=>Wa,trackCreateInlineDiscussion:()=>ja,trackAddComment:()=>Ka,trackDeleteComment:()=>Ya,trackEditComment:()=>Ga,trackResolveDiscussion:()=>Xa,trackReopenDiscussion:()=>qa,trackClickDiscussion:()=>$a,trackAddReaction:()=>Ja,trackRemoveReaction:()=>Qa,trackOpenVersionHistory:()=>es,trackSelectSnapshot:()=>os,trackCopyFromHistory:()=>is,trackRestoreSnapshot:()=>ns,trackClickForkPage:()=>rs,trackPerformanceMetric:()=>as,trackMemoryMetric:()=>ss,trackOpenSearch:()=>ls,trackSpaceInvitationEmailClicked:()=>cs,trackSelectSearchItem:()=>ds,trackAbandonedSearch:()=>ps,trackPostSearchClickPageInteraction:()=>us,trackPostSearchClickPageExit:()=>ms,trackOfflineAccessFailure:()=>gs,trackOpenOutlinerViewAllPopover:()=>hs,trackUpdatedOutlinerViewAllPopoverSort:()=>fs,trackCopyLinkFromOutlinerViewAllPopover:()=>vs,trackCopyLinkFromPermissionsSetting:()=>ys,trackCopyWebLink:()=>bs,trackSelectPageFromOutlinerViewAllPopover:()=>Ss,trackShowWaitlistModal:()=>ws,trackJoinWaitlist:()=>ks,trackCopyReferralLink:()=>Cs,trackShareReferalAttempt:()=>_s,trackDismissWaitlistModal:()=>Ms,trackDismissNewPageSuggestedTemplates:()=>Ts,trackTransclusionContainerCopyButton:()=>Is,trackTransclusionContainerOpenBacklinks:()=>Ps,trackDeveloperIntegrationSiteVisit:()=>xs,trackDeveloperIntegrationsNewClick:()=>Bs,trackDeveloperIntegrationsFilterClick:()=>Zs,trackDeveloperIntegrationsViewVisit:()=>Es,trackDeveloperIntegrationsCreate:()=>Rs,trackDeveloperIntegrationsViewSecret:()=>As,trackDeveloperIntegrationsCopySecret:()=>Ds,trackDeveloperIntegrationsToggleType:()=>Fs,trackDeveloperIntegrationsUpdate:()=>Ls,trackDeveloperIntegrationsMyIntegrationsClick:()=>Vs,trackDeveloperIntegrationsAllIntegrationsClick:()=>Ns,trackDeveloperIntegrationsVisitDeveloperWebsiteClick:()=>Os,trackDeveloperIntegrationsContactDeveloperClick:()=>Us,trackDeveloperIntegrationsDisconnectClick:()=>Hs,trackDeveloperIntegrationsOpenCardDropdownClick:()=>zs,trackDeveloperIntegrationsDeleteClick:()=>Ws,trackDeveloperIntegrationsConfirmDeleteClick:()=>js,trackUploadAttachmentToComment:()=>Ks,trackOpenCommentsSidebar:()=>Ys,trackOpenUpdatesSidebar:()=>Gs,trackUpdatesSidebarTabClick:()=>Xs,trackInstallPublicIntegrationOauth:()=>qs,trackConnectExternalIntegration:()=>$s,trackDisconnectExternalIntegration:()=>Js,trackActivateLinkPreviewMenu:()=>Qs,trackSaveLinkPreview:()=>el,trackUpdateLinkPreview:()=>tl,trackOpenLinkPreviewHelpGuide:()=>ol,trackRemoveLinkPreviewWithError:()=>il,trackLinkPreviewUrlMiss:()=>nl,trackClickDiscoverAppsShowAll:()=>rl,trackCookieBannerShown:()=>sl,trackCookieModalShown:()=>ll,trackCouponTypeformClicked:()=>cl,trackLegacyTransclusionShow:()=>dl,trackTransactionTimestampCollision:()=>pl,trackTransactionTimestampRegression:()=>ul,trackTransactionRaceHazard:()=>ml,trackTransactionAsyncDataLoss:()=>gl,trackTransactionDeadlockWarning:()=>hl,trackTransactionTooLarge:()=>fl,trackTransactionQueueErrorShow:()=>vl,trackConnectionErrorShow:()=>yl,trackConnectionErrorDetailsShow:()=>bl,trackLowStorageErrorShow:()=>Sl,trackTransactionQueueHealthcheck:()=>wl,throttledTrackMessageStoreRemoteVersionUpdateFailure:()=>kl,trackMessageStoreRemoteVersionUpdateSuccess:()=>Cl,throttledTrackMessageStoreRequestTimeout:()=>_l,throttledTrackMessageStoreRequestSuccess:()=>Ml,trackSaveEditsErrorModalShow:()=>Tl,trackUnsavedTransactionError:()=>Il,trackOpenTeamBrowser:()=>Pl,trackCloseTeamBrowser:()=>xl,trackClearTeamBrowserSearch:()=>Bl,trackTeamBrowserHoverMemberList:()=>Zl,trackCreateTeamStart:()=>El,trackCreateTeamComplete:()=>Rl,trackEnableTeams:()=>Al,trackCloseCreateTeamModal:()=>Dl,trackAddAppsToNewTeamClick:()=>Fl,trackSelectFunctionForNewTeamClick:()=>Ll,trackInviteTeamMembers:()=>Vl,trackInviteTeamGroups:()=>Nl,trackSetDefaultTeam:()=>Ol,trackCurrentUserJoinTeam:()=>Ul,trackArchiveTeam:()=>Hl,trackTransitionToZeroTeams:()=>zl,trackRestoreTeam:()=>Wl,trackRemoveTeamMembers:()=>jl,trackRemoveTeamGroups:()=>Kl,trackChangeTeamsOrder:()=>Yl,trackChangeTeamAccessLevel:()=>Gl,trackUpdateTeamSettings:()=>Xl,trackAbandonTeamPermissionsInvite:()=>ql,trackOpenOutlinerTeamOverflow:()=>$l,trackClickOutlinerTeamOverflowOption:()=>Jl,trackClickPageOutlinerDots:()=>Ql,trackEventWithTeamData:()=>tc,trackOpenTeamHome:()=>oc,trackTeamSettingsTabClick:()=>nc,trackRestoreTeamPermissions:()=>rc,trackTeamInviteLinkConfirmationSelection:()=>ac,trackCopyTeamInviteLink:()=>sc,trackClickTeamInviteLink:()=>lc,trackRequestAccessToTeam:()=>cc,trackResolveTeamAccessRequest:()=>dc,trackAddDomainVerification:()=>pc,trackDomainVerificationAttempt:()=>uc,trackDomainVerificationSuccess:()=>mc,trackWorkspaceCreationAbilityFromOnboarding:()=>gc,trackWorkspaceCreationSettingUpdate:()=>hc,trackClaimableSpacesViewed:()=>fc,trackSpaceTransferRequested:()=>vc,trackSpaceTransferCompleted:()=>yc,trackSpaceClaimUpgradeRequested:()=>bc,trackSpaceClaimUpgradeCompleted:()=>Sc,trackSpaceClaimDeletionStarted:()=>wc,trackSpaceClaimDeletionCanceled:()=>kc,trackMoveToError:()=>Cc,trackShowUserValidationResponse:()=>_c,trackZendeskOpenMessenger:()=>Mc,trackZendeskSignup:()=>Tc,trackFullScreenAction:()=>Ic,trackAIAction:()=>Pc,trackAIBlockAction:()=>xc,trackAiAutofillAction:()=>Bc,trackAiAutofillSettingsAction:()=>Zc,trackAICompletionPopupOpen:()=>Ec,trackAICompletionPopupClose:()=>Rc,trackAICompletionPopupRetry:()=>Ac,trackAICompletionPopupHistoryNavigation:()=>Dc,trackAICompletionPopupPreviewStart:()=>Fc,trackAICompletionPopupUpdatePromptText:()=>Lc,trackAICompletionPopupPreviewEnd:()=>Vc,trackAICompletionPopupPreviewStoppedByUser:()=>Nc,trackAIDataSharingOptInSubmit:()=>Oc,trackRecurrenceMenuOpen:()=>Uc,trackRecurrenceSaved:()=>Hc,trackOverviewAnalyticsFilterChange:()=>zc,trackUserAnalyticsEngagementTimerangeFilterChange:()=>Wc,trackUserAnalyticsTableFilterChange:()=>jc,trackUserAnalyticsTableSortChange:()=>Kc,trackUserAnalyticsExportRequested:()=>Yc,trackContentAnalyticsEngagementTimerangeFilterChange:()=>Gc,trackContentAnalyticsExportRequested:()=>Xc,trackContentAnalyticsTableFilterChange:()=>qc,trackContentAnalyticsTableTimerangeFilterChange:()=>$c,trackContentAnalyticsTableSortChange:()=>Jc,trackWorkspaceAnalyticsTabClick:()=>Qc,trackSearchAnalyticsTableTimerangeFilterChange:()=>ed,trackSearchAnalyticsTableSortChange:()=>td,trackAdminContentSearchAcknowledgementConfirmed:()=>od,trackAdminContentSearchFilterChangedWithValues:()=>id,trackAdminContentSearchQueried:()=>nd,trackAdminContentSearchExportRequested:()=>rd,trackConvertToWiki:()=>ad,trackUndoWikiConversion:()=>sd,trackWikiPromoShow:()=>ld,trackWikiPromoClickLearnMore:()=>cd,trackWikiPromoDismiss:()=>dd,trackVerificationPropertyButtonClick:()=>pd,trackVerificationDatePickerClick:()=>ud,trackVerificationUpdate:()=>md,trackToggleOpenInDesktopApp:()=>gd,trackConfigureOpenInDesktopApp:()=>hd,trackOpenInDesktopAppPopupDismiss:()=>fd,trackOpenInDesktopAppPopupDisplay:()=>vd,trackOpenInDesktopAppPopupDownload:()=>yd,trackOpenInDesktopAppPopupOpenInApp:()=>bd,trackAddSlackIntegration:()=>Sd,trackRemoveSlackIntegration:()=>wd,trackSlackNotificationCreate:()=>kd,trackSlackNotificationDelete:()=>Cd,trackSlackNotificationReactivate:()=>_d,trackSlackNotificationUpdate:()=>Md,trackClickTeamNewPageOption:()=>Td,trackShowTeamDuplicateTemplateConfirmation:()=>Id,trackClickTeamDuplicateTemplateConfirmationOption:()=>Pd,trackCreateAppTemplate:()=>xd,trackPaymentStatusBannerDisplayed:()=>Bd,trackPaymentStatusBannerAction:()=>Zd});var i=o(96486),n=o.n(i),r=o(1302),a=o(2280),s=o(15145),l=o(30845),c=o(27006),d=o(29477),p=o(4615),u=o(80984),m=o(9852),g=o(2438),h=o(49902),f=o(97880),v=o(64002),y=o(54642),b=o(84908),S=o(31568),w=o(95477),k=o(51456),C=o(28020),_=o(4708),M=o(15010),T=o(75079),I=o(12955),P=o(62216),x=o(21115),B=o(8323),Z=o(79315),E=o(10161),R=o(29677),A=o(27724),D=o(19522),F=o(48690),L=o(30149),V=o(37181);function N(e,t){k.identifyUser({environment:e,userId:(0,p.F9)(t.user_id),traits:{...t,...t.tags?{original_tags:t.tags}:void 0,user_id:(0,p.F9)(t.user_id)}})}function O(e,t){k.identifyUser({environment:e,userId:(0,p.F9)(t.user_id),traits:{...t,user_id:(0,p.F9)(t.user_id)}})}async function U(){await k.deidentifyCurrentUser()}async function H(e){const{environment:t,experiment_id:o,experiment_group:i,experiment_version:n,logging_source:r}=e,a=(0,m.getSessionExperimentExposure)(o),s=await(0,I.getExperimentDeviceId)(t);Boolean(a)&&a===(0,m.getCombinedExperimentValue)(n,i)||(k.track(t,"experiment_exposure",{experiment_id:o,experiment_group:i,experiment_version:n,experiment_device_id:s,logging_source:r}),(0,m.setSessionExperimentExposure)(o,i,n))}function z(e,t){k.track(e,"download_desktop_app",t)}function W(e,t){k.track(e,"download_mobile_app",t)}function j(e,t){k.track(e,"download_ios_app",t)}function K(e,t){k.track(e,"download_android_app",t)}function Y(e,t){k.track(e,"download_web_clipper",t)}function G(e,t){k.track(e,"click_confirm_signup_input",t)}function X(e,t){const{name:o,...i}=t;k.track(e,"click_link",{...i,click_name:o})}function q(e){k.track(e,"browse_more_templates_click"),E.default.logEvent("browse_more_templates_click",1)}function $(e,t){k.track(e,"toggle_template_section",t)}function J(e,t){k.track(e,"open_typeform",t)}function Q(e,t){k.track(e,"toggle_pricing_term",t)}function ee(e,t){k.track(e,"scroll",t)}function te(e){k.track(e,"front_page_referral_signup_click")}function oe(e,t){k.trackThrottled(e,"page_visit",`page_visit-${t.page_id}-${t.is_peek}-${t.type}`,60,{...t,page_visit_source:(0,s.xt)(v.Ph(t.query,s.$X))})}function ie(e){const t=[{name:"initial_partner_stack_key",value:e.partner_stack_key,operation:"setOnce"},{name:"partner_stack_key",value:e.partner_stack_key,operation:"set"}];k.identifyDevice(t)}function ne(e,t){const o=v.nx(t,(0,m.getUrlAnalyticsFromSessionStorage)());if(o){const{fbclid:e,gclid:t}=o;e&&a.xx({type:"facebook",id:e}),t&&a.xx({type:"google",id:t}),(0,m.saveUrlAnalyticsInSessionStorage)(o)}k.track(e,"visit",{})}function re(e,t){k.trackThrottled(e,"database_visit",`database_visit-${t.collection_id}-${t.type}`,0,t)}function ae(e,t){k.trackThrottled(e,"type_aggregated_database_visit",`type_aggregated_database_visit-${t.databaseType}`,60,t)}function se(e,t){const o=t.page_id;k.trackThrottled(e,"page_visit_contains_synced_relation",`database_visit_contains_synced_relation-${o}`,60,t)}function le(e,t){const o=`${t.from_collection_id}-${t.type}`;k.trackThrottled(e,"database_visit_contains_synced_relation",`database_visit_contains_synced_relation-${o}`,60,t)}function ce(e,t){k.track(e,"page_error",t)}function de(e,t){k.track(e,"reorder_workspaces",t)}function pe(e,t){k.track(e,"multi_account_add_or_create_account_clicked",t)}function ue(e){k.track(e,"content_classification_proceed")}function me(e,t){k.track(e,"onboarding_dialog_error",t),Ce(e,"onboarding_dialog_error",t)}function ge(e,t){k.track(e,"onboarding_error",t),Ce(e,"onboarding_error",t)}function he(e,t){if(k.track(e,"onboarding_show",t),E.default.logEvent("onboarding_show",1,{...t}),t.is_new_onboarding){var o;const{currentUserSettingsStore:e}=Z.default.getState();E.default.logEvent("sign_up_by_domain_type",null==e||null===(o=e.getSettings())||void 0===o?void 0:o.domain_type,{})}}function fe(e,t){k.track(e,"onboarding_invite_copy",t),Ce(e,"onboarding_invite_copy",t)}function ve(e,t){k.track(e,"onboarding_close",t),Ce(e,"onboarding_close",t)}function ye(e,t){k.track(e,"onboarding_skip",t),Ce(e,"onboarding_skip",t)}function be(e,t){k.track(e,"onboarding_invite_send",t),Ce(e,"onboarding_invite_send",t)}function Se(e,t){k.track(e,"onboarding_space_icon_upload",t),Ce(e,"onboarding_space_icon_upload",t)}function we(e,t){k.track(e,"onboarding_stage",t),E.default.logEvent("onboarding_stage",1,{stage:t.stage,workspace_type:t.initial_workspace_type,is_new_onboarding:t.is_new_onboarding,device_type:e.device.deviceType}),E.default.logEvent("onboarding_stage_by_stage",t.stage,{}),E.default.logEvent("onboarding_stage_by_device_type",e.device.deviceType,{})}function ke(e,t){k.track(e,"onboarding_debug_stage_render",t)}function Ce(e,t,o){k.track(e,"onboarding_serverside",{...o,phase:t},{dontWait:!0})}function _e(e,t){k.track(e,"onboarding_join_space_click",t),E.default.logEvent("onboarding_join_space_click",t.joined_space_index,{...t})}function Me(e,t){k.track(e,"onboarding_invite_click",t),E.default.logEvent("onboarding_invite_click",1,{...t})}function Te(e,t){k.track(e,"onboarding_invite_attempt",t)}function Ie(e,t){k.track(e,"onboarding_upload_profile_photo",t)}function Pe(e,t){k.track(e,"onboarding_join_space",t)}function xe(e,t){k.track(e,"onboarding_create_space",t)}function Be(e,t){k.track(e,"onboarding_plan_type_select",t),E.default.logEvent("onboarding_plan_type_select",t.planType,{...t})}function Ze(e,t){k.track(e,"onboarding_persona_select",t),E.default.logEvent("onboarding_persona_select","persona",{...t})}function Ee(e,t){k.track(e,"onboarding_persona_select",t),E.default.logEvent("onboarding_persona_select","role",{...t})}function Re(e,t){k.track(e,"onboarding_persona_select",t),E.default.logEvent("onboarding_persona_select","useCases",{...t})}function Ae(e,t){k.track(e,"onboarding_persona_select",t),E.default.logEvent("onboarding_persona_select","companySize",{...t})}function De(e,t){k.track(e,"onboarding_company_survey_action",{...t,action:t.action}),E.default.logEvent("onboarding_company_survey_action",t.action,{}),E.default.logEvent(`onboarding_company_survey_action_${t.action}`,t.plan_selection,{})}function Fe(e,t){k.track(e,"onboarding_persona_survey_action",{...t,action:t.action}),E.default.logEvent("onboarding_persona_survey_action",t.action,{}),E.default.logEvent(`onboarding_persona_survey_action_${t.action}`,t.plan_selection,{})}function Le(e,t){k.track(e,"notion_topbar_click",t,{dontWait:!0})}function Ve(e,t){k.track(e,"onboarding_user_type_select",t)}function Ne(e,t){k.track(e,"getting_started_page_create",t)}function Oe(e,t){var o,i;const{currentUserSettingsStore:n}=Z.default.state,r=E.default.getExperimentsMap();k.updateSegmentUserTraits(e,{onboarding_complete:!0,onboarding_emails_experiment:r["onboarding-emails"]}),k.track(e,"onboarding_complete",t),a.PL(),E.default.logEvent("onboarding_complete",1,{domain_type:null==n||null===(o=n.getSettings())||void 0===o?void 0:o.domain_type,device_type:e.device.deviceType,is_new_onboarding:t.is_new_onboarding,is_professional_team_user:(0,M.QZ)(),user_persona:t.user_persona,plan_type:t.plan_type,create_or_join:t.initial_workspace_type}),E.default.logEvent("onboarding_complete_by_plan_type",t.plan_type,{}),E.default.logEvent("onboarding_complete_by_device_type",e.device.deviceType,{}),E.default.logEvent("onboarding_complete_by_user_persona",t.user_persona,{}),E.default.logEvent("onboarding_complete_by_user_team_role",t.user_team_role,{}),t.user_use_cases&&t.user_use_cases.forEach((e=>{E.default.logEvent("onboarding_complete_by_user_use_case",e,{})})),E.default.logEvent("onboarding_complete_by_domain_type",null==n||null===(i=n.getSettings())||void 0===i?void 0:i.domain_type,{}),E.default.logEvent("onboarding_complete_by_create_or_join_space",t.initial_workspace_type,{}),(0,M.QZ)()&&E.default.logEvent("pro_team_onboarding_complete",1,{})}function Ue(e,t){k.track(e,"onboarding_tooltips_complete",t)}function He(e,t){k.track(e,"proj_management_onboarding_tooltip_show",t),E.default.logEvent("proj_management_tooltip_show")}function ze(e,t){k.track(e,"proj_management_onboarding_tooltip_dismiss",t),E.default.logEvent("proj_management_tooltip_dismiss")}function We(e,t){k.track(e,"onboarding_team_invite_email_entered",t)}function je(e,t){k.track(e,"onboarding_team_invite_add_more_clicked",t)}function Ke(e,t){k.track(e,"onboarding_bulk_invites_rendered",t)}function Ye(e,t){k.track(e,"landing_page_visit",{routerName:t}),(0,d.Vs)(4e3).then((o=>{E.default.logEvent(`${t}_page_visit`,e.device.deviceType,{})}))}function Ge(e,t){k.track(e,"customer_io_in_app_callout_show",t)}function Xe(e,t){k.track(e,"customer_io_in_app_callout_suppress",t)}function qe(e,t){k.track(e,"customer_io_in_app_callout_dismiss",t)}function $e(e,t){k.track(e,"customer_io_in_app_callout_error",t)}function Je(e,t){k.track(e,"persona_form_step",{event:t.event})}function Qe(e,t){k.track(e,"persona_form_action",{event:t.event})}function et(e,t){k.track(e,"import_button_click",t)}function tt(e,t){k.track(e,"import_source_auth",t)}function ot(e,t){k.track(e,"import_source_input",t)}function it(e,t){k.track(e,"open_import_modal",t)}function nt(e,t){k.track(e,"auth_integration",t)}function rt(e,t){k.track(e,"integration_select_all",t)}function at(e,t){k.track(e,"integration_deselect_all",t)}function st(e,t){k.track(e,"integration_select_item",t)}function lt(e,t){k.track(e,"integration_deselect_item",t)}function ct(e,t){k.track(e,"import_integration",t)}function dt(e,t){k.track(e,"remove_integration",t)}function pt(e,t){k.track(e,"integration_prompt_auth",t)}function ut(e){k.track(e,"open_google_drive_file_picker")}function mt(e){k.track(e,"google_drive_pick_file")}function gt(e,t){k.track(e,"google_drive_embed_file",t)}function ht(e,t){const{pastedText:o}=t;let i;if(l.B(o,"url")){const e=v.Qc(o);e.host&&(i=e.host)}if(i){const{pastedText:o,...n}={...t,url_domain:i};k.track(e,"paste_url",n)}}function ft(e,t){const o=t.url?(0,v.gy)(t.url):void 0;k.track(e,"edit_link",{type:t.type,url_domain:null==o?void 0:o.hostname})}function vt(e){k.track(e,"edit_link_title")}function yt(e,t){k.track(e,"pricing_grid_button_click",t),E.default.logEvent("pricing_grid_button_click",void 0,t),qt(e,{location:"plans_page",cta_item:t.plan,page_section:(0,P.$r)()?"all_plans_grid":"grid",button_text:t.button_text})}function bt(e){k.track(e,"pricing_grid_contact_sales_click")}function St(e){k.track(e,"add_on_discount_popup_seen")}function wt(e){k.track(e,"add_on_discount_popup_dismissed")}function kt(e,t){k.track(e,"subscription_upgrade_modal_open",t)}function Ct(e,t){k.track(e,"subscription_upgrade_modal_billing_interval_updated",t)}function _t(e,t){k.track(e,"subscription_upgrade_modal_add_on_features_updated",t)}function Mt(e,t){k.track(e,"subscription_upgrade_modal_apply_credit_updated",t)}function Tt(e,t){k.track(e,"subscription_upgrade_modal_upgrade_accepted",t)}function It(e,t){k.track(e,"subscription_upgrade_modal_credits_toggled",t)}function Pt(e,t){k.track(e,"subscription_upgrade_modal_upgrade_click",t)}function xt(e,t){k.track(e,"subscription_upgrade_modal_upgrade_failed_validation",t)}function Bt(e){k.track(e,"subscription_upgrade_modal_upgrade_failed_payment")}function Zt(e,t){k.track(e,"subscription_upgrade_modal_payment_method_changed",t)}function Et(e,t){k.track(e,"subscription_upgrade_modal_address_form_updated",t)}function Rt(e){k.track(e,"subscription_upgrade_modal_dismissed")}function At(e,t){k.track(e,"subscription_upgrade_modal_stripe_error",t)}function Dt(e,t){k.track(e,"coupon_code_entered",t)}function Ft(e,t){k.track(e,"create_subscription",t),E.default.logEvent("create_subscription",t.plan,t)}async function Lt(e,t){const o=(0,M.JF)();if(k.track(e,"update_subscription_tier",{from:t.from,action:t.action,old_subscription_tier:t.oldSubscriptionTier,new_subscription_tier:t.newSubscriptionTier,old_price_id:t.oldPriceId,new_price_id:t.newPriceId,old_add_ons:t.oldAddOns,new_add_ons:t.newAddOns,is_cancel_subscription:t.isCancelSubscription,is_professional_team:t.isProfessionalTeamUser,domain_type:o}),E.default.logEvent("update_subscription_tier",void 0,{from:t.from,action:t.action,old_subscription_tier:t.oldSubscriptionTier,new_subscription_tier:t.newSubscriptionTier,old_price_id:t.oldPriceId,new_price_id:t.newPriceId,old_add_ons:t.oldAddOns,new_add_ons:t.newAddOns,is_cancel_subscription:t.isCancelSubscription}),!t.oldSubscriptionTier||!t.newSubscriptionTier)return;const{device:i}=e;if(!(0,g.nR)(t.oldSubscriptionTier)&&(0,g.nR)(t.newSubscriptionTier)&&"personal"!==t.newSubscriptionTier){const n={country:t.addressCountry,productName:t.newPriceId,price:t.creditAmount||0,spaceId:(0,p.cj)(t.spaceId),deviceType:i.isTablet?"tablet":i.isMobile?"mobile":"desktop",subscriptionTier:t.newSubscriptionTier};if("professional"===o&&k.track(e,"professional_workspace_upgraded",t),k.track(e,"workspace_upgraded",t),a.dG({eventType:"workspace_upgraded",source:"client",eventData:{...n,domainType:o}}),"professional"===o&&a.dG({eventType:"professional_workspace_upgraded",source:"client"}),e.device.isElectron){const i=(0,u.fo)(w.Z.domainBaseUrl,{deviceId:await k.getDeviceIdForAnalytics(e),oldSubscriptionTier:t.oldSubscriptionTier,newSubscriptionTier:t.newSubscriptionTier,isProfessionalTeamUser:t.isProfessionalTeamUser,deviceType:e.device.deviceType,domainType:o,eventData:n});return void b.openExternalUrl(i)}}}function Vt(e,t){k.track(e,"subscription_update_plan",t)}function Nt(e,t){k.track(e,"subscription_update_billing",t)}function Ot(e,t){const{step:o,name:i,email:n,...r}=t;k.track(e,"enterprise_sales_contact",{...r,enterprise_name:i,enterprise_email:n}),E.default.logEvent("enterprise_sales_contact")}function Ut(e){k.track(e,"enterprise_sales_contact_opened")}function Ht(e){k.track(e,"enterprise_sales_contact_dismissed")}function zt(e,t){k.track(e,"enterprise_sales_contact_updated",t)}function Wt(e,t){k.track(e,"subscription_apply_credit",t)}function jt(e,t){k.track(e,"cancel_subscription",t),E.default.logEvent("cancel_subscription",void 0,t)}function Kt(e,t,o){k.track(e,"churn_survey",{...t,churnType:o})}function Yt(e){k.track(e,"delete_workspace_click"),E.default.logEvent("delete_workspace_click")}function Gt(e,t,o){k.track(e,"churn_survey_close",{...t,churnType:o})}function Xt(e,t){k.track(e,"click_upgrade_button",t)}function qt(e,t){k.track(e,"plan_cta_click",t),E.default.logEvent("plan_cta_click",void 0,t)}function $t(e){k.trackThrottled(e,"approaching_block_limit","approaching_block_limit",60)}function Jt(e){const t=k.trackThrottled(e,"reach_block_limit","reach_block_limit",60);E.default.logEvent("reach_block_limit",1),t&&k.updateSegmentUserTraits(e,{reach_block_limit:!0,reach_block_limit_time:Date.now(),subscription_tier:(0,B.zt)()})}function Qt(e,t){k.track(e,"click_team_try_for_free",t)}function eo(e,t){k.track(e,"click_team_cancel_plan",t)}function to(e){k.track(e,"workspace_invite_copy_link")}function oo(e){k.track(e,"currently_subscribed")}function io(e){k.track(e,"plans_earn_credit_click")}function no(e){k.track(e,"referral_invite")}function ro(e){k.track(e,"referral_tweet_click")}function ao(e){k.track(e,"referral_copy_link_click")}function so(e){k.track(e,"activate_referral")}function lo(e,t){k.track(e,"apply_credit_click",t)}function co(e,t){k.track(e,"credit_item_action_click",t)}function po(e){k.track(e,"invited_by_credit_click")}function uo(e){k.track(e,"timeline_warning_click")}function mo(e){k.track(e,"timeline_warning_close_click")}function go(e){k.trackThrottled(e,"timeline_warning_show","timeline_warning_show",3600)}function ho(e){k.track(e,"sidebar_promo_click")}function fo(e){k.track(e,"invited_by_credit_close_click")}function vo(e){k.track(e,"sidebar_promo_close_click")}function yo(e){k.track(e,"student_plan_prompt_click")}function bo(e){k.track(e,"student_plan_prompt_close_click")}function So(e){k.track(e,"sidebar_create_work_account_prompt_click",{})}function wo(e){k.track(e,"sidebar_create_work_account_prompt_close_click",{})}function ko(e,t){k.track(e,"onboarding_desktop_app_download_click",t),E.default.logEvent("onboarding_desktop_app_download_click",1)}const Co=n().throttle((e=>{k.updateSegmentUserTraits(e,{created_page:!0})}),864e5,{trailing:!1});function _o(e,t){const{teamStore:o,...i}=t,n=t.teamStore&&(0,k.getTeamEventData)(t.teamStore);k.trackThrottled(e,"create_block",`create_block-${t.type}-${t.from}`,60,{...i,...n}),"page"===t.type&&(k.track(e,"create_page",{...i,...n}),Co(e))}function Mo(e,t){k.track(e,"open_peek_as_page",t)}function To(e,t){k.track(e,"peek_arrow_navigation",t)}function Io(e,t){k.track(e,"close_side_peek",t)}function Po(e){k.track(e,"team_workspace_cta_account_switcher_click")}function xo(e,t){k.track(e,"select_template",t)}function Bo(e,t){k.track(e,"desktop_app_signup_browser_visit",{desktop_app_reroute_email:t.desktopAppRerouteEmail,desktop_app_device_id:t.desktopAppDeviceId})}function Zo(e,t){k.track(e,"template_modal_persona_select",t)}function Eo(e,t){k.track(e,"template_modal_open",t),E.default.logEvent("template_modal_open",1)}function Ro(e,t){k.track(e,"template_modal_item_click",t),E.default.logEvent("template_modal_item_click",1)}function Ao(e,t){k.track(e,"template_modal_get_template_click",t),E.default.logEvent("template_modal_get_template_click",1)}function Do(e,t){k.track(e,"template_modal_accept",t),E.default.logEvent("template_modal_accept",1)}function Fo(e,t){k.track(e,"create_collection_template",t),E.default.logEvent("create_collection_template",1)}function Lo(e,t){k.track(e,"activate_collection_template",t),E.default.logEvent("activate_collection_template",1)}function Vo(e,t){k.track(e,"collection_template_action",t)}function No(e,t){k.trackThrottled(e,"edit_block_text_60",`edit_block_text_60-${t.user_action}`,60,t)}function Oo(e,t){k.track(e,"todo_block_check",t)}function Uo(e,t){k.track(e,"toggle_block_toggle")}function Ho(e,t){k.track(e,"embed_block_action",t)}function zo(e,t){k.track(e,"embed_block_resize",t)}function Wo(e,t){k.track(e,"equation_block_edit",t)}function jo(e,t){r.default.afterNextFlush((()=>{let o;const i=A.default.state.stores[0];i&&(o=i.getType());const{parentTeamStore:n,...r}=t,a=n&&(0,k.getTeamEventData)(n);k.trackThrottled(e,"block_action",`block_action-${t.analyticsName}-${t.from}-${t.block_id}`,60,{...r,final_block_type:o,...a})}))}function Ko(e,t){const{optionalAnalyticsProperties:o,...i}=t,{teamStore:n,collectionContextStore:r,...a}=t.optionalAnalyticsProperties||{},s=(0,T.Pn)(r)||{};n?k.track(e,"open_block_menu",{...s,...(0,k.getTeamEventData)(n),...i,...a}):k.track(e,"open_block_menu",{...s,...i,...a})}function Yo(e,t){tc(e,"open_block_menu",t)}function Go(e){k.trackThrottled(e,"open_slash_menu","open_slash_menu",60)}function Xo(e,t){k.track(e,"download_file",t)}function qo(e,t){k.track(e,"file_open_attempt",t)}function $o(e,t){k.track(e,"duplicate_template",{...t,is_paid:!1})}function Jo(e,t){k.track(e,"duplicate_template_attempt",t)}function Qo(e,t){const o=(0,v.gy)(t.url);k.track(e,"open_embed_menu",{url_domain:null==o?void 0:o.hostname})}function ei(e,t){var o;k.track(e,"click_embed_menu",{url_domain:t.url?null===(o=(0,v.gy)(t.url))||void 0===o?void 0:o.hostname:void 0,type:t.type})}function ti(e,t){k.track(e,"url_turned_bookmark",t)}function oi(e,t){k.track(e,"embed_type",t)}function ii(e,t){k.track(e,"embed_render",t)}function ni(e,t){k.track(e,"embed_client_error",t)}function ri(e,t){k.track(e,"configure_template_button",t)}function ai(e,t){k.track(e,"change_font_type",t)}function si(e,t){k.track(e,"change_font_size",t)}function li(e,t){k.track(e,"change_page_width",t)}function ci(e){k.track(e,"click_add_menu")}function di(e,t){k.track(e,"move_to",t)}function pi(e,t){k.track(e,"move_to_menu_open",t)}function ui(e,t){k.track(e,"add_editor_permission_to_ensure_undo",t)}function mi(e,t){k.track(e,"edit_lock_toggle",t)}function gi(e,t){k.track(e,"rich_text_menu_click",t)}function hi(e,t){k.track(e,"update_page_section_visibility",t)}function fi(e,t){k.track(e,"expand_block",t)}function vi(e,t){k.track(e,"change_table_wrap",t)}function yi(e,t,o){k.track(e,t,o)}function bi(e,t){k.track(e,"board_item_delete_newly_created",t)}function Si(e,t,o){if(!0===o)k.track(e,"edit_block_property_60",t);else{const o=(0,C.zj)();k.trackThrottled(e,"edit_block_property_60",`edit_block_property_60-${o||""}`,60,t)}}function wi(e,t){k.track(e,"click_block_property_url",t)}function ki(e,t){k.track(e,"create_property",t)}function Ci(e,t){k.track(e,"configure_property",t)}function _i(e,t){k.track(e,"delete_property",t)}function Mi(e,t){k.track(e,"create_view",t)}function Ti(e,t){k.track(e,"configure_view",t)}function Ii(e,t){k.track(e,"open_peek_mode_picker",t)}function Pi(e,t){k.track(e,"open_peek_mode_picker",t)}function xi(e,t){k.track(e,"update_peek_mode_format",t)}function Bi(e,t){k.track(e,"update_peek_mode_format",t)}function Zi(e,t){k.track(e,"view_settings",t)}function Ei(e,t){k.track(e,"delete_view",t)}function Ri(e,t){k.track(e,"collection_action_bar_click",t)}function Ai(e,t){k.track(e,"collection_search",t)}function Di(e,t){k.track(e,"collection_view_select",t)}function Fi(e,t){k.track(e,"open_collection_as_page",t)}function Li(e){k.track(e,"collection_no_date_menu_add")}function Vi(e){k.track(e,"collection_no_date_menu_view")}function Ni(e,t){k.track(e,"relation_database_click",t)}function Oi(e,t){k.trackThrottled(e,"timeline_view","timeline_view",5,t)}function Ui(e,t){k.track(e,"timeline_zoom_level_update",t)}function Hi(e,t){k.track(e,"timeline_today_click",t)}function zi(e,t){k.track(e,"timeline_shift_time_click",t)}function Wi(e,t){k.track(e,"timeline_toggle_table_click",t)}function ji(e,t){k.track(e,"timeline_item_scroll_arrow_click",t)}function Ki(e,t){k.track(e,"timeline_item_resize",t)}function Yi(e,t){k.track(e,"timeline_dependency_arrow_add",t)}function Gi(e,t){k.track(e,"timeline_dependency_arrow_delete",t)}function Xi(e,t){k.track(e,"subitem_toggle_block_open",t)}function qi(e,t){k.track(e,"subitem_toggle_block_close",t)}function $i(e){k.track(e,"table_new_subitem_create")}function Ji(e){k.track(e,"inline_collection_load_more_click")}function Qi(e,t){k.track(e,"relation_show_as",t)}function en(e,t){k.track(e,"relation_reorder",t)}function tn(e,t){k.track(e,"relation_add_block",t)}function on(e,t){k.track(e,"relation_remove_block",t)}function nn(e,t){k.track(e,"relation_create_block",t)}function rn(e,t){k.track(e,"relation_customize_displayed_properties",t)}function an(e,t){k.track(e,"relation_section_link_pages",t)}function sn(e,t){k.track(e,"relation_navigate_block",t)}function ln(e,t){k.track(e,"relation_update_property_visibility",t)}function cn(e,t){k.track(e,"configure_rollup_relation",t)}function dn(e,t){k.track(e,"configure_rollup_target_property",t)}function pn(e,t){k.track(e,"configure_rollup_aggregation",t)}function un(e,t){k.track(e,"collection_table_drag_and_fill",t)}function mn(e,t){k.track(e,"create_space",t);const o=(0,B.zt)();if("professional"===t.domain_type&&(k.track(e,"professional_workspace_created",t),a.L1({subscriptionTier:o,planType:t.planType})),a.VT({subscriptionTier:o,domainType:t.domain_type}),"team"===t.planType){const t=a.Q3(),o=a.SY();y.trackConversionEvent(e,{eventName:"create_team_space",fbp:t,clickIds:o})}}function gn(e,t){k.track(e,"join_space",t)}function hn(e){k.track(e,"leave_space")}function fn(e){k.track(e,"delete_space"),E.default.logEvent("delete_space")}function vn(e,t){const{collectionContextStore:o}=t.optionalAnalyticsProperties||{},i=(0,T.Pn)(o)||{},n={from:t.from,block_types:t.draggedTypes,block_count:t.draggedTypes.length,as_copy:t.asCopy||!1,draggable:t.draggableProps,dropzone:t.dropzoneProps,...i};k.track(e,"drag",n),t.asCopy&&k.track(e,"drag_as_copy",n),"selection_menu"===t.from&&k.track(e,"drag_selection_menu",n)}function yn(e,t){k.track(e,"click_selection_menu",{block_type:t.blockType})}function bn(e){k.track(e,"open_mention_menu")}function Sn(e,t){const{clickIndexGlobal:o,clickIndexLocal:i,sectionIndex:n,timeToClickInMs:r,analyticsFrom:a,queryLength:s,mentionType:l}=t,c={clickIndexGlobal:o,clickIndexLocal:i,sectionIndex:n,timeToClickInMs:r,analyticsFrom:a,queryLength:s,mentionType:l};k.track(e,"insert_mention_from_mention_menu",c),E.default.logEvent("insert_mention_from_mention_menu",void 0,c)}function wn(e,t){const{timeToAbandonInMs:o,analyticsFrom:i,queryLength:n}=t,r={timeToAbandonInMs:o,analyticsFrom:i,queryLength:n};k.track(e,"mention_menu_abandon",r),E.default.logEvent("mention_menu_abandon",void 0,r)}function kn(e,t){k.track(e,"mention_user",{mentioned_user_id:(0,p.F9)(t.user_id),from:t.from,block_type:t.block_type})}function Cn(e,t){k.track(e,"mention_group",{mentioned_group_id:(0,p.F9)(t.group_id),from:t.from,block_type:t.block_type})}function _n(e,t){k.track(e,"hover_mention_group",{group_id:(0,p.F9)(t.group_id)})}function Mn(e,t){k.track(e,"mention_date",{date:t.date,from:t.from,block_type:t.block_type})}function Tn(e,t){k.track(e,"mention_page",{mentioned_page_id:(0,p.F9)(t.page_id),from:t.from,block_type:t.block_type})}function In(e,t){k.track(e,"inline_equation_edit",t)}function Pn(e,t){k.track(e,"set_reminder",{date:t.date,reminder:t.reminder})}function xn(e){k.track(e,"resize_column")}function Bn(e){k.track(e,"reset_column_sizes")}function Zn(e){k.track(e,"create_column_list")}function En(e,t){k.track(e,"insert_column",t)}function Rn(e,t){k.track(e,"drag_near_edge_scroll",t)}function An(e,t){k.track(e,"transform_text_block_filter",t)}function Dn(e,t){k.track(e,"unicode_filter",t)}function Fn(e,t){k.track(e,"annotation_filter",t)}function Ln(e,t){k.track(e,"keyboard_annotation",t)}function Vn(e,t){k.track(e,"link_filter",t)}function Nn(e,t){const o=t.invite_targets.filter(R.cl),i=t.invite_targets.filter(R.fZ),r=n().compact(t.permission_items.map((e=>{if("user_permission"===e.type)return e.user_id&&(0,p.cj)(e.user_id)}))),s=(0,B.zt)(),l={role:t.role,user_count:i.length+o.length,new_user_count:o.length,is_onboarding:t.is_onboarding,invite_flow_id:t.invite_flow_id,invite_origin:t.invite_origin,invitee_ids:r,invite_message_length:t.invite_message_length,subscription_tier:s,domain_type:t.domainType};k.track(e,"invite",{...l,is_space:t.is_space}),t.is_space?(k.track(e,"space_invite",l),k.updateSegmentUserTraits(e,{space_invited:!0}),E.default.logEvent("space_invite",t.invite_origin,l),function(e,t){const o=(0,B.zt)();t.visibleMembersCount<=1&&(k.track(e,"workspace_first_invite_sent"),a.kd(o,t.domainType),"professional"===t.domainType&&(k.track(e,"professional_workspace_first_invite_sent",{visible_members_count:t.visibleMembersCount,is_professional_team_user:t.isProfessionalTeamUser,domain_type:t.domainType}),a.Dq()))}(e,{visibleMembersCount:x.qX(),isProfessionalTeamUser:t.isProfessionalTeamUser,domainType:t.domainType})):(k.track(e,"page_invite",l),E.default.logEvent("page_invite",s,l),function(e,t){const{currentUserSettingsStore:o}=Z.default.state;if(!o)return;const i=o.getKeyStore("settings").getKeyStore("signup_time").getValue(),n=o.getKeyStore("settings").getKeyStore("first_page_invite_at").getValue();if(!Boolean(n)){const n=Date.now(),r={...t,...i?{signup_time_ready:!0,time_from_signup_to_first_page_invite:i-n}:{signup_time_ready:!1}};k.track(e,"page_invite_time",r),E.default.logEvent("page_invite_time",t.subscription_tier,r),L.createAndCommit({userAction:"firstPageInvite",environment:e,userId:o.id,perform:e=>{V.d2({userSettingsStore:o,data:{first_page_invite_at:n},transaction:e})}})}}(e,l))}function On(e,t){k.track(e,"change_email",t)}function Un(e,t){k.track(e,"update_page_permission","user_id"in t||"page_id"in t?Hn(t):t)}function Hn(e){const{user_id:t,page_id:o,...i}=e;return i}function zn(e,t,o){k.track(e,"update_space_permission",{...(0,c.jg)(t)&&{updated_user_id:(0,p.cj)(t.user_id)},...(0,c.FB)(t)&&{updated_bot_id:(0,p.cj)(t.bot_id)},..."user_id"in t||"page_id"in t?Hn(t):t,...o})}function Wn(e,t){var o;let{item:i,teamStore:n}=t;const r=null===(o=n.getPermissionItems())||void 0===o?void 0:o.find((e=>e.type===i.type));(null==r?void 0:r.role)!==i.role&&tc(e,"update_team_permission",{store:n,..."user_id"in i||"page_id"in i?Hn(i):i,..."user_id"in i&&{permission_user_id:(0,p.cj)(i.user_id)},old_role:null==r?void 0:r.role,is_team_role_change:!1,is_permission_change:!0})}function jn(e,t){let{permission_user_id:o,store:i,team_role:n}=t;tc(e,"update_team_permission",{store:i,permission_user_id:o,team_role:n,is_team_role_change:!0,is_permission_change:!1})}function Kn(e,t){k.track(e,"convert_guest_to_member",t)}function Yn(e){k.track(e,"remove_guest")}function Gn(e){k.track(e,"permission_group_create")}function Xn(e,t){k.track(e,"permissions_settings_tab_click",t)}function qn(e){k.track(e,"permission_group_rename")}function $n(e,t){k.track(e,"permission_group_set_icon",t)}function Jn(e,t){k.track(e,"permission_group_add_members",t)}function Qn(e){k.track(e,"permission_group_remove_member")}function er(e){k.track(e,"permission_group_delete")}function tr(e){k.track(e,"permission_group_reorder")}function or(e,t){k.track(e,"toggle_allow_search_engine_indexing",t)}function ir(e,t){k.track(e,"set_expiration_time_on_public_page",t)}function nr(e,t){k.track(e,"toggle_allow_duplicate",t)}function rr(e,t){k.track(e,"restrict_permissions",t)}function ar(e,t){k.track(e,"restore_permissions",t)}function sr(e,t){k.track(e,"set_database_sync_permissions",t)}function lr(e){k.track(e,"widen_permissions")}function cr(e){k.track(e,"request_access")}function dr(e,t){k.track(e,"grant_access",t)}function pr(e,t){k.track(e,"grant_access_update_access_level",t)}function ur(e,t){k.track(e,"ignore_access_request",t)}function mr(e,t){k.track(e,"toggle_request_access_security_setting",t)}function gr(e,t){k.track(e,"invite_typed",t),E.default.logEvent("invite_typed",t.subscription_tier,{...t})}function hr(e,t){k.track(e,"invite_select_target",t),E.default.logEvent("invite_select_target",t.subscription_tier,{...t})}function fr(e,t){k.track(e,"invite_change_role",t),E.default.logEvent("invite_change_role",t.subscription_tier,{...t})}function vr(e,t){k.track(e,"abandon_permissions_invite",t),E.default.logEvent("abandon_permissions_invite",t.subscription_tier,{...t})}function yr(e,t){k.track(e,"open_share_workspace_invite",t),E.default.logEvent("open_share_workspace_invite",t.subscription_tier,{...t})}function br(e,t){k.track(e,"send_share_workspace",t),E.default.logEvent("send_share_workspace",t.subscription_tier,{...t})}function Sr(e,t){k.track(e,"send_membership_request",t),E.default.logEvent("send_membership_request",t.subscription_tier,{...t})}function wr(e,t){k.track(e,"view_all_requests_from_membership_request_notification",t),E.default.logEvent("view_all_requests_from_membership_request_notification","notification",t)}function kr(e,t){k.track(e,"resolve_membership_request",t),E.default.logEvent("resolve_membership_request",t.status,t)}function Cr(e,t){k.track(e,"click_invite_people",t),E.default.logEvent("click_invite_people",t.space_role,{...t})}function _r(e){k.track(e,"open_guest_membership_request_modal"),E.default.logEvent("open_guest_membership_request_modal")}function Mr(e){k.track(e,"render_guest_membership_request_entry_point"),E.default.logEvent("render_guest_membership_request_entry_point")}function Tr(e){k.track(e,"sidebar_expand")}function Ir(e){k.track(e,"sidebar_unexpand")}function Pr(e,t){k.track(e,"bookmark",t)}function xr(e,t){k.track(e,"unbookmark",t)}function Br(e,t){k.track(e,"open_settings",t)}function Zr(e,t){k.track(e,"toggle_settings_tab",t)}function Er(e){k.track(e,"upload_profile_photo")}function Rr(e,t){k.track(e,"name_changed",t)}function Ar(e){k.track(e,"delete_account_clicked")}function Dr(e){k.track(e,"delete_account_confirmed")}function Fr(e){k.track(e,"log_out_from_active_sessions_clicked")}function Lr(e){k.track(e,"change_password_clicked")}function Vr(e){k.track(e,"remove_password_clicked")}function Nr(e,t){k.track(e,"locale_changed",t)}function Or(e,t){k.track(e,"invite_link_updated",t)}function Ur(e,t){k.track(e,"allowed_email_domains_updated",t)}function Hr(e){k.track(e,"open_trash")}function zr(e,t){k.track(e,"toggle_trash_tab",t)}function Wr(e){k.track(e,"restore_trash_page")}function jr(e){k.track(e,"delete_trash_page")}function Kr(e){k.track(e,"open_breadcrumb_current_page_menu")}function Yr(e){k.track(e,"click_breadcrumb_current_page_scroll_to_top")}function Gr(e){k.track(e,"click_breadcrumb_move_to")}function Xr(e){k.track(e,"open_page_share"),E.default.logEvent("open_page_share")}function qr(e,t){k.track(e,"open_page_share_invite",t),E.default.logEvent("open_page_share_invite",t.subscription_tier,{...t})}function $r(e){k.track(e,"open_space_invite")}function Jr(e){k.track(e,"open_more_menu")}function Qr(e){k.track(e,"open_more_connections_menu")}function ea(e){k.track(e,"open_public_more_menu")}function ta(e){k.track(e,"confirm_app_update")}function oa(e,t){k.track(e,"export",t)}function ia(e,t){k.track(e,"export_failed",t)}function na(e,t){const{teamStore:o,...i}=t;tc(e,"click_outliner_item",{store:o,...i})}function ra(e,t){"onboarding"===t.from?function(e,t){const o=t.teamStore&&(0,k.getTeamEventData)(t.teamStore);k.track(e,"create_onboarding_page",{...o,forkedTemplateId:t.forkedTemplateId})}(e,{from:t.from,teamStore:t.teamStore,forkedTemplateId:t.pageId}):_o(e,{type:"page",from:t.from,teamStore:t.teamStore})}function aa(e,t){k.track(e,"click_outliner_team_new_page",t)}function sa(e,t){const{teamStore:o,...i}=t;tc(e,"outliner_item_toggle",{store:o,...i})}function la(e,t){tc(e,"outliner_team_toggle",t)}function ca(e,t){k.track(e,"outliner_section_toggle",t)}function da(e){k.track(e,"click_nested_child_page")}function pa(e,t){k.track(e,"click_desktop_navigator",t)}function ua(e){k.track(e,"open_space_switcher")}function ma(e){k.track(e,"space_switcher_select_space")}function ga(e){k.track(e,"space_switcher_logout_click")}function ha(e,t){k.track(e,"toggle_dark_mode",t)}function fa(e){k.track(e,"delete_user")}function va(e,t){k.track(e,"pin_page",t)}function ya(e,t){k.track(e,"unpin_page",t)}function ba(e,t){k.track(e,"open_support_chat",t)}function Sa(e){k.track(e,"click_help"),E.default.logEvent("click_help")}function wa(e,t){k.track(e,"click_help_item",t),"sales_chat"===t.item&&E.default.logEvent("click_help_item")}function ka(e,t){k.track(e,"global_click_learn",t)}function Ca(e,t){k.track(e,"tap_mobile_action_bar_item",{item_name:t.itemName,from:t.from})}function _a(e){k.track(e,"scroll_mobile_action_bar")}function Ma(e){k.track(e,"open_mobile_sidebar")}function Ta(e,t){k.track(e,"tap_mobile_bottom_bar_item",{...t})}function Ia(e){k.track(e,"mobile_add_to_menu_accept")}function Pa(e,t){k.track(e,"navigation",{...t})}function xa(e){k.track(e,"open_notification_settings_from_all_updates")}function Ba(e,t){E.default.logEvent("open_sidebar_updates",t.tab,t),k.track(e,"open_sidebar_updates",t)}function Za(e){k.track(e,"open_page_updates")}function Ea(e,t){k.track(e,"click_update",t)}function Ra(e,t){const{target:o,...i}=t;let n;"notify_mobile"===o?n="set_mobile_notification":"notify_desktop"===o?n="set_desktop_notification":"notify_email"===o?n="set_email_notification":"notify_email_always"===o?n="set_email_always_notification":(0,f.t1)(o),k.track(e,n,i)}function Aa(e,t){k.track(e,"follow_page",t)}function Da(e,t){k.track(e,"unfollow_page",t)}function Fa(e){k.trackThrottled(e,"open_emoji_menu","open_emoji_menu",60)}function La(e,t,o){k.track(e,t,o)}function Va(e,t,o){k.track(e,t,o)}function Na(e,t){k.track(e,"open_block_discussion_menu",t)}function Oa(e){let{environment:t,from:o,notificationId:i,activityId:n}=e;k.track(t,"open_reply_discussion_menu",{from:o,notificationId:i,activityId:n})}function Ua(e){let{environment:t,from:o,notificationId:i,activityId:n}=e;k.track(t,"close_reply_discussion_menu",{from:o,notificationId:i,activityId:n})}function Ha(e){k.track(e,"open_new_block_discussion")}function za(e){k.track(e,"open_new_inline_discussion")}function Wa(e){k.track(e,"create_block_discussion"),E.default.logEvent("create_block_discussion")}function ja(e){k.track(e,"create_inline_discussion"),E.default.logEvent("create_inline_discussion")}function Ka(e,t){k.track(e,"add_comment",t),E.default.logEvent("add_comment",t.from)}function Ya(e,t){k.track(e,"delete_comment",t)}function Ga(e,t){k.track(e,"edit_comment",t)}function Xa(e,t){k.track(e,"resolve_discussion",{from:t}),E.default.logEvent("resolve_discussion",t)}function qa(e,t){k.track(e,"reopen_discussion",{from:t})}function $a(e,t){k.track(e,"click_discussion",t)}function Ja(e){const{environment:t,...o}=e;k.track(t,"add_reaction",o),E.default.logEvent("add_reaction",o.reaction_value)}function Qa(e){const{environment:t,...o}=e;k.track(t,"remove_reaction",o)}function es(e,t){k.track(e,"open_history",{from:t})}function ts(e){return Date.now()-parseInt(e.timestamp)}function os(e,t){k.track(e,"select_snapshot",{ageMs:ts(t)})}function is(e,t){k.track(e,"history_copy",{ageMs:ts(t)})}function ns(e,t){k.track(e,"restore_snapshot",{ageMs:ts(t)})}function rs(e,t){k.track(e,"fork_page",{blockId:t},{dontWait:!0})}function as(e,t){const{type:o,dateMeasurement:i,performanceMeasurement:n,preboot:r,data:a}=t;k.track(e,o,{time:i,performanceTime:n,...a},{preboot:Boolean(r)})}function ss(e,t){const{type:o,bytes:i,data:n}=t;k.track(e,o,{bytes:i,...n})}function ls(e,t){k.track(e,"open_search",t)}function cs(e,t){k.track(e,"space_invitation_email_clicked",t)}function ds(e,t){k.track(e,"select_search_item",t);const{numKeystrokes:o,timeToSelectMs:i,selectedItemIndex:n,originalPosition:r,context:a,numLocalResults:s,searchSessionId:l,searchSessionFlowNumber:c}=t;E.default.logEvent("select_search_item",n,{numKeystrokes:o,timeToSelectMs:i,selectedItemIndex:n,numLocalResults:s,originalItemIndex:r,searchSessionFlowNumber:c});const d=1/(n+1);k.track(e,"quick_find_reciprocal_rank",{reciprocalRank:d,context:a,searchSessionId:l}),E.default.logEvent("quick_find_reciprocal_rank",d,{context:a,searchSessionId:l})}function ps(e,t){k.track(e,"abandoned_search",t);const{numKeystrokes:o,timeToAbandonMs:i,numLocalResults:n}=t;E.default.logEvent("abandoned_search",o,{numKeystrokes:o,timeToAbandonMs:i,numLocalResults:n}),k.track(e,"quick_find_reciprocal_rank",{reciprocalRank:0,searchSessionId:t.searchSessionId}),E.default.logEvent("quick_find_reciprocal_rank",0,{searchSessionId:t.searchSessionId})}function us(e,t){k.track(e,"search_post_click_page_interaction",t)}function ms(e,t){k.track(e,"search_post_click_page_exit",{dwellTime:(new Date).getTime()-t.timeEntered.getTime()})}function gs(e,t){k.track(e,"offline_access_failure",t)}function hs(e,t){k.track(e,"open_view_all_popover",t)}function fs(e,t){k.track(e,"update_view_all_popover_sort",t)}function vs(e,t){k.track(e,"copy_link_from_view_all_popover",t)}function ys(e){k.track(e,"copy_link_from_permissions_setting")}function bs(e){k.track(e,"copy_web_link")}function Ss(e,t){k.track(e,"select_page_from_view_all_popover",t)}function ws(e,t){k.track(e,"show_waitlist_modal",t)}function ks(e,t){k.track(e,"join_waitlist",t)}function Cs(e,t){k.track(e,"copy_referral_link",t)}function _s(e,t){k.track(e,"share_referral_attempt",t)}function Ms(e,t){k.track(e,"dismiss_waitlist_modal",t)}function Ts(e){k.track(e,"dismiss_new_page_suggested_templates")}function Is(e){k.track(e,"transclusion_container_copy_button")}function Ps(e,t){k.track(e,"transclusion_container_open_backlinks",t)}function xs(e){k.track(e,"developer_integrations_list_visit")}function Bs(e){k.track(e,"developer_integrations_new_click")}function Zs(e,t){k.track(e,"developer_integrations_filter_click",t)}function Es(e,t){const o=S.developerIntegrationsTableToFilterType[t.table];k.track(e,"developer_integrations_view_visit",{type:o})}function Rs(e,t){const o=S.developerIntegrationsTableToFilterType[t.table];k.track(e,"developer_integrations_create",{type:o})}function As(e,t){const o=S.developerIntegrationsTableToFilterType[t.table];k.track(e,"developer_integrations_view_secret",{type:o})}function Ds(e,t){const o=S.developerIntegrationsTableToFilterType[t.table];k.track(e,"developer_integrations_copy_secret",{type:o})}function Fs(e,t){const o=S.developerIntegrationsTableToFilterType[t.table];k.track(e,"developer_integrations_toggle_type",{type:o})}function Ls(e,t){const o=S.developerIntegrationsTableToFilterType[t.table],{table:i,...n}=t;k.track(e,"developer_integrations_update",{type:o,...n})}function Vs(e,t){k.track(e,"developer_integrations_my_integrations_click",t)}function Ns(e,t){k.track(e,"developer_integrations_all_integrations_click",t)}function Os(e,t){k.track(e,"developer_integrations_visit_developer_website_click",t)}function Us(e,t){k.track(e,"developer_integrations_contact_developer_click",t)}function Hs(e,t){k.track(e,"developer_integrations_disconnect_click",t)}function zs(e,t){k.track(e,"developer_integrations_open_card_dropdown_click",t)}function Ws(e,t){k.track(e,"developer_integrations_delete_click",t)}function js(e,t){k.track(e,"developer_integrations_confirm_delete_click",t)}function Ks(e,t){k.track(e,"comment_upload_attachments",t)}function Ys(e,t){k.track(e,"open_comments_sidebar",t)}function Gs(e,t){k.track(e,"open_updates_sidebar",t)}function Xs(e,t){k.track(e,"updates_sidebar_tab_click",t)}function qs(e,t){k.track(e,"install_public_integration_oauth",t)}function $s(e,t){k.track(e,"connect_external_integration",t)}function Js(e,t){k.track(e,"disconnect_external_integration",t)}function Qs(e,t){k.track(e,"activate_link_preview_menu",t)}function el(e,t){k.track(e,"save_link_preview",t)}function tl(e,t){k.track(e,"update_link_preview",t)}function ol(e,t){k.track(e,"open_link_preview_help_guide",t)}function il(e,t){k.track(e,"remove_link_preview_with_error",t)}function nl(e,t){k.track(e,"link_preview_url_miss",t)}function rl(e,t){k.track(e,"show_all_discoverable_connected_apps",t)}const al={tracked:!1};function sl(e){let{environment:t,type:o,onboardingState:i}=e;if(al.tracked)return;const n={type:o,onboardingStage:null==i?void 0:i.stage};k.track(t,"cookie_banner_shown",n),al.tracked=!0}function ll(e){k.track(e,"cookie_modal_shown")}function cl(e,t){k.track(e,"coupon_typeform_clicked",t)}function dl(e,t){k.trackThrottled(e,"legacy_transclusion_show",`legacy_transclusion_show_${t.block_type}`,3600,t)}function pl(e,t){k.track(e,"transaction_timestamp_collision",t)}function ul(e,t){k.track(e,"transaction_timestamp_regression",t)}function ml(e,t){k.track(e,"transaction_race_hazard",t)}function gl(e,t){k.track(e,"transaction_async_data_loss",t)}function hl(e,t){k.track(e,"transaction_deadlock_warning",t)}function fl(e,t){k.track(e,"transaction_too_large",t)}function vl(e,t){k.track(e,"transaction_queue_error_show",t)}function yl(e){k.track(e,"connection_error_show",{})}function bl(e,t){k.track(e,"connection_error_indicator_details_show",t)}function Sl(e,t){k.track(e,"low_storage_error_show",t)}function wl(e,t){k.track(e,"transaction_queue_healthcheck",t)}function kl(e,t){return k.trackThrottled(e,"message_store_remote_version_update_failure","message_store_remote_version_update_failure",15,t)}function Cl(e,t){k.track(e,"message_store_remote_version_update_success",t)}function _l(e,t){return k.trackThrottled(e,"message_store_request_timeout","message_store_request_timeout",15,t)}function Ml(e,t){return k.trackThrottled(e,"message_store_request_success","message_store_request_success",15,t)}function Tl(e,t){k.track(e,"save_edits_error_modal_show",t)}function Il(e,t){k.track(e,"unsaved_transaction_error",t)}function Pl(e,t){k.track(e,"open_team_browser",t)}function xl(e,t){k.track(e,"close_team_browser",{...t,num_of_total_teams:t.num_of_joined_teams+t.num_of_unjoined_teams})}function Bl(e,t){k.track(e,"team_browser_search_cleared",t)}function Zl(e,t){const{teamStore:o,outliner_type:i}=t;tc(e,"team_browser_member_list_hover",{store:o,outliner_type:i})}function El(e,t){k.track(e,"create_team_start",{from:t.from,flow_id:t.flowId}),E.default.logEvent("create_team_start",1,t)}async function Rl(e,t){const{store:o}=t;await o.load(),tc(e,"create_team_complete",t),ec("create_team_complete",t)}async function Al(e,t){const{store:o}=t;await o.load(),tc(e,"enable_teams",t)}function Dl(e,t){const{screen:o,persona:i,selectedTypes:n,...r}=t,a=(0,_.c$)(),s=(0,_.KK)()||a;if(o===D.F.Team){const t={screen:"team",function:a?i:void 0,selectedTypes:a?n:[],...r};return tc(e,"close_create_team_modal",t),void ec("close_create_team_modal",t)}if(o===D.F.Types){const o={screen:"types",flow_id:t.flow_id,from:t.from,team_id:t.team_id,store:t.store,function:i,selectedTypes:n};return tc(e,"close_create_team_modal",o),void ec("close_create_team_modal",o)}const l={screen:"members",flow_id:t.flow_id,from:t.from,team_id:t.team_id,store:t.store,function:s?i:void 0,selectedTypes:s?n:[]};tc(e,"close_create_team_modal",l),ec("close_create_team_modal",l)}function Fl(e,t){tc(e,"add_apps_new_team_click",t),ec("add_apps_new_team_click",t)}function Ll(e,t){tc(e,"select_function_new_team_click",t)}function Vl(e,t){tc(e,"invite_team_members",t),ec("invite_team_members",t)}function Nl(e,t){tc(e,"invite_team_groups",t),ec("invite_team_groups",t)}function Ol(e,t){tc(e,"set_default_team",t)}function Ul(e,t){tc(e,"join_team",t),ec("join_team",t)}function Hl(e,t){tc(e,"archive_team",t)}function zl(e,t){tc(e,"transition_to_zero_teams",t)}function Wl(e,t){tc(e,"restore_team",t)}function jl(e,t){tc(e,"remove_team_members",t)}function Kl(e,t){tc(e,"remove_team_groups",t)}function Yl(e,t){tc(e,"change_teams_order",t)}function Gl(e,t){tc(e,"change_team_access_level",t)}function Xl(e,t){tc(e,"update_team_settings",t)}function ql(e,t){tc(e,"abandon_team_permissions_invite",t)}function $l(e,t){tc(e,"open_outliner_team_overflow",t)}function Jl(e,t){tc(e,"click_outliner_team_overflow_option",t),ec("click_outliner_team_overflow_option",t)}function Ql(e,t){tc(e,"click_page_outliner_dots",t)}function ec(e,t){const{store:o,...i}=t;o?E.default.logEvent(e,1,{...(0,k.getTeamEventData)(o),...i}):E.default.logEvent(e,1,t)}async function tc(e,t,o){const{store:i,...n}=o;i?await k.track(e,t,{...(0,k.getTeamEventData)(i),...n}):await k.track(e,t,{...n})}function oc(e,t){tc(e,"open_team_home",t)}function ic(e){switch(e){case F.a.General:return"general";case F.a.Members:return"members";case F.a.Security:return"security";default:(0,f.t1)(e)}}function nc(e,t){tc(e,"click_team_settings_tab",{store:t.store,tab_old_value:ic(t.tab_old_value),tab_new_value:ic(t.tab_new_value)})}function rc(e,t){tc(e,"restore_team_permissions",t)}function ac(e,t){tc(e,"team_invite_link_confirmation_selection",t)}function sc(e,t){tc(e,"copy_team_invite_link",t),ec("copy_team_invite_link",t)}function lc(e,t){tc(e,"click_team_invite_link",t)}function cc(e,t){tc(e,"request_access_to_team",t)}function dc(e,t){tc(e,"resolve_team_access_request",t)}function pc(e,t){k.track(e,"domain_verification_domain_added",t)}function uc(e,t){k.track(e,"domain_verification_verification_attempted",t)}function mc(e,t){k.track(e,"domain_verification_domain_verified",t)}function gc(e,t){k.track(e,"workspace_creation_ability",t)}function hc(e,t){k.track(e,"workspace_creation_setting_updated",t)}function fc(e,t){k.track(e,"claimable_spaces_viewed",t)}function vc(e,t){k.track(e,"space_transfer_requested",t)}function yc(e,t){k.track(e,"space_transfer_completed",t)}function bc(e,t){k.track(e,"space_claim_upgrade_requested",t)}function Sc(e,t){k.track(e,"space_claim_upgrade_completed",t)}function wc(e,t){k.track(e,"space_claim_deletion_started",t)}function kc(e,t){k.track(e,"space_claim_deletion_canceled",t)}function Cc(e,t){k.track(e,"move_to_error",t)}function _c(e,t){k.track(e,"show_user_validation_response",t)}function Mc(e){k.track(e,"zendesk_metadata_open_messenger")}function Tc(e){k.track(e,"zendesk_metadata_signup")}function Ic(e,t){k.track(e,"full_screen_action",t)}function Pc(e,t){k.track(e,"ai_action",t)}function xc(e,t){k.track(e,"ai_block_action",t)}function Bc(e,t){k.track(e,"ai_autofill_action",t)}function Zc(e,t){k.track(e,"ai_autofill_settings_action",t)}function Ec(e,t){k.track(e,"ai_completion_popup_open",t)}function Rc(e,t){k.track(e,"ai_completion_popup_close",t),E.default.logEvent("ai_completion_popup_close",1,{exit_type:t.exit_type})}function Ac(e,t){k.track(e,"ai_completion_popup_retry",t)}function Dc(e,t){k.track(e,"ai_completion_popup_history_navigation",t)}function Fc(e,t){k.track(e,"ai_completion_popup_preview_start",t),E.default.logEvent("ai_completion_popup_preview_start",1,{from:t.from,prompt_key:t.prompt_key})}function Lc(e,t){k.track(e,"ai_completion_popup_update_prompt_text",t)}function Vc(e,t){k.track(e,"ai_completion_popup_preview_end",t),E.default.logEvent("ai_completion_popup_preview_end",1,{preview_time:t.preview_time})}function Nc(e,t){k.track(e,"ai_completion_popup_preview_stopped_by_user",t)}function Oc(e,t){k.track(e,"ai_user_data_sharing_opt_in_submit",t)}function Uc(e,t){k.track(e,"recurrence_menu_open",t)}function Hc(e,t){k.track(e,"recurrence_saved",t)}function zc(e,t){k.track(e,"overview_analytics_filter_change",t)}function Wc(e,t){k.track(e,"user_analytics_engagement_timerange_filter_change",t)}function jc(e,t){k.track(e,"user_analytics_table_filter_change",t)}function Kc(e,t){k.track(e,"user_analytics_table_sort_change",t)}function Yc(e,t){k.track(e,"user_analytics_export_requested",t)}function Gc(e,t){k.track(e,"content_analytics_engagement_timerange_filter_change",t)}function Xc(e,t){k.track(e,"content_analytics_export_requested",t)}function qc(e,t){k.track(e,"content_analytics_table_filter_change",t)}function $c(e,t){k.track(e,"content_analytics_table_timerange_filter_change",t)}function Jc(e,t){k.track(e,"content_analytics_table_sort_change",t)}function Qc(e,t){k.track(e,"workspace_analytics_tab_click",t)}function ed(e,t){k.track(e,"search_analytics_table_timerange_filter_change",t)}function td(e,t){k.track(e,"search_analytics_table_sort_change",t)}function od(e){k.track(e,"admin_content_search_analytics_acknowledge_confirm")}function id(e,t){k.track(e,"admin_content_search_analytics_filter_change",t)}function nd(e,t){k.track(e,"admin_content_search_analytics_queried",t)}function rd(e,t){k.track(e,"admin_content_search_analytics_export_requested",t)}function ad(e,t){k.track(e,"wiki_convert",t),E.default.logEvent("wiki_convert",void 0,t)}function sd(e,t){k.track(e,"wiki_undo_conversion",t),E.default.logEvent("wiki_undo_conversion",void 0,t),h.j("wiki_undo_conversion",t)}function ld(e,t){k.track(e,"wiki_promo_show",t),E.default.logEvent("wiki_promo_show",void 0,t)}function cd(e){k.track(e,"wiki_promo_click_learn_more")}function dd(e){k.track(e,"wiki_promo_dismiss")}function pd(e,t){k.track(e,"verification_property_button_click",t)}function ud(e){k.track(e,"verification_date_picker_click")}function md(e,t){k.track(e,"verification_update",t)}function gd(e,t){k.track(e,"toggle_open_in_desktop_app",t)}function hd(e){k.track(e,"configure_open_in_desktop_app")}function fd(e){k.track(e,"open_in_desktop_app_popup_dismiss")}function vd(e){k.track(e,"open_in_desktop_app_popup_display")}function yd(e){k.track(e,"open_in_desktop_app_popup_download")}function bd(e,t){k.track(e,"open_in_desktop_app_popup_open_in_app",t)}function Sd(e){k.track(e,"add_slack_integration")}function wd(e){k.track(e,"remove_slack_integration")}function kd(e,t){k.track(e,"slack_notification_create",t)}function Cd(e,t){k.track(e,"slack_notification_delete",t)}function _d(e,t){k.track(e,"slack_notification_reactivate",t)}function Md(e,t){k.track(e,"slack_notification_update",t)}function Td(e,t){k.track(e,"click_team_new_page_option",t)}function Id(e,t){k.track(e,"show_team_duplicate_template_confirmation",t)}function Pd(e,t){k.track(e,"click_team_duplicate_template_confirmation_option",t)}function xd(e,t){k.track(e,"create_app_template",t)}function Bd(e,t){k.track(e,"payment_status_banner_displayed",t)}function Zd(e,t){k.track(e,"payment_status_banner_action",t)}},54885:(e,t,o)=>{o.d(t,{XE:()=>r,X3:()=>a,d_:()=>s,XD:()=>l});var i=o(51456),n=o(10161);function r(e,t){i.track(e,"app_preset_selection_shown",t),n.default.logEvent("app_preset_selection_shown",t.app_uri,t)}function a(e,t){i.track(e,"onboarding_app_selection",t),n.default.logEvent("onboarding_app_selection",t.preset,t)}function s(e,t){i.track(e,"app_preset_selection",t),n.default.logEvent("app_preset_selection",t.preset_uri,t)}function l(e,t){i.track(e,"app_preset_accepted",t),n.default.logEvent("app_preset_accepted",t.preset_uri,t)}},19719:(e,t,o)=>{o.d(t,{_b:()=>d,F5:()=>p,cC:()=>u,ix:()=>m,gY:()=>g,u_:()=>h,Z8:()=>f,EQ:()=>v,nI:()=>b,pw:()=>S,Up:()=>w,GP:()=>k,Q6:()=>C,Jn:()=>_,b2:()=>M,zD:()=>T,Xf:()=>I,U0:()=>P});var i=o(27328),n=o(82813),r=o(97880),a=o(4761),s=o(17659),l=o(51456),c=o(50906);function d(e){y({...e,target:"archive"})}function p(e){y({...e,target:"unarchive"})}function u(e){y({...e,target:"mark_as_read"})}function m(e){y({...e,target:"frame"})}function g(e){y({...e,target:"open_reply_menu"})}function h(e){y({...e,target:"mark_as_unread"})}function f(e){let{environment:t,pageId:o,isCurrentlyFollowing:i}=e;l.track(t,"click_page_updates_notifications_button",{pageId:o,isCurrentlyFollowing:i})}function v(e){let{environment:t,backlinkPageId:o,notificationId:i,alreadyRead:n,activity:r,tab:a}=e;y({environment:t,target:"title",notificationId:i,alreadyRead:n,activity:r,tab:a,otherArgs:{backlinkPageId:o}})}function y(e){let{environment:t,target:o,notificationId:i,alreadyRead:r,activity:s,tab:d,otherArgs:p}=e;S({environment:t,target:o});const u=a.ZP.state.sessionId;c.trackClickUpdate(t,{target:o,notification_id:i,activity_id:s.id,tab:d,sessionId:u,is_filtered:a.ZP.isFilteredToUnreadOnly(),...p}),i&&n.e(l.getClientEventTracker(t),{alreadyRead:r,notificationId:i,activityId:s.id,from:o,sessionId:u})}function b(e){const t=a.ZP.state.sessionId;t&&(l.track(e,"close_sidebar_updates",{sessionId:t,tab:_()}),a.ZP.endSession())}function S(e){let{environment:t,target:o}=e,i=!1;switch(o){case"title":case"body":i=!0;break;case"archive":case"unarchive":case"mark_as_read":case"mark_as_unread":case"add_reaction":case"open_reply_menu":case"frame":i=!1;break;default:(0,r.t1)(o)}i&&b(t)}function w(e){let{environment:t,from:o}=e;const n=(0,i.w_)(t.TabbedRouterStore.state);var r;"web"===(r=n).type&&"nativeTab"===r.route.name&&"updates"===r.route.tab&&k({environment:t,from:o})}function k(e){let{environment:t,forceRestartSession:o,from:i}=e;a.ZP.startSession({forceRestart:o??!1}),c.trackOpenAllUpdates(t,{tab:_(),unread_notifications_count:s.aY(),sessionId:a.ZP.state.sessionId,from:i})}function C(e){let{environment:t,activityUpdatesSource:o,filters:i,prevFilters:n}=e;l.track(t,"update_notification_filters",{source:o,prev_date_range_filter_start:n.dateRange.start,prev_date_range_filter_end:n.dateRange.end,prev_activity_types:n.activityTypes,date_range_filter_start:i.dateRange.start,date_range_filter_end:i.dateRange.end,activity_types:i.activityTypes})}function _(){const e=a.ZP.state.currentTab;switch(e){case"mentions":return"mentions_comments";case"archive":return"archive";case"allPages":return"all_updates";default:(0,r.t1)(e)}}function M(e){let{environment:t,action:o,args:i}=e;l.track(t,"push_notification_desktop",{...i,action:o})}function T(e,t){l.track(e,"archive_all_notifications",{...t,onlyRead:"read"===t.readFilter})}function I(e){l.track(e,"mark_all_notifications_as_read")}function P(e,t){l.track(e,"toggle_filter_for_unread_notifications",t)}},17224:(e,t,o)=>{o.d(t,{GZ:()=>r,dw:()=>a,$4:()=>s});var i=o(51456),n=o(50906);async function r(e,t){await i.track(e,"manage_teams_filter_click",t)}function a(e,t){i.track(e,"manage_teams_sort",t)}function s(e,t){n.trackEventWithTeamData(e,"duplicate_team",t)}},54642:(e,t,o)=>{o.r(t),o.d(t,{handleRecordMapForResponse:()=>B,pendingTaskIds:()=>L,getAssetsJson:()=>N,getAssetsJsonV2:()=>O,getAssetsJsonV3:()=>U,getAsanaWorkspaces:()=>H,getAsanaWorkspacesNames:()=>z,getTeamsAndProjectsInAsanaWorkspace:()=>W,getTrelloBoards:()=>j,duplicateBlock:()=>K,getActiveImportTasks:()=>Y,findUser:()=>G,search:()=>X,searchAuditLog:()=>q,searchContacts:()=>$,reportBadSearch:()=>J,getHistoricalAuditLogUsers:()=>Q,searchIntegrations:()=>ee,getBlockFileDownloadUrl:()=>te,setLocale:()=>oe,getRecentPageVisits:()=>ie,createEmailUser:()=>ne,updateSubscription:()=>re,sendMobileAppLink:()=>ae,submitFormstack:()=>se,getHarmonicData:()=>le,saveAssistantFeedback:()=>ce,performAiSearch:()=>de,getLivestormEvents:()=>pe,getLivestormSessions:()=>ue,getDesktopDownloadUrl:()=>me,cancelSubscription:()=>ge,getSubscriptionData:()=>he,getVisibleUsers:()=>fe,authenticateConfluenceUser:()=>ve,getConfluenceSpaces:()=>ye,disconnectConfluence:()=>be,importFile:()=>Se,importConfluenceExport:()=>we,parallelImportConfluenceExport:()=>ke,parallelImportConfluenceViaApi:()=>Ce,importTrello:()=>_e,importAsana:()=>Me,importAsanaIntoBetterTemplate:()=>Te,parallelAsanaImport:()=>Ie,importEvernote:()=>Pe,exportBlock:()=>xe,enqueueTask:()=>Be,loginWithAppleAuth:()=>Ze,loginWithAppleNativeAuth:()=>Ee,loginWithEmail:()=>Re,loginWithGoogleJwt:()=>Ae,loginWithGoogleAuth:()=>De,logout:()=>Fe,verifyEmail:()=>Le,addWebClipperFile:()=>Ve,sendTemporaryPassword:()=>Ne,getLoginOptions:()=>Oe,authGetLoginConfiguration:()=>Ue,getSamlRedirect:()=>He,disconnectAsana:()=>ze,disconnectTrello:()=>We,disconnectEvernote:()=>je,disconnectDrive:()=>Ke,getActivityLog:()=>Ye,changeEmail:()=>Ge,sendEmailVerification:()=>Xe,authCreateSms:()=>qe,authVerifySmsEnroll:()=>$e,authSendSms:()=>Je,authVerifySmsLogin:()=>Qe,authUpdateMfa:()=>et,getBacklinksForBlock:()=>tt,getBotToken:()=>ot,revokeBotToken:()=>it,getUploadFileUrl:()=>nt,deleteSpace:()=>rt,deleteUser:()=>at,getPublicPageData:()=>st,enableTeams:()=>lt,adminDeleteUser:()=>ct,adminListData:()=>dt,adminEditBlockPermissions:()=>pt,adminEditSpacePermissions:()=>ut,adminDescribeEditSpacePermission:()=>mt,adminSetPageContentClassification:()=>gt,adminDisableReverifyForUser:()=>ht,adminDescribeSpacesToDelete:()=>ft,adminDescribeRunSpaceConsolidation:()=>vt,adminDeleteSpaces:()=>yt,adminDescribeAccountsToReset:()=>bt,adminResetAccounts:()=>St,adminEditTeamMembership:()=>wt,adminUpdateTeamMember:()=>kt,adminUpdateUserSettings:()=>Ct,getInvoiceData:()=>_t,addUsersToSpace:()=>Mt,removeUsersFromSpace:()=>Tt,getJoinableSpaces:()=>It,getSpaces:()=>Pt,getBookmarks:()=>xt,deleteBlocks:()=>Bt,restoreBlock:()=>Zt,getUserAnalyticsSettings:()=>Et,syncRecordValues:()=>Rt,loadUserContent:()=>At,loadCachedPageChunk:()=>Dt,loadCachedPageChunks:()=>Ft,loadPageChunk:()=>Lt,queryCollection:()=>Vt,queryCollectionStream:()=>Nt,renameGroup:()=>Ot,deleteGroup:()=>Ut,getSelectPropertyValues:()=>Ht,getNotificationLog:()=>zt,getUnvisitedNotificationIds:()=>Wt,trackSegmentEvent:()=>jt,identifySegmentWorkspace:()=>Kt,identifySegmentUser:()=>Yt,setNotificationsAsRead:()=>Gt,getUserNotifications:()=>Xt,setPageNotificationsAsRead:()=>qt,setSpaceNotificationsAsRead:()=>$t,unsubscribeFromEmails:()=>Jt,leaveBlock:()=>Qt,getPublicSpaceData:()=>eo,loadBlockSubtree:()=>to,initializeUserAnalytics:()=>oo,initializeUserAnalyticsEmptySync:()=>io,checkFilePermission:()=>ro,getBillingHistory:()=>ao,exportSpace:()=>so,exportAuditLog:()=>lo,exportUserAnalytics:()=>co,exportContentAnalytics:()=>po,exportAdminContentSearch:()=>uo,transferPermissionGroup:()=>mo,disableUserAnalytics:()=>go,createReferral:()=>ho,unsubscribeFromIntercomEmails:()=>fo,getBots:()=>vo,getSnapshotsList:()=>yo,getSnapshotContents:()=>bo,restoreSnapshot:()=>So,activateReferral:()=>wo,setBookmarkMetadata:()=>ko,authWithAsana:()=>Co,getConnectedAppsStatus:()=>_o,getCompletion:()=>Mo,authWithTrello:()=>To,authWithSlack:()=>Io,authWithGoogleForDrive:()=>Po,authWithExternalIntegration:()=>xo,getGoogleDriveAccounts:()=>Bo,initializeGoogleDriveBlock:()=>Zo,refreshGoogleDriveBlock:()=>Eo,getEvernoteNotebooks:()=>Ro,getWebClipperData:()=>Ao,addWebClipperURLs:()=>Do,searchWebClipperPages:()=>Fo,authWithEvernote:()=>Lo,recoverUser:()=>Vo,ping:()=>No,recoverSpace:()=>Oo,revokeUserTokens:()=>Uo,exportBlockPreview:()=>Ho,initializePageTemplate:()=>zo,finalizeAppTemplate:()=>Wo,adminSearchUsers:()=>jo,adminGetClientExperiments:()=>Ko,adminGetStatsigExperiment:()=>Yo,adminGetStatsigFeatureGate:()=>Go,adminCheckStatsigSegment:()=>Xo,adminUpdateStatsigSegmentIds:()=>qo,adminFindDeletedUser:()=>$o,adminWhitelistCreditDomain:()=>Jo,searchUnsplashImages:()=>Qo,searchGiphyImages:()=>ei,getGiphyRandomId:()=>ti,postGiphyAnalytics:()=>oi,adminSearchSpaces:()=>ii,adminSearchForUsersInSpaces:()=>ni,adminGetDataAccessConsent:()=>ri,adminGetBulkSpaceIdsByDomain:()=>ai,adminGetBulkSpaceIdsByEmail:()=>si,adminGetBulkUserIdsByEmail:()=>li,adminSearchBlocks:()=>ci,adminSearchTeams:()=>di,adminRecoverMfa:()=>pi,adminRemoveSpaceUsersAndTransferContent:()=>ui,adminGetUserBillingInformation:()=>mi,adminAddEmailToBypass:()=>gi,adminSamlConfigForSpace:()=>hi,getSamlConfigForSpace:()=>fi,getEmailDomainsForSpace:()=>vi,getManagedUsers:()=>yi,getClientExperiments:()=>bi,getClientExperimentsV2:()=>Si,adminViewExperiments:()=>wi,adminUpdateExperiment:()=>ki,adminSetupExperiment:()=>Ci,updateSubscriptionToEducationPlan:()=>_i,adminUpdateSubscription:()=>Mi,adminCancelSubscription:()=>Ti,allowEducationEmails:()=>Ii,isEmailEducation:()=>Pi,getPromoCode:()=>xi,getGenericEmbedBlockData:()=>Bi,isUserDomainJoinable:()=>Zi,adminChangeEmail:()=>Ei,setPassword:()=>Ri,logoutActiveSessions:()=>Ai,createSpace:()=>Di,adminSetDisableSpacePublicAccess:()=>Fi,adminSetSpaceDomain:()=>Li,saveTransactions:()=>Vi,moveToSpace:()=>Ni,inviteGuestsToSpace:()=>Oi,refreshInviteLink:()=>Ui,adminAddPublicEmailDomains:()=>Hi,adminShowCustomerInvoice:()=>zi,adminSwapUserDomains:()=>Wi,adminSwapUserEmails:()=>ji,getUserTasks:()=>Ki,getTasks:()=>Yi,getTestFlightStatus:()=>Gi,getAccessRequests:()=>Xi,getUnreadAccessRequestCount:()=>qi,requestAccess:()=>$i,submitCsatFeedback:()=>Ji,getDataAccessConsent:()=>Qi,setDataAccessConsent:()=>en,getCsatMilestones:()=>tn,getTemplateChecklistForBlock:()=>on,getPageVisitors:()=>nn,recordPageVisit:()=>rn,recordPageExit:()=>an,spaceAdminRestoreAccess:()=>sn,trackConversionEvent:()=>ln,updateSpaceDomain:()=>cn,updatePublicHomePage:()=>dn,getUserSharedPagesInSpace:()=>pn,getUserHomePages:()=>un,getAvailableCountries:()=>mn,invalidateSubscriptionData:()=>gn,getUserAdminApiLog:()=>hn,getSpaceAdminApiLog:()=>fn,getBlockAdminApiLog:()=>vn,getAdminHistory:()=>yn,reportPage:()=>bn,adminGetOwnership:()=>Sn,adminGetRateLimits:()=>wn,adminGetSamlConfig:()=>kn,adminPrimaryWorkspaceChange:()=>Cn,adminDeleteFileFromS3:()=>_n,adminDescribeDeleteFileFromS3:()=>Mn,adminGetSpacesForAllowedEmailDomain:()=>Tn,adminResetRateLimits:()=>In,annotateRecentIntercomConversation:()=>Pn,adminModifyBlock:()=>xn,adminRestoreBlock:()=>Bn,adminDescribeDeletedBlockPermissions:()=>Zn,resolveAddress:()=>En,getDeveloperBotsAndIntegrations:()=>Rn,getIntegrationDomainVerifications:()=>An,getIntegrationSecret:()=>Dn,adminBulkAddPromotionCodes:()=>Fn,adminRemoveAllowedEducationEmails:()=>Ln,adminBulkApplyPromotionCodes:()=>Vn,calculateTax:()=>Nn,chat:()=>On,checkSpaceDomain:()=>Un,deleteBot:()=>Hn,deleteIntegration:()=>zn,adminBlockEmailDomain:()=>Wn,adminSearchPermanentlyDeletedPages:()=>jn,adminSearchSpaceActivity:()=>Kn,adminCopyPageBetweenEnvironments:()=>Yn,adminCountWordsInPage:()=>Gn,getExternalIntegrations:()=>Xn,getUserSpaceExternalBots:()=>qn,createOauthAuthorizationCode:()=>$n,adminGetPublicPages:()=>Jn,adminRestoreDeletedCollectionProperties:()=>Qn,adminViewDeletedCollectionProperties:()=>er,unfurlUrl:()=>tr,resubscribeExternalCollection:()=>or,getExternalCollectionSyncState:()=>ir,getEmailsWithoutAccessToBlock:()=>nr,processShareActionToBlock:()=>rr,updateExperimentOverride:()=>ar,resetExperimentOverrides:()=>sr,refetchExternalObjectInstanceBlocks:()=>lr,listExternalCollections:()=>cr,listExternalObjects:()=>dr,createTeam:()=>pr,setAdminPrivilegedTeamMembership:()=>ur,updateTeamMembers:()=>mr,getTeams:()=>gr,getAllTeamsInSpaceForAdmin:()=>hr,getPrivatePageInfo:()=>fr,markDiscussionNotificationsRead:()=>vr,getIntegrationDataForGallery:()=>yr,getIntegrationIdsForGallery:()=>br,recordCookieConsent:()=>Sr,adminGetIntegrationData:()=>wr,adminUpdateIntegrationData:()=>kr,adminGetSlackIntegrationData:()=>Cr,adminGetSyncedDatabaseData:()=>_r,adminJoinSpacesForOauthRedirect:()=>Mr,adminForceResyncExternalObjects:()=>Tr,getRecoverableSpaceUserContent:()=>Ir,transferSpaceUserContent:()=>Pr,adminCreateMarketingRoute:()=>xr,adminBanUser:()=>Br,adminIsSpaceDomainClaimEligible:()=>Zr,adminGetDomainClaimEligibleSpaces:()=>Er,adminGetDomainManagementSettings:()=>Rr,adminClaimAndUpgradeForSalesAssisted:()=>Ar,adminDelayClaimSpaceDeletion:()=>Dr,adminRemoveChildFromExternalCollection:()=>Fr,adminRunSpaceConsolidation:()=>Lr,deleteDomainVerificationCode:()=>Vr,verifyDomain:()=>Nr,createDomainVerificationCode:()=>Or,getDomainVerificationCodesForSpace:()=>Ur,updateWorkspaceCreationForEmailDomains:()=>Hr,validateUserCanCreateWorkspace:()=>zr,setSamlConfig:()=>Wr,getSpacesCreatedByUserWithDomains:()=>jr,initiateWorkspaceTransfer:()=>Kr,getCostForSpaceUpgrade:()=>Yr,claimAndUpgradeSpace:()=>Gr,requestClaimAndUpgrade:()=>Xr,transferWorkspaceToUser:()=>qr,deleteSpaceForDomain:()=>$r,cancelSpaceDeletionForDomain:()=>Jr,adminDowngradeFraudSubscription:()=>Qr,initiateMultipartUpload:()=>ea,completeMultipartUpload:()=>ta,getTypedDatabases:()=>oa,getCollectionViewBlocksByAppId:()=>ia,getPageAnalytics:()=>na,getCustomerOffer:()=>ra,applyCustomerOffer:()=>aa,getExternalIntegrationAccessToken:()=>sa,sendVerifyTransferEmail:()=>la,getDailyUsersAnalytics:()=>ca,getUserEngagementAnalytics:()=>da,getContentEngagementAnalytics:()=>pa,loadWorkspaceAnalyticsUsers:()=>ua,loadContentAnalytics:()=>ma,loadSearchAnalytics:()=>ga,getVerifiedEmailDomain:()=>ha,getExternalNotificationChannels:()=>fa,adminContentSearch:()=>va,searchVectors:()=>ya,getInferenceTestExamples:()=>ba,isEligibleForGuestMembershipRequest:()=>Sa,setSeenGuestMembershipRequests:()=>wa,getAboutNotionDevelopers:()=>ka,loadContacts:()=>Ca,registerDesktopApp:()=>_a,getDesktopAppRegistration:()=>Ma,getPublicApiObject:()=>Ta,authCreateTotp:()=>Ia,authVerifyTotpLogin:()=>Pa,authVerifyTotpEnroll:()=>xa,authCreateBackupCodes:()=>Ba,authVerifyBackupCodesLogin:()=>Za,authVerifyPassword:()=>Ea,setRecordKey:()=>Ra,isRecordKeyAvailable:()=>Aa,getIdFromUniqueId:()=>Da,suggestRecordKey:()=>Fa,adminUpdateAddOnSubscription:()=>La,getAIUsageEligibility:()=>Va,getCompletionForProperty:()=>Na,adminUpdateNotionAIAvailabilityForSpace:()=>Oa,adminAddWebhookSubscriptionWithBot:()=>Ua,adminGetSpaceMembershipUpdates:()=>Ha,adminBulkCreateTimedTrials:()=>za,getGeoIpLocation:()=>Wa,getTeamAccessRequestMetadata:()=>ja,stripeAdvanceTestClock:()=>Ka,adminOptOutNotionAIDataSharing:()=>Ya,getTransitivePageRelations:()=>Ga,loadCachedPageChunkBatched:()=>qa,syncRecordValue:()=>Ja,getSignedFileUrl:()=>os,pendingTaskEventsById:()=>is});var i=o(96486),n=o.n(i),r=o(39593),a=o.n(r),s=o(13991),l=o(28084),c=o(54064),d=o(43593),p=o(65917),u=o(59730),m=o(74229),g=o(45953),h=o(32739),f=o(63143),v=o(95477),y=o(29350),b=o(33954),S=o(34809),w=o(33665),k=o(79315),C=o(88632),_=o(79167),M=o(50906),T=o(47307),I=o(97977),P=o(4408),x=o(761);function B(e){const{environment:t,eventName:o,response:i,userId:n}=e;if(i&&i.recordMap){const e=g.Ak.create(i.recordMap);"syncRecordValues"!==o&&P.fL({environment:t,userId:n,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,recordMap:e,maybeStaleRecordMap:"loadCachedPageChunk"===o||"loadCachedPageChunks"===o,debugSource:"handleRecordMapForResponse"})}}let Z;async function E(e,t,o,i){if((0,u.tn)(o.body)){T.showError(o);const t=o.body.clientData&&(0,b.cq)(o.body.clientData);M.trackShowUserValidationResponse(e,{type:null==t?void 0:t.type})}if(o.offline)return o;console.error(o.error);const{RouterStore:r}=e;if(401===o.status&&p.log({level:"error",from:"api",type:"httpTrigger401",data:{eventName:t,isLoggedIn:e.currentUser.isLoggedIn(),miscDataToConvertToString:{response:o},routeName:r.state.route.name}}),403===o.status&&o.headers["content-type"]&&o.headers["content-type"].startsWith("text/html")&&p.logWithSampleRate({logMessage:{level:"error",from:"api",type:"httpTrigger403",data:{eventName:t,isLoggedIn:e.currentUser.isLoggedIn(),miscDataToConvertToString:{response:o},userId:e.currentUser.id,routeName:r.state.route.name}},samplePercentage:1}),401===o.status&&Boolean(o.body&&o.body.errorId)&&e.currentUser.isLoggedIn())switch(r.state.route.name){case"page":if((0,w.Sr)()){await I.actuallyLogoutAndDeleteAllLocalData(e,window.location.pathname);break}case"root":case"space":case"onboarding":case"myIntegrations":if(i&&i===e.currentUser.id){const t=n().debounce((async()=>await Fe(e,{userId:i})),1e3);await t();const r=await I.clearCurrentUser(e);I.redirectToLoginOnErrorResponse(r,o)}}return o}async function R(e){const{environment:t,eventName:o,data:i,userId:r,tracking:a,abortSignal:s,prefetchCacheKey:l}=e;!function(e){for(const t of Object.keys(e)){const o=e[t];(n().isNull(o)||n().isUndefined(o))&&delete e[t]}}(i);const c=r||t.currentUser.id,d=(0,y.y)({environment:t,eventName:o,data:i,activeUserId:c,tracking:a,abortSignal:s});let u;l&&t.prefetchCache&&(u=t.prefetchCache.getPrefetchedHttpRequest(l,d,s)),u||(u=(0,S.Z)(d));const m=await u;return"success"===m.type?(B({environment:t,eventName:o,response:m.data,userId:c}),function(e){const{environment:t,responseUserId:o,eventName:i}=e;if(!o)return;if("saveTransactions"!==i)return;const{id:n}=t.currentUser;if(o!==n){if(Z===o)return;const{currentUserStore:e,currentUserRootStore:r,currentUserSettingsStore:a,currentSpaceViewStore:s}=k.default.state,l=n||"<undefined>",c=`currentUser ${l} didn't match user's cookie ${o}`;p.log({from:"client/api",level:"error",type:"currentUserWrong",data:{eventName:i,miscDataToConvertToString:{responseUserId:o,connectionStoreState:C.Z.state,currentUserId:l,userStoreId:e&&e.id,userRootStoreId:r&&r.id,userSettingsStoreId:a&&a.id,currentSpaceViewStoreParentId:s&&s.getParentId()},message:c}}),Z=o,"production"!==v.Z.env&&t.device.isMobile&&T.showErrorMessage(c)}else Z=void 0}({environment:t,eventName:o,responseUserId:m.headers["X-Notion-User-Id"]}),m):E(t,o,m,c)}function A(e){return function(t,o,i,n,r,a){return R({environment:t,eventName:e,data:o,userId:i,tracking:n,abortSignal:r,prefetchCacheKey:a})}}function D(e){return async function(t,o,i,n){const r=i||t.currentUser.id,a=(0,y.t)({environment:t,eventName:e,data:o,activeUserId:r,tracking:n,abortSignal:void 0,format:"jsonStream"}),s=await(0,S.Z)(a);return"failed"===s.type?E(t,e,s,r):(m.H1.is(s.data)?s.data=m.H1.filter(s.data,(e=>!g.qH.is(e)||(function(e){const{environment:t,recordWithRoleAndPointer:o,userId:i}=e;P.Wl({environment:t,userId:i,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,pointer:o.pointer,recordWithRole:o.record,updatePaths:[[]],maybeStaleRecordMap:!1,debugSource:"handleRecordStreamForResponse"})}({environment:t,recordWithRoleAndPointer:e,userId:r}),!1))):B({environment:t,eventName:e,response:s.data,userId:r}),s)}}const F=async function(e){return new Promise(((t,o)=>{is.addOnceListener(e,(e=>{t(e)}))}))},L=new Set,V=function(e){return async function*(t,o){const i={task:{eventName:e,request:o}},n=await Be(t,i);if("failed"===n.type)yield{error:n.error,taskStatus:"not_started"};else{const{taskId:i}=n.data;for(L.add(i);;){const n=await F(i);if("success"===n.state){const o=n.status;B({environment:t,eventName:e,response:o}),yield{value:o,taskStatus:n.state};break}if("failure"===n.state){yield{error:new u.hm(n.error||"Something went wrong.",{eventName:e,request:o},n.clientData),taskStatus:n.state};break}"in_progress"===n.state&&n.status&&(yield{value:n.status,taskStatus:n.state})}}}},N=A("getAssetsJson"),O=A("getAssetsJsonV2"),U=A("getAssetsJsonV3"),H=A("getAsanaWorkspaces"),z=A("getAsanaWorkspacesNames"),W=A("getTeamsAndProjectsInAsanaWorkspace"),j=A("getTrelloBoards"),K=V("duplicateBlock"),Y=A("getActiveImportTasks"),G=A("findUser"),X=A("search"),q=A("searchAuditLog"),$=A("searchContacts"),J=A("reportBadSearch"),Q=A("getHistoricalAuditLogUsers"),ee=A("searchIntegrations"),te=A("getBlockFileDownloadUrl"),oe=A(`set${s.bg}`),ie=A("getRecentPageVisits"),ne=A("createEmailUser"),re=A("updateSubscription"),ae=A("sendMobileAppLink"),se=A("submitFormstack"),le=A("getHarmonicData"),ce=A("saveAssistantFeedback"),de=A("performAiSearch"),pe=A("getLivestormEvents"),ue=A("getLivestormSessions"),me=A("getDesktopDownloadUrl"),ge=A("cancelSubscription"),he=A("getSubscriptionData"),fe=A("getVisibleUsers"),ve=A("authenticateConfluenceUser"),ye=A("getConfluenceSpaces"),be=A("disconnectConfluence"),Se=V("importFile"),we=V("importConfluenceExport"),ke=V("parallelImportConfluenceExport"),Ce=V("parallelImportConfluenceViaApi"),_e=V("importTrello"),Me=V("importAsana"),Te=V("importAsanaIntoBetterTemplate"),Ie=V("parallelAsanaImport"),Pe=V("importEvernote"),xe=V("exportBlock"),Be=A("enqueueTask"),Ze=A("loginWithAppleAuth"),Ee=A("loginWithAppleNativeAuth"),Re=A("loginWithEmail"),Ae=A("loginWithGoogleJwt"),De=A("loginWithGoogleAuth"),Fe=A("logout"),Le=A("verifyEmail"),Ve=A("addWebClipperFile"),Ne=A("sendTemporaryPassword"),Oe=A("getLoginOptions"),Ue=A("authGetLoginConfiguration"),He=A("getSamlRedirect"),ze=A("disconnectAsana"),We=A("disconnectTrello"),je=A("disconnectEvernote"),Ke=A("disconnectDrive"),Ye=A("getActivityLog"),Ge=A("changeEmail"),Xe=A("sendEmailVerification"),qe=A("authCreateSms"),$e=A("authVerifySmsEnroll"),Je=A("authSendSms"),Qe=A("authVerifySmsLogin"),et=A("authUpdateMfa"),tt=A("getBacklinksForBlock"),ot=A("getBotToken"),it=A("revokeBotToken"),nt=A("getUploadFileUrl"),rt=V("deleteSpace"),at=A("deleteUser"),st=A("getPublicPageData"),lt=A("enableTeams"),ct=A("adminDeleteUser"),dt=A("adminListData"),pt=A("adminEditBlockPermissions"),ut=A("adminEditSpacePermissions"),mt=A("adminDescribeEditSpacePermission"),gt=A("adminSetPageContentClassification"),ht=A("adminDisableReverifyForUser"),ft=A("adminDescribeSpacesToDelete"),vt=A("adminDescribeRunSpaceConsolidation"),yt=A("adminDeleteSpaces"),bt=A("adminDescribeAccountsToReset"),St=A("adminResetAccounts"),wt=A("adminEditTeamMembership"),kt=A("adminUpdateTeamMember"),Ct=A("adminUpdateUserSettings"),_t=A("getInvoiceData"),Mt=A("addUsersToSpace"),Tt=A("removeUsersFromSpace"),It=A("getJoinableSpaces"),Pt=A("getSpaces"),xt=A("getBookmarks"),Bt=A("deleteBlocks"),Zt=A("restoreBlock"),Et=A("getUserAnalyticsSettings"),Rt=A("syncRecordValues"),At=A("loadUserContent"),Dt=A("loadCachedPageChunk"),Ft=A("loadCachedPageChunks"),Lt=A("loadPageChunk"),Vt=A("queryCollection"),Nt=D("queryCollection"),Ot=V("renameGroup"),Ut=V("deleteGroup"),Ht=A("getSelectPropertyValues"),zt=A("getNotificationLog"),Wt=A("getUnvisitedNotificationIds"),jt=A("trackSegmentEvent"),Kt=A("identifySegmentWorkspace"),Yt=A("identifySegmentUser"),Gt=A("setNotificationsAsRead"),Xt=A("getUserNotifications"),qt=A("setPageNotificationsAsRead"),$t=A("setSpaceNotificationsAsRead"),Jt=A("unsubscribeFromEmails"),Qt=A("leaveBlock"),eo=A("getPublicSpaceData"),to=A("loadBlockSubtree"),oo=A("initializeUserAnalytics"),io=A("initializeUserAnalyticsEmptySync"),no=A("getSignedFileUrls"),ro=A("checkFilePermission"),ao=A("getBillingHistory"),so=V("exportSpace"),lo=V("exportAuditLog"),co=V("exportUserAnalytics"),po=V("exportContentAnalytics"),uo=V("exportAdminContentSearch"),mo=A("transferPermissionGroup"),go=A("disableUserAnalytics"),ho=A("createReferral"),fo=A("unsubscribeFromIntercomEmails"),vo=A("getBots"),yo=A("getSnapshotsList"),bo=A("getSnapshotContents"),So=V("restoreSnapshot"),wo=A("activateReferral"),ko=A("setBookmarkMetadata"),Co=A("authWithAsana"),_o=A("getConnectedAppsStatus"),Mo=D("getCompletion"),To=A("authWithTrello"),Io=A("authWithSlack"),Po=A("authWithGoogleForDrive"),xo=A("authWithExternalIntegration"),Bo=A("getGoogleDriveAccounts"),Zo=A("initializeGoogleDriveBlock"),Eo=A("refreshGoogleDriveBlock"),Ro=A("getEvernoteNotebooks"),Ao=A("getWebClipperData"),Do=A("addWebClipperURLs"),Fo=A("searchWebClipperPages"),Lo=A("authWithEvernote"),Vo=A("recoverUser"),No=A("ping"),Oo=A("recoverSpace"),Uo=A("revokeUserTokens"),Ho=A("exportBlockPreview"),zo=A("initializePageTemplate"),Wo=A("finalizeAppTemplate"),jo=A("adminSearchUsers"),Ko=A("adminGetClientExperiments"),Yo=A("adminGetStatsigExperiment"),Go=A("adminGetStatsigFeatureGate"),Xo=A("adminCheckStatsigSegment"),qo=A("adminUpdateStatsigSegmentIds"),$o=A("adminFindDeletedUser"),Jo=A("adminWhitelistCreditDomain"),Qo=A("searchUnsplashImages"),ei=A("searchGiphyImages"),ti=A("getGiphyRandomId"),oi=A("postGiphyAnalytics"),ii=A("adminSearchSpaces"),ni=A("adminSearchForUsersInSpaces"),ri=A("adminGetDataAccessConsent"),ai=A("adminGetBulkSpaceIdsByDomain"),si=A("adminGetBulkSpaceIdsByEmail"),li=A("adminGetBulkUserIdsByEmail"),ci=A("adminSearchBlocks"),di=A("adminSearchTeams"),pi=A("adminRecoverMfa"),ui=A("adminRemoveSpaceUsersAndTransferContent"),mi=A("adminGetUserBillingInformation"),gi=A("adminAddEmailToBypass"),hi=A("adminSamlConfigForSpace"),fi=A("getSamlConfigForSpace"),vi=A("getEmailDomainsForSpace"),yi=A("getManagedUsers"),bi=A("getClientExperiments"),Si=A("getClientExperimentsV2"),wi=A("adminViewExperiments"),ki=A("adminUpdateExperiment"),Ci=A("adminSetupExperiment"),_i=A("updateSubscriptionToEducationPlan"),Mi=A("adminUpdateSubscription"),Ti=A("adminCancelSubscription"),Ii=A("allowEducationEmails"),Pi=A("isEmailEducation"),xi=A("getPromoCode"),Bi=A("getGenericEmbedBlockData"),Zi=A("isUserDomainJoinable"),Ei=A("adminChangeEmail"),Ri=A("setPassword"),Ai=A("logoutActiveSessions"),Di=A("createSpace"),Fi=A("adminSetDisableSpacePublicAccess"),Li=A("adminSetSpaceDomain"),Vi=A("saveTransactions"),Ni=V("moveToSpace"),Oi=A("inviteGuestsToSpace"),Ui=A("refreshInviteLink"),Hi=A("adminAddPublicEmailDomains"),zi=A("adminShowCustomerInvoice"),Wi=A("adminSwapUserDomains"),ji=A("adminSwapUserEmails"),Ki=A("getUserTasks"),Yi=A("getTasks"),Gi=A("getTestFlightStatus"),Xi=A("getAccessRequests"),qi=A("getUnreadAccessRequestCount"),$i=A("requestAccess"),Ji=A("submitCsatFeedback"),Qi=A("getDataAccessConsent"),en=A("setDataAccessConsent"),tn=A("getCsatMilestones"),on=A("getTemplateChecklistForBlock"),nn=A("getPageVisitors"),rn=A("recordPageVisit"),an=A("recordPageExit"),sn=A("spaceAdminRestoreAccess"),ln=A("trackConversionEvent"),cn=A("updateSpaceDomain"),dn=A("updatePublicHomePage"),pn=A("getUserSharedPagesInSpace"),un=A("getUserHomePages"),mn=A("getAvailableCountries"),gn=A("invalidateSubscriptionData"),hn=A("getUserAdminApiLog"),fn=A("getSpaceAdminApiLog"),vn=A("getBlockAdminApiLog"),yn=A("getAdminHistory"),bn=A("reportPage"),Sn=A("adminGetOwnership"),wn=A("adminGetRateLimits"),kn=A("adminGetSamlConfig"),Cn=A("adminPrimaryWorkspaceChange"),_n=A("adminDeleteFileFromS3"),Mn=A("adminDescribeDeleteFileFromS3"),Tn=A("adminGetSpacesForAllowedEmailDomain"),In=A("adminResetRateLimits"),Pn=A("annotateRecentIntercomConversation"),xn=A("adminModifyBlock"),Bn=A("adminRestoreBlock"),Zn=A("adminDescribeDeletedBlockPermissions"),En=A("resolveAddress"),Rn=A("getDeveloperBotsAndIntegrations"),An=A("getIntegrationDomainVerifications"),Dn=A("getIntegrationSecret"),Fn=A("adminBulkAddPromotionCodes"),Ln=A("adminRemoveAllowedEducationEmails"),Vn=A("adminBulkApplyPromotionCodes"),Nn=A("calculateTax"),On=D("chat"),Un=A("checkSpaceDomain"),Hn=A("deleteBot"),zn=A("deleteIntegration"),Wn=A("adminBlockEmailDomain"),jn=A("adminSearchPermanentlyDeletedPages"),Kn=A("adminSearchSpaceActivity"),Yn=A("adminCopyPageBetweenEnvironments"),Gn=A("adminCountWordsInPage"),Xn=A("getExternalIntegrations"),qn=A("getUserSpaceExternalBots"),$n=A("createOauthAuthorizationCode"),Jn=A("adminGetPublicPages"),Qn=A("adminRestoreDeletedCollectionProperties"),er=A("adminViewDeletedCollectionProperties"),tr=A("unfurlUrl"),or=A("resubscribeExternalCollection"),ir=A("getExternalCollectionSyncState"),nr=A("getEmailsWithoutAccessToBlock"),rr=A("processShareActionToBlock"),ar=A("updateExperimentOverride"),sr=A("resetExperimentOverrides"),lr=A("refetchExternalObjectInstanceBlocks"),cr=A("listExternalCollections"),dr=A("listExternalObjects"),pr=A("createTeam"),ur=A("setAdminPrivilegedTeamMembership"),mr=A("updateTeamMembers"),gr=A("getTeams"),hr=A("getAllTeamsInSpaceForAdmin"),fr=A("getPrivatePageInfo"),vr=A("markDiscussionNotificationsRead"),yr=A("getIntegrationDataForGallery"),br=A("getIntegrationIdsForGallery"),Sr=A("recordCookieConsent"),wr=A("adminGetIntegrationData"),kr=A("adminUpdateIntegrationData"),Cr=A("adminGetSlackIntegrationData"),_r=A("adminGetSyncedDatabaseData"),Mr=A("adminJoinSpacesForOauthRedirect"),Tr=A("adminForceResyncExternalObjects"),Ir=A("getRecoverableSpaceUserContent"),Pr=A("transferSpaceUserContent"),xr=A("adminCreateMarketingRoute"),Br=A("adminBanUser"),Zr=A("adminIsSpaceDomainClaimEligible"),Er=A("adminGetDomainClaimEligibleSpaces"),Rr=A("adminGetDomainManagementSettings"),Ar=A("adminClaimAndUpgradeForSalesAssisted"),Dr=A("adminDelayClaimSpaceDeletion"),Fr=A("adminRemoveChildFromExternalCollection"),Lr=A("adminRunSpaceConsolidation"),Vr=A("deleteDomainVerificationCode"),Nr=A("verifyDomain"),Or=A("createDomainVerificationCode"),Ur=A("getDomainVerificationCodesForSpace"),Hr=A("updateWorkspaceCreationForEmailDomains"),zr=A("validateUserCanCreateWorkspace"),Wr=A("setSamlConfig"),jr=A("getSpacesCreatedByUserWithDomains"),Kr=A("initiateWorkspaceTransfer"),Yr=A("getCostForSpaceUpgrade"),Gr=A("claimAndUpgradeSpace"),Xr=A("requestClaimAndUpgrade"),qr=A("transferWorkspaceToUser"),$r=A("deleteSpaceForDomain"),Jr=A("cancelSpaceDeletionForDomain"),Qr=A("adminDowngradeFraudSubscription"),ea=A("initiateMultipartUpload"),ta=A("completeMultipartUpload"),oa=A("getTypedDatabases"),ia=A("getCollectionViewBlocksByAppId"),na=A("getPageAnalytics"),ra=A("getCustomerOffer"),aa=A("applyCustomerOffer"),sa=A("getExternalIntegrationAccessToken"),la=A("sendVerifyTransferEmail"),ca=A("getDailyUsersAnalytics"),da=A("getUserEngagementAnalytics"),pa=A("getContentEngagementAnalytics"),ua=A("loadWorkspaceAnalyticsUsers"),ma=A("loadContentAnalytics"),ga=A("loadSearchAnalytics"),ha=A("getVerifiedEmailDomain"),fa=A("getExternalNotificationChannels"),va=A("adminContentSearch"),ya=A("searchVectors"),ba=A("getInferenceTestExamples"),Sa=A("isEligibleForGuestMembershipRequest"),wa=A("setSeenGuestMembershipRequests"),ka=A("getAboutNotionDevelopers"),Ca=A("loadContacts"),_a=A("registerDesktopApp"),Ma=A("getDesktopAppRegistration"),Ta=A("getPublicApiObject"),Ia=A("authCreateTotp"),Pa=A("authVerifyTotpLogin"),xa=A("authVerifyTotpEnroll"),Ba=A("authCreateBackupCodes"),Za=A("authVerifyBackupCodesLogin"),Ea=A("authVerifyPassword"),Ra=A("setRecordKey"),Aa=A("isRecordKeyAvailable"),Da=A("getIdFromUniqueId"),Fa=A("suggestRecordKey"),La=A("adminUpdateAddOnSubscription"),Va=A("getAIUsageEligibility"),Na=D("getCompletionForProperty"),Oa=A("adminUpdateNotionAIAvailabilityForSpace"),Ua=A("adminAddWebhookSubscriptionWithBot"),Ha=A("adminGetSpaceMembershipUpdates"),za=A("adminBulkCreateTimedTrials"),Wa=A("getGeoIpLocation"),ja=A("getTeamAccessRequestMetadata"),Ka=A("stripeAdvanceTestClock"),Ya=A("adminOptOutNotionAIDataSharing"),Ga=A("getTransitivePageRelations"),Xa=new l.Z({performRequests:async e=>{const{environment:t}=e[0],o=e.map((e=>e.args)),i=await Ft(t,{requests:o});if("failed"===i.type)throw i.error;return[]},batchSize:50,maxWorkers:2,requestDelayMs:20,requestTimeoutMs:10*f.C0});async function qa(e,t){return await Xa.enqueue({environment:e,args:t})}const $a=new l.Z({performRequests:async e=>{const t=new Array(e.length),o=e.map(((e,t)=>({environment:e.environment,request:e.args,index:t}))),i=n().groupBy(o,(e=>e.request.userId));for(const[n,r]of Object.entries(i)){const e=r[0].environment,o=[];for(const{request:t}of r){const{pointer:e,version:i}=t;o.push({pointer:e,version:i})}const i=await Rt(e,{requests:o},n);if("failed"===i.type)throw i.error;const a=g.Ak.create(i.data.recordMap);_.Z.addFromRecordMapWithRole(a),_.Z.isEmpty()||x.dY({environment:e});for(const{request:n,index:s}of r)n.pointer&&(t[s]=a.get(n.pointer))}return t},batchSize:500,maxWorkers:2,requestDelayMs:20,requestTimeoutMs:30*f.C0});async function Ja(e,t){if(t.pointer&&(0,g.Ok)(t.pointer))try{const o=await $a.enqueue({environment:e,args:t});return o||-1!==t.version?o:{value:void 0,role:"editor"}}catch(o){}}const Qa=e=>[e.url,e.downloadName,e.download].filter(Boolean).join(":");const es=new class{constructor(){this.lru=new(a())({max:1e3,maxAge:f.U6})}set(e,t){this.lru.set(Qa(e),t)}get(e){return this.lru.get(Qa(e))}},ts=new l.Z({performRequests:async e=>{const t=e.map((e=>{let{url:t}=e;return t})),o=await no(e[0].environment,{urls:t});if("failed"===o.type)throw o.error;const{signedUrls:i}=o.data;return t.forEach(((e,t)=>{const o=i[t];es.set(e,o)})),i},batchSize:500,maxWorkers:1});async function os(e,t,o){const i=es.get(t);let n;return n=i||await ts.enqueue({environment:e,url:t}),n&&(0,d.x$)(n)&&o&&(n=(0,h.NV)({httpUrl:n,protocol:v.Z.protocol,includePort:!0})),n}const is=new c.Z},85266:(e,t,o)=>{o.d(t,{Bs:()=>ae,qY:()=>ue,mc:()=>re,KJ:()=>le,Uz:()=>se});var i=o(50112),n=o(15145),r=o(82813),a=o(7406),s=o(65917),l=o(4615),c=o(80984),d=o(21202),p=o(13493),u=o(65311),m=o(19889),g=o(66079),h=o(28182),f=o(9852),v=o(54153),y=o(64002),b=o(63143),S=o(25320),w=o(51456),k=o(84210),C=o(98165),_=o(33665),M=o(15517),T=o(51),I=o(79315),P=o(69327),x=o(93220),B=o(89523),Z=o(3815),E=o(32470),R=o(87956),A=o(29026),D=o(50906),F=o(92108),L=o(47307),V=o(96514),N=o(57400),O=o(10161),U=o(28209),H=o(54642);var z=o(94273),W=o(98958),j=o(17659),K=o(31304),Y=o(71978),G=o(5978),X=o(87531),q=o(29974),$=o(21325),J=o(94507),Q=o(30149),ee=o(761),te=o(70782),oe=o(12321),ie=o(37181),ne=o(65452);function re(e){I.default.setState(I.default.getInitialState());const{id:t}=e.currentUser;(!I.default.state.currentUserStore||t&&t!==I.default.state.currentUserStore.id)&&(t?(oe.j(e,t),z.Bk(e,t),le(e,t)):(I.default.setState({...I.default.state,initialized:!0}),F.dd(e)))}function ae(){const{currentSpaceStore:e}=I.default.getState();return e?e.id:void 0}async function se(e){const{nextRoute:t,currentRoute:o,environment:m,query:g}=e,h=I.default.state.mainEditorCurrentBlockStore,v=I.default.state.currentCollectionViewStore,C=m.currentUser.id,_=e=>{I.default.state.lastUpdater===_&&I.default.setState({...I.default.state,...e})};I.default.setState({...I.default.state,lastUpdater:_});const D=e=>{I.default.state.lastUpdater===_&&T.Z.setState({publicPageData:e})};if("page"===t.name&&t.queryId&&R.Z.setState({queryId:t.queryId,pageId:t.blockId,timeEntered:new Date}),"page"===t.name||"space"===t.name||"nativeTab"===t.name||"workspaceSetup"===t.name){let e;M.nr(t,C);const p=async()=>{e||(e=Y.I({environment:m,request:{type:"block-space",...t}}));const[o]=await Promise.all([e.next(),I.default.waitUntil((()=>I.default.state.initialized))]),i=o.value;return D(i),i},v=(0,f.getAppRefreshed)();if("page"===t.name&&(!h||h.id!==t.blockId||o&&"page"===o.name&&o.blockId!==t.blockId||h.userId!==C)){G.resetPageState(m),G.resetSidebarState(m),$.$B(),G.resetEditorState(m);const{blockId:e}=t,o=new Z.G(m,{table:d.iU,id:e}),a=new x.Z;if(_({mainEditorCurrentBlockStore:o,currentLoadingContainerStore:a}),!h){const t=await async function(e){const{environment:t,blockId:o}=e,{currentUser:i}=t,n=(0,b.jj)([...i.id?[i.id]:[],...i.loggedInUserIds]);for(const r of n){const e=new Z.G(t,{table:d.iU,id:o},{userId:r});if(await e.load(),e.isDefined())return i.id===r?void 0:r}}({environment:m,blockId:e});if(t)return void(await te.f({newCurrentUserId:t,environment:m,store:o}))}const s=await p(),{currentUserSettingsStore:c}=I.default.state;if(pe({publicPageData:s}))return void function(e){const{store:t,environment:o}=e,i=(0,k.ZP)({store:t,preferPublicLink:!1});G.navigate({environment:o,url:i})}({store:o,environment:m});S.U(m,{block:o,fromPageRefresh:v,pageVisitStore:I.default.state.pageVisitStore,timestamp:Date.now()}),V.Y0(o.id);const{presenceStore:f,currentUserRootStore:M}=I.default.state;K.v(f,m);const T=new B.Z;if(_({presenceStore:T}),K._({userId:C,rootStore:o,presenceStore:T,environment:m}),M)if(s.spaceId&&(s.canJoinSpace||s.userHasExplicitAccess)){const e=await q.j({environment:m,userRootStore:M,spaceId:s.spaceId,navigate:!1,analyticsFrom:"redirect",userSettingsStore:c});_({currentSpaceViewStore:e.spaceViewStore,currentSpaceStore:e.spaceViewStore.getSpaceStore()})}else if(!s.spaceId&&I.default.state.currentSpaceStore){const e=await q.j({environment:m,userRootStore:M,spaceId:I.default.state.currentSpaceStore.id,navigate:!1,analyticsFrom:"redirect",userSettingsStore:c});_({currentSpaceViewStore:e.spaceViewStore,currentSpaceStore:e.spaceViewStore.getSpaceStore()})}s.spaceId&&C&&(ne.h({environment:m,spaceId:s.spaceId,userId:C}),async function(e){const{environment:t,spaceId:o}=e;if("on"!==O.default.getEligibleGroup({experimentId:"my_home",defaultGroup:"control"}))return;const i=await H.getUserHomePages(t,{spaceId:o});"success"===i.type&&U.Z.setState({userHomePageId:i.data.homePageId})}({environment:m,spaceId:s.spaceId,userId:C}),J.I({environment:m,spaceId:s.spaceId,userId:C}));const{currentSpaceStore:E}=I.default.state;E?($.OR({environment:m,spaceId:E.id}).then((async()=>{await o.load(),de(m,o,g)})),w.identifyWorkspace(m)):s&&s.spaceId&&(await o.load(),de(m,o,g)),async function(e,t,o){const a=(0,y.Qc)(t).query,s=a[i.gS];if("email"===(0,n.xt)(a[n.$X])&&(s.includes("email_digest")||s.includes("email_push"))&&a[n.Qs]&&o){const t=(0,l.wr)(a[n.Qs]),i=Z.Xo.createChildStore(o,{table:u.uX,id:t});await i.load();const s=i.getModel();if(!s)return;if((0,r.e)((0,w.getClientEventTracker)(e),{alreadyRead:s.getRead(),notificationId:t,activityId:s.getActivityId(),from:"email"}),!s.getRead()){const t={id:s.id,space_id:s.getSpaceId(),read:s.getRead()};Q.createAndCommit({userAction:"appActions.setNotificationAsReadFromEmail",environment:e,perform:e=>j.$h({notification:t,rootStore:o,transaction:e,read:!0})})}}}(m,g,E);const R=(null==E?void 0:E.id)||s.spaceId;R&&ee.pt({environment:m,spaceId:R,force:!1}),R&&C&&P.Z.reinitializeState(m,C,R)}else if("space"===t.name){const e=await p();if(e.publicHomePage){const t=new Z.G(m,{table:d.iU,id:e.publicHomePage}),o=new x.Z;_({mainEditorCurrentBlockStore:t,currentLoadingContainerStore:o})}else if(_({mainEditorCurrentBlockStore:void 0,currentLoadingContainerStore:void 0}),pe({publicPageData:e}))return void ue({spaceDomain:e.spaceDomain,environment:m})}else if("nativeTab"===t.name){if(G.resetPageState(m),G.resetSidebarState(m),$.$B(),G.resetEditorState(m),await I.default.waitUntil((()=>I.default.state.initialized)),(!t.spaceId||!I.default.state.currentSpaceViewStore||!I.default.state.currentSpaceStore||I.default.state.currentSpaceStore.id!==t.spaceId)&&I.default.state.currentUserRootStore){const e=I.default.state.currentUserRootStore.getSpaceViewStores(),o=t.spaceId?e.find((e=>{var o,i;return(null===(o=e.getSpaceId())||void 0===o?void 0:o.replaceAll("-",""))===(null===(i=t.spaceId)||void 0===i?void 0:i.replaceAll("-",""))})):e[0],i=null==o?void 0:o.getSpaceStore();o&&i&&_({currentSpaceStore:i,currentSpaceViewStore:o})}}else if((0,c.wO)(t)&&(G.resetPageState(m),G.resetSidebarState(m),$.$B(),G.resetEditorState(m),await I.default.waitUntil((()=>I.default.state.initialized)),t.spaceId&&I.default.state.currentUserRootStore)){const e=I.default.state.currentUserRootStore.getSpaceViewStores().find((e=>e.getSpaceId()===t.spaceId)),o=null==e?void 0:e.getSpaceStore();e&&o&&_({currentSpaceStore:o,currentSpaceViewStore:e,mainEditorCurrentBlockStore:void 0})}if("searchQuery"in t||"searchRequest"in t)if(t.searchQuery)X.UT({environment:m,analyticsFrom:"query-args",renderAsPage:!1}),A.ZP.setState({...A.ZP.state,query:{...A.ZP.state.query,text:t.searchQuery}});else if(t.searchRequest)try{const e=JSON.parse(t.searchRequest),{text:o,sort:i,filters:n}=e;g&&A.ZP.setState({...A.ZP.state,query:{text:o,sort:i,filters:n}}),E.ZP.setState({...E.ZP.state,showDebugInfo:!0,debug:"everything"})}catch(z){L.showErrorMessage("Invalid json in searchRequest param"),s.log({level:"error",from:"appActions",type:"JSONParseError",error:{miscDataString:(0,a.tg)(z).message}})}if(e)for await(const t of e)D(t);N.Yh(m),(0,f.setAppRefreshed)(!1)}const F=v?v.id:void 0;if("page"===t.name&&F!==t.collectionViewId){const e=t.collectionViewId;_({currentCollectionViewStore:e?new Z.Xr(m,{table:p.n,id:e}):void 0})}}async function le(e,t){const o=new Z.U6(e,{table:m.KJ,id:t},{userId:t}),i=new Z.vO(e,{table:h.Sr,id:t},{userId:t});i.addListener(ce);const n=new Z.r9(e,{table:g.dx,id:t},{userId:t});W.registerPushNotifications(e),I.default.setState({...I.default.state,currentUserStore:o,currentUserSettingsStore:i,currentUserRootStore:n,initialized:!1}),await oe.w(),I.default.setState({...I.default.state,initialized:!0}),ie.fG(e),F.oG(e)}function ce(e){const t=e.getSettingsStore().getKeyStore("preferred_locale").getValue();t||v.Z.set("preferredLocale",t)}function de(e,t,o){var i,n;D.trackPageVisit(e,{query:o,page_id:t.id,is_peek:!1,peek_mode:void 0,type:"collection"===t.getParentTable()?"database_page":"page",collection_id:t.getParentCollectionId()??(null===(i=t.getCollectionViewCollectionStore())||void 0===i?void 0:i.id),team_id:null===(n=(0,C.VP)(t))||void 0===n?void 0:n.id})}function pe(e){const{publicPageData:t}=e;return!(!(0,_.Sr)()||"none"!==t.publicAccessRole||!t.spaceName)}function ue(e){const{spaceDomain:t,environment:o}=e,i=(0,_.Rs)(t);G.navigate({environment:o,url:i,redirect:!0})}},51127:(e,t,o)=>{o.d(t,{aT:()=>Se,Ln:()=>xe,Ro:()=>Pe,Y6:()=>Ze,JN:()=>Ae,SC:()=>De,ZF:()=>ve,Xt:()=>Ee,Xi:()=>fe,DY:()=>Le,w0:()=>Fe,uR:()=>Ve});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(41892),c=o(41432),d=o(90559),p=o(99036),u=o(80951),m=o(8848),g=o(39068),h=o(67219),f=o(3779),v=o(74181),y=o(4615),b=o(89101),S=o(21202),w=o(6287),k=o(13493),C=o(9844),_=o(90468),M=o(29369),T=o(19889),I=o(11002),P=o(10482),x=o(5500),B=o(70203),Z=o(97880),E=o(82990),R=o(64002),A=o(5366),D=o(81954),F=o(24405),L=o(1136),V=o(40235);function N(e){window.__c={n:"AppTemplateRelatedDependenciesDelete"};const{relatedDependencies:t}=e,o=(0,F.Fg)(),i=(0,D.VK)((()=>{const e=null==t?void 0:t.viewDeps;return e?e.map((e=>({name:e.getName(),icon:e.getFormat().collection_view_icon,type:e.getType()}))):[]}),[t.viewDeps]),r=s.useCallback((e=>n()("span",{style:{marginRight:10,display:"inline-block"}},e.name,n()(L.F,{color:"light",viewIcon:e.icon,viewType:e.type,style:{display:"inline-block",verticalAlign:"middle",marginRight:2,marginBottom:2},size:13}),e.name)),[]),a=[{key:"entity_type",header:void 0},{key:"entities",header:void 0}];return n()(V.Z,{columns:a,rows:(()=>{const e=[],a=null==t?void 0:t.propertyDeps;if(a.length>0){const t=a.map((e=>n()("span",{style:{marginRight:10,display:"inline-block"}},e.name,n()(g.ZP,{icon:e.icon,type:e.type,size:13,style:{display:"inline-block",verticalAlign:"middle",marginRight:2,marginBottom:2},theme:o}),e.name))),i=n()(A.FormattedMessage,{id:"appTemplates.featureBundleDelete.properties",defaultMessage:"{count, plural, one {1 property} other {{count} properties}}",values:{count:t.length}});e.push({key:"bundledProperties",columns:[[i],t]})}if(i.length>0){const t=i.map((e=>r(e))),o=n()(A.FormattedMessage,{id:"appTemplates.featureBundleDelete.views",defaultMessage:"{count, plural, one {1 view} other {{count} views}}",values:{count:t.length}});e.push({key:"bundledViews",columns:[[o],t]})}return e})(),hideHeader:!0,cellStyle:{width:"40%"}})}var O=o(76798),U=o(77373),H=o(93959),z=o(5575),W=o(28410),j=o(70538),K=o(78316),Y=o(33929),G=o(23537),X=o(95802),q=o(79315),$=o(30874),J=o(3815),Q=o(54642),ee=o(5299),te=o(74882),oe=o(16956),ie=o(64434),ne=o(28673),re=o(47307),ae=o(96802),se=o(94419),le=o(88428),ce=o(9953),de=o(5978),pe=o(29974),ue=o(150),me=o(30149),ge=o(37181);const he=(0,A.defineMessages)({initializeAppTemplateError:{id:"appTemplateActions.initializeAppTemplateError.message",defaultMessage:"Duplicate template failed."}});function fe(e,t){const{spaceViewStore:o}=t,i=o.getSpaceId();if(!i)return;const n=R.bf({url:b._j.workspaceSetup,query:{spaceId:y.cj(i)}});q.default.setState({...q.default.state,mainEditorCurrentBlockStore:void 0}),de.navigate({environment:e,url:n})}function ve(e){const{environment:t,temporaryContainerBlockStore:o,transaction:i}=e,n=be({...e,initializeStore:o,createOrModify:"create",appendOrPrepend:"prepend"});return n&&n.length>0&&de.navigateToBlock({environment:t,store:n[0],redirect:!0}),i.postSubmitCallbacks.push((async e=>{e?re.showErrorMessage(Y.default.formatMessage(he.initializeAppTemplateError)):n&&await async function(e){const{environment:t,appCollectionViewBlockStores:o}=e,i=a().compact(o.map((e=>{const t=e.getCollectionViewCollectionStore();if(t){const e=t.getSchema();if((0,d.$z)(e).length>0)return t}})));for(const n of i)await te.K({environment:t,collectionStore:n})}({environment:t,appCollectionViewBlockStores:n})})),n}function ye(e){const{environment:t,appUri:o,parentStore:i,spaceId:n,transaction:r,presetUri:a}=e,s=(0,U.p)().find((e=>e.uri===o));if(!i.isDefined()||!s)return;if(0===s.presets.length)throw new Error(`No presets configuration for specified app: ${o}`);const l=s.presets.find((e=>e.uri===a));if(a&&!l)throw new Error("Couldn't find specified preset");const d=l||s.presets[0],p=(0,H.KC)(d),u=s.presets.filter((e=>!(0,H.Mi)(e.uri))),m="prepend";if(o.startsWith("notion://wiki")||1!==u.length){const e=ce.ae({environment:t,table:S.iU,value:{type:c.Ti.collectionViewPage,parent_id:i.id,parent_table:i.table,space_id:n,format:{app_config_uri:o,collection_view_sub_type:"app_container",page_icon:s.logo,app_template_preset:d.uri,app_template_features:p},properties:{title:(0,B.TP)(o.startsWith("notion://wiki")?s.name:d.shortName)},alive:!0},inMemoryRecordCache:i.inMemoryRecordCache,transaction:r}),a=J.G.createChildStore(i,e.pointer);return Te(t,i,a,r,m),[a]}return Se({environment:t,appParentStore:i,appUri:o,features:p,createOrModify:"create",transaction:r,appendOrPrepend:m})}function be(e){const{appUri:t,presetUri:o}=e,i=(0,U.p)().find((e=>e.uri===t)),n=null==i?void 0:i.presets.find((e=>e.uri===o));if(n)return Se({...e,features:(0,H.KC)(n)})}function Se(e){const{environment:t,appParentStore:o,appUri:i,features:n,transaction:r,isNotionProjectsSandbox:s,createOrModify:l}=e,d=e.appendOrPrepend??"prepend",m=(0,U.p)().find((e=>e.uri===i));if(!m||!o.isDefined())return;let g;if("modify"===l){const t=a().uniq(a().compact(e.appCollectionViewBlockStores.map((e=>e.getFormat().app_id))));if(1!==t.length)throw new Error("App collection view block stores must have the same app id");g=t[0]}const h=(0,H._3)({featurePointers:n,appPackage:m});if(0===h.length)return;let f={};if("create"===e.createOrModify&&e.initializeStore){const t=h.filter((e=>"collection_view_block"===e.type));t.length>0&&(ce.sW({store:e.initializeStore,data:{type:e.initializeStore.isType(c.Ti.collectionViewPage)||e.initializeStore.isType(c.Ti.collectionView)?e.initializeStore.getType():c.Ti.collectionViewPage,format:{collection_pointer:e.initializeStore.getFormat().collection_pointer,app_config_uri:t[0].uri,page_icon:t[0].icon,page_cover:t[0].cover},properties:{...e.initializeStore.getProperties(),title:(0,B.TP)(t[0].name)}},transaction:r}),f[t[0].uri]=e.initializeStore.id)}else"modify"===e.createOrModify&&(f=Object.assign({},...a().compact(e.appCollectionViewBlockStores.map((e=>e.getFormat().app_uri_map)))));const b={...f};!function(e,t,o,i,n,r,s,l){const c=[...o.filter((e=>{let{type:t}=e;return"collection_view_block"===t})),...o.filter((e=>{let{type:t}=e;return"collection"===t})),...o.filter((e=>{let{type:t}=e;return"sub_external_collection"===t})),...o.filter((e=>{let{type:t}=e;return"property"===t})),...o.filter((e=>{let{type:t}=e;return"database_template"===t})),...o.filter((e=>{let{type:t}=e;return"block"===t})),...o.filter((e=>{let{type:t}=e;return"view"===t}))],d=t.table===_.bx?t.id:t.getSpaceId();if(!d)return;for(const u of c)if("collection_view_block"===u.type){const o=i[u.uri];if(o){var m,g;const i=J.G.createChildStore(t,{table:S.iU,id:o,spaceId:d});null!==(m=ke(t,i))&&void 0!==m&&null!==(g=m.getValue())&&void 0!==g&&g.includes(i.id)||Te(e,t,i,r,s),ce.sW({store:i,data:{parent_id:t.id,parent_table:t.table,alive:!0},transaction:r})}else{const o=ce.ae({environment:e,table:S.iU,inMemoryRecordCache:t.inMemoryRecordCache,value:{type:t.table===S.iU&&"app_container"===t.getFormat().collection_view_sub_type?"collection_view":"collection_view_page",parent_id:t.id,parent_table:t.table,space_id:d,format:{app_config_uri:u.uri,page_icon:u.icon,page_cover:u.cover},properties:{title:(0,B.TP)(u.name)},alive:!0},transaction:r});i[u.uri]=o.id;Te(e,t,J.G.createChildStore(t,o.pointer),r,s)}}else if("collection"===u.type){const o=Ie(t,u.blockUri,i);if(!o)throw new Error("SubViewBlockStore not found");const n=o.getCollectionViewSourceCollectionStore();n&&ie.A9({collectionViewBlockStore:o,collectionStore:n,transaction:r});const a=i[u.uri];if(a){const e=J.NW.createChildStore(t,{table:w.v,id:a,spaceId:d});ie.zz({collectionViewBlockStore:o,collectionStore:e,transaction:r}),ce.sW({store:e,data:{alive:!0,parent_id:o.id,parent_table:o.table},transaction:r}),ce.sW({store:e.getFormatStore(),data:{is_notion_projects_sandbox:Boolean(l)},transaction:r})}else{const t=ce.ae({environment:e,table:w.v,inMemoryRecordCache:o.inMemoryRecordCache,value:{...u.value,parent_id:o.id,parent_table:o.table,space_id:o.getSpaceId(),format:{app_config_uri:u.uri,app_uri_map:Object.fromEntries(Object.keys(u.value.schema??{}).filter((e=>e.startsWith("notion://"))).map((e=>[e,e]))),is_notion_projects_sandbox:Boolean(l),...u.value.format},alive:!0},transaction:r});i[u.uri]=t.id;const n=J.NW.createChildStore(o,t.pointer);ie.zz({collectionViewBlockStore:o,collectionStore:n,transaction:r})}}else if("sub_external_collection"===u.type){const o=$.Z.getIntegrationsAsRecordMap().get({table:C.K2,id:u.integrationId});if(!o||!(0,v.VM)(o))throw new Error("Invalid integration");const n=Me(t,u.parentCollectionUri,i);if(!n)throw new Error("Unable to find parent collection store");const a=n.getDeletedSchema()[u.relationUri];if(a&&(0,p.NK)(a)&&a.collection_pointer){i[u.uri]=a.collection_pointer.id;continue}const s=ne.c({environment:e,pattern:u.pattern,integration:o,parentCollectionStore:n,transaction:r});i[u.uri]=s.id}else if("property"===u.type)_e({environment:e,appConfig:n,appParentStore:t,dependency:u,uriMap:i,transaction:r});else if("view"===u.type){const o="block"===t.table&&t.getFormat().app_config_uri===u.blockUri?t:Ie(t,u.blockUri,i);if(!o)throw new Error("View's home block not found");const n=i[u.uri];if(n){const e=J.Xr.createChildStore(t,{table:k.n,id:n,spaceId:d});ce.sW({store:e,data:{alive:!0,parent_id:o.id,parent_table:o.table},transaction:r}),se.R3({parent:o.getCollectionViewsStore(),append:e,transaction:r})}else{var h,f,y;const n=Me(t,u.collectionUri,i);if(!n)throw new Error("View source collection not found");const s={...u.value.format,property_filters:null===(h=u.value.format)||void 0===h||null===(f=h.property_filters)||void 0===f?void 0:f.map((e=>{let{id:t,filter:o}=e;const{filter:n}=o;if("relation_contains"===n.operator){const e=(Array.isArray(n.value)?n.value:[n.value]).map((e=>{const t=e.type;if("relative"===t)return e;if("exact"===t){const t=e.value,o=t&&i[t];return o?{...e,value:o}:e}(0,Z.t1)(t)}));return{id:t,filter:{property:o.property,filter:{operator:n.operator,value:e}}}}return{id:t,filter:o}}))},l=a().compact(null===(y=u.value.page_sort)||void 0===y?void 0:y.map((e=>i[e]))),c=ce.ae({environment:e,table:k.n,inMemoryRecordCache:t.inMemoryRecordCache,value:{...u.value,parent_id:o.id,parent_table:o.table,space_id:d,format:{...s,app_config_uri:u.uri,collection_pointer:n.pointer},query2:{...u.value.query2},page_sort:l,alive:!0},transaction:r});i[u.uri]=c.id;const p=J.Xr.createChildStore(o,c.pointer);se.R3({parent:o.getCollectionViewsStore(),append:p,transaction:r})}}else if("database_template"===u.type){const o=Me(t,u.collectionUri,i);if(!o)throw new Error("Collection not found");const n=o.getTemplatePagesStore(),a=i[u.uri];if(a){const e=J.G.createChildStore(o,{table:S.iU,id:a,spaceId:o.getSpaceId()});ce.sW({store:e,data:{alive:!0,parent_id:o.id,parent_table:o.table,is_template:!0},transaction:r}),se.R3({parent:n,append:e,transaction:r}),u.isDefault&&ae.FH({stores:[o],update:{collection_default_template:{template_page_id:e.id}},transaction:r})}else{var b;const a=ce.ae({environment:e,table:S.iU,inMemoryRecordCache:t.inMemoryRecordCache,value:{...u.blockValue,parent_id:o.id,parent_table:o.table,space_id:o.getSpaceId(),is_template:!0,alive:!0,format:{...null===(b=u.blockValue)||void 0===b?void 0:b.format,app_config_uri:u.uri,...u.blockValue.format}},transaction:r});i[u.uri]=a.id,se.R3({parent:n,append:a,transaction:r}),u.isDefault&&ae.FH({stores:[o],update:{collection_default_template:{template_page_id:a.id}},transaction:r})}}else"block"===u.type?Ce(e,t,u,i,r):"page_template"===u.type||(0,Z.t1)(u);!function(e,t,o,i,n){for(const r of o){const o=Ie(t,r.uri,i);if(o){const s=o.getParentStore();if(s&&"collection"===s.table&&r.blockValue.properties){const l={};Object.entries(r.blockValue.properties).forEach((o=>{var n,r;let[c,d]=o;if("relation"===(null===(n=s.getSchema()[c])||void 0===n?void 0:n.type)){const e=(0,u.rq)(d),o=a().compact(e.map((e=>{const o=i[e.id];if(o)return{table:S.iU,id:o,spaceId:t.table===_.bx?t.id:t.getSpaceId()}}))),n=(0,u.ow)(o);l[c]=n}else"person"===(null===(r=s.getSchema()[c])||void 0===r?void 0:r.type)&&e.currentUser.id?l[c]=(0,u.C1)([{table:T.KJ,id:e.currentUser.id}]):l[c]=d})),ce.sW({store:o.getPropertiesStore(),data:l,transaction:n})}}}}(e,t,o.filter((e=>{let{type:t}=e;return"block"===t})),i,r)}(t,o,h,b,m,r,d,s),h.map((e=>{if("collection_view_block"===e.type){const t=Ie(o,e.uri,b);t&&function(e,t,o){const i=e.getCollectionViewStores().map((e=>{const o=e.getFormat().app_config_uri;let i=o?null==t?void 0:t.indexOf(o):null==t?void 0:t.length;return void 0!==i&&-1!==i||(i=null==t?void 0:t.length),{viewStore:e,order:i}})),n=a().sortBy(i,(e=>e.order)).map((e=>e.viewStore.id));ce.sW({store:e,data:{view_ids:n},transaction:o})}(t,e.defaultViewsOrder||[],r)}}));const M=a().compact(a().uniq(a().compact(h.map((e=>{if("collection_view_block"===e.type)return e.uri;if("blockUri"in e){const t=(0,H.TD)([e.blockUri],m);if(t&&t.length&&"collection_view_block"===t[0].type)return e.blockUri}}))))),I=a().compact(M.map((e=>Ie(o,e,b))));if("create"===l&&e.initializeStore){const t=e.initializeStore.getPermissionItemsStore().getValue();t&&I.forEach((e=>{ce.sW({store:e,data:{permissions:t},transaction:r})}))}const P="create"===l?a().compact([e.initializeStore]):e.appCollectionViewBlockStores,x=I.filter((e=>void 0===P.find((t=>t.id===e.id))));if(P.length>0&&x.length>0){const e=P[P.length-1],t=ke(o,e);t&&x.forEach(((o,i)=>{se.HP({parent:t,current:o,after:0===i?e:x[i-1],transaction:r})}))}const E=g||(0,y.ZP)();return function(e,t,o,i,n){e.forEach((e=>{const r=e.getFormat().app_config_uri;if(r){const a=(0,H.$Q)(new Set([r]),t),s={};a.forEach((e=>{o[e.uri]&&(s[e.uri]=o[e.uri])})),s[r]=o[r],ae.FH({stores:[e],update:{app_uri_map:{...e.getFormat().app_uri_map||{},...s},app_id:i},transaction:n})}}))}(I,h,b,E,r),I}function we(e){const{environment:t,dependencies:o,appCollectionViewBlockStores:i}=e,n=function(e){return e.filter((t=>{if("collection"===t.type){return Boolean(e.find((e=>"collection_view_block"===e.type&&e.uri===t.blockUri)))}if("property"===t.type||"view"===t.type||"collection_view_block"===t.type||"page_template"===t.type||"block"===t.type||"database_template"===t.type||"sub_external_collection"===t.type)return!0;(0,Z.t1)(t)}))}(o),r=Object.assign({},...a().compact(i.map((e=>e.getFormat().app_uri_map))));me.createAndCommit({userAction:"appTemplateActions.removeDependencies",environment:t,perform:e=>{!function(e){const{environment:t,appCollectionViewBlockStores:o,dependenciesToRemove:i,completeUriMap:n,transaction:r}=e,a=[...i.filter((e=>{let{type:t}=e;return"view"===t})),...i.filter((e=>{let{type:t}=e;return"block"===t})),...i.filter((e=>{let{type:t}=e;return"database_template"===t})),...i.filter((e=>{let{type:t}=e;return"page_template"===t})),...i.filter((e=>{let{type:t}=e;return"property"===t})),...i.filter((e=>{let{type:t}=e;return"sub_external_collection"===t})),...i.filter((e=>{let{type:t}=e;return"collection"===t})),...i.filter((e=>{let{type:t}=e;return"collection_view_block"===t}))];for(const l of a)if("collection_view_block"===l.type){const e=o.find((e=>{var t;return(null===(t=e.getFormat())||void 0===t?void 0:t.app_config_uri)===l.uri}));e&&r.postSubmitCallbacks.push((o=>{o||Q.deleteBlocks(t,{blocks:[{id:e.id,spaceId:e.getSpaceId()}],permanentlyDelete:!0})}))}else if("collection"===l.type){const e=o.find((e=>{var t;return(null===(t=e.getFormat())||void 0===t?void 0:t.app_config_uri)===l.blockUri}));if(e){const t=Me(e,l.uri,n);t&&ie.A9({collectionViewBlockStore:e,collectionStore:t,transaction:r})}}else if("property"===l.type){const e=o.find((e=>{var t,o;return(null===(t=e.getCollectionStore())||void 0===t||null===(o=t.getFormat())||void 0===o?void 0:o.app_config_uri)===l.collectionUri}))??o[0],i=Me(e,l.collectionUri,n);if(i){let o;var s;if("relation"===l.propertySchema.type&&l.propertySchema.collection_pointer)o=Me(e,null===(s=l.propertySchema.collection_pointer)||void 0===s?void 0:s.id,n);oe.E2({environment:t,collectionStore:i,schema:i.getSchema(),property:l.uri,transaction:r,targetCollectionStore:o})}}else if("view"===l.type){const e=n[l.uri];if(!e)throw new Error("Cannot delete view: id not found in map.");const t=o.find((e=>{var t;return(null===(t=e.getFormat())||void 0===t?void 0:t.app_config_uri)===l.blockUri}));if(t){const o=J.Xr.createChildStore(t,{table:k.n,id:e,spaceId:t.getSpaceId()});ie.dp({collectionViewBlockStore:t,collectionViewStore:o,transaction:r})}}else"page_template"===l.type||"block"===l.type||"database_template"===l.type||"sub_external_collection"===l.type||(0,Z.t1)(l)}({environment:t,appCollectionViewBlockStores:i,dependenciesToRemove:n,completeUriMap:r,transaction:e})}})}function ke(e,t){const{currentSpaceViewStore:o}=q.default.state;if(e.table===M.e0)return e.getTeamPagesStore();if(e.table===_.bx){if(o){var i,n;if(null!==(i=o.getPrivatePagesStore().getValue())&&void 0!==i&&i.includes(t.id))return o.getPrivatePagesStore();if(null!==(n=o.getSharedPagesStore().getValue())&&void 0!==n&&n.includes(t.id))return o.getSharedPagesStore()}}else{if(e.table===S.iU)return e.getContentStore();(0,Z.t1)(e)}}function Ce(e,t,o,i,n){let r=Ie(t,o.uri,i);const a="collection"===o.parentType?Me(t,o.parentUri,i):Ie(t,o.parentUri,i);if(!a)return{blockStore:r,parentStore:void 0};if(r)ce.sW({store:r,data:{parent_id:a.id,parent_table:a.table,alive:!0},transaction:n});else{const s=t.table===_.bx?t.id:t.getSpaceId();if(!s)return;const l=ce.ae({environment:e,table:S.iU,value:{type:o.blockValue.type,parent_id:a.id,parent_table:a.table,space_id:s,alive:!0,format:{...o.blockValue.format,app_config_uri:o.uri},properties:o.blockValue.properties},inMemoryRecordCache:t.inMemoryRecordCache,transaction:n});r=J.G.createChildStore(a,l.pointer),i[o.uri]=l.pointer.id}return"block"===a.table&&se.R3({parent:a.getContentStore(),append:r,transaction:n}),{blockStore:r,parentStore:a}}function _e(e){var t;const{environment:o,transaction:i,appParentStore:n,dependency:r,uriMap:s,appConfig:l}=e,c=Me(n,r.collectionUri,s);if(!c)throw new Error("Collection not found");let d=r.propertySchema;if("relation"===d.type){if(!d.collection_pointer)throw new Error("Invalid relation schema.");const e=Me(n,d.collection_pointer.id,s);if(!e)throw new Error("Relation target collection not found");const t=c.getDeletedSchema(),a=t[r.uri];if(r.isConnectedRelation&&r.integrationId===x.U9&&a&&(0,p.NK)(a)&&a.collection_pointer){const e=K.D8({deletedSchema:t,property:r.uri});if(!e)throw new Error("Deleted property schema was not found");ie.xO({environment:o,collectionStore:c,update:e.updateSchema,transaction:i}),ie.$N({collectionStore:c,update:e.updateDeletedSchema,transaction:i}),d={...d,collection_pointer:a.collection_pointer}}else d={...d,collection_pointer:null==e?void 0:e.pointer}}else if("select"===d.type){const e=c.getSchema()[r.uri];if(e&&"select"===e.type){var u;const t=(0,H.TD)([r.uri],l),o=a().flatten(a().compact(t.map((e=>{var t;if("property"===e.type&&"select"===e.propertySchema.type)return null===(t=e.propertySchema.options)||void 0===t?void 0:t.map((e=>e.id))})))),i=(null===(u=e.options)||void 0===u?void 0:u.filter((e=>!o.includes(e.id))))||[];d={...d,options:[...d.options||[],...i]}}}else if("auto_increment_id"===d.type){const e=c.getSchema(),t=(0,Z.qP)(e).find((e=>{var t;const o=e[0],i=null===(t=e[1])||void 0===t?void 0:t.type;return o&&i&&"auto_increment_id"===i}));if(t){var m;const e=t[0];return ae.FH({stores:[c],update:{app_uri_map:{...null===(m=c.getFormat())||void 0===m?void 0:m.app_uri_map,[r.uri]:e}},transaction:i}),r.uri}}return ie.xO({environment:o,collectionStore:c,update:{[r.uri]:d},transaction:i}),ae.FH({stores:[c],update:{app_uri_map:{...null===(t=c.getFormat())||void 0===t?void 0:t.app_uri_map,[r.uri]:r.uri}},transaction:i}),r.uri}function Me(e,t,o){return o[t]?J.NW.createChildStore(e,{table:w.v,id:o[t],spaceId:e.table===_.bx?e.id:e.getSpaceId()}):void 0}function Te(e,t,o,i,n){if(t.table!==S.iU)if(t.table===_.bx){const{currentSpaceViewStore:n}=q.default.state;if((null==n?void 0:n.getSpaceId())!==t.id)return;pe.Hj({environment:e,spaceStore:t,spaceViewStore:n,pageStore:o,isPrivate:!0,transaction:i})}else t.table===M.e0?ue.c0({teamStore:t,store:o,transaction:i,appendOrPrepend:n}):(0,Z.t1)(t)}function Ie(e,t,o){return o[t]?J.G.createChildStore(e,{table:S.iU,id:o[t],spaceId:e.table===_.bx?e.id:e.getSpaceId()}):void 0}async function Pe(e){const{environment:t,spaceStore:o,spaceViewStore:i,teamStore:n,appendOrPrepend:r,persona:a}=e,s=function(e){switch(e){case"sales":return I.Y.salesWikiV2;case"projectProgramMgmt":return I.Y.productWikiV2;case"eng":return I.Y.engineeringWikiV2;case"other":case"marketing":default:return I.Y.teamWiki}}(a);return await le.rC({environment:t,item:(0,P.G_)(s,Y.default.getIntl()),isPrivate:!1,spaceStore:o,spaceViewStore:i,useMinimalTemplates:!0,teamStore:n,type:"inTeam",from:"sidebar_team_section",isOnboarding:!0,appendOrPrepend:r})}function xe(e){const{databaseCreationTypes:t,environment:o,teamStore:i,transaction:n,appendOrPrepend:r}=e;let a=[];return t.forEach((e=>{const t=h.$m[e],s=(0,H.vi)(t);if(!s)return;const l=function(e){return Be[e]}(e),c=be({environment:o,appParentStore:i,appUri:s.uri,createOrModify:"create",transaction:n,presetUri:l,appendOrPrepend:r});ee.G({environment:o,appParentStore:i,transaction:n,blockStores:c,presetUri:l,appendOrPrepend:r}),c&&(a=[...a,...c])})),a}const Be={tasks:j.Ll,projects:j.Yb,sprints:j.tt,docs:z.r,meetings:W.KW};function Ze(e){for(const[t,o]of Object.entries(Be))if(o===e)return t;return null}async function Ee(e){const{environment:t,presets:o,spaceStore:i,teamStore:n}=e,{isAndroid:r,ramSizeInGB:s}=t.device;if(r&&(!s||s<2)){const e=o.slice().reverse().map((e=>{const{serverCommitResult:o,performResult:r}=me.createAndCommit({environment:t,userAction:"AppsSetup.onContinueWithApps",perform:o=>{var r;const a=null===(r=(0,H.SP)(e))||void 0===r?void 0:r.uri;if(!a)return;return ye({environment:t,appUri:a,parentStore:(0,G.bq)()?n:i,spaceId:i.id,transaction:o,presetUri:e})}});return{serverCommitResult:o,performResult:r}}));await Promise.all(e.map((e=>e.serverCommitResult)));return a().compact(a().flatten(a().reverse(e.map((e=>e.performResult)))))}{const{serverCommitResult:e,performResult:{collectionViewBlockStores:r}}=me.createAndCommit({environment:t,userAction:"AppsSetup.onContinueWithApps",perform:e=>{const r=a().flatten(a().compact(o.slice().reverse().map((o=>{var r;const a=null===(r=(0,H.SP)(o))||void 0===r?void 0:r.uri;if(!a)return;return ye({environment:t,appUri:a,parentStore:(0,G.bq)()?n:i,spaceId:i.id,transaction:e,presetUri:o})}))));return r.reverse(),{collectionViewBlockStores:r}}});return await e,r}}async function Re(e){const{environment:t,blockStore:o}=e,i=o.getFormat().app_id;if(!i)return[o];const n=await Q.getCollectionViewBlocksByAppId(t,{spaceId:o.getSpaceId(),appId:i}),r=o.getParentStore();return"success"!==n.type||void 0===r?[o]:n.data.result.map((e=>J.G.createChildStore(r,{table:S.iU,id:e.blockId,spaceId:o.getSpaceId()})))}async function Ae(e){const{environment:t,collectionViewBlockStore:o,databaseUri:i}=e,n=await Re({environment:t,blockStore:o});for(const a of n){var r;if(a.isCollectionView()&&(null===(r=a.getCollectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===i)return a}}async function De(e){const{environment:t,block:o,action:i}=e,r=o.getFormat().app_config_uri||"";if(H.rC.includes(r)){const e=await async function(e){const{environment:t,blockStore:o}=e,i=o.getParentStore();if(!i)return[o];const n=await Re({environment:t,blockStore:o}),r=i.id;return n.filter((e=>{var t;return(null===(t=e.getParentStore())||void 0===t?void 0:t.id)===r}))}({environment:t,blockStore:o});if(e.length<=1)return[o];const r=function(e,t,o){return"delete"===e?{message:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBDeleteAlert.message",defaultMessage:"Are you sure you want to delete {dbName}?",description:"Asking for user confirmation before deleting the App DB (either Tasks, Projects or Sprints).",values:{dbName:t.getTitleValue()}}),description:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBDeleteAlert.description",defaultMessage:"{appName} work closely together. You can delete them together, or you might encounter issues after deletion.",description:"Warning user that DBs in app work together and shouldn't be deleted separately.",values:{appName:o}}),allLabel:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBDeleteAlert.allLabel",defaultMessage:"Delete {appName}",description:"Option for user to delete all App DBs",values:{appName:o}}),cancelLabel:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBDeleteAlert.cancelLabel",defaultMessage:"Cancel"}),oneLabel:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBDeleteAlert.oneLabel",defaultMessage:"Delete {dbName} only",description:"Option for user to only delete App DB selected (either Tasks, Projects, or Sprints)",values:{dbName:t.getTitleValue()}}),actionIcon:f.Z.trash}:{message:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBMoveAlert.message",defaultMessage:"Are you sure you want to move {dbName}?",description:"Asking for user confirmation before moving the App DB (either Tasks, Projects or Sprints).",values:{dbName:t.getTitleValue()}}),description:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBMoveAlert.description",defaultMessage:"{appName} work closely together. You can move them together, or you might encounter issues after separating.",values:{appName:o}}),allLabel:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBMoveAlert.allLabel",defaultMessage:"Move together",description:"Option for user to move all App DBs"}),cancelLabel:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBMoveAlert.cancelLabel",defaultMessage:"Cancel"}),oneLabel:n()(A.FormattedMessage,{id:"appTemplateHelpers.multiDBMoveAlert.oneLabel",defaultMessage:"Only move {dbName}",description:"Option for user to only move App DB selected (either Tasks, Projects, or Sprints)",values:{dbName:t.getTitleValue()}}),actionIcon:f.Z.arrowRight}}(i,o,function(e){if(1===e.length)return e[0].getTitleValue().toString();let t="";for(let o=0;o<e.length-1;o++)t+=e[o].getTitleValue(),e.length>2?t+=", ":t+=" ";return t+=`and ${e[e.length-1].getTitleValue()}`,t}(e)),a=await function(e,t){const{message:o,description:i,allLabel:r,cancelLabel:a,oneLabel:s,actionIcon:c}=e;return new Promise((e=>{re.showDialog({showCancel:!1,keepFocus:!1,message:n()("div",{style:{textAlign:"center"}},void 0,n()("span",{style:{display:"inline-block",verticalAlign:"-0.15em",position:"relative"}},void 0,n()("img",{src:l.Z.images.appPackages.projectsIconSvg,style:{width:"1.4em",height:"1.4em"}}),c({width:"0.9em",height:"0.9em",position:"absolute",fill:m.O9.red,right:"-0.3em",bottom:"0.05em"})),n()("div",{style:{fontWeight:E.Z.fontWeight.semibold,margin:"0.7em"}},void 0,o),n()("div",{style:{fontSize:14}},void 0,i)),items:"delete"===t?[{label:s,color:"red",onAccept:()=>{e("one")}},{label:a,onAccept:()=>{e("cancel")}},{label:r,onAccept:()=>{e("all")}}]:[{label:r,color:"blue",onAccept:()=>{e("all")}},{label:s,onAccept:()=>{e("one")}}],handleCancel:()=>{e("cancel")}})}))}(r,i);if("cancel"===a)return"user_canceled";const s=[o];if("all"===a)for(const t of e)if(t.id!==o.id){const e=X.C.findSelectablesFromIds([t.id]);e.length>0?s.push(e[0].props.store):s.push(t)}return s}return[o]}async function Fe(e){var t,o;let{environment:i,property:r,collectionContextStore:s,theme:l}=e;const c=s.collectionStore(),d=s.collectionViewBlockStore(),p=null==d?void 0:d.getCollectionViewStores();if(!c||!d||!p)return!1;const u=c.getSchema()[r],m=c.getFormat().app_config_uri;if(!u||!m)return!1;const h=(0,H.vi)(m);if(!h)return!1;const f=a().compact([...Object.keys((null===(t=c.getFormat())||void 0===t?void 0:t.app_uri_map)||{}),...Object.keys((null===(o=d.getFormat())||void 0===o?void 0:o.app_uri_map)||{})]),v=(0,H.TD)(f,h),y=a().compact([v.find((e=>e.uri===r))]),b=(0,H.K8)({validDependencies:y,dependencies:v,collectionStore:c,collectionViewBlockStore:d,viewStores:p}),{validDependencies:w}=b;if(0===w.length)return!1;const k=null==d?void 0:d.getParentStore();if(!c||!d||!k||k.table!==_.bx&&k.table!==S.iU&&k.table!==M.e0)return!1;const C=d.getFormat().app_id,T=C?await Q.getCollectionViewBlocksByAppId(i,{spaceId:d.getSpaceId(),appId:C}):void 0,I="success"===(null==T?void 0:T.type)?T.data.result.map((e=>J.G.createChildStore(k,{table:S.iU,id:e.blockId,spaceId:d.getSpaceId()}))):[d],P=[{label:n()(A.FormattedMessage,{id:"appTemplatesHelpers.bundledPropertyDelete.deleteMessage",defaultMessage:"{count, plural, one {Delete} other {Delete all}}",values:{count:w.length}}),color:"red",onAccept:()=>we({environment:i,dependencies:w,appCollectionViewBlockStores:I})}],x=w.length>1&&n()(N,{relatedDependencies:b,collectionContextStore:s});return re.showDialog({message:n()("div",{style:{textAlign:"center"}},void 0,n()("span",{style:{fontWeight:E.Z.fontWeight.medium}},void 0,n()(A.FormattedMessage,{id:"appTemplateHelpers.bundledPropertyDelete.message",defaultMessage:"Delete {property} property for everyone on {databaseName}?",description:"Warning message for user to confirm that the property will be deleted",values:{databaseName:n()(O.Z,{style:{display:"inline",fontWeight:E.Z.fontWeight.medium},shouldWrap:!0,store:c}),property:n()("span",{},void 0,n()(g.ZP,{icon:u.icon,type:u.type,size:18,style:{verticalAlign:"middle",display:"inline-block",marginRight:3,marginBottom:2},theme:l}),u.name)}})),w.length>1&&n()("div",{style:{margin:"0.17em"}},void 0,n()("span",{style:{fontSize:13,fontWeight:E.Z.fontWeight.light}},void 0,n()(A.FormattedMessage,{id:"appTemplateHelpers.bundledPropertyDelete.description",defaultMessage:"These related entities will also be deleted since they work together.",description:"User prompt to only allow deletion in typed DBs as a bundle for a particular feature."})))),description:x,showCancel:!0,keepFocus:!0,innerStyle:{width:480},items:P}),!0}async function Le(e,t){if(!(0,H.Ru)()||!(0,H.wY)()||!t.permissionScopes.state.canConfigureCollection)return!1;const o=t.collectionStore(),i=t.collectionViewBlockStore();if(!i)return!1;const n=i.getFormat();if((null==n?void 0:n.app_config_uri)===h.TZ){const t=await Ae({environment:e,collectionViewBlockStore:i,databaseUri:h.p$});if(!t)return!1;const o=null==t?void 0:t.getCollectionStore();return Boolean(!(null!=o&&o.getSchemaStore()[h.Zb]))}return(null==n?void 0:n.app_config_uri)===h.pz&&Boolean(!(null!=o&&o.getSchemaStore()[h.Zb]))}function Ve(e){const{environment:t,requiredCurrPhase:o,nextPhase:i,currentUserSettingsStore:n,currentSpaceStore:r}=e,a=(0,H.jH)(n,r);o&&o!==a||me.createAndCommit({userAction:"ProjManagementIntroModal.updateProjManagementTooltipTourPhase",environment:t,perform:e=>{var t;ge.d2({userSettingsStore:n,transaction:e,data:{proj_management_tooltip_tour_v1_phase_per_space:{...(null===(t=n.getSettings())||void 0===t?void 0:t.proj_management_tooltip_tour_v1_phase_per_space)??{},[r.id]:i}}})},userId:n.id})}},5299:(e,t,o)=>{o.d(t,{m:()=>P,G:()=>x});var i=o(41892),n=o(41432),r=o(67219),a=o(4615),s=o(98963),l=o(18844),c=o(21202),d=o(13493),p=o(90468),u=o(29369),m=o(97880),g=o(5366),h=o(93959),f=o(70538),v=o(33929),y=o(79315),b=o(10161),S=o(3815),w=o(64434),k=o(94419),C=o(9953),_=o(5978),M=o(29974),T=o(150);const I=(0,g.defineMessages)({tutorialPage_0:{id:"appTemplateSprintBoardActions.tutorialPage_0",defaultMessage:"Get started with Sprints",description:"Tutorial page title"},sprintBoard_0:{id:"appTemplateSprintBoardActions.sprintBoard_0",defaultMessage:"Sprint board",description:"Page template's content"},sprintBoard_1_0:{id:"appTemplateSprintBoardActions.sprintBoard_1_0",defaultMessage:"[PLACEHOLDER] How to use Sprints",description:"Page template's content"},sprintBoard_1_0_0_0_0:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_0_0",defaultMessage:"Move tasks to a sprint by editing their ",description:"Page template's content"},sprintBoard_1_0_0_0_1:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_0_1",defaultMessage:"Sprint",description:"Page template's content"},sprintBoard_1_0_0_0_2:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_0_2",defaultMessage:" property, or dragging them from the ",description:"Page template's content"},sprintBoard_1_0_0_0_3:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_0_3",defaultMessage:"Sprint Planning",description:"Page template's content"},sprintBoard_1_0_0_0_4:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_0_4",defaultMessage:" view",description:"Page template's content"},sprintBoard_1_0_0_1_0:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_1_0",defaultMessage:"Write planning notes by ",description:"Page template's content"},sprintBoard_1_0_0_1_1:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_1_1",defaultMessage:"clicking this button",description:"Page template's content"},sprintBoard_1_0_0_2_0:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_2_0",defaultMessage:"Complete the current sprint by clicking the ",description:"Page template's content"},sprintBoard_1_0_0_2_1:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_2_1",defaultMessage:"Complete Sprint",description:"Page template's content"},sprintBoard_1_0_0_2_2:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_2_2",defaultMessage:" button located at the top right corner of the ",description:"Page template's content"},sprintBoard_1_0_0_2_3:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_2_3",defaultMessage:"Current Sprint",description:"Page template's content"},sprintBoard_1_0_0_2_4:{id:"appTemplateSprintBoardActions.sprintBoard_1_0_0_2_4",defaultMessage:" view",description:"Page template's content"},sprintBoard_4_0:{id:"appTemplateSprintBoardActions.sprintBoard_4_0",defaultMessage:"Planning notes",description:"Page template's content"},sprintBoard_6_0:{id:"appTemplateSprintBoardActions.sprintBoard_6_0",defaultMessage:"3rd party data",description:"Page template's content"},sprintBoard_7_0:{id:"appTemplateSprintBoardActions.printBoard_7_0",defaultMessage:"Use ",description:"Page template's content"},sprintBoard_7_1:{id:"appTemplateSprintBoardActions.sprintBoard_7_1",defaultMessage:"/sync",description:"Page template's content"},sprintBoard_7_2:{id:"appTemplateSprintBoardActions.sprintBoard_7_2",defaultMessage:" Add 3rd party data sources as synced database, such as Github, Gitlab or Jira",description:"Page template's content"},sprintBoard_8_0:{id:"appTemplateSprintBoardActions.sprintBoard_8_0",defaultMessage:"New powerful project management, coupled with the power of AI!",description:"Page template's content"},planningNotesButton:{id:"appTemplateSprintBoardActions.planningNotesButton",defaultMessage:"Add planning notes",description:"Text on a button for adding planning notes"}});function P(e){const{environment:t,appParentStore:o,transaction:i,blockStores:n,presetUri:r,appendOrPrepend:a}=e,s=x({environment:t,appParentStore:o,transaction:i,blockStores:n,presetUri:r,appendOrPrepend:a});s&&_.navigateToBlock({environment:t,store:s,redirect:!0})}function x(e){const{environment:t,appParentStore:o,transaction:u,blockStores:m,presetUri:g,appendOrPrepend:_}=e;if(!m||g!==f.tt||!(0,h.wY)())return;const M=m.find((e=>e.getFormat().app_config_uri===r.TZ)),T=m.find((e=>e.getFormat().app_config_uri===r.pz));if(!M||!T)return;const P=b.default.getEligibleGroup({experimentId:"proj_management_sprint_page_add_on",defaultGroup:"control"});return"sprint_board_page"===P?function(e){const{environment:t,appParentStore:o,transaction:u,tasksBlockStore:m,appendOrPrepend:g}=e,h=o.table===p.bx?o.id:o.getSpaceId(),f=o.table===p.bx?o:o.getSpaceStore(),b=y.default.state.currentSpaceViewStore;if(!h||!f||!b)return;const _=function(e){const{environment:t,appParentStore:o,spaceId:r,transaction:a}=e;return C.ae({environment:t,table:c.iU,value:{type:n.Ti.page,parent_id:o.id,parent_table:o.table,space_id:r,format:{page_icon:i.Z.images.appPackages.sprintsDbIconSvg,page_full_width:!0},properties:{title:[[v.default.formatMessage(I.sprintBoard_0)]]},alive:!0},inMemoryRecordCache:o.inMemoryRecordCache,transaction:a})}({environment:t,appParentStore:o,spaceId:h,transaction:u});Z({environment:t,sprintBoardBlockStore:_,transaction:u,spaceId:h});const{blockWithButtonLink:M}=function(e){const{environment:t,sprintBoardBlockStore:o,transaction:i,spaceId:n}=e;return{blockWithButtonLink:A({environment:t,sprintBoardBlockStore:o,transaction:i,spaceId:n,blockDependencies:E({uri:"root"})})["root/1/0/0/1"]}}({environment:t,sprintBoardBlockStore:_,transaction:u,spaceId:h});return Z({environment:t,sprintBoardBlockStore:_,transaction:u,spaceId:h}),function(e){const{environment:t,sprintBoardPageStore:o,tasksBlockStore:i,transaction:a,spaceId:s}=e,l=function(e){const{environment:t,sprintBoardPageStore:o,transaction:i,spaceId:r}=e,a=C.ae({environment:t,table:c.iU,value:{type:n.Ti.collectionView,parent_id:o.id,parent_table:o.table,space_id:r,alive:!0},inMemoryRecordCache:o.inMemoryRecordCache,transaction:i}),s=S.G.createChildStore(o,a.pointer);return k.R3({parent:o.getContentStore(),append:s,transaction:i}),s}({environment:t,sprintBoardPageStore:o,transaction:a,spaceId:s});[r.g3,r.sV,r.y$].forEach((e=>{!function(e){var t,o;const{collectionViewBlock:i,tasksBlockStore:n,viewUri:r,spaceId:a,transaction:s}=e,l=n.getCollectionPointer(),c=null===(t=n.getFormat())||void 0===t||null===(o=t.app_uri_map)||void 0===o?void 0:o[r];if(!c)return;const p=S.Xr.createChildStore(i,{table:d.n,id:c,spaceId:a});l&&p&&function(e){const{viewStore:t,transaction:o,tasksCollectionPointer:i,viewBlockStore:n}=e,r=t.getName(),a=t.getPageSort(),s=t.getFormat(),l=t.getKeyStore("query2").getValue(),c=t.clone(),d=t.getType();C.sW({store:c,data:{name:r,type:d,page_sort:a,format:{...s,collection_pointer:i},query2:l,alive:!0,parent_id:n.id,parent_table:n.table},transaction:o}),k.R3({parent:n.getCollectionViewsStore(),append:c,transaction:o})}({viewStore:p,transaction:s,tasksCollectionPointer:l,viewBlockStore:i});w.dp({collectionViewBlockStore:n,collectionViewStore:p,transaction:s})}({collectionViewBlock:l,tasksBlockStore:i,viewUri:e,spaceId:s,transaction:a})}))}({environment:t,sprintBoardPageStore:_,tasksBlockStore:m,transaction:u,spaceId:h}),function(e){const{environment:t,sprintBoardBlockStore:o,blockWithButtonLink:i,transaction:r,spaceId:d}=e,p=C.ae({environment:t,table:c.iU,value:{type:n.Ti.header,parent_id:o.id,parent_table:c.iU,alive:!0,space_id:d,properties:{title:[[v.default.formatMessage(I.sprintBoard_4_0)]]}},inMemoryRecordCache:o.inMemoryRecordCache,transaction:r}),u=C.ae({environment:t,table:c.iU,value:{type:"button",parent_id:o.id,parent_table:c.iU,space_id:d,alive:!0},inMemoryRecordCache:o.inMemoryRecordCache,transaction:r});k.R3({parent:o.getContentStore(),append:p,transaction:r}),k.R3({parent:o.getContentStore(),append:u,transaction:r});const m=C.ae({environment:t,table:s.cv,value:{parent_id:u.id,parent_table:c.iU,action_ids:[],properties:{icon:"icons/drafts_gray.svg",name:v.default.formatMessage(I.planningNotesButton)},trigger:{id:(0,a.ZP)(),type:"button"},status:"active",space_id:d,alive:!0},inMemoryRecordCache:o.inMemoryRecordCache,transaction:r});C.sW({store:u,data:{format:{automation_id:m.id}},transaction:r});const g=C.ae({environment:t,table:l.Xj,value:{type:"duplicate_blocks",space_id:d,parent_table:"automation",parent_id:m.id,alive:!0,blocks:[]},inMemoryRecordCache:o.inMemoryRecordCache,transaction:r});k.R3({parent:m.getActionIdsStore(),append:g,transaction:r});const h=function(e){const{environment:t,transaction:o,spaceId:i,automationActionStore:r}=e,a=C.ae({environment:t,table:c.iU,value:{type:n.Ti.text,parent_id:r.id,parent_table:"automation_action",alive:!0,space_id:i,content:[]},inMemoryRecordCache:r.inMemoryRecordCache,transaction:o}),s=C.ae({environment:t,table:c.iU,value:{type:n.Ti.toggle,properties:{title:[["‣",[["tv",{type:"today"}]]],[" "]]},parent_id:a.id,parent_table:"block",alive:!0,space_id:i},inMemoryRecordCache:r.inMemoryRecordCache,transaction:o});return k.R3({parent:a.getContentStore(),append:s,transaction:o}),a}({environment:t,automationActionStore:g,transaction:r,spaceId:d});if(k.R3({parent:g.getBlocksStore(),append:h,transaction:r}),!i)return;C.sW({store:i,data:{properties:{title:[[v.default.formatMessage(I.sprintBoard_1_0_0_1_0)],[v.default.formatMessage(I.sprintBoard_1_0_0_1_1),[["a",`/${o.id.split("-").join("")}#${u.id.split("-").join("")}`]]]]}},transaction:r})}({environment:t,sprintBoardBlockStore:_,blockWithButtonLink:M,transaction:u,spaceId:h}),function(e){const{environment:t,sprintBoardBlockStore:o,transaction:i,spaceId:n}=e;A({environment:t,sprintBoardBlockStore:o,transaction:i,spaceId:n,blockDependencies:R("root")})}({environment:t,sprintBoardBlockStore:_,transaction:u,spaceId:h}),B(t,o,_,u,g),_}({environment:t,appParentStore:o,transaction:u,tasksBlockStore:M,appendOrPrepend:_}):"tutorial_page"===P?function(e){const{environment:t,appParentStore:o,transaction:r,appendOrPrepend:a}=e,s=o.table===p.bx?o.id:o.getSpaceId();if(!s)return;const l=C.ae({environment:t,table:c.iU,value:{type:n.Ti.page,parent_id:o.id,parent_table:o.table,space_id:s,format:{page_icon:i.Z.images.appPackages.sprintsDbIconSvg,page_full_width:!0},properties:{title:[[v.default.formatMessage(I.tutorialPage_0)]]},alive:!0},inMemoryRecordCache:o.inMemoryRecordCache,transaction:r});return B(t,o,l,r,a),l}({environment:t,appParentStore:o,transaction:u,appendOrPrepend:_}):void 0}function B(e,t,o,i,n){if(t.table!==c.iU)if(t.table===p.bx){const{currentSpaceViewStore:n}=y.default.state;if((null==n?void 0:n.getSpaceId())!==t.id)return;M.Hj({environment:e,spaceStore:t,spaceViewStore:n,pageStore:o,isPrivate:!0,transaction:i})}else t.table===u.e0?T.c0({teamStore:t,store:o,transaction:i,appendOrPrepend:n}):(0,m.t1)(t)}function Z(e){const{environment:t,sprintBoardBlockStore:o,spaceId:i,transaction:r}=e,a=C.ae({environment:t,table:c.iU,value:{type:n.Ti.text,parent_id:o.id,parent_table:c.iU,space_id:i,alive:!0},inMemoryRecordCache:o.inMemoryRecordCache,transaction:r});k.R3({parent:o.getContentStore(),append:a,transaction:r})}function E(e){const{uri:t}=e;return[{uri:`${t}/1`,type:"block",parentUri:`${t}`,parentType:"block",blockValue:{type:"callout",properties:{title:[[v.default.formatMessage(I.sprintBoard_1_0),[["b"]]]]},format:{page_icon:"/icons/light-bulb_yellow.svg",block_color:"gray_background"}}},{uri:`${t}/1/0`,type:"block",parentUri:`${t}/1`,parentType:"block",blockValue:{type:"column_list"}},{uri:`${t}/1/0/0`,type:"block",parentUri:`${t}/1/0`,parentType:"block",blockValue:{type:"column",format:{column_ratio:.9}}},{uri:`${t}/1/0/0/0`,type:"block",parentUri:`${t}/1/0/0`,parentType:"block",blockValue:{type:"numbered_list",properties:{title:[[v.default.formatMessage(I.sprintBoard_1_0_0_0_0)],[v.default.formatMessage(I.sprintBoard_1_0_0_0_1),[["b"]]],[v.default.formatMessage(I.sprintBoard_1_0_0_0_2)],[v.default.formatMessage(I.sprintBoard_1_0_0_0_3),[["b"]]],[v.default.formatMessage(I.sprintBoard_1_0_0_0_4)]]}}},{uri:`${t}/1/0/0/1`,type:"block",parentUri:`${t}/1/0/0`,parentType:"block",blockValue:{type:"numbered_list",properties:{title:[]}}},{uri:`${t}/1/0/0/2`,type:"block",parentUri:`${t}/1/0/0`,parentType:"block",blockValue:{type:"numbered_list",properties:{title:[[v.default.formatMessage(I.sprintBoard_1_0_0_2_0)],[v.default.formatMessage(I.sprintBoard_1_0_0_2_1),[["b"]]],[v.default.formatMessage(I.sprintBoard_1_0_0_2_2)],[v.default.formatMessage(I.sprintBoard_1_0_0_2_3),[["b"]]],[v.default.formatMessage(I.sprintBoard_1_0_0_2_4)]]}}},{uri:`${t}/1/0/0/3`,type:"block",parentUri:`${t}/1/0/0`,parentType:"block",blockValue:{type:"text"}},{uri:`${t}/1/0/1`,type:"block",parentUri:`${t}/1/0`,parentType:"block",blockValue:{type:"column",format:{column_ratio:.1}}}]}function R(e){return[{uri:`${e}/6`,type:"block",parentUri:`${e}`,parentType:"block",blockValue:{type:"header",properties:{title:[[v.default.formatMessage(I.sprintBoard_6_0)]]}}},{uri:`${e}/7`,type:"block",parentUri:`${e}`,parentType:"block",blockValue:{type:"callout",properties:{title:[[v.default.formatMessage(I.sprintBoard_7_0)],[v.default.formatMessage(I.sprintBoard_7_1),[["c"]]],[v.default.formatMessage(I.sprintBoard_7_2)]]},format:{page_icon:"/icons/light-bulb_yellow.svg",block_color:"gray_background"}}},{uri:`${e}/8`,type:"block",parentUri:`${e}`,parentType:"block",blockValue:{type:"text",properties:{title:[[v.default.formatMessage(I.sprintBoard_8_0)]]}}}]}function A(e){const{environment:t,sprintBoardBlockStore:o,transaction:i,spaceId:n,blockDependencies:r}=e,a={root:o};return r.map((e=>{const r=a[e.parentUri],s=C.ae({environment:t,table:c.iU,value:{...e.blockValue,parent_id:r.id,parent_table:c.iU,space_id:n,alive:!0},inMemoryRecordCache:o.inMemoryRecordCache,transaction:i});a[e.uri]=s,k.R3({parent:r.getContentStore(),append:s,transaction:i})})),a}},2449:(e,t,o)=>{o.d(t,{hC:()=>p,M0:()=>u,cM:()=>m,D$:()=>h,ac:()=>f,W$:()=>v,uG:()=>y});var i=o(65917),n=o(9852),r=o(54153),a=o(63143),s=o(11342),l=o(95477),c=o(39218),d=o(84908);function p(e){var t;const{environment:o,url:r,version:a}=e,{AppUpdateStore:s,device:l}=o;l.isElectron&&r.startsWith("https:")?i.log({level:"error",from:"appUpdateActions",type:"installAppJsUpdate",error:{message:"Attempting to refresh app js on desktop for an https url",stack:(new Error).stack},data:{url:r}}):(s.setState({electronUpdate:s.state.electronUpdate,appUpdate:void 0}),a&&h(a),u(a)||(o.mobileNative&&o.mobileNative.showSplashscreen(),(0,n.setAppRefreshed)(!0),null!==(t=d.electronApi)&&void 0!==t&&t.installAppJsUpdate?d.electronApi.installAppJsUpdate(r):r!==ncd.href()?window.location.href=r:window.location.reload()))}function u(e){return(0,s.isEqualVersion)(e,y())}function m(e,t){if(!t)return!1;if("ready"!==t.state)return!1;if(c.transactionQueue.hasTasks())return!1;if(!e.currentUser.isLoggedIn())return!1;if(t.type===s.UpdateType.Silent){if(e.device.isMobileNative)return!1;const t=v();if(t&&(Date.now()-t)/a.A0<7)return!1;i.log({level:"info",from:"appUpdateActions",type:"shouldUpdateOnNavigate",data:{lastKnownUpdateTime:t}})}return!0}const g="lastKnownAppJsVersion";function h(e){r.Z.set(g,{version:e,time:Date.now()})}function f(){const e=r.Z.get(g);if(e&&e.version)return e.version;{const e=(0,s.parseVersion)(l.Z.version);return r.Z.set(g,{version:e,time:Date.now()}),e}}function v(){const e=r.Z.get(g);if(e&&e.time)return e.time}function y(){return(0,s.parseVersion)(l.Z.version)}},73100:(e,t,o)=>{o.d(t,{qE:()=>se,cz:()=>re,aV:()=>Q,G6:()=>te,vR:()=>ne,CU:()=>ee,f6:()=>oe,eO:()=>le,mA:()=>ae});var i=o(96486),n=o.n(i),r=o(17126),a=o(26263),s=o(1302);function l(e){const t=[[/"/,'"'],[/'/,"'",/(^|[^\p{L}\p{M}])/],[/`/,"`"],[/\(/,")"],[/\[/,"]"],[/\{/,"}"],[/\\\*/,"*/"],[/<([a-z0-9-]+)( [a-z0-9-]+="[^"]*")*>/,"</$1>"]].map((e=>{let[{source:t},o,{source:i}={source:!1}]=e;return[new RegExp(`^${t}[^]*`,"u"),o,i&&new RegExp(`${i}$`,"u")]})),o=[];let i=0;e:for(;i<e.length;){const n=e.slice(i),r=o.at(-1);if(r&&n.startsWith(r))o.pop(),i+=r.length;else{for(const[r,a,s]of t)if(r.test(n)&&(!s||s.test(e.slice(0,i)))){o.push(n.replace(r,a)),i+=1;continue e}i+=1}}return e+o.reverse().join("")}var c=o(78395);class d{constructor(e){this.state=void 0,this.state=e}async eval(e){const{input:t,commit:o}=e,i=this.cloneState(),n=[];try{const e=this.state.parse(t),r=[];for(const t of e)if("element"===t.type)if(c.Mc[t.tagName]){const e=c.Mc[t.tagName]({attributes:t.attributes||{},children:t.children||[],state:i});e&&n.push(e)}else{if(!c.LI[t.tagName])throw new Error(`Unknown API: ${t.tagName}`);{const e=c.LI[t.tagName]({attributes:t.attributes,children:t.children,state:i});r.push(e),c.e3[t.tagName]&&await e}}const a=await Promise.all(r);for(const t of a)t&&n.push(t);o&&(this.state=i)}catch(r){n.push({type:"observation",observationType:"error",value:`${r.name}: ${r.message}`})}finally{return n}}cloneState(){return{...this.state,loadedPageIds:n().cloneDeep(this.state.loadedPageIds),selection:this.state.selection?n().cloneDeep(this.state.selection):void 0,blockIdMap:p(this.state.blockIdMap)}}}function p(e){const t={};for(const o in e)u({block:e[o],oldMap:e,newMap:t});return t}function u(e){const{block:t,oldMap:o,newMap:i}=e;if(i[t.id])return i[t.id];const r={type:"block",id:t.id,tagName:t.tagName,attributes:{...t.attributes},persisted:t.persisted,parent:void 0,children:[],text:n().cloneDeep(t.text),properties:n().cloneDeep(t.properties)};i[t.id]=r;const a=t.children;return r.children=a.map((e=>u({block:e,oldMap:o,newMap:i}))),t.parent&&(r.parent=u({block:t.parent,oldMap:o,newMap:i})),t.parent,r}class m{constructor(e){this.transcript=[],this.codeEvaluator=void 0,this.counter=0,this.streamInference=void 0,this.streamInference=e.streamInference,this.codeEvaluator=new d(e)}getTranscript(){return this.transcript}async*streamSampleNextStep(){const e=this.streamInference(this.getTranscript()),t=this.counter++;let o="";for await(const i of e)o+=i,yield{type:"assistant",id:t,value:o}}async sampleNextStep(){let e;for await(const t of this.streamSampleNextStep())e=t;return e}async simulateStep(e){if("assistant"===e.type||"human"===e.type){return await this.evaluateStep(e,!1)}return[]}async commitStep(e){if(this.transcript=[...this.transcript,e],"assistant"===e.type){const t=await this.evaluateStep(e,!0);return t.length>0&&(this.transcript=[...this.transcript,...t]),t}return"context"===e.type&&(this.codeEvaluator.state.context=e.context),[]}commitStepWithoutEvaluating(e){this.transcript=[...this.transcript,e]}async refreshPages(){}createAssistantStep(e){return{id:this.counter++,type:"assistant",value:e}}createHumanStep(e){return{id:this.counter++,type:"human",value:e}}createContextStep(e){return{id:this.counter++,type:"context",context:e}}async evaluateStep(e,t){const o=(await this.codeEvaluator.eval({input:e.value,commit:t})).map((e=>({...e,id:this.counter++})));return n().compact(o)}async refreshPageObservations(){const e=this.transcript.filter((e=>"observation"===e.type&&"page"===e.observationType)),t=n().groupBy(e,"pageId"),o=Object.values(t).map((e=>e[e.length-1]));for(const i of o){const{pageId:e}=i,t=(await this.codeEvaluator.eval({input:`<load-page id="${e}"/>`,commit:!0}))[0];if("page"!==(null==t?void 0:t.observationType))throw new Error("Expected page observation");i.value!==t.value&&(this.transcript=[...this.transcript,{...t,id:this.counter++}])}}}function g(e,t){let o=e.map((e=>{if("context"===e.type){let t="<context ";for(const o of Object.keys(e.context)){const i=e.context[o];if("string"==typeof i)t+=`${o}="${i}" `;else{if(!Array.isArray(i))throw new Error("Unknown context value type");t+=`${o}="${i.join(",")}" `}}return t+="/>",{type:"human",value:t.trim()}}if("human"===e.type)return{type:"human",value:e.value.trim()};if("observation"!==e.type){if("assistant"===e.type)return{type:"assistant",value:e.value.trim()};throw new Error("Unknown step type")}return"page"===e.observationType||"search"===e.observationType||"queryDatabase"===e.observationType?{type:"stdout",value:e.value.trim()}:"error"===e.observationType?{type:"stderr",value:e.value.trim()}:void function(e){throw new Error(`Expected value to never occur: ${JSON.stringify(e)}`)}(e)}));return o=o.reduce(((e,t)=>{if("stdout"===t.type){const o=e[e.length-1];if(o&&"stdout"===o.type)return o.value+=`\n${t.value}`,e}if("stderr"===t.type){const o=e[e.length-1];if(o&&"stderr"===o.type)return o.value+=`\n${t.value}`,e}return[...e,t]}),[]),o=o.map((e=>"stdout"===e.type?{type:"assistant",value:`<stdout>\n${e.value}\n</stdout>`}:"stderr"===e.type?{type:"assistant",value:`<stderr>\n${e.value}\n</stderr>`}:e)),o=o.reduce(((e,t)=>{if("human"===t.type){const o=e[e.length-1];if(o&&"human"===o.type)return o.value+=`\n${t.value}`,e}if("assistant"===t.type){const o=e[e.length-1];if(o&&"assistant"===o.type)return o.value+=`\n${t.value}`,e}return[...e,t]}),[]),null!=t&&t.hideHumanAssistantTurnPrefix||(o=o.map((e=>{if("human"===e.type)return{type:"human",value:`\n\nHuman: ${e.value}`};if("assistant"===e.type)return{type:"assistant",value:`\n\nAssistant: ${e.value}`};throw new Error(`Unknown step type: ${e}`)}))),o.map((e=>e.value)).join("")}function h(e){throw new Error(`Expected value to never occur: ${JSON.stringify(e)}`)}class f{constructor(e){this.counter=0,this.uuidToCounterMap=new Map,this.counterToUUidMap=new Map,e&&(this.uuidToCounterMap=new Map(Object.entries(e.uuidToCounterMap)),this.counterToUUidMap=new Map(Object.entries(e.counterToUUidMap)),this.counter=this.counterToUUidMap.size)}serialize(){return{uuidToCounterMap:Object.fromEntries(this.uuidToCounterMap),counterToUUidMap:Object.fromEntries(this.counterToUUidMap)}}mapUUIDToCounter(e){if(!this.uuidToCounterMap.has(e)){const t=this.counter.toString();this.uuidToCounterMap.set(e,t),this.counterToUUidMap.set(t,e),this.counter++}return this.uuidToCounterMap.get(e)}mapNodeUUIDToCounter(e){const t={...e};if("block"===t.type){t.id=this.mapUUIDToCounter(t.id),t.attributes=this.mapNodeAttributesUUIDToCounter(t.attributes),t.text=t.text.map((e=>this.mapNodeUUIDToCounter(e))),t.children=t.children.map((e=>{const o=this.mapNodeUUIDToCounter(e);return o.parent=t,o}));const e={};for(const[o,i]of Object.entries(t.properties))e[o]=this.mapNodeUUIDToCounter(i);return t.properties=e,t}return"property"===t.type||"inline"===t.type?(t.attributes=this.mapNodeAttributesUUIDToCounter(t.attributes),t.children=t.children.map((e=>this.mapNodeUUIDToCounter(e))),t):"text"===t.type?t:void h(t)}mapNodeAttributesUUIDToCounter(e){if(!e)return e;const t={...e};for(const o of f.attributesToMap){const e=t[o];e&&(t[o]="href"===o?e:this.mapUUIDToCounter(e))}return t}mapCounterToUUID(e){const t=this.counterToUUidMap.get(e);if(!t)throw new Error(`Tried to map invalid id: ${e}`);return t}mapNodeCounterToUUID(e){const t={...e};if("block"===t.type){t.id=this.mapCounterToUUID(t.id),t.attributes=this.mapNodeAttributesCounterToUUID(t.attributes),t.children=t.children.map((e=>{const o=this.mapNodeCounterToUUID(e);return o.parent=t,o}));const e={};for(const[o,i]of Object.entries(t.properties))e[o]=this.mapNodeCounterToUUID(i);return t.properties=e,t}return"property"===t.type||"inline"===t.type?(t.attributes=this.mapNodeAttributesCounterToUUID(t.attributes),t.children=t.children.map((e=>this.mapNodeCounterToUUID(e))),t):"text"===t.type?t:"move"===t.type?(t.attributes=this.mapNodeAttributesCounterToUUID(t.attributes),t):void h(t)}mapNodeAttributesCounterToUUID(e){if(!e)return e;const t={...e};for(const o of f.attributesToMap){const e=t[o];e&&(t[o]="href"===o?`/${this.mapCounterToUUID(e).split("/")[0].replaceAll("-","")}`:this.mapCounterToUUID(e))}return t}mapNodePropertiesCounterToUUID(e){const t={};for(const[o,i]of Object.entries(e))i&&(t[o]=this.mapNodeCounterToUUID(i));return t}mapAssistantOperationCounterToUUID(e){if("createBlock"===e.command){const t=e.blockNode;return{...e,blockNode:{...t,id:this.mapCounterToUUID(t.id),text:t.text.map((e=>this.mapNodeCounterToUUID(e))),children:t.children.map((e=>this.mapNodeCounterToUUID(e))),attributes:this.mapNodeAttributesCounterToUUID(t.attributes),properties:this.mapNodePropertiesCounterToUUID(t.properties),parent:t.parent&&this.mapNodeCounterToUUID(t.parent)}}}return"removeBlock"===e.command?{...e,parentId:this.mapCounterToUUID(e.parentId),removeId:this.mapCounterToUUID(e.removeId)}:"insertBlockBefore"===e.command?{...e,parentId:this.mapCounterToUUID(e.parentId),insertId:this.mapCounterToUUID(e.insertId),beforeId:e.beforeId?this.mapCounterToUUID(e.beforeId):void 0}:"insertBlockAfter"===e.command?{...e,parentId:this.mapCounterToUUID(e.parentId),insertId:this.mapCounterToUUID(e.insertId),afterId:e.afterId?this.mapCounterToUUID(e.afterId):void 0}:"setBlockText"===e.command||"setBlockAttribute"===e.command||"setBlockTagName"===e.command?{...e,id:this.mapCounterToUUID(e.id)}:"setBlockProperty"===e.command?{...e,blockId:this.mapCounterToUUID(e.blockId),parentBlockId:this.mapCounterToUUID(e.parentBlockId),property:this.mapNodeCounterToUUID(e.property)}:"insertOrMoveTableColumns"===e.command?{...e,blockId:this.mapCounterToUUID(e.blockId),insertOrMoves:e.insertOrMoves.map((e=>this.mapNodeCounterToUUID(e)))}:"removeTableColumn"===e.command?{...e,blockId:this.mapCounterToUUID(e.blockId)}:void h(e)}}f.attributesToMap=["id","page-id","database-id","person-id","href"];var v=o(94568),y=o(88891);function b(e){const{type:t,transcript:o}=e,i=o[o.length-1];return i&&"observation"===i.type&&"error"===i.observationType?function(e){return[...e,{id:0,type:"human",value:"Your last step returned an error and was not executed. Please try the last step again but with the error fixed."}]}(o):"single-page-qa"===t?function(e){const t=e[e.length-1],o=e.filter((e=>"human"===e.type)),i=o[o.length-1];if(i&&"human"===(null==t?void 0:t.type))return[...S,...e.map((e=>e===i?{...e,value:["Use <chat> to respond to my request about this page.","",i.value].join("\n")}:e))];return e}(o):"search-qa"===t?function(e){const t=e[e.length-1],o=e.filter((e=>"human"===e.type)),i=o[o.length-1];if(i&&"human"===(null==t?void 0:t.type))return[...w,...e.map((e=>e===i?{...e,value:['Use <search question="" keywords=""/> to search the workspace for relevant information.',"Provide a detailed question to answer, and a space-separated list of Google-style search keywords. Include at least 2 keywords.","When constructing a question and keywords, do not infer any additional context not already in the human's message.","","DO NOT use <chat>.","",i.value].join("\n")}:e))];if(i&&"observation"===(null==t?void 0:t.type)&&"search"===t.observationType)return[...w,...e.map((e=>e===i?{...e,value:["Use the search results attempt to answer the question using <chat>.","Keep your answer concise and to the point.","Note that the search results may not contain any information relevant to the question.","","You must cite ALL pages that were referenced in the answer by wrapping text in a link to the page.","Citations should be incorporated naturally without negatively affecting the readability of the answer.","In particular, do not link long regions of text.",'Format for links: <a href="page ID">link text</a>',"",i.value].join("\n")}:e))];return e}(o):"search-edit"===t?function(e){const t=e[e.length-1],o=e.filter((e=>"human"===e.type)),i=o[o.length-1];if(i&&"human"===(null==t?void 0:t.type))return[...k,...e.map((e=>e===i?{...e,value:['Use <search question="" keywords=""/> to search the workspace for relevant information.',"Provide a detailed question to answer, and a space-separated list of Google-style search keywords. Include at least 2 keywords.","When constructing a question and keywords, do not infer any additional context not already in the human's message.","",i.value].join("\n")}:e))];if(i&&"observation"===(null==t?void 0:t.type)&&"search"===t.observationType)return[...k,...e.map((e=>e===i?{...e,value:["Using information from the search results, attempt to edit the page.","Note that the search results may not contain relevant information.","",'After completing your edit, use <chat> to cite all pages you referenced by creating a text block with a page mention inside. Use this format: <chat><text>Sources:</text><text><mention-page page-id="ID 1"/></text><text><mention-page page-id="ID 2"/></text><text><mention-page page-id="ID 3"/></text></chat>...',"",i.value].join("\n")}:e))];return e}(o):"database-qa-text"===t?function(e){const t=e[e.length-1],o=e.filter((e=>"human"===e.type)),i=o[o.length-1];if(i&&"human"===(null==t?void 0:t.type))return[...C,...e.map((e=>e===i?{...e,value:["Use <query-database> to construct a database query to respond to my request.","DO NOT use <chat>.","","Types of filters:",'Use \'contains\' to find pages that contain a string: <query-database id="database ID"><filter-property-text name="property name" condition="contains">text</filter-property-text></query-database>','Use \'not contains\' to find pages that do not contain a string: <query-database id="database ID"><filter-property-text name="property name" condition="not contains">text</filter-property-text></query-database>','Use \'is\' to find pages that match an exact string: <query-database id="database ID"><filter-property-text name="property name" condition="is">text</filter-property-text></query-database>','Use \'not is\' to find pages that do not match an exact string: <query-database id="database ID"><filter-property-text name="property name" condition="not is">text</filter-property-text></query-database>','Use \'is\' with no value to find pages with an empty value: <query-database id="database ID"><filter-property-text name="property name" condition="is"></filter-property-text></query-database>','Use \'not is\' with no value to find pages with a value filled in: <query-database id="database ID"><filter-property-text name="property name" condition="not is"></filter-property-text></query-database>','Combine multiple filters to match \'any\': <query-database id="database ID"><filter-group match="any"><filter-property-text name="property name" condition="is">text filter 1</filter-property-text><filter-property-text name="property name" condition="is">text filter 2</filter-property-text></filter-group></query-database>','Combine multiple filters to match \'all\': <query-database id="database ID"><filter-group match="all"><filter-property-text name="property name" condition="is">text filter 1</filter-property-text><filter-property-text name="property name" condition="is">text filter 2</filter-property-text></filter-group></query-database>',"",i.value].join("\n")}:e))];if("observation"===t.type&&"queryDatabase"===t.observationType)return[...e.map((e=>e===i?{...e,value:["Use the database query results to respond to my request using <chat>.","Keep your answer concise and to the point.","Note that the results may not contain any information relevant to the question.","Note that there may be more results than are shown above. The results are paginated.","","You must link to ALL databases and pages that were referenced in the answer by wrapping text in a link to the page or database.","Do not link to the same page or database more than once.","Links should be incorporated naturally without negatively affecting the readability of the answer.","In particular, do not link long regions of text.",'Format for links: <a href="page ID or database ID">link text</a>',"",i.value].join("\n")}:e))];return e}(o):o}const S=[{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-03-15T12:23:03.239-04:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0">Shopping list<text id="1">A dash of roux, a glug of soy, garlic and ginger abound—Japanese curry comes together in a flavorful bound! Add meat and veggies to your heart\'s delight for a comforting meal to make everything right.</text><todo id="2">Japanese curry roux packet x1</todo><todo id="3">Soy sauce x1 bottle</todo><todo id="4">Garlic x1 bulb</todo><todo id="5">Ginger x1 knob</todo><todo id="6">Green onions x1 bunch</todo><todo id="7">Vegetables (carrots, potatoes, onions, etc.) xAssorted</todo><todo id="8">Pork or chicken x1 pound</todo><todo id="9">Rice x1 bag</todo></page>'},{id:0,type:"human",value:"<chat><text>Which vegetables are mentioned in this recipe?</text></chat>"},{id:0,type:"assistant",value:"<chat><text>This recipe mentions carrots, potatoes, and onions.</text></chat>"},{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-04-03T15:54:49.835-07:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0">Ancient Greek History <h2 id="1">Early Civilizations</h2><text id="2">The ancient Greeks are thought to have emerged as a distinct civilization around 1600 BC. During this time period, they developed a complex and rich culture complete with art, literature, and philosophy.</text><h2 id="3">Greek City-States</h2><text id="4">One of the defining characteristics of ancient Greek civilization was the development of city-states. These city-states, such as Athens and Sparta, were independent political units that often competed with one another. Each city-state had its own unique culture and priorities.</text><text id="5">During this time period, city-states such as Athens and Sparta reached the height of their power. They became centers of art, culture, and trade, but often fought with one another in attempts to dominate the region.</text><h2 id="6">The Golden Age</h2><text id="7">The Golden Age of ancient Greece is usually considered to have occurred during the 5th and 4th centuries BC. This was a time of incredible achievement in art, literature, and philosophy. The most famous figures from this time period include Socrates, Plato, and Aristotle.</text><text id="8"></text><text id="9"></text></page>'},{id:0,type:"human",value:"<chat><text>List the key ideas</text></chat>"},{id:0,type:"assistant",value:" <chat><uli>Around 1600 BC, ancient Greek civilization emerged with distinct culture, art, literature and philosophy.</uli><uli>Greek city-states, like Athens and Sparta, became politically independent units with unique priorities that sometimes competed and warred with each other.</uli><uli>Between 5th to 4th century BC, considered the Golden Age of ancient Greece, they achieved remarkable innovations in art, literature and philosophy.</uli><uli>Famous figures included Socrates, Plato and Aristotle who pioneered new ideas in science, logic, ethics.</uli></chat>"}],w=[{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-04-03T15:54:49.835-07:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0"><text id="1"></text></page>'},{id:0,type:"human",value:"<chat><text>who is the chief marketing officer?</text></chat>"},{id:0,type:"assistant",value:'<search question="Who is the chief marketing officer?" keywords="chief marketing officer"/>'},{id:0,type:"observation",observationType:"search",value:'<search-results><page-result id="8" title="Leadership Team" created-datetime="2022-10-30T02:26-07:00" last-edited-datetime="2022-05-21T01:14-07:00" summary="Introduction to the leadership team at PlaygroundRetail, including their roles and backgrounds in the technology and retail sectors">Maya Patel, CMO</page-result>\n\t\t<page-result id="10" title="Investor Relations" created-datetime="2022-11-16T18:59-08:00" last-edited-datetime="2022-05-01T08:24-07:00" summary="Information about PlaygroundRetail, an electronics retailer with over 500 stores across North America and an expanding ecommerce business">There is no information provided about the chief marketing officer of PlaygroundRetail.</page-result>\n\t\t<page-result id="12" title="PlaygroundRetail: Career Paths" created-datetime="2022-11-23T03:58-08:00" last-edited-datetime="2022-07-30T14:51-07:00" summary="Overview of career opportunities at PlaygroundRetail, including retail, operations, corporate, and internship positions">Our corporate offices house positions in marketing, finance, merchandising, and more.\n\t\tMid-level and senior positions include Marketing Manager, Accounting Manager, and Director of Merchandising.</page-result>\n\t\t<page-result id="2" title="Our Story" created-datetime="2022-10-04T23:13-07:00" last-edited-datetime="2022-05-14T20:21-07:00" summary="Overview of the history, mission, and products of PlaygroundRetail, a technology retailer with over 100 stores across the United States and Canada">There is no information on the chief marketing officer of PlaygroundRetail.</page-result>\n\t\t<page-result id="14" title="Featured Articles" created-datetime="2022-09-01T07:48-07:00" last-edited-datetime="2022-05-22T13:39-07:00" summary="Featured articles about PlaygroundRetail, including positive reviews and recognition from media outlets such as CNET, Forbes, and TechRadar">There is no information on the chief marketing officer of PlaygroundRetail.</page-result>\n\t\t<page-result id="15" title="Industry Awards" created-datetime="2022-06-10T08:44-07:00" last-edited-datetime="2022-04-20T15:46-07:00" summary="PlaygroundRetail\' recent industry awards, including recognition for their smart home product bundle, customer satisfaction, CEO Jane Lee\'s leadership, in-store experience, and affordable drone kit."></page-result>\n\t\t<page-result id="17" title="Exclusive Offers" created-datetime="2022-09-10T00:18-07:00" last-edited-datetime="2022-04-04T08:07-07:00" summary="Exclusive offers available to loyalty club members of PlaygroundRetail, including members-only sales, VIP pricing, double reward points, premium delivery and support, and exclusive invite-only events."></page-result>\n\t\t<page-result id="18" title="Media Coverage" created-datetime="2022-12-14T09:39-08:00" last-edited-datetime="2022-06-25T02:40-07:00" summary="Positive media coverage of PlaygroundRetail, including recognition for accessibility and customer service">No excerpt is relevant to the question.</page-result></search-results>'},{id:0,type:"assistant",value:'<chat><text><a href="0">Maya Patel</a> is the chief marketing officer of PlaygroundRetail.</text></chat>'},{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-04-23T12:21:63.125-06:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0">Virtual Reality<text id="1">Immerse yourself in virtual worlds with our wide selection of virtual reality products. We carry VR headsets, controllers, and accessories from top brands like Oculus, HTC Vive, PlayStation VR, and more.</text><h2 id="2">VR Headsets</h2><text id="3">Our VR headsets allow you to explore virtual reality through high-resolution displays, spatial audio, and intuitive controllers.</text><columns id="4"><column id="5"><h3 id="6">Oculus Quest 2</h3><text id="7">Oculus\'s latest standalone VR headset, the Quest 2, delivers a superior all-in-one virtual reality experience with next-generation graphics, higher resolution display, a faster processor, stylish new controllers with improved ergonomics. No PC or mobile phone required.<b>$299.</b></text></column><column id="8"><h3 id="9">HTC Vive Pro 2</h3><text id="10">HTC\'s premier virtual reality system, the Vive Pro 2, offers 5K resolution and a 120° field of view for incomparably clear and light field sweeping visuals. Precise room-scale tracking, ergonomic wireless controllers, and powerful components let you explore VR with uninhibited immersion. Compatible with a desktop PC.<b>$799.</b></text></column><column id="11"><h3 id="12">PlayStation VR</h3><text id="13">Sony\'s PlayStation VR pairs with your PS4 console to provide an immersive virtual reality gaming experience. Easy to set up and use, with access to a strong library of VR titles like Astro Bot Rescue Mission, No Man\'s Sky, and Resident Evil 7. PlayStation Move controllers and PlayStation VR aim controller included.<b>$399.</b></text></column></columns><h2 id="14">VR Accessories</h2><text id="15">We offer a range of accessories to enhance your virtual reality experience, including additional controllers, tracking stations, headphones, gaming chairs, and more.</text><columns id="16"><column id="17"><h3 id="18">Valve Index Controllers</h3><text id="19">Valve\'s ergonomic Index Controllers feature revolutionary fingertracking sensors and reliable input, allowing for unparalleled control, movement, and immersion in virtual reality. Compatible with Valve Index, HTC Vive, and Windows Mixed Reality.<b>$279.</b></text></column><column id="20"><h3 id="21">Oculus Touch Controllers</h3><text id="22">The Oculus Touch controllers allow for natural and intuitive interaction within virtual reality. Features moveable thumb sticks, buttons, sensors, and a comfortable ergonomic design. Compatible with Oculus Quest and Oculus Rift headsets.<b>$69.</b></text></column><column id="23"><h3 id="24">HyperX Cloud Orbit S Headset</h3><text id="25">The HyperX Cloud Orbit S wired gaming headset provides high-resolution audio and supreme comfort for VR gaming sessions. Features planar magnetic drivers for ultra-wide frequency range, noise-canceling microphone, breathable memory foam ear pads and headband. 3.5mm connector compatible with most VR headsets.<b>$329.</b></text></column></columns></page>'},{id:0,type:"human",value:"<chat><text>can you list the cameras we offer and how much they cost</text></chat>"},{id:0,type:"assistant",value:'<search question="What cameras does we and how much do they cost?" keywords="cameras cost price sale"/>'},{id:0,type:"observation",observationType:"search",value:'<search-results><page-result id="22" title="Cameras & Photography" created-datetime="2022-10-12T11:32-07:00" last-edited-datetime="2022-06-09T09:24-07:00" summary="Bits & Bytes offers a variety of cameras, including point-and-shoot, DSLR, mirrorless, and action cameras, as well as drones, with prices ranging from $99 to $499.">Our point-and-shoot cameras are highly compact and portable, perfect for casual and everyday shooting. Starting at just $99.\n\t\tFor professional and advanced amateur photographers, we offer a selection of DSLR cameras from top brands like Canon, Nikon, Sony, and Pentax. DSLR camera packages start at $499.\n\t\tMirrorless cameras combine the image quality of a DSLR with the lightweight and compact size of a point-and-shoot. Our mirrorless camera selection starts at $299.\n\t\tLooking for an action camera or drone? Action cameras start at $99 and drones start at $399.</page-result>\n\t\t<page-result id="6" title="Product Categories" created-datetime="2022-08-06T00:34-07:00" last-edited-datetime="2023-04-05T09:23-07:00" summary="Overview of product categories sold by Bits & Bytes, including electronics such as cameras, virtual reality, and robotics & DIY kits"><child-page id="3" page-id="2">Cameras & Photography</child-page></page-result>\n\t\t<page-result id="23" title="This Week\'s Flyer" created-datetime="2022-08-21T21:10-07:00" last-edited-datetime="2022-09-23T01:29-07:00" summary="Deals and promotions from Bits & Bytes, including discounts on smart watches, drones, robotics kits, headphones and speakers, and virtual reality starter sets, as well as preorders for new gadgets and technology">Save 15% on select drones from top brands like DJI, Ryze, and Snaptain, as well as spare batteries, chargers, cameras, and other drone parts and accessories.\n\t\t</page-result>\n\t\t<page-result id="24" title="Bits & Bytes Sale Highlights" created-datetime="2022-11-23T20:05-08:00" last-edited-datetime="2022-06-08T18:01-07:00" summary="Highlights of the Bits & Bytes sale, featuring discounts on smart watches, fitness trackers, virtual reality headsets, memory and storage upgrades, gaming PC components, smartphone stabilizers, chargers and cables, robot kits and drones, and smart devices.">Just released—the new DJI OM 3 Gimbal smartphone stabilizer for only $99, a $30 value over the previous version.</page-result>\n\t\t<page-result id="25" title="Bits & Bytes - Drones & Gadgets" created-datetime="2022-04-22T03:18-07:00" last-edited-datetime="2022-11-08T07:17-08:00" summary="Bits & Bytes offers a variety of drones and gadgets, including cameras such as the DJI Mavic 3, Ryze Tello, and Parrot ANAFI."><b>DJI Mavic 3:</b>DJI\'s latest prosumer drone with a Hasselblad camera for stunning 4K video and 20MP photos. It has a max flight time of up to 46 minutes and costs $2,999.\n\t\t<b>Ryze Tello:</b>A small but mighty drone perfect for beginners and kids. The Tello drone has a 5MP camera, practices safe flight features, and is controlled with an app. It\'s just $99.\n\t\t<b>Parrot ANAFI:</b>A high-performance yet portable drone with 4K HDR camera, 3-axis gimbal for smooth footage, and a max flight time of 25 minutes. Starting at $699, it\'s ideal for hobbyist filmmakers and photographers.</page-result>\n\t\t<page-result id="26" title="Laptops & Computers at Bits & Bytes" created-datetime="2022-05-29T04:24-07:00" last-edited-datetime="2022-05-01T03:29-07:00" summary="Bits & Bytes offers laptops, desktop PCs, and computer components from top brands like Dell, HP, Acer, and Lenovo, with varying specifications and prices."></page-result>\n\t\t<page-result id="28" title="Members Only Savings" created-datetime="2022-08-16T03:33-07:00" last-edited-datetime="2022-05-09T12:27-07:00" summary="Bits & Bytes Members can save 15% on a variety of tech products, including smart speakers, virtual reality headsets, smartphones, DIY tech kits, and more.">Visit your local Bits & Bytes store or shop online at bitsandbytes.com to discover all the extra savings for Members this week. From smart home devices to cameras, Bluetooth speakers, gaming gear, and more, you\'ll find a huge selection at 15% off when you use coupon code MEMBER15 at checkout.</page-result>\n\t\t<page-result id="29" title="Deals of the Week" created-datetime="2022-09-21T00:50-07:00" last-edited-datetime="2022-08-07T22:37-07:00" summary="Deals of the Week at Bits & Bytes, including discounts on smart watches and fitness trackers, DIY electronics kits, and drones and robotics kits">No information on cameras is provided on the page.</page-result>\n\t\t<page-result id="30" title="Bits & Bytes: Wearable Tech" created-datetime="2022-07-13T14:43-07:00" last-edited-datetime="2022-07-09T02:44-07:00" summary="Overview of wearable technology products sold by Bits & Bytes, including smart watches, fitness trackers, and virtual reality headsets">N/A</page-result></search-results>'},{id:0,type:"assistant",value:'<chat><text>According to <a href="22">Cameras & Photography</a>, we offer offer point-and-shoot cameras starting at $99, DSLR camera packages at $499, and mirrorless cameras from $299.</text><text>Action cameras are $99 and <a href="25">beginner drones</a> start around $99-$399. <a href="23">Select models</a> are on sale too!</text></chat>'},{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-04-23T12:21:63.125-06:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0"><h1 id="1">Intern documentation</h1></page>'},{id:0,type:"human",value:"<chat><text>Are we hiring interns?</text></chat>"},{id:0,type:"assistant",value:'<search question="Are we hiring interns?" keywords="interns careers internships jobs openings positions work students"/>'},{id:0,type:"observation",observationType:"search",value:'<search-results><page-result id="22" title="Job Openings at True Blue" created-datetime="2022-09-03T17:31-07:00" last-edited-datetime="2022-10-20T14:30-07:00" summary="Job openings at True Blue, including positions at retail stores, corporate headquarters, and internships">True Blue offers summer internship opportunities for students interested in technology and retail.</page-result>\n\t\t<page-result id="16" title="Careers" created-datetime="2022-05-03T07:43-07:00" last-edited-datetime="2022-04-06T07:08-07:00" summary="Information about career opportunities at True Blue, including retail positions, corporate roles, and internships">Explore career opportunities available at True Blue, including retail positions, corporate roles, and internships.</page-result>\n\t\t<page-result id="23" title="True Blue: Career Paths" created-datetime="2022-11-23T03:58-08:00" last-edited-datetime="2022-07-30T14:51-07:00" summary="Overview of career opportunities at True Blue, including retail, operations, corporate, and internship positions">We offer internship programs for students interested in retail, operations, merchandising, marketing, and finance.</page-result>\n\t\t<page-result id="24" title="Internships & Opportunities" created-datetime="2023-02-04T23:29-08:00" last-edited-datetime="2022-05-08T04:44-07:00" summary="Information about career opportunities at True Blue, including internships in various areas of the business">Our internship programs provide hands-on experience in the technology industry and a chance to contribute to an innovative company. We offer internships in merchandising, marketing, inventory management, finance, and IT.\n\t\tInternships typically last 3 months over the summer and may lead to full-time job offers for exceptional candidates.</page-result>\n\t\t<page-result id="25" title="Community Sponsorships" created-datetime="2023-02-25T13:09-08:00" last-edited-datetime="2022-03-29T14:27-07:00" summary="True Blue\' community outreach initiatives, including partnerships with local schools, scholarships and internships, and nonprofit partnerships to support STEM education and innovation">We also hire over 50 interns across our stores and corporate office, providing hands-on experience and mentorship in retail, marketing, finance, and product management roles. Many of our interns have gone on to work for True Blue full-time after graduating.</page-result>\n\t\t<page-result id="26" title="STEM Education" created-datetime="2022-06-04T11:38-07:00" last-edited-datetime="2022-07-31T15:31-07:00" summary="True Blue\' initiatives to promote STEM education, including donating technology and funds to schools, offering free coding and robotics camps, partnering with national nonprofits, providing an employee volunteer program, and offering scholarships and internships to underrepresented students pursuing tech-related degrees">We offer college scholarships and paid internships to students pursuing degrees in tech-related fields. Our programs target those from disadvantaged backgrounds who are underrepresented in the tech industry. Over the past 5 years, we have awarded over $10 million in scholarships and hired 500 interns at True Blue.</page-result>\n\t\t<page-result id="27" title="Workplace Culture at True Blue" created-datetime="2023-01-20T22:00-08:00" last-edited-datetime="2022-04-15T10:31-07:00" summary="Overview of workplace culture at True Blue, including continuous learning and development, an inclusive and diverse environment, fun and rewarding work, work-life balance, and career growth opportunities.">True Blue provides substantial opportunities for career growth. Many of our retail employees and interns have transitioned into corporate roles.</page-result>\n\t\t<page-result id="28" title="True Blue: School Grants" created-datetime="2022-07-14T10:37-07:00" last-edited-datetime="2022-07-11T16:40-07:00" summary="Information about the True Blue School Grant Program, which awards grants to K-12 schools for technology education, and partnerships with nonprofits to support technology education"></page-result>\n\t\t<page-result id="29" title="True Blue Volunteer Initiatives" created-datetime="2022-11-06T04:43-08:00" last-edited-datetime="2022-05-06T06:13-07:00" summary="True Blue\' volunteer initiatives, including coding camps for kids, robotics team sponsorships, donation drives, STEM career days, scholarships and internships, and charity fundraising.">We offer competitive paid internships and scholarships for college students pursuing technology and engineering degrees. Over 500 students have participated in our internship program, and we have awarded scholarships to more than 1,000 students since the program began.</page-result></search-results>'},{id:0,type:"assistant",value:'<chat><text>Yes, <a href="22">we offer summer internships</a> for students in areas such as <a href="24">merchandising, marketing, inventory management, finance, and IT</a>.</text><text>According to <a href="25">Community Sponsorships</a>, we hire over 50 interns across stores and offices annually, with many converting to full-time roles.</text></chat>'}],k=[{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-04-03T15:54:49.835-07:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0">Product Categories<text id="1">Shop our wide selection of electronics, including smart home devices, virtual reality, computers & laptops, cameras, robotics & DIY kits, and more.</text><child-page id="3" page-id="2">Cameras & Photography</child-page><child-page id="5" page-id="4">Bits & Bytes: Smart Home</child-page><child-page id="7" page-id="6">Bits & Bytes - Drones & Gadgets</child-page><child-page id="9" page-id="8">Bits & Bytes: Wearable Tech</child-page><child-page id="11" page-id="10">Bits & Bytes: Robotics & DIY Kits</child-page><child-page id="13" page-id="12">Laptops & Computers at Bits & Bytes</child-page><child-page id="15" page-id="14">Virtual Reality</child-page></page>'},{id:0,type:"human",value:"<chat><text>add a table with all of our charitable donations and how much they were, including columns: organization name, amount, and information source</text></chat>"},{id:0,type:"assistant",value:'<search question="What were all of our charitable donations, including the amounts given?" keywords="charitable donations amounts"/>'},{id:0,type:"observation",observationType:"search",value:'<search-results><page-result id="2" title="Charitable Donations" created-datetime="2022-09-25T18:13-07:00" last-edited-datetime="2022-09-02T14:10-07:00" summary="Bits & Bytes\' commitment to donating 1% of annual profits to charities and nonprofits promoting access to technology and technical education, including donations of $75,000 to DonorsChoose.org, $80,000 to Technovation Girls, $50,000 per year for 3 years to Girls Who Code, and $50,000 per year for 3 years to FIRST Robotics.">We have donated $75,000 to DonorsChoose.org...\n\t\tWe have donated $80,000 to Technovation Girls...\n\t\tWe have donated $50,000 per year for 3 years to Girls Who Code...\n\t\tWe have donated $50,000 per year for 3 years to FIRST Robotics...</page-result>\n\t\t<page-result id="3" title="Bits & Bytes: School Grants" created-datetime="2022-07-14T10:37-07:00" last-edited-datetime="2022-07-11T16:40-07:00" summary="Bits & Bytes\' School Grant Program and partnerships with nonprofits to support technology education in schools, including funding for digital tools, robotics kits, teacher training, and scholarships for students to attend tech camps and workshops">Our flagship education initiative is the annual Bits & Bytes School Grant Program. We award $1 million in grants to K-12 schools each year to fund technology education.\n\t\tLast year, we awarded over 300 grants totaling $1.2 million to schools across 50 states.\n\t\tWe also support technology education through partnerships with nonprofits like Girls Who Code, Black Girls Code, and Code.org.</page-result>\n\t\t<page-result id="5" title="Community Sponsorships" created-datetime="2023-02-25T13:09-08:00" last-edited-datetime="2022-03-29T14:27-07:00" summary="Bits & Bytes\' community outreach initiatives, including partnerships with local schools, scholarships and internships, and donations to national nonprofits focused on STEM education and innovation">We recently donated $50,000 worth of robotics kits, microcontrollers, and 3D printers to West Hills Middle School to start an after-school robotics club.\n\t\tEach year we award $200,000 in college scholarships to students studying technology and engineering fields.\n\t\tThrough partnerships, sponsorships, scholarships, internships, and product donations, Bits & Bytes contributes over $2 million each year to support technology education and advancement in our communities.</page-result>\n\t\t<page-result id="4" title="Bits & Bytes Volunteer Initiatives" created-datetime="2022-11-06T04:43-08:00" last-edited-datetime="2022-05-06T06:13-07:00" summary="Bits & Bytes\' volunteer initiatives, including coding camps, robotics team sponsorships, donation drives, STEM career days, scholarships and internships, charity fundraising, and disaster relief efforts">Donation Drives: We frequently organize donation drives to collect new and gently used tech products like laptops, tablets, and scientific calculators for local schools, libraries, and charitable organizations.\n\t\tCharity Fundraising: During the holidays, we hold charity drives across all our locations to raise money for organizations that promote technology education and access, such as Code.org, Girls Who Code, and DonorsChoose.org. We match all employee donations made during these drives.\n\t\tIn addition to our ongoing programs, we regularly hold fundraising and volunteering events in response to natural disasters and crises impacting the communities we serve. We have raised millions of dollars and donated thousands of volunteer hours for relief efforts in the aftermath of hurricanes, wildfires, and other events.</page-result>\n\t\t<page-result id="6" title="STEM Education" created-datetime="2022-06-04T11:38-07:00" last-edited-datetime="2022-07-31T15:31-07:00" summary="Bits & Bytes\' initiatives to promote STEM education, including donating technology and funds to schools, offering free coding and robotics camps, partnering with national nonprofits, employee volunteer program, and scholarships and internships for underrepresented students pursuing tech-related degrees.">We donate electronics, robotics kits, and funds to schools in the communities we serve so students can learn hands-on technical skills. Last year we donated over $5 million in products and funds to 500 schools across the country.\n\t\tIn 2019 we hosted over 10,000 students at our camps.\n\t\tOver the past 5 years, we have awarded over $10 million in scholarships and hired 500 interns at Bits & Bytes.</page-result>\n\t\t<page-result id="7" title="Community Outreach" created-datetime="2022-04-18T04:35-07:00" last-edited-datetime="2022-12-08T08:23-08:00" summary="Overview of community outreach initiatives related to education and innovation in STEM fields, including STEM education, community sponsorships, volunteer initiatives, charitable donations, and school grants"><todo id="9">Charitable Donations</todo></page-result>\n\t\t<page-result id="11" title="Bits & Bytes Sale Highlights" created-datetime="2022-11-23T20:05-08:00" last-edited-datetime="2022-06-08T18:01-07:00" summary="Highlights of a sale on various tech products, including smart watches, fitness trackers, virtual reality headsets, flash drives, gaming PC components, chargers, and smart devices"></page-result>\n\t\t<page-result id="12" title="Member Perks" created-datetime="2022-06-03T05:25-07:00" last-edited-datetime="2023-01-03T07:15-08:00" summary="Overview of the loyalty programs and perks offered by Bits & Bytes Club Rewards"></page-result>\n\t\t<page-result id="8" title="Investor Relations" created-datetime="2022-11-16T18:59-08:00" last-edited-datetime="2022-05-01T08:24-07:00" summary="Overview of Bits & Bytes, including its history, mission, leadership team, partnerships, financials, and contact information for investor relations">There is no information on charitable donations and amounts.</page-result>\n\t\t<page-result id="13" title="Points & Levels" created-datetime="2022-07-03T05:35-07:00" last-edited-datetime="2022-09-01T09:31-07:00" summary="Information about the loyalty rewards programs offered by Bits & Bytes, including the free Byte Points program and the paid MegaBytes program with exclusive benefits for customers who spend a minimum of $1,000 annually"></page-result></search-results>'},{id:0,type:"assistant",value:'<insert-after id="1"><table><tr><property-text name="1">Organization</property-text><property-text name="2">Amount Donated</property-text><property-text name="3">Year</property-text><property-text name="4">Information Source</property-text></tr><tr><property-text name="1">DonorsChoose.org</property-text><property-text name="2">$75,000</property-text><property-text name="3">2021</property-text><property-text name="4"><mention-page page-id="2"/></property-text></tr><tr><property-text name="1">Technovation Girls</property-text><property-text name="2">$80,000</property-text><property-text name="3">2021</property-text><property-text name="4"><mention-page page-id="2"/></property-text></tr><tr><property-text name="1">Girls Who Code</property-text><property-text name="2">$150,000</property-text><property-text name="3">2019-2021</property-text><property-text name="4"><mention-page page-id="2"/><mention-page page-id="6"/></property-text></tr><tr><property-text name="1">FIRST Robotics</property-text><property-text name="2">$150,000</property-text><property-text name="3">2019-2021</property-text><property-text name="4"><mention-page page-id="2"/><mention-page page-id="6"/></property-text></tr><tr><property-text name="1">West Hills Middle School</property-text><property-text name="2">$50,000</property-text><property-text name="3">2022</property-text><property-text name="4"><mention-page page-id="5"/></property-text></tr><tr><property-text name="1">STEM Education/Camps</property-text><property-text name="2">$5 million</property-text><property-text name="3">2021</property-text><property-text name="4"><mention-page page-id="6"/></property-text></tr><tr><property-text name="1">College Scholarships</property-text><property-text name="2">$200,000</property-text><property-text name="3">2021</property-text><property-text name="4"><mention-page page-id="5"/></property-text></tr><tr><property-text name="1">Volunteer/Fundraising Drives</property-text><property-text name="2">millions</property-text><property-text name="3">annual</property-text><property-text name="4"><mention-page page-id="4"/></property-text></tr><tr><property-text name="1">Natural Disaster Relief</property-text><property-text name="2">millions</property-text><property-text name="3">as needed</property-text><property-text name="4"><mention-page page-id="4"/></property-text></tr></table></insert-after><chat><text>Sources:</text><text><mention-page page-id="2"/></text><text><mention-page page-id="6"/></text><text><mention-page page-id="5"/></text><text><mention-page page-id="4"/></text></chat>'},{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-04-03T15:54:49.835-07:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0"><text id="1"></text></page>'},{id:0,type:"human",value:"<chat><text>write a tweet in this page announcing our internship roles</text></chat>"},{id:0,type:"assistant",value:'<search question="What internship roles are we offering?" keywords="internship roles positions"/>'},{id:0,type:"observation",observationType:"search",value:'<search-results><page-result id="2" title="True Blue: Career Paths" created-datetime="2022-11-23T03:58-08:00" last-edited-datetime="2022-07-30T14:51-07:00" summary="Overview of career opportunities at True Blue, including retail, operations, corporate, and internship positions">We offer internship programs for students interested in retail, operations, merchandising, marketing, and finance. Application page: trueblue.com/internships</page-result>\n\t\t<page-result id="3" title="Careers" created-datetime="2022-05-03T07:43-07:00" last-edited-datetime="2022-04-06T07:08-07:00" summary="Overview of career opportunities available at True Blue, including retail positions, corporate roles, and internships">Explore career opportunities available at True Blue, including retail positions, corporate roles, and internships.</page-result>\n\t\t<page-result id="4" title="Internships & Opportunities" created-datetime="2023-02-04T23:29-08:00" last-edited-datetime="2022-05-08T04:44-07:00" summary="Overview of internship, retail, and corporate job opportunities at True Blue, including specific details about the internship program and available roles in merchandising, marketing, inventory management, finance, and IT">Our internship programs provide hands-on experience in the technology industry and a chance to contribute to an innovative company. We offer internships in merchandising, marketing, inventory management, finance, and IT.\n\t\tMerchandising interns help select which products to carry in our stores. Marketing interns develop campaigns to promote new products and events. Inventory management interns track product shipments and optimize store inventory levels. Finance interns assist with budgeting, accounting, and reporting. And IT interns help support internal systems and develop new technology solutions.</page-result>\n\t\t<page-result id="5" title="Community Sponsorships" created-datetime="2023-02-25T13:09-08:00" last-edited-datetime="2022-03-29T14:27-07:00" summary="True Blue\' community outreach initiatives, including partnerships with local schools, scholarships and internships, and nonprofit partnerships to support STEM education and advancement">We also hire over 50 interns across our stores and corporate office, providing hands-on experience and mentorship in retail, marketing, finance, and product management roles. Many of our interns have gone on to work for True Blue full-time after graduating.</page-result>\n\t\t<page-result id="6" title="STEM Education" created-datetime="2022-06-04T11:38-07:00" last-edited-datetime="2022-07-31T15:31-07:00" summary="True Blue\' commitment to promoting STEM education through various initiatives, including donating technology and funds to schools, offering free coding and robotics camps, partnering with national nonprofits, employee volunteer program, and offering scholarships and internships to underrepresented students pursuing tech-related degrees.">We offer college scholarships and paid internships to students pursuing degrees in tech-related fields.\n\t\tOur programs target those from disadvantaged backgrounds who are underrepresented in the tech industry.\n\t\tOver the past 5 years, we have awarded over $10 million in scholarships and hired 500 interns at True Blue.</page-result>\n\t\t<page-result id="7" title="Job Openings at True Blue" created-datetime="2022-09-03T17:31-07:00" last-edited-datetime="2022-10-20T14:30-07:00" summary="Job openings at True Blue, including positions at retail stores, corporate headquarters, and summer internships in customer experience.">True Blue offers summer internship opportunities for students interested in technology and retail. Interns will assist the Marketing and Customer Experience teams with special projects aimed at improving the customer journey.</page-result>\n\t\t<page-result id="8" title="Workplace Culture at True Blue" created-datetime="2023-01-20T22:00-08:00" last-edited-datetime="2022-04-15T10:31-07:00" summary="Overview of the workplace culture at True Blue, including continuous learning and development, an inclusive and diverse environment, fun and rewarding work, work-life balance, and career growth opportunities"></page-result>\n\t\t<page-result id="9" title="True Blue: School Grants" created-datetime="2022-07-14T10:37-07:00" last-edited-datetime="2022-07-11T16:40-07:00" summary="True Blue School Grant Program and partnerships with nonprofits to support technology education">There is no information on internship roles in the given page.</page-result>\n\t\t<page-result id="10" title="True Blue Volunteer Initiatives" created-datetime="2022-11-06T04:43-08:00" last-edited-datetime="2022-05-06T06:13-07:00" summary="Overview of volunteer initiatives at True Blue, including coding camps for kids, robotics team sponsorships, donation drives, STEM career days, scholarships and internships, and charity fundraising.">We offer competitive paid internships and scholarships for college students pursuing technology and engineering degrees. Over 500 students have participated in our internship program, and we have awarded scholarships to more than 1,000 students since the program began.</page-result></search-results>'},{id:0,type:"assistant",value:' <insert-inside id="0"><text>Apply now for True Blue\'s paid summer internships in marketing, finance, IT and merchandising. Gain hands-on experience, mentorship from industry leaders and a chance to contribute to an innovative tech company. Learn more and apply at <a href="trueblue.com/internships">trueblue.com/internships</a></text></insert-inside><chat><text>Sources:</text><text><mention-page page-id="4"/></text><text><mention-page page-id="6"/></text><text><mention-page page-id="5"/></text></chat>'}],C=[{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-04-03T15:54:49.835-07:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0"><child-database id="52" database-id="53">Products<schema-property-text name="Product Name"/><schema-property-text name="Category"/><schema-property-text name="SKU"/><schema-property-text name="Availability Status"/></child-database></page>'},{id:0,type:"human",value:"<chat><text>List all the products in the category 'Toys'</text></chat>"},{id:0,type:"assistant",value:'<query-database id="53"><filter-property-text name="Category" condition="is">Toys</filter-property-text></query-database>'},{id:0,type:"context",context:{"available-commands":c.YK,"current-page-id":"0","current-datetime":"2023-04-03T16:54:49.835-07:00"}},{id:0,type:"assistant",value:'<load-page id="0"/>'},{id:0,type:"observation",observationType:"page",pageId:"0",value:'<page id="0"><child-database id="63" database-id="66">Patients<schema-property-text name="Full Name"/><schema-property-text name="Medical Record Number"/><schema-property-date name="Date of Birth"/><schema-property-text name="Contact Email"/><schema-property-text name="Primary Physician"/></child-database></page>'},{id:0,type:"human",value:"<chat><text>How many patients do we have named Barbara?</text></chat>"},{id:0,type:"assistant",value:'<query-database id="66"><filter-property-text name="Full Name" condition="contains">Barbara</filter-property-text></query-database>'}];function _(e){const t=e[e.length-1],o=e.filter((e=>"human"===e.type)),i=o[o.length-1];return i&&"human"===(null==t?void 0:t.type)?[...e.map((e=>e===i?{...e,value:[`${i.value}`,"","You are the bot defined by <instructions-page>.","Follow the instructions inside <instructions-page> to respond to the user's chat message above.","The user cannot see the text inside <instructions-page>.","The user is currently looking at the page inside <page>."].join("\n")}:e))]:e}var M=o(24993),T=o(90698);function I(e){return e.nodeType===T.NodeType.TEXT_NODE?{type:"text",value:e.textContent}:{type:"element",tagName:e.tagName.toLowerCase(),attributes:e.attributes,children:e.childNodes.map(I)}}var P=o(40682),x=o(65917),B=o(74229),Z=o(11799),E=o(29477),R=o(4615),A=o(21202),D=o(19889),F=o(97880),L=o(95477),V=o(99417),N=o(33929),O=o(98165),U=o(95802),H=o(79315),z=o(80863),W=o(3815),j=(o(12318),o(54642)),K=o(82993),Y=o(73928),G=o(47307),X=o(61045),q=o(24677),$=o(30149);const J=new P.z(1);function Q(e){var t;const{store:o}=e;null!==(t=o.state)&&void 0!==t&&t.temporaryCache&&o.state.temporaryCache.clearCache(),o.set(void 0)}async function ee(e){var t,o;const{environment:i,store:n,completionContext:s}=e;null!==(t=n.state)&&void 0!==t&&t.temporaryCache&&n.state.temporaryCache.clearCache();const l=e.hasOwnProperty("instructionsId")?e.instructionsId:null===(o=n.state)||void 0===o?void 0:o.instructionsId;n.set({sessionId:(0,R.ZP)(),clientSteps:[],sampledSteps:[],previewingStep:void 0,previewingStepIndex:void 0,previewingStepObservations:[],evaluator:new m({context:{"available-commands":c.YK},loadedPageIds:[],selection:void 0,blockIdMap:{},streamInference:async function*(e){var t;const{currentSpaceStore:o}=H.default.state;if(!o)throw new Error("No current space.");const r=null===(t=z.Hl.state)||void 0===t?void 0:t.type,a=await j.getCompletion(i,{id:(0,R.ZP)(),context:{type:"assistant",transcript:l?_(e):b({type:r,transcript:e})},model:"anthropic-2",spaceId:o.id,isSpacePermission:!1,debugOverrides:{returnDebugInfo:!0,ignoreRateLimit:!0}});if("success"!==a.type)return G.showError(a),{type:"error_modal_shown"};if(B.H1.is(a.data))for await(const i of a.data)if("success"===i.type){if(i.debugRenderedPrompt){if(!n.state)return;n.set({...n.state,samplingPrompt:i.debugRenderedPrompt})}yield i.completion}else if("error"===i.type)throw new Error(i.message)},parse:e=>function(e){return(0,T.parse)(e).childNodes.map(I)}(e),addOperation:e=>{if(!n.state)throw new Error("No state");const t=n.state.idMapper.mapAssistantOperationCounterToUUID(e),o=i.currentUser.id;if(!o)throw new Error("No current user.");const r={table:D.KJ,id:o};if(!n.state)throw new Error("No state");const{temporaryCache:a,transaction:s}=n.state;if(!s)throw new Error("No transaction.");const l=(0,y.N)({assistantOperation:t,actorPointer:r,getRecordValue:a.makeGetRecordValueFn(o)});n.set({...n.state,temporaryOperations:n.state.temporaryOperations.concat(l),temporaryAssistantOperations:n.state.temporaryAssistantOperations.concat(t)});for(const n of l){const e=new W.ST({environment:i,pointer:n.pointer,path:n.path,inMemoryRecordCache:a});$.applyOperation({store:e,operation:n,transaction:s})}},randomID:()=>{if(!n.state)throw new Error("No state");const e=(0,R.ZP)();return n.state.idMapper.mapUUIDToCounter(e)},loadPage:async e=>{if(!n.state)throw new Error("No state");const{mainEditorCurrentBlockStore:t}=H.default.state;if(!t)throw new Error("No current block store");const o={table:A.iU,id:n.state.idMapper.mapCounterToUUID(e),spaceId:t.getSpaceId()};n.set({...n.state,temporaryClientSteps:[...n.state.temporaryClientSteps,{type:"assistantLoadPage",pointer:o}]});const i=await(0,M.IT)({pointer:o,loadRecordValue:t.loadRecordValue,baseUrl:L.Z.domainBaseUrl,publicDomainName:L.Z.publicDomainName,intl:N.default.getIntl()});return n.state.idMapper.mapNodeUUIDToCounter(i)},search:async e=>{var t;const o=null===(t=H.default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!o)throw new Error("No space id");if(!n.state)throw new Error("No state");n.set({...n.state,temporaryClientSteps:[...n.state.temporaryClientSteps,{type:"assistantSearch",...e}]});const r=n.state.searchCache.get(e),{idMapper:a}=n.state;if(r)return r;{const t=(0,E.UZ)();n.state.searchCache.set(e,t.promise);const r=function(){const{mainEditorCurrentBlockStore:e}=H.default.state;if(!e)throw new Error("No current block store");const t=(0,O.qA)(e).map((e=>({table:e.table,value:e.getValue()})));return(0,v.If)({currentPageAncestors:t})}();if("production"===L.Z.env&&!r)throw new Error("No ancestor id");return j.performAiSearch(i,{...e,spaceId:o,ancestors:r?[r]:void 0}).then((e=>{if("success"!==e.type)return t.reject(e);const o=e.data.results.map((e=>({...e,id:a.mapUUIDToCounter(e.id)})));return t.resolve(o)})),t.promise}},async queryDatabase(e){const t=n.state;if(!t)throw new Error("No state");const o=i.currentUser.id;if(!o)throw new Error("No current user.");const{inMemoryRecordCache:r}=i.defaultRecordCache,{temporaryCache:a,committing:s}=n.state,l=(!s?a:r).makeGetRecordValueFn(o),{mainEditorCurrentBlockStore:c}=H.default.state;if(!c)throw new Error("No current block store");const{collectionViewBlockPointer:d,collectionPointer:p,filter:u,sort:m,limit:g}=(0,y.h)({assistantDatabaseQuery:e,idMapper:t.idMapper,spaceId:c.getSpaceId(),getRecordValue:l}),h=await new K.Ih({environment:i,clientContext:{type:"event",intl:N.default.getIntl(),actions:[],parentRecordStore:c,persisted:!1,parentPointer:{}},automationModel:{}}).queryCollection({actionId:"",collection:p,filter:u,sort:m,limit:g});if(h.error)throw h.error;n.set({...n.state,temporaryClientSteps:[...n.state.temporaryClientSteps,{type:"queryDatabase"}]});return h.value.blockIds.map((e=>(0,M.gu)({pointer:{table:A.iU,id:e},rootPointer:c.pointer,parentPointer:d,getRecordValue:l,intl:N.default.getIntl()}))).filter(F.$K).map((e=>t.idMapper.mapNodeUUIDToCounter(e)))},chat:(e,t)=>{const o=n.state;if(!o)throw new Error("No state");const i={blockIds:e.map((e=>o.idMapper.mapCounterToUUID(e))),operations:t.map((e=>o.idMapper.mapAssistantOperationCounterToUUID(e)))};n.set({...n.state,temporaryClientSteps:[...n.state.temporaryClientSteps,{type:"assistantChat",blockIds:i.blockIds,operations:i.operations}]})}}),temporaryOperations:[],uncommittedOperations:[],temporaryCache:new a.Z,sampling:!1,evaluating:!1,temporaryClientSteps:[],temporaryAssistantOperations:[],samplingPrompt:void 0,idMapper:new f,committing:!1,transaction:void 0,searchCache:new Z.Z,instructionsId:l});const d=H.default.state.mainEditorCurrentBlockStore;if(d){if(!n.state)throw new Error("No state");const e=n.state.idMapper,t="cursor"===(null==s?void 0:s.type)||"textSelection"===(null==s?void 0:s.type)?{type:"text",start:{blockId:e.mapUUIDToCounter(s.textSelection.start.store.id),index:s.textSelection.start.index},end:{blockId:e.mapUUIDToCounter(s.textSelection.end.store.id),index:s.textSelection.end.index}}:"blockSelection"===(null==s?void 0:s.type)?{type:"block",blockIds:s.stores.map((t=>e.mapUUIDToCounter(t.id)))}:void 0;n.state.evaluator.codeEvaluator.state.selection=t;const o=n.state.evaluator.createContextStep({"available-commands":c.YK,...l&&{"instructions-page-id":e.mapUUIDToCounter(l)},"current-page-id":e.mapUUIDToCounter(d.id),"current-datetime":r.ou.local().toISO({suppressMilliseconds:!0})}),a=await ae({environment:i,store:n,step:o,commit:!0,isStreaming:!1});a.length>0&&G.showMessage({message:JSON.stringify(a)});const p=n.state.evaluator.createAssistantStep(`${l?`<load-page id="${e.mapUUIDToCounter(l)}"/>`:""}<load-page id="${e.mapUUIDToCounter(d.id)}"/>`),u=(await ae({environment:i,store:n,step:p,commit:!0,isStreaming:!1})).find((e=>"error"===e.observationType));u&&G.showMessage({message:u.value}),n.set({...n.state,clientSteps:[],temporaryClientSteps:[]})}}async function te(e){const{environment:t,store:o,message:i}=e;if(!o.state)throw new Error("No state");const{evaluator:n,previewingStep:r}=o.state;r&&await ne({environment:t,store:o}),await n.refreshPageObservations();const a=`<chat><text>${i}</text></chat>`;o.set({...o.state,clientSteps:[...o.state.clientSteps,{type:"human",value:a}]});const s=n.createHumanStep(a);await ae({environment:t,store:o,step:s,commit:!0,isStreaming:!1}),o.set({...o.state,clientSteps:[...o.state.clientSteps,...o.state.temporaryClientSteps],sampledSteps:[],previewingStep:void 0,previewingStepIndex:void 0,previewingStepObservations:[],temporaryOperations:[],temporaryClientSteps:[],temporaryAssistantOperations:[]}),await ie({environment:t,store:o})}async function oe(e){const{environment:t,store:o}=e;if(!o.state)throw new Error("No state");o.set({...o.state,sampledSteps:[],previewingStep:void 0,previewingStepIndex:void 0,previewingStepObservations:[],temporaryOperations:[],temporaryClientSteps:[],temporaryAssistantOperations:[]}),await ie({environment:t,store:o})}async function ie(e){const{environment:t,store:o}=e;if(!o.state)throw new Error("No state");const{evaluator:i}=o.state,r=(0,V.Gw)()?2:1,a=n().range(r);o.set({...o.state,sampling:!0,sampledSteps:a.map((e=>({id:e,type:"assistant",value:""})))});const s=a[Math.floor(Math.random()*a.length)],l=n().throttle((async()=>{const e=o.state;if(!e)return;const i=e.sampledSteps[s];await ae({environment:t,store:o,step:i,commit:!1,isStreaming:!0})}),Y.Z1);try{await Promise.all(a.map((async e=>{const t=i.streamSampleNextStep();for await(const i of t){if(!o.state)throw new Error("No state");const t=o.state.sampledSteps.map(((t,o)=>o===e?i:t));o.setState({...o.state,sampledSteps:t}),e===s&&l()}})))}catch(p){const e=p.message||JSON.stringify(p)||"Unknown error";G.showMessage({message:e})}o.set({...o.state,sampling:!1});const{previewingStepObservations:c}=o.state,d=c.some((e=>"error"!==e.observationType));!(0,V.Gw)()&&d&&await ne({environment:t,store:o})}async function ne(e){var t;const{environment:o,store:i}=e;if(!i.state)throw new Error("No state");const{sampledSteps:n,previewingStep:r,samplingPrompt:a,evaluator:s}=i.state,{currentSpaceStore:l,currentUserStore:d}=H.default.state;if(!r)throw new Error("No previewing step");if(!a)throw new Error("No sampling prompt");if(!l)throw new Error("No current space");if(!d)throw new Error("No current user");const p=s.getTranscript(),u=g(p),m=(0,c.AZ)(s.codeEvaluator.state),h=await ae({environment:o,store:i,step:r,commit:!0,isStreaming:!1}),f=null===(t=z.Hl.state)||void 0===t?void 0:t.type;2===n.length?j.saveAssistantFeedback(o,{id:(0,R.ZP)(),type:"assistant_feedback",start_transcript_steps:p,task_type:f,start_state:m,prompt:a,transcript:u,option_a:n[0].value,option_b:n[1].value,selected_option:r.id===n[0].id?"a":"b",observationSteps:h,observation:h.map((e=>e.value)).join("\n"),space_id:l.id,user_id:d.id,client_version:4,timestamp:Date.now()}):1===n.length&&j.saveAssistantFeedback(o,{id:(0,R.ZP)(),type:"assistant_accept_edits",start_transcript_steps:p,task_type:f,start_state:m,prompt:a,transcript:u,output:r.value,observationSteps:h,observation:h.map((e=>e.value)).join("\n"),space_id:l.id,user_id:d.id,client_version:1,timestamp:Date.now()}),i.set({...i.state,clientSteps:[...i.state.clientSteps,...i.state.temporaryClientSteps],sampledSteps:[],previewingStep:void 0,previewingStepIndex:void 0,previewingStepObservations:[],temporaryOperations:[],temporaryClientSteps:[],temporaryAssistantOperations:[]}),h.length>0&&await ie(e)}function re(e){const{store:t}=e;if(!t.state)throw new Error("No state");const{temporaryCache:o}=t.state;o.clearCache(),t.set({...t.state,temporaryOperations:[],temporaryClientSteps:[],temporaryAssistantOperations:[],previewingStep:void 0,previewingStepIndex:void 0,previewingStepObservations:[]})}async function ae(e){return J.enqueue((async()=>{const{environment:t,store:o,step:i,commit:r,isStreaming:a,preventSelection:c}=e,d=t.currentUser.id;if(!d)throw new Error("No current user.");if(!o.state)throw new Error("No state");const{evaluator:p,temporaryCache:u}=o.state,{inMemoryRecordCache:m}=t.defaultRecordCache;o.set({...o.state,evaluating:!0}),u.clearCache(),u.cacheUsingThisInstanceAsAnOverride||m.addCacheOverride(u),o.set({...o.state,temporaryOperations:[],temporaryClientSteps:[],temporaryAssistantOperations:[],committing:r});const{performResult:h}=await $.createAndCommitAsync({environment:t,async perform(e){if(!o.state)throw new Error("No state.");const{temporaryCache:n}=o.state;o.set({...o.state,transaction:e});for(const i of o.state.uncommittedOperations){const o=new W.ST({environment:t,pointer:i.pointer,path:i.path,inMemoryRecordCache:n});$.applyOperation({store:o,operation:i,transaction:e})}return await(r||"assistant"!==i.type?p.commitStep(i):p.simulateStep({...i,value:l(i.value)}))},waitForServerCommit:!1,userAction:"assistantActions.simulateOrCommitStep",userId:d}),f=h.find((e=>"error"===e.observationType));if(f&&o.state.temporaryCache.clearCache(),f&&!a){const e=g(p.getTranscript());x.log({level:"error",from:"assistantActions",type:"assistantStepError",data:{miscDataToConvertToString:{step:i,transcript:e,observations:h}}})}return r||"assistant"!==i.type||o.setState({...o.state,previewingStep:i,previewingStepIndex:o.state.sampledSteps.indexOf(i),previewingStepObservations:h}),r&&o.state.temporaryOperations.length>0&&o.set({...o.state,uncommittedOperations:[...o.state.uncommittedOperations,...o.state.temporaryOperations]}),!f&&o.state.temporaryAssistantOperations.length>0&&o.set({...o.state,temporaryClientSteps:[...o.state.temporaryClientSteps,{type:"assistantTransaction",operations:o.state.temporaryAssistantOperations}]}),f||c||s.default.afterNextFlush((()=>{var e;const i=n().compact(null===(e=o.state)||void 0===e?void 0:e.temporaryOperations.map((e=>{let{pointer:t}=e;return t.table===A.iU?t.id:void 0}))),r=U.C.findScrollToSelectablesFromIds(i).map((e=>e.props.store));q.Z5({environment:t,stores:r}),X.hl(i,!1)})),o.set({...o.state,evaluating:!1}),h}))}function se(e){const{environment:t,store:o}=e,i=t.currentUser.id;if(!i)throw new Error("No current user.");if(!o.state)throw new Error("No state.");o.state.temporaryCache.clearCache(),$.createAndCommit({environment:t,perform(e){if(!o.state)throw new Error("No state.");for(const i of o.state.uncommittedOperations){const o=new W.ST({environment:t,pointer:i.pointer,path:i.path});$.applyOperation({store:o,operation:i,transaction:e})}},userAction:"assistantActions.applyUncommittedOperations",userId:i}),o.set({...o.state,uncommittedOperations:[]})}async function le(e){var t;const{environment:o,store:i,type:n}=e;if(!i.state)throw new Error("No state");const{previewingStep:r,samplingPrompt:a,evaluator:s}=i.state,{currentSpaceStore:l,currentUserStore:d}=H.default.state;if(!r)throw new Error("No previewing step");if(!a)throw new Error("No sampling prompt");if(!l)throw new Error("No current space");if(!d)throw new Error("No current user");const p=s.getTranscript(),u=g(p),m=(0,c.AZ)(s.codeEvaluator.state),h=await ae({environment:o,store:i,step:r,commit:!1,isStreaming:!1}),f=null===(t=z.Hl.state)||void 0===t?void 0:t.type;j.saveAssistantFeedback(o,{id:(0,R.ZP)(),type:n,start_transcript_steps:p,task_type:f,start_state:m,prompt:a,transcript:u,output:r.value,observationSteps:h,observation:h.map((e=>e.value)).join("\n"),space_id:l.id,user_id:d.id,client_version:1,timestamp:Date.now()})}},82993:(e,t,o)=>{o.d(t,{Ih:()=>ve,zY:()=>de,Hj:()=>ce,AN:()=>pe,oS:()=>he,Nj:()=>fe,sl:()=>me,kM:()=>ue});var i=o(97464),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(1302),c=o(15145),d=o(63362),p=o(97428),u=o(81730);var m=o(94412),g=o(10450),h=o(41432),f=o(22433),v=o(82433),y=o(76218),b=o(65917),S=o(42875),w=o(5366),k=o(4615),C=o(45953),_=o(98459),M=o(68626),T=o(98963),I=o(18844),P=o(21202),x=o(70203),B=o(97880),Z=o(64002),E=o(6854),R=o(95477),A=o(51456),D=o(28020),F=o(23223),L=o(84210),V=o(33929),N=o(77907),O=o(95802),U=o(79315),H=o(58454),z=o(37598),W=o(88923),j=o(3815),K=o(76967),Y=o(50906),G=o(54642),X=o(98834),q=o(47307),$=o(54532),J=o(94419),Q=o(19785),ee=o(9953),te=o(55332),oe=o(5978),ie=o(42858),ne=o(24677),re=o(64964),ae=o(98104),se=o(30149);const le=(0,w.defineMessages)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute",description:"Generic message that a button automation failed to complete."},genericSuccessMessage:{id:"automations.buttonTrigger.genericSuccessMessage",defaultMessage:"Button automation ran successfully",description:"Generic message that a button automation has completed successfully."},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open",description:"Button to open page or database"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo",description:"Button to undo an action"},createdPages:{defaultMessage:"Created {numPagesCreated, plural, one {1 page} other {{numPagesCreated} pages}}",id:"automations.buttonTrigger.createdPages",description:"Message that an action created a number of pages"},updatedPages:{defaultMessage:"Edited {numPagesEdited, plural, one {1 page} other {{numPagesEdited} pages}}",id:"automations.buttonTrigger.updatedPages",description:"Message that an action updated a number of database rows"},createdAndUpdatedPages:{defaultMessage:"Created {numPagesCreated, plural, one {1 page} other {{numPagesCreated} pages}} and edited {numPagesEdited, plural, one {1 page} other {{numPagesEdited} pages}}",id:"automations.buttonTrigger.createdAndUpdatedPages",description:"Message that an action created a number of pages and updated a number of database rows"},createdBlocks:{defaultMessage:"Created {numBlocksDuplicated, plural, one {1 block} other {{numBlocksDuplicated} blocks}} on page",id:"automations.buttonTrigger.createdBlocks",description:"Message that an action created a number of blocks on the current page"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText",description:"The default input value that will be displayed to ask a user for confirmation."},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage",description:"The default message for a button that will continue a workflow."},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage",description:"The default message for a button that will stop a workflow."},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages",description:"The user hits page limit for “update pages”."},errorUserCancelled:{defaultMessage:"Button was cancelled",id:"automations.buttonTrigger.errorUserCancelled",description:"The user cancelled the confirmation modal."}});function ce(e){const{environment:t,collectionStore:o,property:i,transaction:n}=e,r=(0,k.ZP)(),a=o.getSchema()[i];a&&"button"===a.type&&(ee.ae({environment:t,table:T.cv,inMemoryRecordCache:o.inMemoryRecordCache,value:{id:r,parent_id:o.id,parent_table:o.table,alive:!0,space_id:o.getSpaceId(),status:"active",trigger:{id:(0,k.ZP)(),type:"button"}},transaction:n}),ee.sW({store:o.getSchemaStore(),data:{[i]:{...a,automation_id:r}},transaction:n}))}function de(e){const{actionId:t,environment:o,intl:i,automationStore:n,actionType:r,transaction:a,insertionPoint:s,config:l,createDuplicateBlocksContainer:c=!0}=e,d=n.getSpaceId();if(!d)return;let p;"duplicate_blocks"===r&&c&&(p=ee.j4({environment:o,inMemoryRecordCache:n.inMemoryRecordCache,transaction:a,type:"text"}));const u=l??function(e){const{actionType:t,intl:o}=e;if("modal_confirmation"===t)return{continue_button:{text:o.formatMessage(le.defaultContinueWorkflowMessage)},cancel_button:{text:o.formatMessage(le.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,x.TP)(o.formatMessage(le.defaultConfirmationWorkflowText))}}}({actionType:r,intl:i})??{},m=ee.ae({environment:o,inMemoryRecordCache:n.inMemoryRecordCache,table:I.Xj,transaction:a,value:{id:t,type:r,parent_id:n.id,parent_table:T.cv,alive:!0,space_id:d,config:u,blocks:p?[p.id]:[]}});return p&&J.R3({transaction:a,parent:m.getKeyStore("blocks"),append:p}),!s||"afterActionId"in s?J.R3({transaction:a,parent:n.getActionIdsStore(),append:m,after:null==s?void 0:s.afterActionId}):"beforeActionId"in s?J.Ce({transaction:a,parent:n.getActionIdsStore(),prepend:m,before:s.beforeActionId}):(0,B.t1)(s),m}function pe(e){const{actionStore:t,automationStore:o,environment:i,intl:n,transaction:r}=e,a=(0,k.ZP)(),s=t.getType(),l=t.getConfig();if(!s)return{onComplete:Promise.resolve([])};const c=de({actionId:a,actionType:s,automationStore:o,config:l,environment:i,insertionPoint:{afterActionId:t.id},intl:n,transaction:r,createDuplicateBlocksContainer:!1});if(!c)return{onComplete:Promise.resolve([])};const d=t.getBlockStores().map((e=>{const[t,o]=$.Qi({environment:i,store:e,transaction:r,addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!1,targetSpaceId:(0,_.CG)(e.pointer.spaceId),baseUrl:R.Z.domainBaseUrl,publicDomainName:R.Z.publicDomainName,preferDuplicateLocation:"local"});return Q.jG({transaction:r,parentStore:c,childStore:t}),o}));return{onComplete:Promise.all(d)}}function ue(e){const{clientContext:t,transaction:o,newActionIds:i}=e,{automationStore:n}=t,r=n.getValue();if(!r)return;ee.sW({store:n,transaction:o,data:{action_ids:i}});ge({clientContext:t,transaction:o,automationValue:{...r,action_ids:i}})}function me(e){var t;const{clientContext:o,actionStore:i,transaction:n}=e,r=o.automationStore.getValue();if(!r)return;Q.hr({parentStore:o.automationStore,childStore:i,transaction:n});ge({clientContext:o,transaction:n,automationValue:{...r,action_ids:null===(t=r.action_ids)||void 0===t?void 0:t.filter((e=>e!==i.id))}})}function ge(e){const{clientContext:t,automationValue:o,transaction:i}=e,n=t.automationStore.getSpaceId();if(!n)return;const r=(0,F.pt)({context:t,automationValue:o});if(!M.x.isFail(r))for(const a of o.action_ids??[]){const e=t.automationStore.getRecordStore(t.automationStore,{table:I.Xj,id:a,spaceId:n});if(!e.isDefined())continue;const o=e.getModel(),s=new Set(r.value.actionInputValueTypes[a].map((e=>{if(e.kind===v.yp.Binding||e.kind===v.yp.ContextValue)return e.id;e.kind!==v.yp.ThisRow&&(0,B.t1)(e)})).filter(B.$K)),l=(0,p.z)(o.getType()).acceptFormulaVisitor({action:o,visitor:{visitVariableOutsideOfFormula:e=>s.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormula:e=>e.value&&(0,y.UB)(e).some((e=>!s.has(e)))?{type:"replace",value:void 0}:{type:"keep"}}});for(const t of l)se.applyOperation({store:e,operation:t,transaction:i})}}async function he(e){const{environment:t,store:o,clientContext:i}=e;let r,a;const l=await N.deps.formulas.loader();if(i.persisted){await i.automationStore.load();const e=i.automationStore.getModel();if(!e)return;r=e,a=i.automationStore.getActionStores().map((e=>e.getModel())).filter(B.$K)}else r=new m.X({triggerType:"button",actions:i.actions,parentPointer:i.parentPointer,spaceId:i.parentPointer.spaceId}),a=i.actions.map((e=>new m.e(e,i.parentPointer.spaceId)));const c=(0,A.getClientEventTracker)(t);(0,d.rg)(c,{trigger:r.getTriggerType(),block_id:o.id,actions:a.map((e=>e.getType())),automation_id:r.id,space_id:r.getSpaceId()});const u=new ve({automationModel:r,clientContext:i,environment:t}),h=(0,v.yf)(i.parentRecordStore.getRecordValue,i.parentRecordStore.loadRecordValue);if(!t.currentUser.id)return;let f;if("button_property"===i.type?f=(0,g.dG)({blockPointer:{...o.pointer,spaceId:(0,_.CG)(o.pointer.spaceId)},currentUserId:t.currentUser.id,userTimeZone:(0,S.r)()}):"button_block"===i.type?f=(0,g.io)({currentUserId:t.currentUser.id,userTimeZone:(0,S.r)(),pagePointer:i.pageStore.pointer}):"structured_automation"===i.type||"event"===i.type?f={value:{values:[]}}:(0,B.t1)(i),M.x.isFail(f))return b.log({level:"error",from:"automationActions",type:"TriggerError",error:{miscDataString:JSON.stringify(f)}}),(0,d.By)(c,{block_id:o.id,automation_id:r.id,error_type:f.error.type}),void q.showErrorMessage("There was an error executing this automation");const y={automationModel:r,actionModels:a,values:f.value.values,executeEffectMap:u,executeContextualFormula:async(e,t)=>{if(!t)return{value:{type:"undefined"}};return await l.executeFormula(t,{values:e.values,handleDataRequest:h,userTimeZone:(0,S.r)(),intl:i.intl})},handleDataRequest:h,loadRecordValue:i.parentRecordStore.loadRecordValue,getCollectionSchema:e=>i.parentRecordStore.getRecordStore(i.parentRecordStore,e).getSchema(),userTimeZone:(0,S.r)(),intl:i.intl},w=await async function(e){const{context:t}=e,{actionModels:o}=t;let i=t.values;for(const n of o){const e=(0,p.z)(n.getType()),o=await e.execute({...t,values:i},n);if(o.error)return o.error;i=i.concat(o.value.values)}}({context:y});if(w){"production"!==R.Z.env&&console.error("Automation execution error:",w),b.log({level:"error",from:"automationActions",type:"AutomationExecutionError",error:{miscDataString:JSON.stringify({error:w,automationId:r.id})}}),(0,d.By)(c,{block_id:o.id,automation_id:r.id,error_type:w.type});const e=function(e){if("user_cancelled"===e.type)return le.errorUserCancelled;if("query_collection_too_many_items"===e.type)return le.errorQueryCollectionTooManyPages;return le.genericErrorMessage}(w),t=V.default.formatMessage(e);re.oV({label:t})}else(0,d.Cz)(c,{block_id:o.id,automation_id:r.id}),await async function(e){const{environment:t,saveTransactionInfos:o,clientContext:i,undoCheckpointName:r,numBlocksDuplicated:a}=e;let l,c=0,d=0;for(const n of o)"create_page"===n.type?c++:"update_pages"===n.type?d+=n.pageIds.length:(0,B.t1)(n);for(const n of o.slice().reverse()){if("create_page"===n.type){var p;l=j.G.createChildStore(i.parentRecordStore,{table:P.iU,id:n.pageId,spaceId:null===(p=n.collection)||void 0===p?void 0:p.spaceId});break}if("update_pages"===n.type){if(1===n.pageIds.length){var u;l=j.G.createChildStore(i.parentRecordStore,{table:P.iU,id:n.pageIds[0],spaceId:null===(u=n.collection)||void 0===u?void 0:u.spaceId})}else{const e=j.NW.createChildStore(i.parentRecordStore,n.collection);await e.load();const t=e.getParentBlockStore();if(!t)continue;l=t}break}(0,B.t1)(n)}const m=function(e){const{numPagesCreated:t,numPagesEdited:o,numBlocksDuplicated:i}=e;return t>0&&o>0?V.default.formatMessage(le.createdAndUpdatedPages,{numPagesCreated:t,numPagesEdited:o}):t>0?V.default.formatMessage(le.createdPages,{numPagesCreated:t}):o>0?V.default.formatMessage(le.updatedPages,{numPagesEdited:o}):i>0?V.default.formatMessage(le.createdBlocks,{numBlocksDuplicated:i}):V.default.formatMessage(le.genericSuccessMessage)}({numPagesCreated:c,numPagesEdited:d,numBlocksDuplicated:a}),g=()=>{te.qB({environment:t,namedRevisionId:r}),re.rN()},h=K.default.state.revisionStack.some((e=>e.namedRevisionId===r));re.oV({label:m,button:s.createElement(E.wr,n()({blockStoreToOpen:l},h?{performUndo:g}:{}))})}({environment:t,saveTransactionInfos:u.saveTransactionInfos,clientContext:i,undoCheckpointName:u.undoCheckpointName,numBlocksDuplicated:u.getNumBlocksDuplicated()})}function fe(e){const{environment:t,parentStore:o,transaction:i}=e,n=ee.j4({environment:t,type:"text",inMemoryRecordCache:o.inMemoryRecordCache,transaction:i,spaceId:o.pointer.spaceId}),r=J.R3({parent:o,append:n,transaction:i}).child;ne.eP({environment:t,store:r});const a=r.getBlockTitleStore();ae.N_({store:a})}class ve{constructor(e){this.environment=void 0,this.clientContext=void 0,this.automationModel=void 0,this.numBlocksDuplicated=0,this.saveTransactionInfos=[],this.undoCheckpointName=void 0,this.queryCollection=async e=>{const t=e.limit??T.Us;if(t<0||t>T.Us)return{error:new u.Sg({actionId:e.actionId})};const{parentRecordStore:o}=this.clientContext,i=j.NW.createChildStore(o,e.collection);await i.load();const n=i.getValue();if(!n)return{error:new u.Pn({actionId:e.actionId,reason:"no collection value"})};const r=i.getParentBlockStore();if(!r)return{error:new u.Pn({actionId:e.actionId,reason:"no collection parent"})};await r.load();const a=r.getCollectionViewStores()[0],s=a.getSpaceId();if(!a||!s)return{error:new u.Pn({actionId:e.actionId,reason:"no first collection view"})};const l="results",c={type:"reducer",filter:e.filter,sort:e.sort,userTimeZone:(0,S.r)(),searchQuery:void 0,reducers:{[l]:{type:"results",limit:t}}},d=await G.queryCollection(this.environment,{source:{type:"collection",id:e.collection.id,spaceId:e.collection.spaceId},collectionView:{id:a.id,spaceId:s},loader:c},void 0,{src:"queryCollectionAction"});if("failed"===d.type)return{error:new u.Pn({actionId:e.actionId,cause:d.error,reason:"server query failed"})};const p=d.data.result.reducerResults.results;if(!p||"results"!==p.type)return{error:new u.Pn({actionId:e.actionId,reason:"unexpected server result"})};if(p.blockIds.length===T.Us&&p.hasMore)return{error:new u.Zs({actionId:e.actionId})};const m=Date.now(),g={pageSort:[],schema:i.getSchema(),loader:c,userId:this.environment.currentUser.id,userStartOfWeek:D.AK.state,currentTime:m,getRecordValue:U.default.getCurrentBlockValueFn(),intl:V.default.getIntl(),isSorted:!1,visibleProperties:void 0,relativeVariableResult:null==d?void 0:d.data.relativeVariableResult},h=f.fk([n],g);for(const u of p.blockIds){var v;const e=j.G.createChildStore(o,{table:P.iU,id:u}),t=null===(v=e.getAssociatedCollectionStore())||void 0===v?void 0:v.pointer;if(!(t&&C.dr.isEqualIdTable(t,i.pointer)))continue;const r=o.getRecordValue(e);r&&f.BW(r,n,g,h)}const y=z.Z.getEditedBlocksForCollection(n.id),b=new Set(p.blockIds);for(const u of y){if(b.has(u))continue;const e=o.getRecordValue({table:P.iU,id:u});e&&f.BW(e,n,g,h)}const{result:w}=f.kk(g,h);return{value:{blockIds:f.aW({result:w})}}},this.saveTransaction=e=>{if(this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.saveTransaction",environment:this.environment,perform:t=>{for(const o of e.operations){const e=(0,j.Kv)(this.clientContext.parentRecordStore,o.pointer);se.applyOperation({store:e,operation:o,transaction:t})}}}),this.saveTransactionInfos.push(e.info),"create_page"===e.info.type)Y.trackCreateBlock(this.environment,{type:"page",automation_id:this.automationModel.id,from:"button_automation"});else if("update_pages"===e.info.type){const{editedProperties:t,pageIds:o}=e.info;for(const e of o)for(const{id:o,type:i}of t)Y.trackEditBlockProperty(this.environment,{block_id:e,property:o,property_type:i,from:"button_automation",automation_id:this.automationModel.id},!1)}else(0,B.t1)(e.info);return{value:{}}},this.navigateToPage=e=>{const t=U.default.state.mainEditorCurrentBlockStore;if(!t)return;const o=j.G.createChildStore(t,e.page),i="full_page"===e.openIn?(0,L.ZP)({store:o,fullyQualified:!1}):(0,L.ZP)({store:t,peekViewBlockId:o.id,peekMode:(0,W.getUrlParamFromPeekMode)(e.openIn),fullyQualified:!1}),n=(0,Z.SK)(i,{[c.$X]:c.tY.ButtonAutomation});oe.navigate({environment:this.environment,url:n})},this.duplicateBlockChildren=async e=>{if("button_block"!==this.clientContext.type)return{error:new u.iR({contextType:this.clientContext.type})};const t=this.clientContext.blockStore,o=t.getRecordStoreUIParent();if(!o)return{value:{}};let i;"before"===e.insertionPoint?i=!0:"after"===e.insertionPoint?i=!1:(0,B.t1)(e.insertionPoint);const n=j.G.createChildStore(o,e.blockPointer);await n.load();const r=n.getContentStores();i||r.reverse();const s=O.C.findSelectableFromStore(t),c=[],d=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.duplicateBlockChildren",environment:this.environment,perform:e=>r.map((t=>{const[o,n]=$.Qi({environment:this.environment,store:t,transaction:e,addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!0,targetSpaceId:(0,_.CG)(t.pointer.spaceId),baseUrl:R.Z.domainBaseUrl,publicDomainName:R.Z.publicDomainName,preferDuplicateLocation:"local",analyticsFrom:"button_automation"});return s&&(i?s.props.onInsertAbove&&c.push(s.props.onInsertAbove({insertStores:[o],transaction:e})[0]):s.props.onInsertBelow&&c.push(s.props.onInsertBelow({insertStores:[o],transaction:e})[0])),{copy:o,onComplete:n}}))}).performResult;return i||c.reverse(),ne.Z5({environment:this.environment,stores:c}),await Promise.all(d.map((e=>e.onComplete))),l.default.afterNextFlush((()=>{const[e,t]=a().partition(c,(e=>e.isType("button")));ie.DV({environment:this.environment,insertedStores:t,isCreated:!0}),ie.DV({environment:this.environment,insertedStores:e,isCreated:!1})})),this.numBlocksDuplicated+=c.length,{value:{}}},this.displayModal=async e=>{H.Z.setState({open:!0,format:e.format,recordStore:this.clientContext.parentRecordStore}),await H.Z.waitUntil((()=>!H.Z.state.open));const t=H.Z.state;let o;return t.open||(o=t.result),o=o??"continue",o},this.initializeTemplateInDatabase=async e=>{const t=(0,k.ZP)(),o=this.clientContext.parentRecordStore,i=j.G.createChildStore(o,{table:P.iU,id:e.templateId});await i.load();const n=j.NW.createChildStore(o,e.collection);return this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.initializeTemplateInDatabase",environment:this.environment,perform:r=>{const a=ee.j4({environment:this.environment,transaction:r,inMemoryRecordCache:o.inMemoryRecordCache,type:h.Ti.page,id:t});Q.zw({parentStore:n,childStore:a,transaction:r}),X.ob({environment:this.environment,store:a,transaction:r,templateStore:i,title:"template",isCreateIn:!1,isKeyboard:!1,from:"automation_actions"}),ee.sW({transaction:r,store:a.getPropertiesStore(),data:e.propertyUpdates})}}),this.saveTransactionInfos.push({type:"create_page",pageId:t,collection:e.collection}),{value:{pageId:t}}},this.environment=e.environment,this.clientContext=e.clientContext,this.automationModel=e.automationModel,this.undoCheckpointName=`execute-client-automation-${(0,k.ZP)()}`}getNumBlocksDuplicated(){return this.numBlocksDuplicated}createAndCommitForEffect(e){return se.createAndCommit({...e,undoCheckpoint:this.undoCheckpointName})}}},35253:(e,t,o)=>{o.d(t,{Bw:()=>n,qL:()=>r,Js:()=>a});var i=o(22294);const n=e=>{const{id:t,type:o,render:n,removeTimeout:a,bannerStore:s}=e,{banners:l}=s.state;if(!l.find((e=>e.id===t))){const c=e.prepend?[{id:t,render:n,type:o},...l]:[...l,{id:t,render:n,type:o}];s.setState({banners:c}),i.Z.setKeyboardMode(!1),a&&setTimeout((()=>{r({bannerStore:s,id:t})}),a)}},r=e=>{const{id:t,bannerStore:o}=e,{banners:i}=o.state,n=i.filter((e=>e.id!==t));n.length!==i.length&&o.setState({banners:n})},a=e=>{e.bannerStore.state.banners.length>0&&e.bannerStore.setState({banners:[]})}},54564:(e,t,o)=>{o.d(t,{Ib:()=>k,LZ:()=>C,Xv:()=>_});var i=o(96486),n=o(1302),r=o(29477),a=o(98459),s=o(33709),l=o(78089),c=o(65598),d=o(45094),p=o(58202),u=o(46351),m=o(24229),g=o(3815),h=o(7011),f=o(50906),v=o(96514),y=o(24677),b=o(74647),S=o(98104);function w(e,t){const o=u.Z.find((e=>e.getStore().id===t));o&&(y.ZH(e),S.NX({store:o.getInputStore().state.textStore}))}async function k(e){var t;const{environment:o,blockStore:u,analyticsFrom:k,discussionIds:C,shouldFocusDiscussion:_,recursivelyLoadAllDiscussions:M}=e,T=(null==C?void 0:C.map((e=>g.t1.createChildStore(u,{table:s.qF,id:e,spaceId:(0,a.CG)(u.pointer.spaceId)}))))||c.al(u,{recursivelyLoadAllDiscussions:M});let{rect:I}=e;const{resolved:P,unresolved:x}=c.bB(T),B=(0,l.uC)(x.length>0?x:P)||[],Z=null==B||null===(t=B[0])||void 0===t?void 0:t.id,{device:E}=o;E.isMobile&&"updates_sidebar"!==k&&(y.ZH(o),E.isIOS&&S.sD()),v.AM(B.map((e=>e.id))),await n.default.afterNextFlush();const R=(0,d.Sx)(o);if(u.isNavigableBlock()){if(Z){"PageDetailsStore"in o&&o.PageDetailsStore.setToggleState({type:"discussion",id:u.id,environment:o},!0);const e=g.t1.createChildStore(u,{table:s.qF,id:Z,spaceId:(0,a.CG)(u.pointer.spaceId)});if((0,d.Sx)(o)&&v.T4(Z),e.getResolved())if((0,d.Sx)(o))b.setUpdateSidebarCommentsMode(h.F7.Resolved);else{const e=p.R.findBlockWithMethodFromStore(u,"openResolvedDiscussionPopup");e&&(e.openResolvedDiscussionPopup(),await n.default.afterNextFlush(),v.T4(Z))}f.trackOpenBlockDiscussionMenu(o,{from:k,discussion_id:e.id})}if(!R)return}if(!I&&!R&&"margin_comments"!==k){const e=p.R.getRect(u);if(!e)return;const t=e.width,o=e.height,i=e.right-t;I=new DOMRect(i,e.top,t,o)}let A=m.u.Open;if(Z){const e=g.t1.createChildStore(u,{table:s.qF,id:Z,spaceId:(0,a.CG)(u.pointer.spaceId)});e.getResolved()&&(A=m.u.Resolved),e.getResolved()||(b.setUpdateSidebarCommentsMode(h.F7.Unresolved),b.setUpdateSidebarTab(h.gY.Comments))}else A=m.u.Resolved;if(E.isMobile&&"updates_sidebar"!==k&&(y.ZH(o),E.isIOS&&S.sD()),m.Z.setState({open:!0,rect:I,tab:A,blockStore:u,discussionIds:T.map((e=>e.id)),recursivelyLoadAllDiscussions:M}),f.trackOpenBlockDiscussionMenu(o,{from:k,discussion_id:Z}),_)if(Z){if(await r.Vs(10),await n.default.afterNextFlush(),v.T4(Z),o.device.isMobile)return;(function(e){var t;const{blockStore:o,discussionIds:n}=e;return m.Z.state.open&&m.Z.state.blockStore.id===o.id&&i.isEqual(null===(t=m.Z.state)||void 0===t?void 0:t.discussionIds,n)})(e)||w(o,Z)}else{if(o.device.isMobile)return;x.length>0&&(await r.Vs(10),await n.default.afterNextFlush(),w(o,x[0].id))}}function C(){const e=m.Z.state;e.open&&m.Z.setState({open:!1,rect:e.rect})}function _(){const e=m.Z.state;if(e.open&&e.tab===m.u.Open){0===c.vV(e.blockStore,{recursivelyLoadAllDiscussions:!1}).length&&C()}}},6404:(e,t,o)=>{o.d(t,{Qn:()=>c,$Z:()=>d,xv:()=>p});var i=o(95802),n=o(8949),r=o(17903),a=o(96026),s=o(50628),l=o(50906);function c(e){const{environment:t,left:o,top:i,actions:s,showInput:c,stores:d,analyticsFrom:p,optionalAnalyticsProperties:u,pageAnnotationToken:m}=e,g=new DOMRect(o,i,1,1);n.Z.setState({isActive:!0,inputValue:"",actions:s,stores:d,frameScrollTop:r.Z.state.scrollTop,originBlockRect:g,showInput:c,analyticsFrom:p,publicEditMode:d[0]?a.Z.getMode(t,d[0]):void 0,collectionContextStore:null==u?void 0:u.collectionContextStore,clickedPageAnnotation:m}),l.trackOpenBlockMenu(t,{from:p,block_type:d[0]&&d[0].getType(),optionalAnalyticsProperties:u})}const d=function(e){const{environment:t,analyticsFrom:o,actions:c,stores:d,showInput:p}=e,u=i.C.findSelectableFromStore(d[0]);if(!u)return;const m=s.Z.state.selectableRectMap.get(u);m&&n.Z.setState({isActive:!0,inputValue:"",actions:c,stores:d,frameScrollTop:r.Z.state.scrollTop,originBlockRect:m,showInput:void 0===p||p,analyticsFrom:o,publicEditMode:d[0]?a.Z.getMode(t,d[0]):void 0}),t&&l.trackOpenBlockMenu(t,{from:o,block_type:d[0]&&d[0].getType()})},p=function(){n.Z.setState({isActive:!1})}},79554:(e,t,o)=>{o.d(t,{kE:()=>C,_x:()=>_,xv:()=>M,RH:()=>I,wK:()=>P,Dq:()=>B,H8:()=>Z,ry:()=>E});var i=o(96486),n=o.n(i),r=o(41432),a=o(1800),s=o(45953),l=o(21202),c=o(70203),d=o(97880),p=o(95477),u=o(28020),m=o(95802),g=o(61207),h=o(3815),f=o(52229),v=o(19785),y=o(9953),b=o(42858),S=o(24677),w=o(993),k=o(30149);function C(e){const{blocks:t,copiedStores:o,pageSource:i}=e,r=n().last(t);if(!r)return;const a=m.C.getRectFromStore(r);a&&g.Z.setState({open:!0,type:"blocks",blocks:t,rect:a,copiedStores:o,pageSource:i})}function _(e){const{blocks:t,copiedLinks:o,rootStore:i}=e;if(!t.every(T))return!1;if(o.some((e=>e.blockId===i.id)))return!1;const r=n().last(t);if(!r)return!1;const a=m.C.getRectFromStore(r);return!!a&&(g.Z.setState({open:!0,type:"links",blocks:t,rect:a,copiedLinks:o}),!0)}function M(){g.Z.setState({open:!1})}function T(e){return!(e.isType(r.Ti.copyIndicator)||e.isTransclusionType()||e.isInsideCollection())}function I(e){const{blocks:t,pageSource:o,wasContiguousSelection:i,action:n,rootStore:a,copiedStores:l}=e;return"copy"===n&&i&&!(0,s.qo)(o,a.pointer)&&(P(e)||Z(e))&&t.every(T)&&!l.every((e=>e.getType()===r.Ti.externalObjectInstance))}function P(e){const{blocks:t}=e;return 1===t.length}function x(e){const{transaction:t,blockUrl:o,spaceId:i,environment:n}=e,a=y.j4({environment:n,type:r.Ti.text,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:t,spaceId:i}),s=[(0,c.V3)(o,[(0,c.ed)(o)])];return w.sO({environment:n,store:a.getBlockTitleStore(),value:s,transaction:t}),a}async function B(e){const{environment:t,blocks:o,source:i}=e,r=n().first(o);if(!r)return;const s=r.getParentBlockStore();if(!s)return;const c=r.getContentStore();let u;await k.createAndCommitAsync({environment:t,userAction:"blockPasteMenuActions.acceptLinkToPage",waitForServerCommit:!0,perform:async e=>{if("blocks"===i.type){const{copiedStores:o,pageSource:n}=i,d=r,m=o[0];if(!d||!m)return;const g=h.G.createChildStore(c,{table:l.iU,id:m.id});if(g.isNavigableBlock())await g.load(),u=[f.k({environment:t,parentBlock:s,targetStore:g,transaction:e})];else{const o=(0,a.Z)({pageId:n.id,scrollToBlockId:g.id,baseUrl:p.Z.domainBaseUrl});u=[x({blockUrl:o,spaceId:r.getSpaceId(),environment:t,transaction:e})]}}else if("links"===i.type){const{copiedLinks:n}=i;if(n.length!==o.length)return;u=await Promise.all(n.map((async o=>{const i=o.scrollToBlockId||o.peekViewBlockId||o.blockId,n=h.G.createChildStore(c,{table:l.iU,id:i});if(await n.load(),n.isNavigableBlock())return f.k({environment:t,parentBlock:s,targetStore:n,transaction:e});{const i=o.peekViewBlockId||o.blockId,s=h.G.createChildStore(c,{table:l.iU,id:i});await s.load();return x({blockUrl:(0,a.Z)({pageId:i,pageModel:s.getModel(),scrollToBlockId:n.id,baseUrl:p.Z.domainBaseUrl}),spaceId:r.getSpaceId(),environment:t,transaction:e})}})))}else(0,d.t1)(i);const n=b.is({environment:t,blocks:u,selection:o,replaceEmptyTextBlock:!0,transaction:e});b.Cl({environment:t,blocks:o,transaction:e}),S.Z5({environment:t,stores:n}),M()}})}function Z(e){const{blocks:t,copiedStores:o}=e;return t.length>0&&!o.some((e=>e.isInsideCollection()))&&o.every((e=>e.canEdit()))}async function E(e){const{environment:t,blocks:o,copiedBlockIds:i}=e,n=await Promise.all(i.map((async e=>{const t=h.G.createChildStore(o[0],{table:l.iU,id:e});await t.load();const i=t.getParentBlockStore();if(!i)throw new Error("Block has no parent.");await i.load();const n=i.getContentStore();return{store:h.G.createChildStore(n,{table:l.iU,id:e}),parentStore:i,parentContentStore:n}}))),a=n[0];if(!a)return;const{serverCommitResult:s}=k.createAndCommit({userAction:"blockPasteMenuActions.acceptCreateTransclusion",environment:t,perform:e=>{var i;let s;if(a.store.getType()===r.Ti.transclusionContainer)s=a.store;else if(a.store.getType()===r.Ti.transclusionReference){const e=a.store.getTransclusionReferenceTargetStore();if(!e)throw new Error("Could not find target");s=e}else if(a.parentStore.getType()===r.Ti.transclusionContainer)s=a.parentStore;else{s=y.j4({environment:t,type:r.Ti.transclusionContainer,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e,spaceId:a.store.pointer.spaceId});const o=s.getContentStore();v.rS({parentStore:a.parentContentStore,oldChildStore:a.store,newChildStore:s,transaction:e});for(const{store:t}of n)v.jG({parentStore:o,childStore:t,transaction:e})}const l=y.j4({environment:t,type:r.Ti.transclusionReference,format:{transclusion_reference_pointer:s.pointer},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:e,spaceId:0!==o.length?o[o.length-1].pointer.spaceId:null===(i=(0,u.RM)())||void 0===i?void 0:i.pointer.spaceId}),c=b.is({environment:t,blocks:[l],selection:o,transaction:e,replaceEmptyTextBlock:!0});b.Cl({environment:t,blocks:o,transaction:e}),S.Z5({environment:t,stores:c}),M()}});await s}},43664:(e,t,o)=>{o.d(t,{r0:()=>Z,zt:()=>A,V7:()=>D});var i=o(96486),n=o.n(i),r=o(1302),a=o(90559),s=o(99036),l=o(80951),c=o(32918),d=o(84682),p=o(42875),u=o(61784),m=o(89837),g=o(32056),h=o(70203),f=o(97880),v=o(63143),y=o(43132),b=o(93616),S=o(44532),w=o(49616),k=o(33929),C=o(24666),_=o(51365),M=o(77162),T=o(68882),I=o(9953),P=o(61045),x=o(64964),B=o(30149);function Z(e){const{environment:t,store:o,schema:i,property:n,pageValue:r,collectionContextStore:s}=e,u=i[n];if(u)switch(u.type){case"formula":r&&function(e){var t;const{environment:o,store:i,schema:n,property:r,propertySchema:a,pageValue:s}=e,l=(0,d.AH)({property:r,schema:n,block:s,getRecordValue:i.getRecordValue,userTimeZone:(0,p.r)(),depth:0,intl:k.default.getIntl(),resultCache:{}}),u=null==a||null===(t=a.formula)||void 0===t?void 0:t.result_type;switch(u){case"number":v.hj(l)&&E({value:l,propertySchema:a,environment:o});break;case"date":l&&c.U3(l)&&R({date:l,environment:o});break;case"text":if(l)return y.RD({stringValue:l.toString(),environment:o,copiedMessage:y.tq.copiedPropertyToClipboard});break;case"checkbox":case void 0:return;default:(0,f.t1)(u)}}({environment:t,store:o,schema:i,property:n,propertySchema:u,pageValue:r});break;case"number":E({value:l.VY(o.getPropertyValue(n)),propertySchema:u,environment:t});break;case"text":{const e=h.Q(o.getPropertyValue(n)).length;C.default.setState({mode:"readOnly",multiSelection:{start:{store:o.getPropertyStore(n),index:0},end:{store:o.getPropertyStore(n),index:e}}}),y.f4(),x.oV({label:k.default.formatMessage(y.tq.copiedPropertyToClipboard)}),C.default.setState({mode:"empty"});break}case"url":case"email":case"phone_number":{const e=h.Jc(o.getPropertyValue(n));y.RD({stringValue:e,environment:t,copiedMessage:y.tq.copiedPropertyToClipboard});break}case"last_edited_time":case"created_time":{const e=o.getKeyStore(u.type).getValue();if(e){R({date:m.CQ(e,(0,p.r)()),environment:t})}break}case"auto_increment_id":{const e=o.getPropertyValue(n);!function(e){const{value:t,environment:o,collectionContextStore:i}=e;if(t&&i){var n,r;const e=(null===(n=i.collectionStore())||void 0===n||null===(r=n.getRecordKeyStore())||void 0===r?void 0:r.getRecordKey())??"";y.RD({stringValue:(0,a.wf)(e,t),environment:o,copiedMessage:y.tq.copiedPropertyToClipboard})}}({value:l.ah(e),environment:t,collectionContextStore:s});break}}}function E(e){const{value:t,propertySchema:o,environment:i}=e;if(!n().isNaN(t)&&!v.z4(t)){const e=(null==o?void 0:o.number_format)||g.dk,n=g.uf(t,e,k.default.getIntl());y.RD({stringValue:n,environment:i,copiedMessage:y.tq.copiedPropertyToClipboard})}}function R(e){const{date:t,environment:o}=e,i=(0,u.ZV)({value:t,date_format:c.sF,time_format:c.c_,allowRelativeDates:!0,intl:k.default.getIntl()});y.RD({stringValue:i,environment:o,copiedMessage:y.tq.copiedPropertyToClipboard})}async function A(e){var t;const{element:o,rect:i,environment:n,onClick:a,store:c,additionalStores:d=[],property:p,format:u,collectionStore:m,blockPropertyValueOverlayStore:g,disableHorizontalEdgeScroll:h,collectionContextStore:f,mouseStore:v,statusShowAsCheckbox:y,preventClearSelection:k,collectionsBulkActionsToolbarStore:C,scrollers:T}=e,{device:x,WindowSizeStore:Z}=n,E=null===(t=m.getSchema())||void 0===t?void 0:t[p],R=null==E?void 0:E.type;if(!R)return;if(!w.g0({property:p,collectionStore:m})){if("checkbox"===R){const e=c.getPropertyStore(p);e&&B.createAndCommit({userAction:"BlockPropertyValue.handleEditButtonClick",environment:n,perform:e=>{_.vO({stores:[c,...d],property:p,transaction:e})}}),f&&M.rv({environment:n,collectionContextStore:f,block_id:e.id,property:p,property_type:R,from:w.Sy(u),isFromBulkActionsToolbar:Boolean(C)})}else if("status"===R&&"status"===E.type&&y){const e=c.getPropertyValue(p),t=l.rO(e,E);c.getPropertyStore(p)&&B.createAndCommit({userAction:"BlockPropertyValue.handleEditButtonClick",environment:n,perform:e=>{const o=E.groups??[],i=!0===t?o[0]:o[o.length-1],n=(E.options??[]).find((e=>{var t;return e.id===(null==i||null===(t=i.optionIds)||void 0===t?void 0:t[0])}));if(n)for(const t of[c,...d])I.sO({store:t.getPropertyStore(p),value:l.Is(n.value),transaction:e})}})}else{-1===s.uk.indexOf(R)&&(v.setState({...v.state,mouseEntered:!1}),o&&T&&x.isMobileNative&&b.mZ[R]===S.kQ.Popup&&(P.bx({element:o,scrollers:T,vertical:{reveal:"bottom",paddingToTopEdge:4,paddingToBottomEdge:Z.getSafePaddingBottomPx(320)},horizontal:{reveal:"closest"}}),await r.default.afterNextFlush()),_.bA({environment:n,blockPropertyValueOverlayStore:g,store:c,additionalStores:d,property:p,format:u,rect:i,disableHorizontalEdgeScroll:h,collectionContextStore:f,preventClearSelection:k,collectionsBulkActionsToolbarStore:C}),f&&M.zF({environment:n,collectionContextStore:f,property:p,property_type:R,from:w.Sy(u),isFromBulkActionsToolbar:Boolean(C)}))}a&&a()}}function D(e){const{environment:t,store:o,property:i,schema:n,handleOpenPeekPage:r}=e,a=n[i],c=null==a?void 0:a.type;if("title"!==c){if("person"===c){const e=n[i];if("person"!==(null==e?void 0:e.type))return;const r=o.getPropertyValue(i),a=l.DW({textValue:r,propertySchema:e,blockCreatorPointer:l.I1(o.getCreatedById(),o.getCreatedByTable())}),s=t.currentUser.id;if(!s)return;B.createAndCommit({userAction:"BlockPropertyValue.handleActionButtonClick.person",environment:t,perform:t=>{let n=[...a];const r=a.findIndex((e=>e.id===s));if(r>=0)n.splice(r,1);else{const e={table:"notion_user",id:s};n.push(e)}e.limit&&(n=n.slice(n.length-1));const c=l.C1(n);I.sO({store:o.getPropertyStore(i),value:c,transaction:t})}})}a&&s.q3(a)&&T.C({environment:t,stores:[o],property:i,propertySchema:a,userEventForAnalytics:"generate_from_action_button"})}else r&&r()}},51365:(e,t,o)=>{o.d(t,{bA:()=>h,xv:()=>f,vO:()=>v,$o:()=>y,RX:()=>b,gT:()=>S,i2:()=>w,fG:()=>k,mm:()=>C});var i=o(62518),n=o(1302),r=o(99036),a=o(80951),s=o(70203),l=o(58299),c=o(9953),d=o(61045),p=o(24677),u=o(993),m=o(98104),g=o(30149);function h(e){const{environment:t,blockPropertyValueOverlayStore:o,store:a,additionalStores:c=[],property:h,format:f,preventClearSelection:v,insertChar:y,uploadFiles:b,disableHorizontalEdgeScroll:S,isNewBlock:w,collectionContextStore:k,mode:C,collectionsBulkActionsToolbarStore:_}=e,M=(a.getSchema()||{})[h],T=l.Z.findBlockPropertyValue(a,h);let I=e.rect;const P=null==T?void 0:T.getNode();if(P&&(d.bx({element:P,vertical:{reveal:"closest"},horizontal:S?void 0:{reveal:"closest"},scrollers:{verticalScroller:null==T?void 0:T.getContextVerticalScroller(),horizontalScroller:null==T?void 0:T.getContextHorizontalScroller()}}),!I)){const e=i.findDOMNode(P);e instanceof Element&&(I=e.getBoundingClientRect())}if(!I)return;const x=a.clone();if(o.setState({isOpen:!0,store:a,clonedStore:x,additionalStores:c,property:h,format:f,rect:I,preventClearSelection:v,insertChar:y,uploadFiles:b,isNewBlock:w,collectionContextStore:k,mode:C,collectionsBulkActionsToolbarStore:_}),!_||"title"!==(null==M?void 0:M.type)&&"text"!==(null==M?void 0:M.type)||null==_||_.setState({textStoresBeingEdited:[...c,a],lastBlockPropertyValueOverlayCloseTime:void 0}),M&&r.Yl(M.type)){v||p.ZH(t);const e=x.getPropertyStore(h);y&&g.createAndCommit({userAction:"blockPropertyValueOverlayActions.open",environment:t,perform:o=>{u.sO({environment:t,store:e,value:s.TP(y),transaction:o})}}),n.default.afterNextFlush((()=>{n.default.afterNextFlush((()=>{n.default.afterNextFlush((()=>{m.NX({store:e})}))}))}))}else v||p.ZH(t),m.ZH(t)}function f(e){const{environment:t,blockPropertyValueOverlayStore:o}=e,i=o.state;i.isOpen&&(i.preventClearSelection||p.ZH(t),o.reset(),n.default.afterNextFlush((()=>{var e;return null===(e=i.collectionsBulkActionsToolbarStore)||void 0===e?void 0:e.setState({textStoresBeingEdited:[],lastBlockPropertyValueOverlayCloseTime:Date.now()})})))}const v=function(e){const{stores:t,property:o,transaction:i}=e,n=t[0].getPropertyStore(o),r=(0,a.Ml)(n.getValue());for(const s of t)c.sO({store:s.getPropertyStore(o),value:(0,a._I)(!r),transaction:i})};function y(e){const{blockPropertyValueOverlayStore:t}=e,o=t.state;if(o.isOpen){const{store:t,property:r}=o,a=l.Z.findBlockPropertyValue(t,r);var i,n;if(null!=a&&a.getProps().onTab)null==a||null===(i=(n=a.getProps()).onTab)||void 0===i||i.call(n);else f(e)}}function b(e){const{blockPropertyValueOverlayStore:t}=e,o=t.state;if(o.isOpen){const{store:t,property:r}=o,a=l.Z.findBlockPropertyValue(t,r);var i,n;if(null!=a&&a.getProps().onUntab)null==a||null===(i=(n=a.getProps()).onUntab)||void 0===i||i.call(n);else f(e)}}function S(e){const{blockPropertyValueOverlayStore:t}=e,o=t.state;if(o.isOpen){const{store:t,property:r}=o,a=l.Z.findBlockPropertyValue(t,r);var i,n;if(null!=a&&a.getProps().onEnter)null==a||null===(i=(n=a.getProps()).onEnter)||void 0===i||i.call(n);else f(e)}}function w(e){const{blockPropertyValueOverlayStore:t}=e,o=t.state;if(o.isOpen){const{store:t,property:r}=o,a=l.Z.findBlockPropertyValue(t,r);var i,n;if(null!=a&&a.getProps().onEsc)null==a||null===(i=(n=a.getProps()).onEsc)||void 0===i||i.call(n);else f(e)}}function k(e){const{blockPropertyValueOverlayStore:t}=e,o=t.state;if(o.isOpen){const{store:t,property:r}=o,a=l.Z.findBlockPropertyValue(t,r);var i,n;if(null!=a&&a.getProps().onBgClick)null==a||null===(i=(n=a.getProps()).onBgClick)||void 0===i||i.call(n);else f(e)}}function C(e){const{blockPropertyValueOverlayStore:t,openProperty:o}=e,i=t.state;if(i.isOpen){var n,r;const{store:t,property:a}=i,s=l.Z.findBlockPropertyValue(t,a);(null==s||null===(n=(r=s.getProps()).onOpenProperty)||void 0===n?void 0:n.call(r,o))||f(e)}}},48948:(e,t,o)=>{o.d(t,{K:()=>p});var i=o(41432),n=o(29477),r=o(98459),a=o(70203),s=o(79315),l=o(54642),c=o(9953),d=o(30149);async function p(e){const{store:t,url:o,environment:p,teamId:u}=e,m=void 0!==e.transformTimeout?e.transformTimeout:3e3,{serverCommitResult:g}=d.createAndCommit({userAction:"bookmarkBlockActions.createBookmark",environment:p,perform:e=>{c.sW({store:t.getPropertiesStore(),data:{link:a.TP(o),title:a.TP(o)},transaction:e})}}),{winner:h,rest:f}=await n.S3([g,n.Vs(m)]);if(1===h&&(await async function(e,t){const{serverCommitResult:o}=d.createAndCommit({userAction:"bookmarkBlockActions.transformIntoBookmark",environment:e,perform:e=>{c.sW({store:t,data:{type:i.Ti.bookmark},transaction:e})}});await o}(p,t),await f),u){const{currentSpaceStore:e}=s.default.state;await l.setBookmarkMetadata(p,{type:"team-invite-bookmark",block:{id:t.id,spaceId:(0,r.CG)(t.pointer.spaceId)},url:o,teamId:u,spaceId:e&&e.id})}else await l.setBookmarkMetadata(p,{type:"external-bookmark",block:{id:t.id,spaceId:(0,r.CG)(t.pointer.spaceId)},url:o})}},76463:(e,t,o)=>{o.d(t,{lz:()=>T,P0:()=>I,Yw:()=>P,VG:()=>x,v2:()=>B,RN:()=>Z,jX:()=>E,k2:()=>R});var i=o(5366),n=o(26825),r=o(27006),a=o(45953),s=o(21202),l=o(77420),c=o(90468),d=o(19889),p=o(97880),u=o(47307),m=o(33929),g=o(67669),h=o(3815),f=o(54642),v=o(92625),y=o(10279),b=o(9953),S=o(64964),w=o(29974),k=o(30149),C=o(761);const _=(0,i.defineMessages)({duplicatingTemplate:{id:"botActions.duplicatingTemplate.loadingMessage",defaultMessage:"Duplicating template...",description:"Loading state message"},duplicatingTemplateError:{id:"botActions.duplicateTemplateAndShareWithBot.snackbar.failure",defaultMessage:"Failed to duplicate template for to your workspace",description:"Snackbar message shown after failing to duplicate template after a user adds an external integration"}});function M(e,t){const{environment:o,spaceStore:i,spaceRole:n}=t,r=function(e){const{name:t,spaceStore:o,userId:i,icon:n,type:r}=e,a=Date.now(),s={name:t,created_at:a,created_by_table:d.KJ,created_by_id:i,alive:!0,icon:n,space_id:o.id,last_edited_at:a,last_edited_by_id:i,last_edited_by_table:d.KJ};switch(r){case"guest":return{...s,type:"guest",capabilities:e.capabilities,parent_table:c.bx,parent_id:o.id,integration_id:void 0};case"scim":return{...s,type:"scim",parent_table:d.KJ,parent_id:i};default:(0,p.t1)(r)}}(t),a=b.ae({environment:o,table:l.cZ,value:r,inMemoryRecordCache:o.defaultRecordCache.inMemoryRecordCache,transaction:e});return y.ep({environment:o,store:i,permissionItems:[{type:"bot_permission",role:n,bot_id:a.id}],transaction:e}),{botStore:a}}function T(e){const{environment:t}=e,{serverCommitResult:o,performResult:{botStore:i}}=k.createAndCommit({userAction:"botActions.createSpaceBot",environment:t,perform:t=>M(t,e)});return{botStore:i,transactionPromise:o}}async function I(e){const{environment:t,botId:o,onSuccess:i}=e,n=await f.deleteBot(t,{botId:o});"failed"===n.type?u.showError(n):"success"===n.type&&i&&(await C.pJ({environment:t}),i())}async function P(e){const{environment:t,table:o,id:i,type:n}=e,r=await f.getBots(t,{table:o,id:i,type:n});if("failed"===r.type)throw u.showError(r),r;return{botIds:r.data.botIds,recordMap:r.data.recordMap}}async function x(e){const{environment:t,botId:o}=e,i=await f.getBotToken(t,{botId:o});if("failed"!==i.type)return i.data.token;u.showError(i)}function B(e){const{botValue:t,store:o,environment:i}=e,{id:r,parent_id:a,parent_table:s,capabilities:l}=t,c={type:"bot_permission",bot_id:r,parent_id:a,parent_table:s,role:(0,n.uH)(l)};k.createAndCommit({userAction:"TopbarMoreButton.handleAddingConnection",environment:i,perform:e=>{y.ep({environment:i,store:o,permissionItems:[c],transaction:e})}})}function Z(e){const{botId:t,store:o,environment:i}=e,n=o.getPermissionItems().filter((0,p.AO)((e=>(0,r.FB)(e)?{true:e}:{false:e})));for(const r of n)if(r.bot_id===t){const e={...r,role:"none"};k.createAndCommit({userAction:"TopbarMoreButton.handleRemovingConnection",environment:i,perform:t=>{y.ep({environment:i,store:o,permissionItems:[e],transaction:t})}})}}function E(e){const{currentSpaceStore:t,environment:o,pages:i,botStore:n,addPermission:r}=e;if(!t)return;const a=(0,g.zT)({botStore:n,addPermission:r});i.forEach((e=>{const i=h.t1.createChildStore(t,{table:s.iU,id:e});k.createAndCommit({userAction:"botActions.updateBlockPermissionsForBot",environment:o,perform:e=>{y.ep({environment:o,store:i,permissionItems:[a],transaction:e})}})}))}async function R(e){const{environment:t,spaceStore:o,spaceViewStore:i,templatePageId:n,botValue:r,pages:s}=e;if(!o)return;const c=h.t1.createChildStore(o,{table:l.cZ,id:r.id});if(n)return await async function(e){const{environment:t,spaceStore:o,spaceViewStore:i,templatePageId:n,botStore:r}=e;if(!o||!i)return;try{v.j({message:_.duplicatingTemplate});const e=await f.loadBlockSubtree(t,{block:{id:n,spaceId:o.id},shallow:!1});if("failed"===e.type)return;const s=a.Ak.create(e.data.subtreeRecordMap),{performResult:l}=k.createAndCommit({userAction:"botActions.duplicateTemplateAndShareWithBot",environment:t,perform:e=>{const a=w.cc({environment:t,recordMap:s,copyPageId:n,isPrivate:!0,spaceStore:o,spaceViewStore:i,transaction:e,allowCopyExternalObjectInstances:!1}),l=i.getPrivatePageIds();l.length>0&&b.sW({store:i,data:{private_pages:[a.id,...l]},transaction:e});const c=(0,g.zT)({botStore:r,addPermission:!0});return y.ep({environment:t,store:a,permissionItems:[c],transaction:e}),a}});return l}catch(s){S.oV({label:m.default.formatMessage(_.duplicatingTemplateError)})}finally{v.x()}}({environment:t,templatePageId:n,botStore:c,spaceStore:o,spaceViewStore:i});E({environment:t,currentSpaceStore:o,botStore:c,pages:s,addPermission:!0})}},26797:(e,t,o)=>{o.d(t,{JN:()=>w,f$:()=>k,td:()=>C,fX:()=>_,cQ:()=>M,Fv:()=>T,xD:()=>I,QG:()=>P});var i=o(96486),n=o.n(i),r=o(17126),a=o(80951),s=o(32918),l=o(42875),c=o(89837),d=o(6287),p=o(97880),u=o(95802),m=o(15723),g=o(17746),h=o(3815),f=o(7668),v=o(49865),y=o(42239),b=o(19785),S=o(9953);function w(e){const{environment:t,droppedStores:o,collectionStore:i,duplicate:n,calendarBy:p,transaction:u,results:m,collectionContextStore:g}=e,h=r.ou.fromMillis(e.startOfDay);let f=!0;for(const r of o){if(r.getParentTable()===d.v){f=!1;break}b.zw({childStore:r,parentStore:i,transaction:u})||(f=!1)}const S=y.LQ({environment:t,droppedStores:o,duplicate:n,transaction:u,resolveTemplateVariables:!1});for(const r of S){const e=r.getPropertyStore(p),o=a.Gl(e.getValue())||c.Lg((0,l.r)()),n=c.c$(o,(0,l.r)()),d=h.toFormat(c.Iq);let y;if("date"===n.type||"datetime"===n.type)y={...n,start_date:d};else{const e=c.NK(n,(0,l.r)());if(!e.end)return;const t={...n,start_date:d},o=c.NK(t,(0,l.r)()).start.diff(e.start,"days"),i=e.end.plus(o).toFormat(c.Iq);y={...n,start_date:d,end_date:i}}const b=c.c$(y,s.yw(o)||(0,l.r)());v.mp({environment:t,store:r,collectionStore:i,collectionContextStore:g,coerce:!0,groupsPointer:[],results:m,transaction:u,alreadyMovedToCollection:f}),I({environment:t,type:"dateValue",propertyId:p,store:r,transaction:u,dateValue:b})}}function k(e){const{calendarStore:t,direction:o,target:i}=e;t.setState({...t.state,isDragging:!0,target:i,direction:o})}function C(e){const{calendarStore:t,x:o,y:i,calendarBy:d}=e,p=t.state;if(p.isDragging){const e=a.Gl(p.target.getPropertyStore(d).getValue());if(!e)return;const h=c.c$(e,(0,l.r)()),f=p.temporaryValue||e,v=c.c$(f,(0,l.r)()),y=[];p.dayStoreMap.forEach(((e,t)=>{y.push({store:e,timestamp:t})}));const b=y.find((e=>{let{store:t}=e;const n=u.C.getRectFromStore(t);return Boolean(n&&m.uh(n,o,i))}));let S;if(b){const e=r.ou.fromMillis(b.timestamp),t=e.endOf("day"),o=e.toFormat(c.Iq);if(h){const i=c.NK(h,(0,l.r)());if(p.direction===g.t.Left)if(r.Xp.fromDateTimes(e,t).contains(i.start))S=h;else{let e;e="datetimerange"===h.type||"daterange"===h.type?{...h,start_date:o,end_date:h.end_date}:"datetime"===h.type?{type:"datetimerange",start_date:o,start_time:h.start_time,end_date:h.start_date,end_time:h.start_time,time_zone:h.time_zone,reminder:h.reminder}:{type:"daterange",start_date:o,end_date:h.start_date,reminder:h.reminder};const t=c.NK(e,(0,l.r)());S=!i.end&&t.start>i.start||i.end&&t.start>i.end?v:e}else if(i.end?r.Xp.fromDateTimes(e,t).contains(i.end):r.Xp.fromDateTimes(e,t).contains(i.start))S=h;else{let e;e="date"===h.type?{...h,type:"daterange",end_date:o}:"datetime"===h.type?{...h,type:"datetimerange",end_date:o,end_time:"00:00"}:{...h,end_date:o};const t=c.NK(e,(0,l.r)());S=t.end&&t.end<t.start?v:e}}}if(S&&!n().isEqual(v,S)){const e=c.c$(S,s.yw(f)||(0,l.r)());t.setState({...p,temporaryValue:e})}}}function _(e){const{environment:t,calendarStore:o,calendarBy:i,transaction:n}=e,r=o.state;r.isDragging&&r.temporaryValue&&(I({type:"dateValue",environment:t,dateValue:r.temporaryValue,propertyId:i,store:r.target,transaction:n}),o.setState({...o.state,isDragging:!1}))}function M(e){const{calendarStore:t}=e,o=t.state;o.isDragging&&t.setState({...o,isDragging:!1})}function T(e){const{environment:t,store:o,collectionStore:i,collectionContextStore:n,startDayOfWeek:s,results:d,transaction:p}=e,u=n.dateRangeStart.get(),m=(0,l.r)(),g=n.normalizedQueryStore.state;if(!g||!g.calendar_by)return;const h=g.calendar_by,f=c.gQ(u,s,m),y=f.startOf("month"),b=f.endOf("month"),w=r.ou.now().startOf("day");let k;return k=r.Xp.fromDateTimes(y,b).contains(w)?c.hT(w.valueOf(),m):c.hT(c.em(u,s,m).valueOf(),m),S.sW({store:o.getPropertiesStore(),data:{[h]:a.d7(k)},transaction:p}),v.mp({environment:t,store:o,collectionStore:i,collectionContextStore:n,coerce:!0,results:d,groupsPointer:[],transaction:p}),o}function I(e){const{environment:t,store:o,propertyId:i,transaction:n}=e;let r;"timestamp"===e.type?r=c.hT(e.timestampMs.valueOf(),(0,l.r)()):"dateValue"===e.type?r=e.dateValue:(0,p.t1)(e);const s=o.getPropertyValue(i),d=a.d7(r);S.sW({store:o.getPropertiesStore(),data:{[i]:d},transaction:n}),f.H({environment:t,store:o,dateProperty:{id:i,oldValue:s,newValue:d}})}function P(e){const{environment:t,collectionStore:o,calendarBy:i,store:n,insertStores:r,results:a,collectionContextStore:s,transaction:l}=e,c=n.getPropertyStore(i).getValue();for(const d of r)v.mp({environment:t,store:d,collectionStore:o,collectionContextStore:s,coerce:!0,groupsPointer:[],results:a,transaction:l}),S.sO({store:d.getPropertyStore(i),value:c,transaction:l});return r.map((e=>h.G.createChildStore(o,e.pointer)))}},43132:(e,t,o)=>{o.d(t,{tq:()=>Je,JG:()=>Et,IK:()=>so,VG:()=>ro,Hs:()=>no,Dw:()=>ao,RD:()=>co,Pm:()=>uo,by:()=>Bt,of:()=>Ht,e0:()=>bt,Mt:()=>go,wc:()=>mo,v:()=>to,AL:()=>Rt,R$:()=>Nt,X4:()=>Mt,jm:()=>Ct,f4:()=>po,Lh:()=>ho});var i=o(27856),n=o.n(i),r=o(96486),a=o.n(r),s=o(39249),l=o(1302),c=o(66897),d=o(15145),p=o(41432),u=o(99036),m=o(8848),g=o(1800),h=o(15095),f=o(64962),v=o(61075),y=o(42509),b=o(43593),S=o(65917),w=o(38297),k=o(42875),C=o(35811),_=o(64572),M=o(22808),T=o(30845),I=o(44165),P=o(59753),x=o(482),B=o(34424),Z=o(63149),E=o(4615),R=o(71644),A=o(74446),D=o(45953),F=o(10484),L=o(98459),V=o(80984),N=o(21202),O=o(70279),U=o(54153),H=o(70203),z=o(44805),W=o(95371),j=o(97880);const K={applyMutable:function(e){switch(e.operation){case"delete":return function(e){const{deleteFromParent:t,deletingChildren:o}=e;if(0===o.length)return!1;const i=new Set(o),n=t.children.filter((e=>!i.has(e)));if(n.length===t.children.length)return!1;return t.children=n,!0}(e);case"insert":return function(e){const{direction:t,insertChildren:o,insertIntoParent:i,adjacentSibling:n}=e;if(0===o.length)return!1;const r=n?i.children.indexOf(n):-1,a=(()=>{switch(t){case"listBefore":return Math.max(0,r);case"listAfter":return-1===r?i.children.length:r+1;default:(0,j.t1)(t)}})();return i.children.splice(a,0,...o),!0}(e);default:(0,j.t1)(e)}}};var Y=o(70842),G=o(64002),X=o(93171),q=o(5366),$=o(96313),J=o(94419),Q=o(95477),ee=o(28020),te=o(56518),oe=o(44486),ie=o(84210),ne=o(33929),re=o(68056),ae=o(45162),se=o(98165),le=o(70219),ce=o(65598),de=o(69645),pe=o(73959),ue=o(41984),me=o(77505),ge=o(40150),he=o(72133),fe=o(89086),ve=o(77907),ye=o(28685),be=o(95802),Se=o(79315),we=o(87143),ke=o(88632),Ce=o(30874),_e=o(22294),Me=o(3815),Te=o(27724),Ie=o(24666),Pe=o(50906),xe=o(79554),Be=o(22858),Ze=o(64434),Ee=o(47307),Re=o(54532),Ae=o(72747),De=o(89951),Fe=o(19358),Le=o(9953),Ve=o(42858),Ne=o(24677),Oe=o(8713),Ue=o(64964),He=o(21325),ze=o(50125),We=o(993),je=o(98104),Ke=o(30149),Ye=o(63113),Ge=o(761);const Xe=(0,ve.dangerouslyStartLoadingDependency)(ve.deps.markdownLinkifyIt,"clipboardActions"),qe=(0,ve.dangerouslyStartLoadingDependency)(ve.deps.tinyMceMicrosoftWordPasteFilter,"clipboardActions"),$e=(0,q.defineMessages)({offlineError:{id:"clipboardActions.offlineError.message",defaultMessage:"Please go online to copy this block."}}),Je=(0,q.defineMessages)({copiedLinkToClipboard:{id:"action.copiedLinkToClipboard.snackBarMessage",defaultMessage:"Copied link to clipboard"},copiedLinksToClipboard:{id:"action.copiedLinksToClipboard.snackBarMessage",defaultMessage:"Copied links to clipboard"},copiedPropertyToClipboard:{id:"action.copiedPropertyToClipboard.snackBarMessage",defaultMessage:"Copied property to clipboard"},copiedCodeToClipboard:{id:"action.copiedCodeToClipboard.snackBarMessage",defaultMessage:"Copied code to clipboard"},copiedTokenToClipboard:{id:"action.copiedTokenToClipboard.snackBarMessage",defaultMessage:"Copied token to clipboard",description:"Message shown when a (secret) token has been copied to the clipboard"},copiedToClipboard:{id:"action.copiedToClipboard.snackBarMessage",defaultMessage:"Copied to clipboard"},copiedApiObjectToClipboard:{id:"action.copiedApiObjectToClipboard.snackBarMessage",defaultMessage:"Copied API object to clipboard",description:"Confirmation message that appears after an object's public API representation was successfully copied to the clipboard. This is for an internal tool that only Notion employees see."}}),Qe={...Z.Y,dockerfile:"Docker",javascriptreact:"JavaScript",jsonc:"JSON","objective-c":"Objective-C",proto:"Protobuf",shellscript:"Shell",typescriptreact:"TypeScript",vb:"Visual Basic"},et=`text/_notion-blocks-v3-${Q.Z.env}`,tt=`text/_notion-text-${Q.Z.env}`,ot=`text/_notion-multi-text-${Q.Z.env}`,it=`text/_notion-page-source-${Q.Z.env}`,nt="vscode-editor-data",rt=[et,tt,ot,it],at=new Set(rt);const st={fromJson:e=>e,toJson:e=>e},lt=st,ct=st,dt=st,pt={fromJson(e){const t=(0,W.MW)(e.tree,(e=>e)),o=ut.fromJson(e.blockSelection);return{...e,tree:t,blockSelection:o}},toJson(e){const t=ut.toJson(e.blockSelection);return{...e,blockSelection:t}}},ut={fromJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?D.Ak.create(e.blockSubtree):void 0})))}),toJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?e.blockSubtree.toJson({allowVersionDowngrade:!1}):void 0})))})},mt=`VirtualClipboard:${Q.Z.env}`;let gt;function ht(e){return e.isAndroid}function ft(e,t){if(!ht(t))return e;const o=(0,te.nZ)(e.getData("text/html"));if(o){gt||(gt=U.Z.get(mt));const t=gt;if(o===(null==t?void 0:t.id))return{getData(o){const i=e.getData(o);return!i&&function(e){return at.has(e)}(o)?t.mimeTypes[o]||"":i}}}return e}function vt(e,t,o,i){if(!e.clipboardData)return;const n=o.toJson(i),r=JSON.stringify(n);e.clipboardData.setData(t,r)}function yt(e,t,o){try{const i=e.getData(t),n=JSON.parse(i);return o.fromJson(n)}catch(i){return}}function bt(e){const{text:t,html:o,isFromMicrosoftOffice:i}=function(e){const t=e.getData("text/uri-list").trim(),o=e.getData("text/plain").trim()||t,i=e.getData("text/html").trim(),n=Yt(i);if(!function(e){const t=document.createElement("div");return t.innerHTML=Gt(e),C.RE({node:t,window})}(i)&&!function(e,t){return eo.test(e)&&eo.test(t)}(i,o))return{text:o,isFromMicrosoftOffice:n};return{text:o,html:i,isFromMicrosoftOffice:n}}(e);return{text:t,html:o,multiTextSelectionData:yt(e,ot,pt),textSelectionData:yt(e,tt,lt),blockSelectionData:yt(e,et,ut),isFromMicrosoftOffice:i}}function St(e){const{blocks:t,action:o,environment:i}=e;if(0===t.length)return{action:o,blocks:[],wasContiguousSelection:!1};const n=t[0],r=n.inMemoryRecordCache,s=a().uniq(a().compact(t.map((e=>e.id)))),l=n.getParentBlockStore(),c=l?l.getRenderableContentIds():[],d=c.indexOf(n.id),p=Boolean(l&&t.every(((e,t)=>c.indexOf(e.id)===d+t)));if(r.isTemplatePreview){return{blocks:s.map((e=>({blockId:e,snapshotData:void 0,blockSubtree:Re.K8(i,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0})}))),action:o,wasContiguousSelection:p}}if(r.snapshotData){Pe.trackCopyFromHistory(i,r.snapshotData);return{blocks:s.map((e=>({blockId:e,snapshotData:r.snapshotData,blockSubtree:Re.K8(i,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0})}))),action:o,wasContiguousSelection:p}}{const e=(0,te.IU)(t),n=e&&function(e){var t;const{environment:o,multiColumnPasteInfo:i,inMemoryRecordCache:n}=e,{columnListId:r,columnIds:a,spaceId:s}=i,l=D.Ak.create(),c=null===(t=n.getEntry({pointer:{table:N.iU,id:r,spaceId:s},userId:o.currentUser.id}))||void 0===t?void 0:t.value.value;if("column_list"!==(null==c?void 0:c.type))return;const d={...c,content:(c.content||[]).filter((e=>a.has(e)))};l.set({table:N.iU,id:r,spaceId:s},d);for(const m of a){var p;const e=null===(p=n.getEntry({pointer:{table:N.iU,id:m,spaceId:s},userId:o.currentUser.id}))||void 0===p?void 0:p.value.value;if("column"!==(null==e?void 0:e.type))return;const t={...e,content:(e.content||[]).filter((e=>i.blockIds.has(e)))};l.set({table:N.iU,id:m,spaceId:s},t)}const u=[l];for(const m of i.blockIds){const e=Re.K8(o,{blockId:m,inMemoryRecordCache:n,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0});if(!e)return;u.push(e)}return(0,F.Jz)(u)}({environment:i,inMemoryRecordCache:r,multiColumnPasteInfo:e});if(e&&n){let t=!1;const a=[];for(const o of s)e.blockIds.has(o)?t||(a.push({blockId:e.columnListId,snapshotData:void 0,blockSubtree:n}),t=!0):a.push({blockId:o,snapshotData:void 0,blockSubtree:Re.K8(i,{blockId:o,inMemoryRecordCache:r,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0})});return{blocks:a,action:o,wasContiguousSelection:p}}return{blocks:s.map((e=>({blockId:e,snapshotData:void 0,blockSubtree:Re.K8(i,{blockId:e,inMemoryRecordCache:r,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0})}))),action:o,wasContiguousSelection:p}}}function wt(e,t){return Xe((o=>I.c8({...o,markdown:e,plugin:null==t?void 0:t.plugin})))}function kt(e){const{rootBlock:t,clipboardData:o,isWindows:i,fallbackGetRecordValue:n,markdownSerializationOptions:r}=e,{tree:a,blockSelection:s}=o,l=A.mF.tryUntilFound(...s.blocks.map((e=>e.blockSubtree&&A.mF.fromRecordMap(e.blockSubtree))).filter(j.$K),n),c=a.value,d=s.blocks.map((e=>l({...c,id:e.blockId}))).filter(j.$K);return Mt({rootBlock:t,getRecordValue:l,blockValues:d,isWindows:i,markdownSerializationOptions:r})}function Ct(e){const{rootBlock:t,getRecordValue:o}=e,i=o(t);if(!i)return;const n=(0,w.ky)({block:i,getRecordValue:o});if(!n)return;const r=_t({rootBlock:t,getRecordValue:o}),s=(0,u.oC)(n),l=Object.keys(s),c=a().sortBy(l,(e=>{const t=s[e];return t&&t.name||""}));let d="";for(const a of c){const e=s[a];if(e&&"title"!==a){const t=(0,v.Wy)({property:a,schema:s,block:i,exportArgs:r,renderers:f.O});t&&(d+=`${e.name}: ${t}\n`)}}return d||void 0}function _t(e){const{rootBlock:t,getRecordValue:o}=e;return{root:t,navigableBlockId:t.id,renderParentBlockId:void 0,blockId:t.id,userTimeZone:(0,k.r)(),intl:ne.default.getIntl(),getRecordValue:o,numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:e=>{let{toFileURI:t}=e;return t},getExportedRenderAsset:e=>{let{toFileURI:t}=e;return t},getExportedPathToPage:e=>{let{toPageId:t}=e;return(0,g.Z)({pageId:t,pageValue:o({table:N.iU,id:t}),baseUrl:Q.Z.domainBaseUrl})},baseUrl:Q.Z.domainBaseUrl,publicDomainName:Q.Z.publicDomainName}}function Mt(e){const{blockValues:t,rootBlock:o,getRecordValue:i,isWindows:n,markdownSerializationOptions:r}=e,a=I.on(t,{..._t({rootBlock:o,getRecordValue:i}),transformAnnotation:null==r?void 0:r.transformAnnotation,transformBlockMapping:null==r?void 0:r.transformBlockMapping}),s={markdown:void 0,html:void 0};if(a){s.markdown=Pt(n,a);const e=wt(a);e&&(s.html=Pt(n,e))}return s}function Tt(e){const{treePath:t,textPosition:o,endpoint:i}=e,{store:n,index:r}=o,a=t.map((e=>e.value.store.pointer)),s=o.store.path,l=H.xr(n.getValue(),r,r);return{copiedText:"end"===i?l.tokensBeforeRange:l.tokensAfterRange,textIndex:r,attributePath:s,pointerPath:a}}function It(e){var t;const{multiSelection:o,action:i,environment:n}=e;(0,re.qS)(o)&&console.warn("Warning, serializeMultiTextSelectionToClipboardData() was called with a single-store text selection! This function should only be  called with a multi-selection that spans multiple blocks.");const r=null===(t=(0,ae.tp)({filterCommonAncestors:!0,multiSelection:o,focus:void 0}))||void 0===t?void 0:t.stores;if(!r)return;const a=St({action:i,blocks:r,environment:n});if(0===a.blocks.length)return;const s=(0,ae.Nj)({multiSelection:o,includeNonSelectable:!1});if(!s)return;const{treeRange:l}=s,c=[],d=new Map,p=(e,t)=>{t.forEach((e=>p(e,[])));const o=d.get(e),i=o&&o.length>t.length?o:t;d.set(e,i)};for(const{start:v,end:y}of l.iterateAnalogousNodes()){if(v){const e=v.childrenBeforeRange.slice(-1).concat(v.childrenInsideRange);p(v.parent,e)}y&&(p(y.parent,y.childrenInsideRange),c.push(x.op.set({pointer:y.parent.value.store.pointer,path:["content"],args:y.childrenInsideRange.map((e=>e.value.store.id))})))}const u=Tt({textPosition:o.start,endpoint:"start",treePath:l.startPath}),m=Tt({textPosition:o.end,endpoint:"end",treePath:l.endPath});c.push(x.op.set({pointer:u.pointerPath[u.pointerPath.length-1],path:u.attributePath,args:u.copiedText})),c.push(x.op.set({pointer:m.pointerPath[m.pointerPath.length-1],path:m.attributePath,args:m.copiedText}));for(const v of[null===(g=a.blocks[0])||void 0===g?void 0:g.blockSubtree,null===(h=a.blocks[a.blocks.length-1])||void 0===h?void 0:h.blockSubtree]){var g,h;v&&(0,B.FS)({recordMap:v,operations:c,updateOnly:!0})}const f=(0,W.MW)(l.commonAncestor,(e=>{const t=d.get(e);if(t)return{value:e.value.store.pointer,children:t}}));return f?{blockSelection:a,tree:f,multiTextSelection:{start:u,end:m},action:i}:void 0}function Pt(e,t){return e?t.split("\r\n").reduce(((e,t)=>[...e,...t.split("\n")]),[]).join("\r\n"):t}function xt(e,t){!function(e,t){if(!t.clipboardData)return;const o=Te.default.state.stores,i=Ie.default.isEditingComment(),n=me.UQ(),r="empty"!==Ie.default.state.mode&&Ie.default.state.multiSelection,s=e.currentUser.id,l="copy"===t.type?"copy":"cut",c=ee.RM();c&&(0,D.$O)(c.pointer,N.iU)&&vt(t,it,ct,c.pointer);const d=r&&(0,re.QY)(r);if(d&&d.selection.startIndex!==d.selection.endIndex){const o=ne.default.getIntl(),{store:i,selection:n}=d,r=i.inMemoryRecordCache,a=i.getValue();if(t.preventDefault(),a){var u;const e="title"===i.path[i.path.length-1],o=null===(u=(0,pe.sQ)(i))||void 0===u?void 0:u.getType(),r=e&&o&&(0,p.Zu)(o)?o:void 0;vt(t,tt,lt,{blockType:r,editing:a,selection:n,action:l})}const c=H.KU(a,n.startIndex,n.endIndex),g=P.om.fromGetRecordValueFn(r.makeGetRecordValueFn(s)),h=r.makeGetRecordRoleFn(s),f=z.Xh({intl:o,textValue:c,getRecordModel:g,userTimeZone:(0,k.r)()});t.clipboardData.setData("text/plain",Pt(e.device.isWindows,f));const v=z.hW({textValue:c&&{value:c,spaceId:(0,L.CG)(i.pointer.spaceId)},getRecordModel:g,getRecordRole:h,userTimeZone:(0,k.r)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,baseUrl:Q.Z.domainBaseUrl,publicDomainName:Q.Z.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,m.Vx)(),intl:o,katex:void 0,isClient:void 0,currentUserId:void 0,overwriteBaseUrlFromSpaceId:(0,le.b)(e),externalIntegrations:Ce.Z.integrations.state,formulaValueTypes:[]});return void t.clipboardData.setData("text/html",Pt(e.device.isWindows,v))}if(r&&!(0,re.iG)(r)&&!i&&r.start.store.table===N.iU&&r.end.store.table===N.iU){const o=It({environment:e,multiSelection:r,action:l});if(o){t.preventDefault(),vt(t,ot,pt,o);const i=r.start.store.inMemoryRecordCache,n=r.start.store.getRecordStoreUIRoot().getValue();if(!n)return;const{markdown:a,html:l}=kt({clipboardData:o,rootBlock:{id:n.id,table:N.iU,spaceId:n.space_id},isWindows:e.device.isWindows,fallbackGetRecordValue:i.makeGetRecordValueFn(s)});return a&&t.clipboardData.setData("text/plain",a),void(l&&t.clipboardData.setData("text/html",l))}}if(r&&!(0,re.iG)(r)&&!i&&r.start.store.table===O.x_&&r.end.store.table===O.x_){t.preventDefault();const o=(0,ae.L5)(r),i=ne.default.getIntl(),n=o.map((t=>{let{store:o,selection:n}=t;if(n.startIndex===n.endIndex)return;const r=o.inMemoryRecordCache,a=P.om.fromGetRecordValueFn(r.makeGetRecordValueFn(s)),l=r.makeGetRecordRoleFn(s),c=H.KU(o.getValue(),n.startIndex,n.endIndex);return{plainText:z.Xh({intl:i,textValue:c,getRecordModel:a,userTimeZone:(0,k.r)()}),htmlContent:z.hW({textValue:c&&{value:c,spaceId:(0,L.CG)(o.pointer.spaceId)},getRecordModel:a,getRecordRole:l,userTimeZone:(0,k.r)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,baseUrl:Q.Z.domainBaseUrl,publicDomainName:Q.Z.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,m.Vx)(),intl:i,katex:void 0,isClient:void 0,currentUserId:void 0,overwriteBaseUrlFromSpaceId:(0,le.b)(e),externalIntegrations:Ce.Z.integrations.state,formulaValueTypes:[]}),textValue:c}})).filter(j.$K),a=n.map((e=>e.plainText)).join("\n\n"),l=`<div>${n.map((e=>e.htmlContent)).join("</div><div>")}</div>`;return t.clipboardData.setData("text/plain",Pt(e.device.isWindows,a)),void t.clipboardData.setData("text/html",Pt(e.device.isWindows,l))}if(o.length>0&&!i&&!n){t.preventDefault();const i=o[0],n=i.inMemoryRecordCache,r=St({blocks:o,environment:e,action:l});if(vt(t,et,ut,r),!i.isDefined())return;const c=a().compact(o.map((e=>e.computeWithRecordValues((t=>{let{getRecordValueAndSubscribe:o}=t;return o(e)}))))),d=n.makeGetRecordValueFn(s),{markdown:p,html:u}=Mt({rootBlock:{id:i.id,table:N.iU,spaceId:i.getSpaceId()},blockValues:c,getRecordValue:d,isWindows:e.device.isWindows});p&&t.clipboardData.setData("text/plain",p),u&&t.clipboardData.setData("text/html",u)}}(e,t),function(e,t){if(!e.clipboardData||!ht(t))return;const o=(0,E.ZP)(),i={};for(const a of rt)i[a]=e.clipboardData.getData(a);const n=e.clipboardData.getData("text/html");e.clipboardData.setData("text/html",`${n}${(0,te.Gp)(o)}`),gt={id:o,mimeTypes:i};try{U.Z.set(mt,gt)}catch(r){S.log({level:"error",from:"clipboardActions",type:"setVirtualClipboardData",error:{message:"Unable to persistently store virtual clipboard data."}})}}(t,e.device)}async function Bt(e){const{event:t,environment:o}=e,i=Te.default.state.stores,n=Ie.default.isEditingComment(),r=ee.JE(),a="editing"===Ie.default.state.mode&&Ie.default.state.multiSelection,{phase:s}=Te.default.state;Et({environment:o,event:t}),a&&!(0,re.iG)(a)?Ke.createAndCommit({userAction:"clipboardActions.cutWithMaybeConfirmation",environment:o,perform:e=>{We.pz({environment:o,multiSelection:a,transaction:e})}}):(s===Te.SelectionPhase.Selected||a)&&i.length>0&&!n&&!r&&await Ve.Qw({environment:o,blocks:i}),_e.Z.setKeyboardMode(!0)}let Zt=!1;function Et(e){if(!Zt){const{environment:t,event:o}=e;xt(t,o),_e.Z.setKeyboardMode(!0)}}function Rt(e){const{environment:t,files:o,transaction:i}=e,n=Te.default.getCurrentRecordCache(),r=ee.qQ(t);if(n){var a;Lt({environment:t,blocks:Ae.z({environment:t,files:o,inMemoryRecordCache:n,transaction:i,pageWidth:r,spaceId:0!==Te.default.state.stores.length?Te.default.state.stores[0].pointer.spaceId:null===(a=ee.RM())||void 0===a?void 0:a.pointer.spaceId}),transaction:i,replaceEmptyTextBlock:!0})}}function At(e){const{environment:t,store:o,tokens:i,index:n,transaction:r,multiTextSelection:a,disableEmbedMenu:s,selectAll:c}=e,d=(0,re.QY)(a),p=d?{value:d.store.getValue()}:void 0;We.mM({environment:t,store:o,tokens:i,index:n,transaction:r,selectAll:c});const u=Dt(i);!s&&p&&u&&function(e){const{environment:t,hyperlink:o,oldTextValue:i}=e,n="editing"===Ie.default.state.mode&&(0,re.QY)(Ie.default.state.multiSelection),r=Te.default.state;if(n&&r.stores.length>0){const e=n.store.getValue(),r=H.Q(e),a=h.p4(r.substring(0,r.indexOf(o.text))).length,s=a+h.p4(o.text).length;if(n.store.isTable(N.iU)||n.store.isTable(O.x_)){if(Ge.KT({environment:t,blockStore:Te.default.state.stores[0],textStore:n.store,textValueBeforePaste:i,url:o.url,urlSelection:{startIndex:a,endIndex:s}}))return;if($.QZ({environment:t,textStore:n.store,blockStore:Te.default.state.stores[0],oldTextValue:i,url:o.url,urlSelection:{startIndex:a,endIndex:s}}))return}l.default.afterNextFlush((()=>{let e=o.url;try{e=decodeURIComponent(o.url)}catch(r){S.log({level:"info",from:"clipboardActions",type:"activateMenuFromLink",error:{message:`Encountered error in decodeURIComponent ${o.url}`}})}De.KT({environment:t,textStore:n.store,oldTextValue:i,url:e,urlSelection:{startIndex:a,endIndex:s}})}))}}({environment:t,hyperlink:u,oldTextValue:p.value,transaction:r})}function Dt(e){if(1!==e.length)return;const t=e[0];if(!H.AJ(t))return;const[o,i]=t;if(1!==i.length)return;const n=i[0];if(!H.j0(n))return;return{text:o,url:H.zW(n)}}function Ft(e){const{environment:t,clipboardData:o,transaction:i,allowPasteIntoHeaderWithoutChildren:n,selectAll:r}=e;if(Ie.default.isEditingComment()||$t())return!1;if(o.blockSelection.blocks.some((e=>!e.blockSubtree)))return!1;const a=Ie.default.state;if("editing"!==a.mode)return!1;if(!a.multiSelection.start.store.isTable(N.iU))return!1;const s=a.multiSelection.start.store.path;if("title"!==s[s.length-1])return!1;const c=(0,pe.sQ)(a.multiSelection.start.store);if(!c)return!1;const d=c.getType(),u=c.getFormat();if(!d)return!1;if(!((0,p.Um)(d,u)||n&&(0,p.zp)(d)))return!1;if(n&&(0,p.zp)(d)){var m;const e=o.blockSelection.blocks[0],t=null==e?void 0:e.blockId,i=null==e?void 0:e.blockSubtree,n=t&&i?i.get({id:t,table:"block"}):void 0;if(Boolean(null==n||null===(m=n.content)||void 0===m?void 0:m.length))return!1}const g=(0,de.dq)({includeNonSelectableListContainer:!0});if(!g)return!1;const h=(0,de.v5)(c,[g]);if(!h)return!1;let f=0;for(let l=h.length-1;l>=0;l--){const e=h[l].value.store,t=be.C.findSelectableFromStore(e),o=e.getModel();if(null!=o&&o.isType(p.$t)||t&&!t.props.canSelect){f=l;break}}const v=h.slice(f);if(0===v.length)return!1;const y=v[0].value.store,b=y.pointer.spaceId,S=y.isInsideTemplate()||y.isInsideFactoryOrDuplicateBlocksAction(),w=o.blockSelection.blocks.map((e=>{var o;let{blockId:n,blockSubtree:r}=e;if(!r)throw new Error("Missing data for local duplicate block during paste");const a=(null===(o=r.get({table:N.iU,id:n}))||void 0===o?void 0:o.type)===p.Ti.factory,s=!(S||a),l=Me.G.createChildStore(y,{table:N.iU,id:n});return Re.E9({environment:t,sourceBlockId:n,targetBlockPointer:{table:N.iU,id:(0,E.ZP)(),spaceId:b},sourceBlockSubtree:r,targetInMemoryRecordCache:y.inMemoryRecordCache,addCopyName:(0,ue.Z)(l),deepCopyTransclusionContainers:!1,resolveTemplateVariables:s,transaction:i})})),C=o.multiTextSelection.start.pointerPath,_=o.multiTextSelection.end.pointerPath,M=[],T=[],I=Math.max(C.length,_.length),P=(v[v.length-I]||v[0]).value.store,x=(0,W.MW)({node:o.tree,recordStoreParent:P},(e=>{let{node:t,recordStoreParent:o}=e;const i=((e,t)=>{let o;for(const{originalToDuplicate:i}of w)if(o=i.get(t),o)break;if(o)return Me.G.createChildStore(e,o)})(o,t.value),n=M.length<C.length?C[M.length]:void 0,r=T.length<_.length?_[T.length]:void 0;let a=!1;if((null==n?void 0:n.id)===t.value.id&&(a=!0,M.push(i)),(null==r?void 0:r.id)===t.value.id&&(a=!0,T.push(i)),!a)return{value:{store:i}};const s=(null==i?void 0:i.getContentStore())||y;return{value:{store:i},children:t.children.map((e=>({node:e,recordStoreParent:s})))}}));if(M.length!==C.length||0===M.length)throw new Error(`Failed to hydrate start path during paste (found ${M.length} of ${C.length})`);if(T.length!==_.length||0===T.length)throw new Error(`Failed to hydrate end path during paste (found ${T.length} of ${_.length})`);const B=M[M.length-1],Z=T[T.length-1];if(!B||!Z)throw new Error(`Failed to hydrate position during paste (${B?"":"missing start"} ${Z?"":"missing end"})`);const R=(0,W.DY)([x],(e=>e.value.store===B)),A=(0,W.DY)([x],(e=>e.value.store===Z)),D=R&&A&&Y.T.fromNearestCommonAncestor(R,A);if(!D)throw new Error(`Failed to build range for paths: ${R?"":"missing start"} ${A?"":"missing end"}`);We.pz({environment:t,multiSelection:a.multiSelection,transaction:i});const F=Ie.default.state,L="editing"===F.mode?F.multiSelection:a.multiSelection;if((0,ce.PF)(c)&&0===o.multiTextSelection.start.textIndex){const e=B.getType();e&&(0,p.Zu)(e)&&Ye.Cj({environment:t,blocks:[c],blockType:e,transaction:i})}const V=We.Rx({environment:t,multiSelection:L,transaction:i});let O=H.OA(o.multiTextSelection.start.copiedText);S||(O=H.KV(O,{currentUserId:t.currentUser.id,currentTimeZone:(0,k.r)()})),We.mM({environment:t,index:L.start.index,store:L.start.store,tokens:O,transaction:i});const U=(0,pe.mh)(Z);let z=0;U&&(z=H.ee(U.getValue()).length,We.OR({deleteAfterSelectionResult:V,environment:t,store:U,selection:{startIndex:z,endIndex:z},transaction:i}));for(const l of D.iterateInsertionAt(v))(0,de.D_)({transaction:i,treeOperation:l,deleteFrom:"tree-parent"}),K.applyMutable(l);const j=new Set;for(const{originalToDuplicate:l}of w){const e=l.getByTable(N.iU);for(const{value:t}of e){if(!t||j.has(t.id))continue;j.add(t.id);const e=Me.G.createChildStore(B,t);(0,se.qA)(e).find((e=>e.id===y.id))||(e.id,B.id,Fe.YM({childStore:e,parentStore:y,alive:!1,transaction:i}))}}return l.default.afterNextFlush((()=>{const e=(0,de.kC)({rootStore:y,root:g,target:D.end}),t=e&&(0,pe.mh)(e[e.length-1]);if(!t)return;const o={start:{index:r?L.start.index:z,store:r?L.start.store:t},end:{index:z,store:t}};je.NA({multiSelection:o})})),!0}function Lt(e){const{environment:t,blocks:o,transaction:i,replaceEmptyTextBlock:n}=e,r=Te.default.state.stores;if(1===r.length){const e=r[0];if(e.getType()&&e.isType(p.hY)&&function(e){if("editing"!==Ie.default.state.mode||!Ie.default.state.multiSelection)return!1;const t=(0,re.QY)(Ie.default.state.multiSelection);if(!t)return!1;return t.store===e.getTitleStore()}(e)){const n=e.getContentStore(),r=a().clone(o).reverse().map((e=>J.Ce({parent:n,prepend:e,transaction:i}).child));return Ne.Z5({environment:t,stores:r}),r}}return Ve.is({selection:r,environment:t,blocks:o,transaction:i,replaceEmptyTextBlock:n})}function Vt(e,t,o,i){const n=(0,ee.RM)(),r=0!==Te.default.state.stores.length?Te.default.state.stores[0].pointer.spaceId:null==n?void 0:n.pointer.spaceId;if(n){const a=t.blocks.map((t=>{var o;let{blockId:a,blockSubtree:s,snapshotData:l}=t;const c=Me.G.createChildStore(n,{table:N.iU,id:a});let d;if(c.isDefined())d=c.getModel();else{const e=null==s?void 0:s.get({table:N.iU,id:a});d=e&&P.kk.fromBlock(e)}const p=!(n.isInsideTemplate()||Jt()||n.isInsideFactoryOrDuplicateBlocksAction()||null!==(o=d)&&void 0!==o&&o.isTemplateVariableContainerBlock());if(s)return Re.E9({environment:e,sourceBlockId:a,targetBlockPointer:{table:N.iU,spaceId:r,id:(0,E.ZP)()},sourceBlockSubtree:s,targetInMemoryRecordCache:c.inMemoryRecordCache,addCopyName:(0,ue.Z)(c),deepCopyTransclusionContainers:!1,resolveTemplateVariables:p,transaction:i}).targetBlock;{ke.Z.state.online||Ee.showErrorMessage(ne.default.formatMessage($e.offlineError));const[t,o]=Re.WJ({environment:e,sourceBlock:{id:a,spaceId:(0,L.CG)(void 0)},targetInMemoryRecordCache:c.inMemoryRecordCache,addCopyName:(0,ue.Z)(c),transaction:i,deepCopyTransclusionContainers:!1,resolveTemplateVariables:p,snapshotData:l,targetSpaceId:(0,L.CG)(c.pointer.spaceId),convertExternalObjectInstancesToPlaceholders:!1});return o.then((e=>{e&&Ee.showErrorMessage(e)})),t}}));Lt({environment:e,blocks:a,transaction:i,replaceEmptyTextBlock:!0});const s=Te.default.state.stores,c=s.length>0?s:[n],d=t.blocks.map((e=>{const t=c.length>0?c[0]:function(e){return e.isCollectionView()?e.getCollectionViewCollectionStore()||e:e.getContentStore()}(n);return Me.G.createChildStore(t,{table:N.iU,id:e.blockId})}));l.default.afterNextFlush((async()=>{await Promise.all(c.map((e=>e.waitUntil((()=>{const t=e.getType();return Boolean(t&&t!==p.Ti.copyIndicator)}))))),await Promise.all(d.map((e=>e.load()))),o&&xe.RH({environment:e,blocks:c,pageSource:o,copiedStores:d,action:t.action,wasContiguousSelection:t.wasContiguousSelection,rootStore:n})&&xe.kE({copiedStores:d,blocks:c,pageSource:o})}))}}function Nt(e){const{environment:t,disableEmbedMenu:o,transaction:i,overwrite:n,selectAll:r,markdownOptions:a}=e,s=e.text.trim(),l=s.includes("\n"),c=Ie.default.state,d=qt(c);l&&"inline"!==d||"editing"!==c.mode?n?function(e){const{environment:t,text:o,transaction:i,selectAll:n,markdownOptions:r}=e,a=wt(o,r);if(!a)return;let s=Ut({html:a,wrapInEmptyBlocks:!1});s||(s=Ut({html:a,wrapInEmptyBlocks:!0}));if(!s)return;Ft({environment:t,clipboardData:s,transaction:i,allowPasteIntoHeaderWithoutChildren:!0,selectAll:n})}({environment:t,text:s,transaction:i,selectAll:r,markdownOptions:a}):s&&function(e){const{environment:t,text:o,transaction:i,markdownOptions:n}=e,r=wt(o,n);if(r)Wt({environment:t,html:r,transaction:i})}({environment:t,text:s,transaction:i,markdownOptions:a}):function(e){const{environment:t,text:o,disableEmbedMenu:i,transaction:n,selectAll:r,markdownOptions:a}=e,s="editing"===Ie.default.state.mode&&Ie.default.state.multiSelection;if(s){const e=(0,re.QY)(s);if(e&&function(e){const t=Ie.default.state;return"editing"===t.mode&&!(0,re.iG)(t.multiSelection)&&(0,re.qS)(t.multiSelection)&&T.B(e,"url")}(o))Qt({environment:t,text:o,transaction:n,editingSelection:e,selectAll:r});else if((0,fe.Ld)("c"))We.hJ({environment:t,multiSelection:s,string:o,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:n,selectAll:r});else{const e=function(e,t){return Xe((o=>I.lM({...o,markdown:e,plugin:null==t?void 0:t.plugin})))}(o,a);if(!e)return;zt({environment:t,html:e,transaction:n,stripText:!0,disableEmbedMenu:i,selectAll:r})}}}({environment:t,text:s,disableEmbedMenu:o,transaction:i,selectAll:r,markdownOptions:a})}function Ot(e,t){const o=e.get({table:N.iU,id:t});if(!o)return;const i={table:N.iU,id:t,spaceId:o.space_id},n=(o.content??[]).map((t=>Ot(e,t))).filter(j.$K);return new W.mp(i,n)}function Ut(e){var t,o,i,n,r,a;const{html:s,wrapInEmptyBlocks:l}=e,c=Kt(s);if(!c)return;let{allOperations:d,rootContentIds:p}=c;if(l){const e=jt(),t=jt();if(!e||!t)return;d=[e.operation,...d,t.operation],p=[e.id,...p,t.id]}const u=D.Ak.create();(0,B.FS)({recordMap:u,operations:d,updateOnly:!1});const m=[];for(const k of p)m.push({blockId:k,snapshotData:void 0,blockSubtree:u.clone()});const g=new W.mp({table:N.iU,id:(0,E.ZP)(),spaceId:void 0},p.map((e=>Ot(u,e))).filter(j.$K));if(0===g.children.length)return;const h=g.children[0],f=null===(t=(0,W.DY)([g],(e=>e===h)))||void 0===t?void 0:t.map((e=>e.value)),v=null===(o=u.get(h.value))||void 0===o||null===(i=o.properties)||void 0===i?void 0:i.title,y=(0,W.CY)(g),b=null===(n=(0,W.DY)([g],(e=>e===y)))||void 0===n?void 0:n.map((e=>e.value)),S=null===(r=u.get(y.value))||void 0===r||null===(a=r.properties)||void 0===a?void 0:a.title,w=S?H.Q(S).length:0;return v&&f&&S&&b?{blockSelection:{blocks:m,wasContiguousSelection:!0,action:"copy"},tree:g,multiTextSelection:{start:{textIndex:0,copiedText:v,attributePath:["properties","title"],pointerPath:f},end:{textIndex:w,copiedText:S,attributePath:["properties","title"],pointerPath:b}},action:"copy"}:void 0}function Ht(e){const{text:t,html:o,stripText:i}=e,n=o||(t?wt(t):void 0);if(!n)return;const r=document.createElement("div");return r.innerHTML=Gt(n),C.xR({node:r,window,stripText:i})}function zt(e){const{environment:t,html:o,transaction:i,stripText:n,disableEmbedMenu:r,selectAll:a}=e,s="editing"===Ie.default.state.mode&&Ie.default.state.multiSelection;if(s){const e=Ht({html:o,stripText:n});if(!e)return;const l=1===e.length;if(l){if(l&&(!e[0][1]||0===e[0][1].length)){const o=e[0][0];return void We.hJ({environment:t,multiSelection:s,string:o,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:i,selectAll:a})}const o=(0,re.QY)(s);if(o&&!(0,re.iG)(s)){const[,n]=e[0],r=n&&H.rl(n);if(r){return void Qt({environment:t,text:H.zW(r),transaction:i,editingSelection:o,selectAll:a})}}}We.pz({environment:t,multiSelection:s,transaction:i}),At({environment:t,store:s.start.store,tokens:e,index:s.start.index,transaction:i,disableEmbedMenu:r,multiTextSelection:s,selectAll:a})}}function Wt(e){const{environment:t,html:o,transaction:i}=e,n=Kt(o);if(!n)return;const{allOperations:r,rootContentIds:a}=n,s=ee.RM();if(!s)return;for(const l of r){const e=(0,Me.Kv)(s,l.pointer);Ke.applyOperation({store:e,operation:l,transaction:i})}const c=a.map((e=>Me.G.createChildStore(s,{table:N.iU,id:e}))),d=Lt({environment:t,blocks:c,transaction:i,replaceEmptyTextBlock:!0}).slice().reverse();return l.default.afterNextFlush((()=>{const e=d.map((e=>{if(e.getType()!==p.Ti.text)return;const o=Dt(e.getTitleValue());if(!o)return;const i=(0,V.Wj)({url:o.url,baseUrl:Q.Z.domainBaseUrl,publicDomainName:Q.Z.publicDomainName,isMobile:t.device.isMobile,protocol:Q.Z.protocol,currentUrl:ncd.href()});return"page"===i.name?i:void 0})).filter(j.$K);e.length===d.length&&xe._x({environment:t,rootStore:s,blocks:d,copiedLinks:e})})),c}function jt(){const e=(0,E.ZP)(),{currentUserStore:t}=Se.default.state,o=ee.RM();if(!t||!o)return;const i=t.id;if(!i)return;const n=o.id,r=o.pointer.spaceId;return{operation:{pointer:{table:"block",id:e,spaceId:r},command:"set",path:[],args:{id:e,version:1,type:"text",properties:{title:[[""]]},parent_id:n,parent_table:"block",space_id:r,created_by_table:"notion_user",created_by_id:i,created_time:Date.now(),last_edited_by_table:"notion_user",last_edited_by_id:i,last_edited_time:Date.now(),alive:!0}},id:e}}function Kt(e){const t=document.createElement("div");t.innerHTML=Gt(e);const{currentUserStore:o}=Se.default.state,i=ee.RM();if(!o||!i)return;const n=o.getValue();return n?C.$O({actor:(0,c.dp)(n),parentId:i.id,parentTable:"block",spaceId:i.pointer.spaceId,rootNode:t,importFileMap:{},window,secureFileS3Url:Q.Z.secureFileS3.url,ignoreBlockCount:!1,intl:ne.default.getIntl(),randomID:E.ZP,randomShortID:R.ZP,isPhoneNumber:Xt}):void 0}function Yt(e){return/schemas-microsoft-com:office/.test(e)}function Gt(e){if(Yt(e)){const t=qe();t&&(e=t(e))}return n().sanitize(e)}function Xt(e){return/^(\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/.test(e)}function qt(e){const t="editing"===e.mode&&e.multiSelection;if(!t)return;const o=ye.E.findEditableWithStore(t.start.store),i=null==o?void 0:o.props;return i&&!i.disabled?i.pasteBehavior:void 0}function $t(){if("editing"!==Ie.default.state.mode)return!1;const e=(0,re.QY)(Ie.default.state.multiSelection);if(!e)return!1;if(!e.store.isTable(N.iU))return!1;if(0===Te.default.state.stores.length)return!1;const t=e.store.getRecordStoreAtRootPath().getValue();return Boolean(t&&t.type===p.Ti.code)}function Jt(){const e=Te.default.state.stores;if("editing"!==Ie.default.state.mode)return e.length>0&&e[0].isInsideFactoryOrDuplicateBlocksAction();if(0===e.length)return!1;const{multiSelection:t}=Ie.default.state,o=t.start.store;if(!o.isTable(N.iU))return!1;const i=oe.W(o);return Boolean(i)}function Qt(e){const{text:t,transaction:o,environment:i,editingSelection:n,selectAll:r}=e,a=(0,V.Wj)({url:t,baseUrl:Q.Z.domainBaseUrl,publicDomainName:Q.Z.publicDomainName,isMobile:i.device.isMobile,protocol:Q.Z.protocol,currentUrl:ncd.href()}),s="page"===a.name?(0,_.nR)({pageId:a.blockId,peekViewBlockId:a.peekViewBlockId,peekMode:a.peekMode,discussionId:a.discussionId,scrollToBlockId:a.scrollToBlockId,collectionViewId:a.collectionViewId}):t;We.Be({environment:i,store:n.store,selection:n.selection,type:"a",transaction:o}),We.i8({environment:i,store:n.store,selection:n.selection,annotation:["a",s],transaction:o}),je.Z5({store:n.store,selection:{startIndex:r?n.selection.startIndex:n.selection.endIndex,endIndex:n.selection.endIndex}})}const eo=/\<\!-- wp:/;function to(e){const{environment:t,event:o,disableEmbedMenu:i,transaction:n,onPasteFiles:r}=e;if(o.preventDefault(),!o.clipboardData)return;if(!He.M_(t))return;const s=ft(o.clipboardData,t.device),{text:l,html:c,multiTextSelectionData:d,textSelectionData:u,blockSelectionData:m,isFromMicrosoftOffice:g}=bt(s),f=yt(s,it,ct),v=function(e){return e.clipboardData?e.clipboardData.items?a().compact(a().map(e.clipboardData.items,(e=>{const t=e.getAsFile();if(t&&t.size>0)return new File([t],"Untitled",{type:e.type})}))):h.p4(e.clipboardData.files):[]}(o),y=qt(Ie.default.state),b=(null==m?void 0:m.action)||(null==d?void 0:d.action)||(null==u?void 0:u.action);n.annotateWithUserAction("cut"===b?"paste.from_cut":te.xF);const S=l.includes("\n"),w=function(e){const t=yt(e,nt,dt),o=null==t?void 0:t.mode;if(!o)return;return Qe[o]||"Plain Text"}(s),C=S&&w&&"inline"!==y&&!$t()?function(e){const{codeLanguage:t,environment:o,transaction:i}=e,n=Ie.default.state,r="editing"===n.mode&&n.multiSelection,a=Te.default.state.stores;if(!r&&0===a.length)return;let s,l,c;r?(s=r.start.store,l=r.end.store,c=(0,pe.sQ)(l)):(s=a[0],l=a[a.length-1],c=l);if(!c)return;let d=c;if((0,ce.PF)(c))!function(e){const{block:t,environment:o,transaction:i,codeLanguage:n}=e;Ye.Cj({environment:o,blocks:[t],blockType:"code",transaction:i}),Be.E({blocks:[t],language:n,transaction:i})}({block:c,environment:o,transaction:i,codeLanguage:t});else{const e=(0,pe.sQ)(c);if(!e)return;const t=s.inMemoryRecordCache;if(!t)return;d=Le.j4({environment:o,type:p.Ti.code,inMemoryRecordCache:t,transaction:i,spaceId:e.pointer.spaceId}),J.BE({parent:e.getContentStore(),after:l,insert:d,transaction:i})}he.clear(o);const u=(0,pe.mh)(d);u&&je.N_({store:u});return d}({codeLanguage:w,environment:t,transaction:n}):void 0;Pe.trackUrlPaste(t,{pastedText:l,source:"editor_paste"});const _=me.UQ(),M=o.clipboardData.getData(ge.mH);if(!g&&v.length>0)r({environment:t,files:v,transaction:n});else if($t()&&!u)oo(t,l,n);else if(C)oo(t,l,n);else if(d){(function(e){const{environment:t,transaction:o,multiTextSelectionData:i,disableEmbedMenu:n}=e,r=e.pasteBehavior||"inline",a=e.html||wt(e.text);if("editing"===Ie.default.state.mode)switch(r){case"inline":return!!a&&(zt({environment:t,html:a,transaction:o,stripText:!1,disableEmbedMenu:n}),!0);case"block":return Ft({environment:t,clipboardData:i,transaction:o});default:(0,j.t1)(r)}})({multiTextSelectionData:d,environment:t,html:c,text:l,transaction:n,disableEmbedMenu:i,pasteBehavior:y})||Vt(t,d.blockSelection,f,n)}else if(u&&u.editing)!function(e){const{environment:t,textSelectionData:o,transaction:i,disableEmbedMenu:n}=e,r=Te.default.getCurrentRecordCache(),{editing:a,selection:s}=o;let{tokensInsideRange:l}=H.xr(a,s.startIndex,s.endIndex);l=H.OA(l);const c=(0,ee.RM)();if(c&&!(c.isInsideTemplate()||Jt()||c.isInsideFactoryOrDuplicateBlocksAction())&&(l=H.KV(l,{currentUserId:t.currentUser.id,currentTimeZone:(0,k.r)()})),$t()){const e=H.vN(l);e&&(l=e)}const d="editing"===Ie.default.state.mode&&Ie.default.state.multiSelection;if(d){We.pz({environment:t,multiSelection:d,transaction:i});const e=Ie.default.state;if("editing"===e.mode){const r=e.multiSelection;if(o.blockType&&0===s.startIndex){const e=(0,pe.sQ)(r.start.store);e&&"page"!==o.blockType&&(0,ce.PF)(e)&&Ye.Cj({environment:t,blocks:[e],blockType:o.blockType,transaction:i})}At({environment:t,store:r.end.store,tokens:l,index:r.end.index,transaction:i,disableEmbedMenu:n,multiTextSelection:d})}}else if(r){var u;const e=Le.j4({environment:t,type:p.Ti.text,inMemoryRecordCache:r,transaction:i,spaceId:0!==Te.default.state.stores.length?Te.default.state.stores[Te.default.state.stores.length-1].pointer.spaceId:null===(u=ee.RM())||void 0===u?void 0:u.pointer.spaceId}),o=e.getTitleStore();o&&We.mM({environment:t,store:o,tokens:l,index:0,transaction:i}),Lt({environment:t,blocks:[e],transaction:i,replaceEmptyTextBlock:!1})}}({environment:t,textSelectionData:u,transaction:n,disableEmbedMenu:i});else if(m&&m.blocks.length>0&&"inline"!==y)Vt(t,m,f,n);else if(_&&M){const{simpleTableStore:e,selection:i}=_.props,r=me.h4(e);i&&r&&ze.j0({environment:t,simpleTableStore:e,selection:i,currentRows:e.getContentStores(),columnOrder:r,event:o,transaction:n})}else if(c)if(_){const{simpleTableStore:e,selection:i}=_.props,r=me.h4(e);i&&r&&ze.j0({environment:t,simpleTableStore:e,selection:i,currentRows:e.getContentStores(),columnOrder:r,event:o,transaction:n})}else S&&"inline"!==y?Wt({environment:t,html:c,transaction:n}):zt({environment:t,html:c,transaction:n,stripText:!1,disableEmbedMenu:i});else Nt({environment:t,text:l,disableEmbedMenu:i,transaction:n});_e.Z.setKeyboardMode(!0)}function oo(e,t,o){const i="editing"===Ie.default.state.mode&&Ie.default.state.multiSelection;i&&We.hJ({environment:e,multiSelection:i,string:t,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:o})}function io(e){const t=e.isType(p.Ti.alias)?e.getAliasTargetStore():e;if(t){if(!(t instanceof Me.G)){const e=se.uJ(t)[0],o=t.getRecordStoreUIParent();if(e&&!(e instanceof Me.zX)&&o)return(0,ie.pB)({store:e,scrollToBlockId:o.id,fullyQualified:!0},{[d.$X]:d.tY.CopyLink});const i=t.getValue();if(!i)return;const n=(0,Me.Kv)(t,{table:i.parent_table,id:i.parent_id,spaceId:i.space_id}).getValue();if(!n)return;const r=Me.G.createChildStore(t,{table:N.iU,id:n.parent_id}),a=r.getNavigableBlockStore();if(!a)return;return(0,ie.pB)({store:a,scrollToBlockId:r.id===t.id?void 0:t.id,fullyQualified:!0},{[d.$X]:d.tY.CopyLink})}{const e=t.getNavigableBlockStore();if(e)return(0,ie.pB)({store:e,scrollToBlockId:e.id===t.id?void 0:t.id,fullyQualified:!0},{[d.$X]:d.tY.CopyLink})}}}function no(e){const{environment:t,blocks:o}=e,i=o[0];Ze.wG(),Oe.MO();const n=io(i);if(n){co({environment:t,stringValue:n,copiedMessage:Je.copiedLinkToClipboard})}}function ro(e){const{environment:t,blocks:o}=e,i=o[0];Ze.wG(),Oe.MO();const n=io(i),r=function(e,t){var o;const i=io(t);if(!i)return;const n=e.currentUser.id,r=(0,v.Ho)({blockId:t.id,intl:ne.default.getIntl(),getRecordValue:t.inMemoryRecordCache.makeGetRecordValueFn(n),userTimeZone:(0,k.r)()}),a=null===(o=t.getBlockIconStore())||void 0===o?void 0:o.getValue(),s=[(0,M.Z)(a)?a:void 0,r].filter(j.$K).join(" ");return s?`<a href="${i}"><span>${s}</span></a>`:i}(t,i);if(n&&r){!async function(e){const{environment:t,htmlValue:o,stringValue:i,copiedMessage:n,showCopyModal:r}=e;function a(){Ne.ZH(t),we.Z.setState({...we.Z.state,active:!0,stringValue:i})}if(r)return void a();try{if("undefined"==typeof ClipboardItem)await navigator.clipboard.writeText(i);else{const e=new ClipboardItem({"text/html":new Blob([o],{type:"text/html"}),"text/plain":new Blob([i],{type:"text/plain"})});await navigator.clipboard.write([e])}Ue.oV({label:ne.default.formatMessage(n)})}catch{a()}}({environment:t,stringValue:n,htmlValue:r,copiedMessage:Je.copiedLinkToClipboard})}}function ao(e){const{environment:t,blocks:o}=e;if(o.length<2)return no(e);Ze.wG(),Oe.MO();const i=o.map(io).filter(j.$K);if(i.some(Boolean)){const e=i.length>1?Je.copiedLinksToClipboard:Je.copiedLinkToClipboard;co({environment:t,stringValue:i.join("\n\n"),copiedMessage:e})}}function so(e){const{environment:t,blocks:o}=e,i=o[0];if(!i.isDefined())return;const n=i.getModel(),r=i.getProperties(),a=i.getFormat();let s;if(i.isType(p.Ti.bookmark))s=null==r?void 0:r.link,s=H.Q(s);else if(n.isType(p.Ok))s=null==r?void 0:r.source,s=H.Q(s);else if(i.isType(p.Ti.file))s=null==r?void 0:r.source,s=H.Q(s);else if(i.isType(p.Ti.externalObjectInstance)||i.isType(p.Ti.externalObjectInstancePage))s=(null==a?void 0:a.original_url)||(null==a?void 0:a.uri);else if(i.isType(p.Ti.collectionView)){var l;const e=null===(l=i.getCollectionViewCollectionStore())||void 0===l?void 0:l.getValue();var c;if(e&&(0,y.Gq)(e))s=null===(c=e.format)||void 0===c?void 0:c.original_url}else{if(!i.isType(p.Ti.alias))return;s=null==a?void 0:a.comment_alias_url}if(!s)return;if(b.E$(s,Q.Z.secureFileS3.url))return void S.log({level:"error",from:"clipboardActions",type:"copyDirectLinkToContent",error:{message:"Attempted to copy a direct signed url for S3-housed content."}});if(s=G.yn(s),!s)return;Ze.wG(),Oe.MO();co({environment:t,stringValue:s,copiedMessage:Je.copiedLinkToClipboard})}let lo;if("undefined"!=typeof document){lo=document.createElement("textarea"),lo.style.opacity="0",lo.style.pointerEvents="none",lo.style.position="fixed",lo.style.left="0px",lo.style.top="0px",lo.ariaHidden="true",lo.tabIndex=-1;const e=(0,X.Z)(window);e.isAndroid()&&!e.isFirefox()&&(lo.disabled=!0),document.body.appendChild(lo)}function co(e){const{environment:t,stringValue:o,copiedMessage:i,showCopyModal:n}=e;if(!document.queryCommandSupported("copy")||void 0!==n&&n)Ne.ZH(t),we.Z.setState({...we.Z.state,active:!0,stringValue:o});else{lo.value=o;const e=document.createRange();lo.disabled=!1,lo.select(),e.selectNodeContents(lo),he.set(e,t.device),lo.setSelectionRange(0,o.length+1),Zt=!0,document.execCommand("copy"),Zt=!1,he.clear(t),lo.blur(),t.device.isAndroid&&!t.device.isFirefox&&(lo.disabled=!0)}Ue.oV({label:ne.default.formatMessage(i)})}function po(){document.queryCommandSupported("copy")&&document.execCommand("copy")}function uo(e,t){let o;var i;(o="string"==typeof t?t:JSON.stringify(t),o)&&(co({environment:e,stringValue:o,copiedMessage:Je.copiedToClipboard}),(0,s.Am)(`Copied ${i=o,i.length>50?`${i.substr(0,49)}...`:i} to clipboard`))}function mo(e){const{environment:t,textSelection:o,markdownSerializationOptions:i}=e,n=(0,re.QY)(o);if(n&&n.selection.startIndex!==n.selection.endIndex)return function(e){const{environment:t,singleStoreTextSelection:o,markdownSerializationOptions:i}=e,{store:n,selection:r}=o,a=t.currentUser.id,s=n.inMemoryRecordCache,l=ne.default.getIntl(),c=n.getValue(),d=H.KU(c,r.startIndex,r.endIndex),p=n.getRecordStoreUIRoot().getValue();if(!p)return;const u={id:p.id,table:N.iU,spaceId:p.space_id},m=s.makeGetRecordValueFn(a);return I.CK({textValue:d,exportArgs:{root:u,navigableBlockId:u.id,renderParentBlockId:void 0,blockId:u.id,userTimeZone:(0,k.r)(),intl:l,getRecordValue:m,numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:e=>{let{toFileURI:t}=e;return t},getExportedRenderAsset:e=>{let{toFileURI:t}=e;return t},getExportedPathToPage:e=>{let{toPageId:t}=e;return(0,g.Z)({pageId:t,pageValue:m({table:N.iU,id:t}),baseUrl:Q.Z.domainBaseUrl})},baseUrl:Q.Z.domainBaseUrl,publicDomainName:Q.Z.publicDomainName,transformAnnotation:null==i?void 0:i.transformAnnotation,transformBlockMapping:null==i?void 0:i.transformBlockMapping}})}({environment:t,singleStoreTextSelection:n,markdownSerializationOptions:i});const r=It({environment:t,multiSelection:o,action:"copy"});if(!r)return;const a=o.start.store.inMemoryRecordCache,s=o.start.store.getRecordStoreUIRoot().getValue();if(!s)return;const l=t.currentUser.id,{markdown:c}=kt({clipboardData:r,rootBlock:{id:s.id,table:N.iU,spaceId:s.space_id},isWindows:t.device.isWindows,fallbackGetRecordValue:a.makeGetRecordValueFn(l),markdownSerializationOptions:i});return c}function go(e){const{environment:t,inMemoryRecordCache:o,text:i,transaction:n,markdownOptions:r}=e,a=wt(i,r);if(!a)return;const s=document.createElement("div");s.innerHTML=Gt(a);const{currentUserStore:l}=Se.default.state,d=ee.RM();if(!l||!d)return;const p=l.getValue();if(!p)return;const{allOperations:u,rootContentIds:m}=C.$O({actor:(0,c.dp)(p),parentId:d.id,parentTable:"block",spaceId:d.pointer.spaceId,rootNode:s,importFileMap:{},window,secureFileS3Url:Q.Z.secureFileS3.url,ignoreBlockCount:!1,intl:ne.default.getIntl(),randomID:E.ZP,randomShortID:R.ZP,isPhoneNumber:Xt});for(const c of u){const e=new Me.ST({environment:t,pointer:c.pointer,inMemoryRecordCache:o,userId:p.id});Ke.applyOperation({store:e,operation:c,transaction:n})}return m.map((e=>new Me.G(t,{table:N.iU,id:e},{inMemoryRecordCache:o})))}function ho(e){const{environment:t,stores:o,inMemoryRecordCache:i,transaction:n}=e,r=new Me.ST({environment:t,pointer:{table:N.iU,id:(0,E.ZP)()},inMemoryRecordCache:i,userId:t.currentUser.id,path:["content"]});for(const a of o)J.R3({parent:r,append:a,transaction:n}),Le.sW({store:a,data:{parent_id:r.id,parent_table:r.table,alive:!0},transaction:n});return r}},22858:(e,t,o)=>{o.d(t,{E:()=>s,p:()=>l});var i=o(70203),n=o(96802),r=o(9953),a=o(30149);function s(e){const{blocks:t,language:o,transaction:n}=e,a=i.TP(o);for(const i of t)r.sW({store:i.getPropertiesStore(),data:{language:a},transaction:n})}function l(e){const{environment:t,blocks:o,previewFormat:i}=e;a.createAndCommit({userAction:"codeBlockActions.setPersistedCodePreviewFormat",environment:t,perform:e=>{n.FH({stores:o,update:{code_preview_format:i},transaction:e})}})}},77162:(e,t,o)=>{o.d(t,{_H:()=>a,xb:()=>s,wd:()=>l,nS:()=>c,gl:()=>d,$q:()=>p,Rc:()=>u,y9:()=>m,rv:()=>g,zF:()=>h,Ac:()=>f,qm:()=>v,YU:()=>y,Lt:()=>b,bV:()=>S,bu:()=>w,iP:()=>k,Pd:()=>C,z1:()=>_,_t:()=>M,ou:()=>T});var i=o(51456),n=o(75079),r=o(50906);function a(e){const{environment:t,collectionContextStore:o,...i}=e,a=(0,n.Pn)(o)||{};r.trackCreateProperty(t,{...a,...i})}function s(e){const{environment:t,collectionContextStore:o,view_type:i,view_config_uri:a,...s}=e,l=(0,n.Pn)(o)||{};r.trackCreateView(t,{...l,...s,view_type:i,view_config_uri:a})}function l(e){const{environment:t,collectionContextStore:o,action:i,original_view_type:a,new_view_type:s,new_view_id:l,property_type:c}=e,d=(0,n.Pn)(o);d&&d.view_type&&r.trackConfigureView(t,{action:i,...d,view_type:d.view_type,original_view_type:a,new_view_type:s,new_view_id:l,property_type:c})}function c(e){const t=(0,n.Pn)(e.collectionContextStore);t&&t.view_type&&r.trackCollectionsOpenPeekModePicker(e.environment,{from:e.from,from_peek_mode:e.from_peek_mode,...t,view_type:t.view_type})}function d(e){const{peek_mode:t,from_peek_mode:o}=e,i=(0,n.Pn)(e.collectionContextStore);i&&i.view_type&&r.trackCollectionsUpdatePeekModeFormat(e.environment,{from:e.from,peek_mode:t,from_peek_mode:o,...i,view_type:i.view_type})}function p(e){const{environment:t,collectionContextStore:o,property:i,from:a,action:s,new_property_type:l,...c}=e,d=o.normalizedSchemaStore.state[i],p=(0,n.Pn)(o)||{};r.trackConfigureProperty(t,{property_type:null==d?void 0:d.type,new_property_type:l,property:i,from:a,action:s,...c,...p})}function u(e){const{environment:t,collectionContextStore:o,view_type:i,from:a,...s}=e,l=(0,n.Pn)(o)||{};r.trackDeleteView(t,{from:a,...s,...l,view_type:i})}function m(e){const{environment:t,collectionContextStore:o,property_type:i,from:a,property:s,...l}=e,c=(0,n.Pn)(o)||{},d=o.collectionStore(),p=null!=d&&d.getDatabaseType()&&null!=d&&d.isTypedProperty(s)?s:void 0;r.trackDeleteProperty(t,{property_type:i,from:a,property_config_uri:p,...l,...c})}function g(e){var t;const{environment:o,collectionContextStore:i,block_id:a,property:s,property_type:l,from:c,isFromBulkActionsToolbar:d,isUnthrottled:p,...u}=e,m=(0,n.Pn)(i)||{};let g;null!==(t=i.currentSubitemFormatStore.state)&&void 0!==t&&t.property?g="subitem":i.currentArrowsByFormatStore.state&&(g="timeline_arrows_by"),r.trackEditBlockProperty(o,{block_id:a,property:s,property_type:l,property_context:g,from:c,isFromBulkActionsToolbar:d,...u,...m},p||!1)}function h(e){const{environment:t,collectionContextStore:o,property:r,property_type:a,from:s,isFromBulkActionsToolbar:l,...c}=e,d=(0,n.Pn)(o)||{};i.track(t,"collection_open_block_property_overlay",{property:r,property_type:a,property_context:undefined,from:s,isFromBulkActionsToolbar:l,...c,...d})}function f(e){const{environment:t,collectionContextStore:o,checkbox_type:r,...a}=e,s=(0,n.Pn)(o)||{};i.track(t,"collection_multi_select_checkbox_clicked",{...s,checkbox_type:r,...a})}function v(e){const{environment:t,collectionContextStore:o,property_type:i,num_rows:a}=e,s=(0,n.Pn)(o)||{};r.trackCollectionTableDragAndFill(t,{property_type:i,num_rows:a,...s})}function y(e){const{environment:t,collectionContextStore:o,...i}=e,a=(0,n.Pn)(o)||{};r.trackClickBlockPropertyUrl(t,{...a,...i})}function b(e){const{environment:t,property_type:o,from:r,is_first_render:a,time:s,collectionContextStore:l}=e,c=(0,n.vS)(l);c&&i.track(t,"collections.block_property_value_overlay_render",{time:s,property_type:o,from:r,is_first_render:a,...c})}function S(e){const{environment:t,time:o,is_first_render:r,collectionContextStore:a}=e,s=(0,n.vS)(a);s&&i.track(t,"collections.collection_view_block_render",{time:o,is_first_render:r,...s})}function w(e){const{environment:t,time:o,property_type:r}=e,a=(0,n.vS)(e.collectionContextStore);a&&i.track(t,"collections.property_overlay_typing_lag",{time:o,property_type:r,from:e.from,...a})}function k(e){var t;const{environment:o,collectionContextStore:r,time:a,from:s,to:l,did_trigger_fetch:c,sizeHintAtStart:d}=e,p=(0,n.vS)(r),u=null===(t=r.collectionStore())||void 0===t?void 0:t.id;if(!p||!u)return;const{view_type:m,row_count_category:g,...h}=p;i.track(o,"collections.switch_view_lag",{time:a,from:s,to:l,did_trigger_fetch:c,row_count_category:(0,n.ZO)(d),...h})}function C(e){var t;const{environment:o,time:r,from:a,collectionContextStore:s}=e,l=(0,n.vS)(s),c=null===(t=s.collectionStore())||void 0===t?void 0:t.id;l&&c&&i.track(o,"collections.add_item_lag",{time:r,from:a,...l})}function _(e){var t;const{environment:o,from:r,collectionContextStore:a,time:s,did_trigger_fetch:l,sizeHintAtStart:c}=e,d=(0,n.vS)(a),p=null===(t=a.collectionStore())||void 0===t?void 0:t.id;if(!d||!p)return;const{row_count_category:u,...m}=d;i.track(o,"collections.update_filter_lag",{time:s,from:r,property_type:"property_type"in e?e.property_type:void 0,did_trigger_fetch:l,row_count_category:(0,n.ZO)(c),...m})}function M(e){const t=(0,n.vS)(e.collectionContextStore);i.track(e.environment,"collections.max_scroll_lag_in_session",{time:e.time,...t})}function T(e){var t;const o=(0,n.vS)(e.collectionContextStore),r=null===(t=e.collectionContextStore.collectionStore())||void 0===t?void 0:t.id;o&&r&&i.track(e.environment,"collections.drop_item_lag",{time:e.time,is_native_drop:e.is_native_drop,is_empty:e.is_empty,...o})}},74882:(e,t,o)=>{o.d(t,{K:()=>a});var i=o(65917),n=o(6287),r=o(54642);async function a(e){const{environment:t,collectionStore:o}=e,a={id:o.id,table:n.v,spaceId:o.getSpaceId()},s=await r.suggestRecordKey(t,a);if("success"===s.type){const e=s.data.key,o=await r.setRecordKey(t,{...a,key:e});if("success"===o.type)return e;i.log({level:"error",from:"collectionAutoIncrementIdActions.setRecordKeyResponse",type:"JSONParseError",error:{miscDataString:o.error.message}})}else i.log({level:"error",from:"collectionAutoIncrementIdActions.suggestRecordKeyResponse",type:"JSONParseError",error:{miscDataString:s.error.message}})}},7668:(e,t,o)=>{o.d(t,{H:()=>P});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(52936),c=o(42875),d=o(5366),p=o(96486),u=o.n(p),m=o(80951),g=o(61158),h=o(45953);function*f(e){const{startingBlock:t,relationPropertyIds:o,receiver:i}=e;let n,r=o.map((e=>function*(e){const{startingBlock:t,relationPropertyId:o,receiver:i}=e,n=new Set,r=[{block:t,path:[]}];let a=0;for(;;){var s;const e=r.shift();if(!e)break;const{block:t,path:l}=e;if(l.includes(t.id))return;if(n.has(t.id))continue;n.add(t.id);const c=[...l,t.id],d=(0,m.rq)(null===(s=t.properties)||void 0===s?void 0:s[o]);if(!i.receive(d))return;if(d.length>0){const{recordMap:e}=yield{recordPointers:d};r.push(...u().compact(d.map((t=>{const o=e.get(t);if(o&&o.alive)return{block:o,path:c}}))))}if(a++,a>500)throw new Error("Reached maximum number of iterations")}}({relationPropertyId:e,startingBlock:t,receiver:i})));for(;r.length>0;){const e=[];r=r.filter((t=>{const o=n?t.next(n):t.next();return!o.done&&(e.push(o.value),!0)})),e.length>0&&(n=yield{recordPointers:e.flatMap((e=>e.recordPointers))})}}class v{constructor(e){this.blockPointerSet=new g.Z,this.limit=e}getBlockPointers(){return this.blockPointerSet.entries()}receive(e){return this.blockPointerSet.add(...e),this.blockPointerSet.size<this.limit}}function y(e){return function(e){const{startingBlock:t,relationPropertyIds:o,getRecordValue:i,limit:n}=e,r=new v(n),a=f({startingBlock:t,relationPropertyIds:o,receiver:r});let s=a.next();for(;!s.done;){const e=h.Ak.create();for(const t of s.value.recordPointers)e.set(t,i(t));s=a.next({recordMap:e})}return r.getBlockPointers()}(e).every((t=>Boolean(e.getRecordValue(t))))}var b=o(6854),S=o(79315),w=o(10161),k=o(3815),C=o(54642),_=o(64964),M=o(30149);const T=100,I=(0,d.defineMessages)({dateShiftSuccess:{id:"collectionDateActions.dateShiftSuccess",defaultMessage:"Updated {numDependenciesUpdated, plural, one {1 task dependency} other {{numDependenciesUpdated} task dependencies}}",description:"Success message shown to a user after successfully updating due dates for dependencies"}});function P(e){!function(e){var t,o;const{environment:i,store:r,dateProperty:p,endDateProperty:u}=e;if(!w.default.checkGate("dependency_date_shifting"))return;if(u)return;const m={id:r.id,properties:r.getProperties()},g=r.getAssociatedCollectionStore();if(!m||!g)return;const h=g.getFormat(),f=g.getSchema(),v=h.dependency_date_shifting_config;if(!v||v.date_property!==p.id)return;const P=h.collection_default_arrows_by;if(!P)return;const x=f[P];if("relation"!==(null==x?void 0:x.type))return;const B=x.property;if(!B)return;const Z=null===(t=S.default.state.currentUserSettingsStore)||void 0===t||null===(o=t.getSettings())||void 0===o?void 0:o.locale;let E;E=y({startingBlock:m,relationPropertyIds:[B,P],limit:T,getRecordValue:r.getRecordValue})?Promise.resolve():C.getTransitivePageRelations(i,{blockId:m.id,limit:T,properties:[B,P].map((e=>({id:e})))}).then((()=>{}));E.then((()=>{const{numDependenciesUpdated:e,operations:t}=(0,l.y)({block:{id:m.id,properties:{...m.properties,[p.id]:p.oldValue}},blockingPropertyId:P,blockedByPropertyId:B,datePropertyId:p.id,getRecordValue:r.getRecordValue,timeZone:(0,c.r)(),locale:Z,options:v,newDateTextValue:p.newValue});M.createAndCommit({userAction:"collectionDateActions.handleDependencyDateShifting",environment:i,perform:e=>{for(const o of t){const t=(0,k.Kv)(r,o.pointer);M.applyOperation({store:t,operation:o,transaction:e})}}}),e>0&&_.oV({label:s.createElement(d.FormattedMessage,a()({},I.dateShiftSuccess,{values:{numDependenciesUpdated:e}})),button:n()(b.ow,{})})}),(e=>{console.error(e)}))}(e)}},30610:(e,t,o)=>{o.d(t,{mO:()=>h,Ys:()=>f,k7:()=>v,iU:()=>y,_x:()=>b,RD:()=>S});var i=o(77094),n=o.n(i),r=(o(67294),o(1302)),a=o(64964),s=o(37709),l=o(97004),c=o(15517),d=o(79315),p=o(5149),u=o(64434),m=o(30149),g=o(37181);let h;function f(e){const{environment:t,collectionContextStore:o,targetCollectionView:i,preventSnackbarNotification:r,type:c,transaction:d}=e,p=o.temporaryState.get(),g=o.currentPropertyFiltersStore.state,f=i.getPropertyFiltersStore(),v=(0,l.Zh)(o,"persisted");if(c===h.All||c===h.Filters){v.combinatorFilter&&u.Es({collectionViewStore:i,update:{filter:v.combinatorFilter.value||null},transaction:d});for(const e of v.filters.removed)m.applyOperation({store:f,operation:{pointer:f.pointer,command:"keyedObjectListRemove",path:f.path,args:{remove:{id:e}}},transaction:d});for(const{id:e,beforeId:t}of v.filters.moveOps){const o=g.find((t=>t.id===e));o&&(t?m.applyOperation({store:f,operation:{pointer:f.pointer,command:"keyedObjectListBefore",path:f.path,args:{before:{id:t},value:o}},transaction:d}):m.applyOperation({store:f,operation:{pointer:f.pointer,command:"keyedObjectListAfter",path:f.path,args:{value:o}},transaction:d}))}for(const e of v.filters.updated){const t=g.find((t=>t.id===e));t&&m.applyOperation({store:f,operation:{pointer:f.pointer,command:"keyedObjectListUpdate",path:f.path,args:{value:t}},transaction:d})}}c!==h.All&&c!==h.Sorts||!v.sorts||u.Es({collectionViewStore:i,update:{sort:v.sorts.value||null},transaction:d}),b({environment:t,collectionContextStore:o,temporaryState:c===h.All?void 0:c===h.Filters?{...p,combinatorFilter:void 0,propertyFilters:void 0}:{...p,sorts:void 0}}),r||a.oV({label:n()(s.NV,{}),button:n()(s.fw,{collectionContextStore:o,temporaryState:p})})}function v(e){const{environment:t,intl:o,collectionContextStore:i,transaction:n}=e,a=i.collectionViewStore(),s=i.isFullScreen.get(),l=i.isRootChild.get(),c=i.isInPeekRenderer.get();if(!a)return;const d=u.tG({environment:t,collectionContextStore:i,collectionViewStore:a,intl:o,collectionSettingsStore:i.settingsStore,transaction:n});d&&(f({environment:t,type:h.All,collectionContextStore:i,targetCollectionView:d,transaction:n}),d&&(u.f8({environment:t,collectionContextStore:i,collectionViewId:d.id,isFullScreen:s,isRootChild:l,isInPeekRenderer:c}),r.default.afterNextFlush((()=>{p.r$({collectionContextStore:i,collectionSettingsStore:i.settingsStore,selectViewNameInitial:!0})}))))}function y(e){b(e),function(e){const{environment:t,collectionContextStore:o}=e,i=o.collectionViewStore();if(!i)return;o.blockIsPrivateStore.state&&o.permissionScopes.state.canConfigureBlock&&m.createAndCommit({userAction:"collectionFilterActions.applyTemporaryStateIfPrivate",environment:t,perform:e=>{f({environment:t,collectionContextStore:o,type:h.All,targetCollectionView:i,preventSnackbarNotification:!0,transaction:e})}})}(e)}function b(e){const{environment:t,collectionContextStore:o,temporaryState:i}=e,n=o.collectionViewStore();if(!n)return;const r=t.currentUser.id;o.temporaryState.set(i||{}),(0,c.bu)({currentUserId:r,collectionViewId:n.id,temporaryState:i}),o.groupsStore.resetAllLimits()}function S(e){const{environment:t,seen:o}=e,{currentUserSettingsStore:i}=d.default.state;i&&m.createAndCommit({userAction:"collectionFilterActions.setSeenFiltersIntroTooltip",environment:t,perform:e=>{g.d2({userSettingsStore:i,transaction:e,data:{seen_filters_tooltip:o}})}})}!function(e){e[e.All=0]="All",e[e.Filters=1]="Filters",e[e.Sorts=2]="Sorts"}(h||(h={}))},49865:(e,t,o)=>{o.d(t,{BN:()=>G,Od:()=>X,$T:()=>q,mp:()=>$,by:()=>Q,tQ:()=>ee,BO:()=>oe,IW:()=>ie,A6:()=>ne,hz:()=>re,iE:()=>ae,yk:()=>se,o3:()=>de,$D:()=>pe,V$:()=>me,uo:()=>ge,w$:()=>he,tH:()=>fe});var i=o(96486),n=o.n(i),r=o(1302),a=o(41432),s=o(14248),l=o(14714),c=o(99036),d=o(93824),p=o(43593),u=o(42875),m=o(15157),g=o(98459),h=o(21202),f=o(6287),v=o(70203),y=o(95371),b=o(97880),S=o(5366),w=o(28020),k=o(75079),C=o(92918),_=o(52821),M=o(78316),T=o(77181),I=o(33929),P=o(79315),x=o(55367),B=o(3815),Z=o(54642),E=o(77162),R=o(98834),A=o(64434),D=o(61338),F=o(47307),L=o(42239),V=o(72747),N=o(96802),O=o(94419),U=o(19785),H=o(9953),z=o(5978),W=o(42858),j=o(24677),K=o(30149);const Y=(0,S.defineMessages)({removeSortingConfirmation:{id:"databaseActions.removeSortingConfirmationDialog.prompt",defaultMessage:"Would you like to remove sorting?",description:"Prompt for users to confirm removing sort."},removeSortingButton:{id:"databaseActions.removeSortingConfirmationDialog.removeSortingButton.label",defaultMessage:"Remove",description:"Confirm removing sort."},removeSortingCancel:{id:"databaseActions.removeSortingConfirmationDialog.cancelRemoveSortingButton.label",defaultMessage:"Don't remove",description:"Do not remove sort."}});function G(e){const{store:t,groupsPointer:o,environment:i,collectionContextStore:n,transaction:r}=e;if(!t.isDefined())return;const a=n.normalizedSchemaStore.state,l=n.relativeVariableStore.state;for(const c of o){const e=s.ND({block:t.getModel(),schema:a,propertyMapping:void 0,userFilterContext:{userId:i.currentUser.id,userTimeZone:(0,u.r)(),userStartOfWeek:w.AK.state},group:c,getRecordModel:t.getRecordModel,intl:I.default.getIntl(),relativeVariableResult:l});Object.keys(e).length>0&&H.sW({store:t.getPropertiesStore(),data:e,transaction:r})}}function X(e){const{store:t,transaction:o}=e;U.hh({childStore:t,transaction:o})}function q(e){var t;const{environment:o,collectionContextStore:i,before:n,insertStores:r,store:a,results:s,groupsPointer:l,transaction:c,collectionStore:d}=e,p=i.collectionViewStore(),u=null===(t=i.groupsStore.getGroupState(l))||void 0===t?void 0:t.groupUiParentStore;if(!u)return[];const m=[];for(const y of r)$({environment:o,store:y,collectionStore:d,collectionContextStore:i,groupsPointer:l,coerce:!0,results:s,transaction:c}),m.push(B.G.createChildStore(u,{table:h.iU,id:y.id}));const g=s.indexOf(a),f=n?g:g+1,v=[...s.slice(0,f),...m,...s.slice(f)];return p&&J({results:v,collectionViewStore:p,transaction:c}),i.groupsStore.setLimitIfGreater(l,v.length),m}function $(e){const{environment:t,store:o,collectionStore:i,collectionContextStore:r,groupsPointer:l,transaction:d,results:p,coerce:m,alreadyMovedToCollection:g}=e,h=i.getSchema(),f=i.getParentBlockStore(),v=f&&f.isLocked();let y=!m;if(o.isDefined()){const e=g?(0,c.Kc)(I.default.getIntl()):o.getSchema()||{},r=s.Xq({blockProperties:o.getProperties(),oldSchema:e,newSchema:h});r.propertyUpdate&&Object.keys(r.propertyUpdate).length>0&&H.sW({store:o.getPropertiesStore(),data:r.propertyUpdate,transaction:d}),n().isEqual(h,r.newSchema)||v||!M.eD({collectionStore:i,collectionViewBlockStore:f,checkNavigableAncestorLocked:!1})||A.Rm({environment:t,collectionStore:i,update:{schema:r.newSchema},transaction:d})}if(o.getType()===a.Ti.page||o.getType()===a.Ti.collectionViewPage&&o.isAssociatedCollectionAPageTree()||o.getType()===a.Ti.copyIndicator||o.getType()===a.Ti.externalObjectInstancePage||H.sW({store:o,data:{type:a.Ti.page},transaction:d}),r){if(r.collectionViewStore()){const e=r.remoteRequestStore.state,n=o.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:t}=e;return t(o)})),a=r.relativeVariableStore.state;if(n&&e&&m){const c=s.RA({block:n,schema:r.normalizedSchemaStore.state,propertyMapping:i.getPropertyMapping(),filter:e.loader.filter,userFilterContext:{userId:t.currentUser.id,userTimeZone:(0,u.r)(),userStartOfWeek:w.AK.state},relativeVariableResult:a,groupsPointer:l,getRecordValue:i.getRecordValue,intl:I.default.getIntl()}),p=c.update;Object.keys(p).length>0&&H.sW({store:o.getPropertiesStore(),data:p,transaction:d}),y=c.coercionSucceeded}}}if(g?K.applyOperation({store:o,operation:{pointer:o.pointer,path:["alive"],command:"set",args:!0},transaction:d}):U.zw({childStore:o,parentStore:i,transaction:d}),r&&A.w({collectionContextStore:r,blockId:o.id}),r){var b;const e=null===(b=r.groupsStore.getGroupState(l))||void 0===b?void 0:b.currentLimit;if(e){const t=e.get(),i=p.find((e=>e.id===o.id));p.length>=t&&!i&&e.set(p.length+1)}}return y}function J(e){const{results:t,collectionViewStore:o,transaction:i}=e,r=o.getPageSortStore(),a=t.map((e=>e.id)),s=r.getValue()||[],{beforeOps:l}=(0,d.q)(s,a.slice(0,c.gq));for(const[n,c]of Object.entries(l))if(c){const e=(0,B.Kv)(o,{table:h.iU,id:c});O.Vt({parent:r,insert:(0,B.Kv)(o,{table:h.iU,id:n}),before:e,transaction:i})}else{const e=t.findIndex((e=>e.id===n)),a=t[e-1];O.BE({parent:r,insert:(0,B.Kv)(o,{table:h.iU,id:n}),after:a,transaction:i})}const p=r.getValue();if(p&&p.length>c.gq){const e=n().difference(p,a),t=n().uniq([...n().clone(e).reverse(),...n().clone(p).reverse()]).slice(0,p.length-c.gq);for(const o of t)O.Od({parent:r,childToRemove:(0,B.Kv)(r,{table:h.iU,id:o}),transaction:i})}}function Q(e){var t,o;const{environment:i,collectionStore:r,targetStore:a,results:s,droppedDirection:l,droppedStores:d,transaction:p,duplicate:u,collectionContextStore:m,groupsPointer:g,subitemPath:v}=e,b=m.collectionViewStore();if(!b)return;if(!(null===(t=m.groupsStore.getGroupState(g))||void 0===t?void 0:t.groupUiParentStore))return;const S=d.every((e=>e.isExternalObjectInstancePageBlockStore()))&&!(r.isSyncedCollection()&&(null===(o=d[0])||void 0===o?void 0:o.getParentId())===(null==r?void 0:r.id))||u;if(l===x.vh.Onto){j.ZH(i);const e=a.getContentStore(),t=L.LQ({environment:i,droppedStores:d,duplicate:S,transaction:p,resolveTemplateVariables:!1});for(const o of t)O.R3({parent:e,append:o,transaction:p});return[]}let w=!1,k=[];if(!S){const e=function(e){const{environment:t,droppedStores:o,collectionStore:i,transaction:n}=e,r=de({environment:t,stores:o,collectionStore:i,transaction:n});for(const a of r){if(a.getParentTable()===f.v||a.getAssociatedCollectionStore())return;if(!U.zw({childStore:a,parentStore:i,transaction:n}))return}return r}({environment:i,droppedStores:d,collectionStore:r,transaction:p});w=void 0!==e,k=e??[]}const C=L.LQ({environment:i,droppedStores:d,duplicate:S,transaction:p,resolveTemplateVariables:!1});w||(k=de({environment:i,stores:C,transaction:p,collectionStore:r}));for(const n of k){$({environment:i,store:n,collectionStore:r,collectionContextStore:m,groupsPointer:g,coerce:!0,results:s,transaction:p,alreadyMovedToCollection:w});const e=null==m?void 0:m.currentSubitemFormatStore.state,t=null==e?void 0:e.inverse,o=t&&m.normalizedSchemaStore.state[t];if(e&&o&&(0,c.p_)(o)){const t=(0,T.xb)({store:n,subitemFormat:e,propertySchema:o});for(const o of t){const t=B.G.createChildStore(n,o);D.Bl({sourceStore:t,destStore:n,subitemFormat:e,transaction:p})}}const d=(0,T.Af)([...(null==v?void 0:v.map((e=>e.value.store.pointer)))??[]]),u=m.subitemExpandedStore.get().get(d);if(v&&v.length>1||null!=u&&u.isExpanded&&l===x.vh.Below){const e=null!=u&&u.isExpanded?"into":"below";le({collectionContextStore:m,collectionStore:r,subitemPath:v&&(null==v?void 0:v.length)>0?v:[new y.mp((0,T.SM)(a),[])],store:a,before:"into"===e,insertBlock:n,insertDirection:e,transaction:p})}}const _=s.filter((e=>!C.includes(e))),M=_.indexOf(a),I=l===x.vh.Above||l===x.vh.Left?M:M+1;J({results:[..._.slice(0,I),...k,..._.slice(I)],collectionViewStore:b,transaction:p}),te({environment:i,collectionContextStore:m});const P=n().map(k,(e=>B.G.createChildStore(r,{table:h.iU,id:e.id})));return j.Z5({environment:i,stores:P}),P}function ee(e){const{environment:t,collectionStore:o,targetStore:i,results:n,droppedDirection:r,files:a,transaction:s,collectionContextStore:l,groupsPointer:c}=e,d=l.collectionViewStore(),u=w.qQ(t);if(!d)return;const m=o.inMemoryRecordCache,g=V.z({environment:t,files:a,inMemoryRecordCache:m,pageWidth:u,transaction:s,spaceId:o.pointer.spaceId}).map(((e,i)=>{const n=a[i],r=H.j4({environment:t,type:"page",inMemoryRecordCache:m,properties:{title:(0,v.TP)(p.AA(n.name))},transaction:s,spaceId:o.pointer.spaceId});return O.R3({parent:r.getContentStore(),append:e,transaction:s}),r}));Q({environment:t,collectionStore:o,targetStore:i,droppedDirection:r,collectionContextStore:l,groupsPointer:c,droppedStores:g,results:n,duplicate:!1,transaction:s})}function te(e){const{environment:t,collectionContextStore:o}=e,i=o.collectionViewBlockStore(),n=o.collectionViewStore();if(!n||!i)return!1;const r=o.currentViewHasSort(),a=n.getType(),s=o.permissionScopes.state;return!!(r&&a&&_.Km[a]&&s.canConfigureBlock)&&(F.showDialog({message:I.default.formatMessage(Y.removeSortingConfirmation),items:[{label:I.default.formatMessage(Y.removeSortingButton),color:"red",onAccept:()=>{K.createAndCommit({userAction:"collectionGroupActions.offerToRemoveSort",environment:t,perform:e=>{A.Es({collectionViewStore:n,update:{sort:[]},transaction:e})}})}},{label:I.default.formatMessage(Y.removeSortingCancel),onAccept:()=>{}}],showCancel:!1,keepFocus:!0}),!0)}function oe(e){const{environment:t,droppedStores:o,duplicate:i,collectionContextStore:n,groupsPointer:r,transaction:a}=e,s=n.collectionStore(),l=n.collectionViewStore(),c=L.LQ({environment:t,droppedStores:o,duplicate:i,transaction:a,resolveTemplateVariables:!1});if(s)for(const d of c)$({environment:t,store:d,collectionStore:s,collectionContextStore:n,groupsPointer:r,coerce:!0,results:[],transaction:a});return l&&J({results:c,collectionViewStore:l,transaction:a}),[]}function ie(e){var t,o,i;const{environment:n,collectionContextStore:s,results:l,groupsPointer:c,insertAtIndex:d,coerce:p,initializeDefaultTemplate:u,transaction:m,from:g}=e;k.tN("collections.add_item_lag")&&r.default.measureFlush((e=>{E.Pd({environment:n,from:g,time:e,collectionContextStore:s})}));const f=H.j4({environment:n,type:a.Ti.page,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:m,spaceId:null===(t=P.default.state.currentSpaceStore)||void 0===t?void 0:t.id}),v=null===(o=s.collectionStoresStore.state)||void 0===o?void 0:o[0],y=s.collectionViewStore(),b=s.getViewType();if(!v||!y||!b)return{coercionSucceeded:!0,newStore:f};const S=null===(i=s.groupsStore.getGroupState(c))||void 0===i?void 0:i.groupUiParentStore;if(!S)return{coercionSucceeded:!0,newStore:f};const w=B.G.createChildStore(S,{table:h.iU,id:f.id});if(s.permissionScopes.state.canConfigureBlock){J({results:[...l.slice(0,d),w,...l.slice(d)],collectionViewStore:y,transaction:m})}const C=$({environment:n,store:f,collectionStore:v,collectionContextStore:s,groupsPointer:c,coerce:p,results:l,transaction:m});if(u){const e=s.defaultPageTemplateStore.state;e&&R.ob({title:"template",environment:n,store:f,templateStore:e,isKeyboard:!1,isCreateIn:!1,transaction:m,from:"collection_group_actions"})}return{coercionSucceeded:C,newStore:w}}function ne(e){const{collectionContextStore:t,newGroups:o,groupsFormatKey:i,transaction:n}=e,r=t.collectionViewStore();r&&N.FH({stores:[r],update:{[i]:o},transaction:n})}function re(e){const{environment:t,collectionStore:o,property:i,oldValue:n,newValue:r,transaction:a}=e,l=o.getSchema(),c=t.currentUser.id;o.inMemoryRecordCache.forEachRecord(c,((e,t)=>{var c;if(e.table!==h.iU)return;const d=t.value;if(!d)return;if((null===(c=B.G.createChildStore(o,{table:h.iU,id:d.id}).getAssociatedCollectionStore())||void 0===c?void 0:c.id)===o.id){const t=s.hz({block:d,schema:l,property:i,oldValue:n,newValue:r});if(Object.keys(t).length>0){const i=(0,B._J)(o,e,["properties"]);H.sW({store:i,data:t,transaction:a})}}})),o.isDefaultRecordCache()&&a.postSubmitCallbacks.push((async e=>{const a=o.pointer,{value:s}=await Z.renameGroup(t,{collection:{id:a.id,spaceId:(0,g.CG)(a.spaceId)},property:i,oldValue:n,newValue:r}).next();if(s.error)throw s.error}))}function ae(e){const{environment:t,collectionStore:o,groupsFormatKey:i,property:n,groupFormat:r,currentGroups:a,collectionContextStore:d,transaction:p,intl:m}=e,f=o.getSchema(),v=f[r.property];ne({collectionContextStore:d,newGroups:a.filter((e=>!(0,l.we)(r.value,e.value))),groupsFormatKey:i,transaction:p});const y=r.value;if(v&&(0,c.cu)(v)&&y.type===v.type&&o){const e=(v.options||[]).filter((e=>e.value!==y.value)),i={...v,options:e},n={...f,[r.property]:i};A.Rm({environment:t,collectionStore:o,update:{schema:n},transaction:p})}const b=t.currentUser.id;o.inMemoryRecordCache.forEachRecord(b,(async(e,i)=>{if(e.table!==h.iU)return;const r=i.value,a=B.G.createChildStore(o,e);if(r){if(s.wg({block:r,schema:f,property:n,value:y,intl:m,timeZone:(0,u.r)(),getRecordValue:o.getRecordValue}))if(r.parent_id===o.id)U.hh({childStore:a,transaction:p});else{const e=a.getAssociatedCollectionStore();e&&e.id===o.id&&("page"===a.getType()||"collection_view_page"===a.getType()&&!a.isCollectionViewPageWithContent())&&await W.Qw({environment:t,blocks:[a]})}}})),o.isDefaultRecordCache()&&p.postSubmitCallbacks.push((async e=>{const i=await Z.deleteGroup(t,{collection:{id:o.id,spaceId:(0,g.CG)(o.pointer.spaceId)},property:n,value:y}).next();if(i.value.error)throw i.value.error}))}function se(e){const{environment:t,collectionContextStore:o,before:i,store:n,results:r,groupsPointer:s,collectionStore:l,transaction:c,subitemPath:d,subitemInsertDirection:p}=e,u=o.collectionViewStore();if(!u)return;const m=o.groupsStore.getGroupState(s),g=null==m?void 0:m.groupUiParentStore;if(!g)return;const f=H.j4({environment:t,type:a.Ti.page,inMemoryRecordCache:n.inMemoryRecordCache,transaction:c,spaceId:u.pointer.spaceId}),v=$({environment:t,store:f,collectionStore:l,collectionContextStore:o,groupsPointer:s,coerce:!0,results:r,transaction:c}),y=o.defaultPageTemplateStore.state;y&&R.ob({title:"template",environment:t,store:f,templateStore:y,isKeyboard:!1,isCreateIn:!1,transaction:c,from:"collection_group_actions"});const b=B.G.createChildStore(g,{table:h.iU,id:f.id});d&&d.length>0&&le({collectionContextStore:o,subitemPath:d,collectionStore:l,store:n,before:!1,insertBlock:b,insertDirection:p,transaction:c});const S=r.indexOf(n),w=i?S:S+1;if(J({results:[...r.slice(0,w),b,...r.slice(w)],collectionViewStore:u,transaction:c}),v){if(d){var k;const e="into"===p?n:null===(k=d[d.length-2])||void 0===k?void 0:k.value.store;return e?B.G.createChildStore(e,b.pointer):b}return j.Ys({environment:t,store:b}),te({environment:t,collectionContextStore:o}),b}z.peekBlock({environment:t,store:b,peekMode:M.kr(u),resultsStore:null==m?void 0:m.resultsStore,collectionContextStore:o})}function le(e){const{collectionContextStore:t,subitemPath:o,collectionStore:i,store:n,before:r,insertBlock:a,insertDirection:s,transaction:l}=e,c=t.currentSubitemFormatStore.state;if(!c)return;const d=i.getSchema()[c.property];if(!d||"relation"!==d.type)return;if("into"===s){var p;const e=o[o.length-1],t=e.value.store;return void D.hE({sourceStore:t,destStore:a,position:r?{type:"before",before:null===(p=e.children[0])||void 0===p?void 0:p.value.store.id}:{type:"after"},subitemFormat:c,transaction:l})}const u=o[o.length-2];if(!u)return;const m=u.value.store;D.hE({sourceStore:m,destStore:a,subitemFormat:c,position:r?{type:"before",before:n.id}:{type:"after",after:n.id},transaction:l})}function ce(e){const{environment:t,collectionContextStore:o,groupFormat:i,newGroupFormat:n,groupsFormatKey:r,currentGroups:a,transaction:s}=e,c=o.collectionStore();!(0,l.we)(i.value,n.value)&&c&&re({environment:t,collectionStore:c,property:i.property,oldValue:i.value,newValue:n.value,transaction:s});ne({collectionContextStore:o,newGroups:a.map((e=>(0,l.we)(i.value,e.value)?n:e)),groupsFormatKey:r,transaction:s})}function de(e){const{environment:t,stores:o,transaction:i,collectionStore:n}=e;return o.map((e=>{const o=e.getType();if(o&&(a.Ok[o]||o===a.Ti.file||o===a.Ti.externalObjectInstance)){const o=H.j4({environment:t,type:"page",inMemoryRecordCache:e.inMemoryRecordCache,transaction:i,spaceId:n.pointer.spaceId});return U.jG({parentStore:o,childStore:e,transaction:i}),o}return e}))}function pe(e){const{environment:t,format:o,groupsFormatKey:i,collectionContextStore:r,currentGroups:a}=e,s=o[i]||[];if(!r.permissionScopes.state.canConfigureBlock)return;if(0===a.length)return;const l=a.slice(0,C.XD),c=s.slice(0,C.XD);n().isEqual(l,c)||K.createAndCommit({userAction:"collectionGroupActions.persistFormatGroups",environment:t,canUndo:!1,perform:e=>{ne({collectionContextStore:r,newGroups:a,groupsFormatKey:i,transaction:e})}})}function ue(e,t){return`group-${e}-${(0,l.mD)(t)}`}function me(e){const{environment:t,groupFormat:o,collectionContextStore:i}=e,n=i.collectionViewStore();if(!n)return;const r=i.groupsStore.getGroupState(o);if(!r)return;const a=m.Z.get({userId:t.currentUser.id,key:ue(n.id,o)});r.toggleStateStore.set(a??!0)}function ge(e){const{environment:t,groupFormat:o,toggleStateStore:i,newValue:n,collectionContextStore:r}=e,a=r.collectionViewStore();a&&(i.set(n),m.Z.set({userId:t.currentUser.id,key:ue(a.id,o),value:n}))}function he(e){const{newGroupValue:t,groupFormat:o,schema:i,collectionContextStore:n,currentGroups:r,groupsFormatKey:a,collectionStore:s,environment:d}=e,p=i[o.property];if(!p)return;if(!(0,l.LG)(p))return;const u=o.value;if((0,c.cu)(p)){if(u.type!==p.type)return;if(t.type!==p.type)return;if(void 0===t.value)return;const e=p.options||[],l=t.value,c=e.map((e=>e.value===u.value?{...e,value:l}:e)),m={...p,options:c},g={...i,[o.property]:m},h={...o,value:{...u,value:l}};K.createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:d,perform:e=>{ce({environment:d,collectionContextStore:n,groupFormat:o,newGroupFormat:h,currentGroups:r,transaction:e,groupsFormatKey:a}),A.Rm({environment:d,collectionStore:s,update:{schema:g},transaction:e})}})}else if("person"!==p.type)if((0,l.HB)(p.type)){if(u.type!==p.type)return;if(t.type!==p.type)return;if(!t.value||"exact"!==t.value.type)return;const e={...o,value:t};K.createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:d,perform:t=>{ce({environment:d,collectionContextStore:n,groupFormat:o,newGroupFormat:e,currentGroups:r,groupsFormatKey:a,transaction:t})}})}else"status"===p.type||(0,l.A1)(p.type)||"created_by"===p.type||"last_edited_by"===p.type||"number"===p.type||"checkbox"===p.type||"formula"===p.type||"relation"===p.type||"location"===p.type||(0,b.t1)(p.type);else{if(u.type!==p.type)return;if(t.type!==p.type)return;const e={...o,value:t};K.createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:d,perform:t=>{ce({environment:d,collectionContextStore:n,groupFormat:o,newGroupFormat:e,currentGroups:r,groupsFormatKey:a,transaction:t})}})}}async function fe(e){const{update:t,collectionContextStore:o,groupsFormatKey:i,collectionStore:n,environment:r,schema:s,groupBy:l}=e,d=s[l.property];if(!d)return;const p="relation"===d.type&&(0,c.F0)(d),u=p&&new B.NW(r,{table:f.v,id:p});u&&await u.load(),K.createAndCommit({userAction:"collectionGroupActions.handleCollectionAddGroupButtonAccept",environment:r,perform:e=>{if(t.newGroups&&ne({collectionContextStore:o,newGroups:t.newGroups,groupsFormatKey:i,transaction:e}),t.newSchema&&A.Rm({environment:r,collectionStore:n,update:{schema:t.newSchema},transaction:e}),t.newPage&&"relation"===d.type&&u){const o=(0,v.TP)(t.newPage.name),i={id:t.newPage.id,version:0,type:a.Ti.page,parent_id:p,parent_table:f.v,alive:!0,properties:{title:o},collection_id:void 0,space_id:t.newPage.spaceId},s=H.ae({environment:r,table:h.iU,value:i,inMemoryRecordCache:n.inMemoryRecordCache,transaction:e}),l=u.getDefaultTemplatePageStore();l&&R.ob({title:{text:o},environment:r,store:B.G.createChildStore(u,s.pointer),templateStore:l,isKeyboard:!1,isCreateIn:!1,transaction:e,from:"collection_group_actions"})}}})}},16956:(e,t,o)=>{o.d(t,{G3:()=>P,LC:()=>x,bL:()=>B,Bv:()=>Z,OK:()=>E,er:()=>R,fH:()=>A,TI:()=>D,yV:()=>F,E2:()=>L});var i=o(77094),n=o.n(i),r=(o(67294),o(99036)),a=o(95200),s=o(67219),l=o(71644),c=o(6287),d=o(82990),p=o(5366),u=o(76798),m=o(52821),g=o(78316),h=o(33929),f=o(29376),v=o(85526),y=o(3815),b=o(51127),S=o(77162),w=o(31869),k=o(5149),C=o(64434),_=o(47307),M=o(96802),T=o(30149),I=o(29919);function P(e){const{environment:t,collectionViewArgs:o,collectionStore:i,propertyName:n,propertyType:c,transaction:d}=e,p={},u=i.getSchema(),g=Object.keys(u),f=(0,a.Z)(n??m.SO[c],(e=>!g.find((t=>{const o=u[t];return Boolean(o&&o.name===e)})))),v=(0,l.ZP)(),y={name:f,type:c};if(p[v]=y,r.iE(y)&&(g.includes(s.dE)||(p[s.dE]={name:h.default.formatMessage(I.Zi.ownerPropertyName),type:"person",default:"created_by"}),y.verifier_property=s.dE),o){const{format:e,formatKey:t,collectionViewStore:i}=o,n=[...e[t]||[],{property:v,visible:!0}];M.FH({stores:[i],update:{[t]:n},transaction:d})}return C.xO({environment:t,collectionStore:i,update:p,transaction:d}),v}function x(e){const{environment:t,collectionStore:o,property:i,type:n,transaction:r}=e,a=o.getSchema()[i];if(!a||a.type===n)return;const s={...a};s.type=n,C.xO({environment:t,collectionStore:o,update:{[i]:s},transaction:r})}function B(e){const{collectionStore:t,property:o,autoRelate:i,transaction:n}=e;t.getSchema()[o]&&T.applyOperation({store:t,operation:{pointer:t.pointer,path:["schema",o,"autoRelate"],command:"set",args:i},transaction:n})}function Z(e){const{collectionStore:t,property:o,name:i,transaction:n}=e;t.getSchema()[o]&&T.applyOperation({store:t,operation:{pointer:t.pointer,path:["schema",o,"name"],command:"set",args:i},transaction:n})}function E(e){const{collectionStore:t,property:o,icon:i,transaction:n}=e;t.getSchema()[o]&&T.applyOperation({store:t,operation:{pointer:t.pointer,path:["schema",o,"icon"],command:"set",args:i},transaction:n})}function R(e){const{formatStore:t,formatKey:o,property:i,update:n,transaction:r}=e,a=[...t.getFormat()[o]||[]],s=a.findIndex((e=>e.property===i));-1!==s?a[s]={...a[s],...n}:a.push({property:i,...n}),M.FH({stores:[t],update:{[o]:a},transaction:r})}function A(e){const{collectionContextStore:t,collectionStore:o,environment:i,isInPeekRenderer:n,onCloseMenu:r}=e,a=t.settingsStore;k.H4({collectionSettingsStore:a,item:{type:"propertyType",onAccept:(e,s)=>{if("relation"===e)return void k.H4({collectionSettingsStore:a,item:{type:"selectRelationSource",property:void 0,formatKey:"collection_page_properties",collectionPointer:o.pointer}});const{performResult:l}=T.createAndCommit({userAction:"PageProperties.handleAddPropertyClick",environment:i,perform:t=>P({environment:i,collectionStore:o,collectionViewArgs:void 0,propertyType:e,propertyName:s,transaction:t})});null==r||r(),k.FK({collectionSettingsStore:a,item:{type:"property",formatKey:"collection_page_properties",property:l,selectNameInitial:!i.device.isMobile,collectionPointer:o.pointer}}),v.Z.setState({...v.Z.state,openProperty:{property:l,isInPeekRenderer:n}}),S._H({environment:i,collectionContextStore:t,from:"page_properties",property_type:e})},propertyTypes:(0,m.TP)({isSyncedCollection:o.isSyncedCollection(),collectionContextStore:t})}})}async function D(e){const{environment:t,collectionContextStore:o,property:i,handleDeleteAccept:r}=e,a=o.collectionStore();if(!a)return;if(a.isTypedProperty(i)){if(await b.w0({environment:t,property:i,collectionContextStore:o,theme:e.theme}))return}const s=o.normalizedSchemaStore.state,l=s[i],c=f.ny(o,l);await(null==c?void 0:c.load());const m=c&&f.OP(o,i,c),g=c&&f.gZ(c),h=c&&a.id===c.id,v=[{label:n()(p.FormattedMessage,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:r}];let y;if(m&&a&&g&&!h&&v.push({label:n()(p.FormattedMessage,{id:"database.tableHeaderCell.deleteProperty.modal.inverseConfirmButton",defaultMessage:"Delete, but keep related property",description:"Button label to delete a 2way relation property but preserve inverse relation."}),color:"red",onAccept:()=>{T.createAndCommit({userAction:"collectionPropertyActions.showDeletePropertyDialog",environment:t,perform:e=>{if(l&&"relation"===l.type&&l.property&&c){const o=l.property,i=c.getSchema();w.q0({environment:t,collectionStore:c,propertySchema:i[o],property:o,targetPropertyID:void 0,autoRelate:a.isSyncedCollection()&&!c.isSyncedCollection()?{enabled:!1}:l.autoRelate,transaction:e})}w.kQ({environment:t,collectionStore:a,property:i,transaction:e})}})}}),"auto_increment_id"===(null==l?void 0:l.type))y=f.pR(s)?n()(p.FormattedMessage,{id:"database.tableHeaderCell.deleteUniqueIdWithGithubProperty.modal.prompt",defaultMessage:"You will no longer be able to link new GitHub PRs and status automations will stop working.",description:"Warning message in confirmation to delete a unique id property from a collection with a Github Relation."}):n()(p.FormattedMessage,{id:"database.tableHeaderCell.deleteUniqueIdProperty.modal.prompt",defaultMessage:"The ID property will be permanently deleted.",description:"Warning message in confirmation to delete a unique id property."});else if("status"===(null==l?void 0:l.type)){const e=f.Pi(s);if(e){const t=e.connectedRelation.automation;t&&t[i]&&(y=n()(p.FormattedMessage,{id:"database.tableHeaderCell.deleteStatusProperty.modal.prompt",defaultMessage:"Deleting this status property will stop the GitHub Pull Requests status automation.",description:"Warning message in confirmation to delete a status property that has a GitHub automation."}))}}else c&&g&&!h&&m&&(y=n()(p.FormattedMessage,{id:"database.tableHeaderCell.deleteRelatedProperty.modal.prompt",defaultMessage:"This property has a related property on {relationTargetName} which will also be deleted.",description:"Warning message in confirmation to delete an inverse relation property.",values:{relationTargetName:n()(u.Z,{style:{display:"inline",fontWeight:d.Z.fontWeight.medium},store:c})}}));_.showDialog({message:n()("span",{},void 0,n()(p.FormattedMessage,{id:"database.tableHeaderCell.deleteProperty.modal.prompt",defaultMessage:"Delete this property for everyone on {databaseName}?",description:"Warning message for user to confirm that the property will be deleted",values:{databaseName:n()(u.Z,{style:{display:"inline",fontWeight:d.Z.fontWeight.medium},shouldWrap:!0,store:a})}})),description:y,showCancel:!0,keepFocus:!0,items:v})}async function F(e){const{environment:t,collectionStore:o,schema:i,property:n,transaction:a}=e,s=i[n];if(s)if("relation"===s.type&&r.F0(s)&&s.property&&r.F0(s)!==o.id){const e=new y.NW(t,r.j0(s));await e.load(),L({environment:t,collectionStore:o,schema:i,property:n,transaction:a,targetCollectionStore:e})}else L({environment:t,collectionStore:o,schema:i,property:n,transaction:a})}function L(e){const{environment:t,collectionStore:o,schema:i,property:n,transaction:r,targetCollectionStore:a}=e;if(!o.isDefined())return;const s=g.zm({environment:t,collectionId:o.id,schema:i,property:n,targetCollectionStore:a});if(!s)return;C.Rm({environment:t,collectionStore:o,update:{schema:s.newSchema,...s.deletedSchema&&{deleted_schema:s.deletedSchema}},transaction:r}),s.otherCollectionId&&s.otherCollectionSchema&&C.Rm({environment:t,collectionStore:y.NW.createChildStore(o,{table:c.v,id:s.otherCollectionId}),update:{schema:s.otherCollectionSchema,...s.otherCollectionDeletedSchema&&{deleted_schema:s.otherCollectionDeletedSchema}},transaction:r});const l=i[n];"auto_increment_id"===(null==l?void 0:l.type)&&C.$N({collectionStore:o,update:{[n]:null},transaction:r})}},31869:(e,t,o)=>{o.d(t,{q0:()=>g,kQ:()=>h,n7:()=>f,gy:()=>v,sf:()=>y,qK:()=>b});var i=o(80951),n=o(71644),r=o(50906),a=o(77162),s=o(9953),l=o(29376),c=o(16956),d=o(64434),p=o(96802),u=o(30149);function m(e){const{environment:t,collectionStore:o,collectionPointer:i,property:n,name:r,autoRelate:a,limit:s,targetPropertyID:l,connectedRelation:c,transaction:p}=e,u={type:"relation",name:r,collection_id:i.id,collection_pointer:i,limit:"1"===s?1:void 0,property:l,version:"v2",autoRelate:a,connectedRelation:c};d.xO({environment:t,collectionStore:o,update:{[n]:u},transaction:p})}function g(e){const{environment:t,collectionStore:o,propertySchema:i,targetPropertyID:n,property:r,autoRelate:a,transaction:s}=e;d.xO({environment:t,collectionStore:o,update:{[r]:{...i,autoRelate:a,property:n,version:"v2"}},transaction:s})}function h(e){const{environment:t,collectionStore:o,property:i,transaction:n}=e,r=o.getSchema()[i];r&&"relation"===r.type&&(d.xO({environment:t,collectionStore:o,update:{[i]:null},transaction:n}),d.$N({collectionStore:o,update:{[i]:r},transaction:n}))}function f(e){const{environment:t,collectionContextStore:o,collectionStore:i,property:r,propertyName:s,propertyLimit:d,targetCollectionStore:p,hasInverseRelation:u,inverseName:g,autoRelate:h,intl:f,connectedRelation:v,transaction:y,from:b}=e,S=p.pointer.id===i.id&&Boolean(u)?"separate_property":"same_property",w=l.KV(o,r),k=function(e){const{environment:t,collectionContextStore:o,property:i,limit:r,collectionPointer:a,selfRelationType:s,oneWay:l,autoRelate:c,connectedRelation:d,transaction:p}=e,u=o.collectionStore();if(!u)return;const g=u.getSchema()[i];if(!g)return;const h=a.id===u.id?"same_property"===s?i:(0,n.ZP)():l?void 0:(0,n.ZP)();return m({environment:t,collectionStore:u,collectionPointer:a,property:i,name:g.name,autoRelate:c,limit:r,targetPropertyID:h,connectedRelation:d,transaction:p}),h}({environment:t,collectionContextStore:o,property:r,limit:d,collectionPointer:p.pointer,selfRelationType:S,oneWay:!u,autoRelate:h,connectedRelation:v,transaction:y});if((null==w?void 0:w.name)!==s&&(c.Bv({collectionStore:i,property:r,name:s,transaction:y}),a.$q({environment:t,collectionContextStore:o,property:r,from:"view_settings",action:"rename"})),u&&l.gZ(p)&&k){const e=l.rj({inverseName:g,collectionStore:i,propertySchema:w,intl:f,targetCollectionStore:p,from:b});m({environment:t,collectionStore:p,collectionPointer:i.pointer,property:k,name:e,autoRelate:h,limit:"no_limit",targetPropertyID:r,connectedRelation:v,transaction:y})}}function v(e){const{environment:t,collectionContextStore:o,property:i,hasInverseRelation:r,inverseName:a,autoRelate:s,intl:d,transaction:p}=e,u=l.KV(o,i);if(!u||"relation"!==u.type)return;const f=l.ny(o,u),v=o.collectionStore();if(!v||!f)return;const y=l.rj({inverseName:a,collectionStore:v,propertySchema:u,intl:d,targetCollectionStore:f});if(r&&!l.OP(o,i,f)){const e=(0,n.ZP)();g({environment:t,collectionStore:v,propertySchema:u,property:i,targetPropertyID:e,autoRelate:s,transaction:p}),m({environment:t,collectionStore:f,collectionPointer:v.pointer,property:e,name:y,autoRelate:s,limit:"no_limit",targetPropertyID:i,transaction:p})}else if(r){const e=u.property;if(!e)return;c.Bv({collectionStore:f,property:e,name:y,transaction:p}),s&&(c.bL({collectionStore:v,property:i,autoRelate:s,transaction:p}),c.bL({collectionStore:f,property:e,autoRelate:s,transaction:p}))}else{s&&c.bL({collectionStore:v,property:i,autoRelate:s,transaction:p});const e=u.property;if(!e)return;g({environment:t,collectionStore:v,propertySchema:u,property:i,targetPropertyID:void 0,autoRelate:s,transaction:p}),h({environment:t,collectionStore:f,property:e,transaction:p})}}function y(e){const{propertyStore:t,value:o,environment:n,relatedPageId:r,propertySchema:l,transaction:c,collectionContextStore:d,analyticsData:p,isUnthrottled:u}=e,{analyticsFrom:m,isFromBulkActionsToolbar:g}=p,h=i.ow(o);s.sO({store:t,value:h,transaction:c}),a.rv({environment:n,block_id:r,property:t.id,property_type:l.type,from:m,collectionContextStore:d,isFromBulkActionsToolbar:g,isUnthrottled:u})}function b(e){const{propertyFormat:t,visibility:o,collectionStore:n,property:a,environment:s}=e,c=t.property,d=l.U1({collectionStore:n,property:a}),m=(0,i.pX)(d,c,!o),g={...l.ZI(n)};g[a]||(g[a]={}),g[a].related_properties=m,u.createAndCommit({userAction:"collectionRelationActions.updateRelationPropertyVisibility",environment:s,perform:e=>{p.FH({stores:[n],update:{collection_relation_options:g},transaction:e})}}),r.trackRelationUpdatePropertyVisibility(s,{collection_id:n.id,property_id:a,related_property_id:c,visible:!o})}},5149:(e,t,o)=>{o.d(t,{r$:()=>L,NG:()=>V,tS:()=>N,E3:()=>O,H4:()=>U,FK:()=>H,wl:()=>z,z$:()=>W,qU:()=>j,TT:()=>K,zt:()=>Y,Ol:()=>G,iN:()=>X,R0:()=>q,nr:()=>$});var i=o(77094),n=o.n(i),r=(o(67294),o(1302)),a=o(41432),s=o(67219),l=o(59730),c=o(15157),d=o(29477),p=o(21202),u=o(90468),m=o(29369),g=o(63143),h=o(5366),f=o(95477),v=o(93959),y=o(92918),b=o(84210),S=o(33929),w=o(16402),k=o(7095),C=o(54642),_=o(51127),M=o(43132),T=o(77162),I=o(64434),P=o(47307),x=o(96802),B=o(19785),Z=o(9953),E=o(42858),R=o(74647),A=o(64964),D=o(30149);const F=(0,h.defineMessages)({copySuccessMessage:{defaultMessage:"Link to view copied to clipboard",id:"database.viewSettings.copyLinkSnackBarItem.title"}});function L(e){const{collectionContextStore:t,selectViewNameInitial:o,collectionSettingsStore:i,hideSettingsPopup:n}=e,r="collectionTypedView"!==t.contextType&&!t.collectionStore()?{type:"createViewSource"}:{type:"main",selectViewNameInitial:o};i.set({open:!0,hideSettingsPopup:n,stack:[r]})}function V(e){const{collectionSettingsStore:t}=e;z({collectionSettingsStore:t,item:{type:"createSyncedViewSource"}})}function N(e){const{environment:t,store:o}=e;if(!o.isCollectionView())return;const i=k.Z.get();if(!i)return;R.setUpdateExpand({environment:t,isExpanded:!1,from:"close_for_space"});const{collectionContextStore:n}=i;n.setContext({type:"collectionViewBlock",collectionViewBlockStore:o})}function O(e){const{collectionSettingsStore:t}=e;t.set({...t.get(),open:!1,hideSettingsPopup:void 0,stack:[]})}function U(e){const{collectionSettingsStore:t,item:o,hideSettingsPopup:i}=e,n=t.get();t.set({...n,open:!0,stack:[...n.stack,o],...void 0!==i?{hideSettingsPopup:i}:{}})}function H(e){const{collectionSettingsStore:t,item:o}=e,i=t.get();t.set({open:!0,stack:[...i.stack.slice(0,i.stack.length-1),o]})}function z(e){const{collectionSettingsStore:t,item:o}=e;t.set({open:!0,stack:[o]})}function W(e){const{collectionSettingsStore:t}=e,o=t.get(),i=o.stack.slice(0,o.stack.length-1);0===i.length?O({collectionSettingsStore:t}):t.set({open:!0,stack:i})}function j(e){const{collectionSettingsStore:t,property:o,formatKey:i,selectNameInitial:n,collectionPointer:r}=e,a=t.get(),s=a.stack.findIndex((e=>"property"===e.type));t.set({open:!0,stack:[...s>=0?a.stack.slice(0,s):a.stack,{type:"property",property:o,formatKey:i,selectNameInitial:n,collectionPointer:r}]})}function K(e){const{environment:t,collectionContextStore:o,collectionViewStore:i,collectionSettingsStore:r,from:a}=e,s=(0,d.UZ)();return P.showDialog({showCancel:!0,keepFocus:!1,message:n()(h.FormattedMessage,{defaultMessage:"Are you sure you want to delete this view?",id:"database.viewSettings.mainTab.deleteViewConfirm.text"}),items:[{label:n()(h.FormattedMessage,{defaultMessage:"Delete view",id:"database.viewSettings.deleteButton.text"}),color:"red",onAccept:()=>{const e=o.collectionViewStore(),n=o.collectionViewBlockStore(),l=o.isFullScreen.get(),c=i.getType();e&&n&&c&&(D.createAndCommit({userAction:"collectionSettingsActions.handleDeleteCollectionView",environment:t,perform:s=>{if(I.dp({collectionViewBlockStore:n,collectionViewStore:i,transaction:s}),O({collectionSettingsStore:r}),e.id===i.id){const e=n.getCollectionViewStores()[0];e?I.f8({environment:t,collectionContextStore:o,collectionViewId:e.id,isFullScreen:o.isFullScreen.get(),isRootChild:o.isRootChild.get(),isInPeekRenderer:o.isInPeekRenderer.get()}):(I.ME({environment:t,collectionContextStore:o,transaction:s}),l||E.Cl({environment:t,blocks:[n],transaction:s}))}T.Rc({environment:t,collectionContextStore:o,view_type:c,from:a})}}),s.resolve(!0))}}],handleCancel:()=>s.resolve(!1)}),s.promise}function Y(e){const{environment:t,collectionContextStore:o,collectionViewStore:i,collectionSettingsStore:n,intl:a}=e,s=o.isFullScreen.get(),l=o.isRootChild.get(),c=o.isInPeekRenderer.get(),{performResult:d}=D.createAndCommit({userAction:"collectionSettingsActions.newView",environment:t,perform:e=>I.tG({environment:t,collectionContextStore:o,collectionViewStore:i,collectionSettingsStore:n,intl:a,transaction:e})});d&&(I.f8({environment:t,collectionContextStore:o,collectionViewId:d.id,isFullScreen:s,isRootChild:l,isInPeekRenderer:c}),r.default.afterNextFlush((()=>{L({collectionContextStore:o,collectionSettingsStore:n,selectViewNameInitial:!0})})))}function G(e){const{environment:t,collectionContextStore:o,collectionViewStore:i}=e,n=o.collectionViewBlockStore();if(!i||!n)return;const r=(0,b.ZP)({store:n,collectionViewId:i.id,fullyQualified:!0});M.RD({environment:t,stringValue:r,copiedMessage:M.tq.copiedLinkToClipboard}),A.oV({label:S.default.formatMessage(F.copySuccessMessage)})}function X(e){const{environment:t,collectionContextStore:o}=e,i=o.normalizedFormatStore.state.board_columns_by,n=o.collectionViewStore();if(!i||!n)return;const r=!(0,y.h6)(t,o);D.createAndCommit({userAction:"collectionSettingsActions.handleBoardGroupColorColumnsClick",environment:t,perform:e=>{x.FH({stores:[n],update:{board_columns_by:{...i,disableBoardColorColumns:r}},transaction:e})}}),T.wd({environment:t,collectionContextStore:o,action:"toggle_group_color_columns"})}async function q(e){const{environment:t,uri:o,botId:i,collectionId:r,isStale:a,nextSync:s,setNextSync:d}=e;if(!s||Date.now()>s){var p;let e=Date.now()+g.U6;const s=await C.resubscribeExternalCollection(t,{botId:i,uri:o,isStale:a,collectionId:r});if("failed"===s.type&&(0,l.A6)(s.body)&&"rate_limited"===(null===(p=s.body.clientData)||void 0===p?void 0:p.type)){const t=s.body.clientData.retryAfter;t&&(e=Date.now()+t*g.C0),A.oV({label:n()(h.FormattedMessage,{id:"database.viewSettings.syncedSourceTab.update.rateLimitError",defaultMessage:"This database was synced recently. You may try again in {time}.",description:"This indicates the user has tried to refresh their database too many times.",values:{time:(0,w.hH)(Date.now(),e)}})})}if("local"===f.Z.env||f.Z.isAdminMode)return;c.Z.set({userId:t.currentUser.id,key:`${i}:${o}`,value:e}),d(e)}}function $(e){const{environment:t,selectedDBType:o,collectionName:i,collectionContextStore:n,collectionViewBlockStore:l,collectionViewStore:c,useTemporaryRecordCache:d,temporaryRecordCache:g,baseViewType:h}=e;let f=c,y=l,b=l.getParentStore();var S;d&&(f=c.clone(g),y=l.clone(g),b=null===(S=l.getParentStore())||void 0===S?void 0:S.clone(g));if("custom"===o)T.wd({environment:t,collectionContextStore:n,action:"select_new_collection"}),D.createAndCommit({userAction:"CollectionSettingsNewDBType.handleCreateDB",environment:t,perform:e=>{if(d){Z.sW({store:f,data:{name:void 0,format:void 0,query2:void 0,type:h??"table"},transaction:e}),Z.sW({store:y,data:{properties:void 0},transaction:e});const t=y.getCollectionViewSourceCollectionStore();t&&I.A9({collectionViewBlockStore:y,collectionStore:t,transaction:e})}I.TM({environment:t,collectionViewStore:f,collectionViewBlockStore:y,name:i,transaction:e});const o=y.getCollectionViewSourceCollectionStore();n.setContext({type:"collectionView",collectionViewBlockStore:l,collectionStore:o,collectionViewStore:c})}}),r.default.afterNextFlush((()=>{I.W1({environment:t,collectionContextStore:n})}));else{const e=s.$m[o],i=(0,v.vi)(e);if(!i)return;const r=(0,v.Zu)(i,e);if(!r)return;D.createAndCommit({userAction:"CollectionSettingsNewDBType.handleCreateDB",environment:t,perform:e=>{if(!b||b.table!==u.bx&&b.table!==m.e0&&b.table!==p.iU)return;if(!d&&g){t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(g);y.getCollectionViewStores().forEach((t=>I.dp({collectionViewBlockStore:y,collectionViewStore:t,transaction:e})))}const o=(0,v.KC)(r);_.aT({environment:t,appParentStore:b,appUri:i.uri,features:o,createOrModify:"create",initializeStore:y,transaction:e});const s=y.getCollectionViewSourceCollectionStore();if(s){const o=b.table===u.bx?b.id:b.getSpaceId();if(!o)return;for(let n=0;n<3;n++){const i=Z.j4({environment:t,type:a.Ti.page,inMemoryRecordCache:y.inMemoryRecordCache,transaction:e,spaceId:o});B.zw({childStore:i,parentStore:s,transaction:e})}const i=y.getCollectionViewStores()[0];n.setContext({type:"collectionView",collectionViewBlockStore:l,collectionStore:s,collectionViewStore:i}),n.filtersBarOpen.set(!1)}}})}}},87085:(e,t,o)=>{o.d(t,{G0:()=>x,Rl:()=>B,Jw:()=>Z});var i=o(96486),n=o.n(i),r=o(90559),a=o(99036),s=o(74181),l=o(21202),c=o(9844),d=o(90468),p=o(29369),u=o(5500),m=o(97880),g=o(93959),h=o(78316),f=o(30874),v=o(3815),y=o(54642),b=o(51127),S=o(77162),w=o(74882),k=o(16956),C=o(31869),_=o(5149),M=o(64434),T=o(28673),I=o(96802),P=o(30149);async function x(e){var t;const{environment:o,collectionContextStore:i,feature:n}=e,a=i.collectionStore(),m=null==a?void 0:a.getParentBlockStore(),h=null==m?void 0:m.getParentStore(),k=null==a||null===(t=a.getFormat())||void 0===t?void 0:t.app_config_uri,C=k&&(0,g.vi)(k);if(!a||!m||!h||h.table!==d.bx&&h.table!==l.iU&&h.table!==p.e0||!C)return;const M=a.getSchema(),x=m.getFormat().app_id,B=x?await y.getCollectionViewBlocksByAppId(o,{spaceId:m.getSpaceId(),appId:x}):void 0,Z="success"===(null==B?void 0:B.type)?B.data.result.map((e=>v.G.createChildStore(h,{table:l.iU,id:e.blockId,spaceId:m.getSpaceId()}))):[m],E=n.integrationId;if(E){const e=f.Z.getIntegrationsAsRecordMap().get({table:c.K2,id:E});if(!e||!(0,s.VM)(e))return;await T.V(o,a,e,Boolean(n.canOnlyAdminAuth))}E===u.U9&&M&&0===(0,r.$z)(M).length&&await w.K({environment:o,collectionStore:a}),P.createAndCommit({environment:o,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewSuggestedProperty",perform:e=>{var t;if(!C)return;if(null===(t=a.getFormat())||void 0===t?void 0:t.app_config_uri){if(b.aT({environment:o,appParentStore:h,appUri:C.uri,features:[{type:"simple",featureUri:n.uri}],transaction:e,createOrModify:"modify",appCollectionViewBlockStores:Z}),"dependencies"in n&&n.dependencies.map((e=>e.type)).every((e=>"property"===e))){const t=i.collectionViewStore(),o=i.getPropertyFormatKey(),r=i.normalizedFormatStore.state;if(o&&t){const i=r[o]||[],a=[...i];n.dependencies.forEach((e=>{const t=i.findIndex((t=>t.property===e.uri));-1===t?a.push({visible:!0,property:e.uri}):a[t]={...i[t],visible:!0}})),I.FH({stores:[t],update:{[o]:a},transaction:e})}}if(void 0!==n.propertyIdCollectionSettingToNavigateTo){const e={type:"property",property:n.propertyIdCollectionSettingToNavigateTo,selectNameInitial:!1,formatKey:i.getPropertyFormatKey(),collectionPointer:a.pointer};_.H4({collectionSettingsStore:i.settingsStore,item:e})}else _.E3({collectionSettingsStore:i.settingsStore});S._H({environment:o,collectionContextStore:i,from:"view_settings",property_config_uri:n.uri})}}})}function B(e){const{environment:t,collectionContextStore:o,propertyType:i,propertyName:n,from:r}=e,a=o.collectionStore(),s=o.collectionViewStore(),l=o.getPropertyFormatKey();if(!a||!s||!l)return;if("relation"===i)return void _.H4({collectionSettingsStore:o.settingsStore,item:{type:"selectRelationSource",property:void 0,formatKey:"collection_page_properties",collectionPointer:a.pointer}});const{performResult:c}=P.createAndCommit({userAction:"collectionSettingsCreatePropertyActions.handleCreateNewStandardProperty",environment:t,perform:e=>k.G3({environment:t,collectionStore:a,collectionViewArgs:{collectionViewStore:s,format:s.getFormat(),formatKey:l},propertyName:n,propertyType:i,transaction:e})});_.qU({collectionSettingsStore:o.settingsStore,property:c,formatKey:l,selectNameInitial:!0,collectionPointer:a.pointer}),S._H({environment:t,collectionContextStore:o,from:r,property_type:i})}async function Z(e){const{environment:t,collectionContextStore:o,intl:i,connectedRelationProperty:s}=e,l=o.collectionStore(),c=o.collectionViewStore(),d=o.getPropertyFormatKey();if(!l||!c||!d)return;await T.V(t,l,s.integration,Boolean(s.canOnlyAdminAuth));const p=l.getSchema();let g;s.integration.id===u.U9&&p&&0===(0,r.$z)(p).length&&(g=await w.K({environment:t,collectionStore:l})),P.createAndCommit({environment:t,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewConnectedRelationProperty",perform:e=>{g&&k.G3({environment:t,collectionStore:l,collectionViewArgs:{collectionViewStore:c,format:c.getFormat(),formatKey:d},propertyType:"auto_increment_id",transaction:e});const r=l.getDeletedSchema(),p=(0,m.qP)(r).map((e=>{let[t,o]=e;if(o&&a.NK(o)&&o.connectedRelation.integration_id===u.U9)return{propertyId:t,propertySchema:o}})).filter(m.$K);if(!n().isEmpty(p)){const{propertyId:i}=p[0],n=(0,h.D8)({deletedSchema:r,property:i});if(!n)throw new Error("Deleted property schema was not found");M.xO({environment:t,collectionStore:l,update:n.updateSchema,transaction:e}),M.$N({collectionStore:l,update:n.updateDeletedSchema,transaction:e});const a={type:"property",property:i,formatKey:d,collectionPointer:l.pointer};return void _.H4({collectionSettingsStore:o.settingsStore,item:a})}const f=T.c({environment:t,pattern:s.pattern,integration:s.integration,parentCollectionStore:l,transaction:e}),v=k.G3({environment:t,collectionStore:l,collectionViewArgs:c&&d?{collectionViewStore:c,format:c.getFormat(),formatKey:d}:void 0,propertyType:"relation",transaction:e});C.n7({environment:t,collectionContextStore:o,collectionStore:l,property:v,propertyName:s.name,propertyLimit:"no_limit",targetCollectionStore:f,hasInverseRelation:!0,autoRelate:void 0,intl:i,connectedRelation:{integration_id:s.integration.id},transaction:e});const y={type:"property",property:v,formatKey:d,collectionPointer:l.pointer};_.H4({collectionSettingsStore:o.settingsStore,item:y}),S._H({environment:t,collectionContextStore:o,from:"view_settings",property_type:"relation",integration_id:s.integration.id})}})}},98834:(e,t,o)=>{o.d(t,{nx:()=>_,Zh:()=>M,R5:()=>T,ob:()=>I,$p:()=>P});var i=o(41432),n=o(51060),r=o(42875),a=o(98459),s=o(70203),l=o(5366),c=o(33929),d=o(472),p=o(94896),u=o(3815),m=o(50906),g=o(54642),h=o(47307),f=o(54532),v=o(96802),y=o(94419),b=o(9953),S=o(59389),w=o(98724);const k=(0,l.defineMessages)({duplicateTemplateError:{id:"databaseTemplatePickerActions.duplicateTemplateFailedError.message",defaultMessage:"Duplicate template failed."}});function C(e){const{environment:t,pageStore:o,copiedFromPointer:i,useInMemoryRecordCache:s,addCopyName:l,transaction:d,resolveTemplateVariables:m}=e,v=new u.G(t,i,{inMemoryRecordCache:s});if(s){const e=f.K8(t,{blockId:v.id,inMemoryRecordCache:v.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0});if(!e)throw new Error("Client copy could not be created.");f.E9({environment:t,sourceBlockId:v.id,targetBlockPointer:o.pointer,sourceBlockSubtree:e,targetInMemoryRecordCache:o.inMemoryRecordCache,addCopyName:l,transaction:d,deepCopyTransclusionContainers:!1,resolveTemplateVariables:m})}else{if(b.sW({store:o.getPropertiesStore(),data:v.getProperties(),transaction:d}),m&&w.bt({store:o,context:{currentUserId:t.currentUser.id,currentTimeZone:(0,r.r)()},transaction:d}),l){const e=o.getTitleStore();e&&b.sO({store:e,value:n.eb(e.getValue()),transaction:d})}const e={copied_from:i.id};b.sW({store:o,data:e,transaction:d});const s={...v.getFormat(),copied_from_pointer:i};delete s.automation_id,b.sW({store:o.getFormatStore(),data:s,transaction:d}),v.hasContent()&&(p.Z.setStatus(o.id,!0),d.postSubmitCallbacks.push((async e=>{if(e)return h.showErrorMessage(c.default.formatMessage(k.duplicateTemplateError)),void p.Z.setStatus(o.id,!1);await g.duplicateBlock(t,{sourceBlock:{id:i.id,spaceId:(0,a.CG)(i.spaceId)},targetBlock:{id:o.id,spaceId:(0,a.CG)(o.pointer.spaceId)},addCopyName:l,appendContentOnly:!0,isTemplateInstantiation:!0,resolveTemplateVariables:!!m&&{currentUserId:t.currentUser.id,currentTimeZone:(0,r.r)()},deepCopyTransclusionContainers:!1}).next().finally((()=>{p.Z.setStatus(o.id,!1)}))})))}return o}function _(e){const{environment:t,collectionStore:o,transaction:n,title:r}=e,a=b.j4({environment:t,type:i.Ti.page,inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,spaceId:o.getTemplatePagesStore().pointer.spaceId,properties:{title:(0,s.TP)(r||"")}});return b.sW({store:a,data:{is_template:!0},transaction:n}),y.R3({parent:o.getTemplatePagesStore(),append:a,transaction:n}),a}function M(e){const{environment:t,collectionStore:o,templateStore:n,transaction:r}=e,a=b.j4({environment:t,type:i.Ti.page,inMemoryRecordCache:n.inMemoryRecordCache,transaction:r,spaceId:o.getTemplatePagesStore().pointer.spaceId});b.sW({store:a,data:{is_template:!0},transaction:r}),y.BE({parent:o.getTemplatePagesStore(),after:n,insert:a,transaction:r});try{C({environment:t,copiedFromPointer:n.pointer,pageStore:a,addCopyName:!0,transaction:r,resolveTemplateVariables:!1})}catch(s){h.showErrorMessage(c.default.formatMessage(k.duplicateTemplateError))}return a}function T(e){const{collectionStore:t,templateStore:o,transaction:i}=e;y.Od({parent:t.getTemplatePagesStore(),childToRemove:o,transaction:i})}function I(e){const{environment:t,store:o,templateStore:i,title:n,isKeyboard:r,isCreateIn:a,transaction:s,from:l}=e,c=o.getProperties(),p=d.default.createMetric("rum.initialize_collection_template");if(C({environment:t,pageStore:o,copiedFromPointer:i.pointer,useInMemoryRecordCache:o.inMemoryRecordCache!==t.defaultRecordCache.inMemoryRecordCache?o.inMemoryRecordCache:void 0,transaction:s,resolveTemplateVariables:!0}),"template"!==n){const e="empty"===n?null:n.text;b.sW({store:o.getPropertiesStore(),data:{title:e},transaction:s})}b.sW({store:o.getPropertiesStore(),data:c,transaction:s}),b.sW({store:o,data:{is_template:null},transaction:s}),v.Wq({environment:t,store:o,isLocked:!1,transaction:s}),i.hasContent()||S.eV({environment:t,store:o,transaction:s,preventTextSelection:!0}),d.default.emit(t,p,void 0),m.trackActivateCollectionTemplate(t,{template_id:i.id,collection_id:i.getParentId(),is_keyboard:r,is_create_in:a,from:l})}function P(e){const{collectionStore:t,newTemplateIds:o,transaction:i}=e;b.sW({store:t,data:{template_pages:o},transaction:i})}},54281:(e,t,o)=>{o.d(t,{j2:()=>Z,Nf:()=>E,KA:()=>R,oP:()=>A,Fv:()=>D,f$:()=>F,J4:()=>L,td:()=>V,mz:()=>N,fX:()=>O,$o:()=>U,cQ:()=>H,x:()=>z,k2:()=>W,IL:()=>j,tF:()=>K,_p:()=>Y,mg:()=>G});var i=o(96486),n=o.n(i),r=o(17126),a=o(1302),s=o(80951),l=o(42875),c=o(15157),d=o(89837),p=o(97880),u=o(75079),m=o(65742),g=o(78316),h=o(88632),f=o(27724),v=o(50906),y=o(77162),b=o(7668),S=o(49865),w=o(31869),k=o(5149),C=o(64434),_=o(96802),M=o(9953),T=o(5978),I=o(24677),P=o(21325),x=o(98104),B=o(30149);function Z(e){const{collectionViewStore:t,collectionContextStore:o,timelineState:i,environment:r}=e,a=r.currentUser.id,s=(0,m.B8)(t.id),l=(0,m.pQ)(t,r),d=o.permissionScopes.state,p=n().debounce((()=>{if(i.destroyed)return;const e={zoomLevel:i.zoomLevel.get(),centerTimestamp:(0,m.al)(i)};c.Z.set({userId:a,key:s,value:e})}),1e3),u=n().debounce((()=>{if(i.destroyed||!h.Z.state.online||!r.currentUser.isLoggedIn()||!d.canConfigureBlock)return;const e={zoomLevel:i.zoomLevel.get(),centerTimestamp:(0,m.al)(i)},o=t.getFormat().timeline_preference;n().isEqual(o,e)||B.createAndCommit({userAction:"collectionTimelineViewActions.setRemotePreference",environment:r,perform:o=>{_.FH({stores:[t],update:{timeline_preference:e},transaction:o})}})}),5e3);i.savePreference=()=>{p(),u()},E({timelineState:i,environment:r,...l})}function E(e){const{timelineState:t,zoomLevel:o,centerTimestamp:i,environment:n}=e,{savePreference:r}=t,s=n.WindowSizeStore.state.width+2*m.Ge,l=(0,m.x2)(o,s),c=i-l/2,d=i+l/2;t.zoomLevel.set(o),t.currentRange.set({startTimestamp:c,endTimestamp:d}),a.default.afterNextFlush((()=>{R({timelineState:t,centerTimestamp:i}),r&&r()}))}function R(e){const{timelineState:t,centerTimestamp:o}=e,{horizontalScroller:i,outerSizeObserver:n}=t;if(!i)return;const r=t.zoomLevel.get(),{startTimestamp:a,endTimestamp:s}=t.currentRange.get(),l=n.rect.get().width;if(l===(0,m.e$)(r,s-a))return;const c=(0,m.e$)(r,o-a)-l/2;i.scrollLeft=c,t.scrollLeft.set(c)}function A(e){const{environment:t,store:o,query:i,date:n,schema:r,transaction:a}=e,{timeline_by:s}=i;if(!s)return;const l=(0,m.TW)({store:o,dateValue:n,query:i,schema:r}),c=o.getPropertyValue(s),d=i.timeline_by_end?o.getPropertyValue(i.timeline_by_end):void 0;return M.sW({store:o.getPropertiesStore(),data:l,transaction:a}),b.H({environment:t,store:o,dateProperty:{id:s,newValue:(null==l?void 0:l[s])??[],oldValue:c},endDateProperty:i.timeline_by_end?{id:i.timeline_by_end,newValue:(null==l?void 0:l[i.timeline_by_end])??[],oldValue:d}:void 0}),o}function D(e){const{environment:t,timelineState:o,collectionStore:i,collectionContextStore:n,store:a,query:s,groupFormat:c,transaction:p}=e,u=o.zoomLevel.get(),g=(0,m.al)(o),{snapUnit:h,getDateRangePlaceholderDuration:f}=m.BJ[u],{timeline_by:v}=s;if(!v)return;const y=n.groupsStore.getGroupState(c);if(!y)return;const b=r.ou.fromMillis(g),w=(0,m.DS)(b,h),k=(0,m.DS)(f(b),h),C=(0,m.AZ)({startValue:(0,d.Lg)((0,l.r)()),snapUnit:h,desiredStart:w,desiredEnd:k});return A({environment:t,store:a,query:s,schema:i.getSchema(),date:C,transaction:p}),S.$T({environment:t,collectionStore:i,before:!0,store:y.resultsStore.state[0],insertStores:[a],collectionContextStore:n,groupsPointer:c?[c]:[],results:y.resultsStore.state,transaction:p}),a}function F(e){const{type:t,timelineState:o,store:i,startX:r,query:a,schema:s,intl:l,environment:c}=e,{horizontalScroller:d}=o,{startTimestamp:p}=o.currentRange.get();if(!d)return;I.Ys({environment:c,store:i});const u=d.scrollLeft,{stores:g}=f.default.state,h=n().compact(g.map((e=>{const t=(0,m.bk)({store:e,query:a,schema:s,intl:l});if(t)return{startValue:t,store:e}})));o.dragState.set({type:t,startStore:i,stores:h.map((e=>{let{store:t}=e;return t})),startValues:h.map((e=>{let{startValue:t}=e;return t})),temporaryValues:h.map((e=>{let{startValue:t}=e;return t})),startX:r,startStartTimestamp:p,startScrollLeft:u})}function L(e){const{timelineState:t,store:o,startX:i,startY:n,schema:r,collectionContextStore:a,verticalScroller:s}=e,{horizontalScroller:l}=t,{startTimestamp:c}=t.currentRange.get();if(!l||!s)return;const d=l.scrollLeft,p=s.scrollTop,u=(0,m.YE)(a,o,r);t.drawState.set({startStore:o,startDependencyRelationPointers:u,temporaryDependencyRelationPointers:[...u],startX:i,startY:n,startScrollLeft:d,startScrollTop:p,startStartTimestamp:c,xOffsetPx:0,yOffsetPx:0,tryToCompleteDrawnArrow:!1})}function V(e){const{timelineState:t,currentX:o}=e,{horizontalScroller:i}=t,r=t.zoomLevel.get(),a=t.dragState.get(),{startTimestamp:s}=t.currentRange.get();if(!a||!i)return;const{type:l,startStartTimestamp:c,startValues:u,startScrollLeft:g,startX:h,startStore:f,stores:v}=a,y=m.BJ[r],{snapUnit:b}=y,S=i.scrollLeft-g+(o-h)+(0,m.e$)(r,s-c),w=(0,m.x2)(r,S),k=u[v.indexOf(f)];let C;if(l===m.px.LeftResizer){const{start:e}=(0,m.XO)(k,b),t=e.plus(w);C=u.map((e=>{const o=(0,m.AZ)({startValue:e,snapUnit:b,desiredStart:t});return(0,d.gW)(o)}))}else if(l===m.px.RightResizer){const{end:e}=(0,m.XO)(k,b),t=e.plus(w);C=u.map((e=>{const o=(0,m.AZ)({startValue:e,snapUnit:b,desiredEnd:t});return(0,d.Qq)(o)}))}else l===m.px.ItemDrag?C=u.map((e=>{const{start:t,end:o}=(0,m.XO)(e,b),i=t.plus(w),n=i.plus(o.valueOf()-t.valueOf());return(0,m.AZ)({startValue:e,snapUnit:b,desiredStart:i,desiredEnd:n})})):(0,p.t1)(l);n().isEqual(a.temporaryValues,C)||t.dragState.set({...a,temporaryValues:C})}function N(e){const{timelineState:t,currentX:o,currentY:i,verticalScroller:r}=e,a=t.drawState.get(),s=t.zoomLevel.get(),{startTimestamp:l}=t.currentRange.get(),{horizontalScroller:c}=t;if(!a||!c||!r)return;const{startDependencyRelationPointers:d,startStore:p,startX:u,startY:g,startScrollLeft:h,startScrollTop:f,startStartTimestamp:v}=a,y=c.scrollLeft,b=r.scrollTop,S=y-h+(o-u)+(0,m.e$)(s,l-v),w=b-f+(i-g),k=t.hoveredItem.get();if(k&&k!==p&&!d.some((e=>e.id===k.id))){const e=[...d,{table:"block",id:k.id,spaceId:k.getSpaceId()}];n().isEqual(a.temporaryDependencyRelationPointers,e)||t.drawState.set({...a,temporaryDependencyRelationPointers:e,xOffsetPx:void 0,yOffsetPx:void 0})}else t.drawState.set({...a,temporaryDependencyRelationPointers:[...d],xOffsetPx:S,yOffsetPx:w})}function O(e){const{environment:t,timelineState:o,query:i,schema:n,transaction:r}=e,a=o.dragState.get(),{timeline_by:s}=i;if(!a||!s)return;const{temporaryValues:l,stores:c}=a;l.forEach(((e,o)=>{const a=c[o];A({environment:t,store:a,query:i,schema:n,transaction:r,date:e})})),o.dragState.set(void 0)}function U(e){const{timelineState:t,environment:o,transaction:i,collectionContextStore:n,isFullScreen:r,isRootChild:a}=e,l=t.drawState.get(),c=t.dateRangePlaceholder.get();if(!l)return;const{startStore:d,temporaryDependencyRelationPointers:p,startDependencyRelationPointers:g}=l;if(!d)return void t.drawState.set(void 0);if(c.active){const{date:e,store:r,parentStore:a,groupFormat:s,newTimelineItemProps:l,existingTimelineItemProps:u}=c;if(r&&u){const{query:t,schema:n}=u;A({environment:o,store:r,query:t,schema:n,date:e,transaction:i}),p.push({table:"block",id:r.id,spaceId:d.getSpaceId()})}else if(l){const{query:t,schema:c,resultsStore:u,isFullScreen:m,canEditTimelineItems:g,subitemPath:h}=l,f=G({environment:o,date:e,store:r,parentStore:a,query:t,schema:c,resultsStore:u,isFullScreen:m,groupFormat:s,canEditTimelineItems:g,collectionContextStore:n,subitemPath:h,transaction:i,from:"timeline_complete_draw"});f&&p.push({table:"block",id:f.id,spaceId:d.getSpaceId()})}t.dateRangePlaceholder.set({active:!1})}const h=(0,m.H5)(n);h?(M.sO({store:d.getPropertyStore(h),value:(0,s.ow)(p),transaction:i}),y.rv({environment:o,collectionContextStore:n,block_id:d.id,property:h,property_type:"relation",from:"timeline",isFromBulkActionsToolbar:!1,isUnthrottled:!0}),t.drawState.set(void 0)):(k.wl({item:{type:"arrowsBy"},collectionSettingsStore:n.settingsStore}),t.drawState.set({...l,tryToCompleteDrawnArrow:!0}));const f=p.filter((e=>!g.includes(e))),b=1===f.length?f[0].id:void 0;b&&v.trackTimelineDependencyArrowDrawn(o,{...(0,u.Pn)(n),...(0,m.Ii)({environment:o,collectionContextStore:n,timelineState:t,isFullScreen:r,isRootChild:a}),dependenciesPropertyID:h,blockedByStoreID:d.id,blockingStoreID:b})}function H(e){const{timelineState:t,environment:o}=e;t.dragState.get()&&(t.dragState.set(void 0),I.ZH(o))}function z(e){const{timelineState:t,environment:o}=e;t.drawState.get()&&(t.drawState.set(void 0),I.ZH(o))}function W(e){const{stores:t,collectionViewStore:o,schema:i,transaction:n}=e,r=o.getType(),a=o.getQuery(i),s=[];a&&("calendar"===r?a.calendar_by&&s.push(a.calendar_by):"timeline"===r&&(a.timeline_by&&s.push(a.timeline_by),a.timeline_by_end&&s.push(a.timeline_by_end)));for(const l of t)for(const e of s)M.sO({store:l.getPropertyStore(e),value:void 0,transaction:n})}function j(e){const{dependency:t,collectionContextStore:o,environment:i,timelineState:n,isFullScreen:r,isRootChild:a}=e,s=(0,m.H5)(o),l=o.collectionStore();if(!s||!l)return;const{store:c,relationPointer:d}=t,p=c.getSchema(),g=p[s];if(!g||"relation"!==g.type)return;const h=(0,m.YE)(o,c,p).filter((e=>e.id!==d.id)),f=c.getPropertyStore(s);B.createAndCommit({userAction:"CollectionTimelineDependenciesOverlay.handleRemoveRelation",environment:i,perform:e=>{w.sf({store:c,propertyStore:f,value:h,environment:i,relatedPageId:d.id,propertySchema:g,transaction:e,collectionContextStore:o,analyticsData:{analyticsFrom:"timeline",isFromBulkActionsToolbar:!1},isUnthrottled:!0})}}),v.trackTimelineDependencyArrowDeleted(i,{...(0,u.Pn)(o),...(0,m.Ii)({environment:i,collectionContextStore:o,timelineState:n,isFullScreen:r,isRootChild:a}),dependenciesPropertyID:s,blockedByStoreID:c.id,blockingStoreID:d.id})}function K(e){const{collectionViewStore:t,newProperty:o,transaction:i}=e;_.FH({stores:[t],update:{timeline_arrows_by:{property:o}},transaction:i})}function Y(e){const{collectionContextStore:t,relationPropertyId:o,transaction:i}=e,n=t.collectionStore();n&&_.FH({stores:[n],update:{collection_default_arrows_by:o},transaction:i})}function G(e){const{environment:t,transaction:o,date:i,parentStore:n,query:r,schema:a,resultsStore:s,isFullScreen:l,groupFormat:c,canEditTimelineItems:d,collectionContextStore:p,from:u}=e;if(!P.M_(t))return;const m=c?[c]:[],h=p.groupsStore.getGroupState(m);if(!h)return;if(n)return function(e){const{environment:t,transaction:o,date:i,store:n,parentStore:r,query:a,schema:s,resultsStore:l,groupFormat:c,canEditTimelineItems:d,collectionContextStore:p,subitemPath:u}=e;if(!n||!r)return;const m=c?[c]:[];if(!p.groupsStore.getGroupState(m))return;const g=S.yk({environment:t,collectionContextStore:p,groupsPointer:m,results:l.state,store:n,before:!1,collectionStore:r,transaction:o,subitemPath:u,subitemInsertDirection:"into"});if(g)if(A({environment:t,store:g,query:a,schema:s,date:i,transaction:o}),t.device.isMobile)T.navigateToBlock({environment:t,store:g});else if(g&&d){const e=g.getBlockTitleStore();x.N_({store:e})}}(e);p.searchQuery.get()&&C.Ug({searchQuery:"",collectionContextStore:p,isFullScreen:l});const f=s.state,{coercionSucceeded:v,newStore:y}=S.IW({environment:t,collectionContextStore:p,groupsPointer:m,results:f,insertAtIndex:f.length,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:u});if(A({environment:t,store:y,query:r,schema:a,date:i,transaction:o}),t.device.isMobile)T.navigateToBlock({environment:t,store:y});else if(v&&d){const e=y.getBlockTitleStore();x.N_({store:e})}else T.peekBlock({environment:t,store:y,peekMode:(0,g.kr)(p.collectionViewStore()),resultsStore:null==h?void 0:h.resultsStore,collectionContextStore:p});return y}},64434:(e,t,o)=>{o.d(t,{zz:()=>Qe,TM:()=>Je,w:()=>Fe,wG:()=>pt,MO:()=>mt,pi:()=>at,ME:()=>Ne,Ki:()=>ht,HW:()=>tt,dp:()=>Oe,ob:()=>Re,IH:()=>gt,tG:()=>Ve,dj:()=>nt,oh:()=>st,C_:()=>ot,mS:()=>it,A9:()=>et,Wu:()=>Ue,mc:()=>Ee,Ip:()=>Xe,n1:()=>qe,W1:()=>dt,f8:()=>ct,t5:()=>Ae,Z5:()=>ut,Rm:()=>We,$N:()=>Ke,$D:()=>lt,xO:()=>je,iG:()=>He,Uy:()=>Ge,Es:()=>ze,yc:()=>$e,z2:()=>Ye,Ug:()=>De});var i=o(96486),n=o.n(i),r=o(17126),a=o(1302),s=o(41432),l=o(14248),c=o(76205),d=o(14714),p=o(99036),u=o(22433),m=o(10070),g=o(67219),h=o(93824),f=o(51060),v=o(65917),y=o(42875),b=o(74229),S=o(15157),w=o(89837),k=o(77897),C=o(59753),_=o(29477),M=o(4615),T=o(71644),I=o(74446),P=o(45953),x=o(98459),B=o(98963),Z=o(18844),E=o(21202),R=o(6287),A=o(13493),D=o(70203),F=o(63143),L=o(5366),V=o(28020),N=o(42),O=o(97004),U=o(92918),H=o(52821),z=o(78316),W=o(77181);const j=new class{constructor(){this.cache=new Map}get(e){return this.cache.get(e)}set(e,t){for(this.cache.delete(e),this.cache.set(e,t);this.cache.size>25;){const e=this.cache.keys().next().value;this.cache.delete(e)}}};var K=o(33929),Y=o(59488),G=o(45950),X=o(33665),q=o(77546),$=o(472),J=o(15517),Q=o(58202),ee=o(79315),te=o(17746),oe=o(4787),ie=o(6776),ne=o(19511),re=o(88632),ae=o(79167),se=o(37598),le=o(39218),ce=o(3815),de=o(84799),pe=o(27724),ue=o(54642),me=o(82993),ge=o(49865),he=o(5149),fe=o(41433),ve=o(47307),ye=o(96802),be=o(94419),Se=o(92625),we=o(19785),ke=o(9953),Ce=o(4408),_e=o(5978),Me=o(50125),Te=o(98104),Ie=o(30149),Pe=o(761),xe=o(53471);const Be=(0,L.defineMessages)({importingCSV:{id:"databaseViewActions.importingCSV.loadingMessage",defaultMessage:"Importing"},uploadingCSV:{id:"databaseViewActions.uploadingCSV.loadingMessage",defaultMessage:"Uploading"},importFailed:{id:"databaseViewActions.importFailedError.message",defaultMessage:"Import failed."}}),Ze=(0,L.defineMessages)({renameButtonTitle:{defaultMessage:"Rename",id:"database.collectionEditViewButtonPopup.renameButtonTitle"},statusName:{defaultMessage:"Status",id:"database.collectionEditViewButtonPopup.statusNameProperty"},dateName:{defaultMessage:"Date",id:"database.collectionEditViewButtonPopup.dateNameProperty"}});function Ee(e){const{environment:t,collectionViewBlockStore:o,collectionViewStore:i,collectionStore:s,collectionContextStore:l,isFullScreen:c,isRootChild:d,isInPeekRenderer:p}=e;Re({collectionContextStore:l}),c&&(_e.resetPageState(t),_e.resetEditorState(t));const{remoteRequestStore:m,localResultStore:g}=l;if(i){var h;const e=r.ou.fromMillis(te.Z.getLocalDateRangeStart({collectionViewId:i.id,currentUserId:t.currentUser.id}));let v;const y=()=>{a.default.afterNextFlush((()=>{var e;const o=m.state,i=v&&"reducer"===v.loader.type&&v.loader.reducers||{},r=o&&"reducer"===o.loader.type&&o.loader.reducers||{},a=Object.keys(r).find((e=>{const t=i[e],o=r[e];return o&&(!t||!n().isEqual(t,o))})),s={...null===(e=v)||void 0===e?void 0:e.loader,reducers:void 0},c={...null==o?void 0:o.loader,reducers:void 0};!a&&n().isEqual(s,c)||nt(t,l,{src:"reset"}),v=o}))};m.addListener(y);const b=()=>{if((0,k.lB)(1)){const e=$.default.createMetric("database_update_lag");a.default.afterNextFlush((()=>{$.default.emit(t,e,void 0)}))}};g.addListener(b),l.remoteResult.set(void 0),l.searchQuery.set(""),l.searchOpen.set(!1),l.calendarByMenuOpen.set(!1),l.timelineByMenuOpen.set(!1),l.isFullScreen.set(c),l.isRootChild.set(d),l.reducers.set({}),l.groupsStore.reset(),l.groupsLimit.set(U.XD),l.boardColumnsLimit.set(U.XD),l.filtersBarOpen.set(void 0),l.isInPeekRenderer.set(p),l.subitemExpandedStore.set(new Map),l.dateRangeStart.set((0,w.IS)(e.startOf("month").valueOf(),V.AK.state).valueOf()),l.dateRangeEnd.set(c&&!t.device.isMobile?(0,w.V7)(e.endOf("month").plus({month:1}).valueOf(),V.AK.state).valueOf():(0,w.V7)(e.endOf("month").valueOf(),V.AK.state).valueOf());const S=null==i?void 0:i.getFormat();var f;if("typed"===(null==S||null===(h=S.collection_view_source)||void 0===h?void 0:h.type))l.setContext({type:"collectionTypedView",collectionViewBlockStore:o,databaseType:null==S||null===(f=S.collection_view_source)||void 0===f?void 0:f.databaseType,collectionViewStore:i});else l.setContext({type:"collectionView",collectionViewBlockStore:o,collectionStore:s,collectionViewStore:i});l.remoteRequestStoreCallback=y,l.localResultStoreCallback=b;const C=j.get(i.id);if(C){const e={type:"reducer",reducerResults:C},t=new Set(u.aW({result:e,onlyTypes:["results"]}));l.isLoading.set(!1),l.resultSet.set(t),l.remoteResult.set(e)}const _=le.transactionQueue.isPendingTransactionForRecord(i.pointer);l.wasCreatedThisSession.set(_);const M=t.currentUser.id,T=(0,J.Qd)({currentUserId:M,collectionViewId:i.id});l.temporaryState.set(T||{});const{currentSpaceStore:I}=ee.default.state;if(s&&I&&s.isDefaultRecordCache()){const e=t.currentUser.id;(0,J.fs)({currentUserId:e,spaceId:I.id,collectionId:s.id})}c&&(s&&o.getCollectionViewSourceCollectionStore()&&!s.getName()&&(!t.device.isMobile||X.NW(t)||(0,Y.Y)("supportsUntitledPageAutoSelectOnStart"))?dt({environment:t,collectionContextStore:l}):s||"collectionTypedView"===l.contextType||he.r$({collectionContextStore:l,collectionSettingsStore:l.settingsStore}))}}function Re(e){const{collectionContextStore:t}=e,{localResultStore:o,remoteRequestStore:i,remoteRequestStoreCallback:n,localResultStoreCallback:r}=t;n&&i.removeListener(n),r&&o.removeListener(r)}function Ae(e){const{dateRangeStart:t,dateRangeEnd:o,collectionContextStore:i}=e;i.dateRangeStart.set(t),i.dateRangeEnd.set(o)}function De(e){const{searchQuery:t,collectionContextStore:o}=e;o.collectionViewStore()&&(o.searchQuery.set(t||""),o.groupsStore.resetAllLimits())}function Fe(e){const{collectionContextStore:t,blockId:o}=e,i=t.resultSet.get();i.has(o)||(i.add(o),t.resultSet.emit())}function Le(e){const{environment:t,collectionViewBlockStore:o,collectionView:i,transaction:n}=e,r=ke.ae({environment:t,table:A.n,value:i,inMemoryRecordCache:o.inMemoryRecordCache,transaction:n}),a=ce.Xr.createChildStore(o,{table:A.n,id:r.id,spaceId:o.getSpaceId()});return be.R3({parent:o.getCollectionViewsStore(),append:a,transaction:n}),a}function Ve(e){const{environment:t,collectionContextStore:o,collectionViewStore:i,intl:n,transaction:r}=e,a=o.collectionViewBlockStore();if(!a)return;const s=i.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:t}=e;return t(i)}));if(!s)return;return Le({environment:t,collectionViewBlockStore:a,collectionView:{...s,id:(0,M.ZP)(),name:(0,f.nM)(s.name||n.formatMessage(z.b1[s.type]))},transaction:r})}function Ne(e){var t,o,i,n,r;const{environment:s,collectionContextStore:l,transaction:c}=e,d=l.collectionViewBlockStore(),p=l.collectionViewStore(),u=l.settingsStore;if(!d)return;const m=null===(t=l.collectionStore())||void 0===t||null===(o=t.getFormat())||void 0===o?void 0:o.collection_default_subitem,g=null===(i=l.collectionStore())||void 0===i||null===(n=i.getFormat())||void 0===n?void 0:n.collection_default_arrows_by,h=Le({environment:s,collectionViewBlockStore:d,collectionView:{type:"table",parent_id:d.id,parent_table:E.iU,alive:!0,space_id:d.getSpaceId(),format:{table_properties:null==p||null===(r=p.getFormat())||void 0===r?void 0:r.table_properties,collection_view_subitem:m?{property:m}:void 0,timeline_arrows_by:g?{property:g}:void 0,...p&&"collectionTypedView"===l.contextType?{collection_view_source:p.getFormat().collection_view_source,property_filters:p.getFormat().property_filters}:{}}},transaction:c});ct({environment:s,collectionContextStore:l,collectionViewId:h.id,isFullScreen:l.isFullScreen.get(),isRootChild:l.isRootChild.get(),isInPeekRenderer:l.isInPeekRenderer.get()}),a.default.afterNextFlush((()=>{d.getCollectionViewSourceCollectionStore()?(he.r$({collectionContextStore:l,collectionSettingsStore:u}),he.wl({collectionSettingsStore:u,item:{type:"createView"}})):he.r$({collectionContextStore:l,collectionSettingsStore:u})}))}function Oe(e){const{collectionViewBlockStore:t,collectionViewStore:o,transaction:i}=e,n=ce.Xr.createChildStore(t,{table:A.n,id:o.id,spaceId:t.getSpaceId()}),r=o.getFormat().app_config_uri;if(r){const e=t.getFormat().app_uri_map;e&&delete e[r],ye.FH({stores:[t],update:{app_uri_map:e},transaction:i})}be.Od({parent:t.getCollectionViewsStore(),childToRemove:n,transaction:i})}function Ue(e){const{collectionViewBlockStore:t,newViewIds:o,transaction:i}=e,r=t.getCollectionViewStores(),{beforeOps:a}=(0,h.q)(r.map((e=>e.id)).slice(0,o.length),o);n().forEach(a,((e,r)=>{const a=ce.Xr.createChildStore(t,{table:A.n,id:r,spaceId:t.getSpaceId()});if(e)be.Vt({parent:t.getCollectionViewsStore(),insert:a,before:ce.Xr.createChildStore(t,{table:A.n,id:e,spaceId:t.getSpaceId()}),transaction:i});else{const e=n().last(o.filter((e=>e!==r)));be.BE({parent:t.getCollectionViewsStore(),insert:a,after:e?ce.Xr.createChildStore(t,{table:A.n,id:e,spaceId:t.getSpaceId()}):void 0,transaction:i})}}))}function He(e){const{collectionViewStore:t,update:o,transaction:i}=e;ke.sW({store:t,data:o,transaction:i})}function ze(e){const{collectionViewStore:t,update:o,transaction:i}=e;ke.sW({store:t.getQueryStore(),data:o,transaction:i})}function We(e){const{environment:t,collectionStore:o,update:i,transaction:n}=e,r=o.getSchema();i.schema&&(i.schema=p.Fn(i.schema)),i.deleted_schema&&(i.deleted_schema=p.Fn(i.deleted_schema));const a={...i};if(i.deleted_schema){const e=o.getDeletedSchema(),t=(0,m.jf)({schemas:[e,i.deleted_schema]});t.error?v.log({level:"error",from:"collectionViewActions",type:"updateCollection",error:t.error}):a.deleted_schema=t.value}ke.sW({store:o,data:a,transaction:n}),i.schema&&ot({environment:t,collectionStore:o,oldSchema:r,newSchema:i.schema,transaction:n})}function je(e){const{environment:t,collectionStore:o,update:i,transaction:n}=e,r=o.getSchema(),a=p.Fn(i);ke.sW({store:o.getSchemaStore(),data:a,transaction:n}),ot({environment:t,collectionStore:o,oldSchema:r,newSchema:o.getSchema(),transaction:n})}function Ke(e){const{collectionStore:t,update:o,transaction:i}=e;ke.sW({store:(0,ce._J)(t,t.pointer,["deleted_schema"]),data:o,transaction:i})}function Ye(e){const{environment:t,collectionContextStore:o,newViewType:i,transaction:n,intl:r}=e,a=o.collectionViewStore(),s=o.collectionViewBlockStore(),l=o.collectionStore();if(!a||!s)return;const c=o.normalizedSchemaStore.state;if(i===a.getType())return;const p=o.permissionScopes.state;if(ke.sW({store:a,data:{type:i},transaction:n}),"table"===i)ke.sW({store:a.getQueryStore(),data:{aggregations:[{property:"title",aggregator:"count"}]},transaction:n});else if("board"===i){let e=z.Se(c);if(l&&!e){e=(0,T.ZP)();const o={name:r.formatMessage(Ze.statusName),type:"select",options:[]};p.canConfigureCollection&&je({environment:t,collectionStore:l,update:{[e]:o},transaction:n})}const i=o.normalizedSchemaStore.state,s=e&&i[e];if(!e||!s||!(0,d.LG)(s))return;ye.FH({stores:[a],update:{board_columns_by:(0,d.fw)(e,s)},transaction:n})}else if("calendar"===i){let e=z.PD(c);if(l&&!e){e=(0,T.ZP)();const o={name:r.formatMessage(Ze.dateName),type:"date"};p.canConfigureCollection&&je({environment:t,collectionStore:l,update:{[e]:o},transaction:n})}ke.sW({store:a.getQueryStore(),data:{aggregations:[],calendar_by:e},transaction:n})}else if("gallery"===i)ye.FH({stores:[a],update:{gallery_cover:{type:"page_content"}},transaction:n}),ke.sW({store:a.getQueryStore(),data:{aggregations:[]},transaction:n});else if("list"===i){const e=Object.keys(c).find((e=>{const t=c[e];return Boolean(t&&(0,H.Rb)(t))}));ye.FH({stores:[a],update:{list_properties:e?[{property:e,visible:!0}]:[]},transaction:n}),ke.sW({store:a.getQueryStore(),data:{aggregations:[]},transaction:n})}else if("timeline"===i){let e=z.HI(c);if(l&&!e){e=(0,T.ZP)();const o={name:r.formatMessage(Ze.dateName),type:"date"};p.canConfigureCollection&&je({environment:t,collectionStore:l,update:{[e]:o},transaction:n})}ke.sW({store:a.getQueryStore(),data:{aggregations:[{property:"title",aggregator:"count"}],timeline_by:e},transaction:n})}Xe({collectionContextStore:o})}function Ge(e){const{icon:t,collectionViewBlockStore:o,transaction:i}=e;ye.FH({stores:[o],update:{collection_view_icon:t},transaction:i})}function Xe(e){const{collectionContextStore:t}=e,o=t.collectionViewBlockStore();if(!o)return;const i=Q.R.findCollectionViewBlockFromStore(o);null!=i&&i.resetLeftScrollAfterFlush&&i.resetLeftScrollAfterFlush()}function qe(e){const{collectionContextStore:t}=e,o=t.collectionViewBlockStore();if(o){const e=Q.R.findCollectionViewBlockFromStore(o);if(e){const t=e.getNode();t&&(0,q.Wr)(t,{edgeDist:0,animate:!1})}}}function $e(e){var t,o,i,n;const{collectionContextStore:r,collectionStore:a,transaction:s}=e,l=r.collectionViewStore();if(!l||!a.isDefined())return;const c=z.Vv(a),d=null===(t=a.getFormat())||void 0===t?void 0:t.collection_default_subitem,p=null===(o=a.getFormat())||void 0===o?void 0:o.collection_default_arrows_by,u={table_properties:null==c||null===(i=c.getFormat())||void 0===i?void 0:i.table_properties,collection_pointer:{table:R.v,id:a.id,spaceId:a.getSpaceId()},collection_view_subitem:d?{property:d}:void 0,timeline_arrows_by:p?{property:p}:void 0},m=null==r?void 0:r.normalizedSchemaStore.state;ke.sW({store:l,data:(0,F.Q2)({format:u,query2:{sort:null==c||null===(n=c.getQuery(m))||void 0===n?void 0:n.sort}}),transaction:s})}function Je(e){var t;const{environment:o,name:i,collectionViewStore:n,collectionViewBlockStore:r,transaction:a}=e,l=n.getType();if(!l||!r.isDefined())return;const c=r.getCollectionPointer(),d=r.getFormat(),p=(0,D.Q)(null===(t=r.getTitleStore())||void 0===t?void 0:t.getValue()),u=c||i||!p?i:p,m=(0,N.Yu)({environment:o,isInline:r.getType()===s.Ti.collectionView,name:u,viewType:l}),g=P.Ak.create();g.set({table:A.n,id:"view"},n.pointer),fe.ZI({environment:o,sourceBlockId:"root",targetBlockPointer:r.pointer,sourceBlockSubtree:m,targetRecordCache:r.inMemoryRecordCache,transaction:a,recordPointerMap:g,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0});const h=g.get({table:R.v,id:"collection"});if(!h)return;ye.FH({stores:[r],update:{collection_pointer:h},transaction:a});const f=r.getCollectionStore();f&&(We({collectionStore:f,update:{icon:null==d?void 0:d.page_icon,cover:null==d?void 0:d.page_cover},environment:o,transaction:a}),ye.FH({stores:[f],update:{collection_cover_position:null==d?void 0:d.page_cover_position},transaction:a}))}function Qe(e){const{collectionViewBlockStore:t,collectionStore:o,transaction:i}=e;if(!t.isDefined()||!o.isDefined())return;if(t.getCollectionPointer())throw new Error("CollectionViewBlock already has a collection");ye.FH({stores:[t],update:{collection_pointer:o.pointer},transaction:i})}function et(e){const{collectionViewBlockStore:t,collectionStore:o,transaction:i}=e;if(!t.isDefined()||!o.isDefined())return;[t].forEach((e=>{var t;e.getCollectionViewStores().filter((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.id})).forEach((t=>Oe({collectionViewBlockStore:e,collectionViewStore:t,transaction:i}))),(null===(t=e.getFormat().collection_pointer)||void 0===t?void 0:t.id)===o.id&&ke.sW({store:e,data:{format:{...e.getFormat(),collection_pointer:void 0},collection_id:null},transaction:i})})),we.hh({childStore:o,transaction:i})}function tt(e){const{environment:t,collectionStore:o,performTransaction:i}=e;return Ie.createAndCommit({userAction:"collectionViewActions.createSchemaUpdateTransaction",environment:t,perform:e=>{const n=o.getSchema(),r=i(e),a=o.getSchema();return ot({environment:t,collectionStore:o,oldSchema:n,newSchema:a,transaction:e}),r}}).performResult}function ot(e){const{environment:t,collectionStore:o,oldSchema:i,newSchema:r,transaction:a}=e,s=p.Fn(i),c=p.Fn(r),d=Object.keys(c);for(const n of d){const e=s[n],i=c[n];if(i){if("status"===i.type&&"status"!==(null==e?void 0:e.type)){let r;r="select"===(null==e?void 0:e.type)||"multi_select"===(null==e?void 0:e.type)?(0,l.r9)(i.name,e.options??[]):i.groups&&i.options&&i.defaultOption?i:p.I4(i.name);const s={...c,[n]:r};if(ke.sW({store:o,data:{schema:s},transaction:a}),"checkbox"===(null==e?void 0:e.type)&&"status"===i.type){const e=r.groups??[],i=e[e.length-1];i&&ge.hz({environment:t,collectionStore:o,property:n,oldValue:{type:"checkbox",value:!0},newValue:{type:"status",value:{type:"by_group",group:i.name}},transaction:a})}}if("status"===(null==e?void 0:e.type)&&"checkbox"===i.type){const i=e.groups??[],r=e.options??[],s=i[i.length-1],l=r.filter((e=>{var t;return null==s||null===(t=s.optionIds)||void 0===t?void 0:t.includes(e.id)}));for(const e of l)ge.hz({environment:t,collectionStore:o,property:n,newValue:{type:"checkbox",value:!0},oldValue:{type:"status",value:{type:"by_option",option:e.value}},transaction:a})}}}for(const l of d){const e=s[l],i=c[l];!i||e&&p.cu(e)||!p.cu(i)||ue.getSelectPropertyValues(t,{collection:{id:o.id,spaceId:(0,x.CG)(o.pointer.spaceId)},property:l}).then((e=>{if("failed"===e.type)throw e.error;const{results:r}=e.data,a=i.options||[],s=p.Fn(o.getSchema()),c=n().uniqBy([...a,...r.map((e=>({id:(0,T.ZP)(),value:e})))],(e=>e.value)),d={...i,options:c},u={...s,[l]:d};Ie.createAndCommit({userAction:"collectionViewActions.handleCollectionSchemaUpdated",environment:t,perform:e=>{ke.sW({store:o,data:{schema:u},transaction:e})}})}))}const u=n().uniq([...Object.keys(s),...Object.keys(c)]);for(const l of u){const e=s[l],i=c[l],r=e&&p.cu(e)||"status"===(null==e?void 0:e.type),d=i&&p.cu(i)||"status"===(null==i?void 0:i.type);if(r&&d&&e.type===i.type){const r=i,s=e.options||[],c=r.options||[],d=n().uniq([...s.map((e=>e.id)),...c.map((e=>e.id))]);for(const n of d){const r=s.find((e=>e.id===n)),d=c.find((e=>e.id===n));if(r&&d&&r.value!==d.value){const n="status"===e.type?{type:"status",value:{type:"by_option",option:r.value}}:{type:e.type,value:r.value},s="status"===i.type?{type:"status",value:{type:"by_option",option:d.value}}:{type:i.type,value:d.value};ge.hz({environment:t,collectionStore:o,property:l,oldValue:n,newValue:s,transaction:a})}}}}for(const n of u){const e=c[n];"button"!==(null==e?void 0:e.type)||e.automation_id||me.Hj({environment:t,collectionStore:o,property:n,transaction:a})}}function it(e){const{store:t,environment:o}=e;let i;xe.cR({environment:o,bucket:"temporary",onStart:e=>{i=e,Se.j({message:Be.uploadingCSV})},onComplete:e=>{(async(e,i)=>{Se.j({message:Be.importingCSV});const n=t.getCollectionViewCollectionStore();if(!n)return;if(!Q.R.findCollectionViewBlockFromStore(t))return;const{value:r}=await ue.importFile(o,{importType:"MergeIntoCollection",fileURL:e,fileName:i,collection:{id:n.id,spaceId:(0,x.CG)(n.pointer.spaceId)}}).next();r.error&&ve.showErrorMessage(K.default.formatMessage(Be.importFailed)),Se.x()})(e[0],i[0].name)},onError:e=>{Se.x(),ve.showErrorMessage(K.default.formatMessage(Be.importFailed))}})}async function nt(e,t,o){const i=t.collectionViewStore(),{remoteRequestStore:r}=t;if(!r||!i)return;const a=r.state;if(!a)return;const s=t.createUpdateCounter(),l=t.remoteResult.get();re.Z.state.online&&l&&await le.transactionQueue.drain();const c=i.inMemoryRecordCache;if(!t.shouldUpdate(s))return;let d;if(t.isLoading.set(!0),c===e.defaultRecordCache.inMemoryRecordCache&&re.Z.state.online){d=ue.queryCollectionStream(e,a,void 0,o).then((o=>{if("success"===o.type)return rt({environment:e,remoteRequest:a,collectionContextStore:t,response:o.data,updateCounter:s})}));if(!(await(0,_.OI)(1e4,[d])).timeout)return}try{const o=await async function(e,t,o){const{source:i,collectionView:r,loader:a}=t,s=e.currentUser.id;let l;if("collection"!==i.type)throw new Error("TODO: support typed source");l={table:R.v,id:i.id};const c=Date.now(),d=await G.Ye({environment:e,pointer:l,inMemoryRecordCache:o});if(!d)throw new Error("Collection not found.");const m=d.value,g=await G.Ye({environment:e,pointer:{table:A.n,id:r.id},inMemoryRecordCache:o});if(!g)throw new Error("Collection view not found.");const h=I.zF.fromMonomorphicFunctionUnsafe((async t=>{const o=await G.Ye({environment:e,pointer:t});return o?o.value:void 0})),f=g.value,v=P.Ak.create(),y=I.mF.fromRecordMap(v),b={schema:p.oC(m),pageSort:f.page_sort||[],collectionViewId:r.id,loader:a,userId:s,userStartOfWeek:V.AK.state,currentTime:c,getRecordValue:y,intl:K.default.getIntl(),isSorted:!1,relativeVariableResult:void 0},S=u.fk([m],b),w=(await G.ne({environment:e,collection:m,inMemoryRecordCache:o})).filter((e=>{let{value:t}=e;return t&&t.alive})),k=n().compact(w.map((e=>{let{value:t}=e;return t}))),C=(a.reducers?Object.values(a.reducers):[]).some((e=>Boolean("results"===e.type&&e.loadContentCover))),_=await u.Ct({collectionValue:m,loader:a,loadAllProperties:!1,recordMap:v,loadRecordValue:h});await u.c_({blocks:k,dependencies:_,recordMap:v,loadRecordValue:h}),C&&await u.jF({blocks:k,loadRecordValue:h,recordMap:v});for(const n of k)u.BW(n,m,b,S);const{result:M}=u.kk(b,S),T=P.Ak.create(),x=u.aW({result:M});return await Promise.all(x.map((async t=>{const i=await G.Ye({environment:e,pointer:{table:E.iU,id:t},inMemoryRecordCache:o});i&&T.set({table:E.iU,id:t},i)}))),T.set(l,d),T.set({table:A.n,id:r.id},g),{result:M,recordMap:T.toJson({allowVersionDowngrade:!1}),relativeVariableResult:void 0,collectionIds:void 0}}(e,a,c),i=P.Ak.create(o.recordMap);Ce.fL({environment:e,inMemoryRecordCache:c,recordMap:i,debugSource:"collectionViewActions.fetchRemoteResult (localResponse)"}),await rt({environment:e,collectionContextStore:t,remoteRequest:void 0,response:o,updateCounter:s})}catch(m){}d&&d.catch((e=>{}))}async function rt(e){const{environment:t,remoteRequest:o,collectionContextStore:i,response:r,updateCounter:a}=e,s=i.collectionViewStore();if(!i.shouldUpdate(a))return;if(b.H1.is(r))for await(const c of r)if("reducer"===c.type){const e=i.remoteResult.get(),t=null==e?void 0:e.reducerResults[c.name];if(!t||!n().isEqual(t,c.result)){const t={type:"reducer",reducerResults:{...null==e?void 0:e.reducerResults,[c.name]:c.result}};i.remoteResult.set(t);const o=new Set(u.aW({result:t,onlyTypes:["results"]}));i.resultSet.set(o)}}else if("sizeHint"===c.type){const e=i.remoteResult.get(),t={type:"reducer",reducerResults:(null==e?void 0:e.reducerResults)??{},sizeHint:c.sizeHint};i.remoteResult.set(t)}else"relativeVariableResult"===c.type&&de.Z.setState({...de.Z.state,...c.relativeVariableResult});else{const e=i.remoteResult.get();if(!e||!n().isEqual(e,r.result)){"reducer"===r.result.type&&i.remoteResult.set(r.result);const e=new Set(u.aW({result:r.result,onlyTypes:["results"]}));i.resultSet.set(e)}if(r.collectionIds){const e=i.remoteCollectionIds.get();n().isEqual(n().sortBy(e),n().sortBy(r.collectionIds))||i.remoteCollectionIds.set(r.collectionIds)}ae.Z.addFromRecordMapWithRoleJson(r.recordMap),ae.Z.isEmpty()||Pe.dY({environment:t}),de.Z.setState({...de.Z.state,...r.relativeVariableResult})}const l=i.remoteResult.get();l&&(i.isLoading.set(!1),i.lastRemoteRequest.set(o),s&&j.set(s.id,l.reducerResults))}function at(e,t){const o=t.resultSet.get(),i=t.collectionViewStore(),n=e.currentUser.id,r=t.remoteRequestStore.state;if(!i||!i.isDefined()||!r)return;const a=Date.now(),s=K.default.getIntl(),l=i.getRecordValue,c=i.getFormat(),d=i.getType(),h=t.collectionStoresStore.state,f=[];for(const p of h){const e=l(p);e&&f.push(e)}if(0===f.length)return;let v={};if("collectionTypedView"===t.contextType){const e=(t.databaseType&&(0,g.uV)(s))??{},o=(0,m.jf)({schemas:[...f.map((e=>{var t;const o=null==e||null===(t=e.format)||void 0===t?void 0:t.app_uri_map,i=p.oC(e);return m.aQ.toViewSchema(i,o)})),e],onlyPropertyIds:Object.keys(e)});if(o.error)throw o.error;v=o.value}else v=p.oC(f[0]);const y=u.ps(c,d,v),b=t.relativeVariableStore.state,S={pageSort:i.getPageSort(),schema:v,loader:r.loader,userId:n,userStartOfWeek:V.AK.state,currentTime:a,getRecordValue:ee.default.getCurrentBlockValueFn(),intl:K.default.getIntl(),isSorted:!1,visibleProperties:y,relativeVariableResult:b},w={...S,loader:{...r.loader,filter:void 0}},k=t.remoteResult.get(),_=k?new Set(u.aW({result:k,onlyTypes:["results"]})):new Set,M=u.fk(f,S);for(const p of o){const e=ce.G.createChildStore(i,{table:E.iU,id:p}),o=e.getAssociatedCollectionStore();if(!o||!h.find((e=>{let{id:t}=e;return o.id===t})))continue;const n=l(e),a=o&&l(o);if(!a||!n)continue;const s=r.loader.upwardTraversalRelation&&_.has(p)&&(0,W.uU)({block:C.kk.fromBlock(n),collectionContextStore:t});u.BW(n,a,s?w:S,M)}for(const p of f){const e=se.Z.getEditedBlocksForCollection(p.id);for(const t of e){if(o.has(t))continue;const e=l(ce.G.createChildStore(i,{table:E.iU,id:t}));e&&u.BW(e,p,S,M)}}const{result:T}=u.kk(S,M);return"reducer"===T.type?T:void 0}function st(e,t){const o=t.collectionViewStore(),i=t.searchQuery.get();if(!o)return;const r=t.currentSubitemFormatStore.state,a=(0,O.RL)(t),s=(0,c.kk)(a),l=t.currentSortsStore.state,d=function(e){const t=e.reducers.get(),o={};return n().forEach(t,((e,t)=>{e&&(o[t]=e.reducer)})),o}(t);if(n().isEmpty(d))return;const u=(0,x.CG)(o.pointer.spaceId),m=o.getCollectionSource();if(!m)return;const g=t.normalizedSchemaStore.state,h=(null==r?void 0:r.property)&&g[r.property];return{source:m,collectionView:{id:o.id,spaceId:u},loader:{type:"reducer",reducers:d,filter:s,sort:l,searchQuery:i,userTimeZone:(0,y.r)(),...h&&(0,p.p_)(h)&&{upwardTraversalRelation:h}}}}function lt(e){const{reducerId:t,instanceId:o,reducer:i,collectionContextStore:r}=e,a=r.reducers.get(),s=a[t];let l;if(i)l={instanceIds:n().uniq([...(null==s?void 0:s.instanceIds)||[],o]),reducer:i};else{const e=n().without((null==s?void 0:s.instanceIds)||[],o);l=s&&e.length>0?{instanceIds:e,reducer:s.reducer}:void 0}n().isEqual(s,l)||r.reducers.set({...a,[t]:l})}function ct(e){const{environment:t,collectionViewId:o,openInNew:i,collectionContextStore:n,isFullScreen:r,isRootChild:a,isInPeekRenderer:s}=e,l=n.collectionViewBlockStore();if(l){if(l===ee.default.state.mainEditorCurrentBlockStore||i)_e.navigateToBlock({environment:t,store:l,openInNew:i,collectionViewId:o});else{const e=new ce.Xr(t,{table:A.n,id:o},{inMemoryRecordCache:l.inMemoryRecordCache}),i=e.getCollectionStore();Ee({environment:t,collectionViewBlockStore:l,collectionViewStore:e,collectionStore:i,collectionContextStore:n,isFullScreen:r,isRootChild:a,isInPeekRenderer:s}),S.Z.set({userId:t.currentUser.id,key:oe.Z.getLocalViewPreferenceKey(l.id),value:o})}Xe({collectionContextStore:n})}}function dt(e){const{environment:t,collectionContextStore:o}=e;let i=o.collectionStore();const n=o.collectionViewBlockStore();if(!i||!n)return;const{mainEditorCurrentBlockStore:r}=ee.default.state;r&&o.isFullScreen.get()&&(i=ce.NW.createChildStore(r,i.pointer)),Te.mT({environment:t,store:i.getNameStore(),canSelectAllBlocks:!1})}function pt(){Me.MO(),function(){const e=ne.Z.state,t=pe.default.state;if(e.isActive&&1===t.stores.length&&t.stores[0].id===e.store.id)return;mt()}()}function ut(e){const{store:t,transient:o}=e;ne.Z.setState({isActive:!0,store:t,transient:Boolean(o)})}function mt(){ne.Z.setState({...ne.Z.state,isActive:!1})}function gt(e){const{store:t}=e;"new"===ie.Z.state.editMode&&ie.Z.state.store.id===t.id&&ie.Z.reset()}function ht(e){const{environment:t,update:o,transaction:i,collectionStore:n}=e;ke.ae({environment:t,table:B.cv,value:o.newAutomationValue,inMemoryRecordCache:n.inMemoryRecordCache,transaction:i});for(const r of o.newAutomationActionValues)ke.ae({environment:t,table:Z.Xj,value:r,inMemoryRecordCache:n.inMemoryRecordCache,transaction:i})}},61338:(e,t,o)=>{o.d(t,{hE:()=>k,e2:()=>S,FC:()=>w,wA:()=>f,Bl:()=>C,jA:()=>M,dR:()=>_});var i=o(95371),n=o(39721),r=o(73597),a=o(70842),s=o(97880),l=o(78316),c=o(77181),d=o(3815),p=o(96802),u=o(30149);function m(e){const{store:t,propertyId:o,id:i,position:n,transaction:r}=e;let a;a="before"===n.type?{pointer:t.pointer,path:["properties",o],command:"addRelationBefore",args:{id:i,spaceId:t.getSpaceId(),before:n.before}}:{pointer:t.pointer,path:["properties",o],command:"addRelationAfter",args:{id:i,spaceId:t.getSpaceId(),after:n.after}},u.applyOperation({store:t,operation:a,transaction:r})}function g(e){const{store:t,propertyId:o,id:i,transaction:n}=e;u.applyOperation({store:t,operation:{pointer:t.pointer,path:["properties",o],command:"removeRelation",args:{id:i,spaceId:t.getSpaceId()}},transaction:n})}var h=o(24677);function f(e){const{environment:t,transaction:o,blocks:p,action:u}=e,m=(0,l.fm)(p[0]);if(!m)return;const g=m.subitemTreeStore.state;if(!g)return;const f=m.currentSubitemFormatStore.state;if(!f||!f.property)return;const S=m.collectionViewBlockStore();if(!S)return;const w=new i.mp({store:S,pathKey:""},g.map((e=>e)).children),k=function(e,t){const o=new Set(e);let n,s;for(const a of r.JK(t)){if(!o.has(a.value.store)){if(n)return;continue}const e=(0,i.DY)([t],(e=>e===a));if(!e||e.length<2)return;if(n??=e,s=e,o.delete(a.value.store),0===o.size)break}if(n&&s)return a.T.fromNearestCommonAncestor(n,s)}(p,w);if(!k)return;const C=n.o.getIndentOperationsFromTreeRange(k,u),_=new Set,M=[],T="unindentSelf"===u?new Set(C.map((e=>e.target))):new Set;for(const r of C){const{target:e,operation:t}=r,a=(0,i.DY)([w],(t=>t===e));if(void 0===a)return;const l=a[a.length-2];if("indentSelfAndSubtree"===t){if(_.has(l)){_.add(e),M.push(e.value.store);continue}const t=l.children,i=t.indexOf(e);if(0===i)return;const n=t[i-1].value.store;v({parentStore:l.value.store,previousSiblingStore:n,targetStore:e.value.store,subitemFormat:f,transaction:o}),M.push(d.G.createChildStore(n,e.value.store.pointer)),b({collectionContextStore:m,pathKey:(0,c.zV)(l.value.pathKey,n)})}else{if("unindentSelf"!==t)break;{var I;if(T.has(l)){T.delete(e),M.push(e.value.store);continue}if(1===a.length)return;const t=null===(I=a[a.length-3])||void 0===I?void 0:I.value.store;y({parentStore:l.value.store,grandparentStore:t,targetStore:e.value.store,subitemFormat:f,transaction:o}),M.push(d.G.createChildStore(t&&t.isPageBlock()?t:m.collectionViewBlockStore(),e.value.store.pointer))}}if(n.F.applyMutable(w,r))if("indentSelfAndSubtree"===t)_.add(e);else if("unindentSelf"===t){const t=m.subitemExpandedStore.get(),o=l.value.pathKey,i=t.get(o);0===l.children.length&&null!=i&&i.isExpanded&&(t.delete(o),m.subitemExpandedStore.emit()),T.delete(e)}else(0,s.t1)(t)}M&&h.Z5({environment:t,stores:M})}function v(e){const{parentStore:t,previousSiblingStore:o,targetStore:i,subitemFormat:n,transaction:r}=e;t.isPageBlock()&&C({sourceStore:t,destStore:i,subitemFormat:n,transaction:r}),k({sourceStore:o,destStore:i,subitemFormat:n,transaction:r,position:{type:"after"}})}function y(e){const{parentStore:t,grandparentStore:o,targetStore:i,subitemFormat:n,transaction:r}=e;C({sourceStore:t,destStore:i,subitemFormat:n,transaction:r}),o&&o.isPageBlock()&&k({sourceStore:o,destStore:i,subitemFormat:n,position:{type:"after",after:t.id},transaction:r})}function b(e){const{collectionContextStore:t,pathKey:o}=e,i=t.subitemExpandedStore.get(),n=i.get(o);null!=n&&n.isExpanded||(i.set(o,{isExpanded:!0,limit:20}),t.subitemExpandedStore.emit())}function S(e){const t=(0,l.fm)(e);if(!t)return;const o=t.subitemTreeStore.state,n=(0,i.DY)(o.children,(t=>t.value.store===e));if(!n)return;const r=n.map((e=>e.value.store.pointer)),a=(0,c.Af)(r),s=t.subitemExpandedStore.get(),d=s.get(a);d&&d.isExpanded&&(s.delete(a),t.subitemExpandedStore.emit())}function w(e){var t;const o=(0,l.fm)(e);if(!o)return;const n=o.subitemTreeStore.state,r=(0,i.DY)(n.children,(t=>t.value.store===e));if(!r)return;const a=o.currentSubitemFormatStore.state;if(!a)return;const s=null===(t=o.collectionStore())||void 0===t?void 0:t.getSchema()[a.property];if(!s||"relation"!==s.type)return;if(0===(0,c.CJ)({store:e,subitemFormat:a,propertySchema:s}).length)return;const d=r.map((e=>e.value.store.pointer));b({collectionContextStore:o,pathKey:(0,c.Af)(d)})}function k(e){const{sourceStore:t,destStore:o,subitemFormat:i,position:n,transaction:r}=e;m({store:t,propertyId:i.property,id:o.id,position:n,transaction:r}),m({store:o,propertyId:i.inverse,id:t.id,transaction:r,position:{type:"after"}})}function C(e){const{sourceStore:t,destStore:o,subitemFormat:i,transaction:n}=e;g({store:t,propertyId:i.property,id:o.id,transaction:n}),g({store:o,propertyId:i.inverse,id:t.id,transaction:n})}function _(e){const{collectionViewStore:t,propertyID:o,transaction:i}=e;p.FH({stores:[t],update:{collection_view_subitem:o?{property:o}:void 0,collection_view_toggle_by:o?{property:o}:void 0},transaction:i})}function M(e){const{collectionContextStore:t,relationPropertyId:o,transaction:i}=e,n=t.collectionStore();n&&p.FH({stores:[n],update:{collection_default_subitem:o},transaction:i})}},73928:(e,t,o)=>{o.d(t,{Z1:()=>ce,y3:()=>Be,oy:()=>Oe,mN:()=>ve,Wv:()=>ye,Vk:()=>Ie,Jt:()=>De,QS:()=>Ee,bi:()=>de,so:()=>qe,z0:()=>me,lx:()=>pe,Tg:()=>he,IV:()=>ge,Q:()=>Ae,p_:()=>Ve,w_:()=>Re,id:()=>He,me:()=>Ne,mE:()=>ue,jN:()=>Fe,bl:()=>Xe,iJ:()=>Pe,Q2:()=>Ge});var i=o(96486),n=o.n(i),r=o(26263),a=o(1302),s=o(41432),l=o(65917),c=o(42875),d=o(74229),p=o(482),u=(o(27006),o(98459),o(21202));o(6287),o(70279),o(90468),o(29369);function m(e){return{pointer:{table:u.iU,id:e.blockParentId},path:["content"],command:"removeChild",args:{id:e.recordId}}}var g=o(4615),h=o(3791),f=o(70203),v=o(44805),y=o(95371),b=o(97880),S=o(94419),w=o(92022),k=o(63594),C=o(30793),_=o(99417),M=o(88108),T=o(29477);let I=0;const P={debug:!1,responseText:void 0,showErrorCode:!1,delayBetweenChunks:250,numLoremIpsums:3},x="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function B(){return P.debug}function Z(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,T.Vs)(P.delayBetweenChunks),yield t}}}function E(e,t){const o=Math.ceil(e.length/t),i=new Array(o);for(let n=0,r=0;n<o;++n,r+=t)i[n]=e.substr(r,t);return i}const R=async(e,t)=>{console.log("Retrieving fake completion for data",t);const{context:o}=t,i=o.selectedText,n=[];let{responseText:r}=P;if("clipboard"===r&&(r=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===r&&(n.push({type:"success",completion:"\n"},{type:"success",completion:"this is "},{type:"success",completion:"fake "},{type:"success",completion:`streaming response ${I++}.`}),"string"==typeof i)){n.push({type:"success",completion:"\n\nHere is the text you selected:\n\n"});for(const e of E(i,10))n.push({type:"success",completion:e})}if(P.showErrorCode)n.push({type:"error",message:"alas",errorCode:P.showErrorCode});else if(void 0===r)for(let s=0;s<P.numLoremIpsums;s++)n.push(...(a=[`\n\n${s+1}. `,...E(x,0===P.delayBetweenChunks?x.length:50)],a.map((e=>({type:"success",completion:e})))));else r.length>0&&n.push({type:"success",completion:r});var a;return Promise.resolve({type:"success",data:Z(n),status:200,headers:{}})};(0,M.exposeDebugValue)("completionDebugSettings",P);var A=o(43455),D=o(33929),F=o(45162),L=o(67669),V=o(65598),N=o(77546),O=o(69645),U=o(8323),H=o(72133),z=o(89086),W=o(95802),j=o(79315),K=o(80863),Y=o(16772),G=o(3815),X=o(27724),q=o(50906),$=o(54642),J=o(73100),Q=o(43132),ee=o(47307),te=o(9953),oe=o(31299),ie=o(24677),ne=o(64964),re=o(98104),ae=o(29373),se=o(30149),le=o(93678);const ce=300;function de(){"closedWithContext"===Y.default.state.type&&Y.default.reset()}async function pe(e){const{environment:t,prompt:o=_.NX,additionalContext:i,from:n}=e,r=(0,_.FD)();r&&await fe({environment:t,prompt:o,context:r,additionalContext:i,from:n})}async function ue(e){const t=ie.aw(ie.KX()),o=(0,F.W9)(t);if(!o)return;re.NA({multiSelection:o});const i=(0,_.Fu)();if(!i)return;const n={type:"closedWithContext",context:i,futureRevisions:[]};Y.default.setState(n),await ge(e)}async function me(e){const{environment:t,prompt:o=_.NX,additionalContext:i,from:n}=e,r=(0,_.Xc)();r&&await fe({environment:t,prompt:o,context:r,additionalContext:i,from:n})}async function ge(e){"closedWithContext"===Y.default.state.type&&Y.default.state.context&&await fe({...e,context:Y.default.state.context})}async function he(e){await fe(e)}async function fe(e){const{environment:t,prompt:o,context:i,additionalContext:n,skipInitialForm:s,from:l}=e,c="closed"!==Y.default.state.type?Y.default.state.sessionId:void 0,d=Boolean(c),p=c??(0,g.ZP)();ve({clientPrompt:o,additionalContext:n})&&!s?(0,w.hr)({environment:t,from:l,prefilledValue:(0,_.$W)(o),promptForAnalytics:o,sessionId:p,context:i}):(d||q.trackAICompletionPopupOpen(t,{session_id:p,prompt_key:o.key,from:l}),re.ZH(t),await async function(e){const{environment:t,context:o,prompt:i,additionalContext:n,updater:s,sessionId:l,from:c}=e;"textSelection"===o.type&&s((()=>{re.ZH(t),ie.ZH(t)}));const{serverPrompt:d}=be(e),p=new r.Z;p.isTemporaryData=!0,s((()=>{t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(p)}));const u=Y.default.state,m="completionPopup"===u.type&&"initialPrompt"===u.stage||"closedWithContext"===u.type?u.futureRevisions:[],g={type:"completionPopup",stage:"results",loading:!0,sessionId:l,revisions:[...m,{type:"initial",clientPrompt:i,serverPrompt:d,additionalContext:n,userSearchCache:new Map,completion:void 0,hasFeedback:!1}],futureRevisions:[],context:o,inMemoryRecordCache:p,from:c,hasErrored:!1};s((()=>{Y.default.setState(g)})),await a.default.afterNextFlush(),await s((()=>xe({environment:t}))),await Se({...e,updater:s})}({environment:t,context:i,prompt:o,intl:D.default.getIntl(),updater:Y.default.createUpdater(),additionalContext:n,sessionId:p,from:l}))}function ve(e){const{clientPrompt:t,additionalContext:o}=e,i="translate"===t.key&&o&&o.language,n="changeTone"===t.key&&o&&o.tone;return Boolean(!i&&!n&&t.steps)}async function ye(e){const{environment:t}=e,o=Y.default.state;if("completionPopup"===o.type&&"results"===o.stage)if(re.ZH(t),ve((0,_.Iz)(o)));else{const e=(0,_.Iz)(o);Y.default.setState({...o,revisions:[...o.revisions,{type:"initial",clientPrompt:e.clientPrompt,serverPrompt:e.serverPrompt,additionalContext:e.additionalContext,userSearchCache:new Map,completion:void 0,hasFeedback:!1}]}),await Se({environment:t,updater:Y.default.createUpdater()})}}function be(e){const{environment:t,context:o,prompt:i,additionalContext:r,intl:a}=e,s=(0,v.Xh)({intl:a,textValue:o.currentPage.getBlockTitleStore().getValue(),getRecordModel:o.currentPage.getRecordModel,userTimeZone:(0,c.r)()}),{previousContent:l,restContent:d,pageContent:p}=function(e){var t,o;const{environment:i,context:n}=e,r=n.currentPage.getContentStores()[0];let a,s;if("cursor"===n.type||"textSelection"===n.type)a=n.textSelection.start,s=n.textSelection.end;else{var l;a={store:n.stores[0].getBlockTitleStore(),index:0};const e=n.stores[n.stores.length-1].getBlockTitleStore();s={store:e,index:(null===(l=(0,z.x0)(e))||void 0===l?void 0:l.endIndex)||0}}const c=ze(n.currentPage),d=Q.wc({environment:i,textSelection:{start:{store:r.getBlockTitleStore(),index:0},end:s},markdownSerializationOptions:(0,A.KF)()}),p=[c,d].filter(b.$K).join("\n\n"),u=(0,O.Bj)({includeNonSelectableListContainer:!1}),m=null===(t=(0,y.CY)(u).value)||void 0===t?void 0:t.store,g=null==m?void 0:m.getBlockTitleStore(),h=g&&Q.wc({environment:i,textSelection:{start:a,end:{store:g,index:(null===(o=(0,z.x0)(g))||void 0===o?void 0:o.endIndex)||0}},markdownSerializationOptions:(0,A.KF)()})||"",f=We(i,n.currentPage)||"";return{previousContent:p,restContent:h,pageContent:f}}({environment:t,context:o});let u,m;if("textSelection"===o.type||"blockSelection"===o.type){if("textSelection"===o.type)m=Q.wc({environment:t,textSelection:o.textSelection,markdownSerializationOptions:(0,A.KF)()})??"";else if("blockSelection"===o.type){const e=n().compact(X.default.state.stores.map((e=>e.getValue())));m=Q.X4({rootBlock:{...o.currentPage.pointer,spaceId:o.currentPage.getSpaceId()},blockValues:e,isWindows:t.device.isWindows,getRecordValue:o.currentPage.getRecordValue,markdownSerializationOptions:(0,A.KF)()}).markdown||""}else(0,b.t1)(o);u=je({prompt:i,selectedText:m,pageTitle:s,pageContent:p,additionalContext:r}),u||(u=Ye({prompt:i,pageTitle:s,previousContent:l,restContent:d,pageContent:p,additionalContext:r}))}else"cursor"===o.type?(u=Ye({prompt:i,pageTitle:s,previousContent:l,restContent:d,pageContent:p,additionalContext:r}),u||(u=je({prompt:i,selectedText:p,pageTitle:s,additionalContext:r,pageContent:p}))):(0,b.t1)(o);if(!u)throw new Error(`Unable to find server prompt for "${i.key}" client prompt`);const g={type:"initial",pageTitle:s,selectedText:m,pageContent:p};return{serverPrompt:u.serverPrompt,initialStep:g,humanStep:u.humanStep}}async function Se(e){const{environment:t,updater:o}=e,i=Y.default.state;if("completionPopup"!==i.type||"results"!==i.stage)return;const{sessionId:r}=i,a=Date.now(),s=(0,g.ZP)(),l=(0,_.Iz)(i);if(i.revisions[i.revisions.length-1]!==l)throw new Error("Assertion failure, expected current revision to be initial revision");const c={...l,inferenceId:s},d=i.revisions.slice(0,i.revisions.length-1),{serverPrompt:p}=c;q.trackAICompletionPopupPreviewStart(t,{session_id:r,inference_id:s,from:i.from,prompt_key:c.clientPrompt.key,type:"completion"}),o((()=>{Y.default.setState({...i,loading:!0,revisions:[...d,c]})}));let u=!1;if((0,_.E8)(t.device)){if("helpMeWrite"!==p.type&&"helpMeDraft"!==p.type&&"helpMeEdit"!==p.type)throw ee.showErrorMessage("Pre-built prompts are not supported yet – please write a custom prompt only."),new Error("Unexpected prompt type");t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i.inMemoryRecordCache),await J.CU({environment:t,store:K.oX,completionContext:i.context});const e=p.prompt;await J.G6({environment:t,store:K.oX,message:e}),u=!0,await o((()=>{const e=Y.default.state;if("completionPopup"!==e.type||"results"!==e.stage)return;const t=new Map,o=n().last(X.default.state.stores);Y.default.setState({...e,revisions:[...d,{...c,completion:"",userSearchCache:t}],context:{...e.context,origin:o||e.context.origin},loading:!1})}))}else{const e=n().throttle((async()=>{u||await o((()=>xe({environment:t,setSelection:!1})))}),ce),l=await _e({environment:t,inferenceId:s,serverPrompt:p,targetStore:i.context.currentPage,onUpdate(t){let{completion:i,userSearchCache:n}=t;o((()=>{const t=Y.default.state;"completionPopup"===t.type&&"results"===t.stage&&(Y.default.setState({...t,revisions:[...d,{...c,completion:i,userSearchCache:n}]}),e())}))}});if("error_modal_shown"===l.type||"upsell_modal_shown"===l.type)return void o((()=>Le()));u=!0;const{completion:m,userSearchCache:g}=l;await o((()=>{q.trackAICompletionPopupPreviewEnd(t,{session_id:r,inference_id:s,preview_time:Date.now()-a,type:"completion"});const e=Y.default.state;if("completionPopup"===e.type&&"results"===e.stage)return Y.default.setState({...e,revisions:[...d,{...c,completion:m,userSearchCache:g}],loading:!1}),xe({environment:t,setSelection:!0})}))}}function we(e){return(0,_.Nh)(e)?"openai-2":(0,_.GK)(e)?"anthropic-3":(0,_.qy)(e)?"openai-3":"openai-1.1"}function ke(e){const{environment:t,inMemoryRecordCache:o,completion:i,userSearchCache:n,store:r,prompt:a,additionalContext:s,isComplete:l}=e;se.createAndCommit({userAction:"completionActions.updateAiBlockForCompletion",environment:t,perform:e=>{const c=r.clone(o);c.getContentIds().forEach((t=>{se.applyOperation({store:c,operation:m({blockParentId:c.id,recordId:t}),transaction:e})}));const d=Q.Mt({environment:t,text:i,inMemoryRecordCache:o,transaction:e,markdownOptions:(0,A.N9)(n)});if(!d)return;const u=c.getContentStore();d.reverse().forEach((t=>{S.Ce({parent:u,prepend:t,transaction:e}),te.sW({store:t,data:{parent_id:c.id,parent_table:c.table,alive:!0},transaction:e})})),se.applyOperation({store:c,operation:p.op.update({pointer:c.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:a.key}}),transaction:e});const g=s?(0,f.TP)(s.prompt):[];se.applyOperation({store:c,operation:p.op.set({pointer:c.pointer,path:["properties","title"],args:g}),transaction:e}),l&&Ke({transaction:e,completionState:{clientPrompt:a,additionalContext:s}})}})}function Ce(e){const t=D.default.getIntl();return 451===e?ne.oV({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)",description:"Error message shown when AI prompt or output fails moderation"})}):502===e||503===e||504===e?ne.oV({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"We’re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})",description:"Error message shown when AI prompt or output fails due to service provider error; errorCode is a number"},{errorCode:e})}):void ne.oV({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})",description:"Client side message shown when AI completions fail; errorCode is a number."},{errorCode:e})})}async function _e(e){const{environment:t,inferenceId:o,serverPrompt:i,targetStore:n,onUpdate:r}=e,a=B()?R:$.getCompletion,s=n.getSpaceId(),c=(0,L.UK)(n);if(!s)return Ce(1001),{type:"error_modal_shown"};const p=await a(t,{id:o,context:i,model:we(t),spaceId:s,isSpacePermission:c});if("success"!==p.type)return ee.showError(p),{type:"error_modal_shown"};let u="",m="";const g=new Map,f=e=>oe.Yu({environment:t,query:e,membersOnly:!0});if(d.H1.is(p.data))for await(const l of p.data)if("success"===l.type)u+=l.completion,(0,A.Ie)(u)||(m=Me(u),await(0,A.$A)(u,f,g)),r({completion:m,userSearchCache:new Map(g)});else if("error"===l.type)return(0,h.lX)(l.errorCode)?(le.y(t,{from:"ai_limit_in_app",for:(0,U.zt)(),addOnFeature:"ai"}),{type:"upsell_modal_shown"}):(Ce(l.errorCode),{type:"error_modal_shown"});const v=Me(u);return v?(await(0,A.$A)(v,f,g),{type:"success",completion:v,userSearchCache:new Map(g)}):(Ce(600),l.log({level:"error",from:"completionActions.getCompletionWithPostProcessing",type:"emptyResponse",data:{inferenceId:o}}),{type:"error_modal_shown"})}function Me(e){return e.replace(/<br>/g,"\n")}function Te(e){const{improvement:t}=e;return"continueWriting"===t.type?{type:"human",prompt:"Continue writing"}:"makeLonger"===t.type?{type:"human",prompt:"Make longer"}:"helpMeEdit"===t.type?{type:"human",prompt:t.prompt}:void(0,b.t1)(t.type)}async function Ie(e,t){const o=Y.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;let i=!1;const r=Y.default.createUpdater();if((0,_.E8)(e.device)){if("helpMeEdit"!==t.type)throw new Error("Improvements other than helpMeEdit are not supported");await J.G6({environment:e,store:K.oX,message:t.prompt}),i=!0,await r((()=>{const e=Y.default.state;if("completionPopup"!==e.type||"results"!==e.stage)return;const t=n().last(X.default.state.stores);Y.default.setState({...e,context:{...e.context,origin:t||e.context.origin},loading:!1})}))}else{const a=(0,_.xM)(o);if(!a.completion)return;const s=o.context,l=a.completion,c="continueWriting"===t.type?l:"",d=Date.now(),p=(0,g.ZP)();q.trackAICompletionPopupPreviewStart(e,{session_id:o.sessionId,inference_id:p,from:o.from,prompt_key:(0,_.Iz)(o).clientPrompt.key,improvement_prompt_type:t.type,type:"follow_up_improvement"});const u=[...o.revisions,...o.futureRevisions],m={type:"followup",improvement:t,completion:c,userSearchCache:new Map,inferenceId:p,hasFeedback:!1,previousRevision:(0,_.HS)(o)},h={...o,loading:!0,revisions:[...u,m],futureRevisions:[]},f=function(e){const{environment:t,completionState:o}=e,{context:i}=o,n=[];for(const r of(0,_.zU)(o))if("initial"===r.type){const{initialStep:e,humanStep:o}=be({environment:t,context:i,prompt:r.clientPrompt,additionalContext:r.additionalContext,intl:D.default.getIntl()});if(void 0===r.completion)throw new Error("Assertion failure, followup without initial completion");n.unshift(e,o,{type:"assistant",result:r.completion})}else if("followup"===r.type){const e=[Te({improvement:r.improvement})];r.completion&&e.push({type:"assistant",result:r.completion}),n.unshift(...e)}else(0,b.t1)(r);B()&&console.log("Transcript",JSON.stringify(n,null,2));return{type:"writerFollowup",transcript:n}}({environment:e,completionState:h});r((()=>{Y.default.setState(h)}));const v=n().throttle((async()=>{i||await r((()=>xe({environment:e,setSelection:!1})))}),ce),y=await _e({environment:e,inferenceId:p,serverPrompt:f,targetStore:s.currentPage,onUpdate(e){let{completion:t,userSearchCache:o}=e;r((()=>{const e=Y.default.state;"completionPopup"===e.type&&"results"===e.stage&&(Y.default.setState({...e,revisions:[...u,{...m,completion:c+t,userSearchCache:o}]}),v())}))}});if("error_modal_shown"===y.type||"upsell_modal_shown"===y.type)return void r((()=>Le()));i=!0;const{completion:S,userSearchCache:w}=y;r((()=>{q.trackAICompletionPopupPreviewEnd(e,{session_id:h.sessionId,inference_id:p,preview_time:Date.now()-d,type:"follow_up_improvement"}),Y.default.setState({...h,loading:!1,revisions:[...u,{...m,completion:c+S,userSearchCache:w}]}),xe({environment:e,setSelection:!0})}))}}async function Pe(e){const{environment:t,store:o,prompt:i,additionalContext:a}=e,s=o.getRecordStoreUIRoot();if(!(s instanceof G.G))return;const l=function(e){const{environment:t,rootStore:o,store:i,prompt:n,additionalContext:r}=e,a=D.default.getIntl(),s=(0,v.Xh)({intl:a,textValue:o.getBlockTitleStore().getValue(),getRecordModel:o.getRecordModel,userTimeZone:(0,c.r)()}),l=We(t,o)||"";if("helpMeWrite"===n.key){var d,p,u,m,g;const e={type:"helpMeWrite",pageTitle:s,pageContent:l,prompt:(null==r?void 0:r.prompt)??""},n=(0,O.dq)({includeNonSelectableListContainer:!1,root:i.getHighestContentBlockUIAncestor()});if(!n)return e;const a=(0,O.v5)(i,n.children);if(!a)return e;const c=o.getContentStores()[0],h=(0,y.YL)(n,a),f=h.prev?h.prev.value.store.getBlockTitleStore():null===(d=h.parent)||void 0===d?void 0:d.value.store.getBlockTitleStore(),v=c&&f&&Q.wc({environment:t,textSelection:{start:{store:c.getBlockTitleStore(),index:0},end:{store:f,index:(null===(p=(0,z.x0)(f))||void 0===p?void 0:p.endIndex)??0}},markdownSerializationOptions:(0,A.KF)()})||"",S=[ze(o),v].filter(b.$K).join("\n\n"),w=null===(u=(0,y.Xf)(n,a).next)||void 0===u?void 0:u.value.store.getBlockTitleStore(),k=null===(m=(0,y.CY)(n).value)||void 0===m?void 0:m.store,C=null==k?void 0:k.getBlockTitleStore();return{type:"helpMeWrite",pageTitle:s,previousContent:S,restContent:w&&C&&Q.wc({environment:t,textSelection:{start:{store:w,index:0},end:{store:C,index:(null===(g=(0,z.x0)(C))||void 0===g?void 0:g.endIndex)||0}},markdownSerializationOptions:(0,A.KF)()})||"",prompt:(null==r?void 0:r.prompt)??""}}if("summarize"===n.key||"findActionItems"===n.key)return{type:n.key,pageTitle:s,selectedText:l}}({environment:t,rootStore:s,store:o,prompt:i,additionalContext:a});if(!l)return;const d=n().throttle(ke,ce),p=new r.Z;p.isTemporaryData=!0,t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(p);const u=await _e({environment:t,inferenceId:(0,g.ZP)(),serverPrompt:l,targetStore:s,onUpdate(e){let{completion:n,userSearchCache:r}=e;d({inMemoryRecordCache:p,environment:t,store:o,completion:n,userSearchCache:r,prompt:i,additionalContext:a,isComplete:!1})}});if(t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(p),"error_modal_shown"===u.type||"upsell_modal_shown"===u.type)return;const{completion:m,userSearchCache:h}=u;ke({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,store:o,completion:m,userSearchCache:h,prompt:i,additionalContext:a,isComplete:!0})}async function xe(e){const{environment:t,setSelection:o}=e,i=Y.default.state;if("completionPopup"!==i.type||"results"!==i.stage)return;const r=(0,_.xM)(i),{completion:s,userSearchCache:l}=r,{context:c,inMemoryRecordCache:d}=i;if("cursor"!==c.type)return;d.clearCache();const{currentBlock:p,currentParent:u,currentPage:m}=c,g=u||m.getContentStore(),{insertTitle:h,insertCompletion:v}=Ze({completion:s||"",currentPage:m});if(h&&se.createAndCommit({userAction:"completionActions.temporaryInsertion.insertTitle",environment:t,canUndo:!1,perform:e=>{var t;const o=null===(t=m.getTitleStore())||void 0===t?void 0:t.clone(d);o&&te.sO({store:o,value:(0,f.TP)(h),transaction:e})}}),v){const e=se.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletion",environment:t,canUndo:!1,perform:e=>{if(!v)return;const o=Q.Mt({environment:t,text:v,inMemoryRecordCache:d,transaction:e,markdownOptions:(0,A.N9)(l)});if(!o)return;Ae(t,o);Ue({parentStore:g.clone(d),insertAfter:null==p?void 0:p.clone(d),insertStores:o,transaction:e});return o.map((e=>e.clone(t.defaultRecordCache.inMemoryRecordCache))).map((e=>e.cloneWithNewUIParent(g)))}}).performResult;if(!e||!e.length)return;o&&ie.Z5({environment:t,stores:e}),await a.default.afterNextFlush();const i=Y.default.state;if("completionPopup"!==i.type||"results"!==i.stage)return;const r=n().compact(e.map((e=>W.C.findNodeFromStore(e))));if(!(r[0]?(0,N.VW)(r[0]):void 0))return;Y.default.setState({...i,context:{...i.context,origin:n().last(e)}})}else if(p){const e=(0,_.Ah)(p),n=new DOMRect(null==e?void 0:e.x,null==e?void 0:e.y,null==e?void 0:e.width,0);se.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletionStores",environment:t,canUndo:!1,perform:e=>{Ue({parentStore:g.clone(d),insertAfter:p.clone(d),insertStores:[],transaction:e})}}),o&&ie.ZH(t),p.getAlive()?Y.default.setState({...i,context:{...c,origin:p}}):Y.default.setState({...i,context:{...c,origin:n}})}}function Be(e){const{environment:t,transaction:o,selectInsertion:i,exitType:n}=e,r=Y.default.state;if(Y.default.invalidateLastUpdater(),(0,_.E8)(t.device))J.aV({store:K.oX}),He(e);else{if("completionPopup"!==r.type||"results"!==r.stage||"cursor"!==r.context.type)return;const{completion:c,userSearchCache:d,inferenceId:u}=(0,_.xM)(r);if(!c)return;const{currentBlock:m,currentParent:g,currentPage:h}=r.context,v=g||h.getContentStore();He(e);const{insertTitle:y,insertCompletion:b}=Ze({completion:c,currentPage:h});y&&"convert_to_ai_block"!==n&&te.sO({store:h.getBlockTitleStore(),value:(0,f.TP)(y),transaction:o});const w=Q.Mt({environment:t,text:b,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,markdownOptions:(0,A.N9)(d)});if(!w)return;if(m&&"convert_to_ai_block"===n){var l;const e=te.j4({environment:t,type:s.Ti.aiBlock,inMemoryRecordCache:m.inMemoryRecordCache,transaction:o,spaceId:m.pointer.spaceId});S.BE({parent:v,after:m,insert:e,transaction:o}),(0,V.PF)(m)&&S.Od({parent:v,childToRemove:m,transaction:o});const i=(0,_.xM)(r);if("initial"!==i.type)throw new Error("Assertion failure, currentRevision.type is not initial");const n=null===(l=i.additionalContext)||void 0===l?void 0:l.prompt;n&&se.applyOperation({store:e,operation:p.op.set({pointer:e.pointer,path:["properties","title"],args:[[n]]}),transaction:o}),se.applyOperation({store:e,operation:p.op.update({pointer:e.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:i.clientPrompt.key}}),transaction:o}),Ue({parentStore:e.getContentStore(),insertAfter:void 0,insertStores:w,transaction:o})}else Ue({parentStore:v,insertAfter:m,insertStores:w,transaction:o}),function(e){const{environment:t,parentStore:o,insertStores:i,selectInsertion:n}=e,r=i.map((e=>e.cloneWithNewUIParent(o)));a.default.afterNextFlush((()=>{ie.yu({environment:t,stores:r}),n&&function(e){const{environment:t,insertedStores:o}=e;H.clear(t),a.default.afterNextFlush((()=>{const e=(0,F.W9)(o);e&&re.NA({multiSelection:e})}))}({environment:t,insertedStores:r})}))}({environment:t,parentStore:v,insertStores:w,selectInsertion:i});Ke({transaction:o,completionState:(0,_.Iz)(r)}),u&&q.trackAIAction(t,{type:"cursor_completion",inference_id:u,feedback_type:"accept",timestamp:(new Date).toUTCString()})}}function Ze(e){const{completion:t,currentPage:o}=e;let i,n;const r=Boolean(o.getBlockTitleStore().getValue()),a=o.getContentStores().every((e=>{var t;return!(null!==(t=e.getTitleStore())&&void 0!==t&&t.getValue())}));if(!r&&a){const{title:e,content:o}=function(e){const t=e.trim().split("\n"),o=t[0];return o.startsWith("# ")?{title:o.substring(2),content:t.slice(1).join("\n")}:{title:"",content:e}}(t||"");i=e,n=o}else n=t;return{insertTitle:i,insertCompletion:n}}function Ee(e){var t,o;const{environment:i,transaction:r}=e,a=Y.default.state;if(Y.default.invalidateLastUpdater(),"completionPopup"!==a.type||"results"!==a.stage||"textSelection"!==a.context.type)return;const{completion:s,userSearchCache:l}=(0,_.xM)(a);if(!s)return;const{endBlock:c,endBlockParent:d,currentPage:p}=a.context,u=d||p.getContentStore();He(e);const m=Q.Mt({environment:i,text:s,inMemoryRecordCache:i.defaultRecordCache.inMemoryRecordCache,transaction:r,markdownOptions:(0,A.N9)(l)});if(!m)return;Ue({parentStore:u,insertAfter:c,insertStores:m,transaction:r}),Ke({transaction:r,completionState:(0,_.Iz)(a)});const g=m.map((e=>e.cloneWithNewUIParent(u))),h=null===(t=n().first(g))||void 0===t?void 0:t.getBlockTitleStore(),v=null===(o=n().last(g))||void 0===o?void 0:o.getBlockTitleStore();h&&v&&re.NA({multiSelection:{start:{index:0,store:h},end:{index:v.getValue()?f.Q(v.getValue()).length:0,store:v}}})}function Re(e){const{environment:t,transaction:o}=e,i=Y.default.state;if(Y.default.invalidateLastUpdater(),"completionPopup"!==i.type||"results"!==i.stage||"textSelection"!==i.context.type)return;const n=(0,_.xM)(i);n.completion&&(re.NA({multiSelection:i.context.textSelection}),Q.R$({environment:t,text:n.completion,transaction:o,disableEmbedMenu:!0,overwrite:!0,selectAll:!0,markdownOptions:(0,A.N9)(n.userSearchCache)}),Ke({transaction:o,completionState:(0,_.Iz)(i)}),He(e))}function Ae(e,t){for(const o of t)ae.X_(e,o)}function De(e){const{environment:t,transaction:o,replace:i}=e,r=Y.default.state;if(Y.default.invalidateLastUpdater(),"completionPopup"!==r.type||"results"!==r.stage||"blockSelection"!==r.context.type)return;const{completion:a,userSearchCache:s}=(0,_.xM)(r);if(!a)return;const{stores:l}=r.context,c=n().last(l);if(!c)return;const d=c.getRecordStoreUIParent();if(!d)return;He(e);const p=Q.Mt({environment:t,text:a,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,markdownOptions:(0,A.N9)(s)});if(!p)return;if(Ue({parentStore:d,insertAfter:c,insertStores:p,transaction:o}),i)for(const n of l){const e=n.getRecordStoreUIParent();e&&S.Od({parent:e,childToRemove:n,transaction:o})}Ke({transaction:o,completionState:(0,_.Iz)(r)});const u=p.map((e=>e.cloneWithNewUIParent(d)));ie.Z5({environment:t,stores:u})}function Fe(e){const t=Y.default.state;if("completionPopup"!==t.type||"results"!==t.stage||!t.loading)return;const o=(0,_.xM)(t);o.completion&&(q.trackAICompletionPopupPreviewStoppedByUser(e,{session_id:t.sessionId,inference_id:o.inferenceId}),Y.default.invalidateLastUpdater(),Y.default.setState({...t,loading:!1}),xe({environment:e,setSelection:!0}))}function Le(){const e=Y.default.state;"completionPopup"===e.type&&"results"===e.stage&&Y.default.setState({...e,hasErrored:!0})}function Ve(e){const t=Y.default.state;"completionPopup"===t.type&&"results"===t.stage&&0!==t.futureRevisions.length&&(Y.default.invalidateLastUpdater(),Y.default.setState({...t,hasErrored:!1,loading:!1,revisions:[...t.revisions,t.futureRevisions[0]],futureRevisions:t.futureRevisions.slice(1)}),xe({environment:e,setSelection:!0}))}function Ne(e){const{environment:t,purgeFromHistory:o}=e,i=Y.default.state;if("completionPopup"!==i.type||"results"!==i.stage||0===i.revisions.length)return;const n=i.revisions[i.revisions.length-1];return Y.default.invalidateLastUpdater(),Y.default.setState({...i,hasErrored:!1,loading:!1,revisions:i.revisions.slice(0,-1),futureRevisions:o?i.futureRevisions:[n,...i.futureRevisions]}),xe({environment:t,setSelection:!0}),n}function Oe(e){Y.default.invalidateLastUpdater();const{environment:t,sessionId:o,inferenceId:i,exitType:n}=e,r=Y.default.state;if((0,_.E8)(t.device)&&J.aV({store:K.oX}),"completionPopup"!==r.type||"initialPromptForAIBlock"===r.stage)return;if((!t.device.isMobileNative||"error_modal"!==n&&"upsell_modal"!==n)&&("cursor"===r.context.type||"textSelection"===r.context.type?re.NA({multiSelection:r.context.textSelection}):"blockSelection"===r.context.type?ie.Z5({environment:t,stores:r.context.stores}):(0,b.t1)(r.context)),He(e),q.trackAICompletionPopupClose(t,{session_id:o,inference_id:i,exit_type:n}),"results"!==r.stage)return;const a=(0,_.xM)(r);a.inferenceId&&q.trackAIAction(t,{type:"cursor_completion",inference_id:a.inferenceId,feedback_type:"cancel",timestamp:(new Date).toUTCString()})}function Ue(e){const{parentStore:t,insertAfter:o,insertStores:i,transaction:r}=e,a=n().clone(i).reverse();for(const n of a)o?S.BE({parent:t,insert:n,after:o,transaction:r}):S.Ce({parent:t,prepend:n,transaction:r}),te.sW({store:n,data:{parent_id:t.id,parent_table:t.table,alive:!0},transaction:r});o&&(0,V.PF)(o)&&S.Od({parent:t,childToRemove:o,transaction:r})}function He(e){const{environment:t}=e;Y.default.invalidateLastUpdater();const o=Y.default.state;"completionPopup"===o.type&&("initialPromptForAIBlock"!==o.stage&&"initialPrompt"!==o.stage&&t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(o.inMemoryRecordCache),Y.default.setState({type:"closed"}))}function ze(e){return Q.jm({rootBlock:{...e.pointer,spaceId:e.getSpaceId()},getRecordValue:e.getRecordValue})}function We(e,t){const o=n().compact(t.getContentStores().map((e=>e.getValue())));return[ze(t),Q.X4({rootBlock:{...t.pointer,spaceId:t.getSpaceId()},getRecordValue:t.getRecordValue,blockValues:o,isWindows:e.device.isWindows,markdownSerializationOptions:(0,A.KF)()}).markdown].filter(b.$K).join("\n\n")}function je(e){const{prompt:t,pageTitle:o,pageContent:i,selectedText:n,additionalContext:r}=e;B()&&console.log("textSelectionPromptToServerContext",e);const a="string"==typeof t.name?t.name:D.default.formatMessage(t.name);if("fixSpellingGrammar"===t.key||"explainThis"===t.key||"makeLonger"===t.key||"makeShorter"===t.key||"findActionItems"===t.key||"improveWriting"===t.key||"simplifyLanguage"===t.key||"cleanUpFormatting"===t.key||"summarize"===t.key)return{serverPrompt:{type:t.key,pageTitle:o,selectedText:n},humanStep:{type:"human",prompt:a}};if("translate"===t.key){const e=(null==r?void 0:r.language)??"english";return{serverPrompt:{type:t.key,text:n,language:e},humanStep:{type:"human",prompt:`Translate to ${e}`}}}if("changeTone"===t.key){const e=(null==r?void 0:r.tone)??"professional";return{serverPrompt:{type:t.key,text:n,tone:e},humanStep:{type:"human",prompt:`Change tone to ${e}`}}}if("helpMeEdit"===t.key){const e=(null==r?void 0:r.prompt)||"";return{serverPrompt:{type:t.key,prompt:e,selectedText:n,pageTitle:o,pageContent:i},humanStep:{type:"human",prompt:e}}}}function Ke(e){const{transaction:t,completionState:{clientPrompt:o,additionalContext:i}}=e,n=function(e){const{clientPrompt:t,additionalContext:o}=e,i=null==o?void 0:o.prompt;if(("helpMeWrite"===t.key||"helpMeEdit"===t.key||"helpMeDraft"===t.key)&&i)return{type:"helpMeDraft"===t.key?"helpMeWrite":t.key,prompt:i};const n=(0,_.uN)(t,o);if(n)return{type:"helpMeWrite",prompt:n}}({clientPrompt:o,additionalContext:i});if(!n)return;const{currentUserSettingsStore:r}=j.default.state;r&&(0,C.Nv)(n,r,t)}function Ye(e){const{prompt:t,pageTitle:o,previousContent:i,restContent:n,additionalContext:r,pageContent:a}=e;B()&&console.log("cursorPromptToServerContext",e);const s="string"==typeof t.name?t.name:D.default.formatMessage(t.name);if("continueWriting"===t.key)return{serverPrompt:{type:"continueWriting",pageTitle:o,previousContent:i,restContent:n},humanStep:{type:"human",prompt:s}};if("helpMeWrite"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeWrite",pageTitle:o,previousContent:i,restContent:n,prompt:e},humanStep:{type:"human",prompt:e}}}if("helpMeDraft"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeDraft",prompt:e,previousContent:i,pageTitle:o},humanStep:{type:"human",prompt:e}}}if("todoList"===t.key||"outline"===t.key||"meetingAgenda"===t.key||"brainstormIdeas"===t.key||"prosConsList"===t.key||"socialMediaPost"===t.key||"pressRelease"===t.key||"creativeStory"===t.key||"poem"===t.key||"essay"===t.key||"blogPost"===t.key||"jobDescription"===t.key||"salesEmail"===t.key||"recruitingEmail"===t.key){const e=(null==r?void 0:r.topic)??"";return{serverPrompt:{type:t.key,topic:e,pageContent:a},humanStep:{type:"human",prompt:e}}}return"summarize"===t.key||"findActionItems"===t.key?{serverPrompt:{type:t.key,pageTitle:o,selectedText:a},humanStep:{type:"human",prompt:s}}:void 0}async function Ge(e,t){let o;if(P.debug)o=402!==P.showErrorCode,console.log("updateAiEligibility",o);else{const i=await $.getAIUsageEligibility(e,{spaceId:t});"success"===i.type&&(o=i.data.isEligible)}return void 0!==o&&k.Z.setState(o),o}function Xe(e){const{environment:t,revision:o,type:i,userContent:n,shareWithNotion:r,userOptIn:a}=e,s=Y.default.state;o.inferenceId&&"completionPopup"===s.type&&"results"===s.stage&&(q.trackAIAction(t,{type:"cursor_completion",inference_id:o.inferenceId,feedback_type:i,timestamp:(new Date).toUTCString(),user_comment:n,share_with_notion:r,user_opt_in:a}),Y.default.setState({...s,revisions:s.revisions.map((e=>e.inferenceId===o.inferenceId?{...e,hasFeedback:!0}:e))}))}function qe(e,t){const o=Y.default.state;"completionPopup"===o.type&&"initialPromptForAIBlock"===o.stage&&se.createAndCommit({userAction:"completionActions.updatePromptForCurrentAiBlock",environment:e,perform:e=>{se.applyOperation({store:o.store,operation:p.op.set({pointer:o.store.pointer,path:["properties","title"],args:(0,f.TP)(t)}),transaction:e})}})}},86080:(e,t,o)=>{o.d(t,{b:()=>r,x:()=>a});var i=o(29477),n=o(81700);const r=function(e){const t=i.UZ();return n.Z.setState({...e,open:!0,onComplete:t.resolve,inputValue:""}),t.promise},a=function(e){const t=n.Z.state;t.open&&(t.onComplete(e.didConfirm),n.Z.reset())}},28673:(e,t,o)=>{o.d(t,{V:()=>f,c:()=>v});var i=o(4615),n=o(98459),r=o(6287),a=o(97880),s=o(5366),l=o(70764),c=o(33929),d=o(32363),p=o(3815),u=o(47307),m=o(77719),g=o(9953);const h=(0,s.defineMessages)({authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.propertyTypeSection.connected.authFail",description:"Error message for users when failing to auth with a third party."},mobileAdminError:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) app in settings to use this feature.",id:"database.viewSettings.propertyTypeSection.connected.mobileAdminError",description:"Error message for users when trying to auth on mobile that prompts them to ask their admin to auth on desktop."},mobileError:{defaultMessage:"Please authorize with this integration on the desktop app or a browser.",id:"database.viewSettings.propertyTypeSection.connected.mobileError",description:"Error message for users when trying to auth on mobile."}});async function f(e,t,o,i){const n=e.device.isMobile,r=null==t?void 0:t.getSpaceStore();if(!r)return;const a=(0,l.NP)(o.id).length;if(n&&i&&!a){const e=c.default.formatMessage(h.mobileAdminError);throw u.showErrorMessage(e),new Error(e)}if(n&&!i&&!a){const e=c.default.formatMessage(h.mobileError);throw u.showErrorMessage(e),new Error(e)}if(!a&&i&&r.canAdmin()||!a&&!i)try{await m.h({environment:e,integration:o,spaceId:r.id,from:"collection_settings_property_type"})}catch(s){const e=c.default.formatMessage(h.authError);throw u.showErrorMessage(e),new Error(e)}if(!(0,l.NP)(o.id).length){const e=c.default.formatMessage(h.authError);throw u.showErrorMessage(e),new Error(e)}}function v(e){const{environment:t,pattern:o,integration:s,parentCollectionStore:l,transaction:c}=e;if(!o.connected_relation_properties)throw new Error("Cannot create a connected relation collection without properties");const u=new p.NW(t,{table:r.v,id:(0,i.ZP)(),spaceId:l.pointer.spaceId}),m={};o.connected_relation_sub_schemas&&(0,a.qP)(o.connected_relation_sub_schemas).map((e=>{let[o,a]=e;const s=new p.NW(t,{table:r.v,id:(0,i.ZP)(),spaceId:l.pointer.spaceId}),d={bot_id:void 0,external_object_id:void 0,uri:o,integration_id:void 0,is_placeholder:void 0,original_url:void 0,domain:void 0,external_schema:a,sync_state:void 0,pattern_name:void 0},h={id:s.id,version:0,space_id:(0,n.CG)(l.pointer.spaceId),parent_table:r.v,parent_id:u.id,alive:!0,format:d,schema:{}};m[o]=s.id,g.sW({store:s,data:h,transaction:c})}));const h={id:u.id,version:0,space_id:(0,n.CG)(l.pointer.spaceId),parent_table:r.v,parent_id:l.id,alive:!0,format:{attributes:[{id:"title",name:"title",type:"inline",format:{type:"title",section:"title"},values:[(0,d.ni)({pattern:o,integration:s})]}],bot_id:void 0,external_object_id:void 0,uri:`notion://user-defined-collection/${s.id}/${o.name}`,integration_id:s.id,is_placeholder:void 0,original_url:void 0,domain:void 0,external_schema:o.connected_relation_properties,sync_state:void 0,pattern_name:o.name,related_external_object_uris_to_instance_ids:m},schema:{}};return g.sW({store:u,data:h,transaction:c}),u}},92108:(e,t,o)=>{o.d(t,{wk:()=>V,Tz:()=>O,OM:()=>K,qo:()=>Y,oG:()=>G,dd:()=>X,Nh:()=>U,a9:()=>z});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(15145),c=o(86658),d=o(74686),p=o(47779),u=o(65917),m=o(2911),g=o(71644),h=o(63143),f=o(5366),v=o(54642),y=o(97464),b=o.n(y),S=o(480),w=o(24405),k=o(3779),C=o(10182),_=o(89728);const M=function(){const e=(0,S.O7)(),t=(0,w.Fg)();return s.createElement(s.Fragment,null,n()(_.Z,{onClick:()=>K(e,{necessary:!0,performance:!0,preference:!0,targeting:!0})},void 0,n()("b",{style:{color:t.contentBackground}},void 0,s.createElement(f.FormattedMessage,c.ze.acceptAllButtonLabel))),n()(_.Z,{onClick:()=>K(e,{necessary:!0,performance:!1,preference:!1,targeting:!1})},void 0,n()("b",{style:{color:t.contentBackground}},void 0,s.createElement(f.FormattedMessage,c.ze.rejectAllButtonLabel))),n()(C.Z,{hasDismissButton:!0,renderOrigin:e=>s.createElement(_.Z,b()({style:{paddingLeft:8,paddingRight:8}},e),k.Z.dots({width:14,marginLeft:4,fill:t.contentBackground}))}))};var T=o(42402),I=o(51456),P=o(12955),x=o(33929),B=o(36867),Z=o(79315),E=o(61893),R=o(45293),A=o(1310),D=o(50906),F=o(47307);const L=(0,f.defineMessages)({cookieConsentSaveError:{id:"cookieConsent.saveError",defaultMessage:"Cannot record cookie consent, please try again later.",description:"Shown in a dialog popup when there is an error with saving cookie consent."}});async function V(e){const{environment:t,onboardingState:o}=e;if(await N(t))return(0,B.g)(t.currentUser.id)>=2?(j(),R.Z.setState({open:!0}),D.trackCookieBannerShown({environment:t,type:"modal",onboardingState:o}),void D.trackCookieModalShown(t)):void(A.ZP.state.currentItem||(A.ZP.setState({...A.ZP.state,currentItem:{key:(0,g.ZP)(),label:n()("div",{},void 0,(0,c.Fd)(O,"snackbar")),button:n()(M,{})}}),D.trackCookieBannerShown({environment:t,type:"snackbar",onboardingState:o})))}async function N(e){if(!(0,P.canSetCookie)(e))return!1;if(!(0,P.canShowCookieUi)(e))return!1;const t=await(0,P.getHasPermissionArgs)(e);return"true"===(null==t?void 0:t.notion_check_cookie_consent)&&(null==t||!t.notion_cookie_consent)}function O(e,t){return window.__c={n:"renderLinkFn"},n()(T.Z,{href:e},void 0,t)}function U(e,t){if("necessary"===t)return;const o={...E.Z.getState().permission};o[t]=!o[t],E.Z.setPermission(o),H(e,o)}const H=a().debounce(((e,t)=>{z(e,t)}),2e3);async function z(e,t){const o=await v.recordCookieConsent(e,{id:E.Z.getId(),permission:t,document_version:c.fV,userId:e.currentUser.id}).catch((e=>{W({type:"recordCookieConsentError",error:(0,m.Ui)(e)})}));if(!o)return void W({type:"recordCookieConsentEmptyResult"});if("success"!==o.type)return void W({type:"recordCookieConsentReturnsNonSuccess",data:{miscDataToConvertToString:{result:o}}});const i=o.data;await E.Z.setCookieConsent(e,i),l.e9();const n=await I.getDeviceIdForAnalytics(e),r=l.Zk(n);await p.Pv(r);const{permission:a}=i;I.track(e,"record_cookie_consent",{permission:a,consent_type:(0,d.JT)(a)})}function W(e){let{type:t,data:o,error:i}=e;F.showErrorMessage(x.default.formatMessage(L.cookieConsentSaveError)),u.log({level:"error",from:"cookieActions",type:t,data:o,error:i})}function j(){A.ZP.setState({...A.ZP.state,currentItem:void 0})}function K(e,t){z(e,t),j(),Y()}function Y(){F.showMessage({message:x.default.formatMessage(c.ze.reloadAfterSaveMessage),onAccept:()=>{window.location.reload()}})}async function G(e){const{currentUserSettingsStore:t}=Z.default.state;if(!t)return;await t.load();const o=t.getSettings();if(!o)return;const i=o.cookie_consent;i?(await E.Z.setCookieConsent(e,i),j()):(E.Z.clearCookieConsent(),await N(e)&&E.Z.setPermission(c.cW))}async function X(e){const t=await(0,P.getCookieConsentCookie)(e);if(!t)return;const o=(0,h.dj)(t);o&&E.Z.setState(o)}},41433:(e,t,o)=>{o.d(t,{fC:()=>k,ZI:()=>C,jf:()=>_});var i=o(80951),n=o(51060),r=o(42875),a=o(59730),s=o(15157),l=o(63149),c=o(4615),d=o(21202),p=o(19889),u=o(70203),m=o(79727),g=o(16472),h=o(95477),f=o(15517),v=o(79315),y=o(3815),b=o(50906),S=o(96802),w=o(9953);function k(e){var t,o,i;const{environment:n,createBlockItem:r,from:a,inMemoryRecordCache:s,transaction:l}=e;if(!r.templateRootBlockId||!r.createTemplate)throw new Error("Invalid createBlock item.");const p=(null===(t=v.default.state.currentSpaceStore)||void 0===t?void 0:t.id)??(null===(o=v.default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.getSpaceId()),{targetBlock:u}=C({environment:n,sourceBlockId:r.templateRootBlockId,targetBlockPointer:{id:(0,c.ZP)(),table:d.iU,spaceId:p},sourceBlockSubtree:r.createTemplate(n),targetRecordCache:s,transaction:l,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1});var m;(null===(i=r.postCreateCallback)||void 0===i||i.call(r,u),_({store:u,transaction:l}),a&&r.blockType)&&b.trackCreateBlock(n,{from:a,type:r.blockType,collection_id:u.getParentCollectionId()??(null===(m=u.getCollectionViewCollectionStore())||void 0===m?void 0:m.id),collection_view_type:r.collectionViewType,is_toggleable:r.isToggleable,automation_id:u.getAutomationId()});return u}function C(e){const{environment:t,sourceBlockId:o,sourceBlockSubtree:i,targetBlockPointer:s,targetRecordCache:l,transaction:c,deepCopyTransclusionContainers:d,resolveTemplateVariables:u,recordPointerMap:m}=e,{duplicateRecordMap:g,originalToDuplicate:f}=n.PZ({sourceBlockId:o,targetBlockPointer:s,recordMap:i,recordPointerMap:m,options:{deepCopyTransclusionContainers:d,resolveTemplateVariables:!!u&&{currentUserId:t.currentUser.id,currentTimeZone:(0,r.r)()}},baseUrl:h.Z.domainBaseUrl,publicDomainName:h.Z.publicDomainName,actor:t.currentUser.id?{table:p.KJ,id:t.currentUser.id}:void 0,getRecordRole:l.makeGetRecordRoleFn(t.currentUser.id)}),v=new y.G(t,s,{inMemoryRecordCache:l});c.postPerformAssertions.push((function(){if(c.isLocal)return;if(!v.getParentStore())throw new a.p8(`Initialized template was not given a parent before being committed in transaction ${c.getUserActionForAnalyticsPurposesOnly()}`)}));for(const{pointer:n,value:r}of g){const e=(0,y.Kv)(v,n);r&&w.sW({store:e,data:r,transaction:c})}return{targetBlock:v,originalToDuplicate:f}}function _(e){const{store:t,transaction:o}=e;"code"===t.getType()?function(e){const{store:t,transaction:o}=e,n=t.getProperties(),r=t.getFormat(),a=t.environment.currentUser.id,c=s.Z.get({userId:a,key:m.Z.localLanguagePreferenceKey}),d=c&&l.W[c]?c:m.Z.defaultLanguage,p=s.Z.get({userId:a,key:m.Z.localCodeWrapPreferenceKey}),g=t.getBlockTitleStore(),h=g.getValue(),f=u.vN(h);f&&w.sO({store:g,value:f,transaction:o});void 0===n.language&&w.sW({store:t.getPropertiesStore(),data:{language:i.O2(d)},transaction:o});void 0===r.code_wrap&&w.sW({store:t.getFormatStore(),data:{code_wrap:p},transaction:o})}({store:t,transaction:o}):"table_of_contents"===t.getType()?function(e){const{store:t,transaction:o}=e;void 0===t.getFormat().block_color&&S.FH({stores:[t],update:{block_color:"gray"},transaction:o})}({store:t,transaction:o}):"callout"===t.getType()?function(e){const{store:t,transaction:o}=e,i=t.environment.currentUser.id,n=s.Z.get({userId:i,key:f.nF})||"💡",r=s.Z.get({userId:i,key:f.Ns})||"gray_background",a=t.getFormat();void 0===a.block_color&&S.FH({stores:[t],update:{block_color:r},transaction:o});void 0===a.page_icon&&S.FH({stores:[t],update:{page_icon:n},transaction:o})}({store:t,transaction:o}):"quote"===t.getType()&&function(e){const{store:t,transaction:o}=e,i=t.environment.currentUser.id,n=s.Z.get({userId:i,key:g.Z.localSizePreferenceKey});void 0!==n&&w.sW({store:t.getFormatStore(),data:{quote_size:n},transaction:o})}({store:t,transaction:o})}},78519:(e,t,o)=>{o.r(t),o.d(t,{initialize:()=>r});var i=o(79315),n=o(54642);async function r(e,t){if(await i.default.waitUntilRendered(),e.currentUser.isLoggedIn()&&!Boolean(t.fromPageRefresh)){const{CsatMilestoneStore:t}=e,o=await n.getCsatMilestones(e,{});"success"===o.type&&t.setState({data:o.data})}}},79257:(e,t,o)=>{o.d(t,{bA:()=>d,xv:()=>p,M0:()=>u,W4:()=>m,Do:()=>g,D2:()=>h});var i=o(85680),n=o(98452),r=o(52258),a=o(50906),s=o(6404),l=o(96802),c=o(30149);function d(e){const{originRect:t}=e;r.Z.reset(),n.Z.reset(),s.xv(),i.Z.setState({isOpen:!0,rect:t})}function p(){i.Z.setState({isOpen:!1})}function u(e){const{format:t,store:o,property:i,visibility:n,transaction:r}=e,a=t.property_visibility;a&&r&&l.FH({stores:[o],update:{property_visibility:Object.values(a||{}).map((e=>({property:e.property,visibility:i===e.property?n:e.visibility})))},transaction:r})}function m(e){const{store:t,pageSection:o,visibility:i,environment:n,format:r}=e,s=r.page_section_visibility;s&&(a.trackUpdatePageSectionVisibility(n,{section:o,visibility:i}),c.createAndCommit({userAction:"customizePageActions.updatePageSectionVisibility",environment:n,perform:e=>{l.FH({stores:[t],update:{page_section_visibility:{...s,[o]:i}},transaction:e})}}))}function g(e){const{store:t,transaction:o,pageSectionFormats:i}=e;l.FH({stores:[t],update:{collection_page_sections:i},transaction:o})}function h(e){const{store:t,properties:o,environment:i}=e;c.createAndCommit({userAction:"customizePageActions.updateCollectionPageProperties",environment:i,perform:e=>{l.FH({stores:[t],update:{collection_page_properties:o},transaction:e})}})}},67133:(e,t,o)=>{o.d(t,{b:()=>a,x:()=>s});var i=o(28748),n=o(24677),r=o(98104);function a(e,t){n.ZH(e),r.ZH(e),i.Z.setState({open:!0,...t})}function s(){i.Z.setState({open:!1,originRect:i.Z.state.originRect})}},31900:(e,t,o)=>{o.r(t),o.d(t,{DEV_ONLY_createTemporaryBlock:()=>d});var i=o(26263),n=o(41432),r=o(94419),a=o(9953),s=o(993),l=o(30149),c=o(28020);function d(e,t){const o=new i.Z;return o.isTemporaryData=t,e.defaultRecordCache.inMemoryRecordCache.addCacheOverride(o),l.createAndCommit({userAction:"debuggingActions.DEV_ONLY_createTemporaryBlock",environment:e,perform:i=>{var l;const d=null===(l=c.RM())||void 0===l?void 0:l.pointer.spaceId,p=a.j4({environment:e,type:n.Ti.text,inMemoryRecordCache:o,transaction:i,spaceId:d}),u=p.getTitleStore();if(!u)throw new Error("Text block has no title store!");const m=t?"never be sent to the server":"result in a server transaction error if you edit it";s.mM({environment:e,store:u,tokens:[[`Here is a temporary block that will ${m}. To remove it, either call the callback returned by the function that created this block, or reload the page.`]],index:0,transaction:i});const g=c.np();if(!g)throw new Error("Current page not found!");const h=g.getContentStore().clone(o);r.BE({parent:h,insert:p,after:void 0,transaction:i})}}),()=>{e.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(o)}}},84823:(e,t,o)=>{o.d(t,{bO:()=>M,uU:()=>T,JJ:()=>I,QO:()=>P,A1:()=>x,V2:()=>B,Pk:()=>Z});var i=o(15070),n=o(20270),r=o(4615),a=o(89101),s=o(77420),l=o(49953),c=o(9844),d=o(19889),p=o(97880),u=o(44876),m=o(36054),g=o(50906),h=o(76463),f=o(47307),v=o(81677),y=o(95477),b=o(43348),S=o(79315),w=o(3815),k=o(9953),C=o(5978),_=o(30149);function M(e){const{environment:t,integrationStore:o}=e;_.createAndCommit({userAction:"developerIntegrationActions.setIntegrationSecretView",environment:t,perform:e=>{!function(e){const{integrationStore:t,transaction:o}=e,i=(0,w._J)(t,t.pointer,["info"]);k.sW({store:i,data:{has_viewed_secret:!0},transaction:o})}({integrationStore:o,transaction:e})}})}async function T(e){const{environment:t,recordStore:o}=e;function i(){g.trackDeveloperIntegrationsConfirmDeleteClick(t,{table:o.table})}o.table===s.cZ?await h.P0({environment:t,botId:o.id,onSuccess:i}):o.table===c.K2?await v.M4({environment:t,integrationId:o.id,onSuccess:i}):(0,p.t1)(o)}function I(e){const{environment:t,formState:o,formData:n}=e;return"create-bot"===o.type?function(e){const{environment:t,formData:o}=e,{currentUserRootStore:i}=S.default.state;if(!i)return;const{botStore:n}=h.lz({environment:t,name:o.name,icon:o.icon,userId:i.id,spaceStore:o.space,spaceRole:"none",type:"guest",capabilities:o.capabilities||{read_content:!0,insert_content:!0,update_content:!0,read_user_without_email:!0,read_user_with_email:!0}});return B(t,{id:n.id,table:s.cZ,spaceId:o.space.id}),g.trackDeveloperIntegrationsCreate(t,{table:s.cZ}),{id:n.id,table:s.cZ,spaceId:o.space.id}}({environment:t,formData:n}):"update-bot"===o.type?function(e){const{environment:t,botPointer:o,formData:i}=e,{currentUserRootStore:n}=S.default.state;if(!n)return;const r=w.t1.createChildStore(n,o);return _.createAndCommit({userAction:"developerIntegrationActions.updateBot",environment:t,perform:e=>{k.sW({store:r,data:{name:i.name,icon:i.icon,parent_id:i.space.id,last_edited_by_id:n.id,last_edited_by_table:d.KJ,last_edited_at:Date.now(),capabilities:i.capabilities},transaction:e}),e.postSubmitCallbacks=[e=>{e&&f.showErrorMessage(e.message)}]}}),g.trackDeveloperIntegrationsUpdate(t,{table:s.cZ}),o}({environment:t,botPointer:{id:o.startingRecord.value.id,table:o.startingRecord.table,spaceId:o.startingRecord.value.space_id},formData:n}):"create-guest-integration"===o.type?function(e){const{environment:t,botPointer:o,formData:n}=e,{currentUserRootStore:r}=S.default.state;if(!r)return;const a=w.t1.createChildStore(r,o),s=a.isDefined()&&(0,i.hA)(a.getModel())?a.getCapabilities():{read_content:!0,insert_content:!0,update_content:!0,read_user_without_email:!0,read_user_with_email:!0},l={name:n.name,tagline:n.tagline,icon:n.icon,email:n.email,website_url:n.website_url,privacy_policy_url:n.privacy_policy_url,terms_of_use_url:n.terms_of_use_url,template_page_id:n.template_page_id,redirect_uris:n.redirect_uris,capabilities:s,userRootStore:r,developer_name:n.developer_name},{performResult:p}=_.createAndCommit({userAction:"developerIntegrationActions.integrationId",environment:t,perform:e=>{const o=v.Do(t,e,l).id;return k.sW({store:a,data:{integration_id:o,parent_table:d.KJ,parent_id:r.id},transaction:e}),e.postSubmitCallbacks=[e=>{e&&f.showErrorMessage(e.message)}],o}}),u={id:p,table:c.K2};return B(t,u),g.trackDeveloperIntegrationsCreate(t,{table:c.K2,template_id:n.template_page_id}),u}({environment:t,botPointer:{id:o.startingRecord.value.id,table:o.startingRecord.table,spaceId:o.startingRecord.value.space_id},formData:n}):"update-guest-integration"===o.type?function(e){var t;const{environment:o,integrationPointer:i,formData:n}=e,{currentUserRootStore:r}=S.default.state;if(!r)return;const a=w.t1.createChildStore(r,i),s=a.isType("guest")?null===(t=a.getInfo())||void 0===t?void 0:t.template_page_id:void 0,l={name:n.name,redirect_uris:n.redirect_uris,capabilities:n.capabilities},d={tagline:n.tagline,icon:n.icon,email:n.email,website_url:n.website_url,privacy_policy_url:n.privacy_policy_url,terms_of_use_url:n.terms_of_use_url,template_page_id:n.template_page_id,developer_name:n.developer_name},p=(0,w._J)(a,a.pointer,["info"]);_.createAndCommit({userAction:"developerIntegrationActions.updateIntegration",environment:o,perform:e=>{k.sW({store:a,data:l,transaction:e}),k.sW({store:p,data:d,transaction:e}),e.postSubmitCallbacks=[e=>{e&&f.showErrorMessage(e.message)}]}});const u=n.template_page_id??void 0,m=s!==u;return g.trackDeveloperIntegrationsUpdate(o,{table:c.K2,...m&&{template_id_before:s},...m&&{template_id_after:u}}),i}({environment:t,integrationPointer:{id:o.startingRecord.value.id,table:o.startingRecord.table},formData:n}):"create-third-party-external-integration"===o.type?function(e){const{environment:t,formData:o}=e,{currentUserRootStore:i}=S.default.state;if(!i)return;const n=(0,r.ZP)(),a=E({integrationId:n,formData:o,currentIntegrationInfo:void 0});if(!a)return;const s=R(o);if(!s)return;const l=s.oauth_authorize_url;_.createAndCommit({userAction:"developerIntegrationActions.createThirdPartyExternalIntegration",environment:t,perform:e=>{v.GB(t,e,{integrationId:n,name:o.name,redirect_uris:[l],userRootStore:i,integrationInfo:a}),v.xt(t,e,{integrationId:n,userRootStore:i,config:s}),e.postSubmitCallbacks=[e=>{e&&f.showErrorMessage(e.message)}]}});const d={id:n,table:c.K2};return B(t,d),g.trackDeveloperIntegrationsCreate(t,{table:c.K2}),d}({environment:t,formData:n}):"update-third-party-external-integration"===o.type?function(e){const{environment:t,integrationId:o,formData:i}=e,{currentUserRootStore:n}=S.default.state;if(!n)return;const r={table:c.K2,id:o},a=R(i);if(!a)return;const s=w.t1.createChildStore(n,{table:l.r9,id:o}),d={oauth_authorize_url:a.oauth_authorize_url,oauth_token_url:a.oauth_token_url,client_id:a.client_id,client_secret:a.client_secret,scopes:a.scopes||null,deletion_url:a.deletion_url||null},p=w.t1.createChildStore(n,r),u=a.oauth_authorize_url,m={name:i.name,redirect_uris:[u],capabilities:i.capabilities},h=(0,w._J)(p,p.pointer,["info"]),v=E({integrationId:o,formData:i,currentIntegrationInfo:h.getValue()});if(!v)return;return _.createAndCommit({userAction:"developerIntegrationActions.updateThirdPartyExternalIntegration",environment:t,perform:e=>{k.sW({store:p,data:m,transaction:e}),k.sW({store:h,data:v,transaction:e}),k.sW({store:s,data:d,transaction:e}),e.postSubmitCallbacks=[e=>{e&&f.showErrorMessage(e.message)}]}}),g.trackDeveloperIntegrationsUpdate(t,{table:c.K2}),r}({environment:t,integrationId:o.startingRecord.value.id,formData:n}):"update-first-party-external-integration"===o.type?function(e){const{environment:t,integrationId:o,formData:i}=e,{currentUserRootStore:n}=S.default.state;if(!n)return;const r={table:c.K2,id:o},a=w.t1.createChildStore(n,r),s={name:i.name,capabilities:i.capabilities},l=(0,w._J)(a,a.pointer,["info"]),d=E({integrationId:o,formData:i,currentIntegrationInfo:l.getValue()});if(!d)return;return _.createAndCommit({userAction:"developerIntegrationActions.updateFirstPartyExternalIntegration",environment:t,perform:e=>{k.sW({store:a,data:s,transaction:e}),k.sW({store:l,data:d,transaction:e}),e.postSubmitCallbacks=[e=>{e&&f.showErrorMessage(e.message)}]}}),g.trackDeveloperIntegrationsUpdate(t,{table:c.K2}),r}({environment:t,integrationId:o.startingRecord.value.id,formData:n}):(0,p.t1)(o)}function P(e){const{environment:t,integrationId:o,allVerifiedDomains:i,domainToRemove:n}=e,{currentUserRootStore:r}=S.default.state;if(!r)return;const a=w.t1.createChildStore(r,{table:c.K2,id:o}),s=(0,w._J)(a,a.pointer,["info"]);_.createAndCommit({userAction:"developerIntegrationActions.removeVerifiedDomain",environment:t,perform:e=>{k.sW({store:s,data:{original_url_domains:i.filter((e=>e!==n))},transaction:e}),e.postSubmitCallbacks=[e=>{e&&f.showErrorMessage(e.message)}]}}),g.trackDeveloperIntegrationsUpdate(t,{table:c.K2})}function x(e){C.navigate({environment:e,url:a._j.myIntegrations})}function B(e,t){const o={[s.cZ]:"internal",[c.K2]:"public"}[t.table],i=(0,r.cj)(t.id);C.navigate({environment:e,url:`${a._j.myIntegrations}/${o}/${i}`})}function Z(e){const t=(0,r.cj)(e.id);return`${y.Z.domainBaseUrl}${a._j.myIntegrations}/public/${t}/lab`}function E(e){var t;const{integrationId:o,formData:i,currentIntegrationInfo:r}=e,a=(null==r||null===(t=r.original_url_patterns)||void 0===t?void 0:t.filter((e=>{var t;return!0===(null===(t=e.additional_types)||void 0===t?void 0:t.collection)})))??[],s=i.url_matching_and_placeholder.map((e=>{const t=[];for(const o of e.attributes){const e=(0,u.GY)(o);if(!(0,n.nj)(e))return;t.push(e)}return{name:(0,b.X)({patternName:e.name,integrationId:o}),regex:e.regex,attributes:t,sample_urls:e.sampleUrls}})).filter(p.$K),l=i.domain.domainVerifications.filter((e=>"unverified"===e.type)).map((e=>e.domain));return{tagline:i.tagline,icon:i.icon,email:i.email,website_url:i.website_url,privacy_policy_url:i.privacy_policy_url,terms_of_use_url:i.terms_of_use_url,developer_name:i.developer_name,unfurl_url:i.unfurl_url,developer_space_id:i.developer_space.id,development_url_domains:l,original_url_patterns:[...s,...a],dark_icon:(null==r?void 0:r.dark_icon)??i.icon,accent_color:(null==r?void 0:r.accent_color)??{r:36,g:41,b:47},accent_icon:(null==r?void 0:r.accent_icon)??i.icon}}function R(e){const t={oauth_authorize_url:e.external_oauth_authorize_url,oauth_token_url:e.external_oauth_token_url,client_id:e.external_client_id,client_secret:e.external_client_secret,scopes:e.external_oauth_scopes,deletion_url:e.external_deletion_url};return(0,m.Gu)(l.wG,t)?void 0:t}},47307:(e,t,o)=>{o.r(t),o.d(t,{showDialog:()=>d,showErrorMessage:()=>p,showThrottledErrorMessage:()=>u,showError:()=>m,showMessage:()=>g,showFatalError:()=>h,confirmUserAction:()=>f,dismissDialog:()=>v});var i=o(96486),n=o.n(i),r=o(5366),a=o(33954),s=o(33929),l=o(33784);const c=(0,r.defineMessages)({dismissButtonLabel:{defaultMessage:"Okay",id:"dialog.dismissButton.label"},acceptButtonLabel:{defaultMessage:"Confirm",id:"dialog.acceptButton.label",description:"Default message for the accept button in confirmation dialog."},cancelButtonLabel:{defaultMessage:"Cancel",id:"dialog.cancelButton.label",description:"Button label for closing the modal without doing the action."},genericErrorMessage:{id:"dialog.genericErrorMessage",defaultMessage:"An unexpected error occurred"}}),d=function(e){l.Z.reset(),l.Z.setState({...e,open:!0})};function p(e){e||(e=s.default.formatMessage(c.genericErrorMessage)),d({message:e,showCancel:!1,keepFocus:!1,items:[{label:s.default.formatMessage(c.dismissButtonLabel),onAccept:n().identity}]})}const u=n().throttle(p,3e4);function m(e){p((0,a.wf)(s.default.getIntl(),e))}const g=function(e){const{message:t,onAccept:o,innerStyle:i}=e;d({message:t,showCancel:!1,keepFocus:!1,items:[{label:s.default.formatMessage(c.dismissButtonLabel),onAccept:o||n().identity}],innerStyle:i})},h=function(e){const{message:t}=e;d({message:t,showCancel:!1,keepFocus:!0,items:[],fatal:!0})},f=function(e){return new Promise((t=>{d({showCancel:!1,keepFocus:!1,message:e.message,description:e.description,items:[{label:e.acceptLabel||s.default.formatMessage(c.acceptButtonLabel),color:"red",onAccept:()=>{t(!0)}},{label:e.cancelLabel||s.default.formatMessage(c.cancelButtonLabel),onAccept:()=>{t(!1)}}]})}))},v=()=>{l.Z.setState({...l.Z.state,open:l.Z.state.fatal||!1})}},96514:(e,t,o)=>{o.d(t,{DF:()=>E,YF:()=>R,Gu:()=>A,DX:()=>D,bh:()=>F,Xi:()=>L,T4:()=>N,tR:()=>O,cj:()=>U,Zo:()=>z,en:()=>K,Y0:()=>Y,AM:()=>G});var i=o(96486),n=o.n(i),r=o(1302),a=o(80357),s=o(4615),l=o(98459),c=o(70279),d=o(33709),p=o(70203),u=o(63143),m=o(94419),g=o(53471),h=o(28020),f=o(65598),v=o(77546),y=o(72133),b=o(46351),S=o(95802),w=o(24229),k=o(56681),C=o(35973),_=o(3815),M=o(50906),T=o(54564),I=o(72747),P=o(9953),x=o(61045),B=o(3898),Z=o(30149);function E(e){const{environment:t,store:o,text:i,files:n,transaction:r,discussionLocation:a}=e,{filesToCreate:s,fileStoresToDelete:l}=function(e,t){const o=[],i=new Set;t.forEach((e=>{"local"===e.type?o.push(e.file):i.add(e.id)}));const n=f.le(e).filter((e=>e.getAlive()&&!i.has(e.id)));return{filesToCreate:o,fileStoresToDelete:n}}(o,n);z({commentStore:o,fileBlocks:l,transaction:r}),j({commentStore:o,files:s,environment:t,transaction:r});const c=f.zP(o);P.sO({store:c,value:i,transaction:r}),W(o,r),M.trackEditComment(t,{from:a,comment_id:o.id,discussion_id:o.getParentId()})}function R(e){const{environment:t,commentStore:o,transaction:i}=e,n=f.GP(o);if(!n)return;const r=f.ak(n),a=r.getValue();if(!a)return;z({commentStore:o,fileBlocks:f.le(o),transaction:i}),P.sW({store:o,transaction:i,data:{alive:!1}}),Z.applyOperation({store:r,operation:{pointer:r.pointer,path:r.path,command:"listRemove",args:{id:o.id}},transaction:i}),(0===a.length||1===a.length&&a[0]===o.id)&&function(e){const{discussionStore:t,transaction:o}=e,i=f.HK(t);i&&A({discussionStore:t,transaction:o,blockStore:i});const n=h.RM();if(n){const e=f.MI(n);for(const n of e){if(i&&n.table===i.table&&n.id===i.id)continue;const e=f.x8(n).getValue();null!=e&&e.includes(t.id)&&A({discussionStore:t,transaction:o,blockStore:n})}}}({discussionStore:n,transaction:i}),W(o,i),M.trackDeleteComment(t,{from:e.discussionLocation,discussion_id:n.id,comment_id:o.id})}function A(e){const{discussionStore:t,blockStore:o,transaction:i}=e,n=f.x8(o);Z.applyOperation({store:n,operation:{pointer:n.pointer,path:n.path,command:"listRemove",args:{id:t.id}},transaction:i}),V({store:o,discussionId:t.id,transaction:i})}function D(e){var t,o;const{environment:i,discussionStore:n,transaction:r}=e;if(w.Z.state.open){var a;const e=null===(a=w.Z.state.discussionIds)||void 0===a?void 0:a.filter((e=>e!==n.id));w.Z.setState({...w.Z.state,discussionIds:e,open:((null==e?void 0:e.length)||0)>0})}P.sW({store:n,data:{resolved:!0},transaction:r}),C.Z.setState({...C.Z.state,discussionIds:(null===(t=C.Z.state)||void 0===t||null===(o=t.discussionIds)||void 0===o?void 0:o.filter((e=>e!==n.id)))||[]}),M.trackResolveDiscussion(i,e.discussionLocation)}function F(e){const{environment:t,discussionStore:o,transaction:i}=e;P.sW({store:o,data:{resolved:!1},transaction:i}),M.trackReopenDiscussion(t,e.discussionLocation)}function L(e){const{environment:t,discussionStore:o,textValue:i,transaction:r,files:a}=e,{id:s}=t.currentUser;if(!s)return;const l=g.dm(a);if(n().isEqual(i,[])&&0===l.length)return;const c=H({discussionStore:o,text:i,files:l,environment:t,transaction:r});M.trackAddComment(t,{from:e.discussionLocation,comment_id:c.id,discussion_id:o.id})}const V=e=>{const{store:t,transaction:o,discussionId:i}=e,r=f.p9(t),a=r.getValue()||{};if(a){const e=Object.keys(a);for(const t of e){let e=!1;const s=(a[t]||[]).map((t=>{const o=p.Wi(t),r=p.hD(t),a=r.filter((e=>!n().isEqual(e,["m",i])));return e=e||r.length!==a.length,p.V3(o,a)}));e&&P.sW({store:r,data:{[t]:p.Zx(s)},transaction:o})}}};function N(e){const t=b.Z.find((t=>t.getStore().id===e&&!t.isSidebarFormat()&&!t.isMarginFormat()));if(t){const e=t.getNode();if(e&&e.parentElement){const t=Array.from(e.parentElement.children).indexOf(e);v.Wr(e,{edgeDist:0===t?0:-1,animate:!1})}}}function O(e){const{transaction:t,blockStore:o,discussionId:i}=e,n=f.x8(o);Z.applyOperation({store:n,operation:{pointer:n.pointer,path:n.path,command:"listAfter",args:{id:i}},transaction:t})}function U(e){const{context:t,blockStore:o,environment:i,transaction:n,commentTextValue:r,files:a,discussionId:c=(0,s.ZP)()}=e,d=P.ae({environment:i,table:"discussion",value:{id:c,parent_id:o.id,parent_table:o.table,resolved:!1,context:t,space_id:(0,l.CG)(o.pointer.spaceId)},inMemoryRecordCache:o.inMemoryRecordCache,transaction:n});return O({transaction:n,blockStore:o,discussionId:d.id}),H({discussionStore:d,text:r,files:a,environment:i,transaction:n}),d}function H(e){const{discussionStore:t,files:o,text:i,environment:n,transaction:r}=e,a=P.ae({environment:n,table:c.x_,value:{parent_id:t.id,parent_table:t.table,alive:!0,space_id:t.pointer.spaceId},inMemoryRecordCache:t.inMemoryRecordCache,transaction:r}),s=f.ak(t);m.R3({parent:s,append:a,transaction:r});const l=f.zP(a);return P.sO({store:l,value:i,transaction:r}),j({commentStore:a,files:o,environment:n,transaction:r}),W(a,r),a}function z(e){const{commentStore:t,fileBlocks:o,transaction:i}=e,n=f.ig(t);o.forEach((e=>{P.sW({store:e,data:{alive:!1},transaction:i}),m.Od({parent:n,childToRemove:e,transaction:i})}))}function W(e,t){const o=f.bQ(e);P.sO({store:o,value:(0,u.ud)(Date.now()),transaction:t})}function j(e){const{environment:t,files:o,commentStore:i,transaction:n}=e,r=h.qQ(t),a=f.ig(i);I.z({files:o,environment:t,inMemoryRecordCache:i.inMemoryRecordCache,transaction:n,pageWidth:r,ignoreOversizedFiles:!0,spaceId:a.pointer.spaceId}).forEach((e=>{m.R3({parent:a,append:e,transaction:n})}))}async function K(e){let{discussionId:t,currentBlockStore:o,environment:i,analyticsFrom:n,currentEl:s}=e;if(!o)return null;const c=_.t1.createChildStore(o,{table:d.qF,id:t,spaceId:(0,l.CG)(o.pointer.spaceId)});if(!c.isDefined())return;function p(e){const o=function(e){var t;let o,{discussionId:i,blockId:n}=e;const r=null===(t=document.getElementsByClassName(`${(0,a.dk)({discussionId:i})}`))||void 0===t?void 0:t[0];r&&(o=S.C.findSelectableFromChildNode(r)),o||(o=S.C.findScrollToSelectablesFromIds([n])[0]);return o}({discussionId:t,blockId:e});if(!o)return;const i=document.getElementsByClassName(`discussion-id-${t}`)[0];return i?x.bx({element:i,scrollers:{verticalScroller:o.getContextVerticalScroller(),horizontalScroller:o.getContextHorizontalScroller()},vertical:{reveal:"top"},horizontal:{reveal:"closest"},animate:!0}):x.NQ({component:o,vertical:{reveal:"top"},horizontal:{reveal:"closest"},animate:!0}),o.displaySelectionHalo(750),o}p(c.getParentId())||(await B.Nz(o,[c.getParentId()]),await r.default.afterNextFlush(),p(c.getParentId()));const u=_.G.createChildStore(o,c.getParentPointer()),m=y.get(),g=null==m?void 0:m.commonAncestorContainer,h=!(null!=m&&m.collapsed)&&g&&(s===g||(null==s?void 0:s.contains(g)));T.Ib({environment:i,blockStore:u||o,analyticsFrom:n,discussionIds:[t],shouldFocusDiscussion:!h,recursivelyLoadAllDiscussions:!1})}function Y(e){e!==k.Z.state.pageId&&k.Z.reset()}function G(e){const t={};e.forEach((e=>{t[e]=Date.now()})),k.Z.setState({...k.Z.state,...t})}},17503:(e,t,o)=>{o.d(t,{t:()=>a});var i=o(78089),n=o(79315),r=o(56681);function a(e){var t;let{discussionStore:o,commentStore:a}=e;if(!a.isDefined())return!1;const s=null===(t=n.default.state.currentUserStore)||void 0===t?void 0:t.id;const l=r.Z.state[o.id];if(a.getCreatedById()===s)return!1;const c=function(){if(!o.isDefined()||!s)return 0;const{pageVisitStore:e}=n.default.state,{lastViewTime:t,lastExitTime:i}=e.state;return i||t}();if(void 0===c)return!1;const d=(0,i.NI)(o).filter((e=>e.getCreatedById()===s)).reverse()[0],p=a.getCreatedTime();return!p||!(d&&p<d.getCreatedTime())&&(!(l&&p<l)&&p>c)}},42239:(e,t,o)=>{o.d(t,{cQ:()=>Z,fX:()=>E,_4:()=>R,td:()=>A,f$:()=>D,LQ:()=>F,eN:()=>L});var i=o(96486),n=o.n(i),r=o(41432),a=o(8848),s=o(15095),l=o(42875),c=o(4615),d=o(98459),p=o(97880),u=o(95477),m=o(51456),g=o(43250),h=o(78316),f=o(98165),v=o(41984),y=o(27406),b=o(81844),S=o(95802),w=o(55367),k=o(86486),C=o(27724),_=o(50906),M=o(47307),T=o(54532),I=o(42858),P=o(24677),x=o(98724),B=o(98104);function Z(e,t){w.ZP.state.isDragging&&(w.ZP.reset(),P.$Y({environment:e,phase:C.SelectionPhase.Selected,preventClearEditingText:t}))}function E(e){if(w.ZP.state.isDragging){const{draggedStores:a,currentDropZone:s}=w.ZP.state,l=e.optionKey;let d;if(s){var t,o,i;const e=s.type===w.Dl.Selectable?S.C.findSelectablesFromStore(s.store):y.Z.findDropTargetsFromKey(s.key);null===(t=e.find((e=>Boolean(e.props.onSelectableDrop))))||void 0===t||null===(o=t.props)||void 0===o||null===(i=o.onSelectableDrop)||void 0===i||i.call(o,{droppedDirection:s.direction,droppedStores:a,duplicate:l}),d=function(e,t){const o=t.props,i="store"in o?o.store:void 0,n=i?b.Z.findOutlinerItemFromStore(i):void 0,r=i&&f.VP(i),a=r&&(0,m.getTeamEventData)(r),s={...n&&{...a,type:n.type},..."analyticsName"in o&&{dropzone_from:o.analyticsName}};if(!e)return{...s,has_dropzone:!1};let l;switch(e.direction){case w.vh.Above:l="above";break;case w.vh.Below:l="below";break;case w.vh.Left:l="left";break;case w.vh.Onto:l="onto";break;case w.vh.Right:l="right";break;default:(0,p.t1)(e.direction)}if(e.type===w.Dl.Selectable)return{...s,has_dropzone:!0,dropzone_type:"selectable",dropzone_block_id:(0,c.cj)(e.store.id),dropzone_direction:l};return{...s,has_dropzone:!0,dropzone_type:"drop_target",dropzone_key:e.key,dropzone_direction:l}}(s,e[0])}const u=a.find((e=>{const t=e.getType();return Boolean(t&&(0,r.S9)(t))})),g=u&&f.VP(u),v=u&&(0,h.fm)(u);_.trackEditorDrag(e.environment,{draggedTypes:n().compact(a.map((e=>e.getType()))),from:e.analyticsFrom,asCopy:l,draggableProps:{draggable_from:e.analyticsFrom,...g&&(0,m.getTeamEventData)(g)},dropzoneProps:d,optionalAnalyticsProperties:{collectionContextStore:v}}),Z(e.environment),e.environment.device.isPhone&&P.ZH(e.environment)}}function R(e){const{environment:t,files:o,analyticsFrom:i}=e;if(w.ZP.state.isDragging){var n;const e=w.ZP.state.currentDropZone;let l;var r,a,s;if(e)l=e.type===w.Dl.Selectable?S.C.findSelectableFromStore(e.store):y.Z.findDropTargetFromKey(e.key),null===(r=l)||void 0===r||null===(a=r.props)||void 0===a||null===(s=a.onNativeDrop)||void 0===s||s.call(a,{files:o,droppedDirection:e.direction});_.trackEditorDrag(t,{draggedTypes:[],from:i,asCopy:!1}),Z(t,null===(n=l)||void 0===n?void 0:n.props.keepTextSelectionOnDrop)}}function A(e,t){w.ZP.state.isDragging&&(B.ZH(e),w.ZP.setState({...w.ZP.state,...t}))}function D(e,t){if(w.ZP.state.isDragging)return!1;{const{startX:o,startY:i,isNativeDrag:r}=t,a=P.aw(t.stores);B.ZH(e);const s=S.C.getRectFromStore(a[0]);return w.ZP.setState({isDragging:!0,startX:o,startY:i,currentX:o,currentY:i,offsetX:o-(s&&s.left||0),offsetY:i-(s&&s.top||0),currentHintDropZones:[],draggedStores:a,isNativeDrag:r,ghostElements:a.map((e=>t.getGhostElement?t.getGhostElement(e):function(e){const{store:t}=e,o=S.C.findSelectablesFromStore(t);return n().compact(o.map((e=>{if(e.props.canSelect){const t=e.getNode();if(t)return L(t)}})))}({store:e})))}),P.$Y({environment:e,phase:C.SelectionPhase.Selected}),k.default.reset(),!0}}function F(e){const{droppedStores:t,transaction:o,environment:i,duplicate:n}=e,a=e.resolveTemplateVariables;return t.map((e=>{if(!S.C.findSelectableFromStore(e))return e;if(n){const t=!e.isTransclusionType(),[n,s]=T.Qi({environment:i,store:e,addCopyName:(0,v.Z)(e),transaction:o,deepCopyTransclusionContainers:t,targetSpaceId:(0,d.CG)(e.pointer.spaceId),resolveTemplateVariables:e.getType()!==r.Ti.factory&&a,baseUrl:u.Z.domainBaseUrl,publicDomainName:u.Z.publicDomainName,preferDuplicateLocation:"local"});return s.then((e=>{e&&M.showErrorMessage(e)})),n}return a&&x.bt({store:e,context:{currentUserId:i.currentUser.id,currentTimeZone:(0,l.r)()},transaction:o}),I.Od({store:e,transaction:o}),e}))}function L(e){const t=e.style.transform,o=e.style.transition;e.style.transform="",e.style.transition="";const i=e.getBoundingClientRect();e.style.transform=t,e.style.transition=o;const n=e.cloneNode(!0);!function(e,t){const{firstElementChild:o}=e;if(o&&o.hasAttribute("embed-ghost")){const o=V(e,[]);if(o){const n=N(e,o),r=N(t,o);if(n&&r)if(n.shadowRoot){const e=n.shadowRoot;let t=null;if(r.createShadowRoot)t=r.createShadowRoot();else if(r.attachShadow)try{t=r.attachShadow({mode:"open"})}catch(i){}t&&(t.innerHTML=e.innerHTML)}else if(!n.src&&n.contentDocument){const e=document.createElement("iframe");e.width=n.offsetWidth,e.height=n.offsetHeight,O(e,r),r.parentElement.replaceChild(e,r),e.onload=t=>{const o=e.contentDocument.children[0],i=n.contentDocument.children[0];O(o,i),o.innerHTML=i.innerHTML}}else r.width=n.offsetWidth,r.height=n.offsetHeight,r.style.backgroundColor=a.ZP.blackWithAlpha(.12),r.style.backgroundImage=null,r.src=""}}}(e,n);const r=getComputedStyle(e);for(let a=0;a<r.length;a++){const e=r[a],t=r.getPropertyValue(e);"app-region"===e&&"none"===t||(n.style[e]=t)}"absolute"!==r.position&&"relative"!==r.position||(n.style.position="",n.style.top="",n.style.left="",n.style.bottom="",n.style.right="");const s=n.querySelectorAll(`.${g.No6}`);for(const a of s)a.remove();n.style.pointerEvents="none";const l=n.querySelectorAll("*");for(const a of l)a.style&&(a.style.pointerEvents="none");return{cloned:n,rect:i}}function V(e,t){if(e.shadowRoot)return t;if(e instanceof HTMLIFrameElement)return t;{const{firstElementChild:o,nextElementSibling:i}=e;if(o){t.push(0);const e=V(o,t);if(e)return e;t.pop()}if(i){t[t.length-1]+=1;const e=V(i,t);if(e)return e}return null}}function N(e,t){return t.reduce(((e,t)=>e&&e.children&&e.children[t]?e.children[t]:null),e)}function O(e,t){s.p4(t.attributes).forEach((t=>{let{name:o,value:i}=t;e.setAttribute(o,i)}))}},91584:(e,t,o)=>{o.d(t,{Ui:()=>y,WO:()=>b,vQ:()=>S,cR:()=>w,qN:()=>k,O$:()=>C});var i=o(98459),n=o(80984),r=o(64002),a=o(5366),s=o(50906),l=o(47307),c=o(84908),d=o(95477),p=o(71935),u=o(7844),m=o(39218),g=o(54642),h=o(92625),f=o(15356);const v=(0,a.defineMessages)({authenticatingWithGoogle:{id:"googleDriveActions.authenticatingWithGoogle.loadingMessage",defaultMessage:"Authenticating with Google…"},googleLoginTitle:{defaultMessage:"Google login",id:"googleDriveActions.loginWithGoogleModal.title"}});async function y(e){const{environment:t,store:o,fileId:n,token:r}=e;await m.transactionQueue.awaitRecordTransaction(o.pointer);const a=await g.initializeGoogleDriveBlock(t,{block:{id:o.id,spaceId:(0,i.CG)(o.pointer.spaceId)},fileId:n,token:r});if("failed"!==a.type)return a.data.file&&s.trackEmbedGoogleDriveFile(t,{file_type:a.data.file.mimeType??void 0}),a.data;l.showError(a)}function b(e,t){g.refreshGoogleDriveBlock(e,{block:t})}async function S(e){const t=await g.getGoogleDriveAccounts(e,{});return"success"===t.type&&t.data.accounts?t.data:{accounts:[]}}function w(e,t){const{onSuccess:o,onFailure:i}=t;u.Z.setState({open:!0,onConfirm:async()=>{const t=await k(e);t&&t.token?o(t.token):i&&i()},onDecline:i})}async function k(e){const t=(0,p.eC)(e);let o=(0,n.ZQ)(d.Z.domainBaseUrl,{authType:t});if(o=t.redirectToAuth?o:await(0,p.HU)(e,o),e.device.isElectron)return void c.openExternalUrl(o);const i=await f.M(e,{width:610,height:700,url:o,titleMessage:v.googleLoginTitle});if(!i)return;const a=r.Qc(i);return await C(e,a.query.code)}async function C(e,t){if(!t)return;h.j({message:v.authenticatingWithGoogle});const o=await g.authWithGoogleForDrive(e,{code:t});if(h.x(),"failed"!==o.type)return s.trackAuthIntegration(e,{integration_name:"google"}),o.data;{const e=o.error;console.error(e),l.showError(o)}}},54532:(e,t,o)=>{o.d(t,{E9:()=>A,WJ:()=>D,Qi:()=>F,K8:()=>L});var i=o(41432),n=o(51060),r=o(42875),a=o(64572),s=o(59753),l=o(29477),c=o(4615),d=o(45953),p=o(98963),u=o(18844),m=o(21202),g=o(6287),h=o(13493),f=o(29369),v=o(70203),y=o(5366),b=o(95477),S=o(33954),w=o(33929),k=o(35328),C=o(79315),_=o(88632),M=o(3815),T=o(50906),I=o(54642),P=o(41433),x=o(47307),B=o(29533),Z=o(9953),E=o(39865);const R=(0,y.defineMessages)({offlineError:{id:"duplicateActions.offlineError.message",defaultMessage:"Please go online to copy this block."}});function A(e){const{environment:t,sourceBlockId:o,targetBlockPointer:i,sourceBlockSubtree:r,targetInMemoryRecordCache:a,addCopyName:s,deepCopyTransclusionContainers:l,resolveTemplateVariables:c,transaction:d}=e,{targetBlock:p,originalToDuplicate:u}=P.ZI({environment:t,sourceBlockId:o,targetBlockPointer:i,sourceBlockSubtree:r,targetRecordCache:a,transaction:d,deepCopyTransclusionContainers:l,resolveTemplateVariables:c});if(s&&p&&p.isNavigableBlock()){const e=p.getTitleStore();if(e){const t=e.getValue(),o=n.eb(t);Z.sO({store:e,value:o,transaction:d})}}return{targetBlock:p,originalToDuplicate:u}}function D(e){const{environment:t,sourceBlock:o,targetInMemoryRecordCache:n,snapshotData:a,addCopyName:s,deepCopyTransclusionContainers:c,resolveTemplateVariables:d,transaction:p,targetSpaceId:u,convertExternalObjectInstancesToPlaceholders:m}=e,g=Z.j4({environment:t,type:i.Ti.copyIndicator,inMemoryRecordCache:n,transaction:p,spaceId:u}),h=l.UZ();return p.postSubmitCallbacks.push((async e=>{if(e)h.resolve(e.message);else{const e=I.duplicateBlock(t,{sourceBlock:o,targetBlock:{id:g.id,spaceId:g.getSpaceId()},snapshotData:a,addCopyName:s,deepCopyTransclusionContainers:c,resolveTemplateVariables:!!d&&{currentUserId:t.currentUser.id,currentTimeZone:(0,r.r)()},convertExternalObjectInstancesToPlaceholders:m});let i;for await(const t of e)B.R(t,g.id),i=t;if(B.h(g.id),!i)return void h.resolve(void 0);if(i.error){E.Tq({environment:t,blocks:[g]});const e=(0,S.HV)(w.default.getIntl(),i.error);h.resolve(e)}else h.resolve(void 0)}})),[g,h.promise]}function F(e){const{environment:t,store:o,addCopyName:i,deepCopyTransclusionContainers:n,resolveTemplateVariables:r,transaction:a,targetSpaceId:s,preferDuplicateLocation:l,analyticsFrom:d}=e,p=o.getRecordStoreAtRootPath().getValue();let u;const{currentSpaceStore:g}=C.default.getState();var h;(g&&(null==p?void 0:p.parent_table)===f.e0&&(u=M.zX.createChildStore(g,{table:f.e0,id:p.parent_id})),p)&&T.trackCreateBlock(t,{from:d??"copy",type:p.type,teamStore:u,is_toggleable:(0,k._A)(p.type,p.format),collection_id:o.getParentCollectionId()??(null===(h=o.getCollectionViewCollectionStore())||void 0===h?void 0:h.id)});const v=o.getSpaceId()!==s;if("local"===l){const e=L(t,{blockId:o.id,inMemoryRecordCache:o.inMemoryRecordCache,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!n,allowCopyExternalObjectInstances:!v});if(e){const{targetBlock:l}=A({environment:t,sourceBlockId:o.id,targetBlockPointer:{id:(0,c.ZP)(),table:m.iU,spaceId:s},sourceBlockSubtree:e,targetInMemoryRecordCache:o.inMemoryRecordCache,addCopyName:i,deepCopyTransclusionContainers:n,resolveTemplateVariables:r,transaction:a});return[l,Promise.resolve(void 0)]}}if(o.inMemoryRecordCache!==t.defaultRecordCache.inMemoryRecordCache)throw new Error("Can only server duplicate from the environment.defaultRecordCache.inMemoryRecordCache.");return _.Z.state.online||x.showErrorMessage(w.default.formatMessage(R.offlineError)),D({environment:t,sourceBlock:{id:o.id,spaceId:o.getSpaceId()},targetInMemoryRecordCache:o.inMemoryRecordCache,addCopyName:i,transaction:a,deepCopyTransclusionContainers:n,resolveTemplateVariables:r,targetSpaceId:s,convertExternalObjectInstancesToPlaceholders:v})}function L(e,t){const{blockId:o,inMemoryRecordCache:n,allowCopyCollections:r,requireFullSubtree:l,skipTransclusionContainerChildren:c,allowCopyExternalObjectInstances:f}=t,y=e.currentUser.id,S=d.Ak.create(),w=new Set,k=[{pointer:{table:m.iU,id:o},parentId:"doesn't matter"}];for(;k.length>0;){const e=k.shift();if(!e)continue;if(w.has(e.pointer.id))continue;w.add(e.pointer.id);const t=o===e.pointer.id;if((0,d.$O)(e.pointer,m.iU)){var C,_;const o=n.getRecord({pointer:e.pointer,userId:y});if(!o||!o.value){if(l)return;continue}const r=o.value;if(!t&&r.parent_id!==e.parentId)continue;if(r.type===i.Ti.externalObjectInstance&&!f)return;if(S.set(e.pointer,r),null!==(C=r.format)&&void 0!==C&&C.collection_pointer&&k.push({pointer:r.format.collection_pointer,parentId:r.id}),r.collection_id&&k.push({pointer:{table:g.v,id:r.collection_id},parentId:r.id}),r.view_ids)for(const e of r.view_ids)k.push({pointer:{table:h.n,id:e,spaceId:r.space_id},parentId:r.id});if(!c||"transclusion_container"!==r.type){const e=s.kk.fromBlock(r).getRenderableContentIds();for(const t of e)k.push({pointer:{table:m.iU,id:t},parentId:r.id})}if(r.type===i.Ti.externalObjectInstance){var M,T;const e=(null===(M=r.format)||void 0===M?void 0:M.related_external_object_uris_to_instance_ids)&&Object.values(null===(T=r.format)||void 0===T?void 0:T.related_external_object_uris_to_instance_ids)||[];for(const t of e)k.push({pointer:{table:m.iU,id:t,spaceId:r.space_id},parentId:r.id})}if(r.properties)for(const e of Object.values(r.properties))if(e)for(const t of e)for(const e of v.hD(t)){if(v.ST(e)){const t=v.TO(e);k.push({pointer:{table:m.iU,id:t},parentId:r.id})}if(v.j0(e)){const t=v.zW(e),o=(0,a.A5)({url:t,baseUrl:b.Z.domainBaseUrl,publicDomainName:b.Z.publicDomainName});o&&k.push({pointer:{table:m.iU,id:o},parentId:r.id})}if(v.nS(e)){const t=v.Ik(e);t&&k.push({pointer:{table:m.iU,id:t,spaceId:r.space_id},parentId:r.id})}}null!==(_=r.format)&&void 0!==_&&_.automation_id&&k.push({pointer:{table:p.cv,id:r.format.automation_id,spaceId:r.space_id},parentId:r.id})}else if((0,d.$O)(e.pointer,g.v)){if(!r)return;const t=n.getRecord({pointer:e.pointer,userId:y});if(!t||!t.value){if(l)return;continue}if(t.value.parent_id!==e.parentId)continue;S.set(e.pointer,t.value),n.forEachRecord(y,((t,o)=>{if(t.table===m.iU){const i=o;i&&i.value&&i.value.parent_id===e.pointer.id&&i.value.alive&&k.push({pointer:t,parentId:e.pointer.id})}}))}else if((0,d.$O)(e.pointer,h.n)){const t=n.getRecord({pointer:e.pointer,userId:y});if(!t||!t.value){if(l)return;continue}if(t.value.parent_id!==e.parentId)continue;S.set(e.pointer,t.value)}else if((0,d.$O)(e.pointer,p.cv)){const t=n.getRecord({pointer:e.pointer,userId:y});if(!t||!t.value){if(l)return;continue}if(t.value.parent_id!==e.parentId)continue;S.set(e.pointer,t.value);for(const e of t.value.action_ids??[])k.push({pointer:{table:u.Xj,id:e,spaceId:t.value.space_id},parentId:t.value.id})}else if((0,d.$O)(e.pointer,u.Xj)){const t=n.getRecord({pointer:e.pointer,userId:y});if(!t||!t.value){if(l)return;continue}if(t.value.parent_id!==e.parentId)continue;S.set(e.pointer,t.value);for(const e of t.value.blocks??[])k.push({pointer:{table:m.iU,id:e,spaceId:t.value.space_id},parentId:t.value.id})}}return S}},15944:(e,t,o)=>{o.d(t,{o:()=>u,q:()=>m});var i=o(81954),n=o(68056),r=o(89086),a=o(28685),s=o(79315),l=o(24666),c=o(30149),d=o(37181);function p(){const e=l.default.state;if("editing"===e.mode){const t=(0,n.QY)(e.multiSelection);if(t&&(0,r.wd)(t.selection)){const e=t.store,o=a.E.findEditableWithStore(e);if(o){return e.getValue()?void 0:o}}}}function u(){return(0,i.VK)(p,[])}function m(e){const{currentUserSettingsStore:t}=s.default.state;t&&c.createAndCommit({userAction:"educationTooltipsActions.completePressSlashTooltip",environment:e,perform:e=>{d.d2({userSettingsStore:t,transaction:e,data:{pressed_slash_tooltip:!0}})},userId:t.id})}},84908:(e,t,o)=>{o.r(t),o.d(t,{electronApi:()=>c,getDesktopVersion:()=>d,consoleLog:()=>p,openInNewTab:()=>u,openInNewWindow:()=>m,openExternalUrl:()=>g,clearBrowserHistory:()=>h,setBadge:()=>f,electronUpdateReady:()=>v,electronUpdateError:()=>y,checkForUpdates:()=>b,electronUpdateChecking:()=>S,electronUpdateAvailable:()=>w,electronUpdateNotAvailable:()=>k,electronUpdateProgress:()=>C,appUpdateReady:()=>_,appUpdateError:()=>M,appUpdateChecking:()=>T,appUpdateAvailable:()=>I,appUpdateNotAvailable:()=>P,appUpdateReload:()=>x,appUpdateProgress:()=>B,appUpdateFinished:()=>Z,appUpdateInstall:()=>E,installElectronUpdate:()=>R,fullscreen:()=>A,inPageSearch:()=>D,getCurrentZoom:()=>N,zoomIn:()=>O,zoomOut:()=>U,zoomReset:()=>H,toggleMaximized:()=>z,openDevTools:()=>W,getSubstitutions:()=>j,isMainTabOrWindow:()=>K,setTheme:()=>Y,onNewWindow:()=>G,openOauthPopup:()=>X,openGoogleDrivePickerPopup:()=>q,setLogglyData:()=>$,clearCookies:()=>J,clearGoogleAuthCookies:()=>Q,getAppPath:()=>ee,downloadUrl:()=>te,subscribeToProtocolUrl:()=>oe,subscribeToSettingsMenuItem:()=>ie,ready:()=>ne,initializeElectron:()=>re,refreshAll:()=>ae,electronAppFeatures:()=>se,sidebarState:()=>le,windowSidebarState:()=>ce,isActiveTab:()=>de,track:()=>pe});var i=o(96486),n=o.n(i),r=o(65917),a=o(64002),s=o(63643);let l="lastProtocolUrlDeduplicationId";const c=s.electronApi,d=s.getDesktopVersion;function p(e){c&&c.consoleLog&&c.consoleLog(e)}function u(e){const t=a.T1(e.url);c&&(c.openInNewTab?c.openInNewTab(t,e.makeTabActive,e.position):c.openInNewWindow(t))}function m(e){const t=a.T1(e);c&&c.openInNewWindow(t)}function g(e){if(c){void 0!==a.yn(e)&&c.openExternalUrl(e)}}function h(){c&&c.clearBrowserHistory()}function f(e){if(c)return c.setBadge(e)}const v={addListener(e){c&&c.updateReady.addListener(e)},removeListener(e){c&&c.updateReady.removeListener(e)}},y={addListener(e){c&&c.updateError&&c.updateError.addListener(e)},removeListener(e){c&&c.updateError&&c.updateError.removeListener(e)}},b=()=>{c&&c.checkForUpdates&&c.checkForUpdates()},S={addListener(e){c&&c.updateChecking&&c.updateChecking.addListener(e)},removeListener(e){c&&c.updateChecking&&c.updateChecking.removeListener(e)}},w={addListener(e){c&&c.updateAvailable&&c.updateAvailable.addListener(e)},removeListener(e){c&&c.updateAvailable&&c.updateAvailable.removeListener(e)}},k={addListener(e){c&&c.updateNotAvailable&&c.updateNotAvailable.addListener(e)},removeListener(e){c&&c.updateNotAvailable&&c.updateNotAvailable.removeListener(e)}},C={addListener(e){c&&c.updateProgress&&c.updateProgress.addListener(e)},removeListener(e){c&&c.updateProgress&&c.updateProgress.removeListener(e)}},_={addListener(e){c&&c.appUpdateReady&&c.appUpdateReady.addListener(e)},removeListener(e){c&&c.appUpdateReady&&c.appUpdateReady.removeListener(e)}},M={addListener(e){c&&c.appUpdateError&&c.appUpdateError.addListener(e)},removeListener(e){c&&c.appUpdateError&&c.appUpdateError.removeListener(e)}},T={addListener(e){c&&c.appUpdateChecking&&c.appUpdateChecking.addListener(e)},removeListener(e){c&&c.appUpdateChecking&&c.appUpdateChecking.removeListener(e)}},I={addListener(e){c&&c.appUpdateAvailable&&c.appUpdateAvailable.addListener(e)},removeListener(e){c&&c.appUpdateAvailable&&c.appUpdateAvailable.removeListener(e)}},P={addListener(e){c&&c.appUpdateNotAvailable&&c.appUpdateNotAvailable.addListener(e)},removeListener(e){c&&c.appUpdateNotAvailable&&c.appUpdateNotAvailable.removeListener(e)}},x={emit:e=>{c&&c.appUpdateReload&&c.appUpdateReload.emit(e)},addListener(e){c&&c.appUpdateReload&&c.appUpdateReload.addListener(e)},removeListener(e){c&&c.appUpdateReload&&c.appUpdateReload.removeListener(e)}},B={addListener(e){c&&c.appUpdateProgress&&c.appUpdateProgress.addListener(e)},removeListener(e){c&&c.appUpdateProgress&&c.appUpdateProgress.removeListener(e)}},Z={addListener(e){c&&c.appUpdateFinished&&c.appUpdateFinished.addListener(e)},removeListener(e){c&&c.appUpdateFinished&&c.appUpdateFinished.removeListener(e)}},E={addListener(e){c&&c.appUpdateInstall&&c.appUpdateInstall.addListener(e)},removeListener(e){c&&c.appUpdateInstall&&c.appUpdateInstall.removeListener(e)}};function R(){c&&c.installUpdate()}const A={get(){if(c)return c.fullscreen.get()},addListener(e){c&&c.fullscreen.addListener(e)},removeListener(e){c&&c.fullscreen.removeListener(e)}},D={start(e){c&&c.inPageSearch&&c.inPageSearch.start(e)},stop(){c&&c.inPageSearch&&c.inPageSearch.stop()},started:{addListener(e){c&&c.inPageSearch&&c.inPageSearch.started.addListener(e)},removeListener(e){c&&c.inPageSearch&&c.inPageSearch.started.removeListener(e)}},stopped:{addListener(e){c&&c.inPageSearch&&c.inPageSearch.stopped.addListener(e)},removeListener(e){c&&c.inPageSearch&&c.inPageSearch.stopped.removeListener(e)}}},F=(e,t,o)=>Math.min(Math.max(e,o),t);let L,V=1;function N(){return V}function O(){c&&c.zoom&&(V+=.1,c.zoom.set(F(.1,4.9,V)))}function U(){c&&c.zoom&&(V-=.1,c.zoom.set(F(.1,4.9,V)))}function H(){c&&c.zoom&&(V=1,c.zoom.set(V))}function z(){c&&c.toggleMaximized&&c.toggleMaximized()}function W(){c&&c.openDevTools&&c.openDevTools()}function j(){return L||[]}async function K(){return c&&c.isMainTab?c.isMainTab():!c||!c.isMainWindow||c.isMainWindow()}function Y(e){c&&c.setTheme&&c.setTheme(e)}function G(e){c&&c.newWindow&&c.newWindow.addListener(e)}async function X(e){if(c&&c.openOauthPopup)return c.openOauthPopup(e)}async function q(e){if(c&&c.openGoogleDrivePickerPopup)return c.openGoogleDrivePickerPopup(e)}function $(e){c&&(c.setLoggerData?c.setLoggerData(e):c.setLogglyData&&c.setLogglyData(e))}function J(){c&&c.clearCookies&&c.clearCookies()}function Q(){c&&c.clearAllCookies&&c.clearAllCookies()}async function ee(){if(c&&c.getAppPath)return c.getAppPath()}function te(e){if(c&&c.downloadUrl)c.downloadUrl(e);else{const t=document.createElement("a");t.download=e,t.href=e,t.click()}}function oe(e){c&&c.onNavigate&&c.onNavigate.addListener(((t,o)=>{if("string"!=typeof o&&o.deduplicationID){const e=o.deduplicationID;if(l===e)return void r.log({level:"warning",from:"electronActions",type:"duplicateOnNavigateObjectDetected"});l=e}e(o)}))}function ie(e){c&&c.onOpenSettings&&c.onOpenSettings.addListener((t=>e()))}function ne(){c&&c.ready&&c.ready()}async function re(e){const{device:t,electronSqlite:o}=e;if(c&&(await s.getAndCacheDesktopVersionAsync(),c.zoom&&(V=await c.zoom.get()),o&&o.sqliteConnection&&(await o.sqliteConnection.ensureMigrated(),o.sqliteConnection.optimize()),c.getSubstitutions&&t.isElectronMac)){const e=await c.getSubstitutions();L=e.filter((e=>e.replace!==e.with)).map((e=>({length:e.replace.length,replace:new RegExp(`\\b${n().escapeRegExp(e.replace)} $`),with:`${e.with} `})))}}function ae(e){c&&c.refreshAll&&c.refreshAll(e.includeFocusedWindow)}const se={get(){if(c&&c.electronAppFeatures)return c.electronAppFeatures.get()},setPreference(e,t){var o;c&&null!==(o=c.electronAppFeatures)&&void 0!==o&&o.setPreference&&c.electronAppFeatures.setPreference(e,t)},addListener(e){c&&c.electronAppFeatures&&c.electronAppFeatures.addListener(e)},removeListener(e){c&&c.electronAppFeatures&&c.electronAppFeatures.removeListener(e)}},le={set(e){c&&c.sidebarState&&c.sidebarState.set(e)},addToggleListener(e){c&&c.sidebarState&&c.sidebarState.addToggleListener(e)},removeToggleListener(e){c&&c.sidebarState&&c.sidebarState.removeToggleListener(e)}},ce={get:()=>c&&c.windowSidebarState?c.windowSidebarState.get():Promise.resolve(void 0),set(e){c&&c.windowSidebarState&&c.windowSidebarState.set(e)},addListener(e){c&&c.windowSidebarState&&c.windowSidebarState.addListener(e)},removeListener(e){c&&c.windowSidebarState&&c.windowSidebarState.removeListener(e)}},de={get:()=>c&&c.isActiveTab?c.isActiveTab.get():Promise.resolve(!1),addListener(e){c&&c.isActiveTab&&c.isActiveTab.addListener(e)},removeListener(e){c&&c.isActiveTab&&c.isActiveTab.removeListener(e)}},pe={addListener(e){c&&c.track&&c.track.addListener(e)},removeListener(e){c&&c.track&&c.track.removeListener(e)}}},63643:(e,t,o)=>{o.r(t),o.d(t,{electronApi:()=>n,getDesktopVersion:()=>a,getAndCacheDesktopVersionAsync:()=>s});var i=o(11342);const n=window.__electronApi;let r;function a(){if(r)return(0,i.parseVersion)(r)}async function s(){return!r&&n&&(r=await n.getAppVersion()),a()}},72747:(e,t,o)=>{o.d(t,{vW:()=>R,z:()=>D,TH:()=>U,I:()=>L,qC:()=>A,qL:()=>N,x1:()=>H,cT:()=>F});var i=o(49303),n=o.n(i),r=o(1302),a=o(41432),s=o(80951),l=o(95538),c=o(43593),d=o(70203),p=o(5366),u=o(54642),m=o(48948),g=o(95477),h=o(33929),f=o(45010),v=o(472),y=o(58202),b=o(53809),S=o(56164);const w=new b.D({key:"urlTurnedBookmarkToastStatusSetting",namespace:S.$p,important:!0,trackingType:"preference"});var k=o(27411),C=o(50906),_=o(62365),M=o(96802),T=o(27153),I=o(9953),P=o(5978),x=o(64964),B=o(30149),Z=o(53471);const E=(0,p.defineMessages)({urlTurnedBookmark:{id:"action.urlTurnedBookmark.snackBarMessage",defaultMessage:"Pasted url is not embeddable, turned to bookmark instead!",description:"Snackbar message text that comes up when pasted embed url turns into a bookmark instead."}});let R;function A(e){return e===R.PageComment||e===R.SidebarComment}function D(e){const{environment:t,files:o,inMemoryRecordCache:i,transaction:n,pageWidth:r,ignoreOversizedFiles:a,spaceId:s}=e;return o.filter((e=>{if(a){if(!Z.Q7({environment:t,file:e,preventLimitFreeFileSize:!1}))return Z.A3(t),!1}return!0})).map((e=>{if(!e.type||0!==e.type.indexOf("image")&&0!==e.type.indexOf("video")&&0!==e.type.indexOf("audio")||e.type.includes("photoshop")){const o=I.j4({environment:t,type:"file",inMemoryRecordCache:i,transaction:n,spaceId:s});return n.postSubmitCallbacks.push((i=>{i||_.c({environment:t,store:o,file:e})})),o}{const o=I.j4({environment:t,type:"embed",inMemoryRecordCache:i,transaction:n,spaceId:s});return n.postSubmitCallbacks.push((i=>{i||F({environment:t,store:o,file:e,pageWidth:r,preferredType:void 0})})),o}}))}function F(e){const{environment:t,store:o,file:i,pageWidth:a,preferredType:s}=e,c=k.default.getBlockKey(o.id);T.Z(),Z.cT({environment:t,file:i,bucket:"secure",record:o.pointer,onStart:e=>{if(k.default.setKeyState(c,{progressPercent:0,file:i,name:e.name,size:e.size}),i.type.indexOf("image")>=0&&!(0,l.y_)(e.name,"tiff")&&!(0,l.y_)(e.name,"tif"))n()(i,(e=>{const i=k.default.getKeyState(c);i&&e.toDataURL&&k.default.setKeyState(c,{...i,dataURL:e.toDataURL("image/jpeg",z)});const{width:n,height:s}=e;V(t,{store:o,width:n,height:s,scale:!0,type:"image",pageWidth:a}),t.device.isMobile&&r.default.afterNextFlush((()=>{f.Z.PageScroller&&f.Z.PageScroller.scrollerHack()}))}),{canvas:!0,orientation:!0});else{const e=(0,l.Dz)({url:i.name||"",baseUrl:g.Z.domainBaseUrl,publicDomainName:g.Z.publicDomainName,preferredType:s});V(t,{store:o,width:a,type:e,pageWidth:a})}},onProgress:e=>{const t=k.default.getKeyState(c);t&&k.default.setKeyState(c,{...t,progressPercent:e.progressPercent})},onComplete:async e=>{const i=k.default.getKeyState(c);if(i){const n=Boolean(i.dataURL),r=i.name,l=i.size;await L(t,{source:e,store:o,isDataURL:n,pageWidth:a,preferredType:s,name:r,size:l}),k.default.setKeyState(c,void 0)}},onError:()=>{k.default.setKeyState(c,void 0)}})}async function L(e,t){const{store:o,source:i,isDataURL:n,pageWidth:r,preferredType:s,name:c,size:p}=t;let f=n?"image":(0,l.Dz)({url:i,baseUrl:g.Z.domainBaseUrl,publicDomainName:g.Z.publicDomainName,preferredType:s});const y=W(f,i),{properties:b,type:S,format:k}=await(0,l.Ol)({source:y,type:f,isDataURL:n,pageWidth:r,isMobileDevice:e.device.isMobile,getEmbedData:async t=>{const o=await u.getGenericEmbedBlockData(e,t);return"failed"===o.type?void console.error(o.error):o.data},trackEmbedType:t=>C.trackEmbedType(e,{embedType:t})});if(f=S,f===a.Ti.bookmark){const i=o;return await m.K({environment:e,store:i,url:y,transformTimeout:0}),C.trackUrlTurnedBookmark(e),function(){if("do_not_prompt"===w.state)return;w.state?"displayed_once"===w.state?w.setState("displayed_twice"):"displayed_twice"===w.state&&w.setState("do_not_prompt"):w.setState("displayed_once");x.oV({label:h.default.formatMessage(E.urlTurnedBookmark)})}(),void(t.metric&&v.default.emit(e,t.metric,{embedType:f}))}C.trackEmbedRender(e,{embedType:S});const _=c&&p?{title:d.TP(c),size:d.TP(p)}:{},{serverCommitResult:T}=B.createAndCommit({userAction:"embedBlockActions.initializeEmbedBlock",environment:e,perform:e=>{I.sW({store:o.getPropertiesStore(),data:{...b||{},..._},transaction:e}),M.FH({stores:[o],update:k,transaction:e}),I.sW({store:o,data:{type:f},transaction:e})}});await T,t.metric&&v.default.emit(e,t.metric,{embedType:f})}function V(e,t){let{store:o,...i}=t;B.createAndCommit({userAction:"embedBlockActions.initializeFormat",environment:e,perform:e=>{M.FH({stores:[o],update:(0,l.tj)(i),transaction:e})}})}async function N(e,t){const{store:o}=t,i=o.getProperties();if(i){const p=o.getType(),u=p===a.Ti.bookmark?i.link:i.source,m=s.zB(u),g=d.Q(i.title),{display_source:h,original_url:f}=o.getFormat(),v=o.isExternalObjectInstanceBlockStore()?f:m||h;let y;v&&(y=c.rF({title:g,source:v}));var n,r,l="file";if("image"===p?l="image":"video"===p&&(l="video"),v)await P.openFileUrl(e,{url:v,downloadName:y,type:l,from:t.from,permissionRecord:t.store.pointer,download:(null===(n=y)||void 0===n?void 0:n.endsWith(".html"))||(null===(r=y)||void 0===r?void 0:r.endsWith(".htm"))})}}!function(e){e[e.Page=0]="Page",e[e.PageComment=1]="PageComment",e[e.SidebarComment=2]="SidebarComment"}(R||(R={}));const O=(0,p.defineMessages)({downloadingImage:{id:"embedBlockActions.downloading.label",defaultMessage:"Downloading…",description:"Popup text to indicate that an image or file is in the process of downloading"}});async function U(e){const{store:t,environment:o}=e,i=t.getNavigableBlockStore();if(!i)return;const n=await u.getBlockFileDownloadUrl(o,{blockId:t.id,pageBlockId:i.id,meta:{name:"downloadSource"}});if("success"!==n.type)return;const{url:r,fileName:a}=n.data;if(r){let i;C.trackDownloadFile(o,{url:r,fileName:a,from:"embedBlockActions"}),i=c.E$(r,g.Z.secureFileS3.url)?P.downloadFileUrl(o,{url:r,download:!0,downloadName:a,permissionRecord:t.pointer}):function(e){const{store:t,environment:o}=e;if(!o.currentUser.id)return Promise.resolve();const i=t.getProperties(),n=d.Q(null==i?void 0:i.source),r=d.Q(null==i?void 0:i.caption);return c.GN(n,t.pointer,g.Z.domainBaseUrl,o.currentUser.id,r)}(e),x.oV({label:h.default.formatMessage(O.downloadingImage),durationMs:"keep"}),await i.finally((()=>{x.rN()}))}}const H=e=>{const{store:t}=e,o=y.R.findBlockFromStoreWithMethod(t,"replace");o&&o.replace()},z=.92,W=function(e,t){return"maps"===e?/^https?:\/\//i.test(t)?t:`https://maps.google.com/maps/search/${encodeURIComponent(t)}`:(0,l.x$)(t)}},89951:(e,t,o)=>{o.d(t,{KT:()=>A,RL:()=>D,xv:()=>F});var i=o(96486),n=o.n(i),r=o(1302),a=o(41432),s=o(43593),l=o(80984),c=o(21202),d=o(13493),p=o(70203),u=o(95477),m=o(28020),g=o(40056),h=o(72133),f=o(58202),v=o(64233),y=o(88833),b=o(19111),S=o(3815),w=o(27724),k=o(10743),C=o(52229),_=o(50906),M=o(79554),T=o(48948),I=o(96802),P=o(72711),x=o(9953),B=o(42858),Z=o(993),E=o(30149),R=o(63113);function A(e){const{environment:t,textStore:o,url:i,oldTextValue:n,urlSelection:r}=e;if(k.Z.state.open||y.Z.state.open||b.Z.state.open||v.Z.state.open)return;const a=h.get();if(!a)return;const s=h.getRect(a);s&&(v.Z.setState({open:!0,textStore:o,url:i,oldTextValue:n,urlSelection:r,selectionRect:s}),_.trackOpenEmbedMenu(t,{url:i}))}async function D(e){const{environment:t}=e,o=v.Z.state;if(o.open){const{url:i,textStore:h,oldTextValue:v}=o,y=w.default.state.stores,b=y[0];if(!b)return;const k=(0,s.Wv)(i,u.Z.secureFileS3.url,u.Z.secureFileConfig.rootPath,u.Z.secureFileConfig.hostname),_=k?k.link:i,A=(0,l.Wj)({url:_,baseUrl:u.Z.domainBaseUrl,publicDomainName:u.Z.publicDomainName,isMobile:t.device.isMobile,protocol:u.Z.protocol,currentUrl:ncd.href()});if("page"===A.name)await E.createAndCommitAsync({environment:t,userAction:"embedMenuActions.embedPageAlias",waitForServerCommit:!1,perform:async i=>{let n;if(Z.sO({environment:t,store:h,value:v,transaction:i}),A.peekViewBlockId){const e=S.G.createChildStore(h,{table:c.iU,id:A.peekViewBlockId});await e.load(),e.isPageBlock()&&(n=e)}if(n||(n=S.G.createChildStore(h,{table:c.iU,id:A.blockId})),n){if("mention-page"===e.type){const e=n.getRecordValue({id:n.id,table:c.iU});Z.lZ({environment:t,store:h,selection:{startIndex:o.urlSelection.startIndex,endIndex:o.urlSelection.startIndex},annotation:p.$0(A.scrollToBlockId??n.id,null==e?void 0:e.space_id),transaction:i,analyticsFrom:"block"})}else if("create-transclusion"===e.type){if(!A.scrollToBlockId)return;M.ry({environment:t,blocks:w.default.state.stores,copiedBlockIds:[A.scrollToBlockId]})}else if(n.isCollectionView()){const e=A.collectionViewId?S.Xr.createChildStore(n,{table:d.n,id:A.collectionViewId}):void 0;await Promise.all([n.load(),e?e.load():void 0]);const o=e?e.getCollectionStore():n.getCollectionViewCollectionStore();o&&(await o.load(),P.Y_({environment:t,store:b,collectionStore:o,collectionViewStore:e,transaction:i}))}else{const e=b.getParentBlockStore();if(e){const o=C.k({environment:t,parentBlock:e,targetStore:n,transaction:i});B.is({environment:t,blocks:[o],selection:y,transaction:i,replaceEmptyTextBlock:!0})}}r.default.afterNextFlush((()=>{E.createAndCommit({userAction:"embedMenuActions.accept",environment:t,perform:e=>{B.MD({blocks:y,transaction:e})}})}))}}});else if(e.type===a.Ti.bookmark||"teamsInvite"===A.name){const{performResult:e}=E.createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,perform:e=>{var o;Z.sO({environment:t,store:h,value:v,transaction:e});const i=x.j4({environment:t,type:a.Ti.bookmark,inMemoryRecordCache:b.inMemoryRecordCache,transaction:e,spaceId:0!==y.length?y[y.length-1].pointer.spaceId:null===(o=(0,m.RM)())||void 0===o?void 0:o.pointer.spaceId}),n=B.is({environment:t,blocks:[i],selection:y,transaction:e,replaceEmptyTextBlock:!0});return I.FH({stores:[i],transaction:e,update:{bookmark_loading_ttl:Date.now()}}),n}});r.default.afterNextFlush((()=>{E.createAndCommit({userAction:"embedMenuActions.accept",environment:t,perform:e=>{B.MD({blocks:y,transaction:e})}})}));const o=e[0];"teamsInvite"===A.name?await T.K({environment:t,store:o,url:i,teamId:A.teamId}):await T.K({environment:t,store:o,url:i})}else if(e.type===a.Ti.drive){const{performResult:e}=E.createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,perform:e=>{var o;Z.sO({environment:t,store:h,value:v,transaction:e});const i=x.j4({environment:t,type:a.Ti.drive,inMemoryRecordCache:b.inMemoryRecordCache,transaction:e,spaceId:0!==y.length?y[y.length-1].pointer.spaceId:null===(o=(0,m.RM)())||void 0===o?void 0:o.pointer.spaceId});return B.is({environment:t,blocks:[i],selection:y,transaction:e,replaceEmptyTextBlock:!0})}});r.default.afterNextFlush((()=>{E.createAndCommit({userAction:"embedMenuActions.accept",environment:t,perform:e=>{B.MD({blocks:y,transaction:e})}})}));const o=e[0];r.default.afterNextFlush((()=>{const e=f.R.find((e=>e.props.store===o));e&&e.initializeGoogleDriveBlockFromUrl(i)}))}else{const{performResult:o}=E.createAndCommit({userAction:"embedMenuActions.insertedBlocks",environment:t,perform:e=>{var o;Z.sO({environment:t,store:h,value:v,transaction:e});const i=x.j4({environment:t,type:a.Ti.copyIndicator,inMemoryRecordCache:b.inMemoryRecordCache,transaction:e,spaceId:0!==y.length?y[y.length-1].pointer.spaceId:null===(o=(0,m.RM)())||void 0===o?void 0:o.pointer.spaceId});return B.is({environment:t,blocks:[i],selection:y,transaction:e,replaceEmptyTextBlock:!0})}});r.default.afterNextFlush((()=>{E.createAndCommit({userAction:"embedMenuActions.accept",environment:t,perform:e=>{B.MD({blocks:y,transaction:e})}})}));const i=o[0],s=o=>{E.createAndCommit({environment:t,userAction:"embedMenuActions.accept.insertExtractedData",perform:t=>{let n;e.type&&"mention-page"!==e.type&&"create-transclusion"!==e.type?n=e.type:(n=a.Ti.embed,o&&o.media&&("photo"===o.media.type?n=a.Ti.image:"video"===o.media.type&&(n=a.Ti.video))),R.vs({environment:e.environment,block:i,blockType:n,transaction:t})}}),r.default.afterNextFlush((()=>{const e=f.R.find((e=>e.props.store===i&&n().isFunction(e.embed)));e&&e.embed(_)}))};g.W4(t,_).then(s)}}F()}const F=function(){v.Z.setState({url:v.Z.getState().url,open:!1})}},4727:(e,t,o)=>{o.d(t,{_P:()=>g,RL:()=>h,xv:()=>f,jZ:()=>v});var i=o(70203),n=o(68056),r=o(72133),a=o(64233),s=o(88833),l=o(19111),c=o(10743),d=o(24666),p=o(50906),u=o(993),m=o(30149);function g(e){const{environment:t,textStore:o,oldSelection:n,oldTextValue:d}=e,u=i.ee(o.getValue()||[]),m=n.startIndex,g=u[m],h=u[m-1];if(":"!==g)return;if(h&&/[0-9]/.test(h))return;if(c.Z.state.open||s.Z.state.open||l.Z.state.open||a.Z.state.open)return;if(t.device.isPhone)return;const f=r.get();if(!f)return;const v=r.getRect(f);v&&(s.Z.setState({open:!0,textStore:o,oldTextValue:d,oldSelection:n,selectionRect:v}),p.trackOpenEmojiMenu(t))}function h(e){const t=s.Z.state,{environment:o,emoji:i,transaction:n}=e;t.open&&(u.sO({environment:o,store:t.textStore,value:t.oldTextValue,transaction:n}),u.Q0({environment:o,store:t.textStore,selection:t.oldSelection,emoji:i,transaction:n}),f())}function f(){s.Z.setState({open:!1})}function v(e){u.N3({direction:"end"});const t=d.default.state;if("editing"!==t.mode)return;const o=(0,n.QY)(t.multiSelection);if(!o)return;let r=!1;if(o.selection.startIndex>0){const e=o.store.getValue()||[],t=i.ee(e)[o.selection.startIndex-1];/[\s]/g.test(t)||(r=!0)}m.createAndCommit({userAction:"emojiMenuActions.triggerInsertEmojiMenu",environment:e,perform:t=>{r?(u.hJ({environment:e,store:o.store,string:" ",selection:o.selection,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t}),u.hJ({environment:e,store:o.store,string:":",selection:{startIndex:o.selection.startIndex+1,endIndex:o.selection.endIndex+1},disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!1,transaction:t})):u.hJ({environment:e,store:o.store,string:":",selection:o.selection,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!1,transaction:t})}});const a=s.Z.state;a.open&&s.Z.setState({...a,showPopupWithEmptyFilter:!0})}},36280:(e,t,o)=>{o.d(t,{qn:()=>g,Wj:()=>h,gt:()=>v});var i=o(1302),n=o(70203),r=o(97880),a=o(83631),s=o(68056),l=o(72133),c=o(89086),d=o(66949),p=o(24666),u=o(993),m=o(98104);function g(e){var t;const{environment:o,selectedToken:i,selectionRect:r,analyticsFrom:u}=e,g=l.get();if(!g)return;if("editing"!==p.default.state.mode)return;const h=null===(t=(0,s.QY)(p.default.state.multiSelection))||void 0===t?void 0:t.store;if(!h)return;const f=i||a.JT(p.default.state);f&&m.Z5({store:h,selection:f.position});const v=c.lV(p.default.state),y=f?n.o0(f.token):a.Jf(v),b=a.by({environment:o,equation:y,displayMode:"inline"}),S=f?{editingToken:f.token}:{annotations:a.nk(p.default.state)};d.Z.setState({open:!0,value:y,error:b,savedTextSelectionState:p.default.state,savedTextSelectionRect:r||a.TJ({environment:o,selection:g}),...S,analyticsFrom:a.D9({source:u,currentEquationToken:Boolean(f),selectedText:v})}),p.default.setState({mode:"empty"})}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.P.Forward;d.Z.isOpen()&&(f({equationStore:d.Z,getNextSelection:t=>e===d.P.Forward?{startIndex:t.endIndex,endIndex:t.endIndex}:e===d.P.Backward?{startIndex:t.startIndex,endIndex:t.startIndex}:(0,r.t1)(e)}),d.Z.reset(),i.default.afterNextFlush((()=>{p.default.emit()})))}function f(e){const{equationStore:t,getNextSelection:o}=e;if(!t.isOpen())return;const{savedTextSelectionState:i}=t.state,n=(0,s.QY)(i.multiSelection);if(!n)return;const r=o(n.selection);if(m.Z5({store:n.store,selection:r}),"editing"!==p.default.state.mode)throw new Error("TextSelectionStore should have a selection after calling `setSelection`.");t.setState({...t.state,savedTextSelectionState:p.default.state})}function v(e){const{environment:t,equationStore:o,transaction:i}=e;o.isOpen()&&(o.state.error||o.state.editingToken&&n.o0(o.state.editingToken)===o.state.value||(!function(e){const{environment:t,equationStore:o,transaction:i}=e;if(!o.isOpen())return;if(o.state.error)return;const{savedTextSelectionState:r}=o.state,{multiSelection:s}=r;let l;u.pz({environment:t,multiSelection:s,transaction:i}),o.state.value&&(l=a.qZ({equationState:o.state,isTemporary:!1}),u.mM({environment:t,store:s.start.store,index:s.start.index,tokens:[l],transaction:i})),f({equationStore:o,getNextSelection:e=>{const t=l?n.ee([l]).length:0;return{startIndex:e.startIndex,endIndex:e.startIndex+t}}}),p.default.setState({mode:"empty"})}({environment:t,equationStore:d.Z,transaction:i}),f({equationStore:o,getNextSelection:e=>({startIndex:e.endIndex,endIndex:e.endIndex})}),a.ND({environment:t,equation:o.state.value,from:o.state.analyticsFrom})))}},57400:(e,t,o)=>{o.d(t,{Yh:()=>p,Th:()=>u,Tm:()=>m,BX:()=>g,Of:()=>h,mc:()=>v});var i=o(97477),n=o(15157),r=o(54642),a=o(47307),s=o(12955),l=o(64496),c=o(10161),d=o(7339);async function p(e){const t=await(0,s.getExperimentDeviceId)(e),o=e.currentUser.id;let i;const r=(0,l.qE)();if(i=(0,l._3)(e)&&r?(0,l.fP)(t,o,r):n.Z.get({userId:o,key:c.localExperimentsV2Key}),i){const e=i.deviceId!==t,n=i.userId!==o,r=Boolean(i.test);!e&&!n||r||(i=void 0,c.default.reset())}i?c.default.updateState(i,e):await u({environment:e,force:!1}),c.default.getState().isLoaded||c.default.updateState({experimentsBySpace:{},experimentsWithoutSpace:[],isLoaded:!0,userId:o,deviceId:t,test:!1},e),c.default.isStatsigEnabled()&&await d.C.initialize(e)}async function u(e){const{environment:t,force:o}=e;if((0,l._3)(t)&&!o){var i;if(null!==(i=t.mobileNative)&&void 0!==i&&i.api.getExperimentData){const e=await t.mobileNative.api.getExperimentData();e?c.default.updateState(e,t):y({message:"Attempt to get experiments from the mobile cache did not return a result."})}else y({message:"getExperimentData is not implemented in the react native API."})}else{const e=await f(t);"failed"!==e.type&&c.default.updateState(e.data,t)}}async function m(e){const t=await f(e);"failed"!==t.type&&n.Z.set({userId:t.data.userId,key:c.localExperimentsV2Key,value:t.data})}async function g(e,t,o){if(!c.default.state.isLoaded)return;const i=await(0,s.getExperimentDeviceId)(e),n=await r.updateExperimentOverride(e,{experimentId:t,experimentGroup:o,deviceId:i});"failed"!==n.type?await u({environment:e,force:!1}):a.showError(n)}async function h(e){if(!c.default.state.isLoaded)return;const t=await(0,s.getExperimentDeviceId)(e),o=await r.resetExperimentOverrides(e,{deviceId:t});"failed"!==o.type?(await u({environment:e,force:!1}),a.showMessage({message:"Successfully reset experiment overrides."})):a.showError(o)}async function f(e){const t=await(0,s.getExperimentDeviceId)(e),o=e.currentUser.id,i=await r.getClientExperimentsV2(e,{deviceId:t});return"failed"===i.type&&y(i,o,t),i}function v(){c.default.reset()}function y(e,t,o){i.rn(e,{from:"experimentActions",type:"ExperimentFetchError",data:{deviceId:o,userId:t}})}},70630:(e,t,o)=>{o.d(t,{y1:()=>q,BO:()=>$,Qr:()=>J,gJ:()=>se,PN:()=>ie,ZO:()=>H,hN:()=>ae,$G:()=>G,AW:()=>z,Tp:()=>re,aO:()=>oe,GI:()=>te,q$:()=>K});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(65917),c=o(42875),d=o(59730),p=o(15157),u=o(29477),m=o(19889),g=o(5366),h=o(83355),f=o(82990),v=o(19306),y=o(61519),b=o(68785);const S={fontWeight:f.Z.fontWeight.semibold};class w extends h.Z{renderComponent(){return n()("div",{style:this.getMessageStyle()},void 0,n()("div",{style:this.getSpinnerContainerStyle()},void 0,n()(b.Z,{})),this.renderProgress(),this.renderEmail(),this.renderDisabledTeamsWarning())}renderDisabledTeamsWarning(){const e=this.props.disabledExportTeamNames;if(e.length>0)return n()("span",{},void 0,n()(y.Z,{size:10}),n()("p",{},void 0,n()(g.FormattedMessage,{id:"exportActions.exportDisabledTeams.message",defaultMessage:"Export is disabled for the following teamspaces: <b>{teamNames}</b>",description:"Shown if some teams were not included in the export due to having export disabled in their settings.",values:{teamNames:(0,v.W)(e),b:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return n()("span",{style:S},void 0,t)}}})))}renderEmail(){const{targetEmailAddress:e}=this.props.exportProgressStore.state;if(e)return n()("p",{},void 0,n()(g.FormattedMessage,{id:"exportProgressDialog.emailMessage",defaultMessage:"We'll also send you an email with the download link."}))}renderProgress(){const{pagesExported:e}=this.props.exportProgressStore.state;return n()("p",{},void 0,n()(g.FormattedMessage,e>0?{id:"exportProgressDialog.exportedPagesMessage",defaultMessage:"{pagesExported, plural, one {{pagesExported} page exported} other {{pagesExported} pages exported}}",values:{pagesExported:e}}:{id:"exportProgressDialog.exportStartedMessage",defaultMessage:"Exporting…"}))}getMessageStyle(){return{fontSize:14,color:this.theme.mediumTextColor,textAlign:"center"}}getSpinnerContainerStyle(){return{marginTop:24,marginBottom:24,display:"flex",justifyContent:"center"}}}w.displayName="ExportProgress";const k=w;var C=o(617),_=o(30546),M=o(33954),T=o(33929),I=o(21115),P=o(58202),x=o(79315),B=o(4787),Z=o(71071),E=o(49085);class R extends E.Z{getInitialState(){return{pagesExported:0}}}const A=R;var D=o(38484),F=o(50906),L=o(54642),V=o(47307),N=o(92625),O=o(5978);const U=(0,g.defineMessages)({exporting:{id:"exportActions.exporting.loadingMessage",defaultMessage:"Exporting",description:"The text that appears when a user is exporting their workspace to a format like PDF or HTML"},exportAuditLogEmail:{id:"exportActions.auditLog.exporting.EmailMessage",defaultMessage:"Your CSV export is currently being generated. The generated CSV has a 2-hour delay from the real time audit log. Once it is ready, an email will be sent to you with the download link.",description:"The text that appears when a user is exporting audit log to CSV format."},exportCSVEmail:{id:"exportActions.exportingCSV.EmailMessage",defaultMessage:"Your CSV export is currently being generated. Once it is ready, an email will be sent to you with the download link.",description:"The text that appears when a user is waiting for a CSV format export."},exportFailed:{id:"exportActions.exportFailedError.message",defaultMessage:"Export failed."},adminMessage:{defaultMessage:"Admin",id:"export.userPermissionsRole.admin.message"},workspaceOwnerMessage:{defaultMessage:"Workspace owner",id:"export.userPermissionsRole.workspaceOwner.message",description:"Value shown in export members PDF for workspace owner"},memberMessage:{defaultMessage:"Member",id:"export.userPermissionsRole.member.message"},membershipAdminMessage:{defaultMessage:"Membership admin",id:"export.userPermissionsRole.membershipAdmin.message",description:"Value shown in export members PDF for membership admin"},guestMessage:{defaultMessage:"Guest",id:"export.userPermissionsRole.guest.message"},idMessage:{defaultMessage:"ID",id:"export.csvHeader.id",description:"Short for identifier"},emailMessage:{defaultMessage:"Email",id:"export.csvHeader.email"},nameMessage:{defaultMessage:"Name",id:"export.csvHeader.name"},roleMessage:{defaultMessage:"Role",id:"export.csvHeader.role"},permissionGroupsMessage:{defaultMessage:"Permission groups",id:"export.csvHeader.permissionGroups"},partitionMessage:{defaultMessage:"Export is still in progress due to file size. We will send you an email about its progress.",id:"export.exportPartitioned.message",description:"The text that appears when the export is partitioned"}});async function H(e,t){if(!X({environment:e,...t}))return void F.trackExportFailed(e,{target:"block",format:t.exportOptions.exportType,recursive:t.recursive});const{currentUserStore:o}=x.default.state;if(!o)return void F.trackExportFailed(e,{target:"block",format:t.exportOptions.exportType,recursive:t.recursive});const i=o.getEmail();if(!i)return void F.trackExportFailed(e,{target:"block",format:t.exportOptions.exportType,recursive:t.recursive});F.trackExport(e,{target:"block",format:t.exportOptions.exportType,recursive:t.recursive}),"currentView"===t.exportOptions.collectionViewExportType&&(t.exportOptions.preferredViewMap=j(o.id));const n=L.exportBlock(e,t);await W(e,n,t.recursive,i)}async function z(e,t){if(!X({environment:e,recursive:!0,exportOptions:t.exportOptions}))return void F.trackExportFailed(e,{target:"space",format:t.exportOptions.exportType,recursive:!0});const{currentUserStore:o}=x.default.state;if(!o)return void F.trackExportFailed(e,{target:"space",format:t.exportOptions.exportType,recursive:!0});const i=o.getEmail();if(!i)return void F.trackExportFailed(e,{target:"space",format:t.exportOptions.exportType,recursive:!0});F.trackExport(e,{target:"space",format:t.exportOptions.exportType,recursive:!0}),"currentView"===t.exportOptions.collectionViewExportType&&(t.exportOptions.preferredViewMap=j(o.id));const n=L.exportSpace(e,t);await W(e,n,!0,i)}async function W(e,t,o,i){const{currentSpaceViewStore:r}=x.default.state;if(!r)return;const a=new A;a.setState({pagesExported:0,targetEmailAddress:i});let l,c=!1;const p=r.getTeamsStores().filter((e=>e.getSetting("disable_export"))).flatMap((e=>e.getName()||[]));if(o){const e=p.length>0?6e3:1250;l=(0,u.Vs)(e);const t={exportProgressStore:a,disabledExportTeamNames:p};V.showDialog({message:s.createElement(k,t),showCancel:!1,keepFocus:!0,disableBackgroundDismiss:!0,items:[{label:n()(g.FormattedMessage,{id:"exportProgressDialog.closeButton.label",defaultMessage:"Close"}),onAccept:()=>{c=!0}}]})}else l=Promise.resolve(),N.j({message:U.exporting});for await(const n of t){if(c)return;if(n.error){if(N.x(),(0,d.a3)(n.error)&&"team_export_disabled"===n.error.clientData.type){const e=(0,M.HV)(T.default.getIntl(),n.error);V.showErrorMessage(e)}else V.showErrorMessage(T.default.formatMessage(U.exportFailed));return}{const{value:t}=n;if("complete"===t.type||"partition"===t.type)return await l,N.x(),void("complete"===t.type?(V.dismissDialog(),!c&&t.exportURL&&O.downloadUrl({environment:e,url:t.exportURL})):V.showMessage({message:T.default.formatMessage(U.partitionMessage)}));a.setState({...a.state,pagesExported:t.pagesExported})}}}function j(e){const t={};return p.Z.scan(((o,i)=>{if(o.includes(B.Z.PREFERENCE_KEY_PREFIX)&&o.includes(e)){const e=o.split(B.Z.PREFERENCE_KEY_PREFIX)[1];e&&i&&(t[e]=i)}})),t}function K(e){const{root:t,environment:o,isCollectionViewExportTypeSupported:i}=e,n=o.currentUser.id,r=ee(n),a=r&&r.exportType||"markdown",s=i?"currentView":void 0,l="pdf"===a?{exportType:"pdf",timeZone:(0,c.r)(),pdfFormat:te(n),locale:"en",collectionViewExportType:s}:{exportType:a,timeZone:(0,c.r)(),locale:"en",collectionViewExportType:s};$(o,{open:!0,root:t,recursive:"space"===t.table,exportOptions:l})}const Y=(e,t)=>{switch(t){case"editor":return e.formatMessage(U.workspaceOwnerMessage);case"membership_admin":return e.formatMessage(U.membershipAdminMessage);case"read_and_write":return e.formatMessage(U.memberMessage);case"none":return e.formatMessage(U.guestMessage);default:return l.log({level:"error",from:"exportActions",type:"roleNotFound",data:{miscDataToConvertToString:{role:t}}}),""}};async function G(e){const{spaceStore:t,subscriptionData:o,intl:i}=e,n=t.getPermissionGroups(),r=a().compact(await Promise.all(o.users.map((async e=>{const o=D.U.createChildStore(t,{table:m.KJ,id:e.userId});await o.load();const r=o.getEmail(),s=o.getFullName(i),l=a().compact(n.filter((t=>(t.user_ids||[]).includes(e.userId))).map((e=>e.name)).sort());if(r||s)return[r||"",s||"",Y(i,e.role),l.join(","),o.id]})))),s=[[U.emailMessage,U.nameMessage,U.roleMessage,U.permissionGroupsMessage,U.idMessage].map((e=>i.formatMessage(e))),...r].map((e=>e.map((e=>((e=e.replace(/"/g,'""')).search(/("|,|\n)/g)>=0&&(e=`"${e}"`),e))).join(","))).join("\n");var l=document.createElement("a");l.setAttribute("href",`data:text/csv;charset=utf-8,${encodeURIComponent(s)}`),l.setAttribute("download","members.csv"),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}function X(e){return!("pdf"===e.exportOptions.exportType&&e.recursive)||q(e.environment)}function q(e){return(0,I.qb)(e,"enterprise")||(0,I.qb)(e,"business")||C._T()}function $(e,t){const o=Z.ZP.state,i=e.currentUser.id;let n=t;if(Z.Sw(n)&&!q(e))if("space"===n.root.table){const e=o.open&&!Z.Sw(o)?o.exportOptions.exportType:"html";n={...n,exportOptions:{...n.exportOptions,exportType:e}}}else n={...n,recursive:!1};if(!X({environment:e,...n}))throw new d.D3("Invalid export options",{data:n});Z.ZP.setState(n),function(e){const t=Z.ZP.state;if(t.open){const o={...ee(e),exportType:t.exportOptions.exportType};"pdf"===t.exportOptions.exportType&&(o.pdfFormat=t.exportOptions.pdfFormat),p.Z.set({userId:e,key:Q,value:o})}}(i)}function J(){Z.ZP.setState({open:!1})}const Q="ExportSettings";function ee(e){return p.Z.get({userId:e,key:Q})}function te(e){const t=ee(e);return t&&t.pdfFormat||Z.jR()}function oe(e){if(e.isCollectionView()){let t;const o=P.R.findCollectionViewBlockFromStore(e);if(o&&(t=o.collectionContextStore.collectionViewStore()),t||(t=e.getCollectionViewStores()[0]),!t)return e;const i=t.getCollectionStore(),n=null==i?void 0:i.getParentBlockStore();return n||e}return e}async function ie(e,t){const{currentUserStore:o}=x.default.state,{spaceId:i}=t;if(!o)return l.log({level:"error",from:"exportActions",type:"exportAuditLogCSV-currentUserStoreNotFound",data:{miscDataToConvertToString:{spaceId:i}}}),V.showMessage({message:T.default.formatMessage(U.exportFailed)}),void F.trackExportFailed(e,{target:"auditLog",format:"csv",recursive:!1});if(!o.isDefined())return l.log({level:"error",from:"exportActions",type:"exportAuditLogCSV-currentUserValueNotFound",data:{miscDataToConvertToString:{spaceId:i}}}),V.showMessage({message:T.default.formatMessage(U.exportFailed)}),void F.trackExportFailed(e,{target:"auditLog",format:"csv",recursive:!1});F.trackExport(e,{target:"auditLog",format:"csv",recursive:!1});const n=L.exportAuditLog(e,t);await ne(n,U.exportAuditLogEmail)}async function ne(e,t){const o=await e.next();if(o.value.error){const e=(0,M.HV)(T.default.getIntl(),o.value.error);V.showErrorMessage(e)}else V.showMessage({message:T.default.formatMessage(t)})}async function re(e,t){F.trackExport(e,{target:"userAnalytics",format:"csv",recursive:!1});const o=L.exportUserAnalytics(e,t);await ne(o,U.exportCSVEmail)}async function ae(e,t){F.trackExport(e,{target:"contentAnalytics",format:"csv",recursive:!1});const o=L.exportContentAnalytics(e,t);await ne(o,U.exportCSVEmail)}async function se(e,t){F.trackExport(e,{target:"adminContentSearchAnalytics",format:"csv",recursive:!1});const o=L.exportAdminContentSearch(e,{spaceId:t.spaceId,sort:{field:"relevance",direction:"desc"},query:t.filters.query,audience:t.filters.audience,lastEditedTime:(0,_.Hq)(t.filters.lastEditedTime),createdTime:(0,_.Hq)(t.filters.createdTime),createdBy:t.filters.createdBy,sharedWith:t.filters.sharedWith,teamspaceIds:t.filters.teamIds});await ne(o,U.exportCSVEmail)}},77719:(e,t,o)=>{o.d(t,{h:()=>P});var i=o(74181),n=o(68626),r=o(80984),a=o(89101);const s={local:"http://localhost:3008",development:"https://integrations-api-dev.notion.com",staging:"https://integrations-api-stg.notion.com",production:"https://integrations-api.notion.com"};function l(e){return`${s[e]}/slack/install`}function c(e){return`${s[e]}/github/install`}var d=o(9852),p=o(5500),u=o(64002),m=o(5366),g=o(95477),h=o(71935),f=o(10161),v=o(30874),y=o(50906),b=o(54642),S=o(47307),w=o(84908),k=o(94273),C=o(15356),_=o(5978),M=o(97627),T=o(761);const I=(0,m.defineMessages)({authenticating:{id:"externalIntegrationAuthActions.authenticationWithIntegration.loadingMessage",defaultMessage:"Authorizing with integration…"},titleMessage:{id:"externalIntegrationAuthActions.loginWithExternalIntegrationPopupModal.title",defaultMessage:"Authenticate"}});async function P(e){const{environment:t,spaceId:o,integration:s,externalObjectInstanceBlockId:m,unfurlUrl:P,from:x}=e;d.setOauthAuthorizationParams(void 0);const B=s.id,Z=B===p.nO?v.Z.completeSlackAuthentications.state:v.Z.externalAuthentications.state,E=new Set(Z.filter((e=>{let{integration_id:t}=e;return t===B})).map((e=>e.parent_id)));B===p.iK.google_drive.id&&M.pc(t);const R=(0,p.BP)({integrationId:B,env:g.Z.env}),A=(0,i.lT)(g.Z.domainBaseUrl),D=s.redirect_uris.includes(A)?A:s.redirect_uris[0],F=await b.createOauthAuthorizationCode(t,{integrationId:B,spaceId:o,...R?{redirectUri:D}:{}});var L;if("failed"===F.type)return S.showError(F),{error:(null===(L=F.body)||void 0===L?void 0:L.message)??"Unexpected error creating authorization code."};const V=F.data.code,N=t.currentUser.id,O=(0,h.eC)(t);if(!N)return{error:"User must be signed in."};const U={environment:t,redirectUri:D,notionAuthorizationCode:V,integration:s,spaceId:o,externalObjectInstanceBlockId:m,unfurlUrl:P,authType:O,from:x,userId:N};(0,p.BP)({integrationId:B,env:g.Z.env})?await async function(e){const{environment:t,redirectUri:o,notionAuthorizationCode:i,integration:s,spaceId:d,externalObjectInstanceBlockId:p,unfurlUrl:m,authType:h}=e,v=await async function(e){const{integration:t}=e;if("external"===t.type&&void 0!==t.info.handled_by_integrations_server){const o=f.default.checkGate("github_integration");if("github"===t.info.handled_by_integrations_server)return o?(await async function(e){const{environment:t,notionAuthorizationCode:o,spaceId:i,authType:n}=e,s={notion_workspace_id:i,notion_user_id:t.currentUser.id,notion_last_visited_url:ncd.href(),notion_authorization_code:o,callback_type:n.callbackType,...n.redirectToAuth&&{redirectToAuth:"true"}},l=(0,u.bf)({url:c(g.Z.env),query:{...s}});if(t.device.isElectron)return void w.openExternalUrl(l);const d=await C.M(t,{width:610,height:700,url:l,titleMessage:I.titleMessage});if(!d)return;const p=(0,r.Wj)({url:d,isMobile:t.device.isMobile,baseUrl:g.Z.domainBaseUrl,publicDomainName:g.Z.publicDomainName,protocol:g.Z.protocol,currentUrl:ncd.href()}),{url:m}=k.Vr(t);"externalAuthCallback"===p.name&&await _.handleFirstPartyExternalIntegrationAuthCallback({route:p,environment:t});_.navigate({url:m||a._j.root,environment:t})}(e),{value:{success:!0}}):{error:{success:!1}};if("slack"===t.info.handled_by_integrations_server){return f.default.checkGate("link_preview_auth_with_server_integration")?(await async function(e){const{environment:t,userId:o,spaceId:i,authType:n,from:a,externalObjectInstanceBlockId:s,options:c}=e,d={notion_workspace_id:i,notion_user_id:o,notion_last_visited_url:ncd.href(),auth_initiator:a,callback_type:n.callbackType,slack_workspace_id:null==c?void 0:c.slackWorkspaceId,external_object_instance_block_id:s,...n.redirectToAuth&&{redirectToAuth:"true"}},p=(0,u.bf)({url:l(g.Z.env),query:{...d}});if(t.mobileNative)return void t.mobileNative.openInAppBrowser(p);if(t.device.isElectron)return void w.openExternalUrl(p);const m=await C.M(t,{width:610,height:700,url:p,titleMessage:I.titleMessage});if(!m)return;const h=(0,r.Wj)({url:m,isMobile:t.device.isMobile,baseUrl:g.Z.domainBaseUrl,publicDomainName:g.Z.publicDomainName,protocol:g.Z.protocol,currentUrl:ncd.href()});"externalAuthCallback"===h.name&&await _.handleFirstPartyExternalIntegrationAuthCallback({route:h,environment:t})}(e),{value:{success:!0}}):{error:{success:!1}}}return{error:{success:!1}}}return{error:{success:!1}}}(e);if(n.x.isSuccess(v))return;const y={externalObjectInstanceBlockId:p,spaceId:d,callbackType:h.callbackType,...h.redirectToAuth&&{redirectToAuth:"true"}},b={code:i,notion_state:JSON.stringify(y),integration_id:s.id,external_url:m,redirect_uri:o},S=(0,u.bf)({url:o,query:{...b}});if(t.device.isElectron)return void w.openExternalUrl(S);const M=await C.M(t,{width:610,height:700,url:S,titleMessage:I.titleMessage});if(!M)return;const T=(0,r.Wj)({url:M,isMobile:t.device.isMobile,baseUrl:g.Z.domainBaseUrl,publicDomainName:g.Z.publicDomainName,protocol:g.Z.protocol,currentUrl:ncd.href()});"externalAuthCallback"===T.name&&await _.handleFirstPartyExternalIntegrationAuthCallback({route:T,environment:t})}(U):await async function(e){const{environment:t,notionAuthorizationCode:o,integration:i,spaceId:n,userId:s,authType:l,externalObjectInstanceBlockId:c}=e,d=i.id,p={notionAuthorizationCode:o,userId:s,spaceId:n,integrationId:d,externalObjectInstanceBlockId:c,callbackType:l.callbackType,...l.redirectToAuth&&{redirectToAuth:"true"}};let m=(0,u.bf)({url:`${g.Z.domainBaseUrl}${a._j.externalIntegrationPopupRedirect}`,query:{...p}});if(m=l.redirectToAuth?m:await(0,h.HU)(t,m),t.device.isElectron)return void w.openExternalUrl(m);const f=await C.M(t,{width:610,height:700,url:m,titleMessage:I.titleMessage});if(!f)return;const v=(0,r.Wj)({url:f,isMobile:t.device.isMobile,baseUrl:g.Z.domainBaseUrl,publicDomainName:g.Z.publicDomainName,protocol:g.Z.protocol,currentUrl:ncd.href()});"externalIntegrationAuthCallback"===v.name&&await _.handleThirdPartyExternalIntegrationAuthCallback({route:v,environment:t,integrationId:d})}(U),y.trackConnectExternalIntegration(t,{integrationId:s.id,numberOfAccountsAlreadyConnected:E.size,from:x}),await T.pJ({environment:t});return{value:{externalAuthentication:v.Z.externalAuthentications.state.filter((e=>{let{integration_id:t}=e;return t===B})).find((e=>!E.has(e.parent_id)))}}}},62365:(e,t,o)=>{o.d(t,{c:()=>c,v:()=>d});var i=o(70203),n=o(27411),r=o(27153),a=o(9953),s=o(30149),l=o(53471);function c(e){const{store:t,file:o,environment:i}=e,a=n.default.getBlockKey(t.id);r.Z(),l.cT({environment:i,file:o,bucket:"secure",record:t.pointer,onStart:e=>{n.default.setKeyState(a,{progressPercent:0,file:o,name:e.name,size:e.size})},onProgress:e=>{const t=n.default.getKeyState(a);t&&n.default.setKeyState(a,{...t,progressPercent:e.progressPercent})},onComplete:e=>{const o=n.default.getKeyState(a);o&&s.createAndCommit({userAction:"fileBlockActions.uploadFile",environment:i,perform:i=>{d({store:t,source:e,name:o.name,size:o.size,transaction:i}),n.default.setKeyState(a,void 0)}})},onError:()=>{n.default.setKeyState(a,void 0)}})}const d=function(e){const{store:t,source:o,name:n,size:r,transaction:s}=e;let l;n?l=n:o&&(l=o.substring(o.lastIndexOf("/")+1)),a.sW({store:t.getPropertiesStore(),data:{source:i.TP(o),title:i.TP(l),size:i.TP(r)},transaction:s})}},3297:(e,t,o)=>{o.d(t,{sC:()=>T,S:()=>I,DK:()=>x,OH:()=>B,VE:()=>Z});var i=o(42875),n=o(29477),r=o(89101),a=o(97880),s=o(5366),l=o(22889),c=o(95477),d=o(51456),p=o(28020),u=o(84210),m=o(33929),g=o(15517),h=o(79315),f=o(89256),v=o(50906),y=o(47307),b=o(54532),S=o(92625),w=o(11302),k=o(19785),C=o(5978),_=o(29974),M=o(30149);function T(){f.Z.setState({open:!1})}async function I(e){const{environment:t,store:o,originRect:i}=e;v.trackClickForkPage(t,o.id);const{RouterStore:n}=t,a=n.state.route;if("page"===a.name&&a.requestedOnPublicDomain){const e=(0,u.ZP)({store:o,fullyQualified:!1,duplicate:!0});return void C.navigateOnBaseUrl({environment:t,url:e,extraSearchParams:{...await C.generatePartnerStackPathParam(t),utm_source:"public_page",utm_content:"duplicate_button",tid:await(0,d.getDeviceIdForAnalytics)(t),from:"public_page",n:"duplicate_public_page"}})}const{currentUserRootStore:s}=h.default.state;if(s){const e=p.o(s);if(1===e.length){const i=e[0],n=i.getSpaceStore();if(!n)return;x({environment:t,store:o,spaceStore:n,spaceViewStore:i,isPrivate:!0,context:"public_page_duplicate_single_workspace"})}else f.Z.setState({open:!0,store:o,originRect:i})}else g.nM({currentUserId:t.currentUser.id,blockId:o.id}),C.navigate({environment:t,url:r._j.login})}const P=(0,s.defineMessages)({untitledBlockRecordTitle:{defaultMessage:"Untitled",id:"forkPageActions.untitledBlockRecordTitle"},untitledSpaceRecordTitle:{defaultMessage:"Untitled",id:"forkPageActions.untitledSpaceRecordTitle"},loadingStateDisplayText:{defaultMessage:"Duplicating {blockTitle} to {spaceTitle}…",id:"forkPageActions.loadingStateDisplayText",description:"Message to show to the user while they wait for a page to finish duplicating."}});async function x(e){var t,o;const{environment:r,store:a,spaceStore:s,context:c}=e,d=m.default.getIntl(),p=null===(t=a.getModel())||void 0===t?void 0:t.getRenderTitleWithEmoji({getRecordModel:a.getRecordModel,userTimeZone:(0,i.r)(),placeholder:d.formatMessage(P.untitledBlockRecordTitle),intl:d});if(void 0===p)return;const u=null===(o=s.getModel())||void 0===o?void 0:o.getRenderTitleWithEmoji({getRecordModel:s.getRecordModel,userTimeZone:(0,i.r)(),placeholder:d.formatMessage(P.untitledSpaceRecordTitle),intl:d});if(void 0===u)return;S.j({message:P.loadingStateDisplayText,interpolatedValues:{blockTitle:p,spaceTitle:u}});const g=Date.now();let h;const[f]=await Promise.all([B(e).then((e=>(h=Date.now()-g,e))),(0,n.Vs)(750)]);S.x();const b=Date.now()-g;"public_page_duplicate_multiple_workspace"!==c&&"public_page_duplicate_single_workspace"!==c&&"signin_after_duplicate"!==c||v.trackDuplicateTemplate(r,{from:"publicPage",success:!f.error,template_name:p,template_block_id:a.id,target_space_id:s.id,context:c,template_duplication_duration_ms:h,template_duplication_duration_with_minimum_ms:b}),void 0!==f.error?y.showErrorMessage(f.error):C.navigateToBlock({environment:r,store:f.value,visitType:l.vu.Link})}async function B(e){const{environment:t,store:o,spaceStore:i,spaceViewStore:n,isPrivate:r}=e;return new Promise((e=>{M.createAndCommit({userAction:"forkPageActions.forkPage",environment:t,perform:a=>{const[s,l]=b.Qi({environment:t,store:o,transaction:a,addCopyName:!1,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0,targetSpaceId:i.id,baseUrl:c.Z.domainBaseUrl,publicDomainName:c.Z.publicDomainName,preferDuplicateLocation:"local"});l.then((t=>{e(t?{error:t}:{value:s})})),_.Hj({environment:t,spaceStore:i,spaceViewStore:n,pageStore:s,isPrivate:r,location:{type:"prepend"},transaction:a})}})}))}async function Z(e){const{environment:t,store:o}=e,i=h.default.state.currentSpaceStore,n=h.default.state.currentSpaceViewStore,r=h.default.state.mainEditorCurrentBlockStore;if(!i||!n||!r)return;const s=await new Promise((r=>{M.createAndCommit({userAction:"forkPageActions.duplicateTo",environment:t,perform:s=>{const[l,d]=b.Qi({environment:t,store:o,transaction:s,addCopyName:!0,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0,targetSpaceId:i.id,baseUrl:c.Z.domainBaseUrl,publicDomainName:c.Z.publicDomainName,preferDuplicateLocation:"local"});d.then((e=>{r(e?{error:e}:{value:l})}));const p={type:"append",after:o.id};return"team"===e.newParent.table?w.at({transaction:s,currentSpaceViewStore:n,teamStore:e.newParent,targets:[l],environment:t,location:p,action:"move",value:{type:"team",id:e.newParent.id,spaceId:i.id}}):"block"===e.newParent.table?k.jG({parentStore:e.newParent,childStore:l,transaction:s,after:p.after}):"space"===e.newParent.table?_.Hj({environment:t,spaceStore:i,spaceViewStore:n,pageStore:l,isPrivate:!0,location:p,transaction:s}):(0,a.t1)(e.newParent),l}})}));void 0!==s.error?y.showErrorMessage(s.error):C.navigateToBlock({environment:t,store:s.value,visitType:l.vu.Link})}},96802:(e,t,o)=>{o.d(t,{FH:()=>h,Wq:()=>f,hc:()=>v,fs:()=>y,zM:()=>b,is:()=>S,L:()=>w,MF:()=>k,Mp:()=>C,bf:()=>_});var i=o(96486),n=o.n(i),r=o(41432),a=o(20039),s=o(43593),l=o(15157),c=o(63143),d=o(95477),p=o(4323),u=o(15517),m=o(3815),g=o(9953);function h(e){const{stores:t,update:o,transaction:i}=e;for(const n of t)g.sW({store:n.getFormatStore(),data:(0,c.Q2)(o),transaction:i}),n instanceof m.G&&n.getType()===r.Ti.callout&&o.block_color&&l.Z.set({userId:n.environment.currentUser.id,key:u.Ns,value:o.block_color})}function f(e){const{environment:t,store:o,isLocked:i,transaction:n}=e,{id:r}=t.currentUser;if(!r)return;const a={block_locked:i,block_locked_by:r};g.sW({store:o.getFormatStore(),data:a,transaction:n})}function v(e){const{environment:t,store:o,alignment:i,transaction:n}=e,{id:r}=t.currentUser;if(!r)return;const a={block_alignment:i};g.sW({store:o.getFormatStore(),data:a,transaction:n})}function y(e){const{store:t,url:o,position:i,transaction:n}=e,r=(0,s.Wv)(o,d.Z.secureFileS3.url,d.Z.secureFileConfig.rootPath,d.Z.secureFileConfig.hostname),a=r?r.link:o;h({stores:[t],update:{page_cover_position:i},transaction:n});const l=t.getCoverStore();l&&g.sO({store:l,value:a,transaction:n})}function b(){const e=n().sample(["Activities","Objects","Travel & Places"]),t=a.Mq[e];return n().sample(t)}function S(e){const{store:t,transaction:o}=e,i=t.getIconStore();if(i){if(!i.getValue()){const e=b();g.sO({store:i,value:e,transaction:o})}}}function w(e){const{store:t,transaction:o}=e,i=t.getCoverStore();if(i){if(!i.getValue()){const e=Object.keys(p.Z),r=e[n().random(0,e.length-1)],a=p.Z[r],s=a.items[n().random(0,a.items.length-1)],l=s.coverUrl,c=s.position;g.sO({store:i,value:l,transaction:o}),C({store:t,coverPosition:c,transaction:o})}}}function k(e){const{store:t,transaction:o}=e,i=t.getCoverStore();i&&g.sO({store:i,value:null,transaction:o})}function C(e){const{store:t,coverPosition:o,transaction:i}=e;if(t.isCollectionView()){const e=t.getCollectionViewCollectionStore();e&&g.sW({store:e.getFormatStore(),data:{collection_cover_position:o},transaction:i})}else h({stores:[t],update:{page_cover_position:o},transaction:i})}function _(e){const{store:t,coverPosition:o,transaction:i}=e;h({stores:[t],update:{card_cover_position:o},transaction:i})}},47678:(e,t,o)=>{o.d(t,{Y:()=>u});var i=o(96486),n=o.n(i),r=o(45010),a=o(79315),s=o(24612),l=o(27724),c=o(77503),d=o(54564),p=o(42858);function u(e){const{RouterStore:t}=e,{PageScroller:o}=r.Z;if("page"===t.state.route.name&&a.default.state.currentLoadingContainerStore&&a.default.state.currentLoadingContainerStore.state.ready)if(s.Z.reset(),c.Z.reset(),t.state.route.scrollToBlockId){const o=[t.state.route.scrollToBlockId];p.WG(e,o);const i=l.default.state.stores[0];i&&t.state.route.discussionId&&d.Ib({environment:e,blockStore:i,discussionIds:[t.state.route.discussionId],analyticsFrom:"page_load",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1})}else t.state.route.discussionId&&a.default.state.mainEditorCurrentBlockStore?d.Ib({environment:e,blockStore:a.default.state.mainEditorCurrentBlockStore,discussionIds:[t.state.route.discussionId],analyticsFrom:"page_load",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}):"pop"===t.state.action&&t.state.historyState&&(o&&n().isNumber(t.state.historyState.scrollTop)&&o.scrollTo(t.state.historyState.scrollTop,void 0),t.state.historyState.blockIds&&p.DQ(e,t.state.historyState.blockIds))}},54604:(e,t,o)=>{o.d(t,{ui:()=>a,xv:()=>s,zp:()=>l});var i=o(50906),n=o(17903),r=o(38302);function a(e){const{environment:t,renderFullScreenNode:o,fullScreenNodeRect:a,contentAspectRatio:s,block:l,imageUrl:c}=e;i.trackFullScreenAction(t,{type:"open"}),r.Z.setState({...r.Z.state,isOpen:!0,fullscreenNodeAnimationComplete:!1,backgroundAnimationComplete:!1,renderFullScreenNode:o,startScrollTop:n.Z.state.scrollTop,fullScreenNodeRect:a,contentAspectRatio:s,block:l,imageUrl:c})}function s(){r.Z.setState({...r.Z.state,isOpen:!1})}function l(e){return e<1020?0:32}},51118:(e,t,o)=>{o.d(t,{jN:()=>m,FF:()=>g,U4:()=>h,gs:()=>f,zb:()=>v,xx:()=>y});var i=o(77094),n=o.n(i),r=(o(67294),o(98459)),a=o(5366),s=o(46096),l=o(50906),c=o(54642),d=o(47307),p=o(92625);const u=(0,a.defineMessages)({restoringPreviousVersion:{id:"historyModalActions.restoringPreviousVersion.loadingMessage",defaultMessage:"Restoring…"}});function m(e){const{environment:t,from:o,...i}=e;l.trackOpenVersionHistory(t,o),s.Z.setState({...i,open:!0,size:50})}const g=()=>{const e=s.Z.state;e.open&&s.Z.setState({...e,size:e.size+20})},h=function(){s.Z.setState({open:!1})};function f(e){const{environment:t,snapshot:o,nextFutureSnapshot:i}=e;l.trackSelectSnapshot(t,o);const n=s.Z.state;n.open&&s.Z.setState({...n,snapshot:o,nextFutureSnapshot:i,openSnapshotNearTimestamp:void 0})}function v(){const e=s.Z.state;e.open&&s.Z.setState({...e,snapshot:void 0,nextFutureSnapshot:void 0})}async function y(e){if(!s.Z.state.open)return;if(!s.Z.state.snapshot)return;if(!(await d.confirmUserAction({message:n()(a.FormattedMessage,{defaultMessage:"Are you sure you would like to restore to this version?",id:"historyModal.confirmDialog.description"}),acceptLabel:n()(a.FormattedMessage,{defaultMessage:"Restore",id:"historyModal.confirmDialog.restoreButton.label"})})))return;l.trackRestoreSnapshot(e,s.Z.state.snapshot),p.j({message:u.restoringPreviousVersion});const t=await c.restoreSnapshot(e,{block:{id:s.Z.state.blockStore.id,spaceId:(0,r.CG)(s.Z.state.blockStore.pointer.spaceId)},timestamp:s.Z.state.snapshot.timestamp}).next();t.value.error&&d.showErrorMessage(t.value.error.message),p.x(),h()}},45766:(e,t,o)=>{o.d(t,{D:()=>r});var i=o(30149),n=o(37181);function r(e){var t;const{environment:o,currentUserSettingsStore:r}=e;if(!r)return;(null===(t=r.getSettings())||void 0===t?void 0:t.seen_icon_picker_new_v2)||i.createAndCommit({userAction:"mediaPicker.setSeenIconPickerNewBadge",environment:o,perform:e=>{n.d2({userSettingsStore:r,transaction:e,data:{seen_icon_picker_new_v2:!0}})}})}},44886:(e,t,o)=>{o.d(t,{dD:()=>m,uv:()=>g,WY:()=>h,rB:()=>f,A1:()=>v,vi:()=>y,nt:()=>b,gq:()=>S});var i=o(96486),n=o.n(i),r=o(41432),a=o(28020),s=o(73959),l=o(35328),c=o(95802),d=o(26664),p=o(45131),u=o(94419);function m(e){const{parentStore:t,block:o,type:i,transaction:n}=e,r=t.getTransclusionReferenceTargetStore()??t,a=r.getContentStores(),s=a.indexOf(o);if(s<=0)return;const c=a[s-1];if(!c)return;if(!w(r)||!w(c))return;u.Od({parent:r.getContentStore(),childToRemove:o,transaction:n});const{child:d}=u.R3({parent:c.getContentStore(),append:o,transaction:n});if("self"===i)for(const l of d.getContentStores().reverse())u.Od({parent:d.getContentStore(),childToRemove:l,transaction:n}),u.BE({parent:c.getContentStore(),insert:l,after:d,transaction:n});return l.BX(c)&&p.Z.setOpen(c.id,!0),d}function g(e){const{grandparentStore:t,parentStore:o,block:i,transaction:n}=e,r=t.getTransclusionReferenceTargetStore()??t;if(r.getContentStores().indexOf(o)<0)return;const a=o.getContentStores(),s=a.indexOf(i);if(s<0)return;if(!w(r)||!w(o))return;if("transclusion_container"===o.getType()||"transclusion_reference"===o.getType())return;if(w(i))for(let c=s+1;c<a.length;c++){const e=a[c];u.Od({parent:o.getContentStore(),childToRemove:e,transaction:n}),u.R3({parent:i.getContentStore(),append:e,transaction:n})}u.Od({parent:o.getContentStore(),childToRemove:i,transaction:n});const{child:l}=u.BE({parent:r.getContentStore(),insert:i,after:o,transaction:n});return l}function h(e){const{transaction:t}=e,o=e.blocks,i=o[0];if(!i)return;const n=k(i);if(!n)return;const{previousChildStore:r}=n,a=r.getContentStore();return l.BX(r)&&p.Z.setOpen(r.id,!0),o.map((e=>{const o=e.getRecordStoreUIParent();null!=o&&o.valueIs(d.i)&&u.Od({parent:o,childToRemove:e,transaction:t});return u.R3({parent:a,append:e,transaction:t}).child}))}function f(e){const{transaction:t}=e;let o=e.blocks;const i=o[0];if(!i)return;const r=C(i);if(!r)return;const{closestParentStore:a,closestParentParentStore:s}=r,l=a.getContentStores(),c=s.getContentStore();if(l){let e;for(const[t,i]of l.entries())if(i.id===o[o.length-1].id){e=l.splice(t+1);break}o=n().clone(o).reverse(),o=o.map(((o,i)=>{const n=o.getRecordStoreUIParent();null!=n&&n.valueIs(d.i)&&u.Od({parent:n,childToRemove:o,transaction:t});const r=u.BE({parent:c,insert:o,after:a,transaction:t});if(0===i&&e&&w(o))for(const a of e){const e=a.getRecordStoreUIParent();null!=e&&e.valueIs(d.i)&&u.Od({parent:e,childToRemove:a,transaction:t}),u.BE({parent:o.getContentStore(),insert:a,transaction:t})}return r.child}))}return o}function v(e){const{transaction:t,blocks:o}=e,i=o[0];if(!i)return;const r=a.RM();if(!r)return;const s=M(r),l=n().findIndex(s,(e=>e.parent===i.getRecordStoreUIParent()&&e.after===i)),c=n().findLastIndex(s,((e,t)=>t<l&&e.parent===i.getRecordStoreUIParent())),d=n().findLast(s,((e,t)=>t<c&&!i.uiContains(e.parent)));return d?I({blocks:o,listPosition:d,transaction:t}):void 0}function y(e){const{transaction:t,blocks:o}=e,i=n().last(o);if(!i)return;const r=a.RM();if(!r)return;const s=M(r),l=n().findIndex(s,(e=>e.parent===i.getRecordStoreUIParent()&&e.after===i)),c=s.find(((e,t)=>t>l&&!i.uiContains(e.parent)));return c?I({blocks:o,listPosition:c,transaction:t}):void 0}function b(e){return Boolean(e&&k(e))}function S(e){return Boolean(e&&C(e))}function w(e){const t=a.np(),o=e.getType(),i=e.getFormat();return o&&((0,r.TT)(o,i)||e===t)}function k(e){const t=(0,s.sQ)(e);if(null==t||!t.isDefined()||!w(t))return;const o=t.getContentStores(),i=o[o.indexOf(e)-1];return null!=i&&i.isDefined()&&w(i)?{previousChildStore:i}:void 0}function C(e){const t=(0,s.sQ)(e);if(!t)return;if(!t.isDefined()||!w(t))return;const o=(0,s.sQ)(t);return o&&o.isDefined()&&w(o)?{closestParentStore:t,closestParentParentStore:o}:void 0}function _(e,t){let o=[];const{store:i}=e.props;if(e.props.canDropAbove&&T(i)){const e=i.getRecordStoreUIParent();null!=e&&e.valueIs(d.i)&&o.push({parent:e})}const r=t.filter((t=>t.getContextClosestSelectable()===e));for(const a of r)o=n().union(o,_(a,t));if(e.props.canDropBelow&&T(i)){const e=i.getRecordStoreUIParent();null!=e&&e.valueIs(d.i)&&(e.id===i.id?o.push({parent:e}):o.push({parent:e,after:i}))}return o}function M(e){let t=[];const o=c.C.getMembersByDOMOrder({filter:()=>!0}),i=e.getContentStores();for(const r of i){const e=o.find((e=>e.props.store===r));e&&(t=n().union(t,_(e,o)))}return t}function T(e){return"collection"!==e.getParentTable()}function I(e){const{blocks:t,listPosition:o,transaction:i}=e,r=n().clone(t).reverse();for(const n of t){const e=n.getRecordStoreUIParent();null!=e&&e.valueIs(d.i)&&u.Od({parent:e,childToRemove:n,transaction:i})}let a;return a=o.after?r.map((e=>u.BE({insert:e,after:o.after,parent:o.parent,transaction:i}).child)):r.map((e=>u.Ce({prepend:e,parent:o.parent,transaction:i}).child)),a}},88295:(e,t,o)=>{o.d(t,{f8:()=>C,c_:()=>_,lP:()=>M,gt:()=>T,Hk:()=>I});var i=o(41432),n=o(21202),r=o(97880),a=o(19785),s=o(63113),l=o(28020),c=o(98165),d=o(67669),p=o(15517),u=o(79315),m=o(96026),g=o(3815),h=o(50906),f=o(49865),v=o(98834),y=o(94419),b=o(11302),S=o(19358),w=o(9953),k=o(30149);function C(e){const{environment:t,transaction:o,titleText:i,recordStoreParent:r}=e,{databaseTemplate:a,createInValue:s}=function(e,t){let o;if("page"===e.type){const i=g.G.createChildStore(t,{table:n.iU,id:e.id});if(i.isTemplate()){const t=(0,c.Dg)(i,1);t&&(o=i,e={type:"page",id:t.id})}}return{databaseTemplate:o,createInValue:e}}(e.createInValue,r),l=w.j4({transaction:o,environment:t,type:"page",inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,properties:i?{title:[[i]]}:void 0,spaceId:r.pointer.spaceId});let d;switch(s.type){case"block":S.YM({transaction:o,childStore:l,parentStore:g.G.createChildStore(r,{table:n.iU,id:s.id}),alive:!0});break;default:d=b.Ws({transaction:o,environment:t,targets:[l],value:s})}return{environment:t,databaseTemplate:a,createdPages:[l],moveToStorePromise:d}}async function _(e){const{environment:t,createdPages:o,databaseTemplate:i,moveToStorePromise:r}=e.createInState;h.trackCreateBlock(t,{type:"page",from:e.analyticsFrom});const{currentSpaceStore:a}=u.default.state;if(i)k.createAndCommit({userAction:"inlinePageActions.completeCreateIn",environment:t,perform:e=>{o.forEach((o=>v.ob({title:{text:o.getTitleValue()},environment:t,store:o,templateStore:i,isKeyboard:!1,isCreateIn:!0,transaction:e,from:"inline_page_action"})))}}),a&&await p.j2(a,a.id,i.id);else{const e=await r;a&&e&&e.table===n.iU&&await p.j2(a,a.id,e.id)}}function M(e){const{environment:t,transaction:o,parentStore:s,inlinePageIds:l}=e;if(0===l.length)return;const p=g.G.createChildStore(s,s.pointer),u=(0,c.qA)(p).find((e=>{if(e.table!==n.iU)return!1;const t=e.getType(),o=e.getFormat();return!(!t||!o)&&((0,i.Um)(t,o)||(0,i.S9)(t))})),h=u&&u.isCollectionView()?u.getCollectionViewCollectionStore():u,v=h&&m.Z.getMode(t,h);if(!h||(0,d.YF)(v)||!h.canEdit()){for(const e of l)a.nO({pageStore:g.G.createChildStore(s,{table:n.iU,id:e}),transaction:o});return}let b=s;for(const i of l){const e=g.G.createChildStore(s,{table:n.iU,id:i});if(e.isEmptyPage()){a.nO({pageStore:e,transaction:o});continue}const l=!e.isDefined()||Boolean(e.getAlive());S.YM({parentStore:h,childStore:e,transaction:o,alive:l}),"block"!==h.table?"collection"!==h.table?(0,r.t1)(h):f.mp({environment:t,store:e,collectionStore:h,coerce:!0,results:[],groupsPointer:[],transaction:o}):(y.BE({parent:h.getContentStore(),after:b,insert:e,transaction:o}),b=e)}}function T(e){const t=l.np();if(t){if(e&&e.table===n.iU)return{pageStore:(0,c.Dg)(e,0)||t,createInValue:{type:"block",id:e.id}};if(e&&(0,c.n3)(e)){const t=(0,c.Dg)(e,0);if(t)return{pageStore:t,createInValue:{type:"page",id:t.id}}}return{pageStore:t,createInValue:{type:"page",id:t.id}}}}async function I(e,t){const{createInValue:o,blocksToTransform:i}=t,r="page"===o.type?new g.G(e,{table:n.iU,id:o.id}):void 0,a=Boolean(r&&r.isTemplate()),{performResult:{transformedPages:l,pageStore:c}}=await k.createAndCommitAsync({environment:e,userAction:"inlinePageActions.createNewPageIn",waitForServerCommit:!0,perform:async t=>{const l=i.map((o=>s.vs({environment:e,block:o,blockType:"page",transaction:t})));let c;if("page"===o.type)if(r&&a){const o=r.getParentCollectionStore(),i=null==o?void 0:o.getParentPointer();i&&i.table===n.iU&&(c=await b.Y({transaction:t,environment:e,targets:l,value:{type:"page",id:i.id}}))}else{const{mainEditorCurrentBlockStore:i}=u.default.state;i&&i.id!==o.id&&(c=await b.Y({transaction:t,environment:e,targets:l,value:o}))}else"team"===o.type&&await b.Ws({transaction:t,environment:e,targets:l,value:o});return{transformedPages:l,pageStore:c}}});await _({analyticsFrom:"new_page_in",createInState:{environment:e,createdPages:l,databaseTemplate:a?r:void 0,moveToStorePromise:Promise.resolve(c)}})}},81677:(e,t,o)=>{o.d(t,{Do:()=>c,GB:()=>d,xt:()=>p,M4:()=>u});var i=o(49953),n=o(9844),r=o(19889),a=o(54642),s=o(47307),l=o(9953);function c(e,t,o){const{name:i,tagline:a,icon:s,email:c,website_url:d,privacy_policy_url:p,terms_of_use_url:u,template_page_id:m,redirect_uris:g,capabilities:h,userRootStore:f,developer_name:v}=o,y=Date.now(),b=f.id,S={name:i,parent_table:r.KJ,parent_id:b,created_at:y,created_by_id:b,created_by_table:r.KJ,updated_at:y,updated_by_id:b,updated_by_table:r.KJ,redirect_uris:g,type:"guest",status:"unpublished",info:{tagline:a,icon:s,email:c,website_url:d,privacy_policy_url:p,terms_of_use_url:u,template_page_id:m,developer_name:v},capabilities:h,alive:!0};return l.ae({environment:e,table:n.K2,value:S,transaction:t,inMemoryRecordCache:f.inMemoryRecordCache})}function d(e,t,o){const{integrationId:i,name:a,redirect_uris:s,userRootStore:c,integrationInfo:d}=o,p=Date.now(),u=c.id,m={id:i,name:a,type:"external",parent_table:r.KJ,parent_id:u,created_at:p,created_by_id:u,created_by_table:r.KJ,updated_at:p,updated_by_id:u,updated_by_table:r.KJ,redirect_uris:s,status:"unpublished",info:d,alive:!0,capabilities:{link_preview:!0}};return l.ae({environment:e,table:n.K2,value:m,transaction:t,inMemoryRecordCache:c.inMemoryRecordCache})}function p(e,t,o){const{integrationId:n,userRootStore:a,config:{oauth_authorize_url:s,oauth_token_url:c,client_id:d,client_secret:p,scopes:u,deletion_url:m}}=o,g={id:n,oauth_authorize_url:s,oauth_token_url:c,client_id:d,client_secret:p,scopes:u,parent_id:a.id,parent_table:r.KJ,deletion_url:m};return l.ae({environment:e,table:i.r9,value:g,transaction:t,inMemoryRecordCache:a.inMemoryRecordCache})}async function u(e){const{environment:t,integrationId:o,onSuccess:i}=e,n=await a.deleteIntegration(t,{integrationId:o});"failed"===n.type?s.showError(n):"success"===n.type&&i&&i()}},89733:(e,t,o)=>{o.d(t,{qk:()=>s,ke:()=>l,Bd:()=>c,Js:()=>d,iV:()=>p,HY:()=>u,_J:()=>m,Ui:()=>g,Ow:()=>h,e2:()=>f,U4:()=>v,iz:()=>b,ZU:()=>S});var i=o(12534),n=o(39500),r=o(96049),a=o(22294);const s=e=>{const{store:t,event:o,onClick:r,disabled:a}=e;if(a)return;if(o.shiftKey&&!o.altKey)return;let s=!1;(0,i.ZP)({event:o,context:i.Af.EditorClick,callback:()=>{r&&!(0,n.uG)(o)&&r(o),s=!0}}),s||(o.preventDefault(),t.setState({hovered:!1,pressed:!1}))},l=e=>{const{store:t,event:o,onContextMenu:i,disabled:n}=e;n||(t.setState({hovered:!0,pressed:t.state.pressed}),i&&i(o))},c=e=>{const{event:t,onMouseEnter:o}=e;o&&o(t)},d=e=>{const{store:t,event:o,onMouseMove:i,disabled:n,isMobile:s}=e;s||a.Z.state.isKeyboardMode||r.Z.state||n||t.setState({hovered:!0,pressed:t.state.pressed}),i&&i(o)},p=e=>{const{store:t,event:o,onMouseLeave:i,disabled:n}=e;n||t.setState({hovered:t.state.pressed,pressed:!1}),i&&i(o)},u=e=>{const{store:t,event:o,onMouseDown:n,disabled:r}=e;r||(0,i.ZP)({event:o,context:i.Af.ButtonMouseDown,callback:()=>{t.setState({hovered:t.state.hovered,pressed:!0}),n&&n(o),window.addEventListener("mouseup",t.resetIfInteracted)}})},m=e=>{const{store:t,event:o,onMouseUp:i,disabled:n}=e;n||(t.setState({hovered:t.state.hovered,pressed:!1}),i&&i(o),window.removeEventListener("mouseup",t.resetIfInteracted))},g=e=>{const{store:t,event:o,onTouchStart:n,disabled:r}=e;r||(0,i.ZP)({event:o,context:i.Af.MobileTap,callback:()=>{t.setState({hovered:t.state.hovered,pressed:!0}),n&&n(o)}})},h=e=>{const{store:t,event:o,onTouchEnd:i,disabled:n}=e;n||(t.setState({hovered:t.state.hovered,pressed:!1}),i&&i(o))},f=e=>{const{store:t,event:o,onTouchCancel:i,disabled:n}=e;n||(t.setState({hovered:t.state.hovered,pressed:!1}),i&&i(o))},v=new Set;function y(e){e.state.pressed||e.state.hovered?v.add(e):v.delete(e)}function b(e){e.addListener(y)}function S(e){e.removeListener(y),v.delete(e)}},96313:(e,t,o)=>{o.d(t,{QZ:()=>Z,pg:()=>E,az:()=>R});var i=o(26263),n=o(14577),r=o(41432),a=o(98459),s=o(80984),l=o(21202),c=o(33709),d=o(70203),p=o(97880),u=o(9953),m=o(24677),g=o(98104),h=o(95477),f=o(65598),v=o(72133),y=o(70726),b=o(64233),S=o(88833),w=o(48863),k=o(19111),C=o(3815),_=o(10743),M=o(52229),T=o(50906),I=o(94419),P=o(4408),x=o(993),B=o(30149);function Z(e){const{environment:t,textStore:o,blockStore:r,url:d,oldTextValue:p,urlSelection:u}=e;if(_.Z.state.open||S.Z.state.open||k.Z.state.open||b.Z.state.open)return!1;const m=v.get();if(!m)return!1;const g=v.getRect(m);if(!g)return!1;const M=(0,s.Wj)({url:d,baseUrl:h.Z.domainBaseUrl,publicDomainName:h.Z.publicDomainName,isMobile:t.device.isMobile,protocol:h.Z.protocol,currentUrl:ncd.href()});if("page"===M.name&&!!M.discussionId&&M.discussionId){const e=M.discussionId,s=M.blockId,m=r.getParentBlockStore();if(!m)return!1;const h=(0,C.Kv)(m,{table:l.iU,id:s,spaceId:(0,a.CG)(m.pointer.spaceId)}),v=(0,C.Kv)(h,{table:c.qF,id:e,spaceId:(0,a.CG)(r.pointer.spaceId)});if("none"===v.getRole())return!1;const b=new n.Z((()=>f.D4(v)[0]),{debugName:"firstCommentStore"}),S=new i.Z;S.isTemporaryData=!0,t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(S);const k=r.clone(S),_=o.clone(S),I=m.clone(S);return w.Z.setState({args:{commentStore:b},stores:{blockStore:r,textStore:o,parentStore:m},temporaryStores:{blockStore:k,textStore:_,parentStore:I},temporaryRecordCache:S,focusedIndex:y.Z.Preview,selectionRect:g,oldTextValue:p,open:!0,url:d,urlSelection:u}),T.trackOpenEmbedMenu(t,{url:d}),!0}return!1}function E(e){const{actionType:t,environment:o,commentStore:i,useTempStores:n}=e,r=w.Z.state;if(!r.open)return;const{oldTextValue:s}=r,l=n?r.temporaryStores:r.stores,{textStore:c,blockStore:u,parentStore:h}=l,v=o.currentUser.id;if(v){if(n){r.temporaryRecordCache.clearCache();for(const e in r.temporaryStores){const t=r.temporaryStores[e],i={userId:v,pointer:t.pointer},n=o.defaultRecordCache.inMemoryRecordCache.getRecord(i);P.Wl({environment:o,inMemoryRecordCache:r.temporaryRecordCache,pointer:t.pointer,recordWithRole:n,updatePaths:[[]],userId:v,force:!0,debugSource:"setUnfurlType"})}}else o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(r.temporaryRecordCache);switch(t){case y.Z.Link:m.eP({environment:o,store:r.stores.blockStore}),g.Z5({store:r.stores.textStore,selection:{startIndex:r.urlSelection.endIndex,endIndex:r.urlSelection.endIndex}}),w.Z.setState({...r,focusedIndex:y.Z.Link});break;case y.Z.Mention:if(!i)return;const e=(0,a.CG)(c.pointer.spaceId);if(!e)return;const n=i.id;B.createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.mention",perform:t=>{x.sO({environment:o,store:c,value:s,transaction:t}),x.lZ({environment:o,store:c,selection:{startIndex:r.urlSelection.startIndex,endIndex:r.urlSelection.startIndex},annotation:d.mf(n,e),transaction:t,analyticsFrom:"block"})}}),w.Z.setState({...r,focusedIndex:y.Z.Mention});break;case y.Z.Preview:if(!i)return;B.createAndCommit({environment:o,userAction:"internalUnfurlingMenuActions.preview",perform:e=>{x.sO({environment:o,store:c,value:s,transaction:e});const t=f.GP(i);if(!t)return;if(!f.HK(t)||!h||!t.getParentId())return;const n=M.k({environment:o,parentBlock:h,targetStore:i,transaction:e});if(I.BE({parent:h.getContentStore(),insert:n,after:u,transaction:e}),0===d.Q(r.oldTextValue).trim().length){const t=C.G.createChildStore(h.getContentStore(),r.stores.blockStore.pointer);I.Od({parent:h.getContentStore(),childToRemove:t,transaction:e})}}}),w.Z.setState({...r,focusedIndex:y.Z.Preview});break;default:throw(0,p.t1)(t)}n||w.Z.setState({open:!1})}}function R(e){var t,o;const{block:i,transaction:n}=e,a=i.getType(),s=i.getFormat(),l=i.getSpaceId();if(!i.isDefined()||a!==r.Ti.alias||null==s||null===(t=s.alias_pointer)||void 0===t||!t.id)return;const c=[d.YC(d.mf(null==s||null===(o=s.alias_pointer)||void 0===o?void 0:o.id,l))];u.sO({store:i,value:{type:r.Ti.text,properties:{title:c},format:null},transaction:n})}},62134:(e,t,o)=>{o.d(t,{dJ:()=>a,Fe:()=>s,ys:()=>l,Zm:()=>c,fg:()=>d,B4:()=>p});var i=o(96486),n=o.n(i);function r(e,t){return e.KeyboardShortcutStackStore.state.stack.some((e=>t===e.listener))}function a(e,t,o){const{stack:i}=e.KeyboardShortcutStackStore.state;for(let n=i.length-1;n>=0;n--){const e=i[n],r=e.shortcuts[o];if(e.enable&&r)return void r(t)}}function s(e){const{environment:t,stackItem:o}=e,i=t.KeyboardShortcutStackStore;if(r(t,o.listener)){const e=i.state.stack.map((e=>e.listener===o.listener?o:e));i.setState({...i.state,stack:e})}else i.state.stack.push(o),i.setState({stack:n().sortBy(i.state.stack,(e=>e.priority))})}function l(e,t){if(r(e,t)){const o=e.KeyboardShortcutStackStore,i=o.state.stack,r=n().reject(i,(e=>t===e.listener));o.setState({...o.state,stack:r})}}function c(e,t){a(e,t,t.type)}function d(e){return{command:e.device.isMac?"⌘":"ctrl",enter:"↵",delete:"del",backspace:"del",esc:"escape",left:"←",right:"→",up:"↑",down:"↓",tab:"⇥",alt:e.device.isMac?"⌥":"alt"}}function p(e){return{command:e.device.isMac?"command":"control",esc:"escape"}}},94273:(e,t,o)=>{o.d(t,{Bk:()=>c,Vr:()=>d,Ie:()=>p});var i=o(80984),n=o(21202),r=o(95477),a=o(84210),s=o(15517),l=o(3815);function c(e,t){const o=i.Wj({url:ncd.href(),isMobile:e.device.isMobile,baseUrl:r.Z.domainBaseUrl,publicDomainName:r.Z.publicDomainName,protocol:r.Z.protocol,currentUrl:ncd.href()}),{route:a,userId:c}=(0,s.zI)();("root"===o.name||"new"===o.name||"nativeTab"===o.name)&&a&&"page"===a.name&&a.blockId&&c===t&&new l.G(e,{table:n.iU,id:a.blockId,spaceId:a.spaceId}).load()}function d(e){const{route:t,userId:o}=(0,s.zI)();if(t&&"page"===t.name){return{url:(0,a.ZP)({fullyQualified:!1,store:new l.G(e,{table:n.iU,id:t.blockId,spaceId:t.spaceId},{userId:o}),scrollToBlockId:t.scrollToBlockId,peekViewBlockId:t.peekViewBlockId,peekMode:t.peekMode,collectionViewId:t.collectionViewId,templateGalleryItem:t.templateGalleryItem,discussionId:void 0}),userId:o}}if(t&&"space"===t.name){return{url:(0,i.Xs)({route:t}),userId:o}}return{}}async function p(e){const{route:t,userId:o}=(0,s.zI)();let r,c;if(t)if("page"===t.name){const i=new l.G(e,{table:n.iU,id:t.blockId,spaceId:t.spaceId},{userId:o});r=(0,a.ZP)({fullyQualified:!1,store:i,scrollToBlockId:t.scrollToBlockId,peekViewBlockId:t.peekViewBlockId,peekMode:t.peekMode,collectionViewId:t.collectionViewId,templateGalleryItem:t.templateGalleryItem,discussionId:void 0}),await i.load(),c=i.getSpaceId()}else"space"===t.name?(c=t.spaceId,r=(0,i.Xs)({route:t})):("nativeTab"===t.name||"workspaceSetup"===t.name)&&(c=t.spaceId);return{url:r,userId:o,route:t,spaceId:c}}},20747:(e,t,o)=>{o.d(t,{U_:()=>h,FZ:()=>f,fU:()=>b});var i=o(41432),n=o(21202),r=o(3815),a=o(26664),s=o(50906),l=o(96802),c=o(94419),d=o(9953);const p=function(e){const t=e.getRecordStoreUIAncestor(2);if(t&&t instanceof r.G&&t.isType(i.Ti.columnList))return t},u=function(e){return e&&e instanceof r.G&&e.isType(i.Ti.column)};function m(e){const{environment:t,targets:o,inMemoryRecordCache:n,transaction:r}=e,a=d.j4({environment:t,type:i.Ti.columnList,properties:{},inMemoryRecordCache:n,transaction:r,spaceId:0!==o.length?o[0].pointer.spaceId:void 0}),l=a.getContentStore();for(const i of o)c.R3({parent:l,append:i,transaction:r});return s.trackCreateColumnList(t),a}function g(e){const{environment:t,targets:o,inMemoryRecordCache:n,transaction:r}=e,a=d.j4({environment:t,type:i.Ti.column,format:{column_ratio:1},inMemoryRecordCache:n,transaction:r,spaceId:0!==o.length?o[0].pointer.spaceId:void 0}),s=a.getContentStore();for(const i of o)c.R3({parent:s,append:i,transaction:r});return a}function h(e){const{environment:t,parent:o,insertStores:i,left:a,transaction:l}=e;let d,h;if(s.trackInsertColumn(t,{side:"left"}),u(a))d=a,h=p(a);else{d=g({environment:t,targets:[a],inMemoryRecordCache:o.inMemoryRecordCache,transaction:l});const i=m({environment:t,targets:[d],inMemoryRecordCache:o.inMemoryRecordCache,transaction:e.transaction});h=c.rS({parent:o,oldChild:a,newChild:i,transaction:l}).child}const f=g({environment:t,targets:i,inMemoryRecordCache:o.inMemoryRecordCache,transaction:l});if(h){const t=h.getContentStore();c.Vt({parent:t,insert:f,before:d,transaction:e.transaction}),v({columnList:h,addedColumn:f,transaction:l});return r.G.createChildStore(t,{table:n.iU,id:f.id}).getContentStores()}return[]}function f(e){const{environment:t,parent:o,insertStores:i,right:a,transaction:l}=e;let d,h;if(s.trackInsertColumn(t,{side:"right"}),u(a))d=a,h=p(a);else{d=g({environment:t,targets:[a],inMemoryRecordCache:o.inMemoryRecordCache,transaction:l});const i=m({environment:t,targets:[d],inMemoryRecordCache:o.inMemoryRecordCache,transaction:e.transaction});h=c.rS({parent:o,oldChild:a,newChild:i,transaction:l}).child}const f=g({environment:t,targets:i,inMemoryRecordCache:o.inMemoryRecordCache,transaction:l});if(h){const t=h.getContentStore();c.BE({parent:t,insert:f,after:d,transaction:e.transaction}),v({columnList:h,addedColumn:f,transaction:l});return r.G.createChildStore(t,{table:n.iU,id:f.id}).getContentStores()}return[]}const v=function(e){const{columnList:t,addedColumn:o,transaction:i}=e,n=t.getContentStores(),r=1/n.length;l.FH({stores:[o],update:{column_ratio:r},transaction:i});for(const a of n)if(a.id!==o.id){const e=a.getColumnRatio();l.FH({stores:[a],update:{column_ratio:(1-r)*e},transaction:i})}},y=function(e){const{columnList:t,removedColumn:o,transaction:i}=e,n=t.getContentStores(),r=o.getColumnRatio();for(const a of n){const e=a.getColumnRatio();l.FH({stores:[a],update:{column_ratio:e/(1-r)},transaction:i})}},b=function(e){const{parent:t,transaction:o}=e,i=t.getRecordStoreUIParent();let n;if(u(i)&&(n=p(i)),n){const e=n.getContentStore(),t=n.getContentStores();for(const r of t){0===r.getContentStores().length&&(c.Od({parent:e,childToRemove:r,shouldGarbageCollect:!1,transaction:o}),y({columnList:n,removedColumn:r,transaction:o}))}const i=n.getContentStores();if(0===i.length){const e=n.getRecordStoreUIParent();null!=e&&e.valueIs(a.i)&&c.Od({parent:e,childToRemove:n,transaction:o,shouldGarbageCollect:!1})}else if(1===i.length){const e=n.getRecordStoreUIParent(),t=i[0],r=t.getContentStore(),s=t.getContentStores();if(s.reverse(),null!=e&&e.valueIs(a.i)){for(const t of s)c.Od({parent:r,childToRemove:t,shouldGarbageCollect:!1,transaction:o}),c.BE({parent:e,insert:t,after:n,transaction:o});c.Od({parent:e,childToRemove:n,transaction:o,shouldGarbageCollect:!1})}}}}},65770:(e,t,o)=>{o.r(t),o.d(t,{fixLegacyTransclusion:()=>y,DEV_ONLY_createLegacyTransclusion:()=>b});var i=o(41432),n=o(98459),r=o(9953),a=o(42858),s=o(8713),l=o(993),c=o(30149),d=o(95477),p=o(28020),u=o(65598),m=o(27724),g=o(52543),h=o(54532),f=o(94419),v=o(24677);function y(e){const{environment:t,store:o}=e,i=o.getRecordStoreUIParent();i&&(0,u.dz)(i)&&c.createAndCommit({userAction:"legacyTransclusionActions.fixLegacyTransclusion",environment:t,perform:e=>{const[r]=h.Qi({environment:t,store:o,addCopyName:!1,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,targetSpaceId:(0,n.CG)(o.pointer.spaceId),baseUrl:d.Z.domainBaseUrl,publicDomainName:d.Z.publicDomainName,preferDuplicateLocation:"local"}),{child:s}=f.BE({parent:i,insert:r,after:o,transaction:e});a.Od({store:o,transaction:e}),v.Z5({environment:t,stores:[s]})}})}function b(e){c.createAndCommit({userAction:"legacyTransclusionActions.DEV_ONLY_createLegacyTransclusion",environment:e,perform:t=>{var o;const n=m.default.getCurrentRecordCache();if(!n)throw new Error("No in-memory record cache!");if(function(e){const{environment:t,transaction:o}=e,i=g.Z.state;if(!i.isActive)return!1;const{selection:n,simpleTableStore:a}=i,l=s.iz({environment:t,index:n.end.row+1,simpleTableStore:a,transaction:o});return r.sW({store:l,data:{parent_id:a.getParentId(),parent_table:a.getParentTable()},transaction:o}),!0}({environment:e,transaction:t}))return;const d=null===(o=p.RM())||void 0===o?void 0:o.pointer.spaceId,u=r.j4({environment:e,type:i.Ti.text,inMemoryRecordCache:n,transaction:t,spaceId:d}),h=u.getTitleStore();h&&l.mM({environment:e,store:h,tokens:[['here is a legacy transclusion (a.k.a. "phantom synced block")']],index:0,transaction:t});const f=r.j4({environment:e,type:i.Ti.toggle,inMemoryRecordCache:n,transaction:t,spaceId:d}),v=f.getTitleStore();v&&l.mM({environment:e,store:v,tokens:[["this toggle has a legacy transclusion in it"]],index:0,transaction:t});const y=f.getContentStore();c.applyOperation({transaction:t,store:y,operation:{pointer:y.pointer,path:y.path,command:"set",args:[u.id]}}),a.is({environment:e,blocks:[u,f],selection:m.default.state.stores,transaction:t,replaceEmptyTextBlock:!1})}})}},45990:(e,t,o)=>{o.d(t,{dz:()=>u,gp:()=>m,PP:()=>g,iX:()=>h,F5:()=>f});var i=o(70203),n=o(48709),r=o(68056),a=o(72133),s=o(23178),l=o(24666),c=o(993),d=o(98104),p=o(30149);const u=e=>{const t=l.default.state;if("editing"!==t.mode)return;const o="selectionFocus"===e.type?(0,r.TD)({store:e.store,selection:e.selection}):t.multiSelection,c=(0,r.QY)(o);if(!c)return;const{tokensInsideRange:d}=i.xr(c.store.getValue(),o.start.index,o.end.index),p=d.find((e=>Boolean(i.Hz(e)))),u=a.get();if(!u)return;const m=a.getRect(u);if(!m)return;const g=Boolean(p);s.Z.setState({open:!0,url:"",title:p&&(0,n.Ts)(p)||"",editingToken:p,savedTextSelectionState:{...t,multiSelection:o},selectionRect:m,focusLinkInput:!g&&e.focus,focusTitleInput:g&&e.focus})};function m(e){const{environment:t,transaction:o,url:i,title:n,editingToken:a,savedTextSelectionState:s}=e,l=(0,r.QY)(s.multiSelection);if(!l)return;a&&c.Be({environment:t,store:l.store,type:"a",selection:l.selection,transaction:o});const p=["a",i];return c.i8({environment:t,store:l.store,annotation:p,selection:l.selection,transaction:o}),d.Z5({store:l.store,selection:{startIndex:l.selection.startIndex,endIndex:l.selection.endIndex}}),n?{editingToken:[n,[p]]}:void 0}function g(e){const t=s.Z.state;if(!t.open)return;const{editingToken:o,savedTextSelectionState:i}=t;if(!o)return;const n=(0,r.QY)(i.multiSelection);n&&(p.createAndCommit({userAction:"linkAnnotationActions.unlinkSelection",environment:e,perform:t=>{c.Be({environment:e,store:n.store,type:"a",selection:n.selection,transaction:t})}}),l.default.emit(),s.Z.reset())}function h(e){const{environment:t,title:o,transaction:n,editingToken:a,savedTextSelectionState:s}=e;if(!o||!a)return;const l=(0,r.QY)(s.multiSelection);if(!l)return;const p=l.store;c.pz({environment:t,multiSelection:s.multiSelection,transaction:n});const u=l.selection.startIndex,m=u+o.length,g={startIndex:u,endIndex:m},h=["a",i.Hz(a)],f=i.V3(o);return c.mM({environment:t,store:p,tokens:[f],index:u,transaction:n}),c.i8({environment:t,store:p,annotation:h,selection:g,transaction:n}),d.Z5({store:p,selection:g}),{editingToken:[o,[h]],savedTextSelectionState:{...s,multiSelection:{start:{store:p,index:u},end:{store:p,index:m}}}}}function f(){s.Z.setState({open:!1})}},94419:(e,t,o)=>{o.d(t,{rS:()=>a,BE:()=>s,Vt:()=>l,Od:()=>c,MK:()=>d,R3:()=>p,Ce:()=>u,HP:()=>m});var i=o(20747),n=o(19358),r=o(30149);const a=function(e){const{parent:t,oldChild:o,newChild:i,transaction:a}=e,s=o.id,l=i.id,c=(t.getValue()||[]).indexOf(s);n.D0({parentStore:t,childStore:i,transaction:a}),n.If({parentStore:t,childStore:o,transaction:a}),c>=0&&(r.applyOperation({transaction:a,store:t,operation:{pointer:t.pointer,path:t.path,command:"listAfter",args:{id:l,after:s}}}),r.applyOperation({transaction:a,store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:s}}}));return{parent:t,child:i.cloneWithNewUIParent(t)}},s=function(e){const{parent:t,insert:o,after:i,transaction:a}=e;let s;i&&(s=i.id),n.D0({parentStore:t,childStore:o,transaction:a}),r.applyOperation({transaction:a,store:t,operation:{pointer:t.pointer,path:t.path,command:"listAfter",args:{after:s,id:o.id}}});return{parent:t,child:o.cloneWithNewUIParent(t)}},l=function(e){const{parent:t,insert:o,before:i,transaction:a}=e;let s;i&&(s=i.id),n.D0({parentStore:t,childStore:o,transaction:a}),r.applyOperation({transaction:a,store:t,operation:{pointer:t.pointer,path:t.path,command:"listBefore",args:{before:s,id:o.id}}});return{parent:t,child:o.cloneWithNewUIParent(t)}},c=function(e){void 0===e.shouldGarbageCollect&&(e.shouldGarbageCollect=!0);const{parent:t,childToRemove:o,shouldGarbageCollect:a,transaction:s}=e;n.If({parentStore:t,childStore:o,transaction:s}),r.applyOperation({transaction:s,store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:o.id}}}),a&&s.preEnqueueActions.push((()=>{i.fU({parent:t,transaction:s})}));const l=o.cloneWithNewUIParent(t);return{parent:t,child:l}},d=function(e){const{parent:t,append:o,transaction:i}=e;n.D0({parentStore:t,childStore:o,transaction:i}),r.applyOperation({transaction:i,store:t,operation:{pointer:t.pointer,path:t.path,command:"keyedObjectListAfter",args:{value:o.pointer,after:void 0}}});return{parent:t,child:o.cloneWithNewUIParent(t)}},p=function(e){const{parent:t,append:o,transaction:i,after:a}=e;n.D0({parentStore:t,childStore:o,transaction:i}),r.applyOperation({transaction:i,store:t,operation:{pointer:t.pointer,path:t.path,command:"listAfter",args:{id:o.id,after:a}}});return{parent:t,child:o.cloneWithNewUIParent(t)}},u=function(e){const{parent:t,prepend:o,transaction:i,before:a}=e;n.D0({parentStore:t,childStore:o,transaction:i}),r.applyOperation({transaction:i,store:t,operation:{pointer:t.pointer,path:t.path,command:"listBefore",args:{id:o.id,before:a}}});return{parent:t,child:o.cloneWithNewUIParent(t)}},m=function(e){const{parent:t,current:o,after:i,transaction:n}=e;i?s({parent:t,insert:o,after:i,transaction:n}):u({parent:t,prepend:o,transaction:n});return{parent:t,child:o.cloneWithNewUIParent(t)}}},13084:(e,t,o)=>{o.d(t,{LQ:()=>T,uQ:()=>I,DC:()=>P,Bm:()=>x,HO:()=>B,UG:()=>Z});var i=o(96486),n=o.n(i),r=o(1302),a=o(41432),s=o(14248),l=o(21202),c=o(95371),d=o(28020),p=o(65598),u=o(69645),m=o(73959),g=o(55367),h=o(3815),f=o(49865),v=o(42239),y=o(72747),b=o(20747),S=o(94419),w=o(9953),k=o(42858),C=o(24677),_=o(21325),M=o(98104);function T(e){const{environment:t,droppedDirection:o,droppedStores:i,targetStore:r,targetParentStore:l,transaction:c,duplicate:d}=e,p=i.every((e=>e.isExternalObjectInstancePageBlockStore()))||d;if(r&&o===g.vh.Onto){C.ZH(t);const e=!(r.isInsideTemplate()||r.isInsideFactoryOrDuplicateBlocksAction()),o=v.LQ({environment:t,droppedStores:i,duplicate:p,transaction:c,resolveTemplateVariables:e});let n=r;if(r.isType(a.Ti.alias)){const e=r.getAliasTargetStore();if(!e)throw new Error("Alias has no target.");e instanceof h.G&&(n=e)}const l=n.getCollectionViewCollectionStore();if(n.isCollectionView()&&!n.isCollectionViewPageWithContent()){if(!l)throw new Error("CollectionStore is not defined.");const e=f.o3({environment:t,stores:o,transaction:c,collectionStore:l});for(const o of e)f.mp({environment:t,store:o,collectionStore:l,coerce:!0,results:[],groupsPointer:[],transaction:c});return e}{const e=n.getAssociatedCollectionStore();if(null!=e&&e.isPageTreeCollection())for(const i of o){if("page"!==i.getType())continue;if(!i.isDefined())continue;const t=s.Xq({blockProperties:i.getProperties(),oldSchema:i.getSchema(),newSchema:e.getSchema()});t.propertyUpdate&&Object.keys(t.propertyUpdate).length>0&&w.sW({store:i.getPropertiesStore(),data:t.propertyUpdate,transaction:c})}const t=n.getContentStore();for(const i of o)S.R3({parent:t,append:i,transaction:c});return o}}{const e=!!r&&!(r.isInsideTemplate()||r.isInsideFactoryOrDuplicateBlocksAction(!1));let a=v.LQ({environment:t,droppedStores:i,duplicate:p,transaction:c,resolveTemplateVariables:e});return o===g.vh.Above?(a=n().clone(a),r?a=n().map(a,(e=>S.Vt({parent:l,insert:e,before:r,transaction:c}).child)):(a.reverse(),a=n().map(a,(e=>S.Ce({parent:l,prepend:e,transaction:c}).child)))):o===g.vh.Below?(a=n().clone(a),r?(a.reverse(),a=n().map(a,(e=>S.BE({parent:l,insert:e,after:r,transaction:c}).child))):a=n().map(a,(e=>S.R3({parent:l,append:e,transaction:c}).child))):r&&o===g.vh.Left?a=b.U_({environment:t,parent:l,insertStores:a,left:r,transaction:c}):r&&o===g.vh.Right&&(a=b.FZ({environment:t,parent:l,insertStores:a,right:r,transaction:c})),k.DV({environment:t,insertedStores:a}),C.Z5({environment:t,stores:a}),a}}function I(e){const{environment:t,files:o,droppedDirection:i,targetStore:n,targetParentStore:r,transaction:a}=e,s=r.inMemoryRecordCache,l=d.qQ(t);T({environment:t,targetParentStore:r,targetStore:n,droppedDirection:i,droppedStores:y.z({environment:t,files:o,inMemoryRecordCache:s,pageWidth:l,transaction:a,spaceId:null==n?void 0:n.pointer.spaceId}),duplicate:!1,transaction:a})}function P(e){const{environment:t,targetStore:o,isAtStartOfLine:i}=e;(function(e){const{environment:t,isClick:o,targetStore:i}=e;if(!o)return!1;const n=i.findRecordStoreUIAncestor((e=>e instanceof h.G&&e.isTransclusionType())).ancestor;if(n&&n instanceof h.G){const e=i.findRecordStoreUIAncestor((e=>e instanceof h.G&&e.getType()===a.Ti.transclusionReference)).ancestor,o=(e&&e instanceof h.G?e:void 0)||n,r=o.getRecordStoreUIParent();if(!r||!(0,p.dz)(r))return;return C.Z5({environment:t,stores:[o]}),!0}return!1})(e)||A({environment:t,store:o,isAtStartOfLine:i})||function(e){const{environment:t,targetStore:o,isAtStartOfLine:i}=e,n=C.KX(),r=n.indexOf(o);if(-1===r)return!1;if(i)for(let a=r;a>=0&&a>r-20;a--){if(A({environment:t,store:n[a],isAtStartOfLine:!1}))return!0}else for(let a=r;a<n.length&&a<r+20;a++){if(A({environment:t,store:n[a],isAtStartOfLine:!0}))return!0}}(e)}function x(e){const{environment:t,targetStore:o,isAtStartOfLine:i}=e;A({environment:t,store:o,isAtStartOfLine:i})||R({...e,placement:"after"})}function B(e){return E(e)}function Z(e){return E(e)}function E(e){const{environment:t,container:o,store:i,transaction:r}=e,s=function(e){var t;const{container:o,store:i}=e;let r=(0,u.dq)({includeNonSelectableListContainer:!0,container:o});r&&i&&(r=n().last((0,c.DY)([r],(e=>e.value.store===i))));if(!r)return;let s=r;for(;s.children.length>0;){const e=n().last(s.children);if(0===e.children.length)break;const t=e.value.store.getType();if(t&&a.BT[t])break;s=e}return{parentStore:s.value.store,siblingStore:null===(t=n().last(s.children))||void 0===t?void 0:t.value.store}}({container:o,store:i});if(!s)return!1;const{parentStore:d,siblingStore:m}=s;if(m&&(0,p.PF)(m))return!1;const g=d.getParentStore();return R({environment:t,targetParentStore:(d.getType()===a.Ti.tab&&(null==g?void 0:g.table)===l.iU?g:d).getContentStore(),placement:"after",transaction:r})}function R(e){const{environment:t,targetStore:o,targetParentStore:i,placement:n,transaction:s}=e;if(i.getValue()&&_.M_(t)&&_.M_(t)){const e=w.j4({environment:t,type:a.Ti.text,inMemoryRecordCache:i.inMemoryRecordCache,transaction:s,spaceId:i.pointer.spaceId}),l="after"===n?S.BE({parent:i,after:o,insert:e,transaction:s}):S.Vt({parent:i,before:o,insert:e,transaction:s});return r.default.afterNextFlush((()=>{A({environment:t,store:l.child,isAtStartOfLine:!1})})),!0}return!1}function A(e){const{environment:t,store:o,isAtStartOfLine:i}=e,n=(0,m.mh)(o);return!!n&&(C.eP({environment:t,store:o}),i?M.N_({store:n}):M.NX({store:n}),!0)}},20073:(e,t,o)=>{o.d(t,{O:()=>n,I:()=>r});var i=o(23883);const n=e=>{const{cursors:t,rootStore:o}=e,n={};for(const i of t)for(const e of i.stack)for(const t of e)n[t.id]=t.index;i.Z.setLimitParents(o,n)},r=e=>{i.Z.removeLimitParents(e.rootStore)}},92625:(e,t,o)=>{o.d(t,{j:()=>r,x:()=>a});var i=o(33929),n=o(31104);const r=function(e){let{message:t,interpolatedValues:o,targetRecordId:r}=e;n.Z.setState({open:!0,message:i.default.formatMessage(t,o),targetRecordId:r})},a=function(){n.Z.setState({open:!1,targetRecordId:void 0})}},35979:(e,t,o)=>{o.d(t,{z_:()=>l,Be:()=>c,_5:()=>d,V_:()=>p,lJ:()=>m,wt:()=>g,nk:()=>h,TR:()=>f,WA:()=>v});var i=o(2280),n=o(50906),r=o(51456),a=o(10161);function s(e,t){r.track(e,t)}function l(e){s(e,"request_login_with_apple"),u(e,"login-with-apple")}function c(e){s(e,"request_login_with_google"),u(e,"login-with-google")}function d(e){s(e,"send_temporary_password"),u(e,"temporary-passcode")}function p(e){s(e,"redirect_to_saml_login"),u(e,"saml")}function u(e,t){r.track(e,"login_attempt",{login_method:t})}function m(e,t){n.trackServersideOnboarding(e,"signup_login_button_clicked",t),a.default.logEvent("signup_login_button_clicked",t.login_method,t)}function g(e,t){r.track(e,"login_success",t,{dontWait:!0})}function h(e,t){const{isBannedGoogleSSOUserAgent:o,isSignup:r}=t;n.trackServersideOnboarding(e,"onboarding_landing_page",{is_banned_google_sso_user_agent:o,is_signup:r}),r&&i.T1()}function f(e,t){const{actionType:o,isSignup:i}=t;r.track(e,"google_one_tap_login_button_click",{is_signup:Boolean(i),action_type:o},{dontWait:!0})}function v(e,t){r.trackThrottled(e,"login_email_input_updates","login_email_input_updates",1,{email:t})}},97977:(e,t,o)=>{o.r(t),o.d(t,{requestLoginWithApple:()=>fe,requestLoginWithGoogleOneTap:()=>ye,requestLoginWithGoogle:()=>Se,requestLoginWithEmail:()=>we,requestLoginWithSaml:()=>ke,sendPasswordResetLink:()=>Ce,sendTemporaryPassword:()=>_e,verifyEmail:()=>Me,loginWithTemporaryPasscode:()=>Te,handleLoginWithTemporaryPasscodeSuccess:()=>Ie,loginWithPassword:()=>Pe,completeLoginWithMfa:()=>xe,loginWithAppleAuth:()=>Be,loginWithGoogleAuth:()=>Ze,redirectToSaml:()=>Ee,loginSamlUserWithToken:()=>Re,loginPasswordReset:()=>Ae,loginSamlUser:()=>De,loginAsAdmin:()=>Fe,logoutSingleAccount:()=>Le,logout:()=>Ve,clearCurrentUser:()=>Ne,actuallyLogoutAndDeleteAllLocalData:()=>Oe,handleLoginSuccess:()=>Ue,handleTryAnotherAccount:()=>ze,setLocalStorageUserId:()=>Ke,initialize:()=>Ye,redirectToLoginOnErrorResponse:()=>Ge,shouldCreatePassword:()=>Xe,checkUserHasEducationPlan:()=>qe});var i=o(96486),n=o.n(i),r=o(13991),a=o(87997),s=o(2280),l=o(46826),c=o(65917),d=o(59730),p=o(2911),u=o(29477),m=o(4615),g=o(80984),h=o(89101),f=o(19889),v=o(66079),y=o(9852),b=o(54153),S=o(64002),w=o(66504),k=o(5366),C=o(84908),_=o(29974),M=o(95477),T=o(51456),I=o(71935),P=o(11781),x=o(12955),B=o(33954),Z=o(58026),E=o(87381),R=o(33929),A=o(28125),D=o(57491),F=o(78873),L=o(33665),V=o(472),N=o(15517),O=o(21115),U=o(87629),H=o(32223),z=o(81831),W=o(47958),j=o(58455),K=o(79315),Y=o(10161),G=o(33759),X=o(39218),q=o(12768),$=o(3815),J=o(27724),Q=o(76487),ee=o(17364),te=o(24666),oe=o(50906),ie=o(54642),ne=o(85266),re=o(47307),ae=o(57400),se=o(94273),le=o(92625),ce=o(35979),de=o(15356),pe=o(4408),ue=o(5978),me=o(70782);const ge=(0,k.defineMessages)({loggingInWithApple:{id:"loginActions.loggingInWithApple.loadingMessage",defaultMessage:"Logging in with Apple…"},loggingInWithGoogle:{id:"loginActions.loggingInWithGoogle.loadingMessage",defaultMessage:"Logging in with Google…"},googleErrorMessage:{id:"loginActions.loggingInWithGoogle.errorMessage",defaultMessage:"Something went wrong while trying to log in with Google."},unsavedChanges:{id:"loginActions.dialogError.logoutUnsavedChanges.message",defaultMessage:"You have unsaved changes. If you log out now, you could lose them."},logoutWithoutSaving:{defaultMessage:"Discard edits and log out",id:"loginActions.dialogError.logoutUnsavedChanges.confirmButton.label"},titleMessage:{defaultMessage:"Google login",id:"loginActions.googleLoginPopupModal.title"},signupPendingMessage:{defaultMessage:"Creating Notion account…",id:"loginActions.signup.pending.message",description:"Message for the signup pending dialog."},loginPendingMessage:{defaultMessage:"Logging in to Notion…",id:"loginActions.login.pending.message",description:"Message for the login pending dialog."},redirectSamlMessage:{defaultMessage:"SAML SSO required. Redirecting to the configured login page.",id:"loginActions.login.redirect.saml.message",description:"Message for the redirect saml dialog."}});async function he(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=[];if(t){const e=(0,y.getOauthAuthorizationParams)();sessionStorage.clear(),(0,y.setOauthAuthorizationParams)(e)}else sessionStorage.clear();if(N.ZL(),i.push(je(e)),o&&i.push(Ne(e)),i.push(oe.deidentifyCurrentUser()),e.mobileNative){i.push(e.mobileNative.logoutOfGoogle());const t=W.U(e.mobileNative);t&&i.push(t.clearStorage(e.mobileNative)),i.push(e.mobileNative.cancelUserBackgroundTasks())}if(e.device.isElectron&&(C.clearBrowserHistory(),t||C.clearCookies()),K.default.reset(),J.default.reset(),te.default.reset(),pe.LK(e),H.resetRecordSubscriptions(),Q.Z.reset(),j.default.reset(),q.default.reset(),i.push((0,Z.a)()),i.push(X.transactionQueue.reset()),"on"===Y.default.getGroup("clear-record-cache-on-login")){const t=e.defaultRecordCache.persistedRecordCache;t&&"reset"in t&&i.push(t.reset())}Y.default.reset(),await Promise.all(i)}async function fe(e){const{environment:t,store:o}=e,{mobileNative:i}=t,n=await(0,E.loadCurrentUserId)(t);if(ce.z_(t),i&&i.hasNativeAppleLogin())return void(await async function(e){const{environment:t,store:o,previousPersistedUserId:i}=e,{mobileNative:n}=t;if(!n)return;const r=await n.requestNativeAppleAuth();if(!r)return;if(r.error)c.log({level:"error",from:"loginActions",type:"requestNativeAppleAuth",error:(0,p.Ui)(r.error)});else{le.j({message:ge.loggingInWithApple});const{code:e,nonce:n,firstName:a,lastName:s}=r.value,l=await ie.loginWithAppleNativeAuth(t,{code:e,nonce:n,firstName:a,lastName:s});if("success"===l.type){const{isNewSignup:e,userId:o}=l.data;await Ue({environment:t,isNewSignup:e,userId:o,previousPersistedUserId:i,loginMethod:"login-with-apple"}),le.x()}else{await $e(t,l);const e=(0,B.wf)(R.default.getIntl(),l);o.setState({...o.state,alert:e}),le.x()}}}({environment:t,store:o,previousPersistedUserId:n}));const r=(0,I.IJ)(t);let a=g.MQ(M.Z.domainBaseUrl,{authType:r});a=r.redirectToAuth?a:await(0,I.HU)(t,a),t.mobileNative?be(t,a):t.device.isElectron&&C.electronApi?C.electronApi.openExternalUrl(a):window.location.href=a}const ve=R.default.formatMessage(ge.googleErrorMessage);async function ye(e){const{environment:t,idToken:o,store:i,frontPathName:n}=e,r=await(0,E.loadCurrentUserId)(t),a=V.default.createMetric("login_time.google"),s=await ie.loginWithGoogleJwt(t,{idToken:o});if(V.default.emit(t,a,void 0),"success"===s.type){const{isNewSignup:e,userId:o}=s.data;return await Ue({environment:t,isNewSignup:e,userId:o,previousPersistedUserId:r,loginMethod:"login-with-google-onetap",frontPathName:n}),{status:"success"}}{await $e(t,s);const e=(0,B.wf)(R.default.getIntl(),s);return i.setState({...i.state,alert:e}),{status:"fail"}}}function be(e,t){e.mobileNative&&((0,I.Q7)(e)?e.mobileNative.openAuthSessionBrowser(t):e.mobileNative.openInAppBrowser(t))}async function Se(e){const{environment:t,store:o,email:i,permissionsStore:n}=e,{mobileNative:r}=t,a=await(0,E.loadCurrentUserId)(t);ce.Be(t);const s=r&&r.hasNativeGoogleLogin()?()=>r.requestGoogleJwt():void 0;if(s){const e=await s();if(e){if(e.error)return void c.log({level:"error",from:"loginActions",type:"requestGoogleJwt",error:(0,p.Ui)(e.error)});{le.j({message:ge.loggingInWithGoogle});const{idToken:i}=e.value,{device:n}=t,r=n.isElectron?"nativeredirect":n.isNative?"native":void 0,s=V.default.createMetric("login_time.google"),l=await ie.loginWithGoogleJwt(t,{idToken:i,callbackType:r});if(V.default.emit(t,s,void 0),"success"===l.type){const{isNewSignup:e,userId:o}=l.data;await Ue({environment:t,isNewSignup:e,userId:o,previousPersistedUserId:a,loginMethod:"login-with-google"}),le.x()}else await $e(t,l),o.setState({...o.state,alert:ve}),le.x()}return}}const l=(0,I.eC)(t);let d=g.OB(M.Z.domainBaseUrl,{email:i,contacts:n.state.contacts,authType:l});if(d=l.redirectToAuth?d:await(0,I.HU)(t,d,!(!t.mobileNative||"local"!==M.Z.env)),t.mobileNative)be(t,d);else if("redirect"===l.callbackType)window.location.href=d;else if(t.device.isElectron&&C.electronApi)C.electronApi.openExternalUrl(d);else{const e=await de.M(t,{width:610,height:700,url:d,titleMessage:ge.titleMessage});if(!e)return;const o=S.K5({url:S.T1(e),pathname:h._j.googleAuthCallback});ue.navigate({environment:t,url:o})}}async function we(e){const{disableLoginLink:t,loginStore:o,environment:i,recaptchaOptions:n,turnstileOptions:r}=e;if(!o.isEmail())return;const{email:a}=o.state,l=await ie.getLoginOptions(i,{email:a});if("failed"===l.type){const e=(0,B.wf)(R.default.getIntl(),l);return o.setState({...o.state,loginType:"email",alert:e}),void function(e,t){(0,T.track)(e,"login_invalid_email_submitted",{invalidEmail:t})}(i,a)}const c=l.data;return"required"===c.samlSignIn?(await Je(2e3),o.setState({...o.state,loginType:"saml",alert:"Redirecting you to use SAML SSO"}),void ke({environment:i,loginStore:o})):((0,s.k3)(i.device,a),c.hasAccount?void(c.mustReverify?await _e({environment:i,store:o,reverify:!0,disableLoginLink:t,recaptchaToken:await(0,P.Of)(n,"login_temporary_password"),turnstileToken:await(0,P.hc)(i,r,"login_temporary_password")}):c.passwordSignIn?o.setState({...o.state,loginType:"password",alert:void 0}):(o.setState({...o.state,hasAccount:!0}),_e({environment:i,store:o,disableLoginLink:t,recaptchaToken:await(0,P.Of)(n,"login_temporary_password"),turnstileToken:await(0,P.hc)(i,r,"login_temporary_password")}))):(o.setState({...o.state,hasAccount:!1}),void _e({environment:i,store:o,disableLoginLink:t,recaptchaToken:await(0,P.Of)(n,"login_temporary_password"),turnstileToken:await(0,P.hc)(i,r,"login_temporary_password")})))}async function ke(e){const{environment:t,loginStore:o}=e,{device:i}=t;if(!o.isSaml())return;const{email:n}=o.state;if(!n)return;const r=i.isElectron||(0,I.Q7)(t)?"nativeredirect":i.isNative?"native":void 0,a=await ie.getSamlRedirect(t,{email:n,callbackType:r});if("failed"===a.type)return void o.setState({...o.state,alert:(0,B.wf)(R.default.getIntl(),a)});o.setState({...o.state,alert:void 0});const s=a.data.redirectUrl;s&&Ee(t,s)}async function Ce(e){const{environment:t,store:o}=e,i=await ie.sendTemporaryPassword(t,{passwordReset:!0,email:o.state.email,native:t.device.isNative});if("success"===i.type){const{csrfState:e}=i.data;o.setState({...o.state,loginType:"reset",password:"",sentPasswordResetState:e,alert:void 0})}else{const e=(0,B.wf)(R.default.getIntl(),i);o.setState({...o.state,password:"",alert:e})}}async function _e(e){const{environment:t,store:o,reverify:i,recaptchaToken:n,turnstileToken:a}=e,{RouterStore:s}=t,l=e.disableLoginLink||Boolean((0,y.getSessionAnalyticsTags)());ce._5(t);const{url:c}=se.Vr(t),d=A.S4(t),p=await ie.sendTemporaryPassword(t,{email:o.state.email,redirectURL:c,disableLoginLink:l,native:t.device.isNative,isSignup:"signup"===s.state.route.name,recaptchaToken:n,turnstileToken:a,shouldHidePasscode:d});if("success"===p.type){const{csrfState:e}=p.data;if(o.setState({...o.state,loginType:i?"reverify":"temporary",password:"",sentEmailPasscodeState:e,alert:void 0,hiddenPasscode:d}),C.electronApi&&function(e){let{environment:t,isNewSignup:o}=e;return t.device.isElectron&&o&&"en-US"===r.SP&&"control"!==Y.default.getEligibleGroup({experimentId:"redirect_after_passcode_sent",defaultGroup:"control"})}({environment:t,isNewSignup:!Boolean(o.state.hasAccount)})){const e=Y.default.getEligibleGroup({experimentId:"redirect_after_passcode_sent",defaultGroup:"control"}),i=await(0,T.getDeviceIdForAnalytics)(t),n=S.bf({url:`${M.Z.domainBaseUrl}${h._j.desktopEmailConfirm}`,query:{state:btoa(JSON.stringify({email:o.state.email,deviceId:i,experimentVariant:e}))}});C.electronApi.openExternalUrl(n)}}else{const e=(0,B.wf)(R.default.getIntl(),p);o.setState({...o.state,loginType:"email",password:"",alert:e})}}async function Me(e){const{environment:t,state:o,password:i}=e,n=await ie.verifyEmail(t,{state:o,password:i});if("success"!==n.type){return(0,B.wf)(R.default.getIntl(),n)}}async function Te(e){const{environment:t,state:o,password:i,redirectURL:n,webBrowserDeviceId:r,passcodeEnterMethod:a}=e,s=V.default.createMetric("login_time.passcode"),l=await(0,E.loadCurrentUserId)(t),c=await ie.loginWithEmail(t,{state:o,password:i});if(V.default.emit(t,s,void 0),"success"!==c.type){await $e(t,c);return(0,B.wf)(R.default.getIntl(),c)}{const{isNewSignup:e,userId:o,userSessionAuthToken:i}=c.data;if(C.electronApi&&function(e){let{environment:t,isNewSignup:o,webBrowserDeviceId:i}=e;if(!t.device.isElectron||!o||i)return!1;return Y.default.checkGate("desktop_app_login_with_email_redirect")}({environment:t,isNewSignup:e,webBrowserDeviceId:r})){const e=S.$U(S.bf({url:`${M.Z.domainBaseUrl}${h._j.loginSuccess}`}));C.electronApi.openExternalUrl(e)}else await Ie({environment:t,isNewSignup:e,userId:o,redirectURL:n,previousPersistedUserId:l,userSessionAuthToken:i,loginMethod:"temporary-passcode",webBrowserDeviceId:r,passcodeEnterMethod:a})}}async function Ie(e){const{environment:t}=e;await Ue(e),await Xe(t)&&await qe(t)&&F.E({environment:t})}async function Pe(e){const{environment:t,email:o,password:i,redirectURL:n,recaptchaOptions:r,turnstileOptions:a,loginStore:s}=e,l=V.default.createMetric("login_time.password"),c=await(0,E.loadCurrentUserId)(t),d=await ie.loginWithEmail(t,{email:o,password:i,recaptchaToken:await(0,P.Of)(r,"login_password"),turnstileToken:await(0,P.hc)(t,a,"login_password")});if(V.default.emit(t,l,void 0),"success"!==d.type){await $e(t,d);return(0,B.wf)(R.default.getIntl(),d)}{const e=d.data.enabledMfaSettings??[],{userId:o,userSessionAuthToken:i}=d.data;e.length>0?He({environment:t,isNewSignup:!1,userId:o,redirectURL:n,previousPersistedUserId:c,loginMethod:"password",mfaSettings:e,loginStore:s}):await Ue({environment:t,isNewSignup:!1,userId:o,redirectURL:n,previousPersistedUserId:c,userSessionAuthToken:i,loginMethod:"password"})}}async function xe(e){const{environment:t,redirectURL:o,previousPersistedUserId:i,userId:n}=e;await Ue({environment:t,isNewSignup:!1,userId:n,redirectURL:o,previousPersistedUserId:i,loginMethod:"password-mfa"})}async function Be(e){const{environment:t,code:o,encryptedToken:i,encryptedNonce:n,encryptedUserObject:r,webBrowserDeviceId:a}=e,s=V.default.createMetric("login_time.apple"),l=await(0,E.loadCurrentUserId)(t),c=await ie.loginWithAppleAuth(t,{code:o,encryptedToken:i,encryptedNonce:n,encryptedUserObject:r});if(V.default.emit(t,s,void 0),"success"!==c.type)return await $e(t,c),(0,B.wf)(R.default.getIntl(),c);{const{isNewSignup:e,userId:o}=c.data;await Ue({environment:t,isNewSignup:e,userId:o,previousPersistedUserId:l,loginMethod:"login-with-apple",webBrowserDeviceId:a})}}async function Ze(e){const{environment:t,encryptedToken:o,code:i,callbackType:n,webBrowserDeviceId:r}=e,a=await(0,E.loadCurrentUserId)(t),s=await ie.loginWithGoogleAuth(t,{code:i,encryptedToken:o,callbackType:n});if("success"!==s.type)return await $e(t,s),(0,B.wf)(R.default.getIntl(),s);{const{isNewSignup:e,userId:o}=s.data;await Ue({environment:t,isNewSignup:e,userId:o,previousPersistedUserId:a,loginMethod:"login-with-google",webBrowserDeviceId:r})}}function Ee(e,t){ce.V_(e),e.mobileNative?be(e,t):e.device.isElectron&&C.electronApi?C.electronApi.openExternalUrl(t):window.location.href=t}async function Re(e){const{environment:t,csrfState:o,token:i,isNewSignup:n}=e,r=await(0,E.loadCurrentUserId)(t),a=await x.getBrowserId(t);o||i||c.log({level:"error",type:"loginSamlUserWithToken",from:"loginActions",error:{stack:(new Error).stack},data:{miscDataToConvertToString:{deviceId:a,isNewSignup:n}}});const s=await ie.loginWithEmail(t,{state:o,password:i});if("success"!==s.type)return await $e(t,s),(0,B.wf)(R.default.getIntl(),s);{const{userId:e}=s.data;await Ue({environment:t,isNewSignup:n,userId:e,previousPersistedUserId:r,loginMethod:"saml"})}}async function Ae(e){const{environment:t,csrfState:o,password:i,loginStore:n}=e,r=await(0,E.loadCurrentUserId)(t);if(!o){const e=await x.getCookie(t,"notion_browser_id");c.log({level:"error",type:"loginPasswordReset",from:"loginActions",error:{stack:(new Error).stack},data:{miscDataToConvertToString:{deviceId:e,previousPersistedUserId:r}}})}const a=await ie.loginWithEmail(t,{state:o,password:i,passwordReset:!0});if("success"!==a.type)return await $e(t,a),(0,B.wf)(R.default.getIntl(),a);{const{userId:e,userSessionAuthToken:o,enabledMfaSettings:i}=a.data;i&&i.length>0?(He({environment:t,isNewSignup:!1,userId:e,previousPersistedUserId:r,loginMethod:"password-reset",loginStore:n,mfaSettings:i}),ue.navigateOnBaseUrl({environment:t,url:h._j.login}),F.E({environment:t})):(await Ue({environment:t,isNewSignup:!1,userId:e,previousPersistedUserId:r,userSessionAuthToken:o,loginMethod:"password-reset"}),F.E({environment:t}))}}async function De(e){const{environment:t,userId:o,previousUserId:i,isNewSignup:n}=e;await Ue({environment:t,isNewSignup:n,userId:o,previousPersistedUserId:i,loginMethod:"saml"})}async function Fe(e){const{environment:t,userId:o}=e;await Ue({environment:t,isNewSignup:!1,userId:o,previousPersistedUserId:"admin",loginMethod:"admin"}),window.location.href=h._j.root}async function Le(e){const{environment:t,userId:o}=e,{nextUserId:i,nextSpaceViewStore:n}=function(e){const{environment:t,userId:o}=e,i=t.currentUser.id;if(o===i){const e=ee.Z.getAllSpaceViewStores(t).filter((e=>{const t=e.getUserRootParentId();return t&&t!==o}))[0];return{nextUserId:e&&e.getUserRootParentId(),nextSpaceViewStore:e}}{const{currentSpaceViewStore:e}=K.default.state;return{nextUserId:i,nextSpaceViewStore:e}}}(e);if(i&&n){if(await X.transactionQueue.hasTasksForUser(o)){if(!(await re.confirmUserAction({message:R.default.formatMessage(ge.unsavedChanges),acceptLabel:R.default.formatMessage(ge.logoutWithoutSaving)})))return}await ie.logout(t,{userId:o}),await X.transactionQueue.clearForUser(o),N.ZL(o);const e=await me.x({environment:t,newCurrentUserId:i,loggedOutUserId:o}),{currentUserRootStore:r,currentUserSettingsStore:a}=K.default.state;r&&a&&_.y3({environment:e,spaceViewStore:n,userSettingsStore:a,userRootStore:r}),C.refreshAll({includeFocusedWindow:!1})}else await Ve(t)}async function Ve(e){if(await X.transactionQueue.anySessionHasTasks()){if(!(await re.confirmUserAction({message:R.default.formatMessage(ge.unsavedChanges),acceptLabel:R.default.formatMessage(ge.logoutWithoutSaving)})))return}(0,L.Sr)()?window.location.href=`${M.Z.domainBaseUrl}/logout`:ue.navigate({environment:e,url:h._j.logout})}async function Ne(e){if(e.mobileNative&&await e.mobileNative.unregisterPushNotifications(),await je(e),e.updateCurrentUserId){const t={environment:e,currentUserId:void 0,userIds:[]};e.updateCurrentUserId(t)}return{...e,currentUser:new a.CurrentUser}}async function Oe(e,t){await ie.logout(e,{}),await he(e),C.clearGoogleAuthCookies(),C.refreshAll({includeFocusedWindow:!1}),window.location.href=t||h._j.root}async function Ue(e){const{environment:t,isNewSignup:o,userId:i,redirectURL:n,previousPersistedUserId:r,userSessionAuthToken:a,frontPathName:d,webBrowserDeviceId:p,passcodeEnterMethod:f}=e;o?le.j({message:ge.signupPendingMessage}):le.j({message:ge.loginPendingMessage});try{const v=A.kH(t);if(pe.LK(t),t.device.isElectron&&(C.clearBrowserHistory(),C.refreshAll({includeFocusedWindow:!1})),r&&r!==i){const e=await X.transactionQueue.getTotalNumberOfTasks();e>5&&c.log({level:"warning",from:"loginActions",type:"setLoggedInUserId",data:{userId:i,currentUserId:r,clearedTransactionCount:e}}),await he(t,v,!t.currentUser.loggedInUserIds.includes(r))}if(!r){const e=N.qd(void 0);N.nM({currentUserId:i,blockId:e}),N.nM({currentUserId:void 0,blockId:void 0})}const b=await We(t,i);if(ce.lJ(b,{is_new_signup:o,login_method:e.loginMethod,front_pathname:d}),o){oe.identifyNewUser(b,{user_id:i,tags:(0,y.getSessionAnalyticsTags)(),origin_initial_page:N.Mp(i)});const t=await(0,T.getCurrentEnvironmentData)(b);await(0,u.OI)(200,[ie.initializeUserAnalyticsEmptySync(b,{isNewSignup:o,analyticsProperties:(0,l.Z)({...(0,T.getCurrentUserData)(),...(0,T.getCurrentUserIdentityData)(),...(0,D.getMobileNativeDeviceInfo)(),...t,experiments:Y.default.getExperimentsMap(),login_method:e.loginMethod,signup_from:t.route_name,front_pathname:d,web_browser_device_id:p,passcode_enter_method:f})})])}if(n){const e=g.Wj({url:n,isMobile:b.device.isMobile,baseUrl:M.Z.domainBaseUrl,publicDomainName:M.Z.publicDomainName,protocol:M.Z.protocol,currentUrl:ncd.href()});if(!e||"space"!==e.name&&"page"!==e.name){if(e&&"oauthAuthorization"===e.name){const{responseType:t,redirectUri:o,integrationId:i,state:n,owner:r,userId:a,spaceId:s}=e;(0,y.setOauthAuthorizationParams)({responseType:t,redirectUri:o,integrationId:i,state:n,owner:r,userId:a,spaceId:s})}}else N.nr(e,i)}if(ne.mc(b),ae.mc(),await ae.Yh(b),o&&(Y.default.logEvent("sign_up",void 0,{login_method:e.loginMethod,device_type:t.device.deviceType}),Y.default.logEvent("sign_up_by_login_method",e.loginMethod),Y.default.logEvent("sign_up_by_device_type",t.device.deviceType)),ce.wt(b,{is_new_signup:o,login_method:e.loginMethod,logged_in_user_ids:b.currentUser.loggedInUserIds.map((e=>(0,m.F9)(e))),most_recent_user_id:(0,m.F9)(i),web_browser_device_id:p,passcode_enter_method:f}),s.j(b.device,{facebook:{eventName:"ViewContent"},google:{eventName:"loggedIn"}}),M.Z.isAdminMode){if(!(await x.getGhostAdminUserId(t)))return void ue.navigate({environment:t,url:"/__admin"})}const S=(0,y.getPostLoginRedirect)(M.Z.secureFileConfig.protocol,M.Z.secureFileConfig.hostname);S?((0,y.unsetPostLoginRedirect)(),window.location.href=S):(0,U.j)(t)||(0,L.Sr)()&&a?ue.navigate({environment:b,url:h._j.root}):!v&&r&&r!==i?window.location.href=h._j.root:ue.navigate({environment:b,url:h._j.root})}finally{le.x()}}function He(e){const{loginStore:t,userId:o}=e,i=new $.U6(e.environment,{table:f.KJ,id:o},{userId:o});t.setState({...t.state,settings:e.mfaSettings,loginType:"mfa",redirectURL:e.redirectURL,previousPersistedUserId:e.previousPersistedUserId,userStore:i})}function ze(e){e.reset()}async function We(e,t){await async function(e,t){await Ke(e,t)}(e,t);let o=[t];const i=await(0,E.getUserIdsFromCookie)(e);i&&(i.push(t),o=n().uniq(i));const r=await x.getGhostAdminUserId(e),s={...e,currentUser:new a.CurrentUser({id:t,loggedInUserIds:o,adminUserId:r})};if(e.updateCurrentUserId){const i={environment:e,currentUserId:t,userIds:o};await e.updateCurrentUserId(i)}return s.device.isFirefox||N.lr(),s}async function je(e){b.Z.remove(E.currentUserIdKey);const t=W.U(e.mobileNative);t&&await t.clearCurrentUserId(e.mobileNative)}async function Ke(e,t){const o=await(0,E.getUserIdsFromCookie)(e);if(o&&!o.includes(t))return;b.Z.set(E.currentUserIdKey,t);const i=W.U(e.mobileNative);i&&await i.saveCurrentUserId(e.mobileNative,t)}async function Ye(e){const t=await(0,E.loadCurrentUserId)(e),{mobileNative:o,device:i,defaultRecordCache:n}=e;if(o&&o.sqliteConnection)try{await z.y6(o.sqliteConnection,t||w.I)}catch(r){c.log({level:"error",from:"loginAction.ts",type:"backfillRecordsWithUserId",error:(0,p.Ui)(r),data:{}})}return i.isElectron&&i.electronVersion&&i.electronVersion[0]>=6&&n.persistedRecordCache&&await n.persistedRecordCache.initialize(t),t?await We(e,t):e}function Ge(e,t){if((0,d.Jx)(t.body)&&"saml_sso_required"===t.body.clientData.type){const e=(0,B.wf)(R.default.getIntl(),t);G.Z.setState({...G.Z.state,loginType:"saml",alert:e})}ue.navigate({environment:e,url:h._j.login})}async function Xe(e){const{currentUserStore:t}=K.default.state;if(!t)return!1;const o=t.getEmail();if(!o)return!1;const i=await F.c({environment:e,userEmail:o});if(i.error)throw i.error;return!i.value.isSamlEnforced&&!i.value.hasPassword&&!i.value.didLogInWithSaml}async function qe(e){const t=e.currentUser.id;if(!t)return!1;const o=new $.r9(e,{table:v.dx,id:t});await o.load();return(await(0,O.Gh)({environment:e,userRootStore:o})||[]).some((e=>e===M.Z.pricing.student.productId))}async function $e(e,t){var o,i;if("saml_sso_required"===(null===(o=t.body.clientData)||void 0===o?void 0:o.type)&&null!==(i=t.body.clientData)&&void 0!==i&&i.redirectUrl){await Je(2e3);Ee(e,t.body.clientData.redirectUrl)}}async function Je(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;le.j({message:ge.redirectSamlMessage}),await(0,u.Vs)(e),le.x()}},27153:(e,t,o)=>{o.d(t,{$:()=>r,Z:()=>a});var i=o(91390),n=o(24677);function r(e,t){t.disableClearSelection||n.ZH(e),i.Z.setState({...t,isActive:!0})}function a(){const e=i.Z.state;e.isActive&&e.onCancel&&e.onCancel(),i.Z.reset()}},47798:(e,t,o)=>{o.d(t,{_P:()=>P,lZ:()=>x,WI:()=>B,RL:()=>Z,xv:()=>E,Br:()=>R});var i=o(96486),n=o.n(i),r=o(70203),a=o(21325),s=o(28020),l=o(23223),c=o(44486),d=o(68056),p=o(98165),u=o(72133),m=o(79315),g=o(64233),h=o(88833),f=o(19111),v=o(96026),y=o(72087),b=o(10743),S=o(24666),w=o(12318),k=o(50906),C=o(88295),_=o(993),M=o(30149);function T(e){const{textStore:t,environment:o}=e,i=(0,p.n3)(t)&&v.Z.getMode(o,t).hasPublicPermission,n=t.isDefaultRecordCache()||"comment"===t.table,r=!i,a=!i;return{page:n,createPage:n&&t.isDefaultRecordCache(),user:r,bot:r,date:!0,reminder:!0,templateVariable:I(t),group:a}}function I(e){const t=(0,s.RM)();if(!t||"block"!==e.table)return!1;if(t.isInsideTemplate())return!0;const o=c.W(e);if(o||t.isInsideFactoryOrDuplicateBlocksAction()){const t=null==o?void 0:o.getTitleStore();return!(o&&t&&t.id===e.id&&n().isEqual(t.path,e.path))}return!!(0,l.td)(e)}function P(e){const{environment:t,textStore:o,oldSelection:i,oldTextValue:n,disableDateMentions:a,disableDateReminderMentions:s}=e,l=function(e){const{textStore:t,oldSelection:o}=e;if(b.Z.state.open||h.Z.state.open||g.Z.state.open)return;const i=r.ee(t.getValue()||[]),n=o.startIndex,a=(i[n]||"").normalize("NFKD"),s=(i[n-1]||"").normalize("NFKD"),l=f.Z.state;if(l.open)return"[["===l.insertionType&&"]"===a&&"]"===s?"]]":void 0;if("@"===a){if(s&&!/[\s\(\)\[\]]/g.test(s))return;return"@"}if("+"===a){if(s&&!/[\s\(\)\[\]]/g.test(s))return;return"+"}if("[["===i.slice(n-1,n+1).join("")){const e=i[n-1];if(e&&!/[\s\(\)\[\]]/g.test(e))return;return"[["}}(e);if(!l)return;const c=f.Z.state;if("]]"===l){if(c.open){const e=c.temporaryInputData.state;e&&c.temporaryInputData.setState({...e,suffix:"]]"}),f.Z.setState({...c,showCreateIn:!0})}return}const d=u.get();if(!d)return;const p=u.getRect(d);if(!p)return;const m=T({textStore:o,environment:t}),v=m.page,S=m.createPage,C=m.user&&"@"===l,_=m.bot&&"@"===l,M=m.date&&"@"===l&&!a,I=m.reminder&&"@"===l&&!a&&!s,P=m.templateVariable&&"@"===l&&!a,x=m.group&&"@"===l;(C||x||v||S||M||I||P)&&("+"!==l||S)&&(f.Z.setState({open:!0,openTime:Date.now(),insertionType:l,textStore:o,oldTextValue:n,oldSelection:i,selectionRect:p,userRequestStore:new y.Z,botRequestStore:new y.Z,pageRequestStore:new y.Z,temporaryInputData:new w.default(void 0),mentionTypes:{page:v,createPage:S,user:C,bot:_,date:M,reminder:I,templateVariable:P,group:x},expandSection:void 0,showCreateIn:!1,createInQuery:"",isEmptyPageTitle:!1}),k.trackOpenMentionMenu(t))}function x(e,t){_.N3({direction:"end"});const o=S.default.state;if("editing"!==o.mode)return;const i=(0,d.QY)(o.multiSelection);if(!i)return;let n=!1;if(i.selection.startIndex>0){const e=i.store.getValue()||[],t=r.ee(e)[i.selection.startIndex-1];/[\s]/g.test(t)||(n=!0)}M.createAndCommit({userAction:"mentionMenuActions.insertMention",environment:e,perform:t=>{n?(_.hJ({environment:e,store:i.store,string:" ",selection:i.selection,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t}),_.hJ({environment:e,store:i.store,string:"@",selection:{startIndex:i.selection.startIndex+1,endIndex:i.selection.endIndex+1},disableMentions:!1,disableDateMentions:!1,disableDateReminderMentions:!1,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})):_.hJ({environment:e,store:i.store,string:"@",selection:i.selection,disableMentions:!1,disableDateMentions:!1,disableDateReminderMentions:!1,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}});const a=f.Z.state;if(!a.open)return;const s=T({environment:e,textStore:i.store});f.Z.setState({...a,mentionTypes:{page:s.page&&t.page,createPage:s.createPage&&t.createPage,user:s.user&&t.user,bot:s.bot&&t.bot,date:s.date&&t.date,reminder:s.reminder&&t.reminder,templateVariable:s.templateVariable&&t.templateVariable,group:s.group&&t.group}})}function B(){const e=f.Z.state;if(e.open){const{mainEditorCurrentBlockStore:t}=m.default.state;return t&&t.uiContains(e.textStore)?"block":"comment"}}function Z(e){const t=f.Z.state,{environment:o,annotation:i,transaction:n,menuListItemAction:a,query:s,mentionType:l}=e;if(t.open){let e=t.oldTextValue,c=t.oldSelection;const d=t.insertionType.length-1;d>0&&(e=r.vY(e,t.oldSelection.startIndex-d,t.oldSelection.startIndex),c={startIndex:c.startIndex-d,endIndex:c.endIndex-d}),_.sO({environment:o,store:t.textStore,value:e,transaction:n});const p=B();i&&_.lZ({environment:o,store:t.textStore,selection:c,annotation:i,analyticsFrom:p,transaction:n}),l&&k.trackInsertMentionFromMentionMenu(o,{clickIndexGlobal:null==a?void 0:a.index,clickIndexLocal:null==a?void 0:a.indexLocal.indexLocal,sectionIndex:null==a?void 0:a.indexLocal.section,analyticsFrom:p,timeToClickInMs:Date.now()-t.openTime,queryLength:s.length,mentionType:l}),E()}}function E(){f.Z.setState({open:!1,userRequestStore:f.Z.state.userRequestStore,botRequestStore:f.Z.state.botRequestStore,pageRequestStore:f.Z.state.pageRequestStore,mentionTypes:f.Z.state.mentionTypes})}async function R(e){const{environment:t,titleText:o,ignoreSelectionAreaStore:i,createInValue:n,onPageCreated:r,menuListItemAction:s}=e,l=f.Z.state;if(!l.open)return;if(!a.M_(t))return;i.reset();const{performResult:c}=await M.createAndCommitAsync({environment:t,userAction:"mentionMenuActions.acceptCreateIn",waitForServerCommit:!0,perform:async e=>{const i=C.f8({environment:t,transaction:e,titleText:o,createInValue:n,recordStoreParent:l.textStore}),a=i.createdPages[0];if(a)return r&&r(a),Z({environment:t,annotation:["p",a.id],transaction:e,menuListItemAction:s,query:o,mentionType:"createPage"}),await i.moveToStorePromise,{createInState:i}}});if(c){const{createInState:e}=c;return await C.c_({analyticsFrom:"mention_menu",createInState:e}),e}}},91376:(e,t,o)=>{o.d(t,{r:()=>a});var i=o(79315),n=o(64404),r=o(92083);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{currentTab:t,subtab:o}=e;if(t)r.Z.setState({open:!0,...s({currentTab:t,subtab:o}),highlightedSetting:void 0});else{const{currentSpaceStore:e}=i.default.state;r.Z.setState({open:!0,currentTab:e&&e.canRead()?"members":"settings",defaultSubtab:void 0,highlightedSetting:void 0})}}function s(e){const{currentTab:t,subtab:o}=e;if("members"!==t)return{currentTab:t,defaultSubtab:void 0};return{currentTab:"members",defaultSubtab:o===n.Q.Members||o===n.Q.Groups||o===n.Q.Guests||o===n.Q.Reprovisioning||o===n.Q.Requests?o:void 0}}},60971:(e,t,o)=>{o.d(t,{aV:()=>a,eV:()=>s,kW:()=>d,sv:()=>p});var i=o(96486),n=o.n(i),r=o(85818);function a(e){const{store:t,itemsPerRow:o,sections:i,disableKeyboardArrowWrap:n}=e,{focus:r}=t.state;if(void 0===r.indexLocal)return d({store:t,sections:i,indexGlobal:0});const a=r.indexLocal+o,s=i[r.section],p=s.items.length-1;if(a<=p)return d({store:t,sections:i,indexLocal:{section:r.section,indexLocal:a}});const u=function(e){const{indexLocal:t,section:o,itemsPerRow:i}=e,n=c({indexLocal:t,section:o,itemsPerRow:i});if(!n)return;const r=l({section:o,itemsPerRow:i});if(!r)return;return n.rowsBefore===r.rowsBefore}({indexLocal:r.indexLocal,section:s,itemsPerRow:o});if(void 0===u)return;if(!1===u)return d({store:t,sections:i,indexLocal:{section:r.section,indexLocal:p}});const m=function(e){const{currentSection:t,sections:o,disableWrap:i}=e;if(0===o.length)return;if(t&&t>=o.length&&i)return;const n=void 0===t?0:(t+1)%o.length,r=o[n];if(!r)return;return{index:n,section:r}}({currentSection:r.section,sections:i,disableWrap:n});if(!m)return;const g=r.indexLocal%o;return m.section.items.length<=g?d({store:t,sections:i,indexLocal:{section:m.index,indexLocal:0}}):d({store:t,sections:i,indexLocal:{section:m.index,indexLocal:g}})}function s(e){const{store:t,itemsPerRow:o,sections:i,disableKeyboardArrowWrap:n}=e,{focus:a}=t.state;if(void 0===a.indexLocal){return d({store:t,indexGlobal:r.tM(i)-1,sections:i})}const s=a.indexLocal-o;if(s>=0)return d({store:t,sections:i,indexLocal:{section:a.section,indexLocal:s}});const c=function(e){const{currentSection:t,sections:o,disableWrap:i}=e;if(0===o.length)return;if(0===t||void 0===t){if(i)return;const e=o.length-1,t=o[e];if(!t)return;return{index:e,section:t}}const n=o[t-1];if(!n)return;return{index:t-1,section:n}}({currentSection:a.section,sections:i,disableWrap:n});if(!c)return;const p=l({section:c.section,itemsPerRow:o});if(!p)return;const u=a.indexLocal%o;if(p.column<u)return d({store:t,sections:i,indexLocal:{section:c.index,indexLocal:p.indexLocal}});{const e=p.rowsBefore*o+u;return d({store:t,sections:i,indexLocal:{section:c.index,indexLocal:e}})}}function l(e){const{section:t,itemsPerRow:o}=e;if(0===t.items.length)return;if(0===o)return;const i=t.items.length-1,n=c({indexLocal:i,section:t,itemsPerRow:o});return n?{indexLocal:i,...n}:void 0}function c(e){const{indexLocal:t,section:o,itemsPerRow:i}=e;if(!(i<=0||t>=o.items.length))return{rowsBefore:Math.trunc(t/i),column:t%i}}function d(e){const{store:t,sections:o}=e;if(e.indexLocal){const i=r.$6(e.indexLocal,o);if(!r._K(e.indexLocal,o))return;t.setState({...t.state,focus:{...e.indexLocal,indexGlobal:i}})}else if(void 0===e.indexGlobal)t.unsetFocus();else{const i=r.Ds(e.indexGlobal,o);if(!i)return;t.setState({...t.state,focus:{...i.index,indexGlobal:e.indexGlobal}})}}function p(e){let{store:t,focus:o}=e;"number"==typeof t.state.focus.indexLocal&&(n().isEqual(o,t.state.focus)||t.setState({...t.state,focus:o}))}},98958:(e,t,o)=>{o.r(t),o.d(t,{initializeMobileNativeApp:()=>m,registerPushNotifications:()=>g,handleTokenRefresh:()=>h,waitForCssInsets:()=>f,getInitialTheme:()=>y});var i=o(65917),n=o(2911),r=o(29477),a=o(62643),s=o(95477),l=o(51456),c=o(47958),d=o(54642),p=o(9953),u=o(30149);async function m(e){if(e.device.isMobileNative&&e.mobileNative){await f(e),e.device.isAndroid&&e.mobileNative.api.setStatusBarBackgroundColor&&e.mobileNative.api.setStatusBarStyle&&!e.mobileNative.api.setAppTheme&&(e.mobileNative.api.setStatusBarBackgroundColor("black"),e.mobileNative.api.setStatusBarStyle("light-content")),e.mobileNative.updateReceiveApiHandlers({track:t=>{l.track(e,t.eventName,{...t.eventData,logging_source:"mobile_native"})}});const o=(0,c.U)(e.mobileNative);if(o&&(await o.initializeKeyValueStore(e.mobileNative),await o.initializeStorage(e.mobileNative),await o.legacyLogSqliteSchema(e.mobileNative)),e.mobileNative&&e.mobileNative.sqliteConnection)try{await e.mobileNative.sqliteConnection.ensureMigrated(),e.mobileNative.sqliteConnection.optimize()}catch(t){i.log({level:"error",from:"loginAction.ts",type:"backfillRecordsWithUserId",error:(0,n.Ui)(t),data:{}})}e.mobileNative.api.getTheme&&(v=await e.mobileNative.api.getTheme())}}async function g(e){const{mobileNative:t}=e;if(t&&t.api.registerPushNotifications){const o=await t.api.registerPushNotifications();o&&h(e,o,"registration")}}async function h(e,t,o){const n=e.currentUser.id;if(t&&n){const r=(0,a.r9)({user_id:n,token:t}),l=await d.syncRecordValue(e,{pointer:{table:a.q4,id:r},userId:n,version:-1});let c=!1;l&&(l.value&&!l.value.invalid||(u.createAndCommit({userAction:"mobileNativeActions.handleTokenRefresh",environment:e,perform:o=>{p.ae({environment:e,table:a.q4,value:{id:r,token:t,user_id:n,invalid:!1},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,transaction:o})}}),c=!0)),"production"!==s.Z.env&&i.log({level:"info",from:"mobileNativeActions.ts",type:"handleTokenRefresh",data:{message:"FCM Token",miscDataToConvertToString:{source:o,token:t,createdRecord:c}}})}}async function f(e){if(!e.device.isIOS||!e.device.isMobileNative)return;const t=document.createElement("div");t.style.width=`calc(${["env(safe-area-inset-top)","env(safe-area-inset-bottom)","env(safe-area-inset-left)","env(safe-area-inset-right)"].join(" + ")})`,t.style.visibility="hidden",document.body.appendChild(t);let o=0;for(;o<50&&!(t.offsetWidth>0);)await r.Vs(1),o++;document.body.removeChild(t),e.WindowSizeStore.updateWindowSize()}let v="light";function y(){return v}},29533:(e,t,o)=>{o.d(t,{R:()=>r,h:()=>a});var i=o(68626),n=o(17294);function r(e,t){const o={taskStatus:e.taskStatus,...i.x.isSuccess(e)?{completeBlocks:e.value.completeBlocks,totalBlocks:e.value.totalBlocks}:{}};n.Z.update((e=>({...e,[t]:o})))}function a(e){n.Z.update((t=>({...t,[e]:void 0})))}},96178:(e,t,o)=>{o.d(t,{w:()=>k,e:()=>C});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(5366),l=o(5978),c=o(73744),d=o(22889),p=o(6854);function u(e){return r.createElement(r.Fragment,null,r.createElement(m,e),n()(p.ow,{onUndo:void 0}))}function m(e){let{moveToLocation:t,movedItems:o}=e;window.__c={n:"MoveToVisitButton"};const i=(0,a.O7)(),u=(0,r.useCallback)((e=>{var n;if(t)switch(t.type){case"moveToBlock":l.navigateToBlock({environment:i,openInNew:c.DJ(e),store:t.blockStore,scrollToBlockId:null===(n=o[0])||void 0===n?void 0:n.id,visitType:d.vu.Link})}}),[i,t,o]);return t&&"moveToBlock"===t.type?n()(p.Pn,{onClick:u},void 0,n()(s.FormattedMessage,{defaultMessage:"Visit",id:"moveToHelpers.afterMoveToast.viewButton",description:"Button for toast message after moving one or more blocks, to visit the destination"})):null}var g=o(4708),h=o(40544),f=o(79315),v=o(70935),y=o(50906),b=o(10279),S=o(36432),w=o(64964);function k(e){const{environment:t,movedItems:o,previousParentIds:i,moveToLocation:r}=e;v.Z.isInBulkSelectSession()&&S.V();o.some((e=>{const t=i[e.id],o=e.getParentId();return!(!t||t===o)}))&&w.oV({label:(0,h.ah)({environment:t,movedItems:o,moveToLocation:r}),button:n()(u,{moveToLocation:r,movedItems:o})})}function C(e){const{environment:t,transaction:o,moveToStore:i,targetBlocks:n,from:r}=e;if(!(0,g.vI)()&&"move_to"===r)return;const{currentUserStore:a}=f.default.state;null!=a&&a.isDefined()&&i.canEdit()&&!i.canAdmin()&&n.forEach((e=>{if(e.canAdmin())return y.trackAddEditorPermissionToEnsureUndoMove(t,{from:r}),b.ep({transaction:o,store:e,environment:t,permissionItems:[{type:"user_permission",user_id:a.id,role:"editor"}]})}))}},11302:(e,t,o)=>{o.d(t,{z1:()=>j,bA:()=>Y,FX:()=>G,pB:()=>X,xv:()=>q,Ws:()=>$,Y:()=>J,at:()=>te});var i=o(96486),n=o.n(i),r=o(41432),a=o(67219),s=o(59730),l=o(21202),c=o(6287),d=o(97880),p=o(5366),u=o(617),m=o(51456),g=o(33929),h=o(59488),f=o(40544),v=o(98165),y=o(38755),b=o(15517),S=o(79315),w=o(42330),k=o(98452),C=o(3815),_=o(52258),M=o(52229),T=o(50906),I=o(6404),P=o(49865),x=o(47307),B=o(57400),Z=o(94419),E=o(92625),R=o(96178),A=o(72711),D=o(19785),F=o(9953),L=o(5978),V=o(24677),N=o(64964),O=o(29974),U=o(150),H=o(30149),z=o(63113),W=o(65452);const j=()=>[u._z,u.Gg,u.jl,u.ff(u.$I),u.ff(u.xw),u.ff(u.P9(r.Ti.externalObjectInstancePage)),u.ff(u.Vw),u.k5,u.lQ],K=(0,p.defineMessages)({duplicatingContent:{id:"moveToMenuActions.duplicatingContent.loadingMessage",defaultMessage:"Duplicating content…",description:"Loading message shown when duplicating from one workspace to another."},duplicatedToSpace:{id:"moveToMenuActions.duplicatedToSpace.toast",defaultMessage:"Duplicated {name} to {spaceName}",description:"Toast shown after duplicating from one workspace to another."}});function Y(e){const{environment:t,blocks:o,originRect:i,moveToContext:n,onAccept:r,isAddTo:a,needsConfirmation:s}=e;o.length&&(_.Z.reset(),k.Z.reset(),I.xv(),w.ZP.setState({variant:"untyped",isOpen:!0,rect:i,targets:o,autocompleteQuery:"",moveToContext:n,onAccept:r,isAddTo:a,lastPageId:w.ZP.state.lastPageId,needsConfirmation:Boolean(s)}),T.trackMoveToMenuOpen(t,{from:n,render_type:"web",target_block_ids:o.map((e=>e.id)),targets_database_type:w.ZP.getTargetsDatabaseType()}))}async function G(e){const{environment:t,blocks:o,originRect:i,moveToContext:n,onAccept:r,isAddTo:s,needsConfirmation:l}=e,c=await async function(e){var t,o;const{environment:i,blocks:n,moveToContext:r}=e;if(!(0,h.Y)("supportsNativeMoveTo")||null===(t=i.mobileNative)||void 0===t||!t.api.moveTo||0===n.length)return{supported:!1};const s=null===(o=n[0].getAssociatedCollectionStore())||void 0===o?void 0:o.getDatabaseType();if(s&&s!==a.GZ&&n.every((e=>{var t;return(null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.getDatabaseType())===s})))return{supported:!1};return await i.mobileNative.api.moveTo({targets:n.map((e=>e.id)),moveToContext:r})}(e);if(!c.supported||!c.destination)return c.supported;_.Z.reset(),k.Z.reset(),I.xv(),w.ZP.setState({variant:"untyped",isOpen:!0,rect:i,targets:o,autocompleteQuery:"",moveToContext:n,onAccept:r,isAddTo:s,lastPageId:w.ZP.state.lastPageId,needsConfirmation:Boolean(l),renderType:"mobileNative"}),T.trackMoveToMenuOpen(t,{from:n,render_type:"native",target_block_ids:o.map((e=>e.id)),targets_database_type:w.ZP.getTargetsDatabaseType()});const d=w.ZP.state.isOpen&&w.ZP.state.useSudoMode;return await X({environment:t,value:c.destination,useSudoMode:d}),q(t),!0}async function X(e){const{environment:t,value:o,useSudoMode:i}=e;await H.createAndCommitAsync({environment:t,userAction:"MoveToMenuRenderer.completeMoveTransaction",waitForServerCommit:!1,useSudoMode:i,perform:async e=>{await async function(e,t,o){const i=w.ZP.state,{currentSpaceStore:n}=S.default.state;if(!i.isOpen||!n)return;const{targets:a}=i;q(o);const s=n.id,p=function(e){const{type:t}=e;switch(t){case"page":case"collection":case"space-private-pages":case"team":return e.spaceId;case"space":return e.id;default:(0,d.t1)(t)}}(e);if(p&&s!==p){if(!(await(0,f.cJ)()))return}const u=a.find((e=>{const t=e.getType();return Boolean(t&&(0,r.S9)(t))})),g=u&&(0,v.VP)(u),h=(0,w.rJ)(a),y=Object.fromEntries(a.map((e=>[e.id,e.getParentId()]))),k=await async function(e){return Q({...e,action:"move"})}({environment:o,value:e,targets:a,transaction:t});if(!k)return;const C=(0,f.WH)(e);R.w({environment:o,previousParentIds:y,movedItems:i.targets,moveToLocation:C});const _=u&&(0,v.VP)(u);T.trackMoveTo(o,{table:k.table,from:i.moveToContext,type:null==C?void 0:C.type,team_before:g&&(0,m.getTeamEventData)(g),team_after:_&&(0,m.getTeamEventData)(_),targets_database_type:h,destination_database_type:k.table===c.v?k.getDatabaseType():void 0}),i.onAccept&&i.onAccept(e);k.table===l.iU&&await b.j2(n,n.id,k.id)}(o,e,t)}})}function q(e){const t=w.ZP.state;w.ZP.setState({isOpen:!1,lastPageId:t.lastPageId}),V.ZH(e),t.isOpen&&"home_tab"===t.moveToContext&&L.navigateToHomeTab(e)}async function $(e){return Q({...e,action:"add"})}async function J(e){return Q({...e,action:"retain-alias"})}async function Q(e){const{value:t,transaction:o,targets:i}=e;if("user_cancelled_move"===await U.Hl({transaction:o,moveStores:i,moveTargetStore:(0,f.uw)(t)}))return;const n=await async function(e){const{transaction:t,targets:o,value:i,environment:n,action:r}=e,{mainEditorCurrentBlockStore:a,currentSpaceStore:s,currentSpaceViewStore:c}=S.default.state,{id:p}=n.currentUser;if(!a||!p||!c)return;const u=(0,f.uw)(i);if(!u)return;let m;const{table:h}=u;switch(h){case"collection":case"block":m=await async function(e){const{environment:t,blockOrCollectionStore:o,targets:i,transaction:n,retainAliasInCurrentParent:r}=e;let a;await o.load(),a=o instanceof C.NW?o:o.isLinkedCollectionView()?o.getCollectionViewSourceOrLinkCollectionStores()[0]:o.isCollectionView()?o.getCollectionViewCollectionStore():o;if(!a)throw new Error("Move to store invalid.");for(const s of i){const e=s.getParentStore();if(e instanceof C.G&&r){const o=M.k({environment:t,parentBlock:e,targetStore:s,transaction:n});D.jG({parentStore:e.getContentStore(),after:s.id,childStore:o,transaction:n})}if(a instanceof C.G)D.jG({parentStore:a,childStore:s,transaction:n});else if(a instanceof C.NW){const e=P.o3({environment:t,stores:[s],collectionStore:a,transaction:n})[0];P.mp({environment:t,store:e,collectionStore:a,coerce:!0,results:[],groupsPointer:[],transaction:n}),D.zw({parentStore:a,childStore:e,transaction:n})}}return a}({environment:n,blockOrCollectionStore:u,targets:o,transaction:t,retainAliasInCurrentParent:"retain-alias"===r});break;case"space":m="space-private-pages"===i.type&&u.id===(null==s?void 0:s.id)?ee({environment:n,spaceStore:u,spaceViewStore:c,targets:o,transaction:t,currentUserId:p,retainAliasToBlock:"retain-alias"===r}):await async function(e){const{environment:t,transaction:o,currentSpaceViewStore:i,currentBlockStore:n,currentUserId:r,spaceStore:a,targets:s,action:c,value:d}=e;if("space"!==d.type&&d.spaceId&&d.spaceId!==a.id)throw new Error("Wrong value to move to another space");z._w({environment:t,blocks:s,transaction:o});const p=n.getSpaceId()||a.id;let u;if("move"===c&&("space"!==d.type&&d.spaceId&&d.spaceId!==p||"space"===d.type&&d.id!==p||"space-private-pages"!==d.type)){E.j({message:K.duplicatingContent,targetRecordId:a.id});const e=await O.eX({environment:t,blockStores:s,spaceId:a.id,targetParent:oe(d)});if(E.x(),void 0!==e.error)return void x.showErrorMessage(e.error);u=e.value}else"space-private-pages"===d.type&&ee({environment:t,spaceStore:a,spaceViewStore:i,targets:s,transaction:o,currentUserId:r,retainAliasToBlock:"retain-alias"===c});await async function(e){const{environment:t,currentBlockStore:o,currentUserId:i,spaceStore:n,targets:r,crossSpaceTargetBlockId:a}=e,s=Boolean(r.find((e=>e.id===o.id))),c=(0,y.w3)(n.id);if(!s||!c)return;const d=a?C.G.createChildStore(o,{table:l.iU,id:a}):o;await W.l({environment:t,spaceId:n.id,userId:i}),await async function(e){const{environment:t,spaceStore:o,spaceViewStore:i,blockStore:n}=e;o&&i&&(S.default.setState({...S.default.state,currentSpaceStore:o,currentSpaceViewStore:i,mainEditorCurrentBlockStore:n}),await B.Yh(t))}({environment:t,spaceStore:n,spaceViewStore:c,blockStore:d}),A.ru({environment:t,blocks:[d]})}({environment:t,currentBlockStore:n,currentUserId:r,targets:s,spaceStore:a,crossSpaceTargetBlockId:u}),u&&N.oV({label:g.default.formatMessage(K.duplicatedToSpace,{name:(0,f.EC)({environment:t,movedItems:s}),spaceName:a.getName()})});return a}({environment:n,transaction:t,currentSpaceViewStore:c,currentBlockStore:a,currentUserId:p,spaceStore:u,targets:o,value:i,action:r});break;case"team":m=te({environment:n,transaction:t,currentSpaceViewStore:c,teamStore:u,targets:o,value:i,action:r,location:{type:"append"}});break;default:(0,d.t1)(h)}return R.e({environment:n,transaction:t,moveToStore:u,targetBlocks:o,from:"move_to"}),m}({...e});return n||void 0}function ee(e){let{environment:t,spaceStore:o,spaceViewStore:i,targets:n,currentUserId:r,transaction:a,retainAliasToBlock:l}=e;for(const c of n){const e=c.getParentStore();if(e instanceof C.H2){if(e.id!==o.id)throw new s.D3("moveOrAddToPrivatePages: Try to move to a different space");Z.Od({parent:e.getPagesStore(),childToRemove:c,transaction:a})}else if(e instanceof C.zX)U.sp({teamStore:e,store:c,transaction:a});else if(e instanceof C.G){if(l){const o=M.k({environment:t,parentBlock:e,targetStore:c,transaction:a});D.jG({parentStore:e.getContentStore(),after:c.id,childStore:o,transaction:a})}D.hr({parentStore:e,childStore:c,transaction:a})}const n={type:"user_permission",user_id:r,role:"editor"};F.sW({store:c,data:{permissions:[n]},transaction:a}),Z.R3({parent:i.getPrivatePagesStore(),append:c,transaction:a})}return o}function te(e){let{transaction:t,currentSpaceViewStore:o,teamStore:i,targets:r,location:a,environment:s}=e;const l=o.getTeamsStores(),c=i.getTeamPagesStore();z._w({environment:s,blocks:r,transaction:t});for(const p of r){const e=n().find(l,(e=>{const t=e.getTeamPagesStore().getValue();if(t)return t.includes(p.id)}));(null==e?void 0:e.id)!==i.id&&("append"===a.type?D.jG({parentStore:c,childStore:p,after:a.after,transaction:t}):"prepend"===a.type?D.SH({parentStore:c,childStore:p,before:a.before,transaction:t}):(0,d.t1)(a),e&&U.sp({teamStore:e,store:p,transaction:t}))}return i}function oe(e){const{type:t}=e;switch(t){case"space":case"space-private-pages":return;case"page":return e.spaceId?{id:e.id,table:"block",spaceId:e.spaceId}:void 0;case"collection":case"team":return e.spaceId?{id:e.id,table:t,spaceId:e.spaceId}:void 0;default:(0,d.t1)(t)}}},7476:(e,t,o)=>{o.d(t,{WD:()=>P,yw:()=>x,Cd:()=>B,i8:()=>Z,ZL:()=>E,uK:()=>A});var i=o(1302),n=o(41432),r=o(4615),a=o(98459),s=o(21202),l=o(70203),c=o(5366),d=o(96514),p=o(30149),u=o(53471),m=o(78089),g=o(33929),h=o(45162),f=o(72133),v=o(89086),y=o(58202),b=o(87404),S=o(13884),w=o(50906),k=o(47307),C=o(9953),_=o(56863),M=o(24677),T=o(98104);const I=(0,c.defineMessages)({discardCommentConfirmationPrompt:{id:"newDiscussionMenu.discardCommentConfirmationDialog.prompt",defaultMessage:"Do you want to discard the comment?"},discardCommentButtonLabel:{id:"newDiscussionMenu.discardCommentConfirmationDialog.discardButton.label",defaultMessage:"Discard"}});async function P(e){const{environment:t,blockStore:o,multiSelection:i,rect:n}=e;let r=n;if(!r){const e=f.get();if(!e)return;r=f.getRect(e)}if(!r)return;const s=r.width,l=r.height,c=r.right-s,d=new b.Z(t,(0,a.CG)(o.pointer.spaceId));S.Z.setState({open:!0,rect:new DOMRect(c,r.top,s,l),type:"inline",blockStore:o,multiSelection:i,discussionInputStore:d}),_.w(),await R(d,t),w.trackOpenNewInlineDiscussion(t)}async function x(e){const{environment:t,blockStore:o}=e,i=y.R.getRect(o);if(!i)return;const n=new b.Z(t,(0,a.CG)(o.pointer.spaceId)),r=i.width,s=i.height,l=i.right-r;S.Z.setState({open:!0,rect:new DOMRect(l,i.top,r,s),type:"block",blockStore:o,discussionInputStore:n}),await R(n,t),w.trackOpenNewBlockDiscussion(t)}function B(e){const t=S.Z.state;t.open&&S.Z.setState({open:!1,rect:t.rect})}function Z(e){const{environment:t,blockStore:o,commentTextValue:i,transaction:r,files:a}=e,{id:s}=t.currentUser;if(!s)return;let c;const p=o.getType();if(p&&(0,n.XD)(p)&&!(0,n.S9)(p)){const e=o.getTitleValue();c=l.O1(l.OA(e))}const m=d.cj({context:c,blockStore:o,environment:t,transaction:r,commentTextValue:i,files:u.dm(a)});return w.trackCreateBlockDiscussion(t),m}function E(e){const t=S.Z.state;if(t.open){const o=t.discussionInputStore.state.textStore.getValue(),i=t.discussionInputStore.state.files;(o&&o.length>0||i.length>0)&&("inline"===t.type?p.createAndCommit({userAction:"newDiscussionMenuActions.submitNewDiscussion",environment:e,perform:a=>{!function(e){const{environment:t,multiSelection:o,commentTextValue:i,transaction:a,files:c}=e,{id:p}=t.currentUser;if(!p)return;const m=(0,r.ZP)(),g=(0,h.L5)(o).filter((e=>{let{store:t}=e;return t.table===s.iU}));if(0===g.length)return;const f=g[0].store.getRecordStoreAtRootPath(),y=[],b=new Set;g.forEach(((e,t)=>{let{store:o,selection:i}=e;b.add(o.id);const r=o.getRecordStoreAtRootPath(),s=r.getKeyStore("type").getValue(),c=r.getKeyStore("format").getValue();if(s&&(0,n._T)(s,c))return;let p=o.getValue();const u=l.Ul(p,i);(0,v.wd)(u)||(p=l.aS({textValue:p,selection:u,annotation:[l.GK.Discussion,m]}),C.sO({store:o,value:p,transaction:a}));const g=l.KU(p,u.startIndex,u.endIndex),h=0===t?[]:[l.V3("\n")];y.push(...h,...g),t>0&&d.tR({blockStore:r,discussionId:m,transaction:a})}));const S=(0,h.tp)({multiSelection:o,filterCommonAncestors:!1,focus:void 0});if(S)for(const r of S.stores){if(b.has(r.id))continue;const e=r.getType(),t=r.getFormat();e&&(0,n._T)(e,t)||d.tR({blockStore:r,discussionId:m,transaction:a})}d.cj({context:y,blockStore:f,environment:t,transaction:a,commentTextValue:i,files:u.dm(c),discussionId:m}),w.trackCreateInlineDiscussion(t)}({environment:e,multiSelection:t.multiSelection,commentTextValue:o||[],files:i,transaction:a})},skipUpdatingEditedMetadata:!0}):"block"===t.type&&p.createAndCommit({userAction:"newDiscussionMenuActions.submitNewDiscussion",environment:e,perform:n=>{Z({environment:e,blockStore:t.blockStore,commentTextValue:o||[],files:i,transaction:n})},skipUpdatingEditedMetadata:!0})),B()}}async function R(e,t){await i.default.afterNextFlush(),M.ZH(t),T.N_({store:e.state.textStore})}function A(e,t){(0,m.hu)(e)?k.showDialog({message:g.default.formatMessage(I.discardCommentConfirmationPrompt),showCancel:!0,keepFocus:!0,items:[{label:g.default.formatMessage(I.discardCommentButtonLabel),color:"red",onAccept:()=>B()}]}):B()}},17659:(e,t,o)=>{o.d(t,{go:()=>b,rG:()=>k,aZ:()=>_,E1:()=>M,$h:()=>T,aY:()=>I,Qy:()=>P,G7:()=>x});var i=o(65917),n=o(2911),r=o(65311),a=o(5366),s=o(95477),l=o(33929),c=o(79315),d=o(3815),p=o(76487),u=o(4761),m=o(50906),g=o(19719),h=o(54642),f=o(47307),v=o(30149);const y=(0,a.defineMessages)({archiveError:{id:"notificationActions.archiveNotification.errorMessage",defaultMessage:"Failed to archive. Please try again.",description:"Error message when archiving a notification fails."},setReadError:{id:"notificationActions.setRead.errorMessage",defaultMessage:"Failed to mark notification as read. Please try again.",description:"Error message when marking a notification as read fails."},setAllAsReadError:{id:"notificationActions.setAllAsRead.errorMessage",defaultMessage:"Failed to mark all notifications as read. Please try again.",description:"Error message when marking all notifications as read fails."},setUnreadError:{id:"notificationActions.setUnread.errorMessage",defaultMessage:"Failed to mark notification as unread. Please try again.",description:"Error message when marking a notification as unread fails."}});async function b(e){const t=u.ZP.state.currentTab,{currentSpaceStore:o}=c.default.state;if(o&&!s.Z.isAdminMode&&(0,u.g0)(t)){try{await h.setNotificationsAsRead(e,{spaceId:o.id,timestamp:Date.now(),type:t})}catch(r){return f.showErrorMessage(l.default.formatMessage(y.setAllAsReadError)),void i.log({level:"error",from:"notificationActions",type:"setCurrentUpdatesTabAsRead",error:(0,n.Ui)(r)})}w(t,o.id,S.decrementToZero)}}const S={incrementByOne:e=>e+1,decrementByOne:e=>Math.max(e-1,0),decrementToZero:e=>0};function w(e,t,o){const{results:i}=p.Z.state,n=i.map((i=>{if(i.spaceId===t){const t=i.unread[e];return void 0===t?i:{...i,unread:{...i.unread,[e]:o(t)}}}return i}));p.Z.setState({results:n})}async function k(e,t,o){const{currentSpaceStore:r}=c.default.state;if(r&&!s.Z.isAdminMode){try{for(;;){if(!(await C({environment:e,currentSpaceStore:r,inbox:t,readFilter:o})).more)break}}catch(a){return f.showErrorMessage(l.default.formatMessage(y.archiveError)),void i.log({level:"error",from:"notificationActions",type:"archiveAll",error:(0,n.Ui)(a)})}"read"!==o&&w(t,r.id,S.decrementToZero)}}async function C(e){const{environment:t,currentSpaceStore:o,inbox:r,readFilter:a}=e,s=await h.getUnvisitedNotificationIds(t,{spaceId:o.id,timestamp:Date.now(),type:r,size:500,readFilter:a});if("failed"===s.type)return f.showErrorMessage(l.default.formatMessage(y.archiveError)),i.log({level:"error",from:"notificationActions",type:"archiveApiError",error:(0,n.Ui)(s.error)}),{more:!1};const{notificationIds:c}=s.data;return await async function(e){const{environment:t,notificationIds:o,rootStore:i}=e,{serverCommitResult:n}=v.createAndCommit({userAction:"notificationActions.archiveNotificationIds",environment:t,canUndo:!0,undoCheckpoint:!0,perform:e=>{for(const t of o)M({transaction:e,rootStore:i,visited:!0,notificationId:t})}});await n}({environment:t,notificationIds:c,rootStore:o}),c.length>=500?{more:!0}:{more:!1}}function _(e){const{notification:t,rootStore:o,transaction:a}=e;if(!t.visited){try{M({notificationId:t.id,rootStore:o,transaction:a,visited:!0})}catch(s){return f.showErrorMessage(l.default.formatMessage(y.archiveError)),void i.log({level:"error",from:"notificationActions",type:"archiveNotification",error:(0,n.Ui)(s)})}if(!t.read){w(r.hE[t.type],t.space_id,S.decrementByOne)}}}function M(e){const{transaction:t,notificationId:o,rootStore:i,visited:n}=e,a=(0,d.Kv)(i,{table:r.uX,id:o});v.applyOperation({transaction:t,store:a,operation:{command:"update",pointer:{table:r.uX,id:o},path:[],args:n?{visited:!0,read:!0}:{visited:!1}}})}function T(e){const{transaction:t,notification:o,rootStore:a,read:s}=e;if(o.read===s)return;const c=(0,d.Kv)(a,{table:r.uX,id:o.id});try{v.applyOperation({transaction:t,store:c,operation:{command:"update",pointer:{table:r.uX,id:o.id},path:[],args:{read:s}}})}catch(p){return e.suppressErrorMessage||f.showErrorMessage(l.default.formatMessage(s?y.setReadError:y.setUnreadError)),void i.log({level:"error",from:"notificationActions",type:"setRead",error:(0,n.Ui)(p)})}w("mentions",o.space_id,s?S.decrementByOne:S.incrementByOne)}function I(){return p.Z.getUnreadCountForCurrentSpace().mentions}async function P(e){const{environment:t}=e,{currentSpaceStore:o}=c.default.state;if(!o)return[];const i=await h.getUnvisitedNotificationIds(t,{spaceId:o.id,timestamp:Date.now(),type:"mentions",size:100,readFilter:"unread"});return"failed"===i.type?[]:i.data.notificationIds}function x(e){let{environment:t,newTab:o,shouldTrack:i}=e;const n=u.ZP.state.currentTab;if(n!==o){if("mentions"===o?u.ZP.update((e=>({...e,currentTab:o,containsBothReadAndUnreadNotifications:!1,containsUnreadNotifications:!1,showOnlyUnreadNotifications:!1,unreadNotificationIds:[]}))):u.ZP.update((e=>({...e,currentTab:o}))),i){const e=t.device.isMobile;g.GP({environment:t,forceRestartSession:!1,from:"updates-tab-click"}),e&&m.trackTapMobileBottomBarItem(t,{itemName:"updates"})}"mentions"===n&&async function(e){const t=await h.getUserNotifications(e,{size:1e3});if("failed"===t.type)return;const{results:o}=t.data;p.Z.setState({results:o})}(t)}}},36110:(e,t,o)=>{o.d(t,{gF:()=>m,VW:()=>g});var i=o(74181),n=o(56589),r=o(82036),a=o(89101),s=o(9852),l=o(64002),c=o(63143),d=o(54642),p=o(47307),u=(o(91376),o(5978));o(29974);function m(e){const{environment:t,responseType:o,integrationId:i,redirectUri:n,state:r,owner:s,userId:d,spaceId:p}=e,m=l.bf({url:a._j.oauthAuthorization,query:(0,c.m8)(Object.entries({response_type:o,client_id:i,redirect_uri:n,state:r,owner:s,user_id:d,space_id:p}).filter((e=>{let[,t]=e;return t})))});u.navigate({environment:t,url:m,redirect:!0})}async function g(e){const{environment:t,params:o,integration:c}=e;s.setOauthAuthorizationParams(void 0);const m=c&&n._(c,o.redirectUri);if(!m)return void u.navigate({environment:t,url:a._j.root,redirect:!0});let h;if("errorType"in e)h={error:e.errorType,state:o.state};else{const{integration:n,spaceId:a,blockIdsForBot:s}=e;let l;if(l=(0,i.VM)(n)?await d.createOauthAuthorizationCode(t,{integrationId:n.id,spaceId:a,redirectUri:o.redirectUri}):await d.createOauthAuthorizationCode(t,{integrationId:n.id,spaceId:a,redirectUri:o.redirectUri,blockIdsForBot:s,templatePageId:e.templatePageId}),"failed"===l.type){p.showError(l);return g({environment:t,params:o,integration:n,errorType:503===l.status?r._.temporarily_unavailable:r._.server_error})}h={code:l.data.code,state:o.state}}const f=l.bf({url:m,query:{...h}});u.navigateToExternalURL({environment:t,url:f,targetSelf:!0})}},15356:(e,t,o)=>{o.d(t,{M:()=>m});var i=o(29477),n=o(89101),r=o(64002),a=o(5366),s=o(95477),l=o(33929),c=o(10161),d=o(47307),p=o(84908);const u=(0,a.defineMessages)({allowPopup:{id:"authAction.authorize.popupBlocked",defaultMessage:"It looks like your browser is currently blocking popups. Please allow pop-ups to continue",description:"Show when auth popup is blocked by browser or extension"},dismissButtonLabel:{defaultMessage:"Okay",id:"dialog.dismissButton.label"}});async function m(e,t){const{width:o,height:a,url:c,titleMessage:m}=t,h=l.default.formatMessage(m);if(e.device.isElectron)return p.openOauthPopup({width:o,height:a,url:c,title:h});const f=e.device.isMobile,v=void 0!==window.screenX?window.screenX:window.screenLeft,y=void 0!==window.screenY?window.screenY:window.screenTop,b=void 0!==window.outerWidth?window.outerWidth:document.documentElement.clientWidth,S=void 0!==window.outerHeight?window.outerHeight:document.documentElement.clientHeight-22,w=f?0:o,k=f?0:a;let C="toolbar=0,menubar=0,location=0";0!==w&&(C+=`,width=${w}`),0!==k&&(C+=`,height=${k}`),C+=`,left=${(v<0?window.screen.width+v:v)+(b-w)/2}`,C+=`,top=${y+(S-k)/2.5}`,C+=",scrollbars=1";const _=g()?(0,r.bf)({url:`${s.Z.domainBaseUrl}${n._j.verifyNoPopupBlockerHtmlAndRedirect}`,query:{redirectUri:c}}):c,M=window.open(_,h,C);if(M)M.focus();else if(g())return void d.showDialog({showCancel:!1,keepFocus:!1,message:l.default.formatMessage(u.allowPopup),items:[{label:l.default.formatMessage(u.dismissButtonLabel),onAccept:()=>{}}]});const T=i.UZ(),I=e=>{if(e&&e.data&&"popup-callback"===e.data.type){const t=e.data.url;T.resolve(t)}},P=setInterval((()=>{M&&M.closed&&T.resolve(void 0)}),300);window.addEventListener("message",I,!1);const x=await T.promise;return window.removeEventListener("message",I,!1),clearInterval(P),M&&M.close(),window.focus(),x}function g(){return"on"===c.default.getEligibleGroup({experimentId:"show_instruction_on_auth_popup_blocked",defaultGroup:"control"})}},95489:(e,t,o)=>{o.d(t,{xN:()=>ke,VW:()=>Pe,EV:()=>Ie,lp:()=>Te,yH:()=>we,Mf:()=>_e,Ex:()=>Ce,zJ:()=>be,Qt:()=>xe,I1:()=>Me});var i=o(77094),n=o.n(i),r=(o(67294),o(2280)),a=o(7406),s=o(65917),l=o(59730),c=o(15157),d=o(89101),p=o(90468),u=o(77858),m=o(19889),g=o(5366),h=o(64369),f=o(33954),v=o(34809),y=o(33929),b=o(26374),S=o(38755),w=o(79315),k=o(10161),C=o(12768),_=o(3815),M=o(50906),T=o(47307),I=o(94273),P=o(92625),x=o(97977),B=o(9953),Z=o(5978),E=o(74647),R=o(70782),A=o(96486),D=o.n(A),F=o(13991),L=o(46826),V=o(80994),N=o(4615),O=o(21202),U=o(54153),H=o(10482),z=o(97880),W=o(95477),j=o(28020),K=o(93959),Y=o(472),G=o(15517),X=o(73329),q=o(54642),$=o(35253),J=o(36110),Q=o(4408),ee=o(29974),te=o(21325),oe=o(30149),ie=o(53471),ne=o(37181);const re=(0,g.defineMessages)({joiningWorkspace:{id:"onboardingStateActions.joiningWorkspace.loadingMessage",defaultMessage:"Joining team…"},creatingWorkspace:{id:"onboardingStateActions.creatingWorkspace.loadingMessage",defaultMessage:"Getting ready…"},navigatingToWorkspace:{id:"onboardingStateActions.navigatingToWorkspace.loadingMessage",defaultMessage:"Taking you to your workspace…"},errorNoAction:{id:"onboardingStateActions.errorMessage.noActionToPerform",defaultMessage:"No action to perform for {onboardingRedirectType}",description:"This error is shown to the user when there is no workspace or page to redirect the user to after onboarding. Example of onboardingRedirectType is 'redirect_space' or 'guest_redirect'"},errorWorkspaceCreationPreventedWithEmail:{id:"onboardingStateActions.errorMessage.domainClaim.workspaceCreationPreventedWithEmail",defaultMessage:"You are signed in to {userEmailAddress} and do not have access to any workspaces. Please reach out to your IT department for access to Notion.",description:"This error is shown if a company claims their corporate email domain and has decided to prevent employees from creating new workspaces using their corporate Notion account and email"},errorWorkspaceCreationPrevented:{id:"onboardingStateActions.errorMessage.domainClaim.workspaceCreationPrevented",defaultMessage:"You do not have access to any workspaces. Please reach out to your IT department for access to Notion.",description:"This error is shown if a company claims their corporate email domain and has decided to prevent employees from creating new workspaces using their corporate Notion account and email"},errorWorkspaceDoesNotExist:{id:"onboardingStateActions.errorMessage.spaceDoesNotExist",defaultMessage:"Workspace does not exist.",description:"This error is shown to the user when the space linked to an inviteCode or inviteLink cannot be found."},errorWorkspaceDidNotLoad:{id:"onboardingStateActions.errorMessage.spaceDidNotLoad",defaultMessage:"Failed to load workspace.",description:"This error is shown to the user when the space linked to an inviteCode or inviteLink failed to load."}});async function ae(e,t){if(!e.isOnboarding)return{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};const o={...e,stageNumber:e.stageNumber+1};switch(o.stage){case"profile":return se(o,t);case"workspace_plan_choose":return function(e,t){if(!b.fz({state:e})){const o={userRole:void 0,companySize:void 0,...e,spaceJoinOrCreate:"create",useCases:[],stage:"workspace_create",spaceIcon:null,uploadingSpaceIcon:!1},{onboardingData:i}=e,n=y.default.getIntl(),r=i.userStore.getFullName(n),a=i.userStore.getProfilePhoto();if("userType"in e&&"personal"===e.userType&&r){return le({...o,userType:e.userType,userPersona:e.userPersona||"unfilled",spaceName:b.eW(r,n),spaceIcon:a||null,useCases:e.useCases},t)}return o}var o;if("on"!==(null===(o=e.onboardingExperiments)||void 0===o?void 0:o.onboarding_creator_no_joinable_spaces)){return{userRole:void 0,companySize:void 0,spaceName:void 0,...e,skip:!1,back:!1,stage:"persona_survey",previousStage:"workspace_plan_choose"}}{const o=y.default.getIntl();switch(e.planSelection){case"personal":case"school":return le({...e,spaceName:b.eW(e.onboardingData.userStore.getFullName(o)||"",o),companySize:void 0,userType:"personal",userPersona:"school"===e.planSelection?"student":"unfilled",userRole:void 0,useCases:[],spaceJoinOrCreate:"create",spaceIcon:e.onboardingData.userStore.getProfilePhoto()||null,uploadingSpaceIcon:!1,stage:"workspace_create"},t);case"team":return{spaceName:void 0,companySize:void 0,...e,skip:!1,back:!1,stage:"company_survey",previousStage:"workspace_plan_choose"};default:throw new Error(`Invalid intent selection: ${e.planSelection}`)}}}(o,t);case"workspace_choose":return async function(e,t){const{redirectData:o}=e;if("guest_redirect"===o.type)return ve(e,o,"guest",t);if("create"===e.spaceJoinOrCreate){if(b.fz({state:e})){const o={planSelection:void 0,useCases:[],companySize:void 0,userRole:void 0,...e,spaceJoinOrCreate:"create",stage:"workspace_create",spaceIcon:null,uploadingSpaceIcon:!1},i=e.onboardingData.userStore.getFullName(y.default.getIntl());if("userType"in o&&"personal"===o.userType&&i){const n=e.onboardingData.userStore.getProfilePhoto();return le({...o,userType:o.userType,userPersona:o.userPersona||"unfilled",spaceName:b.eW(i,y.default.getIntl()),spaceIcon:n||null},t)}return o}return{...ye(t,e),planSelection:void 0,...e,stage:"workspace_plan_choose",useCases:[]}}{const o=await async function(e,t){const{spaceStore:o,spaceViewStore:i,...n}=await me(e,t);return n}(e,t),{spaceId:i,spaceViewId:n,redirectData:r}=o,{flow:a}=e;switch(a){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_redirect":case"desktop_joinable_spaces":return await pe({environment:t,onboardingData:e.onboardingData,spaceId:i,spaceViewId:n,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:r,onboardingFlow:a,onboardingStage:e.stage,onboardingState:e}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":{const i={...e,...o};return ce(e.onboardingData,i,t)}case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return de({onboardingState:{...e,...o},environment:t,flow:a});default:return z.t1(a)}}}(o,t);case"company_survey":return function(e,t){if(e.back)return{...ye(t,e),useCases:[],...e,stage:"workspace_plan_choose"};return{userPersona:void 0,userRole:void 0,useCases:[],...e,skip:!1,back:!1,stage:"persona_survey",previousStage:"company_survey"}}(o,t);case"persona_survey":return function(e,t){if(e.back)return"company_survey"===e.previousStage?{...e,stage:"company_survey"}:{...ye(t,e),...e,stage:"workspace_plan_choose"};e.skip||function(e,t){const{onboardingData:o,userPersona:i,userRole:n,useCases:r,companySize:a}=t;oe.createAndCommit({userAction:"onboardingStateActions.setUserPersonaRoleAndUseCases",environment:e,perform:e=>{ne.d2({userSettingsStore:o.userSettingsStore,data:{persona:i,team_role:n,use_cases:r,company_size:a,persona_version:{version:"V4",timestamp:(new Date).getTime()}},transaction:e})}})}(t,e);const{onboardingData:o}=e,i=b.ey({onboardingData:o,isNewUserFlow:b.n0(e)});if(i.length>0){const t=b.Wc(o);return{...e,joinableSpaces:i,joinableSpaceGroup:t,stage:"workspace_choose"}}if(b.fz({state:e})){var n;const i=y.default.getIntl();if("on"===(null===(n=e.onboardingExperiments)||void 0===n?void 0:n.onboarding_creator_no_joinable_spaces)){const n={userType:"userType"in e?e.userType:"unknown",spaceIcon:e.onboardingData.userStore.getProfilePhoto()||null,...e,userPersona:e.userPersona||"unfilled",spaceJoinOrCreate:"create",spaceName:e.spaceName||b.eW(o.userStore.getFullName(i)||"",i),uploadingSpaceIcon:!1,stage:"workspace_create"};return"team"===e.planSelection?async function(e,t){var o;if("team"!==e.planSelection)throw new Error("This method should only be called for work intent");const{currentUserSettingsStore:i}=w.default.state,n=null==i?void 0:i.getSettings();!n||null!==(o=n.persona_version)&&void 0!==o&&o.version||b.PK(t,e);const r=await async function(e){const{environment:t,onboardingData:o,userPersona:i,spaceName:n,spaceIcon:r}=e,a=Y.default.createMetric("create_space_with_templates"),{spaceStore:l,spaceViewStore:c,inviteLinkCode:d,teamStore:p,personaTeamStore:u}=await ee.wh({environment:t,planType:"team",name:n,userRootStore:o.userRootStore,analyticsFrom:"onboarding",icon:r||void 0,userPersona:i,shouldCreateUserPersonaTeam:!0,shouldMakeUserPersonaTeamDefault:!0});C.default.setState({...C.default.state,spaceId:l.id}),await te.OR({environment:t,spaceId:l.id,isNewlyCreatedSpace:!0}),"staging"===W.Z.env&&s.log({level:"info",from:"onboardingStateActions",type:"createSpaceWithTemplates",data:(0,L.Z)({message:"createdSpace",spaceName:n,spaceId:l.id,userId:o.userSettingsStore.id,miscDataToConvertToString:{templates:i}})});return{spaceStore:l,spaceViewStore:c,inviteLinkCode:d,teamStore:p,personaTeamStore:u,createSpacePerfMetric:a}}({environment:t,onboardingData:e.onboardingData,userPersona:e.userPersona,spaceName:e.spaceName,spaceIcon:e.spaceIcon});!async function(e){const{spaceStore:t,spaceViewStore:o,teamStore:i,createSpacePerfMetric:n,environment:r,redirectData:a,onboardingData:l,personaTeamStore:c,useCases:d,spaceName:p,userPersona:u,isNewUserOnboarding:m}=e;let g;g=await ee.sM({environment:r,redirectData:a,spaceViewStore:o,userSettingsStore:l.userSettingsStore,userRootStore:l.userRootStore,isNewUserOnboarding:m,isPrivate:!1,templateType:"app_template",templates:K.pP,planType:"team",spaceJoinOrCreate:"create",teamStore:i,personaTeamStore:c,useCases:d,isOnboardingCreatorNoJoinableSpaces:!0}),"staging"===W.Z.env&&s.log({level:"info",from:"onboardingStateActions",type:"createSpaceWithTemplates",data:(0,L.Z)({message:"createdTemplates",spaceName:p,spaceId:t.id,redirectPageId:g?g.id:void 0,userId:l.userSettingsStore.id,miscDataToConvertToString:{templates:u}})});M.trackOnboardingCreateSpace(r,{plan_selection:"team",user_persona:u,initial_workspace_type:"create",space_name:p,space_id:t.id}),Y.default.emit(r,n,{});const h=fe(a,g);C.default.setState({...C.default.state,redirectData:h,spaceSetupCompleted:!0})}({...r,environment:t,isNewUserOnboarding:b.rT(e),redirectData:e.redirectData,onboardingData:e.onboardingData,useCases:e.useCases,spaceName:e.spaceName,userPersona:e.userPersona});const a=b.Of(e.onboardingData),{spaceStore:l,inviteLinkCode:c,spaceViewStore:d}=r,p=l.id,u=d.id;return b.At({environment:t,state:e,spaceStore:l,spaceViewStore:d}),{...e,isChecked:!0,spaceId:p,spaceViewId:u,emails:[],emailDomain:a,inviteLinkUrl:c&&(0,S.cJ)(t,p,c),stage:"invite",isBulkInvite:!1,shouldTriggerPostInviteAnimations:!1,spaceSetupCompleted:!1}}(n,t):le(n,t)}const r={spaceIcon:null,uploadingSpaceIcon:!1,...ye(t,e),...e,spaceJoinOrCreate:"create",userPersona:e.userPersona,stage:"workspace_create"},a=o.userStore.getFullName(i);if("userType"in r&&"personal"===r.userType&&a){const e=o.userStore.getProfilePhoto();return le({...r,userType:r.userType,userPersona:r.userPersona||"unfilled",spaceName:b.eW(a,i),spaceIcon:e||null},t)}return r}return{...ye(t,e),...e,planSelection:void 0,spaceJoinOrCreate:"create",userPersona:e.userPersona,stage:"workspace_plan_choose",useCases:[]}}(o,t);case"workspace_create":return le(o,t);case"invite":return async function(e,t){const o=Y.default.createMetric("invite_next_state");await b.SN(e,t);const{flow:i}=e;switch(i){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":return await pe({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingStage:e.stage,onboardingState:e}),Y.default.emit(t,o,{numInvitesSent:e.emails.length}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":if("mobile_join_or_create_space"===i){const n=ce(e.onboardingData,e,t);return Y.default.emit(t,o,{mobileOnboardingState:i}),n}{const n=de({onboardingState:e,environment:t,flow:i});return Y.default.emit(t,o,{mobileOnboardingState:i}),n}default:return z.t1(i)}}(o,t);case"desktop_app_download":return async function(e,t){return await pe({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingStage:e.stage,onboardingState:e}),{...e,flow:e.flow,stage:"template_optout"}}(o,t);case"template_optout":return function(e,t){return{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id}}(0,t);case"workspace_setup":return async function(e,t){const{flow:o}=e;switch(o){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":return await pe({environment:t,onboardingData:e.onboardingData,spaceId:e.spaceId,spaceViewId:e.spaceViewId,spaceJoinOrCreate:e.spaceJoinOrCreate,redirectData:e.redirectData,onboardingFlow:e.flow,onboardingStage:e.stage,onboardingState:e}),{isOnboarding:!1,isLoading:!1,currentUserId:t.currentUser.id};case"mobile_join_or_create_space":return ce(e.onboardingData,e,t);case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return Z.navigateToOnboarding(t),de({onboardingState:e,environment:t,flow:o});default:return z.t1(o)}}(o,t);case"mobile_editor":return function(e){return{...e,stage:"mobile_sidebar"}}(o);case"mobile_sidebar":return function(e,t){if(!b.og(t))return{...e,stage:"mobile_desktop"};return{...e,stage:"mobile_web_clipper"}}(o,t);case"mobile_desktop":return function(e,t){if(!b.og(t))return{...e,stage:"mobile_web_clipper"};return{...e,stage:"mobile_app_download"}}(o,t);case"mobile_web_clipper":return function(e,t){if(!b.og(t))return"mobile_existing_user"===e.flow?he(e,t):ce(e.onboardingData,e,t);return{...e,stage:"mobile_app_download"}}(o,t);case"mobile_app_download":return async function(e,t){return"mobile_existing_user"===e.flow?he(e,t):ce(e.onboardingData,e,t)}(o,t);case"error":return function(e){return{isOnboarding:!1,isLoading:!1,currentUserId:e.currentUser.id}}(t);default:z.t1(o)}}async function se(e,t){await b._J(e,t);const{password:o,...i}=e,n=U.Z.get(b.WX),{onboardingData:r,redirectData:a}=i,s=b.ey({onboardingData:r,isNewUserFlow:b.n0(i)});if("guest_redirect"===a.type)return ve(i,a,"guest",t);if("redirect_page"===a.type||"redirect_space"===a.type)return ve(i,a,"member",t);if("public_access_page_redirect"===a.type)return function(e,t,o){return ue({environment:o,permissionLevel:"public",onboardingState:e}),Z.navigateToBlock({environment:o,store:new _.G(o,{table:O.iU,id:t.pageId})}),{isOnboarding:!1,isLoading:!1,currentUserId:o.currentUser.id}}(i,a,t);if(n){const e=await q.getPublicSpaceData(t,{type:"invite-link",inviteLinkCode:n});if("success"===e.type){const{data:o}=e,{results:r}=o,a=r[0];if(a)return ve(i,{type:"team_invite_redirect",spaceId:a.id,inviteCode:n},"member",t);throw new Error(y.default.formatMessage(re.errorWorkspaceDoesNotExist))}throw new Error(y.default.formatMessage(re.errorWorkspaceDidNotLoad))}if(s.length>0){if(b.fz({state:i})){return{...i,spaceJoinOrCreate:"join",userPersona:void 0,userType:void 0,useCases:[],stage:"workspace_plan_choose",planSelection:void 0}}return{spaceName:void 0,...i,spaceJoinOrCreate:"join",userPersona:void 0,userRole:void 0,companySize:void 0,useCases:[],stage:"persona_survey",skip:!1,back:!1,previousStage:"profile",planSelection:void 0}}if(r.canUserCreateSpace){if(b.fz({state:i})){return{...i,spaceJoinOrCreate:"create",userPersona:void 0,userType:void 0,useCases:[],stage:"workspace_plan_choose",planSelection:void 0}}return{spaceName:void 0,...i,spaceJoinOrCreate:"create",userPersona:void 0,userRole:void 0,companySize:void 0,useCases:[],stage:"persona_survey",skip:!1,back:!1,previousStage:"profile",planSelection:void 0}}{M.trackWorkspaceCreationAbilityFromOnboarding(t,{can_user_create_space:!1,is_new_user:!0,has_joinable_spaces:!1,onboarding_stage:i.stage});const e=r.userStore.getEmail();throw new l.bp(e?y.default.formatMessage(re.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:e}):y.default.formatMessage(re.errorWorkspaceCreationPrevented),{newUser:!0})}}async function le(e,t){var o;const{flow:i,stage:n,spaceJoinOrCreate:r,onboardingData:a}=e,{currentUserSettingsStore:s}=w.default.state,l=null==s?void 0:s.getSettings();!l||null!==(o=l.persona_version)&&void 0!==o&&o.version||b.PK(t,e);const{spaceStore:c,spaceViewStore:d,...p}=await me(e,t);if(b.At({environment:t,state:e,spaceStore:c,spaceViewStore:d}),"team"===e.planSelection){const o=b.Of(e.onboardingData),{spaceId:i,inviteLinkCode:n}=p;return{...e,...p,isChecked:!0,spaceId:i,emails:[],emailDomain:o,inviteLinkUrl:n&&(0,S.cJ)(t,i,n),stage:"invite",isBulkInvite:!1,shouldTriggerPostInviteAnimations:!1,spaceSetupCompleted:!0}}switch(i){case"desktop_cold_start":case"desktop_join_or_create_space":case"desktop_joinable_spaces":case"desktop_redirect":const{spaceId:o,spaceViewId:s,redirectData:l}=p;return P.j({message:re.navigatingToWorkspace}),await pe({environment:t,onboardingData:a,spaceId:o,spaceViewId:s,spaceJoinOrCreate:r,redirectData:l,onboardingFlow:i,onboardingStage:n,onboardingState:e}),P.x(),{...e,spaceId:o,spaceViewId:s,flow:i,stage:"template_optout"};case"mobile_join_or_create_space":return ce(e.onboardingData,{...e,...p},t);case"mobile_cold_start":case"mobile_joinable_spaces":case"mobile_redirect":return de({onboardingState:{...e,...p},environment:t,flow:i});default:return z.t1(i)}}async function ce(e,t,o){return await pe({environment:o,onboardingData:e,spaceId:t.spaceId,spaceViewId:t.spaceViewId,spaceJoinOrCreate:t.spaceJoinOrCreate,redirectData:t.redirectData,onboardingFlow:t.flow,onboardingStage:t.stage,onboardingState:t}),{isOnboarding:!1,isLoading:!1,currentUserId:o.currentUser.id}}function de(e){const{onboardingState:t,environment:o,flow:i}=e;if("oauth_authorization_redirect"===t.redirectData.type){const{responseType:e,integrationId:i,redirectUri:n,state:r,owner:a,userId:s,spaceId:l}=t.redirectData;J.gF({environment:o,responseType:e,integrationId:i,redirectUri:n,state:r,owner:a,userId:s,spaceId:l})}return{...t,flow:i,stage:"mobile_editor"}}async function pe(e){const{environment:t,redirectData:o,spaceViewId:i,spaceId:n,onboardingData:r,spaceJoinOrCreate:a,onboardingFlow:s,onboardingState:l}=e;$.qL({bannerStore:X.Z,id:ie.XQ}),t.device.isMobile&&oe.createAndCommit({userAction:"onboardingStateActions.redirectAfterOnboarding",environment:t,perform:e=>{_e({userStore:r.userStore,transaction:e})}});const c=i?_.V9.createChildStore(r.userRootStore,{table:u.zU,id:i}):void 0;if("redirect_page"===o.type&&o.spaceId===n&&c)await Q.bG({environment:t,pointer:{table:O.iU,id:o.pageId},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,userId:t.currentUser.id}),await ee.y3({environment:t,spaceViewStore:c,redirectPageId:o.pageId,userSettingsStore:r.userSettingsStore,userRootStore:r.userRootStore,isNewlyCreatedSpace:"create"===a});else if("fork_page"===o.type&&c)await ee.y3({environment:t,spaceViewStore:c,redirectPageId:o.pageId,userSettingsStore:r.userSettingsStore,userRootStore:r.userRootStore,isNewlyCreatedSpace:"create"===a});else if("redirect_space"===o.type&&o.spaceId===n&&c)await ee.y3({environment:t,spaceViewStore:c,userSettingsStore:r.userSettingsStore,userRootStore:r.userRootStore,isNewlyCreatedSpace:"create"===a});else if("getting_started_page"!==o.type&&"redirect_space"!==o.type||!c)if("oauth_authorization_redirect"===o.type&&"mobile_cold_start"!==s&&"mobile_joinable_spaces"!==s&&"mobile_redirect"!==s){const{responseType:e,integrationId:i,redirectUri:n,state:r,owner:a,userId:s,spaceId:l}=o;J.gF({environment:t,responseType:e,integrationId:i,redirectUri:n,state:r,owner:a,userId:s,spaceId:l})}else if(c)await ee.y3({environment:t,spaceViewStore:c,userSettingsStore:r.userSettingsStore,userRootStore:r.userRootStore,isNewlyCreatedSpace:"create"===a});else{if(!r.firstSpaceView)throw new Error(y.default.formatMessage(re.errorNoAction,{onboardingRedirectType:o.type}));await ee.y3({environment:t,spaceViewStore:r.firstSpaceView,userSettingsStore:r.userSettingsStore,userRootStore:r.userRootStore,isNewlyCreatedSpace:"create"===a})}else await ee.y3({environment:t,spaceViewStore:c,redirectPageId:o.pageId,userSettingsStore:r.userSettingsStore,userRootStore:r.userRootStore,isNewlyCreatedSpace:"create"===a});ue({environment:t,spaceJoinOrCreate:a,permissionLevel:"member",onboardingState:l})}function ue(e){const{environment:t,onboardingState:o}=e;if(!o.isOnboarding)return;const{onboardingData:i}=o,{userStore:n}=i;oe.createAndCommit({userAction:"onboardingStateActions.setAndTrackOnboardingComplete",environment:t,perform:e=>{Ce({userStore:n,transaction:e})}}),M.trackOnboardingComplete(t,{...b.iF(o),initial_workspace_type:"public"!==e.permissionLevel?e.spaceJoinOrCreate:void 0,permission_level:e.permissionLevel}),M.trackZendeskSignup(t)}async function me(e,t){if("join"===e.spaceJoinOrCreate){P.j({message:re.joiningWorkspace});const o=await ge({environment:t,onboardingData:e.onboardingData,redirectData:e.redirectData,spaceId:e.spaceId||"",isNewUserOnboarding:b.rT(e)});return P.x(),o}{var o;P.j({message:re.creatingWorkspace});const i=await async function(e){const{environment:t,onboardingData:o,userPersona:i,redirectData:n,spaceName:r,planSelection:a,spaceIcon:l,isPrivate:c,useCases:d,isOnboardingCreatorNoJoinableSpaces:p,isNewUserOnboarding:u}=e,m="team"===a?"team":"personal",g=Y.default.createMetric("create_space_with_templates"),{spaceStore:h,spaceViewStore:f,inviteLinkCode:v,teamStore:b,personaTeamStore:S}=await ee.wh({environment:t,planType:m,name:r,userRootStore:o.userRootStore,analyticsFrom:"onboarding",icon:l||void 0,userPersona:i,shouldCreateUserPersonaTeam:p,shouldMakeUserPersonaTeamDefault:p});C.default.setState({...C.default.state,spaceId:h.id}),await te.OR({environment:t,spaceId:h.id,isNewlyCreatedSpace:!0}),"staging"===W.Z.env&&s.log({level:"info",from:"onboardingStateActions",type:"createSpaceWithTemplates",data:(0,L.Z)({message:"createdSpace",spaceName:r,spaceId:h.id,userId:o.userSettingsStore.id,miscDataToConvertToString:{templates:i}})});let w;if("team"===m)w=await ee.sM({environment:t,redirectData:n,spaceViewStore:f,userSettingsStore:o.userSettingsStore,userRootStore:o.userRootStore,isPrivate:c,templateType:"app_template",templates:K.pP,planType:m,spaceJoinOrCreate:"create",teamStore:b,personaTeamStore:S,useCases:d,isOnboardingCreatorNoJoinableSpaces:p,isNewUserOnboarding:u});else{const e=(0,H.vY)(m,y.default.getIntl());w=await ee.sM({environment:t,redirectData:n,spaceViewStore:f,userSettingsStore:o.userSettingsStore,userRootStore:o.userRootStore,isPrivate:c,templates:e,templateType:"page_template",planType:m,spaceJoinOrCreate:"create",teamStore:b,personaTeamStore:S,useCases:d,isNewUserOnboarding:u})}"staging"===W.Z.env&&s.log({level:"info",from:"onboardingStateActions",type:"createSpaceWithTemplates",data:(0,L.Z)({message:"createdTemplates",spaceName:r,spaceId:h.id,redirectPageId:w?w.id:void 0,userId:o.userSettingsStore.id,miscDataToConvertToString:{templates:i}})});M.trackOnboardingCreateSpace(t,{plan_selection:a,user_persona:i,initial_workspace_type:"create",space_name:r,space_id:h.id}),Y.default.emit(t,g,{});return{redirectData:fe(n,w),spaceId:h.id,spaceViewId:f.id,inviteLinkCode:v,spaceStore:h,spaceViewStore:f}}({environment:t,isNewUserOnboarding:b.rT(e),onboardingData:e.onboardingData,userPersona:e.userPersona,redirectData:e.redirectData,spaceName:e.spaceName,spaceIcon:e.spaceIcon,planSelection:e.planSelection,isPrivate:"team"!==e.planSelection,useCases:e.useCases,isOnboardingCreatorNoJoinableSpaces:"on"===(null===(o=e.onboardingExperiments)||void 0===o?void 0:o.onboarding_creator_no_joinable_spaces)});return P.x(),i}}async function ge(e){const{environment:t,onboardingData:o,spaceId:i,redirectData:n,isNewUserOnboarding:r}=e,a="team_invite_redirect"===n.type?n.inviteCode:void 0,{spaceViewStore:s}=await ee.j({environment:t,spaceId:i,userRootStore:o.userRootStore,analyticsFrom:"onboarding",userSettingsStore:o.userSettingsStore,inviteCode:a}),l=await ee.sM({environment:t,redirectData:n,spaceViewStore:s,isPrivate:!0,userSettingsStore:o.userSettingsStore,userRootStore:o.userRootStore,templates:void 0,templateType:"page_template",planType:"team",spaceJoinOrCreate:"join",useCases:[],isNewUserOnboarding:r});M.trackOnboardingJoinSpace(t,{initial_workspace_type:"join",space_id:i});return{redirectData:fe(n,l),spaceId:i,spaceViewId:s.id,inviteLinkCode:void 0,spaceStore:void 0,spaceViewStore:s}}async function he(e,t){const o=await async function(e,t){const o="spaceId"in e.redirectData&&e.redirectData.spaceId,{onboardingData:i,redirectData:n}=e;if(o){const r=await ge({environment:t,onboardingData:i,redirectData:n,spaceId:o,isNewUserOnboarding:b.rT(e)});return{...e,...r,spaceId:o}}if("fork_page"===n.type){const o=j.o(i.userRootStore);if(o.length>0){const r=o[0].getSpaceId();if(r){const a=_.H2.createChildStore(i.userRootStore,{table:p.bx,id:r}),s=fe(n,await ee.ux({environment:t,userRootStore:i.userRootStore,isPrivate:!0,forkedPageId:n.pageId,spaceStore:a,spaceViewStore:o[0]}));return{...e,redirectData:s,spaceViewId:o[0].id,spaceId:r}}}}return e}(e,t);return ce(e.onboardingData,o,t)}function fe(e,t){if(t){if("redirect_space"===e.type)return{type:e.type,pageId:t.id,spaceId:e.spaceId};if("getting_started_page"===e.type)return{type:e.type,pageId:t.id};if("fork_page"===e.type)return{type:e.type,pageId:t.id}}return e}async function ve(e,t,o,i){const{onboardingData:n}=e;if("guest"===o){if(ue({environment:i,spaceJoinOrCreate:"join",permissionLevel:o,onboardingState:e}),"team_invite_redirect"===t.type)throw new Error("Cannot invite guests to workspace from invite links.");await ee.j({environment:i,spaceId:t.spaceId,userRootStore:n.userRootStore,analyticsFrom:"onboarding",userSettingsStore:n.userSettingsStore,navigate:!0,redirectPageId:t.pageId})}else{const o=await ge({environment:i,onboardingData:n,redirectData:t,spaceId:t.spaceId,isNewUserOnboarding:b.rT(e)});await pe({environment:i,onboardingData:n,spaceId:o.spaceId,spaceViewId:o.spaceViewId,spaceJoinOrCreate:"join",redirectData:o.redirectData,onboardingFlow:e.flow,onboardingStage:e.stage,onboardingState:e})}return{isOnboarding:!1,isLoading:!1,currentUserId:i.currentUser.id}}function ye(e,t){let o,i;t.onboardingData.isEducationPlanEligible&&(i="personal",o="student");const{currentUserSettingsStore:n}=w.default.state,r=n&&n.getSettings();return r&&r.persona&&r.type&&(o=r.persona,i=r.type),{userPersona:o,userType:i}}async function be(e,t){if(!e.currentUser.id)return!1;const o=Se(e);return!!b.BB(o)||(t||(t=new _.U6(e,{table:m.KJ,id:e.currentUser.id}),await t.awaitNonNullValue()),!t.getOnboardingCompleted())}function Se(e){return{...c.Z.get({userId:e.currentUser.id,key:C.onboardingPreferenceKey}),currentUserId:e.currentUser.id}}async function we(e,t){const{state:o}=C.default;if(o.isLoading||o.isOnboarding||!e.currentUser.id)return;const i=Se(e);if(!i.isOnboarding)return;if(b.NT(i)&&t&&(null==t?void 0:t.id)!==i.spaceViewId)return;const{flow:n}=i,r="desktop_join_or_create_space"===n||"mobile_join_or_create_space"===n,a=await b.dD({environment:e,disableRedirects:r});a&&(i.onboardingData=a),C.default.setState(i);const{spaceId:s}=i;if(s&&w.default.setState({...w.default.state,currentSpaceStore:new _.H2(e,{table:p.bx,id:s})}),i.isOnboarding&&"spaceViewId"in i&&i.spaceViewId){const t=new _.V9(e,{table:u.zU,id:i.spaceViewId});w.default.setState({...w.default.state,currentSpaceViewStore:t})}Be(e,i)}async function ke(e){await Me(e,{type:"create-or-join"})}const Ce=function(e){const{userStore:t,transaction:o}=e;B.sW({store:t,data:{onboarding_completed:!0},transaction:o})},_e=function(e){const{userStore:t,transaction:o}=e;B.sW({store:t,data:{mobile_onboarding_completed:!0},transaction:o})};async function Me(e,t){try{k.default.getEligibleGroup({experimentId:"join_workspace_v2",defaultGroup:"unassigned"}),Z.navigate({environment:e,url:d._j.onboarding});const o=await b.dD({environment:e,disableRedirects:Boolean(t.disableRedirectUrl)||"create-or-join"===t.type}),i=b.Pn(o),n=await async function(e,t,o,i){const n=e.currentUser.id;if(void 0===n)throw new Error("Environment currentUserId not defined.");const{type:r,redirectUrl:a,disableRedirectUrl:s}=t,c=e.device.isMobile,{currentUserRootStore:d}=w.default.state,p=0===(d&&d.isReady()?D().uniq(d.getSpaceViewStores().filter((e=>e.getJoined())).map((e=>e.getSpaceId()))).length:0),u={onboardingData:o,redirectData:i,isOnboarding:!0,isLoading:!1,flowId:(0,N.ZP)(),currentUserId:n,isNewUser:p,stageNumber:0,spaceId:void 0,historicalStages:void 0,onboardingExperiments:{}};if("new-user"===r){const t=o.joinableSpaceData.results.length>0;let i;if(c)i=a&&!s?"mobile_redirect":t?"mobile_joinable_spaces":"mobile_cold_start";else if(a&&!s)i="desktop_redirect";else if(t)i="desktop_joinable_spaces";else{var m;"en-US"===F.SP&&(u.onboardingExperiments.onboarding_creator_no_joinable_spaces=(null===(m=(0,G.eN)(void 0))||void 0===m?void 0:m.onboarding_creator_no_joinable_spaces)||k.default.getEligibleGroup({experimentId:"onboarding_creator_no_joinable_spaces",defaultGroup:"control"})),i="desktop_cold_start"}const n={...u,flow:i,stage:"profile",uploadingProfilePhoto:!1,profilePhoto:null,prefilled:!1,passwordErrorData:null,emailOptIn:k.default.checkGate("onetrust_onboarding_checkbox")&&(0,V.Aw)(o.countryCode).defaultOptIn},r=b.$U({userStore:o.userStore});return r?se({...n,...r},e):n}if("create-or-join"===r){const t=b.ey({onboardingData:o,isNewUserFlow:!1}),i=b.Wc(o),n=c?"mobile_join_or_create_space":"desktop_join_or_create_space";if(t.length>0)return{...u,flow:n,stage:"workspace_choose",joinableSpaces:t,joinableSpaceGroup:i,prefilled:!1};if(o.canUserCreateSpace)return{...ye(0,u),...u,flow:n,stage:"workspace_plan_choose",prefilled:!1,spaceJoinOrCreate:"create",useCases:[],planSelection:void 0};{M.trackWorkspaceCreationAbilityFromOnboarding(e,{can_user_create_space:!1,is_new_user:!1,has_joinable_spaces:!1,onboarding_stage:void 0});const t=o.userStore.getEmail();throw new l.bp(t?y.default.formatMessage(re.errorWorkspaceCreationPreventedWithEmail,{userEmailAddress:t}):y.default.formatMessage(re.errorWorkspaceCreationPrevented),{newUser:!1})}}if("mobile-onboarding"===r)return{...u,flow:"mobile_existing_user",stage:"mobile_editor",spaceJoinOrCreate:"join"};throw z.t1(r),new Error("Invalid type.")}(e,t,o,i);if(n&&n.isOnboarding){"invalid"===i.type&&(n.stage="error"),C.default.setState(n);const t=b.iF(n);M.trackOnboardingShow(e,t),M.trackOnboardingStage(e,t),Be(e,n),n.isNewUser&&(r.I$(),r.j(e.device,{facebook:{eventName:"CompleteRegistration"},google:{eventName:"registration"}}))}}catch(o){const t=(0,a.tg)(o);!function(e,t,o){C.default.setState({...C.default.state,isLoading:!1}),M.trackOnboardingError(e,{...b.iF(C.default.state),errorMessage:t.message}),s.log({level:"error",from:"onboardingActions",type:"handleError",error:{message:`Found onboarding error: ${t.message}`}});const i=o?async()=>await x.actuallyLogoutAndDeleteAllLocalData(e):void 0;T.showMessage({message:t.message,onAccept:i})}(e,t,"WorkspaceCreationError"===t.name&&(0,l.Zw)(t)&&t.data.newUser)}}async function Te(e,t){if(t.isOnboarding)try{const o=await ae(t,e);M.trackOnboardingStage(e,b.iF(o)),C.default.setState(o),o.isOnboarding&&Be(e,o)}catch(o){Ie(e,(0,a.tg)(o))}}async function Ie(e,t){if(C.default.setState({...C.default.state,isLoading:!1}),M.trackOnboardingDialogError(e,{...b.iF(C.default.state),errorMessage:t.message}),s.log({level:"error",from:"onboardingActions",type:"handleOnboardingError",error:{message:`Found onboarding error: ${t.message}`,stack:String(t.stack)}}),P.x(),t instanceof v.G&&(0,l.Rp)(t.data.responseBody)&&"UnauthorizedError"===t.data.responseBody.name)return;let o;if(t instanceof v.G){var i,r;const e=null==t||null===(i=t.data)||void 0===i||null===(r=i.responseBody)||void 0===r?void 0:r.clientData;e&&(o=(0,f.XN)(y.default.getIntl(),e))}await T.confirmUserAction({message:n()("div",{},void 0,n()(h.Z,{style:{fontSize:17,fontWeight:500,lineHeight:"24px",paddingBottom:8}},void 0,n()(g.FormattedMessage,{defaultMessage:"Oops, something went wrong.",id:"onboardingActions.onboardingErrorDialog.message"})),n()("div",{},void 0,o??t.message)),acceptLabel:n()(g.FormattedMessage,{defaultMessage:"Start over",id:"onboardingActions.onboardingErrorDialog.startOverButton.label"}),cancelLabel:n()(g.FormattedMessage,{defaultMessage:"Close",id:"onboardingActions.onboardingErrorDialog.closeButton.label"})})&&function(e,t){const o=C.default.state;b.n0(o)?Me(e,{type:"new-user",disableRedirectUrl:!0}):b.y7(o)?Me(e,{type:"create-or-join",disableRedirectUrl:!0}):e.device.isMobile?Me(e,{type:"mobile-onboarding",disableRedirectUrl:!0}):s.log({level:"error",from:"onboardingActions",type:"handleOnboardingError",error:{message:`Could not redirect onboarding: ${t.message}`,stack:String(t.stack)}})}(e,t)}async function Pe(e){const{state:t}=C.default;if(b.n0(t)){if(!(await T.confirmUserAction({message:n()("div",{style:{display:"block"}},void 0,n()("div",{style:{fontWeight:600}},void 0,n()(g.FormattedMessage,{defaultMessage:"Cancel new account setup?",id:"onboardingActions.closeOnboardingDialog.newUser.title"})),n()("div",{},void 0,n()(g.FormattedMessage,{defaultMessage:"You'll be taken back to the Notion home page.",id:"onboardingActions.closeOnboardingDialog.newUser.subtitle"}))),acceptLabel:n()(g.FormattedMessage,{defaultMessage:"Return to home page",id:"onboardingActions.closeOnboardingDialog.newUser.confirmCloseButton.label"}),cancelLabel:n()(g.FormattedMessage,{defaultMessage:"Continue setup",id:"onboardingActions.closeOnboardingDialog.newUser.continueButton.label"})})))return;M.trackOnboardingClose(e,b.iF(t)),await x.actuallyLogoutAndDeleteAllLocalData(e)}else{if(!(await T.confirmUserAction({message:n()("div",{style:{display:"block"}},void 0,n()("div",{style:{fontWeight:600}},void 0," ",n()(g.FormattedMessage,{defaultMessage:"Cancel new workspace setup?",id:"onboardingActions.closeOnboardingDialog.existingUser.title"})),n()("div",{style:{wordBreak:"keep-all"}},void 0,n()(g.FormattedMessage,{defaultMessage:"You'll be taken back to your previous workspace.",id:"onboardingActions.closeOnboardingDialog.existingUser.subtitle"}))),acceptLabel:n()(g.FormattedMessage,{defaultMessage:"Back to previous workspace",id:"onboardingActions.closeOnboardingDialog.existingUser.confirmCloseButton.label"}),cancelLabel:n()(g.FormattedMessage,{defaultMessage:"Continue setup",id:"onboardingActions.closeOnboardingDialog.existingUser.continueButton.label"})})))return;M.trackOnboardingClose(e,b.iF(t));const{mainEditorCurrentBlockStore:i}=w.default.state,r=null==i?void 0:i.getSpaceId(),a=r&&(0,S.w3)(r);if(a){const e=a.getSpaceStore();w.default.setState({...w.default.state,currentSpaceStore:e,currentSpaceViewStore:a})}const{url:s,userId:l}=I.Vr(e);let c=e;if(l&&l!==e.currentUser.id&&(c=await R.x({environment:e,newCurrentUserId:l})),s){var o;E.close();const e=()=>{const e={isOnboarding:!1,isLoading:!1,currentUserId:l};C.default.setState(e)};Z.navigate({environment:c,url:s}),null!==(o=c.mobileNative)&&void 0!==o&&o.supportsNativeHomeOnPhone()?Z.navigateToHomeTab(c,e):e()}}}function xe(e){const{state:t}=C.default;M.trackOnboardingSkip(e,b.iF(t)),C.default.setState({isOnboarding:!1,isLoading:!1,currentUserId:e.currentUser.id})}function Be(e,t){if(!t.isOnboarding)return;if(t.isOnboarding){const o=[...t.historicalStages||[],{stageName:t.stage,stageNumber:t.stageNumber,timestamp:Date.now()}];C.default.setState({...t,historicalStages:o.length>20?[{stageName:"truncated",stageNumber:-1,timestamp:Date.now()}]:o}),M.trackServersideOnboarding(e,"onboarding_stage",{...b.iF(t),historical_stages:o})}}},89858:(e,t,o)=>{o.d(t,{B8:()=>X,D0:()=>q,kC:()=>$,mv:()=>J,pq:()=>Q,v9:()=>ee,NP:()=>te,LR:()=>oe,Eo:()=>ie,A5:()=>ne,He:()=>se});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=(o(67294),o(41432)),l=o(65917),c=o(15157),d=o(27006),p=o(29369),u=o(10482),m=o(82990),g=o(5366),h=o(22889),f=o(33929),v=o(40544),y=o(35026),b=o(38755),S=o(21115),w=o(23537),k=o(81844),C=o(79315),_=o(55367),M=o(42330),T=o(3815),I=o(70935),P=o(78291),x=o(50906),B=o(51127),Z=o(98834),E=o(47307),R=o(94419),A=o(13084),D=o(96178),F=o(11302),L=o(88428),V=o(19785),N=o(10279),O=o(9953),U=o(5978),H=o(74647),z=o(29974),W=o(21325),j=o(150),K=o(89971),Y=o(30149),G=o(63113);function X(e,t){return`${e.id}:${t}`}function q(e){var t;const{environment:o,store:i,transaction:n,navigateToParent:r}=e,a=O.j4({environment:o,type:s.Ti.page,inMemoryRecordCache:i.inMemoryRecordCache,transaction:n,spaceId:i.isCollectionView()?null===(t=i.getCollectionViewCollectionStore())||void 0===t?void 0:t.pointer.spaceId:i.pointer.spaceId}),l=i.getAssociatedCollectionStore();if(i.isCollectionView()){const e=i.getCollectionViewCollectionStore()||l;if(!e)throw new Error("getCollectionViewCollectionStore() returned undefined");if(!V.zw({parentStore:e,childStore:a,transaction:n}))throw new Error("parentChildActions.moveToCollection() returned false");const t=e.getDefaultTemplatePageStore();t&&Z.ob({title:"template",environment:o,store:a,templateStore:t,isKeyboard:!1,isCreateIn:!1,transaction:n,from:"outliner_actions"})}i.isCollectionView()||V.jG({parentStore:i.getContentStore(),childStore:a,transaction:n}),M.ZP.setState({...M.ZP.state,lastPageId:C.default.state.mainEditorCurrentBlockStore?C.default.state.mainEditorCurrentBlockStore.id:void 0}),o.device.isMobile?U.navigateToBlock({environment:o,store:a,showMoveTo:!1,saveParent:!1,visitType:h.vu.Link}):U.peekBlock({environment:o,store:a,showMoveTo:!0,saveParent:!1,currentBlockStore:r?i:void 0,peekMode:void 0,resultsStore:void 0,collectionContextStore:void 0}),x.trackCreateBlock(o,{from:"sidebar_outliner_item",type:"page"})}async function $(e){const{environment:t,spaceStore:o,spaceViewStore:i,type:r,prepend:a,outlinerToggleButtonStore:s,shouldPersistToggleState:l,title:c}=e;if(W.M_(t)){if("workspace"===r){const{data:e}=P.default.state,t=e?(0,S.su)(e):1;if(t>=10){if(!(await E.confirmUserAction({message:n()("span",{},void 0,n()(g.FormattedMessage,{defaultMessage:"Are you sure you want to create a new top-level page? <strongtext>This page will be visible in the sidebar to all {memberCount} members of your workspace.</strongtext>",id:"sidebarActions.confirmDialog.newWorkspacePage.message",description:"Shown in a dialog when the user attempts to create a new top level page when there are more than 10 members in the workspace. memberCount is always 10 or greater.",values:{strongtext:e=>n()("strong",{},void 0,e),memberCount:t}})),acceptLabel:n()(g.FormattedMessage,{defaultMessage:"Create top-level page",id:"sidebarActions.confirmDialog.newWorkspacePage.confirmButton.label"})})))return null}}const{serverCommitResult:e,performResult:{createdPage:d}}=Y.createAndCommit({userAction:"outlinerActions.createPageInSection",environment:t,perform:e=>{const n=z.KE({environment:t,spaceStore:o,spaceViewStore:i,isPrivate:"private"===r,prepend:a,transaction:e,title:c});return s&&ie({environment:t,spaceViewStore:i,type:r,outlinerToggleButtonStore:s,newIsHidden:!1,shouldPersistToggleState:Boolean(l)}),t.device.isMobile&&H.close(),"private"===r?x.trackCreateBlock(t,{from:"sidebar_private_section",type:"page"}):"workspace"===r&&x.trackCreateBlock(t,{from:"sidebar_workspace_section",type:"page"}),{createdPage:n}}}),p=o.getDisableSpacePageEdits();return"workspace"===r&&p&&await e,U.navigateToBlock({environment:t,store:d,visitType:h.vu.Link}),d}}async function J(e){const{environment:t,spaceStore:o,spaceViewStore:i,teamStore:n,andNavigate:r,from:a,outlinerToggleButtonStore:s,shouldPersistToggleState:l,title:c,loading:d,appendOrPrepend:p}=e,{serverCommitResult:u,performResult:{createdPage:m}}=Y.createAndCommit({userAction:"outlinerActions.createPageInTeam",environment:t,perform:e=>({createdPage:Q({environment:t,spaceStore:o,spaceViewStore:i,teamStore:n,from:a,title:c,loading:d,appendOrPrepend:p,transaction:e})})});return await u,r&&U.navigateToBlock({environment:t,store:m,visitType:h.vu.Link}),s&&K.k7({environment:t,spaceViewStore:i,teamStore:n,outlinerToggleButtonStore:s,newIsHidden:!1,shouldPersistToggleState:Boolean(l),isExplicitUserAction:!1}),m}function Q(e){const{environment:t,spaceStore:o,spaceViewStore:i,teamStore:n,from:r,title:a,loading:s,appendOrPrepend:l,transaction:c}=e;if(!(0,y.si)({teamStore:n,environment:t}))throw new Error("User is not eligible to create top-level page in team");const d=z.KE({environment:t,spaceStore:o,spaceViewStore:i,isPrivate:!1,prepend:!1,title:a,loading:s,transaction:c});x.trackCreatePageInTeam(t,{teamStore:n,from:r,pageId:d.id}),N.u9({store:d,transaction:c});const u=(0,v.uw)({type:"team",id:n.id});if(u.table!==p.e0)throw new Error("Assertion failure, moveToStore table is not TeamTable!");return F.at({environment:t,transaction:c,action:"add",teamStore:u,currentSpaceViewStore:i,targets:[d],value:{type:"team",id:n.id},location:{type:l}}),d}async function ee(e){var t;if(!(await async function(e){let{environment:t,type:o,droppedStores:i,droppedDirection:r,targetStore:a}=e;const s=re(i),{data:l}=P.default.state,c=l?(0,S.su)(l):1;if(!s)return!0;if("workspace"===o&&s===o&&c>=10)return r!==_.vh.Onto?E.confirmUserAction({message:n()("span",{},void 0,n()(g.FormattedMessage,{defaultMessage:"Are you sure you want re-order the workspace sidebar? <boldtext>This will be visible to all {memberCount} members.</boldtext>",id:"sidebarActions.confirmDialog.reorderWorkspaceSidebar.message",description:"Shown in a dialog when the user attempts to reorder a top level page when there are more than 10 members in the workspace. memberCount is always 10 or greater.",values:{memberCount:c,boldtext:e=>n()("span",{style:{fontWeight:m.Z.fontWeight.semibold}},void 0,e)}})),acceptLabel:n()(g.FormattedMessage,{defaultMessage:"Re-order sidebar",id:"sidebarActions.confirmDialog.reorderWorkspaceSidebar.confirmButton.label"})}):E.confirmUserAction({message:n()("span",{},void 0,n()(g.FormattedMessage,{defaultMessage:"Are you sure you want to move this workspace page? <boldtext>This will be visible to all {memberCount} members.</boldtext>",description:"Shown in a dialog when the user attempts to move top level page when there are more than 10 members in the workspace. memberCount is always 10 or greater.",id:"sidebarActions.confirmDialog.moveWorkspacePage.message",values:{memberCount:c,boldtext:e=>n()("span",{style:{fontWeight:m.Z.fontWeight.semibold}},void 0,e)}})),acceptLabel:n()(g.FormattedMessage,{defaultMessage:"Move page",id:"sidebarActions.confirmDialog.moveWorkspacePage.confirmButton.label"})});if("workspace"===o&&s!==o&&c>1)return E.confirmUserAction({message:n()("span",{},void 0,n()(g.FormattedMessage,{defaultMessage:"Are you sure you want to share this page with the workspace? <boldtext>It will be accessible by all {memberCount} members.</boldtext>",description:"Shown in a dialog when the user attempts to move a page to the workspace level when there are more than 10 members in the workspace. memberCount is always 10 or greater.",id:"sidebarActions.confirmDialog.sharePageWithWorkspace.message",values:{memberCount:c,boldtext:e=>n()("span",{style:{fontWeight:m.Z.fontWeight.semibold}},void 0,e)}})),acceptLabel:n()(g.FormattedMessage,{defaultMessage:"Move to workspace",id:"sidebarActions.confirmDialog.sharePageWithWorkspace.confirmButton.label"})});if("private"===o&&s!==o&&!I.Z.isInBulkSelectSession())return E.confirmUserAction({message:n()("span",{},void 0,n()(g.FormattedMessage,{defaultMessage:"Are you sure you want to make this page private? <boldtext>Only you will be able to access it.</boldtext>",id:"sidebarActions.confirmDialog.movePageToPrivate.message",values:{boldtext:e=>n()("span",{style:{fontWeight:m.Z.fontWeight.semibold}},void 0,e)}})),acceptLabel:n()(g.FormattedMessage,{defaultMessage:"Move to private",id:"sidebarActions.confirmDialog.movePageToPrivate.confirmButton.label"})});if(I.Z.isInBulkSelectSession()&&i.length>1)return(0,v.vW)({environment:t,moveToLocation:(0,v.vz)({outlinerSectionType:o,targetStore:a,droppedDirection:r}),movedItems:i});return!0}(e)))return;const{environment:o,droppedStores:i,droppedDirection:r,type:a,targetStore:l,targetParentStore:c}=e;if(!(I.Z.isInBulkSelectSession()||1!==i.length||null!==(t=c.getValue())&&void 0!==t&&t.includes(i[0].id))){let e=[];for(const n of i)if(e=await B.SC({environment:o,block:n,action:"move"}),"user_canceled"===e)return;const t=i[0].id;for(const o of e)o.id!==t&&i.push(o)}const p=Object.fromEntries(i.map((e=>[e.id,e.getParentId()]))),{performResult:{moved:u}}=await Y.createAndCommitAsync({environment:o,userAction:"outlinerActions.confirmAndHandleDrop",waitForServerCommit:!0,perform:async t=>({moved:await async function(e){const{environment:t,type:o,droppedDirection:i,targetStore:r,targetParentStore:a,droppedStores:l,transaction:c,isTopLevelItem:p}=e,u=re(l),{currentSpaceStore:m,currentUserStore:h}=C.default.state,f=null==m?void 0:m.id,{data:y}=P.default.state,w="bookmarks"===u&&"bookmarks"===o,k=ae(e),M=f&&l.some((e=>e.isTopLevelWorkspacePage(f))),T=r&&f&&r.isTopLevelWorkspacePage(f),I=null==m?void 0:m.getDisableSpacePageEdits();if(f&&I&&(M||T)&&!w&&i!==_.vh.Onto&&null!=h&&h.isDefined()&&y){const e=(0,S.hn)(y).filter((e=>e.userId===h.id))[0];if(e&&!d.zz(e.role))return E.showErrorMessage(n()(g.FormattedMessage,{defaultMessage:"This workspace has locked top-level workspace page operations.",id:"sidebarActions.confirmDialog.lockedWorkspaceTopLevel.message",description:"Shown in a dialog when the member attempts to modify top-level pages when workspace section has been locked."})),!1}const x=function(e){let{targetStore:t,targetParentStore:o}=e;if(t)return t;const{id:i,table:n}=o;let r;switch(n){case"space":case"space_view":r={type:"space",id:i};break;case"block":r={type:"page",id:i};break;case"team":r={type:"team",id:i};break;default:throw new Error("Unexpected table type")}return(0,v.uw)(r)}({targetStore:r,targetParentStore:a});if(!w&&!k){if("user_cancelled_move"===await j.Hl({transaction:c,moveStores:l,moveTargetStore:x}))return!1}D.e({environment:t,transaction:c,moveToStore:x,targetBlocks:l,from:"drag_and_drop"});const B=function(e){const{environment:t,type:o,targetStore:i,targetParentStore:n,droppedDirection:r,droppedStores:a,duplicate:l,transaction:c}=e,{currentSpaceViewStore:d,currentSpaceStore:p,currentUserSettingsStore:u}=C.default.state;let m;const g=null==i?void 0:i.getModel();if(r===_.vh.Onto&&i&&n&&null!=g&&g.isType(s.m3))m=A.LQ({environment:t,targetParentStore:n,targetStore:i,droppedDirection:_.vh.Below,droppedStores:a,duplicate:l,transaction:c});else if(ae(e)&&i){if(!d||!u)throw new Error("currentSpaceViewStore or currentUserSettingsStore not found");const{visibleSharedPagesStores:e}=(0,b.MC)({environment:t,spaceViewStore:d,userSettingsStore:u}).state,o=e.map((e=>e.id)),n=a.map((e=>e.id)),s=o.filter((e=>n.indexOf(e)<0)),l=s.findIndex((e=>e===i.id));let p=[];p=r===_.vh.Above?[...s.slice(0,l),...n,...s.slice(l)]:[...s.slice(0,l+1),...n,...s.slice(l+1)],O.sW({store:d,data:{shared_pages:p},transaction:c}),m=a}else"private"===o&&p&&d&&z.OQ({environment:t,spaceStore:p,spaceViewStore:d,transaction:c}),m=A.LQ({environment:t,targetParentStore:n,targetStore:i,droppedDirection:r,droppedStores:a,duplicate:l,transaction:c});return m}(e),Z=B.filter((e=>e.isTopLevel()));u&&"private"!==u&&"private"===o&&z.O2({blocks:B,transaction:c});"workspace"===o?z.lF({environment:t,blocks:Z,transaction:c}):"private"===o&&z.IY({environment:t,blocks:Z,transaction:c});p&&i!==_.vh.Onto&&G._w({environment:t,blocks:l,transaction:c});return!0}({...e,transaction:t})})});u&&D.w({environment:o,movedItems:i,previousParentIds:p,moveToLocation:(0,v.vz)({targetStore:l,droppedDirection:r,outlinerSectionType:a})})}async function te(e){const{droppedStores:t,duplicate:o}=e.dropArgs,{environment:i,type:n,isTopLevel:r,parentStore:a}=e,s=_.vh.Below;return!!a&&(await ee({environment:i,type:n,targetParentStore:a,isTopLevelItem:r,droppedDirection:s,droppedStores:t,duplicate:o}),!0)}function oe(e){const{environment:t,store:o,parentStore:i,insertStores:n,transaction:r,before:s,type:l}=e,{currentSpaceViewStore:c,currentSpaceStore:d}=C.default.state,p=a().clone(n).reverse();"private"===l&&d&&c&&z.OQ({environment:t,spaceStore:d,spaceViewStore:c,transaction:r});const u=s?p.map((e=>R.Vt({parent:i,insert:e,before:o,transaction:r}).child)):p.map((e=>R.BE({parent:i,insert:e,after:o,transaction:r}).child)),m=u.filter((e=>e.isTopLevel()));return"workspace"===l?z.lF({environment:t,blocks:m,transaction:r}):"private"===l&&z.IY({environment:t,blocks:m,transaction:r}),u}function ie(e){let{environment:t,spaceViewStore:o,type:i,outlinerToggleButtonStore:n,newIsHidden:r,shouldPersistToggleState:a}=e;n.setState({...n.state,isHidden:r}),x.trackOutlinerSectionToggle(t,{is_toggled:!r,outliner_type:i}),a&&c.Z.set({userId:o.environment.currentUser.id,key:X(o,i),value:r})}function ne(e){const{type:t,targetStore:o,targetParentStore:i,transaction:n,isTopLevelItem:r}=e,a=(0,w.bq)()&&"team"===t&&i.table===p.e0&&r;if(R.Od({childToRemove:o,parent:i,transaction:n}),a&&o.getParentId()===i.id){const t=T.zX.createChildStore(e.targetParentStore,{...e.targetParentStore.pointer,table:p.e0});j.sp({teamStore:t,store:o,transaction:n})}}function re(e){for(const t of e){const e=k.Z.findOutlinerItemFromStore(t);if(e)return e.type}}function ae(e){let{type:t,droppedDirection:o,isTopLevelItem:i}=e;return"shared"===t&&o!==_.vh.Onto&&i}async function se(e){const{environment:t,teamStore:o}=e,i=C.default.state.currentSpaceStore,n=C.default.state.currentSpaceViewStore;if(!i||!n)return l.log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-SpaceOrSpaceViewStoreError"}),!1;const r=(0,u.Y4)(f.default.getIntl());return!!(await L.rC({environment:t,item:r,isPrivate:!1,spaceStore:i,spaceViewStore:n,useMinimalTemplates:!1,type:"inTeam",teamStore:o,from:"homepage_team",appendOrPrepend:"prepend",isOnboarding:!1}))||(l.log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-PageNotCreated"}),!1)}},72711:(e,t,o)=>{o.d(t,{hc:()=>w,Y_:()=>k,ru:()=>C,bo:()=>_});var i=o(1302),n=o(41432),r=o(4615),a=o(21202),s=o(6287),l=o(19889),c=o(78316),d=o(84210),p=o(89014),u=o(58202),m=o(79315),g=o(3815),h=o(26664),f=o(52229),v=o(94419),y=o(9953),b=o(5978),S=o(30149);const w=function(e){const{environment:t,store:o,targetStore:i,transaction:n}=e,r=o.getParentBlockStore();if(r){const e=r.getContentStore(),a=f.k({environment:t,parentBlock:r,targetStore:i,transaction:n});return v.rS({parent:e,oldChild:o,newChild:a,transaction:n}).child}throw new Error("Could not create alias block.")};function k(e){const{environment:t,store:o,collectionStore:d,collectionViewStore:m,transaction:f}=e,{id:b}=t.currentUser,S=o.getRecordStoreUIParent();if(null!=S&&S.valueIs(h.i)){if(!o.isDefined())throw new Error("Block to replace was not defined.");if(S&&b){var w,k,C;const e=Date.now(),h=(0,r.ZP)(),_=null===(w=(0,c.Vv)(d))||void 0===w?void 0:w.getFormatStore().getKeyStore("table_properties").getValue(),M=null===(k=(0,c.Vv)(d))||void 0===k||null===(C=k.getQueryStore())||void 0===C?void 0:C.getKeyStore("sort").getValue(),T={id:(0,r.ZP)(),version:0,type:"table",parent_id:h,parent_table:"block",alive:!0,space_id:o.getSpaceId(),format:{table_properties:_},query2:{sort:M}};y.ae({environment:t,table:"collection_view",value:T,inMemoryRecordCache:o.inMemoryRecordCache,transaction:f});const I={id:h,type:n.Ti.collectionView,collection_id:d.id,view_ids:[T.id],properties:{},parent_id:S.id,parent_table:"block",alive:!0,created_by_table:l.KJ,created_by_id:b,created_time:e,last_edited_by_table:l.KJ,last_edited_by_id:b,last_edited_time:e,space_id:o.getSpaceId(),format:{collection_pointer:{table:s.v,id:d.id,spaceId:d.pointer.spaceId}}};y.ae({environment:t,table:"block",value:I,inMemoryRecordCache:o.inMemoryRecordCache,transaction:f});const P=v.rS({parent:S,oldChild:o,newChild:g.G.createChildStore(S,{table:a.iU,id:h}),transaction:f}).child;return(0,p.u)(T.id,{viewPointer:null==m?void 0:m.pointer}),i.default.afterNextFlush((()=>{const e=u.R.findBlockWithMethodFromStore(P,"handleCreated");e&&e.handleCreated()})),P}}}function C(e){const{environment:t,blocks:o,openInNew:i}=e,n=o[0];if(i){const e=(0,d.ZP)({store:n});b.navigate({environment:t,url:e,openInNew:i})}else{const e=n.recordStoreUIParentStore instanceof g.G&&n.recordStoreUIParentStore.isCollectionView(),{mainEditorCurrentBlockStore:o}=m.default.state;if(e&&o){const e=(0,d.ZP)({store:o,fullyQualified:!1,peekViewBlockId:n.id});b.navigate({environment:t,url:e})}else b.navigateToBlock({environment:t,store:n})}}function _(e){const{environment:t,store:o,lock:i}=e,{id:n}=t.currentUser;if(!n)return;const r={block_locked:i,block_locked_by:n};S.createAndCommit({userAction:"pageBlockActions.setPageLock",environment:t,perform:e=>{y.sW({store:o.getFormatStore(),data:r,transaction:e})}})}},88428:(e,t,o)=>{o.d(t,{RL:()=>Q,xv:()=>J,rC:()=>te,YH:()=>re,Jj:()=>q,Hp:()=>ie,Lf:()=>ee,GS:()=>X,$7:()=>G,zO:()=>$,GF:()=>ne});var i=o(59730),n=o(15157),r=o(5366),a=o(45953),s=o(98459),l=o(21202),c=o(96486),d=o.n(c),p=o(65680),u=o(24211),m=o(11002),g=o(10482),h=o(98251);function f(e,t){return e.map((e=>(0,g.G_)(e,t)))}function v(e){return e.map((e=>d().clone(e)))}const y={nameMessage:h.sY.personal,sectionName:"personal",icon:"😀",items:v([m.Y.quickNoteV2,m.Y.personalHomeV2,m.Y.taskList,m.Y.journalV2,m.Y.readingListV2,m.Y.goals,m.Y.travelPlannerV2,m.Y.blogPostV2,m.Y.simpleNotebook,m.Y.habitTrackerV2,m.Y.lifeWikiV2,m.Y.resumeV2,m.Y.jobApplicationsV2,m.Y.weeklyAgenda])},b={nameMessage:h.sY.designer,sectionName:"designer",icon:"🎨",items:v([m.Y.roadmap,m.Y.userResearch,m.Y.designTasks,m.Y.designMeetingNotes,m.Y.designSystem,m.Y.companyGoals])},S={nameMessage:h.sY.engineering,sectionName:"programmer",icon:"🔨",items:v([m.Y.engineeringToDo,m.Y.roadmap,m.Y.engineeringWiki,m.Y.engineeringDocs,m.Y.engineeringMeetingNotes,m.Y.companyGoals])},w={nameMessage:h.sY.marketing,sectionName:"marketing",icon:"🎤",items:v([m.Y.brandAssets,m.Y.marketingMeetingNotes,m.Y.mediaList,m.Y.contentCalendar,m.Y.moodBoard])},k={nameMessage:h.sY.hr,sectionName:"hr_recruiting",truncatedNameMessage:h.sY.truncated_hr,icon:"👫",items:v([m.Y.jobBoard,m.Y.hrMeetingNotes,m.Y.newHireOnboarding,m.Y.applicantTracker,m.Y.companyHome])},C={nameMessage:h.sY.productManagement,sectionName:"product_manager",icon:"🏗",items:v([m.Y.roadmap,m.Y.userResearch,m.Y.pmDocs,m.Y.pmMeetingNotes,m.Y.productWiki,m.Y.companyGoals])},_={nameMessage:h.sY.support,sectionName:"customer_support",icon:"🚑",items:v([m.Y.teamDirectory,m.Y.productFAQs,m.Y.supportMeetingNotes,m.Y.supportTaskList,m.Y.helpCenter,m.Y.supportProcessDocs])},M={nameMessage:h.sY.student,sectionName:"student",icon:"🎒",items:v([m.Y.classNotes,m.Y.studentJobApplications,m.Y.gradeCalculator,m.Y.clubHomepage,m.Y.readingList,m.Y.thesisPlanning,m.Y.cornellNotesSystem,m.Y.personalCRM,m.Y.roommateSpace,m.Y.simpleBudget,m.Y.syllabus,m.Y.classroomHome,m.Y.lessonPlans,m.Y.courseSchedule,m.Y.classDirectory])},T={nameMessage:h.sY.sales,sectionName:"sales",icon:"🤝",items:v([m.Y.salesMeetingNotes,m.Y.salesCRM,m.Y.salesWiki,m.Y.competitiveAnalysis,m.Y.salesAssets])},I={designer:b,student:M,programmer:S,hr_recruiting:k,marketing:w,personal:y,unfilled:{nameMessage:h.sY.other,sectionName:"other",icon:"🎁",items:v([m.Y.teamMeetingNotes,m.Y.teamDocs,m.Y.teamHome,m.Y.teamTasks,m.Y.taskList])},product_manager:C,sales:T,customer_support:_};function P(e,t){const{nameMessage:o,truncatedNameMessage:i,items:n,...r}=e,a=n.filter((e=>t.locale in e.sources)),s=0!==a.length||(0,p.Bd)(t.locale)?a:n.filter((e=>u.al in e.sources));return{...r,...i?{truncatedName:t.formatMessage(i)}:{},items:f(s,t),name:t.formatMessage(o)}}function x(e){return d().uniq(Object.values(I)).reduce(((t,o)=>{const i=P(o,e);return i.items.length>0&&t.push(i),t}),[])}var B=o(95477),Z=o(33929),E=o(98165),R=o(79315),A=o(56638),D=o(50906),F=o(54642),L=o(54532),V=o(89858),N=o(9953),O=o(4408),U=o(5978),H=o(24677),z=o(74647),W=o(29974),j=o(30149);const K="LastViewedTemplateId",Y=(0,r.defineMessages)({clientCopyError:{defaultMessage:"Client copy could not be created.",id:"spaceActions.createGettingStartedPage.copyNotCreated.error",description:"Client refers to the user's Notion application."}});function G(e){const{environment:t,item:o,createNewPage:i,isPrivate:r}=e;H.ZH(t);const a=function(e,t){const o=x(Z.default.getIntl());for(const i of o)for(const e of i.items)if(e.previewRootId===t.previewRootId&&e.rootId===t.rootId)return i.sectionName}(0,o),s=a?[a]:void 0,l=x(Z.default.getIntl());A.Z.setState({open:!0,item:o,sections:l,createNewPage:i,isPrivate:r,isLoading:!1,openSections:s}),n.Z.set({userId:t.currentUser.id,key:K,value:o.rootId}),D.trackTemplateModalOpen(t,{template_name:o.name,from:i?"sidebar":"newPage"})}function X(e){if(A.Z.state.open){const t=function(e){if(A.Z.state.open){const t=A.Z.state.openSections||[];if(e&&-1===t.indexOf(e))return[...t,e]}return[]}(e);A.Z.setState({...A.Z.state,openSections:t})}}function q(e){if(A.Z.state.open){const t=A.Z.state.openSections;if(t){const o=t.indexOf(e);if(-1!==o){t.splice(o,1);const e=t.length>0?t.slice(0):void 0;A.Z.setState({...A.Z.state,openSections:e})}}}}function $(e){let{templateItem:t,currentUserId:o}=e;const i=A.Z.state.item;A.Z.setState({...A.Z.state,item:t}),i!==t&&n.Z.set({userId:o,key:K,value:t.rootId})}function J(e){A.Z.setState({item:A.Z.state.item,open:!1}),H.ZH(e)}async function Q(e){const{item:t,environment:o,spaceStore:i}=e;A.Z.state.open&&A.Z.setState({...A.Z.state,isLoading:!0});const n=e.initializeStore?{...e,initializeStore:e.initializeStore,isPrivate:!1,type:"inExistingStore",useMinimalTemplates:!1}:{...e,type:"inSpace",useMinimalTemplates:!1,isOnboarding:!1};let r=!1;const a=Date.now();let s;try{s=await te(n),r=!0,U.navigateToBlock({environment:o,store:s}),J(o),o.device.isMobile&&z.close()}finally{var l;const n=Date.now()-a,c=e.initializeStore?E.VP(e.initializeStore):void 0,d=e.initializeStore?!Boolean(c):e.isPrivate;D.trackTemplateModalAccept(o,{template_name:t.name,destination:d?"private":"team",template_block_id:t.rootId,template_duplication_duration_ms:n,team_id:null==c?void 0:c.id,created_page_id:null===(l=s)||void 0===l?void 0:l.id}),D.trackDuplicateTemplate(o,{from:"inApp",success:r,context:e.from,template_name:t.name,template_block_id:t.rootId,target_space_id:i.id,template_duplication_duration_ms:n})}}async function ee(e){const{environment:t,initializeStore:o,item:i,isPrivate:n,useMinimalTemplates:r,spaceStore:s,spaceViewStore:l}=e,c=r?i.rootId:i.previewRootId,d=await F.loadBlockSubtree(t,{block:{id:c,spaceId:i.spaceId},shallow:!1});let p;"success"===d.type&&(p=a.Ak.create(d.data.subtreeRecordMap));const u="pageTemplateModalActions.loadAndDuplicatePageTemplate",{performResult:m}=j.createAndCommit({userAction:u,environment:t,perform:e=>{const i=o||W.KE({environment:t,spaceStore:s,spaceViewStore:l,isPrivate:n,loading:!0,transaction:e});O.fL({environment:t,inMemoryRecordCache:i.inMemoryRecordCache,recordMap:p,debugSource:u});const r=L.K8(t,{blockId:c,inMemoryRecordCache:i.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0});if(!r)throw new Error(Z.default.getIntl().formatMessage(Y.clientCopyError));return L.E9({environment:t,sourceBlockId:c,targetBlockPointer:i.pointer,sourceBlockSubtree:r,targetInMemoryRecordCache:i.inMemoryRecordCache,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0}),i}});return m}async function te(e){const{environment:t,item:o,useRecordCache:i,isPrivate:n,useMinimalTemplates:r,spaceStore:a,spaceViewStore:s,isOnboarding:c}=e,{serverCommitResult:d,performResult:{pageStore:p,copyBlock:u}}=j.createAndCommit({userAction:"pageTemplateModalActions.createTemplateInstance",environment:t,perform:c=>{let d;d="inExistingStore"===e.type&&e.initializeStore?e.initializeStore:"inTeam"===e.type&&e.teamStore?V.pq({environment:t,spaceStore:a,spaceViewStore:s,teamStore:e.teamStore,from:e.from,loading:!0,appendOrPrepend:e.appendOrPrepend?e.appendOrPrepend:"append",transaction:c}):W.KE({environment:t,spaceStore:a,spaceViewStore:s,isPrivate:n,loading:!0,transaction:c});const p={id:i&&!r?o.previewRootId:o.rootId,table:l.iU,spaceId:o.spaceId};return ne({item:o,spaceViewStore:s,transaction:c}),function(e){const{item:t,transaction:o,spaceViewStore:i}=e;if(i){const e=i.getSidebarHiddenTemplateIds();if(e.indexOf(t.rootId)<0){const n=e.concat([t.rootId]);N.sW({store:i,data:{sidebar_hidden_templates:n},transaction:o})}}}({item:o,spaceViewStore:s,transaction:c}),{pageStore:d,copyBlock:p}}});return await d,await ie({environment:t,pageStore:p,copyBlock:u,useRecordCache:i,item:o,isOnboarding:Boolean(c)}),p}const oe={block:!0,collection:!0,collection_view:!0,discussion:!0,comment:!0};async function ie(e){const{environment:t,pageStore:o,copyBlock:n,item:r,useRecordCache:l,isOnboarding:c}=e,d=a.Ak.create();l&&l.forEachRecord(t.currentUser.id,((e,t)=>{oe[e.table]&&d.set(e,t.value)}));const{currentSpaceStore:p}=R.default.state;if(!p)throw new i.p8("Could not get currentSpaceStore.");return"failed"===(await F.initializePageTemplate(t,{recordMap:d.toJson({allowVersionDowngrade:!1}),sourceBlock:n,targetBlock:{id:o.pointer.id,table:o.pointer.table,spaceId:(0,s.CG)(o.pointer.spaceId)},isOnboarding:c})).type&&"local"===B.Z.env&&j.createAndCommit({userAction:"pageTemplateModalActions.initializePageTemplate",environment:t,perform:e=>{N.sW({store:o,data:{type:"page",properties:{title:[[r.name]]},format:{page_icon:r.emoji}},transaction:e})}}),o}function ne(e){const{item:t,transaction:o,spaceViewStore:i}=e;if(i){const e=i.getVisitedTemplateIds();if(e.indexOf(t.rootId)<0){const n=e.concat([t.rootId]);N.sW({store:i,data:{visited_templates:n},transaction:o})}}}function re(){if(A.Z.state.open)return A.Z.state.openSections}},25320:(e,t,o)=>{o.d(t,{U:()=>f,R:()=>v});var i=o(96486),n=o.n(i),r=o(98459),a=o(21202),s=o(70017),l=o(89470),c=o(97880),d=o(67669),p=o(65598),u=o(79315),m=o(39218),g=o(3815),h=o(54642);async function f(e,t){await u.default.waitUntilRendered();const{fromPageRefresh:o,block:i,pageVisitStore:n,timestamp:c}=t,f=e.currentUser.id;if(void 0===f||o)return;t.block.id!==n.state.pageId&&n.setState({...n.getInitialState(),pageId:t.block.id});const v=(0,g.Kv)(i,{table:l.UI,id:(0,l.Pv)({parent_id:i.id,user_id:f}),spaceId:(0,r.CG)(i.pointer.spaceId)}),b=(0,g.Kv)(i,{table:s.Kk,id:(0,l.Pv)({parent_id:i.id,user_id:f}),spaceId:(0,r.CG)(i.pointer.spaceId)});if(await m.transactionQueue.awaitRecordTransaction({table:a.iU,id:i.id}),await(0,p.M1)(i),!i.canRead()||(0,d.IJ)(e,i))return;await v.load(),await b.load();const S=v.getKeyStore("visited_at").getValue(),w=b.getKeyStore("exited_at").getValue(),k=await async function(e,t,o,i){const{id:n}=e.currentUser;var r;n&&(null==e||null===(r=e.mobileNative)||void 0===r||r.recordPageVisit(n,{blockId:t,spaceId:o,visitedAt:i}));return await h.recordPageVisit(e,{block:{id:t,spaceId:o},timestamp:i})}(e,i.id,(0,r.CG)(i.pointer.spaceId),c);if("failed"===k.type)return;const C=y({pageVisits:k.data.pageVisits,omittedUserIds:[],currentState:n.state,block:i});n.state.pageId===i.id&&n.setState({...C,lastViewTime:S,lastExitTime:w})}async function v(e,t){await u.default.waitUntilRendered();const o=e.currentUser.id;if(void 0===o)return;const{block:i,pageVisitStore:a,incremental:s}=t,l=t.limit||32;let d;if(s){const{pageId:e,lastViewTime:t,lastExitTime:i,omittedUserIds:r,...s}=a.state,l=Object.entries(s).map((e=>{let[t,i]=e;if(o===t)return;const n=i.getVisitedAt();return void 0!==n?n+1:void 0}));d=n().max(l.filter(c.$K))}const p=await h.getPageVisitors(e,{block:{id:i.id,spaceId:(0,r.CG)(i.pointer.spaceId)},sinceTimestamp:d,limit:l});if("failed"===p.type)return;const m=y({pageVisits:p.data.pageVisits,omittedUserIds:p.data.omittedUserIds,block:i,currentState:a.state});let g;if(Object.keys(m).length<=l)g=m;else{const{pageId:e,lastViewTime:t,lastExitTime:o,omittedUserIds:i,...r}=m,a=(0,c.qP)(r).map((e=>{let[t,o]=e;return[t,o.getVisitedAt()??0]}));g={pageId:e,omittedUserIds:i,lastViewTime:void 0,lastExitTime:void 0};const s=n().sortBy(a,(e=>{let[,t]=e;return-t})).slice(0,l);for(const[n]of s)g[n]=m[n]}a.state.pageId===m.pageId&&a.setState(g)}function y(e){const{block:t,pageVisits:o,currentState:i,omittedUserIds:n}=e,a={...i,pageId:t.id,omittedUserIds:[...i.omittedUserIds,...n]};for(const s of o){const{id:e,user_id:o}=s;o in a||(a[o]=g.t1.createChildStore(t,{table:l.UI,id:e,spaceId:(0,r.CG)(t.pointer.spaceId)}))}return a}},19785:(e,t,o)=>{o.d(t,{zw:()=>s,hh:()=>l,nO:()=>c,hr:()=>d,jG:()=>p,SH:()=>u,rS:()=>m});var i=o(1144),n=o(65598),r=o(9953),a=o(30149);const s=e=>{const{childStore:t,parentStore:o,transaction:i}=e,n=t.getRecordStoreAtRootPath().getValue(),r=o.getParentBlockStore();if(r&&r.isCollectionViewPageWithContent())return p({parentStore:r,childStore:t,transaction:i}),!0;if(n){const{parent_id:e,parent_table:r,alive:s}=n;if(e!==o.id||r!==o.table||!s)return a.applyOperation({store:o,operation:{pointer:t.pointer,path:[],command:"setParent",args:{parentId:o.id,parentTable:o.table}},transaction:i}),!0}return!1},l=e=>{const{childStore:t,transaction:o}=e;if((0,n.NZ)(t)){const e=t,i=e.getAssociatedCollectionStore();if(null!=i&&i.isPageTreeCollection()){const i=t.getParentBlockStore();i&&d({childStore:e,parentStore:i,transaction:o})}}t.getRecordStoreAtRootPath().getKeyStore("alive").getValue()&&r.sW({store:t,data:{alive:!1},transaction:o})},c=e=>{const{pageStore:t,transaction:o}=e;t.getRecordStoreAtRootPath().getKeyStore("alive").getValue()&&r.sW({store:t,data:{alive:!1},transaction:o})},d=e=>{const{childStore:t,parentStore:o,transaction:n}=e,r=(0,i.A6)(o.table,t.table);if(!r)throw new Error(`Could not find child path for parent table ${o.table} and child table ${t.table}`);a.applyOperation({store:o,operation:{pointer:o.pointer,path:r,command:"removeChild",args:{id:t.id}},transaction:n})},p=e=>{const{childStore:t,parentStore:o,transaction:n}=e,r=(0,i.A6)(o.table,t.table);if(!r)throw new Error(`Could not find child path for parent table ${o.table} and child table ${t.table}`);a.applyOperation({store:o,operation:{pointer:o.pointer,path:r,command:"insertChildrenAfter",args:{ids:[t.id],after:e.after}},transaction:n})},u=e=>{const{childStore:t,parentStore:o,transaction:n}=e,r=(0,i.A6)(o.table,t.table);if(!r)throw new Error(`Could not find child path for parent table ${o.table} and child table ${t.table}`);a.applyOperation({store:o,operation:{pointer:o.pointer,path:r,command:"insertChildrenBefore",args:{ids:[t.id],before:e.before}},transaction:n})},m=function(e){const{parentStore:t,oldChildStore:o,newChildStore:i,transaction:n}=e,r=o.id;(t.getValue()||[]).indexOf(r)>=0&&(p({parentStore:t,childStore:i,transaction:n,after:r}),d({parentStore:t,childStore:o,transaction:n}))}},19358:(e,t,o)=>{o.d(t,{YM:()=>m,D0:()=>g,If:()=>h});var i=o(73360),n=o(18844),r=o(21202),a=o(6287),s=o(70279),l=o(90468),c=o(77858),d=o(29369),p=o(66079),u=o(9953);function m(e){const{childStore:t,parentStore:o,transaction:i}=e,n=t.getRecordStoreAtRootPath().getValue();if(n){const{parent_id:r,parent_table:a,alive:s}=n;r===o.id&&a===o.table&&s===e.alive||u.sW({store:t,data:{parent_id:o.id,parent_table:o.table,alive:e.alive},transaction:i})}}function g(e){if((0,i.hL)(e.childStore.table)){const t=e.childStore;return function(e){const{childStore:t,parentStore:o,transaction:i}=e,u=t.getRecordStoreUIParent();if(o.table===l.bx&&t.table===r.iU||o.table===d.e0&&t.table===r.iU||o.table===p.dx&&t.table===c.zU||o.table===n.Xj&&t.table===r.iU)m({childStore:t,parentStore:o,alive:!0,transaction:i});else if(o.table===c.zU&&o.path&&"private_pages"===o.path[0]&&t.table===r.iU){const e=o.getRecordStoreUIParent().getSpaceStore();e&&m({childStore:t,parentStore:e,alive:!0,transaction:i})}else o.table===r.iU&&u&&u.table===c.zU&&u.path&&"private_pages"===u.path[0]?m({childStore:t,parentStore:o,alive:!0,transaction:i}):o.table!==r.iU&&o.table!==a.v&&o.table!==s.x_||!function(e){const t=e.getKeyStore("parent_id").getValue(),o=e.getKeyStore("parent_table").getValue(),i=e.getRecordStoreUIParent();if(void 0===t)return!0;if(o===a.v)return!0;if(void 0!==i&&t===i.id&&o===i.table)return!0;return!1}(t)||m({childStore:t,parentStore:o,alive:!0,transaction:i})}({...e,childStore:t})}{const{childStore:t,parentStore:o,transaction:i}=e,{parent_id:n,parent_table:r}=t.getValue()||{};n===o.id&&r===o.table||u.sW({store:t,data:{parent_id:o.id,parent_table:o.table},transaction:i})}}function h(e){const{childStore:t,parentStore:o,transaction:i}=e,{parent_id:n,parent_table:r,alive:a}=t.getValue()||{},s=o.table===c.zU&&o.path&&"private_pages"===o.path[0]&&a,l=n===o.id&&r===o.table&&a;(s||l)&&u.sW({store:t,data:{alive:!1},transaction:i})}},87420:(e,t,o)=>{o.d(t,{bA:()=>k,Af:()=>C,jG:()=>_,E5:()=>M,xv:()=>I,ME:()=>P,Om:()=>x,Xd:()=>B});var i=o(50906),n=o(94419),r=o(5978),a=o(74647),s=o(30149),l=o(39865),c=o(28020),d=o(78316),p=o(84210),u=o(79315),m=o(10161),g=o(22294),h=o(88923),f=o(86486),v=o(27724),y=o(7755),b=o(29370),S=o(24666),w=o(37181);function k(e,t){const{mode:o,showMoveTo:i}=t,n=e.WindowSizeStore.state.width,r=h.default.state.preferredSidePeekWidth||n/2,s=function(e,t){const o=m.default.checkGate("quick_capture_global_mini_peek");if(!(e!==h.PeekModeMini||t&&o))return h.PeekModeCenter;return e}(o,i);h.default.setState({...h.default.state,open:!0,preferredSidePeekWidth:Math.min(r,n/1.5),isOpening:!0,isClosing:!1,...t,mode:s}),s===h.PeekModeSide&&a.toggleLeftSidebarByWindowSize(e)}function C(e){const{resultsStore:t,collectionContextStore:o}=e;h.default.setState({...h.default.state,resultsStore:t,collectionContextStore:o})}function _(e){(h.default.isSidePeekOpen()||h.default.isCenterPeekOpen()||h.default.isMiniPeekOpen())&&T(e)}function M(e){h.default.isSidePeekOpen()&&T(e)}function T(e){c.kw.state&&!g.Z.state.isKeyboardMode||f.default.state.isOpen&&f.default.state.menuIsOpen||v.default.isSelected()||S.default.hasSelection()||I(e,"empty_space_click")}function I(e,t){const o=h.default.state;if(!o.open||o.isClosing)return;h.default.isSidePeekOpen()&&(h.default.setState({...o,isClosing:!0}),x({environment:e,seen:!0}));const{target:a,showMoveTo:c,savedSelectionStoreState:d,savedTableSelectionStoreState:m,savedSidebarExpandedStoreState:g}=o,f=c&&a.isEmptyTitle()&&a.isEmptyPage();s.createAndCommit({userAction:"PeekRenderer.close",environment:e,perform:t=>{const r=a.getContentStores(),s=r[0];1===r.length&&s&&s.isEmptyEditableBlock()&&n.Od({parent:a.getContentStore(),childToRemove:s,transaction:t}),f&&(l.y8({environment:e,blocks:[o.target],transaction:t}),t.postSubmitCallbacks.push((t=>{t||i.trackBlockAction(e,{analyticsName:"delete",from:"peek_actions",block_id:a.id,block_type:"page"})})))}}),t&&i.trackCloseSidePeek(e,{from:t}),r.resetPeekState(e),r.resetSidebarState(e),r.resetEditorState(e),v.default.setState({...v.default.state,...d}),m.isActive&&b.Z.setState(m),g&&y.gV.set(!0);const{mainEditorCurrentBlockStore:S}=u.default.state,{RouterStore:w}=e,k=w.state.route;if(S&&"page"===k.name){const t=(0,p.ZP)({store:S,fullyQualified:!1,scrollToBlockId:k.scrollToBlockId,collectionViewId:k.collectionViewId,discussionId:k.discussionId,showMoveTo:k.showMoveTo,saveParent:k.saveParent});r.navigate({environment:e,url:t})}}function P(){const e=h.default.state;e.open&&!e.isClosing&&h.default.setState({...e,open:!1,resultsStore:void 0,collectionContextStore:void 0})}function x(e){const{environment:t,seen:o}=e,{currentUserSettingsStore:i}=u.default.state;i&&s.createAndCommit({userAction:"peekActions.setSeenPeekModeIntroTooltip",environment:t,perform:e=>{w.d2({userSettingsStore:i,transaction:e,data:{seen_peek_mode_tooltip:o}})}})}function B(e){const{collectionContextStore:t,resultsStore:o}=e;(0,d.YG)(null==t?void 0:t.collectionViewStore())||C({collectionContextStore:t,resultsStore:o})}},10279:(e,t,o)=>{o.d(t,{hs:()=>j,u9:()=>J,n_:()=>G,GQ:()=>q,MX:()=>W,Kh:()=>K,Pk:()=>z,ep:()=>O});var i=o(96486),n=o.n(i),r=o(1302),a=o(66897),s=o(24211),l=o(26825),c=o(27006),d=o(4615),p=o(77420),u=o(84683),m=o(90468),g=o(29369),h=o(19889),f=o(94044),v=o(64684),y=o(97880),b=o(5366),S=o(15010),w=o(33929),k=o(98165),C=o(67669),_=o(65598),M=o(38755),T=o(21115),I=o(23537),P=o(79315),x=o(3815),B=o(78291),Z=o(50906);function E(e){let{store:t,newItems:o}=e;const i=e=>`${e.type}:${l.D3(e)}`,r=t.getPermissionItems(),a=n().keyBy(r,i),s=C.YO(t).map((e=>e.permissionItem)),c=n().keyBy(s,i);return o.map((e=>{var t,o;const n=i(e),r=null===(t=a[n])||void 0===t?void 0:t.role;return{newItem:e,role_old_inherited_or_most_permissive:null===(o=c[n])||void 0===o?void 0:o.role,role_old_on_page:r}}))}var R=o(54642),A=o(47307),D=o(9953),F=o(21325),L=o(57688),V=o(30149);const N=(0,b.defineMessages)({preventFullPageAccessDeletion:{id:"permissionsActions.preventRemovingAllFullAccess.message",defaultMessage:"Please give someone else Full Access before removing this permission.",description:"A warning that appears when a user is the only person with full admin access to a page and they attempt to remove their own admin permissions. We need the user to give admin permissions to at least one other person before they can remove their own permissions."},preventUserOrGroupDeletion:{id:"permissionsActions.preventUserOrGroupDeletion.message",defaultMessage:"At least one person or group must have access.",description:"A warning that appears when a top-level page has only a workspace permission left, and no users or groups."},confirmUpgradeMessage:{defaultMessage:"To add members to your workspace, you need to switch it to the Team plan. You will be charged a prorated amount based on your current billing interval and account balance.",id:"permissions.confirmDialog.upgradeToTeamWorkspace.message"},confirmUpgradeButtonLabel:{defaultMessage:"Upgrade to Team workspace",id:"permissions.confirmDialog.upgradeToTeamWorkspace.confirmButton.label"}});function O(e){const{environment:t,store:o,permissionItems:i,transaction:a,from:s,skipAnalytics:d,pagePermissionChangeLocation:p}=e;if((0,C.Kz)(e))return!1;if(!o.isDefined())return!1;const u=o.getPermissionItems();let g=[...u];const{id:h}=t.currentUser,f=o instanceof x.H2,b=o instanceof x.G&&o.getParentTable()===m.bx,S=o instanceof x.G&&(b||o.isRestricted());d||(o instanceof x.G?function(e){let{environment:t,location:o,inSudoMode:i,store:n,newItems:r}=e;E({store:n,newItems:r}).forEach((e=>{let{role_old_inherited_or_most_permissive:n,role_old_on_page:r,newItem:a}=e;Z.trackUpdatePagePermission(t,{...a,location:o,in_sudo_mode:i||void 0,role_old_inherited_or_most_permissive:n,role_old_on_page:r})}))}({environment:t,store:o,newItems:i,location:p,inSudoMode:a.useSudoMode}):i.forEach((e=>{f?Z.trackUpdateSpacePermission(t,e,{from:s}):o instanceof x.zX?Z.trackUpdateTeamPermission(t,{item:e,teamStore:o}):(0,y.t1)(o)}))),g=g.filter((e=>!i.some((t=>l.Kf(e,t)))));for(const n of i)g.push(n);g=g.filter((e=>"none"!==c.cY(e)));const _=Boolean(i.find((e=>"user_permission"===e.type&&e.user_id===h&&!c.zz(e.role))));if(o instanceof x.G&&S&&h){const e=k.Pj(o),t=e?(0,M.jv)(e):[],n=e?e.getPermissionGroups():[],r=Boolean(g.find((e=>"user_permission"===e.type&&c.zz(e.role)&&e.user_id===h))),s=k.VP(o),l=null==s?void 0:s.getMembers(),d=void 0!==l&&(0,v.pd)({membership:l},h),p=e&&s&&(0,I.AL)({teamStore:s,spaceStore:e,userId:h}),u=t.find((e=>"user_permission"===e.type&&e.user_id===h)),m=i.find((e=>"space_permission"===e.type&&c.zz(e.role))),f=i.find((e=>"space_permission"===e.type&&c.YX(e.role))),y=i.find((e=>"space_permission"===e.type&&!c.YX(e.role))),b=g.find((e=>Boolean("group_permission"===e.type&&c.zz(e.role)&&n.find((t=>Boolean(t.id===e.group_id&&t.user_ids&&t.user_ids.indexOf(h)>=0)))))),S=(0,I.bq)();if(e&&e.canEdit()&&!S){const t=e.getPagesStore();f?V.applyOperation({transaction:a,store:t,operation:{pointer:t.pointer,path:t.path,command:"listAfter",args:{id:o.id}}}):y&&V.applyOperation({transaction:a,store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:o.id}}})}if(!S&&r&&u&&(m||b)&&(g=g.filter((e=>!("user_permission"===e.type&&e.user_id===h)))),!_){g.some((e=>!("space_permission"!==e.type||!c.zz(e.role)||!u)||(!("user_permission"!==e.type||!c.zz(e.role)||e.user_id!==h)||(!("group_permission"!==e.type||!c.zz(e.role)||!n.find((t=>Boolean(t.id===e.group_id&&t.user_ids&&t.user_ids.indexOf(h)>=0))))||(!!((0,c.zU)(e)&&c.zz(e.role)&&(null==s?void 0:s.id)===e.team_id&&p)||!!((0,c.LW)(e)&&c.zz(e.role)&&(null==s?void 0:s.id)===e.team_id&&d))))))||a.useSudoMode||(g=g.filter((e=>!("user_permission"===e.type&&e.user_id===h))),g.push({type:"user_permission",user_id:h,role:"editor"}))}}if(!g.some((e=>{const t=c.cY(e);return c.zz(t)}))&&(f||S))return r.default.afterNextFlush((()=>{A.showErrorMessage(w.default.formatMessage(N.preventFullPageAccessDeletion))})),!1;const T=g.some((e=>(c.jg(e)||c.hV(e))&&"editor"===e.role));if((0,I.bq)()&&b&&!T)return r.default.afterNextFlush((()=>{A.showErrorMessage(w.default.formatMessage(N.preventUserOrGroupDeletion))})),!1;const P=(0,x.Vh)(o,o.pointer,"permissions"),B=[];for(const n of u){!g.find((e=>l.Kf(n,e)))&&c.C2(n)&&B.push({...n,role:"none"})}for(const r of g){const e=u.find((e=>l.Kf(r,e)));!c.C2(r)||e&&n().isEqual(e,r)||B.push(r)}let R=[];const D=k.Om(o);if(o instanceof x.G&&!o.isRestricted()&&D&&D instanceof x.G){const e=(0,C.YO)(D);R=B.map((t=>e.find((e=>n().isEqual(e.permissionItem,t)))?{...t,role:"none"}:t))}else R=B;for(const n of R)V.applyOperation({store:P,operation:{pointer:P.pointer,command:"setPermissionItem",path:P.path,args:n},transaction:a});return a.postSubmitCallbacks.push((async e=>{e||await F.bi(t)})),!0}function U(e){var t;const{environment:o,store:i,permissionItems:n,transaction:r,inviteFlowId:a,inviteMessage:s,inviteOrigin:l}=e,c=null===(t=P.default.state.currentSpaceStore)||void 0===t?void 0:t.id,{id:d}=o.currentUser;for(const p of n)if(c&&"user_permission"===p.type&&p.invite_id){const{inviteeId:e,inviteeTable:t}=H({item:p,spaceId:c}),o={id:p.invite_id,version:1,flow_id:a,space_id:c,target_id:i.id,target_table:i.table,inviter_id:d,inviter_table:h.KJ,invitee_id:e,invitee_table_or_group:t,message:s,created_time:Date.now(),attributes:{permission:p,origin_type:l}};D.sW({store:(0,x.Kv)(i,{table:"invite",id:o.id,spaceId:c}),data:o,transaction:r})}return!0}function H(e){const{item:t,spaceId:o}=e;return c.jg(t)?{inviteeId:t.user_id,inviteeTable:h.KJ}:c.FB(t)?{inviteeId:t.bot_id,inviteeTable:p.cZ}:c.hV(t)?{inviteeId:t.group_id,inviteeTable:u._e}:c.ix(t)?{inviteeId:o,inviteeTable:m.bx}:c.zU(t)?{inviteeId:t.team_id,inviteeTable:g.e0}:{}}function z(e){const{environment:t,store:o,permissionItem:i,transaction:n,shouldInherit:r}=e;if(!o.isDefined())return;const s=[];if(r){const e=(0,C.YO)(o).map((e=>e.permissionItem)).filter((e=>!l.Kf(e,i)));for(const t of e)c.C2(t)&&(o.isCollectionView()||!c.WY(t.role)||c.FB(t)?s.push(t):s.push({...t,role:"read_and_write"}))}const d=t.currentUser.id,p=d?o.getRecordValue({table:h.KJ,id:d}):void 0,u=p&&(0,a.dp)(p),m=k.fJ(o);!d||l.ZO({actor:u,ancestors:m,updatedPermissionItem:i})||n.useSudoMode||s.push({type:"user_permission",user_id:d,role:"editor"}),s.push(i);const g=o.getPermissionItemsStore();for(const a of s)V.applyOperation({store:g,operation:{pointer:g.pointer,command:"setPermissionItem",path:g.path,args:a},transaction:n});V.applyOperation({store:g,operation:{pointer:g.pointer,command:"setSingletonPermissionItem",path:g.path,args:{singletonPermissionItem:{type:"restricted_permission"},set:!0}},transaction:n}),Z.trackRestrictPermissions(t,{type:"none"===i.role?"remove":"narrow"}),n.postSubmitCallbacks.push((e=>{e||F.bi(t)}))}function W(e){const{environment:t,store:o,transaction:i}=e;if(!o.isDefined())return;const n=o.getPermissionItems(),r=k.Om(o),a=r?l.Wo(k.fJ(r)):[],s=l.Ub(o.getModel(),n,a),c=o.getPermissionItemsStore();for(const l of s)V.applyOperation({store:c,operation:l,transaction:i});Z.trackRestorePermissions(t,{using_admin_api:!1}),i.postSubmitCallbacks.push((e=>{e||F.bi(t)}))}async function j(e){const{environment:t,store:o}=e,{currentSpaceStore:i}=P.default.state;if(i){const e=i.id,n=o.id,r=await R.spaceAdminRestoreAccess(t,{spaceId:e,blockId:n});Z.trackRestorePermissions(t,{using_admin_api:!0}),"failed"===r.type&&A.showError(r)}}function K(e){const{environment:t,store:o,transaction:i}=e,n=o.getPermissionItems();if(!o.isTopLevelTeamPage()||0===n.length)return;const r=n.filter((e=>c.FB(e)));D.sW({store:o,transaction:i,data:{permissions:r}}),Z.trackRestoreTeamPermissions(t,{store:k.VP(o)})}function Y(e){const t=e.inviteTargets[0];return!(!t||"bot"!==t.type)}async function G(e){const{environment:t,isOnboarding:o,invite:i}=e;if(0===e.inviteTargets.length)return{success:!0,invitedUsers:{}};const{data:n}=B.default.state;let r;if(Y(e))if((0,_.Mm)(e.store)){const t=e.inviteRole;r=e.inviteTargets.map((e=>({type:"bot_permission",role:t,bot_id:e.value.id})))}else(0,_.NZ)(e.store)?r=e.inviteTargets.map((e=>({type:"bot_permission",role:l.uH(e.value.capabilities),bot_id:e.value.id,parent_table:e.value.parent_table,parent_id:e.value.parent_id}))):(0,y.t1)(e.store);else r=await async function(e){const{environment:t,inviteTargets:o,inviteRole:i}=e;return Promise.all(o.map((async o=>{if("newUser"===o.type){const e=await X(t,o);return{type:"user_permission",role:i,user_id:e}}if("existingUser"===o.type){return{type:"user_permission",role:e.inviteRole,user_id:o.value.id}}if("group"===o.type){return{type:"group_permission",role:e.inviteRole,group_id:o.value.id}}(0,y.t1)(o)})))}({environment:t,inviteTargets:e.inviteTargets,inviteRole:e.inviteRole,data:n});var a;Y(e)||Z.trackEmailInvite(t,{role:e.inviteRole,is_space:e.store instanceof x.H2,invite_targets:e.inviteTargets,is_onboarding:e.isOnboarding,invite_origin:i.inviteOrigin,permission_items:r,invite_message_length:(null===(a=i.inviteMessage)||void 0===a?void 0:a.length)??0,isProfessionalTeamUser:(0,S.QZ)(),domainType:(0,S.JF)()});let s;e.store instanceof x.G&&T.He()?s=await async function(e){const{environment:t,store:o,permissionItems:i,invite:n}=e,{currentSpaceStore:r}=P.default.state;if(!r)return!1;if(!r.isDefined())return!1;const a=i.filter(c.jg).map((e=>({...e,invite_id:(0,d.ZP)()})));if("failed"===(await R.inviteGuestsToSpace(t,{block:{id:o.id,spaceId:r.id},permissionItems:a})).type)return!1;const{serverCommitResult:s}=V.createAndCommit({userAction:"permissionsActions.saveInvites",environment:t,perform:e=>{const{inviteFlowId:i,inviteMessage:r,inviteOrigin:s}=n;U({environment:t,store:o,permissionItems:a,transaction:e,inviteFlowId:i,inviteMessage:(0,f.my)(r),inviteOrigin:s})}});await s;const l=i.filter(c.FB);l.length>0&&await $({environment:t,store:o,permissionItems:l,invite:n});return!0}({environment:t,store:e.store,permissionItems:r,invite:i}):(await $({environment:t,store:e.store,sudoModeStore:e.sudoModeStore,permissionItems:r,invite:i}),s=!0),o||await F.bi(t);const p={};return e.inviteTargets.forEach(((e,t)=>{var o;const i=r[t];"newUser"!==e.type&&"existingUser"!==e.type||null===(o=e.value)||void 0===o||!o.email||"user_permission"!==i.type||(p[e.value.email]=i.user_id)})),{success:s,invitedUsers:p}}async function X(e,t){const o=(0,s.E2)(w.default.getIntl()),i=t.value.email,n=await R.createEmailUser(e,{email:i,preferredLocaleOrigin:"inferred_from_inviter",preferredLocale:o});if("failed"===n.type)throw A.showErrorMessage(n.error.message),n.error;return n.data.userId}async function q(e){let{environment:t,store:o,inviteTargets:i,inviteRole:n,createNewTeamFlowId:r}=e;const a=o.getSpaceId(),s=t.currentUser.id;if(0===i.length)return!0;if(!a||!s)return!1;const{data:l}=B.default.state,c=await async function(e){const{environment:t,inviteTargets:o,inviteRole:i}=e;return Promise.all(o.map((async e=>{if("newUser"===e.type){const o=await X(t,e);return{entity_type:"user",type:i,user_id:o}}return"existingUser"===e.type?{entity_type:"user",type:i,user_id:e.value.id}:"group"===e.type?{entity_type:"group",type:"member",group_id:e.value.id}:void(0,y.t1)(e)})))}({environment:t,inviteTargets:i,inviteRole:n,data:l}),d=await L.Uj({environment:t,teamMemberInfos:c,teamStore:o,isSettingDefaultTeam:!1,createNewTeamFlowId:r});return d&&await F.bi(t),d}async function $(e){const{environment:t,store:o,sudoModeStore:i,permissionItems:n,invite:r}=e,{serverCommitResult:a}=V.createAndCommit({userAction:"permissionsActions.savePermissionItems",environment:t,useSudoMode:"block"===o.table&&(null==i?void 0:i.shouldSaveTransactionWithSudoMode(o)),perform:e=>{const i=n.map((e=>"user_permission"!==e.type?e:{...e,invite_id:(0,d.ZP)()})),{inviteFlowId:a,inviteMessage:s,inviteOrigin:l}=r;U({environment:t,store:o,permissionItems:i,transaction:e,inviteFlowId:a,inviteMessage:(0,f.my)(s),inviteOrigin:l}),O({environment:t,store:o,permissionItems:i,transaction:e,from:l})}});await a}const J=function(e){const{store:t,transaction:o}=e;D.sW({store:t,data:{permissions:null},transaction:o})}},30147:(e,t,o)=>{o.r(t),o.d(t,{performPrefetchRequests:()=>a});var i=o(80984),n=o(95477),r=o(66430);function a(e){let{environment:t,currentUserId:o}=e;const a=new r.vH(t.device),s=(0,i.Wj)({url:ncd.href(),isMobile:t.device.isMobile,baseUrl:n.Z.domainBaseUrl,publicDomainName:n.Z.publicDomainName,protocol:n.Z.protocol,currentUrl:ncd.href()});return"page"===s.name&&(0,r.jZ)({prefetchCache:a,environment:t,activeUserId:o,data:{page:{id:s.blockId,spaceId:void 0},limit:r.OZ,cursor:{stack:[]},chunkNumber:0,verticalColumns:t.device.isMobile}}),a}},31304:(e,t,o)=>{o.d(t,{v:()=>k,_:()=>C});var i=o(96486),n=o.n(i),r=o(18466),a=o(65917),s=o(2911),l=o(75189),c=o(44615),d=o(63143),p=o(36054),u=o(41641),m=o(95477),g=o(2688),h=o(85844),f=o(3815),v=o(27724),y=o(24666),b=o(54642);const S=1*d.U6,w="presenceActions";function k(e,t){const{persistAutoListener:o,rootStore:i,isActive:n,listenerReference:r,userId:l}=e.state;if(n){if(o&&o.destroy(),r&&g.Z.removeListener(r,t),l&&i&&T({userId:l,rootStore:i})){const e=(0,c.T0)(i.id);g.Z.updateField(e,l,{present:!1},S,t),b.recordPageExit(t,{block:{id:i.id,spaceId:i.getSpaceId()},timestamp:Date.now()}),g.Z.clearOnDisconnect(e,w,t).catch((e=>{a.log({level:"error",from:"destroyPresence",type:"SystemError",error:(0,s.Ui)(e)})}))}e.reset()}}async function C(e){const{userId:t,rootStore:o,presenceStore:i,environment:a}=e;if(await o.load(),M({userId:t,rootStore:o})){i.setState({...i.state,isActive:!0,rootStore:o,userId:t});const e=n().throttle((()=>{i&&i.state.isActive&&i.state.rootStore===o&&_(i,a)}),1e3),s=(e,t)=>{i&&i.state.isActive&&i.state.rootStore===o&&function(e,t){const{remotePresenceData:o}=t.state,i=e||{};n().isEqual(o,i)||t.setState({...t.state,remotePresenceData:i})}(function(e){const t={};if(n().isObject(e)){const o=Object.keys(e);for(const i of o){const o=e[i];o&&!(0,p.Gu)(l.uP,o)&&(t[i]=o)}}return t}(t),i)},d=(0,c.T0)(o.id),u=g.Z.addListener(d,s,void 0,a);i.setState({...i.state,persistAutoListener:new r.Z({onChange:e}),listenerReference:u}),t&&T({userId:t,rootStore:o})&&await g.Z.onDisconnect(d,[{operation:"updateField",key:d,field:t,updates:{present:!1},ttl:S},{operation:"logPageExit",userId:t,blockId:o.id,spaceId:o.getSpaceId()}],w,a),_(i,a)}}function _(e,t){const{persistAutoListener:o,rootStore:i,userId:n}=e.state;if(o&&o.startListener({incrementCycle:!0}),!i||!T({userId:n,rootStore:i}))return;let r;if(n&&i.canEdit()){var a,s;let e;const t=v.default.state;t.stores.length&&(e=t.stores[0]);const o=y.default.state,l="editing"===o.mode&&o.multiSelection;l&&i.uiContains(l.start.store)&&"block"===l.start.store.table&&(e=l.start.store),e||t.pivot&&(e=t.pivot);const c=null===(a=e)||void 0===a?void 0:a.findRecordStoreUIAncestors((e=>e instanceof f.G)).map((e=>e.id)),p=d.ud(Date.now());r={userId:n,present:h.Z.state.isVisible,activityTimestampNearestMinuteMs:p,blockId:(null===(s=e)||void 0===s?void 0:s.id)||null,blockPath:c||null}}if(o&&o.stopListener({isEndOfCycle:!0}),r){const e=(0,c.T0)(i.id);n&&g.Z.updateField(e,n,r,S,t)}}function M(e){const{userId:t,rootStore:o}=e;return Boolean(o)&&(0,u.Z)(o.id)&&o.canEdit()&&t}function T(e){const{userId:t,rootStore:o}=e;return M({userId:t,rootStore:o})&&!m.Z.isAdminMode}},68882:(e,t,o)=>{o.d(t,{C:()=>U,V:()=>H});var i=o(77094),n=o.n(i),r=o(67294),a=o(26263),s=o(99036),l=o(74229),c=o(4615),d=o(70203),p=o(97880),u=o(81954),m=o(3779),g=o(5366),h=o(50906),f=o(55332),v=o(64964),y=o(33929),b=o(60709),S=o(31945),w=o(12508),k=o(73420),C=o(73063),_=o(1743),M=o(74194),T=o(78140),I=o(72495),P=o(64369),x=o(6854);const B=(0,g.defineMessages)({submitFeedbackButtonLabel:{id:"aiAutofill.feedbackPopup.submitFeedbackButtonLabel",defaultMessage:"Submit feedback",description:"Accessibility label for a button that submits the user's feedback for their Notion AI output"},feedbackInputPlaceholder:{id:"aiAutofill.feedbackPopup.feedbackInputPlaceholder",defaultMessage:"How could the output be improved? (optional)",description:"Placeholder text for user input to gather extra feedback on Notion AI's output"}});const Z=function(e){let{environment:t,inferenceId:o,feedbackType:i,setKeepSnackbarOpen:a,children:s}=e;window.__c={n:"AiAutofillSnackbarFeedbackPopupButton"};const[l,c]=(0,r.useState)(""),[d,p]=(0,r.useState)(!0),u=(0,r.useCallback)((()=>{H({environment:t,inferenceId:o,feedbackType:i,userContent:l,shareWithNotion:d})}),[t,o,i,l,d]),h=(0,r.useCallback)((()=>{p(!d)}),[d]);return n()(S.Z,{popupType:S.Z.PopupType.Popup,originGap:12,placementToOrigin:S.Z.Placement.Top,alignmentToOrigin:S.Z.Alignment.Center,onClick:a,renderOrigin:e=>r.createElement(x.Pn,e,s),render:e=>n()(_.Z,{capture:!0,allowEsc:!0},void 0,n()(T.Z,{menuType:b.og.Popup,width:320},void 0,n()(I.Z,{style:{padding:8}},void 0,n()(M.Z,{textarea:!0,placeholder:y.default.formatMessage(B.feedbackInputPlaceholder),value:l,onChange:e=>{c(e.target.value)}})),n()(I.Z,{style:{padding:8}},void 0,n()(k.X2,{gap:8,alignItems:"center",justifyContent:"space-between"},void 0,n()(k.X2,{gap:4,alignItems:"center"},void 0,n()(w.Z,{checked:d,onClick:h,size:14}),n()("div",{onClick:h},void 0,n()(P.Z,{style:{cursor:"pointer"},isSmall:!0},void 0,n()(g.FormattedMessage,{defaultMessage:"Share AI instruction and outputs with Notion",id:"aiAutofill.feedbackPopup.shareWithNotion",description:"Label for checkbox indicating user's permission to share the contents of their AI interaction with Notion."})))),n()(C.Z,{icon:m.Z.sendArrow,onClick:()=>{u(),e.close()},ariaLabel:y.default.formatMessage(B.submitFeedbackButtonLabel),isBlue:!0,iconStyle:{height:24,width:24},style:{height:20,width:20}})))))})};var E=o(68785);const R=function(e){let{environment:t,inferenceId:o,progressStore:i}=e;const{numBlocksToAutofill:a,numBlocksAutofilled:s,propertySchema:{name:l},collectionId:c,sessionId:d}=(0,u.VK)((()=>i.state),[i]),p=(0,r.useCallback)((()=>{v.z1()}),[]),y=(0,r.useCallback)((()=>{h.trackAiAutofillAction(t,{type:"undo_from_snackbar",inference_id:o,collection_id:c,session_id:d}),f.Yw(t,!0),v.rN()}),[c,t,o,d]);return s===a?n()(k.X2,{gap:4,alignItems:"center"},void 0,m.Z.thinCheck({width:16}),n()(g.FormattedMessage,{defaultMessage:'AI updated "{propertyName}" on {numPages, plural, one {1 page} other {# pages}}',id:"snackbar.aiAutofill.autofillInProgress",description:"Message about database properties being filled with Notion AI",values:{propertyName:l,numPages:a}}),!t.device.isMobile&&n()(k.X2,{alignItems:"center",gap:4},void 0,n()(Z,{environment:t,inferenceId:o,feedbackType:"thumbsup",setKeepSnackbarOpen:p},void 0,m.Z.thumbUp({width:16})),n()(Z,{environment:t,inferenceId:o,feedbackType:"thumbsdown",setKeepSnackbarOpen:p},void 0,m.Z.thumbDown({width:16}))),n()(x.Pn,{onClick:y},void 0,n()(g.FormattedMessage,{defaultMessage:"Undo",id:"snackbar.aiAutofill.undo",description:"Button to undo Notion AI filling database properties"})),n()(x.Pn,{onClick:()=>{v.rN()}},void 0,n()(g.FormattedMessage,{defaultMessage:"Close",id:"snackbar.aiAutofill.close",description:"Button to close the snackbar notifying user of Notion AI filling database properties"}))):n()(k.X2,{gap:4,alignItems:"center"},void 0,n()(E.Z,{}),n()(g.FormattedMessage,0===s?{defaultMessage:'AI updating "{propertyName}" on {numPages, plural, one {1 page} other {# pages}}',id:"snackbar.aiAutofill.autofillStarting",description:"Message about database properties being filled with Notion AI",values:{propertyName:l,numPages:a}}:{defaultMessage:'AI updated "{propertyName}" on {numFilledPages} of {numTotalPages} pages',id:"snackbar.aiAutofill.completedAutofill",description:"Message confirming that all selected page properties have been filled with Notion AI",values:{propertyName:l,numFilledPages:s,numTotalPages:a}}),n()(x.Pn,{onClick:y},void 0,n()(g.FormattedMessage,{defaultMessage:"Undo & stop",id:"snackbar.aiAutofill.undoAndStop",description:"Button to stop filling database properties with Notion AI and undo all changes"})))};var A=o(1310),D=o(12318),F=o(54642),L=o(47307),V=o(9953),N=o(30149);function O(e){let{environment:t,property:o,storesWithCompletions:i,useTemporaryStore:n}=e;N.createAndCommit({userAction:"BlockPropertyValue.handleActionButtonClick.aiAutofill",environment:t,canUndo:!Boolean(n),undoCheckpoint:!0,perform:e=>{for(const{store:t,temporaryStore:r,completion:a}of i){const i=n?r:t;V.sO({store:i.getPropertyStore(o),value:d.TP(a.trim()),transaction:e})}}})}async function U(e){let{environment:t,stores:o,property:i,propertySchema:r,userEventForAnalytics:d}=e;const u=(0,c.ZP)(),m=(0,c.ZP)(),g=i,f=o[0].getParentCollectionId(),y=new a.Z;h.trackAiAutofillAction(t,{type:d,inference_id:u,collection_id:f,session_id:m});const b=new D.default({propertySchema:r,collectionId:f,numBlocksToAutofill:o.length,numBlocksAutofilled:0,sessionId:m});v.oV({label:n()(R,{environment:t,progressStore:b,inferenceId:u}),durationMs:A.JY});try{t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(y);const e=o.map((e=>({spaceId:e.getSpaceId(),...e.pointer,propertyId:g})));if(!(0,p.Of)(e))throw new Error("No blocks to autofill");const i=(0,s.q3)(r);if(!i)throw new Error("Invalid property for autofill");const n=await F.getCompletionForProperty(t,{inferenceId:u,blockPropertyPointers:e,aiInference:i});if("success"!==n.type)throw L.showError(n),new Error("Failed to autofill property");const a=Object.fromEntries(o.map((e=>[e.pointer.id,{store:e,temporaryStore:e.clone(y),completion:""}])));if(l.H1.is(n.data))for await(const o of n.data){const e=a[o.blockPropertyPointer.id],i=e.completion+o.completion;a[o.blockPropertyPointer.id]={...e,completion:i},O({environment:t,property:g,storesWithCompletions:Object.values(a),useTemporaryStore:!0}),b.setState({...b.state,numBlocksAutofilled:Object.values(a).filter((e=>{let{completion:t}=e;return""!==t})).length})}t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(y),O({environment:t,property:g,storesWithCompletions:Object.values(a),useTemporaryStore:!1})}catch(S){t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(y)}}function H(e){const{environment:t,inferenceId:o,feedbackType:i,userContent:n,shareWithNotion:r}=e;h.trackAIAction(t,{type:"property_autofill",inference_id:o,feedback_type:i,timestamp:(new Date).toUTCString(),user_comment:n,share_with_notion:r})}},71978:(e,t,o)=>{o.d(t,{J:()=>I,I:()=>P});var i=o(66897),n=o(7406),r=o(65917),a=o(2911),s=o(63306),l=o(96486),c=o.n(l),d=o(99036),p=o(33728),u=o(26825),m=o(27006),g=o(90965);function h(e,t){if(f(e,t))return!0;return t&&(0,i.pu)(t),!1}function f(e,t){if(!t)return!1;if((0,i.z8)(t))return!1;const o=t.value;let n=!1;const r=e.email_domains||[],a=e.permissions||[];if(o&&o.email&&r){const e=(0,p.Gd)(o.email);n=c().includes(r,e)}return a.find((e=>"user_permission"===e.type&&e.user_id===o.id))&&(n=!0),n}function v(e){const{block:t,space:o,viewer:i}=e;if(!t)return;if(!f(o,i))return;const n=(0,u.uO)(t).filter((e=>"user_permission"===e.type&&(0,m.zz)(e.role))).map((e=>e.user_id));return 0!==n.length?n.find((e=>(0,g.kC)(o,e))):void 0}var y=o(45953),b=o(21202),S=o(6287),w=o(90468),k=o(19889),C=o(33929),_=o(45950),M=o(5659),T=o(54642);async function*I(e){const{environment:t,request:o}=e;if("block-space"===o.type){const e=await M.A.measure("loadPublicPageData",`block:${o.blockId} space:${o.spaceId}`,(()=>x(t,o)));"value"in e&&(yield e.value)}const i=await T.getPublicPageData(t,o);"success"===i.type?yield i.data:(r.log({level:"error",from:"publicPageDataActions",type:"loadPublicPageData",error:(0,a.Ui)(i.error)}),yield)}async function*P(e){const{environment:t,request:o}=e;if("block-space"===o.type){const e=await M.A.measure("loadPublicPageData",`block:${o.blockId} space:${o.spaceId}`,(()=>x(t,o)));"value"in e&&(yield e.value)}const i=await T.getPublicPageData(t,o);if("success"!==i.type)throw r.log({level:"error",from:"publicPageDataActions",type:"loadPublicPageDataUnsafely",error:(0,a.Ui)(i.error)}),i.error;yield i.data}async function x(e,t){if("block-space"!==t.type)return{error:Error("Shouldn't be looking for a non-block-space page")};const{blockId:o}=t,{id:r}=e.currentUser;if(o&&r){let t,l,c,p;try{const n=await _.yY({environment:e,recordPointers:[{table:b.iU,id:o},{table:k.KJ,id:r}],recurFn:(e,i,n)=>{const r=[];if(e===b.iU&&i===o&&n&&n.value&&(t=n.value),e===w.bx&&n&&n.value&&(l=n.value),e===S.v&&n&&n.value&&t&&t.parent_id===i&&(c=n.value),e===k.KJ&&n&&n.value&&(p=n.value),n&&n.value){const e=n.value;e.parent_id&&e.parent_table&&r.push(y.dr.getParentPointerFromRecordWithParent(e))}return r},recordIsRequired:()=>!0});if(t&&l&&p){const e=s.Wq({table:b.iU,id:o},n),r={table:k.KJ,value:p},a=Boolean(s.YL(e,r)),u=s.YP(e);return{value:function(e){const{block:t,space:o,spaceDomain:i,associatedCollectionValue:n,actor:r,userHasExplicitAccess:a,intl:s,requireInterstitial:l,requireLogin:c,publicAccessRole:p,publicHomePage:u}=e,m="none"!==p,g=f(o,r),y=n&&(a||m)?d.oC(n):void 0,b=n&&(a||m)?n.id:void 0,S=n&&n.format&&(a||m)?n.format:void 0;return{pageId:null==t?void 0:t.id,spaceName:o.name||s.formatMessage({id:"publicPageDataHelpers.untitledWorkspace.placeholder",defaultMessage:"Untitled Workspace"}),spaceId:o.id,spaceDomain:i,canJoinSpace:g,icon:o.icon,userHasExplicitAccess:a,ownerUserId:v({block:t,space:o,viewer:r}),collectionId:b,collectionSchema:y,collectionFormat:S,betaEnabled:o.beta_enabled,canRequestAccess:h(o,r),requireInterstitial:l,requireLogin:Boolean(c),publicAccessRole:p,publicHomePage:u}}({block:t,space:l,spaceDomain:void 0,associatedCollectionValue:c,actor:(0,i.dp)(p),userHasExplicitAccess:a,intl:C.default.getIntl(),requireInterstitial:void 0,publicAccessRole:u,publicHomePage:void 0})}}}catch(a){return{error:(0,n.tg)(a)}}}return{error:Error("No offline public page data found.")}}},9953:(e,t,o)=>{o.d(t,{ae:()=>d,j4:()=>p,sO:()=>u,sW:()=>m,nj:()=>g});var i=o(59730),n=o(4615),r=o(73360),a=o(45953),s=o(21202),l=o(3815),c=o(30149);function d(e){const{environment:t,table:o,value:i,transaction:s,inMemoryRecordCache:d}=e;i.id||(i.id=(0,n.ZP)());const p=i,u=r.mk.create(o,p),m=a.dr.fromRecordWithTable(u),g=l.t1.createUniqueRootStore(t,m,{userId:s.userId,inMemoryRecordCache:d});return c.applyOperation({store:g,operation:{pointer:g.pointer,path:[],command:"set",args:i},transaction:s}),g}function p(e){const{environment:t,type:o,properties:r,permissions:a,format:d,transaction:p,inMemoryRecordCache:m}=e,g=e.id||(0,n.ZP)(),h=e.spaceId||p.spaceId,f=new l.G(t,{table:s.iU,id:g,spaceId:h},{userId:p.userId,inMemoryRecordCache:m});return u({store:f,transaction:p,value:{type:o,permissions:a,properties:r,format:d,space_id:h}}),c.updateMetadataForTransaction({environment:t,transaction:p}),p.postPerformAssertions.push((function(){if(p.isLocal)return;if(!f.getParentStore())throw new i.p8(`Created block was not given a parent before being committed in transaction ${p.getUserActionForAnalyticsPurposesOnly()}`)})),f}const u=function(e){const{store:t,value:o,transaction:i}=e,n=t.path;c.applyOperation({store:t,operation:{pointer:t.pointer,path:n,command:"set",args:o||null},transaction:i})};function m(e){const{store:t,data:o,transaction:i}=e,n=t.path;c.applyOperation({store:t,operation:{pointer:t.pointer,path:n,command:"update",args:o},transaction:i})}function g(e){const{store:t,source:o,fileIds:i,transaction:n}=e,r=t.path;for(const a of i)c.applyOperation({store:t,operation:{pointer:t.pointer,path:r,command:"copyFile",args:{source:o,fileId:a}},transaction:n})}},4408:(e,t,o)=>{o.d(t,{Wl:()=>q,fL:()=>$,bG:()=>J,HB:()=>Q,uo:()=>ee,LK:()=>te});var i=o(27006),n=o(10484),r=o(98963),a=o(18844),s=o(21202),l=o(6359),c=o(44312),d=o(19639),p=o(73387),u=o(32161),m=o(82447),g=o(49953),h=o(14710),f=o(66726),v=o(30754),y=o(84683),b=o(80396),S=o(24836),w=o(86135),k=o(84323),C=o(83200),_=o(67627),M=o(65963),T=o(14130),I=o(34406),P=o(42314),x=o(16663),B=o(93646),Z=o(90468),E=o(96740),R=o(75990),A=o(57829),D=o(56877),F=o(47238),L=o(77858),V=o(53412),N=o(19889),O=o(98897),U=o(66079),H=o(58161),z=o(28182),W=o(35794),j=o(70203),K=o(44133),Y=o(68015),G=o(39218),X=o(54642);function q(e){const{environment:t,pointer:o,userId:n,inMemoryRecordCache:r,recordWithRole:a,force:l,maybeStaleRecordMap:c,updatePaths:d,debugSource:p}=e;"block"===o.table&&(0,K.setBlockIdDebugSource)(o.id,p);const u=n||t.currentUser.id,m=a&&a.value&&a.value.version,g=a&&a.role,h=r.getRole({pointer:o,userId:u}),f=r.getVersion({pointer:o,userId:u}),v="number"==typeof m&&m>f;if(l||v||g&&h!==g){let e=a;if(!l&&!v&&g&&function(e){const{oldRole:t,newRole:o}=e;if(!i.YX(o))return!1;if(t&&!i.J5(t))return!1;return!0}({oldRole:h,newRole:g})){const t=r.getRecord({pointer:o,userId:u});t&&(e={...t,role:g})}r.setRecord({pointer:o,userId:u},e);for(const t of d)r.emitRecord(o,t);if(e){if(o.table===s.iU&&e.value){const t=e.value;t.properties&&t.properties.title&&(t.properties.title=t.properties.title.map((e=>j.Y_(e))))}const n=t.defaultRecordCache.persistedRecordCache;n&&ne[o.table]&&n.set(o,e,function(e){const{environment:t,pointer:o,recordWithRole:n}=e,{id:r}=t.currentUser;if((o.table===N.KJ||o.table===U.dx||o.table===z.Sr)&&r===o.id)return oe;if(o.table===L.zU&&n.value&&n.value.parent_id===r)return ie;if(o.table===Z.bx&&(0,i.Jy)(n.role))return ie;return}({environment:t,pointer:o,recordWithRole:e}),u,c)}r===t.defaultRecordCache.inMemoryRecordCache&&Y.unsubscribeAfterDelay({pointer:o,userId:u,environment:t})}}function $(e){const{environment:t,userId:o,recordMap:i,inMemoryRecordCache:r,force:a,maybeStaleRecordMap:s,debugSource:l}=e,c=t.defaultRecordCache.persistedRecordCache;n.Us(i,(async e=>{let{pointer:i,value:n}=e,d=n;if(G.transactionQueue.isPendingTransactionForRecord(i)&&c){const e=await c.get(i,o||t.currentUser.id);e&&(d=e)}q({environment:t,inMemoryRecordCache:r,pointer:i,userId:o,recordWithRole:d,updatePaths:[[]],force:a,maybeStaleRecordMap:s,debugSource:l})}))}async function J(e){const{inMemoryRecordCache:t,pointer:o,userId:i,environment:n}=e,r=G.transactionQueue.isPendingTransactionForRecord(o),a=n.defaultRecordCache.persistedRecordCache;if(r)return a&&await a.get(o,i);let s,l;a&&(s=await a.get(o,i),s&&q({environment:n,inMemoryRecordCache:t,pointer:o,userId:i,recordWithRole:s,updatePaths:[[]],debugSource:"refreshAndReturnRecord (localResult)"}));try{const e=t.getEntry({pointer:o,userId:i}),r=e?e.value:void 0,a=e?e.pointer:void 0;l=await X.syncRecordValue(n,{userId:i,version:r&&r.value&&r.value.version?r.value.version:-1,pointer:a||o}),l&&q({environment:n,inMemoryRecordCache:t,pointer:o,userId:i,recordWithRole:l,updatePaths:[[]],debugSource:"refreshAndReturnRecord (remoteResult)"})}catch(c){console.error(c)}return l||s}async function Q(e){const{inMemoryRecordCache:t,pointer:o,userId:i,environment:n}=e,{defaultRecordCache:r}=n,a=await X.syncRecordValue(n,{pointer:o,userId:i,version:-1});a&&(ee({environment:n,inMemoryRecordCache:t,defaultRecordCache:r,pointer:o,userId:i}),q({environment:n,inMemoryRecordCache:t,pointer:o,userId:i,recordWithRole:a,updatePaths:[[]],debugSource:"forceFetchRemoteRecord"}))}function ee(e){const{inMemoryRecordCache:t,defaultRecordCache:o,pointer:i,userId:n}=e;t.deleteRecord({pointer:i,userId:n}),t.emitRecord(i,[]),o.persistedRecordCache&&o.persistedRecordCache.deleteRecord(i,n)}function te(e){const t=e.defaultRecordCache.inMemoryRecordCache;for(const{pointer:o}of t.data)Y.unsubscribeForAllUsers({pointer:o,environment:e});t.clearCache()}const oe=100,ie=50,ne={block:!0,notion_user:!0,space:!0,space_view:!0,user_root:!0,collection:!0,collection_view:!0,follow:!0,discussion:!0,comment:!0,user_settings:!0,slack_integration:!0,bot:!0,integration:!0,space_invite_link:!0,template_checklist:!0,page_visit:!0,page_exit:!0,[u.P]:!0,team:!0,[b.yo]:!0,activity:!1,notification:!1,access_request:!1,customer:!1,temporary_password:!1,password:!1,slack_notification:!1,snapshot:!1,credit:!1,used_credit:!1,space_recover_pages:!1,user_metadata:!1,saml_config:!1,experiment:!1,education_domain:!1,education_email:!1,public_email_domain:!1,user_data_consent_permissions:!1,token:!1,apple_token:!1,google_token:!1,firebase_token:!1,trello_token:!1,asana_token:!1,confluence_token:!1,evernote_token:!1,drive_token:!1,block_token:!1,bot_token:!1,integration_token:!1,csat_feedback:!1,subscription:!1,space_domain:!1,admin_api_log:!1,admin_api_op_log:!1,oauth_authorization_code:!1,mfa_settings:!1,[h.Dw]:!1,[H.t]:!1,[B.O]:!1,[l.H]:!1,[v.G]:!1,[f.l]:!1,[m.r]:!1,[g.r9]:!1,[c.Jd]:!1,[d.mz]:!1,[R.F]:!1,[y.Tu]:!1,[r.cv]:!1,[S.qV]:!1,[w.FM]:!1,[a.Xj]:!1,[p.k]:!1,[A.fF]:!1,[F.x]:!1,[O.pm]:!1,[E.L]:!1,[D.L9]:!1,[V.n]:!1,[W.b]:!1,[M.a]:!1,[x.h]:!1,[I.f1]:!1,[P.P]:!1,[C.w]:!1,[T.O]:!1,[_.m]:!1,[k.b]:!1}},52989:(e,t,o)=>{o.d(t,{AI:()=>v,MZ:()=>y,qw:()=>b});var i=o(96486),n=o.n(i),r=o(73744),a=o(28314),s=o(77546),l=o(95802),c=o(15723),d=o(4926),p=o(69784),u=o(50628),m=o(27724),g=o(64434),h=o(24677),f=o(8713);function v(e){const{environment:t,target:o,startX:i,startY:n,showSelectionRect:c,preventSelectStores:u,allowVerticalEdgeScroll:v,allowHorizontalEdgeScroll:b}=e,S=m.default.getDefaultContainerFromTarget(o);if(!S)return;if(i>=window.innerWidth-d.Z.state)return;if(n>=window.innerHeight-d.Z.state)return;const w=s.VW(o),k=s.xH(o),C=l.C.getMembersByDOMOrder({filter:e=>e.getContextSelectableContainer()===S}),_=()=>{p.Z.state.isActive&&(h.Jy(),y({environment:t,currentX:p.Z.state.currentX,currentY:p.Z.state.currentY,toggle:a.yA().shift}))};w&&r.lj(w,"scroll",_),k&&r.lj(k,"scroll",_),p.Z.setState({moved:!1,isActive:!0,startX:i,startY:n,currentX:i,currentY:n,currentRect:void 0,defaultContainer:S,startSelection:m.default.state.stores,startSelectables:C,verticalScrollerEl:w,horizontalScrollerEl:k,startScrollTop:w?w.scrollTop:0,startScrollLeft:k?k.scrollLeft:0,showSelectionRect:c,handleScroll:_,preventSelectStores:u,allowVerticalEdgeScroll:v,allowHorizontalEdgeScroll:b}),h.ZH(t),g.wG(),f.MO()}function y(e){const{environment:t}=e,o=p.Z.state;if(o.isActive){const{currentX:i,currentY:r,verticalScrollerEl:a,horizontalScrollerEl:s,startScrollTop:l,startScrollLeft:d,preventSelectStores:m}=o;let g=o.startY;if(a){g-=a.scrollTop-l}let f=o.startX;if(s){f-=s.scrollLeft-d}const v={top:Math.min(g,r),bottom:Math.max(g,r),left:Math.min(f,i),right:Math.max(f,i)},y=u.Z.state.selectableRectMap,b=o.startSelectables.filter((e=>{const t=y.get(e),i=e.props.store;return e.props.canSelect&&t&&c.kK(v,t)&&m.indexOf(i)<0&&(!o.showSelectionRect||i.isTransclusionType()||!i.isInsideTransclusion())})),S=w(b);let k=[];const C=S.find((e=>e.length>1));if(C)k=C;else{const e=n().last(S);e&&(k=e)}let _=n().map(k,(e=>e.props.store));if(e.toggle)for(const e of o.startSelection)n().includes(_,e)?_=n().without(_,e):_.push(e);p.Z.setState({...o,moved:!0,currentX:e.currentX,currentY:e.currentY,currentRect:v}),h.Z5({environment:t,stores:_})}}function b(e){const t=p.Z.state;if(t.isActive){const{moved:o,verticalScrollerEl:i,horizontalScrollerEl:n,handleScroll:a}=t;o||h.ZH(e),i&&r.ZV(i,"scroll",a),n&&r.ZV(n,"scroll",a),p.Z.setState({isActive:!1})}}const S=function(e){if(e)for(;;){if(!(e=e.getContextClosestSelectable()))return;if(e.props.canSelect)return e}},w=function(e){const t=new Map,o={root:!0};for(const i of e){const e=S(i)||o;t.get(e)||t.set(e,[]),t.get(e).push(i)}return Array.from(t.values())}},3992:(e,t,o)=>{o.r(t),o.d(t,{addRecurrence:()=>m,disableRecurrence:()=>g,createRecurrenceInner:()=>h});var i=o(4615),n=o(54061),r=o(98963),a=o(6287),s=o(79315),l=o(3815),c=o(50906),d=o(96802),p=o(9953),u=o(30149);function m(e){let{environment:t,blockStore:o,recurrence:i}=e;const a=o.getAutomationId(),s=function(e){return{...e,start_date:(0,n.convertDateToUtcRepresentation)(new Date(e.start_date))}}(i);a?function(e,t,o,i){const n={table:r.cv,id:t,spaceId:o.getSpaceId()},a=l.Mz.createChildStore(o,n),s=a.getTrigger();if(!s)return;u.createAndCommit({environment:e,userAction:"recurrenceActions.updateRecurrence",perform:e=>{p.sW({store:a,data:{status:"active",trigger:{id:s.id,type:"recurrence",recurrence:i}},transaction:e})}}),c.trackRecurrenceSaved(e,{type:"updated",frequency:i.frequency})}(t,a,o,s):function(e,t,o){u.createAndCommit({environment:e,userAction:"recurrenceActions.createRecurrence",perform:i=>{h(i,e,t,o)}})}(t,o,s)}function g(e){let{environment:t,blockStore:o}=e;const i=o.getAutomationId();if(!i)return;const n={table:r.cv,id:i,spaceId:o.getSpaceId()};u.createAndCommit({environment:t,userAction:"recurrenceActions.disableRecurrence",perform:e=>{p.sW({store:(0,l.Kv)(o,n),data:{status:"disabled",run_at:void 0},transaction:e})}}),c.trackRecurrenceSaved(t,{type:"disabled"})}function h(e,t,o,n){const{currentUserRootStore:l}=s.default.state;if(!l)return;const u=o.getParentStore();if(!u||u.table!==a.v)return;if(!u.getParentBlockStore())return;const m=(0,i.ZP)();p.ae({environment:t,table:r.cv,inMemoryRecordCache:o.inMemoryRecordCache,value:{id:m,parent_id:o.id,parent_table:o.table,alive:!0,space_id:o.getSpaceId(),status:"active",trigger:{id:(0,i.ZP)(),type:"recurrence",recurrence:n}},transaction:e}),d.FH({stores:[o],update:{automation_id:m},transaction:e}),c.trackRecurrenceSaved(t,{type:"created",frequency:n.frequency})}},43008:(e,t,o)=>{o.d(t,{g:()=>l,x:()=>c});var i=o(95802),n=o(79315),r=o(3815),a=o(64951),s=o(24677);const l=function(e){const{mainEditorCurrentBlockStore:t}=n.default.state;if(t){const o=r.G.createChildStore(t,e.blockStore.pointer);a.Z.setState({...a.Z.state,originRect:e.originRect||i.C.getRectFromStore(e.blockStore),blockStore:o})}};function c(e){a.Z.reset(),s.ZH(e)}},52771:(e,t,o)=>{o.d(t,{$:()=>l,x:()=>c});var i=o(95802),n=o(79315),r=o(3815),a=o(82187),s=o(24677);const l=function(e){const{mainEditorCurrentBlockStore:t}=n.default.state;if(t){const o=r.G.createChildStore(t,e.blockStore.pointer);a.Z.setState({...a.Z.state,originRect:e.originRect||i.C.getRectFromStore(e.blockStore),clonedBlockStore:o,originalBlockStore:e.blockStore,renderDelete:e.renderDelete})}};function c(e){a.Z.reset(),s.ZH(e)}},4083:(e,t,o)=>{o.d(t,{oK:()=>p,UZ:()=>u,Cd:()=>m});var i=o(1302),n=o(29477),r=o(98459),a=o(87404),s=o(13264),l=o(50906),c=o(24677),d=o(98104);async function p(e){const{environment:t,discussionStore:o,rect:p,blockStore:u,discussionLocation:m,activityId:g,notificationId:h}=e,f=new a.Z(t,(0,r.CG)(u.pointer.spaceId));s.Z.setState({open:!0,rect:p,discussionStore:o,discussionInputStore:f,blockStore:u,discussionLocation:m,activityId:g,notificationId:h}),c.ZH(t),await i.default.afterNextFlush(),await(0,n.Vs)(10),d.NX({store:f.state.textStore}),l.trackOpenReplyDiscussionMenu({environment:t,from:m,activityId:g,notificationId:h})}function u(e){const t=s.Z.state;if(t.open){const{discussionLocation:o,activityId:i,notificationId:n}=t;s.Z.setState({open:!1,rect:t.rect}),c.ZH(e),l.trackCloseReplyDiscussionMenu({environment:e,from:o,activityId:i,notificationId:n})}}function m(e){const t=s.Z.state;if(t.open){0===t.discussionStore.getComments().length&&u(e)}}},360:(e,t,o)=>{o.d(t,{l:()=>n,q:()=>r});var i=o(25399);function n(){i.Z.setState({open:!0,submitted:!1,error:void 0})}function r(){i.Z.setState({open:!1})}},55332:(e,t,o)=>{o.d(t,{K9:()=>m,Yw:()=>g,KX:()=>h,dA:()=>f,L0:()=>v,AZ:()=>y,qB:()=>b});var i=o(96486),n=o.n(i),r=o(45953),a=o(76967),s=o(27724),l=o(24666),c=o(30149);const d=function(){const e=a.default.state,{currentIndex:t,revisionStack:o}=e,i=t+1;return{revision:o[t],index:i}};function p(e){const{environment:t,revision:o,nextIndex:i,preventSelectText:d}=e;let{transactions:p}=o;c.createAndCommit({userAction:"revisionActions.undoRevision",environment:t,canUndo:!1,perform:e=>{p=n().clone(p),p.reverse();for(const t of p){c.DEBUG&&console.log("Undoing transaction",t.getUserActionForAnalyticsPurposesOnly());const o=n().clone(t.invertedOperations);o.reverse();for(const i of o){const o=t.stores.find((e=>(0,r.qo)(e.pointer,i.pointer)));i&&o&&c.applyOperation({transaction:e,store:o,operation:i})}t.beforeSelection&&s.default.setState({...s.default.state,...t.beforeSelection}),t.beforeTextSelection&&!d&&l.default.setState(t.beforeTextSelection)}}}),a.default.setState({...a.default.state,currentIndex:i})}const u=function(){const e=a.default.state,{currentIndex:t,revisionStack:o}=e,i=t-1;return{revision:o[i],index:i}};const m=function(e){const t=a.default.state;let{revisionStack:o}=t;const{currentIndex:i}=t;o=n().slice(o,i,o.length);const r=Date.now();if("string"==typeof e.undoCheckpoint){const t=o.find((t=>t.namedRevisionId===e.undoCheckpoint));t?t.transactions.push(e.transaction):o.unshift({transactions:[e.transaction],timestamp:r,namedRevisionId:e.undoCheckpoint})}else{const t=o[0];!e.undoCheckpoint&&t&&!t.namedRevisionId&&r-t.timestamp<=a.groupInterval&&t.transactions[0].isLocal===e.transaction.isLocal?t.transactions.push(e.transaction):o.unshift({transactions:[e.transaction],timestamp:r})}a.default.setState({...a.default.state,revisionStack:o,currentIndex:0})};function g(e,t){const{revision:o,index:i}=d();o&&p({environment:e,revision:o,nextIndex:i,preventSelectText:t})}function h(e,t){const{revision:o,index:i}=u();o&&function(e,t,o,i){const{transactions:n}=t;c.createAndCommit({userAction:"revisionActions.redoRevision",environment:e,canUndo:!1,perform:e=>{for(const t of n){for(const o of t.operations){const i=t.stores.find((e=>(0,r.qo)(e.pointer,o.pointer)));i&&c.applyOperation({transaction:e,store:i,operation:o})}t.afterSelection&&s.default.setState({...s.default.state,...t.afterSelection}),t.afterTextSelection&&!i&&l.default.setState(t.afterTextSelection)}}}),a.default.setState({...a.default.state,currentIndex:o})}(e,o,i,t)}const f=function(){a.default.reset()},v=function(){const{revision:e}=d();return!!e},y=function(){const{revision:e}=u();return!!e};function b(e){const{environment:t,namedRevisionId:o}=e,{revisionStack:i,currentIndex:n}=a.default.state,r=i.findIndex((e=>e.namedRevisionId===o));if(r<0||n>r)return;const s=i[r],l=[...i];l.splice(r,1),l.splice(n,0,s),a.default.setState({...a.default.state,revisionStack:l});p({environment:t,revision:s,nextIndex:n+1})}},56863:(e,t,o)=>{o.d(t,{w:()=>r});var i=o(49557),n=o(4935);const r=function(){i.Z.state.isActive&&(n.Z.setState({...n.Z.state,open:!1}),i.Z.setState({...i.Z.state,isActive:!1,isAnimatingClosed:!0}))}},5978:(e,t,o)=>{o.r(t),o.d(t,{back:()=>Mo,canGoUp:()=>Io,clearHistoryState:()=>Qt,downloadFileUrl:()=>ko,downloadUrl:()=>Co,forward:()=>To,generatePartnerStackPathParam:()=>to,getTrackingParams:()=>oo,goDownInPeekMode:()=>vo,goUpInPeekMode:()=>fo,handleFirstPartyExternalIntegrationAuthCallback:()=>Ro,handleNavigateWithinSamePage:()=>ro,handleRedirectToLastVisitedPage:()=>Do,handleSlackAuthCallback:()=>Eo,handleThirdPartyExternalIntegrationAuthCallback:()=>Ao,initialize:()=>No,navigate:()=>io,navigateAwayIfCurrentPage:()=>_o,navigateOnBaseUrl:()=>eo,navigateToBlock:()=>go,navigateToExternalURL:()=>yo,navigateToHomeTab:()=>uo,navigateToOnboarding:()=>no,navigateToPage:()=>mo,navigateToTab:()=>ao,openFileUrl:()=>wo,openInNativeApp:()=>xo,peekBlock:()=>ho,potentialWebSearchAbandonEventEmitter:()=>lo,publicPageTopBarAction:()=>Lo,resetEditorState:()=>Gt,resetPageState:()=>Kt,resetPeekState:()=>Yt,resetSidebarState:()=>Xt,up:()=>Po,updateHistoryState:()=>Jt,updateRouterState:()=>Bo,updateRouterStateForDocumentTitleChange:()=>po});var i=o(17673),n=o(96486),r=o.n(n),a=o(1302),s=o(97477),l=o(27328),c=o(50112),d=o(15145),p=o(7406),u=o(33147),m=o(43593),g=o(17755),h=o(65917),f=o(15157),v=o(29477),y=o(90850),b=o(4615),S=o(71644),w=o(98459),k=o(80984),C=o(89101),_=o(21202),M=o(7678),T=o(33709),I=o(77858),P=o(19889),x=o(66079),B=o(32739),Z=o(9852),E=o(54153),R=o(97880),A=o(64002),D=o(36054),F=o(74487),L=o(11342),V=o(5366),N=o(73928),O=o(91584),U=o(3297),H=o(97977),z=o(36110),W=o(25320),j=o(87420),K=o(4083),Y=o(74647),G=o(76095),X=o(95477),q=o(51456),$=o(28020),J=o(70764),Q=o(99417),ee=o(12955),te=o(21969),oe=o(22889),ie=o(84210),ne=o(15070),re=o(9844),ae=o(79315),se=o(49065);var le=o(33929),ce=o(59488),de=o(26374),pe=o(98165),ue=o(33665),me=o(45094),ge=o(38755),he=o(472),fe=o(15517),ve=o(87629),ye=o(95802),be=o(51),Se=o(80863),we=o(19511),ke=o(10161),Ce=o(89256),_e=o(17903),Me=o(46735),Te=o(73796),Ie=o(3418),Pe=o(47593),xe=o(33759),Be=o(89403),Ze=o(49085);class Ee extends Ze.Z{getInitialState(){return{args:void 0}}}const Re=new Ee;var Ae=o(42330),De=o(12768),Fe=o(42389),Le=o(19671),Ve=o(93220),Ne=o(30539),Oe=o(13023),Ue=o(88923),He=o(98452),ze=o(99332),We=o(24612),je=o(89523),Ke=o(3815),Ye=o(13264),Ge=o(55320),Xe=o(87956),qe=o(86486),$e=o(27724),Je=o(7755),Qe=o(11689),et=o(1310),tt=o(92083),ot=o(29370),it=o(37394),nt=o(52258),rt=o(66708),at=o(77503),st=o(62820),lt=o(7011),ct=o(50906),dt=o(19719),pt=o(54642),ut=o(85266),mt=o(51127),gt=o(2449),ht=o(73100),ft=o(54564),vt=o(6404),yt=o(51365),bt=o(64434),St=o(47307),wt=o(84908),kt=o(47678),Ct=o(54604),_t=o(94273),Mt=o(92625),Tt=o(91376),It=o(7476),Pt=o(95489),xt=o(31304),Bt=o(71978),Zt=o(43008),Et=o(52771),Rt=o(55332),At=o(3898),Dt=o(24677),Ft=o(8713),Lt=o(64964),Vt=o(29974),Nt=o(98104),Ot=o(30149),Ut=o(39865),Ht=o(761),zt=o(53471),Wt=o(39634);const jt=(0,V.defineMessages)({errorSamlMessage:{defaultMessage:"Could not log you in.",id:"router.loginWithSamlError.message",description:"SAML is a method of logging in for enterprise users. This error is shown when a user cannot log in with SAML."},appleErrorMessage:{id:"loginActions.loggingInWithApple.errorMessage",defaultMessage:"Something went wrong while trying to log in with Apple."},authenticating:{id:"externalIntegrationAuthActions.authenticationWithIntegration.loadingMessage",defaultMessage:"Authorizing with integration…"},joinedTeamMessage:{id:"joinedTeam.confirmationMessage",defaultMessage:"Joined {teamName}",description:"This message is shown after a user successfully joins a team"}});function Kt(e){rt.Z.reset(),at.Z.reset(),nt.Z.reset(),Ce.Z.reset(),yt.xv({environment:e,blockPropertyValueOverlayStore:Le.Z}),zt.W8(),Lt.C1(),(0,Q.jp)(e.device)&&ht.aV({store:Se.oX})}function Yt(e){He.Z.reset(),ze.Z.reset(),We.Z.reset(),yt.xv({environment:e,blockPropertyValueOverlayStore:Oe.Z}),et.ZP.reset()}function Gt(e){var t;wt.inPageSearch.stop(),Dt.ZH(e),Nt.ZH(e),bt.wG(),Ft.MO(),Dt.Fp({pivot:void 0}),vt.xv(),qe.default.reset(),Rt.dA(),ft.LZ(),Et.x(e),Zt.x(e),N.id({environment:e}),Ct.xv(),null===(t=e.NativeMobileActionBarStore)||void 0===t||t.clear(!1)}function Xt(e){Qe.Z.reset(),Ge.default.reset(),st.Z.state.open&&(st.Z.reset(),e.device.isMobile&&Y.close()),Ye.Z.state.open&&K.UZ(e),It.Cd(e)}function qt(){const{mainEditorCurrentBlockStore:e}=ae.default.state;let t=0,o=[];if(e){const{stores:e}=$e.default.state;o=r().compact(e.map((e=>e.id))),t=_e.Z.state.scrollTop}return{scrollTop:t,blockIds:o}}function $t(e){let{historyId:t,historyIndex:o,currentUserId:i}=e;const n={...qt(),index:o};f.Z.set({userId:i,key:t,value:n})}function Jt(e){let{historyId:t,currentUserId:o}=e;const i=f.Z.get({userId:o,key:t});if(!i)return;const n={...qt(),index:i.index};f.Z.set({userId:o,key:t,value:n})}function Qt(e){let{RouterStore:t,currentUserId:o}=e;const i=t.state.id;f.Z.remove({userId:o,key:i})}function eo(e){const t=function(e,t){try{const o=e.startsWith("/")?new URL(e,X.Z.domainBaseUrl):new URL(e);if(t)for(const[e,i]of Object.entries(t))o.searchParams.append(e,i);return o.pathname+o.search+o.hash}catch{throw new Error(`${e} is neither a URL nor an absolute path`)}}(e.url,e.extraSearchParams);return io({...e,url:`${X.Z.domainBaseUrl}${t}`})}async function to(e){const t=await ee.getPartnerStackCookie(e);if(!t)return{};return{gspk:window.btoa(t)}}async function oo(e,t){const{utmContent:o,utmSource:i}=t,n={utm_source:i,utm_content:o,tid:await(0,q.getDeviceIdForAnalytics)(e)},{mainEditorCurrentBlockStore:r}=ae.default.state;return null!=r&&r.id&&(n.utm_campaign=(0,b.F9)(null==r?void 0:r.id)),n}function io(e){var t,o;const{environment:i,openInNew:n,frontPreserveScrollPosition:r,queryId:a}=e,{RouterStore:s,currentUser:l}=i,c=l.id,{savedSidebarExpandedStoreState:d}=Ue.default.state;d&&Je.gV.set(!0);const p=k.Wj({url:e.url,baseUrl:X.Z.domainBaseUrl,publicDomainName:X.Z.publicDomainName,isMobile:i.device.isMobile,protocol:X.Z.protocol,currentUrl:ncd.href()}),{redirect:u,updateMobileTabbedRouterArgs:m}=co(e,p),g=A.gy(ncd.href()),h=A.gy(e.url),v=Boolean((null==h?void 0:h.hostname)&&h.hostname!==(null==g?void 0:g.hostname));if("external"===p.name||v)return void yo({environment:i,url:e.url,targetSelf:v});const y=B.u5({schemeUrl:e.url,baseUrl:X.Z.domainBaseUrl}),b=A.T1(e.url);if("tab"===n)return void(i.device.isElectron&&"page"===p.name?wt.openInNewTab({url:b,position:"after-children"}):yo({environment:i,url:y}));if("window"===n&&i.device.isElectron&&"page"===p.name)return void wt.openInNewWindow(b);const w=s.state.route,C="page"===w.name&&"page"===p.name&&w.blockId===p.blockId,_="page"===w.name&&"page"===p.name&&w.spaceDomain!==p.spaceDomain&&(w.requestedOnPublicDomain||p.requestedOnPublicDomain),M=i.AppUpdateStore.state.appUpdate;if(!C&&!e.redirect&&gt.cM(i,M))return void gt.hC({environment:i,url:b,version:M.version});if(u||C||(Jt({historyId:s.state.id,currentUserId:c}),(0,me.Sx)(i)&&(Y.setUpdateExpand({environment:i,isExpanded:!1,from:"close_for_space"}),lt.ZP.update((e=>({...e,canRender:!1}))))),Xt(i),_)return void yo({environment:i,url:e.url,targetSelf:!0});const T=(0,S.ZP)();u?ncd.replaceState({id:T,currentUserId:i.currentUser.id},void 0,b):ncd.pushState({id:T,currentUserId:i.currentUser.id},void 0,b);const I=function(e){let{historyId:t,currentUserId:o}=e;const i=f.Z.get({userId:o,key:t});return i?i.index:0}({historyId:s.state.id,currentUserId:c});$t({historyId:T,historyIndex:u?I:I+1,currentUserId:c}),!C&&"page"===w.name&&Xe.Z.state&&(null===(t=Xe.Z.state)||void 0===t?void 0:t.pageId)===w.blockId&&ct.trackPostSearchClickPageExit(i,Xe.Z.state),Bo({environment:i,id:T,action:u?"replace":"push",href:b,updateMobileTabbedRouterArgs:m}).then((()=>{"page"===p.name&&!C&&a?Xe.Z.setState({queryId:a,pageId:p.blockId,timeEntered:new Date}):Xe.Z.reset()}));(C||"nativeTab"===w.name&&"page"===p.name&&(null===(o=ae.default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.id)===p.blockId)&&ro(i),!r&&window.scrollTo(0,0),he.default.logNavigation()}function no(e){io({environment:e,url:C._j.onboarding})}async function ro(e){const{RouterStore:t}=e,o=ae.default.state.mainEditorCurrentBlockStore;if(o&&"page"===t.state.route.name){if(t.state.route.scrollToBlockId){const e=[t.state.route.scrollToBlockId];0===r().compact(ye.C.findSelectablesFromIds(e)).length&&(await At.Nz(o,e),await a.default.afterNextFlush())}kt.Y(e)}}function ao(e){var t,o,i;const{environment:n,tab:a,navigationAction:s,navigationSource:c}=e,{TabbedRouterStore:d,currentUser:p}=n;if(!ue.__(n))return;"updates"!==a&&dt.nI(n);const u=d.state.activeTab,m=(0,l.w_)(d.state),g=r().cloneDeep(d.state);g.activeTab=a,g.navigationAction=s,g.navigationSource=c,void 0!==e.nativeRootPageOverrideEnabled&&(g.tabs[g.activeTab].nativeRootPageOverrideEnabled=e.nativeRootPageOverrideEnabled);let h=!1;if(void 0!==e.pages){const t=e.pages.map((e=>{const t=(0,l.Gt)(e,!0),o=k.Wj({url:t,baseUrl:X.Z.domainBaseUrl,publicDomainName:X.Z.publicDomainName,isMobile:n.device.isMobile,protocol:X.Z.protocol,currentUrl:ncd.href()});return{...e,route:o}})),o=g.tabs[g.activeTab].pages;h=!r().isEqual(o,t),g.tabs[g.activeTab].pages=t}if(so(m)&&!so((0,l.w_)(g))&&lo.emit(Date.now()),d.setState(g),d.state.activeTab===u&&!h)return;const f=ae.default.state.mainEditorCurrentBlockStore,v="web"===m.type&&(null===(t=m.redirectedTo)||void 0===t?void 0:t.route)&&"page"===(null===(o=m.redirectedTo)||void 0===o?void 0:o.route.name)&&(null===(i=m.redirectedTo)||void 0===i?void 0:i.route.showMoveTo),y=f&&(null==f?void 0:f.canEdit())&&f.isEmptyTitle()&&f.isEmptyPage();"addPage"===u&&v&&y&&p.isLoggedIn()&&Ot.createAndCommit({userAction:"routerActions.navigateToTab",environment:n,perform:e=>{Ut.y8({environment:n,blocks:[f],transaction:e}),e.postSubmitCallbacks.push((e=>{e||ct.trackBlockAction(n,{analyticsName:"delete",from:"mobile_navigation",block_id:f.id,block_type:"page"})}))}});const b="addPage"===a,w=d.state.tabs[a],{rootPage:C,pages:_}=w;let M=!1;switch(C.type){case"native":break;case"web":if(0===_.length||b)io({environment:n,redirect:!0,url:(0,l.Gt)(C,!0,e.queryParams),updateMobileTabbedRouterArgs:{restoringTab:!0}});else{M=!0;const e=(0,S.ZP)();ncd.replaceState({id:e,currentUserId:n.currentUser.id},void 0,(0,l.Gt)(C))}}if(b)return;const T=!0===g.tabs[g.activeTab].nativeRootPageOverrideEnabled;_.forEach(((e,t)=>{if(!T&&t===_.length-1)return void io({environment:n,redirect:!M,url:(0,l.Gt)(e),updateMobileTabbedRouterArgs:{restoringTab:!0}});const o=(0,S.ZP)(),i=(0,l.Gt)(e);M?ncd.pushState({id:o,currentUserId:n.currentUser.id},void 0,i):(M=!0,ncd.replaceState({id:o,currentUserId:n.currentUser.id},void 0,i))}))}const so=function(e){return"web"===e.type&&"nativeTab"===e.route.name&&"search"===e.route.tab},lo=new u.Z,co=function(e,t){const o={redirect:e.redirect,updateMobileTabbedRouterArgs:e.updateMobileTabbedRouterArgs};return ue.__(e.environment)?("login"!==t.name&&"logout"!==t.name||(o.redirect=!0,o.updateMobileTabbedRouterArgs={...o.updateMobileTabbedRouterArgs,clearNativeRootPageOverride:!0}),o):o};function po(e){var t;const{environment:o,url:i}=e;if(!ue.__(o))return;const{TabbedRouterStore:n}=o,r=(0,l.w_)(n.state);if("web"!==r.type)return;const a=k.Wj({url:i,baseUrl:X.Z.domainBaseUrl,publicDomainName:X.Z.publicDomainName,isMobile:o.device.isMobile,protocol:X.Z.protocol,currentUrl:ncd.href()}),s=(null===(t=r.redirectedTo)||void 0===t?void 0:t.route)??r.route;if(a.name!==s.name)return;const c=A.T1(e.url);r.redirectedTo?(r.redirectedTo.route=a,r.redirectedTo.url=c):(r.route=a,r.url=c)}function uo(e,t){var o,i;if(ue.__(e))return e.device.isMobileNative&&e.device.isAndroid&&Ie.Z.closeAll(),ao({environment:e,tab:"home",nativeRootPageOverrideEnabled:!0}),void(t&&t());Boolean(null===(o=e.mobileNative)||void 0===o?void 0:o.supportsNativeHomeOnPhone())&&(null===(i=e.mobileNative)||void 0===i||i.showNativeHomeTab(t))}function mo(e){const{store:t,openInNew:o,environment:i}=e,{currentSpaceStore:n}=ae.default.state;if(!t.isDefined())return;const r=t.isNavigableBlock(),{page:a,block:s}=r?{page:t,block:void 0}:{page:pe.Dg(t),block:t};a&&(!s&&n&&fe.es({currentUserId:i.currentUser.id,spaceId:n.id,blockId:a.id}),go({environment:i,store:a,scrollToBlockId:s&&s.id,openInNew:o,visitType:oe.vu.Search,pageVisitSource:d.tY.Search,queryId:e.queryId}))}function go(e){const{environment:t,store:o,redirect:i,scrollToBlockId:n,collectionViewId:r,openInNew:a,discussionId:s,showMoveTo:l,saveParent:c,visitType:p,templateGalleryItem:u,pageVisitSource:m,openInSidePeek:g,queryId:h}=e,f=(0,ie.Hu)({store:o,fullyQualified:!1,scrollToBlockId:n,collectionViewId:r,discussionId:s,showMoveTo:l,saveParent:c,templateGalleryItem:u,openInSidePeek:g});o.isNavigableBlock()&&Me.Z.recordVisit({id:o.id,type:void 0!==p?p:oe.vu.Default,currentUserId:t.currentUser.id}),io({environment:t,url:m?A.SK(f,{[d.$X]:m,qid:a?h:void 0}):f,redirect:i,openInNew:a,queryId:h})}function ho(e){const{environment:t,store:o,peekMode:i,openInNew:n,showMoveTo:r,saveParent:a,resultsStore:s,collectionContextStore:l}=e,c=e.currentBlockStore??ae.default.state.mainEditorCurrentBlockStore;if(!c)return;io({environment:t,url:Boolean(n)||"full_page"===i?(0,ie.Hu)({store:o,fullyQualified:!1,showMoveTo:r,saveParent:a}):(0,ie.Hu)({store:c,peekViewBlockId:o.id,peekMode:(0,Ue.getUrlParamFromPeekMode)(i),fullyQualified:!1,showMoveTo:r,saveParent:a}),openInNew:n}),j.Af({resultsStore:s,collectionContextStore:l})}function fo(){const{resultsStore:e}=Ue.default.state,t=null==e?void 0:e.getState();if(Ue.default.state.open&&t){const{target:e}=Ue.default.state,o=t.findIndex((t=>t.id===e.id)),{mainEditorCurrentBlockStore:i}=ae.default.state;if(i&&o>0){const e=(0,ie.Hu)({store:i,fullyQualified:!1,peekViewBlockId:t[o-1].id,peekMode:(0,Ue.getUrlParamFromPeekMode)(Ue.default.state.mode)});io({environment:i.environment,url:e}),ct.trackPeekArrowNavigation(i.environment,{direction:"up"})}}}function vo(){const{resultsStore:e}=Ue.default.state,t=null==e?void 0:e.getState();if(Ue.default.state.open&&t){const{target:e}=Ue.default.state,o=t.findIndex((t=>t.id===e.id)),{mainEditorCurrentBlockStore:i}=ae.default.state;if(i&&o<t.length-1){const e=(0,ie.Hu)({store:i,fullyQualified:!1,peekViewBlockId:t[o+1].id,peekMode:(0,Ue.getUrlParamFromPeekMode)(Ue.default.state.mode)});io({environment:i.environment,url:e}),ct.trackPeekArrowNavigation(i.environment,{direction:"down"})}}}function yo(e){const{environment:t,targetSelf:o}=e;let i=e.url;"/"===i[0]&&(i=X.Z.domainBaseUrl+i);const n=A.yn(i);if(n)if(t.device.isElectron)wt.openExternalUrl(n);else if(t.mobileNative)n.startsWith("http:")||n.startsWith("https:")?t.mobileNative.openInAppBrowser(n):window.location.href=n;else{const t=document.createElement("a");t.href=e.url,t.classList.add("notion-link"),o||t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer"),document.body.appendChild(t),t.click(),t.remove()}}function bo(e){if(!Boolean(e.mobileNative))return!1;const{device:t}=e,o=(0,L.parseMobileAppVersion)(t.mobileAppVersion,t.isAndroid);if(!o)return!1;if(t.isIOS)switch(X.Z.env){case"production":return(0,L.isGreaterThanOrEqualToVersion)(o,[0,4,669]);default:return!0}else if(t.isAndroid)switch(X.Z.env){case"production":return(0,L.isGreaterThanOrEqualToVersion)(o,[0,6,735]);default:return!0}return!1}async function So(e,t){return e.device.isElectron||e.device.isMobileNative?await pt.getSignedFileUrl(e,t,!1):(0,g.g)({...t,baseURL:X.Z.domainBaseUrl,currentUserId:e.currentUser&&e.currentUser.id})}async function wo(e,t){ct.trackFileOpenAttempt(e,{from:"embedded_block_click",type:t.type});let o=t.url;const i=e.mobileNative&&bo(e),n=m.E$(t.url,X.Z.secureFileS3.url);n&&(i&&e.mobileNative.showLightBoxV2({url:void 0,downloadName:t.downloadName,type:t.type,from:t.from,state:"fetching"}),o=await Promise.race([So(e,t),v.Xb(g.nK,void 0)])),o?n&&i?e.mobileNative.showLightBoxV2({url:o,downloadName:t.downloadName,type:t.type,from:t.from,state:"url_ready"}):yo({environment:e,url:o}):(i&&e.mobileNative.showLightBoxV2({url:void 0,downloadName:t.downloadName,type:t.type,from:t.from,state:"error"}),h.log({level:"error",from:"routerActions",type:"openFileUrl",data:{message:`failed to get url for ${t.url}`}}))}async function ko(e,t){let o=t.url;const i=e.mobileNative&&bo(e),n=m.E$(t.url,X.Z.secureFileS3.url);n&&(i&&e.mobileNative.showLightBoxV2({url:void 0,downloadName:t.downloadName,type:"file",from:"download",state:"fetching"}),o=await Promise.race([So(e,t),v.Xb(g.nK,void 0)])),o?n&&i?e.mobileNative.showLightBoxV2({url:o,downloadName:t.downloadName,type:"file",from:"download",state:"url_ready"}):n?Co({environment:e,url:o}):yo({environment:e,url:o}):(i&&e.mobileNative.showLightBoxV2({url:void 0,downloadName:t.downloadName,type:"file",from:"download",state:"error"}),h.log({level:"error",from:"routerActions",type:"openFileUrl",data:{message:`failed to get url for ${t.url}`}}))}function Co(e){const{environment:t,url:o}=e;t.mobileNative?t.mobileNative.openInAppBrowser(o):t.device.isElectron?wt.downloadUrl(o):window.location.href=o}async function _o(e){const{environment:t,blocks:o}=e,{mainEditorCurrentBlockStore:i,currentSpaceViewStore:n,currentUserSettingsStore:r,currentUserRootStore:a}=ae.default.state,s=i&&o.find((e=>e.id===i.id));if(s&&n){const e=pe.Dg(s,1);(0,ce.Y)("supportsNativeHome")?ue.NW(t)?Mo(t):uo(t):e?go({environment:t,store:e}):await Vt.y3({environment:t,spaceViewStore:n,userSettingsStore:r,userRootStore:a})}Boolean(o.find((e=>{var t;return e.id===(null===(t=Ue.default.peekTarget.state)||void 0===t?void 0:t.id)})))&&i&&go({environment:t,store:i})}const Mo=function(e){ue.__(e)?function(e){const{TabbedRouterStore:t}=e,o=t.state,i=(0,l.Os)(o);if(!i)return;const n=i.type;"native"===n?t.updateWithNativePage({page:i,clearPages:!1,navigationAction:"pop",navigationSource:"mobile-back-navigation"}):"web"===n?window.history.back():(0,R.t1)(n)}(e):window.history.back()},To=function(){window.history.forward()},Io=function(){const e=ae.default.state.mainEditorCurrentBlockStore;return!!e&&!!pe.Dg(e,1)},Po=function(e){const t=ae.default.state.mainEditorCurrentBlockStore;if(!t)return;const o=pe.Dg(t,1);o&&go({environment:e,store:Ke.G.createChildStore(o,o.pointer)})};async function xo(e){const{environment:t,url:o}=e,i=A.T1(o);t.device.isNative?io({url:i,environment:t}):window.location.href=A.SK(B.NV({httpUrl:i,protocol:X.Z.protocol}),{di:await(0,q.getDeviceIdForAnalytics)(t)})}async function Bo(e){const{id:t,action:o,href:n,environment:r,updateMobileTabbedRouterArgs:a}=e,{RouterStore:l,currentUser:d,TabbedRouterStore:u}=r,m=(null==a?void 0:a.restoringTab)||!1,g=k.Wj({url:n,isMobile:r.device.isMobile,baseUrl:X.Z.domainBaseUrl,publicDomainName:X.Z.publicDomainName,protocol:X.Z.protocol,currentUrl:ncd.href()});s.FB(g.name);const S=l.state.route,P=f.Z.get({userId:d.id,key:t});if(l.setState({id:t,historyState:P,action:o,route:g}),null!=a&&a.forceUpdate||ue.__(r)&&!m){const e={type:"web",url:A.T1(n),route:g};u.updateWithWebPage({page:e,action:null!=a&&a.forceUpdate?"replace":o,updateMobileTabbedRouterArgs:a})}const B=A.Qc(n),R=(0,b.xP)(B.query[M.uF]);R&&(0,y.ZB)({currentUserId:d.id,referralUserId:R});const L=B.query[M.Vt];L&&(0,y.Zj)({currentUserId:d.id,promoCode:L});const V=B.query[c.gS];V&&((0,Z.setSessionAnalyticsTags)(V),Vo(c.gS)),"page"===g.name||k.KV[g.name]||ct.trackVisit(r,n);const{target:N,subtarget:K}=function(e){if(!e)return{target:void 0};const t=null==e?void 0:e.indexOf(".");if(-1===t)return{target:e};return{target:e.substring(0,t),subtarget:e.substring(t+1)}}(B.query.target);"intercom"===N?(Wt.j({environment:r,from:"query_param"}),Vo("target")):"billing"===N||"plans"===N||"members"===N||"audit_log"===N||"connected_apps"===N||"identity_provisioning"===N||"analytics"===N||"admin_content_search"===N||"profile"===N||"notifications_and_settings"===N||"language_and_region"===N||"settings"===N?(Tt.r({currentTab:N,subtab:K}),Vo("target")):"contact_us"===N&&(Te.Z.setState({open:!0}),Vo("target")),await ke.default.waitUntil((()=>ke.default.state.isLoaded));const q=A.T1(n),J=i.parse(q.split("?")[1]||"");if(e.enableDesktopAppRedirect&&function(e){const{route:t}=e.RouterStore.state;return k.c$[t.name]&&"always"===Fe.Z.state&&e.device.isDesktop&&e.device.isBrowser&&(e.device.isMac||e.device.isWindows||!1)&&(!("configureOpenInDesktopApp"in t)||!t.configureOpenInDesktopApp)}(r))!function(e){let t;try{t=A.$U((0,te.W)(ncd.href()))}catch{}t&&io({environment:e,url:t})}(r);else if("root"===g.name){!async function(e,t,o){const i=t.currentUser.isLoggedIn(),{RouterStore:n,device:r}=t,a=r.isMobileNative&&r.isIOS&&"on"===ke.default.getGroup("enforce-root-redirect-on-root-only"),s=n.state.route,l=(e,t)=>{a&&"root"!==n.state.route.name?h.log({level:"warning",from:"routerActions",type:"handleRootRedirect",data:{message:`Prevented ${e} as route has since changed to "${n.state.route.name}"]. Initial route at the start of handleRootRedirect was "${s.name}"}`}}):(a&&h.log({level:"info",from:"routerActions",type:"handleRootRedirect",data:{message:`Redirecting for ${e} as route is still root. Initial route at the start of handleRootRedirect was "${s.name}"}`}}),t())};if(i){a&&h.log({level:"info",from:"routerActions",type:"handleRootRedirect",data:{message:"Called handleRootRedirect"}});const n=await(0,ge.iX)({environment:t,disableRedirectUrl:!1}),{firstSpaceView:r,lastVisitedSpaceView:s,forkPageBlockId:c,publicAccessPageId:d,oauthAuthorizationParams:p,userRootStore:u,redirectUrl:m,userSettingsStore:g,userStore:f}=n;await ke.default.waitUntil((()=>ke.default.state.isLoaded));await Pt.zJ(t,f)&&await Pt.yH(t);const v=De.default.state,y=t.currentUser.id,b=E.Z.get(de.WX);if(b&&i)return void(await Fo(t,b));if(p&&r&&(n.onboardingCompleted||de.BB(v))){const{responseType:e,redirectUri:o,integrationId:i,state:n,owner:r,userId:a,spaceId:s}=p;return void z.gF({environment:t,responseType:e,redirectUri:o,integrationId:i,state:n,owner:r,userId:a,spaceId:s})}if(v.isOnboarding)if(de.BB(v)){if(v.spaceViewId){const e=new Ke.V9(t,{table:I.zU,id:v.spaceViewId});"workspace_setup"===v.stage?mt.Xi(t,{spaceViewStore:e}):await Vt.y3({environment:t,spaceViewStore:e,userSettingsStore:g,userRootStore:u,templateGalleryItem:null==o?void 0:o.templateGalleryItem})}}else no(t);else if(p&&n.onboardingCompleted){const{responseType:e,integrationId:o,redirectUri:i,state:n,owner:r,userId:a,spaceId:s}=p;z.gF({environment:t,responseType:e,integrationId:o,redirectUri:i,state:n,owner:r,userId:a,spaceId:s})}else if(d&&n.onboardingCompleted){fe.Hr({currentUserId:y,blockId:void 0});const e=Ke.G.createChildStore(u,{table:_.iU,id:d});await e.load(),go({environment:t,store:e})}else if(r&&n.onboardingCompleted){if(t.device.isMobile&&!n.mobileOnboardingCompleted)await Pt.I1(t,{type:"mobile-onboarding",redirectUrl:m});else if(c){fe.nM({currentUserId:y,blockId:void 0});const e=Ke.G.createChildStore(u,{table:_.iU,id:c});await e.load(),await $.wU(u);const o=$.o(u);if(1===o.length){const i=o[0],n=i.getSpaceStore();if(!n)return;U.DK({environment:t,store:e,spaceStore:n,spaceViewStore:i,isPrivate:!0,context:"signin_after_duplicate"})}else go({environment:t,store:e})}else m?l("redirectUrl",(()=>{const e=A.SK(m,{tg:null==o?void 0:o.templateGalleryItem});io({environment:t,url:e,redirect:!0})})):s?l("lastVisitedSpaceView",(()=>{Vt.y3({environment:t,spaceViewStore:s,userRootStore:u,userSettingsStore:g})})):l("spaceActions.navigateToFirstSpace",(()=>{Vt.L5({environment:t,userRootStore:u,userSettingsStore:g})}));"credit"===e.target&&tt.Z.setState({open:!0,currentTab:"credit",defaultSubtab:void 0,highlightedSetting:void 0}),"import"===e.target&&Pe.Z.setState({open:!0})}else await Pt.I1(t,{type:"new-user",redirectUrl:m})}}(g,r,{templateGalleryItem:Array.isArray(J.tg)?J.tg[0]:J.tg})}else if("onboarding"===g.name)!async function(e){if(e.currentUser.isLoggedIn()){await Pt.zJ(e)&&await Pt.yH(e)}else{const t=De.default.state,o=E.Z.get(de.WX);t.isOnboarding||o?io({environment:e,url:C._j.signup}):io({environment:e,url:C._j.login})}}(r);else if("googleOneTapRedirect"===g.name)!async function(e,t){const{code:o,frontPathName:i}=t;if(!o)return void io({environment:e,url:C._j.signup});"fail"===(await H.requestLoginWithGoogleOneTap({environment:e,store:xe.Z,idToken:o,frontPathName:i})).status&&io({environment:e,url:C._j.signup})}(r,{code:g.code,frontPathName:g.frontPathName});else if("samlAuthCallback"===g.name)!async function(e,t){let o;e.userId?await H.loginSamlUser({environment:t,userId:e.userId,isNewSignup:e.isNewSignup||!1,previousUserId:e.previousUserId}):o=e.token&&e.csrfState?await H.loginSamlUserWithToken({environment:t,csrfState:e.csrfState,token:e.token,isNewSignup:e.isNewSignup||!1}):e.error||le.default.formatMessage(jt.errorSamlMessage);o&&(xe.Z.setState({...xe.Z.state,alert:o}),io({environment:t,url:C._j.login}))}(g,r);else if("appleAuthCallback"===g.name)!async function(e,t){const{callbackType:o,encryptedToken:i,encryptedNonce:n,code:r,error:a,encryptedUserObject:s,webBrowserDeviceId:l}=e;if("native"===o&&!t.device.isNative)return void xo({url:ncd.href(),environment:t});if("user_cancelled_authorize"===a)return xe.Z.setState({...xe.Z.state,loginType:"email"}),void io({environment:t,url:C._j.login});if(a||!r||!i||!n){const e=le.default.formatMessage(jt.appleErrorMessage);return xe.Z.setState({...xe.Z.state,alert:e}),void io({environment:t,url:C._j.login})}const c=await H.loginWithAppleAuth({environment:t,encryptedToken:i,encryptedNonce:n,code:r,encryptedUserObject:s,webBrowserDeviceId:l});c&&(xe.Z.setState({...xe.Z.state,alert:c}),io({url:C._j.login,environment:t}))}(g,r);else if("googleAuthCallback"===g.name)!async function(e,t){const{callbackType:o,encryptedToken:i,code:n,error:r,webBrowserDeviceId:a}=e;if("native"===o&&!t.device.isNative)return void xo({url:ncd.href(),environment:t});"access_denied"===r&&xe.Z.setState({...xe.Z.state,loginType:"email"});if(r||!n||!i)return xe.Z.setState({...xe.Z.state,alert:r}),void io({environment:t,url:C._j.login});const s=await H.loginWithGoogleAuth({environment:t,encryptedToken:i,code:n,callbackType:"native"===o||"nativeredirect"===o?o:void 0,webBrowserDeviceId:a});s&&(xe.Z.setState({...xe.Z.state,alert:s}),io({url:C._j.login,environment:t}))}(g,r);else if("googleDriveAuthCallback"===g.name)!function(e,t){const{code:o,error:i}=e;!i&&o&&O.O$(t,o);const{url:n}=_t.Vr(t);io({url:n||C._j.root,environment:t})}(g,r);else if("slackAuthCallback"===g.name)Eo({route:g,environment:r});else if("externalAuthCallback"===g.name)Ro({route:g,environment:r});else if("externalIntegrationAuthCallback"===g.name)Ao({route:g,environment:r});else if("loginWithEmailCallback"===g.name)!async function(e,t){const{state:o,password:i,isSignup:n,redirectURL:r,webBrowserDeviceId:a}=e,s=await H.loginWithTemporaryPasscode({environment:t,state:o,password:i,redirectURL:r,webBrowserDeviceId:a,passcodeEnterMethod:"magic_link"});s&&(xe.Z.setState({...xe.Z.state,alert:s}),io(n?{url:C._j.signup,environment:t}:{url:C._j.login,environment:t}))}(g,r);else if("loginSuccessCallback"===g.name)!async function(e,t){const{args:o}=Re.getState(),{webBrowserDeviceId:i}=e;o?await H.handleLoginWithTemporaryPasscodeSuccess({environment:t,...o,webBrowserDeviceId:i}):(h.log({level:"error",from:"routerActions",type:"handleLoginSuccessRedirect",data:{message:"empty args for handleLoginSuccessRedirect"}}),io({url:C._j.root,environment:t}))}(g,r);else if("passwordResetCallback"===g.name)!async function(e,t){const{state:o,password:i}=e,n=await H.loginPasswordReset({environment:t,csrfState:o,password:i,loginStore:xe.Z});n&&(xe.Z.setState({...xe.Z.state,loginType:"email",alert:n}),io({url:C._j.login,environment:t}))}(g,r);else if("logout"===g.name)!async function(e){if((0,ve.j)(e))return void(await H.actuallyLogoutAndDeleteAllLocalData(e,C._j.syncUserSessionAuthCookies));await H.actuallyLogoutAndDeleteAllLocalData(e)}(r);else if("login"===g.name||"signup"===g.name){Zo(r,n),function(e,t){try{const o=new URL(t).searchParams.get("product")||void 0;o&&xe.Z.setState({...xe.Z.state,productType:o}),o===fe.bz&&fe.DP({currentUserId:e.currentUser.id,data:{onboarding_creator_no_joinable_spaces:"on"}})}catch(o){}}(r,n);const e={doNotRedirectWhenLoggedIn:Boolean(J.newSignup)};!function(e,t,o){if((0,ue.Sr)()){const t=A.TW({publicDomainName:X.Z.publicDomainName},window.location.host);ut.qY({spaceDomain:t,environment:e})}else!e.currentUser.isLoggedIn()||null!=o&&o.doNotRedirectWhenLoggedIn?ct.trackLandingPageVisit(e,t):io({environment:e,url:C._j.root,redirect:!0})}(r,g.name,e)}else"oauthAuthorization"===g.name?async function(e,t){Z.setOauthAuthorizationParams(e);const{userId:o,spaceId:i}=e;if(i){const e=o?[o]:t.currentUser.loggedInUserIds;for(const o of e){const e=new Ke.r9(t,{table:x.dx,id:o},{userId:o});await e.load();const n=e.getSpaceViewStores();if(n.length>0){await Promise.all(n.map((e=>e.load())));const e=n.find((e=>e.getSpaceId()===i));if(e)return void(await Vt.ce({environment:t,spaceViewStore:e}))}}}const{currentUserRootStore:n}=ae.default.state;if(n){await n.load();const e=n.getSpaceViewStores();if(e.length>0){const o=e.find((e=>e.canAdmin()))||e[0];if(o)return void(await Vt.ce({environment:t,spaceViewStore:o}))}}io({environment:t,url:C._j.login,redirect:!0})}(g,r):"page"===g.name||"space"===g.name?(Zo(r,n),"page"===g.name&&function(e,t){if(!t)return;try{const{experimentGroups:o,inviteeEmail:i}=JSON.parse(window.atob(t));ct.trackSpaceInvitationEmailClicked(e,{invitee_email:i,invitation_experiment_groups:o});"on"===o.email_invite_one_click_to_join&&Be.Z.setState({...Be.Z.state,inviteeEmail:i})}catch(o){}}(r,g.state),ut.Uz({nextRoute:g,currentRoute:S,environment:r,query:q}),function(e,t,o){if(!e.device.isMobile){const{mainEditorCurrentBlockStore:r}=ae.default.state;if(!r)return;const a=Ue.default.state;let s,l=!1,c=!1;if("page"===t.name&&t.peekViewBlockId){const e=Ke.G.createChildStore(r,{table:_.iU,id:t.peekViewBlockId});l=Boolean(t.showMoveTo),c=Boolean(t.saveParent),s=e}const d="page"===t.name&&t.peekMode?t.peekMode:void 0,p=(0,Ue.getPeekModeFromUrlParam)(d);if(s&&(!a.open||s.id!==a.target.id||p!==a.mode)){var i,n;const t=$e.default.cloneState(),r=ot.Z.cloneState(),a=we.Z.cloneState(),d=e.currentUser.id;Yt(e),Xt(e),Gt(e),ct.trackPageVisit(e,{page_id:s.id,collection_id:s.getParentCollectionId()??(null===(i=s.getCollectionViewCollectionStore())||void 0===i?void 0:i.id),team_id:null===(n=(0,pe.VP)(s))||void 0===n?void 0:n.id,is_peek:!0,peek_mode:p,type:"page",query:o});const u=new Ke.G(e,s.pointer),m=new Ne.Z,g=new je.Z,h=new Ve.Z;j.bA(e,{mode:p??Ue.PeekModeCenter,target:u,pageVisitStore:m,presenceStore:g,showMoveTo:l,saveParent:c,loadingContainerStore:h,savedSelectionStoreState:t,savedTableSelectionStoreState:r,savedCollectionViewSelectionStoreState:a,savedSidebarExpandedStoreState:Je.gV.state}),xt._({userId:d,rootStore:u,presenceStore:g,environment:e}),W.U(e,{block:u,pageVisitStore:m,timestamp:Date.now(),fromPageRefresh:(0,Z.getAppRefreshed)()}),Me.Z.recordVisit({id:s.id,type:oe.vu.Default,currentUserId:d})}a.open&&!s&&(j.ME(),xt.v(a.presenceStore,e),Yt(e))}}(r,g,q),function(e,t){if(e.device.isMobile)return;const{mainEditorCurrentBlockStore:o}=ae.default.state;if(!o)return;"page"===t.name&&t.templateGalleryItem?"closed"===it.Z.state.status&&it.Z.open({analyticsFrom:"direct_link",cloneTo:"destination_picker"}):"closed"!==it.Z.state.status&&it.Z.setState({...it.Z.state,status:"closed"})}(r,g),async function(e,t){"configureOpenInDesktopApp"in t&&t.configureOpenInDesktopApp&&(await ke.default.waitUntilStatsigReady(),e.device.isDesktop&&e.device.isBrowser&&(e.device.isMac||e.device.isWindows)&&tt.Z.setState({open:!0,currentTab:"notifications_and_settings",defaultSubtab:void 0,highlightedSetting:tt.R.OpenInDesktopApp}))}(r,g),await async function(e,t){const{mainEditorCurrentBlockStore:o}=ae.default.state;if(!o)return;if("page"===t.name&&t.scrollToBlockId&&t.discussionId){const i=Ke.G.createChildStore(o,{table:_.iU,id:t.blockId}),n=(0,Ke.Kv)(i,{table:T.qF,id:t.discussionId,spaceId:(0,w.CG)(i.pointer.spaceId)});await n.load(),n.getKeyStore("resolved").getValue()&&(Y.setUpdateExpand({environment:e,isExpanded:!0,from:"resolved_comment"}),Y.setUpdateSidebarCommentsMode(lt.F7.Resolved))}}(r,g)):"templatesRedirect"===g.name?io({environment:r,url:(0,ue.UY)("templateGallery"),redirect:!0}):"communityRedirect"===g.name?io({environment:r,url:(0,ue.UY)("community"),redirect:!1}):"guideRedirect"===g.name?io({environment:r,url:(0,ue.UY)("guides.guides"),redirect:!0}):"invoiceRedirect"===g.name?io({environment:r,url:C._j.root,redirect:!0}):"termsRedirect"===g.name?io({environment:r,url:(0,ue.UY)("terms"),redirect:!0}):"contentPolicyRedirect"===g.name?io({environment:r,url:(0,ue.UY)("contentPolicy"),redirect:!0}):"uiDoc"===g.name||"exportPreview"===g.name?io({environment:r,url:C._j.root,redirect:!0}):"admin"===g.name?X.Z.isAdminMode||io({environment:r,url:C._j.root,redirect:!0}):"teamInvite"===g.name?Fo(r,g.inviteCode):"teamsInvite"===g.name?r.currentUser.isLoggedIn()||io({environment:r,url:C._j.signup,redirect:!0}):"aiFavoriteImport"===g.name?async function(e){const{environment:t,route:o}=e;if(io({environment:t,url:C._j.root,redirect:!0}),await ke.default.waitUntil((()=>ke.default.state.isLoaded)),!ke.default.checkGate("ai_favorites"))return;await ae.default.waitUntil((()=>void 0!==ae.default.state.currentUserSettingsStore&&void 0!==ae.default.state.currentSpaceStore&&void 0!==ae.default.state.currentSpaceViewStore&&void 0!==ae.default.state.currentUserRootStore)),await v.Vs(2e3),await(0,G.Gb)({environment:t,importArgs:o})}({environment:r,route:g}):"new"===g.name?async function(e,t){if(!e.currentUser.id)return void io({environment:e,url:C._j.root,redirect:!0});const{id:o,type:i}=t;let n;if(t.spaceId)n=t.spaceId;else{const{spaceId:t}=await _t.Ie(e);n=t}if(n){const{currentUserSettingsStore:t}=ae.default.state,o=new Ke.r9(e,{table:x.dx,id:e.currentUser.id});if(await o.load(),void 0===ae.default.state.currentSpaceStore||ae.default.state.currentSpaceStore.id!==n)try{await Vt.j({environment:e,userRootStore:o,spaceId:n,navigate:!0,analyticsFrom:"redirect",userSettingsStore:t,shouldDeferSubscriptionRefresh:!0})}catch(a){return void St.showMessage({message:(0,p.tg)(a).message,onAccept:()=>{Mo(e)}})}}else io({environment:e,url:C._j.root,redirect:!0}),await ae.default.waitUntil((()=>void 0!==ae.default.state.currentSpaceStore&&void 0!==ae.default.state.currentSpaceViewStore&&void 0!==ae.default.state.currentUserRootStore));let r;if(i){if(!(0,D.Gu)(F.literals(...Ae.o1),i)){const e=i;switch(e){case"page":case"team":o&&(r={type:e,spaceId:n,id:o});break;case"space":o&&(r={type:e,id:o});break;case"space-private-pages":r={type:e,spaceId:n}}}}Y.quickAddPage({environment:e,from:"route",redirect:!0,quickAddParentOverride:r})}(r,g):"myIntegrations"===g.name?function(e){e.currentUser.isLoggedIn()||io({environment:e,url:C._j.login})}(r):"unknown"===g.name?io({environment:r,url:C._j.root,redirect:!0}):"nativeTab"===g.name?async function(e,t,o,i){if(!e.currentUser.id)return void io({environment:e,url:C._j.root,redirect:!0});let n;if(t.spaceId)n=t.spaceId;else{const{spaceId:t}=await _t.Ie(e);n=t}if(ut.Uz({nextRoute:{...t,spaceId:n},currentRoute:o,environment:e,query:""}),"search"===t.tab){if(!Ge.default.state.sessionId){const t=(0,b.ZP)();Ge.default.setState({open:!1,openAsPage:!0,openedTimeMs:Date.now(),sessionId:t,searchMode:"default"}),ct.trackOpenSearch(e,{from:"pop"===i?"mobile-back-navigation":"mobile-bottom-bar",searchSessionId:t})}}else"updates"===t.tab&&dt.Up({environment:e,from:"pop"===i?"mobile-back-navigation":"mobile-bottom-bar"})}(r,g,S,o):"workspaceSetup"===g.name?function(e,t,o){if(!e.currentUser.id)return void io({environment:e,url:C._j.root,redirect:!0});t.spaceId&&De.default.state.isOnboarding?ut.Uz({nextRoute:t,currentRoute:o,environment:e,query:""}):io({environment:e,url:C._j.root,redirect:!0})}(r,g,S):"uniqueId"===g.name&&await async function(e,t){var o;const i=e.currentUser.id;if(!i)return void Oo(e);const n=new Ke.r9(e,{table:x.dx,id:i},{userId:i});await n.load();const r=null===(o=n.getSpaceViewStores())||void 0===o?void 0:o[0].getSpaceId();if(!r)return void Oo(e);const a=await pt.getIdFromUniqueId(e,{spaceId:r,uniqueId:t});if("failed"===a.type||!a.data.id)return void Oo(e);const s=a.data.id,l=Ke.G.createChildStore(n,{table:_.iU,id:s});await l.load(),mo({environment:e,store:l})}(r,g.uniqueId)}function Zo(e,t){if(ee.canSetCookie(e))try{const o=new URL(t).searchParams.get("gspk");if(o){const t=window.atob(o);ee.setPartnerStackCookie(e,t),ct.trackPartnerStackPartnerId({partner_stack_key:t})}}catch(o){}}async function Eo(e){const{route:t,environment:o}=e;"legacy"===t.type?await async function(e){const{route:{code:t,state:o},environment:i}=e;let n;if(t&&o){const e=await pt.authWithSlack(i,{code:t,encryptedState:o});"failed"===e.type&&(n=e.error.message)}else n="Something went wrong.";n&&St.showErrorMessage(n);const{url:r}=_t.Vr(i);io({url:r||C._j.root,environment:i})}({environment:o,route:t}):"new"===t.type?await async function(e){const{route:{error:t},environment:o}=e;if(t){const e=le.default.formatMessage((0,J.mO)(t),{value:t});St.showErrorMessage(e)}else await Ht.pJ({environment:o});const{url:i}=_t.Vr(o);io({url:i||C._j.root,environment:o})}({environment:o,route:t}):(0,R.t1)(t)}async function Ro(e){const{route:t,environment:o}=e;let i=t.error?t.errorDescription||le.default.formatMessage((0,J.mO)(t.error),{value:t.error}):void 0;try{if(!t.notionState)throw new Error("No notionState.");const e=JSON.parse(decodeURIComponent(t.notionState));await Ht.pJ({environment:o}),await Ht.FD({environment:o,notionState:e})}catch(n){i||(i="An unknown error occurred.")}i&&St.showErrorMessage(i),Do(o)}async function Ao(e){const{route:t,environment:o,integrationId:i}=e;let n=t.error?t.errorDescription||le.default.formatMessage((0,J.mO)(t.error),{value:t.error}):void 0;try{if(!t.state)throw new Error("No state provided.");if(!t.code)throw new Error("No code provided.");Mt.j({message:jt.authenticating});const e=await pt.authWithExternalIntegration(o,{code:t.code,state:t.state});if(Mt.x(),"failed"===e.type)throw e.error;{const{externalObjectInstanceBlockId:t,spaceId:i}=e.data;await Ht.pJ({environment:o}),await Ht.FD({environment:o,notionState:{externalObjectInstanceBlockId:t,spaceId:i}})}}catch(r){n||(n=(0,p.tg)(r).message)}n&&St.showErrorMessage(n),await async function(e){const{environment:t,integrationId:o}=e;if(function(e){const{currentUserRootStore:t}=ae.default.state;if(!t||!e)return!1;const o=(0,se.Kv)(t,{id:e,table:re.K2}).getKeyStore("capabilities").getValue();return(0,ne.ms)(o)}(o)){const{spaceId:e}=await _t.Ie(t);z.gF({environment:t,responseType:"code",spaceId:e,integrationId:o,redirectUri:void 0,state:void 0,owner:void 0,userId:void 0})}else Do(t)}({environment:o,integrationId:i})}function Do(e){const{url:t}=_t.Vr(e);io({url:t||C._j.root,environment:e})}async function Fo(e,t){const o=Bt.I({environment:e,request:{type:"invite-link",inviteLinkCode:t}}),i=(await o.next()).value;be.Z.setState({publicPageData:i});const n=()=>{E.Z.set(de.WX,t),no(e)};if(e.currentUser.isLoggedIn()&&i.spaceId){const{id:o}=e.currentUser;if(o){const a=new Ke.U6(e,{table:P.KJ,id:o});await a.load();if(!a.getFullName(le.default.getIntl())){n();const t=await(0,ge.iX)({environment:e,disableRedirectUrl:!1});return void(await Pt.I1(e,{type:"new-user",redirectUrl:t.redirectUrl}))}const s=new Ke.r9(e,{table:x.dx,id:o});await s.load();try{const o=await Vt.j({environment:e,userRootStore:s,userSettingsStore:void 0,spaceId:i.spaceId,navigate:!1,analyticsFrom:"redirect",inviteCode:t});await Vt.y3({environment:e,spaceViewStore:o.spaceViewStore,userSettingsStore:void 0,userRootStore:s})}catch(r){St.showMessage({message:(0,p.tg)(r).message,onAccept:()=>{Mo(e)}})}}}else n()}async function Lo(e,t){const{utmContent:o,nextRoute:i}=t,[n,r]=await Promise.all([to(e),oo(e,{utmContent:o,utmSource:"public_page"})]);eo({environment:e,url:i,extraSearchParams:{...n,...r}})}function Vo(e){const t=A.T1(A.iO(ncd.href(),e));ncd.replaceState(history.state,void 0,t)}const No=async function(e){const t=window.history.state&&window.history.state.id||(0,S.ZP)();if(!window.history.state){const o=e.currentUser.id;ncd.replaceState({id:t,currentUserId:o},void 0,ncd.href()),$t({historyId:t,historyIndex:0,currentUserId:o})}(0,ce.Y)("supportsNativeSearch")&&e.TabbedRouterStore.setupWithNativeSearch(),await Bo({environment:e,id:t,action:"pop",href:ncd.href(),updateMobileTabbedRouterArgs:{forceUpdate:!0,silenceErrors:!0,clearNativeRootPageOverride:"/"!==window.location.pathname},enableDesktopAppRedirect:!0});const o=e.currentUser.id,i=fe.Mp(o);if(!i||"undefined"===i){const e=window.location.pathname;e&&fe.Tq({currentUserId:o,value:e})}};function Oo(e){e.RouterStore.setState({id:(0,S.ZP)(),route:{name:"notFound"},action:"push"})}},3898:(e,t,o)=>{o.d(t,{uE:()=>m,Nz:()=>f});var i=o(96486),n=o.n(i),r=o(21202),a=o(98165),s=o(52315),l=o(35328),c=o(79315),d=o(3815),p=o(34147),u=o(29373);function m(e){const t=e.state;return"page"===t.route.name&&t.route.scrollToBlockId?[t.route.scrollToBlockId]:t.historyState?t.historyState.blockIds:[]}function g(e,t){const o=function(e,t){const o=t.map((t=>d.G.createChildStore(e,{table:r.iU,id:t}))).map((e=>a.qA(e))).filter((t=>{let o=!1;const i=t.slice(1).find((e=>{if("block"===e.table)return e.isTransclusionType()&&(o=!0),e.isNavigableBlock()}));return i&&(i.id===e.id||o)})).map((e=>{const t=e.findIndex((e=>"block"===e.table&&e.isNavigableBlock()));return e.slice(1,t).filter((e=>"block"===e.table&&(0,l.BX)(e)))}));return n().uniqBy(n().flatten(o),(e=>e.id))}(e,t);for(const i of o)u.rd({blockId:i.id,state:!0,currentUserId:i.environment.currentUser.id});return o}function h(e,t){const o=function(e,t){const o=t.map((t=>d.G.createChildStore(e,{table:r.iU,id:t,spaceId:e.pointer.spaceId}))).map((e=>a.qA(e))).filter((t=>{const o=t.slice(1).find((e=>"block"===e.table&&e.isNavigableBlock()));return o&&o.id===e.id})).map((e=>{const t=e.findIndex((e=>"block"===e.table&&e.isNavigableBlock()));return e.slice(1,t).filter((e=>{if("block"!==e.table)return!1;const t=e.getParentStore();return"block"===(null==t?void 0:t.table)&&"tab"===(null==t?void 0:t.getType())}))}));return n().uniqBy(n().flatten(o),(e=>e.id))}(e,t);for(const n of o){const e=n.getParentStore();var i;if((null==e?void 0:e.table)===r.iU&&"tab"===(null==e?void 0:e.getType()))p.x2({store:e,id:n.id,currentUserId:null===(i=c.default.state.currentUserStore)||void 0===i?void 0:i.id})}return o}async function f(e,t){await async function(e,t){const o=t.map((t=>d.G.createChildStore(e,{table:r.iU,id:t})));await Promise.all(o.map((e=>a.s(e))))}(e,t);const o=n().uniqBy([...g(e,t),...h(e,t)],(e=>e.id));await async function(e){await Promise.all(e.map((e=>s.r(e))))}(o)}},61045:(e,t,o)=>{o.d(t,{aB:()=>F,bx:()=>L,NQ:()=>V,Zv:()=>N,hl:()=>O,_4:()=>z,YC:()=>W,hQ:()=>j,Q7:()=>Y});var i=o(96486),n=o.n(i),r=o(62518),a=o(14577),s=o(37601),l=o(59488),c=o(68056),d=o(77546),p=o(72133),u=o(47372),m=o(3994),g=o(75987),h=o(95802),f=o(34859),v=o(80796),y=o(64233),b=o(65686),S=o(19111),w=o(69454),k=o(19671),C=o(13023),_=o(88923),M=o(27724),T=o(29337),I=o(10743),P=o(24666),x=o(50906);function B(e,t,o,i){const n=(o-t)/o,r=i/10/60,a=r+(3*i/60-r)*Math.min(n*n,1);return e.device.isIOS?Math.ceil(a):a}const Z=1e3,E=n().throttle((e=>{x.trackEditorDragNearEdgeScroll(e,{direction:"top"})}),Z),R=n().throttle((e=>{x.trackEditorDragNearEdgeScroll(e,{direction:"bottom"})}),Z),A=n().throttle((e=>{x.trackEditorDragNearEdgeScroll(e,{direction:"left"})}),Z),D=n().throttle((e=>{x.trackEditorDragNearEdgeScroll(e,{direction:"right"})}),Z);function F(e){const{environment:t,scroller:o,currentMouseX:i,currentMouseY:n,verticalEdgeThreshold:r,horizontalEdgeThreshold:a,disableVerticalEdgeScroll:s,disableHorizontalEdgeScroll:c}=e,{clientRect:d,scrollTop:p,scrollHeight:u,scrollLeft:m,scrollWidth:g}=o.stores.store.state;if(d){if(o.props.type!==f.Z.X&&!s){const e=n-d.top;let i,a;w.Z.state.phase!==w.i.shown?(i=r,a=(0,l.Y)("supportsNativeBottomBarOverlappingWebView")?d.bottom-w.Z.estimatedNativeWebBottomOverlap()-n:d.bottom-n):(i=.25*w.Z.state.estimatedKeyboardWebViewOverlap,a=d.bottom-w.Z.estimatedNativeWebBottomOverlap()+i-n);const s=0===p,c=p+d.height===u;if(e<r&&!s){const i=B(t,e,r,d.height);o.scrollTo(p-i,void 0),i>0&&E(t)}if(a<i&&!c){const e=B(t,a,i,d.height);o.scrollTo(p+e,void 0),e>0&&R(t)}}if(o.props.type!==f.Z.Y&&!c){const e=i-d.left,n=d.right-i,r=0===m,s=m+d.width===g;if(e<a&&!r){const i=B(t,e,a,d.width);o.scrollTo(void 0,m-i),i>0&&A(t)}if(n<a&&!s){const e=B(t,n,a,d.width);o.scrollTo(void 0,m+e),e>0&&D(t)}}}}function L(e){const{element:t,scrollers:o,vertical:i,horizontal:n,animate:r}=e,a=t.getBoundingClientRect();if(i&&o.verticalScroller){const{reveal:e}=i,t=i.paddingToTopEdge||64,n=i.paddingToBottomEdge||64,s=o.verticalScroller,l=s&&s.getClientRect();if(s&&l){const o=l.top+t,i=l.bottom-n,c=a.top>o&&a.top<i,d=a.bottom>o&&a.bottom<i,p=a.top<o&&a.bottom>i,u=a.bottom-i,m=a.top-o;"top"===e?c||s.scrollByOffset(m,0,{animate:r}):"bottom"===e?d||s.scrollByOffset(u,0,{animate:r}):c||d||p||(Math.abs(u)<Math.abs(m)?s.scrollByOffset(u,0,{animate:r}):s.scrollByOffset(m,0,{animate:r}))}}if(n&&o.horizontalScroller){const{reveal:e}=n,t=n.paddingToLeftEdge||64,i=n.paddingToRightEdge||64,s=o.horizontalScroller,l=s&&s.getClientRect();if(s&&l){const o=l.left+t,n=l.right-i,c=a.left>o&&a.left<n,d=a.right>o&&a.right<n,p=a.left<o&&a.right>n,u=a.right-n,m=a.left-o;"left"===e?c||s.scrollByOffset(0,m,{animate:r}):"right"===e?d||s.scrollByOffset(0,u,{animate:r}):c||d||p||(Math.abs(u)<Math.abs(m)?s.scrollByOffset(0,u,{animate:r}):s.scrollByOffset(0,m,{animate:r}))}}}function V(e){const{component:t,horizontal:o,vertical:i,animate:n}=e;if(!t)return;const a=r.findDOMNode(t);return a&&a instanceof Element?L({vertical:i,animate:n,horizontal:o,element:a,scrollers:{verticalScroller:t.getContextVerticalScroller?t.getContextVerticalScroller():void 0,horizontalScroller:t.getContextHorizontalScroller?t.getContextHorizontalScroller():void 0}}):void 0}function N(){if(M.default.state.pivot)O([M.default.state.pivot.id]);else{O(M.default.state.stores.map((e=>e.id)))}}function O(e,t){const o=h.C.findScrollToSelectablesFromIds(e)[0];if(o){const{disableScrollToRevealHorizontal:e}=o.props;V({component:o,vertical:{reveal:"closest"},horizontal:e?void 0:{reveal:"closest"},animate:t})}}let U;function H(e){let{position:t}=e;const{paddingTop:o}=e;if("editing"!==P.default.state.mode)return;let i=e.paddingBottom;u.Z.find((e=>e.props.show))&&(i+=s.O);const n=p.get();if(n){const e=d.SD(n.commonAncestorContainer);if(!e)return;const r=d.hI(e).find((e=>e.scrollHeight>e.clientHeight));if(!r)return;const a=p.getRect(n);if(!a||!r)return;const s=r.getBoundingClientRect();if(!(n.startContainer instanceof Text)){const e=a;e.top+=4,e.bottom-=5,e.height-=9}const l=a.top<s.top+o,c=a.bottom>s.bottom-i;if(n.startContainer instanceof Text&&n.startOffset!==n.endOffset)return;if(t===U.natural)if(c)t=U.bottom;else{if(!l)return;t=U.top}if(t===U.top){const e=r.scrollTop+a.top,t=s.top+o;r.scrollTop=e-t}else if(t===U.bottom){const e=r.scrollTop+a.bottom,t=s.bottom-i;r.scrollTop=e-t}else if(t===U.middle){const e=r.scrollTop+a.top,t=s.top+s.height/2-10;r.scrollTop=e-t}}}function z(){return w.Z.estimatedNativeWebBottomOverlap()+20}function W(e){if(g.Z.isInlineAutocompleteOpen())return!0;const t=e.device.isMobile&&(!e.device.isNative||e.device.isTablet);return!!(!t&&S.Z.state.open||!t&&I.Z.state.open||!t&&function(){var e;const t="editing"===P.default.state.mode&&(null===(e=(0,c.QY)(P.default.state.multiSelection))||void 0===e?void 0:e.store);if(t){const e=t.getRecordStoreAtRootPath();if("block"===e.table){const t=e.getValue(),o=t&&t.type;return"link_to_page"===o||"link_to_collection"===o}}return!1}()||y.Z.state.open)}function j(e){const t=m.Z.shouldPreventMobileAutoScroll(e);W(e)?H({position:U.top,paddingTop:20,paddingBottom:z()}):t||k.Z.state.isOpen&&!_.default.state.open||C.Z.state.isOpen||H({position:U.natural,paddingTop:20,paddingBottom:z()})}!function(e){e[e.top=0]="top",e[e.middle=1]="middle",e[e.bottom=2]="bottom",e[e.natural=3]="natural"}(U||(U={}));const K=n().once((e=>{const{device:t}=e;return new a.Z((()=>t.isMobile&&v.Z.state.isDragging||t.isMobile&&T.Z.state.swiping?f.Z.All:b.Z.getPreventScrollType()),{debugName:"preventScrollTypeStore"})}));function Y(e){return K(e).state}},31299:(e,t,o)=>{o.d(t,{vp:()=>U,E5:()=>H,tw:()=>z,D7:()=>W,nJ:()=>j,df:()=>K,qh:()=>Y,M0:()=>q,bI:()=>$,bm:()=>J,RT:()=>Q,$w:()=>ee,RF:()=>te,sC:()=>ne,pz:()=>re,Yu:()=>ae,CO:()=>le,Te:()=>ce,yy:()=>de,ri:()=>pe,WL:()=>ue,UJ:()=>me,zf:()=>ge});var i=o(43261),n=o.n(i),r=o(96486),a=o.n(r),s=o(15070),l=o(33728),c=o(31942),d=o(63306),p=o(27006),u=o(4615),m=o(45953),g=o(80984),h=o(21202),f=o(77420),v=o(6287),y=o(19889),b=o(92338),S=o(64684),w=o(5500),k=o(70203),C=o(97880),_=o(7928),M=o(95477),T=o(4708),I=o(98165),P=o(67669),x=o(15447),B=o(80084),Z=o(16639),E=o(15517),R=o(21115),A=o(79315),D=o(10161),F=o(69327),L=o(3815),V=o(78291),N=o(54642),O=o(21325);const U=300,H=75;async function z(e){const{currentSpaceStore:t,currentSpaceViewStore:o}=A.default.state;if(t)return await B.hb({environment:e,currentSpaceStore:t,currentSpaceViewStore:o})}async function W(e){const{environment:t,query:o,limit:i,spaceId:n,requireEditPermissions:r,excludeTemplates:a,source:s,boostRecentlyViewedPages:l}=e,{currentSpaceStore:c}=A.default.state,d={results:[],recordMap:m.Ak.createWithRoles().toJson({allowVersionDowngrade:!1}),total:0,trackEventProperties:{}};if(!c)return d;const p=await z(t),u=b.u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:a,requireEditPermissions:r||void 0}),g={field:"relevance"};if(!o&&p){const e=B.iA({query:{query:{text:o,filters:u,sort:g},limit:i},localCachedPages:p,userId:t.currentUser.id});return e||d}const h=await N.search(t,{type:b.n8.BlocksInSpace,query:o,spaceId:n,limit:i,filters:u,sort:g,source:s,recentPagesForBoosting:l?(0,x.Wk)(F.Z.getWithoutSubscribing(n)):void 0});if("failed"===h.type)throw h.error;return h.data}async function j(e){const t=await W(e);return{results:t.results.map((e=>e.id)),recordMap:t.recordMap}}async function K(e){const{environment:t,query:o,collectionId:i,limit:n,spaceId:r,excludeTemplates:s,source:l,includePublicPagesWithoutExplicitAccess:c,boostRecentlyViewedPages:d,ignoresHighlight:p}=e,u=new Array,m=await z(t),g=b.u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:c,excludeTemplates:s}),h={field:"relevance"},f=N.search(t,{type:b.n8.BlocksInCollection,query:o,spaceId:r,collectionId:i,limit:n,filters:g,sort:h,source:l,recentPagesForBoosting:d?(0,x.Wk)(F.Z.getWithoutSubscribing(r)):void 0,ignoresHighlight:p});if(m){const e={table:v.v,id:i,spaceId:r},a=new L.NW(t,e);await a.load();const s=B.iA({query:{query:{text:o,filters:a.isPageTreeCollection()?{...g,ancestors:[i]}:{...g,parentId:i},sort:h},limit:n},localCachedPages:m,userId:t.currentUser.id});s&&u.push(...s.results)}const y=await f;if("failed"===y.type){if(0===u.length)throw y.error}else{let e=y.data.results;o||(e=B.YB({sort:h,batchSize:n,currentUserId:t.currentUser.id,unsorted:e})),u.push(...e)}return{results:a().compact(a().uniq(u.map((e=>e.id))))}}async function Y(e){const{environment:t,query:o,parentId:i,limit:n,spaceId:r,excludeTemplates:s,source:l,includePublicPagesWithoutExplicitAccess:c,boostRecentlyViewedPages:d,ignoresHighlight:p}=e,[u,m]=await Promise.all([N.search(t,{type:b.n8.BlocksInParent,query:o,spaceId:r,parentId:i,limit:n,filters:b.u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:c,excludeTemplates:s}),sort:{field:"relevance"},source:l,recentPagesForBoosting:d?(0,x.Wk)(F.Z.getWithoutSubscribing(r)):void 0,ignoresHighlight:p}),G(e)]);if("failed"===u.type)throw u.error;return{results:a().compact(a().uniq([m,...u.data.results.map((e=>e.id))]))}}async function G(e){const{environment:t,query:o,parentId:i,spaceId:n}=e,r=(0,g.Wj)({url:o,baseUrl:M.Z.domainBaseUrl,publicDomainName:M.Z.publicDomainName,isMobile:t.device.isMobile,protocol:M.Z.protocol,currentUrl:ncd.href()}),a="page"===r.name?r.peekViewBlockId||r.blockId:void 0,s=((0,u.qn)(o)?(0,u.wr)(o):void 0)||a;if(s){const e={table:h.iU,id:s},o=new L.G(t,e);await o.load();const r=o.id,a=o.getParentId(),l=o.getSpaceId();if(a===i&&l===n)return r}}async function X(e){const{environment:t,query:o,ancestorId:i,limit:n,excludeTemplates:r,source:a}=e,s=await N.search(t,{type:b.n8.BlocksInAncestor,query:o,ancestorId:i,filters:b.u4({navigableBlockContentOnly:!0,excludeTemplates:r}),sort:{field:"relevance"},limit:n,source:a});if("failed"===s.type)throw s.error;return s.data}async function q(e){return{results:(await X(e)).results.map((e=>e.id))}}async function $(e){const{environment:t,query:o,limit:i,ancestorId:n,spaceId:r}=e,a=0===o.trim().length?{field:"lastEdited",direction:"desc"}:{field:"relevance"},s={query:o,filters:b.u4({isDeletedOnly:!0,navigableBlockContentOnly:!0,excludeTemplates:!1,editedBy:e.editedById?[e.editedById]:[]}),sort:a,limit:i,spaceId:r,source:"trash"},l=n?N.search(t,{type:b.n8.BlocksInAncestor,...s,ancestorId:n}):N.search(t,{type:b.n8.BlocksInSpace,...s}),c=await l;if("failed"===c.type)throw c.error;{const{results:e,recordMap:t,total:o}=c.data;return{results:e.map((e=>e.id)),recordMap:m.Ak.create(t),endOfResultsReached:o===e.length}}}async function J(e,t){const{query:o,limit:i,source:n,requireEditPermissions:r}=t,{currentSpaceStore:s}=A.default.state;if(!s)return{results:[],total:0};const[l,c]=await Promise.all([he(e,{...t,spaceId:s.id,requireEditPermissions:r}),N.search(e,{type:b.n8.CollectionsInSpace,query:o,spaceId:s.id,limit:i,filters:b.u4({excludeTemplates:!0,requireEditPermissions:r}),sort:{field:"relevance"},source:n})]),d=a().union("success"===c.type?c.data.results.map((e=>e.id)):[],l).slice(0,i);return{results:d,total:"success"===c.type?c.data.total:d.length}}async function Q(e){const{environment:t,collectionViewBlockStore:o,parentStore:i,query:n,limit:r,requireEditPermissions:s}=e;if(!i.isDefaultRecordCache())return{results:[],total:0};let l=[],c=0;if(!n){const{currentSpaceStore:e}=A.default.state,n=t.currentUser.id;e&&(l=[...(0,E.lG)({currentUserId:n,spaceId:e.id}).map((e=>L.NW.createChildStore(i,{table:v.v,id:e})))]),l=[...a().compact(null==o?void 0:o.getCollectionViewStores().map((e=>e.getCollectionStore()))),...l],l=a().uniqBy(l,(e=>e.id)).filter((e=>!s||e.canEdit()))}const d=await J(t,{query:n,limit:r,source:"collection_settings_source",requireEditPermissions:s});return l=[...l,...d.results.map((e=>L.NW.createChildStore(i,{table:v.v,id:e})))],c=d.total,l=l.filter((e=>!(0,I.wf)(e)&&e.canRead())),await Promise.all(l.map((async e=>{await e.load()}))),{results:a().compact([...a().uniqBy(l,(e=>e.id)).slice(0,r).map((e=>e.id))]),total:c}}function ee(e){const{query:t,intl:o}=e,{currentSpaceStore:i}=A.default.state,n=null==i?void 0:i.getPermissionGroups();if(!n)return[];return t?(0,c.ZP)(t,n,(e=>(0,Z.kF)({intl:o,group:e}))):n}async function te(e){const{query:t}=e,{currentSpaceStore:o}=A.default.state;if(!o)return[];return ie({currentSpaceStore:o,query:t,botIds:await oe(e)})}async function oe(e){const{environment:t}=e,{currentSpaceStore:o}=A.default.state;if(!o)return[];const i=o.id;await O.OR({environment:t,spaceId:i});const{data:n}=V.default.state;if(!n)return[];return(0,R.NM)(n).map((e=>e.botId))}async function ie(e){const{currentSpaceStore:t,query:o,botIds:i}=e,n=a().compact(await Promise.all(i.map((async e=>{const o=(0,L.Kv)(t,{table:f.cZ,id:e,spaceId:t.id});return await o.load(),o.getValue()}))));return o?(0,c.ZP)(o,n,s.y2):n}async function ne(e){const{query:t,environment:o,spaceId:i,botSettings:n}=e;if(!i)return[];const r=await N.searchIntegrations(o,{query:t});if("success"===r.type){const e=r.data.integrationIds,t=n&&n.integration_approval_statuses?Object.keys(n.integration_approval_statuses):[],o=Boolean(null==n?void 0:n.integration_restrictions),i=Boolean("approved_or_built_by_notion"===(null==n?void 0:n.integration_restrictions));return o?e.filter((e=>i?t.includes(e)||(0,w.BP)({integrationId:e,env:M.Z.env}):t.includes(e))):e}if("failed"===r.type)throw r.error;(0,C.t1)(r)}async function re(e){var t;let{currentSpaceStore:o,query:i,userIds:n}=e;const r=a().compact(await Promise.all(n.map((async e=>{const t=L.U6.createChildStore(o,{table:y.KJ,id:e});return await t.load(),t.getValue()})))),s="on"===D.default.getGroup("user_similarity_in_ranking"),d=new Set(o.getEmailDomains()),p=s?(null===(t=V.default.state.data)||void 0===t?void 0:t.userSimilarity)??{}:{},u=Math.max(...Object.values(p));function m(e){var t;return e===(null===(t=A.default.state.currentUserRootStore)||void 0===t?void 0:t.userId)?u+1e-5:p[e]??0}const g=a().isEmpty(p)?r:r.sort(((e,t)=>{const o=m(e.id);return m(t.id)-o}));return i?(0,c.ZP)(i,g,_.of,{getSortScore:e=>{const{original:t,score:o}=e,i=t.email&&(0,l.Gd)(t.email);return o*(i&&d.has(i)?-2:-1)}}):r}async function ae(e){const{currentSpaceStore:t}=A.default.state;if(!t)return[];const o=e.query.startsWith("@")?e.query.slice(1):e.query,i=await se(e);return await re({currentSpaceStore:t,query:o,userIds:i})}async function se(e){const{environment:t,membersOnly:o}=e,{currentSpaceStore:i}=A.default.state;if(!i)return[];await O.OR({environment:t,spaceId:i.id});const{data:n}=V.default.state;if(!n)return[];const r=(0,R.CM)(n).filter((e=>!(o&&!(0,p.Jy)(e.role)))),{mainEditorCurrentBlockStore:s,currentUserStore:l}=A.default.state,c=s&&!o?(0,P.YO)(s).flatMap((e=>{let{permissionItem:t}=e;return(0,p.jg)(t)?[t.user_id]:[]})):[],d=((0,T.F$)()&&s?function(e,t){const o=I.VP(e);if(o){const e=new Set((0,S.Hf)({membership:o.getRawMembership()}));return t.filter((t=>"none"!==t.role||t.isPageGuest||t.isTeamGuest&&e.has(t.userId)))}return t.filter((e=>"none"!==e.role||e.isPageGuest))}(s,r):r).map((e=>e.userId));return a().uniq([...a().compact([null==l?void 0:l.userId]),...c,...d])}async function le(e){const[t,o]=await Promise.all([ae(e),te(e)]);return{users:t,bots:o}}async function ce(e){const[t,o]=await Promise.all([se(e),oe(e)]);return{userIds:t,botIds:o}}async function de(e,t){const o=(0,l.H3)(t);if((0,l.oH)(o)&&o){const t=await N.findUser(e,{email:o});if("failed"===t.type)throw t.error;const i=t.data;return i.value?{user:i.value.value}:{email:o}}return{}}async function pe(e){const{query:t,userIds:o,botIds:i}=e,{currentSpaceStore:n}=A.default.state;if(!n)return{users:[],bots:[]};const[r,a]=await Promise.all([re({currentSpaceStore:n,query:t,userIds:o}),ie({currentSpaceStore:n,query:t,botIds:i})]);return{users:r,bots:a}}async function ue(e){const{nearBlock:t,environment:o,query:i,source:n}=e,{currentSpaceStore:r}=A.default.state,a=t&&(0,P.YO)(t).find((e=>{let{permissionItem:t}=e;return(0,p.$D)(t)}));if(r){return(await W({environment:o,query:i,limit:20,spaceId:r.id,requireEditPermissions:!1,excludeTemplates:!0,source:n,boostRecentlyViewedPages:!0})).results}if(a&&a.from.table===h.iU){return(await X({environment:o,query:i,limit:20,ancestorId:a.from.blockId,excludeTemplates:!0,source:n})).results}return[]}async function me(e){const{environment:t,query:o,source:i,limit:n}=e,{currentSpaceStore:r}=A.default.state;if(!r)return[];return(await W({environment:t,query:o,limit:n||20,spaceId:r.id,requireEditPermissions:!0,excludeTemplates:!0,source:i,boostRecentlyViewedPages:!1})).results.filter((e=>{const t=L.G.createChildStore(r,{table:h.iU,id:e.id}),o=(0,I.fJ)(t);return(0,d.$t)(o)}))}async function ge(e){let{spaceViewStore:t,query:o,teamStores:i}=e;const n=a().compact(await Promise.all(i.map((async e=>(await e.load(),e.getValue()))))),r=t.getTeamsStores(),s=new Set(r.map((e=>e.id)));return o?(0,c.ZP)(o,n,(e=>e.name),{getSortScore:e=>{const{original:t,score:o}=e;return o*(s.has(t.id)?-2:-1)}}):n}function he(e,t){const{query:o,limit:i,spaceId:r,requireEditPermissions:a}=t,s=[];return e.defaultRecordCache.inMemoryRecordCache.forEachRecord(e.currentUser.id,((e,t)=>{if(!(s.length>=i)&&e.table===v.v&&t.value){const i=t.value;if(i&&i.space_id===r){if(a&&!(0,p.J5)(t.role))return;const r=(0,k.Q)(i.name);n().test(o,r)&&s.push(e.id)}}})),s}},87531:(e,t,o)=>{o.d(t,{Kf:()=>p,UT:()=>u,IB:()=>m,qm:()=>g});var i=o(4615),n=o(89101),r=o(10161),a=o(22294),s=o(55320),l=o(29026),c=o(50906),d=o(5978);function p(e){s.default.state.open?m():u(e)}function u(e){const{environment:t,renderAsPage:o}=e,a=(0,i.ZP)(),p=Date.now(),u=r.default.getGroup("search-two-step-ui"),m="nav-local-only"===u?"nav-local-only":"nav-local-n-title"===u?"nav-local-n-title":"default";if(Boolean(o))d.navigate({environment:t,url:`${n.VP.nativeTab}/search`,redirect:!0}),s.default.setState({open:!1,openAsPage:!0,openedTimeMs:p,sessionId:a,searchMode:m});else{if(s.default.state.open)return;s.default.setState({open:!0,openAsPage:!1,openedTimeMs:p,sessionId:a,searchMode:m})}"default"!==m?l.ZP.enableNavigationalMode():l.ZP.disableNavigationalMode(),c.trackOpenSearch(e.environment,{from:e.analyticsFrom,searchSessionId:a})}const m=()=>{s.default.state.open&&(s.default.reset(),a.Z.setKeyboardMode(!1))};function g(){s.default.update((e=>({...e,searchMode:"full-content"}))),l.ZP.disableNavigationalMode()}},5851:(e,t,o)=>{o.d(t,{n:()=>u,y:()=>m});var i=o(96486),n=o.n(i),r=o(5366),a=o(33929),s=o(47307),l=o(9953),c=o(29974),d=o(30149);const p=(0,r.defineMessages)({saveFieldError:{id:"securitySAMLSettings.saveSettingsError.message",defaultMessage:"Something went wrong.",description:"An error that shows up when something goes wrong while trying to save data"}});function u(e,t){const{securitySettingsState:o,spaceStore:i}=t,{disablePublicAccess:n,disableGuests:r,disableMoveToSpace:a,disableExport:s,disableSpacePageEdits:l,disablePublicAccessRequests:p,disableTeamCreation:u,disableMembershipRequests:m,disableGuestMembershipRequests:g,enableAiFeature:h,disableTeamGuests:f}=o;return d.createAndCommit({userAction:"securitySettingsActions.saveSecuritySettings",environment:e,perform:t=>{c.Xr({environment:e,transaction:t,spaceStore:i,disablePublicAccess:n,disableGuests:r,disableMoveToSpace:a,disableExport:s,disableSpacePageEdits:l,disablePublicAccessRequests:p,disableTeamCreation:u,disableMembershipRequests:m,disableGuestMembershipRequests:g,enableAiFeature:Boolean(h),disableTeamGuests:f})}})}function m(e,t){const{securitySettingsStore:o,spaceStore:i,fields:r}=t,c={...o.state},u={...o.state,...r};o.setState(u),d.createAndCommit({userAction:"SecuritySettings.saveToggle",environment:e,perform:e=>{e.postSubmitCallbacks.push((e=>{if(e)return s.showErrorMessage(a.default.formatMessage(p.saveFieldError)),void o.setState(c)}));const t=n().omitBy({disable_public_access:r.disablePublicAccess,disable_guests:r.disableGuests,disable_move_to_space:r.disableMoveToSpace,disable_export:r.disableExport,disable_space_page_edits:r.disableSpacePageEdits,disable_public_access_requests:r.disablePublicAccessRequests},(e=>n().isNil(e)));l.sW({store:i,data:t,transaction:e})}})}},42858:(e,t,o)=>{o.d(t,{Od:()=>j,MD:()=>K,Qw:()=>Y,Cl:()=>G,is:()=>X,mp:()=>q,aO:()=>$,at:()=>Q,yt:()=>ee,dK:()=>te,QZ:()=>oe,Ah:()=>ie,jQ:()=>ne,VJ:()=>re,DQ:()=>ae,WG:()=>se,eJ:()=>le,YP:()=>ce,ZJ:()=>de,uE:()=>pe,QK:()=>ue,DV:()=>me});var i=o(96486),n=o.n(i),r=o(1302),a=o(41432),s=o(5366),l=o(98459),c=o(21202),d=o(49914),p=o(95477),u=o(617),m=o(28020),g=o(40959),h=o(22889),f=o(33929),v=o(65598),y=o(41984),b=o(58202),S=o(95802),w=o(79315),k=o(88923),C=o(3815),_=o(27724),M=o(50906),T=o(54642),I=o(51127),P=o(41433),x=o(47307),B=o(54532),Z=o(54604),E=o(94419),R=o(87420),A=o(5978),D=o(61045),F=o(24677),L=o(84084),V=o(64964),N=o(21325),O=o(34147),U=o(98104),H=o(30149),z=o(63113);const W=(0,s.defineMessages)({deletePages:{id:"action.deletePages.snackBarMessage",defaultMessage:"Moved to trash",description:"label on the snackbar when deleting pages"}});function j(e){var t,o;const{store:i,transaction:n}=e,r=S.C.findSelectablesFromStore(i).find((e=>Boolean(e.props.onRemove)));null==r||null===(t=(o=r.props).onRemove)||void 0===t||t.call(o,{transaction:n})}function K(e){const{blocks:t,transaction:o}=e;if(1===t.length){const e=t[0];e&&v.PF(e)&&j({store:e,transaction:o})}}async function Y(e){const{environment:t,blocks:o}=e;let i=!0;const r=[];for(const l of o){const e=b.R.findBlockFromStore(l);if(e&&n().isFunction(e.handleRemoveBlockFromComment)){if(await e.handleRemoveBlockFromComment())continue}else if(e&&n().isFunction(e.canRemoveBlock)){const t=await e.canRemoveBlock();if(!t.canRemove)return;i=t.canUndo}const o=await I.SC({environment:t,block:l,action:"delete"});if("user_canceled"===o)return;o.length>1?r.push(...o):r.push(l)}if(0===r.length)return;const{serverCommitResult:a}=H.createAndCommit({userAction:"selectableBlockActions.removeBlocksWithMaybeConfirmation",environment:t,canUndo:i,perform:e=>{G({environment:t,blocks:r,transaction:e})}});await a;const{currentSpaceStore:s}=w.default.state;s&&r.some((e=>e.isPageBlock()))&&V.d4({item:{label:f.default.formatMessage(W.deletePages)},undoFunc:()=>{for(const e of r)T.restoreBlock(t,{pointer:{table:c.iU,id:e.id,spaceId:e.pointer.spaceId||s.id}})}}),r.some((e=>{var t;return e.id===(null===(t=k.default.peekTarget.state)||void 0===t?void 0:t.id)}))&&R.xv(t,void 0)}function G(e){const{environment:t,blocks:o,transaction:i,preventClearSelection:r}=e,s=function(e){const t=S.C.getMembersByDOMOrder({filter:()=>!0}),o=n().findIndex(t,(t=>t.props.store===e)),i=t[o];if(!i)return;const r=i.getContextSelectableContainer(),a=n().slice(t,0,o),s=n().findLast(a,(e=>e.props.canSelect&&e.getContextSelectableContainer()===r));if(s)return s.props.store;const l=n().slice(t,o+1).find((e=>Boolean(e.props.canSelect&&e.getContextSelectableContainer()===r)));if(l)return l.props.store}(o[0]);for(const n of o)j({store:n,transaction:i});r||(F.ZH(t),F.Fp({pivot:s})),(u._J({environment:t,blocks:o,publicEditMode:void 0})||u.Nn({environment:t,blocks:o,publicEditMode:void 0})||u.oY({environment:t,blocks:o,publicEditMode:void 0})||o.some((e=>{var t;return e.getType()===a.Ti.transclusionContainer||(null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isPageTreeCollection())})))&&(i.postSubmitCallbacks.push((e=>{e||T.deleteBlocks(t,{blocks:o.map((e=>({id:e.id,spaceId:(0,l.CG)(e.pointer.spaceId)}))),permanentlyDelete:!1})})),A.navigateAwayIfCurrentPage({environment:t,blocks:o})),r||U.ZH(t)}function X(e){const{environment:t,blocks:o,selection:i,transaction:r,replaceEmptyTextBlock:a,preventSetSelection:s}=e,l=m.RM();if(!l)throw new Error("No root store.");let c;if(i.length>0){const e=n().last(i);let s=e;if(Boolean(o.find((e=>e.isType("column_list"))))){const t=null==e?void 0:e.findRecordStoreUIAncestor((e=>e&&e instanceof C.G&&e.isType("column_list"))).ancestor;t&&t instanceof C.G&&(s=t)}const d=S.C.find((e=>e.props.store===s&&e.props.canInsertBelow&&e.props.onInsertBelow));if(d&&d.props.onInsertBelow)c=n().compact(d.props.onInsertBelow({insertStores:o,transaction:r})),a&&e&&e.isEmptyTextBlock()&&G({environment:t,blocks:[e],transaction:r});else{c=n().clone(o).reverse().map((e=>E.Ce({parent:l.getContentStore(),prepend:e,transaction:r}).child))}}else if(l.isCollectionView()){const e=b.R.findBlockFromStoreWithMethod(l,"insertBlocks");if(!e)throw new Error("No collection view found.");c=e.insertBlocks(o,r)}else{const e=l.getContentStore();c=o.map((t=>E.R3({parent:e,append:t,transaction:r}).child))}return Boolean(s)||(c=c.flatMap((e=>e.isType("column_list")?e.getContentStores().flatMap((e=>e.getContentStores())):[e])),F.Z5({environment:t,stores:c})),c}function q(e){const{blocks:t}=e,o=t[0];if(o){const t=S.C.findSelectableFromStore(o);t&&t.props.onEnter&&t.props.onEnter(e)}}function $(e){const{environment:t,createBlockItem:o,selection:i,transaction:n,analyticsFrom:r,preventSetSelection:a}=e,s=_.default.getCurrentRecordCache();let l;if(N.M_(t)&&o&&s){l=X({environment:t,blocks:[P.fC({environment:t,createBlockItem:o,transaction:n,inMemoryRecordCache:s,from:r})],selection:i,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:a})[0]}return l}function J(e){const{environment:t,createBlockItem:o,selection:i,transaction:n,analyticsFrom:r}=e,a=_.default.getCurrentRecordCache();let s;if(N.M_(t)&&o&&a){s=function(e){const{environment:t,selection:o,transaction:i}=e,{blocks:n}=e,r=m.RM();if(!r)throw new Error("No root store.");if(o.length>0){const e=o[0],r=S.C.find((t=>t.props.store===e&&t.props.canInsertAbove&&t.props.onInsertAbove));if(!r||!r.props.onInsertAbove)throw new Error("No Selectable found.");const a=r.props.onInsertAbove({insertStores:n,transaction:i});return F.Z5({environment:t,stores:a}),a}{const e=r.getContentStore(),o=n.map((t=>E.R3({parent:e,append:t,transaction:i}).child));return F.Z5({environment:t,stores:o}),o}}({environment:t,blocks:[P.fC({environment:t,createBlockItem:o,transaction:n,inMemoryRecordCache:a,from:r})],selection:i,transaction:n})[0]}return s}function Q(e){const{environment:t,selection:o,transaction:i}=e,n=$({...e,preventSetSelection:!0});n&&me({environment:t,insertedStores:[n],isCreated:!0}),K({transaction:i,blocks:o})}function ee(e){const{environment:t,blocks:o,transaction:i,preferDuplicateLocation:n}=e,r=o.map((e=>{const o=!e.isTransclusionType(),[r,a]=B.Qi({environment:t,store:e,addCopyName:(0,y.Z)(e),transaction:i,deepCopyTransclusionContainers:o,resolveTemplateVariables:!(e.isInsideTemplate()||e.isInsideFactoryOrDuplicateBlocksAction()),targetSpaceId:(0,l.CG)(e.pointer.spaceId),baseUrl:p.Z.domainBaseUrl,publicDomainName:p.Z.publicDomainName,preferDuplicateLocation:n});return a.then((e=>{e&&x.showErrorMessage(e)})),r}));X({environment:t,blocks:r,selection:o,transaction:i,replaceEmptyTextBlock:!1})}function te(e){const t=e.blocks[0],{blockLocationOfTargetBlock:o}=e,i=b.R.find((e=>e instanceof d.Z&&e.props.store===t&&(!o||e.props.blockLocation===o)));i&&i.canRenderFullScreen()&&Z.ui({environment:i.environment,renderFullScreenNode:i.renderFullScreenNode,fullScreenNodeRect:i.getFullScreenNodeRect(),block:t})}function oe(e){let t;e.blocks.find((e=>{const o=b.R.findBlockFromStoreWithMethod(e,"activate");return!!o&&(t=o,!0)})),t&&t.activate()}function ie(e){e.blocks.forEach((t=>{const o=t.getParentStore();o&&o.table===c.iU&&o.getType()===a.Ti.tab&&O.x2({store:o,id:t.id,currentUserId:e.environment.currentUser.id})}))}function ne(e){const t=e.blocks[0],o=b.R.findBlockFromStoreWithMethod(t,"configure");o&&(o.configure(),M.trackConfigureTemplateButton(e.environment,{from:"block_action"}))}function re(e){const t=e.blocks[0],o=b.R.findBlockFromStoreWithMethod(t,"caption");o&&o.caption()}function ae(e,t){const o=n().compact(S.C.findSelectablesFromIds(t)).map((e=>e.props.store));F.Z5({environment:e,stores:o})}function se(e,t){const o=S.C.findScrollToSelectablesFromIds(t);o[0]&&(D.NQ({component:o[0],vertical:{reveal:"top"},horizontal:{reveal:"closest"}}),F.Z5({environment:e,stores:o.map((e=>e.props.store))}))}function le(e){const{blocks:t,method:o}=e,i=t[0].findRecordStoreUIAncestor((e=>e instanceof C.G&&e.isCollectionView())).ancestor;if(i){const e=b.R.findBlockFromStoreWithMethod(i,o);e&&e[o]()}}function ce(e){const{environment:t,blocks:o}=e,i=o[0].findRecordStoreUIAncestor((e=>e instanceof C.G&&e.isCollectionView())).ancestor;i&&A.navigateToBlock({environment:t,store:i,visitType:h.vu.Link})}function de(e){const{blocks:t,transaction:o,environment:i}=e,n=$({environment:i,selection:t,createBlockItem:g.Hc.text,analyticsFrom:"text_insert_below",transaction:o});return n&&r.default.afterNextFlush((()=>{L.hb({environment:i,blockStore:n})})),n}function pe(e){const{blocks:t,transaction:o,environment:i}=e,n=J({environment:i,selection:t,createBlockItem:g.Hc.text,analyticsFrom:"text_insert_above",transaction:o});return n&&r.default.afterNextFlush((()=>{L.hb({environment:i,blockStore:n})})),n}function ue(e){const{block:t,transaction:o,environment:i}=e,n=$({environment:i,selection:[t],createBlockItem:g.Hc.text,analyticsFrom:"text_insert_right",transaction:o});if(n){const e=z.uo({environment:i,blocks:[t,n],transaction:o});r.default.afterNextFlush((()=>{L.hb({environment:i,blockStore:e[1]})}))}return n}function me(e){const{environment:t,insertedStores:o,isCreated:i}=e;i?r.default.afterNextFlush((()=>{const e=o[0];if(!e)return;const i=b.R.findBlockWithMethodFromStore(e,"handleCreated");i?i.handleCreated():(F.Ys({environment:t,store:e}),F.Db(t))})):F.Z5({environment:t,stores:o})}},24677:(e,t,o)=>{o.d(t,{KX:()=>B,ji:()=>E,OS:()=>R,rs:()=>A,aw:()=>D,$Y:()=>F,Af:()=>L,Fp:()=>V,wI:()=>N,Z5:()=>O,Ys:()=>U,eP:()=>H,Db:()=>z,yu:()=>W,ZH:()=>j,zJ:()=>K,e2:()=>G,DI:()=>X,FC:()=>$,td:()=>J,w5:()=>Q,hn:()=>ee,Jy:()=>te,Ch:()=>oe});var i=o(96486),n=o.n(i),r=o(55010),a=o(1302),s=o(95371),l=o(77181),c=o(28314),d=o(69645),p=o(77505),u=o(35328),m=o(27406),g=o(16339),h=o(95802),f=o(12211),v=o(50628),y=o(27724),b=o(45131),S=o(64434),w=o(61338),k=o(89951),C=o(47798),_=o(61045),M=o(8713),T=o(84084),I=o(98104),P=o(29373),x=o(30149);function B(){const e=y.default.getCurrentDefaultContainer();if(e){return h.C.getMembersByDOMOrder({filter:t=>t.getContextSelectableContainer()===e&&t.props.canSelect}).map((e=>e.props.store))}return[]}function Z(e){const t=y.default.state.stores,o=y.default.state.pivot,i=n().compact(n().without(t,o));let r;r=o===n().last(t)?t[t.length-2]:t[1],O({environment:e,stores:i,pivot:r})}function E(e){const t=c.yA();return e.device.isMac?t.shift&&t.command:t.shift&&t.option}function R(){return c.yA().shift}function A(e){e.sort(((e,t)=>(0,r.Z)(h.C.findNodeFromStore(e),h.C.findNodeFromStore(t))))}function D(e){const t=new Array(e.length);return h.C.forEach((o=>{if(o.props.canSelect){const i=e.indexOf(o.props.store);if(i>=0){const e=o.getNode();e&&(t[i]=e)}}})),e.filter(((o,i)=>{const n=t[i];return o&&!e.some(((e,o)=>{const i=t[o];return Boolean(i&&i!==n&&n&&i.contains(n))}))}))}function F(e){y.default.setState({...y.default.state,phase:e.phase}),e.phase===y.SelectionPhase.Editing||e.preventClearEditingText||I.ZH(e.environment)}function L(e){const{stores:t}=e,o=y.default.state.stores,i=n().union(t,o);i.length===t.length&&i.length===o.length||y.default.setState({...y.default.state,stores:e.stores}),t.length>0&&(S.wG(),(0,p.Mp)(t)||M.MO())}function V(e){y.default.setState({...y.default.state,pivot:e.pivot})}function N(e){const{stores:t}=y.default.state;L({stores:t.map((t=>t===e.store?e.replace:t))})}function O(e){const{environment:t}=e,o=D(e.stores);L({stores:o}),F({environment:e.environment,phase:e.phase||y.SelectionPhase.Selected}),1===o.length&&function(e){var t;const o=e.anchor,i=null===(t=h.C.findSelectableFromStore(o))||void 0===t?void 0:t.getNode();let n;i&&(n=y.default.getDefaultContainerFromTarget(i)),y.default.setState({...y.default.state,anchor:o,anchorContainer:n})}({anchor:o[0]});const i=e.pivot||o[0];if(V({pivot:i}),a.default.afterNextFlush((()=>{A(o)})),e.phase===y.SelectionPhase.Editing&&i)if(t.device.isMobile)_.hQ(t);else if(!t.device.isMobileBrowser){const e=h.C.findScrollToSelectableFromStore(i);e&&_.NQ({component:e,vertical:{reveal:"closest"},horizontal:e.props.disableScrollToRevealHorizontal?void 0:{reveal:"closest"}})}}function U(e){void 0===e.toggle&&(e.toggle=!1),void 0===e.selectBetween&&(e.selectBetween=!1);const{stores:t}=y.default.state;if(e.toggle)n().includes(t,e.store)?O({environment:e.environment,stores:n().without(t,e.store)}):O({environment:e.environment,stores:n().union(t,[e.store])});else if(e.selectBetween){let o=n().clone(t);const i=B(),r=i.indexOf(e.store);n().includes(o,e.store)||o.push(e.store);const a=t[0];if(a){const e=i.indexOf(a);if(e>=0){const t=n().slice(i,r,e);o=n().union(o,t)}}const s=n().last(t);if(s){const e=i.indexOf(s);if(e>=0){const t=n().slice(i,e,r);o=n().union(o,t)}}O({environment:e.environment,stores:o})}else n().includes(t,e.store)||O({environment:e.environment,stores:[e.store]});F({environment:e.environment,phase:y.SelectionPhase.Selected})}function H(e){const{environment:t,store:o}=e;if(o)if(L({stores:[o]}),V({pivot:void 0}),F({environment:t,phase:y.SelectionPhase.Editing}),t.device.isMobile)_.hQ(t);else if(!t.device.isMobileBrowser){const e=h.C.findScrollToSelectableFromStore(o);e&&_.NQ({component:e,vertical:{reveal:"closest"},horizontal:e.props.disableScrollToRevealHorizontal?void 0:{reveal:"closest"}})}}function z(e){const{stores:t}=y.default.state,o=t[0];if(!o)return;const i=h.C.findSelectableFromStore(o);if(i&&i.props.onEditText){const t=i.props.onEditText;x.createAndCommit({userAction:"selectionActions.editSelection",environment:e,perform:e=>{t({isAtStartOfLine:!1,isClick:!1,transaction:e})}})}}function W(e){const{environment:t,stores:o}=e,i=n().last(o);if(!i)return;const r=h.C.findSelectableFromStore(i);if(r&&r.props.onEditText){const e=r.props.onEditText;x.createAndCommit({userAction:"selectionActions.editStoresAtEnd",environment:t,perform:t=>{e({isAtStartOfLine:!1,isClick:!1,transaction:t})}})}}function j(e){L({stores:[]}),F({environment:e,phase:y.SelectionPhase.Selected}),C.xv(),T.xv(),k.xv()}function K(e){const{environment:t}=e,o=y.default.state.stores;A(o);const i=y.default.state.pivot,r=o[0];if(r)if(e.shiftKey)if(i===r){const i=(0,d.Bj)({includeNonSelectableListContainer:!1}),a=(0,d.v5)(r,i.children),{prev:l,parent:c}=e.altKey?(0,s.Sr)(i,a):(0,s.YL)(i,a);if(l){const e=l.value.store;O({environment:t,stores:n().union(o,[e]),pivot:e})}else if(c){const e=c.value.store;O({environment:t,stores:n().union(o.filter((e=>!(0,s.Yz)(c,(t=>t.store===e)))),[e]),pivot:e})}}else Z(e.environment);else{const o=(0,d.Bj)({includeNonSelectableListContainer:!1}),i=(0,d.v5)(r,o.children),{prev:n,parent:a}=e.altKey?(0,s.Sr)(o,i):(0,s.YL)(o,i);if(n){const e=n.value.store;O({environment:t,stores:[e],pivot:e})}else if(a){const e=a.value.store;O({environment:t,stores:[e],pivot:e})}else O({environment:t,stores:[r],pivot:r})}else if(i)O({environment:t,stores:[i]});else{const e=B(),o=n().last(e);o&&O({environment:t,stores:[o],pivot:o})}Y()}function Y(){const e=y.default.state.pivot||y.default.state.stores[0],t=h.C.findScrollToSelectableFromStore(e);t&&_.NQ({component:t,vertical:{reveal:"top"},horizontal:t.props.disableScrollToRevealHorizontal?void 0:{reveal:"closest"}})}function G(e){const t=y.default.state.stores;A(t);const o=y.default.state.pivot;if(0!==t.length&&o)if((0,u.BX)(o)&&b.Z.isOpen(o.id))O({environment:e,stores:[o],pivot:o}),P.rd({blockId:o.id,state:!1,currentUserId:e.currentUser.id});else if((0,l.IX)(o))w.e2(o);else{const t=(0,d.Bj)({includeNonSelectableListContainer:!1}),i=(0,d.v5)(o,t.children),n=(0,s.ub)(i);if(n){const t=n.value.store;O({environment:e,stores:[t],pivot:t})}else O({environment:e,stores:[o],pivot:o})}else if(o)O({environment:e,stores:[o]});else{const t=B(),o=n().last(t);o&&O({environment:e,stores:[o],pivot:o})}Y()}function X(e){const{environment:t}=e,o=y.default.state.stores;A(o);const i=y.default.state.pivot,r=n().last(o);if(r)if(e.shiftKey)if(i===r){const e=(0,d.Bj)({includeNonSelectableListContainer:!1}),i=(0,d.v5)(r,e.children),{next:a}=(0,s.Xf)(e,i);if(a){const e=a.value.store;O({environment:t,stores:n().union(o,[e]),pivot:e})}}else Z(t);else{const o=(0,d.Bj)({includeNonSelectableListContainer:!1}),i=(0,d.v5)(r,o.children),{next:n}=e.altKey?(0,s.Xf)(o,i):(0,s.lj)(o,i);if(n){const e=n.value.store;O({environment:t,stores:[e],pivot:e})}else O({environment:t,stores:[r],pivot:r})}else if(i)O({environment:t,stores:[i]});else{const e=B()[0];e&&O({environment:t,stores:[e],pivot:e})}q()}function q(){const e=y.default.state.pivot||n().last(y.default.state.stores);if(e){const t=h.C.findScrollToSelectableFromStore(e);t&&_.NQ({component:t,vertical:{reveal:"bottom"},horizontal:t.props.disableScrollToRevealHorizontal?void 0:{reveal:"closest"}})}}function $(e){const t=y.default.state.stores;A(t);const o=y.default.state.pivot;if(0!==t.length&&o)if((0,u.BX)(o)&&!b.Z.isOpen(o.id))O({environment:e,stores:[o],pivot:o}),P.rd({blockId:o.id,state:!0,currentUserId:e.currentUser.id});else if((0,l.IX)(o))w.FC(o);else{const t=(0,d.Bj)({includeNonSelectableListContainer:!1}),i=(0,d.v5)(o,t.children),n=(0,s.si)(i);if(n){const t=n.value.store;O({environment:e,stores:[t],pivot:t})}else O({environment:e,stores:[o],pivot:o})}else if(o)O({environment:e,stores:[o]});else{const t=B()[0];t&&O({environment:e,stores:[t],pivot:t})}q()}function J(e){const t=B();O({environment:e,stores:t,pivot:t[0]})}function Q(e){const t=B()[0];if(t){O({environment:e,stores:[t],pivot:t});const o=h.C.findScrollToSelectableFromStore(t);o&&_.NQ({component:o,vertical:{reveal:"top"},horizontal:o.props.disableScrollToRevealHorizontal?void 0:{reveal:"closest"}})}}function ee(e){const t=B(),o=t[t.length-1];if(o){O({environment:e,stores:[o],pivot:o});const t=h.C.findScrollToSelectableFromStore(o);t&&_.NQ({component:t,vertical:{reveal:"bottom"},horizontal:t.props.disableScrollToRevealHorizontal?void 0:{reveal:"closest"}})}}function te(){const e=performance.now(),t=new Map,o=new Map;h.C.forEach((e=>{const i=e.getNode();if(i&&i instanceof Element){const n=i.getBoundingClientRect();t.set(e,n),o.set(i,n)}}));const i=new Map;g.Z.forEach((e=>{const t=e.getNode();t&&t instanceof Element&&i.set(e,t.getBoundingClientRect())}));const n=new Map;m.Z.forEach((e=>{const t=e.getNode();t&&t instanceof Element&&n.set(e,t.getBoundingClientRect())})),v.Z.setState({...v.Z.state,selectableRectMap:t,selectableContainerRectMap:i,selectableElementRectMap:o,lastUpdate:e}),f.Z.setState({...f.Z.state,dropTargetRectMap:n})}const oe=n().throttle(te,200)},37190:(e,t,o)=>{o.r(t),o.d(t,{messages:()=>h,SPOTLIGHT_RADIUS:()=>f,CURSOR_PADDING:()=>v,ELEMENT_TO_PHASE_MAPPING:()=>y,ELEMENT_TO_MESSAGE_MAPPING:()=>b,registerElementForShadowCursor:()=>S,getShadowCursorCurrentElementName:()=>w,pointToSupportedCursorElement:()=>k,exitTutorial:()=>C,complete:()=>_,pointTo:()=>M,startShadowCursorTutorial:()=>T,updateShadowCursorSubpagePhase:()=>I});var i=o(97464),n=o.n(i),r=o(67294),a=o(1302),s=o(5366),l=o(77124),c=o(79315),d=o(39636),p=o(69501),u=o(64964),m=o(30149),g=o(37181);const h=(0,s.defineMessages)({snackbarLabelContainer:{id:"shadowCursorSnackbar.label.container",defaultMessage:"Step {step} of {totalSteps}: {message}",description:"The label for the snackbar that appears when the shadow cursor is active"},snackbarExitButtonLabel:{id:"shadowCursorSnackbar.exitButton.label",defaultMessage:"Exit tutorial",description:"Label to exit the tutorial"},snackbarNewPageSidebarLabel:{id:"shadowCursorSnackbar.newPageSidebar.label",defaultMessage:"Create a page",description:"The label for the snackbar that appears when the shadow cursor is active for create a page from sidebar step"},snackbarNewPageBlankLineLabel:{id:"shadowCursorSnackbar.newPageBlankLine.label",defaultMessage:"Use '/' to create content",description:"The label for the snackbar that appears when the shadow cursor is active for create a page from blank line step"},snackbarBreadcrumbLabel:{id:"shadowCursorSnackbar.breadcrumb.label",defaultMessage:"View subpage organization",description:"The label for the snackbar that appears when the shadow cursor is actiate to show the breadcrumb"}}),f=40,v=15,y={"new-page-sidebar":"create_page","new-page-blank-line":"slash_menu_subpage",completed:"complete"},b={"new-page-sidebar":h.snackbarNewPageSidebarLabel,"new-page-blank-line":h.snackbarNewPageBlankLineLabel};function S(e,t){c.default.state.shadowCursorStore.setState({...c.default.state.shadowCursorStore.state,supportedCursorElements:{...c.default.state.shadowCursorStore.state.supportedCursorElements,[e]:t}})}function w(){return c.default.state.shadowCursorStore.state.currentCursorElement}function k(e,t){const{elementName:o,userSettingsStore:i}=t;c.default.state.shadowCursorStore.setState({...c.default.state.shadowCursorStore.state,currentCursorElement:o});const p=y[o];p&&I({environment:e,userSettingsStore:i,phase:p}),a.default.afterNextFlush((()=>{const e=function(e){const{supportedCursorElements:t}=c.default.state.shadowCursorStore.state;if(e in t)return t[e];const o=document.querySelector(`.${function(e){return`shadow-cursor-${e}`}(e)}`);if(o)return o;switch(e){case"new-page-blank-line":return(0,l.pd)();default:return}}(o);if(e){const t=e.getBoundingClientRect();M({x:t.left-v,y:(t.bottom+t.top)/2-(f-v)}),u.oV({label:r.createElement(s.FormattedMessage,n()({},h.snackbarLabelContainer,{values:{step:d.C.indexOf(o)+1,totalSteps:d.C.length,message:r.createElement(s.FormattedMessage,b[o])}})),button:null,durationMs:"keep"})}}))}function C(e,t){c.default.state.shadowCursorStore.setState({...c.default.state.shadowCursorStore.state,visible:!1,currentCursorElement:null}),I({environment:e,userSettingsStore:t,phase:"dismissed_tutorial"}),u.rN()}function _(e,t){c.default.state.shadowCursorStore.setState({...c.default.state.shadowCursorStore.state,visible:!1,currentCursorElement:null}),I({environment:e,userSettingsStore:t,phase:"complete"}),u.rN()}function M(e){c.default.state.shadowCursorStore.setState({...c.default.state.shadowCursorStore.state,position:e})}function T(e,t){const{position:o,userSettingsStore:i}=t;p.Z.setState({open:!1}),c.default.state.shadowCursorStore.setState({...c.default.state.shadowCursorStore.state,visible:!0,position:o}),k(e,{userSettingsStore:i,elementName:"new-page-sidebar"})}function I(e){const{environment:t,userSettingsStore:o,phase:i}=e;o&&m.createAndCommit({userAction:"shadowCursorSubpagePhase.update",environment:t,perform:e=>{g.d2({userSettingsStore:o,transaction:e,data:{shadow_cursor_subpage_phase:i}})},userId:o.id})}},48429:(e,t,o)=>{o.d(t,{Cv:()=>S,zd:()=>k,qg:()=>C,Kt:()=>_,wx:()=>M,iK:()=>T});var i=o(77094),n=o.n(i),r=(o(67294),o(33728)),a=o(26825),s=o(27006),l=o(4615),c=o(5366),d=o(10279),p=o(64964),u=o(30149),m=o(64369),g=o(18878),h=o(19306),f=o(26907),v=o(67669),y=o(50906),b=o(47307);function S(e){const{success:t,inviteTargets:o}=e;0!==o.length&&(t?p.oV({label:n()(c.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",description:"Client side snackbar message shown when the page invite succeeds on the server side.",values:{users:w(o)}})}):p.oV({label:n()(c.FormattedMessage,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",description:"Client side snackbar message shown when the page invite fails on the server side.",values:{users:w(o)}})}))}function w(e){return(0,h.W)(e.map((e=>"group"===e.type?e.value.name??"group":e.value.email)))}async function k(e){const{inviteTargetsStore:t}=e,o=n()(c.FormattedMessage,{id:"shareMenu.closeInviteDialog.confirmationMessage",defaultMessage:"Your changes have not been saved. Discard changes?",description:"Confirmation message after clicking outside the share menu and dismissing the entries you have not saved or sent out."}),i=n()(c.FormattedMessage,{id:"shareMenu.closeInviteDialog.confirmationButton.label",defaultMessage:"Yes",description:"Label for button that appears below the question, 'Your changes have not been saved. Discard changes?' to confirm that the user would like to discard the changes."}),r=n()(c.FormattedMessage,{id:"shareMenu.closeInviteDialog.cancelButton.label",defaultMessage:"Cancel",description:"Label for button that appears below the question, 'Your changes have not been saved. Discard changes?' to confirm that the user does not want to discard the changes."});if(t.state.inviteTargets.length>0){const e=await b.confirmUserAction({message:o,acceptLabel:i,cancelLabel:r});return e}return!1}async function C(e){const{environment:t,blockStore:o,inviteTargetsStore:i,sudoModeStore:n,onInviteClick:a,onInviteComplete:c,inviteOrigin:p,role:u,emailMessage:m}=e;let g=!1;try{g=await async function(e){const{environment:t,blockStore:o,sudoModeStore:i,inviteTargetsStore:n,role:a,inviteOrigin:c,emailMessage:p,onInviteStart:u}=e,m=(0,l.ZP)();if(!(0,s.iC)(a))return!1;const{tokenQuery:g,inviteTargets:h}=n.state;if((0,r.oH)(g.trim())&&0===h.length){const e={type:"newUser",value:{email:g.trim()},source:"email"};f.H({target:e,inviteTargetsStore:n})||n.setState({inviteTargets:[...n.state.inviteTargets,e],tokenQuery:""})}const y=v.mU(o,n.state.inviteTargets);null==u||u();return(await d.n_({environment:t,store:o,sudoModeStore:i,inviteTargets:y,inviteRole:a,isOnboarding:!1,invite:{inviteFlowId:m,inviteMessage:p,inviteOrigin:c}})).success}({environment:t,blockStore:o,sudoModeStore:n,inviteTargetsStore:i,role:u,emailMessage:m,inviteOrigin:p,onInviteStart:a})}catch(h){}finally{null==c||c(g)}}async function _(e){const{environment:t,useSudoMode:o,store:i}=e,r={type:"restoreTeamPermissions",permissionChanges:[]};await b.confirmUserAction({message:(0,g.mX)(r),acceptLabel:(0,g.nH)(r),cancelLabel:n()(c.FormattedMessage,{id:"restrictedPermissionConfirmationModal.actionButton.cancel",defaultMessage:"Close"})})&&u.createAndCommit({userAction:"PermissionsRestoreBanner.restoreTeamPermissions",environment:t,useSudoMode:o,perform:e=>{d.Kh({environment:t,store:i,transaction:e})}})}async function M(e){const{environment:t,useSudoMode:o,store:i,permissionChanges:r}=e,a={type:"restore",permissionChanges:r};await b.confirmUserAction({message:(0,g.mX)(a),acceptLabel:(0,g.nH)(a),cancelLabel:n()(c.FormattedMessage,{id:"restrictedPermissionConfirmationModal.actionButton.cancel",defaultMessage:"Close"}),description:n()(g.mo,{openState:a})})&&(i.getPermissionItemsStore().canAdmin()?u.createAndCommit({userAction:"PermissionsRestoreBanner.restoreRestrictedPermissions",environment:t,useSudoMode:o,perform:e=>{d.MX({environment:t,store:i,transaction:e})}}):d.hs({environment:t,store:i}))}async function T(e){const{oldPermissionItem:t,newPermissionItem:o,wasInherited:i,environment:r,store:s,sudoModeStore:l}=e;if(!(0,a.Kf)(t,o))throw new Error("Permission type mismatch.");const p=!!l&&l.shouldSaveTransactionWithSudoMode(s),h=(0,a.nl)(t.role,o.role);if(i&&h!==o.role)return void(await async function(e){const{environment:t,useSudoMode:o,store:i,permissionItem:r}=e,a="none"===r.role?{type:"remove",permissionItem:r}:{type:"restrict"};("user_permission"===r.type&&r.user_id===t.currentUser.id||await b.confirmUserAction({message:(0,g.mX)(a),acceptLabel:(0,g.nH)(a),cancelLabel:n()(c.FormattedMessage,{id:"restrictedPermissionConfirmationModal.actionButton.cancel",defaultMessage:"Close"}),description:n()(m.Z,{isSmall:!0,isMultiline:!0},void 0,n()(c.FormattedMessage,{id:"restrictedPermissionConfirmationModal.footer.whisperText",defaultMessage:"Admins will still be able to restore permissions from restricted pages."}))}))&&u.createAndCommit({userAction:"PermissionItem.onAccept",environment:t,useSudoMode:o,perform:e=>{d.Pk({environment:t,store:i,permissionItem:r,shouldInherit:!0,transaction:e})}})}({environment:r,useSudoMode:p,store:s,permissionItem:o}));!s.isTopLevel()&&t.role!==o.role&&h!==t.role&&y.trackWidenPermission(r),u.createAndCommit({userAction:"PermissionItem.handlePermissionItemChange",environment:r,useSudoMode:p,perform:t=>{d.ep({environment:r,store:s,permissionItems:[o],transaction:t,pagePermissionChangeLocation:e.location})}})}},74647:(e,t,o)=>{o.r(t),o.d(t,{OnlyOneSidebarVisibleWidthThreshold:()=>W,SidePeekCloseLeftSidebarFrameWidthThreshold:()=>j,open:()=>K,close:()=>Y,setExpand:()=>G,handleSidebarButtonClick:()=>X,setUpdateExpand:()=>q,toggleLeftSidebarByWindowSize:()=>$,setWidth:()=>J,setUpdateWidth:()=>Q,setPeekWidth:()=>ee,leaveBlocks:()=>te,bookmarkPage:()=>oe,unbookmarkPage:()=>ie,pinSharedPage:()=>ne,unpinSharedPage:()=>re,quickAddPage:()=>se,newPageMessages:()=>le,initialize:()=>ge,setUpdateSidebarTab:()=>he,setUpdateSidebarCommentsMode:()=>fe,toggleBothSidebars:()=>ve});var i=o(1302),n=o(98459),r=o(54153),a=o(5366),s=o(87420),l=o(37181),c=o(59488),d=o(45010),p=o(45094),u=o(38755),m=o(15517),g=o(23537),h=o(79315),f=o(8949),v=o(66949),y=o(10161),b=o(3418),S=o(475),w=o(42330),k=o(79689),C=o(88923),_=o(24864),M=o(3815),T=o(69784),I=o(82187),P=o(7755),x=o(62213),B=o(11689),Z=o(62820),E=o(7011),R=o(50906),A=o(54642),D=o(54564),F=o(98834),L=o(94419),V=o(11302),N=o(89858),O=o(9953),U=o(5978),H=o(21325),z=o(30149);const W=1024,j=430;function K(){P.TC.state||T.Z.state.isActive||v.Z.isOpen()||(0,g.xp)()&&0!==b.Z.state.openPopups.size||P.TC.set(!0)}function Y(){!P.TC.state||S.Z.state.open||Z.Z.state.open||B.Z.state.open||x.Z.state.open||f.Z.state.isActive||I.Z.state.clonedBlockStore||P.cY.state.isResizing||!(0,k.c)()||b.Z.state.namedOpenPopups.has("team_more_actions")||b.Z.state.namedOpenPopups.has("teams_heading_actions")||(P.Ic.set(0),P.TC.set(!1))}function G(e){(0,c.Y)("supportsNativeHome")||(P.gV.set(e.isExpanded),ue(),C.default.setSidebarExpandedStoreState(e.isExpanded),e.isExpanded&&e.environment.WindowSizeStore.state.width<W&&(0,p.Sx)(e.environment)&&q({environment:e.environment,isExpanded:!1,from:"close_for_space"}),e.isExpanded&&(0,p.$3)(e.environment)<j&&s.xv(e.environment,"sidebar_expand"),e.isExpanded?R.trackSidebarExpand(e.environment):R.trackSidebarUnexpand(e.environment))}function X(e,t,o,i){const n=C.default.state.open,{currentTab:r}=E.ZP.state,a=r!==o||r===o&&!(0,p.Sx)(e);E.ZP.setState({...E.ZP.state,currentTab:o}),n?(U.navigateToBlock({environment:e,store:t}),q({environment:e,isExpanded:!0,from:i})):q({environment:e,isExpanded:a,from:i})}function q(e){var t;const{isExpanded:o,environment:i,from:n}=e;if(o||D.LZ(),o){i.WindowSizeStore.state.width<W&&(0,p.in)(i)&&G({environment:i,isExpanded:!1});const e=E.ZP.state.currentTab,t={origin:C.default.state.open?"peek_view":"page",from:n};e===E.gY.Comments?R.trackOpenCommentsSidebar(i,t):e===E.gY.Updates&&R.trackOpenUpdatesSidebar(i,t)}E.ZP.setState({...E.ZP.state,expanded:o,mouseEntered:!!o||E.ZP.state.mouseEntered,openedOnBlockId:C.default.state.open&&C.default.state.target.id||(null===(t=h.default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.id),canRender:!0}),me()}function $(e){C.default.state.savedSidebarExpandedStoreState&&!P.gV.state&&function(e){if(P.gV.state||!C.default.state.savedSidebarExpandedStoreState)return;C.default.isSidePeekOpen()&&(0,p.$3)(e)-(0,p.qG)(e)>=j&&P.gV.set(!0)}(e),P.gV.state&&function(e){const t=P.gV.state&&0===(0,p.Wk)(e)?e.WindowSizeStore.state.width-P.GZ.state-(0,p.ll)(e,!1):(0,p.$3)(e);C.default.isSidePeekOpen()&&C.default.state.savedSidebarExpandedStoreState&&P.gV.state&&t<j&&(P.gV.set(!1),C.default.setSidebarExpandedStoreState(!0))}(e)}function J(e){P.GZ.set(e.width),(0,p.$3)(e.environment)<j&&s.xv(e.environment,"sidebar_expand"),ue()}function Q(e){E.ZP.setState({...E.ZP.state,width:e.width}),me()}function ee(e){C.default.state.open&&C.default.isSidePeekOpen()&&(C.default.setSidePeekWidth(e.width,e.environment.WindowSizeStore.state.width),function(){const{preferredSidePeekWidth:e}=C.default.state,t={width:e};r.Z.set(pe,t)}(),$(e.environment))}async function te(e){const{blocks:t,transaction:o,environment:i}=e,{currentSpaceViewStore:r}=h.default.state;if(r)for(const n of t)L.Od({parent:r.getSharedPagesStore(),childToRemove:n,transaction:o});U.navigateAwayIfCurrentPage({environment:i,blocks:t}),await Promise.all(t.map((e=>A.leaveBlock(i,{block:{id:e.id,spaceId:(0,n.CG)(e.pointer.spaceId)}}))))}const oe=function(e){const{store:t,spaceViewStore:o,transaction:i}=e,n=o.getBookmarkedPagesStore(),r=M.G.createChildStore(n,t.pointer);L.Ce({parent:n,prepend:r,transaction:i})},ie=function(e){const{store:t,spaceViewStore:o,transaction:i}=e,n=o.getBookmarkedPagesStore(),r=M.G.createChildStore(n,t.pointer);L.Od({parent:n,childToRemove:r,transaction:i})},ne=function(e){const{store:t,spaceViewStore:o,transaction:i}=e;ae(e);const n=o.getSharedPagesStore(),r=M.G.createChildStore(n,t.pointer);L.Ce({parent:n,prepend:r,transaction:i})},re=function(e){const{store:t,spaceViewStore:o,transaction:i}=e;ae(e);const n=o.getSharedPagesStore(),r=M.G.createChildStore(n,t.pointer);L.Od({parent:n,childToRemove:r,transaction:i})};function ae(e){const{environment:t,spaceViewStore:o,userSettingsStore:i,transaction:n}=e,r=o.getSpaceId();if(!r||i.hasUserPinnedToOutliner({spaceId:r,type:"shared"}))return;const{visibleSharedPagesStores:a}=(0,u.k0)({environment:t,spaceViewStore:o,userSettingsStore:i}),s=a.map((e=>{let{id:t}=e;return t}));O.sW({store:o,data:{shared_pages:s},transaction:n}),l.Nb({userSettingsStore:i,spaceId:r,type:"shared",transaction:n})}async function se(e){const{quickAddParentOverride:t,from:o,environment:n,redirect:r}=e,{currentSpaceStore:a,currentSpaceViewStore:s}=h.default.state,l=y.default.checkGate("quick_capture_global_mini_peek");if(H.M_(n)&&a&&a.canEdit()&&s){const{performResult:{createdPage:e}}=await z.createAndCommitAsync({environment:n,userAction:"sidebarActions.quickAddPage",waitForServerCommit:!1,perform:async e=>{const o=t||await m.lX(a,a.loadRecordValue);w.ZP.setState({...w.ZP.state,lastPageId:h.default.state.mainEditorCurrentBlockStore?h.default.state.mainEditorCurrentBlockStore.id:void 0});const i=O.j4({environment:n,type:"page",inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:e,spaceId:a.id}),r=await V.Ws({environment:n,targets:[i],value:o,transaction:e});if(r&&"collection"===r.table){const t=r.getDefaultTemplatePageStore();t&&F.ob({title:"template",environment:n,store:i,templateStore:t,isKeyboard:!1,isCreateIn:!1,transaction:e,from:"sidebar_actions"})}return{createdPage:i}}});return n.device.isMobile?(U.navigateToBlock({environment:n,store:e,showMoveTo:!0,saveParent:!0,redirect:r}),Y()):U.peekBlock({environment:n,store:e,showMoveTo:!0,saveParent:!0,peekMode:l?C.PeekModeMini:void 0,resultsStore:void 0,collectionContextStore:void 0}),N.Eo({environment:n,spaceViewStore:s,type:"private",newIsHidden:!1,outlinerToggleButtonStore:_.Z,shouldPersistToggleState:!0}),R.trackCreateBlock(n,{from:o,type:"page"}),i.default.afterNextFlush((()=>{d.Z.SidebarScroller&&d.Z.SidebarScroller.scrollToBottom()})),e}}const le=(0,a.defineMessages)({label:{id:"sidebar.newPage.button",defaultMessage:"New page"},tooltip:{id:"sidebar.newPage.tooltip",defaultMessage:"Create a new page",description:"Tooltip for the new page button in the sidebar allowing the user to create a new page"}}),ce="sidebar",de="updateSidebar",pe="sidePeek";function ue(){const e={expanded:P.gV.state,width:P.GZ.state};r.Z.set(ce,e)}function me(){const{expanded:e,width:t,openedOnBlockId:o,commentsMode:i}=E.ZP.state,n={expanded:e,width:t,openedOnBlockId:o,commentsMode:i};r.Z.set(de,n)}function ge(){const e=r.Z.get(ce),t=r.Z.get(de),o=r.Z.get(pe);if((0,c.Y)("supportsNativeHome")?(P.gV.set(!1),P.GZ.set(0)):e&&(void 0!==e.expanded&&P.gV.set(e.expanded),void 0!==e.width&&e.width>=P.nP&&P.GZ.set(e.width)),t){const e=t.width&&t.width>=E.AO?t.width:E.AO;E.ZP.setState({...E.ZP.state,...t,width:e}),window.innerWidth<W&&P.gV.set(!1)}o&&C.default.setSidePeekWidth(o.width,window.innerWidth)}function he(e){E.ZP.setState({...E.ZP.state,currentTab:e})}function fe(e){E.ZP.setState({...E.ZP.state,commentsMode:e}),me()}function ve(e){(0,p.Sx)(e)||P.gV.state?(G({environment:e,isExpanded:!1}),q({environment:e,isExpanded:!1,from:"keyboard_default"})):(q({environment:e,isExpanded:!0,from:"keyboard_default"}),G({environment:e,isExpanded:!0}))}},36432:(e,t,o)=>{o.d(t,{R:()=>p,V:()=>u});var i=o(96486),n=o.n(i),r=o(97880),a=o(45094),s=o(81844),l=o(79315),c=o(70935);const d=e=>{const{sidebarSelectionMode:t,isInBulkSelectSession:o,selectedStore:i,selectedStoreIsBookmark:n}=e;let d=[{isBookmark:n,store:i}];const p=l.default.state.mainEditorCurrentBlockStore;return!o&&p&&(d=[...d,...s.Z.findOutlinerItemsFromId(p.id).map((e=>({store:e.store,isBookmark:a.IS(e)})))]),d.filter((e=>{let{isBookmark:o,store:i}=e;return(e=>{let t=!1;switch(e.mode){case c.Y.FavoritesOnly:t=e.isBookmark;break;case c.Y.NonFavoritesOnly:t=!e.isBookmark;break;case c.Y.NotSelecting:t=!0;break;default:(0,r.t1)(e.mode)}return t&&a.Bb(e.store)&&!c.Z.isSelected(e.store)})({store:i,mode:t,isBookmark:o})})).map((e=>{let{store:t}=e;return t}))},p=e=>{const{block:t,isInBookmarkSection:o}=e,i=c.Z.getSelectedPageMap();c.Z.isSelected(t)?(e=>{const{block:t,currSelectionMap:o}=e;if(!c.Z.isSelected(t))return;const i=c.Z.getStoreKey(t),r=n().omit({...o},i);n().isEmpty(r)?u():c.Z.setState({mode:c.Z.getSelectionMode(),selectedPages:r})})({block:t,currSelectionMap:i}):(e=>{const{block:t,isBookmark:o,currSelectionMap:i}=e;let r=c.Z.getSelectionMode();r===c.Y.NotSelecting&&(r=o?c.Y.FavoritesOnly:c.Y.NonFavoritesOnly);const a=d({sidebarSelectionMode:r,isInBulkSelectSession:c.Z.isInBulkSelectSession(),selectedStore:t,selectedStoreIsBookmark:o});0!==a.length&&c.Z.setState({mode:r,selectedPages:{...i,...n().keyBy(a,(e=>c.Z.getStoreKey(e)))}})})({block:t,isBookmark:o,currSelectionMap:i})},u=()=>{c.Z.reset()}},8713:(e,t,o)=>{o.d(t,{pj:()=>O,iH:()=>U,n5:()=>H,pB:()=>z,m6:()=>W,fT:()=>j,Ps:()=>K,MO:()=>Y,eh:()=>G,rS:()=>q,fn:()=>$,Fn:()=>J,Or:()=>Q,Iu:()=>ee,Hf:()=>te,x$:()=>oe,ce:()=>ie,I9:()=>ne,uM:()=>re,m1:()=>ae,xy:()=>se,co:()=>ce,Qs:()=>de,FV:()=>pe,iz:()=>ue,nS:()=>me,Hh:()=>ge,Fi:()=>he,Md:()=>ve,_C:()=>ye,LB:()=>Se,il:()=>we,p2:()=>ke,Jc:()=>Ce,hh:()=>_e,y1:()=>Me,gP:()=>Te,ih:()=>Ie,g4:()=>Pe,M5:()=>Be,Q:()=>Ze,W5:()=>Ae,WO:()=>De,Fv:()=>Le,sR:()=>Ve,lm:()=>Ne,sr:()=>Oe,vk:()=>Ue,ys:()=>He});var i=o(1302),n=o(41432),r=o(90559),a=o(99036),s=o(80951),l=o(4615),c=o(71644),d=o(98459),p=o(21202),u=o(6287),m=o(13493),g=o(70203),h=o(63143),f=o(5366),v=o(95477),y=o(14976),b=o(33929),S=o(65598),w=o(77505),k=o(90496),C=o(22294),_=o(3815),M=o(27724),T=o(60749),I=o(84568),P=o(52543),x=o(24666),B=o(54532),Z=o(96802),E=o(94419),R=o(19785),A=o(9953),D=o(24677),F=o(993),L=o(98104),V=o(30149);const N=(0,f.defineMessages)({turnIntoCollectionTitle:{defaultMessage:"Title",id:"simpleTableActions.collectionTitle"},turnIntoCollectionColumnTitle:{defaultMessage:"Column {columnIndex}",id:"simpleTableActions.collectionColumnTitle"}});function O(e){const{environment:t,index:o,simpleTableStore:i}=e;P.Z.setState({isActive:!0,simpleTableStore:i,selection:{start:{col:0,row:o},end:{col:w.WN(i)-1,row:o},type:"row"}}),D.Z5({environment:t,stores:[i],phase:M.SelectionPhase.Editing}),L.ZH(t)}function U(e){const{environment:t,index:o,simpleTableStore:i}=e;P.Z.setState({isActive:!0,simpleTableStore:i,selection:{start:{col:o,row:0},end:{col:o,row:w.bm(i)-1},type:"column"}}),D.Z5({environment:t,stores:[i],phase:M.SelectionPhase.Editing}),L.ZH(t)}function H(e){const{environment:t,rowIndex:o,columnIndex:i,simpleTableStore:n}=e;P.Z.setState({isActive:!0,simpleTableStore:n,selection:{start:{col:i,row:o},end:{col:i,row:o},type:"cell"}}),D.Z5({environment:t,stores:[n],phase:M.SelectionPhase.Editing})}function z(e){const{environment:t,start:o,end:i,simpleTableStore:n}=e;P.Z.setState({isActive:!0,simpleTableStore:n,selection:{start:o,end:i,type:"cell"}}),D.Z5({environment:t,stores:[n],phase:M.SelectionPhase.Editing}),L.ZH(t)}function W(e){const{environment:t,rowIndex:o,columnIndex:i,simpleTableStore:n}=e;z({environment:t,start:P.Z.state.isActive?P.Z.state.selection.start:{col:i,row:o},end:{col:i,row:o},simpleTableStore:n})}function j(e){H(e);const t=w.f8(e);t&&L.NX({store:t})}function K(){if("editing"!==x.default.state.mode)return;const e=w.UQ();if(!e)return void Y();const{columnIndex:t,rowIndex:o,simpleTableStore:i}=e.props,n=P.Z.state;if(n.isActive){const{start:e,end:r}=n.selection;!(e.col===r.col&&e.row===r.row)||e.col===t&&e.row===o&&n.simpleTableStore===i||H({environment:i.environment,rowIndex:o,columnIndex:t,simpleTableStore:i})}else H({environment:i.environment,rowIndex:o,columnIndex:t,simpleTableStore:i})}function Y(){P.Z.setState({isActive:!1})}function G(e){const{environment:t,direction:o,bypassExistingTextSelection:i,expandSelection:n}=e;if(!i&&w.UQ())return;const r=P.Z.state;if(r.isActive){const{selection:e,simpleTableStore:a}=r;if(n){const{rowIndex:i,columnIndex:n}=X({selection:e,simpleTableStore:a,direction:o,wrapRow:!1});return void W({environment:t,rowIndex:i,columnIndex:n,simpleTableStore:a})}if(w.u({selection:e,columnIndex:e.start.col,simpleTableStore:a})){const{columnIndex:i}=X({selection:e,simpleTableStore:a,direction:o,wrapRow:!1});U({environment:t,index:i,simpleTableStore:a})}else{i&&L.ZH(t);const{rowIndex:n,columnIndex:r}=X({selection:e,simpleTableStore:a,direction:o,wrapRow:!0});H({environment:t,rowIndex:n,columnIndex:r,simpleTableStore:a})}}C.Z.setKeyboardMode(!0)}function X(e){const{selection:t,simpleTableStore:o,direction:i,wrapRow:n}=e,r=w.WN(o)-1,a=w.bm(o)-1,{col:s,row:l}=t.end;return"right"===i?s===r&&l===a?{columnIndex:r,rowIndex:a}:s===r?n?{columnIndex:0,rowIndex:l+1}:{columnIndex:s,rowIndex:l}:{columnIndex:s+1,rowIndex:l}:0===s&&0===l?{columnIndex:0,rowIndex:0}:0===s?n?{columnIndex:r,rowIndex:l-1}:{columnIndex:s,rowIndex:l}:{columnIndex:s-1,rowIndex:l}}function q(e){const{environment:t,direction:o,bypassExistingTextSelection:i,expandSelection:n}=e;if(!i&&w.UQ())return;const r=P.Z.state;if(r.isActive){const{selection:e,simpleTableStore:a}=r,{rowIndex:s,columnIndex:l}=function(e){const{selection:t,simpleTableStore:o,direction:i}=e,n=w.bm(o)-1,{col:r,row:a}=t.end,s="down"===i?Math.min(n,a+1):Math.max(0,a-1);return{columnIndex:r,rowIndex:s}}({selection:e,simpleTableStore:a,direction:o});if(n)return void W({environment:t,rowIndex:s,columnIndex:l,simpleTableStore:a});w.Ax({selection:e,rowIndex:e.start.row,simpleTableStore:a})?O({environment:t,index:s,simpleTableStore:a}):(w.ok(e)||w._Y())&&(i&&L.ZH(t),H({environment:t,rowIndex:s,columnIndex:l,simpleTableStore:a}))}C.Z.setKeyboardMode(!0)}function $(e){if(w.UQ())return;const t=P.Z.state;if(!t.isActive)return;const{environment:o,transaction:i}=e,{selection:n,simpleTableStore:r}=t;if(w.u({selection:n,columnIndex:n.start.col,simpleTableStore:r}))De(e),xe({index:n.start.col,simpleTableStore:r,transaction:i}),Y();else if(w.Ax({selection:n,rowIndex:n.start.row,simpleTableStore:r})){Ee({rowID:r.getRenderableContentIds()[n.start.row],simpleTableStore:r,transaction:i}),Y()}else w.ok(n)?Ae({environment:o,transaction:i}):w._Y()&&De({environment:o,transaction:i})}function J(e){if(w.UQ())return;const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t;if(w.ok(o)||w._Y()){const t=i.getContentStores()[o.end.row],n=w.h4(i);if(!n)return;const{environment:r,transaction:a,key:s}=e,l=t.getPropertyStore(n[o.end.col]);if(s&&1===s.length){const e=l.getValue(),t=g.TP(s);F.sO({environment:r,store:l,value:e?e.concat(t):t,transaction:a}),L.NX({store:l})}}}function Q(e){if(w.UQ())return;const t=P.Z.state;if(!t.isActive)return;const{environment:o,transaction:i}=e,{selection:n,simpleTableStore:r}=t;w.u({selection:n,columnIndex:n.start.col,simpleTableStore:r})?ge({transaction:i}):w.Ax({selection:n,rowIndex:n.start.row,simpleTableStore:r})&&he({environment:o,transaction:i})}function ee(e){const{simpleTableStore:t,annotation:o}=e,i=P.Z.state;if(!i.isActive||i.simpleTableStore!==t)return;const{selection:n}=i,r=[],a=Math.min(n.start.row,n.end.row),s=Math.max(n.start.row,n.end.row),l=Math.min(n.start.col,n.end.col),c=Math.max(n.start.col,n.end.col);for(let u=a;u<=s;u++)for(let e=l;e<=c;e++){const o=w.f8({simpleTableStore:t,rowIndex:u,columnIndex:e}),i=null==o?void 0:o.getValue();o&&i&&r.push({textStore:o,textValue:i})}const d=g.J7(o),p=r.every((e=>{let{textValue:t}=e;return t.every((e=>g.hD(e).some((e=>g.J7(e)===d))))}));for(const{textStore:u,textValue:m}of r)F.QT({...e,textStore:u,textValue:m,action:p?"removeAnnotationType":"annotate"})}function te(e){if(be())return;const{x:t,y:o,simpleTableStore:i}=e;T.Z.setState({isActive:!0,simpleTableStore:i,hover:{x:t,y:o,showResizer:!1,resizing:!1,type:"cell"}})}function oe(e){if(be())return;const{type:t,simpleTableStore:o,index:i}=e;T.Z.setState({isActive:!0,simpleTableStore:o,hover:{type:t,index:i}})}function ie(e){const{simpleTableStore:t,resizer:o}=e;T.Z.setState({isActive:!0,simpleTableStore:t,hover:{type:"resizer",resizer:o}})}function ne(){be()||T.Z.setState({isActive:!1})}function re(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,{environment:n,transaction:r}=e;le({index:o.start.col,simpleTableStore:i,transaction:r}),j({environment:n,rowIndex:0,columnIndex:o.start.col,simpleTableStore:i})}function ae(e){const{count:t,simpleTableStore:o,transaction:i}=e;if(t<1)return;const n=w.WN(o);for(let r=0;r<t;r++)le({index:n+r,simpleTableStore:o,transaction:i})}function se(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,{environment:n,transaction:r}=e;le({index:o.end.col+1,simpleTableStore:i,transaction:r}),j({environment:n,rowIndex:0,columnIndex:o.end.col+1,simpleTableStore:i})}function le(e){const{index:t,simpleTableStore:o,transaction:i,columnID:n,format:r}=e,a=w.h4(o)||[],s=w.FA(o),l=n||(0,c.ZP)(),d=[...a.slice(0,t),l,...a.slice(t)],p=r?{...s,[l]:r}:s;Z.FH({stores:[o],update:{table_block_column_order:d,table_block_column_format:p},transaction:i})}function ce(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,{environment:n,transaction:r}=e;ue({environment:n,index:o.start.row,simpleTableStore:i,transaction:r}),j({environment:n,rowIndex:o.start.row,columnIndex:0,simpleTableStore:i})}function de(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,{environment:n,transaction:r}=e;ue({environment:n,index:o.end.row+1,simpleTableStore:i,transaction:r}),j({environment:n,rowIndex:o.end.row+1,columnIndex:0,simpleTableStore:i})}function pe(e){const{environment:t,count:o,simpleTableStore:i,transaction:n}=e;if(o<1)return;const r=w.bm(i);for(let a=0;a<o;a++)ue({environment:t,index:r+a,simpleTableStore:i,transaction:n})}function ue(e){const{environment:t,index:o,simpleTableStore:i,transaction:n}=e,r=i.getContentStore();if(!(0,S.dz)(r))throw new Error("Block has an invalid parent.");const a=A.j4({environment:t,type:"table_row",properties:{},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:n,spaceId:i.pointer.spaceId}),s=_.G.createChildStore(r,a.pointer);if(o<=0)R.SH({parentStore:r,childStore:s,transaction:n});else{const e=i.getContentStores();R.jG({parentStore:r,childStore:s,transaction:n,after:e[o-1].id})}return s}function me(e){const{environment:t,simpleTableStore:o,transaction:i}=e,n=o.getContentStore();if(!(0,S.dz)(n))throw new Error("Block has an invalid parent.");const r=A.j4({environment:t,type:"table_row",properties:{},inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:i,spaceId:o.pointer.spaceId}),a=_.G.createChildStore(n,r.pointer);return R.jG({parentStore:n,childStore:a,transaction:i}),a}function ge(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,n=w.h4(i),r=w.FA(i);if(!n)return;const a=n.slice(o.start.col,o.end.col+1);if(!a)return;const s=[],{transaction:l}=e;for(let d=o.start.col;d<=o.end.col;d++){const e=a[d-o.start.col],t=(0,c.ZP)();s.push(t),le({index:o.end.col+1,simpleTableStore:i,transaction:l,columnID:t,format:r?r[e]:void 0})}for(const c of i.getContentStores())fe({rowStore:c,columnIDs:a,newColumnIDs:s,transaction:l})}function he(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,n=i.getRenderableContentIds(),{environment:r,transaction:a}=e;for(let s=o.start.row;s<=o.end.row;s++){const e=_.G.createChildStore(i,{table:p.iU,id:n[s]}),[t]=B.Qi({environment:r,store:e,addCopyName:!1,transaction:a,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,targetSpaceId:(0,d.CG)(e.pointer.spaceId),baseUrl:v.Z.domainBaseUrl,publicDomainName:v.Z.publicDomainName,preferDuplicateLocation:"local"});E.BE({parent:i.getContentStore(),insert:t,after:e,transaction:a})}}function fe(e){const{rowStore:t,columnIDs:o,newColumnIDs:i,transaction:n}=e,r=t.getPropertiesStore(),a={...r.getValue(),...(0,h.m8)(i.map(((e,i)=>[e,t.getPropertyValue(o[i])])))};A.sO({store:r,value:a,transaction:n})}function ve(e){const t=T.Z.state;if(!t.isActive)return;const{hover:o}=t;"cell"===o.type&&T.Z.setState({...t,hover:{...o,showResizer:e}})}function ye(e){const t=T.Z.state;if(!t.isActive)return;const{hover:o}=t;"cell"===o.type&&T.Z.setState({...t,hover:{...o,resizing:e}})}function be(){const e=T.Z.state;return e.isActive&&"resizing"in e.hover&&e.hover.resizing}function Se(e){const{tableBlockColumnFormat:t,simpleTableStore:o,transaction:i}=e;Z.FH({stores:[o],update:{table_block_column_format:t},transaction:i})}function we(e){const t=P.Z.state;if(!t.isActive||"row"!==t.selection.type)return;const{selection:o}=t;P.Z.setState({...t,selection:{...o,end:{col:e,row:o.end.row}}})}function ke(e){const t=P.Z.state;if(!t.isActive||"column"!==t.selection.type)return;const{selection:o}=t;P.Z.setState({...t,selection:{...o,end:{col:o.end.col,row:e}}})}function Ce(e){const{environment:t,simpleTableStore:o,id:i,index:n,type:r,rowStore:a,theme:s,selectorStartPx:l,mouseOffsetPx:c}=e;let d=[];"column"===r?(U({environment:t,index:n,simpleTableStore:o}),d=k.Z.findCellsInColumnFromStore(o,i)):(O({environment:t,index:n,simpleTableStore:o}),d=k.Z.findCellsInRowFromStore(a));const p=w.To({cells:d,type:r,theme:s});I.Z.setState({isActive:!0,simpleTableStore:o,source:{id:i,type:r,index:n,draggedCells:p,selectorStartPx:l,mouseOffsetPx:c},destIndex:n,selectorDragPx:l,moved:!1})}function _e(e){const{destIndex:t,selectorDragPx:o}=e,i=I.Z.state;i.isActive&&I.Z.setState({...i,destIndex:t,selectorDragPx:o,moved:!0})}function Me(){I.Z.reset()}function Te(e){const{event:t,environment:o,format:n,simpleTableStore:r,transaction:a,type:s,onNoChange:l}=e,c=I.Z.state;if(!c.isActive)return;const{source:d,destIndex:p}=c;d.type===s&&c.simpleTableStore===r&&("column"===s?function(e){const{environment:t,columnOrder:o,source:n,destIndex:r,simpleTableStore:a,transaction:s}=e;if(!o)return;Y();const l=[...o.slice(0,n.index),...o.slice(n.index+1)],c=[...l.slice(0,r),n.id,...l.slice(r)];Z.FH({stores:[a],update:{table_block_column_order:c},transaction:s}),i.default.afterNextFlush((()=>{U({environment:t,index:r,simpleTableStore:a})}))}({environment:o,columnOrder:n.table_block_column_order,source:d,destIndex:p,simpleTableStore:r,transaction:a}):function(e){const{environment:t,source:o,destIndex:n,simpleTableStore:r,transaction:a}=e,s=r.getRenderableContentIds(),l=n>o.index?n:n-1;let c=n>0?s[l]:void 0;c===o.id&&(c=s[l+1]);Y();const d=r.getContentStores().find((e=>e.id===o.id)),p=r.getContentStores().find((e=>e.id===c));if(d){const e=r;p?R.jG({parentStore:e,after:p.id,childStore:d,transaction:a}):R.SH({parentStore:e,childStore:d,transaction:a}),i.default.afterNextFlush((()=>{O({environment:t,index:n,simpleTableStore:r})}))}}({environment:o,source:d,destIndex:p,simpleTableStore:r,transaction:a}),d.index===p&&(null==l||l(t)))}function Ie(e){const t=P.Z.state;if(!t.isActive)return;De(e);const{selection:o,simpleTableStore:i}=t,{transaction:n}=e;for(let r=o.start.col;r<=o.end.col;r++)xe({index:r,simpleTableStore:i,transaction:n})}function Pe(e){const{simpleTableStore:t,columnOrder:o,transaction:i}=e;Z.FH({stores:[t],update:{table_block_column_order:o},transaction:i})}function xe(e){const{index:t,simpleTableStore:o,transaction:i}=e,n=w.h4(o);if(!n||1===n.length)return;const r=[...n.slice(0,t),...n.slice(t+1)];Z.FH({stores:[o],update:{table_block_column_order:r},transaction:i})}function Be(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,n=i.getRenderableContentIds(),{transaction:r}=e;for(let a=o.start.row;a<=o.end.row;a++)Ee({rowID:n[a],simpleTableStore:i,transaction:r})}function Ze(e){const{simpleTableStore:t,numRowsToDelete:o,transaction:i}=e,n=t.getRenderableContentIds();for(let r=n.length-o;r<n.length;r++)Ee({rowID:n[r],simpleTableStore:t,transaction:i})}function Ee(e){const{rowID:t,simpleTableStore:o,transaction:i}=e,n=o.getContentStore();if(!(0,S.dz)(n))throw new Error("Block has an invalid parent.");if(w.bm(o)<=1)return;const r={table:p.iU,id:t};Re({rowStore:_.G.createChildStore(n,r),simpleTableStore:o,transaction:i})}function Re(e){const{rowStore:t,simpleTableStore:o,transaction:i}=e,n=o.getContentStore();R.hr({parentStore:n,childStore:t,transaction:i})}function Ae(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o}=t;if(!w.ok(o))return;const{environment:i,transaction:n}=e;De({environment:i,transaction:n})}function De(e){const t=P.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,n=w.h4(i);if(!n)return;const r=i.getContentStores(),{environment:a,transaction:s}=e,l=Math.min(o.start.row,o.end.row),c=Math.max(o.start.row,o.end.row),d=Math.min(o.start.col,o.end.col),p=Math.max(o.start.col,o.end.col);for(let u=l;u<=c;u++)Fe({rowStore:r[u],startIndex:d,endIndex:p,columnOrder:n,transaction:s});L.ZH(a)}function Fe(e){const{rowStore:t,startIndex:o,endIndex:i,columnOrder:n,transaction:r}=e,a=n.slice(o,i+1);if(!a)return;const s=t.getPropertiesStore(),l=(0,h.m8)(Object.entries(s.getValue()||{}).filter((e=>{let[t,o]=e;return!a.includes(t)})));A.sO({store:s,value:l,transaction:r})}function Le(e){const{simpleTableStore:t,transaction:o}=e,i=w.h4(t)||[],r=w.FA(t)||{},{headerRow:s}=w._j(t),c=t.getContentStores();if(!i.length)return;const d=i[0],g=t.getSpaceId(),f=(0,l.ZP)(),v=(0,l.ZP)(),S=s?c[0]:void 0,k=(0,h.m8)(i.map(((e,t)=>function(e){const{columnID:t,columnIndex:o,titleColumnID:i,headerRowStore:n}=e;let r=t,a="text",s=N.turnIntoCollectionColumnTitle;t===i&&(r="title",a="title",s=N.turnIntoCollectionTitle);const l=b.default.getIntl();return[r,{name:n?y.Xh(n.getPropertyValue(t),n):l.formatMessage(s,{columnIndex:o}),type:a}]}({columnID:e,columnIndex:t,titleColumnID:d,headerRowStore:S})))),C={id:f,version:0,parent_table:p.iU,parent_id:t.id,space_id:g,name:void 0,schema:k,alive:!0},M={table:u.v,id:f,spaceId:g};V.applyOperation({store:(0,_.Kv)(t,M),operation:{pointer:M,command:"set",path:[],args:C},transaction:o}),A.sW({store:t,data:{type:n.Ti.collectionView,collection_id:f,format:{collection_pointer:{table:u.v,id:f,spaceId:g}},view_ids:[v],content:[]},transaction:o}),c.map(((e,i)=>{if(s&&0===i)return void Re({rowStore:e,simpleTableStore:t,transaction:o});const r=e.getProperties();A.sW({store:e,data:{type:n.Ti.page,parent_id:f,parent_table:u.v,properties:{...r,title:r[d],[d]:void 0}},transaction:o})}));const T={id:v,version:0,type:"table",name:void 0,parent_id:t.id,parent_table:"block",space_id:g,format:{table_properties:i.map((e=>({visible:!0,property:e===d?"title":e,width:r&&e in r?r[e].width:void 0})))},page_sort:c.map((e=>e.id)).slice(0,a.gq),alive:!0},I={table:m.n,id:v,spaceId:g};V.applyOperation({store:(0,_.Kv)(t,I),operation:{pointer:I,command:"set",path:[],args:T},transaction:o})}function Ve(e){var t;const{environment:o,collectionViewBlockStore:i,pageStores:a,transaction:l}=e,d=i.getCollectionViewSourceCollectionStore();if(!d)return;if(a.length>w.HY||a.some((e=>e.hasContent())))return;const[u]=i.getCollectionViewStores(),m=d.getSchema(),g=(u.getFormat().table_properties||[]).filter((e=>e.visible&&e.property in m));if(!g)return;const f=i.getContentStore(),v=(0,c.ZP)();A.sW({store:i,data:{type:n.Ti.table,format:{table_block_column_order:g.map((e=>"title"===e.property?v:e.property)),table_block_column_format:(0,h.m8)(g.map((e=>["title"===e.property?v:e.property,{width:e.width}]))),table_block_column_header:!0}},transaction:l});const y=A.j4({environment:o,type:"table_row",properties:(0,h.m8)(g.map((e=>{const t=e.property,o=t in m?m[t]:void 0;return["title"===t?v:t,o?[[o.name]]:[]]}))),inMemoryRecordCache:o.defaultRecordCache.inMemoryRecordCache,transaction:l,spaceId:i.pointer.spaceId}),b=_.G.createChildStore(f,y.pointer);R.SH({parentStore:f,childStore:b,transaction:l});const S=(0,r.$z)(m),k=S.length>0?null===(t=d.getRecordKeyStore())||void 0===t?void 0:t.getRecordKey():void 0;a.map(((e,t)=>{const o=_.G.createChildStore(f,e.pointer),a=e.getProperties(),c=S.reduce((function(e,t){const o=(0,r.wf)(k,s.ah(a[t]));return e[t]=[[o]],e}),{});A.sW({store:o,data:{type:n.Ti.tableRow,parent_id:i.id,parent_table:p.iU,properties:{...a,...c,title:void 0,[v]:a.title}},transaction:l}),R.jG({parentStore:f,childStore:o,transaction:l})})),A.sW({store:d,data:{alive:!1},transaction:l}),A.sW({store:u,data:{alive:!1},transaction:l})}function Ne(e){const{simpleTableStore:t,transaction:o}=e,i=t.getFormat(),n=!Boolean(i.table_block_column_header);Z.FH({stores:[t],update:{table_block_column_header:n},transaction:o})}function Oe(e){const{simpleTableStore:t,transaction:o}=e,i=t.getFormat(),n=!Boolean(i.table_block_row_header);Z.FH({stores:[t],update:{table_block_row_header:n},transaction:o})}function Ue(e,t,o){const i=P.Z.state;if(!i.isActive)return;const{selection:n,simpleTableStore:r}=i;if("row"===n.type){const e=r.getContentStores()[n.start.row];Z.FH({stores:[e],update:{block_color:"default"===t?void 0:t},transaction:o})}if("column"===n.type){const e=w.h4(r),i=w.FA(r)||{};if(!e)return;const a=e[n.start.col];a in i?i[a].color=t:i[a]={color:t},Z.FH({stores:[r],update:{table_block_column_format:i},transaction:o})}M.default.state.phase!==M.SelectionPhase.Selected||e.device.isMobile||D.ZH(e)}function He(e){const{simpleTableStore:t,parentWidth:o,transaction:i}=e,n=w.h4(t);if(!n)return;const r=w.FA(t),a=(o-18)/n.length,s=(0,h.m8)(n.map((e=>[e,{width:a,color:r&&r[e]?r[e].color:void 0}])));Z.FH({stores:[t],update:{table_block_column_format:s},transaction:i})}},84084:(e,t,o)=>{o.d(t,{_P:()=>S,hb:()=>w,RL:()=>k,xv:()=>C});var i=o(96486),n=o.n(i),r=o(13991),a=o(70203),s=o(73959),l=o(72133),c=o(95802),d=o(64233),p=o(88833),u=o(19111),m=o(10743),g=o(50906),h=o(24677),f=o(993),v=o(98104);const y=new Set(["/","／"]),b={"ja-JP":new Set(["；"])};function S(e){const{environment:t,textStore:o,oldSelection:i,oldTextValue:s}=e,c=a.ee(o.getValue()||[]),h=i.startIndex,f=c[h],v=b[r.SP]||new Set;if(!y.has(f)&&!v.has(f))return;if(h>0&&!n().isNaN(parseInt(c[h-1])))return;if(m.Z.state.open||p.Z.state.open||u.Z.state.open||d.Z.state.open)return;if(t.device.isPhone)return;const S=l.get();if(!S)return;const w=l.getRect(S);w&&(m.Z.setState({open:!0,isAddMenu:!1,textStore:o,oldTextValue:s,oldSelection:i,selectionRect:w,lettersAtLastResult:0,filter:""}),g.trackOpenSlashMenu(t))}function w(e){const{environment:t,blockStore:o}=e,i=m.Z.state;if(h.eP({environment:t,store:o}),v.N_({store:o.getBlockTitleStore()}),!i.open&&!t.device.isPhone){const e=o.getBlockTitleStore(),t=c.C.getRectFromStore(o);t&&m.Z.setState({open:!0,isAddMenu:!0,textStore:e,oldTextValue:e.getValue(),oldSelection:{startIndex:0,endIndex:0},selectionRect:t,lettersAtLastResult:0,filter:""})}}function k(e){const{transaction:t,environment:o}=e,i=m.Z.state;if(i.open){const{textStore:e,oldTextValue:n,oldSelection:r}=i;f.sO({environment:o,store:e,value:n,transaction:t}),C();const a=(0,s.sQ)(e);a&&h.eP({environment:o,store:a}),v.Z5({store:e,selection:r})}}function C(){m.Z.setState({open:!1,previousFilter:m.Z.state.open?m.Z.state.filter:void 0})}},64964:(e,t,o)=>{o.d(t,{oV:()=>l,z1:()=>c,rN:()=>d,d4:()=>p,C1:()=>u});var i=o(77094),n=o.n(i),r=(o(67294),o(71644)),a=o(6854),s=o(1310);function l(e){const t={...e,key:(0,r.ZP)()};s.ZP.setState({...s.ZP.state,currentItem:t}),"keep"!==t.durationMs&&setTimeout((()=>{s.ZP.state.currentItem===t&&"keep"!==s.ZP.state.currentItem.durationMs&&s.ZP.setState({...s.ZP.state,currentItem:void 0})}),t.durationMs??s.Ty)}function c(){s.ZP.state.currentItem&&s.ZP.setState({...s.ZP.state,currentItem:{...s.ZP.state.currentItem,durationMs:"keep"}})}function d(){s.ZP.setState({...s.ZP.state,currentItem:void 0})}function p(e){const{item:t,undoFunc:o}=e;l({...t,button:n()(a.ow,{onUndo:o})})}function u(){s.ZP.state.shouldReset&&s.ZP.reset()}},29974:(e,t,o)=>{o.d(t,{wh:()=>we,eX:()=>ke,sM:()=>Ce,ux:()=>_e,ce:()=>Me,y3:()=>Te,L5:()=>Ie,Yi:()=>Pe,KE:()=>xe,Hj:()=>Be,OQ:()=>Ze,FI:()=>Ee,cc:()=>Re,$F:()=>De,_u:()=>Ve,OF:()=>Ne,Xr:()=>Oe,ys:()=>Ue,j:()=>He,bf:()=>ze,Ns:()=>We,IY:()=>je,lF:()=>Ke,O2:()=>Ye,mo:()=>Ge,jF:()=>Xe,Xv:()=>qe,_Q:()=>$e,Y5:()=>Qe,wg:()=>et,LV:()=>tt,$U:()=>ot});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=(o(67294),o(13991)),l=o(15145),c=o(41432),d=o(65917),p=o(2911),u=o(482),m=o(27006),g=o(4615),h=o(45953),f=o(21202),v=o(90468),y=o(77858),b=o(29369),S=o(66079),w=o(9852),k=o(62965),C=o(90965),_=o(54153),M=o(11002),T=o(10482),I=o(98251),P=o(70203),x=o(97880),B=o(5366),Z=o(95477),E=o(77373),R=o(93959),A=o(5575),D=o(70538),F=o(4708),L=o(15010),V=o(33929),N=o(26374),O=o(38755),U=o(15517),H=o(23537),z=o(79315),W=o(88632),j=o(10161),K=o(73329),Y=o(69327),G=o(12768),X=o(81236),q=o(3815),$=o(17364),J=o(50906),Q=o(54642),ee=o(51127),te=o(35253),oe=o(47307),ie=o(54532),ne=o(57400),re=o(3297),ae=o(94419),se=o(92625),le=o(29533),ce=o(95489),de=o(88428),pe=o(10279),ue=o(9953),me=o(4408),ge=o(5978),he=o(5851),fe=o(21325),ve=o(30149),ye=o(53471),be=o(70782);const Se=(0,B.defineMessages)({deletingWorkspace:{id:"spaceActions.deletingWorkspace.loadingMessage",defaultMessage:"Deleting workspace…"},goOnlineCreateSpace:{defaultMessage:"Please go online to create your workspace.",id:"spaceActions.dialogError.createWorkspaceError.goOnline.message"},createSpaceError:{defaultMessage:"Sorry! We could not create your workspace. Please try again.",id:"spaceActions.dialogError.createWorkspaceError.message"},loginToCreateSpace:{defaultMessage:"Must be logged in.",id:"spaceActions.dialogError.createWorkspaceError.notLoggedIn.message"},moveToSpaceOnlineError:{defaultMessage:"Please go online to move content to another space.",id:"spaceActions.dialogError.moveContentError.goOnline.message"},cannotMoveShardRestriction:{defaultMessage:"Cannot move these pages at once.",id:"spaceActions.dialogError.moveContentError.cannotMovePages.message"},cannotMoveContent:{defaultMessage:"Sorry! We could not move this content. Please try again.",id:"spaceActions.dialogError.couldNotMoveContentError.message"},loginToMoveContent:{defaultMessage:"Must be logged in.",id:"spaceActions.dialogError.movetoWorkspace.notLoggedIn.message"},invalidSpaceStore:{defaultMessage:"Invalid space data.",id:"spaceActions.dialogError.createTemplatesInSpace.invalidStorage.message",description:"Space data refers to the data we store on the user's machine about the workspace these templates are being created in."},forkPageError:{defaultMessage:"Could not fork page.",id:"spaceActions.dialogError.forkPageError.message"},invalidSpaceStoreOnNavigate:{defaultMessage:"Invalid space data.",id:"spaceActions.dialogError.navigateToWorkspace.invalidStorage.message",description:"Space data refers to the data we store on the user's machine about the workspace that the user is attempting to navigate to."},createAndDuplicatePageError:{defaultMessage:"Duplicated page could not be created.",id:"spaceActions.createAndDuplicatePageInSpace.copyNotCreated.error",description:"Duplicated page could not be created on user's Notion application."},invalidSpaceStoreOnCreateTemplate:{defaultMessage:"Invalid space view data.",id:"spaceActions.dialogError.createTemplatesInWorkspace.invalidStorage.message",description:"Space view data refers to the data we store on the user's machine about the workspace that the user is creating templates in."},invalidUserSettings:{defaultMessage:"Invalid user settings data.",id:"spaceActions.dialogError.createTemplatesInWorkspace.invalidUserSettings.message",description:"User settings data refers to the data we store on the user's machine about the current logged in user's settings."},noSpaceViewOnJoin:{defaultMessage:"No space view data was created.",id:"spaceActions.dialogError.joinWorkspace.invalidWorkspaceStorage.message",description:"Space view data refers to the data we store on the user's machine about the workspace that the user is attempting to join."},noLocalDataForPermissionGroup:{defaultMessage:"No local data about this workspace.",id:"spaceActions.dialogError.createOrUpdatePermissionGroup.invalidWorkspaceStorage.message",description:"Local data refers to the data we store on the user's machine about the workspace that the user is attempting to create or update a permission group in."}});async function we(e){const{environment:t,name:o,domain:i,userRootStore:n,emailDomains:r,analyticsFrom:s,icon:l,planType:c,userPersona:d,shouldCreateUserPersonaTeam:p,shouldMakeUserPersonaTeamDefault:u}=e,{id:m}=t.currentUser;if(m){const e=await Q.createSpace(t,{name:o,domain:i,emailDomains:r,icon:l,planType:c,initialPersona:d,shouldCreateUserPersonaTeam:p,shouldMakeUserPersonaTeamDefault:u});if("failed"===e.type){if(e.offline)throw new Error(V.default.formatMessage(Se.goOnlineCreateSpace));throw new Error(V.default.formatMessage(Se.createSpaceError))}const{spaceId:g,teamId:h,personaTeamId:f,inviteLinkCode:w}=e.data,k=new q.H2(t,{table:v.bx,id:g}),C=h?q.zX.createChildStore(k,{table:b.e0,id:h}):void 0,_=f?q.zX.createChildStore(k,{table:b.e0,id:f}):void 0,{serverCommitResult:M,performResult:{spaceViewStore:T}}=ve.createAndCommit({userAction:"spaceActions.createSpace",environment:t,perform:e=>{const o=ue.ae({environment:t,table:y.zU,value:{space_id:k.id,notify_mobile:!0,notify_desktop:!0,notify_email:!0,parent_id:m,parent_table:S.dx,alive:!0,joined:!0,joined_teams:(C||_)&&a().compact([null==C?void 0:C.id,null==_?void 0:_.id])},inMemoryRecordCache:n.inMemoryRecordCache,transaction:e}),i=new q.V9(t,o.pointer);return ae.R3({parent:n.getSpaceViewsStore(),append:o,transaction:e}),ae.MK({parent:n.getSpaceViewPointersStore(),append:o,transaction:e}),z.default.setState({...z.default.state,currentSpaceStore:k,currentSpaceViewStore:i}),J.trackCreateSpace(t,{from:s,planType:c,isProfessionalTeamUser:(0,L.QZ)(),domain_type:(0,L.JF)()}),{spaceViewStore:i}}});return await M,await ne.Yh(t),{spaceViewStore:T,spaceStore:k,inviteLinkCode:w,teamStore:C,personaTeamStore:_}}throw new Error(V.default.formatMessage(Se.loginToCreateSpace))}async function ke(e){const{environment:t,blockStores:o,spaceId:i,targetParent:n}=e,{id:r}=t.currentUser;if(r){if(!W.Z.state.online)return{error:V.default.formatMessage(Se.moveToSpaceOnlineError)};const e=[],c=[];for(const t of o)t.isDefined()&&(e.push({id:t.id,spaceId:t.getSpaceId()}),c.push(i));if(a().uniq(c).length>1)return{error:V.default.formatMessage(Se.cannotMoveShardRestriction)};if(n&&n.spaceId!==i)return{error:V.default.formatMessage(Se.cannotMoveShardRestriction)};const u=Q.moveToSpace(t,{blocks:e,targetSpaceId:i,targetParent:n,clearPermissions:(0,H.bq)()});let m;for await(const t of u){if(le.R(t,i),t.error)return d.log({level:"error",from:"spaceActions",type:"moveSpaceError",error:(0,p.Ui)(t.error),data:{userId:r,blocks:e,spaceId:i}}),{error:V.default.formatMessage(Se.cannotMoveContent)};{const e=h.Ak.create(t.value.recordMap).getByTable(f.iU);for(const{value:t}of e){var s,l;if("copy_indicator"===(null==t||null===(s=t.value)||void 0===s?void 0:s.type))m=null==t||null===(l=t.value)||void 0===l?void 0:l.id}}}return le.h(i),{value:m}}return{error:V.default.formatMessage(Se.loginToMoveContent)}}async function Ce(e){const{environment:t,spaceViewStore:o,isPrivate:i,userSettingsStore:n,redirectData:r,userRootStore:l,planType:c,spaceJoinOrCreate:d,teamStore:p,templates:m,templateType:g,personaTeamStore:h,isNewUserOnboarding:f}=e,v=o.getSpaceStore();if(!v)throw new Error(V.default.formatMessage(Se.invalidSpaceStore));let y,b=[];if(n&&v&&m&&(b=await async function(e){const{spaceStore:t,spaceViewStore:o,userSettingsStore:i,teamStore:n}=e;if(await Promise.all(a().compact([t.load(),o.load(),i.load(),null==n?void 0:n.load()])),t.canEdit()){if(!o.isDefined())throw new Error(V.default.formatMessage(Se.invalidSpaceStoreOnCreateTemplate));if(!i.isDefined())throw new Error(V.default.formatMessage(Se.invalidUserSettings));if(!o.getCreatedOnboardingTemplates()){return await async function(e){var t;const{environment:o,spaceStore:i,spaceViewStore:n,isPrivate:r,teamStore:s,personaTeamStore:l,templateType:c,userSettingsStore:d,isOnboardingCreatorNoJoinableSpaces:p}=e;if(p)return await async function(e){var t;const{environment:o,spaceStore:i,spaceViewStore:n,teamStore:r,personaTeamStore:a,userSettingsStore:s,useCases:l}=e,c=null===(t=s.getSettings())||void 0===t?void 0:t.persona,d=[];if(a&&r){if((l.includes("docs")||l.includes("notes"))&&d.push(...Ae({environment:o,personaTeamStore:a,presetUri:A.r})),l.includes("project"))switch(c){case"eng":case"productDesign":case"projectProgramMgmt":case"product":d.push(...Ae({environment:o,personaTeamStore:a,presetUri:D.tt}));break;default:d.push(...Ae({environment:o,personaTeamStore:a,presetUri:D.Yb}))}let e,t,s;if(l.includes("wikis")){let t=M.Y.teamWiki;switch(c){case"eng":t=M.Y.engineeringWikiV2;break;case"product":t=M.Y.productWikiV2;break;case"sales":t=M.Y.salesWikiV2}e=de.rC({environment:o,item:(0,T.G_)(t,V.default.getIntl()),isPrivate:!1,spaceStore:i,spaceViewStore:n,useMinimalTemplates:!0,teamStore:a,type:"inTeam",from:"onboarding",isOnboarding:!0,appendOrPrepend:"prepend"})}r&&(t=de.rC({environment:o,item:(0,T.G_)(M.Y.companyHomeV2,V.default.getIntl()),isPrivate:!1,spaceStore:i,spaceViewStore:n,useMinimalTemplates:!0,teamStore:r,type:"inTeam",from:"onboarding",isOnboarding:!0})),l.includes("goals")&&r&&(s=de.rC({environment:o,item:(0,T.G_)(M.Y.okrs,V.default.getIntl()),isPrivate:!1,spaceStore:i,spaceViewStore:n,useMinimalTemplates:!0,teamStore:r,type:"inTeam",from:"onboarding",isOnboarding:!0}));const p=de.rC({environment:o,item:(0,T.G_)(M.Y.teamHomeV2,V.default.getIntl()),isPrivate:!1,spaceStore:i,spaceViewStore:n,useMinimalTemplates:!0,teamStore:a,type:"inTeam",from:"onboarding",isOnboarding:!0,appendOrPrepend:"prepend"}),[m,g,h,f]=await Promise.all([e,t,s,p]);m&&d.push(m),g&&(d.push(g),ve.createAndCommit({userAction:"Onboarding.renameCompanyHome",environment:o,perform:e=>{ve.applyOperation({store:g,operation:u.op.set({pointer:g.pointer,path:["properties","title"],args:[[V.default.formatMessage(I.K3.workspaceNameHome,{workspaceName:i.getName()})]]}),transaction:e})}})),h&&d.push(h),f&&(d.push(f),ve.createAndCommit({userAction:"Onboarding.renameTeamHome",environment:o,perform:e=>{ve.applyOperation({store:f,operation:u.op.set({pointer:f.pointer,path:["properties","title"],args:[[V.default.formatMessage((0,T.wJ)(c))]]}),transaction:e})}}))}return d}(e);let m=[];if("page_template"===c&&e.templates){const t=e.templates.map((e=>s?de.rC({environment:o,item:e,isPrivate:!1,spaceStore:i,spaceViewStore:n,useMinimalTemplates:!0,teamStore:s,type:"inTeam",from:"onboarding",isOnboarding:!0}):de.rC({environment:o,item:e,isPrivate:r,spaceStore:i,spaceViewStore:n,useMinimalTemplates:!0,type:"inSpace",isOnboarding:!0})));m=a().compact(await Promise.all(t))}else"app_template"===c&&e.templates&&s&&(m=await ee.Xt({environment:o,presets:e.templates,spaceStore:i,spaceViewStore:n,teamStore:s}));const g=null===(t=d.getSettings())||void 0===t?void 0:t.persona;if(l&&g){let e=[];["design","product","marketing","sales","eng"].includes(g)?e=(0,T.GZ)(g,j.default,V.default.getIntl()):(0,T.mS)(g)&&"on"===j.default.getEligibleGroup({defaultGroup:"control",experimentId:"persona_teamspaces_v2"})&&(e=(0,T.K1)(g,V.default.getIntl()));const t=e.map((e=>de.rC({environment:o,item:e,isPrivate:!1,spaceStore:i,spaceViewStore:n,useMinimalTemplates:!0,teamStore:l,type:"inTeam",from:"onboarding",isOnboarding:!0})));m=[...m,...a().compact(await Promise.all(t))]}e.templates&&e.templates.length>0&&ve.createAndCommit({userAction:"spaceActions.createOnboardingTemplatesInSpace",environment:o,perform:e=>{const t={created_onboarding_templates:!0};ue.sW({store:n,data:t,transaction:e})}});return m}({...e})}}return[]}({...e,spaceStore:v,userSettingsStore:n,teamStore:p,personaTeamStore:h})),n&&(y=await async function(e){const{environment:t,spaceStore:o,spaceViewStore:i,userSettingsStore:n,planType:r,spaceJoinOrCreate:a,isNewUserOnboarding:l}=e;if(await Promise.all([o.load(),i.load(),n.load()]),o.canEdit()){if(!i.isDefined())throw new Error(V.default.formatMessage(Se.invalidSpaceStoreOnCreateTemplate));if(!n.isDefined())throw new Error(V.default.formatMessage(Se.invalidUserSettings));const e=function(e,t){if(e.device.isMobile)return null;if("en-US"!==s.SP)return null;if(!t)return null;switch(j.default.getEligibleGroup({defaultGroup:"control",experimentId:"getting_started_high_value_actions"})){case"variant_1":return"desktopHighValueActionsV1";case"variant_2":return"desktopHighValueActionsV2";case"control":return null}}(t,l);let c;if(c=e||(t.device.isMobile?"mobile":"personal"===r?"desktopPersonal":"create"===a?"desktopTeamCreate":"desktopTeamJoin"),!i.getCreatedGettingStarted())return Ee({environment:t,spaceStore:o,spaceViewStore:i,type:c,userSettingsStore:n})}}({isNewUserOnboarding:f,environment:t,spaceStore:v,spaceViewStore:o,userSettingsStore:n,planType:c,spaceJoinOrCreate:d})),"fork_page"===r.type){return await _e({environment:t,userRootStore:l,isPrivate:i,forkedPageId:r.pageId,spaceStore:v,spaceViewStore:o})}if("app_template"===g&&b.length>0){var S;return function(e){const{createdTemplatePages:t,createdGettingStartedPage:o,userUseCases:i,isOnboardingCreatorNoJoinableSpaces:n}=e;if(n){const e=function(e){return e.userUseCases.includes("docs")&&e.userUseCases.includes("project")?e.createdTemplatePages[1]:e.userUseCases.includes("project")?e.createdTemplatePages[0]:void 0}({userUseCases:i||[],createdTemplatePages:t});return e||o}if(!i)return t[0];const r=(0,F.Jp)(i);if("control"===r)return t[0];if("getting_started"===r&&o)return o;for(const a in R.yM)if(i.includes(a))return t[R.pP.indexOf(R.yM[a])];return t[0]}({createdTemplatePages:b,createdGettingStartedPage:y,userUseCases:null==n||null===(S=n.getSettings())||void 0===S?void 0:S.use_cases,isOnboardingCreatorNoJoinableSpaces:e.isOnboardingCreatorNoJoinableSpaces})}return y}async function _e(e){const{environment:t,userRootStore:o,isPrivate:i,forkedPageId:n,spaceStore:r,spaceViewStore:a}=e;if(r.canEdit()){const e=q.G.createChildStore(o,{table:f.iU,id:n});U.nM({currentUserId:t.currentUser.id,blockId:void 0});const s=Date.now(),l=await re.OH({environment:t,store:e,spaceStore:r,spaceViewStore:a,isPrivate:i}),c=Date.now()-s;if(J.trackDuplicateTemplate(t,{from:"publicPage",success:!l.error,template_name:P.Q(e.getTitleValue()),template_block_id:n,target_space_id:(0,g.F9)(r.id),context:"public_page_duplicate",template_duplication_duration_ms:c}),void 0===l.error)return l.value}throw new Error(V.default.formatMessage(Se.forkPageError))}async function Me(e){const{environment:t,spaceViewStore:o,openInNew:i,isNewlyCreatedSpace:n,leavingSpace:r,shouldDeferSubscriptionRefresh:a}=e;await o.awaitNonNullValue();const s=o.getSpaceStore();if(!s)throw new Error(V.default.formatMessage(Se.invalidSpaceStoreOnNavigate));if(!i&&(te.qL({bannerStore:K.Z,id:ye.XQ}),z.default.setState({...z.default.state,currentSpaceStore:s,currentSpaceViewStore:o}),r)){const e=await(0,O.rg)(t,o);z.default.setState({...z.default.state,mainEditorCurrentBlockStore:e})}const l=t.currentUser.id,c=o.getUserRootParentId();if(c&&l!==c){const e=await be.x({environment:t,newCurrentUserId:c});await fe.OR({environment:e,spaceId:s.id,isNewlyCreatedSpace:n,shouldDeferSubscriptionRefresh:a});const{currentUserSettingsStore:o,currentUserRootStore:i}=z.default.state;return{switchedUser:!0,newEnvironment:e,newUserRootStore:i,newUserSettingsStore:o}}return await fe.OR({environment:t,spaceId:s.id,isNewlyCreatedSpace:n,shouldDeferSubscriptionRefresh:a}),{switchedUser:!1}}async function Te(e){const{spaceViewStore:t,redirectPageId:o,openInNew:i,isNewlyCreatedSpace:n,templateGalleryItem:r,leavingSpace:a,shouldDeferSubscriptionRefresh:s}=e;let{environment:c,userSettingsStore:d,userRootStore:p}=e;const u=t.getSpaceStore();if(!u)throw new Error(V.default.formatMessage(Se.invalidSpaceStoreOnNavigate));const m=await Me({environment:c,spaceViewStore:t,openInNew:i,isNewlyCreatedSpace:n,leavingSpace:a,shouldDeferSubscriptionRefresh:s});let g;m.switchedUser&&(c=m.newEnvironment,d=m.newUserSettingsStore,p=m.newUserRootStore);const h=(0,w.getSessionVisitedEvernotePage)();if(d){const e=d.getSettings();!u.canEdit()||!h||null!=e&&e.created_evernote_getting_started||((0,w.setSessionVisitedEvernotePage)(!1),g=await Ee({environment:c,type:"evernote",spaceStore:u,spaceViewStore:t,userSettingsStore:d}))}p&&await Y.Z.reinitializeState(c,p.id,u.id);const v=function(e){const{spaceId:t}=e,o=Y.Z.getWithoutSubscribing(t);if(!Array.isArray(o))return;const i=o[0];if(void 0===(null==i?void 0:i.pageId))return;return i.store}({environment:c,spaceId:u.id}),y=await(0,O.rg)(c,t),b=p&&p.getSpaceViewStores(),S=O.g4(c,t),k=G.default.getState();if(G.default.setState({...k,shouldTriggerPostInviteAnimations:!0}),await new Promise((e=>setTimeout(e,800))),o)ge.navigateToBlock({environment:c,store:new q.G(c,{table:f.iU,id:o}),openInNew:i});else if(g)ge.navigateToBlock({environment:c,store:g,openInNew:i});else if("last_visited_page"===S&&v&&v.canRead()&&v.pathIsAccessibleAndAlive())ge.navigateToBlock({environment:c,store:v,openInNew:i,templateGalleryItem:r,pageVisitSource:l.tY.LastVisitedPage});else if(y)ge.navigateToBlock({environment:c,store:y,openInNew:i,templateGalleryItem:r});else if(u.canEdit()){const{performResult:e}=ve.createAndCommit({userAction:"spaceActions.createdPage",environment:c,perform:e=>xe({environment:c,spaceStore:u,spaceViewStore:t,isPrivate:!0,transaction:e,prepend:!1})});ge.navigateToBlock({environment:c,store:e,openInNew:i})}else d&&p&&b&&b.length>0&&b[0]&&b[0].id!==t.id?(U.vq(),await Ie({environment:c,userRootStore:p,userSettingsStore:d,openInNew:i})):(U.vq(),await ce.xN(c))}async function Ie(e){const{environment:t,userRootStore:o,ignoreSpaceId:i,userSettingsStore:n,openInNew:r,skipPendingTransferWorkspaces:a,leavingSpace:s}=e;await o.load();const l=o.getSpaceViewStores();await Promise.all(l.map((e=>e.load())));const c=l.filter((e=>{var t,o;return!!e.isDefined()&&(i?e.getSpaceId()!==i:!a||!(0,C.DI)(null===(t=e.getSpaceStore())||void 0===t||null===(o=t.getSettings())||void 0===o?void 0:o.space_request))}));let d;for(const p of c){const e=await(0,O.rg)(t,p);if(e&&e.isDefined()){d=p;break}}d?await Te({environment:t,spaceViewStore:d,userSettingsStore:n,userRootStore:o,openInNew:r,leavingSpace:s}):(U.vq(),await ce.xN(t))}async function Pe(e){const{environment:t,index:o,userRootStore:i,userSettingsStore:n}=e,r=$.Z.getAllSpaceViewStores(t)[o];r&&await Te({environment:t,spaceViewStore:r,userSettingsStore:n,userRootStore:i})}function xe(e){const{environment:t,spaceViewStore:o,spaceStore:i,isPrivate:n,prepend:r,title:a,transaction:s,loading:l}=e,d=ue.j4({environment:t,type:l?c.Ti.copyIndicator:c.Ti.page,properties:{title:a?P.TP(a):void 0},inMemoryRecordCache:i.inMemoryRecordCache,transaction:s,spaceId:i.id});return Be({environment:t,spaceStore:i,spaceViewStore:o,pageStore:d,isPrivate:n,location:{type:r?"prepend":"append"},transaction:s}),d}function Be(e){const{environment:t,spaceStore:o,spaceViewStore:i,pageStore:n,isPrivate:r,location:a,transaction:s}=e,{id:l}=t.currentUser;let c;r?l&&(c={type:"user_permission",role:"editor",user_id:l}):c={type:"space_permission",role:"editor"},ue.sW({store:n,data:{permissions:c?[c]:[]},transaction:s}),r&&Ze({environment:t,spaceStore:o,spaceViewStore:i,transaction:s});const d=a||{type:"append"};"prepend"===d.type?ae.Ce({parent:r?i.getPrivatePagesStore():o.getPagesStore(),prepend:n,before:d.before,transaction:s}):"append"===d.type?ae.R3({parent:r?i.getPrivatePagesStore():o.getPagesStore(),append:n,after:d.after,transaction:s}):(0,x.t1)(d)}function Ze(e){const{environment:t,spaceStore:o,spaceViewStore:i,transaction:n}=e,r=new Set(i.getPrivatePageStores().map((e=>e.id)));(0,O.XD)(t,o).filter((e=>e.isTopLevelPrivatePage({spaceStore:o,environment:t}))).forEach((e=>{r.has(e.id)||ae.R3({parent:i.getPrivatePagesStore(),append:e,transaction:n})}))}async function Ee(e){const{environment:t,type:o,spaceStore:i,spaceViewStore:n,userSettingsStore:r}=e;if(!W.Z.state.online)return;const a=(0,T.nD)(o,V.default.getIntl()).rootId,s=await Q.loadBlockSubtree(t,{block:{id:a,spaceId:i.id},shallow:!1});let l;if("failed"===s.type){if("local"!==Z.Z.env)return;l=function(e){const t=(0,g.ZP)(),o=(0,g.ZP)(),i=h.Ak.create(),n={id:e,version:0,type:"page",parent_id:t,parent_table:v.bx,alive:!0,permissions:[],space_id:t,format:{page_icon:"📝"},properties:{title:[["Getting Started"]]},content:[o]};return i.set({id:n.id,table:f.iU,spaceId:t},{value:n,role:"reader"}),i}(a)}else l=h.Ak.create(s.data.subtreeRecordMap);const c="spaceActions.createGettingStartedPageInSpace",{performResult:d}=ve.createAndCommit({userAction:c,environment:t,perform:e=>{const s=xe({environment:t,spaceStore:i,spaceViewStore:n,isPrivate:!0,prepend:!0,transaction:e});me.fL({environment:t,inMemoryRecordCache:s.inMemoryRecordCache,recordMap:l,debugSource:c});const d=ie.K8(t,{blockId:a,inMemoryRecordCache:s.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0});if(!d)throw new Error(V.default.formatMessage(Se.createAndDuplicatePageError));ie.E9({environment:t,sourceBlockId:a,targetBlockPointer:s.pointer,sourceBlockSubtree:d,targetInMemoryRecordCache:s.inMemoryRecordCache,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0});const p={},u={};return"evernote"===o?u.created_evernote_getting_started=!0:p.created_getting_started=!0,Object.keys(p).length>0&&ue.sW({store:n,data:p,transaction:e}),Object.keys(u).length>0&&ue.sW({store:r.getSettingsStore(),data:u,transaction:e}),s}});return J.trackGettingStartedPageCreate(t,{getting_started_page_type:o,getting_started_page_id:a,duplicated_from_page_id:a,duplicated_to_page_id:d.id}),d}function Re(e){const{environment:t,spaceStore:o,spaceViewStore:i,transaction:n,copyPageId:r,recordMap:a,isPrivate:s,allowCopyExternalObjectInstances:l}=e,c=xe({environment:t,spaceStore:o,spaceViewStore:i,isPrivate:s,loading:!0,transaction:n});me.fL({environment:t,inMemoryRecordCache:c.inMemoryRecordCache,recordMap:a,debugSource:"spaceActions.createAndDuplicatePageInSpace"});const d=ie.K8(t,{blockId:r,inMemoryRecordCache:c.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:l});if(!d)throw new Error(V.default.formatMessage(Se.createAndDuplicatePageError));return ie.E9({environment:t,sourceBlockId:r,targetBlockPointer:c.pointer,sourceBlockSubtree:d,targetInMemoryRecordCache:c.inMemoryRecordCache,transaction:n,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0}),c}function Ae(e){var t;const{environment:o,presetUri:i,personaTeamStore:n}=e,r=null===(t=(0,R.SP)(i))||void 0===t?void 0:t.uri,a=n.getTeamPagesStores().find((e=>e.getFormat().app_config_uri===r));if(r){const{performResult:{blockStores:e}}=ve.createAndCommit({environment:o,perform:e=>{const t=(0,E.p)().find((e=>e.uri===r)),s=null==t?void 0:t.presets.find((e=>e.uri===i));if(s){const t=(0,R.KC)(s),i=ee.aT({environment:o,appParentStore:n,appUri:r,features:t,createOrModify:"create",initializeStore:a,transaction:e});if(i)return{blockStores:i}}return{blockStores:[]}},userAction:"Onboarding.createAppTemplateInSpace"});return e}return[]}async function De(e){const{environment:t,spaceStore:o}=e;o.isDefined()&&!(0,k.Z)(o.getEmailDomains(),e.emailDomains)&&J.trackAllowedEmailDomainChange(t,{domains:e.emailDomains||[],confirmed:!0});const i={email_domains:e.emailDomains};e.name&&(i.name=e.name);const n={};for(const r of(0,x.Yd)(i)){const e=o.getKeyStore(r).getValue(),t=i[r];a().isEqual(e,t)||(n[r]=t||null)}a().isEmpty(n)||await new Promise(((e,i)=>{ve.createAndCommit({userAction:"spaceActions.updateSpace",environment:t,perform:t=>{ue.sW({store:o,data:n,transaction:t}),t.postSubmitCallbacks.push((t=>{t?i(t):e()}))}})}))}async function Fe(e){var t;const{environment:o,spaceStore:i,domain:n}=e;(null===(t=X.Z.state.publicSpaceDataMap[i.id])||void 0===t?void 0:t.domain)!==n&&(await Q.updateSpaceDomain(o,{spaceId:i.id,domain:n}),X.Z.getPublicSpaceData(o,i.id,!0))}async function Le(e){var t;const{environment:o,spaceStore:i,publicHomePage:n}=e;(null===(t=X.Z.state.publicSpaceDataMap[i.id])||void 0===t?void 0:t.publicHomePage)!==n&&(await Q.updatePublicHomePage(o,{spaceId:i.id,publicHomePage:n}),X.Z.getPublicSpaceData(o,i.id,!0))}function Ve(e){const{environment:t,spaceStore:o,domain:i}=e,{currentUserStore:n}=z.default.state;return Q.checkSpaceDomain(t,{spaceId:o.id,domain:i},null==n?void 0:n.id)}async function Ne(e){const{environment:t,spaceStore:o,spaceBasicSettingsStore:i,securitySettingsStore:n}=e,{name:r,domain:a,emailDomains:s,publicHomePage:l}=i.state;await Promise.all([De({environment:t,spaceStore:o,name:r,emailDomains:s}),Fe({environment:t,spaceStore:o,domain:a}),Le({environment:t,spaceStore:o,publicHomePage:l}),n?he.n(t,{spaceStore:o,securitySettingsState:n.state}):Promise.resolve()])}const Oe=function(e){const{environment:t,transaction:o,spaceStore:i,disablePublicAccess:n,disableGuests:r,disableMoveToSpace:a,disableExport:s,disableSpacePageEdits:l,disablePublicAccessRequests:c,disableTeamCreation:d,disableMembershipRequests:p,disableGuestMembershipRequests:u,enableAiFeature:m,disableTeamGuests:g}=e;ue.sW({store:i,data:{disable_public_access:n,disable_guests:r,disable_move_to_space:a,disable_export:s,disable_space_page_edits:l,disable_public_access_requests:c,settings:{...i.getSettings(),enable_ai_feature:m,disable_team_guests:g},disable_team_creation:d},transaction:o}),ve.applyOperation({store:i,operation:{pointer:i.pointer,path:["settings","disable_membership_requests"],command:"set",args:p},transaction:o}),ve.applyOperation({store:i,operation:{pointer:i.pointer,path:["settings","disable_guest_membership_requests"],command:"set",args:u},transaction:o}),c&&J.trackToggleRequestAccessSecuritySetting(t,{disable_public_access_requests:c})},Ue=function(e){const{transaction:t,spaceStore:o,inviteLinkEnabled:i}=e;ue.sW({store:o,data:{invite_link_enabled:i},transaction:t})};async function He(e){const{environment:t,spaceId:o,userRootStore:i,navigate:n,analyticsFrom:r,userSettingsStore:a,redirectPageId:s,inviteCode:l,shouldDeferSubscriptionRefresh:c}=e,d=i.getSpaceViewStores().find((e=>e.getSpaceId()===o));if(Z.Z.isAdminMode||Q.setSpaceNotificationsAsRead(t,{timestamp:Date.now(),spaceId:o}),d)return!0!==d.getJoined()&&ve.createAndCommit({userAction:"spaceActions.joinSpace",environment:t,perform:e=>{Je({spaceViewStore:d,transaction:e})}}),n&&await Te({environment:t,spaceViewStore:d,userSettingsStore:a,redirectPageId:s,userRootStore:i,shouldDeferSubscriptionRefresh:c}),{spaceViewStore:d};{const c=await Q.addUsersToSpace(t,{userIds:[i.id],spaceId:e.spaceId,inviteCode:l});if("failed"===c.type)throw c.body&&c.body.clientData&&"invite_link_disabled"===c.body.clientData.type&&_.Z.remove(N.WX),c.error;const d=i.getSpaceViewStores();await Promise.all(d.map((e=>e.load())));const p=d.find((e=>e.getSpaceId()===o));if(!p)throw new Error(V.default.formatMessage(Se.noSpaceViewOnJoin));return!0!==p.getJoined()&&ve.createAndCommit({userAction:"spaceActions.joinSpace",environment:t,perform:e=>{Je({spaceViewStore:p,transaction:e})}}),n&&await Te({environment:t,spaceViewStore:p,userSettingsStore:a,redirectPageId:s,userRootStore:i}),fe.OR({environment:t,spaceId:e.spaceId}).then((()=>{J.trackJoinSpace(t,{from:r})})),_.Z.remove(N.WX),z.default.setState({...z.default.state,currentSpaceStore:p.getSpaceStore(),currentSpaceViewStore:p}),ne.Th({environment:t,force:!0}),await ne.Yh(t),{spaceViewStore:p}}}async function ze(e){const{environment:t,spaceId:o,userSettingsStore:i}=e,{currentUserRootStore:n,currentUserStore:r}=z.default.state;if(n&&r){const e=await Q.removeUsersFromSpace(t,{userIds:[r.id],spaceId:o,removePagePermissions:!0,revokeUserTokens:!1});return"success"===e.type?(Ie({environment:t,userRootStore:n,ignoreSpaceId:o,userSettingsStore:i,leavingSpace:!0}),!0):(oe.showError(e),!1)}}async function We(e){const{environment:t,spaceId:o,userSettingsStore:i}=e,{currentUserRootStore:n,currentUserStore:r}=z.default.state;if(n&&r){se.j({message:Se.deletingWorkspace});try{const{value:e}=await Q.deleteSpace(t,{spaceId:o}).next();if(e.error)throw e.error;await me.bG({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,pointer:{table:S.dx,id:n.id},userId:t.currentUser.id}),Ie({environment:t,userRootStore:n,ignoreSpaceId:o,userSettingsStore:i})}finally{se.x()}}}function je(e){const{environment:t,blocks:o,transaction:i}=e,n=t.currentUser.id;if(n)for(const r of o){const e=r.getPermissionItems().filter((e=>(0,m.FB)(e)));ue.sW({store:r,data:{permissions:[...e,{type:"user_permission",role:"editor",user_id:n}]},transaction:i})}}function Ke(e){const{environment:t,blocks:o,transaction:i}=e;if(t.currentUser.id)for(const n of o){const e=n.getPermissionItems(),o=e.find((e=>"space_permission"===e.type)),r=e.filter((e=>(0,m.FB)(e)));o||pe.ep({environment:t,store:n,permissionItems:[...r,{type:"space_permission",role:"editor"}],transaction:i})}}function Ye(e){const{blocks:t,transaction:o}=e;for(const i of t){const e=i.getPermissionItems().filter((e=>(0,m.FB)(e)));ue.sW({store:i,data:{permissions:e.length>0?e:null},transaction:o})}}function Ge(e){const{spaceStore:t,transaction:o}=e;if(!t.isDefined())throw new Error(V.default.formatMessage(Se.noLocalDataForPermissionGroup));const i=Date.now(),n={id:(0,g.ZP)(),last_edited_time:i},r=[n,...t.getPermissionGroups()];return ue.sW({store:t,data:{permission_groups:r},transaction:o}),n}function Xe(e){const{spaceStore:t,group:o,transaction:i}=e;if(!t.isDefined())throw new Error(V.default.formatMessage(Se.noLocalDataForPermissionGroup));const n=t.getPermissionGroups();let r;r=n.findIndex((e=>e.id===o.id))>=0?n.map((e=>e.id===o.id?o:e)):[...n,o],ue.sW({store:t,data:{permission_groups:r},transaction:i})}async function qe(e){const{environment:t,spaceStore:o,group:i,transaction:n}=e;if(!o.isDefined())throw new Error(V.default.formatMessage(Se.noLocalDataForPermissionGroup));const r=o.getPermissionGroups().filter((e=>e.id!==i.id));ue.sW({store:o,data:{permission_groups:r},transaction:n}),await Q.transferPermissionGroup(t,{spaceId:o.id,groupId:i.id})}const $e=function(e){const{userRootStore:t,spaceViewIds:o,transaction:i,spaceViewPointers:n}=e;ue.sW({store:t,data:{space_views:o,space_view_pointers:n},transaction:i})};function Je(e){ue.sW({store:e.spaceViewStore,data:{joined:!0},transaction:e.transaction})}function Qe(e){let{spaceBasicSettingsStore:t,environment:o,spaceId:i}=e;return new Promise(((e,r)=>{const a=X.Z.getPublicSpaceData(o,i);t.state.domain!==(null==a?void 0:a.domain)&&null!=a&&a.hasPublicPages?oe.showDialog({message:n()("div",{style:{overflowWrap:"anywhere"}},void 0,n()(B.FormattedMessage,{id:"spaceBasicSettings.changeWorkspaceDomain.prompt",defaultMessage:"This workspace has public pages. If you proceed with changing the domain, any existing links starting with {current_domain}.notion.site will no longer work.",values:{current_domain:(null==a?void 0:a.domain)||"your_domain"}}),n()("p",{}),n()(B.FormattedMessage,{id:"spaceBasicSettings.changeWorkspaceDomain.areYouSure",defaultMessage:"Are you sure you want to change your domain?"})),showCancel:!1,keepFocus:!0,items:[{label:n()(B.FormattedMessage,{id:"spaceBasicSettings.changeWorkspaceDomain.changeButton.label",defaultMessage:"Change"}),color:"red",onAccept:()=>e(!0)},{label:n()(B.FormattedMessage,{id:"spaceBasicSettings.changeWorkspaceDomain.cancelButton.label",defaultMessage:"Cancel"}),color:void 0,onAccept:()=>e(!1)}]}):e(!0)}))}function et(e,t,o){const i=o||z.default.state.currentSpaceStore;if(!i)throw d.log({level:"error",from:"spaceActions",type:"setSpaceSurveyData",error:{message:"Couldn't find a SpaceStore."}}),new Error;ve.createAndCommit({userAction:"spaceActions.setSpaceSurveyData",environment:e,perform:e=>{!function(e,t,o){ve.applyOperation({store:e,operation:{pointer:e.pointer,path:["settings"],command:"update",args:{...e.getSettings(),...o}},transaction:t})}(i,e,{space_survey_data:t})}})}function tt(e){const t=e.getEditDomain();return t?`${window.location.host}/${t}`:null}function ot(e){return e=(e=e.toLowerCase()).replace(/[^a-z0-9-]/g,"")}},97627:(e,t,o)=>{o.d(t,{W7:()=>l,cm:()=>c,lo:()=>d,pE:()=>p,TY:()=>u,kY:()=>m,pu:()=>g,NY:()=>h,pc:()=>f,Q1:()=>v});var i=o(65917),n=o(51456),r=o(79315),a=o(30149);function s(e,t,o){a.applyOperation({store:e,operation:{pointer:e.pointer,path:["settings"],command:"update",args:{...e.getSettings(),...o}},transaction:t})}function l(e){var t;const{currentSpaceViewStore:o}=r.default.state;o&&void 0===(null===(t=o.getSettings())||void 0===t?void 0:t.enterprise_settings_prompt)&&a.createAndCommit({userAction:"userSettingsActions.updateOnboardingChecklistSettings",environment:e,perform:e=>{s(o,e,{enterprise_settings_prompt:{status:"showing",num_times_shown:0}})}})}function c(e){var t;const{currentSpaceViewStore:o}=r.default.state;o&&void 0===(null===(t=o.getSettings())||void 0===t?void 0:t.domain_claim_settings_prompt)&&a.createAndCommit({userAction:"userSettingsActions.updateOnboardingChecklistSettings",environment:e,perform:e=>{s(o,e,{domain_claim_settings_prompt:{status:"showing",num_times_shown:0}})}})}function d(e){var t;const{currentSpaceViewStore:o}=r.default.state;o&&void 0===(null===(t=o.getSettings())||void 0===t?void 0:t.space_analytics_settings_prompt)&&a.createAndCommit({userAction:"userSettingsActions.initializeSpaceAnalyticsPromptSettings",environment:e,perform:e=>{s(o,e,{space_analytics_settings_prompt:{status:"showing",num_times_shown:0}})}})}function p(e){var t;const{currentSpaceViewStore:o}=r.default.state;if(!o)return;const i=null===(t=o.getSettings())||void 0===t?void 0:t.space_analytics_settings_prompt;if(!i||"dismissed"===i.status||"hidden"===i.status)return;const n={...i,num_times_shown:i.num_times_shown+1};n.num_times_shown>3&&(n.status="hidden"),a.createAndCommit({userAction:"spaceViewActions.incrementSpaceAnalyticsSettings",environment:e,perform:e=>{s(o,e,{space_analytics_settings_prompt:n})}})}function u(e){var t;const{currentSpaceViewStore:o}=r.default.state;if(!o)return;const i=null===(t=o.getSettings())||void 0===t?void 0:t.space_analytics_settings_prompt;i&&"dismissed"!==i.status&&a.createAndCommit({userAction:"spaceViewActions.incrementspaceAnalyticsSettings",environment:e,perform:e=>{s(o,e,{space_analytics_settings_prompt:{status:"dismissed"}})}})}function m(e,t){var o;const{currentSpaceViewStore:i}=r.default.state;if(!i)return;const l=(null===(o=i.getSettings())||void 0===o?void 0:o.page_analytics_opt_out_list)||[];l.includes(t)||(a.createAndCommit({userAction:"spaceViewActions.optOutOfPageAnalyticsForPage",environment:e,perform:e=>{s(i,e,{page_analytics_opt_out_list:[...l,t]})}}),n.track(e,"page_analytics_page_opt_out"))}function g(e,t){var o;const{currentSpaceViewStore:i}=r.default.state;if(!i)return;const l=(null===(o=i.getSettings())||void 0===o?void 0:o.page_analytics_opt_out_list)||[];l.includes(t)&&(a.createAndCommit({userAction:"spaceViewActions.optInToPageAnalyticsForPage",environment:e,perform:e=>{s(i,e,{page_analytics_opt_out_list:l.filter((e=>e!==t))})}}),n.track(e,"page_analytics_page_opt_in"))}function h(e){const{currentSpaceViewStore:t}=r.default.state;t&&a.createAndCommit({userAction:"spaceViewActions.confirmAdminContentSearchAcknowledgement",environment:e,perform:e=>{s(t,e,{admin_content_search_acknowledgement:!0})}})}function f(e){var t;const{currentSpaceViewStore:o}=r.default.state;o&&(null!==(t=o.getSettings())&&void 0!==t&&t.has_migrated_to_google_drive_external_integration||a.createAndCommit({userAction:"spaceViewActions.setUserMigratedToGoogleDriveExternalIntegrationInSpace",environment:e,perform:e=>{s(o,e,{has_migrated_to_google_drive_external_integration:!0})}}))}function v(e,t,o){const n=o||r.default.state.currentSpaceViewStore;if(!n)throw i.log({level:"error",from:"spaceActions",type:"setUserSurveyData",error:{message:"Couldn't find a SpaceViewStore."}}),new Error;a.createAndCommit({userAction:"spaceViewActions.setUserSurveyData",environment:e,perform:e=>{s(n,e,{user_survey_data:t})}})}},21325:(e,t,o)=>{o.d(t,{Mg:()=>H,y3:()=>z,EO:()=>W,r7:()=>G,$B:()=>X,OR:()=>q,bi:()=>$,px:()=>Q,M_:()=>te,I0:()=>oe,Xb:()=>ie});var i=o(77094),n=o.n(i),r=o(17126),a=o(67294),s=(o(41892),o(65917)),l=(o(65454),o(15157)),c=o(26929),d=o(47425),p=o(5366),u=o(91754),m=o(65162),g=(o(95477),o(15010)),h=o(33929),f=o(78873),v=o(62216),y=o(21115),b=o(8323),S=o(23537),w=o(79315),k=o(73329),C=o(39218),_=o(81236),M=o(3815),T=o(92083),I=o(27242),P=o(9209),x=o(78291),B=o(85703),Z=o(50906),E=o(54642),R=o(35253),A=o(47307),D=o(92625),F=o(97977),L=o(94507),V=o(93678);const N="SubscriptionDataV2";let O;const U=(0,p.defineMessages)({updatingSubscription:{id:"subscriptionSettings.updatingSubscriptionMessage",defaultMessage:"Updating your subscription…"},verifyingEligibility:{id:"subscriptionSettings.verifyingEligibilityMessage",defaultMessage:"Verifying eligibility…"},personalFree:{id:"subscriptionSettings.personalFreeMessage",defaultMessage:"You are now subscribed to Notion’s Personal Pro Plan for free."},educationPlusFree:{id:"subscriptionSettings.educationPlusFreeMessage",defaultMessage:"You are now subscribed to Notion's Education plan for free",description:"Shown to confirm that a plan change was successful"}});async function H(e){const{environment:t,spaceStore:o,plan:i,billingEmail:n,creditAmount:r,stripeToken:a,vatId:s,coupon:l,customerName:c,businessName:d,addressLine1:p,addressZip:u,addressCity:m,addressState:h,addressCountry:f,promoCodeId:v,from:b,addOns:S,useTestClock:w}=e,{data:C}=x.default.state,_=j(t,C),M=null==C?void 0:C.addOns;if(!C)throw new Error("Subscription data not loaded.");R.Js({bannerStore:k.Z}),D.j({message:U.updatingSubscription});const T=await E.updateSubscription(t,{spaceId:o.id,plan:i,billingEmail:n,creditAmount:r,stripeToken:a,vatId:s,coupon:l,customerName:c,businessName:d,addressLine1:p,addressZip:u,addressCity:m,addressState:h,addressCountry:f,promoCodeId:v,addOns:S,useTestClock:w});let I;if("failed"===T.type)A.showError(T);else{const e=y.XX(C);if(e){const o=Boolean(i&&i!==e.plan),r={...o?{plan_changed:o,plan_current:i,plan_old:e.plan}:{plan_changed:o},billing_email_changed:Boolean(n&&n!==e.billingEmail),billing_address_changed:!1};I=K(C,e),Z.trackSubscriptionUpdateBilling(t,r)}else i&&Z.trackCreateSubscription(t,{plan:i,credit_amount:r||0});await Y({environment:t,spaceStore:o,newDefaultTeamId:T.data.newDefaultTeamId});const{data:a}=x.default.state;if(!a)throw new Error("Subscription data not loaded.");Z.trackSubscriptionChanged(t,{from:b,action:"update",spaceId:o.id,oldSubscriptionTier:_,newSubscriptionTier:j(t,a),oldPriceId:I,newPriceId:i,oldAddOns:null==M?void 0:M.map((e=>e.feature)),newAddOns:a.addOns.map((e=>e.feature)),addressCountry:f,creditAmount:r,isProfessionalTeamUser:(0,g.QZ)()})}return D.x(),"success"===T.type}async function z(e){const{environment:t,spaceStore:o,address:i}=e;R.Js({bannerStore:k.Z}),D.j({message:U.updatingSubscription});const n=await E.updateSubscription(t,{spaceId:o.id,customerName:i.name,businessName:i.businessName,addressLine1:i.addressLine1,addressLine2:i.addressLine2,addressZip:i.zipCode,addressCity:i.city,addressState:i.state,addressCountry:i.country});if("failed"===n.type)throw D.x(),A.showError(n),n.error;Z.trackSubscriptionUpdateBilling(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!0}),await $(t),await Q(t),D.x()}async function W(e){const{environment:t,spaceStore:o,planType:i,from:n}=e,{data:r}=x.default.state;if(!r)throw new Error("Subscription data not loaded.");const a=j(t,r),s=r.addOns,l=await E.cancelSubscription(t,{spaceId:o.id,planType:i});"failed"===l.type&&A.showError(l);const c=y.XX(r);let d;"subscribed_admin"===r.type&&c&&(d=!0,Z.trackCancelSubscription(t,{plan:c.plan})),await Y({environment:t,spaceStore:o,newDefaultTeamId:"success"===l.type?l.data.newDefaultTeamId:void 0});const{data:p}=x.default.state;if(!p)throw new Error("Subscription data not loaded.");return Z.trackSubscriptionChanged(t,{from:n,action:"cancel",spaceId:o.id,oldSubscriptionTier:a,newSubscriptionTier:j(t,p),oldPriceId:K(r,c),oldAddOns:s.map((e=>e.feature)),isCancelSubscription:d,isProfessionalTeamUser:(0,g.QZ)()}),!0}function j(e,t){const o=(0,b.zt)();if(!t)return o;return(0,y.DH)(t)?"free":o}function K(e,t){if(!e)return;return(0,y.DH)(e)||null==t?void 0:t.plan}async function Y(e){let{environment:t,newDefaultTeamId:o,spaceStore:i}=e;if(await $(t),await Q(t),(0,S.bq)()&&t.currentUser.id&&void 0!==o){await L.m({userId:t.currentUser.id,spaceId:i.id,environment:t});const e=M.zX.createChildStore(i,{table:"team",id:o,spaceId:i.id});await e.load()}}async function G(e){const{environment:t,spaceStore:o,code:i}=e;D.j({message:U.verifyingEligibility});const{data:r}=x.default.state;if(!r)throw new Error("Subscription data not loaded.");const a=await E.updateSubscriptionToEducationPlan(t,{spaceId:o.id,code:i});"failed"===a.type?A.showError(a):a.data.isEligible?ee(r,t):P.Z.setState({open:!0,handlePromoCode:async e=>{D.j({message:U.updatingSubscription});const i=await E.updateSubscriptionToEducationPlan(t,{spaceId:o.id,code:e});"failed"===i.type?A.showError(i):i.data.isEligible?ee(r,t):A.showErrorMessage(n()(p.FormattedMessage,{id:"subscriptionSettings.invalidPromoCodeError.message",defaultMessage:"This promo code is not valid."})),D.x()}}),D.x()}function X(){O&&O.close()}async function q(e){const{environment:t,spaceId:o,isNewlyCreatedSpace:i,shouldDeferSubscriptionRefresh:n}=e,r=x.default.state.spaceId;if(!t.currentUser.isLoggedIn()||r&&r===o)await x.default.waitUntilLoaded();else if(x.default.setState({...x.default.state,spaceId:o}),B.Z.setState({...B.Z.state,spaceId:o}),i){const e={credits:[],creditEnabled:!1,totalCredit:0,availableCredit:0,version:"v2",type:"unsubscribed_admin",users:[],bots:[],joinedMemberIds:[],blockUsage:0,hasPaidNonzero:!1,accountBalance:0,timelineViewUsage:0,inviteLinkCode:"",userSimilarity:{},spaceUsers:[],members:[],customerData:void 0,revenueCatEnabled:!1,addOns:[]};x.default.setState({...x.default.state,data:e}),$(t)}else await $(t,{shouldDeferSubscriptionRefresh:n}),Q(t)}async function $(e){let{shouldDeferSubscriptionRefresh:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{spaceId:o}=x.default.state,i=e.currentUser.id;if(!o)throw new Error("No spaceId.");{const n=`${N}:${o}:v2`,r=l.Z.get({userId:i,key:n});r&&x.default.setState({spaceId:o,data:r}),t?J({environment:e,spaceId:o,currentUserId:i,localKey:n}):await J({environment:e,spaceId:o,currentUserId:i,localKey:n})}}async function J(e){let{environment:t,spaceId:o,currentUserId:i,localKey:n}=e;await C.transactionQueue.drain();const[r,a]=await Promise.all([E.getSubscriptionData(t,{spaceId:o,version:"v2"}),E.getVisibleUsers(t,{spaceId:o})]);if("success"===r.type&&"success"===a.type){const e={...r.data,...a.data};l.Z.set({userId:i,key:n,value:e}),x.default.state.spaceId===o&&(x.default.setState({spaceId:o,data:e}),y.YK(e)&&Z.trackCurrentlySubscribed(t))}else s.log({level:"error",from:"subscriptionActions",type:"fetchSubscriptionDataV2Failed",data:{miscDataToConvertToString:{getSubscriptionDataResponseType:r.type,getSubscriptionDataResponseStatus:r.status,getVisibleUserResponseType:a.type,getVisibleUserResponseStatus:a.status}}});await _.Z.awaitPublicSpaceData(t,o,!0)}async function Q(e){const{spaceId:t}=x.default.state,o=e.currentUser.id;if(!t)throw new Error("No spaceId.");{const i=`UpcomingInvoiceData:${t}:v2`,n=l.Z.get({userId:o,key:i});n&&B.Z.setState({spaceId:t,data:n}),await C.transactionQueue.drain();const r=await E.getInvoiceData(e,{spaceId:t,type:"upcoming"});if("success"===r.type){const{data:e}=r;l.Z.set({userId:o,key:i,value:e.invoiceData}),B.Z.state.spaceId===t&&B.Z.setState({spaceId:t,data:e.invoiceData})}else s.log({level:"error",from:"subscriptionActions",type:"fetchUpcomingInvoiceCall",data:{miscDataToConvertToString:{upcomingInvoiceResponse:r}}})}}async function ee(e,t){await $(t),Q(t);const o=()=>{A.showMessage({message:h.default.formatMessage(U.educationPlusFree)}),T.Z.setState({...T.Z.state,currentTab:"billing",defaultSubtab:void 0});const o=y.XX(e);Z.trackSubscriptionUpdatePlan(t,{plan:"student_free",old_plan:o?o.plan:void 0})};await F.shouldCreatePassword(t)?f.E({environment:t,onSubmit:o,onCancel:o}):o()}function te(e){const{data:t}=x.default.state;if(e.device.isMobileNative)return!0;if(t){if((0,v.du)())return!0;if(y.Ln(e,t))return Z.trackReachBlockLimit(e),function(e){const{device:t}=e,{isMobile:o,isTablet:i}=t,r=o&&!i;if((0,v.du)())return;R.Bw({id:"SubscriptionEditingBlocker",bannerStore:k.Z,type:u.$.Red,render:()=>n()(a.Fragment,{},void 0,n()(p.FormattedMessage,r?{id:"subscriptionActions.overFreeBlockLimit.shortMessage",defaultMessage:"You are over the block limit"}:{id:"subscriptionActions.overFreeBlockLimit.longMessage",defaultMessage:"You are over the block limit for the Free plan"}),n()(m.Z,{onClick:()=>{V.y(e,{from:"block_limit_banner",for:d.$M})},style:{marginLeft:12}},void 0,n()(p.FormattedMessage,r?{id:"subscriptionActions.upgradeForUnlimitedBlocks.shortMessage",defaultMessage:"Upgrade"}:{id:"subscriptionActions.upgradeForUnlimitedBlocks.longMessage",defaultMessage:"Upgrade for unlimited"})))})}(e),!1;y.XZ(e,t)&&Z.trackApproachingBlockLimit(e)}if((0,v.e0)()){var o;const e=null===(o=w.default.state.currentSpaceStore)||void 0===o?void 0:o.getOverdueSubscription(),t=x.default.state.testClockTime??r.ou.now(),{paymentStatus:i}=(0,c.cS)({now:t,overdueSubscription:e});if("unpaid"===i)return!1}return R.qL({bannerStore:k.Z,id:"SubscriptionEditingBlocker"}),!0}function oe(e,t){const{subscriptionTier:o,from:i,addOnFeature:n}=t;Z.trackSubscriptionUpgradeModalOpen(e,{subscriptionTier:o,from:i,addOnFeature:n}),I.Z.open(o,n)}function ie(e){I.Z.openForClaimAndUpgrade(e)}},99498:(e,t,o)=>{o.d(t,{k2:()=>a,v5:()=>s,Cl:()=>l,Kj:()=>c});var i=o(4615),n=o(896),r=o(8711);function a(){r.Z.setState({open:!0,stage:"limit_reached",addOnUpgradeId:(0,i.ZP)(),tax:0})}function s(){r.Z.setState({open:!1})}function l(e){const t=r.Z.state;t.open&&r.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,n.$)(e)?e:void 0})}function c(){r.Z.setState({open:!0,stage:"cancel_plan",addOnUpgradeId:(0,i.ZP)(),tax:0})}},89859:(e,t,o)=>{o.d(t,{y:()=>l,A:()=>c});var i=o(5366),n=o(33929),r=o(54642),a=o(47307);const s=(0,i.defineMessages)({invalidCoupon:{id:"applyCoupon.error.invalidCoupon",defaultMessage:"Unable to apply the coupon to your account.",description:"Error message we show when a customer tries to apply an invalid coupon to their workspace."}});async function l(e,t){const{customerId:o,offerType:i}=t,n=await r.getCustomerOffer(e,{customerId:o,newPlan:"downgrade_flow"===i?t.newPlan:void 0,offerType:i});if("failed"===n.type)a.showError(n);else{const e=n.data;if(e.offerType===i)return e.coupon}}async function c(e,t){const{customerId:o,coupon:i,offerType:l}=t;if(!i)return void a.showErrorMessage(n.default.formatMessage(s.invalidCoupon));const c=await r.applyCustomerOffer(e,{customerId:o,newPlan:"downgrade_flow"===l?t.newPlan:void 0,offerType:l,coupon:i});"failed"===c.type&&a.showError(c)}},17153:(e,t,o)=>{o.d(t,{a:()=>r,c:()=>a});var i=o(4615),n=o(73428);function r(e){n.Z.setState({open:!0,updateModalId:(0,i.ZP)(),view:e})}function a(){n.Z.setState({open:!1})}},28040:(e,t,o)=>{o.d(t,{i:()=>d});var i=o(26263),n=o(21202),r=o(8323),a=o(79315),s=o(10161),l=o(3815),c=o(54642);async function d(e){const{environment:t,sudoModeStore:o,pageBlockId:d}=e,p=o.state.privatePageStore&&o.state.privatePageStore.id===d;if(t.device.isMobile||p||o.state.loading||o.state.error)return;if(!s.default.checkGate("enable_get_private_page_info_endpoint"))return;const{currentSpaceStore:u}=a.default.state,m=null==u?void 0:u.canAdmin();if(!(d&&m&&u&&(0,r.wP)()))return;o.setState({...o.state,loading:!0});const g=u.id,h=await c.getPrivatePageInfo(t,{id:d});if("failed"===h.type)return void o.setState({...o.state,loading:!1,error:h.error});const f=h.data,v=new i.Z;for(const i of f)switch(i.table){case"block":case"collection":v.setRecord({pointer:{spaceId:g,table:i.table,id:i.value.id},userId:t.currentUser.id},{role:"editor",value:i.value});break;case"team":v.setRecord({pointer:{spaceId:g,table:i.table,id:i.value.id},userId:t.currentUser.id},{role:"editor",value:i.value})}const y=new l.G(t,{table:n.iU,id:d},{inMemoryRecordCache:v});y.inMemoryRecordCache.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),o.setState({...o.state,privatePageStore:y,loading:!1,error:void 0})}},34147:(e,t,o)=>{o.d(t,{gG:()=>w,jL:()=>g,nz:()=>y,ls:()=>b,x2:()=>f,a:()=>h});var i=o(41432),n=o(15157),r=o(5366),a=o(33929),s=o(49085);class l extends s.Z{getInitialState(){return{}}setSelected(e,t){this.setState({...this.state,[e]:t})}getSelectedTab(e){return this.state[e]}}const c=new l;var d=o(94419),p=o(9953),u=o(24677),m=o(98104);function g(e){const t=e.getContentStores(),o=e.id,i=c.getSelectedTab(o);return i?t.findIndex((e=>e.id===i)):0}function h(e){const{store:t,index:o,currentUserId:i}=e,n=t.getContentStores()[o];n&&f({store:t,id:n.id,currentUserId:i})}function f(e){const{store:t,id:o,currentUserId:i}=e;c.setSelected(t.id,o),n.Z.set({userId:i,key:v(t.id),value:o})}function v(e){return`TabBlock-${e}`}function y(e){const{blockId:t,currentUserId:o}=e,i=n.Z.get({userId:o,key:v(t)});i&&c.setSelected(t,i)}function b(e){const{environment:t,store:o,transaction:n}=e,r=p.j4({environment:t,type:i.Ti.text,inMemoryRecordCache:o.inMemoryRecordCache,transaction:n});d.R3({parent:o.getContentStore(),append:r,transaction:n});const a=o.getContentStores()[0];u.eP({environment:t,store:a});const s=a.getBlockTitleStore();m.N_({store:s})}const S=(0,r.defineMessages)({newTab:{id:"tabBlockActions.addTab.title",defaultMessage:"New tab"}});function w(e){const{environment:t,store:o,transaction:n}=e,r=p.j4({environment:t,type:i.Ti.text,inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,properties:{title:[[a.default.formatMessage(S.newTab)]]}});return d.R3({parent:o.getContentStore(),append:r,transaction:n}),c.setSelected(o.id,r.id),r}},50125:(e,t,o)=>{o.d(t,{DI:()=>ze,e2:()=>Oe,FC:()=>Ue,zJ:()=>He,MO:()=>Ne,qn:()=>Ye,nA:()=>Ke,NE:()=>je,j0:()=>qe,Z5:()=>Ve,AU:()=>tt,qY:()=>ot,K4:()=>it});var i=o(96486),n=o.n(i),r=o(68497),a=o(80951),s=o(1800),l=o(97464),c=o.n(l),d=o(77094),p=o.n(d),u=o(67294),m=o(97762),g=o(66897),h=o(41432),f=o(15070),v=o(90559),y=o(99036),b=o(34299),S=o(47315),w=o(8848),k=o(98923),C=o(39068),_=o(32918),M=o(95538),T=o(7406),I=o(61075),P=o(6695),x=o(84682),B=o(38297),Z=o(64572),E=o(22808),R=o(61784),A=o(89837),D=o(59753),F=o(32056),L=o(63306),V=o(21202),N=o(77420),O=o(6287),U=o(33709),H=o(19889),z=o(85031),W=o(70203),j=o(44805),K=o(7928),Y=o(63143),G=o(4308);function X(e){if(void 0!==e&&0!==e.length)return e.map(((e,t)=>p()(u.Fragment,{},t,e)))}function q(e){return X((0,I.hJ)({...e,fromString:e=>e}))}const $=p()("div",{className:"checkbox checkbox-on"}),J=p()("div",{className:"checkbox checkbox-off"});function Q(e){if(window.__c={n:"renderPropertyIcon"},e)return p()("span",{className:"icon property-icon"},void 0,p()(C.ZP,{type:e.type,icon:e.icon,size:14,theme:(0,w.gh)({theme:"light"})}))}function ee(e){window.__c={n:"PropertyUserMention"};const{user:t,exportArgs:o}=e,i=(0,K.Nz)(o.intl,t)[0];let n=p()("span",{className:"icon text-icon user-icon"},void 0,p()("span",{className:"user-icon-inner"},void 0,i));if(t.profile_photo){const e=o.getExportedRenderAsset({fromBlockId:o.blockId,toFileURI:t.profile_photo});n=p()("img",{src:e,className:"icon user-icon"})}return p()("span",{className:"user"},void 0,n,(0,K.Nz)(o.intl,t))}function te(e){window.__c={n:"PropertyBotMention"};const{bot:t}=e,o=(0,f.Mh)(t)[0],i=p()("span",{className:"icon text-icon user-icon"},void 0,p()("span",{className:"user-icon-inner"},void 0,o));return p()("span",{className:"user"},void 0,i,(0,f.Mh)(t))}function oe(e,t){window.__c={n:"renderSelectValue"};const o=n().compact(["selected-value",t&&t.color&&`select-value-color-${t.color}`]).join(" ");return p()("span",{className:o},e,e)}function ie(e){if(window.__c={n:"renderLink"},e)return p()("a",{href:e,className:"url-value"},void 0,e)}function ne(e){window.__c={n:"renderDate"};const t=(0,R.ZV)(e);return p()("time",{},void 0,"@",t)}function re(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];if(D.kk.fromBlock(e).isType(h.Zj)){const t=e.format?e.format.block_color:void 0;if(t)return{className:[`block-color-${t}`,...o].join(" ")}}return{className:o.join(" ")}}function ae(e){const{block:t,exportArgs:o,renderers:i}=e;return q({textValue:D.kk.fromBlock(t).getProperties().title,exportArgs:o,renderers:i})}function se(e){const{block:t,exportArgs:o,renderers:i}=e;return q({textValue:D.kk.fromBlock(t).getProperties().caption,exportArgs:o,renderers:i})}function le(e){const{block:t,exportArgs:o,renderers:i}=e,r=t.content;if(!r)return;return X(n().compact(r.filter((e=>!(o.visitedBlockIds||new Set).has(e)&&t.id!==e)).map((e=>(0,I._2)({exportArgs:{...o,blockId:e,renderParentBlockId:t.id,visitedBlockIds:(o.visitedBlockIds||new Set).add(t.id)},renderers:i})))))}async function ce(e){const{block:t,exportArgs:o,renderers:i,ticker:r}=e,a=t.content;if(!a)return;const s=a.filter((e=>!(o.visitedBlockIds||new Set).has(e)&&t.id!==e)),l=await Promise.all(s.map((async e=>{const n=await(0,I._f)({exportArgs:{...o,blockId:e,renderParentBlockId:t.id,visitedBlockIds:(o.visitedBlockIds||new Set).add(t.id)},renderers:i,ticker:r});return await r.maybeYield(),n})));return Promise.resolve(X(n().compact(l)))}function de(e){var t;window.__c={n:"PageProperties"};const{block:o,exportArgs:i}=e,r=(0,B.ky)({getRecordValue:i.getRecordValue,block:o});if(!r||!r.format)return null;const a=(0,y.oC)(r);let s;const l=(0,P.iB)(r.format,a,void 0,P.j5.Page);if(null!=l&&null!==(t=l.collection_page_properties)&&void 0!==t&&t.length)s=l.collection_page_properties.map((e=>e.property));else{const e=Object.keys(a);s=n().sortBy(e,(e=>{const t=a[e];return t&&t.name||""}))}const c=n().compact(s.map((t=>{const i=a[t];if("title"===t)return null;if(!i)return null;const n=(0,I.Wy)({...e,property:t,schema:a,block:o});return p()("tr",{className:`property-row property-row-${i.type}`},t,p()("th",{},void 0,Q(i),i.name),p()("td",{},void 0,n))})));return p()("table",{className:"properties"},void 0,p()("tbody",{},void 0,c))}function pe(e){window.__c={n:"WholePage"};const{title:t,children:o,block:i,exportArgs:n}=e,r=D.kk.fromBlock(i),a=D.om.fromGetRecordValueFn(n.getRecordValue);let s;const l=r.getRenderIcon({getRecordModel:a}),c=i.format&&i.format.page_font;let d;const{cover:m,cover_position:g}=function(e,t){let o,i;if("page"===e.type&&e.format&&(o=e.format.page_cover,i=e.format.page_cover_position),"collection_view"===e.type||"collection_view_page"===e.type){const n=D.kk.fromBlock(e).getCollectionPointer();if(n){const e=t(n);e&&(o=e.cover,i=e.format&&e.format.collection_cover_position)}}return{cover:o,cover_position:i}}(i,n.getRecordValue);if(m){const e=m&&n.getExportedRenderAsset({fromBlockId:i.id,toFileURI:m}),t="number"==typeof g?`center ${100*(1-g||0)}%`:"center 50%";e&&(d=p()("img",{className:"page-cover-image",src:e,style:{objectPosition:t}}))}return l&&l.icon&&(s=p()("div",{className:`page-header-icon ${m&&"page-header-icon-with-cover"}`},void 0,p()(me,{block:i,exportArgs:n}))),p()("article",{id:i.id,className:`page ${c||"sans"}`},void 0,p()("header",{},void 0,d,s,p()("h1",{className:"page-title"},void 0,t),u.createElement(de,e)),p()("div",{className:"page-body"},void 0,o))}function ue(e){window.__c={n:"LinkToPage"};const{exportArgs:t,renderers:o,block:i}=e,{getRecordValue:n}=t,r=n({table:V.iU,id:t.blockId}),a=(0,I.cN)({children:"",annotation:W.$0(t.blockId,null==r?void 0:r.space_id),exportArgs:t,renderers:o});return u.createElement("figure",c()({id:t.blockId},re(i,"link-to-page")),a)}function me(e){const{block:t,exportArgs:o}=e,{getRecordValue:i,getExportedRenderAsset:n}=o,r=D.kk.fromBlock(t),a=D.om.fromGetRecordValueFn(i),s=r.getRenderIcon({getRecordModel:a});if(s&&s.icon){const e=s.icon;if((0,E.Z)(e))return p()("span",{className:"icon"},void 0,e);const t=n({fromBlockId:o.blockId,toFileURI:e});return p()("img",{className:"icon",src:t})}return null}function ge(e){window.__c={n:"renderSourceBlock"};const{block:t,exportArgs:o,renderers:i}=e,{source:n}=D.kk.fromBlock(t).getProperties(),r=W.Q(n);let a,s;(0,h.XD)(t.type)&&(a=ae({block:t,exportArgs:o,renderers:i}));const l=D.kk.fromBlock(t);l.isType(h.oe)&&(s=function(e){const{block:t,exportArgs:o,renderers:i}=e;return q({textValue:t.getProperties().caption,exportArgs:o,renderers:i})}({block:l,exportArgs:o,renderers:i}));const c=(0,I.cN)({annotation:W.ed(r),children:a||r,renderers:i,exportArgs:o});return p()("figure",{id:t.id},void 0,u.createElement("div",re(t,"source"),c),s&&p()("figcaption",{},void 0,s))}async function he(e){return await e.ticker.maybeYield(),ge(e)}function fe(e){var t;const{block:o}=e,i=null===(t=o.format)||void 0===t?void 0:t.original_url;if(i)return p()("figure",{id:o.id},void 0,u.createElement("div",re(o,"source"),i))}function ve(e){window.__c={n:"renderImageBlock"};const{block:t,exportArgs:o,linkToImage:i}=e,n=se(e),r=W.Q(D.kk.fromBlock(t).getProperties().source),a=o.getExportedRenderAsset({fromBlockId:t.id,toFileURI:r}),s={},l={};return t.format&&(t.format.block_full_width?s.width="100%":t.format.block_width&&(s.width=t.format.block_width),t.format.block_alignment&&(l.textAlign=t.format.block_alignment)),u.createElement("figure",c()({id:e.block.id},re(t,"image"),{style:l}),i?p()("a",{href:a},void 0,p()("img",{style:s,src:a})):p()("img",{style:s,src:a}),n&&p()("figcaption",{},void 0,n))}function ye(e){var t;window.__c={n:"renderCollectionView"};const{block:o,exportArgs:i,renderers:n}=e;if(Boolean(null===(t=o.content)||void 0===t?void 0:t.length))return u.createElement(pe,c()({title:ae(e)},e),le(e));const r=(0,I.LK)(e);if(!r)return;const{schema:a,sortedBlocks:s,columnIds:l,columnIdToName:d,collectionTitle:m}=r,g=s.map((e=>{const t=l.map((t=>{const o=(0,I.Wy)({exportArgs:{...i,blockId:e.id},renderers:n,schema:a,property:t,block:e});return p()("td",{className:`cell-${t}`},t,o)}));return p()("tr",{id:e.id},e.id,t)})),h=u.createElement(u.Fragment,null,p()("table",{className:"collection-content"},void 0,p()("thead",{},void 0,p()("tr",{},void 0,l.map(((e,t)=>{const o=a[e];return p()("th",{},t,Q(o),d[e])})))),p()("tbody",{},void 0,g)));return(0,I.Qx)(i)?u.createElement(pe,c()({title:m},e),h):u.createElement("div",c()({id:o.id},re(o,"collection-content")),p()("h4",{className:"collection-title"},void 0,m),h)}function be(e){return e.list_format?e.list_format:e.depth%3==0?"disc":e.depth%3==1?"circle":"square"}const Se={annotationRenderers:{[W.GK.Bold]:e=>{let{children:t}=e;return p()("strong",{},void 0,t)},[W.GK.Underline]:e=>{let{children:t}=e;return p()("span",{style:{borderBottom:"0.05em solid"}},void 0,t)},[W.GK.Italic]:e=>{let{children:t}=e;return p()("em",{},void 0,t)},[W.GK.Strike]:e=>{let{children:t}=e;return p()("del",{},void 0,t)},[W.GK.Code]:e=>{let{children:t}=e;return p()("code",{},void 0,t)},[W.GK.Highlight]:e=>{let{children:t,annotation:o}=e;const i=W.zI(o);return p()("mark",{className:`highlight-${i}`},void 0,t)},[W.GK.Link]:e=>{let{annotation:t,children:o,exportArgs:i}=e;const{getExportedPathToFile:n,getExportedPathToPage:r,blockId:a,baseUrl:s,publicDomainName:l}=i,c=W.zW(t),d=(0,Z.A5)({url:c,baseUrl:s,publicDomainName:l}),u=d?r({toPageId:d}):n({fromBlockId:a,toFileURI:c});return p()("a",{href:u},void 0,o)},[W.GK.Group]:e=>{let{annotation:t,exportArgs:o}=e;const i=(0,I.kF)({annotation:t,exportArgs:o});if(i)return function(e){return window.__c={n:"renderGroupMention"},p()("span",{className:"group"},void 0,e)}(i)},[W.GK.ExternalObjectInstance]:e=>{var t;let{annotation:o,exportArgs:i}=e;const n=W.Ik(o),r=i.getRecordValue({table:V.iU,id:n,spaceId:i.root.spaceId}),a=null==r||null===(t=r.format)||void 0===t?void 0:t.original_url;if(a)return p()("a",{href:a},void 0,a)},[W.GK.User]:e=>{let{annotation:t,exportArgs:o}=e;const i=W.zE(t),n=o.getRecordValue({table:H.KJ,id:i});if(n)return r=o.intl,a=n,window.__c={n:"renderUserMention"},p()("span",{className:"user"},void 0,"@",(0,K.Nz)(r,a));var r,a},[W.GK.Bot]:e=>{let{annotation:t,exportArgs:o}=e;const i=W._R(t),n=o.getRecordValue({table:N.cZ,id:i});if(n)return r=n,window.__c={n:"renderBotMention"},p()("span",{className:"bot"},void 0,"@",(0,f.Mh)(r));var r},[W.GK.Page]:e=>{const{annotation:t,exportArgs:o}=e,{getRecordValue:i,getExportedPathToPage:n}=o,r=W.TO(t),s=i({table:V.iU,id:r});if(s){if("page"===s.type){const e=(0,I.Ho)({intl:o.intl,blockId:r,getRecordValue:o.getRecordValue,userTimeZone:o.userTimeZone}),t=n({toPageId:r}),i=p()(me,{block:s,exportArgs:o});return p()("a",{href:t},void 0,i,e||o.intl.formatMessage({id:"export.linkToPage.untitledPagePlaceholder",defaultMessage:"Untitled"}))}if("external_object_instance_page"===s.type){var l;const e=null===(l=s.format)||void 0===l?void 0:l.uri,t=W.Q(a.wS(s,"title"));if(e)return p()("a",{href:e},void 0,t||e)}}},[W.GK.Comment]:e=>{let{annotation:t,exportArgs:o}=e;const{getRecordValue:i,baseUrl:n}=o,r=W.$W(t);if(!r)return;const a=i(r);if(!a)return;const l=a.parent_id,c={table:U.qF,id:l,spaceId:a.space_id},d=(0,L.el)((0,L.DW)(c,i));if(!d)return;const u=i(c),m=(0,s.Z)({pageId:d.id,scrollToBlockId:null==u?void 0:u.parent_id,pageValue:d,baseUrl:n,discussionId:l});return p()("a",{href:m},void 0,m)},[W.GK.Date]:e=>{let{annotation:t,exportArgs:o}=e;const{date_format:i,time_format:n,...r}=W.Ot(t);return ne({allowRelativeDates:!1,value:r,date_format:i,time_format:n,userTimeZone:o.userTimeZone,intl:o.intl})},[W.GK.Equation]:function(e){let{annotation:t,exportArgs:o}=e;window.__c={n:"renderInlineEquation"};const i=W.xe(t),{katex:n}=o;return p()(u.Fragment,{},void 0,p()(k.k7,{}),j.CY({katex:n,equation:i,index:0,intl:o.intl,isTemporary:!1,theme:(0,w.gh)({theme:"light"})}))},[W.GK.Discussion]:I.Hf,[W.GK.Inserted]:I.Hf,[W.GK.Deleted]:I.Hf,[W.GK.TemporaryComment]:I.Hf,[W.GK.TemporaryEquation]:I.Hf,[W.GK.TemporaryPage]:I.Hf,[W.GK.TemporaryInput]:I.Hf,[W.GK.TemporarySelection]:I.Hf,[W.GK.TemplateVariable]:I.Hf,[W.GK.FormulaPageProperty]:I.Hf,[W.GK.FormulaUserProperty]:I.Hf,[W.GK.FormulaContextValue]:I.Hf,[W.GK.FormulaError]:I.Hf},propertyRenderers:{title:e=>{const{exportArgs:t,renderers:o}=e,{getRecordValue:i}=t;if(t.blockId!==t.navigableBlockId){const e=i({table:V.iU,id:t.blockId});return(0,I.cN)({renderers:o,exportArgs:t,annotation:W.$0(t.blockId,null==e?void 0:e.space_id),children:""})}return q(e)},text:q,select:e=>{const{textValue:t,propertySchema:o}=e,i=o.options||[],n=a.Sj(t,i),r=i.find((e=>e.value===n));return n&&oe(n,r)},multi_select:e=>{const{textValue:t,propertySchema:o}=e,i=o.options||[],n=a.uP(t,i);return n.sort(),n.map((e=>{const t=i.find((t=>t.value===e));return oe(e,t)}))},status:e=>{const{textValue:t,propertySchema:o}=e,i=o,r=i.options||[],s=a.Sj(t,r)??i.defaultOption,l=r.find((e=>e.value===s));return s&&function(e,t){window.__c={n:"renderStatusValue"};const o=n().compact(["status-value",t&&t.color&&`select-value-color-${t.color}`]).join(" "),i=n().compact(["status-dot",t&&t.color&&`status-dot-color-${t.color}`]).join(" ");return p()("span",{className:o},e,p()("div",{className:i}),e)}(s,l)},relation:e=>{const{textValue:t,propertySchema:o,exportArgs:i}=e;if("relation"!==o.type)return;const n=a.j$({relationValue:a.rq(t),getRecordValue:i.getRecordValue,propertySchema:o}),r=a.ow(n);return function(e){const{textValue:t}=e;if(t){const o=[];for(let i=0;i<t.length;i++){const n=t[i];W.QJ(n)||(o.push(q({...e,textValue:[n]})),i<t.length-1&&o.push(", "))}return X(o)}}({...e,textValue:r})},rollup:e=>{const t=e.exportArgs.getRecordValue;return b.kJ({...e,userTimeZone:e.exportArgs.userTimeZone,getRecordValue:t,depth:0,intl:e.exportArgs.intl})},url:e=>{let{textValue:t}=e;return ie(a.zB(t))},email:e=>{let{textValue:t}=e;return ie(a.zB(t))},phone_number:e=>{let{textValue:t}=e;return ie(a.zB(t))},checkbox:e=>{let{textValue:t}=e;return a.Ml(t)?$:J},person:e=>{let{textValue:t,exportArgs:o,propertySchema:i,block:r}=e;const s=a.DW({textValue:t,propertySchema:i,blockCreatorPointer:a.I1(r.created_by_id,r.created_by_table)});return X(n().compact(s.map((e=>{let{table:t,id:i}=e;if(t===H.KJ){const e=o.getRecordValue({table:t,id:i});if(e)return p()(ee,{user:e,exportArgs:o})}else{const e=o.getRecordValue({table:t,id:i});if(e)return p()(te,{bot:e,exportArgs:o})}}))))},number:e=>{let{textValue:t,propertySchema:o,exportArgs:i}=e;const n=a.VY(t);if(void 0!==n)return"number"===o.type?F.uf(n,o.number_format,i.intl):n.toString()},date:e=>{let{textValue:t,propertySchema:o,...i}=e;const n=i.exportArgs.userTimeZone,r=a.Gl(t),{date_format:s,time_format:l}=o;if(r)return ne({allowRelativeDates:!1,value:r,date_format:s,time_format:l,userTimeZone:n,intl:i.exportArgs.intl})},file:e=>{let{textValue:t,exportArgs:o,renderers:i}=e;return X(a.g(t).map((e=>{let{url:t,name:n}=e;let r=n;if(M.SR({url:t})){const e=o.getExportedRenderAsset({fromBlockId:o.blockId,toFileURI:t});r=p()("img",{style:{width:20,maxHeight:24},src:e,alt:n})}const a=i.annotationRenderers.a({annotation:W.ed(t),exportArgs:o,renderers:i,children:r});return p()("span",{style:{marginRight:6}},void 0,a)})))},formula:e=>{const{property:t,schema:o,block:i,exportArgs:n}=e,{userTimeZone:r,getRecordValue:a}=n,s=(0,x.AH)({intl:n.intl,schema:o,property:t,block:i,getRecordValue:a,userTimeZone:r,depth:0,resultCache:{}});return"boolean"==typeof s?s?$:J:(0,Y.hj)(s)?s.toString():(0,_.U3)(s)?ne({allowRelativeDates:!1,value:s,userTimeZone:r,intl:n.intl}):s},created_time:e=>{const{block:t,exportArgs:o}=e,{userTimeZone:i}=o;if(t.created_time)return ne({allowRelativeDates:!1,value:(0,A.CQ)(t.created_time,i),userTimeZone:i,intl:o.intl})},last_edited_time:e=>{const{block:t,exportArgs:o}=e,{userTimeZone:i}=o;if(t.last_edited_time)return ne({allowRelativeDates:!1,value:(0,A.CQ)(t.last_edited_time,i),userTimeZone:i,intl:o.intl})},created_by:e=>{const{block:t,exportArgs:o}=e,{getRecordValue:i}=o;if(t.created_by_table&&t.created_by_id){const e=(0,g.Hl)({getRecordValue:i,pointer:{table:t.created_by_table,id:t.created_by_id}});if(e.value)return(0,g.uC)(e)?p()(ee,{user:e.value,exportArgs:o}):p()(te,{bot:e.value,exportArgs:o})}},last_edited_by:e=>{const{block:t,exportArgs:o}=e,{getRecordValue:i}=o;if(t.last_edited_by_table&&t.last_edited_by_id){const e=(0,g.Hl)({getRecordValue:i,pointer:{table:t.last_edited_by_table,id:t.last_edited_by_id}});if(e.value)return(0,g.uC)(e)?p()(ee,{user:e.value,exportArgs:o}):p()(te,{bot:e.value,exportArgs:o})}},button:()=>"",auto_increment_id:e=>{let{textValue:t,block:o,exportArgs:i}=e;const{getRecordValue:n}=i,r=a.ah(t);if(void 0!==r){const e=D.kk.fromBlock(o),t=e.getParentTable();if(t!==O.v)return;const i=n((0,S.We)({spaceId:e.getSpaceId(),parentTable:t,parentId:e.getParentId()}));return(0,v.wf)(null==i?void 0:i.record_key,r)}},location:()=>"",verification:e=>{let{textValue:t,exportArgs:o}=e;const i=a._w(t);if(!i)return"";const n=G.WN(i);return o.intl.formatMessage(G.A3(n.type))}},blockRenderers:{text:e=>{const t=e.block.id,o=ae(e),i=le(e);return u.createElement("p",c()({id:t},re(e.block)),o||i?o:"\n",i&&p()("div",{className:"indented"},void 0,i))},header:e=>{const t=e.block.id,o=ae(e);if((0,h.eJ)(e.block.type,e.block.format)){const i=le(e);return u.createElement(u.Fragment,null,u.createElement("h1",c()({id:t},re(e.block)),p()("details",{open:!0},void 0,p()("summary",{},void 0,o))),i&&p()("div",{className:"indented"},void 0,i))}return u.createElement("h1",c()({id:t},re(e.block)),o)},sub_header:e=>{const t=e.block.id,o=ae(e);if((0,h.eJ)(e.block.type,e.block.format)){const i=le(e);return u.createElement(u.Fragment,null,u.createElement("h2",c()({id:t},re(e.block)),p()("details",{open:!0},void 0,p()("summary",{},void 0,o))),i&&p()("div",{className:"indented"},void 0,i))}return u.createElement("h2",c()({id:t},re(e.block)),o)},sub_sub_header:e=>{const t=e.block.id,o=ae(e);if((0,h.eJ)(e.block.type,e.block.format)){const i=le(e);return u.createElement(u.Fragment,null,u.createElement("h3",c()({id:t},re(e.block)),p()("details",{open:!0},void 0,p()("summary",{},void 0,o))),i&&p()("div",{className:"indented"},void 0,i))}return u.createElement("h3",c()({id:t},re(e.block)),o)},quote:e=>{const t=e.block.id,o=ae(e),i=le(e);return u.createElement("blockquote",c()({id:t},re(e.block)),o,i)},bulleted_list:e=>{const t=e.block.id,o=ae(e),i=le(e),n=(0,I.ZW)(e);return u.createElement("ul",c()({id:t},re(e.block,"bulleted-list")),p()("li",{style:{listStyleType:be(n)}},void 0,o,i))},toggle:e=>{const t=e.block.id,o=ae(e),i=le(e);return u.createElement("ul",c()({id:t},re(e.block,"toggle")),p()("li",{},void 0,p()("details",{open:!0},void 0,p()("summary",{},void 0,o),i)))},to_do:e=>{const{block:t}=e,o=a.Ml(D.kk.fromBlock(t).getProperties().checked),i=o?$:J,n=o?"checked":"unchecked";return u.createElement("ul",c()({id:t.id},re(t,"to-do-list")),p()("li",{},void 0,i," ",p()("span",{className:`to-do-children-${n}`},void 0,ae(e)),p()("div",{className:"indented"},void 0,le(e))))},numbered_list:e=>{const t=(0,I.K9)(e);return u.createElement("ol",c()({type:t.format,id:e.block.id},re(e.block,"numbered-list"),{start:t.index+1}),p()("li",{},void 0,ae(e),le(e)))},code:e=>{let{block:t}=e;const o=D.kk.fromBlock(t).getProperties(),i=W.Q(o.title),n=t.format||{},{code_wrap:r}=n,a=["code"];return r&&a.push("code-wrap"),p()(u.Fragment,{},void 0,u.createElement("pre",c()({id:t.id},re(t,...a)),p()("code",{},void 0,i)))},page:e=>{const{exportArgs:t}=e,o=ae(e);return(0,I.Qx)(t)?u.createElement(pe,c()({title:o},e),le(e)):u.createElement(ue,e)},image:e=>ve({...e,linkToImage:!0}),video:ge,embed:ge,external_object_instance:fe,bookmark:e=>{const{block:t,exportArgs:o}=e,{link:i,description:n}=D.kk.fromBlock(t).getProperties(),r=t.format||{},{bookmark_icon:s,bookmark_cover:l}=r,d=a.zB(i),m=ae(e),g=se(e),h=W.Jc(n),f=l&&o.getExportedRenderAsset({fromBlockId:t.id,toFileURI:l}),v=s&&o.getExportedRenderAsset({fromBlockId:t.id,toFileURI:s});return p()("figure",{id:t.id},void 0,u.createElement("a",c()({href:d},re(t,"bookmark","source")),p()("div",{className:"bookmark-info"},void 0,p()("div",{className:"bookmark-text"},void 0,p()("div",{className:"bookmark-title"},void 0,m),h&&p()("div",{className:"bookmark-description"},void 0,h)),p()("div",{className:"bookmark-href"},void 0,v&&p()("img",{src:v,className:"icon bookmark-icon"}),d)),f&&p()("img",{src:f,className:"bookmark-image"})),g&&p()("figcaption",{},void 0,g))},drive:e=>{const{block:t}=e;if(t.format&&t.format.drive_properties){const{url:e,title:o,icon:i}=t.format.drive_properties;return p()("figure",{id:t.id},void 0,p()("div",{className:"bookmark source"},void 0,i&&p()("img",{style:{width:"1em",height:"1em",marginRight:"0.5em",verticalAlign:"text-bottom"},src:i}),p()("a",{href:e},void 0,o),p()("br",{}),p()("a",{className:"bookmark-href",href:e},void 0,e)))}return ge(e)},file:ge,tweet:ge,maps:ge,gist:ge,framer:ge,whimsical:ge,miro:ge,abstract:ge,sketch:ge,excalidraw:ge,replit:ge,invision:ge,figma:ge,loom:ge,pdf:ge,typeform:ge,codepen:ge,audio:ge,mixpanel:ge,hex:ge,deepnote:ge,divider:e=>{let{block:t}=e;return p()("hr",{id:t.id})},equation:e=>{let{block:t,exportArgs:o}=e;const{title:i}=D.kk.fromBlock(t).getProperties();if(!i)return;const{katex:n}=o,r=W.Q(i);let a;try{const e=n?n.renderToString(r,{displayMode:!0}):r;a=u.createElement(u.Fragment,null,p()(k.k7,{}),p()("div",{className:"equation-container",dangerouslySetInnerHTML:{__html:e}},"value"))}catch(s){a=p()("div",{className:"equation-error"},"error",(0,T.tg)(s).message)}return u.createElement("figure",c()({id:t.id},re(t,"equation")),a)},collection_view:ye,collection_view_page:e=>{const{exportArgs:t}=e;return(0,I.Qx)(t)?ye(e):u.createElement(ue,e)},column_list:e=>{const t=le(e);return u.createElement("div",c()({id:e.block.id},re(e.block,"column-list")),t)},column:e=>{const t=100*(e.block.format&&e.block.format.column_ratio||1)+"%",o=le(e);return u.createElement("div",c()({id:e.block.id,style:{width:t}},re(e.block,"column")),o)},factory:()=>{},copy_indicator:()=>{},breadcrumb:()=>{},link_to_collection:()=>{},link_to_page:()=>{},table_of_contents:e=>{const{exportArgs:t,block:o}=e,{getRecordValue:i}=t,n=(0,I.Gb)(t);if(!n)return;const r=z.Q(n.id,D.om.fromGetRecordValueFn(i));return u.createElement("nav",c()({id:o.id},re(o,"table_of_contents")),X(r.map(((n,a)=>{const s=z.y({headerBlockId:n,headerBlockIds:r,index:a,getRecordModel:D.om.fromGetRecordValueFn(i)}),l=i({table:V.iU,id:n});if(l){const i=ae({...e,block:l,exportArgs:{...t,blockId:n,renderParentBlockId:o.id}});return p()("div",{className:`table_of_contents-item table_of_contents-indent-${s}`},void 0,p()("a",{className:"table_of_contents-link",href:`#${n}`},void 0,i))}}))))},callout:e=>{const{block:t,exportArgs:o}=e,i=ae(e),n=le(e);if(i)return u.createElement("figure",c()({},re(t,"callout"),{style:{whiteSpace:"pre-wrap",display:"flex"},id:t.id}),p()("div",{style:{fontSize:"1.5em"}},void 0,p()(me,{block:t,exportArgs:o})),p()("div",{style:{width:"100%"}},void 0,i,n))},alias:e=>{const{block:t,exportArgs:o}=e;if(t.format&&t.format.alias_pointer)return(0,I._2)({exportArgs:{...o,blockId:t.format.alias_pointer.id,renderParentBlockId:t.id,visitedBlockIds:(o.visitedBlockIds||new Set).add(t.id)},renderers:Se})},transclusion_container:e=>{const t=le(e);return p()("div",{},void 0,t)},transclusion_reference:e=>{const{block:t,exportArgs:o}=e;if(t.format&&t.format.transclusion_reference_pointer)return(0,I._2)({exportArgs:{...o,blockId:t.format.transclusion_reference_pointer.id,renderParentBlockId:t.id,visitedBlockIds:(o.visitedBlockIds||new Set).add(t.id)},renderers:Se})},table:e=>{var t,o,i,n;const{block:r,exportArgs:a}=e,s=null===(t=r.format)||void 0===t?void 0:t.table_block_column_order,l=null===(o=r.format)||void 0===o?void 0:o.table_block_column_header,d=r.content,m=(null===(i=a.table)||void 0===i||null===(n=i[r.id])||void 0===n?void 0:n.renderRows)??d;if(s&&m&&d){const e=l&&m[0]===d[0];return u.createElement("table",c()({id:r.id},re(r,"simple-table")),e&&p()("thead",{className:"simple-table-header"},void 0,(0,I._2)({exportArgs:{...a,blockId:m[0],renderParentBlockId:r.id,visitedBlockIds:(a.visitedBlockIds||new Set).add(r.id)},renderers:Se})),p()("tbody",{},void 0,(e?m.slice(1):m).map((e=>(0,I._2)({exportArgs:{...a,blockId:e,renderParentBlockId:r.id,visitedBlockIds:(a.visitedBlockIds||new Set).add(r.id)},renderers:Se})))))}},table_row:e=>{var t,o,i,n;const{block:r,exportArgs:a}=e,{getRecordValue:s,renderParentBlockId:l}=a;if(!l)return;const c=s({table:V.iU,id:l}),d=(null==c||null===(t=c.format)||void 0===t?void 0:t.table_block_column_header)&&(null==c?void 0:c.content)&&c.content[0]===r.id,u=null==c||null===(o=c.format)||void 0===o?void 0:o.table_block_column_format,m=(e,t,o)=>{var i;return u&&u[t]&&u[t].color?`block-color-${u[t].color}`:null!==(i=e.format)&&void 0!==i&&i.block_color?`block-color-${e.format.block_color}`:o?"simple-table-header-color":""},g=null==c||null===(i=c.format)||void 0===i?void 0:i.table_block_column_order,h=c?(null===(n=a.table)||void 0===n?void 0:n[c.id].renderColumns)??g:g;return g&&h?p()("tr",{id:r.id},r.id,h.map((e=>{var t;const o=q({textValue:r.properties&&e in r.properties?r.properties[e]:void 0,exportArgs:a,renderers:Se}),i=(null==c||null===(t=c.format)||void 0===t?void 0:t.table_block_row_header)&&e===g[0],n=(e=>{if(u&&u[e]&&u[e].width)return u[e].width})(e);return d||i?p()("th",{id:e,className:`${m(r,e,!0)} simple-table-header`,style:n?{width:`${n}px`}:{}},e,o):p()("td",{id:e,className:m(r,e,!1),style:n?{width:`${n}px`}:{}},e,o)}))):void 0},tab:e=>{var t;const{block:o,exportArgs:i}=e,{getRecordValue:n}=i;return u.createElement("div",c()({id:e.block.id},re(e.block,"tab")),null===(t=o.content)||void 0===t?void 0:t.map((t=>{const o=n({table:V.iU,id:t});if(o)return u.createElement(u.Fragment,null,p()("div",{style:{borderBottom:"0.05em solid",borderBottomColor:(0,w.gh)({theme:"light"}).lightDividerColor}},void 0,ae({...e,block:o,exportArgs:{...i,blockId:t,renderParentBlockId:e.block.id}})),le({...e,block:o}))})))},external_object_instance_page:()=>{},button:()=>{},ai_block:e=>{const t=le(e);return p()("div",{},void 0,t)},drawing:()=>{}},asyncBlockRenderers:{text:async e=>{const t=e.block.id,o=ae(e),i=await ce(e);return u.createElement("p",c()({id:t},re(e.block)),o||i?o:"\n",i&&p()("div",{className:"indented"},void 0,i))},header:async e=>{const t=e.block.id,o=ae(e);if((0,h.eJ)(e.block.type,e.block.format)){const i=await ce(e);return u.createElement(u.Fragment,null,u.createElement("h1",c()({id:t},re(e.block)),p()("details",{open:!0},void 0,p()("summary",{},void 0,o))),i&&p()("div",{className:"indented"},void 0,i))}return u.createElement("h1",c()({id:t},re(e.block)),o)},sub_header:async e=>{const t=e.block.id,o=ae(e);if((0,h.eJ)(e.block.type,e.block.format)){const i=await ce(e);return u.createElement(u.Fragment,null,u.createElement("h2",c()({id:t},re(e.block)),p()("details",{open:!0},void 0,p()("summary",{},void 0,o))),i&&p()("div",{className:"indented"},void 0,i))}return u.createElement("h2",c()({id:t},re(e.block)),o)},sub_sub_header:async e=>{const t=e.block.id,o=ae(e);if((0,h.eJ)(e.block.type,e.block.format)){const i=await ce(e);return u.createElement(u.Fragment,null,u.createElement("h3",c()({id:t},re(e.block)),p()("details",{open:!0},void 0,p()("summary",{},void 0,o))),i&&p()("div",{className:"indented"},void 0,i))}return u.createElement("h3",c()({id:t},re(e.block)),o)},quote:async e=>{const t=e.block.id,o=ae(e),i=await ce(e);return u.createElement("blockquote",c()({id:t},re(e.block)),o,i)},bulleted_list:async e=>{const t=e.block.id,o=ae(e),i=await ce(e),n=(0,I.ZW)(e);return u.createElement("ul",c()({id:t},re(e.block,"bulleted-list")),p()("li",{style:{listStyleType:be(n)}},void 0,o,i))},toggle:async e=>{const t=e.block.id,o=ae(e),i=await ce(e);return u.createElement("ul",c()({id:t},re(e.block,"toggle")),p()("li",{},void 0,p()("details",{open:!0},void 0,p()("summary",{},void 0,o),i)))},to_do:async e=>{const{block:t}=e,o=a.Ml(D.kk.fromBlock(t).getProperties().checked),i=o?$:J,n=o?"checked":"unchecked";return u.createElement("ul",c()({id:t.id},re(t,"to-do-list")),p()("li",{},void 0,i," ",p()("span",{className:`to-do-children-${n}`},void 0,ae(e)),p()("div",{className:"indented"},void 0,await ce(e))))},numbered_list:async e=>{const t=(0,I.K9)(e);return u.createElement("ol",c()({type:t.format,id:e.block.id},re(e.block,"numbered-list"),{start:t.index+1}),p()("li",{},void 0,ae(e),await ce(e)))},code:async e=>{let{block:t,ticker:o}=e;const i=D.kk.fromBlock(t).getProperties(),n=W.Q(i.title),r=t.format||{},{code_wrap:a}=r,s=["code"];return a&&s.push("code-wrap"),await o.maybeYield(),p()(u.Fragment,{},void 0,u.createElement("pre",c()({id:t.id},re(t,...s)),p()("code",{},void 0,n)))},page:async e=>{const{exportArgs:t}=e,o=ae(e);return(0,I.Qx)(t)?u.createElement(pe,c()({title:o},e),await ce(e)):u.createElement(ue,e)},image:async e=>(await e.ticker.maybeYield(),ve({...e,linkToImage:!0})),video:he,embed:he,external_object_instance:async e=>(await e.ticker.maybeYield(),fe(e)),bookmark:async e=>{const{block:t,exportArgs:o}=e,{link:i,description:n}=D.kk.fromBlock(t).getProperties(),r=t.format||{},{bookmark_icon:s,bookmark_cover:l}=r,d=a.zB(i),m=ae(e),g=se(e),h=W.Jc(n),f=l&&o.getExportedRenderAsset({fromBlockId:t.id,toFileURI:l}),v=s&&o.getExportedRenderAsset({fromBlockId:t.id,toFileURI:s});return await e.ticker.maybeYield(),p()("figure",{id:t.id},void 0,u.createElement("a",c()({href:d},re(t,"bookmark","source")),p()("div",{className:"bookmark-info"},void 0,p()("div",{className:"bookmark-text"},void 0,p()("div",{className:"bookmark-title"},void 0,m),h&&p()("div",{className:"bookmark-description"},void 0,h)),p()("div",{className:"bookmark-href"},void 0,v&&p()("img",{src:v,className:"icon bookmark-icon"}),d)),f&&p()("img",{src:f,className:"bookmark-image"})),g&&p()("figcaption",{},void 0,g))},drive:async e=>{const{block:t}=e;if(t.format&&t.format.drive_properties){const{url:e,title:o,icon:i}=t.format.drive_properties;return p()("figure",{id:t.id},void 0,p()("div",{className:"bookmark source"},void 0,i&&p()("img",{style:{width:"1em",height:"1em",marginRight:"0.5em",verticalAlign:"text-bottom"},src:i}),p()("a",{href:e},void 0,o),p()("br",{}),p()("a",{className:"bookmark-href",href:e},void 0,e)))}return he(e)},file:he,tweet:he,maps:he,gist:he,framer:he,whimsical:he,miro:he,abstract:he,sketch:he,excalidraw:he,replit:he,invision:he,figma:he,loom:he,pdf:he,typeform:he,codepen:he,audio:he,mixpanel:he,hex:he,deepnote:he,divider:async e=>{let{block:t,ticker:o}=e;return await o.maybeYield(),p()("hr",{id:t.id})},equation:async e=>{let{block:t,exportArgs:o,ticker:i}=e;const{title:n}=D.kk.fromBlock(t).getProperties();if(!n)return;const{katex:r}=o,a=W.Q(n);let s;try{const e=r?r.renderToString(a,{displayMode:!0}):a;s=u.createElement(u.Fragment,null,p()(k.k7,{}),p()("div",{className:"equation-container",dangerouslySetInnerHTML:{__html:e}},"value"))}catch(l){s=p()("div",{className:"equation-error"},"error",(0,T.tg)(l).message)}return await i.maybeYield(),u.createElement("figure",c()({id:t.id},re(t,"equation")),s)},collection_view:async function(e){return await e.ticker.maybeYield(),ye(e)},collection_view_page:async e=>{const{exportArgs:t}=e;return await e.ticker.maybeYield(),(0,I.Qx)(t)?ye(e):u.createElement(ue,e)},column_list:async e=>{const t=await ce(e);return u.createElement("div",c()({id:e.block.id},re(e.block,"column-list")),t)},column:async e=>{const t=100*(e.block.format&&e.block.format.column_ratio||1)+"%",o=await ce(e);return u.createElement("div",c()({id:e.block.id,style:{width:t}},re(e.block,"column")),o)},factory:()=>Promise.resolve(void 0),copy_indicator:()=>Promise.resolve(void 0),breadcrumb:()=>Promise.resolve(void 0),link_to_collection:()=>Promise.resolve(void 0),link_to_page:()=>Promise.resolve(void 0),table_of_contents:async e=>{const{exportArgs:t,block:o}=e,{getRecordValue:i}=t,n=(0,I.Gb)(t);if(!n)return;const r=z.Q(n.id,D.om.fromGetRecordValueFn(i));return await e.ticker.maybeYield(),u.createElement("nav",c()({id:o.id},re(o,"table_of_contents")),X(r.map(((n,a)=>{const s=z.y({headerBlockId:n,headerBlockIds:r,index:a,getRecordModel:D.om.fromGetRecordValueFn(i)}),l=i({table:V.iU,id:n});if(l){const i=ae({...e,block:l,exportArgs:{...t,blockId:n,renderParentBlockId:o.id}});return p()("div",{className:`table_of_contents-item table_of_contents-indent-${s}`},void 0,p()("a",{className:"table_of_contents-link",href:`#${n}`},void 0,i))}}))))},callout:async e=>{const{block:t,exportArgs:o}=e,i=ae(e),n=await ce(e);if(i)return u.createElement("figure",c()({},re(t,"callout"),{style:{whiteSpace:"pre-wrap",display:"flex"},id:t.id}),p()("div",{style:{fontSize:"1.5em"}},void 0,p()(me,{block:t,exportArgs:o})),p()("div",{style:{width:"100%"}},void 0,i,n))},alias:async e=>{const{block:t,exportArgs:o,ticker:i}=e;if(t.format&&t.format.alias_pointer)return(0,I._f)({exportArgs:{...o,blockId:t.format.alias_pointer.id,renderParentBlockId:t.id,visitedBlockIds:(o.visitedBlockIds||new Set).add(t.id)},renderers:Se,ticker:i})},transclusion_container:async e=>{const t=await ce(e);return p()("div",{},void 0,t)},transclusion_reference:async e=>{const{block:t,exportArgs:o,ticker:i}=e;if(t.format&&t.format.transclusion_reference_pointer)return(0,I._f)({exportArgs:{...o,blockId:t.format.transclusion_reference_pointer.id,renderParentBlockId:t.id,visitedBlockIds:(o.visitedBlockIds||new Set).add(t.id)},renderers:Se,ticker:i})},table:async e=>{var t,o,i,n;const{block:r,exportArgs:a,ticker:s}=e,l=null===(t=r.format)||void 0===t?void 0:t.table_block_column_order,d=null===(o=r.format)||void 0===o?void 0:o.table_block_column_header,m=r.content,g=(null===(i=a.table)||void 0===i||null===(n=i[r.id])||void 0===n?void 0:n.renderRows)??m;if(l&&g&&m){const e=d&&g[0]===m[0];return u.createElement("table",c()({id:r.id},re(r,"simple-table")),e&&p()("thead",{className:"simple-table-header"},void 0,(0,I._2)({exportArgs:{...a,blockId:g[0],renderParentBlockId:r.id,visitedBlockIds:(a.visitedBlockIds||new Set).add(r.id)},renderers:Se})),p()("tbody",{},void 0,await Promise.all((e?g.slice(1):g).map((async e=>(0,I._f)({exportArgs:{...a,blockId:e,renderParentBlockId:r.id,visitedBlockIds:(a.visitedBlockIds||new Set).add(r.id)},renderers:Se,ticker:s}))))))}},table_row:async e=>{var t,o,i,n;const{block:r,exportArgs:a}=e,{getRecordValue:s,renderParentBlockId:l}=a;if(!l)return;const c=s({table:V.iU,id:l}),d=(null==c||null===(t=c.format)||void 0===t?void 0:t.table_block_column_header)&&(null==c?void 0:c.content)&&c.content[0]===r.id,u=null==c||null===(o=c.format)||void 0===o?void 0:o.table_block_column_format,m=(e,t,o)=>{var i;return u&&u[t]&&u[t].color?`block-color-${u[t].color}`:null!==(i=e.format)&&void 0!==i&&i.block_color?`block-color-${e.format.block_color}`:o?"simple-table-header-color":""},g=null==c||null===(i=c.format)||void 0===i?void 0:i.table_block_column_order,h=c?(null===(n=a.table)||void 0===n?void 0:n[c.id].renderColumns)??g:g;return g&&h?(await e.ticker.maybeYield(),p()("tr",{id:r.id},r.id,h.map((e=>{var t;const o=q({textValue:r.properties&&e in r.properties?r.properties[e]:void 0,exportArgs:a,renderers:Se}),i=(null==c||null===(t=c.format)||void 0===t?void 0:t.table_block_row_header)&&e===g[0],n=(e=>{if(u&&u[e]&&u[e].width)return u[e].width})(e);return d||i?p()("th",{id:e,className:`${m(r,e,!0)} simple-table-header`,style:n?{width:`${n}px`}:{}},e,o):p()("td",{id:e,className:m(r,e,!1),style:n?{width:`${n}px`}:{}},e,o)})))):void 0},tab:async e=>{var t;const{block:o,exportArgs:i}=e,{getRecordValue:n}=i,r=null===(t=o.content)||void 0===t?void 0:t.map((async t=>{const o=n({table:V.iU,id:t});if(o)return u.createElement(u.Fragment,null,p()("div",{style:{borderBottom:"0.05em solid",borderBottomColor:(0,w.gh)({theme:"light"}).lightDividerColor}},void 0,ae({...e,block:o,exportArgs:{...i,blockId:t,renderParentBlockId:e.block.id}})),await ce({...e,block:o}))}));return u.createElement("div",c()({id:e.block.id},re(e.block,"tab")),r?await Promise.all(r):void 0)},external_object_instance_page:async()=>Promise.resolve(void 0),button:async()=>Promise.resolve(void 0),ai_block:async e=>{const t=await ce(e);return p()("div",{},void 0,t)},drawing:()=>Promise.resolve(void 0)}};const we=Se;var ke=o(42875),Ce=o(5773),_e=o(98459),Me=o(95477),Te=o(33929),Ie=o(77505),Pe=o(40150),xe=o(29370),Be=o(43132),Ze=o(49865),Ee=o(64434),Re=o(96802),Ae=o(9953),De=o(24677),Fe=o(8713),Le=o(30149);function Ve(e){const{environment:t,selectionKey:o,selection:i}=e;xe.Z.setState({isActive:!0,selectionKey:o,selection:i}),De.ZH(t)}function Ne(){xe.Z.setState({isActive:!1})}function Oe(e){const{environment:t,selectionKey:o,shiftKey:i,columnCount:n,selection:r}=e;if(i&&r.end.col>0){const e={col:r.end.col-1,row:r.end.row};Ve({environment:t,selectionKey:o,selection:{start:r.start,end:e}})}else if(!i&&r.start.col>0){const e={col:r.start.col-1,row:r.start.row};Ve({environment:t,selectionKey:o,selection:{start:e,end:e}})}else if(!i&&0===r.start.col&&r.start.row>0){const e={col:n-1,row:r.start.row-1};Ve({environment:t,selectionKey:o,selection:{start:e,end:e}})}}function Ue(e){const{environment:t,selectionKey:o,shiftKey:i,columnCount:n,rowCount:r,selection:a}=e;if(i&&a.end.col<n-1){const e={col:a.end.col+1,row:a.end.row};Ve({environment:t,selectionKey:o,selection:{start:a.start,end:e}})}else if(!i&&a.start.col<n-1){const e={col:a.start.col+1,row:a.start.row};Ve({environment:t,selectionKey:o,selection:{start:e,end:e}})}else if(!i&&a.start.col>=n-1&&a.start.row<r-1){const e={col:0,row:a.start.row+1};Ve({environment:t,selectionKey:o,selection:{start:e,end:e}})}}function He(e){const{environment:t,selectionKey:o,shiftKey:i,selection:n}=e;if(i&&n.end.row>0){const e={col:n.end.col,row:n.end.row-1};Ve({environment:t,selectionKey:o,selection:{start:n.start,end:e}})}else if(!i&&n.start.row>0){const e={col:n.start.col,row:n.start.row-1};Ve({environment:t,selectionKey:o,selection:{start:e,end:e}})}}function ze(e){const{environment:t,selectionKey:o,shiftKey:i,rowCount:n,selection:r}=e;if(i&&r.end.row<n-1){const e={col:r.end.col,row:r.end.row+1};Ve({environment:t,selectionKey:o,selection:{start:r.start,end:e}})}else if(!i&&r.start.row<n-1){const e={col:r.start.col,row:r.start.row+1};Ve({environment:t,selectionKey:o,selection:{start:e,end:e}})}}const We=new Set(["auto_increment_id"]);function je(e){const{selection:t,schema:o,currentRows:i,currentPropertyFormats:n,transaction:r}=e,a=Pe.AV(t);for(let s=a.minRow;s<=a.maxRow;s++){const e=i[s];if(e)for(let t=a.minCol;t<=a.maxCol;t++){const i=n[t],a=o[i.property];null!=a&&a.type&&We.has(a.type)||Ae.sO({store:e.getPropertyStore(i.property),value:null,transaction:r})}}}const Ke=e=>{Ye(e),je(e)},Ye=e=>{const{selection:t,currentRows:o,event:i}=e;if(null===i.clipboardData)return;const r=Pe.AV(t);let a="";const l=[],c=o.slice(Math.max(0,r.minRow),r.maxRow+1).filter((e=>e&&e.isDefined()));for(const s of c){const t=[];l.push(t);for(let o=r.minCol;o<=r.maxCol;o++){const[i,n]="selectionKey"in e?Ge({row:s,x:o,collectionViewBlockStore:e.selectionKey.collectionViewBlockStore,...e}):Xe({row:s,x:o,...e});t.push([i,s.pointer]),n&&(a+=n),o<r.maxCol&&(a+="\t")}s!==n().last(c)&&(a+="\n")}if(i.preventDefault(),i.clipboardData.setData("text/plain",a),function(e,t){if(null===e.clipboardData)return;e.clipboardData.setData(Pe.mH,JSON.stringify(t))}(i,l),"simpleTableStore"in e){const{environment:t,simpleTableStore:o,columnOrder:n}=e,a=t.currentUser.id,l=t.defaultRecordCache.inMemoryRecordCache.makeGetRecordValueFn(a),g=n.slice(r.minCol,r.maxCol+1).filter((e=>void 0!==e)),h=(0,I._2)({exportArgs:{root:{table:V.iU,id:o.id,spaceId:(0,_e.CG)(o.pointer.spaceId)},navigableBlockId:o.id,renderParentBlockId:void 0,blockId:o.id,userTimeZone:(0,ke.r)(),intl:Te.default.getIntl(),getRecordValue:l,numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:e=>{let{toFileURI:t}=e;return t},getExportedRenderAsset:e=>{let{toFileURI:t}=e;return t},getExportedPathToPage:e=>{let{toPageId:t}=e;return(0,s.Z)({pageId:t,pageValue:l({table:V.iU,id:t}),baseUrl:Me.Z.domainBaseUrl})},baseUrl:Me.Z.domainBaseUrl,publicDomainName:Me.Z.publicDomainName,table:{[o.id]:{renderRows:c.map((e=>e.id)),renderColumns:g}},katex:t.KatexStore.getKatex()},renderers:we});if(h){const e=(d=h,m.renderToStaticMarkup(p()(u.Fragment,{},void 0,d)));i.clipboardData.setData("text/html",e)}}var d};function Ge(e){const{row:t,x:o,collectionViewBlockStore:i,schema:n,currentPropertyFormats:a}=e,s=a[o],l=et(t,n,s.property);if(!t.isDefined())return[l,void 0];return[l,(0,r.L)({property:s.property,schema:n,block:t.getModel(),getRecordModel:i.getRecordModel,userTimeZone:(0,ke.r)(),exportedFilePaths:!1,depth:0,intl:Te.default.getIntl()})]}function Xe(e){const{row:t,x:o,columnOrder:i,simpleTableStore:n}=e,r=t.getPropertyStore(i[o]);return[r.getValue()||[],j.Xh({textValue:r.getValue(),getRecordModel:n.getRecordModel,userTimeZone:(0,ke.r)(),intl:Te.default.getIntl()})]}function qe(e){const{environment:t,selection:o,currentRows:i,event:n,transaction:r}=e;if(!n.clipboardData)return;let a;const s=n.clipboardData.getData(Pe.mH),l=n.clipboardData.getData("text/html");if(s)a=JSON.parse(s);else if(l){const e=document.createElement("div");e.innerHTML=l;const t=e.querySelector("table");if(t){const e=t.querySelectorAll("tr");a=[];for(const t of Array.from(e)){const e=[],o=t.querySelectorAll("td, th");for(const t of Array.from(o)){const o=W.TP(t.textContent||"");e.push([o,void 0])}a.push(e)}}}if(!a){const e=function(e){if(!e.clipboardData)return;const{text:t,html:o,multiTextSelectionData:i,textSelectionData:n,blockSelectionData:r}=Be.e0(e.clipboardData);if(i)return Be.of({text:t,html:o,stripText:!1});if(n){const{editing:e,selection:t}=n;return W.OA(W.xr(e,t.startIndex,t.endIndex).tokensInsideRange)}if(o||t)return function(e,t,o){return e.includes("\n")||o&&o.blocks.length>0?W.TP(e):Be.of({text:e,html:t,stripText:!1})}(t,o,r)}(n);e&&(a=[[[e,void 0]]])}if(a){const n=Pe.AV(o),s=a[0].length;let l=Math.floor((n.maxCol-n.minCol+1)/s);0===l&&(l=1);const c=a.length;let d=Math.floor((n.maxRow-n.minRow+1)/c);0===d&&(d=1);for(let t=0;t<d;t++)for(let o=0;o<l;o++){const l=n.minCol+o*s,d=n.minRow+t*c;for(let t=0;t<c;t++){let o=i[d+t];if(!o){const t="selectionKey"in e?$e(e):Fe.nS(e);t&&(e.currentRows.push(t),o=t)}for(let i=0;i<s;i++){const n=a[t][i];if(!n)continue;const s=l+i;"currentPropertyFormats"in e?Je({row:o,x:s,serializedValue:n,currentPropertyFormats:e.currentPropertyFormats,transaction:r,schema:e.schema}):Qe({row:o,x:s,serializedValue:n,columnOrder:e.columnOrder,transaction:r})}}}const p={start:{col:n.minCol,row:n.minRow},end:{col:n.minCol+s*l-1,row:n.minRow+c*d-1}};"selectionKey"in e?Ve({environment:t,selectionKey:e.selectionKey,selection:p}):Ie._Y()&&Fe.pB({environment:t,start:p.start,end:p.end,simpleTableStore:e.simpleTableStore})}}function $e(e){const{environment:t,currentRows:o,collectionContextStore:i,selectionKey:n,transaction:r}=e,{groupFormat:a}=n,{newStore:s}=Ze.IW({environment:t,collectionContextStore:i,groupsPointer:a?[a]:[],results:o,insertAtIndex:o.length,coerce:!0,initializeDefaultTemplate:!1,transaction:r,from:"table_paste_selection"});return s}function Je(e){var t;const{row:o,x:i,serializedValue:n,currentPropertyFormats:r,transaction:a,schema:s}=e,l=r[i];if(!l)return;if("verification"===(null===(t=s[l.property])||void 0===t?void 0:t.type))return;const[c,d]=n;if(Ae.sO({store:o.getPropertyStore(l.property),value:c,transaction:a}),d){var p;const e=(0,Ce.jy)(c,Me.Z.secureFileS3.url,(null===(p=Me.Z.secureFileConfig)||void 0===p?void 0:p.rootPath)??"");Ae.nj({store:o,source:d,fileIds:e.map((e=>e.id)),transaction:a})}}function Qe(e){const{row:t,x:o,serializedValue:i,transaction:n,columnOrder:r}=e,a=r[o];if(!a)return;const[s,l]=i;Ae.sO({store:t.getPropertyStore(a),value:W.OA(s),transaction:n})}const et=function(e,t,o){const i=t[o];if(!i)throw new Error("Property not found");if(!e.isDefined())return[];const n=e.getPropertyValue(o);if("formula"===i.type){const i=(0,x.y4)({property:o,schema:t,block:e.getModel(),getRecordModel:e.getRecordModel,userTimeZone:(0,ke.r)(),depth:0,intl:Te.default.getIntl(),resultCache:{}});return W.TP(i)}if("created_time"===i.type&&e.getCreatedTime())return a.d7(A.CQ(e.getCreatedTime(),(0,ke.r)()));if("created_by"===i.type&&e.getCreatedByPointer()){const{table:t,id:o}=e.getCreatedByPointer()??{};return t===H.KJ?[W.YC(["u",o])]:[W.YC(["r",o])]}if("last_edited_time"===i.type&&e.getLastEditedTime())return a.d7(A.CQ(e.getLastEditedTime(),(0,ke.r)()));if("last_edited_by"===i.type&&e.getLastEditedByPointer()){const{table:t,id:o}=e.getLastEditedByPointer()??{};return t===H.KJ?[W.YC(["u",o])]:[W.YC(["r",o])]}return n||[]};function tt(e){let{environment:t,collectionViewStore:o,currentValue:i}=e;Le.createAndCommit({userAction:"tableActions.toggleTableVerticalLines",environment:t,perform:e=>{Re.FH({stores:[o],update:{hide_table_vertical_lines:!i},transaction:e})}})}function ot(e){let{environment:t,collectionViewStore:o,currentValue:i}=e;const n=o.getFormat().table_properties,r=null==n?void 0:n.map((e=>({...e,wrap:!i})));Le.createAndCommit({userAction:"tableActions.toggleTableWrapCells",environment:t,perform:e=>{Re.FH({stores:[o],update:{table_wrap:!i,table_properties:r},transaction:e})}})}function it(e){let{property:t,collectionViewStore:o,format:i,formatKey:n,environment:r,currentValue:a}=e;const s=!a,l=o.getFormat().table_wrap,c=i[n]||[];let d=!0;const p=c.map((e=>{let o;return o=e.property===t?s:Boolean(l||e.wrap),o||(d=!1),{...e,wrap:o}})),u={...i,[n]:p,table_wrap:d};Le.createAndCommit({userAction:"tableActions.toggleWrapColumn",environment:r,perform:e=>{Ee.iG({collectionViewStore:o,update:{format:u},transaction:e})}})}},57688:(e,t,o)=>{o.d(t,{wT:()=>we,aQ:()=>Ae,ED:()=>He,VG:()=>ne,Cm:()=>ie,Sq:()=>re,mX:()=>me,tW:()=>Me,HD:()=>ae,w6:()=>Pe,Ui:()=>Ve,Uj:()=>Ie,Cj:()=>Te,um:()=>Ce,s:()=>Ze,Dv:()=>Be,lo:()=>Se,tn:()=>Ue,hI:()=>Oe,mN:()=>Re,WO:()=>Ee,X0:()=>ve,YH:()=>De,Ju:()=>ye,$J:()=>ue,jg:()=>be,xI:()=>pe,lH:()=>ce,fs:()=>se,$x:()=>le,d:()=>Fe,W8:()=>he,Ce:()=>ge,RF:()=>xe});var i=o(51060),n=o(5220),r=o(65917),a=o(42875),s=o(2911),l=o(27006),c=o(4615),d=o(90468),p=o(29369),u=o(19889),m=o(90965),g=o(64684),h=o(70203),f=o(97880),v=o(63143),y=o(28020),b=o(33929),S=o(45010),w=o(8323),k=o(78122),C=o(5366),_=o(64964),M=o(1310),T=o(19306);const I=(0,C.defineMessages)({leftTeam:{id:"teamPermissionsActions.leftTeam",defaultMessage:"Left {teamName}"},leftTeamNoName:{id:"teamPermissionsActions.leftTeamNoName",defaultMessage:"Left team",description:"Toast message that shows after the user leaves a team, displayed when the user name is not available."},leftYetStillInTeam:{id:"teamPermissionsActions.leftYetStillInTeam",defaultMessage:"You are still in {hasTeamName, select, true {{teamName}} other {the team}} because you are a member of the following groups: {groupsString}",description:"Toast message that shows after the user leaves a team as an individual, but is stil a member of some groups that are part of the team."},removedYetStillInTeam:{id:"teamPermissionsActions.removedYetStillInTeam",defaultMessage:"{hasMemberName, select, true {{memberName}} other {The removed user}} is still in {hasTeamName, select, true {{teamName}} other {the team}} because they are a member of the following groups: {groupsString}",description:"Toast message that shows after a user is removed from a team as an individual, but is stil a member of some groups that are part of the team."},joinedTeam:{id:"teamPermissionsActions.joinedTeam",defaultMessage:"Joined {teamName}",description:"Toast message that shows after the user joins a team."},joinedTeamUsingAdminPrivileges:{id:"teamPermissionsActions.joinedTeamUsingAdminPrivileges",defaultMessage:"Joined {teamName} using admin privileges",description:"Toast message that shows after the user joins a team using enterprise admin privileges. Ex: joining a private team."},upgradedSelfToOwner:{id:"teamPermissionsActions.upgradedSelfToOwnerUsingAdminPrivileges",defaultMessage:"Became owner of {teamName} using admin privileges",description:"Toast message that shows after the user becomes owner of a teamspace using enterprise admin privileges."},archivedTeam:{id:"teamPermissionsActions.archivedTeam",defaultMessage:"Archived {teamName}"},restoredTeam:{id:"teamPermissionsActions.restoredTeam",defaultMessage:"Restored {teamName}"},restoredTeamNoName:{id:"teamPermissionsActions.restoredTeamNoName",defaultMessage:"Restored team",description:"Toast message that shows when a team is restored."},duplicatedTeam:{id:"teamPermissionsActions.duplicatedTeam",defaultMessage:"Duplicated {teamName}",description:"Toast message that shows when a teamspace is duplicated."},duplicatedTeamNoName:{id:"teamPermissionsActions.duplicatedTeamNoName",defaultMessage:"Duplicated teamspace",description:"Toast message that shows when a teamspace is duplicated, but it doesn't have a name."}}),P=(e,t,o)=>{const i=b.default.formatMessage(e,{...t});_.oV({label:i,durationMs:o})},x=e=>{let{teamName:t,usingAdminPrivileges:o}=e;return P(o?I.joinedTeamUsingAdminPrivileges:I.joinedTeam,{teamName:t})};var B=o(23537),Z=o(25223),E=o(27406),R=o(79315),A=o(3418),D=o(3815),F=o(19522),L=o(7755),V=o(48690),N=o(42185),O=o(72684),U=o(74716),H=o(30397),z=o(50906),W=o(17224),j=o(54642),K=o(47307),Y=o(11302),G=o(89858),X=o(10279),q=o(9953),$=o(5978),J=o(21325),Q=o(150),ee=o(24690);var te=o(30149),oe=o(65452);async function ie(e){let{environment:t,name:o,description:i,icon:n,accessLevel:r,isDefault:a,flowId:s,createTeamHome:l,teamPermissionRole:c,spacePermissionRole:d,members:u,settings:m,persona:g}=e;const{currentSpaceStore:h}=R.default.getState();if(!h)throw new Error("currentSpaceStore does not exist");const f=h.id,v=await j.createTeam(t,{spaceId:f,name:o,description:i,icon:n,isDefault:a,accessLevel:r,teamPermissionRole:c,spacePermissionRole:d,members:u,settings:m});if("failed"===v.type)return void Le(v);const{teamId:y}=v.data,b=D.zX.createChildStore(h,{table:p.e0,id:y,spaceId:f});return await b.load(),l&&await G.He({environment:t,teamStore:b}),z.trackCreateTeamComplete(t,{store:b,flowId:s,persona:g}),b}function ne(e){var t;let{environment:o,page:i}=e;const n=(0,c.ZP)(),r=(null===(t=i.getParentPointer())||void 0===t?void 0:t.table)!==p.e0?"page_to_team_nested":"page_to_team";z.trackCreateTeamStart(o,{from:r,flowId:n}),O.Z.setState({open:!0,pageStore:i,flowId:n})}async function re(e){var t;let{environment:o,page:i,flowId:n,intl:r}=e;const{accessLevel:s,spacePermissionRole:l,teamPermissionRole:c,members:d}=(0,B.Pr)(i),u=(i.isDefined()?i.getModel().getRenderTitle({intl:r,userTimeZone:(0,a.r)(),getRecordModel:i.getRecordModel}):void 0)??h.Q(i.getTitleValue()),m=await ie({environment:o,name:u,icon:null===(t=i.getIcon())||void 0===t?void 0:t.icon,accessLevel:s,isDefault:!1,description:"",flowId:n,createTeamHome:!1,teamPermissionRole:c,spacePermissionRole:l,members:d});if(!m)return;const{currentSpaceViewStore:g}=R.default.state;g&&(te.createAndCommit({userAction:"teamActions.movePageToCreatedTeam",environment:o,perform:e=>{Y.at({environment:o,currentSpaceViewStore:g,transaction:e,teamStore:m,action:"move",value:{type:p.e0,id:m.id},targets:[i],location:{type:"append"}})}}),xe({environment:o,teamId:m.id,tab:V.a.Members,from:"create_team_from_page"}),await new Promise((e=>setTimeout((()=>Ne({teamStore:m,environment:o})),100))))}async function ae(e){let{environment:t,name:o,description:i,icon:n,flowId:r,trackCreateTeamComplete:a,persona:s}=e;const{currentSpaceStore:l}=R.default.getState();if(!l)throw new Error("currentSpaceStore does not exist");const c=l.id;if(!(0,B.XL)()||!c)return;const d=await j.enableTeams(t,{spaceId:c,defaultTeamName:o,defaultTeamIcon:n,defaultTeamDescription:i});if("failed"===d.type)return void Le(d);const{teamId:u}=d.data,m=D.zX.createChildStore(l,{table:p.e0,id:u,spaceId:c});return await m.load(),await G.He({environment:t,teamStore:m}),z.trackEnableTeams(t,{spaceId:c,store:m,flowId:r}),a&&u&&z.trackCreateTeamComplete(t,{store:m,flowId:r,persona:s}),m}function se(e){const{store:t,update:o,transaction:i}=e;q.sW({store:t,data:(0,v.Q2)(o),transaction:i})}function le(e){let{environment:t,store:o,update:i,transaction:n}=e;const r=function(e){let{store:t,update:o}=e;const i=t.getSettingsStore().getValue();if(!i)return{};const n={};for(const r in o)n[r]=i[r];return n}({store:o,update:i});q.sW({store:o.getSettingsStore(),data:(0,v.Q2)(i),transaction:n}),z.trackUpdateTeamSettings(t,{store:o,old_settings:r,updated_settings:i})}async function ce(e){let{environment:t,spaceValue:o,addedStores:i,removedStores:n,createNewTeamFlowId:r,from:a}=e;const s=t.currentUser.id;if(!s||i.some((e=>!e.isDefined())))return!1;if(!(0,m.wv)(o,s))throw new Error("Only admins can update default teams");const{performResult:{results:l},serverCommitResult:c}=te.createAndCommit({environment:t,userAction:"teamActions.updateDefaultTeams",perform:e=>{const o=[];for(const n of i){const i=de({environment:t,transaction:e,teamStore:n,isDefault:!0,from:a,createNewTeamFlowId:r});o.push(i)}for(const i of n){const n=de({environment:t,transaction:e,teamStore:i,isDefault:!1,from:a,createNewTeamFlowId:r});o.push(n)}return{results:o}}});return await c,await J.bi(t),l.every((e=>e))}function de(e){let{environment:t,transaction:o,teamStore:i,isDefault:n,from:r,createNewTeamFlowId:a}=e;return i.isDefault()===n||(q.sW({store:i,data:{is_default:n},transaction:o}),o.postSubmitCallbacks.push((e=>{e||z.trackSetDefaultTeam(t,{store:i,is_default_team:n,create_new_team_flow_id:a,from:r})}))),!0}function pe(e){var t;const{environment:o,teamStore:i,newRole:n,transaction:r,permissionsToClear:a}=e,s=a.map((e=>({...e,role:"none"}))),c=(null===(t=i.getTeamPermission())||void 0===t?void 0:t.role)??"none",d={type:"explicit_team_permission",team_id:i.id,role:n};s.push(d),X.ep({environment:o,store:i,permissionItems:s,transaction:r}),i.isDefault()&&X.ep({environment:o,store:i,permissionItems:[{type:"space_permission",role:n}],transaction:r}),(0,l.J5)(c)||!(0,l.J5)(n)||i.getDisableTeamPageEdits()||le({environment:o,store:i,update:{disable_team_page_edits:!0},transaction:r})}function ue(e){const{environment:t,teamStore:o,newRole:i,transaction:n,permissionsToClear:r}=e,a=r.map((e=>({...e,role:"none"}))),s={type:"explicit_team_guest_permission",team_id:o.id,role:i};a.push(s),X.ep({environment:t,store:o,permissionItems:a,transaction:n})}function me(e){let{userId:t,teamStore:o,transaction:i,environment:n,permissionRole:r}=e;const a=o.getMembershipDefinedOnTeam(),s=a.find((e=>"user"===e.entity_type&&e.user_id===t));if(!s)throw new Error("Specified user is not on the team");if("member"===s.type)return!1;if(!o.isDefined())return!1;const l=o.getPermissionItems(),c=o.id;if(r&&(0,g.bk)({teamValue:{id:c,permissions:l},permissionRole:r}))throw new Error("Cannot set member's permission to be lower than default team permission.");if(!(0,g.XO)({membership:a}).includes(t))throw new Error("Specified user is not an owner of the team");let d=!1;if(a.length>0){const e=a.filter((e=>!("user"===e.entity_type&&e.user_id===t)));d=a.length!==e.length;const r=[{entity_type:"user",type:"member",user_id:t},...e];te.applyOperation({store:o,operation:{pointer:o.pointer,path:["membership"],command:"set",args:r},transaction:i}),z.trackTeamRoleUpdateForIndividualUser(n,{store:o,permission_user_id:t,team_role:"member"})}let p=r||"none";const u=(0,g.xC)({id:c,permissions:l});u&&r===u&&(p="none");const m={type:"user_permission",role:p,user_id:t};return X.ep({environment:n,store:o,permissionItems:[m],transaction:i,skipAnalytics:d})}function ge(e){let{environment:t,userId:o,teamStore:i,spaceStore:n,transaction:r,newTeamRole:a}=e;if(!i.isDefined())return!1;const s=i.getMembers().find((e=>"user"===e.entity_type&&e.user_id===o));return!!s&&(s.type!==a&&(te.applyOperation({store:i,operation:{pointer:i.pointer,path:["membership"],command:"setTeamMembershipItem",args:{entity_type:"user",type:a,user_id:o}},transaction:r}),X.ep({environment:t,store:n,permissionItems:[{type:"user_permission",role:"read_and_write",user_id:o}],transaction:r}),ve({environment:t,memberInfo:s,teamStore:i,transaction:r}),!0))}function he(e){let{environment:t,userId:o,teamStore:i,transaction:n}=e;const r=i.getMembers().find((e=>"user"===e.entity_type&&e.user_id===o));if(!r)throw new Error("Specified user is not on the team");if("owner"===r.type)return!1;if(!i.isDefined())return!1;const a=i.getMembershipDefinedOnTeam().filter((e=>!("user"===e.entity_type&&e.user_id===o))),s=[{entity_type:"user",type:"owner",user_id:o},...a];return te.applyOperation({store:i,operation:{pointer:i.pointer,path:["membership"],command:"set",args:s},transaction:n}),z.trackTeamRoleUpdateForIndividualUser(t,{store:i,permission_user_id:o,team_role:"owner"}),ve({environment:t,memberInfo:r,teamStore:i,transaction:n}),!0}function fe(e){let{memberInfo:t,newRole:o}=e;return"user"===t.entity_type?{type:"user_permission",user_id:t.user_id,role:o}:{type:"group_permission",group_id:t.group_id,role:o}}function ve(e){let{environment:t,memberInfo:o,teamStore:i,transaction:n}=e;return!!i.getPermissionItems()&&(X.ep({environment:t,store:i,permissionItems:[fe({memberInfo:o,newRole:"none"})],transaction:n}),!0)}async function ye(e){let{store:t,environment:o,accessLevel:i,teamName:n,from:r,isDefault:a}=e;const{currentSpaceStore:s}=R.default.getState();if(!s)throw new Error("currentSpaceStore does not exist");const l=t.isDefault()??!1,c=t.getTeamAccessLevel(),d=(0,g.Hf)({membership:t.getRawMembership()}).length;if(i===c&&a===l)return!1;if(!(await k.hL({teamName:n,accessLevel:i,currentIsDefault:l,isDefault:a,numberOfTeamGuests:d})))return!1;const p=t.getPermissionItems(),u=t.getSettingsStore().getValue();if(!u||!p)return!1;const m=(0,g.AW)({teamValue:{id:t.id,permissions:p,settings:u},accessLevel:i,isDefault:a}),{performResult:{result:h}}=te.createAndCommit({userAction:"teamActions.setTeamAccessLevel",environment:o,perform:e=>{de({environment:o,transaction:e,teamStore:t,isDefault:"invite_only"!==m.settings.space_member_join_access&&a,from:r,createNewTeamFlowId:void 0});const i=X.ep({environment:o,store:t,permissionItems:m.permissions,transaction:e});return q.sW({store:t.getSettingsStore(),data:m.settings,transaction:e}),{result:i}}});return h&&z.trackChangeTeamAccessLevel(o,{store:t,old_access_level:c,new_access_level:i,from:r}),h}function be(e){let{memberInfo:t,teamStore:o,transaction:i,environment:n,permissionRole:r}=e;if("owner"===t.type)return me({userId:t.user_id,teamStore:o,transaction:i,environment:n,permissionRole:r});if(!o.isDefined())return!1;const a=o.id,s=o.getPermissionItems(),l=o.getMembers();if(r&&(0,g.bk)({teamValue:{id:a,permissions:s},permissionRole:r}))throw new Error("Cannot set member's permission to be lower than default team permission.");const c=(0,g.hY)({membership:l});if("user"===t.entity_type&&!c.find((e=>"user"===e.entity_type&&e.user_id===t.user_id))||"group"===t.entity_type&&!c.find((e=>"group"===e.entity_type&&e.group_id===t.group_id)))throw new Error("Specified memberInfo not found on team");let d=r||"none";const p=(0,g.xC)({id:a,permissions:s});return p&&r===p&&(d="none"),X.ep({environment:n,store:o,permissionItems:[fe({memberInfo:t,newRole:d})],transaction:i})}function Se(e){F.Z.setState({...F.Z.state,open:!0,from:e})}async function we(e){let{environment:t,currentSpaceStore:o,teamStore:i,from:n,action:r}=e;const a=t.currentUser.id;if(!a||!o||!(0,Z.o)({userId:a,spaceStore:o,entrypoint:n}))return!1;if(!(await async function(e){return!ee.Z.state.open&&await new Promise((t=>{ee.Z.setState({open:!0,type:e,onAccept:()=>t(!0),onCancel:()=>t(!1)})}))}(r)))return!1;const s=await j.setAdminPrivilegedTeamMembership(t,{spaceId:o.id,teamId:i.id,teamRole:ke(r)});if("failed"===s.type)return Le(s),!1;switch(r){case"joinTeamAsOwner":case"joinClosedOrPrivateTeamAsMember":_e({environment:t,teamStore:i,from:n,newRole:"joinTeamAsOwner"===r?"owner":"member",usingAdminPrivileges:!0,andNavigateToTeamHome:!1});break;case"upgradeToOwner":z.trackTeamRoleUpdateForIndividualUser(t,{permission_user_id:a,team_role:"owner",store:i});const e=i.getName();e&&(e=>{P(I.upgradedSelfToOwner,{teamName:e})})(e);break;default:(0,f.t1)(r)}return!0}function ke(e){switch(e){case"joinTeamAsOwner":case"upgradeToOwner":return"owner";case"joinClosedOrPrivateTeamAsMember":return"member";default:(0,f.t1)(e)}}async function Ce(e){let{environment:t,currentSpaceStore:o,teamStore:i,from:n,andNavigateToTeamHome:r}=e;const a=t.currentUser.id;if(!a)return!1;const s=await j.updateTeamMembers(t,{spaceId:o.id,teamId:i.id,newMembersOrGuestsToAdd:[{type:"member",entity_type:"user",user_id:a}]});return"failed"===s.type?(Le(s),!1):(_e({environment:t,teamStore:i,from:n,newRole:"member",usingAdminPrivileges:!1,andNavigateToTeamHome:r}),!0)}function _e(e){let{environment:t,teamStore:o,from:i,newRole:n,usingAdminPrivileges:r,andNavigateToTeamHome:a}=e;const s=t.currentUser.id,l=R.default.state.currentSpaceStore,c=R.default.state.currentSpaceViewStore;if(!s||!l||!c)return!1;!function(e){var t;let{environment:o,currentSpaceViewStore:i,teamId:n}=e;const r=null===(t=(0,y.k_)(o).state)||void 0===t?void 0:t.userJoinedTeamsStores;if(!r||!i)return!1;const a=[...r.map((e=>{let{id:t}=e;return t})).filter((e=>e!==n)),n];Q.Ct({environment:o,currentSpaceViewStore:i,orderedTeamIds:a,userAction:"TeamBrowserOutliner",isExplicitUserAction:!1})}({environment:t,currentSpaceViewStore:c,teamId:o.id}),z.trackCurrentUserJoinTeam(t,{store:o,joined_role:n,from:i}),oe.l({environment:t,userId:s,spaceId:l.id});const d=o.getName();a?(Oe({environment:t,teamStore:o,shouldScroll:!1}),d&&new Promise((e=>setTimeout(e,500))).then((()=>{x({teamName:d,usingAdminPrivileges:r})}))):d&&x({teamName:d,usingAdminPrivileges:r})}async function Me(e){var t;let{environment:o,teamStore:n,from:r,buttonPopupStore:a}=e;if(!o.currentUser.id)return!1;const s=(0,c.ZP)(),l=n.isDefault(),d=n.getTeamAccessLevel();if(l)return!1;const p=n.getName(),u=await ie({environment:o,name:(0,i.nM)(p||""),description:"",icon:n.getRawIcon(),accessLevel:d,isDefault:l,createTeamHome:!0,teamPermissionRole:null===(t=n.getTeamPermission())||void 0===t?void 0:t.role,spacePermissionRole:n.getSpacePermissionRole(),members:[],settings:n.getSettings(),flowId:s});return!!u&&(W.$4(o,{store:u,from:r}),Oe({environment:o,teamStore:u,shouldScroll:!0}),xe({environment:o,teamId:u.id,tab:V.a.General,from:"duplicate_team",buttonPopupStore:a}),new Promise((e=>setTimeout(e,500))).then((()=>{var e;(e=p)?P(I.duplicatedTeam,{teamName:e}):P(I.duplicatedTeamNoName)})),!0)}async function Te(e){let{environment:t,teamId:o,spaceId:i,teamMemberInfos:n,isSettingDefaultTeam:r,inviterId:a}=e;const s=t.currentUser.id;if(!i||!s)return!1;return"failed"!==(await j.updateTeamMembers(t,{spaceId:i,teamId:o,newMembersOrGuestsToAdd:n,isSettingDefaultTeam:r,addNewMembersToSpace:!1},a)).type}async function Ie(e){let{environment:t,teamStore:o,teamMemberInfos:i,isSettingDefaultTeam:n,createNewTeamFlowId:r}=e;const a=o.getSpaceId();if(!a)return!1;const s=t.currentUser.id;if(!a||!s)return!1;if("failed"===(await j.updateTeamMembers(t,{spaceId:a,teamId:o.id,newMembersOrGuestsToAdd:i,isSettingDefaultTeam:n,addNewMembersToSpace:(0,w.Mk)()},s)).type)return!1;if(!n){const e=i.flatMap((e=>"user"!==e.entity_type?[]:e.user_id)),n=e.length,a=i.filter((e=>"group"===e.entity_type)).length;n>0&&z.trackInviteTeamMembers(t,{store:o,num_members_invited:n,create_new_team_flow_id:r,members_invited:e}),a>0&&z.trackInviteTeamGroups(t,{store:o,num_groups_invited:a,create_new_team_flow_id:r})}return!0}function Pe(e){switch(e){case"team_browser":case"duplicate_team":case"create_team_from_page":case"permission_item":case"teams_dropdown_for_team_guest":case"teams_dropdown_for_team_member":case"teams_dropdown_for_group":case"teamSidebar":case"teamBrowserSearch":case"teamBrowserUnjoinedTeams":case"teamBrowserJoinedTeams":case"team_breadcrumb_popup":case"team_menu_header":case"sidebar_team_modal":case"team_invite_link":return!1;case"manage_teams_table":return!0;default:(0,f.t1)(e)}}function xe(e){let{environment:t,teamId:o,tab:i,from:n,buttonPopupStore:r}=e;const a=R.default.state.currentSpaceStore;if(!a)return;const s=D.zX.createChildStore(a,{table:p.e0,id:o});if(s.canRead()||!(0,B.mP)())V.Z.update((e=>({...e,open:!0,tab:i,teamStore:s,viewingUnjoinedPrivateTeamAsEnterpriseAdmin:!1})));else{const e=Be({environment:t,spaceStore:a,teamId:o,from:n});if(!e)return;V.Z.update((t=>({...t,open:!0,tab:i,unjoinedPrivateTeamStore:e,viewingUnjoinedPrivateTeamAsEnterpriseAdmin:!0})))}r&&(A.Z.removeNamedPopup("team_more_actions"),r.setState({...r.state,open:!1}))}function Be(e){var t;let{environment:o,spaceStore:i,teamId:r,from:a}=e;if(!Pe(a))return;const s=i.getModel(),l=null===(t=R.default.state.currentUserStore)||void 0===t?void 0:t.id;if(!(0,n.H)({spaceModel:s,userId:l}))return;const c=U.Z.createTeamStoreFromCache({environment:o,teamId:r,spaceId:i.id,userId:l}),d=null==c?void 0:c.getModel();return null!=c&&c.canRead()&&d&&(0,g.Ei)({userId:l,teamModel:d,spaceModel:s})?c:void 0}async function Ze(e){let{environment:t,teamStore:o,currentSpaceStore:i,from:n}=e;const r=t.currentUser.id;return!!r&&await Ee({environment:t,teamStore:o,currentSpaceStore:i,userId:r,from:n})}async function Ee(e){let{environment:t,teamStore:o,currentSpaceStore:i,userId:n,from:r}=e;const a=o.getSpaceId();if(!(o.isDefined()&&null!=i&&i.isDefined()&&t.currentUser.id&&a))return!1;const s=o.getMembers(),l=(0,g.XO)({membership:s}),c=l.some((e=>e===n));if(c&&1===l.length)return k.ZH(),!1;const d=(0,g.x4)({members:s,groups:i.getPermissionGroups()}).filter((e=>{var t;return null===(t=e.user_ids)||void 0===t?void 0:t.includes(n)}));if(!o.getMembers().find((e=>"user"===e.entity_type&&e.user_id===n)))return k.T0(d),!1;const p=D.t1.createChildStore(o,{table:u.KJ,id:n}),m=n===t.currentUser.id,h=o.getName()??"",f=p.getDisplayName(b.default.getIntl());if(!(await k.A8({isCurrentUser:m,teamName:h,memberName:f})))return!1;const v=[{entity_type:"user",type:c?"owner":"member",user_id:n}],y=await j.updateTeamMembers(t,{spaceId:a,teamId:o.id,existingMembersOrGuestsToRemove:v});return"failed"===y.type?(Le(y),!1):(z.trackRemoveTeamMembers(t,{store:o,is_leaving_team:m,num_members_removed:v.length,from:r}),d.length>0?m?((e,t)=>{const o=(0,T.W)(t.flatMap((e=>e.name||[])));P(I.leftYetStillInTeam,{hasTeamName:void 0!==e,teamName:e,groupsString:o},M.JY)})(h,d):((e,t,o)=>{const i=(0,T.W)(o.flatMap((e=>e.name||[])));P(I.removedYetStillInTeam,{hasMemberName:void 0!==e,hasTeamName:void 0!==t,memberName:e,teamName:t,groupsString:i},M.JY)})(f,h,d):m&&(e=>{e?P(I.leftTeam,{teamName:e}):P(I.leftTeamNoName)})(h),oe.l({environment:t,userId:n,spaceId:a}),!0)}function Re(e){let{environment:t,teamStore:o,group:i}=e;const n=o.getSpaceId();if(!n)return;const r=o.getMembers().find((e=>"group"===e.entity_type&&e.group_id===i.id));r&&k.iT({group:i,onAccept:async()=>{const e=[r],i=await j.updateTeamMembers(t,{spaceId:n,teamId:o.id,existingMembersOrGuestsToRemove:e});"failed"!==i.type?z.trackRemoveTeamGroups(t,{store:o,num_groups_removed:e.length}):Le(i)}})}async function Ae(e){const{currentSpaceStore:t}=R.default.getState();if(!t)throw new Error("currentSpaceStore does not exist");const{environment:o,teamStore:i,from:n}=e,r=o.currentUser.id,a=i.getName()||"",s=t.getSettingsStore();if(!r)return;const c=H.Z.state.teams.map((e=>({membership:e.getMembers(),id:e.id,archived_by:e.getArchivedBy(),is_default:e.isDefault()}))),p=(0,g.wN)({spaceValue:{permissions:t.getPermissionItems(),permission_groups:t.getPermissionGroups()},teamsInSpace:c,currentUserId:r,teamId:i.id,isTeamsPricingUpdatesEnabled:(0,B.XL)()});if(await k.Fy(a,p)){if(p){const e=await k.wG(a);te.createAndCommit({userAction:"teamsHelpers.archiveLastTeam",environment:o,perform:o=>{if(se({store:i,update:{archived_by:r,archived_at:Date.now()},transaction:o}),q.sW({store:s,data:{is_teams_enabled:!1},transaction:o}),e){const e=i.getTeamPagesStores()??[];for(const i of e){const e=i.getRole();if(!e)continue;const n={type:"user_permission",user_id:r,role:e},a=[...i.getPermissionItems().filter((e=>!l.fG(e)&&!l.Le(e)&&!l.ix(e))),n];q.sW({store:i,data:{parent_id:t.id,parent_table:d.bx,permissions:a},transaction:o})}q.sW({store:i,data:{team_pages:[]},transaction:o})}}}),z.trackTransitionToZeroTeams(o,{store:i,from:n})}else te.createAndCommit({userAction:"teamsHelpers.archiveTeam",environment:o,perform:e=>{se({store:i,update:{archived_by:r,archived_at:Date.now()},transaction:e})}});z.trackArchiveTeam(o,{store:i,from:n}),V.Z.setState({open:!1,limitMembers:!0,memberFilterQuery:"",tab:void 0}),(e=>{P(I.archivedTeam,{teamName:e})})(a)}}function De(e){let{environment:t,teamStore:o,teamName:i,from:n}=e;te.createAndCommit({userAction:"teamsHelpers.restoreArchivedTeam",environment:t,perform:e=>{se({store:o,update:{archived_by:void 0,archived_at:void 0},transaction:e})}}),z.trackRestoreTeam(t,{store:o,from:n}),(e=>{e?P(I.restoredTeam,{teamName:e}):P(I.restoredTeamNoName)})(i)}async function Fe(e){let{settingName:t,newTeamSettingValue:o,spaceSettingValue:i,environment:n,store:r}=e;let a=!0;return"disable"===i&&"allow"===o?a=await k.hC(t):"disable"===o&&(a=await k.Bj(t)),!!a&&(te.createAndCommit({userAction:"teamsHelpers.changeTeamSetting",environment:n,perform:e=>{le({environment:n,store:r,update:{[t]:"disable"===o},transaction:e})}}),!0)}function Le(e){K.showError(e),r.log({level:"error",from:"teamActions",type:"TeamApiError",error:(0,s.Ui)(e.error),data:{miscDataToConvertToString:{body:e.body,status:e.status}}})}function Ve(e){return`TeamToggle_${e.id}`}function Ne(e){let{teamStore:t,environment:o}=e;if(o.device.isMobile)return;const i=Ve(t),n=E.Z.findDropTargetFromKey(i);if(n){const e=n.getNode();if(!(e instanceof HTMLElement))return;if(S.Z.SidebarScroller){var r;const o=(null===(r=S.Z.SidebarScroller.scrollerEl())||void 0===r?void 0:r.offsetTop)||0;S.Z.SidebarScroller.scrollTo(e.offsetTop-o,0,{animate:!0}),N.Z.setState(t.id),setTimeout((()=>{N.Z.state===t.id&&N.Z.setState(void 0)}),1500)}}}function Oe(e){const{environment:t,teamStore:o,shouldScroll:i}=e;i&&Ne({teamStore:o,environment:t});const n=o.getTeamPagesStores();!n||n.length<1||($.navigateToBlock({environment:t,store:n[0]}),z.trackOpenTeamHome(t,{store:o}))}function Ue(e,t){let{from:o}=t;z.trackOpenTeamBrowser(e,{from:o}),L.kx.setState(!L.kx.state)}function He(e){let{environment:t,from:o,teamStore:i}=e;const{state:n}=F.Z;z.trackCloseCreateTeamModal(t,{screen:n.screen,team_id:n.teamId,team_has_icon:Boolean(n.icon),team_has_name:Boolean(n.name),team_has_description:Boolean(n.description),team_access_level:n.accessLevel,flow_id:n.flowId,from:o,store:i,persona:n.persona,selectedTypes:n.selectedTypes}),F.Z.reset()}},150:(e,t,o)=>{o.d(t,{Ct:()=>v,Hl:()=>y,c0:()=>S,sp:()=>w});var i=o(77094),n=o.n(i),r=o(67294),a=o(5366),s=o(27006),l=o(29369),c=o(64684),d=o(98165),p=o(3815),u=o(50906),m=o(47307),g=o(94419),h=o(9953),f=o(30149);function v(e){const{environment:t,currentSpaceViewStore:o,orderedTeamIds:i,userAction:n}=e;if(f.createAndCommit({userAction:n,environment:t,perform:e=>{h.sW({store:o,data:{joined_teams:i},transaction:e})}}),e.isExplicitUserAction){const{key:i,startPosition:n,endPosition:r}=e.dropArgs,a=p.zX.createChildStore(o,{table:l.e0,id:i});u.trackChangeTeamsOrder(t,{store:a,start_position:n,end_position:r})}}async function y(e){let{transaction:t,...o}=e;const{moveToTeam:i,permissionsUpdateItems:s}=function(e){let{moveStores:t,moveTargetStore:o}=e;const i=t.reduce(((e,t)=>(e[t.id]=(0,d.VP)(t),e)),{}),n=(0,d.VP)(o),r=[];for(const a of t){const e=b({blockStore:a,moveFromTeam:i[a.id],moveToTeam:n});e&&r.push(e)}return{moveToTeam:n,permissionsUpdateItems:r}}(o);if(0===s.length)return"not_cleared";if(!(await async function(e){let{numPagesMoved:t,moveToTeam:o,permissionsUpdateItems:i}=e;if(0===i.length)return!0;if(!o)return!0;const s=o.getName(),l=i.some((e=>{let{isRemovingRestricted:t}=e;return!0===t}))&&n()(a.FormattedMessage,{id:"teamActions.confirmMoveToTeam.removeRestrictedDescription",description:"Description for removing the restricted status of a page in confirmation dialog.",defaultMessage:" {numPagesMoved, plural, one {This page} other {These pages}} will no longer have restricted access.",values:{numPagesMoved:t}});return await m.confirmUserAction({message:n()(a.FormattedMessage,{defaultMessage:"Are you sure you want to move {numPagesMoved, plural, one {this page} other {these pages}} to {moveToTeamName}?",id:"teamActions.confirmMoveToTeam.title",description:"Confirmation dialog title asking user whether they want make an open team private",values:{moveToTeamName:s,numPagesMoved:t}}),description:r.createElement(r.Fragment,null,n()(a.FormattedMessage,{id:"teamActions.confirmMoveFromTeam.description",description:"Confirmation dialog description text.",defaultMessage:"This will transfer the permissions on {numPagesMoved, plural, one {this page} other {these pages}} to members of {moveToTeamName}. ",values:{moveToTeamName:s,numPagesMoved:t}}),l)})}({numPagesMoved:o.moveStores.length,moveToTeam:i,permissionsUpdateItems:s})))return"user_cancelled_move";for(const{blockStore:n,permissions:r}of s)h.sW({store:n,data:{permissions:r},transaction:t});return"cleared"}function b(e){let{blockStore:t,moveFromTeam:o,moveToTeam:i}=e;if(void 0===o&&void 0===i)return;if((null==o?void 0:o.id)===(null==i?void 0:i.id))return;const n=t.getPermissionItems();let r=!1;const a=n.filter((e=>(0,s.Le)(e)?(r=!0,!1):!(0,s.ix)(e)&&(!o||!(0,c.J2)(e,o.id)&&!(0,c.jc)(e,o.id))));return n.length!==a.length?{blockStore:t,permissions:a,moveFromTeam:o,isRemovingRestricted:r}:void 0}function S(e){const{store:t,teamStore:o,transaction:i,appendOrPrepend:n}=e,r=o.getTeamPagesStore(),a=p.G.createChildStore(r,t.pointer);"append"===n?g.R3({parent:r,append:a,transaction:i}):"prepend"===n&&g.Ce({parent:r,prepend:a,transaction:i})}function w(e){const{store:t,teamStore:o,transaction:i}=e,n=o.getTeamPagesStore(),r=p.G.createChildStore(n,t.pointer);g.Od({childToRemove:r,parent:n,transaction:i})}},18698:(e,t,o)=>{o.d(t,{um:()=>v,t_:()=>y,Px:()=>b,ow:()=>S,Id:()=>w,Ng:()=>k});var i=o(5366),n=o(19889),r=o(33929),a=o(38755),s=o(79315),l=o(50906),c=o(54642),d=o(9953),p=o(64964),u=o(29974),m=o(57688),g=o(30149),h=o(94507);const f=(0,i.defineMessages)({joinTeamSuccessMessage:{id:"teamInviteLinkActions.joinTeam.confirmationMessage",defaultMessage:"Joined {teamName}",description:"This message is shown after a user successfully joins a team"},requestTeamSuccessMessage:{id:"teamInviteLinkActions.requestAccess.successMessage",defaultMessage:"Successfully requested membership",description:"This message is shown after a user successfully requests access to a team"},requestTeamFailureMessage:{id:"teamInviteLinkActions.requestAccess.failureMessage",defaultMessage:"Failed to request membership",description:"This message is shown after a user fails to request access to a team"}});async function v(e){let{environment:t,userId:o,teamStore:i,user:n}=e;const a=i.getSpaceId();if(!a)return;await m.Cj({environment:t,teamId:i.id,spaceId:a,teamMemberInfos:n,isSettingDefaultTeam:!1,inviterId:o})&&(l.trackCurrentUserJoinTeam(t,{store:i,joined_role:"member",from:"team_invite_link"}),await y({environment:t,userId:o,teamStore:i}),p.oV({label:r.default.formatMessage(f.joinTeamSuccessMessage,{teamName:i.getName()})}))}async function y(e){let{environment:t,userId:o,teamStore:i}=e;const n=s.default.state.currentUserRootStore,r=i.getSpaceId();if(!r||!n)return;const a=n.getSpaceViewStores().filter((e=>e.getSpaceId()===r))[0];await u.y3({environment:t,spaceViewStore:a,userSettingsStore:void 0,userRootStore:n}),await h.I({environment:t,spaceId:r,userId:o}),m.hI({environment:t,teamStore:i,shouldScroll:!0})}async function b(e){let{environment:t,teamId:o,message:i}=e;if(!t.currentUser.id)return;"success"===(await c.requestAccess(t,{type:"current-actor-to-team",teamId:o,message:i})).type?(l.trackRequestAccessToTeam(t,{teamId:o}),await w({environment:t}),new Promise((e=>setTimeout(e,500))).then((()=>{p.oV({label:r.default.formatMessage(f.requestTeamSuccessMessage)})}))):p.oV({label:r.default.formatMessage(f.requestTeamFailureMessage)})}async function S(e){let{environment:t,teamStore:o,accessRequestStore:i,status:r}=e;const a=i.getForActorId();if(!a)return;const s=i.getRecordModel({table:n.KJ,id:a});if(s){if("approved"===r){const e=[{type:"member",entity_type:"user",user_id:s.id}];if(!(await m.Uj({environment:t,teamStore:o,teamMemberInfos:e,isSettingDefaultTeam:!1,createNewTeamFlowId:void 0})))return}g.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:t,perform:e=>{d.sW({store:i,transaction:e,data:{resolved_time:Date.now(),resolved_by_table:n.KJ,resolved_by_id:t.currentUser.id,status:r}})}}),l.trackResolveTeamAccessRequest(t,{store:o,resolution:r})}}async function w(e){let{environment:t}=e;const{lastVisitedSpaceView:o,userRootStore:i,userSettingsStore:n}=await(0,a.iX)({environment:t,disableRedirectUrl:!1});o?await u.y3({environment:t,spaceViewStore:o,userRootStore:i,userSettingsStore:n}):await u.L5({environment:t,userRootStore:i,userSettingsStore:n})}async function k(e){let{environment:t,teamId:o}=e;const i=await c.getTeamAccessRequestMetadata(t,{teamId:o});if("success"===i.type)return i.data}},89971:(e,t,o)=>{o.d(t,{k7:()=>a,RW:()=>s,oO:()=>l});var i=o(15157),n=o(70704),r=o(50906);function a(e){const{environment:t,spaceViewStore:o,teamStore:n,outlinerToggleButtonStore:a,newIsHidden:l,shouldPersistToggleState:c,isExplicitUserAction:d}=e;a.setState({...a.state,isHidden:l}),d&&r.trackOutlinerTeamToggle(t,{store:n,is_toggled:!l,outliner_type:e.teamOutlinerType}),c&&i.Z.set({userId:o.environment.currentUser.id,key:s(o,n.id),value:l})}function s(e,t){return`Team_Outliner_Item_${e.id}:${t}`}function l(e){let{oldState:t,teamIds:o,spaceId:r,userId:a}=e;return o.reduce(((e,o)=>{if(o in e)return e;if(o in t)return e[o]=t[o],e;const l=s({id:r},o),c=i.Z.get({userId:a,key:l});return e[o]=new n.Z,e[o].setState({isHidden:c??!1}),e}),{})}},94507:(e,t,o)=>{o.d(t,{I:()=>l,m:()=>c});var i=o(96486),n=o.n(i),r=o(54642),a=o(23537),s=o(61464);async function l(e){let{environment:t,spaceId:o,userId:i}=e;if(!t.currentUser.loggedInUserIds.includes(i))throw new Error("Must be logged in user.");(0,a.bq)()&&(s.Z.getUserJoinedTeamsState({userId:i,spaceId:o})||await c({environment:t,spaceId:o,userId:i}))}async function c(e){var t;let{environment:o,spaceId:i,userId:a,emitValue:l}=e;if(!o.currentUser.loggedInUserIds.includes(a))throw new Error("Must be logged in user.");s.Z.setHasFetched({userId:a,spaceId:i});const c=await r.getTeams(o,{spaceId:i,onlyJoined:!0},a);if("failed"===c.type)return;const d=c.data.teamIds,p=(null===(t=s.Z.getUserJoinedTeamsState({userId:a,spaceId:i}))||void 0===t?void 0:t.joinedTeamsIds)||[];d.length===p.length&&0===n().difference(d,p).length&&0===n().difference(p,d).length||s.Z.setUserJoinedTeamsState({userId:a,spaceId:i,state:{joinedTeamsIds:d,lastEmitValue:l}})}},59389:(e,t,o)=>{o.d(t,{eV:()=>g,T_:()=>h,Ud:()=>f});var i=o(1302),n=o(42),r=o(58202),a=o(50906),s=o(41433),l=o(96802),c=o(94419),d=o(9953),p=o(24677),u=o(98104),m=o(63113);function g(e){const{environment:t,store:o,transaction:n,preventTextSelection:r}=e,s=d.j4({environment:t,type:"text",inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,spaceId:o.pointer.spaceId}),l=c.R3({parent:o.getContentStore(),append:s,transaction:n}).child;return r||i.default.afterNextFlush((()=>{p.eP({environment:t,store:l}),u.N_({store:l.getBlockTitleStore()})})),a.trackCreateBlock(t,{from:"template_picker",type:"text"}),l}function h(e){const{environment:t,store:o,transaction:i}=e;l.is({store:o,transaction:i}),g({environment:t,store:o,transaction:i})}function f(e){var t;const{environment:o,store:l,viewType:c,transaction:p}=e,u=null===(t=l.getBlockTitleStore())||void 0===t?void 0:t.getValue();s.ZI({environment:o,sourceBlockId:"root",targetBlockPointer:l.pointer,sourceBlockSubtree:(0,n.iC)({isInline:!1,viewType:c}),targetRecordCache:l.inMemoryRecordCache,transaction:p,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0}),m.vs({environment:o,block:l,blockType:"collection_view_page",transaction:p}),u&&d.sO({store:l.getBlockTitleStore(),value:u,transaction:p}),i.default.afterNextFlush((()=>{const e=r.R.findCollectionViewBlockFromStore(l);null==e||e.handleCreated()})),a.trackCreateBlock(o,{from:"template_picker",type:"collection_view_page"})}},993:(e,t,o)=>{o.d(t,{pz:()=>ce,pe:()=>de,N3:()=>pe,hJ:()=>ue,mM:()=>me,sO:()=>ge,MY:()=>he,i8:()=>fe,Du:()=>ve,QT:()=>ye,Be:()=>be,Rx:()=>Se,OR:()=>we,n2:()=>ke,fs:()=>Ce,YV:()=>_e,aS:()=>Me,lZ:()=>Te,Q0:()=>Ie,wA:()=>Pe,O5:()=>xe,AE:()=>Be,VO:()=>Ze,ON:()=>Ee,Nh:()=>Re,Zl:()=>Ae,gy:()=>Fe});var i=o(96486),n=o.n(i),r=o(1302),a=o(1800),s=o(15095),l=o(64572),c=o(98459),d=o(80984),p=o(21202),u=o(70279),m=o(33709),g=o(70203),h=o(39721),f=o(64002),v=o(95182),y=o(54564),b=o(67133),S=o(5978),w=o(95477),k=o(14976),C=o(73744),_=o(84210),M=o(68056),T=o(45162),I=o(98165),P=o(65598),x=o(33665),B=o(69645),Z=o(73959),E=o(60846),R=o(72133),A=o(89086),D=o(35328),F=o(89574),L=o(95802),V=o(24229),N=o(66949),O=o(10161),U=o(88923),H=o(81236),z=o(3815),W=o(27724),j=o(24666),K=o(45131),Y=o(50906),G=o(6404),X=o(96514),q=o(4727),$=o(36280),J=o(44886),Q=o(88295),ee=o(47798),te=o(9953),oe=o(61045),ie=o(24677),ne=o(84084),re=o(22110),ae=o(98104),se=o(25103),le=o(30149);function ce(e){const{multiSelection:t,environment:o,transaction:i}=e,n=(0,T.L5)(t);if(0===n.length)return;if(1===n.length){const{store:e,selection:t}=n[0];return de({environment:o,transaction:i,store:e,selection:t})}const r=(0,T.Nj)({multiSelection:t,includeNonSelectable:!1});if(!r)return;const{treeRange:a}=r;for(const p of a.iterateDeletion())(0,B.D_)({transaction:i,treeOperation:p,deleteFrom:"record-store-parent"});const{start:s,end:l}=t;de({environment:o,transaction:i,selection:{startIndex:s.index,endIndex:1/0},store:s.store});const c=Se({environment:o,transaction:i,store:l.store,selection:{startIndex:0,endIndex:l.index}}),d=(0,A.x0)(s.store);d&&we({environment:o,store:s.store,selection:d,deleteAfterSelectionResult:c,transaction:i}),ae.Z5({store:s.store,selection:d}),ie.eP({environment:o,store:a.start.value.store})}function de(e){const{environment:t,store:o,selection:i,transaction:n}=e;if(i.startIndex!==i.endIndex){const e=o.getValue(),r=g.vY(e,i.startIndex,i.endIndex);ge({environment:t,store:o,value:r,transaction:n});const a={startIndex:i.startIndex,endIndex:i.startIndex};ae.Z5({store:o,selection:a});const s=o.getRecordStoreAtRootPath();De({environment:t,store:o,oldTextValue:e,newTextValue:r,transaction:n,rootStore:s})}else ae.Z5({store:o,selection:i})}function pe(e){const t=j.default.state;if("editing"!==t.mode)return;if((0,M.iG)(t.multiSelection))return;const{start:o,end:i}=t.multiSelection,n="start"===e.direction?o:i;j.default.setState({...t,multiSelection:{start:n,end:n}})}function ue(e){const{environment:t,disableMentions:o,disableDateMentions:i,disableDateReminderMentions:n,disableSlashCommands:r,disableEmojiCommands:a,disableFilters:l,string:c,transaction:d,selectAll:p}=e;if("editing"!==j.default.state.mode)return;const u=g.vJ(c),m=s.p4(u).length,h="multiSelection"in e?e.multiSelection:(0,M.TD)(e);let f;const v=(0,M.QY)(h);if(f=v?{canRestore:!0,oldSelection:v,toTextValue:v.store.getValue()}:{canRestore:!1},ce({environment:t,multiSelection:h,transaction:d}),0===m)return;const y=(0,A.bj)(),b=g.V3(u,y),S=h.start.store.getValue(),w=g.P$(S,[b],h.start.index);ge({environment:t,store:h.start.store,value:w,transaction:d});const k={startIndex:p?h.start.index:h.start.index+m,endIndex:h.start.index+m};ae.Z5({store:h.start.store,selection:k}),l||re.f({environment:t,store:h.start.store,transaction:d}),f.canRestore&&(o||ee._P({environment:t,textStore:f.oldSelection.store,oldSelection:f.oldSelection.selection,oldTextValue:f.toTextValue,disableDateMentions:i,disableDateReminderMentions:i||Boolean(n)}),r||ne._P({environment:t,textStore:f.oldSelection.store,oldSelection:f.oldSelection.selection,oldTextValue:f.toTextValue}),a||q._P({environment:t,textStore:f.oldSelection.store,oldSelection:f.oldSelection.selection,oldTextValue:f.toTextValue}))}function me(e){const{environment:t,store:o,index:i,transaction:r,selectAll:a}=e,s=e.tokens.map(g.Y_),l=o.getValue()||[];ge({environment:t,store:o,value:g.P$(l,s,i),transaction:r});const c=o.getRecordStoreAtRootPath();if("block"===c.table){const e=c,t=n().without(g.ll(s),...g.ll(l));for(const o of t){const t=P.x8(e);le.applyOperation({transaction:r,store:t,operation:{pointer:t.pointer,path:t.path,command:"listAfter",args:{id:o,after:void 0}}})}}const d=g.ee(s).length;ae.Z5({store:o,selection:{startIndex:a?i:i+d,endIndex:i+d}})}function ge(e){const{environment:t,store:o,value:i,transaction:n}=e;if(te.sO({store:o,transaction:n,value:g.Zx(i)}),o.isTable("block")){const e=o.getRecordStoreAtRootPath().getValue();e&&Y.trackEditBlockText(t,{user_action:n.getUserActionForAnalyticsPurposesOnly(),block_id:e.id,type:e.type,is_toggleable:(0,D._A)(e.type,e.format)})}}function he(e){const{environment:t,multiSelection:o,annotation:i,transaction:n}=e,r=i,a=g.J7(r),s=(0,T.L5)(o),l=Boolean((0,A.a6)(a,o,{}));s.forEach((e=>{let{store:o,selection:i}=e;const s=o.getValue();if(!s)return;const c=g.Ul(s,i),{tokensInsideRange:d}=g.xr(s,c.startIndex,c.endIndex),p=g.VP(d,(e=>g.J7(e)!==a)),u=l?p:p.map((e=>g.V3(g.Wi(e),[...g.hD(e),r]))),m=g.vY(s,c.startIndex,c.endIndex),h=g.P$(m,u,c.startIndex);ge({environment:t,store:o,value:h,transaction:n})}))}function fe(e){const{environment:t,store:o,selection:i,annotation:n,transaction:r}=e;he({environment:t,annotation:n,transaction:r,multiSelection:(0,M.TD)({store:o,selection:i})})}function ve(e){const{environment:t,blocks:o,annotation:i,transaction:r}=e,a=g.J7(i),s=n().compact(o.map((e=>{const t=e.getTitleStore();if(!t)return;const o=t.getValue();return o?{block:e,titleStore:t,titleValue:o}:void 0}))),l=s.every((e=>{let{titleValue:t}=e;return t.every((e=>g.hD(e).some((e=>g.J7(e)===a))))}));for(const{titleValue:n,titleStore:c}of s)ye({environment:t,annotation:i,textStore:c,textValue:n,action:l?"removeAnnotationType":"annotate",transaction:r})}function ye(e){const{environment:t,annotation:o,transaction:i,textStore:n,textValue:r,action:a}=e,s=g.J7(o);ge({environment:t,store:n,value:r.map((e=>{const t=g.Wi(e),i=g.hD(e).filter((e=>g.J7(e)!==s));return"annotate"===a&&i.push(o),g.V3(t,i)})),transaction:i})}function be(e){const{environment:t,store:o,selection:i,type:n,transaction:r}=e,a=o.getValue();if(a){const{tokensInsideRange:e}=g.xr(a,i.startIndex,i.endIndex),s=e.map((e=>{const t=g.hD(e),o=g.Wi(e),i=t.filter((e=>g.J7(e)!==n));return g.V3(o,i)})),l=g.vY(a,i.startIndex,i.endIndex),c=g.P$(l,s,i.startIndex);ge({environment:t,store:o,value:c,transaction:r}),ae.Z5({store:o,selection:i});const d=o.getRecordStoreAtRootPath();De({environment:t,store:o,oldTextValue:a,newTextValue:c,transaction:r,rootStore:d})}}function Se(e){const{environment:t,transaction:o}=e,i="multiSelection"in e?e.multiSelection.end.store:e.store,n="multiSelection"in e?e.multiSelection.end.index:e.selection.endIndex,r=g.lz(i.getValue()),a=g.Q(r).length,{tokensInsideRange:s}=g.xr(r,n,a);return s.length>0&&de({environment:t,store:i,selection:{startIndex:n,endIndex:a},transaction:o}),{store:i,tokens:s}}function we(e){const{environment:t,store:o,selection:i,deleteAfterSelectionResult:n,transaction:r}=e;me({environment:t,store:o,tokens:n.tokens,index:i.startIndex,transaction:r})}function ke(e){const{environment:t,closestSelectable:o,shiftKey:i,transaction:n}=e;if((0,T.Aw)(t))return void function(e){const{transaction:t}=e,o=j.default.state;if("editing"!==o.mode)return;const{multiSelection:i}=o,n=(0,T.Nj)({multiSelection:i,includeNonSelectable:!0});if(!n)return;const{tree:a,treeRange:s}=n,l=a.value.store,c=h.o.getIndentOperationsFromTreeRange(s,e.direction);for(const r of c){const{target:e,operation:o}=r,i=(0,B.kC)({rootStore:l,root:a,target:e});if(void 0===i)throw new Error("Cannot find node to indent");let n=!1;switch(o){case"indentSelf":case"indentSelfAndSubtree":if(i.length>=2){const e=i[i.length-2],r=i[i.length-1];if(r){let i="indentSelf"===o?"self":"subtree";(0,D.BX)(r)&&!K.Z.isOpen(r.id)&&(i="subtree");void 0!==J.dD({block:r,parentStore:e,transaction:t,type:i})&&(n=!0)}}break;case"unindentSelfAndUpdateSiblings":if(i.length>=3){const e=i[i.length-3],o=i[i.length-2],r=i[i.length-1];if(o&&r){void 0!==J.uv({block:r,parentStore:o,grandparentStore:e,transaction:t})&&(n=!0)}}}n&&h.F.applyMutable(a,r)}r.default.afterNextFlush((()=>{const e=(0,B.kC)({rootStore:l,root:a,target:s.start}),t=(0,B.kC)({rootStore:l,root:a,target:s.end}),o=e&&(0,Z.mh)(e[e.length-1]),n=t&&(0,Z.mh)(t[t.length-1]);if(o&&n){const e={start:{store:o,index:i.start.index},end:{store:n,index:i.end.index}};ae.NA({multiSelection:e})}}))}({environment:t,transaction:n,direction:e.shiftKey?"unindent":"indent"});const a=i?J.rB({environment:t,blocks:[o],transaction:n}):J.WY({environment:t,blocks:[o],transaction:n});if(!a)return;const s=j.default.state;if("editing"===s.mode){var l;const e=null===(l=(0,T.xI)("textActions",s.multiSelection))||void 0===l?void 0:l.selection;if(!e)return;r.default.afterNextFlush((()=>{const i=L.C.findSelectableFromStore(a[0]);if(ie.wI({store:o,replace:a[0]}),i){const o=(0,Z.mh)(i.props.store);o?ae.Z5({store:o,selection:e}):ie.$Y({environment:t,phase:W.SelectionPhase.Selected})}}))}}function Ce(e){const{transaction:t,direction:o}=e,i=j.default.state;if("editing"!==i.mode)return;const{multiSelection:n}=i,a=(0,T.tp)({multiSelection:n,filterCommonAncestors:!0,focus:void 0});if(!a)return;const s=a.stores;("up"===o?J.A1({transaction:t,blocks:s}):J.vi({transaction:t,blocks:s}))&&r.default.afterNextFlush((()=>{const[e,t]=L.C.findSelectablesFromIds([n.start.store.id,n.end.store.id]),o=(null==e?void 0:e.props.store)&&(0,Z.mh)(null==e?void 0:e.props.store),i=(null==t?void 0:t.props.store)&&(0,Z.mh)(null==t?void 0:t.props.store);o&&i&&(ae.NA({multiSelection:{start:{store:o,index:n.start.index},end:{store:i,index:n.end.index}},forceEmit:!0}),oe.Zv())}))}function _e(e){const{transaction:t,environment:o,multiSelection:i}=e;i&&!(0,M.qS)(i)&&ce({environment:o,transaction:t,multiSelection:i}),Me({...e,usingMultiSelection:!0})}function Me(e){const{environment:t,store:o,newValue:i,disableMentions:n,disableDateMentions:r,disableSlashCommands:a,disableEmojiCommands:l,disableDateReminderMentions:c,disableFilters:d,transaction:p,usingMultiSelection:u}=e,m=o.getValue(),h=g.Q(m),f=E.UZ(h,i),v=j.default.state;if("editing"!==v.mode)return;const y=v.multiSelection.start.index;let b=0;for(let g=0;g<f.length;g++){const e=f[g];if(b+s.p4(e[1]).length>y){if(e[0]===E.JZ){const t=f[g-1],o=f[g+1];let i=f[g-2],n=f[g+2];if(o&&o[0]===E.D$)for(n||(n=[E.JZ,""],f.push(n));b+s.p4(e[1]).length>y&&e[1].endsWith(o[1]);)e[1]=e[1].slice(0,e[1].length-o[1].length),n[1]=o[1]+n[1];else if(t&&t[0]===E.D$)for(i||(i=[E.JZ,""],f.unshift(i));b+s.p4(e[1]).length>y&&e[1].startsWith(t[1]);)e[1]=e[1].slice(t[1].length),i[1]=i[1]+t[1],b-=s.p4(t[1]).length}break}b+=s.p4(e[1]).length}let S=!1,w=!1,C=0;for(const[k,_]of f)if(k===E.D$)S=!0,ue({environment:t,store:o,selection:{startIndex:C,endIndex:C},string:_,disableMentions:n,disableDateMentions:r,disableDateReminderMentions:c,disableSlashCommands:a,disableEmojiCommands:l,disableFilters:d,transaction:p}),C+=s.p4(_).length;else if(k===E.NL){S=!0,w=_===g.qy;de({environment:t,store:o,selection:{startIndex:C,endIndex:C+s.p4(_).length},transaction:p})}else k===E.JZ&&(C+=s.p4(_).length);if(S&&!w&&!t.TextSelectionCompositionStore.state.isComposing)if(u){const e=R.get(),t=(0,T.fx)({range:e,contentEditableLeafRegistry:void 0,allowInvisibleEndSelection:!0});t&&ae.NA(t)}else{const e=k.Ut(t);e&&(ae.Z5({store:o,selection:e.selection}),e.forceEmitSelectionStore&&j.default.emit())}}function Te(e){const{environment:t,store:o,selection:i,annotation:n,analyticsFrom:r,transaction:a}=e;de({environment:t,store:o,selection:i,transaction:a});const s=(0,A.yj)(i,o),l=[g.YC(n,s),g.V3(" ",s)];if(me({environment:t,store:o,tokens:l,index:i.startIndex,transaction:a}),ae.Z5({store:o,selection:{startIndex:i.startIndex+l.length,endIndex:i.startIndex+l.length}}),g.IW(n)&&(o.isTable("block")||o.isTable("comment"))){const e=t.currentUser.id,i=g.zE(n),a=o.getRecordStoreAtRootPath();e&&Y.trackMentionUser(t,{is_current_user:i===e,user_id:i,from:r,block_type:"block"===a.table?a.getKeyStore("type").getValue():void 0})}else if(g._b(n)&&(o.isTable("block")||o.isTable("comment"))){var c;const e=null===(c=g.kx(n))||void 0===c?void 0:c.groupId,i=o.getRecordStoreAtRootPath();e&&Y.trackMentionGroup(t,{group_id:e,from:r,block_type:"block"===i.table?i.getKeyStore("type").getValue():void 0})}else if(g.fp(n)&&(o.isTable("block")||o.isTable("comment"))){const e=g.Ot(n),i=o.getRecordStoreAtRootPath();Y.trackMentionDate(t,{date:e,from:r,block_type:"block"===i.table?i.getKeyStore("type").getValue():void 0})}else if(g.ST(n)&&(o.isTable("block")||o.isTable("comment"))){const e=g.TO(n),i=o.getRecordStoreAtRootPath();Y.trackMentionPage(t,{page_id:e,from:r,block_type:"block"===i.table?i.getKeyStore("type").getValue():void 0})}}function Ie(e){const{environment:t,store:o,selection:i,emoji:n,transaction:r}=e;de({environment:t,store:o,selection:i,transaction:r});const a=[g.V3(n)];me({environment:t,store:o,tokens:a,index:i.startIndex,transaction:r}),ae.Z5({store:o,selection:{startIndex:i.startIndex+a.length,endIndex:i.startIndex+a.length}})}function Pe(e){const{environment:t,shouldStripTokens:o,store:i,selection:r,transaction:a}=e,l=(0,A.fM)(i,r,o),c=o?g.Jc(i.getValue()):g.Q(i.getValue());let d=s.p4(c),p=0;for(const s of l)if(p++,0===s)d.unshift("\t");else{const e=s+p;d=[...n().slice(d,0,e),"\t",...n().slice(d,e)]}Me({environment:t,store:i,newValue:g.vJ(d.join("")),disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:a}),ae.Z5({store:i,selection:{startIndex:r.startIndex+1,endIndex:r.endIndex+p}})}function xe(e){const{environment:t,shouldStripTokens:o,store:i,selection:r,transaction:a}=e,l=(0,A.fM)(i,r,o),c=o?g.Jc(i.getValue()):g.Q(i.getValue());let d=s.p4(c),p=0,u=0;for(const s of l){const e=s-p;0===e?"\t"===d[0]?(d=n().slice(d,1),p+=1):" "===d[0]&&" "===d[1]?(d=n().slice(d,2),p+=2):" "===d[0]&&(d=n().slice(d,1),p+=1):"\t"===d[e+1]?(d=[...n().slice(d,0,e+1),...n().slice(d,e+2)],p+=1):" "===d[e+1]&&" "===d[e+2]?(d=[...n().slice(d,0,e+1),...n().slice(d,e+3)],p+=2):" "===d[e+1]&&(d=[...n().slice(d,0,e+1),...n().slice(d,e+2)],p+=1),s<=r.startIndex&&(u=p)}Me({environment:t,store:i,newValue:g.vJ(d.join("")),disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:a}),ae.Z5({store:i,selection:{startIndex:r.startIndex-u,endIndex:r.endIndex-p}})}function Be(e){const{token:t,store:o,readOnly:i}=e;let n=0,r=0;if(t.textValue){let e=0;for(;e<t.tokenIndex;)n+=g.J1(t.textValue[e]),e++;r=n+g.J1(t.textValue[e])}ae.Z5({store:o,selection:{startIndex:n,endIndex:r},readOnly:i})}function Ze(e){const{environment:t,event:o,interactiveToken:i,store:n,parentStore:s,canEdit:l}=e,h=g.hD(i.textToken),v=g.rl(h),k=g.wP(h),T=g.V8(h),B=g.zr(h).map((e=>g.h1(e)));if(g.Yr(i.textToken)&&!o.shiftKey&&!o.altKey){if(o.preventDefault(),N.Z.state.open)$.Wj();else{const e=i.textToken,o=document.createRange(),a=i.node.parentNode,s=i.tokenIndex+1;o.setStart(a,i.tokenIndex),o.setEnd(a,s),R.set(o,t.device),ae.dd({store:n}),r.default.afterNextFlush((()=>{if("editing"!==j.default.state.mode)return;const o=(0,M.QY)(j.default.state.multiSelection);o&&$.qn({environment:t,selectedToken:{token:e,position:o.selection},selectionRect:i.node.getBoundingClientRect(),analyticsFrom:"click_token"})}))}return}const E=B.map((e=>{const t=s||n;return z.t1.createChildStore(t,{table:m.qF,id:e,spaceId:(0,c.CG)(t.pointer.spaceId)})})),{unresolved:A}=P.bB(E);if(A.length>0){const e=Boolean(v||T),i=V.Z.state.open||t.device.isMobile,r=(0,Z.sQ)(n);if(e&&i)y.LZ();else if(r){const n=o.target&&o.target.getBoundingClientRect();if(y.Ib({environment:t,blockStore:r,analyticsFrom:"existing_comment",discussionIds:A.map((e=>e.id)),rect:n,shouldFocusDiscussion:!1,recursivelyLoadAllDiscussions:!1}),e&&!i)return void o.preventDefault()}}else F.Z.find((e=>e.isEditing()))||y.LZ();let D;if(v&&(D=f.Nm({str:g.zW(v),allowNoProtocol:!0})),T){const e=g.TO(T),i=z.G.createChildStore(s||n,{table:p.iU,id:e}),r=O.default.checkGate("side_peek_anywhere")&&(o.altKey||U.default.isSidePeekOpen())&&!o.metaKey;D=(0,_.ZP)({store:i,openInSidePeek:r,preferPublicLink:(0,x.Sr)(),getSpaceDomain:()=>{var e;return null===(e=H.Z.getPublicSpaceData(t,i.getSpaceId()))||void 0===e?void 0:e.domain}})}if(D){o.preventDefault(),ae.ZH(t),se.l();const{device:e}=t;e.isIOS&&ae.sD();if("page"===(0,d.Wj)({url:D,baseUrl:w.Z.domainBaseUrl,publicDomainName:w.Z.publicDomainName,isMobile:t.device.isMobile,protocol:w.Z.protocol,currentUrl:ncd.href()}).name){const e=C.DJ(o);S.navigate({environment:t,url:D,openInNew:e})}else S.navigateToExternalURL({environment:t,url:D})}else{if(l){const{textToken:e,node:r,tokenIndex:a}=i,s=g.hD(e);if(g.K9(s))return se.l(),b.b(t,{originRect:r.getBoundingClientRect(),textStore:n,tokenIndex:a,allowReminders:"comment"!==n.table}),void o.preventDefault()}if(k){const e=(0,z.Kv)(n,{table:u.x_,id:k[1],spaceId:k[2]}),i=e.getValue();if(!i)return;const r=I.Dg(e);if(!r)return;const s=(0,z.Kv)(r,{table:i.parent_table,id:i.parent_id,spaceId:i.space_id}).getValue();if(!s)return;const l=(0,a.Z)({pageId:r.id,scrollToBlockId:null==s?void 0:s.parent_id,pageModel:r.getModel(),baseUrl:void 0,discussionId:s.id});o.preventDefault(),S.navigate({environment:t,url:l})}}}function Ee(e){const{environment:t,event:o,interactiveToken:i,store:n,parentStore:r}=e;if(!r)return;const a=g.hD(i.textToken),s=g.V8(a);if(s){const e=g.yr(s);if(!e)return;const i=z.G.createChildStore(r||n,e);o.preventDefault(),G.Qn({environment:t,stores:[i],left:o.clientX,top:o.clientY,showInput:!1,actions:v.yT,analyticsFrom:"page_mention_block_menu",pageAnnotationToken:{parentStore:r,pageAnnotation:s}})}}function Re(e){se.H({token:e.interactiveToken,store:e.store})}function Ae(e){se.l()}function De(e){const{store:t,environment:o,oldTextValue:i,newTextValue:r,transaction:a,rootStore:s}=e;if(s.isTable(p.iU)){const e=s.getValue();if(e){const n=(0,l.m3)({parentBlock:e,oldTextValue:i,newTextValue:r,getRecordValue:t.getRecordValue,baseUrl:w.Z.domainBaseUrl,publicDomainName:w.Z.publicDomainName});Q.lP({environment:o,transaction:a,parentStore:s,inlinePageIds:n})}}if(P.NZ(s)){const e=new Set(n().without(g.ll(i),...g.ll(r)));for(const t of e){const e=z.t1.createChildStore(s,{table:m.qF,id:t,spaceId:(0,c.CG)(s.pointer.spaceId)});X.Gu({discussionStore:e,blockStore:s,transaction:a})}}const d=n().without(g.zU(i),...g.zU(r));for(const n of d){const e=z.G.createChildStore(s,{table:p.iU,id:n,spaceId:(0,c.CG)(s.pointer.spaceId)});te.sW({store:e,data:{alive:!1},transaction:a})}}function Fe(e){const{block:t,transaction:o,tokenIndex:i}=e,n=t.getBlockTitleStore(),r=t.getTitleStore();if(!n.isDefined()||!r||!n.getValue()||n.getValue().length<i)return!1;const a=n.getValue(),s=g.tT(a.slice(0,i),a.slice(i+1));return te.sO({store:r,value:s,transaction:o}),!0}},98724:(e,t,o)=>{o.d(t,{aS:()=>h,mX:()=>f,V$:()=>v,bt:()=>y});var i=o(96486),n=o.n(i),r=o(70203),a=o(63143),s=o(46888),l=o(45162),c=o(89086),d=o(24666),p=o(9953),u=o(993),m=o(98104),g=o(30149);function h(e){const{environment:t,annotation:o}=e,i=d.default.state;if("editing"!==i.mode)return;if(d.default.isEmptySelection())return void m.Km({annotation:o});const{multiSelection:n}=i;(0,l.L5)(n).length>0&&(g.createAndCommit({userAction:"textAnnotationActions.annotateSelection",environment:t,perform:e=>{u.MY({environment:t,annotation:o,multiSelection:n,transaction:e})}}),m.NA({multiSelection:n}))}function f(e){const{environment:t,annotationType:o}=e,i=d.default.state;if("editing"!==i.mode)return;if(d.default.isEmptySelection())return;const{multiSelection:n}=i,r=(0,l.L5)(n);r.length>0&&(g.createAndCommit({userAction:"textAnnotationActions.unannotateSelection",environment:t,perform:e=>{for(const{selection:i,store:n}of r)u.Be({environment:t,store:n,type:o,selection:i,transaction:e})}}),m.NA({multiSelection:n}))}function v(e){const{environment:t,annotationType:o,blocks:i,transaction:n}=e;for(const r of(0,s.V)(i)){const e=(0,c.P2)(r);e&&u.Be({environment:t,store:r,type:o,selection:e,transaction:n})}}function y(e){const{store:t,context:o,transaction:i}=e;if(!t.canEdit())return;const s=(0,a.m8)(n().compact(Object.entries(t.getProperties()).map((e=>{let[t,i]=e;if(!i)return;const a=i.map((e=>r.sB(e,o)));return n().isEqual(i,a)?void 0:[t,a]}))));n().isEmpty(s)||p.sW({store:t.getPropertiesStore(),data:s,transaction:i})}},56971:(e,t,o)=>{o.d(t,{ew:()=>C,as:()=>_,YV:()=>M});var i=o(96486),n=o.n(i),r=o(1302),a=o(41432),s=o(68056),l=o(73959),c=o(89086),d=o(35328),p=o(28685),u=o(95802),m=o(10161),g=o(24666),h=o(96802),f=o(44886),v=o(94419),y=o(42858),b=o(24677),S=o(993),w=o(98104),k=o(63113);function C(e){const{environment:t,store:o,transaction:i}=e;i.annotateWithUserAction("textBackspaceActions.annotatedContentBlockBackspaceAtBeginning");const n=(0,l.sQ)(o);if(n){"callout"===n.getType()&&h.FH({stores:[n],update:{block_color:void 0},transaction:i});let e=n,o=a.Ti.text;if(d.fn(n)){const e=n.getType();e&&(o=e)}e=k.vs({environment:t,block:n,blockType:o,transaction:i}),r.default.afterNextFlush((()=>{const o=u.C.findEditableStoreWithin(e);o&&(w.N_({store:o}),b.eP({environment:t,store:e}))}))}return o}function _(e){const{environment:t,multiSelection:o,transaction:i,deleteForwards:k,event:_}=e,M=t.device.isApple&&_.metaKey,T=!(t.device.isIOS&&(0,s.iG)(o));w.aJ();const I=(0,s.QY)(o);if(I&&0===I.selection.startIndex&&0===I.selection.endIndex&&!k){const{store:e,selection:o}=I;_.preventDefault();const s=(0,l.sQ)(e);if(s){const g=s.getModel();if(g){const s=g.isType(a.q7);s&&!M?C({environment:t,store:e,transaction:i}):g.isType(a.Q3)||s&&M?function(e){const{store:t,selection:o,transaction:i,environment:a}=e;i.annotateWithUserAction("textBackspaceActions.textBackspaceAtBeginning");const s=(0,l.sQ)(t);if(!s)return;const g=(0,l.sQ)(s),k=g&&(0,l.sQ)(g);if(g&&k){const e=g.getRenderableContentIds()??[];if(!(n().last(e)!==s.id||g.isTransclusionType()||d.BX(g)&&n().first(e)===s.id||"tab"===k.getType())){const e=f.uv({block:s,parentStore:g,grandparentStore:k,transaction:i});if(e)return void r.default.afterNextFlush((()=>{if(e){const t=u.C.findEditableStoreWithin(e);t&&(b.eP({environment:a,store:e}),w.N_({store:t}))}}))}}if(m.default.checkGate("text_align")){if("center"===s.getFormat().block_alignment)return void h.hc({environment:a,store:s,alignment:"left",transaction:i});if("right"===s.getFormat().block_alignment)return void h.hc({environment:a,store:s,alignment:"center",transaction:i})}const C=p.E.getMembersByDOMOrder({filter:e=>!e.props.store.inMemoryRecordCache.isMockTextStore}),_=n().findIndex(C,(e=>e.props.store===t)),M=n().findLast(C,((e,t)=>t<_&&e.props.canInsertText));let T;if(M&&(T=M.props.store),T&&s){const e=S.Rx({environment:a,store:t,selection:o,transaction:i}),n=(0,c.x0)(T);n&&S.OR({environment:a,store:T,selection:n,deleteAfterSelectionResult:e,transaction:i}),w.Z5({store:T,selection:n});const r=(0,l.sQ)(T);if(b.eP({environment:a,store:r}),!d.BX(s)&&g){const e=s.getContentStores();for(const n of e)v.Vt({parent:g.getContentStore(),before:s,insert:n,transaction:i});const t=s.getContentStore(),o=s.getContentStores();for(const n of o)v.Od({parent:t,childToRemove:n,transaction:i})}y.Od({store:s,transaction:i})}}({environment:t,store:e,selection:o,transaction:i}):g.isType(a.oe)&&function(e){const{environment:t,store:o,selection:i,transaction:r}=e;r.annotateWithUserAction("textBackspaceActions.captionBackspaceAtBeginning");const a=p.E.getMembersByDOMOrder({filter:()=>!0}),s=n().findIndex(a,(e=>e.props.store===o)),d=n().findLast(a,((e,t)=>t<s&&e.props.canInsertText));let u;d&&(u=d.props.store);const m=(0,l.sQ)(o);if(u&&m){const e=S.Rx({environment:t,store:o,selection:i,transaction:r}),n=(0,c.x0)(u);n&&S.OR({environment:t,store:u,selection:n,deleteAfterSelectionResult:e,transaction:r}),w.Z5({store:u,selection:n});const a=(0,l.sQ)(u);b.eP({environment:t,store:a})}}({environment:t,store:e,selection:o,transaction:i})}}}else I&&(0,c.J_)(I.store,I.selection)&&k?(_.preventDefault(),function(e){const{environment:t,store:o,transaction:i}=e;i.annotateWithUserAction("textBackspaceActions.textDeleteAtEnd");const r=p.E.getMembersByDOMOrder({filter:()=>!0}),a=n().findIndex(r,(e=>e.props.store===o)),s=r.find(((e,t)=>Boolean(t>a&&e.props.canInsertText)));let d;if(s&&(d=s.props.store),(0,l.sQ)(o)&&d){const e="readOnly"===g.default.state.mode,n="empty"!==g.default.state.mode&&g.default.state.multiSelection,r=S.Rx({environment:t,store:d,selection:{startIndex:0,endIndex:0},transaction:i}),a=(0,c.x0)(o);a&&S.OR({environment:t,store:o,selection:a,deleteAfterSelectionResult:r,transaction:i});const s=(0,l.sQ)(d);if(s){const t=(0,l.sQ)(s);if(t){const e=s.getContentStore(),o=s.getContentStores();for(const n of o)v.Od({parent:e,childToRemove:n,transaction:i}),v.Vt({parent:t.getContentStore(),before:s,insert:n,transaction:i})}y.Od({store:s,transaction:i}),n&&w.NA({multiSelection:n,readOnly:e})}}}({environment:t,store:I.store,transaction:i})):T&&(_.preventDefault(),function(e){const{environment:t,multiSelection:o,transaction:i,deleteForwards:n}=e;let r;i.annotateWithUserAction("textBackspaceActions.textBackspaceWithinContent"),r=(0,s.iG)(o)?n?{start:o.start,end:{store:o.start.store,index:o.start.index+1}}:{start:{store:o.start.store,index:o.start.index-1},end:o.start}:o,S.pz({environment:t,multiSelection:r,transaction:i})}({environment:t,multiSelection:o,deleteForwards:k,transaction:i}));const P=g.default.state;"editing"===P.mode&&(0,c.ST)(P.multiSelection.start.store.getValue(),P.multiSelection.start.index-1,"c")&&w.aR({annotation:["c"],extend:!0})}function M(e){const{event:t,multiSelection:o,device:i}=e;return(i.isApple&&t.metaKey||!i.isApple&&t.ctrlKey||i.isApple&&t.altKey)&&!(0,c.dQ)(o)}},74284:(e,t,o)=>{o.d(t,{IO:()=>T});var i=o(1302),n=o(41432),r=o(21202),a=o(70203),s=o(68056),l=o(73959),c=o(35328),d=o(10161),p=o(3815),u=o(24666),m=o(45131),g=o(50906),h=o(44886),f=o(94419),v=o(9953),y=o(61045),b=o(24677),S=o(21325),w=o(993),k=o(56971),C=o(98104),_=o(29373);function M(e){const t=(0,l.sQ)(e.store);if(t&&function(e){var t;const o=e.getType();return!!o&&(!!(0,n.he)(o)&&!(e.id!==(null===(t=e.getParentBlockStore())||void 0===t?void 0:t.getRenderableContentIds().at(-1))))}(t)){const o=h.rB({environment:e.environment,blocks:[t],transaction:e.transaction});if(o)return void i.default.afterNextFlush((()=>{const e=o[0].getTitleStore();e&&C.NA({multiSelection:{start:{store:e,index:0},end:{store:e,index:0}}})}))}k.ew(e)}function T(e){const{environment:t,transaction:o,multiSelection:r}=e;S.M_(t)&&((0,l.x7)(r.start.store)?function(e){const{environment:t,transaction:o}=e;let i=e.multiSelection;const r=(0,l.sQ)(i.start.store);if(!r||r.isCollectionView())return;w.pz({environment:t,multiSelection:i,transaction:o});const a=u.default.state;i="editing"===a.mode&&a.multiSelection||i;const s=i.start.store,c=w.Rx({environment:t,multiSelection:i,transaction:o}),d=v.j4({environment:t,type:n.Ti.text,inMemoryRecordCache:s.inMemoryRecordCache,transaction:o,spaceId:r.pointer.spaceId}),p=f.Ce({parent:r.getContentStore(),prepend:d,transaction:o}).child;b.eP({environment:t,store:p});const m=p.getBlockTitleStore();w.OR({environment:t,store:m,selection:{startIndex:0,endIndex:0},deleteAfterSelectionResult:c,transaction:o}),C.N_({store:m}),g.trackCreateBlock(t,{from:"text_enter",type:n.Ti.text})}(e):(0,s.iG)(r)&&function(e){const t=e.getRecordStoreUIParent();return t instanceof p.G&&e&&t.isType(n.q7)&&0===a.Q(t.getTitleValue()).length}(r.start.store)?M({environment:t,transaction:o,store:r.start.store}):function(e){return 0===e.start.index&&(0,s.iG)(e)}(r)&&I(r.start.store)&&P(r.start.store)?function(e){const{environment:t,transaction:o}=e,r=e.multiSelection.start.store,s=(0,l.sQ)(r);if(!s)return;const d=s.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:t}=e;return t(s)})),p=(0,l.sQ)(s);if(!d||!p)return;const u=v.j4({environment:t,type:d.type,inMemoryRecordCache:r.inMemoryRecordCache,transaction:o,spaceId:p.pointer.spaceId}),h={...d,id:u.id,ignore_block_count:void 0};v.sO({store:u,value:h,transaction:o});const S=f.BE({parent:p.getContentStore(),after:s,insert:u,transaction:o}).child;if(I(r)&&s){const e=s.getContentStores(),t=s.getContentStore(),i=u.getContentStore();for(const n of e)f.Od({parent:t,childToRemove:n,transaction:o}),f.R3({parent:i,append:n,transaction:o})}const k=s.getTitleStore();if((0,n.he)(d.type)&&k)w.sO({environment:t,store:k,value:a.TP(""),transaction:o});else{const e={id:d.id,version:d.version,type:n.Ti.text,parent_id:d.parent_id,parent_table:d.parent_table,alive:!0,space_id:d.space_id};v.sO({store:s,value:e,transaction:o})}(0,c.BX)(s)&&_.rd({blockId:u.id,state:m.Z.isOpen(s.id),currentUserId:t.currentUser.id}),b.eP({environment:t,store:S});const M=(0,l.mh)(S);M&&C.N_({store:M}),g.trackCreateBlock(t,{from:"text_enter",type:n.Ti.text}),t.device.isMobile&&i.default.afterNextFlush((()=>y.hQ(t)))}(e):function(e){var t;const{environment:o,transaction:i}=e;let r=e.multiSelection;const a=(0,l.sQ)(r.start.store);if(!a)return;const s=(0,l.sQ)(a);if(!s)return;w.pz(e);const p=u.default.state;r="editing"===p.mode&&p.multiSelection||r;const h=r.start.store,y=w.Rx({environment:o,multiSelection:r,transaction:i}),S=null==a?void 0:a.getType(),k=null==a?void 0:a.getContentLength(),_=null==a?void 0:a.getModel();let M;if(a&&(0,c.BX)(a)&&m.Z.isOpen(a.id))M=n.Ti.text;else if(S&&_&&k>0&&_.isType(n.nH)){M=n.Ti.text;const e=a.getContentStores()[0];if(e){const t=e.getType();e.isDefined()&&t&&n.kC[t]&&(M=t)}}else M=S&&_&&!_.isType(n.Q2)&&I(h)&&P(h)&&"code"!==S?S:n.Ti.text;const T=d.default.checkGate("text_align")?{block_alignment:null==a||null===(t=a.getFormat())||void 0===t?void 0:t.block_alignment}:void 0,x=v.j4({environment:o,type:M,inMemoryRecordCache:h.inMemoryRecordCache,transaction:i,spaceId:s.pointer.spaceId,format:T}),B=s.getRenderableContentIds()||[];let Z,E=!1;if(a&&(0,c.BX)(a)&&m.Z.isOpen(a.id)){const e=a.getContentStore();E=!0,Z=f.Ce({parent:e,prepend:x,transaction:i})}else if(a&&S&&_&&k&&_.isType(n.nH)){const e=a.getContentStore();E=!0,Z=f.Ce({parent:e,prepend:x,transaction:i})}else Z=a&&B.indexOf(a.id)>=0?f.BE({parent:s.getContentStore(),after:a,insert:x,transaction:i}):f.Ce({parent:s.getContentStore(),prepend:x,transaction:i});const R=Z.child;if(I(h)&&S&&!E&&a&&!(0,c.BX)(a)){const e=a.getContentStores(),t=a.getContentStore(),o=R.getContentStore();for(const n of e)f.Od({parent:t,childToRemove:n,transaction:i}),f.R3({parent:o,append:n,transaction:i})}b.eP({environment:o,store:R});const A=R.getBlockTitleStore();w.OR({environment:o,store:A,selection:{startIndex:0,endIndex:0},deleteAfterSelectionResult:y,transaction:i}),C.N_({store:A}),g.trackCreateBlock(o,{from:"text_enter",type:M,is_toggleable:(0,c._A)(M,x.getFormat())})}(e),t.device.isMobile||i.default.afterNextFlush((()=>{y.Zv()})))}function I(e){if(e.table===r.iU){const t=p.G.createChildStore(e,{table:r.iU,id:e.id}).getType();return t&&!(0,n.S9)(t)}return!1}function P(e){if(e.table===r.iU){const t=p.G.createChildStore(e,{table:r.iU,id:e.id}).getModel();return t&&!t.isType(n.oe)&&!t.isType(n.Ok)}return!1}},22110:(e,t,o)=>{o.d(t,{G:()=>U,f:()=>H});var i=o(96486),n=o.n(i),r=o(41432),a=o(15095),s=o(21202),l=o(70203),c=o(40959),d=o(83631);function p(e,t){return a.p4(e.substring(0,t)).length}var u=o(68056),m=o(99445),g=o(35328),h=o(3815),f=o(27724),v=o(24666),y=o(50906),b=o(84908),S=o(96802),w=o(9953),k=o(42858),C=o(24677),_=o(993),M=o(98104),T=o(30149),I=o(63113);function P(e){var t;const{environment:o,store:i,toBlockType:n,matchRegex:s,insertTextAfter:d,transaction:p,postTransformAction:m}=e,b="editing"===v.default.state.mode&&(null===(t=(0,u.QY)(v.default.state.multiSelection))||void 0===t?void 0:t.selection);if(!b)return;const S=a.p4(l.Q(i.getValue())).slice(0,b.endIndex).join(""),T=s.exec(S);if(!T)return;const P=i.getRecordStoreUIParent();if(!(P&&P instanceof h.G))return;const x=P.getType();if(!x)return;if(x!==r.Ti.text&&!r.q7[x])return;const B=n(T);if(void 0===B||B===x)return;let Z=B;P instanceof h.G&&("toggle"===B&&(0,r.zp)(P.getType())?Z=g.m1(x):"toggle"===x&&g.JO(B)&&(Z=g.m1(B)),I.vs({environment:o,block:P,blockType:Z,transaction:p}));const E={startIndex:0,endIndex:T&&a.p4(T[0]).length||0};if(_.pe({environment:o,store:i,selection:E,transaction:p}),d){const e=k.aO({environment:o,selection:f.default.state.stores,createBlockItem:c.Hc[r.Ti.text],analyticsFrom:"text_filter_actions",transaction:p}),t=i.getValue()||[];e&&(w.sO({store:i,value:[],transaction:p}),w.sO({store:e.getBlockTitleStore(),value:t,transaction:p}),C.eP({environment:o,store:e}),M.N_({store:e.getBlockTitleStore()}))}m&&m(T),y.trackTransformTextBlockFilter(o,{type:B})}function x(e){var t,o;const{environment:i,store:n,transaction:r,regex:s,length:c,analyticsType:d,replace:m}=e,g="editing"===v.default.state.mode&&(null===(t=(0,u.QY)(v.default.state.multiSelection))||void 0===t?void 0:t.selection);if(!g)return;const h=n.getValue()||[],f=l.Q(h),b=a.p4(f).slice(0,g.endIndex).join(""),S=s.exec(b);if(!S)return;const w=p(f,S.index),k={startIndex:w,endIndex:w+c},C=n.getValue()||[];if(l.oP(C,k.startIndex,k.endIndex,"c"))return;const M="function"==typeof m?m({match:S,matchIndex:w,textValue:h}):m;if(void 0===M)return;if(_.pe({environment:i,store:n,selection:k,transaction:r}),"editing"!==v.default.state.mode)return;const T=null===(o=(0,u.QY)(v.default.state.multiSelection))||void 0===o?void 0:o.selection;T&&(_.hJ({environment:i,store:n,selection:T,string:M,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:r}),y.trackUnicodeFilter(i,{type:d}))}function B(e){var t;const{environment:o,store:i,delimiter:n,annotation:r,transaction:s}=e,c="editing"===v.default.state.mode&&(null===(t=(0,u.QY)(v.default.state.multiSelection))||void 0===t?void 0:t.selection);if(!c)return;const d=i.getValue(),m=Z({delimiter:n,storeValue:d,selectionEndIndex:c.endIndex});if(!m)return;if(!E({delimiter:n,storeValue:d,...m}))return;if(l.p9(d,m.startIndex,m.endIndex,l.GK.Code))return;const{textValue:g,startIndex:h,endIndex:f}=m,b=p(g,h),S=g.slice(h,f),w=a.p4(S).length,k={startIndex:b,endIndex:b+n.length};_.pe({environment:o,store:i,selection:k,transaction:s});const C={startIndex:b+w-n.length-n.length,endIndex:b+w-n.length};_.pe({environment:o,store:i,selection:C,transaction:s});const T={startIndex:k.startIndex,endIndex:C.startIndex};_.i8({environment:o,store:i,selection:T,annotation:r,transaction:s});const I=T.endIndex;M.Z5({store:i,selection:{startIndex:I,endIndex:I}}),M.aR({annotation:r,extend:!1}),y.trackAnnotationFilter(o,{type:l.J7(r)})}function Z(e){const{delimiter:t,storeValue:o,selectionEndIndex:i}=e,r=a.p4(l.Q(o)).slice(0,i).join("");if(0===r.length||!r.endsWith(t))return;const s=r.split(t);if(s.length<=2)return;s.reverse();const[c,...d]=s.slice(1),p=n().sum(d.map((e=>e.length+t.length)))-t.length;return{textValue:r,matchString:c,startIndex:p,endIndex:p+c.length+2*t.length}}function E(e){const{delimiter:t,matchString:o,startIndex:i,endIndex:n,textValue:r}=e;return o.length>0&&!/\s/g.test(o[0])&&!/\s/g.test(o[o.length-1])&&!o.startsWith(t)&&!o.endsWith(t)&&(!r[i-1]||/[\s(]/g.test(r[i-1]))&&(!r[n]||/[\s)]/g.test(r[n]))}function R(e){var t;const{environment:o,delimiter:i,store:n,transaction:r}=e,s="editing"===v.default.state.mode&&(null===(t=(0,u.QY)(v.default.state.multiSelection))||void 0===t?void 0:t.selection);if(!s)return;const c=n.getValue(),m=Z({delimiter:i,storeValue:c,selectionEndIndex:s.endIndex});if(!m)return;if(!function(e){const{storeValue:t,startIndex:o,endIndex:i,delimiter:n}=e;if(!E(e))return!1;const r={[l.GK.User]:l.GK.User,[l.GK.Page]:l.GK.Page,[l.GK.Comment]:l.GK.Comment,[l.GK.Bot]:l.GK.Bot,[l.GK.ExternalObjectInstance]:l.GK.ExternalObjectInstance,[l.GK.Date]:l.GK.Date,[l.GK.TemporaryPage]:l.GK.TemporaryPage,[l.GK.TemplateVariable]:l.GK.TemplateVariable,[l.GK.FormulaPageProperty]:l.GK.FormulaPageProperty,[l.GK.FormulaUserProperty]:l.GK.FormulaUserProperty,[l.GK.FormulaContextValue]:l.GK.FormulaContextValue,[l.GK.Group]:l.GK.Group};for(const a of Object.values(r))if(l.oP(t,o,i,a))return!1;if(l.oP(t,o,o+n.length,l.GK.Code)&&l.oP(t,i-n.length,i,l.GK.Code))return!1;return!0}({delimiter:i,storeValue:c,...m}))return;const{textValue:g,matchString:h,startIndex:f,endIndex:b}=m,S=p(g,f),w=g.slice(f,b);_.pe({environment:o,store:n,selection:{startIndex:S,endIndex:S+a.p4(w).length},transaction:r});const k=l.qZ(h);_.mM({environment:o,store:n,tokens:[k],index:S,transaction:r});const C=S+a.p4(l.Wi(k)).length;M.Z5({store:n,selection:{startIndex:C,endIndex:C}}),y.trackAnnotationFilter(o,{type:l.GK.Equation}),d.ND({environment:o,equation:h,from:{type:"create",source:"text_filter",selection:!0}})}const A=["\\.",",",";","\\?","!","\\)","\\]"," "].join("|"),D=new RegExp(` (${A})$`);function F(e){const t=l.xr(e.textValue,e.matchIndex-1,e.matchIndex),o=n().last(t.tokensInsideRange);if(o&&l.km(o))return e.match[1]}const L=[{delimiter:"**",type:l.GK.Bold},{delimiter:"＊＊",type:l.GK.Bold},{delimiter:"*",type:l.GK.Italic},{delimiter:"＊",type:l.GK.Italic},{delimiter:"__",type:l.GK.Bold},{delimiter:"＿＿",type:l.GK.Bold},{delimiter:"_",type:l.GK.Italic},{delimiter:"＿",type:l.GK.Italic},{delimiter:"~",type:l.GK.Strike},{delimiter:"〜",type:l.GK.Strike},{delimiter:"～",type:l.GK.Strike}],V=[{toBlockType:()=>r.Ti.toDo,matchRegex:/^(\[\] |\「\」　)$/,insertTextAfter:!1},{toBlockType:()=>r.Ti.subSubHeader,matchRegex:/^(### |＃＃＃)$/,insertTextAfter:!1},{toBlockType:()=>r.Ti.subHeader,matchRegex:/^(## |＃＃)$/,insertTextAfter:!1},{toBlockType:()=>r.Ti.header,matchRegex:/^(# |＃)$/,insertTextAfter:!1},{toBlockType:()=>r.Ti.toggle,matchRegex:/^(> |＞)$/,insertTextAfter:!1},{toBlockType:()=>r.Ti.quote,matchRegex:/^(\| |\" |\“ |\”)$/,insertTextAfter:!1},{toBlockType:()=>r.Ti.bulletedList,matchRegex:/^(\* |\- |\+ |\＊|\ー|\＋|\・)$/,insertTextAfter:!1},{toBlockType:()=>r.Ti.divider,matchRegex:/^—-$/,insertTextAfter:!0}],N=[{annotationDelimiter:"`",blockMatchRegex:/^```$/},{annotationDelimiter:"´",blockMatchRegex:/^´´´$/},{annotationDelimiter:"｀",blockMatchRegex:/^｀｀｀$/}],O=[{regex:/^"$/,length:1,replace:"“",analyticsType:"sentence_start_double_quote"},{regex:/ "$/,length:2,replace:" “",analyticsType:"start_double_quote"},{regex:/"$/,length:1,replace:"”",analyticsType:"end_double_quote"},{regex:/^'$/,length:1,replace:"‘",analyticsType:"sentence_start_single_quote"},{regex:/ '$/,length:2,replace:" ‘",analyticsType:"start_single_quote"},{regex:/'$/,length:1,replace:"’",analyticsType:"middle_single_quote"},{regex:/--$/,length:2,replace:"—",analyticsType:"em_dash"},{regex:/->$/,length:2,replace:"→",analyticsType:"right_arrow"},{regex:/<->$/,length:3,replace:"↔",analyticsType:"right_left_arrow"},{regex:/←>$/,length:2,replace:"↔",analyticsType:"right_left_arrow"},{regex:/=>$/,length:2,replace:"⇒",analyticsType:"right_arrow_double"},{regex:/<-$/,length:2,replace:"←",analyticsType:"left_arrow"},{regex:/>=$/,length:2,replace:"≥",analyticsType:"greater_than_or_equal_to"},{regex:/<=$/,length:2,replace:"≤",analyticsType:"less_than_or_equal_to"},{regex:/!=$/,length:2,replace:"≠",analyticsType:"not_equal"},{regex:/\.\.\.$/,length:3,replace:"…",analyticsType:"ellipsis"}];function U(e){const{environment:t,store:o,transaction:i}=e;let c;if(o.isTable("block")){const e=o.getRecordStoreAtRootPath().getValue();c=e&&e.type}if("code"!==c||v.default.isEditingCaption()){if("callout"!==c){for(const e of V)P({environment:t,store:o,toBlockType:e.toBlockType,matchRegex:e.matchRegex,insertTextAfter:e.insertTextAfter,transaction:i});P({environment:t,store:o,matchRegex:/^(\d+|[\uff10-\uff19]+)(\. |\。|\．)$/,insertTextAfter:!1,transaction:i,toBlockType:t=>{var o;const i=t[1],n=(0,m.DA)(i);return null===(o=z(e,parseInt(n)))||void 0===o?void 0:o.type},postTransformAction:t=>{var n;const r=t[1],a=(0,m.DA)(r),l=null===(n=z(e,parseInt(a)))||void 0===n?void 0:n.number;if(o.table!==s.iU)return;const c=o.getRecordStoreAtRootPath(),d=h.G.fromRecordStore(c),p=l&&l>1?l:void 0;S.FH({stores:[d],update:{list_start_index:p},transaction:i})}}),P({environment:t,store:o,matchRegex:/^([a-z]+)(\. |\。|\．)$/,insertTextAfter:!1,transaction:i,toBlockType:t=>{const o=(0,m.UF)(t[1]),i=z(e,o);if(1===o||void 0===(null==i?void 0:i.number))return null==i?void 0:i.type},postTransformAction:()=>{if(o.table!==s.iU)return;const e=o.getRecordStoreAtRootPath(),t=h.G.fromRecordStore(e);S.FH({stores:[t],update:{list_format:"roman"},transaction:i})}}),P({environment:t,store:o,matchRegex:/^([a-z]+)(\. |\。|\．)$/,insertTextAfter:!1,transaction:i,toBlockType:t=>{const o=(0,m.yk)(t[1]),i=z(e,o);if(1===o||void 0===(null==i?void 0:i.number))return null==i?void 0:i.type},postTransformAction:()=>{if(o.table!==s.iU)return;const e=o.getRecordStoreAtRootPath(),t=h.G.fromRecordStore(e);S.FH({stores:[t],update:{list_format:"letters"},transaction:i})}});for(const{blockMatchRegex:e}of N)P({environment:t,store:o,toBlockType:()=>r.Ti.code,matchRegex:e,insertTextAfter:!1,transaction:i})}if(!function(e){var t;const o="editing"===v.default.state.mode&&(null===(t=(0,u.QY)(v.default.state.multiSelection))||void 0===t?void 0:t.selection);if(!o)return!1;const i=e.getValue()||[],r=l.xr(i,0,o.endIndex),a=n().findLastIndex(r.tokensInsideRange,(e=>l.hD(e).some((e=>l.fT(e))))),s=r.tokensInsideRange.slice(-1===a?0:a,r.tokensInsideRange.length),c=l.Q(s);return Boolean(c.match(/(^| )`[^ ]/))}(o)){const e=b.getSubstitutions();for(const n of e)x({environment:t,store:o,transaction:i,regex:n.replace,length:n.length,replace:n.with,analyticsType:"custom_substitution"});for(const n of O)x({environment:t,store:o,transaction:i,regex:n.regex,length:n.length,replace:n.replace,analyticsType:n.analyticsType});!function(e){x({environment:e.environment,store:e.store,transaction:e.transaction,regex:D,length:2,replace:F,analyticsType:"mention_punctuation"})}({environment:t,store:o,transaction:i})}for(const{annotationDelimiter:e}of N)B({environment:t,delimiter:e,annotation:[l.GK.Code],store:o,transaction:i});for(const{delimiter:e,type:n}of L)B({environment:t,delimiter:e,annotation:[n],store:o,transaction:i});R({environment:t,delimiter:"$$",store:o,transaction:i}),R({environment:t,delimiter:"＄＄",store:o,transaction:i}),function(e){var t;const{environment:o,store:i,transaction:n}=e,r="editing"===v.default.state.mode&&(null===(t=(0,u.QY)(v.default.state.multiSelection))||void 0===t?void 0:t.selection);if(!r)return;const s=i.getValue(),c=a.p4(l.Q(s)).slice(0,r.endIndex).join("");if(l.oP(s,r.startIndex,r.endIndex,"c"))return;const d=/([^ ]+) $/.exec(c);if(!d)return;const m=d[1],g=l.rO(m);if(!g)return;const{value:h,href:f}=g,b=p(c,c.indexOf(h)),S=b+a.p4(h).length,w={startIndex:b,endIndex:S};l.oP(s,b,S,"a")||(_.i8({environment:o,store:i,annotation:["a",f],selection:w,transaction:n}),M.Z5({store:i,selection:r}),y.trackLinkFilter(o,{href:f}))}({environment:t,store:o,transaction:i})}}function H(e){const{store:t,transaction:o,environment:i}=e;o.postEnqueueActions.push((()=>{T.createAndCommit({userAction:"textFilterActions.runAllFiltersAfterTransaction",environment:i,undoCheckpoint:!0,perform:e=>{U({environment:i,store:t,transaction:e})}})}))}function z(e,t){const{store:o}=e;if(o.table!==s.iU)return;const i=o.getRecordStoreAtRootPath(),n=h.G.fromRecordStore(i),a=n.getType();if(a===r.Ti.header||a===r.Ti.subHeader||a===r.Ti.subSubHeader)return;const l=n.getParentBlockStore();if(!l)return;const c=l.getContentStores(),d=c.findIndex((e=>e.id===n.id));if(-1===d)return;const p=c.slice(0,d);let u=-1,m=1;for(let s=0;s<p.length;s++){const e=p[s];if(e.getType()!==r.Ti.numberedList)m=1,u=s;else{var g;const t=null===(g=e.getFormat())||void 0===g?void 0:g.list_start_index;t?m=t+1:m++}}return m===t?{type:r.Ti.numberedList,number:void 0}:d===u+1?{type:r.Ti.numberedList,number:t}:void 0}},98104:(e,t,o)=>{o.d(t,{NA:()=>I,z9:()=>P,Z5:()=>x,Km:()=>B,aR:()=>Z,aJ:()=>E,N_:()=>R,NX:()=>A,UV:()=>D,mT:()=>F,ls:()=>V,dd:()=>N,sD:()=>O,ZH:()=>U,o9:()=>H,N3:()=>j,zJ:()=>K,FG:()=>Y,DI:()=>G,AL:()=>X,e2:()=>q,D1:()=>$,FC:()=>J,J9:()=>Q,jh:()=>ee,LG:()=>te,bc:()=>ie});var i=o(96486),n=o.n(i),r=o(1302),a=o(70203),s=o(41046),l=o(14976),c=o(46150),d=o(28314),p=o(68056),u=o(45162),m=o(73959),g=o(77505),h=o(72133),f=o(89086),v=o(28685),y=o(95802),b=o(27724),S=o(24666),w=o(36280),k=o(45990),C=o(13084),_=o(24677),M=o(8713),T=o(30149);function I(e){const{multiSelection:t,readOnly:o,forceEmit:i}=e,n=S.default.state,r="empty"!==n.mode&&n.savedSelectionXPosition||void 0,a="editing"===n.mode&&(0,p.e6)(n.multiSelection,t)?n.forceExtendAnnotations:{},s=o?{mode:"readOnly",multiSelection:t,savedSelectionXPosition:r}:{mode:"editing",multiSelection:t,savedSelectionXPosition:r,forceExtendAnnotations:a};if(s.mode!==n.mode||!(0,p._v)(n.multiSelection,t))return S.default.setState(s),void M.Ps();i&&S.default.emit()}function P(e,t){if(!("always"===(0,u.Aw)(e)))return;const{TextSelectionCompositionStore:o}=e;o.setState({isComposing:t})}function x(e){const{store:t,selection:o,readOnly:i}=e;if(t&&o){I({multiSelection:(0,p.TD)({store:t,selection:o}),readOnly:i})}else if(t&&!o){const e={store:t,index:0},o={start:e,end:e};i?S.default.setState({mode:"readOnly",multiSelection:o,savedSelectionXPosition:0}):S.default.setState({mode:"editing",multiSelection:o,forceExtendAnnotations:{},savedSelectionXPosition:0})}else"empty"!==S.default.state.mode&&S.default.setState({mode:"empty"})}function B(e){const{annotation:t}=e;if(a.k8[t[0]])return;const o=a.J7(t),i=(0,f.bj)().find((e=>a.J7(e)===o));Z(i?{annotation:i,extend:!1}:{annotation:t,extend:!0})}function Z(e){const{annotation:t,extend:o}=e,i=S.default.state,n=a.J7(t);"editing"===i.mode&&S.default.setState({...i,forceExtendAnnotations:{...i.forceExtendAnnotations,[n]:{annotation:t,extend:o}}})}function E(){const e=S.default.state;"editing"===e.mode&&S.default.setState({...e,forceExtendAnnotations:{}})}function R(e){const{store:t}=e;x({store:t,selection:{startIndex:0,endIndex:0}})}function A(e){const{store:t}=e;x({store:t,selection:(0,f.x0)(t)})}function D(e){var t;E();const{environment:o,store:i,canSelectAllBlocks:n,contentEditableContextId:r}=e,a=S.default.state;let s;s="empty"===a.mode?{start:{store:i,index:0},end:{store:i,index:0}}:a.multiSelection;const l={start:{store:s.start.store,index:0},end:{store:s.end.store,index:(null===(t=(0,f.x0)(s.end.store))||void 0===t?void 0:t.endIndex)||0}};if((0,p._v)(l,s)){if(r){const e=(0,f.Ov)(),t=e=>{var t;return(null===(t=e.contentEditableContext)||void 0===t?void 0:t.id)===r},o=e.find(t),i=e.reverse().find(t);if(o&&i){const e=o.props.store,t=i.props.store;if(e&&t){var c;return void I({multiSelection:{start:{store:e,index:0},end:{store:t,index:(null===(c=(0,f.x0)(t))||void 0===c?void 0:c.endIndex)||0}}})}}}n&&(0,m.Mn)(o.device)&&_.td(o)}else I({multiSelection:l})}function F(e){var t;E();const{environment:o,store:i,canSelectAllBlocks:n}=e,r=(0,f.x0)(i),a={startIndex:0,endIndex:r?r.endIndex:0};n&&"empty"!==S.default.state.mode&&(0,f.fu)(null===(t=(0,u.xI)("textSelectionActions",S.default.state.multiSelection))||void 0===t?void 0:t.selection,a)?_.td(o):x({store:i,selection:a})}function L(e){const t=S.default.state;"empty"===t.mode||t.savedSelectionXPosition||S.default.setState({...t,savedSelectionXPosition:e.savedSelectionXPosition})}function V(){"empty"!==S.default.state.mode&&S.default.setState({...S.default.state,savedSelectionXPosition:void 0})}function N(e){const{store:t,contentEditableLeafRegistry:o}=e;r.default.afterNextFlush((()=>{const e=h.get(),i=(0,u.fx)({contentEditableLeafRegistry:o,range:e,allowInvisibleEndSelection:(0,d.yA)().shift});i?I(i):x({store:t})}))}function O(){const e=document.activeElement;e instanceof HTMLElement&&e.blur()}function U(e){h.clear(e),H()}function H(){x({store:void 0,selection:void 0})}function z(e){const{currentEditableTopBottomPadding:t,targetEdge:o,targetEditable:i,selectionXPosition:r}=e,a=i.getNode();if(!(a&&a instanceof Element))return;const l=a.getBoundingClientRect(),c=Math.min(Math.max(r,l.left),l.right),d=Math.min(t,i.props.topBottomPadding),p="top"===o?l.top:l.bottom;return function(e,t,o){const i=new Map,r={visibility:"hidden"},a=Object.keys(r);let l;try{for(;l=h.rangeFromPoint(e,t);){if(o.contains(l.commonAncestorContainer))return l;const e=s.Z.getParentOverlayNode(l.commonAncestorContainer);if(!e)return;if(i.has(e))return;const t=n().pick(e.style,a);i.set(e,t),Object.assign(e.style,r)}}finally{for(const[e,t]of i)Object.assign(e.style,t)}}(c,"top"===o?p+d:p-d,a)}function W(e){const{focusContainerOffset:t,focusStore:o,edge:i,topBottomPadding:n}=e,r=v.E.findNodeFromStore(o);if(!(r&&r instanceof Element))return;const a=h.getRect(h.rangeFromContainerOffsets({start:t,end:t})),s=r.getBoundingClientRect();if(!a||!s)return;const[l,c]="top"===i?[a.top,s.top]:[a.bottom,s.bottom];return{focusIsAtEdge:Math.abs(l-c)<=n,focusSelectionRect:a,renderedNode:r,renderedNodeRect:s}}function j(e){const{environment:t,event:o,topBottomPadding:i,contentEditableLeafRegistry:n}=e,r=h.get();if(!r)return;E();const a=S.default.state;if("empty"===a.mode)return;const{multiSelection:s}=a,{focus:l,anchor:d}=(0,u.uZ)(s),m=W({focusContainerOffset:h.rangeToContainerOffsets(r).focus,focusStore:l.store,topBottomPadding:i,edge:"top"});if(!m)return;const{focusIsAtEdge:y,focusSelectionRect:b}=m,w=g.UQ(),k=w?(0,f.Q8)(w):(0,f.mK)(l.store),C=k&&v.E.findEditableWithStore(k);if(y&&C){var T;const e=Math.max(a.savedSelectionXPosition||0,b.left),n=z({targetEditable:C,targetEdge:"bottom",currentEditableTopBottomPadding:i,selectionXPosition:e}),s=(null===(T=(0,u.fx)({range:n,contentEditableLeafRegistry:void 0,allowInvisibleEndSelection:!0}))||void 0===T?void 0:T.multiSelection)||(0,p.TD)({store:C.props.store,selection:(0,f.x0)(C.props.store)});if(o.shiftKey&&!o.altKey&&s&&(0,c.D1)(C.getNode(),r.commonAncestorContainer))return o.preventDefault(),L({savedSelectionXPosition:e}),void ie({environment:t,multiSelection:(0,u.$r)(s.start,d),focus:s.start,forceEmit:!1});if(!o.shiftKey&&!o.altKey&&s)return o.preventDefault(),L({savedSelectionXPosition:e}),void ie({environment:t,forceEmit:!1,multiSelection:s,focus:"start"})}if(o.shiftKey&&!o.altKey&&(0,f.e7)(l,s.start.store)){if(g._Y()&&ne(t))return void M.rS({environment:t,direction:"up",bypassExistingTextSelection:!1,expandSelection:!0});const e=(0,u.tp)({multiSelection:s,focus:l,filterCommonAncestors:!0});if(e)return o.preventDefault(),void _.Z5({environment:t,...e})}N({store:l.store,contentEditableLeafRegistry:n})}function K(e){const{environment:t,store:o,event:i,topBottomPadding:n}=e,r=h.get();if(!r)return;E();const a=h.getRect(r),s=v.E.findNodeFromStore(o),c=S.default.state;if(!s)return;if(!(s instanceof Element))return;if("empty"===c.mode)return;const d=(0,u.xI)("textSelectionActions",c.multiSelection);if(!d)return;const p=s.getBoundingClientRect(),y=g.UQ(),b=y?(0,f.Q8)(y):(0,f.mK)(o);if(a&&p){const e=Math.abs(a.top-p.top),s={startIndex:d.selection.startIndex,endIndex:d.selection.startIndex},u=(0,m.sQ)(o);if(!i.altKey&&i.shiftKey&&(0,f.Rw)(s)&&(h.selectionIsBackwards()||r.collapsed)&&u)_.Z5({environment:t,stores:[u]});else if(!i.altKey&&!i.shiftKey&&e<=n&&b){i.preventDefault();const e=Math.max(c.savedSelectionXPosition||0,a.left);L({savedSelectionXPosition:e});const o=v.E.findNodeFromStore(b);if(o&&o instanceof Element){const i=o.getBoundingClientRect(),r=Math.min(Math.max(e,i.left),i.right),a=i.bottom-n,s=h.rangeFromPoint(r,a),c=l.Ut(t,s);c&&(oe({environment:t,store:b,selection:c.selection}),c.forceEmitSelectionStore&&S.default.emit())}}else N({store:o})}}function Y(e){const{environment:t,event:o,topBottomPadding:i,contentEditableLeafRegistry:n}=e,r=h.get();if(!r)return;E();const a=S.default.state;if("empty"===a.mode)return;const{multiSelection:s}=a,{focus:l,anchor:d}=(0,u.uZ)(s),y=W({focusContainerOffset:h.rangeToContainerOffsets(r).focus,focusStore:l.store,topBottomPadding:i,edge:"bottom"});if(!y)return;const{focusIsAtEdge:b,focusSelectionRect:w}=y,k=g.UQ(),C=k?(0,f.a5)(k):(0,f.hn)(l.store),T=C&&v.E.findEditableWithStore(C);if(b&&T){var I;const e=Math.max(a.savedSelectionXPosition||0,w.left),n=z({targetEditable:T,targetEdge:"top",currentEditableTopBottomPadding:i,selectionXPosition:e}),s=(null===(I=(0,u.fx)({range:n,contentEditableLeafRegistry:void 0,allowInvisibleEndSelection:!0}))||void 0===I?void 0:I.multiSelection)||(0,p.TD)({store:T.props.store,selection:{startIndex:0,endIndex:0}});if(o.shiftKey&&!o.altKey&&s&&(0,c.D1)(T.getNode(),r.commonAncestorContainer))return o.preventDefault(),L({savedSelectionXPosition:e}),void ie({environment:t,multiSelection:(0,u.$r)(s.start,d),focus:s.start,forceEmit:!1});if(!o.shiftKey&&!o.altKey&&s)return o.preventDefault(),L({savedSelectionXPosition:e}),void ie({environment:t,forceEmit:!1,multiSelection:s,focus:"end"})}const P=(0,m.sQ)(s.start.store);if(o.shiftKey&&!o.altKey&&(0,f.iB)(l,s.end.store)&&P){if(g._Y()&&ne(t))return void M.rS({environment:t,direction:"down",bypassExistingTextSelection:!1,expandSelection:!0});const e=(0,u.tp)({multiSelection:s,focus:l,filterCommonAncestors:!0});if(e)return o.preventDefault(),void _.Z5({environment:t,...e})}N({store:l.store,contentEditableLeafRegistry:n})}function G(e){const{environment:t,store:o,event:i,topBottomPadding:n}=e,r=h.get();if(!r)return;E();const a=h.getRect(r),s=v.E.findNodeFromStore(o),c=S.default.state;if(!s)return;if(!(s instanceof Element))return;if("empty"===c.mode)return;const d=(0,u.xI)("textSelectionActions",c.multiSelection);if(!d)return;const p=s.getBoundingClientRect();if(a&&p){const e=g.UQ(),s=e?(0,f.a5)(e):(0,f.hn)(o),u=Math.abs(a.bottom-p.bottom),y={startIndex:d.selection.endIndex,endIndex:d.selection.endIndex},b=(0,m.sQ)(o);if(!i.altKey&&i.shiftKey&&(0,f.J_)(o,y)&&(!h.selectionIsBackwards()||r.collapsed)&&b)_.Z5({environment:t,stores:[b]});else if(!i.altKey&&!i.shiftKey&&u<=n&&s){i.preventDefault();const e=Math.max(c.savedSelectionXPosition||0,a.left);L({savedSelectionXPosition:e});const o=v.E.findNodeFromStore(s);if(o&&o instanceof Element){const i=o.getBoundingClientRect(),r=Math.min(Math.max(e,i.left),i.right),a=i.top+n,c=h.rangeFromPoint(r,a),d=l.Ut(t,c);d&&(oe({environment:t,store:s,selection:d.selection}),d.forceEmitSelectionStore&&S.default.emit())}}else N({store:o})}}function X(e){r.default.afterNextFlush((()=>{V()})),E();const{environment:t,event:o,contentEditableLeafRegistry:i}=e,n=h.get(),s=S.default.state;if("empty"===s.mode)return;const{multiSelection:l}=s,{focus:d,anchor:m}=(0,u.uZ)(l),y=(0,f.mK)(d.store),b=y&&v.E.findEditableWithStore(y);if((0,f.e7)(d,d.store)&&b){const e=(0,p.TD)({store:b.props.store,selection:(0,f.x0)(b.props.store)});if(o.shiftKey&&!o.altKey&&e&&(0,c.D1)(b.getNode(),null==n?void 0:n.commonAncestorContainer))return o.preventDefault(),void ie({environment:t,multiSelection:(0,u.$r)(e.start,m),focus:e.start,forceEmit:!1});if(!o.shiftKey&&!o.altKey&&e&&(0,p.iG)(l))return o.preventDefault(),void ie({environment:t,forceEmit:!1,multiSelection:e,focus:"start"})}if(o.shiftKey&&!o.altKey&&(0,f.e7)(d,l.start.store)){if(g._Y()&&ne(t))return void M.eh({environment:t,direction:"left",bypassExistingTextSelection:!1,expandSelection:!0});const e=(0,u.tp)({multiSelection:l,focus:d,filterCommonAncestors:!0});if(e)return o.preventDefault(),void _.Z5({environment:t,...e})}if(o.altKey||o.shiftKey||o.ctrlKey||o.metaKey||!n||!n.collapsed)N({store:d.store,contentEditableLeafRegistry:i});else{const e=d.index-1,i=a.b1(l.start.store.getValue(),e);if(i&&a.tk(i)){o.preventDefault(),I({multiSelection:{start:{...d,index:e},end:d}});const n={startIndex:e,endIndex:d.index};a.Yr(i)&&r.default.afterNextFlush((()=>{w.qn({environment:t,selectedToken:{token:i,position:n},analyticsFrom:"arrow_keys"})}))}const n=a.hp(d.store.getValue(),e,((e,t)=>{const o=a.Hz(e);return t?Boolean(o&&a.Hz(t)===o):Boolean(o)}));n&&k.dz({type:"selectionFocus",store:d.store,focus:!1,selection:n})}}function q(e){r.default.afterNextFlush((()=>{V()})),E();const{environment:t,store:o,event:i}=e,n=h.get(),s=S.default.state;if("empty"===s.mode)return;const l=(0,u.xI)("textSelectionActions",s.multiSelection);if(!l)return;const c={startIndex:l.selection.startIndex,endIndex:l.selection.startIndex},d=(0,m.sQ)(o);if(!i.altKey&&i.shiftKey&&n&&(0,f.Rw)(c)&&(h.selectionIsBackwards()||n.collapsed)&&d)_.Z5({environment:t,stores:[d]});else if(i.altKey||i.shiftKey||l.store!==o||!(0,f.Rw)(l.selection))if(i.altKey||i.shiftKey||i.ctrlKey||i.metaKey||!n||!n.collapsed)N({store:o});else{const e=a.b1(o.getValue(),c.startIndex-1);if(e&&a.tk(e)){i.preventDefault();const n={startIndex:c.startIndex-1,endIndex:c.startIndex};x({store:o,selection:n}),a.Yr(e)&&r.default.afterNextFlush((()=>{w.qn({environment:t,selectedToken:{token:e,position:n},analyticsFrom:"arrow_keys"})}))}const n=a.hp(o.getValue(),c.startIndex-1,((e,t)=>{const o=a.Hz(e);return t?Boolean(o&&a.Hz(t)===o):Boolean(o)}));n&&k.dz({type:"selectionFocus",store:o,focus:!1,selection:n})}else{i.preventDefault();const e=(0,f.mK)(o);if(e){const o=(0,f.x0)(e);o&&oe({environment:t,store:e,selection:o})}}}function $(e){r.default.afterNextFlush((()=>{V()})),E();const{environment:t,event:o,contentEditableLeafRegistry:i}=e,n=h.get(),s=S.default.state;if("empty"===s.mode)return;const{multiSelection:l}=s,{focus:d,anchor:m}=(0,u.uZ)(l),y=(0,f.hn)(d.store),b=y&&v.E.findEditableWithStore(y);if((0,f.iB)(d,d.store)&&b){const e=(0,p.TD)({store:b.props.store,selection:{startIndex:0,endIndex:0}});if(o.shiftKey&&!o.altKey&&e&&(0,c.D1)(b.getNode(),null==n?void 0:n.commonAncestorContainer))return o.preventDefault(),void ie({environment:t,multiSelection:(0,u.$r)(e.start,m),focus:e.start,forceEmit:!1});if(!o.shiftKey&&!o.altKey&&e&&(0,p.iG)(l))return o.preventDefault(),void ie({environment:t,forceEmit:!1,multiSelection:e,focus:"end"})}if(o.shiftKey&&!o.altKey&&(0,f.iB)(d,l.end.store)){if(g._Y()&&ne(t))return void M.eh({environment:t,direction:"right",bypassExistingTextSelection:!1,expandSelection:!0});const e=(0,u.tp)({multiSelection:l,focus:d,filterCommonAncestors:!0});if(e)return o.preventDefault(),void _.Z5({environment:t,...e})}if(o.altKey||o.shiftKey||o.ctrlKey||o.metaKey||!n||!n.collapsed)N({store:d.store,contentEditableLeafRegistry:i});else{const e=d.index,i=d.index+1,n=a.b1(l.start.store.getValue(),e);if(n&&a.tk(n)){o.preventDefault(),I({multiSelection:{start:d,end:{...d,index:i}}});const s={startIndex:e,endIndex:i};a.Yr(n)&&r.default.afterNextFlush((()=>{w.qn({environment:t,selectedToken:{token:n,position:s},analyticsFrom:"arrow_keys"})}))}const s=a.hp(d.store.getValue(),e,((e,t)=>{const o=a.Hz(e);return t?Boolean(o&&a.Hz(t)===o):Boolean(o)}));s&&k.dz({type:"selectionFocus",store:d.store,focus:!1,selection:s})}}function J(e){r.default.afterNextFlush((()=>{V()})),E();const{environment:t,store:o,event:i}=e,n=h.get(),s=S.default.state;if("empty"===s.mode)return;const l=(0,u.xI)("textSelectionActions",s.multiSelection);if(!l)return;const c={startIndex:l.selection.endIndex,endIndex:l.selection.endIndex},d=(0,m.sQ)(o);if(!i.altKey&&i.shiftKey&&n&&(0,f.J_)(o,c)&&(!h.selectionIsBackwards()||n.collapsed)&&d)_.Z5({environment:t,stores:[d]});else if(i.altKey||i.shiftKey||l.store!==o||!(0,f.J_)(o,l.selection))if(i.altKey||i.shiftKey||i.ctrlKey||i.metaKey||!n||!n.collapsed)N({store:o});else{const e=a.b1(o.getValue(),c.startIndex);if(e&&a.tk(e)){i.preventDefault();const n={startIndex:c.startIndex,endIndex:c.startIndex+1};x({store:o,selection:n}),a.Yr(e)&&r.default.afterNextFlush((()=>{w.qn({environment:t,selectedToken:{token:e,position:n},analyticsFrom:"arrow_keys"})}))}const n=a.hp(o.getValue(),c.startIndex+1,((e,t)=>{const o=a.Hz(e);return t?Boolean(o&&a.Hz(t)===o):Boolean(o)}));n&&k.dz({type:"selectionFocus",store:o,focus:!1,selection:n})}else{i.preventDefault();const e=(0,f.hn)(o);e&&oe({environment:t,store:e,selection:{startIndex:0,endIndex:0}})}}function Q(e,t){const{x:o,y:i,target:n}=t,r=(0,f.fx)(o,i,n);r&&r.selectable.props.onEditText&&T.createAndCommit({userAction:"textSelectionActions.editNearestBlock",environment:e,perform:e=>{r.selectable.props.onEditText&&r.selectable.props.onEditText({isAtStartOfLine:o<=r.rect.left,isClick:!0,transaction:e})}})}function ee(e,t,o){const{x:i,y:n,target:r}=t,a=r?b.default.getDefaultContainerFromTarget(r):void 0;if(a&&(0,f.Q3)(n,a)&&C.HO({environment:e,container:a,transaction:o}))return;const s=(0,f.fx)(i,n,r);if(s&&s.selectable.props.onEditText){const e=n<=s.rect.top;s.selectable.props.onEditText({isAtStartOfLine:i<=s.rect.left,isAtStartOfContainer:e,isClick:!0,transaction:o})}}function te(e,t,o,i){const{y:n,target:r}=t,a=r?b.default.getDefaultContainerFromTarget(r):void 0,s=y.C.findSelectableFromStore(o);a&&s&&(0,f.qh)(n,s)&&C.UG({environment:e,container:a,store:o,transaction:i})}function oe(e){const{environment:t,store:o,selection:i}=e;x({store:o,selection:i});const n=(0,m.sQ)(o);n&&_.eP({environment:t,store:n})}function ie(e){const{environment:t,multiSelection:o,forceEmit:i,readOnly:n,focus:r}=e;I({multiSelection:o,forceEmit:i,readOnly:"infer"===n?(0,u.L5)(o).some((e=>{let{editable:t}=e;return!t.props.store.canEdit()})):n});const a=(0,u.tp)({multiSelection:o,filterCommonAncestors:!1,focus:r});a&&_.Z5({environment:t,phase:b.SelectionPhase.Editing,...a})}function ne(e){const t=g.UQ();if(t){const{rowIndex:o,columnIndex:i,simpleTableStore:n}=t.props;return M.n5({environment:e,rowIndex:o,columnIndex:i,simpleTableStore:n}),U(e),!0}return!1}},35822:(e,t,o)=>{o.d(t,{h0:()=>u,I6:()=>f,rz:()=>v,LH:()=>y,MH:()=>b});var i=o(289),n=o(97880),r=o(67669),a=o(15517),s=o(30021),l=o(79315),c=o(4926),d=o(84908);let p;function u(e,t){const{device:o,ThemeStore:n}=e,{mode:r,usingSystemTheme:s}=t,l={mode:r};n.setState(l),e.mobileNative&&e.mobileNative.setTheme(r,s),d.setTheme(i.c(r)),a.Dc(l),function(e,t){if(0===e.nativeScrollbarWidth)return;const o=document.getElementById("scroll-properties");if(o){const e=10;o.innerHTML=`\n\t\t\t::-webkit-scrollbar {\n\t\t\t\twidth: ${e}px;\n\t\t\t\theight: ${e}px;\n\t\t\t}\n\t\t\t::-webkit-scrollbar {\n\t\t\t\tbackground: transparent;\n\t\t\t}\n\t\t\t::-webkit-scrollbar-track {\n\t\t\t\tbackground: ${m[t]};\n\t\t\t}\n\t\t\t::-webkit-scrollbar-thumb {\n\t\t\t\tbackground:${g[t]};\n\t\t\t}\n\t\t\t::-webkit-scrollbar-thumb:hover {\n\t\t\t\tbackground:${h[t]};\n\t\t\t}\n\t\t`,c.Z.set(e)}}(o,r),"dark"===r?document.body.classList.add("dark"):document.body.classList.remove("dark")}const m={light:"#EDECE9",dark:"rgba(202, 204, 206, 0.04)"},g={light:"#D3D1CB",dark:"#474c50"},h={light:"#AEACA6",dark:"rgba(202, 204, 206, 0.3)"};function f(e){p=e}function v(e){p=void 0,s.Z.setState(e)}function y(e){const t=S(e);switch(t){case"dark":case"light":u(e,{mode:t,usingSystemTheme:!1});break;case"system":!async function(e){const{mobileNative:t}=e;let o="light";o=t&&t.api.getTheme?await t.api.getTheme():e.device.prefersDarkInterface?"dark":"light",u(e,{mode:o,usingSystemTheme:!0})}(e);break;default:(0,n.t1)(t)}}function b(e){return p||S(e)}function S(e){let t=s.Z.state;const{mainEditorCurrentBlockStore:o}=l.default.state;return t||(t=e.device.isMobile||o&&(0,r.IJ)(e,o)?"system":e.ThemeStore.state.mode),"dark"===(i=t)||"light"===i||"system"===i?i:"system";var i}},29373:(e,t,o)=>{o.d(t,{ls:()=>y,rd:()=>b,nz:()=>S,LO:()=>w,X_:()=>C});var i=o(96486),n=o.n(i),r=o(41432),a=o(15157),s=o(98459),l=o(35328),c=o(58202),d=o(45131),p=o(54642),u=o(49865),m=o(94419),g=o(9953),h=o(24677),f=o(98104);function v(e){return`ToggleBlock-${e}`}function y(e){const{environment:t,store:o,transaction:i}=e,n=g.j4({environment:t,type:r.Ti.text,inMemoryRecordCache:o.inMemoryRecordCache,transaction:i,spaceId:o.pointer.spaceId});m.R3({parent:o.getContentStore(),append:n,transaction:i});const a=o.getContentStores()[0];h.eP({environment:t,store:a});const s=a.getBlockTitleStore();f.N_({store:s})}function b(e){let{blockId:t,state:o,currentUserId:i}=e;d.Z.setOpen(t,o),a.Z.set({userId:i,key:v(t),value:o})}function S(e){let{blockId:t,currentUserId:o}=e;const i=a.Z.get({userId:o,key:v(t)});d.Z.setOpen(t,i)}function w(e,t){p.loadCachedPageChunkBatched(e,{page:{id:t.id,spaceId:(0,s.CG)(t.spaceId)},limit:25,chunkNumber:0,cursor:{stack:[]},verticalColumns:!1})}function k(e,t){const o=(null==t?void 0:t.toggleBlockIds)||[],i=(null==t?void 0:t.collectionBlockIds)||[],n=e.getType();if((0,l.BX)(e)&&o.push(e.id),"collection_view"!==n&&"collection_view_page"!==n||i.push(e.id),n===r.Ti.transclusionReference){const t=e.getTransclusionReferenceTargetStore();t&&k(t,{toggleBlockIds:o,collectionBlockIds:i})}else{const t=e.getContentStores();for(const e of t)e.isNavigableBlock()||k(e,{toggleBlockIds:o,collectionBlockIds:i}),"collection_view"===e.getType()&&i.push(e.id)}return{toggleBlockIds:o,collectionIds:i}}function C(e,t){const{toggleBlockIds:o,collectionIds:i}=k(t),r=t.environment.currentUser.id;o.forEach((e=>S({blockId:e,currentUserId:r})));const a=n().compact(i.map((e=>function(e){const t=c.R.findCollectionViewBlockFromId(e);if(t)return t.collectionContextStore}(e)))),s=a.flatMap((e=>e.groupsStore.getAllGroupStates())),l=o.every((e=>d.Z.isOpen(e))),p=s.every((e=>e.toggleStateStore.state)),m=!(l&&p);o.forEach((e=>b({blockId:e,state:m,currentUserId:r}))),function(e,t,o){for(const i of t)for(const t of i.groupsStore.getAllGroupStates())u.uo({environment:e,collectionContextStore:i,groupFormat:t.groupsPointer[0],toggleStateStore:t.toggleStateStore,newValue:o})}(e,a,m)}},25103:(e,t,o)=>{o.d(t,{l:()=>p,H:()=>d});var i=o(70203),n=o(44805),r=o(97880),a=o(79315),s=o(96049),l=o(48588),c=o(35973);function d(e){var t;if(s.Z.state)return;const{token:o,store:d}=e,u=i.hD(o.textToken),m=null===(t=a.default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getSpaceId();if(!m)return;const g=i.zr(u).filter((e=>!(0,n.vz)({annotation:e,spaceId:m,getRecordModel:d.getRecordModel}))),h=[i.rl(u),i.K9(u),i.QG(u),i.fr(u),i.x(u),...g].filter(r.$K);h.length>0?(l.Z.setState({token:o,store:d,annotations:h}),function(e){let{source:t,discussionAnnotations:o}=e;c.Z.setState({source:t,discussionIds:o.map(i.h1)})}({discussionAnnotations:g,source:"editor"})):p()}function p(){var e,t;l.Z.state&&l.Z.setState(void 0),e="editor",(null===(t=c.Z.state)||void 0===t?void 0:t.source)===e&&c.Z.setState(void 0)}},30149:(e,t,o)=>{o.r(t),o.d(t,{DEBUG:()=>$,MetadataUpdateManager:()=>ne,applyOperation:()=>se,createAndCommit:()=>me,createAndCommitAsync:()=>ge,updateConnectionState:()=>oe,updateMetadataForTransaction:()=>ie});var i=o(96486),n=o.n(i),r=o(18466),a=o(45060),s=o(97477),l=o(63144),c=o(65917),d=o(5773),p=o(43593);var u=o(1144),m=o(59730),g=o(2911),h=o(59753),f=o(482),v=o(34424),y=o(45953),b=o(98963),S=o(21202),w=o(6287),k=o(13493),C=o(70279),_=o(90468),M=o(19889),T=o(97880),I=o(63143),P=o(5366),x=o(95477),B=o(21830),Z=o(33929),E=o(98165),R=o(4615);class A{constructor(e){this.id=(0,R.ZP)(),this.spaceId=void 0,this.userId=void 0,this.committed=!1,this.isLocal=!1,this.useSudoMode=void 0,this.deadlockWarningTimeout=void 0,this.operations=[],this.stores=[],this.initialRecordMap=y.Ak.create(),this.invertedOperations=[],this.postPerformAssertions=[],this.preEnqueueActions=[],this.postEnqueueActions=[],this.postSubmitCallbacks=[],this.userAction=void 0;const{spaceId:t,userId:o,deadlockTimeoutMs:i,onDeadlockWarning:n}=e;t&&o&&(this.spaceId=t,this.userId=o),n&&(this.deadlockWarningTimeout=window.setTimeout(n,i))}annotateWithUserAction(e){this.userAction=e}getUserActionForAnalyticsPurposesOnly(){return this.userAction}cancelDeadlockWarning(){void 0!==this.deadlockWarningTimeout&&(window.clearTimeout(this.deadlockWarningTimeout),this.deadlockWarningTimeout=void 0)}done(e){this.cancelDeadlockWarning();for(const t of this.postSubmitCallbacks)t(e)}}var D=o(99341),F=o(88632),L=o(37598),V=o(39218),N=o(3815),O=o(27724),U=o(24666),H=o(50906),z=o(85266),W=o(36576),j=o(74446),K=o(10484);var Y=o(47307),G=o(4408),X=o(55332),q=o(21325);const $=!1,J=new Set;let Q=0;const ee=(0,P.defineMessages)({invalidBlockOperation:{defaultMessage:"Hey there! Blocks cannot be moved inside of themselves.",id:"saveChanges.errorDialog.blocksCannotBeMovedInsideSelf.message"},saveEditsError:{id:"saveEditsError.message",defaultMessage:"There was an issue persisting your edits. Please message us for help."}}),te=25*I.C0;function oe(e){F.Z.state.online&&e.currentUser.id&&V.transactionQueue.unpause()}function ie(e){const{environment:t,transaction:o,skipUpdatingEditedMetadata:i}=e,r=t.currentUser.adminUserId?M.el.id:t.currentUser.id,a=new ne({transaction:o,userId:r,skipUpdatingEditedMetadata:i,timeMs:Date.now()}),s=n().uniqBy(o.stores,(e=>e.id));for(const n of s)if(n.table===S.iU){const e=N.G.createChildStore(n,n.pointer);if(e.canEdit()&&a.addStore(e),!e.isNavigableBlock()){const t=E.Dg(e);t&&t.canEdit()&&a.addStoreWithLargeSubtree(t)}}else if(n.table===C.x_){if(n.path.length)continue;const e=o.initialRecordMap.get(n.pointer),t=n.getValue();(void 0===e||l.P(h.kk.fromValue(C.x_,e),h.kk.fromValue(C.x_,t)))&&a.addStore(N.T5.createChildStore(n,n.pointer))}else if(n.table===_.bx)a.addStoreWithLargeSubtree(N.H2.createChildStore(n,n.pointer));else if(n.table===w.v){const e=N.NW.createChildStore(n,n.pointer).getParentBlockStore();e&&e.canEdit()&&a.addStore(e)}else if(n.table===k.n){const e=N.Xr.createChildStore(n,n.pointer).getParentBlockStore();e&&e.canEdit()&&a.addStoreWithLargeSubtree(e)}else if(n.table===b.cv&&n.canEdit()){const e=N.Mz.createChildStore(n,n.pointer);a.addStore(e);const t=e.getParentBlockStore();t&&t.canEdit()&&a.addStore(t)}a.getAllOperations().forEach((e=>{let[t,i]=e;return se({transaction:o,store:t,operation:i})}))}class ne{constructor(e){this.transaction=void 0,this.timeMs=void 0,this.userId=void 0,this.skipUpdatingEditedMetadata=void 0,this.seenStoreIds=void 0,this.operations=void 0,this.transaction=e.transaction,this.timeMs=e.timeMs,this.userId=e.userId,this.skipUpdatingEditedMetadata=e.skipUpdatingEditedMetadata,this.seenStoreIds=new Set,this.operations=new Map}addStoreWithLargeSubtree(e){this.addStoreInternal(e,{shouldDebounceEditedTime:!0})}addStore(e){this.addStoreInternal(e,{shouldDebounceEditedTime:!1})}getAllOperations(){return Array.from(this.operations.entries())}addStoreInternal(e,t){if(e.inMemoryRecordCache.recordHasOverride({pointer:e.pointer,userId:this.transaction.userId}))return;if(this.seenStoreIds.has(e.id))return;this.seenStoreIds.add(e.id);const o={};n().merge(o,this.collectCreationMetadata(e),this.skipUpdatingEditedMetadata?{}:this.collectEditionMetadata(e,t.shouldDebounceEditedTime)),Object.keys(o).length>0&&this.operations.set(e,{pointer:e.pointer,path:[],command:"update",args:o})}collectCreationMetadata(e){const t={};(e.isDefined()?e.getCreatedById():void 0)||(t.created_by_id=this.userId,t.created_by_table=M.KJ);return(e.isDefined()?e.getCreatedTime():void 0)||(t.created_time=this.timeMs),t}collectEditionMetadata(e,t){const o={},i=e.isDefined()?e.getLastEditedTime():-1;if((t?this.hasDebounceEnded(i,this.timeMs):i!==this.timeMs)&&(o.last_edited_time=this.timeMs),e instanceof N.G||e instanceof N.H2||e instanceof N.Mz){const t=o;(e.isDefined()?e.getLastEditedById():void 0)!==this.userId&&(t.last_edited_by_id=this.userId,t.last_edited_by_table=M.KJ)}return o}hasDebounceEnded(e,t){return I.ud(e)!==I.ud(t)}}const re=function(e){n().uniqBy(e.stores,(e=>e.id)).forEach((t=>{if(!t.inMemoryRecordCache.recordHasOverride({pointer:t.pointer,userId:e.userId}))if(t.table===S.iU){const o=N.G.fromRecordStore(t),i=o.getProperties(),n=o.getFormat();if(o.isDefined()){const t=(0,d.xN)({properties:i,format:n},x.Z.secureFileS3.url,x.Z.secureFileConfig.rootPath,x.Z.secureFileConfig.hostname,o.pointer),r=t.files,a=t.operations,s=o.getFileIds();for(const i of r)s.indexOf(i.id)<0&&se({transaction:e,store:o,operation:{pointer:o.pointer,path:["file_ids"],command:"listAfter",args:{id:i.id}}});for(const i of a)se({transaction:e,store:o,operation:i})}}else if(t.table===w.v){const o=N.NW.fromRecordStore(t),i=o.getFileIds(),n=o.getIconStore().getValue(),r=o.getCoverStore().getValue();if(o.isDefined()){const t=function(e,t,o){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(o&&!e.file_ids)return[];const r=[],{cover:a,icon:s}=e;if(a){const e=(0,p.mV)(a,t,i,n);e&&r.push(e)}if(s){const e=(0,p.mV)(s,t,i,n);e&&r.push(e)}return r}({cover:r,icon:n,file_ids:i},x.Z.secureFileS3.url,!1,x.Z.secureFileConfig.rootPath,x.Z.secureFileConfig.hostname),a=i;for(const i of t)a.indexOf(i.id)<0&&se({transaction:e,store:o,operation:{pointer:o.pointer,path:["file_ids"],command:"listAfter",args:{id:i.id}}})}}}))};const ae=function(e,t){const o=z.Bs(),i=new Error("Potential transaction deadlock"),n=new A({spaceId:o,userId:t||e.currentUser.id,deadlockTimeoutMs:te,onDeadlockWarning:()=>{J.delete(n);const t=n.getUserActionForAnalyticsPurposesOnly();(0,a.XY)(`A ${t} transaction hasn't been committed in ${te} ms.`,[["stack =",i.stack]]),s.IE(i,{extra:{operations_count:n.operations.length},tags:{userAction:t}}),H.trackTransactionDeadlockWarning(e,{operations_count:n.operations.length,user_action:t});const o=n.operations.map((e=>({command:e.command,stringifiedArgs:(0,g.LK)({path:e.path,pointer:e.pointer})})));c.log({level:"warning",from:"transactionActions",type:"transactionDeadlockWarning",data:{userAction:t,operations:o}}),"production"!==x.Z.env&&(Y.showErrorMessage(`Warning: an uncommitted ${t} transaction remained after 5s! Check the console for a trace.`),console.warn(i))}});return n.beforeSelection=O.default.cloneState(),n.beforeTextSelection=U.default.cloneState(),J.add(n),n};function se(e){const{store:t,operation:o,transaction:i}=e,{inMemoryRecordCache:r}=t;if(i.committed)throw new Error("Transaction has already been committed.");const s=t.getRecordStoreAtRootPath().getValue(),l=t.getRecordStoreAtRootPath().getRole(),c=e.isDerived?[]:(0,f.S)(o)?(0,u.rb)(o,r.makeGetRecordValueFn(i.userId)):[v.bv(o,s)].filter(T.$K);if(i.initialRecordMap.get(t.pointer)||(l?i.initialRecordMap.set(t.pointer,{role:l,value:s}):i.initialRecordMap.set(t.pointer,void 0)),(0,f.S)(o)){const n=(0,u.T1)(o,r.makeGetRecordValueFn(i.userId));for(const i of n)o.additionalUpdatedPointers||(o.additionalUpdatedPointers=[]),o.additionalUpdatedPointers.push(i.pointer),se({...e,operation:i,isDerived:!0,store:(0,N.Kv)(t,i.pointer)});i.operations.push(o),i.invertedOperations.push(...c)}else{const l=v.lK(o,s),d=r.getRole({pointer:t.pointer,userId:t.userId}),p="update"===o.command?Object.keys(o.args).map((e=>o.path.concat([e]))):[o.path];if(G.Wl({environment:t.environment,inMemoryRecordCache:r,pointer:t.pointer,userId:t.userId,force:!0,recordWithRole:{value:l,role:d||"editor"},updatePaths:p,debugSource:i.getUserActionForAnalyticsPurposesOnly()??"applyOperation"}),"block"===t.table){const e=l;e&&e.parent_id&&"collection"===e.parent_table&&L.Z.setEditedBlock(e.parent_id,e.id),"local"===x.Z.env&&function(e){const{transaction:t,operation:o,store:i}=e;if(i.table!==S.iU)return;const r=function(e){if(e.pointer.table!==S.iU)return[];if("update"===e.command&&n().isEqual(e.path,["properties"])&&"object"==typeof e.args)return n().compact(Object.entries(e.args).map((e=>{let[t,o]=e;return Array.isArray(o)?{propertyId:t,newValue:o}:void 0})));if("set"===e.command&&"properties"===e.path[0]&&2===e.path.length&&"string"==typeof e.path[1]&&Array.isArray(e.args))return[{propertyId:e.path[1],newValue:e.args}];return[]}(o);if(0===r.length)return;const s=E.Om(i);if(!(s instanceof N.NW))return;const l=s.getSchema();for(const n of r){const e=l[n.propertyId];if("date"===(null==e?void 0:e.type)){const e=(new Error).stack,o=t.getUserActionForAnalyticsPurposesOnly();if(!ce({stack:e,userAction:o})){const e=le.flatMap((e=>"function"===e.type?[e.name]:[]));(0,a.XY)(`Detected an un-centralized access to a date property (${o})`,[`Please use one of the following helpers to update block dates: ${e.join(", ")}`])}}}}({transaction:i,operation:o,store:t})}i.isLocal=!t.shouldCacheReceiveUpdates(),e.isDerived||i.operations.push(o),c&&i.invertedOperations.push(...c),i.stores.push(t),r.appliedTransaction=!0}}const le=[{type:"function",name:"calendarActions.updateBlockDate",requiredStackTokens:["calendarActions.ts","updateBlockDate"]},{type:"function",name:"collectionTimelineViewActions.setItemDateValue",requiredStackTokens:["collectionTimelineViewActions.ts","setItemDateValue"]},{type:"userAction",allowedUserAction:"revisionActions.undoRevision"},{type:"userAction",allowedUserAction:"collectionDateActions.handleDependencyDateShifting"}];function ce(e){const{stack:t,userAction:o}=e,i=t?t.split("\n"):[];for(const n of le)if("function"===n.type){if(i.some((e=>n.requiredStackTokens.every((t=>e.includes(t))))))return!0}else if("userAction"===n.type){if(o===n.allowedUserAction)return!0}else(0,T.t1)(n);return!1}function de(e){e.cancelDeadlockWarning(),J.delete(e);const t=n().uniqBy(e.stores,(e=>e.id));for(const o of t){G.uo({inMemoryRecordCache:o.inMemoryRecordCache,defaultRecordCache:o.environment.defaultRecordCache,pointer:o.pointer,userId:o.userId,environment:o.environment});const t=e.initialRecordMap.get(o.pointer);t&&G.Wl({environment:o.environment,inMemoryRecordCache:o.inMemoryRecordCache,pointer:o.pointer,userId:o.userId,updatePaths:[[]],recordWithRole:t,debugSource:"cancelTransaction"})}}const pe=n().throttle(((e,t)=>{H.trackSaveEditsErrorModalShow(e,{errorType:t.type||t.name}),t.type===B.vZ?Y.showThrottledErrorMessage(t.message):Y.showThrottledErrorMessage(Z.default.formatMessage(ee.saveEditsError))}),3e4);function ue(e){return new Promise(((t,o)=>{J.delete(e.transaction);const i=Array.from(J).filter((e=>e.operations.length>0));var n;if(i.length>0&&H.trackTransactionRaceHazard(e.environment,{committed_transaction_user_action:e.transaction.getUserActionForAnalyticsPurposesOnly(),first_uncommitted_transaction_user_action:i[0].getUserActionForAnalyticsPurposesOnly(),uncommitted_transaction_count:i.length}),0===e.transaction.operations.length)return null===(n=V.transactionQueue.logEmptyTaskForDebugging)||void 0===n||n.call(V.transactionQueue,e.transaction.getUserActionForAnalyticsPurposesOnly()),e.transaction.committed=!0,e.transaction.done(),t();void 0===e.canUndo&&(e.canUndo=!0);const{transaction:r,canUndo:a}=e,s=function(e){for(const t of e.stores)if("block"===t.table){const e=E.Om(t);if(e&&E.qA(e).find((e=>e.table===t.table&&e.id===t.id)))return Z.default.formatMessage(ee.invalidBlockOperation)}}(r);if(s)return de(r),Y.showErrorMessage(s),void t();r.cancelDeadlockWarning();for(const e of r.preEnqueueActions)e();if(ie({environment:e.environment,transaction:r,skipUpdatingEditedMetadata:e.skipUpdatingEditedMetadata}),re(r),function(e,t){const o=t.operations.filter((e=>e.pointer.table===k.n));o.length>0&&y.dr.uniq(o.map((e=>e.pointer))).map((e=>t.initialRecordMap.get(e))).includes(void 0)&&t.postSubmitCallbacks.push((()=>{q.bi(e)}))}(e.environment,r),r.afterSelection=O.default.cloneState(),r.afterTextSelection=U.default.cloneState(),a&&X.K9({transaction:r,undoCheckpoint:e.undoCheckpoint}),$&&console.log("Committing transaction",r),r.isLocal){for(const e of r.postEnqueueActions)e();r.done(),t()}else{const i=e=>{r.done(e),e?o(e):t()},{LocalBacklinkStore:n,currentUser:a}=e.environment;n&&async function(e,t){const{LocalBacklinkStore:o,currentUser:i}=e;if(0===t.stores.length)return;const n=t.stores[0].inMemoryRecordCache,r=[],a=y.Ak.create(),s=new Set;for(const p of t.stores)s.has(p.id)||(s.add(p.id),r.push(p.pointer),a.set(p.pointer,p.getRecordStoreAtRootPath().getValue()));const{createdBacklinks:l,deletedBacklinks:c}=await(0,W.xU)({loadRecordValue:j.zF.fromGetRecordValueFn(n.makeGetRecordValueFn(i.id)),operationPointers:r,initialRecordMap:K.DI(t.initialRecordMap),finalRecordMap:a}),d=o.updateBacklinks({createdBacklinks:l,deletedBacklinks:c,currentUserId:i.id});t.postSubmitCallbacks.push((e=>{e&&o.resetBacklinkState({blockIds:d,currentUserId:i.id})}))}({LocalBacklinkStore:n,currentUser:a},r);const s=Date.now();s<Q&&H.trackTransactionTimestampRegression(e.environment,{regression_amount:Q-s}),Q=s,V.transactionQueue.enqueueTask((0,D.JG)({transaction:r,timestamp:s,callback:i})).catch((t=>{c.log({level:"error",from:"transactionActions",type:"enqueueTask",error:(0,g.Ui)(t)}),e.environment.device.isMobileNative&&"SqliteOutOfSpace"===t.name||pe(e.environment,t),de(r),i(t)}));for(const e of r.postEnqueueActions)e()}r.committed=!0}))}function me(e){const{userAction:t,environment:o,userId:i,perform:n,canUndo:a,undoCheckpoint:l,transactionTooBigFallback:d,skipUpdatingEditedMetadata:p,useSudoMode:u}=e;return r.Z.withListenerIgnored((()=>{const r=ae(o,i);let h;r.annotateWithUserAction(t),u&&(r.useSudoMode=!0);try{h=n(r),function(e){if(e.isLocal)return;for(const t of e.stores)if(t.inMemoryRecordCache.recordHasTemporaryData(t))throw new m.p8(`Transaction "${e.getUserActionForAnalyticsPurposesOnly()}" is manipulating a store with temporary local changes!`)}(r);for(const e of r.postPerformAssertions)e()}catch(f){de(r);const e=r.getUserActionForAnalyticsPurposesOnly();throw s.IE(f,{tags:{userAction:e}}),c.log({level:"error",from:"transactionActions",type:"createAndCommit",error:(0,g.Ui)(f),data:{userAction:e,spaceId:r.spaceId}}),"production"!==x.Z.env&&(Y.showErrorMessage(`Warning: a ${e} transaction threw an exception! Check the console for a trace.`),console.error(f)),f}finally{0}if(d&&(0,D.jQ)(r))return de(r),me({...e,perform:d,transactionTooBigFallback:void 0,userAction:`${t} transactionTooBigFallback`});return{performResult:h,serverCommitResult:ue({environment:o,transaction:r,canUndo:a,undoCheckpoint:l,skipUpdatingEditedMetadata:p})}}))}async function ge(e){const{environment:t,perform:o,waitForServerCommit:i,userAction:n,userId:r,canUndo:a,undoCheckpoint:l,useSudoMode:d}=e,p=ae(t,r);let u;p.annotateWithUserAction(n),d&&(p.useSudoMode=!0);try{u=await o(p);for(const e of p.postPerformAssertions)e()}catch(h){const t=p.getUserActionForAnalyticsPurposesOnly();J.delete(p);const o=p.operations.length>0;throw o&&H.trackTransactionAsyncDataLoss(e.environment,{user_action:t,operation_count:p.operations.length}),s.IE(h,{tags:{userAction:t,transactionOperationCount:p.operations.length}}),c.log({level:"error",from:"transactionActions",type:"createAndCommitAsync",error:(0,g.Ui)(h),data:{message:o?`POSSIBLE DATA LOSS: asynchronous transaction had ${p.operations.length} operations`:void 0,userAction:t}}),"production"!==x.Z.env&&(Y.showErrorMessage(`Warning: an asynchronous ${t} transaction threw an exception! Check the console for a trace.`),console.error(h)),h}const m=ue({environment:t,transaction:p,canUndo:a,undoCheckpoint:l});return i&&await m,{performResult:u,serverCommitResult:m}}},63113:(e,t,o)=>{o.d(t,{_w:()=>D,vs:()=>E,Cj:()=>R,uo:()=>A});var i=o(96486),n=o.n(i),r=o(1302),a=o(41432),s=o(26825),l=o(27006),c=o(4615),d=o(21202),p=o(70203),u=o(22858),m=o(65598),g=o(35328),h=o(3815),f=o(26664),v=o(41433),y=o(94419),b=o(10279),S=o(9953),w=o(42858),k=o(24677),C=o(21325),_=o(98104),M=o(29373),T=o(73959),I=o(55367),P=o(96802),x=o(13084);function B(e,t){const{store:o,transaction:i,disableAutoChildrenMove:n}=e;return n||function(e){const{environment:t,store:o,transaction:i}=e,n=(0,T.sQ)(o),r=(null==n?void 0:n.getContentStores())||[];let a=!1;const s=r.filter((e=>{return a?(t=e.getType(),i=o.getType(),!(!t||!i||t===i||"divider"===t||"collection_view"===t||"sub_header"===i&&"header"===t||"sub_sub_header"===i&&("header"===t||"sub_header"===t))||(a=!1,!1)):(e===o&&(a=!0),!1);var t,i}));x.LQ({environment:t,targetParentStore:o.getContentStore(),droppedDirection:I.vh.Below,droppedStores:s,duplicate:!1,transaction:i})}(e),P.FH({stores:[o],update:{toggleable:t},transaction:i})}var Z=o(30149);function E(e){const{environment:t,block:o,blockType:i,transaction:r,isMultiBlockTransformation:c}=e,d=o.getType(),m=o.getFormat(),h=o.recordStoreUIParentStore;if(C.M_(t)&&d&&!function(e,t){const o=e.type,i=e.format;if(g.ih(t)){var n;return"mermaid_code_block"===t?e.type===a.Ti.code&&"Mermaid"===p.Q(null===(n=e.properties)||void 0===n?void 0:n.language):(0,a.Fx)(t)?g.tZ(t)===e.type&&(0,a.eJ)(o,i):g.tZ(t)===e.type}return e.type===t&&!(0,a.eJ)(o,i)}({type:d,format:m,properties:o.getProperties()},i)){const e=d,p=g.ih(i)?g.tZ(i):i;if(S.sW({store:o,data:{type:p},transaction:r}),(0,a.Fx)(i)&&!g.fn(o)?function(e){B(e,!0)}({environment:t,store:o,transaction:r,disableAutoChildrenMove:Boolean(c)}):!(0,a.Fx)(i)&&g.fn(o)&&function(e){const{store:t}=e;t.recordStoreUIParentStore&&B(e,!1)}({environment:t,store:o,transaction:r,disableAutoChildrenMove:Boolean(c)}),"mermaid_code_block"===i&&u.E({blocks:[o],language:"Mermaid",transaction:r}),a.Z7[e]&&!a.Z7[i]){(0,s.uO)({permissions:o.getPermissionItems()}).some(l.Le)&&b.MX({environment:t,store:o,transaction:r})}g.BX(o)&&M.rd({blockId:o.id,state:!0,currentUserId:t.currentUser.id});const f=o.getType();f&&h&&d&&(0,a.Um)(d,m)&&!(0,a.Um)(f,o.getFormat())&&function(e){let{environment:t,block:o,parentStore:i}=e;(async()=>{const e=o.getContentStores();await Promise.all(e.map((e=>e.load()))),Z.createAndCommit({userAction:"transformActions.runAsync",environment:t,perform:t=>{const r=n().clone(e).reverse();for(const e of r)y.Od({parent:o.getContentStore(),childToRemove:e,transaction:t}),y.BE({parent:i,insert:e,after:o,transaction:t})}})})()}({environment:t,parentStore:h,block:o}),v.jf({store:o,transaction:r})}return o}function R(e){const{environment:t,blocks:o,blockType:i,transaction:s}=e;if(i!==a.Ti.transclusionContainer)if(i!==a.Ti.columnList)if((0,a.sX)(i)){const e=parseInt(i.replace("column","").replace("block","")),a=n().compact(n().times(e-1,(()=>w.ZJ({environment:t,blocks:o,transaction:s})))),l=[...o,...a],c=A({environment:t,blocks:l,transaction:s});r.default.afterNextFlush((()=>{_.N_({store:c[0].getBlockTitleStore()})}))}else for(const n of o)E({environment:t,block:n,blockType:i,transaction:s,isMultiBlockTransformation:o.length>1});else A({environment:t,blocks:o,transaction:s});else!function(e){const{environment:t,blocks:o,transaction:i}=e,n=o[0];if(!n)return;const r=n.getRecordStoreUIParent();if(!r||!(0,m.dz)(r))return;const s=r.getRecordStoreUIParent();if(!s||!(0,m.NZ)(s))return;if(!s.isDefined())return;const l=(0,c.ZP)(),p={id:l,type:a.Ti.transclusionContainer,parent_id:r.id,parent_table:"block",space_id:s.getSpaceId(),alive:!0};S.ae({environment:t,table:"block",value:p,inMemoryRecordCache:r.inMemoryRecordCache,transaction:i});const u=h.G.createChildStore(r,{table:d.iU,id:l}),g=u.getContentStore();y.BE({parent:r,insert:u,after:n,transaction:i}),function(e){const{newParent:t,blocks:o,transaction:i}=e;for(const n of o){const e=n.getRecordStoreUIParent();null!=e&&e.valueIs(f.i)&&(y.Od({parent:e,childToRemove:n,transaction:i}),y.R3({parent:t,append:n,transaction:i}))}}({newParent:g,blocks:o,transaction:i}),_.ZH(t),k.ZH(t),k.Z5({environment:t,stores:[u]})}({environment:t,blocks:o,transaction:s})}function A(e){const{environment:t,blocks:o,transaction:i}=e,n=o[0];if(!n)return[];const r=n.recordStoreUIParentStore;if(null==r||!r.valueIs(f.i))return[];const s=(0,c.ZP)(),l={id:s,type:a.Ti.columnList,parent_id:r.id,parent_table:"block",space_id:n.getSpaceId(),alive:!0};S.ae({environment:t,table:"block",value:l,inMemoryRecordCache:n.inMemoryRecordCache,transaction:i});const p=h.G.createChildStore(r,{table:d.iU,id:s}),{child:u}=y.Vt({parent:r,insert:p,before:n,transaction:i});return o.map((e=>{const o=(0,c.ZP)(),n={id:o,type:a.Ti.column,parent_id:p.id,parent_table:"block",space_id:e.getSpaceId(),alive:!0};S.ae({environment:t,table:"block",value:n,inMemoryRecordCache:e.inMemoryRecordCache,transaction:i});const s=h.G.createChildStore(u.getContentStore(),{table:d.iU,id:o}),{child:l}=y.Od({parent:r,childToRemove:e,transaction:i}),{child:m}=y.BE({parent:u.getContentStore(),insert:s,transaction:i}),{child:g}=y.BE({parent:m.getContentStore(),insert:l,transaction:i});return g}))}function D(e){let{environment:t,blocks:o,transaction:i}=e;(function(e){return 1===e.length&&"collection_view"===e[0].getType()})(o)&&R({environment:t,blocks:o,blockType:"collection_view_page",transaction:i})}},39865:(e,t,o)=>{o.d(t,{cB:()=>y,y8:()=>b,Rn:()=>S,Tq:()=>w});var i=o(1144),n=o(98459),r=o(21202),a=o(5366),s=o(33929),l=o(79315),c=o(43339),d=o(50906),p=o(54642),u=o(47307),m=o(19785),g=o(5978),h=o(74647),f=o(65452);const v=(0,a.defineMessages)({deletePageConfirmationMessage:{id:"trashActions.deletePagePermanentlyDialog.prompt",defaultMessage:"Are you sure you want to delete this page permanently?"},deletePageConfirmationButton:{id:"trashActions.deletePagePermanentlyDialog.confirmDeleteButton.label",defaultMessage:"Yes. Delete this page"}});async function y(e){const{environment:t,block:o,spaceId:i}=e;c.Z.state.excludePages.add(o.id),c.Z.emit(),await p.restoreBlock(t,{pointer:{table:r.iU,id:o.id,spaceId:i}}),g.navigateToBlock({environment:t,store:o}),t.device.isMobile&&h.close(),d.trackRestoreTrashPage(t)}function b(e){const{environment:t,blocks:o,transaction:r}=e;for(const n of o){const e=n.getParentStore();e&&((0,i.A6)(e.table,n.table)?m.hr({parentStore:e,childStore:n,transaction:r}):m.hh({childStore:n,transaction:r}))}r.postSubmitCallbacks.push((async e=>{e||await p.deleteBlocks(t,{blocks:o.map((e=>({id:e.id,spaceId:(0,n.CG)(e.pointer.spaceId)}))),permanentlyDelete:!1})}))}function S(e){u.showDialog({message:s.default.formatMessage(v.deletePageConfirmationMessage),showCancel:!0,keepFocus:!1,items:[{label:s.default.formatMessage(v.deletePageConfirmationButton),color:"red",onAccept:()=>w(e)}]})}async function w(e){const{blocks:t,environment:o}=e,{currentSpaceStore:i}=l.default.state,r=e.environment.currentUser.id;if(i&&r){for(const e of t)c.Z.state.excludePages.add(e.id),c.Z.emit();await p.deleteBlocks(e.environment,{blocks:t.map((e=>({id:e.id,spaceId:(0,n.CG)(e.pointer.spaceId)}))),permanentlyDelete:!0}),await f.l({environment:o,spaceId:i.id,userId:r}),g.navigateAwayIfCurrentPage({environment:e.environment,blocks:t}),d.trackDeleteTrashPage(o)}}},761:(e,t,o)=>{o.d(t,{KT:()=>fe,FD:()=>be,xv:()=>ve,pt:()=>me,os:()=>xe,dY:()=>_e,pJ:()=>he,hJ:()=>ye,UY:()=>ke,yp:()=>we,sz:()=>Ze,aV:()=>Ee,qK:()=>Re});var i=o(96486),n=o.n(i),r=o(26263),a=o(1302),s=o(41432),l=o(99036),c=o(80951),d=o(95538),p=o(2864),u=o(65917),m=o(20270),g=o(4615),h=o(45953),f=o(98459),v=o(21202),y=o(77420),b=o(6287),S=o(13493),w=o(32161),k=o(9844),C=o(90965),_=o(5500),M=o(70203),T=o(97880),I=o(44876),P=o(64002),x=o(63143),B=o(5366),Z=o(43132),E=o(94419),R=o(9953),A=o(24677),D=o(993),F=o(98104),L=o(30149),V=o(95477),N=o(65454),O=o(10161);var U=o(70764),H=o(41232),z=o(28415),W=o(33929),j=o(65598),K=o(72133),Y=o(58202),G=o(79315),X=o(88833),q=o(30874),$=o(79167),J=o(19111),Q=o(3815),ee=o(1634),te=o(80064),oe=o(40671),ie=o(50906),ne=o(54642),re=o(85266),ae=o(5149),se=o(47307),le=o(77719),ce=o(27153),de=o(4408),pe=o(21325);const ue=(0,B.defineMessages)({browse:{id:"externalBlock.mediaPicker.browseTab.title",defaultMessage:"Browse {appName}",description:"Shown in the media picker tab title"},somethingWentWrong:{defaultMessage:"Something went wrong.",id:"externalActions.dialogError.openFilePicker.errorMessage",description:"Shown in the dialog if fetching bot access token fails"},copyDebuggingInformation:{id:"externalActions.dialogItem.openFilePicker.copyDebugData",defaultMessage:"Copy debugging information",description:"When a file picker fails to load, the user can click this button to copy debugging information to their clipboard to send to support."},copiedDebuggingInfo:{id:"externalActions.dialogError.copiedDebuggingInfo",defaultMessage:"Copied to clipboard.",description:"Displays in tiny modal after clicking 'copy debugging info' to let the user know the information is copied to their clipboard."}});async function me(e){const{environment:t,spaceId:o,force:i}=e;await G.default.waitUntilRendered();const r=q.Z.state;if(!r.loaded&&!r.loading||r.loaded&&o!==r.spaceId||i){q.Z.setState({...q.Z.state,loading:!0});const[e,i]=await Promise.all([ne.getExternalIntegrations(t,{spaceId:o}),ge({environment:t,spaceId:o})]);if("success"!==e.type||"success"!==i.type)throw new Error("Request failed.");const r=h.Ak.create(e.data.recordMap),a=h.Ak.create(i.data.recordMap);q.Z.setState({loaded:!0,loading:!1,spaceId:o,integrations:n().sortBy(n().compact(e.data.integrationIds.map((e=>{var t;return null===(t=r.get({table:k.K2,id:e}))||void 0===t?void 0:t.value}))),(e=>{let{created_at:t}=e;return t})),externalAuthentications:n().sortBy(n().compact(i.data.externalAuthenticationIds.map((e=>{var t;return null===(t=a.get({table:w.P,id:e}))||void 0===t?void 0:t.value}))),(e=>{let{created_at:t}=e;return t})),bots:n().orderBy(n().compact(i.data.botIds.map((e=>{var t;return null===(t=a.get({table:y.cZ,id:e}))||void 0===t?void 0:t.value}))),(e=>{let{last_edited_at:t,created_at:o}=e;return t||o}),"desc"),completeSlackAuthentications:n().sortBy(n().compact(i.data.completeSlackAuthenticationIds.map((e=>{var t;return null===(t=a.get({table:w.P,id:e}))||void 0===t?void 0:t.value}))),(e=>{let{created_at:t}=e;return t}))})}}async function ge(e){const{environment:t,spaceId:o}=e;return t.currentUser.isLoggedIn()?await ne.getUserSpaceExternalBots(t,{spaceId:o}):{type:"success",status:200,headers:{},data:{botIds:[],externalAuthenticationIds:[],recordMap:{},completeSlackAuthenticationIds:[]}}}async function he(e){const{environment:t}=e,{currentSpaceStore:o}=G.default.state;o&&await me({environment:t,spaceId:o.id,force:!0})}function fe(e){const{environment:t,blockStore:o,textStore:i,url:l,textValueBeforePaste:c,urlSelection:p}=e,m=K.get();if(!o||X.Z.state.open||J.Z.state.open||te.Z.state.open||!m)return!1;const{currentSpaceStore:h}=G.default.state,y=(0,d.x$)(l),w=(0,P.Qc)(y);if(!w.host)return!1;const k=t.currentUser.id;if(null==h||!h.isDefined()||!k)return!1;const T=q.Z.integrations.state.filter((e=>e.id!==_.U9)),x=(0,I.ny)({url:y,integrations:T,currentSpaceId:h.id});if("partial"===x.type)return function(e){const{environment:t,parsedUrl:o,urlDomain:i,integrationId:n}=e;ie.trackLinkPreviewUrlMiss(t,{integrationId:n,urlDomain:i}),u.log({level:"debug",from:"activateFromLinkCreation",type:"linkPreviewUrlMiss",data:{miscDataToConvertToString:{integrationId:n,urlDomain:i,path:o.path}}})}({...x,integrationId:x.integration.id,environment:t}),!1;if("failure"===x.type)return!1;const{integration:B,pattern:Z}=x;if(!(0,C.wv)({permissions:h.getPermissionItems()},k)&&!(0,C.hU)({spaceBotSettings:h.getBotSettingsStore().getValue(),integrationId:B.id,env:V.Z.env}))return!1;const E=(0,U.NP)(B.id),R=function(e){var t;const{integration:o,pattern:i,blockStore:r,textValueBeforePaste:a}=e,l=r&&r.getType()===s.Ti.text&&0===(0,M.Q)(a).trim().length,c=Boolean(null===(t=i.additional_types)||void 0===t?void 0:t.collection);return l?n().compact(["preview","mention","link",c&&"collection"]):n().compact(["mention","preview","link",c&&"collection"])}({blockStore:o,integration:B,pattern:Z,textValueBeforePaste:c}),A=K.getRect(m);if(!A)return!1;const D=o.getRecordStoreUIParent();if(!D||!(0,j.dz)(D))return!1;const F=new r.Z;F.isTemporaryData=!0,t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(F);const N=D.clone(F),O=o.clone(F),H=i.clone(F),z=new Q.G(t,{table:v.iU,id:(0,g.ZP)(),spaceId:o.pointer.spaceId}),Y=z.clone(F),$=n().range(I.wh).map((()=>new Q.G(t,{table:v.iU,id:(0,g.ZP)(),spaceId:(0,f.CG)(o.pointer.spaceId)}))),ee=$.map((e=>e.clone(F))),oe=new Q.NW(t,{table:b.v,id:(0,g.ZP)(),spaceId:o.pointer.spaceId}),ne=oe.clone(F);let re;re=Z.defaultViews?Z.defaultViews.map((e=>new Q.Xr(t,{table:S.n,id:(0,g.ZP)(),spaceId:o.pointer.spaceId}))):[new Q.Xr(t,{table:S.n,id:(0,g.ZP)(),spaceId:o.pointer.spaceId})];const ae=re.map((e=>e.clone(F))),se=n().range(I.wh).map((()=>new Q.NW(t,{table:b.v,id:(0,g.ZP)(),spaceId:o.pointer.spaceId}))),le=se.map((e=>e.clone(F))),ce=n().range(I.wh).map((()=>new Q.Xr(t,{table:S.n,id:(0,g.ZP)(),spaceId:o.pointer.spaceId}))),de=ce.map((e=>e.clone(F)));return te.Z.setState({open:!0,url:y,textValueBeforePaste:c,textValueAfterPaste:i.getValue(),urlSelection:p,renderRect:A,integration:B,pattern:Z,currentOption:{type:"link"},allOptionTypes:R,temporaryRecordCache:F,stores:{blockStore:o,blockParentStore:D,textStore:i,externalObjectInstanceBlockStore:z,subExternalObjectInstanceBlockStores:$,externalCollectionStore:oe,externalCollectionViewStores:re,subExternalCollectionStores:se,subExternalCollectionViewStores:ce},temporaryStores:{blockParentStore:N,blockStore:O,textStore:H,externalObjectInstanceBlockStore:Y,subExternalObjectInstanceBlockStores:ee,externalCollectionStore:ne,externalCollectionViewStores:ae,subExternalCollectionStores:le,subExternalCollectionViewStores:de},unfurlResponse:void 0}),E.length>0&&Se({environment:t,url:l,botIds:E.map((e=>{let{id:t}=e;return t})),integrationId:B.id,externalObjectInstanceBlockStore:z}),ie.trackActivateLinkPreviewMenu(t,{integrationId:B.id,entity:Z.name,domain:w.host,from:"link_paste"}),a.default.afterNextFlush((()=>{L.createAndCommit({userAction:"unfurlingActions.activateFromLinkCreation",environment:t,perform:e=>{ye({environment:t,type:R[0],useTemporaryRecordCache:!0,transaction:e,intl:W.default.getIntl()})}})})),!0}function ve(e){const{environment:t,setType:o,transaction:i}=e,{currentUserSettingsStore:n}=G.default.state,r=te.Z.state;if(!r.open)return;t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(r.temporaryRecordCache);const a=(0,U.NP)(r.integration.id).length>0;if(ye({environment:t,type:o||r.currentOption.type,useTemporaryRecordCache:!1,transaction:i,intl:W.default.getIntl()}),"preview"===r.currentOption.type&&A.Z5({environment:t,stores:[r.currentOption.externalObjectInstanceBlockStore]}),r.integration&&!a){(null==n?void 0:n.hasDismissedIntegrationPopup({integrationId:r.integration.id}))||ee.Z.setState({open:!0,integration:r.integration,externalObjectInstanceBlockId:r.stores.externalObjectInstanceBlockStore.id,unfurlUrl:r.url})}te.Z.setState({open:!1})}function ye(e){const{environment:t,type:o,transaction:i,useTemporaryRecordCache:r}=e,l=te.Z.state;if(!l.open)return;const c=t.currentUser.id;if(!c)return;const u=r?l.temporaryStores:l.stores;if(r){l.temporaryRecordCache.clearCache();for(const e in l.temporaryStores){const o=l.temporaryStores[e],i=n().isArray(o)?o:[o];for(const e of i){const o={userId:c,pointer:e.pointer},i=t.defaultRecordCache.inMemoryRecordCache.getRecord(o);de.Wl({environment:t,inMemoryRecordCache:l.temporaryRecordCache,pointer:e.pointer,recordWithRole:i,updatePaths:[[]],userId:c,force:!0,debugSource:"setUnfurlingOptionType"})}}}const m=(0,d.x$)(l.url),{host:g}=(0,P.Qc)(m);if(g){if("preview"===o||"mention"===o){const{unfurlResponse:e}=l,t=Ae({externalObjectInstanceBlockStore:u.externalObjectInstanceBlockStore,parentId:u.blockParentStore.id}),o={original_url:m,domain:g};let r;if(e){const a=(0,x.m8)(n().compact(e.relations.map(((e,t)=>{if(e.external_schema)return;const o=u.subExternalObjectInstanceBlockStores[t];if(!o)return;const n=e,r={id:o.id,type:s.Ti.externalObjectInstance,space_id:(0,f.CG)(u.blockStore.pointer.spaceId),parent_table:v.iU,parent_id:u.externalObjectInstanceBlockStore.id,alive:!0,format:n};return R.sW({store:o,data:r,transaction:i}),[e.uri,o.id]})))),{external_object_id:l,uri:c,bot_id:d}=e.root;if(l&&c&&d){let i,n;const s=(0,p.o)(e.root.attributes,(0,H.o$)());s&&(i=s.block_width,n=s.block_height);const u={...o,...{...e.root,block_width:i,block_height:n,external_schema:void 0},related_external_object_uris_to_instance_ids:a,external_object_id:l,uri:c,bot_id:d};r={...t,format:u}}else{var h;const i={...o,attributes:e.root.attributes,error:e.root.error,auth_refresh_in_progress:439===(null===(h=e.root.error)||void 0===h?void 0:h.status_code)||null};r={...t,format:i}}}else{const e=o;r={...t,format:e}}R.sW({store:u.externalObjectInstanceBlockStore,data:r,transaction:i})}else if("collection"===o){const{unfurlResponse:e}=l,t={id:u.externalObjectInstanceBlockStore.id,version:0,type:s.Ti.collectionView,format:{collection_pointer:u.externalCollectionStore.pointer},collection_id:u.externalCollectionStore.pointer.id,space_id:(0,f.CG)(u.blockStore.pointer.spaceId),parent_table:v.iU,parent_id:u.blockParentStore.id,alive:!0,view_ids:u.externalCollectionViewStores.map((e=>e.id))},o=u.externalCollectionViewStores.map(((e,t)=>{var o,i,n;return{id:e.id,version:0,space_id:(0,f.CG)(u.blockStore.pointer.spaceId),type:(null===(o=l.pattern.defaultViews)||void 0===o?void 0:o[t].type)||"table",format:null===(i=l.pattern.defaultViews)||void 0===i?void 0:i[t].format,query2:null===(n=l.pattern.defaultViews)||void 0===n?void 0:n[t].query2,parent_table:v.iU,parent_id:u.externalObjectInstanceBlockStore.id,alive:!0}}));let n;if(e){const{external_object_id:o,uri:r,bot_id:a}=e.root;if(o&&r&&a)if("collectionId"in e&&e.collectionId){n={id:e.collectionId,version:0,space_id:(0,f.CG)(u.blockStore.pointer.spaceId),parent_table:v.iU,parent_id:u.externalObjectInstanceBlockStore.id,alive:!0,schema:{}},t.format=void 0,t.collection_id=e.collectionId}else{const t={};e.relations.forEach(((e,o)=>{const n=u.subExternalCollectionStores[o],r=e,a={id:n.id,version:0,space_id:(0,f.CG)(u.blockStore.pointer.spaceId),parent_table:b.v,parent_id:u.externalCollectionStore.id,alive:!0,format:r,schema:{}};t[e.uri]=n.id,R.sW({store:n,data:a,transaction:i})}));n={id:u.externalCollectionStore.id,version:0,space_id:(0,f.CG)(u.blockStore.pointer.spaceId),parent_table:v.iU,parent_id:u.externalObjectInstanceBlockStore.id,alive:!0,format:{original_url:m,domain:g,...e.root,related_external_object_uris_to_instance_ids:{...t}},schema:{}}}else{n={id:u.externalCollectionStore.id,version:0,space_id:(0,f.CG)(u.blockStore.pointer.spaceId),parent_table:v.iU,parent_id:u.externalObjectInstanceBlockStore.id,alive:!0,format:{original_url:m,domain:g,error:e.root.error},schema:{}}}}else{n={id:u.externalCollectionStore.id,version:0,space_id:(0,f.CG)(u.blockStore.pointer.spaceId),parent_table:v.iU,parent_id:u.externalObjectInstanceBlockStore.id,alive:!0,format:{original_url:m,domain:g},schema:{}}}R.sW({store:u.externalObjectInstanceBlockStore,data:t,transaction:i}),u.externalCollectionViewStores.forEach(((t,n)=>{e&&"collectionId"in e&&e.collectionId&&o[n].format&&(o[n].format={collection_pointer:{id:e.collectionId,table:b.v}}),R.sW({store:t,data:o[n],transaction:i})})),R.sW({store:u.externalCollectionStore,data:n,transaction:i});const r=l.integration;a.default.afterNextFlush((()=>{const e=Y.R.findCollectionViewBlockFromId(u.externalObjectInstanceBlockStore.id);if(e){const t=e.collectionContextStore.settingsStore;ae.wl({collectionSettingsStore:t,item:{type:"shareSyncedView",integrationName:r.name,integrationIcon:r.info.icon}})}}))}if("preview"===o){D.sO({environment:t,store:u.textStore,value:l.textValueBeforePaste,transaction:i});const e=Q.G.createChildStore(u.blockParentStore,u.externalObjectInstanceBlockStore.pointer);if(E.BE({parent:u.blockParentStore,insert:e,after:u.blockStore,transaction:i}),0===(0,M.Q)(l.textValueBeforePaste).trim().length){const e=Q.G.createChildStore(u.blockParentStore,l.stores.blockStore.pointer);E.Od({parent:u.blockParentStore,childToRemove:e,transaction:i})}const n=Q.G.createChildStore(l.stores.blockParentStore,l.stores.externalObjectInstanceBlockStore.pointer);A.ZH(t),te.Z.setState({...l,currentOption:{type:o,externalObjectInstanceBlockStore:n}})}else if("mention"===o){const e=(0,M.x3)(u.externalObjectInstanceBlockStore.id),o=(0,M.YC)(e),n=(0,M.P$)(l.textValueBeforePaste,[o],l.urlSelection.startIndex),r={startIndex:l.urlSelection.startIndex+1,endIndex:l.urlSelection.startIndex+1};D.sO({environment:t,store:u.textStore,value:n,transaction:i}),R.sW({store:u.externalObjectInstanceBlockStore,data:{parent_id:u.textStore.id,parent_table:v.iU,alive:!0},transaction:i}),A.eP({environment:t,store:l.stores.blockStore}),F.Z5({store:l.stores.textStore,selection:r}),te.Z.setState({...l,currentOption:{type:"mention",mentionTokenSelection:r}})}else if("link"===o)te.Z.setState({...l,currentOption:{type:"link"}}),A.eP({environment:t,store:l.stores.blockStore}),F.Z5({store:l.stores.textStore,selection:{startIndex:l.urlSelection.endIndex,endIndex:l.urlSelection.endIndex}});else if("collection"===o){D.sO({environment:t,store:u.textStore,value:l.textValueBeforePaste,transaction:i});const e=Q.G.createChildStore(u.blockParentStore,u.externalObjectInstanceBlockStore.pointer);if(E.BE({parent:u.blockParentStore,insert:e,after:u.blockStore,transaction:i}),0===(0,M.Q)(l.textValueBeforePaste).trim().length){const e=Q.G.createChildStore(u.blockParentStore,l.stores.blockStore.pointer);E.Od({parent:u.blockParentStore,childToRemove:e,transaction:i})}A.ZH(t),te.Z.setState({...l,currentOption:{type:o}})}else(0,T.t1)(o);if(!r){const{unfurlResponse:e}=l;ie.trackSaveLinkPreview(t,{integrationId:l.integration.id,type:o,entity:l.pattern.name,domain:g,from:"unfurl_menu",...e&&{status:null!=e&&e.root.error?"failure":"success"},collection_id:"collection"===o?u.externalCollectionStore.pointer.id:void 0,collection_view_block_id:"collection"===o&&u.blockStore.isCollectionView()?u.blockStore.id:void 0})}}}async function be(e){const{environment:t,notionState:o}=e,{externalObjectInstanceBlockId:i,spaceId:n}=o;if(i){const e=new Q.G(t,{table:v.iU,id:i,spaceId:n});let o;if(await Promise.all([e.load(),q.Z.waitUntil((()=>q.Z.state.loaded))]),e.isExternalObjectInstanceBlockStore())o=e.getFormat();else if(e.isCollectionView()){var r;o=null===(r=e.getCollectionViewSourceCollectionStore())||void 0===r?void 0:r.getFormat()}if(!o)throw new Error("External object instance has no value.");const a=o.original_url;if(!a)throw new Error("External object instance has no original_url.");const s=(0,I.ny)({url:a,integrations:q.Z.integrations.state,currentSpaceId:n});if("success"!==s.type)throw new Error("Could not find integration.");const{integration:l}=s,c=(0,U.NP)(l.id);if(0===c.length)throw new Error("Could not find bot.");if(e.isExternalObjectInstanceBlockStore())await Se({environment:t,url:a,botIds:c.map((e=>{let{id:t}=e;return t})),integrationId:l.id,externalObjectInstanceBlockStore:e});else{if(!e.isCollectionView())throw new Error(`BlockStore is neither an ExternalObject nor a ExternalCollection. It has type: ${e.getType()}`);{const o=e.getCollectionViewSourceCollectionStore();if(!o)throw new Error("Could not find collection store.");await ke({environment:t,url:a,botIds:c.map((e=>{let{id:t}=e;return t})),externalCollectionViewBlockStore:e,externalCollectionStore:o})}}}}async function Se(e){const{environment:t,url:o,botIds:i,integrationId:r,externalObjectInstanceBlockStore:a}=e;oe.Z.add(o);const l=await ne.unfurlUrl(t,{url:o,botIds:i,integrationId:r,spaceId:re.Bs()});oe.Z.delete(o);const c=te.Z.state,u="success"===l.type?l.data:{root:{error:{status_code:l.status}},relations:[]};if(c.open&&c.stores.externalObjectInstanceBlockStore===a)te.Z.setState({...c,unfurlResponse:u}),L.createAndCommit({userAction:"unfurlingActions.startUnfurlRequest",environment:t,perform:e=>{ye({environment:t,type:c.currentOption.type,useTemporaryRecordCache:!0,transaction:e,intl:W.default.getIntl()})}});else if(a.isExternalObjectInstanceBlockStore())!function(e){const{environment:t,unfurlResponse:o,url:i,externalObjectInstanceBlockStore:r}=e,a=r.pointer.spaceId;if(!t.currentUser.id)return;const l=(0,d.x$)(i),{host:c}=(0,P.Qc)(l);if(!c)return;if("collectionId"in o)return;const u=r.getFormat().related_external_object_uris_to_instance_ids,m=(0,x.m8)(Object.entries(u||{}).map((e=>{let[t,o]=e;return[t,Q.G.createChildStore(r,{id:o,table:v.iU,spaceId:r.getSpaceId()})]})));L.createAndCommit({userAction:"unfurlingActions.createExternalObjectInstanceFromInitialUnfurl",environment:t,perform:e=>{const l=(0,x.m8)(n().compact(o.relations.map((o=>{var i;if(o.external_schema)return;const n=(null===(i=m[o.uri])||void 0===i?void 0:i.id)||(0,g.ZP)(),l=new Q.G(t,{table:v.iU,id:n,spaceId:a}),c=o,d={id:l.id,type:s.Ti.externalObjectInstance,space_id:a,parent_table:v.iU,parent_id:r.id,alive:!0,format:c};return R.sW({store:l,data:d,transaction:e}),[o.uri,l.id]})))),c=r.getFormatStore().getValue();let d,u;if(c&&(d=c.block_width,u=c.block_height),!d&&!u){const e=(0,p.o)(o.root.attributes,(0,H.o$)());e&&(d=e.block_width,u=e.block_height)}R.sW({store:r.getFormatStore(),data:{...{...o.root,block_width:d,block_height:u,external_schema:void 0,integration_id:null,original_url:i,is_placeholder:null,error:o.root.error??null},related_external_object_uris_to_instance_ids:l},transaction:e})}})}({environment:t,unfurlResponse:u,url:o,externalObjectInstanceBlockStore:a}),function(e){const{environment:t,url:o,spaceId:i,status:n}=e,r=(0,H.GQ)(o,i),a=(0,d.x$)(o),s=(0,P.Qc)(a);r&&s.host&&ie.trackSaveLinkPreview(t,{integrationId:r.integration.id,type:"preview",entity:r.pattern.name,domain:s.host,from:"link_preview_placeholder",...n&&{status:n}})}({environment:t,url:o,spaceId:a.getSpaceId(),...u&&{status:u.root.error?"failure":"success"}});else{if(!a.isCollectionView()){if(a.isExternalObjectInstancePageBlockStore())return;throw new Error(`BlockStore is neither an ExternalObject nor a ExternalCollection. It has type: ${a.getType()}`)}{const e=a.getCollectionViewSourceCollectionStore();if(!e)throw new Error("Could not find collection store.");L.createAndCommit({userAction:"unfurlingActions.startUnfurlRequest",environment:t,perform:i=>{Ce({environment:t,unfurlResponse:u,url:o,externalCollectionStore:e,externalCollectionViewBlockStore:a,transaction:i})}})}}}async function we(e){const{environment:t,url:o,botIds:i,userDefinedExternalCollectionStore:n,relatedPageId:r}=e,a=n.getFormat();if(!a.uri||void 0!==a.external_object_id)return;oe.Z.add(o);const l=await ne.unfurlUrl(t,{url:o,botIds:i,spaceId:n.getSpaceId(),targetCollectionId:n.id,relatedPageId:r});if("failed"===l.type)return void se.showError(l);oe.Z.delete(o);const c=l.data;let p;return"pageId"in c&&c.pageId?p=new Q.G(t,{table:v.iU,id:c.pageId,spaceId:n.getSpaceId()}):(p=new Q.G(t,{table:v.iU,id:(0,g.ZP)(),spaceId:n.getSpaceId()}),function(e){const{environment:t,unfurlResponse:o,url:i,rootUserDefinedExternalCollectionStore:n,rootExternalObjectInstancePageStore:r}=e,a=n.pointer.spaceId;if(!t.currentUser.id)return;const l=(0,d.x$)(i),{host:c}=(0,P.Qc)(l);if(!c)return;if(!o.root.external_object_id)return;const p=o.root;L.createAndCommit({userAction:"unfurlingActions.createExternalObjectInstancePageFromInitialUnfurl",environment:t,perform:e=>{const t={id:r.id,type:s.Ti.externalObjectInstancePage,space_id:a,parent_table:b.v,parent_id:n.id,alive:!0,format:p};R.sW({store:r,data:t,transaction:e})}})}({environment:t,unfurlResponse:c,url:o,rootUserDefinedExternalCollectionStore:n,rootExternalObjectInstancePageStore:p})),p}async function ke(e){const{environment:t,url:o,botIds:i,externalCollectionStore:n,externalCollectionViewBlockStore:r}=e;oe.Z.add(o);const a=await ne.unfurlUrl(t,{url:o,botIds:i,spaceId:re.Bs()});oe.Z.delete(o);const s="success"===a.type?a.data:{root:{error:{status_code:a.status}},relations:[]};L.createAndCommit({userAction:"unfurlingActions.startUnfurlRequestForCollection",environment:t,perform:e=>{Ce({environment:t,unfurlResponse:s,url:o,externalCollectionStore:n,externalCollectionViewBlockStore:r,transaction:e})}})}function Ce(e){const{environment:t,unfurlResponse:o,url:i,externalCollectionStore:r,externalCollectionViewBlockStore:a,transaction:s}=e,p=(0,d.x$)(i),{host:u}=(0,P.Qc)(p);if(!u)return;const{external_object_id:m,uri:h,bot_id:y}=o.root;if(!m||!h||!y)return;const S=n().range(I.wh).map((()=>new Q.NW(t,{table:b.v,id:(0,g.ZP)(),spaceId:a.pointer.spaceId}))),w={};o.relations.forEach(((e,t)=>{const o=S[t],i=e,n={id:o.id,version:0,space_id:(0,f.CG)(a.pointer.spaceId),parent_table:b.v,parent_id:r.id,alive:!0,format:i,schema:{}};w[e.uri]=o.id,R.sW({store:o,data:n,transaction:s})}));const k={id:r.id,version:0,space_id:(0,f.CG)(a.pointer.spaceId),parent_table:v.iU,parent_id:a.id,alive:!0,format:{original_url:p,domain:u,...o.root,property_visibility:(C=o.root.external_schema,C&&Object.keys(C).flatMap((e=>(0,l.HF)(e)?[]:{property:`${c.UU}${e}`,visibility:"hide_if_empty"}))),related_external_object_uris_to_instance_ids:{...w},is_placeholder:void 0,integration_id:void 0},schema:{}};var C;R.sW({store:r,data:k,transaction:s})}async function _e(e){const{environment:t}=e,{externalObjectInstanceBlockPointersMap:o,externalCollectionInstancePointersMap:i}=$.Z.state;await ne.refetchExternalObjectInstanceBlocks(t,{recordPointers:[...Object.values(o),...Object.values(i)]}),$.Z.reset()}function Me(e){const{integration:t}=e;return"box"===(0,_.s9)(t.id)&&"on"===O.default.getEligibleGroup({experimentId:"box_file_picker",defaultGroup:"control"})?Te({integrationType:"box",...e}):"google_drive"===(0,_.s9)(t.id)&&(0,z.qH)()?Te({integrationType:"drive",...e}):void 0}function Te(e){const{integrationType:t,integration:o}=e;return"box"===t?{type:t,title:W.default.formatMessage(ue.browse,{appName:o.name}),accounts:q.Z.externalAuthentications.state.filter((e=>{let{integration_id:t}=e;return t===o.id})),onSelect:Ie(e)}:"drive"===t?{type:t,title:W.default.formatMessage(ue.browse,{appName:o.name}),accounts:q.Z.externalAuthentications.state.filter((e=>{let{integration_id:t}=e;return t===o.id})),onSelect:Ie(e)}:void 0}function Ie(e){const{integration:t,environment:o,externalObjectTokenStore:i,externalObjectInstanceBlockStore:n}=e;return async e=>{ce.Z();let r=e?e.id:void 0;if(!e){const{currentSpaceStore:e}=G.default.state,i=q.Z.integrations.state.find((e=>{let{id:o}=e;return o===t.id}));if(i&&e){const n=q.Z.bots.state;await le.h({environment:o,integration:i,spaceId:e.id,from:"integration_file_picker"});const a=function(e,t){const o=q.Z.bots.state;var i;if(e.length!==o.length)return null===(i=o.filter((e=>e.integration_id===t))[0])||void 0===i?void 0:i.id}(n,t.id);a&&(r=a)}}if(r){const e=await async function(e,t,o,i,n){if(!q.Z.state.loaded)return;const r=t.getSpaceId();n.setState({error:!1,loading:!0});const a=await ne.getExternalIntegrationAccessToken(e,{botId:i,integrationId:o.id,spaceId:r});if(n.setState({error:"success"!==a.type,loading:!1}),"failed"!==a.type)return a.data;se.showDialog({message:W.default.formatMessage(ue.somethingWentWrong),showCancel:!0,keepFocus:!0,items:[{label:W.default.formatMessage(ue.copyDebuggingInformation),color:void 0,onAccept:()=>{const t={statusCode:a.status,integrationId:o.id,botId:i};Z.RD({environment:e,stringValue:JSON.stringify(t,null,2),copiedMessage:ue.copiedDebuggingInfo})}}]})}(o,n,t,r,i);e&&await function(e){const{integration:t,tokenDetails:o,environment:i,externalObjectInstanceBlockStore:n,botId:r}=e,a={box:"box",drive:"google_drive"},s=(0,_.s9)(t.id);let l;if(!s)return;s===a.box?l=async function(e,t){const{access_token:o}=e;try{await(0,N.ZP)("https://cdn01.boxcdn.net/polyfills/core-js/2.5.3/core.min.js",{resourceType:N._g.Javascript});const e=[{url:"https://cdn01.boxcdn.net/platform/elements/15.0.0/en-US/picker.js",resourcetype:N._g.Javascript},{url:"https://cdn01.boxcdn.net/platform/elements/15.0.0/en-US/picker.css",resourcetype:N._g.Stylesheet}];await Promise.all(e.map((e=>{let{url:t,resourcetype:o}=e;return(0,N.ZP)(t,{resourceType:o})})))}catch(a){return void t(!0,"")}const i=document.createElement("div");i.setAttribute("id","box-app-container"),document.body.appendChild(i);const n=new Box.FilePicker;n.show("0",o,{size:"small",container:"#box-app-container",maxSelectable:1,logoUrl:"box"});const r=()=>{n.hide(),i.remove()};n.addListener("choose",(function(e){var o;const i=null==e||null===(o=e[0])||void 0===o?void 0:o.id;i&&t(!1,`https://app.box.com/file/${i}`),r()})),n.addListener("cancel",r)}(o,Pe({environment:i,externalObjectInstanceBlockStore:n,botId:r})):s===a.drive&&(l=(0,z.vE)({environment:i,accessToken:o.access_token,callback:Pe({environment:i,externalObjectInstanceBlockStore:n,botId:r}),integration:t}));if(!l)return;return l}({integration:t,environment:o,externalObjectInstanceBlockStore:n,externalObjectTokenStore:i,botId:r,tokenDetails:e})}}}function Pe(e){const{environment:t,externalObjectInstanceBlockStore:o,botId:i}=e;return(e,n)=>{if(e)return se.showDialog({message:W.default.formatMessage(ue.somethingWentWrong),showCancel:!0,keepFocus:!0,items:[{label:W.default.formatMessage(ue.copyDebuggingInformation),color:void 0,onAccept:()=>{const o={err:e,botId:i};Z.RD({environment:t,stringValue:JSON.stringify(o,null,2),copiedMessage:ue.copiedDebuggingInfo})}}]});Be({environment:t,externalObjectInstanceBlockStore:o,url:n,botId:i})}}function xe(e){const{environment:t,originRect:o,externalObjectInstanceBlockStore:i,integration:n}=e,r=[{type:"embed",onChange:o=>{Be({environment:t,url:o,externalObjectInstanceBlockStore:i,placeholderIntegrationId:e.placeholderIntegrationId}),ce.Z()}}];if(n&&!t.device.isMobile){const o=Me({integration:n,environment:t,externalObjectInstanceBlockStore:i,externalObjectTokenStore:e.externalObjectTokenStore});o&&r.push(o)}ce.$(t,{originGap:0,originRect:o,title:"Embed Link Preview",currentTab:"embed",tabs:r})}function Be(e){const{environment:t,url:o,externalObjectInstanceBlockStore:i,placeholderIntegrationId:n,botId:r}=e,a=(0,I.ny)({url:o,integrations:q.Z.integrations.state,currentSpaceId:i.getSpaceId()});if("success"===a.type){const{integration:e,pattern:n}=a,s=r?[r]:q.Z.bots.state.filter((t=>t.integration_id===e.id)).map((e=>{let{id:t}=e;return t}));if(s.length>0){const r=i.getParentId(),a=(0,d.x$)(o),{host:l}=(0,P.Qc)(a);if(l&&r){const a={...Ae({externalObjectInstanceBlockStore:i,parentId:r}),format:{original_url:o,domain:l}};L.createAndCommit({userAction:"unfurlingActions.startUnfurlFromPlaceholder",environment:t,perform:e=>{R.sW({store:i,data:a,transaction:e})}}),ie.trackActivateLinkPreviewMenu(t,{integrationId:e.id,entity:n.name,domain:l,from:"placeholder"})}Se({environment:t,url:o,botIds:s,integrationId:e.id,externalObjectInstanceBlockStore:i})}else L.createAndCommit({userAction:"unfurlingActions.startUnfurlFromPlaceholder",environment:t,perform:e=>{R.sW({store:i.getFormatStore(),data:{integration_id:null,original_url:o,is_placeholder:null},transaction:e})}})}else if("partial"===a.type){const{integration:e}=a;L.createAndCommit({userAction:"unfurlingActions.startUnfurlFromPlaceholder",environment:t,perform:t=>{R.sW({store:i.getFormatStore(),data:{is_placeholder:null,integration_id:e.id,original_url:o,error:{status_code:m.Rl.UNPROCESSABLE_ENTITY}},transaction:t})}})}else"failure"===a.type?L.createAndCommit({userAction:"unfurlingActions.startUnfurlFromPlaceholder",environment:t,perform:e=>{R.sW({store:i.getFormatStore(),data:{is_placeholder:null,original_url:o,integration_id:n,error:{status_code:m.Rl.UNPROCESSABLE_ENTITY}},transaction:e})}}):(0,T.t1)(a)}function Ze(e){const{environment:t,block:o,transaction:i}=e;if(!o.isDefined()||!pe.M_(t)||!o.isType(s.Ti.externalObjectInstance))return;const n=(0,g.ZP)(),r={id:n,type:s.Ti.externalObjectInstance,parent_id:o.id,parent_table:o.table,space_id:o.getSpaceId(),alive:!0,format:o.getFormat()};R.ae({environment:t,table:v.iU,value:r,inMemoryRecordCache:o.inMemoryRecordCache,transaction:i});const a=o.getFormatStore().getKeyStore("related_external_object_uris_to_instance_ids").getValue();if(a)for(const s of Object.values(a)){const e={table:v.iU,id:s,spaceId:o.getSpaceId()};L.applyOperation({store:(0,Q.Kv)(o,e),operation:{pointer:e,path:[],command:"update",args:{parent_table:v.iU,parent_id:n}},transaction:i})}const l=[(0,M.YC)((0,M.x3)(n))];R.sO({store:o,value:{type:s.Ti.text,properties:{title:l},format:null},transaction:i})}function Ee(e){var t;const{block:o,transaction:i,token:n,parentStore:r}=e,{tokenIndex:a}=n;if(!o.isDefined())return;const s=null===(t=r.getParentBlockStore())||void 0===t?void 0:t.getContentStore();if(!s)return;D.gy({block:r,transaction:i,tokenIndex:a})&&E.BE({parent:s,insert:o,after:r,transaction:i})}function Re(e){const{environment:t,spaceId:o,from:i,store:n,bypassCache:r}=e,a=(0,H.y6)(n),s=(null==a?void 0:a.original_url)||(null==a?void 0:a.uri);if(!s)return;const l=(0,H.GQ)(s,o),c=(0,H.Ue)(s,o);if(!l||0===c.length)return;const d=n.getCollectionViewCollectionStore(),{integration:p,pattern:u}=l;n.isCollectionView()&&d?ne.refetchExternalObjectInstanceBlocks(t,{recordPointers:[{...d.pointer,spaceId:o}],bypassCache:r}):n.isExternalObjectInstancePageBlockStore()?ne.refetchExternalObjectInstanceBlocks(t,{recordPointers:[{...n.pointer,spaceId:o}],bypassCache:r}):n.isExternalObjectInstanceBlockStore()&&Se({environment:t,url:s,botIds:c.map((e=>{let{id:t}=e;return t})),integrationId:p.id,externalObjectInstanceBlockStore:n}),ie.trackUpdateLinkPreview(t,{integrationId:p.id,entity:u.name,from:i})}function Ae(e){const{externalObjectInstanceBlockStore:t,parentId:o}=e;return{id:t.id,version:0,type:s.Ti.externalObjectInstance,space_id:(0,f.CG)(t.pointer.spaceId),parent_table:v.iU,parent_id:o,alive:!0}}},53471:(e,t,o)=>{o.d(t,{nQ:()=>A,Xo:()=>D,IL:()=>L,Q7:()=>V,cT:()=>O,cR:()=>U,y:()=>H,A3:()=>z,W8:()=>W,K_:()=>j,XQ:()=>K,dm:()=>$});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(15095),c=o(7406),d=o(65917),p=o(29477),u=o(4615),m=o(98459),g=o(68626),h=o(53770),f=o(47425),v=o(70203),y=o(5366),b=o(93678),S=o(91754),w=o(65162),k=o(33954),C=o(33929),_=o(52533),M=o(21115),T=o(73329),I=o(91551),P=o(88923),x=o(78291),B=o(50906),Z=o(54642),E=o(35253);const R=(0,y.defineMessages)({uploadFileFailed:{defaultMessage:"Upload failed.",id:"uploadActions.uploadFailedError.message"}});function A(e){return e.filter((e=>e.getAlive())).map((e=>{const{source:t,title:o,size:i}=e.getProperties()||{};return{type:"remote",id:e.id,source:v.Q(t),name:v.Q(o),size:v.Q(i),store:e}}))}function D(e){return{...F(e),id:(0,u.ZP)(),dataURL:URL.createObjectURL(e),type:"local"}}function F(e){return{file:e,name:e.name,size:`${(e.size/1024).toFixed(1)}KB`}}function L(e){var t;const o=e.files.map(F);null===(t=e.onBatchStart)||void 0===t||t.call(e,o);const i={};let n=0;p.dC(e.files,G,(t=>Promise.all(t.map((t=>{const o=(0,u.ZP)();return new Promise(((r,s)=>{const l={environment:e.environment,..."secure"===e.bucket?{bucket:e.bucket,record:e.record}:{bucket:e.bucket},file:t,onStart:t=>{var i;null===(i=e.onSingleFileStart)||void 0===i||i.call(e,t,o)},onProgress:t=>{var i,r;let{progressPercent:a,uploadedFiles:s}=t;null===(i=e.onBatchProgress)||void 0===i||i.call(e,{progressPercent:a,uploadedFiles:n}),null===(r=e.onSingleFileProgress)||void 0===r||r.call(e,{progressPercent:a,uploadedFiles:s},o)},onComplete:a=>{var s;n++,i[t.name]=a,null===(s=e.onSingleFileComplete)||void 0===s||s.call(e,a,o),r()},onError:t=>{var i;const n=new Error(t);null===(i=e.onSingleFileError)||void 0===i||i.call(e,n,o),s(n)},preventLimitFreeFileSize:e.preventLimitFreeFileSize};"confluence"===e.uploadType?async function(e){const{environment:t,file:o,preventLimitFreeFileSize:i}=e,n=o.type||"text/plain; charset=utf-8";if(V({preventLimitFreeFileSize:i,environment:t,file:o})){var r;null===(r=e.onStart)||void 0===r||r.call(e,F(o));const i=Math.floor(o.size/N)+1,u={bucket:e.bucket,name:o.name,contentType:n,supportExtraHeaders:!0,contentLength:o.size,numberOfFileChunks:i},m=await Z.initiateMultipartUpload(t,u);var s;if("failed"===m.type)return void(null===(s=e.onError)||void 0===s||s.call(e,m.error.message));const f=await async function(e){const{file:t,signedUrlsForChunks:o}=e,i=[];let n,r,s,l=[];const d=[];for(let a=0;a<o.length;a++){n=a*N,r=(a+1)*N,s=a+1<o.length?t.slice(n,r):t.slice(n);const e=o[a],l=fetch(e,{method:"PUT",body:new Blob([s],{type:t.type})});i.push(l)}const p=a().chunk(i,3);for(const[a,g]of p.entries()){var u;try{const e=await(0,h.Yb)((()=>Promise.all(g)),[100,1e3,3e3]);l=[...l,...e]}catch(m){return{error:(0,c.tg)(m)}}null===(u=e.onProgress)||void 0===u||u.call(e,{progressPercent:Math.floor(a/p.length*100),uploadedFiles:0})}return l.forEach(((e,t)=>{const o=e.headers.get("etag");o&&d.push({ETag:o,PartNumber:t+1})})),{value:d}}({file:o,signedUrlsForChunks:m.data.signedUrlsForChunks,onProgress:e.onProgress});var l;if(g.x.isFail(f))return void(null===(l=e.onError)||void 0===l||l.call(e,f.error.message));const v={...u,multipartUploadEtags:f.value,fileKey:m.data.key,uploadId:m.data.uploadId},y=await Z.completeMultipartUpload(t,v);var d,p;if("success"===y.type)null===(d=e.onComplete)||void 0===d||d.call(e,m.data.url);else null===(p=e.onError)||void 0===p||p.call(e,y.error.message)}else z(e.environment)}(l):O(l)}))}))))).then((()=>{var t;const o=e.files.map((e=>i[e.name]));null===(t=e.onBatchComplete)||void 0===t||t.call(e,o)})).catch((t=>{var o;"confluence"===e.uploadType&&B.trackImportSourceAuth(e.environment,{import_source:"confluence",data:{import_type:"file",status:"failure",error:t,fileSize:e.files[0].size}}),null===(o=e.onBatchError)||void 0===o||o.call(e,t)}))}function V(e){const{preventLimitFreeFileSize:t,environment:o,file:i}=e,{data:n}=x.default.state;let r=!1;if(o.device.isMobileNative){const e="personal"===M.M9(o);r=!((0,_.S$)({environment:o})&&e)}return!(!t&&n&&M.Bu(n)&&!r&&i.size>Y)}const N=20971520;async function O(e){const{environment:t,file:o,preventLimitFreeFileSize:i}=e,n=o.type||"text/plain; charset=utf-8";if(V({preventLimitFreeFileSize:i,environment:t,file:o})){e.onStart&&e.onStart(F(o));const i="secure"===e.bucket?{bucket:e.bucket,name:o.name,contentType:n,record:{table:e.record.table,id:e.record.id,spaceId:(0,m.CG)(e.record.spaceId)},supportExtraHeaders:!0,contentLength:o.size}:{bucket:e.bucket,name:o.name,contentType:n,supportExtraHeaders:!0,contentLength:o.size},r=await Z.getUploadFileUrl(t,i);if("success"===r.type){const{url:t,signedPutUrl:i,putHeaders:a}=r.data,s=p.UZ(),l=new XMLHttpRequest;l.open("PUT",i),l.setRequestHeader("Content-type",n);for(const e of a)l.setRequestHeader(e.name,e.value);l.upload.addEventListener("progress",(t=>{if(t.lengthComputable){const o=Math.round(100*t.loaded/t.total);e.onProgress&&e.onProgress({progressPercent:o,uploadedFiles:0})}})),l.onreadystatechange=function(){4===l.readyState&&(200===l.status?s.resolve({value:t}):(d.log({level:"error",from:"uploadActions",type:"ClientUploadError",data:{miscDataToConvertToString:{status:l.status,responseText:l.responseText}}}),s.resolve({error:C.default.formatMessage(R.uploadFileFailed)})))},l.send(o);const c=await s.promise;c.error?e.onError&&e.onError(c.error):e.onComplete&&e.onComplete(t)}else if(e.onError){const t=(0,k.wf)(C.default.getIntl(),r);e.onError(t)}}else z(e.environment)}function U(e){q({...e,onChange:t=>{if(!t.files||0===t.files.length)return;const o=Array.from(t.files);L({environment:e.environment,files:o,..."secure"===e.bucket?{bucket:e.bucket,record:e.record}:{bucket:e.bucket},onBatchStart:e.onStart,onBatchProgress:e.onProgress,onBatchComplete:e.onComplete,onBatchError:e.onError,preventLimitFreeFileSize:e.preventLimitFreeFileSize})}})}async function H(e){const t=p.UZ();return q({...e,onChange:e=>{const o=l.p4(e.files);t.resolve(o)}}),t.promise}function z(e){const{device:t}=e,{isMobile:o,isTablet:i}=t,r=o&&!i,a=x.default.state.data;let l=!0;const c="personal"===M.M9(e),d=a&&M.GJ(a);(0,_.S$)({environment:e})&&c&&!d&&(l=!1),E.Bw({bannerStore:P.default.state.open?I.Z:T.Z,id:K,type:S.$.Red,render:()=>n()(s.Fragment,{},void 0,n()(y.FormattedMessage,{id:"uploadLimitExceededBanner.message",defaultMessage:"{shouldShowShortMessage, select, true {Your file is over the {maxFreeAccountFileSize} MB limit} other {Your file is over the {maxFreeAccountFileSize} MB limit of the Free plan}}",values:{shouldShowShortMessage:r,maxFreeAccountFileSize:j}}),l&&n()(w.Z,{onClick:()=>{b.y(e,{from:"upload_limit_banner",for:M.M9(e)||f.$M})},style:{marginLeft:12}},void 0,n()(y.FormattedMessage,{id:"uploadLimitExceededBanner.upgradeButton.label",defaultMessage:"{shouldShowShortMessage, select, true {Upgrade} other {Upgrade for unlimited uploads}}",values:{shouldShowShortMessage:r}})))})}function W(){E.qL({bannerStore:T.Z,id:K}),E.qL({bannerStore:I.Z,id:K})}const j=5,K="SubscriptionEditingBlocker",Y=1e6*j,G=5;let X;const q=function(e){X&&X.remove(),X=document.createElement("input"),X.type="file",X.style.opacity="0",X.style.pointerEvents="none",X.style.position="fixed",X.style.left="-1000px",X.style.top="-1000px",X.ariaHidden="true",document.body.appendChild(X),e.multiple?X.setAttribute("multiple",""):X.removeAttribute("multiple"),e.accept&&X.setAttribute("accept",e.accept),X.addEventListener("change",(()=>{e.onChange&&e.onChange(X)})),X.addEventListener("blur",(()=>{e.onBlur&&e.onBlur(X)})),X.addEventListener("click",(e=>{e.stopPropagation()})),X.click(),X.focus({preventScroll:!0})};function $(e){return e.filter(J).map((e=>e.file))}function J(e){return"local"===e.type}},93678:(e,t,o)=>{o.d(t,{y:()=>w});var i=o(77094),n=o.n(i),r=(o(67294),o(60897)),a=o(47425),s=o(97880),l=o(5366),c=o(47307),d=o(21325),p=o(33929),u=o(52533),m=o(21115),g=o(8323),h=o(79315),f=o(92083),v=o(78291),y=o(50906),b=o(99498),S=o(89859);const w=async function(e,t){var o;function i(){t.dontOpenPlansOnCancel||f.Z.setState({open:!0,currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0})}if(y.trackClickUpgradeInfoButton(e,{from:t.from,for_subscription_tier:t.for,addOnFeature:t.addOnFeature}),!t.addOnFeature&&(0,a.QM)(t.for))return;const w=(0,u.S$)({environment:e})&&"personal"===t.for;if(e.device.isMobileNative&&!w){if("ai"===t.addOnFeature){const t=(0,u.Y2)({environment:e})?n()(l.FormattedMessage,{id:"upsellActions.noIAPForAIWithExternalPurchaseOption",defaultMessage:"This workspace has used all of its free AI responses. Visit on desktop to purchase Notion AI and go unlimited.",description:"Shown when a user is on a mobile device without in-app purchases that has used all its free AI responses, in which we can refer the user to external purhcase options."}):n()(l.FormattedMessage,{id:"upsellActions.noIAPForAIWithoutExternalPurchaseOption",defaultMessage:"This workspace has used all of its free AI responses.",description:"Shown when a user is on a mobile device without in-app purchases that has used all its free AI responses, but in which we can't refer the user to other purchase options for legal reasons."});c.showErrorMessage(t)}return}const k=h.default.state.currentSpaceStore;if(!k)return;if(!k.canAdmin())return;await d.bi(e);const C=v.default.state.data;if(!C)return;if("unsubscribed_admin"!==C.type&&"subscribed_admin"!==C.type)return void i();if(m.Q6(C)){const e=n()(l.FormattedMessage,{id:"upsellActions.referToSalesRep",defaultMessage:"This workspace is part of a managed account. Please contact your account representative to discuss any changes to your subscription.",description:"Shown when a user on a managed account encounters an upsell to direct them to their account manager to make the changes."});return void c.showErrorMessage(e)}if(w)return void(e.mobileNative&&k.id&&e.mobileNative.openUpgradeModal(k.id));if("revenueCat"===(null===(o=C.customerData)||void 0===o?void 0:o.activeSubscriptionPlatform)){const e=n()(l.FormattedMessage,{id:"upsellActions.switchPlanFromInAppPurchase",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. To switch plans, cancel your subscription with Apple first."});return void c.showErrorMessage(e)}const _=m.XX(C);if(_&&m.jL(C)){if(t.addOnFeature){const t=await S.y(e,{offerType:"add_on_upgrade_flow",customerId:_.customerId});return b.k2(),void b.Cl(t)}const o=function(e){let{tier:t,stripeData:o}=e;if((0,a.QM)(t)||(0,a.iJ)(t))return null;const i={tier:t,price:m._B({subscriptionTier:t,intl:p.default.intl})[o.interval],br:n()("br",{}),isSubscribed:void 0===o.canceledAt};if((0,g.Aw)())switch(t){case"personal":return n()(l.FormattedMessage,{id:"upsellActions.confirmProration.personalMessage.fromSinglePlayerPlus",defaultMessage:"You are about to subscribe to Notion’s Personal Plan for {price} per member per month.{br}You will lose your current discounted price, and will be charged a prorated amount, minus any account balance.",description:"Shown to ask user to confirm plan change away from discounted plan",values:i});case"plus":case"team":return n()(l.FormattedMessage,{id:"upsellActions.confirmProration.plusMessage.fromSinglePlayerPlus",defaultMessage:"You are about to subscribe to Notion’s Plus Plan with no member limit for {price} per member per month.{br}You will lose your current discounted price, and will be charged a prorated amount, minus any account balance.",description:"Shown to ask user to confirm plan change away from discounted plan",values:i});case"business":return n()(l.FormattedMessage,{id:"upsellActions.confirmProration.businessMessage.fromSinglePlayerPlus",defaultMessage:"You are about to subscribe to Notion’s Business Plan for {price} per member per month.{br}You will lose your current discounted price, and will be charged a prorated amount, minus any account balance.",description:"Shown to ask user to confirm plan change away from discounted plan",values:i});case"enterprise":return n()(l.FormattedMessage,{id:"upsellActions.confirmProration.enterpriseMessage.fromSinglePlayerPlus",defaultMessage:"You are about to subscribe to Notion’s Enterprise Plan for {price} per member per month.{br}You will lose your current discounted price, and will be charged a prorated amount, minus any account balance.",description:"Shown to ask user to confirm plan change away from discounted plan",values:i});default:return(0,s.t1)(t)}switch(t){case"personal":return n()(l.FormattedMessage,{id:"upsellActions.confirmProration.personalMessage",defaultMessage:"You are about to subscribe to Notion’s Personal Plan for {price} per member per month.{br}{isSubscribed, select, true {You will be charged a prorated amount, minus any account balance.} other {}}",description:"Shown to ask user to confirm plan change",values:i});case"plus":case"team":return n()(l.FormattedMessage,{id:"upsellActions.confirmProration.plusMessage",defaultMessage:"You are about to subscribe to Notion’s Plus Plan for {price} per member per month.{br}{isSubscribed, select, true {You will be charged a prorated amount, minus any account balance.} other {}}",description:"Shown to ask user to confirm plan change",values:i});case"business":return n()(l.FormattedMessage,{id:"upsellActions.confirmProration.businessMessage",defaultMessage:"You are about to subscribe to Notion’s Business Plan for {price} per member per month.{br}{isSubscribed, select, true {You will be charged a prorated amount, minus any account balance.} other {}}",description:"Shown to ask user to confirm plan change",values:i});case"enterprise":return n()(l.FormattedMessage,{id:"upsellActions.confirmProration.enterpriseMessage",defaultMessage:"You are about to subscribe to Notion’s Enterprise Plan for {price} per member per month.{br}{isSubscribed, select, true {You will be charged a prorated amount, minus any account balance.} other {}}",description:"Shown to ask user to confirm plan change",values:i});default:return(0,s.t1)(t)}}({tier:t.for,stripeData:_});if(!(await c.confirmUserAction({message:o,acceptLabel:n()(l.FormattedMessage,{id:"upsellActions.confirmProration.acceptLabel",defaultMessage:"Upgrade to {plan, select, personal {Personal} team {Plus} plus {Plus} business {Business} other {Enterprise}}",values:{plan:t.for}})})))return void i();const{interval:u}=_,h=(0,a.iJ)(t.for)?void 0:r.HA[t.for][u];await d.Mg({environment:e,spaceStore:k,plan:h,from:"upsell_modal"})}else d.I0(e,{subscriptionTier:t.for,from:t.from,addOnFeature:t.addOnFeature})}},70782:(e,t,o)=>{o.d(t,{x:()=>v,f:()=>y});var i=o(87997),n=o(9852),r=o(54153),a=o(12955),s=o(87381),l=o(32223),c=o(79315),d=o(10161),p=o(12768),u=o(3815),m=o(85266),g=o(97977),h=o(95489),f=o(5978);async function v(e){const{newCurrentUserId:t,loggedOutUserId:o,environment:c}=e;await g.setLocalStorageUserId(c,t),(0,n.setSessionUserId)(t),await a.setCookie(c,{name:"notion_user_id",value:t});const u=c.currentUser.loggedInUserIds.filter((e=>e!==o)),f=await a.getGhostAdminUserId(c),v={...c,currentUser:new i.CurrentUser({id:t,loggedInUserIds:u,adminUserId:f})};if(c.updateCurrentUserId){const e={environment:c,currentUserId:t,userIds:u};"on"!==d.default.getGroup("await-update-user-id")?await c.updateCurrentUserId(e):c.updateCurrentUserId(e)}r.Z.set(s.currentUserIdKey,t),l.resetRecordSubscriptions(),p.default.reset();return await h.zJ(c)&&h.yH(v),await m.KJ(v,t),v}async function y(e){const{newCurrentUserId:t,environment:o,store:i}=e,{mainEditorCurrentBlockStore:n}=c.default.state,r=await v({environment:o,newCurrentUserId:t});if(n){const e=new u.G(r,i.pointer);c.default.setState({...c.default.state,mainEditorCurrentBlockStore:void 0}),f.navigateToBlock({environment:r,store:e})}}},12321:(e,t,o)=>{o.d(t,{j:()=>b,w:()=>S});var i=o(96486),n=o.n(i),r=o(44615),a=o(45953),s=o(21202),l=o(90468),c=o(77858),d=o(19889),p=o(66079),u=o(45950),m=o(5659),g=o(2688),h=o(88632),f=o(29226),v=o(54642),y=o(4408);function b(e,t){!function(e){w&&g.Z.removeListener(w,e);k&&h.Z.removeListener(k);f.Z.reset()}(e),async function(e,t){try{const o=await m.A.measure("loadUserContent","(current user)",(()=>async function(e){const{defaultRecordCache:t,currentUser:o}=e;if(!t.persistedRecordCache)throw new Error("No local database found.");const i=o.id;if(!i)throw new Error("User is not logged in.");return{recordMap:(await u.yY({environment:e,recordPointers:[{table:p.dx,id:i}],recurFn:(e,t,o)=>{const i=[];if((e===c.zU||e===p.dx)&&!o.value)throw new Error(`Not defined: ${e}, ${t}`);if(e===p.dx){i.push({table:d.KJ,id:t});const e=o.value;if(e){const t=(0,p.ao)(e);for(const e of t??[])i.push(e)}}else if(e===c.zU){const e=o.value;if(e&&e.bookmarked_pages)for(const t of e.bookmarked_pages)i.push({table:s.iU,id:t});if(e&&e.shared_pages)for(const t of e.shared_pages)i.push({table:s.iU,id:t});e&&e.space_id&&i.push({table:l.bx,id:e.space_id})}else if(e===l.bx){const e=o.value;if(e&&e.pages)for(const t of e.pages)i.push({table:s.iU,id:t})}return i},recordIsRequired:e=>e.table===p.dx||e.table===c.zU})).toJson({allowVersionDowngrade:!1})}}(e))),i=a.Ak.create(o.recordMap);y.fL({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,recordMap:i,debugSource:"fetchLocalUserContent"}),f.Z.setState({...f.Z.state,localSpaceInaccessiblePages:_(i,t)}),f.Z.state.readyPromise.resolve()}catch(o){}}(e,t),C(e);let o,i=h.Z.state.online;k=()=>{const t=h.Z.state.online;!t||i||f.Z.state.remoteSpaceInaccessiblePages||C(e),i=t},h.Z.addListener(k);const b=n().throttle(((i,n)=>{void 0!==o&&o!==n&&async function(e,t){const o=await v.loadUserContent(e,{});"success"===o.type&&(f.Z.setState({...f.Z.state,remoteSpaceInaccessiblePages:_(a.Ak.create(o.data.recordMap),t)}),f.Z.state.readyPromise.resolve())}(e,t),o=n}),5e3);w=g.Z.addListener((0,r.Sx)(t),b,void 0,e)}async function S(){await f.Z.state.readyPromise.promise}let w,k;async function C(e){const t=await v.getSpaces(e,{}),o=e.currentUser.id;if("success"===t.type)for(const[i,n]of Object.entries(t.data)){const t=a.Ak.create(n);y.fL({environment:e,userId:i,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,recordMap:t,debugSource:"fetchAllUserSpaces"}),i===o&&(f.Z.setState({...f.Z.state,remoteSpaceInaccessiblePages:_(t,i)}),f.Z.state.readyPromise.resolve())}}function _(e,t){const o={};for(const{pointer:i}of e.getByTable(l.bx)){const n=i.id,r=e.get({table:l.bx,id:n});if(r&&r.value){const i=new Set;if(r.value.pages){for(const t of r.value.pages){const o=e.get({table:s.iU,id:t});o&&o.value||i.add(t)}o[t]||(o[t]={}),o[t][n]=i}}}return o}},39634:(e,t,o)=>{o.d(t,{j:()=>g});var i=o(13991),n=o(7250),r=o(92979),a=o(5978),s=o(51456),l=o(28020),c=o(59488),d=o(58455),p=o(50906),u=o(54642),m=o(98958);function g(e){const{environment:t,from:o,prepopulatedContent:g}=e;p.trackOpenSupportChat(t,{from:o});const h=(0,l.Fv)(),f=d.default.state;if(t.device.isMobileNative){const e=(0,l.B7)(t),o=`${t.device.os} v${t.device.mobileAppVersion}(${t.device.version})`,i="team@makenotion.com",n=`Help with my account ${null==e?void 0:e.getEmail()} on ${o}`,r=()=>{const e=encodeURIComponent(n);a.navigateToExternalURL({environment:t,url:`mailto:${i}?subject=${e}`})},s=t.mobileNative;s&&(0,c.Y)("supportsNativeSubmitUserFeedback")&&s.api.submitUserFeedback?s.submitUserFeedback({sendToEmailAddress:i,subject:n},r):r()}else if(f.isZendeskEnabled&&(0,s.isZendeskEnabled)())(0,r.g)({locale:i.SP,analyticsSettings:f}),p.trackZendeskOpenMessenger(t);else if(f.isIntercomEnabled){function e(){if(h&&h.id)return u.annotateRecentIntercomConversation(t,{page:h})}let o=0;const i=3,r=60;async function a(){o++;const t=await e();t&&"success"===t.type&&"not_found"===t.data.status&&o<i&&setTimeout(a,r)}n.Nv({prepopulatedContent:g,waitForCssInsets:()=>m.waitForCssInsets(t)}),setTimeout(a,1e3*r)}}},37181:(e,t,o)=>{o.d(t,{fG:()=>d,d2:()=>p,Zf:()=>u,rx:()=>m,Nb:()=>g,GK:()=>h,dM:()=>f,Qm:()=>v});var i=o(2280),n=o(42875),r=o(95477),a=o(79315),s=o(3815),l=o(9953),c=o(30149);async function d(e){if(!r.Z.isAdminMode)return;const{currentUserSettingsStore:t}=a.default.state;if(!t)return;await t.load();const o=t.getSettings();if(!o)return;const{device:i}=e,s={};(0,n.r)()!==o.time_zone&&(s.time_zone=(0,n.r)()),i.isDesktopBrowser&&!o.used_desktop_web_app&&(s.used_desktop_web_app=!0),i.isMobileBrowser&&!o.used_mobile_web_app&&(s.used_mobile_web_app=!0),i.isElectron&&i.isMac&&!o.used_mac_app&&(s.used_mac_app=!0),i.isElectron&&i.isWindows&&!o.used_windows_app&&(s.used_windows_app=!0),i.isMobileNative&&i.isIOS&&!o.used_ios_app&&(s.used_ios_app=!0),i.isMobileNative&&i.isAndroid&&!o.used_android_app&&(s.used_android_app=!0),Object.keys(s).length>0&&c.createAndCommit({userAction:"userSettingsActions.updateUserSettingsOnReset",environment:e,perform:e=>{p({userSettingsStore:t,data:s,transaction:e})}})}const p=function(e){const{userSettingsStore:t,data:o,transaction:i}=e;l.sW({store:t.getSettingsStore(),data:o,transaction:i})};function u(e){c.createAndCommit({userAction:"userSettingsActions.setStartWeekToMonday",environment:e,perform:e=>{const{currentUserSettingsStore:t}=a.default.state;t&&p({userSettingsStore:t,data:{start_day_of_week:1},transaction:e})}})}function m(e){c.createAndCommit({userAction:"userSettingsActions.setStartWeekToSunday",environment:e,perform:e=>{const{currentUserSettingsStore:t}=a.default.state;t&&p({userSettingsStore:t,data:{start_day_of_week:0},transaction:e})}})}function g(e){const{transaction:t,userSettingsStore:o,spaceId:i,type:n}=e;l.sO({store:(0,s._J)(o,o.pointer,["settings","sidebar_outliner_settings",i,n,"has_pinned"]),value:!0,transaction:t})}function h(e){const{transaction:t,userSettingsStore:o,integrationId:i}=e;l.sO({store:(0,s._J)(o,o.pointer,["settings","dismissed_link_preview_integration_popup",i]),value:!0,transaction:t})}function f(e,t){const o=(0,i.SY)(),n=(0,i.Q3)();if(!o||!n)return;const r={};n&&(r.fbp=n),o&&(r.click_ids=o),c.createAndCommit({userAction:"userSettingsActions.persistAdClick",environment:e,perform:e=>{e.postSubmitCallbacks.push((e=>{e||((0,i.iI)(),(0,i.HR)())})),p({userSettingsStore:t,data:r,transaction:e})}})}function v(e){const t=a.default.state.currentUserSettingsStore;if(!t)return;const o=t.getKeyStore("settings").getKeyStore("seen_share_button_tooltip_at").getValue();Boolean(o)||c.createAndCommit({userAction:"dismissShareButtonTooltip",environment:e,userId:t.id,perform:e=>{p({userSettingsStore:t,data:{seen_share_button_tooltip_at:Date.now()},transaction:e})}})}},65452:(e,t,o)=>{o.d(t,{h:()=>f,l:()=>v});var i=o(96486),n=o.n(i),r=o(15157),a=o(44615),s=o(29477),l=o(45953),c=o(21202),d=o(45950),p=o(5659),u=o(2688),m=o(92425),g=o(54642),h=o(4408);async function f(e){const{environment:t,userId:o,spaceId:i}=e,r=(0,a.NP)({userId:o,spaceId:i});if(!S||S!==r){let o;!function(e){b&&u.Z.removeListener(b,e)}(t);const i=(t,i)=>{void 0!==o&&o!==i&&v(e),o=i},a=n().throttle(i,5e3);b=u.Z.addListener(r,a,void 0,t),S=r;if(!m.Z.getSharedPagesState(e))return v(e)}}async function v(e){const{environment:t,userId:o,spaceId:i}=e,n=m.Z.getSharedPagesState(e);if(n&&n.loadingDone)return n.loadingDone;const a=(0,s.UZ)();m.Z.setSharedPagesState({spaceId:i,userId:o,state:{currentPageIds:null==n?void 0:n.currentPageIds,loadingDone:a.promise}});try{const n=async function*(e,t,o){try{const o=await p.A.measure("loadUserSharedPages","(current user)",(()=>async function(e,t){const{id:o}=e.currentUser;if(!o)throw new Error("Must be logged in.");if(!e.defaultRecordCache.persistedRecordCache)throw new Error("No local database found.");const i=r.Z.get({userId:o,key:y({userId:o,spaceId:t.spaceId})})||void 0;if(!i)throw new Error("No local shared pages found.");const n=await d.yY({environment:e,recordPointers:i.map((e=>({table:c.iU,id:e}))),recurFn:()=>[],recordIsRequired:()=>!1});return{pages:i,recordMap:n.toJson({allowVersionDowngrade:!1})}}(e,{spaceId:t})));h.fL({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,recordMap:l.Ak.create(o.recordMap),debugSource:"loadUserSharedPagesInSpace"}),yield o}catch(n){}const i=await g.getUserSharedPagesInSpace(e,{spaceId:t,includeDeleted:!0},o);"success"===i.type&&(e.defaultRecordCache.persistedRecordCache&&r.Z.set({userId:e.currentUser.id,key:y({userId:o,spaceId:t}),value:i.data.pages}),yield i.data)}(t,i,o);for await(const e of n)m.Z.setSharedPagesState({spaceId:i,userId:o,state:{currentPageIds:e.pages,loadingDone:a.promise}});const s=m.Z.getSharedPagesState(e);s&&s.currentPageIds?m.Z.setSharedPagesState({spaceId:i,userId:o,state:{currentPageIds:s.currentPageIds,loadingDone:void 0}}):m.Z.setSharedPagesState({spaceId:i,userId:o,state:void 0})}catch(u){m.Z.setSharedPagesState({spaceId:i,userId:o,state:void 0})}}function y(e){return`UserSharedPagesInSpace:${e.userId}:${e.spaceId}`}let b,S},29919:(e,t,o)=>{o.d(t,{Zi:()=>M,Y:()=>T,Cq:()=>I});var i=o(41432),n=o(67219),r=o(5366),a=o(4615),s=o(71644),l=o(21202),c=o(6287),d=o(13493),p=o(70203),u=o(52821),m=o(33929),g=o(45010),h=o(3815),f=o(1310),v=o(50906),y=o(64434),b=o(47307),S=o(9953),w=o(64964),k=o(30149),C=o(63113),_=o(73060);const M=(0,r.defineMessages)({home:{id:"wikiActions.collectionView.home",defaultMessage:"Home",description:"Name for the main page of a wiki"},allPages:{id:"wikiActions.collectionView.allPages",defaultMessage:"All pages",description:"Name for a view of the database showing all pages in this wiki"},pagesIOwn:{id:"wikiActions.collectionView.pagesIOwn",defaultMessage:"Pages I own",description:"Name for a view of the database showing all pages in this wiki owned by the current user"},pagePropertyName:{id:"wikiActions.collectionView.pagePropertyName",defaultMessage:"Page",description:"Name of database property representing page titles"},ownerPropertyName:{id:"wikiActions.collectionView.ownerPropertyName",defaultMessage:"Owner",description:"Name of database property representing one or more owners for a page in a wiki"},tagsPropertyName:{id:"wikiActions.collectionView.tagsPropertyName",defaultMessage:"Tags",description:"Name of database property representing one or more tags for a page in a wiki"},tagsDesignValue:{id:"wikiActions.collectionView.tagsDesignValue",defaultMessage:"Design",description:"Initial design tag value for a page in a wiki"},tagsOnboardingValue:{id:"wikiActions.collectionView.tagsOnboardingValue",defaultMessage:"Onboarding",description:"Initial onboarding tag value for a page in a wiki"},verificationPropertyName:{id:"wikiActions.collectionView.verificationPropertyName",defaultMessage:"Verification",description:"Name of database property representing whether a page in a wiki has been verified"},undoToast:{id:"wikiActions.convertToWiki.undo.toastMessage",defaultMessage:"Turned {pageName} into a wiki",description:"Text that shows in a temporary notification at the bottom of the page, alongside an undo button, when a user converts their page to a wiki."}});function T(e){const{blocks:t,transaction:o,environment:r,source:y}=e,b=(0,a.ZP)(),C=t[0];if(!C||!C.isPageBlock())return;const T=C.getSpaceId(),P=(0,a.ZP)(),x=C.getFormat().page_icon,B=(0,s.ZP)(),Z=n.dE,E=(0,s.ZP)(),R=(0,s.ZP)(),A={title:{name:m.default.formatMessage(M.pagePropertyName),type:"title"},[Z]:{name:m.default.formatMessage(M.ownerPropertyName),type:"person",default:"created_by"},[R]:{name:m.default.formatMessage(M.tagsPropertyName),type:"multi_select",options:[{id:(0,a.ZP)(),value:m.default.formatMessage(M.tagsOnboardingValue),color:"blue"},{id:(0,a.ZP)(),value:m.default.formatMessage(M.tagsDesignValue),color:"green"}]},[B]:{name:u.SO.last_edited_time,type:"last_edited_time",date_format:"relative"}},D=[{visible:!0,property:"title",width:300},{visible:!0,property:Z,width:150},{visible:!0,property:E,width:150},{visible:!0,property:R,width:150},{visible:!0,property:B,width:250}];A[E]={name:m.default.formatMessage(M.verificationPropertyName),type:"verification",verifier_property:Z};const F={table:c.v,id:P,spaceId:T};k.applyOperation({store:(0,h.Kv)(C,F),operation:{pointer:F,command:"set",path:[],args:{id:P,version:0,parent_table:l.iU,parent_id:C.id,space_id:T,name:C.getTitleValue(),schema:A,cover:C.getFormat().page_cover,format:{...C.getFormat(),collection_mode:{type:"page_tree",root_page_pointer:{table:l.iU,id:C.id,spaceId:T}},app_config_uri:n.GZ,property_visibility:[{property:B,visibility:"hide"},{property:R,visibility:"show"},{property:Z,visibility:"show"},{property:E,visibility:"show"}],collection_page_properties:D,collection_cover_position:C.getFormat().page_cover_position},icon:x,alive:!0}},transaction:o});const L=(0,a.ZP)(),V=(0,a.ZP)(),N=(0,a.ZP)();S.sW({store:C,data:{type:i.Ti.collectionViewPage,collection_id:P,format:{...C.getFormat(),collection_pointer:F,app_config_uri:n.FF,app_uri_map:{[n.GZ]:P},app_id:b},view_ids:[L,V,N]},transaction:o});const O={table:d.n,id:L,spaceId:T};k.applyOperation({store:(0,h.Kv)(C,O),operation:{pointer:O,command:"set",path:[],args:{id:L,version:0,type:"page",name:m.default.formatMessage(M.home),parent_id:C.id,parent_table:"block",space_id:T,format:{page_pointer:{id:(0,a.Mt)(C.id),spaceId:T,table:"block"}},alive:!0}},transaction:o});const U={table:d.n,id:V,spaceId:T};k.applyOperation({store:(0,h.Kv)(C,U),operation:{pointer:U,command:"set",path:[],args:{id:V,version:0,type:"table",name:m.default.formatMessage(M.allPages),parent_id:C.id,parent_table:"block",space_id:T,format:{table_properties:D},query2:{sort:[{property:B,direction:"descending"}]},alive:!0}},transaction:o});const H={table:d.n,id:N,spaceId:T};k.applyOperation({store:(0,h.Kv)(C,H),operation:{pointer:H,command:"set",path:[],args:{id:N,version:0,type:"table",name:m.default.formatMessage(M.pagesIOwn),parent_id:C.id,parent_table:"block",space_id:T,format:{table_properties:D,property_filters:[{id:(0,a.ZP)(),filter:{filter:{value:{type:"relative",value:"me"},operator:"person_contains"},property:Z}}]},query2:{sort:[{property:B,direction:"descending"}]},alive:!0}},transaction:o});const z=g.Z.PageScroller;z&&z.scrollToTop({animate:!0}),_.rm(o),v.trackConvertToWiki(r,{source:y,root_page_id:C.id,collection_id:P}),function(e){const{environment:t,blocks:o}=e,i=o[0];if(!i||!i.isCollectionViewPageWithContent())return;const n=(0,p.Q)(i.getTitleValue());f.ZP.setState({...f.ZP.state,shouldReset:!1}),w.d4({item:{label:m.default.formatMessage(M.undoToast,{pageName:n}),durationMs:f.JY},undoFunc:()=>{k.createAndCommit({userAction:"wikiActions.wikiConversionToast.undo",environment:t,perform:e=>{I({environment:t,blocks:o,transaction:e,source:"snackbar"})}})}})}({environment:r,blocks:t})}function I(e){var t;const{environment:o,blocks:n,transaction:r,source:a}=e,s=n[0];if(!s||!s.isCollectionView())return void b.showErrorMessage("Something went wrong");const l=s.getFormat().collection_pointer;if(!l)return void b.showErrorMessage("Something went wrong");const c=h.NW.createChildStore(s,l),d=null===(t=s.getCover())||void 0===t?void 0:t.cover,p=c.getFormat().collection_cover_position,u=c.getName();C.vs({environment:o,block:s,blockType:i.Ti.page,transaction:r}),S.sW({store:s,data:{format:{...s.getFormat(),app_config_uri:void 0,app_uri_map:void 0,app_id:void 0,page_cover:d,page_cover_position:p},properties:{...s.getProperties(),title:u}},transaction:r}),y.A9({collectionViewBlockStore:s,collectionStore:c,transaction:r}),v.trackUndoWikiConversion(o,{source:a,root_page_id:s.id,collection_id:l.id})}},73060:(e,t,o)=>{o.d(t,{B1:()=>s,Rg:()=>l,FO:()=>c,rm:()=>d,nX:()=>p});var i=o(28182),n=o(79315),r=o(30149),a=o(37181);function s(){const{currentUserSettingsStore:e}=n.default.state;if(!e||!e.isReady())return;const t=e.getSettings();return t?t.wiki_onboarding_phase??"unseen":void 0}function l(e){const t=s();if(void 0===t)return;const o=i.dF.indexOf(t);if(-1!==o&&o<i.dF.length-1){const{currentUserSettingsStore:t}=n.default.state;if(!t)return;r.createAndCommit({userAction:"wikiOnboardingActions.advanceOnboardingStep",environment:e,perform:e=>{a.d2({userSettingsStore:t,transaction:e,data:{wiki_onboarding_phase:i.dF[o+1]}})}})}}function c(e){const t=s();if(void 0===t)return;const o=i.dF.indexOf(t);if(-1!==o&&o>1){const{currentUserSettingsStore:t}=n.default.state;if(!t)return;r.createAndCommit({userAction:"wikiOnboardingActions.previousOnboardingStep",environment:e,perform:e=>{a.d2({userSettingsStore:t,transaction:e,data:{wiki_onboarding_phase:i.dF[o-1]}})}})}}function d(e){const{currentUserSettingsStore:t}=n.default.state;t&&"unseen"===s()&&a.d2({userSettingsStore:t,transaction:e,data:{wiki_onboarding_phase:"home"}})}function p(e){if("complete"===s())return;const{currentUserSettingsStore:t}=n.default.state;t&&r.createAndCommit({userAction:"wikiOnboardingActions.completeOnboarding",environment:e,perform:e=>{a.d2({userSettingsStore:t,transaction:e,data:{wiki_onboarding_phase:"complete"}})},userId:t.id})}},89626:(e,t,o)=>{o.d(t,{__:()=>k,B1:()=>C,ON:()=>_,h1:()=>M,w9:()=>T,lZ:()=>I,n7:()=>P,TH:()=>B});var i=o(67294),n=o(480),r=o(81954),a=o(41432),s=o(65917),l=o(66673),c=o(28182),d=o(30149),p=o(37181),u=o(95477),m=o(99417),g=o(68056),h=o(89086),f=o(28685),v=o(79315),y=o(10161),b=o(96026),S=o(3815),w=o(24666);const k=new(o(12318).default)(void 0);function C(){const{currentUserSettingsStore:e}=v.default.state;if(!e||!e.isReady())return;const t=e.getSettings();return t?t.ai_onboarding_phase??"not_seen":void 0}function _(e){"space_for_ai"===C()&&M(e)}function M(e){const t=C();if(void 0===t)throw new Error("Assertion failure, AI onboarding state is undefined!");const o=c.AQ.indexOf(t);if(-1===o)throw new Error(`Assertion failure, ${t} is not a valid AI onboarding state!`);if(o<c.AQ.length-1){const{currentUserSettingsStore:t}=v.default.state;if(!t)return;d.createAndCommit({userAction:"AiOnboardingActions.advanceAIOnboardingStage",environment:e,perform:e=>{p.d2({userSettingsStore:t,transaction:e,data:{ai_onboarding_phase:c.AQ[o+1]}})},userId:t.id})}}function T(e){const t=(0,n.O7)(),o="completionPopup"===e.type&&"results"===e.stage&&!e.loading,r=(0,l.D9)(o);(0,i.useEffect)((()=>{r&&!o&&"refine_ai_response"===C()&&M(t)}),[o,r,t])}function I(e){const t=(0,n.O7)(),o="results"===e.stage&&e.loading,r=(0,l.D9)(o);(0,i.useEffect)((()=>{o&&!r&&"ask_ai_anything"===C()&&M(t)}),[o,r,t])}function P(){return(0,r.VK)(x,[])}function x(){if("space_for_ai"!==C())return;const e=w.default.state;if("editing"===e.mode){const t=(0,g.QY)(e.multiSelection);if(t&&(0,h.wd)(t.selection)){const e=t.store,o=f.E.findEditableWithStore(e);if(o){const t="block"===e.pointer.table?S.G.createChildStore(e,e.pointer):void 0,i=t&&t.getType(),n=Boolean(i&&(0,a.hD)(i)),r=e.getValue();if(n&&!r)return o}}}}function B(e){const t=(0,n.O7)(),o=(0,r.VK)((()=>{const e=v.default.state.mainEditorCurrentBlockStore;return e&&b.Z.getMode(t,e)}),[t]),a=(0,i.useCallback)((t=>{e.forIntroModal&&y.default.checkGate("ai_onboarding_logging")&&s.log({level:"info",from:"useAiOnboardingModalVisible",type:"isVisible",error:{miscDataString:t}})}),[e.forIntroModal]);return(0,r.VK)((()=>{const{currentUserSettingsStore:e,inAppCalloutStore:i}=v.default.state;if(!i.canShow("ai_intro_modal"))return a("conflicting modals in InAppCalloutStore"),!1;if(!e)return a("currentUserSettingsStore is undefined"),!1;if(!e.isReady())return a("currentUserSettingsStore not ready"),!1;const n=e.getSettings();if(!n)return a("userSettings is undefined"),!1;if(void 0!==n.ai_onboarding_phase&&"not_seen"!==n.ai_onboarding_phase)return a(`userSettings.ai_onboarding_phase -- ${n.ai_onboarding_phase}`),!1;return"staging"!==u.Z.env&&n.signup_time&&n.signup_time>16770636e5?(a(`userSettings.signup_time -- ${n.signup_time}`),!1):(0,m.GD)(t,o)?(a(`completionsEnabled is true -- publicEditMode: ${o}`),!0):(a("no passing condition met"),!1)}),[t,o,a])}},16091:(e,t,o)=>{o.d(t,{u7:()=>u,RD:()=>m,gl:()=>g});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(5366),c=o(81415),d=o(89626);const p=(0,l.defineMessages)({spaceForAiHeader:{id:"AiOnboardingTooltips.spaceForAi.header",defaultMessage:"Press ‘space’ for AI",description:"Header for the tooltip to introduce the Space key to activate AI"},spaceForAiContent:{id:"AiOnboardingTooltips.spaceForAi.content",defaultMessage:"On a new line or page, press ‘space’ on your keyboard for AI to generate or edit the page. Try it now!",description:"Content for the tooltip to introduce the Space key to activate AI"},askAiAnythingHeader:{id:"AiOnboardingTooltips.askAiAnything.header",defaultMessage:"Ask AI anything",description:"Header for the tooltip to introduce AI freeform input"},askAiAnythingContent:{id:"AiOnboardingTooltips.askAiAnything.content",defaultMessage:"Just tell AI what to do — the more details, the better. You can also start from an example in the menu.",description:"Content for the tooltip to introduce AI freeform input"},refineAiResponseHeader:{id:"AiOnboardingTooltips.refineAiResponse.header",defaultMessage:"Tell AI what to do next",description:"Header for the tooltip to introduce AI follow-up prompts"},refineAiResponseContent:{id:"AiOnboardingTooltips.refineAiResponse.content",defaultMessage:"How was it? Give AI further instructions to improve what it wrote, or hit ‘Done’ when finished.",description:"Content for the tooltip to introduce AI follow-up prompts"}});function u(){window.__c={n:"SpaceForAiOnboardingTooltip"};const e=(0,a.O7)(),t=(0,d.n7)();return e.device.isMobile||!t?null:n()(c.U,{origin:()=>t.getNode(),placementToOrigin:"bottom",header:r.createElement(l.FormattedMessage,p.spaceForAiHeader),content:r.createElement(l.FormattedMessage,p.spaceForAiContent),onCloseClick:()=>(0,d.h1)(e)})}function m(e){window.__c={n:"AskAIAnythingOnboardingTooltip"};const{originRef:t,openState:o}=e,i=(0,a.O7)(),u=(0,s.VK)((()=>(0,d.B1)()),[]);if(i.device.isMobile)return null;const m="ask_ai_anything"===u&&"initialPrompt"===o.stage;return n()(c.U,{origin:m?t:void 0,placementToOrigin:"top",header:r.createElement(l.FormattedMessage,p.askAiAnythingHeader),content:r.createElement(l.FormattedMessage,p.askAiAnythingContent),onCloseClick:()=>(0,d.h1)(i)})}function g(e){window.__c={n:"RefineAIResponseOnboardingTooltip"};const{originRef:t,openState:o,isInputEmpty:i}=e,u=(0,a.O7)(),m=(0,s.VK)((()=>(0,d.B1)()),[]);if(u.device.isMobile)return null;const g="refine_ai_response"===m&&"results"===o.stage&&!o.loading&&"cursor"===o.context.type&&i;return n()(c.U,{origin:g?t:void 0,placementToOrigin:"right",pointerOffset:-4,pointerLength:25,header:r.createElement(l.FormattedMessage,p.refineAiResponseHeader),content:r.createElement(l.FormattedMessage,p.refineAiResponseContent),onCloseClick:()=>(0,d.h1)(u)})}},45441:(e,t,o)=>{o.d(t,{K:()=>Vt});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(18466),c=o(26263),d=o(1302),p=o(480),u=o(81954),m=o(24405),g=o(42875),h=o(66673),f=o(62965),v=o(44805),y=o(97880),b=o(5366),S=o(96323),w=o(50906),k=o(43132),C=o(73928),_=o(30149),M=o(3386),T=o(43250),I=o(99417),P=o(43455),x=o(16772),B=o(29798),Z=o(89626),E=o(16091),R=o(92022),A=o(3779),D=o(72897),F=o(9342),L=o(22346),V=o(63296),N=o(72495),O=o(34859);function U(e){window.__c={n:"ExitConfirmationDialog"};const{open:t,onCancelExit:o,onConfirmExit:i}=e,n=(0,s.useCallback)((()=>a()(H,{onConfirmExit:i,onCancelExit:o})),[i,o]);return a()(L.Z,{open:t,render:n,disableAnimation:!0,onDismiss:o})}function H(e){window.__c={n:"ExitConfirmationDialogContent"};const t=(0,m.yK)((e=>({wrapper:{padding:24,display:"flex",flexDirection:"column",minWidth:280},question:{fontWeight:500,maxWidth:240,textAlign:"center",marginTop:8,marginBottom:8,lineHeight:"1.2em"},icon:{width:32,height:32,alignSelf:"center",paddingTop:8,fill:e.accentColors.purple[400]}})),[]),o={width:"100%",marginTop:8},i=[{key:"confirm",render:e=>s.createElement(V.Z,n()({style:o},e),a()(b.FormattedMessage,{id:"completions.ExitConfirmationDialog.confirmExit",defaultMessage:"Discard",description:"Label of button for user to confirm the exit of an AI session"})),action:e.onConfirmExit},{key:"cancel",render:e=>s.createElement(V.Z,n()({style:o},e),a()(b.FormattedMessage,{id:"completions.ExitConfirmationDialog.cancelExit",defaultMessage:"Cancel",description:"Label of button for user to cancel the exit of an AI session"})),action:e.onCancelExit}];return a()(D.Z,{capture:!0,preventType:O.Z.All},void 0,a()("div",{style:t.wrapper},void 0,A.Z.sparkles(t.icon),a()("p",{style:t.question},void 0,a()(b.FormattedMessage,{id:"completions.ExitConfirmationDialog.question",defaultMessage:"Do you want to discard the AI response?",description:"Question asked when user tries to exit an AI session"})),a()(F.Z,{type:F.i.Vertical,initialFocus:0,sections:[{key:"dialog",render:e=>s.createElement(N.Z,n()({topBorder:!1,disableMobileBorders:!0},e)),items:i}]})))}var z=o(76095),W=o(62967),j=o(48019),K=o(73063),Y=o(68894),G=o(78140),X=o(64369),q=o(60709),$=o(79315),J=o(71184);const Q=(0,b.defineMessages)({save:{id:"ai.favorites.save",defaultMessage:"Save changes",description:"In AI favorites menu, action label for user to save their changes to an AI favorite."},delete:{id:"ai.favorites.delete",defaultMessage:"Delete",description:"In AI favorites menu, action label for user to delete an AI favorite."},share:{id:"ai.favorites.share",defaultMessage:"Copy sharable link",description:"In AI favorites menu, action label for user to copy an AI favorite's sharable link to their clipboard."}});function ee(e){window.__c={n:"FavoriteEditorMenuPopupContent"};const{state:t,context:o}=e,i=(0,p.O7)(),n=(0,s.useMemo)((()=>new B.Z),[]),r=(0,W.PH)({key:"input",analyticsName:"TODO",displayName:Q.save,validators:[],closeParentMenu:!1,render:()=>a()(N.Z,{isInput:!0,style:{marginTop:0}},void 0,a()(Y.ZP,{value:t.current.name,onChange:e=>{t.set({...t.current,name:e.target.value}),n.setState({focus:{section:0,indexLocal:1,indexGlobal:1}})},placeholder:"Action name",focusInitial:!0})),action(e,t){}}),l=[(0,W.$J)({actions:[r,(0,W.PH)({key:"save",analyticsName:"TODO",displayName:Q.save,validators:[],svg:A.Z.save,closeParentMenu:!1,action(e,o){(0,z.m5)({state:t,environment:i})}}),(0,W.PH)({key:"delete",analyticsName:"TODO",displayName:Q.delete,validators:[],svg:A.Z.trash,closeParentMenu:!1,action(e,o){const{currentUserSettingsStore:n}=$.default.state;n&&(_.createAndCommit({userAction:"ai.favoriteEditorPopup.delete",environment:i,perform(e){(0,J.QC)(t.current,n,e)}}),t.clear())}}),(0,W.PH)({key:"share",analyticsName:"TODO",displayName:Q.share,validators:[],svg:A.Z.link,closeParentMenu:!1,action(e,o){(0,z.IW)(t.current)}})],key:"actions",render:e=>s.createElement(N.Z,e)})],c=(0,s.useCallback)((()=>{}),[]);return a()("div",{style:{display:"flex",flexDirection:"column"}},void 0,a()("div",{style:{display:"flex",alignItems:"center",padding:"8px 8px 0 8px"}},void 0,a()(K.Z,{icon:A.Z.backward,onClick:()=>{(0,z.ny)({environment:i,state:t})},ariaLabel:"TODO a11y"}),a()(X.Z,{isSecondaryColor:!0,isSmall:!0,style:{fontWeight:700}},void 0,"Save or share AI action")),a()(G.Z,{menuType:q.og.Popup,width:"100%",maxHeight:"min(40vh, 320px)",minHeight:"100%"},void 0,a()(j.Z,{menuListStore:n,sections:l,onAccept:c,initialFocus:0,context:o})))}var te=o(57819),oe=o(10161);const ie=(0,b.defineMessages)({undoAriaLabel:{defaultMessage:"Go to previous AI response",id:"id.completions.undoAriaLabel",description:"Accessibility label on button that will go to the previous AI response (undo)"},redoAriaLabel:{defaultMessage:"Go to next AI response",id:"id.completions.redoAriaLabel",description:"Accessibility label on button that will go to the next AI response (undo)"},historyLabel:{defaultMessage:"{currentRevision} of {totalRevisions}",id:"id.completions.historyLabel",description:"Label between previous/next buttons that tell the user which AI response they are currently viewing, and how many total responses are available."}}),ne={display:"flex",alignItems:"center",marginLeft:-2,marginRight:-2},re={width:20,height:20,marginLeft:2,marginRight:2};function ae(e){window.__c={n:"CompletionHistory"};const{onUndo:t,onRedo:o,historyLabel:i}=e,n=(0,b.useIntl)();return t||o?a()("div",{style:ne},void 0,a()(K.Z,{icon:A.Z.chevronLeft,ariaLabel:n.formatMessage(ie.undoAriaLabel),disabled:!t,onClick:t,style:re}),a()(X.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontVariantNumeric:"tabular-nums"}},void 0,i),a()(K.Z,{icon:A.Z.chevronRight,ariaLabel:n.formatMessage(ie.redoAriaLabel),disabled:!o,onClick:o,style:re})):null}const se={onUndo:void 0,onRedo:void 0,historyLabel:void 0};function le(e,t){const o=x.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;const{sessionId:i}=o,n=(0,I.xM)(o);w.trackAICompletionPopupHistoryNavigation(e,{session_id:i,inference_id:n.inferenceId,type:t})}var ce=o(56863),de=o(56948),pe=o(80863),ue=o(11066),me=o(1743),ge=o(74194);function he(e,t){e.set({...e.current,action:{...e.current.action,prompt:t}})}function fe(e){window.__c={n:"FavoritePromptEditorContent"};const{state:t,inputRef:o}=e,i=(0,p.O7)(),n=(0,te.bJ)();return a()(me.Z,{capture:!0,allowMenuList:!1,allowEsc:!0},void 0,s.createElement(ge.Z,{ref:o,format:ge.Z.Format.Transparent,placeholder:"Prompt for action",selectAll:!0,value:t.current.action.prompt,textarea:!0,textareaSubmitOnEnter:!1,autosize:!0,style:{minHeight:28,paddingTop:4,paddingBottom:4},onChange:e=>he(t,e.target.value),onKeyDown:e=>{"Enter"===e.key&&he(t,`${t.current.action.prompt}\n`)},focusInitial:!1}),a()("div",{style:n.inputActions},void 0,a()(ue.Z,{style:n.purpleButton,onClick:()=>(0,z.m5)({state:t,environment:i})},void 0,"Done")))}var ve=o(61519);function ye(e){window.__c={n:"PromptOrActionInput"};const{query:t,setQuery:o,onDismiss:i,onSubmit:n,inputRef:r,submitOnEnter:l,inputPlaceholder:c,children:d}=e,[p,u]=(0,s.useState)(void 0);return a()(me.Z,{capture:!0,allowMenuList:!1,allowEsc:!0},void 0,s.createElement(ge.Z,{ref:r,format:ge.Z.Format.Transparent,placeholder:c,selectAll:!0,value:t,textarea:!0,textareaSubmitOnEnter:!0,autosize:!0,style:{minHeight:28,paddingTop:4,paddingBottom:4},onSubmit:e=>{t&&l&&(e.stopPropagation(),null==n||n())},onChange:e=>{o(e.target.value)},onKeyUp:e=>{"Backspace"===e.key&&(""===p&&i(),u(void 0))},onKeyDown:e=>{"Backspace"===e.key&&void 0===p&&u(t)},focusInitial:!0}),d)}var be=o(58261),Se=o(58032);function we(e){window.__c={n:"SubmitAIPromptButton"};const{onSubmit:t,canSend:o}=e,i=(0,te.bJ)(),r=(0,p.O7)(),l=(0,u.VK)((()=>r.device.isPhone),[r]);return a()(Se.Z,{renderTooltip:()=>a()("div",{},void 0,a()(b.FormattedMessage,{defaultMessage:"Send to AI",id:"completions.CompletionMenuActionBar.sendTooltip",description:"Tooltip for button to send content to Notion's AI powered assisted writing feature"}),a()(be.Z,{style:i.keyboardShortcutInverted,name:"enter"})),placement:Se.Z.Placement.Bottom,render:e=>s.createElement(K.Z,n()({icon:A.Z.sendArrow,onClick:t,isPurple:o,disabled:!o,iconStyle:{height:l?24:20,width:l?24:20},style:{pointerEvents:"auto",height:l?24:20,width:l?24:20}},e))})}const ke=(0,b.defineMessages)({followUpInputPlaceholder:{id:"AlternativeCommandPalette.followUp.inputPlaceholder",defaultMessage:"Tell AI what to do next…",description:"Placeholder for the command palette input"}}),Ce={padding:"8px 10px 8px 14px"};function _e(e){window.__c={n:"CompletionFinishedContent"};const t=(0,te.bJ)(),o=(0,b.useIntl)(),i=0===e.query.trim().length,r=(0,p.O7)(),l=(0,u.VK)((()=>{if(!(0,I.E8)(r.device))return!1;const e=pe.oX.state;return Boolean(e&&e.previewingStep)}),[r]);return s.createElement(ye,n()({},e,{inputPlaceholder:o.formatMessage(ke.followUpInputPlaceholder)},l&&{onSubmit:void 0}),a()("div",{style:t.inputActions},void 0,a()(we,{onSubmit:e.onSubmit,canSend:!i&&!l}),(e.onUndo||e.onRedo)&&s.createElement(s.Fragment,null,a()(ve.Z,{vertical:!0,size:1,style:Ce}),s.createElement(ae,e))))}var Me=o(64921),Te=o(91839);function Ie(e){window.__c={n:"CompletionInProgressContent"};const{onStop:t,onRetry:o}=e,i=(0,te.bJ)(),n=(0,p.O7)().device,r=n.isMobileNative&&n.isIOS;return a()(M.Z,{capture:!0,onEnter:()=>{t()},onEsc:()=>{t()},onKeypress:e=>{e.metaKey||"r"!==e.key||o()}},void 0,a()("div",{style:i.writingLabel},void 0,a()(b.FormattedMessage,{id:"AlternativeCompletionsPopupContent.writing",defaultMessage:"AI is writing",description:"Label for when AI is writing content"}),a()(Te.Z,{style:i.loadingDots})),!r&&a()(Me.Z,{style:i.lightweightButton,onClick:o},void 0,a()(b.FormattedMessage,{id:"AlternativeCompletionsPopupContent.tryAgain.label",defaultMessage:"Try again",description:"Label for button to start over with AI"}),a()("span",{style:i.keyboardShortcut},void 0,a()(b.FormattedMessage,{id:"AlternativeCompletionsPopupContent.startOver.shortcut",defaultMessage:"r",description:"Keyboard shortcut for button to start over with AI"}))),a()(Me.Z,{style:i.lightweightButton,onClick:t},void 0,a()(b.FormattedMessage,r?{id:"AlternativeCompletionsPopupContent.cancel.label",defaultMessage:"Cancel",description:"Label for button to cancel AI"}:{id:"AlternativeCompletionsPopupContent.stop.label",defaultMessage:"Stop",description:"Label for button to stop AI"}),a()("span",{style:i.keyboardShortcut},void 0,a()(b.FormattedMessage,{id:"AlternativeCompletionsPopupContent.stop.shortcut",defaultMessage:"esc",description:"Keyboard shortcut for button to stop AI content"}))))}var Pe=o(96486),xe=o.n(Pe),Be=o(61134),Ze=o(18647),Ee=o(17748);function Re(e){window.__c={n:"CompletionPreview"};const{temporaryListStore:t,isLoading:o}=e,i=(0,p.O7)(),n=(0,s.useRef)(null),r=null==n?void 0:n.current,l=null==r?void 0:r.getStore(),c=(0,u.VK)((()=>i.device.isPhone),[i]),d=(0,te.jq)({resetWhenScrolledToBottom:!0,areWeLoading:o,scrollerStore:l});(0,s.useEffect)((()=>{r&&(d?Ae.cancel():Ae(r))}),[r,t,d]);const m={scroller:{maxHeight:c?"min(15vh, 200px)":"min(40vh, 320px)",width:"100%"}};return a()(s.Fragment,{},void 0,s.createElement(Ze.Z,{type:Ze.Z.OverflowType.Y,style:m.scroller,ref:n},a()(Be.O,{displayName:"CompletionPopupContent",disabled:!0},void 0,a()(Ee.Z,{store:t,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0}))))}const Ae=xe().debounce((e=>{e.scrollToBottom({animate:!0})}),60);var De=o(63594),Fe=o(42402);function Le(){const e=(0,s.useCallback)((()=>{window.open("/help/guides/using-notion-ai#what-are-the-current-limitations-of-notion-ai")}),[]),t=(0,m.yK)((e=>({icon:{width:12,height:12,fill:e.lightIconColor,marginLeft:2},link:{color:e.lightTextColor,fontWeight:500}})),[]);return s.createElement(s.Fragment,null,A.Z.warning(t.icon),a()(X.Z,{isSecondaryColor:!0,isSmall:!0},void 0,a()(b.FormattedMessage,{id:"completions.AiWarning.warning",defaultMessage:"AI responses can be inaccurate or misleading.",description:"Disclaimer to let users know about the current limitations of Notion AI"})),a()(X.Z,{isSmall:!0},void 0,a()(Fe.Z,{onClick:e,style:t.link,disableHover:!0,disableUnderline:!0},void 0,a()(b.FormattedMessage,{id:"completions.AiWarning.learnMore",defaultMessage:"Learn more",description:"Link to help page where the user can learn more about the current limitations of Notion AI"}))))}var Ve=o(64964),Ne=o(37181),Oe=o(44532),Ue=o(8323),He=o(82990),ze=o(42922),We=o(12508),je=o(16354),Ke=o(33665);function Ye(e){window.__c={n:"FeedbackCheckbox"};const{checked:t,onChange:o}=e;return a()("div",{style:{display:"flex",gap:6,alignItems:"center"}},void 0,a()(We.Z,{checked:t,onClick:o,size:14}),a()("div",{onClick:o},void 0,a()(X.Z,{style:{cursor:"pointer"},isSmall:!0},void 0,a()(b.FormattedMessage,{defaultMessage:"Share this AI session with Notion",id:"completions.FeedbackPopup.shareWithNotion",description:"Label for checkbox indicating user's permission to share the contents of their AI session with Notion."}))))}function Ge(){window.__c={n:"OptInLearnMore"};const e=(0,m.yK)((e=>({container:{display:"flex",flexDirection:"row"},giftIcon:{width:16,height:16,fill:e.lightIconColor},message:{marginLeft:9,color:e.mediumTextColor,fontSize:12}})),[]);return a()("div",{style:e.container},void 0,A.Z.giftOutline(e.giftIcon),a()("div",{style:e.message},void 0,a()(b.FormattedMessage,{defaultMessage:"You’re sharing data with Notion for AI quality improvement. <aiTerms>Learn more</aiTerms>",id:"completions.OptInLearnMore.description",description:"Let users know they have opted in to share data with Notion",values:{aiTerms:e=>a()(Fe.Z,{external:!0,href:(0,Ke.UY)("ai.dataSharingTerms")},void 0,e)}})))}function Xe(e){window.__c={n:"ShareDataPopup"};const{onSubmit:t}=e,o=(0,m.yK)((e=>({container:{width:300,display:"flex",flexDirection:"column",alignItems:"center",padding:19,position:"relative"},closeButtonContainer:{position:"absolute",top:10,right:10},closeButton:{zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:e.buttonHoveredBackground,width:20,height:20,padding:4},closeButtonHover:{background:e.buttonPressedBackground},closeButtonIcon:{width:16,fill:e.mediumTextColor},giftIcon:{width:24,height:24,fill:e.lightIconColor},terms:{color:e.mediumTextColor,textAlign:"center",fontSize:13},shareButton:{width:"100%",marginTop:17,paddingTop:7,paddingBottom:7},notNowButton:{color:e.mediumTextColor,fontSize:14,marginTop:15},title:{textAlign:"center",marginTop:9,marginBottom:8,fontWeight:He.Z.fontWeight.semibold}})),[]);return a()("div",{style:o.container},void 0,a()("div",{style:o.closeButtonContainer},void 0,a()(Me.Z,{onClick:()=>{t({optIn:!1})},style:o.closeButton,hoveredStyle:o.closeButtonHover},void 0,A.Z.closeSmall(o.closeButtonIcon))),A.Z.giftOutline(o.giftIcon),a()("div",{style:o.title},void 0,a()(b.FormattedMessage,{defaultMessage:"Always share data to improve Notion AI?",id:"completions.ShareDataPopup.title",description:"Title Notion AI data sharing pop-up"})),a()("div",{style:o.terms},void 0,a()(b.FormattedMessage,{defaultMessage:"Help Notion improve AI quality by automatically sharing data from your usage of AI powered features.{br}By continuing, you agree to <aiTerms>AI Data Sharing Terms</aiTerms>",id:"completions.ShareDataPopup.description",description:"Message for data sharing terms",values:{br:a()("br",{}),aiTerms:e=>a()(Fe.Z,{external:!0,href:(0,Ke.UY)("ai.dataSharingTerms")},void 0,e)}})),a()(ze.Z,{style:o.shareButton,onClick:()=>{t({optIn:!0})}},void 0,a()(b.FormattedMessage,{defaultMessage:"Always share",id:"completions.ShareDataPopup.alwaysShareButton",description:"Button to always share feedback with Notion AI"})),a()(je.Z,{style:o.notNowButton,onClick:()=>{t({optIn:!1})}},void 0,a()(b.FormattedMessage,{defaultMessage:"Not now",id:"completions.ShareDataPopup.notNowButton",description:"Button to not share data now"})))}function qe(e){window.__c={n:"FeedbackPopup"};const{state:t,onUpdate:o,onSubmit:i,onCancel:n,userOptIn:r}=e,l=(0,s.useCallback)((()=>{o({...t,shareWithNotion:!t.shareWithNotion})}),[t,o]),c=(0,s.useCallback)((()=>{i(t)}),[i,t]),d=(0,s.useCallback)((e=>{o({...t,userContent:e.target.value})}),[o,t]),p=(0,b.useIntl)(),u=!r;return a()("div",{style:{minWidth:400,padding:14},className:T.YOJ},void 0,a()(me.Z,{capture:!0},void 0,a()(ge.Z,{value:t.userContent,onChange:d,onSubmit:e=>{e.stopPropagation(),c()},onCancel:n,focusInitial:!0,placeholder:p.formatMessage({id:"completions.FeedbackPopup.userCommentPlaceholder",defaultMessage:"How could the output be improved? (optional)",description:"Placeholder/label for text input asking user how their Notion AI result could be improved"})}),a()("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:10}},void 0,u?a()(Ye,{checked:t.shareWithNotion,onChange:l}):a()(Ge,{}),a()(K.Z,{icon:A.Z.sendArrow,onClick:c,ariaLabel:p.formatMessage({id:"completions.FeedbackPopup.submitButtonLabel",defaultMessage:"Submit feedback",description:"Accessibility label for a button that submit's the user's feedback for their Notion AI result"}),isBlue:!0,iconStyle:{height:24,width:24},style:{height:20,width:20}}))))}function $e(e){window.__c={n:"FeedbackButtonWithPopup"};const{type:t,ariaLabel:o,onClick:i,feedbackState:r,onDismiss:l,onSubmit:c,onUpdate:d,showShareDataPopup:p,onDataShareSubmit:u,userOptIn:m}=e,g=t===(null==r?void 0:r.type),h=function(e,t){switch(e){case"thumbsup":return t?A.Z.thumbUpFilled:A.Z.thumbUp;case"thumbsdown":return t?A.Z.thumbDownFilled:A.Z.thumbDown}}(t,g),f=(0,s.useCallback)((()=>i(t)),[i,t]),v=a()(Se.Z,{renderTooltip:()=>a()("div",{},void 0,a()(b.FormattedMessage,{defaultMessage:"Share feedback with Notion",id:"completions.CompletionMenuActionBar.feedbackTooltip",description:"Tooltip for button to thumbs up and send negative feedback for Notion AI result"})),placement:Se.Z.Placement.Bottom,render:e=>s.createElement(K.Z,n()({onClick:f,icon:h,ariaLabel:o},e))});return a()(Oe.ZP,{origin:v,open:(null==r?void 0:r.type)===t,popupType:Oe.kQ.Popup,onDismiss:l,render:()=>r?p?a()(Xe,{onCancel:l,onSubmit:u}):a()(qe,{state:r,onSubmit:c,onUpdate:d,onCancel:l,userOptIn:m}):null})}function Je(e){const{revision:t}=e,o=(0,b.useIntl)(),i=(0,p.O7)(),[n,r]=(0,s.useState)(void 0),[l,c]=(0,s.useState)(!1),d=(0,s.useRef)(null),m=(0,u.VK)((()=>oe.default.checkGate("ai_data_sharing")),[]),g=(0,u.VK)((()=>$.default.state.currentUserSettingsStore),[]),h=(0,u.VK)((()=>{var e;const t=null==g||null===(e=g.getSettings())||void 0===e?void 0:e.seen_ai_data_share_prompt_at,o=!(0,Ue.mq)();return!Boolean(t)&&o}),[g]),f=(0,u.VK)((()=>{var e;return(null==g||null===(e=g.getSettings())||void 0===e?void 0:e.ai_data_share_opt_in)??false}),[g]),v=(0,s.useCallback)((()=>{Ve.oV({label:o.formatMessage({id:"completions.CompletionMenuFooter.showFeedbackThanksMessage",defaultMessage:"Thanks for submitting feedback!",description:"Message shown to user after they submit feedback for their Notion AI result"})})}),[o]),y=(0,s.useCallback)((e=>{d.current=document.activeElement,r((t=>({userContent:"",shareWithNotion:true,...t,type:e})))}),[]),S=(0,s.useCallback)((e=>{e.shareWithNotion&&h&&m?c(!0):(v(),r(void 0)),C.bl({...e,environment:i,revision:t,userOptIn:f})}),[t,i,f,h,m,v]),k=(0,s.useCallback)((e=>{e&&e.stopPropagation&&e.stopPropagation(),r(void 0),d.current&&d.current instanceof HTMLElement&&d.current.focus()}),[]),M=(0,s.useCallback)((e=>{const{optIn:t}=e;g&&(_.createAndCommit({userAction:"FeedbackButtons.aiDataShareOptIn",environment:i,userId:g.id,perform:e=>{Ne.d2({userSettingsStore:g,data:{ai_data_share_opt_in:t,seen_ai_data_share_prompt_at:Date.now()},transaction:e})}}),w.trackAIDataSharingOptInSubmit(i,{user_opt_in:t}),t?Ve.oV({label:o.formatMessage({id:"completions.CompletionMenuFooter.dataShareThanks",defaultMessage:"Thank you for your help making Notion better!",description:"Message shown to user after opt-in to data sharing"})}):v(),c(!1),r(void 0))}),[o,g,i,v]);return t.hasFeedback&&!l?null:s.createElement(s.Fragment,null,a()($e,{type:"thumbsup",ariaLabel:o.formatMessage({id:"completions.CompletionMenuFooter.thumbsUp",defaultMessage:"Submit positive feedback",description:"Accessibility label shown for thumbs up button, used to submit positive feedback for a Notion AI result"}),onClick:y,feedbackState:n,onDismiss:k,onSubmit:S,onUpdate:r,showShareDataPopup:l,onDataShareSubmit:M,userOptIn:f}),a()($e,{type:"thumbsdown",ariaLabel:o.formatMessage({id:"completions.CompletionMenuFooter.thumbsDown",defaultMessage:"Submit negative feedback",description:"Accessibility label shown for thumbs down button, used to submit negative feedback for a Notion AI result"}),onClick:y,feedbackState:n,onDismiss:k,onSubmit:S,onUpdate:r,showShareDataPopup:l,onDataShareSubmit:M,userOptIn:f}))}var Qe=o(99498),et=o(93678),tt=o(21115),ot=o(78291);function it(){const e=(0,p.O7)(),t=(0,u.VK)((()=>e.device.isMobile),[e]),o=(0,u.VK)((()=>{const e=ot.default.state.data;return tt.GJ(e)}),[]),i=(0,s.useCallback)((()=>{t?Qe.k2():et.y(e,{from:"ai_upsell_notice",for:(0,Ue.zt)(),addOnFeature:"ai"})}),[e,t]),n=(0,m.yK)((e=>({upsellIcon:{width:14,height:14,fill:e.lightIconColor},upsellLink:{color:e.blueColor,fontWeight:500}})),[]);return s.createElement(s.Fragment,null,A.Z.giftOutline(n.upsellIcon),a()(X.Z,{isSecondaryColor:!0,isSmall:!0},void 0,a()(b.FormattedMessage,{id:"UpsellNotice.label",defaultMessage:"All free AI responses have been used for this workspace.",description:"Message shown when the user has used up all free AI completions on their plan."})),o&&s.createElement(s.Fragment,null,a()(X.Z,{isSmall:!0},void 0,a()(Fe.Z,{onClick:i,style:n.upsellLink,disableHover:!0,disableUnderline:!0},void 0,a()(b.FormattedMessage,{id:"UpsellNotice.link.label",defaultMessage:"Go unlimited",description:"Link to upgrade to a plan with more AI completions."})))))}function nt(e){window.__c={n:"MainPopupFooter"};const{state:t}=e,o=(0,p.O7)(),i=(0,u.VK)((()=>o.device.isPhone),[o]),n=(0,m.yK)((e=>({wrapper:{background:"dark"===e.mode?e.accentColors.gray[100]:e.accentColors.gray[30],display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 12px",borderTop:`1px solid ${e.lightDividerColor}`,gap:8,color:e.lightTextColor,fontSize:12,minHeight:36},noticeContent:{display:"flex",alignItems:"center",gap:8},actionContent:{display:"flex",alignItems:"center"}})),[]),r=(0,u.VK)((()=>!De.Z.state),[]);if(i)return null;let s,l;return r&&(s=a()(it,{})),"results"!==t.stage||t.loading||(s=s??a()(Le,{}),l=a()(Je,{revision:(0,I.xM)(t)})),s?a()("div",{style:n.wrapper},void 0,a()("div",{style:n.noticeContent},void 0,s),l&&a()("div",{style:n.actionContent},void 0,l)):null}const rt=(0,b.defineMessages)({writeInputPlaceholder:{defaultMessage:"Ask AI to write anything…",id:"completions.PromptMenu.alternativeUiWriteInputPlaceholder",description:"Input placeholder for AI actions menu when user is writing new content (alternative experimental UI)"},editInputPlaceholder:{defaultMessage:"Ask AI to edit or generate…",id:"completions.PromptMenu.alternativeUiEditInputPlaceholder",description:"Input placeholder for AI actions menu when user is editing existing content (alternative experimental UI)"}});function at(e){const{state:t,onDismiss:o,onCompletionRetry:i,onCompletionStop:r,temporaryListStore:l,favoriteEditingState:c}=e,d=(0,s.useRef)(null);(0,s.useEffect)((()=>{ce.w()}),[]);const g=(0,p.O7)(),h=(0,u.VK)((()=>g.device.isPhone),[g]),f=(0,u.VK)((()=>{if(!(0,I.E8)(g.device))return;const e=pe.oX.state;return e?e.temporaryClientSteps.filter((e=>"assistantChat"===e.type||"assistantLoadPage"===e.type||"assistantSearch"===e.type)):void 0}),[g],{useDeepEqual:!0}),v=(0,m.yK)((e=>({icon:{height:18,width:18,paddingLeft:h?0:4,marginLeft:h?-4:void 0,fill:"dark"===e.mode?e.accentColors.purple[600]:e.accentColors.purple[300]},outer:{width:"100%",minHeight:h?44:36,padding:h?"2px 16px 2px 16px":"2px 12px 2px 8px",display:"flex",flexDirection:"column",justifyContent:"center",gap:2,fontSize:h?16:14,borderRadius:6,background:e.popoverBackground,boxShadow:e.mediumBoxShadow,overflow:"hidden",isolation:"isolate"}})),[h]);if((0,u.VK)((()=>(0,I.dU)()),[]))return null;const y=a()("div",{style:{height:36,alignItems:"center",display:"flex"}},void 0,A.Z.sparkles(v.icon));if("active"===c.type)return s.createElement("div",{style:v.outer,ref:d},a()("div",{style:{display:"flex",gap:8,width:"100%"}},void 0,y,a()(fe,{state:c,inputRef:e.inputRef})));const b=s.createElement("div",{style:v.outer,ref:d},l&&a()(Re,{temporaryListStore:l,isLoading:"results"===t.stage&&t.loading}),f&&s.createElement(s.Fragment,null,f.map(((e,t)=>a()(de.H,{store:pe.oX,clientStep:e},t)))),a()("div",{style:{display:"flex",gap:8,width:"100%"}},void 0,y,"initialPrompt"===t.stage||"initialPromptForAIBlock"===t.stage?s.createElement(st,n()({},e,{paletteMode:(0,te.rR)(t)})):t.loading?a()(Ie,{onDismiss:o,state:t,onRetry:i,onStop:r}):s.createElement(_e,e)));return s.createElement(s.Fragment,null,b,a()(nt,{state:t}))}function st(e){window.__c={n:"MainPopupInitialPromptContent"};const{query:t,onSubmit:o,paletteMode:i}=e,r=(0,te.bJ)(),l=(0,b.useIntl)(),c="edit"===i?l.formatMessage(rt.editInputPlaceholder):l.formatMessage(rt.writeInputPlaceholder),d=t.trim().length>0;return s.createElement(ye,n()({},e,{inputPlaceholder:c}),a()("div",{style:r.inputActions},void 0,a()(we,{onSubmit:o,canSend:d})))}var lt=o(8848),ct=o(68204),dt=o(4615),pt=o(30793);const ut="recent-actions",mt=(0,b.defineMessages)({recentActions:{defaultMessage:"Recents",id:"commandPalette.recentActions.title",description:"Label for the 'recent actions' section of the command palette"},more:{defaultMessage:"See more",id:"commandPalette.recentActions.more",description:"Label of button for user to view more menu items"},removeFromMenu:{defaultMessage:"Remove this action from the menu",id:"commandPalette.recentActions.removeFromMenu",description:"Accessibility label (possibly tooltip) of button to remove an action from the recent actions menu"}});function gt(e){window.__c={n:"FavoriteButton"};const{focused:t,recentAction:o,state:i,userSettingsStore:n,intl:r}=e,s=(0,p.O7)();return a()(K.Z,{style:{visibility:t?"visible":"hidden",width:18,height:18},onClick:()=>{const e={id:(0,dt.ZP)(),name:"",action:o};_.createAndCommit({userAction:"ai.recentActions.renderFavoriteButton",environment:s,perform(t){(0,J.gC)(e,n,t),(0,pt.lG)(o,n,t)}}),i.set(e)},icon:A.Z.star,ariaLabel:r.formatMessage(mt.recentActions)})}function ht(){const e=(0,m.Fg)();return A.Z.dots({width:12,fill:e.mediumIconColor,marginLeft:2,marginRight:2})}const ft="This string should never show up in analytics",vt=(0,b.defineMessages)({clickToEditAndRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToEditAndRetry",defaultMessage:"Click to edit prompt and retry",description:"Label of tooltip for 'try again' action, allowing user to edit their most recent artificial intelligence prompt and then re-suggest content based on it"},clickToRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToRetry",defaultMessage:"Click to retry",description:"Label of tooltip for 'try again' action, allowing user to re-suggest content"},tryAgain:{id:"completions.CompletionMenuActionBar.tryAgain",defaultMessage:"Try again",description:"Label of button for user to get Notion's artificial intelligence powered assisted writing feature to re-suggest content"},delete:{id:"completions.CompletionMenuActionBar.delete",defaultMessage:"Discard",description:"Label of button for user to discard content suggested by Notion's artificial intelligence powered assisted writing feature"},close:{id:"completions.CompletionMenuActionBar.close",defaultMessage:"Close",description:"Label of button for user to dismiss popup UI shown by Notion's artificial intelligence powered assisted writing feature"},keep:{id:"completions.CompletionMenuActionBar.done",defaultMessage:"Done",description:"Label of button for user to keep content suggested by Notion's artificial intelligence powered assisted writing feature"},replace:{id:"completions.CompletionMenuActionBar.replace",defaultMessage:"Replace selection",description:"Label of button for user to replace selected content with content suggested by Notion's artificial intelligence powered assisted writing feature"},insert:{id:"completions.CompletionMenuActionBar.insert",defaultMessage:"Insert below",description:"Label of button for user to insert content suggested by Notion's artificial intelligence powered assisted writing feature into their page"}});function yt(e){const{filter:t,state:o,from:i,favoriteEditingState:n,onUpdatePromptState:r,onImprove:l,context:c,intl:d,environment:p,completionResultInfo:u}=e,m=(0,I.E8)(p.device);let g;switch(o.stage){case"initialPrompt":case"initialPromptForAIBlock":g=function(e){const{state:t,environment:o,intl:i,filter:n,from:r,onUpdatePromptState:l,favoriteEditingState:c,type:d}=e,{currentUserSettingsStore:p}=$.default.state;if((0,I.E8)(o.device))return[];const u=p?function(e,t,o,i,n){const r=n.filterOut.toLocaleLowerCase().trim(),l=(0,pt.pz)(o),c=[];let d=0;for(const s of l){const l="recentAction."+d++,p=e=>a()("div",{style:{display:"flex"}},void 0,a()(K.Z,{style:{visibility:e.focused?"visible":"hidden",width:18,height:18},onClick:()=>_.createAndCommit({userAction:"ai.recentActions.renderRemoveButton",environment:i,perform(e){(0,pt.lG)(s,o,e)}}),icon:A.Z.closeSmall,ariaLabel:t.formatMessage(mt.recentActions)}),"inactive"===n.favoriteEditingState.type&&a()(gt,{state:n.favoriteEditingState,focused:e.focused,recentAction:s,userSettingsStore:o,intl:t}),a()(S.xj,{type:"updatePrompt",focused:e.focused}));let u;if(s.prompt.toLocaleLowerCase().trim()!==r){switch(s.type){case"helpMeEdit":"initialPrompt"!==e.stage||"blockSelection"!==e.context.type&&"textSelection"!==e.context.type||(u=(0,S.cK)({key:l,name:s.prompt,analyticsName:"recentAction",right:p,onUpdatePromptState:n.onUpdatePromptState,renderTooltip:W.zz}));break;case"helpMeWrite":"initialPromptForAIBlock"!==e.stage&&"cursor"!==e.context.type||(u=(0,S.cK)({key:l,name:s.prompt,analyticsName:"recentAction",right:p,onUpdatePromptState:n.onUpdatePromptState,renderTooltip:W.zz}));break;default:(0,y.t1)(s)}u&&c.push(u)}}const p=c.slice(0,3),u=c.slice(3);if(u.length){const e=(0,W.$J)({key:"more recent actions",render:e=>s.createElement(N.Z,e),actions:u}),t=(0,W.MV)({key:"more recent actions extension",displayName:mt.more,analyticsName:"Completions - more",validators:[],svg:()=>a()(ht,{}),subActions:()=>[e],collapseSubActionsIntoParent:!0,width:400});p.push(t)}return[(0,W.$J)({key:ut,title:mt.recentActions,render:e=>s.createElement(N.Z,e),actions:p})]}(t,i,p,o,{onUpdatePromptState:l,favoriteEditingState:c,filterOut:n}):[],m=[...p&&"disabled"!==c.type?(0,z.Mi)(t,i,p,o,{onUpdatePromptState:l,favoriteEditingState:c}):[]];"initialPromptForAIBlock"===t.stage?m.push((0,S.xI)({store:t.store,from:r})):"aiBlock"!==d&&m.push(...(0,S.LK)({from:r,type:d,onUpdatePromptState:l}));return m.push(...u),m}({state:o,environment:p,intl:d,filter:t,from:i,context:c,favoriteEditingState:n,onUpdatePromptState:r,type:(0,te.VZ)(o)});break;case"results":g=o.loading?[]:function(e){const{state:t,defaultAction:o,isAssistant:i,closeOrDiscard:n}=e,r={key:"insert",analyticsName:ft,displayName:vt.insert,validators:[],closeParentMenu:!0,svg:A.Z.insertDown,action(){e.onInsert()}},l={key:"delete",analyticsName:ft,displayName:vt.delete,validators:[],closeParentMenu:!0,svg:A.Z.trash,action(){e.onCancel()}},c=function(e){const{state:t,onRetry:o}=e;if("results"!==t.stage)return;return{key:"tryAgain",analyticsName:ft,displayName:vt.tryAgain,validators:[],closeParentMenu:!0,svg:A.Z.undo,renderTooltip:()=>a()(St,{state:t}),action(){o()}}}({...e}),d=[],p=A.Z.thinCheck;if(i)return[(0,W.$J)({key:"main",render:e=>s.createElement(N.Z,e),actions:[(0,W.PH)({key:"keep",analyticsName:ft,displayName:vt.keep,validators:[],closeParentMenu:!0,svg:p,action(){e.onAccept({exitType:"accept"})}})]})];"accept"===o?d.push((0,W.PH)({key:"keep",analyticsName:ft,displayName:vt.keep,validators:[],closeParentMenu:!0,svg:p,action(){e.onAccept({exitType:"accept"})}})):"replace"===o?d.push((0,W.PH)({key:"replace",analyticsName:ft,displayName:vt.replace,validators:[],closeParentMenu:!0,svg:p,action(){e.onReplace()}}),(0,W.PH)(r)):"insert"===o?d.push((0,W.PH)({...r,svg:p})):(0,y.t1)(o);d.push((0,W.PH)({key:"continueWriting",analyticsName:ft,displayName:I.Dr.continueWriting,validators:[],closeParentMenu:!0,svg:wt(A.Z.pencil),action(){e.onImprove({type:"continueWriting"})}}),(0,W.PH)({key:"makeLonger",analyticsName:ft,displayName:I.Dr.makeLonger,validators:[],closeParentMenu:!0,svg:wt(A.Z.aiMakeLonger),action(){e.onImprove({type:"makeLonger"})}}),(0,W.PH)({key:"convertToAiBlock",analyticsName:ft,displayName:I.Dr.insertAIBlock,validators:[()=>{if(!oe.default.checkGate("insert_as_ai_block"))return!1;if("completionPopup"!==t.type||"results"!==t.stage||"cursor"!==t.context.type)return!1;const e=(0,I.xM)(t);return"initial"===e.type&&Boolean(I.Xi[e.clientPrompt.key])}],closeParentMenu:!0,svg:wt(A.Z.sparkles),action(){e.onAccept({exitType:"convert_to_ai_block"})}}));const u=[c?(0,W.PH)(c):void 0,"discard"===n?(0,W.PH)(l):(0,W.PH)({key:"close",analyticsName:ft,displayName:vt.close,validators:[],closeParentMenu:!0,svg:A.Z.close,shortcuts:["esc"],action(){e.onAccept({exitType:"click_outside_window_accept",selectInsertion:!0})}})],m=(0,W.$J)({key:"main",render:e=>s.createElement(N.Z,e),actions:d}),g=(0,W.$J)({key:"final",render:e=>s.createElement(N.Z,e),actions:u.filter(y.$K)});return[m,g]}({state:o,onImprove:l,closeOrDiscard:"cursor"===o.context.type?"close":"discard",isAssistant:m,...u});break;default:(0,y.t1)(o)}let h=(0,ct.sG)({sections:g,context:c,query:t});if(1===h.length&&h[0].key===ut){const e=h[0].actions.slice();(0,I.LN)(t,d)||e.unshift((0,S.sH)({customPrompt:t,execute:u.onSubmit})),h=[(0,W.$J)({key:"actions",render:e=>s.createElement(N.Z,e),actions:e})]}else(function(e){let t=!1;for(const o of e)if(o.key===z.YX)t=!0;else if(o.key!==ut)return!1;return t})(h)&&h.push((0,W.$J)({key:"literal-actions",render:e=>s.createElement(N.Z,e),actions:[(0,S.sH)({customPrompt:t,execute:u.onSubmit})]}));return h}function bt(e,t){switch(t.type){case"continueWriting":return e.formatMessage(I.Dr.continueWriting);case"makeLonger":return e.formatMessage(I.Dr.makeLonger);case"helpMeEdit":return t.prompt}}function St(e){const{state:t}=e,o=(0,m.yK)((e=>({hint:{color:e.mediumInvertedTextColor}})),[]),i=(0,I.xM)(t),n=(0,b.useIntl)();let r,l=vt.clickToEditAndRetry;if("initial"===i.type)if(C.mN(i))r=(0,I.gY)(i);else{l=vt.clickToRetry;const e=i.clientPrompt.name;r="string"==typeof e?e:n.formatMessage(e)}else"followup"===i.type?r=bt(n,i.improvement):(0,y.t1)(i);return s.createElement(s.Fragment,null,a()("div",{},void 0,r),a()("div",{style:o.hint},void 0,n.formatMessage(l)))}function wt(e){return()=>a()(S.lA,{svg:e,svgFill:lt.FN.light.purple[400]})}function kt(e){window.__c={n:"MenuPopupContent"};const{sections:t,onCloseParentMenu:o,context:i,menuListStore:n}=e,r=(0,s.useCallback)((e=>{e.closeParentMenu&&o()}),[o]),l=(0,p.O7)(),c=(0,u.VK)((()=>l.device.isPhone),[l]);return a()(G.Z,{menuType:c?q.og.ActionSheet:q.og.Popup,width:"100%",maxHeight:c?"min(17vh, 160px)":"min(40vh, 320px)",maxWidth:"100%"},void 0,a()(j.Z,{menuListStore:n,sections:t,onAccept:r,initialFocus:0,context:i}))}var Ct=o(51454),_t=o(69454),Mt=o(77794),Tt=o(21199),It=o(45010),Pt=o(3815);function xt(e){window.__c={n:"PopupPositioner"};const{scrollerStore:t,openState:o,children:i}=e,[r,l]=(0,s.useState)(Date.now()),c=(0,s.useCallback)((()=>l(Date.now())),[]),d=(0,s.useRef)(null),[p,g]=(0,s.useState)(void 0),[h,f]=(0,s.useState)(void 0),v=(0,u.VK)((()=>oe.default.checkGate("ai_blocks_v2")),[]),y=(0,u.VK)((()=>{const e=(0,te.$b)(o);if(!e)return;const i=(0,I.wA)(e);if(!i)return;const{origin:n}=e;"results"!==o.stage&&i&&n instanceof Pt.G&&("spacebar"===o.from||n.isEmptyEditableBlock())&&(i.height=0),v&&"initialPromptForAIBlock"===o.stage&&(i.height=0);const r=t.state,a=r.clientRect??new DOMRect,s=r.scrollTop;return function(e){const{openState:t,originRect:o,scrollerRect:i,scrollerScrollTop:n,popupRect:r}=e,a=(null==r?void 0:r.height)??0,s=(null==r?void 0:r.width)??0,l=Math.min(Math.max(o.width,500),730);let c;const d=o.bottom-i.top+n+Zt;o.bottom+a+Zt+Et>i.bottom&&(c=d-(i.height-a-Et+n));let p;s+Rt+At>i.width?p=Rt:o.left+s>i.right?p=i.width-s-At:(p=o.left-i.left,"initialPromptForAIBlock"===t.stage&&(p-=s-o.width));return{top:d,left:p,width:l,scrollTopIntoView:c}}({openState:o,originRect:i,scrollerRect:a,scrollerScrollTop:s,popupRect:p})}),[t,p,o,v]);(0,s.useEffect)((()=>{y&&f(y)}),[y]);const b=y??h;(0,s.useEffect)((()=>{if(Date.now()-r>500)return;const e=null==b?void 0:b.scrollTopIntoView;if(!e)return;const o=Dt(t);o&&Bt(e,o)}),[null==b?void 0:b.scrollTopIntoView,t,r]);const S=(0,m.yK)((e=>({wrap:{position:"absolute",left:null==b?void 0:b.left,top:null==b?void 0:b.top,width:null==b?void 0:b.width,zIndex:Ct.lB}})),[b]);(0,s.useEffect)((()=>{const e=new Mt.E;if(!d.current)throw new Error("ref.current is null");return e.observe(d.current),e.rect.addListener((e=>{g(e.state)})),()=>{e.destroy()}}),[]);const w="results"===o.stage&&!o.loading;(0,s.useEffect)((()=>{w&&c()}),[w,c]);const k="results"===o.stage&&o.loading,C=(0,te.jq)({resetWhenScrolledToBottom:!1,areWeLoading:k,scrollerStore:t}),_="results"===o.stage&&"cursor"===o.context.type,[M,T]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{!k||!_&&M||(C?Bt.cancel():null!=b&&b.scrollTopIntoView&&(c(),T(!0)))}),[C,M,_,k,b,c]),a()(Tt.Z,{capture:!0,render:e=>a()(me.Z,{capture:!0,allowMenuList:!0,allowEsc:!0},void 0,s.createElement("div",n()({style:S.wrap,ref:d},e),b&&i))})}const Bt=xe().debounce(((e,t)=>{t.scrollByOffset(e,0,{animate:!0}),It.Z.MenuScroller&&It.Z.MenuScroller.scrollToTop()}),60),Zt=4,Et=6,Rt=6,At=16;function Dt(e){var t,o;return e===(null===(t=It.Z.PageScroller)||void 0===t?void 0:t.stores.store)?It.Z.PageScroller:e===(null===(o=It.Z.PeekViewScroller)||void 0===o?void 0:o.stores.store)?It.Z.PeekViewScroller:void 0}function Ft(e){window.__c={n:"MobilePopupPositioner"};const{children:t,scrollerStore:o,openState:i}=e,[n,r]=(0,s.useState)(Date.now()),a=(0,s.useRef)(null),[l,c]=(0,s.useState)(void 0),d=(0,s.useCallback)((()=>r(Date.now())),[]),{WindowSizeStore:m}=(0,p.O7)();(0,s.useEffect)((()=>{const e=new Mt.E,t=a.current;if(!t)throw new Error("ref.current is null");e.observe(t);let o=t.getBoundingClientRect().top;e.rect.addListener((e=>{o=e.state.top,c(e.state)}));const i=setInterval((()=>{const i=t.getBoundingClientRect().top;i!==o&&(o=i,e.recompute())}),50);return()=>{e.destroy(),clearInterval(i)}}),[]);const g="results"===i.stage&&!i.loading,f=("results"===i.stage||"initialPrompt"===i.stage)&&"cursor"===i.context.type,v=(0,u.VK)((()=>{const e=(0,te.$b)(i);if(!e)return;const t=(0,I.wA)(e);if(!t)return;if(!l)return;const o=t.bottom-l.top;return o>0?o:void 0}),[i,l]);(0,s.useEffect)((()=>{if(Date.now()-n>500)return;if(!v)return;const e=Dt(o);e&&Bt(v,e)}),[v,o,n]),(0,s.useEffect)((()=>{g&&f&&d()}),[g,f,d]);const y="results"===i.stage&&i.loading,b=(0,h.D9)(y),[S,w]=(0,s.useState)();(0,s.useEffect)((()=>{b&&!y&&w(Date.now())}),[y,b]),(0,s.useEffect)((()=>{const e=!!S&&Date.now()-S<1e3;(y||e)&&f&&v&&d()}),[f,y,d,v,S]);const k=(0,u.VK)((()=>{const e=_t.Z.state.phase===_t.i.hidden||_t.Z.state.phase===_t.i.willHide,t=_t.Z.estimatedNativeWebBottomOverlap()+Et;return e?m.getSafePaddingBottomPx(t):t}),[m]);return s.createElement("div",{ref:a,style:{position:"absolute",bottom:k,left:Rt,right:Rt,zIndex:Ct.Mo}},t)}const Lt="notion-alternate-ai-ui";function Vt(e){window.__c={n:"CompletionPopup"};const{scrollerStore:t}=e,o=(0,p.O7)(),i=(0,u.VK)((()=>x.default.state),[]);(0,Z.w9)(i);const n=(0,s.useMemo)((()=>(0,te.RR)(i)),[i]),r=(0,u.VK)((()=>n&&(0,te.$b)(n)),[n]),l=(0,u.VK)((()=>o.device.isPhone),[o]);return n?t!==(null==r?void 0:r.scrollerStore)?null:a()(l?Ft:xt,{scrollerStore:t,openState:n},void 0,a()(Nt,{openState:n})):null}function Nt(e){const{openState:t}=e,o=(0,p.O7)(),i=(0,b.useIntl)(),r=(0,s.useState)(function(e){switch(e.stage){case"results":return"";case"initialPromptForAIBlock":return e.prompt??e.prefilledValue;case"initialPrompt":return e.prefilledValue}}(t))[0],[A,D]=function(e){const t=(0,b.useIntl)(),[o,i]=(0,s.useState)("");return[(0,u.VK)((()=>{if("initialPromptForAIBlock"!==e.stage||!(0,I.dU)())return o;const i=e.store.getTitleValue();return(0,v.Xh)({intl:t,textValue:i,getRecordModel:e.store.getRecordModel,userTimeZone:(0,g.r)()})}),[o,t,e]),i]}(t),[F,L]=(0,s.useState)(!1),[V,N]=(0,s.useState)(""),O=(0,z.mY)(),H=(0,s.useRef)(null),W=(0,te.rR)(t),j=(0,s.useMemo)((()=>({environment:o,blocks:[],publicEditMode:void 0})),[o]);(0,Z.lZ)(t);const K=(0,s.useCallback)((e=>{w.trackAICompletionPopupUpdatePromptText(o,{session_id:t.sessionId,type:e.analyticsName}),D(e.insertText),C.so(o,e.insertText),H.current&&H.current.focusInput()}),[t.sessionId,o,D]),Y="results"===t.stage?(0,I.xM)(t).completion:void 0,G=(0,h.Z_)(Y,C.Z1,f.Z),X="results"===t.stage?t:void 0,q=(0,s.useMemo)((()=>{if(!X||"textSelection"!==X.context.type&&"blockSelection"!==X.context.type)return;const{userSearchCache:e}=(0,I.xM)(X);return G?l.Z.withListenerIgnored((()=>{const t=new c.Z;t.isTemporaryData=!0;const i=_.createAndCommit({userAction:"CompletionPopup.temporarymarkdownToBlocks",environment:o,canUndo:!1,perform:i=>{const n=k.Mt({environment:o,text:G,inMemoryRecordCache:t,transaction:i,markdownOptions:(0,P.N9)(e)});if(n)return C.Q(o,n),k.Lh({environment:o,stores:n,inMemoryRecordCache:t,transaction:i})}}).performResult;return t.addCacheFallback(o.defaultRecordCache.inMemoryRecordCache),i})):void 0}),[X,G,o]),$=(0,u.VK)((()=>{if(!q||!X||"completionPopup"!==X.type||"results"!==X.stage||"textSelection"!==X.context.type&&"blockSelection"!==X.context.type)return;return X.context.stores.every((e=>{const t=e.getType();return!!t&&("blockSelection"===X.context.type?Boolean(I.d5[t]):"textSelection"===X.context.type&&Boolean(I.DD[t]))}))}),[X,q]);let J=!0,Q=!1;switch(t.stage){case"initialPrompt":if(t.futureRevisions.length>0)break;case"initialPromptForAIBlock":J=!1;break;case"results":t.loading||"cursor"!==t.context.type||""!==A||(Q=!0);break;default:(0,y.t1)(t)}const ne=function(e){const{environment:t,sessionId:o}=e,i=(0,s.useCallback)((e=>{let{exitType:i,selectInsertion:n}=e;const r=x.default.state;"completionPopup"!==r.type||"results"!==r.stage||r.loading||(w.trackAICompletionPopupClose(t,{session_id:o,inference_id:(0,I.xM)(r).inferenceId,exit_type:i}),_.createAndCommit({userAction:"CompletionPopup.handleAccept",environment:t,perform:e=>{C.y3({environment:t,transaction:e,selectInsertion:n,exitType:i})}}))}),[t,o]),n=(0,s.useCallback)((()=>{const e=x.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||((0,te.Tq)(t),w.trackAICompletionPopupClose(t,{session_id:o,inference_id:(0,I.xM)(e).inferenceId,exit_type:"insert"}),"textSelection"===e.context.type?_.createAndCommit({userAction:"CompletionPopup.handleInsert",environment:t,perform:e=>{C.QS({environment:t,transaction:e})}}):"blockSelection"===e.context.type&&_.createAndCommit({userAction:"CompletionPopup.handleInsert",environment:t,perform:e=>{C.Jt({environment:t,transaction:e,replace:!1})}}))}),[t,o]),r=(0,s.useCallback)((()=>{const e=x.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||"textSelection"!==e.context.type&&"blockSelection"!==e.context.type||((0,te.Tq)(t),w.trackAICompletionPopupClose(t,{session_id:o,inference_id:(0,I.xM)(e).inferenceId,exit_type:"replace"}),"textSelection"===e.context.type?_.createAndCommit({userAction:"CompletionPopup.handleReplace",environment:t,perform:e=>{C.w_({environment:t,transaction:e})}}):"blockSelection"===e.context.type&&_.createAndCommit({userAction:"CompletionPopup.handleReplace",environment:t,perform:e=>{C.Jt({environment:t,transaction:e,replace:!0})}}))}),[t,o]);return(0,s.useMemo)((()=>({onAccept:i,onInsert:n,onReplace:r})),[i,n,r])}({environment:o,sessionId:t.sessionId});(0,s.useEffect)((()=>{D(r),H.current&&H.current.focusInput()}),[r,D]);const re="results"===t.stage&&t.hasErrored,ae=(0,h.D9)(re),ce=re&&!ae,de=(0,s.useCallback)((e=>{const{purgeFromHistory:t}=e,n=C.me({environment:o,purgeFromHistory:t});n&&"followup"===n.type&&(D(bt(i,n.improvement)),H.current&&H.current.focusInput())}),[o,i,D]),pe=(0,s.useCallback)((()=>{"results"===t.stage&&(C.me({environment:o,purgeFromHistory:!1}),H.current&&H.current.focusInput())}),[t,o]),ue=(0,s.useCallback)((()=>{"results"===t.stage&&(C.p_(o),H.current&&H.current.focusInput())}),[o,t]);(0,s.useEffect)((()=>{if(!ce||"results"!==t.stage)return;const{sessionId:e}=t;if((0,I.sr)(t))return void de({purgeFromHistory:!0});const i=(0,I.Iz)(t);C.mN(i)?(D(V),(0,R.jn)({environment:o})):C.oy({environment:o,sessionId:e,inferenceId:i.inferenceId,exitType:"error_modal"})}),[o,ce,t,V,de,D]);const me=(0,s.useCallback)((()=>{if("results"!==t.stage)return;const{sessionId:e}=t,i=(0,I.xM)(t);if((0,I.sr)(t))return w.trackAICompletionPopupRetry(o,{session_id:e,inference_id:i.inferenceId,is_reverting_follow_up_improvement:!0}),void de({purgeFromHistory:!1});w.trackAICompletionPopupRetry(o,{session_id:e,inference_id:i.inferenceId,is_reverting_follow_up_improvement:!1});const n=(0,I.Iz)(t);C.mN(n)?(D((0,I.gY)(n)),(0,R.jn)({environment:o})):C.Wv({environment:o})}),[o,t,de,D]),ge=(0,s.useCallback)((()=>{if("results"!==t.stage)return;if(!(0,I.xM)(t).completion)return(0,I.sr)(t)?void de({purgeFromHistory:!0}):(D(V),void(0,R.jn)({environment:o}));C.jN(o)}),[t,o,de,V,D]),he=(0,s.useCallback)((()=>{L(!1),d.default.afterNextFlush((()=>{H.current&&H.current.focusInput()}))}),[]),fe=(0,s.useCallback)((()=>{switch(t.stage){case"initialPromptForAIBlock":w.trackAICompletionPopupClose(o,{session_id:t.sessionId,inference_id:void 0,exit_type:"accept"}),(0,R.fz)();break;case"initialPrompt":D(""),(0,R.sj)();break;case"results":break;default:(0,y.t1)(t)}}),[t,o,D]),ve=(0,s.useCallback)((e=>{switch((0,te.Tq)(o),L(!1),t.stage){case"initialPrompt":case"initialPromptForAIBlock":w.trackAICompletionPopupClose(o,{session_id:t.sessionId,inference_id:void 0,exit_type:e}),(0,R.fz)();break;case"results":C.oy({environment:o,sessionId:t.sessionId,inferenceId:(0,I.xM)(t).inferenceId,exitType:e});break;default:(0,y.t1)(t)}}),[t,o]),ye=(0,s.useCallback)((()=>ve("cancel")),[ve]),be=(0,s.useCallback)((()=>{"active"!==O.type?Q?ne.onAccept({exitType:"click_outside_window_accept",selectInsertion:!0}):J?L(!0):ve("click_outside_window_cancel"):(0,z.bi)({state:O})}),[O,Q,ne,ve,J]),Se=(0,u.VK)((()=>(0,I.dU)()),[]);(0,s.useEffect)((()=>{function e(e){return!!(e instanceof Element&&(e.closest(`.${Lt}`)||e.closest(`.${T.YPt}`)||e.closest(`.${T.p4m}`)||e.closest(`.${T.zov}`)))}function t(t){Se||!e(t.target)&&e(t.relatedTarget)&&t.relatedTarget instanceof HTMLElement&&t.relatedTarget.focus()}function o(t){e(t.target)||("click"!==t.type&&"contextmenu"!==t.type||be(),Se||(t.preventDefault(),t.stopPropagation()))}if(!F)return window.addEventListener("focus",t,!0),window.addEventListener("click",o,!0),window.addEventListener("contextmenu",o,!0),window.addEventListener("mousedown",o,!0),window.addEventListener("mouseup",o,!0),window.addEventListener("mouseover",o,!0),window.addEventListener("mouseout",o,!0),window.addEventListener("mouseenter",o,!0),window.addEventListener("mouseleave",o,!0),window.addEventListener("mousemove",o,!0),()=>{window.removeEventListener("focus",t,!0),window.removeEventListener("click",o,!0),window.removeEventListener("contextmenu",o,!0),window.removeEventListener("mousedown",o,!0),window.removeEventListener("mouseup",o,!0),window.removeEventListener("mouseover",o,!0),window.removeEventListener("mouseout",o,!0),window.removeEventListener("mouseenter",o,!0),window.removeEventListener("mouseleave",o,!0),window.removeEventListener("mousemove",o,!0)}}),[be,F,Se]);const we=(0,s.useCallback)((e=>{N(A),D(""),C.Vk(o,e)}),[o,A,D]),ke=(0,s.useCallback)((()=>{switch(t.stage){case"initialPrompt":(0,R.sj)(),N(A),D(""),(0,S.Hh)({environment:o,inputValue:A,from:t.from,mode:W});break;case"initialPromptForAIBlock":w.trackAICompletionPopupClose(o,{session_id:t.sessionId,inference_id:void 0,exit_type:"accept"}),(0,R.fz)(),N(A),D(""),(0,S.F0)({environment:o,inputValue:A,store:t.store});break;case"results":we({type:"helpMeEdit",prompt:A});break;default:(0,y.t1)(t)}}),[A,W,t,o,we,D]);let Ce="insert";"results"===t.stage&&"cursor"===t.context.type?Ce="accept":$&&(Ce="replace");const _e=(0,u.VK)((()=>t?yt({environment:o,intl:i,filter:A,state:t,from:t.from,favoriteEditingState:O,onUpdatePromptState:K,onImprove:we,context:j,completionResultInfo:{...ne,onRetry:me,onSubmit:ke,onCancel:ye,defaultAction:Ce}}):[]),[O,j,o,K,ke,we,A,i,t,ne,me,ye,Ce]),Me=_e.length>0,Te=(0,s.useMemo)((()=>new B.Z),[]);(0,s.useEffect)((()=>{Te.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[A,Te]);const Ie=(0,u.VK)((()=>o.device.isPhone),[o]),Pe=(0,m.yK)((e=>({menuPopup:{marginTop:4,marginBottom:4,borderRadius:6,background:e.popoverBackground,boxShadow:e.mediumBoxShadow,width:Ie?"100%":320,overflow:"hidden",isolation:"isolate"}})),[Ie]),xe=(0,s.useRef)(null);let Be;"active"===O.type?Be=s.createElement("div",{style:Pe.menuPopup,ref:xe,className:Lt},a()(ee,{state:O,context:j})):Me&&(Be=s.createElement(s.Fragment,null,s.createElement("div",{style:Pe.menuPopup,ref:xe,className:Lt},a()(kt,{sections:_e,onCloseParentMenu:fe,context:j,menuListStore:Te})),a()(E.gl,{originRef:xe,openState:t,isInputEmpty:!A})));const Ze=(0,s.useRef)(null),Ee=function(e){const{openState:t,undoRevision:o,redoRevision:i}=e,n=(0,p.O7)(),r=(0,b.useIntl)(),a=(0,u.VK)((()=>oe.default.checkGate("ai_multi_level_undo")),[]),l=(0,s.useCallback)((()=>{o(),le(n,"undo")}),[n,o]),c=(0,s.useCallback)((()=>{i(),le(n,"redo")}),[n,i]);if("results"!==t.stage||!a)return se;const d=t.revisions.length,m=t.futureRevisions.length,g=d+m,h=d;return 1===g?se:{onUndo:d>1?l:void 0,onRedo:m>0?c:void 0,historyLabel:r.formatMessage(ie.historyLabel,{currentRevision:h.toString(),totalRevisions:g.toString()})}}({openState:t,undoRevision:pe,redoRevision:ue});return s.createElement(s.Fragment,null,a()(M.Z,{capture:!0,onEsc:be}),Ie&&Be,a()(E.RD,{originRef:Ze,openState:t}),s.createElement("div",{ref:Ze,className:Lt},s.createElement(at,n()({state:t,onDismiss:be,onCompletionRetry:me,onCompletionStop:ge,query:A,setQuery:D,onSubmit:ke,submitOnEnter:!Me&&!F,inputRef:H,temporaryListStore:q,favoriteEditingState:O},Ee))),!Ie&&Be,a()(U,{open:F,onConfirmExit:ye,onCancelExit:he}))}},63594:(e,t,o)=>{o.d(t,{Z:()=>i});const i=new(o(12318).default)(!0)},92022:(e,t,o)=>{o.d(t,{jn:()=>h,fz:()=>f,sj:()=>v,yd:()=>y,hr:()=>b});var i=o(4615),n=o(50906),r=o(73928),a=o(84084),s=o(98104),l=o(99417),c=o(68056),d=o(16772),p=o(27724),u=o(24666),m=o(89626);function g(e){"completionPopup"!==e.type||"initialPrompt"!==e.stage||"textSelection"!==e.context.type&&"cursor"!==e.context.type||s.NA({multiSelection:e.context.textSelection})}function h(e){d.default.invalidateLastUpdater();const{environment:t}=e,{state:o}=d.default;if("completionPopup"!==o.type||"results"!==o.stage)return;t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(o.inMemoryRecordCache);const i={type:"completionPopup",stage:"initialPrompt",prefilledValue:"",context:o.context,sessionId:o.sessionId,from:o.from,futureRevisions:[...o.revisions,...o.futureRevisions]};d.default.setState(i)}function f(){g(d.default.state),d.default.setState({type:"closed"})}function v(){const{state:e}=d.default;g(e),"completionPopup"===e.type&&"initialPrompt"===e.stage&&d.default.setState({type:"closedWithContext",context:e.context,sessionId:e.sessionId,futureRevisions:e.futureRevisions}),setTimeout((()=>r.bi()),1)}function y(e){d.default.setState({...e,type:"completionPopup",stage:"initialPromptForAIBlock",from:"ai_block",prefilledValue:"",sessionId:(0,i.ZP)()}),S({environment:e.environment,promptForAnalytics:e.clientPrompt})}function b(e){const{environment:t,from:o}=e;let{context:n,prefilledValue:r,sessionId:a}=e,s={type:"closed"};if("closed"===d.default.state.type){if(!n&&p.default.state.stores.length>0){const e=u.default.state;n="empty"===e.mode?(0,l.Xc)():(0,c.iG)(e.multiSelection)?(0,l.FD)():(0,l.Fu)()}n&&(r||(r=""),a||(a=(0,i.ZP)()),s={type:"completionPopup",stage:"initialPrompt",context:n,from:o,prefilledValue:r,sessionId:a,futureRevisions:[]},"spacebar"===o&&(0,m.ON)(t))}d.default.setState(s),S(e)}function S(e){const{environment:t,promptForAnalytics:o}=e,{state:i}=d.default;"completionPopup"===i.type&&"results"!==i.stage&&(s.ZH(t),n.trackAICompletionPopupOpen(t,{session_id:i.sessionId,prompt_key:(null==o?void 0:o.key)??(i.prefilledValue?"unknown":"alternative_ui_empty_input"),from:i.from}),a.xv())}},96431:(e,t,o)=>{o.r(t),o.d(t,{resetRecentAndFavoriteActionsForDebugging:()=>r});var i=o(30149),n=o(37181);function r(e,t){i.createAndCommit({userAction:"recentActions.resetRecentActionsForDebugging",environment:e,perform(e){n.d2({userSettingsStore:t,transaction:e,data:{recent_ai_actions:[],favorite_ai_actions:[]}})}})}},76095:(e,t,o)=>{o.d(t,{YX:()=>M,mY:()=>I,Mi:()=>B,m5:()=>Z,ny:()=>E,bi:()=>R,IW:()=>A,Gb:()=>D});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(81954),c=o(3779),d=o(5366),p=o(4615),u=o(97880),m=o(96323),g=o(62967),h=o(47307),f=o(64964),v=o(30149),y=o(73063),b=o(72495),S=o(95477),w=o(79315),k=o(10161),C=o(30793),_=o(71184);const M="favorite-actions",T=(0,d.defineMessages)({favoriteActions:{defaultMessage:"Favorites",id:"ai.favoriteActions.title",description:"Label for the 'favorite actions' section of the AI menu"}});function I(){const[e,t]=(0,s.useState)(void 0),o=(0,l.VK)((()=>k.default.checkGate("ai_favorites")),[]);return(0,s.useMemo)((()=>o?e?{type:"active",current:e,set:t,clear:()=>t(void 0)}:{type:"inactive",set:t}:{type:"disabled"}),[e,o])}const P={maxWidth:400,whiteSpace:"pre-wrap"};function x(e){window.__c={n:"FavoriteActionTooltip"};const{value:t}=e;return n()("div",{style:P},void 0,n()("div",{},void 0,t.action.prompt))}function B(e,t,o,i,r){const a=(0,_.JS)(o),l=[];for(const s of a){const t=e=>n()("div",{style:{display:"flex"}},void 0,n()(y.Z,{style:{visibility:e.focused?"visible":"hidden",width:18,height:18},onClick:()=>{r.favoriteEditingState.set(s)},icon:c.Z.editPropertyType,ariaLabel:"TODO i18n"}),n()(m.xj,{type:"updatePrompt",focused:e.focused}));let o=!1;switch(s.action.type){case"helpMeEdit":"initialPrompt"!==e.stage||"blockSelection"!==e.context.type&&"textSelection"!==e.context.type||(o=!0);break;case"helpMeWrite":"initialPromptForAIBlock"!==e.stage&&"cursor"!==e.context.type||(o=!0);break;default:(0,u.t1)(s.action)}if(o){const e=(0,m.cK)({key:s.id,name:s.name,textToInsert:s.action.prompt,analyticsName:"favoriteAction",onUpdatePromptState:r.onUpdatePromptState,right:t,renderTooltip:()=>n()(x,{value:s})});l.push(e)}}return[(0,g.$J)({key:M,title:T.favoriteActions,render:e=>s.createElement(b.Z,e),actions:l})]}function Z(e){const{state:t,environment:o}=e,{currentUserSettingsStore:i}=w.default.state;i&&(t.current.name?(v.createAndCommit({userAction:"favoriteActions.saveFavoriteEditsAndClearState",environment:o,perform(e){(0,_.gC)(t.current,i,e)}}),t.clear()):f.oV({label:"Please enter a name for the action."}))}function E(e){const{state:t,environment:o}=e,{currentUserSettingsStore:i}=w.default.state;i&&(t.current.name||v.createAndCommit({userAction:"favoriteActions.cancelFavoriteEditsAndClearState",environment:o,perform(e){(0,_.QC)(t.current,i,e),(0,C.Nv)(t.current.action,i,e)}}),t.clear())}async function R(e){const{state:t}=e,{currentUserSettingsStore:o}=w.default.state;if(o){const e=(0,_.JS)(o).filter((e=>e.id===t.current.id));if(e.length>0&&a().isEqual(t.current,e[0]))return void t.clear()}await h.confirmUserAction({message:"Are you sure you want to stop editing your favorite? Unsaved changes will be lost.",acceptLabel:"Discard changes",cancelLabel:"Go back"})&&t.clear()}async function A(e){const t=new URLSearchParams({prompt:e.action.prompt,title:e.name||"untitled",type:e.action.type}),o=`${S.Z.domainBaseUrl}/ai-favorite?${t.toString()}`;try{await navigator.clipboard.writeText(o)}catch(i){return void f.oV({label:"An error occurred while copying the link to your clipboard."})}f.oV({label:"Link copied. Share it with others who may find this useful."})}async function D(e){const{environment:t,importArgs:o}=e,{currentUserSettingsStore:i}=w.default.state;if(!i)return;const n={id:(0,p.ZP)(),name:o.title,action:{type:o.type,prompt:o.prompt}},r=(0,_.JS)(i);let a=`"${n.name}" AI action added to your Favorites.`;for(const s of r)if(s.name===n.name){if(s.action.type===n.action.type&&s.action.prompt===n.action.prompt)return void f.oV({label:`"${s.name}" AI action is already in your Favorites.`});if(!(await h.confirmUserAction({message:`An AI action called "${s.name}" is already in your Favorites. Overwrite it?`,acceptLabel:"Overwrite existing AI action",cancelLabel:"Keep existing AI action"})))return;n.id=s.id,a=`"${n.name}" AI action updated in your Favorites.`}v.createAndCommit({userAction:"favoriteActions.handleFavoriteImport",environment:t,perform(e){(0,_.gC)(n,i,e)}}),f.oV({label:a})}},71184:(e,t,o)=>{o.d(t,{gC:()=>r,JS:()=>a,QC:()=>s});var i=o(37181);function n(e,t){return e.id===t.id}function r(e,t,o){const r=a(t).slice(),s=r.findIndex((t=>n(e,t)));-1===s?r.unshift(e):r.splice(s,1,e),i.d2({userSettingsStore:t,transaction:o,data:{favorite_ai_actions:r}})}function a(e){var t,o;return(null===(t=e.getModel())||void 0===t||null===(o=t.getSettings())||void 0===o?void 0:o.favorite_ai_actions)??[]}function s(e,t,o){const r=a(t).filter((t=>!n(t,e)));i.d2({userSettingsStore:t,transaction:o,data:{favorite_ai_actions:r}})}},57819:(e,t,o)=>{o.d(t,{bJ:()=>d,RR:()=>p,VZ:()=>u,rR:()=>m,Tq:()=>g,$b:()=>h,jq:()=>f});var i=o(67294),n=o(480),r=o(81954),a=o(24405),s=o(66673),l=o(99417),c=o(72133);function d(){const e=(0,n.O7)(),t=(0,r.VK)((()=>e.device.isPhone),[e]);return(0,a.yK)((e=>{const o="dark"===e.mode?e.accentColors.purple[900]:e.accentColors.purple[400];return{purpleButton:{padding:4,fontWeight:600,color:o},keyboardShortcut:{textTransform:"uppercase",fontWeight:500,fontSize:11,marginLeft:6,color:e.lightTextColor,display:t?"none":void 0},lightweightButton:{display:"flex",alignItems:"baseline",justifyContent:"center",fontSize:14,padding:"5px 8px",borderRadius:4,color:e.mediumTextColor,height:32,marginTop:2},returnIndicatorIconStyles:{width:14,height:14,paddingLeft:4,fill:e.lightIconColor},keyboardShortcutInverted:{color:e.mediumInvertedTextColor,paddingLeft:4},writingLabel:{flex:1,color:o,fontWeight:500,flexDirection:"row",gap:6,display:"flex",alignItems:"center"},inputActions:{height:36,display:"flex",alignSelf:"flex-end",alignItems:"center"},loadingDots:{backgroundColor:o}}}),[t])}function p(e){if("completionPopup"===e.type)return e}function u(e){return"initialPromptForAIBlock"===e.stage?"aiBlock":e.context.type}function m(e){return"initialPromptForAIBlock"===e.stage?"write":function(e){switch(e.type){case"cursor":return"write";case"blockSelection":case"textSelection":return"edit"}}(e.context)}function g(e){c.clear(e)}function h(e){if("initialPromptForAIBlock"===e.stage){const t=e.originRef.current;if(!t)return;const o=t.getBoundingClientRect(),i=e.store.getRecordStoreUIRoot();return{origin:o,scrollerStore:(0,l.Dj)(i)}}return e.context}function f(e){const{areWeLoading:t,scrollerStore:o,resetWhenScrolledToBottom:n}=e,a=(0,s.D9)(t);(0,i.useEffect)((()=>{t!==a&&c(!1)}),[t,a]);const[l,c]=(0,i.useState)(!1),d=(0,r.VK)((()=>null==o?void 0:o.state.scrollTop),[o]),p=(0,s.D9)(d),u=(0,r.VK)((()=>{const e=null==o?void 0:o.state.clientRect;if(e)return o.state.scrollHeight-e.height}),[o]);return(0,i.useEffect)((()=>{void 0!==p&&void 0!==d&&p-d>1&&c(!0)}),[d,p]),(0,i.useEffect)((()=>{n&&void 0!==d&&void 0!==u&&Math.abs(d-u)<1&&c(!1)}),[u,d,n]),l}},30793:(e,t,o)=>{o.d(t,{Nv:()=>s,pz:()=>l,lG:()=>c});var i=o(96486),n=o.n(i),r=o(37181);function a(e,t){return n().isEqual(e,t)}function s(e,t,o){const i=l(t).filter((t=>!a(t,e)));r.d2({userSettingsStore:t,transaction:o,data:{recent_ai_actions:[e,...i].slice(0,100)}})}function l(e){var t,o;return(null===(t=e.getModel())||void 0===t||null===(o=t.getSettings())||void 0===o?void 0:o.recent_ai_actions)??[]}function c(e,t,o){const i=l(t).filter((t=>!a(t,e)));r.d2({userSettingsStore:t,transaction:o,data:{recent_ai_actions:i}})}},97832:(e,t,o)=>{o.d(t,{Z:()=>I});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(3779),p=o(90965),u=o(82990),m=o(5366),g=o(7512),h=o(50906),f=o(86080),v=o(71119),y=o(38755),b=o(79315),S=o(92083),w=o(11066),k=o(63296),C=o(93007),_=o(23189),M=o(55422);class T extends l.Z{constructor(){super(...arguments),this.handleDeleteAccountClick=async()=>{const{currentUserStore:e,currentUserRootStore:t}=b.default.state;if(!e||!t)return;if(!e.isDefined())return;const o=a().compact(t.getSpaceViewStores().map((e=>e.getSpaceStore()))).filter((t=>!(0,p.XO)(e.id,t.getModel(),t.getRole()))),i=a().compact(o.map((e=>({id:e.id,name:(0,y.rn)(this.environment,e)}))));h.trackDeleteAccountClicked(this.environment);await f.b({width:420,message:n()("div",{},void 0,n()("div",{},void 0,n()(m.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.warning",defaultMessage:"This action cannot be undone. This will permanently delete your entire account. All private workspaces will be deleted, and you will be removed from all shared workspaces."}),i.length>0&&n()("ul",{style:{padding:0}},void 0,i.map((e=>{let{id:t,name:o}=e;return n()("li",{style:{marginTop:6,color:c.ZP.red,fontWeight:u.Z.fontWeight.medium,listStyle:"none"}},t,o)})))," ",n()(m.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.prompt",defaultMessage:"Please type in your email to confirm."})),n()(C.Z,{style:{marginTop:16},translations:{es:"Esta acción no se puede deshacer. Esto eliminará permanentemente su cuenta completa. Se eliminarán todas las áreas de trabajo privadas y se eliminará de todas las áreas de trabajo compartidas. Por favor, escriba su correo electrónico para confirmar.",ru:"Это действие не может быть отменено. Это навсегда удалит всю вашу учетную запись. Все частные рабочие области будут удалены, и вы будете удалены из всех общих рабочих областей. Пожалуйста, введите ваш адрес электронной почты для подтверждения.",zh:"此操作无法撤消。 这将永久删除您的整个帐户。 将删除所有私有工作空间，您将从所有共享工作空间中删除。 请输入您的电子邮箱进行确认。",de:"Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird Ihr gesamtes Konto dauerhaft gelöscht. Alle privaten Arbeitsbereiche werden gelöscht und Sie werden aus allen freigegebenen Arbeitsbereichen entfernt. Bitte geben Sie Ihre E-Mail-Adresse zur Bestätigung ein.",fr:"Cette action ne peut pas être annulée. Cela supprimera définitivement votre compte en entier. Tous les espaces de travail privés seront supprimés et vous serez supprimé de tous les espaces de travail partagés. Veuillez taper votre email pour confirmer.",ja:"この操作を元に戻すことはできません。 これによりアカウント全体が完全に削除されます。 すべてのプライベートワークスペースが削除され、あなたはすべての共有ワークスペースから削除されます。 確認のためにメールアドレスを入力してください。",it:"Questa azione non può essere annullata. Questo eliminerà definitivamente l'intero account. Tutti gli spazi di lavoro privati verranno eliminati e verranno rimossi da tutti gli spazi di lavoro condivisi. Inserisci la tua email per confermare.",pt:"Essa ação não pode ser desfeita. Isso excluirá permanentemente sua conta inteira. Todos os espaços de trabalho privados serão excluídos e você será removido de todos os espaços de trabalho compartilhados. Por favor, digite o seu email para confirmar.",nl:"Deze actie kan niet ongedaan gemaakt worden. Hiermee wordt uw gehele account permanent verwijderd. Alle privéwerkruimten worden verwijderd en u wordt verwijderd uit alle gedeelde werkruimten. Voer je e-mailadres in om te bevestigen.",pl:"Tego działania nie można cofnąć. Spowoduje to trwałe usunięcie całego konta. Wszystkie prywatne obszary robocze zostaną usunięte, a użytkownik zostanie usunięty ze wszystkich współużytkowanych obszarów roboczych. Wpisz swój e-mail, aby potwierdzić.",sv:"Den här åtgärden kan inte ångras. Detta tar bort hela ditt konto permanent. Alla privata arbetsytor kommer att raderas, och du kommer att tas bort från alla delade arbetsytor. Vänligen skriv in din email för att bekräfta.",uk:"Цю дію не можна скасувати. Таким чином буде видалено весь обліковий запис назавжди. Всі приватні робочі області будуть видалені, і ви будете видалені з усіх спільних робочих областей. Будь ласка, введіть електронний лист для підтвердження.",no:"Denne handlingen kan ikke fortrykkes. Dette vil permanent slette hele kontoen din. Alle private arbeidsområder blir slettet, og du vil bli fjernet fra alle delte arbeidsområder. Vennligst skriv inn din epost for å bekrefte.",tr:"Bu işlem geri alınamaz. Bu işlem hesabınızın tamamını kalıcı olarak siler. Tüm özel çalışma alanları silinecek ve paylaşılan tüm çalışma alanlarından kaldırılacaksınız. Lütfen onaylamak için e-postanızı yazın.",cs:"Tuto akci nelze vrátit zpět. Tím bude trvale smazán celý váš účet. Všechny soukromé pracovní prostory budou smazány a budete ze všech sdílených pracovních prostor odstraněni. Pro potvrzení zadejte svůj e-mail.",vi:"Hành động này không thể được hoàn tác. Điều này sẽ xóa vĩnh viễn toàn bộ tài khoản của bạn. Tất cả các không gian làm việc riêng tư sẽ bị xóa và bạn sẽ bị xóa khỏi tất cả các không gian làm việc chung. Vui lòng nhập email của bạn để xác nhận.",da:"Denne handling kan ikke fortrydes. Dette vil permanent slette hele din konto. Alle private arbejdsområder slettes, og du vil blive fjernet fra alle delte arbejdsområder. Indtast venligst din email for at bekræfte.",hu:"Ez a művelet nem visszavonható. Ez véglegesen törli a teljes fiókot. Minden privát munkaterület törlődik, és eltávolításra kerül minden megosztott munkaterületről. Kérjük, írja be e-mail címét, hogy megerősítse.",ar:"لا يمكن التراجع عن هذا الإجراء. سيؤدي الإجراء إلى حذف حسابك بالكامل. سيتم أيضا حذف جميع مساحات العمل الخاصة ، وستتم إزالتك من جميع مساحات العمل المشتركة. يرجى كتابة البريد الإلكتروني الخاص بك للتأكيد.",th:"การกระทำนี้ไม่สามารถยกเลิกได้ นี่จะเป็นการลบบัญชีทั้งหมดของคุณอย่างถาวร พื้นที่ทำงานส่วนตัวทั้งหมดจะถูกลบและคุณจะถูกลบออกจากพื้นที่ทำงานที่ใช้ร่วมกันทั้งหมด กรุณาพิมพ์อีเมลของคุณเพื่อยืนยัน",he:"לא ניתן לבטל פעולה זו. פעולה זו תמחק לצמיתות את כל החשבון שלך. כל סביבות העבודה הפרטיות יימחקו, ותוסר מכל סביבות העבודה המשותפות. הקלד את האימייל שלך כדי לאשר.",fi:"Tätä toimintoa ei voi peruuttaa. Tämä poistaa koko tilin pysyvästi. Kaikki yksityiset työtilat poistetaan ja poistetaan kaikista jaetuista työtiloista. Vahvistaaksesi kirjoita sähköpostiosoitteesi.",id:"Tindakan ini tidak bisa dibatalkan. Ini akan secara permanen menghapus seluruh akun Anda. Semua ruang kerja pribadi akan dihapus, dan Anda akan dihapus dari semua ruang kerja bersama. Ketikkan email Anda untuk mengonfirmasi."}})),acceptLabel:0===i.length?n()(m.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountButton.label",defaultMessage:"Permanently delete account"}):this.environment.device.isMobile?n()(m.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountAndWorkspacesButtonMobile.label",description:"The confirmation button on mobile when the user is trying to delete their account.",defaultMessage:"{numberOfWorkspaces, plural, one {Delete account & 1 workspace} other {Delete account & {numberOfWorkspaces} workspaces}}",values:{numberOfWorkspaces:i.length}}):n()(m.FormattedMessage,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountAndWorkspacesButton.label",defaultMessage:"{numberOfWorkspaces, plural, one {Permanently delete account and 1 workspace} other {Permanently delete account and {numberOfWorkspaces} workspaces}}",values:{numberOfWorkspaces:i.length}}),requiredInputValue:e.getEmail()})&&(h.trackDeleteAccountConfirmed(this.environment),S.Z.reset(),g.t(this.environment))}}renderComponent(){const{device:e}=this.environment;return(0,v.DH)()?n()(M.Z,{type:"custom",isMobile:e.isMobile,title:n()(m.FormattedMessage,{id:"profileSettings.accountDeletionSetting.title",defaultMessage:"Delete my account",description:"Title of setting in profile section to allow user to delete their account"}),caption:n()(m.FormattedMessage,{id:"manageActiveSessions.accountDeletionSetting.label",defaultMessage:"Permanently delete the account and remove access from all workspace.",description:"Caption describing that the user will delete their account and lose access to all workspaces"}),isCritical:!0,customButton:e.isMobile?n()(k.Z,{isLarge:!0,isRed:!0,onClick:this.handleDeleteAccountClick},void 0,n()(m.FormattedMessage,{id:"profileSettings.deleteMyAccount.button.label",defaultMessage:"Delete my account",description:"Button label for mobile devices that allows user to delete their account."})):n()(w.Z,{style:{borderRadius:"0.25em"},onClick:this.handleDeleteAccountClick},void 0,d.Z.chevronRightRoundedThin(this.getIconStyle()))}):s.createElement(s.Fragment,null,n()(_.Z,{},void 0,n()(m.FormattedMessage,{id:"profileSettings.dangerousSettings.title",defaultMessage:"Danger zone",description:"Title for the user settings that we consider 'dangerous', like deleting an account."})),n()(k.Z,{isLarge:!0,isRed:!0,onClick:this.handleDeleteAccountClick},void 0,n()(m.FormattedMessage,{id:"profileSettings.dangerousSettings.deleteAccountButton.label",defaultMessage:"Delete my account"})))}getIconStyle(){return{width:20,height:20,fill:this.theme.lightIconColor}}getSettingTextStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}getSettingStyle(){return{display:"flex",flexDirection:"row",alignItems:"center"}}}T.displayName="AccountDeletion";const I=T},24736:(e,t,o)=>{o.d(t,{Z:()=>l});var i=o(77094),n=o.n(i),r=(o(67294),o(24405)),a=o(3779),s=o(64921);function l(e){let{onClick:t,className:o,isMobile:i,style:l,onFocus:c,onBlur:d,onMouseDown:p,onMouseEnter:u,onMouseLeave:m}=e;window.__c={n:"ActionMenuButton"};const{buttonStyle:g,iconStyle:h}=(0,r.yK)((e=>({buttonStyle:{display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,borderRadius:3,width:i?45:24,height:i?45:24,marginRight:i?-8:-6,...l},iconStyle:{width:i?18:14,height:i?18:14,fill:e.mediumIconColor}})),[i,l]);return n()(s.Z,{onClick:t,style:g,className:o,mobileFeedback:i,onFocus:c,onBlur:d,onMouseDown:p,onMouseEnter:u,onMouseLeave:m},void 0,a.Z.dots(h))}},87636:(e,t,o)=>{o.d(t,{Z:()=>f});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(13991),l=o(80357),c=o(97880),d=o(82990),p=o(17311),u=o(30016),m=o(64921),g=o(58032);class h extends a.Z{renderComponent(){const{children:e,isVisible:t,position:o,style:i}=this.props,a=r.Children.toArray(e).filter(c.$K),s=a.length;return n()(u.Z,{isVisible:!0,animationStyle:{opacity:t?1:0},render:()=>r.createElement("div",(0,l.iv)(this.getContainerStyle(),i,t&&this.getHoveredContainerStyle(),"top"===o&&this.getTopContainerStyle()),a.map(((e,t)=>this.renderChild(
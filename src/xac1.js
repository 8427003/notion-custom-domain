ments'."}),right:t?p.Z.check(P):r,rightStyle:x}))},{key:"mentions-and-replies",action:i,render:e=>s.createElement(T.Z,n()({},e,{title:B({isFollowing:!1}),shouldWrapCaption:!0,caption:a()(M.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.mentionsAndReplies.caption",defaultMessage:"Notified of comment replies and @mentions",description:"Caption on the menu item button to choose to receive notifications for only mentions and replies on a page. The title next to this caption says '@mentions and replies'."}),right:t?r:p.Z.check(P),rightStyle:x}))}],render:e=>s.createElement(I.Z,e)}}({isFollowing:r,setFollowing:d,setNotFollowing:u})),[r,d,u]),g={minWidth:290,menuType:w.og.Popup,maxHeight:"50vh"};return s.createElement(C.Z,g,a()(_.Z,{type:_.i.Vertical,initialFocus:void 0,sections:[m]}))}function E(e){const{blockStore:t,wasFollowing:o,environment:i}=e;return()=>{const e=!o,{currentUserRootStore:n}=k.default.state;if(n){const o=n.id,r=t.id;S.createAndCommit({userAction:"UpdateSidebarFollowControl.setFollowing",environment:i,canUndo:!1,perform:n=>{!function(e){const t=(0,y.$j)({user_id:e.userId,navigable_block_id:e.navigableBlockId});b.ae({environment:e.environment,table:y.t0,value:{id:t,user_id:e.userId,navigable_block_id:e.navigableBlockId,following:e.value,created_time:Date.now(),space_id:e.spaceId},inMemoryRecordCache:e.environment.defaultRecordCache.inMemoryRecordCache,transaction:e.transaction})}({environment:i,value:e,navigableBlockId:r,userId:o,transaction:n,spaceId:t.getSpaceId()}),e?v.trackFollowPage(i,{from:"page_updates"}):v.trackUnfollowPage(i,{from:"page_updates"})}})}}}function R(e){window.__c={n:"GetNotifiedButton"};const{blockStore:t}=e,o=e.moreProminentStyling??!1,i=(0,l.O7)(),r=(0,l.Fy)(),v=(0,c.VK)((()=>A(t)),[t]),y=(0,c.VK)((()=>t.isFollowing()),[t]),b=(0,s.useCallback)((()=>m.Z8({environment:i,pageId:t.pointer.id,isCurrentlyFollowing:y})),[t.pointer.id,i,y]),S=function(e){const{isMobile:t,moreProminentStyling:o}=e;return(0,d.yK)((e=>({buttonContainer:{display:"flex",alignItems:"center",color:e.mediumTextColor,padding:o?"4px 10px":4,borderRadius:3,marginRight:o?0:4,fontSize:t?u.Z.fontSize.UIRegular.mobile:u.Z.fontSize.UIRegular.desktop},bellIcon:{width:14,height:14,marginRight:4},chevronIcon:{marginLeft:4,width:10,height:10},spacer:{flexGrow:1}})),[t,o])}({isMobile:r.isMobile,moreProminentStyling:o});return v?a()(h.Z,{popupType:h.Z.PopupType.Popup,alignmentToOrigin:h.Z.Alignment.End,placementToOrigin:h.Z.Placement.Bottom,sameWidthAsOrigin:o,render:e=>a()(Z,{blockStore:t,onClose:()=>e.close()}),renderOrigin:e=>s.createElement(f.Z,n()({},(0,g.Z)(e,{onClick:b}),{style:S.buttonContainer}),p.Z.bell(S.bellIcon),B({isFollowing:y}),o&&a()("div",{style:S.spacer}),p.Z.chevronDown(S.chevronIcon))}):null}function A(e){return e.isPageBlock()}},45055:(e,t,o)=>{o.d(t,{Z:()=>Ne});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(13991),u=o(6740),m=o(29450),g=o(8848),h=o(3779),f=o(89101),v=o(73409),y=o(7928),b=o(92979),S=o(5366),w=o(50906),k=o(84908),C=o(5978),_=o(39634),M=o(95477),T=o(51456),I=o(44819),P=o(60709),x=o(98742),B=o(33665),Z=o(21115),E=o(47046),R=o(58455),A=o(79315),D=o(10161),F=o(73796),L=o(5188),V=o(475),N=o(16194),O=o(480),U=o(81954),H=o(24405),z=o(88108),W=o(896),j=o(99498),K=o(89859),Y=o(30149),G=o(37181),X=o(31925),q=o(77907),$=o(25464),J=o(78291);function Q(e){const{children:t}=e,o=(0,O.O7)(),[i,n]=c.useState(void 0);(0,c.useEffect)((()=>{(0,z.exposeDebugValue)("resetAddOnDiscountPopup",(()=>{const{currentUserSettingsStore:e}=A.default.state;e&&Y.createAndCommit({userAction:"AddOnDiscountPopup.resetAddOnPromoPopup",environment:o,perform:t=>{G.d2({userSettingsStore:e,transaction:t,data:{seen_ai_discount_popup:!1}})}})}))}),[o]);const{currentUserSettingsStore:r,currentSpaceStore:s}=(0,U.VK)((()=>A.default.state),[]);(0,c.useEffect)((()=>{!async function(){var e;if(!s)return;if(!s.canAdmin())return;const t=J.default.state.data;if(!t)return;if("unsubscribed_admin"!==t.type&&"subscribed_admin"!==t.type)return;if("stripe"!==(null===(e=t.customerData)||void 0===e?void 0:e.activeSubscriptionPlatform)||!t.customerData.stripe.isSubscribed)return;const i=Z.XX(t),r=null!=i&&i.customerId?await K.y(o,{offerType:"add_on_upgrade_flow",customerId:i.customerId}):void 0;r&&!(0,W.$)(r)&&n(r)}()}),[o,s]);const l=(0,c.useCallback)((()=>{r&&(Y.createAndCommit({userAction:"AddOnDiscountPopup.markSeen",environment:o,perform:e=>{G.d2({userSettingsStore:r,transaction:e,data:{seen_ai_discount_popup:!0}})}}),w.trackAddOnDiscountPopupDismissed(o))}),[r,o]),d=(0,c.useCallback)((()=>{i&&(j.k2(),j.Cl(i))}),[i]),p=(0,U.VK)((()=>!(!i||(0,W.$)(i))),[i]),u=(0,H.yK)((e=>({icon:{width:20,height:20,fill:e.accentColors.purple[400]}})),[]);return p?a()(q.LazyFeatureIntroPopup,{initialPromo:{icon:h.Z.sparkles,iconStyle:u.icon,header:a()(S.FormattedMessage,{id:"AddOnDiscountPopup.header",description:"Header text on a popup that lets customers know we're offering them a discount for Notion AI.",defaultMessage:"Get {percentage} off Notion AI",values:{percentage:i?(0,X.ov)(i,!0):void 0}}),description:a()(S.FormattedMessage,{id:"AddOnDiscountPopup.description",description:"Description text on a popup that lets customers know we're offering them a discount for Notion AI.",defaultMessage:"Work faster, write better, think bigger. Add Notion AI now to access this special offer for your workspace."})},steps:[],placementToOrigin:$.u.Top,alignmentToOrigin:$.v.Center,seenFeatureUserSetting:"seen_ai_discount_popup",userSettingsStore:r,allowExternalMouseEvents:!0,onDismiss:l,onTryFeatureClick:d,children:t,isUserEligible:p,onPopupSeen:()=>w.trackAddOnDiscountPopupSeen(o),onLearnMore:()=>{i&&d(),l()},ctaMessage:a()(S.FormattedMessage,{id:"AddOnDiscountPopup.purchase.button",description:"Button message shown in a popup so customer can open the upgrade modal so they can purchase Notion AI.",defaultMessage:"Purchase Notion AI"})}):c.createElement(c.Fragment,null,t)}var ee=o(61784),te=o(11342),oe=o(43132),ie=o(57491),ne=o(49085);class re extends ne.Z{getInitialState(){return{showUpdateInfo:!1}}}const ae=re;var se=o(64921),le=o(28992),ce=o(58032);class de extends d.Z{constructor(){super(...arguments),this.storeTypes={store:ae},this.copyVersionInformationToClipboard=e=>{oe.Pm(this.environment,e)},this.renderUpdateInfo=()=>{const{AppUpdateStore:e}=this.environment,t=e.state.appUpdate?this.renderUpdateState("App.js - ",e.state.appUpdate):a()(S.FormattedMessage,{defaultMessage:"App.js - Waiting…",id:"appVersionMenuItem.waitingForAppJsUpdate.message"}),o=e.state.electronUpdate&&this.renderUpdateState("Electron - ",e.state.electronUpdate);return a()("div",{},void 0,t,o)},this.handleResetCache=()=>{const{AppUpdateStore:e,mobileNative:t}=this.environment;e.setState({appUpdate:void 0,electronUpdate:e.state.electronUpdate}),t&&t.resetAssetCache()},this.handleShowUpdateInfo=()=>{this.stores.store.setState({showUpdateInfo:!0})}}renderComponent(){const{device:e}=this.environment,t=`Notion 2.23.${M.Z.version}`,o=a()(S.FormattedMessage,{id:"appVersionMenuItem.lastUpdatedTime.menuItem",defaultMessage:"Updated {lastUpdatedTime}",description:"Message to tell the user when their current version of the Notion app was last updated.",values:{lastUpdatedTime:(0,ee.tv)(M.Z.lastUpdatedTime,p.SP)}});let i=a()(c.Fragment,{},void 0,t,a()("br",{}),o);if(e.isMobileNative){const e=ie.getMobileVersion(this.environment),n=a()(S.FormattedMessage,{defaultMessage:"Mobile {reactNativeVersionFormatted}",values:{reactNativeVersionFormatted:(0,te.formatVersion)(e)},id:"appVersionMenuItem.lastUpdatedReactNativeVersion.menuItem"});i=a()(c.Fragment,{},void 0,t,a()("br",{}),n,a()("br",{}),o)}if(e.isElectron){const e=k.getDesktopVersion(),n=a()(S.FormattedMessage,{defaultMessage:"Desktop {desktopVersionFormatted}",values:{desktopVersionFormatted:(0,te.formatVersion)(e)},id:"appVersionMenuItem.desktopVersion.menuItem"});i=a()(c.Fragment,{},void 0,t,a()("br",{}),n,a()("br",{}),o)}const r=M.Z.isLocalhost||"local"===M.Z.env||"development"===M.Z.env;if(e.isMobile){const e=r&&this.stores.store.state.showUpdateInfo&&a()("div",{},void 0,this.renderUpdateInfo(),a()(se.Z,{style:{paddingTop:4},onClick:this.handleResetCache},void 0,a()(S.FormattedMessage,{defaultMessage:"Clear cache",id:"appVersionMenuItem.mobile.clearCache.message"})));return a()(le.Z,{caption:a()("div",{style:{color:this.theme.lightTextColor}},void 0,a()("div",{style:{userSelect:"none",WebkitUserSelect:"none"}},void 0,i),e),onClick:r?this.handleShowUpdateInfo:void 0})}return r?a()(ce.Z,{renderTooltip:this.renderUpdateInfo,placement:ce.Z.Placement.Left,render:e=>c.createElement(le.Z,n()({onClick:()=>this.copyVersionInformationToClipboard(t),caption:a()("div",{style:{color:this.theme.lightTextColor}},void 0,i)},e))}):a()(le.Z,{onClick:()=>this.copyVersionInformationToClipboard(t),caption:a()("div",{style:{color:this.theme.lightTextColor}},void 0,i)})}renderUpdateState(e,t){return"checking"===t.state?a()("div",{},void 0,e," ",a()(S.FormattedMessage,{defaultMessage:"Checking for updates…",id:"appVersionMenuItem.updateStateForApp.checking.message"})):"no-update"===t.state?a()("div",{},void 0,e," ",a()(S.FormattedMessage,{defaultMessage:"No update {timeFromNow}",id:"appVersionMenuItem.noUpdatesForApp.message",description:"timeFromNow is a translated message like '2 hours ago' that refers to the time of the last update.",values:{timeFromNow:(0,ee.tv)(t.timestamp,p.SP)}})):"downloading"===t.state?a()("div",{},void 0,e," ",a()(S.FormattedMessage,{defaultMessage:"Downloading {version} {percentComplete}",id:"appVersionMenuItem.downloadingUpdate.message",values:{percentComplete:this.props.intl.formatNumber(t.progress,{style:"percent",maximumFractionDigits:0}),version:(0,te.formatVersion)(t.version)}})):"ready"===t.state?a()("div",{},void 0,e," ",a()(S.FormattedMessage,{defaultMessage:"Update ready {version}",id:"appVersionMenuItem.updateReady.message",values:{version:(0,te.formatVersion)(t.version)}})):"error"===t.state?a()("div",{},void 0,e," ",a()(S.FormattedMessage,{defaultMessage:"Update error {errorMessage}",id:"appVersionMenuitem.updateError.message",values:{errorMessage:t.error&&t.error.message}})):void 0}}de.displayName="AppVersionMenuItem";const pe=(0,S.injectIntl)(de);var ue=o(51454),me=o(28020),ge=o(45094),he=o(4926),fe=o(79482);function ve(e,t){const{theme:o,rightEdgeDistance:i,isInPeekRenderer:n}=t,r=(0,ge.ll)(e,n)-(0,ge.vJ)(e);return{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",background:o.whiteButtonBackground,bottom:16+he.Z.state,right:i+he.Z.state,width:36,height:36,borderRadius:"100%",fontSize:20,boxShadow:o.lightBoxShadow,zIndex:ue.hT,opacity:me.tu.state?0:1,transform:`translateX(-${r}px) translateZ(0)`,transition:`\n\t\t\topacity ${fe.Z.transitionDuration}ms,\n\t\t\tcolor ${fe.Z.transitionDuration}ms,\n\t\t\ttransform 200ms\n\t\t`}}var ye=o(52275),be=o(31945),Se=o(78140),we=o(9342),ke=o(72495);const Ce=function(e){const{locale:t,children:o}=e;return t===p.SP?a()(c.Fragment,{},void 0,o):null};var _e=o(14694),Me=o(41892),Te=o(90965),Ie=o(64684),Pe=o(70203),xe=o(82990),Be=o(29919),Ze=o(98165),Ee=o(67669),Re=o(8323),Ae=o(85644),De=o(21884);const Fe=["wiki","위키"];function Le(e){window.__c={n:"WikiPromoPopup"};const{children:t}=e,o=(0,O.O7)(),i=(0,H.Fg)(),n=(0,H.yK)((()=>({image:{width:320,height:220}})),[]),r="light"===i.mode?Me.Z.images.wikiTargetedPromo.lightMode:Me.Z.images.wikiTargetedPromo.darkMode,s=[{imageSrc:r.verificationPng,imageStyles:n.image,title:a()(S.FormattedMessage,{defaultMessage:"Verify pages",id:"WikiPromoPopup.verification.title",description:"A title in the wiki promo popup introducing the user to the new verification property available on wikis."}),subtitle:a()(S.FormattedMessage,{defaultMessage:"Assign <bold>owners</bold> to pages. Owners can verify if a page has accurate, reliable information",id:"WikiPromoPopup.verification.subtitle",description:"Text in the wiki promo popup introducing the user to the new verification property available on wikis.",values:{bold:e=>a()("span",{style:{fontWeight:xe.Z.fontWeight.semibold}},void 0,e)}})},{imageSrc:r.tagsPng,imageStyles:n.image,title:a()(S.FormattedMessage,{defaultMessage:"Organize your pages with tags",id:"WikiPromoPopup.tags.title",description:"A title in the wiki promo popup introducing the user to the multiselect 'tags' property on wikis."}),subtitle:a()(S.FormattedMessage,{defaultMessage:"Use tags and other database properties to keep your wiki organized",id:"WikiPromoPopup.tags.subtitle",description:"Text in the wiki promo popup introducing the user to the multiselect 'tags' property on wikis."})},{imageSrc:r.ownerPng,imageStyles:n.image,title:a()(S.FormattedMessage,{defaultMessage:"Sort and filter pages",id:"WikiPromoPopup.owner.title",description:"A title in the wiki promo popup introducing the user to the new database wiki functionality."}),subtitle:a()(S.FormattedMessage,{defaultMessage:"Easily find all pages you're responsible for using database sorting and filtering",id:"WikiPromoPopup.owner.subtitle",description:"Text in the wiki promo popup introducing the user to the new database wiki functionality."})},{imageSrc:r.upgradePng,imageStyles:n.image,title:a()(S.FormattedMessage,{defaultMessage:"Ready to upgrade?",id:"WikiPromoPopup.upgrade.title",description:"A title in the wiki promo popup inviting the user to try out the new wiki."}),subtitle:a()(S.FormattedMessage,{defaultMessage:"Add verification, owners, and tags to this page (you can undo this later)",id:"WikiPromoPopup.upgrade.subtitle",description:"Text in the wiki promo popup inviting the user to try out the new wiki."})}];(0,c.useEffect)((()=>{(0,z.exposeDebugValue)("resetWikiPromoPopup",(()=>{const{currentUserSettingsStore:e}=A.default.state;e&&Y.createAndCommit({userAction:"WikiPromoPopup.resetWikiPromoPopup",environment:o,perform:t=>{G.d2({userSettingsStore:e,transaction:t,data:{seen_targeted_wiki_prompt:!1}})}})})),(0,z.exposeDebugValue)("resetWikiOnboarding",(()=>{const{currentUserSettingsStore:e}=A.default.state;e&&Y.createAndCommit({userAction:"WikiPromoPopup.resetWikiOnboarding",environment:o,perform:t=>{G.d2({userSettingsStore:e,transaction:t,data:{wiki_onboarding_phase:"unseen"}})}})}))}),[o]);const{currentUserSettingsStore:l,currentSpaceStore:d,mainEditorCurrentBlockStore:p,currentUserStore:u}=(0,U.VK)((()=>A.default.state),[]),m=(0,U.VK)((()=>{if(!p)return;return Ze.VP(p)}),[p]),g=(0,c.useCallback)((()=>{l&&(Y.createAndCommit({userAction:"WikiPromoPopup.markSeen",environment:o,perform:e=>{G.d2({userSettingsStore:l,transaction:e,data:{seen_targeted_wiki_prompt:!0}})}}),w.trackWikiPromoDismiss(o),De.E.setState({showConvertTooltip:!0,forceShow:!1}))}),[l,o]),f=(0,c.useCallback)((()=>{p&&(De.E.reset(),Y.createAndCommit({userAction:"WikiPromoPopup.turnIntoWiki",environment:o,perform:e=>{Be.Y({environment:o,blocks:[p],transaction:e,source:"targeted_promo"})}}))}),[p,o]),v=(0,U.VK)((()=>De.E.state.forceShow),[]),y=(0,U.VK)((()=>{if(o.device.isMobile)return!1;if(!(l&&d&&p&&u))return!1;if(!(0,Ae.z)(p))return!1;if((0,Ee.yi)(o,p))return!1;if(!(0,Re.Mk)())return!1;const e=l.getSettings();if(!e||void 0!==e.wiki_onboarding_phase&&"unseen"!==e.wiki_onboarding_phase)return!1;if(!p.isTopLevel())return!1;if(p.isTopLevelTeamPage()){if(!(0,Ie.pd)({membership:null==m?void 0:m.getMembers()},u.id))return!1}else if(!(0,Te.KM)({permissions:d.getPermissionItems()},u.id))return!1;return!!Fe.some((e=>(0,Pe.Q)(p.getTitleValue()).toLowerCase().includes(e)))}),[l,d,o,p,m,u]);return a()(q.LazyFeatureIntroPopup,{initialPromo:{icon:h.Z.openBook,header:a()(S.FormattedMessage,{id:"WikiPromoPopup.header",description:"Header text on a popup that promotes the new wiki as database feature on Notion",defaultMessage:"Better wikis in Notion"}),description:a()(S.FormattedMessage,{id:"WikiPromoPopup.description",description:"Description text on a popup that promotes the new wiki as database feature on Notion",defaultMessage:"You can now use <bold>page verification</bold> and <bold>page owners</bold> to keep information{br}up to date",values:{bold:e=>a()("span",{style:{fontWeight:xe.Z.fontWeight.semibold}},void 0,e),br:a()("br",{})}})},steps:s,placementToOrigin:$.u.Top,alignmentToOrigin:$.v.Center,seenFeatureUserSetting:"seen_targeted_wiki_prompt",userSettingsStore:l,allowExternalMouseEvents:!0,onDismiss:g,onTryFeatureClick:f,children:t,forceShow:v,isUserEligible:y,onPopupSeen:()=>w.trackWikiPromoShow(o,{source:v?"page_menu":"targeted_promo"}),onLearnMore:()=>w.trackWikiPromoClickLearnMore(o)})}class Ve extends d.Z{constructor(){super(...arguments),this.renderOrigin=e=>{if(this.props.isMobile)return c.createElement(se.Z,n()({hovered:V.Z.state.open,mobileFeedback:this.props.isMobile},e),a()(_e.Z,{left:h.Z.help({fill:this.theme.mediumIconColor,width:16,height:16}),disableMobileBorder:!0},void 0,a()(S.FormattedMessage,{defaultMessage:"Help & feedback",id:"helpButton.mobileHelpFeedbackButton.label"})));{const t=(0,x.Z)(e,{onFocus:this.handleFocus,onBlur:this.handleBlur});return c.createElement(c.Fragment,null,a()(ce.Z,{renderTooltip:()=>a()("span",{},void 0,a()(S.FormattedMessage,{defaultMessage:"Help, feedback, and {br}keyboard shortcuts",id:"helpButton.desktopHelpButton.tooltip",values:{br:a()("br",{})}})),render:e=>c.createElement(se.Z,n()({className:"notion-help-button",style:ve(this.environment,{theme:this.theme,rightEdgeDistance:16,isInPeekRenderer:!1}),hoveredStyle:{background:this.theme.whiteButtonHoveredBackground},pressedStyle:{background:this.theme.whiteButtonPressedBackground}},(0,x.Z)(t,e)),"?")}))}},this.renderMessageItem=e=>{const{device:t}=this.environment;return t.isElectron?this.renderMessageButton(e):a()(ce.Z,{renderTooltip:()=>this.renderIntercomTooltip(),delayThreshold:0,disableTooltip:!this.messageIsDisabled(),placement:ce.Z.Placement.Right,render:t=>this.renderMessageButton((0,x.Z)(e,t))},e.key)},this.renderSalesItem=e=>this.renderSalesButton(e),this.renderGuideItem=e=>c.createElement(ye.Z,n()({},e,{isTokenTitle:!0,icon:h.Z.helpButtonGuide(this.getIconStyle()),title:a()(S.FormattedMessage,{defaultMessage:"Help & documentation",id:"helpButton.helpSupportGuide.menuItem"})})),this.renderMessageButton=e=>c.createElement(ye.Z,n()({},e,{isTokenTitle:!0,icon:h.Z.helpButtonMessage(this.getIconStyle()),title:a()(S.FormattedMessage,{defaultMessage:"Message support",id:"helpButton.sendMessage.menuItem"}),disabled:this.messageIsDisabled()})),this.renderCsatButton=e=>c.createElement(ye.Z,n()({},e,{isTokenTitle:!0,icon:h.Z.feedback(this.getIconStyle()),title:a()(S.FormattedMessage,{defaultMessage:"Give feedback",id:"helpButton.giveFeedback.menuItem"})})),this.renderSalesButton=e=>c.createElement(ye.Z,n()({},e,{isTokenTitle:!0,icon:h.Z.helpButtonSales(this.getIconStyle()),title:a()(S.FormattedMessage,{defaultMessage:"Contact sales",id:"helpButton.salesChat.menuItem",description:"Title for help menu item prompting the user to contact the sales team."})})),this.renderJoinUsItem=e=>a()(Ce,{locale:"en-US"},void 0,c.createElement(ye.Z,n()({},e,{title:a()(S.FormattedMessage,{defaultMessage:"Join us",id:"helpButton.joinUs.menuItem"})}))),this.renderKeyboardShortcutsItem=e=>c.createElement(ye.Z,n()({},e,{title:a()(S.FormattedMessage,{defaultMessage:"Keyboard shortcuts",id:"helpButton.keyboardShortcuts.menuItem"})})),this.renderNewsItem=e=>c.createElement(ye.Z,n()({},e,{title:a()(S.FormattedMessage,{defaultMessage:"What's new?",id:"helpButton.whatsNew.menuItem"})})),this.renderTermsItem=e=>{const{device:t}=this.environment;return t.isMobile?c.createElement(ye.Z,n()({},e,{title:"Terms & privacy"})):c.createElement(ye.Z,n()({},e,{caption:"Terms & privacy"}))},this.renderTwitterItem=e=>{const{device:t}=this.environment;return t.isMobile?c.createElement(ye.Z,n()({},e,{title:a()(S.FormattedMessage,{defaultMessage:"Twitter – @{notionHandle}",id:"helpButton.mobileTwitter.menuItem",values:{notionHandle:"NotionHQ"}})})):c.createElement(ye.Z,n()({},e,{caption:a()(S.FormattedMessage,{defaultMessage:"Twitter – @{notionHandle}",id:"helpButton.twitter.menuItem",values:{notionHandle:"NotionHQ"}})}))},this.renderStatusItem=e=>{const{device:t}=this.environment;return t.isMobile?c.createElement(ye.Z,n()({},e,{title:"Status"})):c.createElement(ye.Z,n()({},e,{caption:"Status"}))},this.renderDevelopersItem=e=>{const{device:t}=this.environment;return t.isMobile?c.createElement(ye.Z,n()({},e,{title:"Developers"})):c.createElement(ye.Z,n()({},e,{caption:"Developers"}))},this.acceptMessageItem=()=>{this.analyticsTrackClickItem("help_feedback"),_.j({environment:this.environment,from:"help_button"}),this.closePopup()},this.acceptSalesItem=()=>{this.analyticsTrackClickItem("sales_chat");const{currentUserStore:e}=A.default.state;null!=e&&e.isDefined()&&(F.Z.setState({open:!0,email:null==e?void 0:e.getEmail(),name:(0,y.Nz)(this.props.intl,null==e?void 0:e.getModel())}),this.closePopup())},this.acceptCsatItem=()=>{this.analyticsTrackClickItem("csat"),L.Z.setState({open:!0,type:v.og}),this.closePopup()},this.acceptGuideItem=()=>{this.analyticsTrackClickItem("guides"),C.navigateToExternalURL({environment:this.environment,url:(0,B.UY)("guides.guides")}),this.closePopupForExternalURLNavigation()},this.acceptKeyboardShortcutsItem=()=>{this.analyticsTrackClickItem("keyboard_shortcuts"),C.navigateToExternalURL({environment:this.environment,url:(0,B.UY)("guides.keyboardShortcuts")}),this.closePopupForExternalURLNavigation()},this.acceptTwitterItem=()=>{this.analyticsTrackClickItem("twitter"),C.navigateToExternalURL({environment:this.environment,url:f._j.notionTwitter}),this.closePopupForExternalURLNavigation()},this.acceptStatusItem=()=>{this.analyticsTrackClickItem("status"),C.navigateToExternalURL({environment:this.environment,url:f._j.statusPage}),this.closePopupForExternalURLNavigation()},this.acceptDevelopersItem=()=>{E.Z.setState({open:!0}),this.closePopupForExternalURLNavigation()},this.acceptJoinUsItem=()=>{this.analyticsTrackClickItem("join_us"),C.navigateToExternalURL({environment:this.environment,url:f._j.careers}),this.closePopupForExternalURLNavigation()},this.acceptNewsItem=()=>{const e=(0,I.Us)(f._j.releases);C.navigateToExternalURL({environment:this.environment,url:e}),this.analyticsTrackClickItem("whats_new"),this.closePopupForExternalURLNavigation()},this.acceptTermsItem=()=>{C.navigateToExternalURL({environment:this.environment,url:f._j.termsAndPrivacy}),this.analyticsTrackClickItem("terms"),this.closePopupForExternalURLNavigation()},this.supportsNativeHomeOnPhone=()=>{const{mobileNative:e}=this.environment;return(null==e?void 0:e.supportsNativeHomeOnPhone())||!1},this.handleClose=()=>{this.supportsNativeHomeOnPhone()?C.navigateToHomeTab(this.environment,this.closePopup):this.closePopup()},this.trackClickHelp=()=>{w.trackClickHelp(this.environment);const e=R.default.state;(0,T.isZendeskEnabled)()&&e.isZendeskEnabled&&b.j({locale:p.SP,analyticsSettings:e})}}renderComponent(){const{device:e}=this.environment,t=this.props.isMobile,o=this.supportsNativeHomeOnPhone();return a()(Q,{},void 0,a()(Le,{},void 0,a()(be.Z,{popupType:e.isMobile?be.Z.PopupType.SlideUp:be.Z.PopupType.Popup,hidesMobileNativeBottomBar:o,preventSlideUpTransition:o,renderOrigin:this.renderOrigin,originGap:t?0:12,placementToOrigin:t?be.Z.Placement.Right:be.Z.Placement.Top,alignmentToOrigin:t?be.Z.Alignment.Center:be.Z.Alignment.End,buttonPopupStore:V.Z,onClick:this.trackClickHelp,render:()=>{const t=this.getSections();let i;return i=e.isMobile?o?{menuType:P.og.Modal,title:a()(S.FormattedMessage,{defaultMessage:"Help & feedback",description:"Title for a view that shows up when the user taps on the Help and Feedback button",id:"helpButton.mobile.title"}),right:a()(S.FormattedMessage,{defaultMessage:"Done",description:"Title for a button that dismisses the help and feedback view",id:"helpButton.mobile.rightActionButton.done"}),onClickRight:this.handleClose,whiteBackground:!0}:{menuType:P.og.ActionSheet}:{menuType:P.og.Popup,minWidth:208},c.createElement(Se.Z,i,a()(we.Z,{type:we.i.Vertical,initialFocus:void 0,sections:t}))}})))}getSections(){const{device:e}=this.environment,t=(0,Z.qX)()>1,o=!R.default.state.isIntercomEnabled,i="on"===D.default.getGroup("csat")&&!this.environment.device.isMobile;return l().compact([{key:"guide",render:e=>c.createElement(ke.Z,e),items:l().compact([{key:"guide",action:this.acceptGuideItem,render:this.renderGuideItem},o?void 0:{key:"message",action:this.acceptMessageItem,render:this.renderMessageItem},t?{key:"sales",action:this.acceptSalesItem,render:this.renderSalesItem}:void 0,i?{key:"csat",action:this.acceptCsatItem,render:this.renderCsatButton}:void 0])},{key:"middle section",render:e=>c.createElement(ke.Z,n()({},e,{topBorder:!0})),items:l().compact([{key:"keyboardshortcut",action:this.acceptKeyboardShortcutsItem,render:this.renderKeyboardShortcutsItem},{key:"news",action:this.acceptNewsItem,render:this.renderNewsItem},{key:"join-us",action:this.acceptJoinUsItem,render:this.renderJoinUsItem}])},{key:"botttom section",render:e=>c.createElement(ke.Z,n()({},e,{topBorder:!0})),items:l().compact([{key:"twitter",action:this.acceptTwitterItem,render:this.renderTwitterItem},{key:"terms",action:this.acceptTermsItem,render:this.renderTermsItem},{key:"status",action:this.acceptStatusItem,render:this.renderStatusItem},void 0,e.isElectron&&"production"!==M.Z.env?{key:"devtools",action:k.openDevTools,render:e=>c.createElement(ye.Z,n()({},e,{caption:"Open Dev Tools"}))}:void 0])},{key:"version",render:e=>c.createElement(ke.Z,n()({},e,{topBorder:!0})),items:l().compact([{key:"version",action:()=>{},render:e=>c.createElement(pe,e)}])}])}renderIntercomTooltip(){return a()("span",{},void 0,a()(S.FormattedMessage,{defaultMessage:"To enable messaging, please make sure you have accepted functional cookies.{br}You can update your cookies in your Notion settings.{br}You can also contact us via email at team@makenotion.com.",values:{br:a()("br",{})},id:"helpButton.sendUsAMessage.tooltip.intercom.disabled"}))}analyticsTrackClickItem(e){w.trackClickHelpItem(this.environment,{item:e})}closePopupForExternalURLNavigation(){this.supportsNativeHomeOnPhone()||this.closePopup()}closePopup(){V.Z.setState({...V.Z.state,open:!1})}messageIsDisabled(){return!(0,m.hasPermissionForTrackingTypeBrowser)("preference")&&!this.environment.device.isMobileNative}handleFocus(e){const t=e.target;t instanceof HTMLElement&&(0,u.E)(t)&&N.Z.setState(!0)}handleBlur(){N.Z.setState(!1)}getIconStyle(){let{size:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=16-(e??16);return{width:e??16,height:e??16,color:this.theme.regularTextColor,fill:this.theme.regularTextColor,marginRight:t}}getRedDotStyle(){return{height:"8px",width:"8px",backgroundColor:g.ZP.red,borderRadius:"50%",display:"inline-block"}}}Ve.displayName="HelpButton";const Ne=(0,S.injectIntl)(Ve)},83182:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(3779),s=o(50906),l=o(60709),c=o(52275),d=o(16354);class p extends r.Z{renderComponent(){return n()(d.Z,{href:this.props.href,external:!0,onClick:()=>s.trackClickHelpButton(this.environment,{from:this.props.analyticsFrom})},void 0,n()(c.Z,{icon:!this.props.left&&this.renderIcon(),title:this.renderTitle(),focused:!1}))}renderIcon(){const{device:e}=this.environment;return a.Z.help({width:e.isPhone?16:14,fill:this.theme.lightIconColor,marginRight:this.props.left?6:0})}renderTitle(){const{left:e}=this.props;return e?n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()("span",{style:{...this.getTitleStyle(),marginRight:"auto"}},void 0,this.props.left),this.renderIcon(),n()("span",{style:this.getTitleStyle()},void 0,this.props.title)):n()("span",{style:this.getTitleStyle()},void 0,this.props.title)}getTitleStyle(){const{device:e}=this.environment;return{fontSize:e.isPhone?14:12,verticalAlign:1,color:this.theme.lightTextColor}}}p.displayName="HelpButtonMenuItem",p.contextTypes={...l.mw,...r.w};const u=p},74523:(e,t,o)=>{o.d(t,{Z:()=>f});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(24405),d=o(3779),p=o(50906),u=o(73063),m=o(16354),g=o(89728);function h(e){let{title:t,href:o,analyticsFrom:i,shouldShrink:r,style:h,buttonStyle:f,isBlue:v,onClick:y,onFocus:b,onBlur:S,onMouseDown:w,onMouseEnter:k,onMouseLeave:C}=e;window.__c={n:"HelpButtonSettingsCaption"};const _=(0,l.O7)(),M={onFocus:b,onBlur:S,onMouseDown:w,onMouseEnter:k,onMouseLeave:C},T=(0,s.useCallback)((()=>{void 0!==y&&y(),p.trackClickHelpButton(_,{from:i})}),[i,_,y]),I=(0,c.yK)((()=>({link:{display:"flex",marginLeft:-6,...h}})),[h]);return s.createElement(m.Z,n()({style:I.link,className:"notion-print-ignore",href:o,external:!0,onClick:T},M),t?a()(g.Z,{icon:d.Z.help,isSmall:!0,isBlue:v,isLightGray:!v,shouldShrink:r,style:f},void 0,t):s.createElement(u.Z,n()({icon:d.Z.help,isBlue:v,style:f},M)))}const f=s.memo(h)},46247:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(3779),s=o(50906),l=o(64921),c=o(16354);class d extends r.Z{renderComponent(){return n()(c.Z,{style:{display:"flex",alignSelf:"stretch",width:36,...this.props.isRight?{marginRight:-8}:{marginLeft:-8}},external:!0,href:this.props.href,onClick:()=>s.trackClickHelpButton(this.environment,{from:this.props.analyticsFrom})},void 0,n()(l.Z,{mobileFeedback:!0,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"}},void 0,a.Z.help({width:18,marginTop:1,fill:this.theme.lightIconColor})))}}d.displayName="HelpIconButtonMobile";const p=d},51428:(e,t,o)=>{o.d(t,{Z:()=>k});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(64002),d=o(26198),p=o(12534),u=o(55367),m=o(80796),g=o(10161),h=o(49085);class f extends h.Z{getInitialState(){return{disabled:!1,loaded:!1,hasPreviewBeenDismissed:!1,isVisible:!1}}}const v=f;var y=o(69784),b=o(59649);class S extends l.Z{constructor(){super(...arguments),this.iframe=null,this.storeTypes={iframeStore:v},this.handleMouseMove=e=>{const t=u.ZP.state.isDragging,o=m.Z.state.isDragging,i=y.Z.state.isActive,n=t||o||i;this.stores.iframeStore.setState({...this.stores.iframeStore.state,disabled:n})},this.handleIframeLoad=()=>{this.stores.iframeStore.setState({...this.stores.iframeStore.state,loaded:!0})},this.releaseFocus=()=>{document.activeElement&&document.activeElement===this.iframe&&document.activeElement.blur()},this.getSanitizedSource=()=>{let e=c.yn(this.props.source);if(e||this.props.source.includes(":")||(e=c.yn(`https:${this.props.source}`)),e&&new URL(e).origin!==location.origin)return e},this.handlePreviewMouseDown=e=>{e.preventDefault(),(0,p.ZP)({event:e,context:p.Af.EditorClick,callback:()=>{this.stores.iframeStore.setState({...this.stores.iframeStore.state,hasPreviewBeenDismissed:!0})}})}}didMountOrUpdate(){super.didMountOrUpdate(),this.releaseFocus()}renderComponent(){return a()("div",{style:this.props.style,onMouseMove:this.handleMouseMove,onMouseEnter:this.handleMouseMove,onMouseLeave:this.releaseFocus},void 0,a()("div",{style:this.getAspectRatioContainerStyle()},void 0,this.renderInnerContent()))}renderInnerContent(){return this.shouldRenderPreview()?this.renderPreview():a()(b.Z,{innerStyle:{height:"100%",width:"100%"},loaded:this.stores.iframeStore.state.loaded,style:S.aspectRatioInnerStyle,spinnerSize:"1em",showSpinnerTimeout:500},void 0,this.renderIframe())}renderPreview(){var e,t;return a()("div",{style:{...this.getIframeStyle(),backgroundColor:"none"},onMouseDown:this.handlePreviewMouseDown},void 0,null===(e=(t=this.props).renderPreview)||void 0===e?void 0:e.call(t))}renderIframe(){const e=this.getSanitizedSource();if(!e)return;const t=this.getIframeStyle(),o=this.environment.device.isElectron?"allow-scripts allow-popups allow-forms allow-same-origin":"allow-scripts allow-popups allow-top-navigation-by-user-activation allow-forms allow-same-origin allow-storage-access-by-user-activation";return s.createElement(w,{ref:e=>{this.iframe=e},wrapperStyle:{...t,backgroundColor:"none"},style:t,src:e,frameBorder:"0",onLoad:this.handleIframeLoad,sandbox:o,allowFullScreen:!0,allow:this.props.allow})}shouldRenderPreview(){return!(!window.__webViewTerminatedWhileAppActive&&"on"!==g.default.getGroup("embed-previews"))&&(!this.stores.iframeStore.state.hasPreviewBeenDismissed&&Boolean(this.props.renderPreview))}getAspectRatioContainerStyle(){const{height:e,isFullWidth:t,isFullHeight:o,aspectRatio:i,preserveScale:n}=this.props,r={position:"relative",display:"flex",justifyContent:"center",width:"100%",minHeight:100};return o?(r.height="100%",r.position=void 0):t||!n?r.height=e:(r.height=0,r.paddingBottom=100*(i||.75)+"%"),r}getIframeStyle(){return{...S.aspectRatioInnerStyle,pointerEvents:this.stores.iframeStore.state.disabled?"none":"auto",backgroundColor:this.props.background?this.theme.contentBackground:"none"}}}S.displayName="IFrameBox",S.aspectRatioInnerStyle={position:"absolute",left:0,top:0,width:"100%",height:"100%",borderRadius:1};const w=s.forwardRef(((e,t)=>{const{wrapperStyle:o,...i}=e,[r,a]=(0,d.jo)();return s.createElement("div",{ref:r,style:o},a&&s.createElement("iframe",n()({},i,{ref:t})))})),k=S},23321:(e,t,o)=>{o.d(t,{OF:()=>Z,L6:()=>E,ZP:()=>D});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(8848),u=o(15095),m=o(54153),g=o(5366),h=o(50906),f=o(34809),v=o(5385),y=o(33929),b=o(4391),S=o(29798),w=o(73657),k=o(68785),C=o(9342),_=o(77137),M=o(43145),T=o(72495),I=o(38797),P=o(57670);const x=I.tg,B=I.Nm,Z=I.II,E=I.pq,R=(0,g.defineMessages)({noResults:{defaultMessage:"No results",id:"emojiPicker.noResults.message"}});class A extends d.Z{constructor(){super(...arguments),this.filter="",this.splitFilter=[],this.storeTypes={store:b.Z,menuListStore:S.Z},this.insertIcon=e=>{const t=this.getNormalizedIconPath(e);this.props.onSubmit(t);const o=t.split(/[/_.]/),i=o[2],n=o[3];this.addToRecentIcons(i),this.props.iconLoggingData&&h.trackIconActions(this.environment,"pick_colored_icon",{icon:i,color:n,...this.props.iconLoggingData})},this.createListItem=(e,t)=>{const o=v.x(),i=this.props.enforceIconColor??o,n=`/icons/${`${e}${i?`_${i}`:""}`}.svg`;return{key:n,action:e=>this.handleIconButtonClick(n),render:o=>c.createElement(P.Z,a()({},o,{icon:e,color:i??"gray",variations:t,insertIcon:this.insertIcon,shouldOpenVariations:!Boolean(i)}))}},this.performGetAllIconsRequest=async e=>{const{store:t}=this.stores;if(!l().isEmpty(t.getState().allIcons))return t.getState().allIcons;const o=await(0,f.Z)({environment:this.environment,url:e,method:"GET",format:"json",mode:"cors"});if("success"===o.type)return t.setState({...t.state,allIcons:o.data}),o.data;throw o.error},this.createCategory=(e,t)=>{if(!t)return;let o=[];return o="recent"===e.id?this.stores.store.state.recentIcons||[]:Object.keys(t),0!==o.length?{key:e.id,items:o.map((e=>{if(void 0!==t[e])return this.createListItem(e,t[e])})).filter(Boolean),render:t=>n()(T.Z,{isTitleUppercase:!0,title:e.title},t.key,n()("div",{style:this.getIconSectionWrapStyle()},void 0,t.children))}:void 0},this.handleScroll=e=>{if(Math.abs(e)<A.loadMoreCategoryEdgeDistance){const{loadIconCount:e,allIcons:t}=this.stores.store.state,o=this.getNumIconsPerRow()*this.getNumRowsPerPage(),i=Math.max(o,this.getAllSectionsIconCount(t));this.stores.store.setState({...this.stores.store.state,loadIconCount:Math.min(i,e+o)})}},this.handleIconButtonClick=e=>{this.insertIcon(e)},this.getNormalizedIconPath=e=>e.replace("_dark","")}willMount(e){super.willMount(e);const t=m.Z.get(A.localRecentIconsKey);this.stores.store.setState({...this.stores.store.state,recentIcons:t||[]})}renderComponent(){return n()(_.Z,{request:"/icons/all",performRequest:this.performGetAllIconsRequest,render:(e,t,o)=>o?this.renderIconPicker(t):n()("div",{style:this.getLoadingContainerStyle()},void 0,n()(k.Z,{}))})}getNumIconsPerRow(){var e,t,o,i,n,r;const{device:a,WindowSizeStore:s}=this.environment;return a.isPhone?(window.innerWidth-s.getSafePaddingLeftPx(A.phonePaddingLeft)-s.getSafePaddingRightPx(A.phonePaddingRight))/P.Z.mobileButtonSize:a.isTablet?x:null!==(e=this.props)&&void 0!==e&&null!==(t=e.menuRef)&&void 0!==t&&null!==(o=t.current)&&void 0!==o&&o.offsetWidth?((null===(i=this.props)||void 0===i||null===(n=i.menuRef)||void 0===n||null===(r=n.current)||void 0===r?void 0:r.offsetWidth)-2*A.desktopPopupPaddingHorizontal)/P.Z.desktopButtonSize:a.isTablet?x:8}getNumRowsPerPage(){return this.environment.device.isMobile?E:Z}renderIconPicker(e){const{menuListStore:t}=this.stores,o=this.getVisibleSections(this.getAllSections(e)),i=this.environment.device.isDesktop&&o.length>0?0:void 0;return 0===o.length&&(this.props.onNoResults&&this.props.onNoResults(),o.push({key:"no results",items:[{key:"no results",action:e=>{},render:(e,t)=>c.createElement(w.Z,a()({},e,{caption:y.default.formatMessage(R.noResults)}))}],render:e=>c.createElement(T.Z,e)})),n()("div",{style:A.wrapStyle},void 0,n()("div",{style:{flexGrow:1}},void 0,c.createElement(C.Z,a()({},this.getMenuListProps(),{store:t,initialFocus:i,sections:o,disableMouseLeaveBlur:!0,disableKeyboardArrowWrap:!0,unfocusOnScroll:this.environment.device.isMobile}))),n()(M.Z,{onChange:this.handleScroll}))}getCategories(){return l().compact([!this.props.filter&&{id:"recent",title:n()(g.FormattedMessage,{id:"iconPicker.section.recent",defaultMessage:"Recent",description:"Heading for recently selected icons in the icon picker"})},!this.props.filter&&{id:"icons",title:n()(g.FormattedMessage,{id:"iconPicker.section.icons",defaultMessage:"Icons",description:"Heading for all icons in the icon picker"})}])}createFilteredSection(e){if(!e)return[];const t=this.filterAndSortIcons(e);return 0===t.length?[]:[{key:"search-results",items:t.map((t=>this.createListItem(t,e[t]))),render:e=>n()(T.Z,{},e.key,n()("div",{style:this.getIconSectionWrapStyle()},void 0,e.children))}]}getMenuListProps(){return{type:C.i.Grid,itemsPerRow:this.getNumIconsPerRow(),renderRow:(e,t)=>n()("div",{style:A.rowStyle},t,e)}}addToRecentIcons(e){const t=m.Z.get(A.localRecentIconsKey),o=l().union([e],t),i=l().take(o,this.getNumIconsPerRow()*B);m.Z.set(A.localRecentIconsKey,i),this.stores.store.setState({...this.stores.store.state,recentIcons:i})}getAllSections(e){this.filter=u.rJ(this.props.filter)??"",this.splitFilter=this.filter?this.filter.split(" ").filter(Boolean):[];const t=l().compact(this.getCategories().map((t=>this.createCategory(t,e))));return this.props.filter&&this.filter?this.createFilteredSection(e):t}getAllSectionsIconCount(e){const t=this.getAllSections(e);let o=0;for(const i of t)o+=i.items.length;return o}getVisibleSections(e){let{loadIconCount:t}=this.stores.store.state;0===t&&(t+=this.getNumIconsPerRow()*this.getNumRowsPerPage());const o=[];let i=0;for(const n of e){if(!(i+n.items.length<=t)){o.push({...n,items:n.items.slice(0,t-i)});break}o.push(n),i+=n.items.length}return o}filterAndSortIcons(e){const{filter:t}=this,o=l().compact(Object.keys(e).map((o=>{const i=e[o],n=((null==i?void 0:i.tooltip)??o).replace("-"," "),r=[n,...i.tags],a=r.findIndex((e=>e===t));if(-1!==a)return[0===a?100:50,o];const s=r.findIndex((e=>e.startsWith(t))),l=n.includes(t);return 0!==s&&l?[40,o]:-1!==s?[0===s?80:30,o]:void 0})));return l().sortBy(o,(e=>-e[0])).map((e=>e[1]))}getLoadingContainerStyle(){return{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center",paddingBottom:"10px"}}getIconSectionWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",flexWrap:"wrap",alignItems:"flex-start",...e.isPhone?{background:this.theme.popoverBackground,paddingTop:10,paddingBottom:10,paddingLeft:t.getSafePaddingLeftCSS(A.phonePaddingLeft),paddingRight:t.getSafePaddingLeftCSS(A.phonePaddingRight),boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}:{background:p.ZP.transparent,paddingLeft:e.isTablet?A.tabletPopupPaddingHorizontal:A.desktopPopupPaddingHorizontal,paddingRight:e.isTablet?A.tabletPopupPaddingHorizontal:A.desktopPopupPaddingHorizontal}}}}A.displayName="IconPicker",A.loadMoreCategoryEdgeDistance=100,A.localRecentIconsKey="recentIcons",A.desktopPopupPaddingHorizontal=I.ZP.desktopPopupPaddingHorizontal,A.tabletPopupPaddingHorizontal=I.ZP.tabletPopupPaddingHorizontal,A.desktopIconPickerOnlyPopupWidth=8*P.Z.desktopButtonSize+2*A.desktopPopupPaddingHorizontal,A.desktopIconPickerOnlyPopupHeight=356,A.phonePaddingLeft=I.ZP.phonePaddingLeft,A.phonePaddingRight=I.ZP.phonePaddingRight,A.wrapStyle={display:"flex",flexDirection:"column"},A.rowStyle={display:"flex"};const D=A},57670:(e,t,o)=>{o.d(t,{Z:()=>S});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(79362),d=o(98742),p=o(61766),u=o(64921),m=o(31945),g=o(1743),h=o(3386),f=o(9342),v=o(58032),y=o(79920);class b extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:p.Z},this.renderIconWithVariations=()=>{const{icon:e,focused:t}=this.props,{buttonPopupStore:o}=this.stores;return a()(h.Z,{capture:t,onEnter:this.handleOpenMenu,onEsc:this.handleCloseMenu},e,a()(m.Z,{buttonPopupStore:o,popupType:m.Z.PopupType.Popup,renderOrigin:e=>this.renderSingleIcon(e),render:this.renderVariationMenu}))},this.renderSingleIcon=e=>{const{icon:t,focused:o,color:i,onClick:r,onMouseEnter:l,variations:c,hideTooltip:p}=this.props,m=c.tooltip?c.tooltip:t,g="dark"===this.theme.mode?c.dark:c.light;return a()(v.Z,{allowHover:Boolean(t&&!p),disableTooltip:p,renderTooltip:()=>m.replaceAll("-"," ").replaceAll("_"," "),closeDelay:0,render:c=>s.createElement(u.Z,n()({key:t,focused:o,onClick:r},(0,d.Z)(e||{},(0,d.Z)({onMouseEnter:l},c)),{ignoreLocalHoverState:!0,style:this.styles.iconButton}),a()("img",{src:`data:image/svg+xml;utf8,${encodeURIComponent(g[i])}`,style:this.styles.iconImage,onContextMenu:e=>e.preventDefault()}))})},this.renderVariationMenu=e=>{const{icon:t,variations:o,insertIcon:i}=this.props,r="dark"===this.theme.mode?o.light:o.dark,l=Object.keys(r).sort(((e,t)=>c.Oe.indexOf(e)-c.Oe.indexOf(t))).map((r=>{const a=`${t}_${r}`;return{key:a,action:t=>{e.close(),i(`/icons/${a}.svg`)},render:e=>s.createElement(b,n()({},this.props,e,{icon:a,color:r,variations:o,shouldOpenVariations:!1,hideTooltip:!0}))}}));return a()(g.Z,{capture:!0,allowEsc:!0},void 0,a()(f.Z,{type:f.i.Grid,itemsPerRow:5,initialFocus:0,sections:[{key:"variations",render:e=>s.createElement("div",e),items:l}],renderRow:(e,t)=>a()("div",{style:this.styles.variationMenu},t,e)}))},this.handleOpenMenu=e=>{e.preventDefault();const{buttonPopupStore:t}=this.stores;t.setState({...t.state,open:!0})},this.handleCloseMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState({...e.state,open:!1})},this.styles={iconButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,...this.getButtonStyles()},variationMenu:{display:"flex",padding:2,gap:1},iconImage:{...this.environment.device.isMobile?{width:b.mobileFontSize,height:b.mobileFontSize}:{width:b.desktopFontSize,height:b.desktopFontSize}}}}renderComponent(){const{shouldOpenVariations:e}=this.props;return e?this.renderIconWithVariations():this.renderSingleIcon()}getButtonStyles(){const{device:e}=this.environment;return e.isMobile?{width:b.mobileButtonSize,height:b.mobileButtonSize,fontSize:b.mobileFontSize}:{width:b.desktopButtonSize,height:b.desktopButtonSize,fontSize:b.desktopFontSize}}}b.displayName="IconPickerMenuItem",b.desktopButtonSize=y.Z.desktopButtonSize,b.desktopFontSize=y.Z.desktopFontSize,b.mobileButtonSize=y.Z.mobileButtonSize,b.mobileFontSize=y.Z.mobileFontSize;const S=b},56813:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(3779),c=o(5366),d=o(33929),p=o(68859),u=o(10161),m=o(86671),g=o(49914);const h=(0,c.defineMessages)({urlPlaceholder:{defaultMessage:"Paste the image link…",id:"imageBlock.linkInput.placeholder"},embedButtonText:{defaultMessage:"Embed image",id:"imageBlock.embedImage.button.label"}});class f extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:p.Z}}renderPersisted(){const{disabled:e}=this.props,t=[{type:"file",imageUpload:!0},{type:"embed"},{type:"unsplash"}];return u.default.checkGate("enable_giphy_feature_gate")&&t.push({type:"giphy"}),s.createElement(g.Z,n()({},this.props,this.stores,{store:this.props.store,urlInputPlaceholder:d.default.formatMessage(h.urlPlaceholder),iconSvg:l.Z.picture,disabled:e,preserveScale:!0,mediaMenuCurrentTab:"file",mediaMenuTabs:t,mediaMenuEmbedCaption:a()(c.FormattedMessage,{defaultMessage:"Works with any image from the web",id:"imageBlock.linkInput.caption"}),embedButtonText:d.default.formatMessage(h.embedButtonText),popupWidth:540,maxHeight:420}),a()(c.FormattedMessage,{defaultMessage:"Add an image",id:"imageBlock.placeholder"}))}}const v=f},42402:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(8848),s=o(16354);class l extends r.Z{renderComponent(){return n()(s.Z,{href:this.props.href,external:this.props.external,style:{...l.linkStyle,...this.props.style,...this.props.disableUnderline&&{textDecoration:"none"}},onClick:this.props.onClick,className:this.props.disableHover?void 0:this.props.showAIVersion?"notion-link-ai-version":"notion-link",onMouseDown:this.props.onMouseDown,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave},void 0,this.props.children)}}l.displayName="InlineTextLink",l.linkStyle={display:"inline",textDecoration:"underline",color:a.ZP.inherit};const c=l},67706:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(24405),c=o(82990),d=o(44532),p=o(58032);function u(e){let{text:t,tooltipText:o,icon:i}=e;window.__c={n:"InlineTextWithIconTooltip"};const r=(0,l.yK)((e=>({icon:{height:"1em",width:"1em",marginRight:"0.25em",fill:e.mediumIconColor,marginBottom:"0.1em"},tooltip:{background:e.contentBackground,boxShadow:e.lightBoxShadow},container:{display:"flex",alignItems:"center",fontWeight:c.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:c.Z.fontSize.UISmall.desktop,textAlign:"center"},text:{display:"inline"}})),[]);return n()(p.Z,{style:r.tooltip,render:e=>s.createElement("div",a()({style:r.text},e),t),renderTooltip:()=>n()("div",{style:r.container},void 0,i(r.icon),n()("div",{},void 0,o)),alignment:d.ZP.Alignment.Start,placement:d.ZP.Placement.Bottom})}},37770:(e,t,o)=>{o.d(t,{Z:()=>f});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(65917),s=o(2911),l=o(29477),c=o(88632),d=o(49085);class p extends d.Z{getInitialState(){return{loaded:!1}}}const u=p;var m=o(68785),g=o(33411);class h extends r.Z{constructor(e,t){super(e,t),this.storeTypes={store:u}}didMount(){this.fetch()}renderComponent(){return n()(g.Z,{show:!this.stores.store.state.loaded,showDelay:300,showHold:0,render:e=>this.stores.store.state.loaded?this.props.render(this.stores.store.state.result):this.props.loading?this.props.loading(e):e?n()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"}},void 0,n()(m.Z,{})):void 0})}async fetch(){let e=1e3;for(;;)try{const e=await this.props.fetch();this.stores.store.setState({loaded:!0,result:e});break}catch(t){a.log({level:"warning",from:"LazyLoader",type:"fetchError",error:(0,s.Ui)(t),data:{miscDataToConvertToString:{waitMs:e}}}),await l.Vs(e),await c.Z.waitUntil((()=>c.Z.state.online)),e=Math.min(2*e,3e4)}}}h.displayName="LazyLoader";const f=h},17748:(e,t,o)=>{o.d(t,{Z:()=>ie});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(83355),c=o(27531),d=o(41432),p=o(4615),u=o(21202),m=o(13084),g=o(30149),h=o(98165),f=o(67669),v=o(23883),y=o(3815),b=o(99757),S=o(97464),w=o.n(S),k=o(45697),C=o.n(k),_=o(45060),M=o(95538),T=o(45953),I=o(18844),P=o(90468),x=o(50906),B=o(94419),Z=o(617),E=o(28020),R=o(78316),A=o(78175),D=o(41232),F=o(78429),L=o(10663),V=o(17504),N=o(73959),O=o(45094),U=o(77505),H=o(35328),z=o(68859),W=o(4926),j=o(88923),K=o(26664),Y=o(27724),G=o(45131),X=o(83907),q=o(12022),$=o(30016),J=o(45952),Q=o(66094);class ee extends l.Z{constructor(){super(...arguments),this.blockRef=s.createRef(),this.storeTypes={blockResizerStore:z.Z},this.renderPreventSidebar=()=>{const{isInlineCollectionView:e}=this.renderStateStore.state;return e?this.renderSelectable():(0,V.Z)(this.renderSelectable)},this.renderSelectable=e=>{const{store:t,canEditList:o,isFirstItem:i}=this.props,{canDropOnto:n,canDropLeftRight:r,shouldShowParentHalo:a,showHoverMenu:l,canDrag:c,canSelect:d,shouldShowSelectionHalo:p,isColumnList:u,isSimpleTable:m,showCommentMenu:g,preventBackgroundDrag:h,shouldDisableHoverMenuDrag:f,disableForceTouch:v}=this.renderStateStore.state;return s.createElement(Q.Z,w()({style:this.getStyle.state,store:t,canSelect:d,canEditText:this.canEdit(),shouldShowHalo:p,shouldShowParentHalo:a,canDrag:c,canDropAbove:o&&i,canDropBelow:o,canDropLeft:r,canDropRight:r,canDropOnto:o&&n,canNativeDropAbove:o&&i,canNativeDropBelow:o,canNativeDropLeft:r,canNativeDropRight:r,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,canTriggerContextMenu:o&&!u,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,canInsertAbove:o,canInsertBelow:o,onEditText:this.handleEditText,onEnter:this.handleEnter,onRemove:this.handleRemove,showBlockMenuInput:!0,shouldShowHoverMenu:l,shouldDisableHoverMenuDrag:f,disableForceTouch:v,shouldShowCommentMenu:g,shouldShowDropZone:!m,isListContainer:!0,preventBackgroundDrag:h,analyticsName:"page_content"},e),this.renderBlock())},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e;return a().clone(t).reverse().map((e=>B.Vt({parent:this.props.listStore,insert:e,before:this.props.store,transaction:o}).child))},this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e;return a().clone(t).reverse().map((e=>B.BE({parent:this.props.listStore,insert:e,after:this.props.store,transaction:o}).child))},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:i}=e;g.createAndCommit({userAction:"ListItemBlock.handleDrop",environment:this.environment,perform:e=>{m.LQ({environment:this.environment,targetParentStore:this.props.listStore,targetStore:this.props.store,droppedDirection:t,droppedStores:o,duplicate:i,transaction:e})}})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e;g.createAndCommit({userAction:"ListItemBlock.handleNativeDrop",environment:this.environment,perform:e=>m.uQ({environment:this.environment,files:t,targetParentStore:this.props.listStore,targetStore:this.props.store,droppedDirection:o,transaction:e})})},this.handleEditText=e=>{m.DC({environment:this.environment,targetStore:this.props.store,targetParentStore:this.props.listStore,isAtStartOfLine:e.isAtStartOfLine,isAtStartOfContainer:e.isAtStartOfContainer,isClick:e.isClick,transaction:e.transaction})},this.handleEnter=e=>{this.blockRef.current&&this.blockRef.current.edit?this.blockRef.current.edit():m.Bm({environment:this.environment,targetStore:this.props.store,targetParentStore:this.props.listStore,isAtStartOfLine:!1,isClick:!1,transaction:e.transaction})},this.handleRemove=e=>{const{store:t}=this.props,{transaction:o}=e,i=t.getRecordStoreUIParent();i&&(i.table!==u.iU&&i.table!==P.bx&&i.table!==I.Xj||!i.valueIs(K.i)||B.Od({parent:i,childToRemove:t,transaction:o}))},this.isPageFullWidth=this.createComputedStore((()=>{var e;return null===(e=this.pageContext)||void 0===e?void 0:e.pageStore.isFullWidth()})),this.canEditStore=this.createComputedStore((()=>{const e=this.pageContext&&this.pageContext.publicEditModeStore.state;return!this.props.disabled&&(!(0,f.YF)(e)&&this.props.store.canEdit())})),this.isLegacyTransclusionStore=this.createComputedStore((()=>{const e=this.props.store.getParentId();return Boolean(e&&this.props.listStore.id!==e)})),this.isReadOnlyBlockInReadWritePageStore=this.createComputedStore((()=>{const e=this.pageContext&&this.pageContext.publicEditModeStore.state;return this.props.canEditList&&!Z.OO({environment:this.environment,blocks:[this.props.store],publicEditMode:e})})),this.renderStateStore=this.createComputedStore((()=>{const{device:e}=this.environment,{store:t,canEditList:o,disableSelection:i,disableHoverMenu:n,disableCommentMenu:r}=this.props,a=t.getFormat(),s=t.getType(),{dragging:l,temporaryFullWidth:c}=this.stores.blockResizerStore.state,p=(0,X.h)(this.props.store),m=l?c:a.block_full_width,g=s===d.Ti.page||s===d.Ti.collectionViewPage||a.alias_pointer&&(0,T.$O)(a.alias_pointer,u.iU)||s&&(0,H._A)(s,a)&&!G.Z.isOpen(t.id),h=Boolean(s&&(0,d.dM)(s)),v=s===d.Ti.table,y=s===d.Ti.columnList,b=p===q.Z,S=b,w=this.isRootOrDirectChild()&&!y&&!v&&o&&!e.isPhone,k=this.pageContext&&this.pageContext.publicEditModeStore.state,C=(0,f.BZ)(k),_=!i&&t.canRead()&&!y&&!b&&!v&&!this.isReadOnlyBlockInReadWritePageStore.state,M=!C&&_&&!b&&!v,I=M,P=!(C||n||y||b||v||(s===d.Ti.transclusionContainer||s===d.Ti.transclusionReference||s===d.Ti.aiBlock)&&this.descendantIsSelected()),x=!r&&("comment_only"===t.getRole()||"comment"===(null==k?void 0:k.permission))&&!o&&!y&&!h&&this.environment.currentUser.isLoggedIn()&&!v,B=v?U.Xp({simpleTableStore:t,environment:this.environment,includeInline:!this.marginCommentsVisible.state}):0,Z=o&&!y&&!this.props.disableDrag,E=Boolean(this.props.store.findRecordStoreUIAncestor((e=>e===j.default.peekTarget.state)).ancestor),R=s&&(0,d.OY)(s)&&!t.getProperties().source,A="drawing"===s&&(0,N.iZ)(t),D=a.block_alignment;return{type:s,isFullWidth:m,canDropOnto:g,canDropLeftRight:w,shouldShowParentHalo:I,showHoverMenu:P,canDrag:Z,canSelect:_,shouldShowSelectionHalo:M,isColumnList:y,showCommentMenu:x,numSimpleTableComments:B,isInlineCollectionView:b,isSimpleTable:v,isInPeekRenderer:E,isMediaWithoutSource:R,preventBackgroundDrag:S,disableForceTouch:A,shouldDisableHoverMenuDrag:this.isReadOnlyBlockInReadWritePageStore.state,alignStyle:D}}),!0,"renderStateStore"),this.blockRendererStore=this.createComputedStore((()=>(0,X.h)(this.props.store))),this.appRenderState=this.createComputedStore((()=>E.h1(this.environment))),this.getStyle=this.createComputedStore((()=>{const{device:e}=this.environment,{store:t}=this.props,{type:o,isInPeekRenderer:i,isFullWidth:n,isInlineCollectionView:r,isSimpleTable:a,numSimpleTableComments:s,isMediaWithoutSource:l,alignStyle:c}=this.renderStateStore.state,p={};if(this.externalObjectStateStore.state){const e=this.externalObjectStateStore.state;p.minWidth=M.B9,"image/*"!==e&&(p.width="100%")}else p.width="100%";p.maxWidth=this.getFullWidth(),(e.isMobile&&!n||this.isInColumnList()||!this.isRootOrDirectChild())&&(p.maxWidth="100%"),c&&!n&&!e.isPhone&&ee.alignmentStyleMap[c]?p.alignSelf=ee.alignmentStyleMap[c]:this.isRootOrDirectChild()&&o&&d.ib[o]?p.alignSelf="center":o&&d.Ok[o]&&(p.alignSelf="flex-start");const{topGap:u,gap:m,bottomGap:g}=ee;if(p.marginTop=this.props.isFirstItem?u:m,p.marginBottom=this.props.isLastItem?g:m,l?p.marginTop=ee.marginStyle.marginTop:o&&ee.defaultMarginTop[o]&&(p.marginTop=ee.defaultMarginTop[o]),l&&!this.props.isLastItem?p.marginBottom=ee.marginStyle.marginBottom:!this.props.isLastItem&&o&&ee.defaultMarginBottom[o]&&(p.marginBottom=ee.defaultMarginBottom[o]),(r||a&&0===s)&&(this.isRootOrDirectChild()||e.isPhone)){const e=this.getFullWidth();p.maxWidth=i?this.getInlineCollectionInPeekViewMaxWidth():(0,R.Ks)(t)&&!this.isPageFullWidth.state?E.CC:e,p.width=(0,R.Ks)(t)&&!this.isPageFullWidth.state?E.CC:e,p.alignSelf="center"}return this.isRootOrDirectChild()&&this.marginCommentsVisible.state&&r&&(p.zIndex=1),(0,F.H)()&&this.isLegacyTransclusionStore.state&&(p.border="3px dashed deeppink"),p})),this.externalObjectStateStore=this.createComputedStore((()=>{if((0,D.Xg)()&&this.props.store.isExternalObjectInstanceBlockStore()){var e;const t=(0,D._l)({store:this.props.store,canEdit:this.canEdit(),currentUserId:this.environment.currentUser.id,isInDarkMode:"dark"===this.environment.ThemeStore.state.mode,showAction:void 0});return(null==t?void 0:t.renderConfig.previewAttributes)&&(null===(e=t.renderConfig.previewAttributes[0])||void 0===e?void 0:e.mimeType)}}),!0),this.marginCommentsVisible=this.createComputedStore((()=>(0,L.fg)(this.environment,this.props.store))),this.sidePeekWidth=this.createComputedStore((()=>(0,O.vJ)(this.environment)))}willMount(e){super.willMount(e),this.isCopyIndicatorWithoutPendingTransaction=(0,E.hq)(e.store)}didMount(){this.isLegacyTransclusionStore.state&&(x.trackLegacyTransclusionShow(this.environment,{block_type:this.props.store.getType()}),(0,_.XY)("Found a potential legacy transclusion--a block's parent is not its rendered parent!",[["block",this.props.store],["block parent id = ",this.props.store.getParentId()],["rendered parent id = ",this.props.listStore.id]]))}renderComponent(){if(!this.isCopyIndicatorWithoutPendingTransaction||this.renderStateStore.state.type!==d.Ti.copyIndicator)return this.isResizableType()?n()($.Z,{isVisible:!0,animationStyle:this.getResizeAnimationStyle(),render:()=>this.renderPreventSidebar()}):this.renderPreventSidebar()}renderBlock(){const{renderItem:e,disabled:t,store:o,disableHoverMenu:i,disableDrag:n,disableCommentMenu:r,numberedListCounterStore:a,bulletedListFormatStore:l}=this.props,c=this.blockRendererStore.state;return e?e(o):c?s.createElement(c,{ref:this.blockRef,store:this.props.store,disabled:t,isFirstItem:this.props.isFirstItem,isLastItem:this.props.isLastItem,blockResizerStore:this.stores.blockResizerStore,disableCommentMenu:r,numberedListCounterStore:a,bulletedListFormatStore:l,disableHoverMenu:i,disableDrag:n}):void 0}isRootOrDirectChild(){return this.props.store.isRootOrDirectChild()}descendantIsSelected(){const{store:e}=this.props;return Y.default.state.stores.some((t=>t!==e&&e.uiContains(t)))}isInHistoryModal(){return Boolean(this.props.store.inMemoryRecordCache.snapshotData)}isResizableType(){const e=this.renderStateStore.state.type;return!!e&&(Boolean(d.Ok[e])||this.props.store.isType("column_list")&&(0,A.Po)(this.props.store,this.environment)||this.props.store.isType("external_object_instance")&&(0,D.Xg)())}isOverflowEdgeBlockType(){const e=this.renderStateStore.state.type;return!!e&&(d.GP[e]||this.props.store.isType("column_list")&&(0,A.Po)(this.props.store,this.environment)&&this.props.store.getFormat().block_full_width)}isInColumnList(){return this.context.isInColumnList}canEdit(){return this.canEditStore.state}getResizeAnimationStyle(){const{type:e}=this.renderStateStore.state;if(e&&(0,J.x)({environment:this.environment,type:e}))return{width:"100%"};const{dragging:t,temporaryWidth:o,temporaryFullWidth:i,temporaryPageWidth:n}=this.stores.blockResizerStore.state,{block_width:r,block_full_width:a,block_page_width:s}=this.props.store.getFormat(),l=t?o:r,c=t?n:s;return{width:(t?i:a)?this.getFullWidth():c?"100%":l}}getFullWidth(){const{device:e}=this.environment,{isInPeekRenderer:t}=this.renderStateStore.state,o=this.environment.WindowSizeStore.state.width,i=(0,O.ll)(this.environment,t)-this.sidePeekWidth.state,n=o-W.Z.state-i;if(this.isInHistoryModal()&&!e.isPhone)return.8*o-240-W.Z.state;if(this.isInColumnList()||!this.isRootOrDirectChild())return"100%";if(t)return j.default.getPeekModeWidth(o)-W.Z.state;if((0,O.Jr)(this.environment)){let o=n;const{state:{shouldShowSidebar:i}}=this.appRenderState;return(!e.isMobile||e.isTablet)&&i&&(0,O.in)(this.environment)&&(o-=(0,O.Wk)(this.environment)),!this.renderStateStore.state.isInlineCollectionView&&this.marginCommentsVisible.state&&(this.isPageFullWidth.state?o-=L.QB:o-=2*(0,L.gC)(this.environment,t,(0,R.Ks)(this.props.store))),this.isOverflowEdgeBlockType()||(o-=2*(0,E.ui)(this.environment)),o}return n}getInlineCollectionInPeekViewMaxWidth(){return`calc(100vw - ${2*j.PeekModeOuterPadding-W.Z.state}px)`}}ee.displayName="ListItemBlock",ee.contextTypes={...l.w,isInColumnList:C().any},ee.marginStyle={marginTop:4,marginBottom:4},ee.alignmentStyleMap={left:"flex-start",center:"center",right:"flex-end"},ee.defaultMarginTop={quote:ee.marginStyle.marginTop,code:ee.marginStyle.marginTop,bookmark:ee.marginStyle.marginTop,external_object_instance:ee.marginStyle.marginTop,file:void 0,video:ee.marginStyle.marginTop,embed:ee.marginStyle.marginTop,tweet:ee.marginStyle.marginTop,audio:ee.marginStyle.marginTop,drive:ee.marginStyle.marginTop,gist:ee.marginStyle.marginTop,maps:ee.marginStyle.marginTop,framer:ee.marginStyle.marginTop,invision:ee.marginStyle.marginTop,figma:ee.marginStyle.marginTop,loom:ee.marginStyle.marginTop,typeform:ee.marginStyle.marginTop,codepen:ee.marginStyle.marginTop,equation:ee.marginStyle.marginTop,pdf:ee.marginStyle.marginTop,header:"2em",sub_header:"1.4em",sub_sub_header:"1em",image:ee.marginStyle.marginTop,page:void 0,collection_view:void 0,collection_view_page:void 0,column_list:void 0,column:void 0,breadcrumb:void 0,text:void 0,bulleted_list:void 0,numbered_list:void 0,to_do:void 0,toggle:void 0,factory:void 0,copy_indicator:void 0,divider:void 0,link_to_collection:void 0,link_to_page:void 0,alias:void 0,transclusion_container:1,transclusion_reference:1,callout:ee.marginStyle.marginTop,table_of_contents:ee.marginStyle.marginTop,whimsical:ee.marginStyle.marginTop,miro:ee.marginStyle.marginTop,abstract:ee.marginStyle.marginTop,mixpanel:ee.marginStyle.marginTop,sketch:ee.marginStyle.marginTop,excalidraw:ee.marginStyle.marginTop,replit:ee.marginStyle.marginTop,table:1,table_row:void 0,tab:ee.marginStyle.marginTop,hex:ee.marginStyle.marginTop,deepnote:ee.marginStyle.marginTop,external_object_instance_page:ee.marginStyle.marginTop,button:void 0,ai_block:1,drawing:ee.marginStyle.marginTop},ee.defaultMarginBottom={quote:ee.marginStyle.marginBottom,code:ee.marginStyle.marginBottom,header:ee.marginStyle.marginBottom,bookmark:ee.marginStyle.marginBottom,external_object_instance:ee.marginStyle.marginBottom,file:void 0,video:ee.marginStyle.marginBottom,embed:ee.marginStyle.marginBottom,tweet:ee.marginStyle.marginBottom,drive:ee.marginStyle.marginBottom,audio:ee.marginStyle.marginBottom,gist:ee.marginStyle.marginBottom,maps:ee.marginStyle.marginBottom,framer:ee.marginStyle.marginBottom,invision:ee.marginStyle.marginBottom,figma:ee.marginStyle.marginBottom,loom:ee.marginStyle.marginBottom,typeform:ee.marginStyle.marginBottom,mixpanel:ee.marginStyle.marginBottom,codepen:ee.marginStyle.marginBottom,equation:ee.marginStyle.marginBottom,pdf:ee.marginStyle.marginBottom,image:ee.marginStyle.marginBottom,sub_header:void 0,sub_sub_header:void 0,page:void 0,collection_view:void 0,collection_view_page:void 0,column_list:void 0,column:void 0,breadcrumb:void 0,text:void 0,bulleted_list:void 0,numbered_list:void 0,to_do:void 0,toggle:void 0,factory:void 0,copy_indicator:void 0,divider:void 0,link_to_collection:void 0,link_to_page:void 0,alias:void 0,transclusion_container:1,transclusion_reference:1,callout:ee.marginStyle.marginBottom,table_of_contents:ee.marginStyle.marginBottom,whimsical:ee.marginStyle.marginBottom,miro:ee.marginStyle.marginBottom,abstract:ee.marginStyle.marginBottom,sketch:ee.marginStyle.marginBottom,excalidraw:ee.marginStyle.marginBottom,replit:ee.marginStyle.marginBottom,hex:ee.marginStyle.marginBottom,deepnote:ee.marginStyle.marginBottom,table:1,table_row:void 0,tab:ee.marginStyle.marginBottom,external_object_instance_page:ee.marginStyle.marginBottom,button:void 0,ai_block:1,drawing:ee.marginStyle.marginBottom},ee.topGap=2,ee.gap=1,ee.bottomGap=0;const te=ee;class oe extends l.Z{constructor(){super(...arguments),this.renderItem=(e,t,o)=>e===oe.emptyDroppableKey?this.renderEmptyDroppable():e===oe.placeholderKey?n()("div",{},e,this.props.emptyPlaceholder):this.renderChild(e,t,o),this.handleEmptyDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:i}=e;g.createAndCommit({userAction:"List.handleEmptyDrop",environment:this.environment,perform:e=>{m.LQ({environment:this.environment,targetParentStore:this.props.store,targetStore:void 0,droppedDirection:t,droppedStores:o,duplicate:i,transaction:e})}})},this.handleEmptyNativeDrop=e=>{const{files:t,droppedDirection:o}=e;g.createAndCommit({userAction:"List.handleEmptyNativeDrop",environment:this.environment,perform:e=>{m.uQ({environment:this.environment,files:t,targetParentStore:this.props.store,targetStore:void 0,droppedDirection:o,transaction:e})}})},this.bulletedListFormatStore=this.createComputedStore((()=>{var e;const t=this.itemKeysStore.state,o=null===(e=this.props.bulletedListFormatStore)||void 0===e?void 0:e.getState().depth,i="number"==typeof o?o+1:0,n=new Map;let r;for(const a of t){const e=this.createStoreForItemId(a);r=e.getType()===d.Ti.bulletedList?e.getFormat().bullet_list_format||r:void 0,r&&n.set(a,r)}return{depth:i,blockIdFormats:n}})),this.numberedListCounterStore=this.createComputedStore((()=>{var e;const t=this.itemKeysStore.state,o=[],i=t.length?t[0]:void 0,n=i?this.createStoreForItemId(i):void 0,r=null==n?void 0:n.getParentId(),a=null===(e=this.props.numberedListCounterStore)||void 0===e?void 0:e.state.numberedListBlockIdsWithFormat.find((e=>e.id===r)),s=null==a?void 0:a.format;let l=void 0===(null==a?void 0:a.depth)?0:(null==a?void 0:a.depth)+1,c=s,p=0;for(const u of t)if(u!==oe.emptyDroppableKey&&u!==oe.placeholderKey){const e=this.createStoreForItemId(u),t=e.getType(),i=e.getFormat();if(c=(null==i?void 0:i.list_format)??c,t===d.Ti.numberedList){let e=i.list_start_index;e&&0!==p&&(e=void 0),p=e||p+1,o.push({id:u,format:c,depth:l||0,index:p})}else c=void 0,o.push({id:void 0,format:c,depth:0,index:p}),l=0,p=0}return{depth:l||0,numberedListBlockIdsWithFormat:o}})),this.canEditStore=this.createComputedStore((()=>{const e=(0,h.n3)(this.props.store)&&this.pageContext&&this.pageContext.publicEditModeStore.state;return!(0,f.YF)(e)&&this.props.store.canEdit()})),this.itemKeysStore=this.createComputedStore((()=>{const e=this.props.store.getValue()||[];let t=e;const o=this.getChildrenLimit(),i=this.canEdit(),n=0===e.length;return void 0!==o&&(t=a().slice(t,0,o)),i&&n&&t.push(oe.emptyDroppableKey),i&&n&&this.props.emptyPlaceholder&&t.push(oe.placeholderKey),t}))}renderComponent(){if(!this.props.disableContent){var e;const t=null===(e=this.context.restrictedContentContext)||void 0===e?void 0:e.state;return t?this.itemKeysStore.state.reduce(((e,o,i,n)=>(t.indexOf(o)>=0&&e.push(this.renderItem(o,i,n)),e)),[]):this.itemKeysStore.state.map(this.renderItem)}}renderChild(e,t,o){const{disabled:i}=this.props,r=this.createStoreForItemId(e),s=a().findLastIndex(o,(e=>(0,p.e)(e)));return n()(te,{store:r,renderItem:this.props.renderItem,listStore:this.props.store,isFirstItem:0===t,isLastItem:t===s,disabled:i,disableLayout:this.props.disableLayout,canEditList:this.canEdit(),disableSelection:this.props.disableSelection,disableHoverMenu:this.props.disableHoverMenu,disableCommentMenu:this.props.disableCommentMenu,disableDrag:this.props.disableDrag,numberedListCounterStore:this.numberedListCounterStore,bulletedListFormatStore:this.bulletedListFormatStore},e)}renderEmptyDroppable(){const e=y.G.createChildStore(this.props.store,{table:u.iU,id:this.props.store.id}),t=this.canEdit();return n()(Q.Z,{store:e,canDropBelow:t,canNativeDropBelow:t,onSelectableDrop:this.handleEmptyDrop,onNativeDrop:this.handleEmptyNativeDrop,style:this.props.emptyDroppableStyle,analyticsName:"page_content",shouldShowDropZone:!0},oe.emptyDroppableKey)}canEdit(){return!this.props.disabled&&(!b.n.state&&this.canEditStore.state)}getChildrenLimit(){const{limitParents:e}=v.Z.state,t=this.props.store.id;let o;return this.props.store.findRecordStoreUIAncestor((i=>{const n=e.get(i);return!(!n||!n.hasOwnProperty(t))&&(o=n[t],!0)})),o}createStoreForItemId(e){return y.G.createChildStore(this.props.store,{table:u.iU,id:e})}}oe.displayName="List",oe.placeholderKey="placeholder",oe.emptyDroppableKey="emptyDroppableKey",oe.contextTypes={...c.J,...l.w};const ie=oe},78454:(e,t,o)=>{o.d(t,{v2:()=>u,LK:()=>y,R8:()=>b,ZP:()=>T});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(49271),c=o(63143),d=o(89086),p=o(68709);let u;!function(e){e[e.Start=0]="Start",e[e.Center=1]="Center",e[e.End=2]="End"}(u||(u={}));const{Start:m,Center:g,End:h}=u,f=function(e){return window.__c={n:"renderLeft"},s.createElement(p.p,n()({},(0,d.td)("start"),{allowSelectionWithin:!1,style:C(e)}),e.left)},v=function(e){return window.__c={n:"renderRight"},s.createElement(p.p,n()({},(0,d.td)("end"),{allowSelectionWithin:!1,style:_(e)}),e.right)},y=24,b={...l.ZD,textAlign:"left"},S={[m]:"flex-start",[g]:"center",[h]:"flex-end"},w=function(e){return{display:"flex",alignItems:c.z4(e.alignment)?S[u.Start]:S[e.alignment],width:"100%",...e.style}},k=function(e){const t={display:"flex",alignItems:"center",justifyContent:"center",flexGrow:0,flexShrink:0};return(e.leftRightMinHeight||c.z4(e.leftRightMinHeight))&&(t.minHeight=`calc(1.5em + ${l.ZD.paddingTop}px + ${l.ZD.paddingTop}px)`),t},C=e=>({marginRight:2,width:y,...k(e),...e.leftStyle}),_=e=>({marginLeft:4,...k(e),...e.rightStyle}),M=e=>({flexGrow:1,flexShrink:1,flexBasis:0,minWidth:1,...e.childrenStyle}),T=function(e){return window.__c={n:"ListItemBox"},a()("div",{onClick:e.onClick,onMouseMove:e.onMouseMove,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onMouseDown:e.onMouseDown,style:w(e)},void 0,e.left&&f(e),e.children&&a()("div",{style:M(e)},void 0,e.children),e.right&&v(e))}},78948:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(68785),s=o(28992);class l extends r.Z{renderComponent(){return n()(s.Z,{title:n()(a.Z,{})})}}l.displayName="LoadingMenuItem";const c=l},93007:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355));function a(){return(navigator.languages?navigator.languages.map((e=>e.toLowerCase())):navigator.language?[navigator.language.toLowerCase()]:navigator.userLanguage?[navigator.userLanguage.toLowerCase()]:[]).map((e=>e.split("-")[0]))}const s=["ar","az","he","fa","ur"];class l extends r.Z{renderComponent(){return this.renderTranslatedText()}renderTranslatedText(){const{translations:e}=this.props,t=a();for(const o of t){const t=e[o];if(t)return n()("div",{style:this.getTextStyle(o)},void 0,t)}}getTextStyle(e){return s.includes(e)?{direction:"rtl",...this.props.style}:{...this.props.style}}}l.displayName="LocaleText";const c=l},40148:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(13991),s=o(82990);class l extends r.Z{renderComponent(){return n()("div",{style:this.getStyle()},void 0,n()("div",{style:l.innerStyle},void 0,this.props.iconSvg({...this.getIconStyle()}),n()("div",{style:{...s.Z.textOverflowStyle}},void 0,this.props.children)),this.props.right&&n()("div",{style:l.rightStyle},void 0,this.props.right))}getStyle(){return{width:"100%",fontSize:14,fontFamily:s.Z.getCompositeFontFamily(a.SP).sans,color:this.theme.mediumTextColor,borderRadius:3,background:this.theme.embedPlaceholderBackground,position:"relative",...this.props.style}}getIconStyle(){return{width:25,height:25,flexShrink:0,marginRight:12,fill:this.theme.mediumIconColor,...this.props.iconStyle}}}l.displayName="MediaPlaceholder",l.innerStyle={padding:12,paddingRight:36,display:"flex",alignItems:"center",textAlign:"left",width:"100%",overflow:"hidden"},l.rightStyle={position:"absolute",top:4,right:4},l.textPaddingLeftRight=6,l.textPaddingTopBottom=2,l.titleStyle={fontSize:14,lineHeight:"20px"},l.captionStyle={fontSize:12,paddingTop:l.textPaddingTopBottom,paddingBottom:l.textPaddingTopBottom},l.smallButtonStyle=l.captionStyle;const c=l},39849:(e,t,o)=>{o.d(t,{Z:()=>d});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(8848),s=o(82990);let l;!function(e){e[e.Red=0]="Red",e[e.Gray=1]="Gray"}(l||(l={}));class c extends r.Z{renderComponent(){const{count:e}=this.props,t=this.props.color===l.Red;if(e&&!(e<=0))return n()("div",{style:{...c.style,...this.props.style,...e>99&&{width:void 0,padding:2},background:t?this.theme.redBadgeBackground:this.theme.lightIconColor}},void 0,this.renderNumber())}renderNumber(){const{count:e}=this.props;if(e)return 1===e?n()("span",{style:{marginLeft:-.5,...this.props.numberStyle}},void 0,"1"):e>99?n()("span",{style:{letterSpacing:-.5,...this.props.numberStyle}},void 0,"99+"):n()("span",e>9?{style:{letterSpacing:-.5,marginLeft:-.5,...this.props.numberStyle}}:{style:{...this.props.numberStyle}},void 0,e)}}c.displayName="MentionsBadge",c.Color=l,c.style={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:16,height:16,fontSize:10,textAlign:"center",fontWeight:s.Z.fontWeight.semibold,borderRadius:3,color:a.ZP.white,position:"static",marginLeft:6,WebkitFontSmoothing:"auto"};const d=c},255:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(3779),s=o(73063);class l extends r.Z{constructor(){super(...arguments),this.styles={removeFilterButton:{height:void 0,width:void 0},removeFilterButtonMobile:{marginRight:-12,marginTop:-12,marginBottom:-12,paddingRight:12,paddingTop:12,paddingBottom:12}}}renderComponent(){const{onClick:e,disabled:t}=this.props,o=this.styles,{device:i}=this.environment,r=i.isMobile?{...o.removeFilterButton,...o.removeFilterButtonMobile}:o.removeFilterButton;return n()(s.Z,{icon:a.Z.clearInput,onClick:e,disabled:t,disableBackground:!0,style:r})}}l.displayName="MenuItemRemoveButton";const c=l},61208:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(77094),n=o.n(i),r=(o(67294),o(24405)),a=o(3779);function s(e){window.__c={n:"MobileUpdatesModalEmptyTab"};const{message:t,title:o}=e,i=(0,r.yK)((e=>({wrapper:{textAlign:"center",paddingLeft:20,paddingRight:20,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minHeight:220},icon:{width:48,fill:e.mediumTextColor},message:{fontSize:14,color:e.lightTextColor,marginTop:2,marginBottom:4,maxWidth:380},title:{fontSize:14,fontWeight:500,color:e.mediumTextColor,maxWidth:380}})),[]),s=e.icon||a.Z.inbox;return n()("div",{style:i.wrapper},void 0,n()("div",{style:{paddingBottom:12}},void 0,s(i.icon)),n()("div",{style:i.title},void 0,o),n()("div",{style:i.message},void 0,t))}},65085:(e,t,o)=>{o.d(t,{Z:()=>l});var i=o(77094),n=o.n(i),r=o(67294),a=o(24405),s=o(42402);function l(e){window.__c={n:"MultiLineTextOverflow"};const{children:t,maxLines:o,onMore:i,onLess:s}=e,l=(0,r.useRef)(null),d=(0,r.useRef)(null),p=(0,r.useRef)(null),[u,m]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!o),[f,v]=(0,r.useState)(0),[y,b]=(0,r.useState)(0);(0,r.useEffect)((()=>{if(u){var e;const t=null===(e=d.current)||void 0===e?void 0:e.getClientRects()[0];v((null==t?void 0:t.height)??0),b((null==t?void 0:t.width)??0)}}),[u]);const S=(0,r.useCallback)((()=>{l.current&&m(l.current.scrollHeight>l.current.clientHeight)}),[]);(0,r.useEffect)((()=>{!g&&o&&S()}),[g,o,S]),(0,r.useEffect)((()=>{if(p.current){const e=new MutationObserver((()=>{g||S()})),t=new ResizeObserver((()=>{g||S()}));return t.observe(p.current),e.observe(p.current,{childList:!0,subtree:!0}),()=>{t.disconnect(),e.disconnect()}}}),[g,S]);const w=(0,r.useCallback)((e=>{i?i(e):(e.preventDefault(),e.stopPropagation(),h(!0))}),[i]),k=(0,r.useCallback)((e=>{s?s(e):(e.preventDefault(),e.stopPropagation(),h(!1))}),[s]),C=(0,r.useMemo)((()=>n()(c,{style:{position:"absolute",right:0,bottom:0},onClick:w},void 0,r.createElement("div",{ref:d},e.moreElement))),[e.moreElement,w]),_=(0,r.useMemo)((()=>n()(c,{onClick:k},void 0,e.lessElement)),[e.lessElement,k]),M=(0,a.yK)((e=>({base:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:g?void 0:o},clamped:{WebkitMaskPosition:"right bottom",WebkitMask:`linear-gradient(0deg,transparent 0,transparent ${f}px,#000 ${f}px),\n\t\t\t\t\t\t\t linear-gradient(270deg,transparent 0,transparent ${y}px,#000 ${2*y}px)`}})),[o,g,f,y]);return n()("div",{style:{position:"relative"}},void 0,r.createElement("div",{ref:l,style:{...M.base,...u&&!g&&M.clamped,...e.style}},r.createElement("div",{ref:p},t),u&&g&&_),u&&!g&&C)}function c(e){let{onClick:t,style:o,children:i}=e;return window.__c={n:"WrapInlineActionElement"},n()(s.Z,{disableUnderline:!0,style:o,onClick:e=>{t(e)}},void 0,i)}},83590:(e,t,o)=>{o.d(t,{Z:()=>Te,f:()=>Ie});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(24405),c=o(76725),d=o(89101),p=o(32161),u=o(97880),m=o(82990),g=o(5366),h=o(50906),f=o(84908),v=o(9953),y=o(5978),b=o(35822),S=o(30149),w=o(37181),k=o(51456),C=o(21969),_=o(59488),M=o(18441),T=o(33665),I=o(28187),P=o(38755),x=o(21115),B=o(79315),Z=o(88632),E=o(24042),R=o(10161),A=o(30874),D=o(42389),F=o(3815),L=o(72087),V=o(92083),N=o(78291),O=o(97832),U=o(79092),H=o(97464),z=o.n(H),W=o(86658),j=o(3779),K=o(92108),Y=o(12955),G=o(10182),X=o(89728),q=o(55422);function $(e){return(0,Y.canSetCookie)(e)&&(0,Y.canShowCookieUi)(e)}function J(){window.__c={n:"CookieSettingsButton"};const e=(0,l.Fg)();return n()(G.Z,{hasDismissButton:!1,renderOrigin:t=>r.createElement(X.Z,z()({style:{paddingLeft:8,paddingRight:8,height:32}},t),n()(g.FormattedMessage,{id:"cookieSelector.label.customize",defaultMessage:"Customize"}),j.Z.chevronDown({width:10,marginLeft:4,fill:e.lightIconColor}))})}const Q=function(e){let{isMobile:t}=e;return window.__c={n:"CookieSettings"},$((0,a.O7)())?n()(q.Z,{isMobile:t,title:r.createElement(g.FormattedMessage,W.ze.cookieSettingsLabel),caption:(0,W.Fd)(K.Tz,"settings"),type:"custom",customButton:n()(J,{})}):null};var ee=o(42922),te=o(61519),oe=o(16354),ie=o(68785),ne=o(64369),re=o(79603),ae=o(74523),se=o(42402),le=o(1548),ce=o(68626),de=o(5500),pe=o(77719),ue=o(60709),me=o(64921),ge=o(52275),he=o(31945),fe=o(78140),ve=o(9342),ye=o(72495);function be(e){window.__c={n:"PersonalSlackNotificationsAccountDropdownButton"};const{currentExternalAuthentication:t,externalAuthentications:o,spaceId:i,spaceViewStore:c}=e,d=(0,a.O7)(),p=(0,a.Fy)(),u=(0,s.VK)((()=>A.Z.integrations.state.find((e=>e.id===de.nO))),[]),m=(0,l.yK)((e=>({popupContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:14,marginTop:12},dropdownButtonContainer:{display:"flex",alignItems:"center",minWidth:0,padding:"0px 8px",borderRadius:3,marginLeft:8},currentValueLabel:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",flex:1},icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor}})),[]);let f;f=p.isPhone?{menuType:ue.og.ActionSheet}:{menuType:ue.og.Popup,width:280,maxHeight:"50vh"};const y=r.useCallback((e=>Object.entries((0,M.YJ)(o)).map(((o,i)=>{let[n,a]=o;return{key:n,items:a.map((o=>{let{externalAuthentication:i,workspaceName:n}=o;return{key:i.id,action:()=>{e.close(),Se({environment:d,spaceViewStore:c,currentExternalBotId:null==t?void 0:t.parent_id,selectedExternalBotId:i.parent_id})},render:e=>r.createElement(ge.Z,z()({},e,{title:n,right:i.id===(null==t?void 0:t.id)&&j.Z.check({width:12,height:12})}))}})),render:e=>r.createElement(ye.Z,z()({},e,{title:n,topBorder:0!==i}))}}))),[null==t?void 0:t.id,null==t?void 0:t.parent_id,d,o,c]),b=r.useCallback((e=>u?[{key:"disable-notification",items:[{key:"disable-slack-notification",action:()=>{e.close(),function(e){const{environment:t,spaceViewStore:o}=e;S.createAndCommit({userAction:"NotificationsAndPersonalSettings.SlackNotificationsAccountSetting",environment:t,perform:e=>{v.sW({store:o.getSettingsStore(),data:{notify_slack:null},transaction:e})}}),h.trackSlackNotificationDelete(t,{type:"personal",source:"notifications_and_settings"})}({environment:d,spaceViewStore:c})},render:e=>r.createElement(ge.Z,z()({},e,{title:n()(g.FormattedMessage,{id:"personalSlackNotificationsAccountDropdownButton.disableNotification.label",defaultMessage:"Off",description:"Label for turning the 'notify slack' setting off."}),right:void 0===t&&j.Z.check({width:12,height:12})}))}],render:e=>r.createElement(ye.Z,z()({},e,{topBorder:y.length>0}))},{key:"create-new-auth",items:[{key:"connect",render:e=>r.createElement(ge.Z,z()({},e,{icon:j.Z.plus({width:12,height:12}),title:n()(g.FormattedMessage,{id:"database.viewSettings.notificationsTab.slack.addNewAccount.label",defaultMessage:"Add new account",description:"Prompt to authenticate with a new Slack account"})})),action:async()=>{var e;const t=await pe.h({environment:d,integration:u,spaceId:i,from:"notifications_and_settings"});if(ce.x.isFail(t))return;const o=null===(e=t.value.externalAuthentication)||void 0===e?void 0:e.parent_id;o&&Se({environment:d,spaceViewStore:c,currentExternalBotId:void 0,selectedExternalBotId:o})}}],render:e=>r.createElement(ye.Z,z()({},e,{topBorder:!0}))}]:[]),[t,d,y.length,i,c,u]);return n()("div",{style:m.popupContainer},void 0,n()(he.Z,{popupType:he.Z.PopupType.Popup,alignmentToOrigin:he.Z.Alignment.End,render:e=>r.createElement(fe.Z,f,n()(ve.Z,{type:ve.i.Vertical,initialFocus:0,sections:[...y(e),...b(e)]})),renderOrigin:t=>r.createElement(me.Z,z()({},t,{style:m.dropdownButtonContainer}),n()("div",{style:m.currentValueLabel},void 0,r.createElement(we,e)),j.Z.chevronDown(m.icon))}))}function Se(e){const{environment:t,spaceViewStore:o,selectedExternalBotId:i,currentExternalBotId:n}=e;n!==i&&(S.createAndCommit({userAction:"NotificationsAndPersonalSettings.SlackNotificationsAccountSetting",environment:t,perform:e=>{v.sW({store:o.getSettingsStore(),data:{notify_slack:{external_bot_id:i}},transaction:e})}}),void 0===n?h.trackSlackNotificationCreate(t,{type:"personal",source:"notifications_and_settings"}):h.trackSlackNotificationUpdate(t,{type:"personal",source:"notifications_and_settings"}))}function we(e){const{currentExternalAuthentication:t}=e;if(!t)return n()(g.FormattedMessage,{id:"SlackNotificationsPersonalSettingsAccountPicker.accountDropdown.selectPlaceholder",defaultMessage:"Off",description:"Account picker placeholder for when Slack notifications are turned off in the personal notifications section."});const o=(0,M.jg)(t).organizationName;return r.createElement(r.Fragment,null,o)}var ke=o(27386),Ce=o(23189),_e=o(42982),Me=o(30045);function Te(e){let{isMobile:t}=e;window.__c={n:"NotificationsAndPersonalSettings"};const{isElectron:o,isPhone:i,isIOS:l}=(0,a.Fy)(),c=(0,a.O7)(),d=(0,s.VK)((()=>Z.Z.state.online),[]),p=(0,s.VK)((()=>{var e;const i=(null===(e=B.default.state.currentSpaceViewStore)||void 0===e?void 0:e.getNotifyEmail())||!1,r=(0,I.kC)();return function(e){const{isMobile:t,isElectron:o,showNotifyEmailAlwaysSetting:i,showSlackNotificationSetting:r}=e;return[{key:"notify_mobile",renderSettingsItem:()=>n()(xe,{target:"notify_mobile"})},!t&&o?{key:"notify_desktop",renderSettingsItem:()=>n()(xe,{target:"notify_desktop"})}:void 0,{key:"notify_email",renderSettingsItem:()=>n()(xe,{target:"notify_email"})},i?{key:"notify_email_always",renderSettingsItem:()=>n()(xe,{target:"notify_email_always"})}:void 0,r?{key:"notify_slack",renderSettingsItem:()=>n()(Be,{target:"notify_slack",isMobile:t})}:void 0].filter(u.$K)}({isMobile:t,isElectron:o,showNotifyEmailAlwaysSetting:i,showSlackNotificationSetting:r})}),[t,o]),m=(0,s.VK)((()=>R.default.checkGate("page_analytics")||R.default.checkGate("page_analytics_individual")||R.default.checkGate("page_analytics_prerelease_opt_outs")),[]),h=(0,s.VK)((()=>t?function(e){let{environment:t,isPhone:o,isIOS:i,enablePageAnalyticsOptOuts:r}=e;const{data:a}=N.default.state,s=i&&x.wY(a),l=(0,re.mS)(),c="on"===R.default.getGroup("mobile-delete-account"),d=!(o&&(0,_.Y)("supportsNativeHome")),p=R.default.checkGate("block_attribution");return[{key:"password",renderSettingsItem:()=>n()(Re,{})},!r&&$(t)?{key:"cookies",renderSettingsItem:()=>n()(Q,{isMobile:!0})}:void 0,{key:"appearance",renderSettingsItem:()=>n()(Ae,{isMobile:!0})},d?{key:"page-on-app-start",renderSettingsItem:()=>n()(Fe,{isMobile:!0})}:void 0,p?{key:"block-attribution",renderSettingsItem:()=>n()(De,{isMobile:!0})}:void 0,s?{key:"subscription",renderSettingsItem:()=>n()(_e.Z,{})}:void 0,{key:"user-consent",renderSettingsItem:()=>n()(Me.Z,{})},{key:"calendar",renderSettingsItem:()=>n()(U.Z,{})},l?{key:"experiments",renderSettingsItem:()=>n()(re.Pp,{})}:void 0,c?{key:"deleteAccount",renderSettingsItem:()=>n()(O.Z,{})}:void 0].filter(u.$K)}({environment:c,isPhone:i,isIOS:l,enablePageAnalyticsOptOuts:m}):function(e){const{environment:t,enablePageAnalyticsOptOuts:o}=e,i=R.default.checkGate("block_attribution"),r=t.device.isDesktop&&(t.device.isMac||t.device.isWindows||!1),a=t.device.isDesktop&&t.device.isMac,s=!o&&$(t);return[{key:"appearance",renderSettingsItem:()=>n()(Ae,{isMobile:!1})},{key:"page-on-app-start",renderSettingsItem:()=>n()(Fe,{isMobile:!1})},r?{key:"open-in-desktop-app",renderSettingsItem:()=>n()(Ve,{})}:void 0,a?{key:"close-browser-tabs",renderSettingsItem:()=>n()(Le,{})}:void 0,s?{key:"cookies",renderSettingsItem:()=>n()(Q,{isMobile:!1})}:void 0,i?{key:"block-attribution",renderSettingsItem:()=>n()(De,{isMobile:!1})}:void 0].filter(u.$K)}({environment:c,enablePageAnalyticsOptOuts:m})),[c,t,i,l,m]),f=(0,s.VK)((()=>[$(c)?{key:"cookies",renderSettingsItem:()=>n()(Q,{isMobile:t})}:void 0,{key:"view-history",renderSettingsItem:()=>n()(Ne,{isMobile:t})}].filter(u.$K)),[c,t]),{paddingBottomCSS:v}=(0,s.VK)((()=>c.WindowSizeStore.state),[c]);return d?n()(ke.Z,{disableScroller:t},void 0,n()(Ce.Z,{large:!t,divider:"full"},void 0,n()(g.FormattedMessage,{id:"notificationAndPersonalSettings.notificationSection.title",defaultMessage:"My notifications"})),n()(Pe,{isMobile:t,items:p}),n()(te.Z,{size:48,isHidden:!0}),n()(Ce.Z,{large:!t,divider:"full"},void 0,n()(g.FormattedMessage,{id:"notificationAndPersonalSettings.settingsSection.title",defaultMessage:"My settings"})),n()(Pe,{isMobile:t,items:h}),m&&r.createElement(r.Fragment,null,n()(te.Z,{size:48,isHidden:!0}),n()(Ce.Z,{large:!t,divider:"full"},void 0,n()(g.FormattedMessage,{id:"notificationAndPersonalSettings.privacySection.title",defaultMessage:"Privacy",description:"Privacy settings section title"})),n()(Pe,{isMobile:t,items:f})),n()(te.Z,{size:48,isHidden:!1}),n()("div",{style:{marginTop:4,marginBottom:t?v:void 0}},void 0,n()(ae.Z,{title:n()(g.FormattedMessage,{id:"notificationSettings.helpButton.caption",defaultMessage:"Learn about notifications & settings"}),href:(0,T.UY)("guides.notificationSettings"),analyticsFrom:"notifications_settings"}))):n()(ke.Z,{},void 0,n()(ne.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,n()(g.FormattedMessage,{defaultMessage:"Please go online to manage settings.",id:"notificationSettingsButton.goOnline.prompt"})))}function Ie(e){return e?32:18}function Pe(e){const{isMobile:t,items:o}=e;return r.createElement(r.Fragment,null,(0,c.Z)(o.map((e=>{let{key:t,renderSettingsItem:o}=e;return n()(r.Fragment,{},t,o())})),(e=>n()(te.Z,{size:Ie(t),isHidden:!t},e))))}function xe(e){window.__c={n:"PushNotificationSetting"};const{target:t}=e,o=(0,a.O7)(),i=(0,s.VK)((()=>B.default.state.currentSpaceViewStore),[]),l=(0,s.VK)((()=>{var e;return(null==i||null===(e=i.getKeyStore(t))||void 0===e?void 0:e.getValue())||!1}),[i,t]),c=(0,r.useCallback)((()=>{if(i){const e=!l;S.createAndCommit({userAction:"NotificationsAndPersonalSettings.onToggle",environment:o,perform:o=>{v.sW({store:i,data:{[t]:e},transaction:o})}}),h.trackSetPushNotification(o,{is_on:e,target:t})}}),[o,i,l,t]);return n()(q.Z,{isMobile:!0,title:Ze(t),caption:Ee({target:t}),type:"toggle",isOn:l,onToggle:c})}function Be(e){window.__c={n:"SlackNotificationsSetting"};const{target:t,isMobile:o}=e,i=(0,s.VK)((()=>B.default.state.currentSpaceViewStore),[]),a=(0,s.VK)((()=>B.default.state.currentSpaceStore),[]),c=(0,s.VK)((()=>A.Z.completeSlackAuthentications.state),[]),d=(0,s.VK)((()=>{var e,o;const n=null==i||null===(e=i.getSettings())||void 0===e||null===(o=e[t])||void 0===o?void 0:o.external_bot_id;if(!n)return;const r=c.find((e=>e.parent_id===n));if(r)return r;if(!i)return;return(0,F.Kv)(i,{id:n,table:p.P}).getValue()}),[i,c,t]),u=(0,l.yK)((e=>({notifySlackSelectedWorkspaceName:{fontWeight:m.Z.fontWeight.bold,color:e.darkTextColor},titleWithBadgeContainer:{display:"flex",alignItems:"center"},betaBadgeContainer:{marginTop:-3},betaBadge:{display:"inline",marginLeft:6}})),[]);return i&&a?n()(q.Z,{type:"custom",isMobile:o,title:Ze(t),caption:r.createElement(r.Fragment,null,d?n()(g.FormattedMessage,{id:"notificationSettings.slackNotificationsSettings.workspaceSelected.description",description:"The caption for the Slack notifications setting in the personal notifications and settings section when a Slack workspace is selected.",defaultMessage:"Receive notifications in {slackWorkspaceName} when you're mentioned in a page, database property, or comment.",values:{slackWorkspaceName:n()("span",{style:u.notifySlackSelectedWorkspaceName},void 0,(0,M.jg)(d).organizationName)}}):Ee({target:t})),customButton:n()(be,{currentExternalAuthentication:d,externalAuthentications:c,spaceId:a.id,spaceViewStore:i})}):null}function Ze(e){return"notify_mobile"===e?n()(g.FormattedMessage,{id:"notificationSettings.mobilePushNotificationSettings.title",defaultMessage:"Mobile push notifications"}):"notify_desktop"===e?n()(g.FormattedMessage,{id:"notificationSettings.desktopNotificationSettings.title",defaultMessage:"Desktop push notifications"}):"notify_email"===e?n()(g.FormattedMessage,{id:"notificationSettings.emailNotificationSettings.title",defaultMessage:"Email notifications"}):"notify_email_always"===e?n()(g.FormattedMessage,{id:"notificationSettings.emailAlwaysNotificationSettings.title",defaultMessage:"Always send email notifications"}):"notify_slack"===e?n()(g.FormattedMessage,{id:"notificationSettings.slackNotificationSettings.title",description:"Title of the Slack notifications setting in the personal notifications and settings section.",defaultMessage:"Slack notifications"}):void(0,u.t1)(e)}function Ee(e){let{target:t}=e;return"notify_mobile"===t?n()(g.FormattedMessage,{id:"notificationSettings.mobilePushNotificationSettings.description",defaultMessage:"Receive push notifications on mentions and comments via your mobile app."}):"notify_desktop"===t?n()(g.FormattedMessage,{id:"notificationSettings.desktopNotificationSettings.description",defaultMessage:"Receive push notifications on mentions and comments immediately via your desktop app."}):"notify_email"===t?n()(g.FormattedMessage,{id:"notificationSettings.emailNotificationSettings.description2",description:"The caption for the email notifications setting that changes whether the user receives emails when they are mentioned in the app.",defaultMessage:"Receive email updates, including mentions and comment replies."}):"notify_email_always"===t?n()(g.FormattedMessage,{id:"notificationSettings.emailAlwaysNotificationSettings.description",defaultMessage:"Receive updates by email, even when you're active on the app."}):"notify_slack"===t?n()(g.FormattedMessage,{id:"notificationSettings.slackNotificationsSettings.default.description",description:"The caption for the Slack notifications setting in the personal notifications and settings section when a Slack workspace is not selected.",defaultMessage:"Receive notifications in your Slack workspace when you're mentioned in a page, database property, or comment."}):void(0,u.t1)(t)}function Re(){const[e,,t]=(0,s.AF)(void 0,L.Z),o=(0,s.VK)((()=>{const{data:e}=N.default.state;return x.wl(e)}),[]);return e.loading?n()(ie.Z,{}):n()(le.Z,{requestStore:t,isEducationPlan:o})}function Ae(e){let{isMobile:t}=e;window.__c={n:"AppearanceSetting"};const o=(0,a.O7)(),i=(0,s.VK)((()=>b.MH(o)),[o]);return n()(q.Z,{isMobile:t,title:n()(g.FormattedMessage,{id:"appearanceSettings.title",defaultMessage:"Appearance"}),caption:n()(g.FormattedMessage,{id:"appearanceSettings.description.message",defaultMessage:"Customize how Notion looks on your device."}),type:"dropdown",currentOption:i,options:[{key:"system",label:n()(g.FormattedMessage,{id:"appearanceSetting.system.label",defaultMessage:"Use system setting"})},{key:"light",label:n()(g.FormattedMessage,{id:"appearanceSetting.light.label",defaultMessage:"Light"})},{key:"dark",label:n()(g.FormattedMessage,{id:"appearanceSetting.dark.label",defaultMessage:"Dark"})}],onSelectOption:e=>{b.rz(e)}})}function De(e){let{isMobile:t}=e;window.__c={n:"AttributionSetting"};const o=(0,a.O7)(),{currentUserSettingsStore:i}=(0,s.VK)((()=>B.default.state),[]),l=(0,s.VK)((()=>{var e;return(null==i||null===(e=i.getSettings())||void 0===e?void 0:e.show_block_attribution)??!0}),[i]),c=(0,r.useCallback)((()=>{i&&S.createAndCommit({userAction:"NotificationsAndPersonalSettings.onToggle",environment:o,perform:e=>{w.d2({userSettingsStore:i,data:{show_block_attribution:!l},transaction:e})}})}),[i,l,o]);return n()(q.Z,{isMobile:t,title:n()(g.FormattedMessage,{id:"attributionSetting.title",defaultMessage:"Block attribution"}),caption:n()(g.FormattedMessage,{id:"attributionSetting.description.message",defaultMessage:"See your teammates’ initials to the left of blocks they created or edited."}),type:"toggle",isOn:l,onToggle:c})}function Fe(e){let{isMobile:t}=e;window.__c={n:"PageOnAppStartSetting"};const o=(0,a.O7)(),i=(0,s.VK)((()=>B.default.state.currentSpaceViewStore),[]),r=(0,s.VK)((()=>P.g4(o,i)),[o,i]);return n()(q.Z,{isMobile:t,title:n()(g.FormattedMessage,{id:"pageOnAppStoreSetting.title",defaultMessage:"Open on start"}),caption:n()(g.FormattedMessage,{id:"pageOnAppStoreSetting.description.message",defaultMessage:"Choose what to show when Notion starts or when you switch workspaces."}),type:"dropdown",currentOption:r,options:[{key:"last_visited_page",label:n()(g.FormattedMessage,{id:"pageOnAppStoreSetting.lastVisitedPage.label",defaultMessage:"Last visited page"})},{key:"first_page",label:n()(g.FormattedMessage,{id:"pageOnAppStoreSetting.firstPage.label",defaultMessage:"Top page in sidebar"})}],onSelectOption:e=>{if(i){const t=(0,F._J)(i,i.pointer,["settings"]);S.createAndCommit({userAction:"NotificationsAndPersonalSettings.PageOnAppStartSetting",environment:o,perform:o=>{v.sW({store:t,data:{on_app_start:e},transaction:o})}})}}})}function Le(){window.__c={n:"CloseBrowserTabsSetting"};const{isElectron:e,isMac:t}=(0,a.Fy)(),o=(0,s.VK)((()=>{var e;return null===(e=E.Z.state.preferences)||void 0===e?void 0:e.isClosingBrowserTabs}),[]),i=(0,r.useCallback)((()=>{const e=!o;f.electronAppFeatures.setPreference("isClosingBrowserTabs",e)}),[o]);if(!e||!t||void 0===o)return null;const l=n()(g.FormattedMessage,{id:"openInDesktopAppSettings.closeBrowserTabs.title",description:"The title for close browser tabs setting that allows people to choose whether or not the app should close the 'opening in desktop app' tabs.",defaultMessage:"Close redirecting browser tabs"}),c=n()(g.FormattedMessage,{id:"openInDesktopAppSettings.closeBrowserTabs.caption",description:"The caption for close browser tabs setting that allows people to choose whether or not the app should close the 'opening in desktop app' tabs.",defaultMessage:'When opening links in the desktop app, close "Redirecting to your Notion app..." browser tabs.'});return n()(q.Z,{isMobile:!1,title:l,caption:c,type:"toggle",isOn:o,onToggle:i})}function Ve(){window.__c={n:"OpenInDesktopAppSetting"};const e=(0,a.O7)(),{isElectron:t}=(0,a.Fy)(),o=(0,s.VK)((()=>D.Z.state),[]),i=n()(g.FormattedMessage,{id:"openInDesktopAppSetting.title",defaultMessage:"Open links in desktop app",description:"The title for the setting toggle that enables desktop deep-linking."}),r=(0,s.VK)((()=>V.Z.state.highlightedSetting===V.R.OpenInDesktopApp),[]);if(t)return n()(q.Z,{isMobile:!1,title:i,caption:n()(g.FormattedMessage,{id:"openInDesktopAppSetting.desktopConfigureCaption",defaultMessage:"You can configure browser links to open in this app.",description:"You can only configure deep-linking from the browser. On the desktop app, we show this caption."}),type:"custom",customButton:n()(oe.Z,{href:(0,C.H)(ncd.href()),external:!0,onClick:()=>{h.trackConfigureOpenInDesktopApp(e)}},void 0,n()(ee.Z,{},void 0,n()(g.FormattedMessage,{id:"openInDesktopAppSetting.desktopConfigureButton",defaultMessage:"Configure",description:"You can only configure deep-linking from the browser. On the desktop app, they can click this button."})))});return n()(q.Z,{isMobile:!1,title:i,caption:n()(g.FormattedMessage,{id:"openInDesktopAppSetting.description.messageWindows",defaultMessage:"You must have the <desktopapplink>Mac or Windows app</desktopapplink> installed",description:"A supplemental caption for the setting toggle that enables desktop deep-linking.",values:{desktopapplink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return n()(se.Z,{external:!0,href:d.AR.desktop,onClick:e=>{e.stopPropagation()}},void 0,t)}}}),type:"toggle",isOn:"always"===o,onToggle:()=>{const t="always"===o?"never":"always";D.Z.setState(t),"always"===t&&y.openInNativeApp({url:(0,C.W)(ncd.href()),environment:e}),h.trackToggleOpenInDesktopApp(e,{toggled_to:"always"===t?"on":"off"})},shouldHighlight:r})}function Ne(e){let{isMobile:t}=e;window.__c={n:"ViewHistorySettings"};const o=(0,a.O7)(),i=(0,s.VK)((()=>B.default.state.currentUserSettingsStore),[]),r=(0,s.VK)((()=>{var e;return!0===(null==i||null===(e=i.getSettings())||void 0===e?void 0:e.disable_page_analytics)?"do_not_record":"record"}),[i]);return n()(q.Z,{isMobile:t,title:n()(g.FormattedMessage,{id:"viewHistorySettings.title",defaultMessage:"Show my view history",description:"The title for the setting toggle that enables view history"}),caption:n()(g.FormattedMessage,{id:"viewHistorySettings.description.message",defaultMessage:"People with edit or full access will be able to see when you’ve viewed a page. <inlinelink>Learn more</inlinelink>.",description:"Caption for the setting toggle that enables view history",values:{inlinelink:e=>n()(se.Z,{external:!0,href:(0,T.UY)("guides.pageAnalytics")},void 0,e)}}),type:"dropdown",currentOption:r,options:[{key:"record",label:n()(g.FormattedMessage,{id:"viewHistorySettings.record.label",defaultMessage:"Record",description:"Option to record view history for page analytics"})},{key:"do_not_record",label:n()(g.FormattedMessage,{id:"viewHistorySettings.do_not_record.label",defaultMessage:"Don't record",description:"Option to not record view history for page analytics"})}],onSelectOption:e=>{const t="do_not_record"===e;S.createAndCommit({userAction:"ViewHistorySettings.onSelectOption",environment:o,perform:e=>{i&&w.d2({userSettingsStore:i,data:{disable_page_analytics:t},transaction:e})}}),k.track(o,t?"page_analytics_account_opt_out":"page_analytics_account_opt_in")}})}},75173:(e,t,o)=>{o.d(t,{Z:()=>_});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(31942),d=o(15157),p=o(32056),u=o(64434),m=o(30149),g=o(33929),h=o(60709),f=o(29798),v=o(12318),y=o(52275),b=o(68894),S=o(78140),w=o(9342),k=o(72495);class C extends l.Z{constructor(){super(...arguments),this.storeTypes={numberFormatFilterStore:v.default.of(""),menuListStore:f.Z},this.handleNumberFormatFilterChange=e=>{this.stores.numberFormatFilterStore.set(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.handleNumberFormatChange=e=>{const{collectionStore:t,property:o,schema:i,onClose:n}=this.props,r=i[o];if(!r)return;if("number"!==r.type&&"formula"!==r.type)return;const a={...r,number_format:e,show_as:void 0};"number"===r.type&&(0,p.b3)(e)&&d.Z.set({userId:this.environment.currentUser.id,key:C.localLastUsedCurrencyPreferenceKey,value:e}),m.createAndCommit({userAction:"NumberFormatMenu.handleNumberFormatChange",environment:this.environment,perform:e=>{u.xO({environment:this.environment,collectionStore:t,update:{[o]:a},transaction:e})}}),null==n||n()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:h.og.ActionSheet}:{menuType:h.og.Popup};const o=!e.isMobile&&a()(k.Z,{isInput:!0},void 0,a()(b.ZP,{value:this.stores.numberFormatFilterStore.get(),onChange:this.handleNumberFormatFilterChange,focus:!0,focusAfterAnimation:!0,placeholder:g.default.getIntl().formatMessage({defaultMessage:"Filter formats…",id:"blockPropertyValue.filterForNumberFormats.placeholder",description:"Placeholder text for input field that allows user to filter number format options including currencies"}),preventCaptureDeleteWhenEmpty:!0}));return s.createElement(S.Z,n()({},t,{header:o}),a()(w.Z,{type:w.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>s.createElement(k.Z,e),items:this.getMenuItems()}],store:this.stores.menuListStore}))}getMenuItems(){const e=d.Z.get({userId:this.environment.currentUser.id,key:C.localLastUsedCurrencyPreferenceKey});return(0,c.ZP)(this.stores.numberFormatFilterStore.get(),(0,p.jD)(e),(e=>e)).map((e=>({key:e,render:t=>this.renderMenuItem(e,t),action:()=>this.handleNumberFormatChange(e)})))}renderMenuItem(e,t){return s.createElement(y.Z,n()({},t,{title:(0,p.Bo)(g.default.getIntl(),e)}))}}C.displayName="NumberFormatMenu",C.localLastUsedCurrencyPreferenceKey="LastUsedCurrency";const _=C},56247:(e,t,o)=>{o.d(t,{b:()=>g});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=(o(67294),o(24405)),l=o(32056),c=o(63143),d=o(49616),p=o(33929),u=o(85248),m=o(78942);function g(e){window.__c={n:"NumberValue"};const{numberValue:t,numberFormat:o,numberShowAs:i,shouldRenderTooltip:r,style:g,ringSize:h}=e,f=(0,s.Fg)();if(a().isNaN(t)||c.z4(t))return null;const v=(null==i?void 0:i.showValue)??!0,y=v&&l.uf(t,o,p.default.getIntl());let b;if("bar"===(null==i?void 0:i.type)||"ring"===(null==i?void 0:i.type)){const a=l.IM(t,i.maxValue),s="default"===i.color?f.selectLightGray:f.accentColors[i.color],c="dark"===f.mode?s[500]:s[400],p=s[50],g="dark"===f.mode?s[200]:f.selectLightGray[200],y=r?d.X7({numberValue:t,numberFormat:o,numberShowAs:i}):void 0;b="bar"===i.type?n()(u.k,{percentage:a,filledColor:c,gapColor:p,unfilledColor:g,style:{marginLeft:v?8:0,...e.barStyle,...v?{}:{flexBasis:"100%"}},tooltip:y}):n()(m.e,{percentage:a,filledColor:c,gapColor:p,unfilledColor:g,size:h||20,style:{marginLeft:v?8:0},tooltip:y})}const S={display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",...g};return n()("div",{style:S},void 0,y,b)}},22541:(e,t,o)=>{o.d(t,{Z:()=>Z});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(480),p=o(81954),u=o(24405),m=o(3779),g=o(75934),h=o(5366),f=o(89858),v=o(74647),y=o(43250),b=o(35026),S=o(79315),w=o(64921),k=o(55118),C=o(59649),_=o(55094),M=o(14694);function T(e){window.__c={n:"EmptyChildrenPlaceholder"};const t=(0,d.Fy)(),o=(0,u.yK)((e=>({placeholder:{color:e.lightTextColor,paddingLeft:12,...t.isMobile&&{display:"flex",alignItems:"center",height:32}}})),[t]);return n()(M.Z,{style:e.itemStyle},void 0,n()("div",{style:o.placeholder},void 0,n()(h.FormattedMessage,{defaultMessage:"No pages inside",id:"outliner.NoPagesInside.placeholder"})))}function I(e){window.__c={n:"AddPageButton"};const{type:t}=e,o=(0,d.O7)(),{currentSpaceStore:i,currentSpaceViewStore:r}=(0,p.VK)((()=>S.default.state),[]),a=o.device.isMobile,s=(0,u.yK)((e=>({sidebarItem:{color:e.mediumTextColor}})),[]);if(!i||!r)return null;return n()(w.Z,{mobileFeedback:a,onClick:async()=>{if("team"===t)return;await f.kC({environment:o,spaceStore:i,spaceViewStore:r,type:t,prepend:!1,shouldPersistToggleState:!0})&&a&&v.close()}},void 0,n()(M.Z,{style:s.sidebarItem,left:n()(B,{}),disableMobileBorder:!0},void 0,n()(h.FormattedMessage,{defaultMessage:"Add a page",description:"When a sidebar section is empty, show a link under the section to quickly add a new page",id:"sidebar.addAWorkspaceOrPrivatePage.tooltip"})))}function P(e){window.__c={n:"PageItem"};const{store:t,index:o}=e;return n()(_.ZP,{type:e.type,store:t,style:e.itemStyle,toggleStyle:e.itemToggleStyle,itemIndex:o,itemDepth:e.itemDepth,parentStore:t.getRecordStoreUIParent(),onItemClick:e.onItemClick,onNavigate:e.onNavigate,disabled:e.disabled},t.id)}function x(e){window.__c={n:"EmptyDroppable"};const t=(0,d.O7)(),{type:o,parentStore:i}=e,r=l().compact(["OutlinerItem",o,null==i?void 0:i.id]).join("_");return n()(k.G,{dropTargetKey:r,canDropBelow:!0,onSelectableDrop:async e=>{await f.NP({dropArgs:e,environment:t,type:o,isTopLevel:!0,parentStore:i})},shouldShowDropZone:!0,canAcceptDrop:e=>{const{currentSpaceStore:o}=S.default.state;return!!o&&(0,b.Pl)({environment:t,draggingStores:e.draggingStores,parentStore:i,currentSpaceStore:o})}})}function B(){window.__c={n:"PlusIcon"};const e=(0,u.yK)((e=>({icon:{fill:e.mediumIconColor,width:16,height:16},iconContainer:{display:"flex",alignItems:"center",justifyContent:"center"}})),[]);return n()("div",{style:e.iconContainer},void 0,m.Z.plusThick(e.icon))}const Z=function(e){window.__c={n:"Outliner"};const{disabled:t,childStores:o,areChildrenLoading:i,itemDepth:r,type:s}=e,l=(0,d.Fy)(),p=o.map(((t,o)=>c.createElement(P,a()({},e,{key:t.id,store:t,index:o})))),u=0===r,m=0===p.length,h=(m||e.isHeaderless||l.isMobile)&&u&&("private"===s||"workspace"===s)&&!t,f=m&&!h&&!u,v={offline:y.blN,bookmarks:y.fe0,workspace:y.BEs,shared:y.JkF,private:y.q1J,team:y.l24,[g.PT]:void 0,[g.cz]:void 0,[g.mu]:void 0,[g.kg]:void 0}[e.type];return n()(C.Z,{style:e.style,className:v,loaded:!i,showSpinnerTimeout:3e3,spinnerSize:"1em"},void 0,p,m&&u&&n()(x,{type:e.type,parentStore:e.parentStore}),h&&n()(I,{type:e.type}),f&&n()(T,{itemStyle:e.itemStyle}))}},55094:(e,t,o)=>{o.d(t,{gZ:()=>Ae,aZ:()=>De,ZP:()=>Fe});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(33125),c=o(41432),d=o(15157),p=o(21202),u=o(82990),m=o(89858),g=o(35026),h=o(50659),f=o(45094),v=o(52315),y=o(81844),b=o(79315),S=o(49085);class w extends S.Z{getInitialState(){return{open:!1,hovered:!1,focused:!1}}}const k=w;var C=o(3815),_=o(26664),M=o(70935),T=o(86671),I=o(480),P=o(81954),x=o(24405),B=o(15145),Z=o(50906),E=o(93959),R=o(84210),A=o(98165),D=o(23537),F=o(80796),L=o(39218),V=o(84076),N=o(68785),O=o(76798),U=o(13243),H=o(5366),z=o(9953),W=o(30149),j=o(31278),K=o(58032);function Y(e){window.__c={n:"OutlinerItemIcon"};const{targetStore:t,canEditItem:o}=e,i=(0,I.O7)(),{isMobile:r}=i.device,l=(0,P.VK)((()=>t.getIcon()),[t]),c=(0,P.VK)((()=>!r&&o&&!t.isLocked()),[r,o,t]),d=(0,P.VK)((()=>{var e;return null===(e=t.getIconStore())||void 0===e?void 0:e.table}),[t]),p=(0,x.yK)((e=>({pageIcon:{fill:e.mediumIconColor}})),[]),u=e=>{const o=t.getIconStore();o&&W.createAndCommit({userAction:"OutlinerItem.handleRecordIconChange",environment:i,perform:t=>{z.sO({store:o,value:e,transaction:t})}})};return a()(K.Z,{renderTooltip:()=>a()(H.FormattedMessage,{defaultMessage:"Change icon",id:"sidebarItem.changeIconButton.tooltip"}),placement:K.Z.Placement.Bottom,render:e=>{var o;return c?s.createElement(j.Z,n()({bucket:"secure",disabled:!1,icon:l,store:t,title:void 0,isEmptyPage:t.isEmptyPage(),size:r?24:20,onChange:u,pageIconStyle:p.pageIcon},e,{largeIcon:!0,iconLoggingData:{recordTable:d,source:"sidebar",block_type:t.getType(),collection_id:"collection"===d?null===(o=t.getIconStore())||void 0===o?void 0:o.id:void 0}})):a()(j.Z,{disabled:!0,icon:l,title:void 0,isEmptyPage:t.isEmptyPage(),size:r?24:20,pageIconStyle:p.pageIcon,largeIcon:!0})}})}var G=o(5210);function X(e){window.__c={n:"OutlinerItemLeftToggleButton"};const{store:t,outlinerItemStore:o,targetStore:i,type:n,itemIndex:r,itemDepth:s}=e,l=(0,I.O7)(),{isMobile:c}=l.device,d=(0,P.VK)((()=>o.state.open),[o]),p=(0,P.VK)((()=>{if((0,D.ku)()){const e=Boolean(null==i?void 0:i.isCollectionView()),o=g.Yz(t).length>0;return e||o}return!0}),[t,i]),u=(0,x.yK)((e=>({hiddenToggle:{width:(0,G.q)({isMobile:c,isSidebar:!0})},toggle:{color:e.lightIconColor}})),[c]);if(!p)return a()("div",{style:u.hiddenToggle});return a()(G.Z,{isSidebar:!0,fill:!0,icon:"chevron",open:Boolean(d),color:u.toggle.color,onClick:()=>{const e=0===s,i=A.VP(t);Z.trackOutlinerItemToggle(l,{teamStore:i,type:e?"top_level":"nested",is_toggled:!d,outliner_type:n,outliner_position:r,outliner_depth:s}),g.Ps({store:t,toggleStore:o,toOpen:!d,environment:l,isTopLevelItem:e})}})}var q=o(3779),$=o(6404),J=o(24677),Q=o(74647),ee=o(21325),te=o(33929),oe=o(60709),ie=o(98742),ne=o(75024),re=o(64921),ae=o(52275),se=o(31945),le=o(78140),ce=o(9342),de=o(40721),pe=o(72495);const ue=(0,H.defineMessages)({addAPageInside:{defaultMessage:"Quickly add a page inside",id:"sidebarItem.addAPageInside.tooltip"}});function me(e){window.__c={n:"OutlinerItemRightIcons"};const{store:t,outlinerItemStore:o,canEditItem:i,itemDepth:n}=e,{isMobile:r}=(0,I.Fy)(),s=(0,P.VK)((()=>r||o.state.hovered||o.state.focused),[r,o]),l=(0,P.VK)((()=>{var e;const o=Boolean(t.getAppContainerBlockStore()),n=null===(e=t.getCollectionViewCollectionStore())||void 0===e?void 0:e.isSyncedCollection();return Boolean(t.getType()&&i&&!o&&!n)}),[t,i]),c=(0,x.yK)((()=>({iconContainer:{display:"flex",paddingLeft:3,...s?{}:{...ne.jy,display:"block"}}})),[s]);return a()("div",{style:c.iconContainer},void 0,a()(ve,{store:t,type:e.type,itemIndex:e.itemIndex,itemDepth:n}),l&&a()(ge,{store:t,outlinerItemStore:o,isTopLevelItem:0===n}))}function ge(e){window.__c={n:"AddPageButton"};const{store:t,outlinerItemStore:o,isTopLevelItem:i}=e,n=(0,I.O7)(),{isMobile:r}=n.device,s=(0,P.VK)((()=>t.getLinkedViewCollectionBlockStores()),[t]),l=te.default.formatMessage(ue.addAPageInside);return s.length<=1?a()(K.Z,{renderTooltip:()=>l,placement:K.Z.Placement.Bottom,render:e=>{const r={...e,onClick:()=>{ye({store:t,outlinerItemStore:o,sourceStore:s[0]??t,shouldNavigateToSource:!1,environment:n,isTopLevelItem:i})}};return a()(he,{events:r})}}):a()(K.Z,{renderTooltip:()=>l,placement:K.Z.Placement.Bottom,render:e=>a()(se.Z,{popupType:r?se.Z.PopupType.SlideUp:se.Z.PopupType.Popup,renderOrigin:t=>a()(he,{events:(0,ie.Z)(e,t)}),render:e=>a()(fe,{store:t,outlinerItemStore:o,parent:e,isTopLevelItem:i})})})}function he(e){window.__c={n:"AddPageButtonInternal"};const{isMobile:t}=(0,I.Fy)(),o=(0,x.yK)((e=>({button:{display:"flex",alignItems:"center",justifyContent:"center",width:t?32:20,height:t?32:20,borderRadius:3,marginLeft:t?0:4},buttonIcon:{fill:t?e.lightIconColor:e.sidebarTextColor,width:t?18:14}})),[t]);return s.createElement(re.Z,n()({ariaLabel:te.default.formatMessage(ue.addAPageInside),mobileFeedback:t,style:o.button},e.events),q.Z.plusThick(o.buttonIcon))}function fe(e){window.__c={n:"AddToCollectionViewMenu"};const{store:t,outlinerItemStore:o,parent:i,isTopLevelItem:r}=e,l=(0,I.O7)(),{isMobile:c}=l.device,d=(0,P.VK)((()=>t.getLinkedViewCollectionBlockStores()),[t]),p=(0,x.yK)((()=>({menuItem:{display:"flex",alignItems:"center",whiteSpace:"pre"}})),[]),u={menuType:c?oe.og.Modal:oe.og.Popup,right:c?a()(de.DoneMenuText,{}):void 0},m={key:"collections",render:e=>s.createElement(pe.Z,n()({},e,{title:a()(H.FormattedMessage,{defaultMessage:"Add to",id:"sidebarItem.addAPageInside.popup.addTo",description:"Title for the add to a specific database menu item"})})),items:d.map((e=>({key:e.id,render:t=>s.createElement(ae.Z,n()({},t,{title:a()("div",{style:p.menuItem},void 0,a()(O.Z,{store:e})),icon:a()(j.Z,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:14})})),action:()=>{ye({store:e,outlinerItemStore:o,sourceStore:e,shouldNavigateToSource:!0,environment:l,isTopLevelItem:r})}})))};return s.createElement(le.Z,u,a()(ce.Z,{type:ce.i.Vertical,onAccept:i.close,initialFocus:void 0,sections:[m]}))}function ve(e){window.__c={n:"MenuButton"};const{store:t,type:o,itemDepth:i,itemIndex:r}=e,l=(0,I.O7)(),{isMobile:c}=l.device,d=(0,P.VK)((()=>g.wS(t)),[t]),p=(0,x.yK)((e=>({button:{display:"flex",alignItems:"center",justifyContent:"center",width:c?32:20,height:c?32:20,borderRadius:3},buttonIcon:{fill:c?e.lightIconColor:e.sidebarTextColor,width:c?18:14}})),[c]),u=e=>{const n=A.VP(t);J.Ys({environment:l,store:t}),$.Qn({environment:l,stores:d,left:e.clientX,top:e.clientY,showInput:!1,actions:g.Zq(t),analyticsFrom:"sidebar_more_menu",optionalAnalyticsProperties:{teamStore:n,type:0===i?"top_level":"nested",outliner_type:o,outliner_position:r,outliner_depth:i}})};return a()(K.Z,{renderTooltip:()=>a()(H.FormattedMessage,"bookmarks"===o?{defaultMessage:"Remove, rename, and more…",id:"sidebarItem.favoritedPageMenuButton.tooltip",description:"Tooltip text for 3-dot menu on favorited pages in the sidebar."}:{defaultMessage:"Delete, duplicate, and more…",id:"sidebarItem.pageMenuButton.tooltip",description:"Tooltip text for 3-dot menu on pages in the sidebar."}),placement:K.Z.Placement.Bottom,render:e=>s.createElement(re.Z,n()({mobileFeedback:c,style:p.button,onClick:u},e),q.Z.dots(p.buttonIcon))})}function ye(e){const{store:t,outlinerItemStore:o,sourceStore:i,shouldNavigateToSource:n,environment:r,isTopLevelItem:a}=e;ee.M_(r)&&(r.device.isMobile&&Q.close(),W.createAndCommit({userAction:"OutlinerItem.createdPage",environment:r,perform:e=>m.D0({environment:r,store:i,transaction:e,navigateToParent:n})}),t.isCollectionView()||g.Ps({store:t,toggleStore:o,toOpen:!0,environment:r,isTopLevelItem:a}))}var be=o(14694);function Se(e){window.__c={n:"BlockSidebarItem"};const{store:t,outlinerItemStore:o,style:i,targetStore:r,itemDepth:l}=e,c=(0,I.O7)(),d=c.device.isMobile,p=(0,P.VK)((()=>"copy_indicator"===t.getType()),[t]),m=(0,P.VK)((()=>function(e){if(!e)return;if(e.isNavigableBlock())return(0,R.pB)({store:e,fullyQualified:!1},{[B.$X]:B.tY.Sidebar});{const t=A.Dg(e);if(t)return(0,R.pB)({store:t,scrollToBlockId:e.id,fullyQualified:!1},{[B.$X]:B.tY.Sidebar})}}(r)),[r]),f=(0,P.VK)((()=>p&&L.transactionQueue.isPendingTransactionForRecord(t.pointer)),[p,t]),v=(0,P.VK)((()=>{const{mainEditorCurrentBlockStore:e}=b.default.state;return e&&t.id===e.id}),[t]),{isDeselectedCurrentPage:y,showSelectedState:S}=(0,P.VK)((()=>{const e=g.Kx(t),o=M.Z.isInBulkSelectSession();return{isDeselectedCurrentPage:v&&!e&&o,showSelectedState:v||e}}),[v,t]),w=(0,x.yK)((e=>({sidebarItem:{...!d&&{paddingLeft:5},...y&&{opacity:"50%"},...v&&{fontWeight:u.Z.fontWeight.semibold},...S&&{background:e.sidebarItemSelectedBackground,color:e.regularTextColor,...d&&{boxShadow:`\n                            0 1px 0 ${e.buttonHoveredBackground}\n                        `}},...(0,h.Z3)({isMobile:d}),...i},children:{display:"flex",alignItems:"center"},loadingSpinner:{marginLeft:6},moveOrDuplicateProgress:{flex:1,marginLeft:d?10:6,marginRight:d?12:void 0},link:{width:"100%"}})),[d,y,v,S,i]);if(p)return f?a()(be.Z,{style:w.sidebarItem,childrenStyle:w.children,onFocus:ke(o),onBlur:Ce(o),onMouseMove:_e(o),onMouseLeave:Me(o)},void 0,a()(N.Z,{style:w.loadingSpinner}),a()(U.Z,{targetRecordId:t.id,style:w.moveOrDuplicateProgress})):null;if(m){const o=()=>{const o=A.VP(t);Z.trackClickOutlinerItem(c,{teamStore:o,type:0===l?"top_level":"nested",outliner_type:e.type,outliner_position:e.itemIndex,outliner_depth:l}),e.onNavigate&&e.onNavigate(t)};return a()(V.Z,{style:w.link,href:m,onClick:o,innerStyle:(0,h.G$)({isMobile:d})},void 0,s.createElement(we,n()({},e,{sidebarItemStyle:w.sidebarItem,sidebarItemChildrenStyle:w.children})))}return s.createElement(we,n()({},e,{sidebarItemStyle:w.sidebarItem,sidebarItemChildrenStyle:w.children}))}function we(e){window.__c={n:"SidebarItemContainer"};const{store:t,parentStore:o,outlinerItemStore:i,targetStore:n,itemDepth:r,type:s}=e,l=(0,P.VK)((()=>function(e){const{store:t,parentStore:o,isTopLevelItem:i,type:n}=e;if(t.isDefined()&&(0,E.h7)(t))return!1;if(t.isCollectionView()&&!(0,D.bq)())return!t.getCollectionViewSourceCollectionStore();if("block"===(null==o?void 0:o.table)){if(C.G.createChildStore(o,{table:p.iU,id:o.id,spaceId:t.getSpaceId()}).isType("collection_view_page"))return!1}if(t.isDefined()&&t.getType()===c.Ti.alias)return!0;if(i&&"team"!==n)return!1;if(!o)return!1;if(t.isDefined())return t.getParentId()!==o.id;return!1}({store:t,parentStore:o,isTopLevelItem:0===r,type:s})),[t,o,r,s]);return a()(be.Z,{style:e.sidebarItemStyle,childrenStyle:e.sidebarItemChildrenStyle,left:a()(X,{store:t,outlinerItemStore:i,targetStore:n,type:s,itemIndex:e.itemIndex,itemDepth:r}),icon:n&&a()(Y,{targetStore:n,canEditItem:e.canEditItem}),right:a()(me,{store:t,outlinerItemStore:i,type:s,itemIndex:e.itemIndex,itemDepth:r,canEditItem:e.canEditItem}),onFocus:ke(i),onBlur:Ce(i),onMouseMove:_e(i),onMouseLeave:Me(i),onClick:o=>{var i;return null===(i=e.onItemClick)||void 0===i?void 0:i.call(e,t,o)},isAlias:l},void 0,a()(O.Z,{store:t}))}function ke(e){return t=>{e.update((e=>({...e,focused:!0})))}}function Ce(e){return t=>{e.update((e=>({...e,focused:!1})))}}function _e(e){return t=>{F.Z.state.isDragging||e.update((e=>({...e,hovered:!0})))}}function Me(e){return t=>{e.update((e=>({...e,hovered:!1})))}}var Te=o(12534),Ie=o(45669),Pe=o(22541);function xe(e){window.__c={n:"CollectionViewOutlinerItem"};const{store:t,collectionViewStore:o,onNavigate:i}=e,n=(0,I.O7)(),r=(0,P.VK)((()=>M.Z.isInBulkSelectSession()),[]),s=(0,P.VK)((()=>t.getCollectionViewStores().some((e=>"page"===e.getType()))),[t]),l=(0,P.VK)((()=>{const{mainEditorCurrentBlockStore:e,currentCollectionViewStore:i}=b.default.state;return!s&&Boolean(e&&t.id===e.id&&i&&i.id===o.id)}),[o.id,t.id,s]),c=(0,P.VK)((()=>M.Z.isSelected(t)),[t]),d=l&&!c&&r,p=l||c,m=(0,x.yK)((t=>({initialIcon:{fontSize:12,fontWeight:500,marginLeft:5,color:t.mediumTextColor},sideBarItem:{...d&&{opacity:"50%"},...l&&{fontWeight:u.Z.fontWeight.semibold},...p&&{background:t.buttonHoveredBackground,color:t.regularTextColor,...n.device.isMobile&&{boxShadow:`\n\t\t\t\t\t\t0 1px 0 ${t.buttonHoveredBackground}\n\t\t\t\t\t`}},...e.style}})),[n.device.isMobile,l,d,e.style,p]),f=(0,P.VK)((()=>(0,R.ZP)({store:t,fullyQualified:!1,collectionViewId:o.id})),[o.id,t]),y=(0,P.VK)((()=>({ready:o.isReady(),type:o.getType(),pagePointer:o.getFormat().page_pointer,name:o.getName()})),[o]),S=(0,P.VK)((()=>{if("page"!==y.type||!y.pagePointer)return null;const e=C.G.createChildStore(t,{table:y.pagePointer.table,id:y.pagePointer.id}),o=(0,g.Q2)(e);return{pageStore:e,ready:(0,v.b)(e),outlinerItems:o}}),[y,t]);if(!y.ready)return null;if("page"===y.type&&S){const{ready:o,outlinerItems:i}=S;return a()(Pe.Z,{type:e.type,childStores:i,areChildrenLoading:!o,itemDepth:e.itemDepth+1,parentStore:t.getContentStore(),itemStyle:m.sideBarItem,itemToggleStyle:e.itemToggleStyle,onNavigate:e.onNavigate,disabled:e.disabled,onItemClick:e.onItemClick})}return s?null:a()(V.Z,{href:f,style:{width:"100%"},innerStyle:(0,h.G$)({isMobile:n.device.isMobile}),onClick:()=>{i&&i(t)}},void 0,a()(be.Z,{icon:a()("div",{style:m.initialIcon},void 0,"•"),style:m.sideBarItem},void 0,a()(Ie.Z,{collectionViewName:y.name,collectionViewType:y.type??"table"})))}function Be(e){window.__c={n:"CollectionViewOutliner"};const{store:t}=e,o=(0,P.VK)((()=>t.getCollectionViewStores()),[t]);return a()("div",{onContextMenu:e=>{e.preventDefault(),(0,Te.ZP)({event:e,context:Te.Af.EditorContextMenu,callback:()=>{}})}},void 0,o.map((o=>a()(xe,{store:t,collectionViewStore:o,style:e.itemStyle,onNavigate:e.onNavigate,type:e.type,itemDepth:e.itemDepth,disabled:e.disabled,childStores:e.childStores},o.id))))}var Ze=o(66094);function Ee(e){return 0===e}class Re extends T.Z{constructor(){super(...arguments),this.storeTypes={outlinerItemStore:k},this.isCurrentPage=this.createComputedStore((()=>{const{store:e}=this.props,{mainEditorCurrentBlockStore:t}=b.default.state;return t&&e.id===t.id})),this.isInBulkSelectSession=this.createComputedStore((()=>M.Z.isInBulkSelectSession())),this.handleDrop=async e=>{const{droppedDirection:t,droppedStores:o,duplicate:i}=e,{store:n,type:r,itemDepth:a,parentStore:s}=this.props;s&&await m.v9({environment:this.environment,type:r,targetParentStore:s,targetStore:n,isTopLevelItem:Ee(a),droppedDirection:t,droppedStores:o,duplicate:i})},this.handleInsertAbove=e=>{const{store:t,type:o}=this.props;return m.LR({environment:this.environment,store:t,insertStores:e.insertStores,parentStore:e.parentStore,before:!0,transaction:e.transaction,type:o})},this.handleInsertBelow=e=>{const{store:t,type:o}=this.props;return m.LR({environment:this.environment,store:t,insertStores:e.insertStores,parentStore:e.parentStore,before:!1,transaction:e.transaction,type:o})},this.handleRemove=e=>{const{store:t,type:o,itemDepth:i}=this.props,n=t.getRecordStoreUIParent();null!=n&&n.valueIs(_.i)&&m.A5({...e,type:o,targetStore:t,targetParentStore:n,isTopLevelItem:Ee(i)})}}toggleStore(){return this.stores.outlinerItemStore}didMount(){if(super.didMount(),this.shouldPersistToggleState()){const e=d.Z.get({userId:this.environment.currentUser.id,key:this.getLocalStoreKey()});this.stores.outlinerItemStore.setState({...this.stores.outlinerItemStore.state,open:e})}}renderPersisted(){const{store:e,itemIndex:t,parentStore:o}=this.props,i=0===t,r=f.Bb(e),l=this.canEdit()&&!e.isLinkedCollectionView(),c=r&&o?{onInsertBelow:e=>this.handleInsertBelow({...e,parentStore:o}),onInsertAbove:e=>this.handleInsertAbove({...e,parentStore:o})}:{};return s.createElement(Ze.Z,n()({analyticsName:"outliner_item",blockMenuActions:(0,g.Zq)(e),contextMenuAndDragStores:(0,g.wS)(e),canDrag:r,canDropAbove:i,canDropBelow:r,canDropOnto:l,canInsertBelow:r,canInsertAbove:r,canSelect:r,canTriggerContextMenu:!0,onRemove:this.handleRemove,onSelectableDrop:this.handleDrop,shouldShowDropZone:!0,showBlockMenuInput:!1,store:e},c),a()(Se,{store:e,outlinerItemStore:this.stores.outlinerItemStore,style:this.props.style,onItemClick:this.props.onItemClick,parentStore:o,type:this.props.type,itemIndex:this.props.itemIndex,itemDepth:this.props.itemDepth,onNavigate:this.props.onNavigate,targetStore:this.getTargetStore(),canEditItem:this.canEdit()}),this.shouldShowChildren()&&this.renderOutliner())}renderOutliner(){const{disabled:e,onItemClick:t,store:o,itemDepth:i}=this.props,n=this.getTargetStore();if(!n)return;if(n.isCollectionView())return a()(Be,{store:n,itemStyle:this.getSubOutlinerStyle(),onNavigate:this.props.onNavigate,type:this.props.type,childStores:(0,g.Yz)(o),areChildrenLoading:!1,itemDepth:i+1,parentStore:n.getContentStore(),itemToggleStyle:this.props.toggleStyle,disabled:e,onItemClick:t});const r=C.G.createChildStore(o,{table:p.iU,id:o.id}),s=!(0,v.b)(r);return a()(Pe.Z,{type:this.props.type,childStores:(0,g.Yz)(o),areChildrenLoading:s,itemDepth:i+1,parentStore:n.getContentStore(),itemStyle:this.getSubOutlinerStyle(),itemToggleStyle:this.props.toggleStyle,onNavigate:this.props.onNavigate,disabled:e,onItemClick:t})}shouldPersistToggleState(){return Ee(this.props.itemDepth)}shouldShowChildren(){return this.stores.outlinerItemStore.state.open}getLocalStoreKey(){const{store:e}=this.props;return`Outliner-${e.id}`}getTargetStore(){const{store:e}=this.props;if(e.getType()===c.Ti.alias){const t=e.getAliasTargetStore();return t instanceof C.G?t:void 0}return e}getPaddingLeftUnit(){const{isMobile:e}=this.environment.device;return e?De:14}getSidebarItemStyle(){const{device:e}=this.environment,t=this.isCurrentPage.state,o=(0,g.Kx)(this.props.store),i=this.isInBulkSelectSession.state,n=t&&!o&&i,r=t||o;return{...!e.isMobile&&{paddingLeft:5},...n&&{opacity:"50%"},...t&&{fontWeight:u.Z.fontWeight.semibold},...r&&{background:this.theme.sidebarItemSelectedBackground,color:this.theme.regularTextColor,...e.isMobile&&{boxShadow:`\n\t\t\t\t\t\t0 1px 0 ${this.theme.buttonHoveredBackground}\n\t\t\t\t\t`}},...(0,h.Z3)({isMobile:e.isMobile}),...this.props.style}}getSubOutlinerStyle(){const e={...this.props.style},t=this.getSidebarItemStyle(),o="number"==typeof t.paddingLeft?t.paddingLeft:this.getInitialPaddingLeft();return e.paddingLeft=o+this.getPaddingLeftUnit(),e}getInitialPaddingLeft(){const{isMobile:e}=this.environment.device;return e?Ae:14}}const Ae=6,De=22,Fe=function(e){window.__c={n:"OutlinerItem"};const{store:t,parentStore:o,type:i,itemDepth:r}=e,a=Ee(r),c=(0,s.useRef)(null);return(0,l.c)(y.Z,(()=>({store:t,parentStore:o,type:i,isTopLevelItem:a,getNode:()=>{var e;return(null===(e=c.current)||void 0===e?void 0:e.getNode())||null}})),[t,o,i,a]),s.createElement(Re,n()({ref:c},e))}},62151:(e,t,o)=>{o.d(t,{Z:()=>he});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(1302),u=o(3779),m=o(15157),g=o(75934),h=o(97880),f=o(82990),v=o(5366),y=o(89858),b=o(24677),S=o(37190),w=o(57688),k=o(89971),C=o(59389),_=o(98104),M=o(30149),T=o(43250),I=o(98742),P=o(50659);var x=o(79315),B=o(31792),Z=o(70704),E=o(64921),R=o(58032),A=o(480),D=o(81954),F=o(24405),L=o(8848),V=o(50906),N=o(12534),O=o(35026),U=o(92350),H=o(77907),z=o(3418),W=o(42185),j=o(33052),K=o(30016),Y=o(31945),G=o(55118),X=o(11913),q=o(5210);const $=function(e){window.__c={n:"TeamCaratSwitcher"};const{outlinerToggleButtonStore:t,isHovered:o,outlinerTeamOnToggle:i,style:n}=e,r=(0,F.Fg)(),s=(0,F.yK)((()=>({caratContainer:{minHeight:20,minWidth:20,...n||{}}})),[n]),l=(0,D.VK)((()=>t.state.isHidden),[t]);return a()("div",{style:s.caratContainer},void 0,o&&a()(q.Z,{isSidebar:!0,fill:!0,icon:"chevron",open:!l,color:r.lightIconColor,onClick:i,disabled:!0}))};var J=o(30040),Q=o(19889),ee=o(64684),te=o(23537),oe=o(3815),ie=o(29302);function ne(e){const t=(0,A.O7)(),[o,i]=(0,c.useState)(!1),{teamStore:r,spaceStore:s,teamOutlinerType:l}=e,{isReady:d,allMembersUserIds:p,userStores:u}=(0,D.VK)((()=>{const e=(0,te.tO)({teamStore:r,spaceStore:s}),t=e.map((e=>oe.U6.createChildStore(r,{table:Q.KJ,id:e}))),o=t&&t.every((e=>e.isReady()));return{allMembersUserIds:e,userStores:t,isReady:o}}),[r,s]),{ownerStores:m,memberStores:g}=(0,D.VK)((()=>{const e=[],t=[];if(!r.isReady())return{ownerStores:e,memberStores:t};for(const o of u){(null==o?void 0:o.id)&&((0,ee.pd)({membership:r.getMembers()},null==o?void 0:o.id)?e.push(o):t.push(o))}return{ownerStores:e,memberStores:t}}),[r,u]),h=(0,F.yK)((e=>({membershipSection:{display:"flex",flexDirection:"row",fontSize:14,alignItems:"center",whiteSpace:"nowrap"},members:{display:"flex",alignItems:"center",position:"relative",flexDirection:"row-reverse",marginRight:10,marginLeft:5},avatar:{width:23,height:23,borderRadius:23,marginRight:-5,position:"relative"},teamMemberTooltipSectionLabel:{color:e.mediumInvertedTextColor,fontSize:10,textTransform:"uppercase",letterSpacing:"0.015em"},teamMemberList:{paddingTop:3},moreMessage:{marginLeft:2,marginTop:4,color:e.mediumInvertedTextColor}})),[]);let f=0,y=u;return y=[...m,...g],u.length>5&&(f=u.length-5,y=y.slice(0,5)),d?a()("div",{style:h.membershipSection},void 0,a()(R.Z,{placement:R.Z.Placement.Bottom,disableTooltip:p.length<=0,render:t=>{return c.createElement("span",n()({},t,{style:e.renderStyle}),p.length," ",(o=p.length,a()(v.FormattedMessage,o>1?{defaultMessage:"members",id:"teamBrowser.teamCard.MembershipPlural"}:{defaultMessage:"member",id:"teamBrowser.teamCard.Membership"})));var o},renderTooltip:e=>(o||(i(!0),V.trackTeamBrowserHoverMemberList(t,{teamStore:r,outliner_type:l})),c.createElement("div",e,a()("div",{style:{marginBottom:4}},void 0,y.map((e=>a()(ie.Z,{style:h.teamMemberList,userStore:e,avatarSize:18}))),f>0&&a()("div",{style:h.moreMessage},void 0,a()(v.FormattedMessage,{id:"teamMembersList.tooltip.overflowMessage",defaultMessage:"{countRemainingUsers} more…",description:"Text saying there a number of users in addition to the ones shown.",values:{countRemainingUsers:f}})))))})):null}var re=o(93686),ae=o(74647),se=o(4708),le=o(61766),ce=o(15189);function de(e){let{teamStore:t,from:o,outlinerToggleButtonStore:i,shouldPersistToggleState:r}=e;window.__c={n:"OutlinerTeamToggleAddPageButton"};const s=(0,A.Fy)(),l=(0,A.O7)(),d=(0,D.qz)(void 0,le.Z),p=(0,D.VK)((()=>(0,se.Kx)()),[]),m=(0,c.useCallback)((()=>{const{currentSpaceStore:e,currentSpaceViewStore:n}=x.default.state;e&&n&&((0,se._A)(),"control"===p?(y.mv({environment:l,from:o,spaceStore:e,spaceViewStore:n,teamStore:t,outlinerToggleButtonStore:i,shouldPersistToggleState:r,andNavigate:!0,appendOrPrepend:"append"}),s.isMobile&&ae.close()):V.trackClickOutlinerTeamNewPage(l,{from:"sidebar_team_new_page"}))}),[s.isMobile,l,o,p,i,r,t]),g=function(){const e=(0,A.Fy)(),t=e.isMobile?32:20;return(0,F.yK)((o=>({button:{height:t,width:t,border:"none",borderRadius:3,marginLeft:e.isMobile?0:4},mediumText:{color:o.mediumInvertedTextColor},plusIcon:{fill:e.isMobile?o.lightIconColor:o.sidebarTextColor,...e.isMobile?{width:18,height:18}:{width:14,height:14}},plusIconContainer:{display:"flex",alignItems:"center",justifyContent:"center",color:o.legacyRedSelectColor,height:t,width:t},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,height:20,width:20},menuItemButton:{minWidth:200},caption:{minWidth:230}})),[e.isMobile,t])}();return a()(Y.Z,{popupType:Y.Z.PopupType.Popup,buttonPopupStore:d,alignmentToOrigin:Y.Z.Alignment.Start,originGap:2,disablePopup:"control"===p,onClick:m,renderOrigin:e=>a()(R.Z,{textWrap:!1,renderTooltip:()=>c.createElement(c.Fragment,null,a()(v.FormattedMessage,"control"===p?{id:"sidebar.addAPageButtonTeamToggle.tooltip",defaultMessage:"Add a page",description:"Tooltip shown when hovering on the plus icon button in the sidebar teamspace toggle, indicating the action is to add a page."}:{id:"sidebar.addAPageOrTemplateButtonTeamToggle.tooltip",defaultMessage:"Add a page or template",description:"Tooltip shown when hovering on the plus icon button in the sidebar teamspace toggle, indicating the action is to add a page or template."})),placement:R.Z.Placement.Bottom,render:t=>c.createElement(E.Z,n()({style:g.button},(0,I.Z)(t,e)),a()("div",{style:g.plusIconContainer},void 0,u.Z.plusThick(g.plusIcon)))}),render:e=>a()(ce.Z,{teamStore:t,closePopup:e.close,from:"sidebar_team_new_page"})})}function pe(e){window.__c={n:"OutlinerTeamToggleButton"};const{teamStore:t,label:o,isHovered:i,outlinerToggleButtonStore:r,shouldPersistToggleState:s,teamOutlinerType:l,outlinerTeamOnToggle:d,onTeamJoinComplete:p}=e,m=(0,A.Fy)().isMobile,b=function(e){switch(e){case g.cz:case g.mu:return!0;case g.PT:case g.kg:return!1;default:(0,h.t1)(e)}}(l),S=(0,A.O7)(),{name:k,showAddPageButton:C}=(0,D.VK)((()=>({name:t.getName(),showAddPageButton:t.canAddOrRemoveTopLevelPages()})),[t]),_=(0,U.e4)(t),M=(0,U.s9)(t),T=(0,U.KR)(t),I=(0,D.VK)((()=>x.default.state.currentSpaceStore),[]),[,,P]=(0,D.AF)(void 0,j.Z),B=(0,A.Fy)(),Z=(0,F.yK)((e=>({teamHighlightAnimationBackgroundContainer:{backgroundColor:L.ZP.frontTertiaryButtonBackgroundHovered,position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:-1,borderRadius:3},container:{position:"relative",display:"flex",alignItems:"center",minHeight:m?48:b?30:28,padding:b?"6px 12px":"0px 10px 0px 11px"},overflow:{marginLeft:5,justifySelf:"flex-end",height:22,display:"flex",alignItems:"center"},labelContainer:{flexShrink:1,flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",height:"100%",...f.Z.textOverflowStyle},labelText:{display:"flex",width:"100%",alignItems:"center",lineHeight:f.Z.lineHeight.UISmall.desktop,marginBottom:1,...f.Z.textOverflowStyle},membersCountText:{display:"flex",fontSize:12,fontWeight:f.Z.fontWeight.regular,lineHeight:1.3,color:e.lightTextColor,width:"100%",...f.Z.textOverflowStyle},joinedBadge:{color:e.darkTextColor,lineHeight:1.2,...f.Z.textOverflowStyle},joinedBadgeIcon:{display:"inline",color:e.darkTextColor,marginBottom:-1,marginRight:2,marginLeft:3,width:10,height:10},joinLeaveButton:{background:"none",color:e.mediumTextColor,fontSize:13,borderRadius:4,padding:"0px 4px",height:22},joinLeaveButtonHovered:{background:e.buttonHoveredBackground},unjoinedOverflowMenu:{display:"flex",height:22,marginLeft:8,marginRight:-6},teamIconContainer:{minHeight:20,minWidth:20,marginRight:9},closedTeamLabelContainer:{display:"flex"},closedTeamLabel:{display:"flex",alignItems:"center"},closedTeamTooltip:{whiteSpace:"normal",width:220}})),[m,b]),E=(0,D.VK)((()=>t.getTeamPagesStore()),[t]),q=(0,D.VK)((()=>W.Z.state===t.id),[t.id]),Q=(0,D.VK)((()=>t.getTeamAccessLevel()),[t]),[ee,te]=(0,c.useState)(void 0),oe=(0,c.useCallback)((e=>{let{draggingStores:t}=e;return!!I&&(0,O.Pl)({environment:S,draggingStores:t,parentStore:E,currentSpaceStore:I})}),[I,S,E]),ie=(0,c.useCallback)((async e=>{await y.NP({dropArgs:e,environment:S,type:"team",isTopLevel:!0,parentStore:E})}),[S,E]);if(!k)return null;const ae=!M,se=function(e,t){if(!t)return!1;switch(e){case g.mu:return!0;case g.PT:case g.kg:case g.cz:return!1;default:(0,h.t1)(e)}}(l,_),le=!B.isMobile&&!_&&"closed"===Q,ce=e=>{z.Z.addNamedPopup("team_more_actions"),V.trackOpenOutlinerTeamOverflow(S,{store:t,from:e})},pe=()=>{z.Z.removeNamedPopup("team_more_actions")};return a()(G.G,{dropTargetKey:w.Ui(t),canDropOnto:!e.isExpanded,shouldShowDropZone:!0,canAcceptDrop:oe,onSelectableDrop:ie},void 0,a()(Y.Z,{popupType:Y.Z.PopupType.Popup,alignmentToOrigin:Y.Z.Alignment.Start,placementToOrigin:Y.Z.Placement.Right,preventSlideUpTransition:!0,preventScaleTransition:!0,originRect:ee,render:e=>a()(X.m,{teamStore:t,permissionsInviteStore:P,onDismiss:e.close,from:"teamSidebar"}),renderOrigin:e=>{let{onClick:m}=e;return a()("div",{style:Z.container,onContextMenu:e=>{!B.isMobile&&(0,N.ZP)({event:e,context:N.Af.EditorContextMenu,callback:()=>{e.preventDefault(),te(new DOMRect(e.clientX,e.clientY)),m()}})}},void 0,B.isMobile&&a()($,{store:t,isHovered:!0,outlinerToggleButtonStore:r,outlinerTeamOnToggle:d}),a()("div",{style:Z.teamIconContainer},void 0,a()(re.p,{size:20,store:t,disabled:!0,style:{fontWeight:f.Z.fontWeight.medium}})),a()("div",{style:Z.labelContainer},void 0,a()("div",{style:Z.labelText},void 0,o,!B.isMobile&&a()($,{store:t,isHovered:i,outlinerToggleButtonStore:r,outlinerTeamOnToggle:d})),b&&void 0!==T&&a()("div",{style:Z.membersCountText},void 0,I&&a()(ne,{teamStore:t,spaceStore:I,renderStyle:Z.membersCountText,teamOutlinerType:l}),le&&a()(R.Z,{placement:R.Z.Placement.Bottom,renderTooltip:e=>c.createElement("div",n()({style:Z.closedTeamTooltip},e),function(e){let{accessLevel:t}=e;if("private"===t)return a()(v.FormattedMessage,{id:"teamJoinLeaveButton.joinTeam.privateTeamTooltip",defaultMessage:"You can only join a private teamspace with an invite from a member",description:"Tooltip help text that shows up when a user tries to join a teamspace where joining is disabled."})}({accessLevel:Q})),render:e=>c.createElement("div",n()({style:Z.closedTeamLabel},e)," ","·"," ",a()(v.FormattedMessage,{id:"outlinerTeamToggleButton.closedTeamLabel",defaultMessage:"Closed",description:"Subtitle label in a closed teamspace toggle button. It explains that a user can only join a closed teamspace by invitation."}))}),se&&c.createElement(c.Fragment,null,a()("span",{},void 0," ")," ·",a()("span",{},void 0,u.Z.circleCheck(Z.joinedBadgeIcon)),a()("span",{style:Z.joinedBadge},void 0,a()(v.FormattedMessage,{id:"outlinerTeamToggleButton.joinedBadge",description:"Badge that shows next to a team in the sidebar that the user has already joined.",defaultMessage:"Joined"}))))),i&&_&&a()("div",{style:Z.overflow},void 0,a()(X.o,{teamStore:t,from:l,onPopupClick:()=>ce(l),onPopupClose:pe}),C&&a()(de,{teamStore:t,outlinerToggleButtonStore:r,shouldPersistToggleState:s,from:ue(l)})),i&&!_&&a()("div",{style:Z.unjoinedOverflowMenu},void 0,a()(X.o,{teamStore:t,from:l,hideJoin:!0,onPopupClick:()=>ce(l),onPopupClose:pe})),!B.isMobile&&i&&ae&&a()(J.M,{style:Z.joinLeaveButton,hoveredStyle:Z.joinLeaveButtonHovered,teamStore:t,placement:R.Z.Placement.Right,from:"sidebar_team_modal",navigateToTeamHomeOnJoin:!0,onJoinedTeam:p}),C&&B.isMobile&&a()("div",{style:Z.overflow},void 0,a()(de,{teamStore:t,from:ue(l),outlinerToggleButtonStore:r,shouldPersistToggleState:s})),a()(K.Z,{isVisible:q,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{stiffness:30,damping:10,precision:.001},render:()=>a()("div",{style:Z.teamHighlightAnimationBackgroundContainer})}))},onClick:()=>ce("teamSidebar"),onClose:pe}),a()(H.LazyTeamPermissionsInviteWithModal,{permissionsInviteStore:P,store:t}))}function ue(e){switch(e){case g.cz:case g.PT:return"sidebar_team_section_browser";case g.mu:return"sidebar_team_section_browser_search";case g.kg:return"sidebar_team_section";default:(0,h.t1)(e)}}var me=o(14694);class ge extends d.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:B.Z,labelMouseStore:B.Z,outlinerToggleButtonStore:Z.Z},this.headerRef=c.createRef(),this.handleHideClick=()=>{const{isHidden:e}=this.getToggleButtonStore().state,t=!e;"team"===this.props.type?k.k7({environment:this.environment,spaceViewStore:this.props.spaceViewStore,teamStore:this.props.teamStore,outlinerToggleButtonStore:this.getToggleButtonStore(),newIsHidden:t,shouldPersistToggleState:this.props.shouldPersistToggleState,teamOutlinerType:this.props.teamOutlinerType,isExplicitUserAction:!0}):y.Eo({environment:this.environment,spaceViewStore:this.props.spaceViewStore,type:this.props.type,outlinerToggleButtonStore:this.getToggleButtonStore(),newIsHidden:t,shouldPersistToggleState:this.props.shouldPersistToggleState})},this.handleCreatePageClick=async e=>{const{type:t,spaceStore:o,spaceViewStore:i,shouldPersistToggleState:n}=this.props,{outlinerToggleButtonStore:r}=this.stores;if("team"!==t)if("private"===t&&"new-page-sidebar"===S.getShadowCursorCurrentElementName()){const e=y.kC({environment:this.environment,spaceStore:o,spaceViewStore:i,type:t,outlinerToggleButtonStore:r,prepend:!0,shouldPersistToggleState:n}),a=await e;p.default.afterNextFlush((()=>{a&&(M.createAndCommit({userAction:"outlinerToggleButton.shadowCursorStoreInit",environment:this.environment,perform:e=>C.eV({environment:this.environment,store:a,transaction:e})}),setTimeout((()=>{var e;const t=null===(e=x.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getContentStores()[0];t&&(b.eP({environment:this.environment,store:t}),_.NX({store:t.getBlockTitleStore()}));const{currentUserSettingsStore:o}=x.default.state;o&&S.pointToSupportedCursorElement(this.environment,{elementName:"new-page-blank-line",userSettingsStore:o})}),1e3))}))}else y.kC({environment:this.environment,spaceStore:o,spaceViewStore:i,type:t,outlinerToggleButtonStore:r,prepend:!0,shouldPersistToggleState:n})},this.handleCreateTeamClick=()=>{w.lo("sidebar_team_section")}}willMount(e){if(super.willMount(e),e.initialToggleState&&this.getToggleButtonStore().setState({...this.getToggleButtonStore().state,isHidden:"hidden"===e.initialToggleState}),!e.shouldPersistToggleState)return;const t="team"===e.type?k.RW(e.spaceViewStore,e.teamStore.id):y.B8(e.spaceViewStore,e.type),o=m.Z.get({userId:this.environment.currentUser.id,key:t});o&&this.getToggleButtonStore().setState({...this.getToggleButtonStore().state,isHidden:o})}renderComponent(){const{renderSidebar:e,isLastTeam:t,marginBottomOverrideWhenExpanded:o,marginBottomOverrideWhenCollapsed:i}=this.props,{isHidden:n}=this.getToggleButtonStore().state,r={bookmarks:T.F4o,workspace:T.j35,shared:T.MU2,private:T.aL4,offline:T.yNE,team:T.l24,[g.PT]:T.RG3,[g.cz]:T.Uwd,[g.mu]:T.jWx,[g.kg]:T.rIE}[this.props.type];return c.createElement("div",{ref:this.headerRef,onMouseMove:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1}),style:{marginBottom:n||t&&!this.environment.device.isMobile?i:o??ge.marginBottom,width:"100%"},className:`${r}-container`},this.renderLabel(r),!n&&e(this.headerRef))}renderRightLabel(){const{right:e,showAddButton:t}=this.props;return c.createElement(c.Fragment,null,e,t&&this.renderAddButton())}renderLabel(e){const{isMobile:t}=this.environment.device,{isHidden:o}=this.getToggleButtonStore().state,{labelMouseStore:i}=this.stores,{mouseEntered:r}=i.state,s=a()(v.FormattedMessage,o?{defaultMessage:"Click to show section",id:"sidebar.sectionHeaderShow.tooltip"}:{defaultMessage:"Click to hide section",id:"sidebar.sectionHeaderHide.tooltip"}),l={...t?this.getMobileSectionLabelStyle():this.getSectionLabelStyle(),transition:"color 100ms ease-out",..."team"===this.props.type?{width:"100%"}:{}};r&&Object.assign(l,this.getSectionLabelHoverStyles());const d="team"===this.props.type?{width:"100%",display:"flex",alignItems:"center",...(0,P.G$)({isMobile:t})}:this.getLabelButtonStyle();return a()(me.Z,{className:e,disableMobileBorder:o&&"team"!==this.props.type,shouldShowMobileMarginBottom:o&&"team"!==this.props.type,style:"team"===this.props.type?this.getSectionTeamItemStyle():this.getSectionSidebarItemStyle(),childrenStyle:{overflow:"visible"},right:this.renderRightLabel()},void 0,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(R.Z,{textWrap:!1,disableTooltip:"team"===this.props.type,renderTooltip:()=>a()("div",{},void 0,a()("div",{},void 0,s),a()("span",{style:{color:this.theme.mediumInvertedTextColor,whiteSpace:"nowrap"}},void 0,this.props.labelTooltip)),placement:R.Z.Placement.Top,render:e=>c.createElement(E.Z,n()({mobileFeedback:t,style:d,hovered:!!this.props.forceHoveredButtonStyle||void 0,onClick:()=>this.handleHideClick()},(0,I.Z)(e,{onMouseMove:()=>i.setState({...i.state,mouseEntered:!0}),onMouseLeave:()=>i.setState({...i.state,mouseEntered:!1})})),a()("span",{style:l},void 0,this.renderLabelContent()))})))}renderAddButton(){const{type:e}=this.props,t=function(e){switch(e){case"bookmarks":case"private":case"shared":case"team":case"workspace":return!1;case g.PT:case g.cz:case g.mu:case g.kg:return!0;default:(0,h.t1)(e)}}(e),o=l().compact([T.JiD,"private"===e?"shadow-cursor-new-page-sidebar":void 0]).join(" ");return a()(R.Z,{textWrap:!1,renderTooltip:()=>{const e=a()(v.FormattedMessage,t?{defaultMessage:"New teamspace",id:"sidebar.addButton.addTeamTooltip",description:"Tooltip for 'New teamspace' button in sidebar"}:{defaultMessage:"Add a page",id:"sidebar.addButton.addPageTooltip",description:"Tooltip for 'add a page' button in sidebar"});return a()(c.Fragment,{},void 0,e,a()("br",{}),a()("span",{style:{color:this.theme.mediumInvertedTextColor}},void 0,!t&&this.props.labelTooltip))},placement:R.Z.Placement.Bottom,render:e=>c.createElement(E.Z,n()({style:this.getPlusButtonStyle(),mobileFeedback:this.environment.device.isMobile,onClick:t?this.handleCreateTeamClick:this.handleCreatePageClick,className:o},e),u.Z.plusThick({fill:this.theme.mediumIconColor,width:14,height:14}))})}renderLabelContent(){switch(this.props.type){case"bookmarks":return a()(v.FormattedMessage,{defaultMessage:"Favorites",id:"sidebar.favoritesSection.header"});case"workspace":return a()(v.FormattedMessage,{defaultMessage:"Workspace",id:"sidebar.workspaceSection.header"});case"private":return a()(v.FormattedMessage,{defaultMessage:"Private",id:"sidebar.privateSection.header"});case"shared":return a()(v.FormattedMessage,{defaultMessage:"Shared",id:"sidebar.sharedSection.header"});case"team":if(this.props.teamHeaderLabel){const{isHidden:e}=this.getToggleButtonStore().state,{mouseEntered:t}=this.stores.labelMouseStore.state;return a()(pe,{isHovered:t,isExpanded:!e,teamStore:this.props.teamStore,label:this.props.teamHeaderLabel,outlinerToggleButtonStore:this.getToggleButtonStore(),shouldPersistToggleState:this.props.shouldPersistToggleState,outlinerTeamOnToggle:()=>this.handleHideClick(),teamOutlinerType:this.props.teamOutlinerType,onTeamJoinComplete:this.props.onTeamJoinComplete})}break;case g.kg:case g.mu:case g.cz:case g.PT:return this.props.sectionLabel;default:(0,h.t1)(this.props)}}getToggleButtonStore(){return this.props.customToggleButtonStore||this.stores.outlinerToggleButtonStore}getSectionSidebarItemStyle(){return{paddingTop:0,paddingBottom:0,paddingRight:14,paddingLeft:15,minHeight:24,marginBottom:2,marginTop:6}}getSectionTeamItemStyle(){return{padding:0,margin:0,paddingLeft:10,borderRadius:0}}getSectionLabelStyle(){return{textTransform:"initial",fontSize:12,lineHeight:1,color:this.theme.lightTextColor,fontWeight:f.Z.fontWeight.semibold}}getMobileSectionLabelStyle(){return{textTransform:"initial",fontSize:13,lineHeight:1,color:this.theme.lightTextColor,fontWeight:f.Z.fontWeight.semibold}}getSectionLabelHoverStyles(){return{color:this.theme.darkTextColor}}getLabelButtonStyle(){const{isMobile:e}=this.environment.device;return{display:"flex",alignItems:"center",borderRadius:3,padding:"2px 4px",marginLeft:-4,...e&&{marginBottom:8}}}getPlusButtonStyle(){const{isMobile:e}=this.environment.device;return{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:3,marginLeft:e?0:4}}}ge.displayName="OutlinerToggleButton",ge.marginBottom=18;const he=ge},31054:(e,t,o)=>{o.d(t,{A:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(480)),a=o(24405),s=o(5366),l=o(50659),c=o(64921),d=o(14694);function p(e){const{isMobile:t}=(0,r.Fy)(),{isPopoverOpen:o,onClick:i,moreCount:p,inline:u}=e,m=(0,a.yK)((e=>({button:(0,l.G$)({isMobile:t}),sidebarItem:{background:o?e.buttonHoveredBackground:void 0,marginBottom:t?16:void 0,paddingLeft:t?10:20,color:e.lightTextColor},flexRow:{display:"flex",alignItems:"center",fontSize:t?16:12},inlineButton:{color:e.blueColor,display:"inline-flex",paddingLeft:2,paddingRight:2,borderRadius:3}})),[o,t]);return u?n()(c.Z,{style:m.inlineButton,mobileFeedback:t,onClick:i},void 0,n()(s.FormattedMessage,{defaultMessage:"View all ({total})",description:"Inline 'view all' button for the team outline, appears when there are no pages",id:"viewMoreOutlinerButton.inlineOverflowButtonText",values:{total:p}})):n()(c.Z,{style:m.button,mobileFeedback:t,onClick:i},void 0,n()(d.Z,{style:m.sidebarItem,disableMobileBorder:!0},void 0,n()("div",{style:m.flexRow},void 0,n()(s.FormattedMessage,{defaultMessage:"{total} more",id:"viewMoreOutlinerButton.labelv2",description:"Label for popover menu that displays all pages for an overflowing section in the sidebar. The count represents total number of pages  (e.g. 8 more",values:{total:p}}))))}},32016:(e,t,o)=>{o.d(t,{uO:()=>Me,QO:()=>Te,k4:()=>_e});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(59054),p=o(63143),u=o(5366),m=o(50906),g=o(5978),h=o(31299),f=o(65452),v=o(35026),y=o(79689),b=o(44532),S=o(96486),w=o.n(S),k=o(24405),C=o(42875),_=o(3779),M=o(89837),T=o(97880),I=o(82990),P=o(33929),x=o(60709),B=o(33665),Z=o(29798),E=o(64921),R=o(52275),A=o(68894),D=o(68785),F=o(78140),L=o(40721),V=o(76798),N=o(72495),O=o(14871),U=o(33411),H=o(83182),z=o(46247),W=o(21202),j=o(74647),K=o(73744),Y=o(3815),G=o(84787),X=o(9342),q=o(30149),$=o(98742),J=o(25464),Q=o(79315),ee=o(88632),te=o(48494),oe=o(24039),ie=o(73063),ne=o(58032),re=o(31278);function ae(e){window.__c={n:"RecordIconWithAliasIndicator"};const{icon:t,isAlias:o,isEmptyPage:i}=e,r=function(){const e=(0,l.O7)();return(0,k.yK)((t=>({wrap:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:e.device.isMobile?28:22,height:e.device.isMobile?24:18,position:"relative"},pageLinkInicator:{position:"absolute",width:"50%",height:"50%",right:0,bottom:-1,fill:"dark"===t.mode?t.regularTextColor:"#3E3C38",stroke:"dark"===t.mode?t.sidebarBackground:"white",strokeWidth:"dark"===t.mode?"1.85px":"1.5px"}})),[e])}();return n()("div",{style:r.wrap},void 0,n()(re.Z,{disabled:!0,icon:t,isEmptyPage:i,size:19}),o&&n()("div",{},void 0,_.Z.pageLinkIndicator(r.pageLinkInicator)))}function se(e){window.__c={n:"PinButton"};const{isPinned:t,store:o,spaceViewStore:i,type:r}=e,a=(0,l.O7)(),s=(0,l.MO)(),d=(0,c.VK)((()=>ee.Z.state.online),[]),p=(0,c.VK)((()=>Q.default.state.currentUserSettingsStore),[]),u=(0,k.yK)((e=>({pinned:{width:s?18:14,height:s?18:14,fill:e.regularIconColor},unpinned:{width:s?18:14,height:s?18:14}})),[s]);return n()(ie.Z,{icon:t?_.Z.pinFilled:_.Z.pin,style:d?void 0:{cursor:"default"},iconStyle:t?u.unpinned:u.pinned,onClick:()=>{p&&q.createAndCommit({userAction:"OutlinerViewAllMenuListItem2.onClick",environment:a,perform:e=>{t?(j.unpinSharedPage({environment:a,store:o,spaceViewStore:i,userSettingsStore:p,transaction:e}),m.trackOutlinerSectionUnpin(a,{type:r,from:"sidebar_dropdown_menu"})):(j.pinSharedPage({environment:a,store:o,spaceViewStore:i,userSettingsStore:p,transaction:e}),m.trackOutlinerSectionPin(a,{type:r}))}})},disabled:!d})}const le=s.forwardRef(((e,t)=>{const{store:o,timestamp:i,actorPointer:r,type:d,...p}=e,u=(0,c.VK)((()=>o.getIcon()),[o]),m=(0,c.VK)((()=>o.isEmptyPage()),[o]),g=(0,l.O7)();return(0,c.VK)((()=>{(0,te.B)(o)}),[o]),n()(ne.Z,{placement:J.u.Right,render:i=>s.createElement(R.Z,a()({},(0,$.Z)(p,i),{ref:t,title:n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()(V.Z,{store:o})),icon:n()(ae,{icon:u,isEmptyPage:m,isAlias:!1}),right:(p.focused||e.isPinned||g.device.isMobile)&&n()("div",{style:{display:"flex"}},void 0,"shared"===e.type&&s.createElement(se,e))})),renderTooltip:()=>n()(oe.Z,{store:o})})}));function ce(e){const{sections:t}=e,o=1===t.length;return t.map(((t,i)=>{let{key:n,pages:r}=t;return{key:n,items:de({...e,pages:r}),render:e=>s.createElement(N.Z,a()({},e,{topBorder:0!==i,title:o?void 0:pe({section:n,isFirst:0===i})}))}}))}function de(e){const{environment:t,spaceStore:o,pages:i,visiblePageIds:n,onClose:r,type:l,state:c}=e,d=n.length;return i.map((i=>{let{blockId:p,timestamp:u,authorId:h,authorTable:f,index:v}=i;const y=Y.G.createChildStore(o,{table:W.iU,id:p}),b=h&&f?{table:f,id:h}:void 0,S=n.includes(p);return{key:p,action:e=>{let{event:o}=e;const i=K.DJ(o);i||r(),g.navigateToBlock({environment:t,store:y,openInNew:i}),t.device.isPhone&&j.close(),m.trackSelectPageFromOutlinerViewAllPopover(t,{type:l,queryStringLength:c.query.length,selectedItemIndex:v})},render:t=>s.createElement(le,a()({},t,e,{store:y,timestamp:u,actorPointer:b,isPinned:S,spaceId:o.id,pinnedAmount:d}))}}))}function pe(e){const{section:t,isFirst:o}=e;switch(t){case"today":return n()(u.FormattedMessage,o?{id:"sharedWithMePopover.updatedTodaySection.label",defaultMessage:"Updated today",description:"Page was updated today."}:{id:"sharedWithMePopover.todaySection.label",defaultMessage:"Today"});case"past-week":return n()(u.FormattedMessage,o?{id:"sharedWithMePopover.updatedPastWeekSection.label",defaultMessage:"Updated in the past week",description:"Page was updated in the past week."}:{id:"sharedWithMePopover.pastWeekSection.label",defaultMessage:"Past week"});case"earlier":return n()(u.FormattedMessage,o?{id:"sharedWithMePopover.updatedEarlierSection.label",defaultMessage:"Updated earlier",description:"Page was updated prior to the past week."}:{id:"sharedWithMePopover.earlierSection.label",defaultMessage:"Earlier"});default:throw T.t1(t)}}const ue=function(e){const{sections:t,onClose:o,state:i,menuListStore:r,setState:a,...c}=e,d=(0,l.O7)(),p=w().sumBy(t,(e=>e.pages.length)),u=Math.min(p,i.numPagesShown),m=(0,s.useMemo)((()=>{let e=u;return t.map((t=>{const o={...t,pages:t.pages.slice(0,e)};return e=Math.max(0,e-t.pages.length),o}))}),[u,t]);return s.createElement(s.Fragment,null,n()(X.Z,{type:X.i.Vertical,initialFocus:void 0,sections:ce({...c,setState:a,state:i,environment:d,onClose:o,sections:m,menuListStore:r}),store:r}),n()(G.Z,{fetchSize:u,resultSize:p,loading:!1,onLoadMore:()=>{a({query:i.query,filter:i.filter,numPagesShown:Math.min(p,u+Me)})}}))};var me=o(93686);const ge=(0,u.defineMessages)({searchPlaceholder:{id:"outlinerViewAllPopover.search.placeholder",defaultMessage:"Search for shared pages…",description:"Search placeholder text in 'Shared' overflow popover menu"},teamSearchPlaceholder:{id:"outlinerViewAllPopover.search.teamPlaceholder2",defaultMessage:"Search {teamName}…",description:"Search placeholder text in Team overflow popover menu"},sortAllPages:{id:"outlinerViewAllPopover.sortSelect.allPages",defaultMessage:"All pages",description:"Sort option to show all pages"},sortOwnedPages:{id:"outlinerViewAllPopover.sortSelect.ownedPages",defaultMessage:"Owned pages",description:"Sort option to show owned pages"},sortSharedPages:{id:"outlinerViewAllPopover.sortSelect.sharedPages",defaultMessage:"Shared pages",description:"Sort option to show shared pages"},sortMenuTitle:{id:"outlinerViewAllPopover.sortSelect.menuTitle",defaultMessage:"Sort",description:"Menu title for sorts"}});function he(e){const t=(0,l.Fy)(),{isLoading:o,state:i,setState:r,type:a,menuListStore:d}=e,p=(0,k.yK)((e=>({iconStyle:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[]),u=(0,c.VK)((()=>"team"===e.type?e.teamStore.getName():void 0),[e]);return s.createElement(s.Fragment,null,"team"===e.type&&!t.isMobile&&n()(fe,{teamStore:e.teamStore,state:i,setState:r}),n()(N.Z,{extraTopPadding:!0},void 0,n()(A.ZP,{style:{...t.isAndroid&&{borderBottom:"none"}},left:n()(U.Z,{show:o,showDelay:500,showHold:300,render:e=>e?n()(D.Z,{style:p.iconStyle}):_.Z.searchThick(p.iconStyle)}),showClearButton:!0,placeholder:P.default.formatMessage("team"===a?ge.teamSearchPlaceholder:ge.searchPlaceholder,{teamName:u}),focus:!t.isMobile||void 0,value:i.query,onChange:e=>{r({filter:i.filter,query:e.target.value,numPagesShown:_e}),d.setState({...d.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})))}function fe(e){const{teamStore:t,state:o,setState:i}=e,r=(0,l.O7)(),a=(0,k.yK)((()=>({root:{display:"flex",alignItems:"center",marginLeft:12,marginRight:12,...r.device.isMobile&&{paddingTop:12}},teamName:{fontSize:12,fontWeight:I.Z.fontWeight.semibold,maxWidth:180,...I.Z.textOverflowStyle},icon:{marginRight:4},overflow:{marginLeft:4},grow:{flexGrow:1},sectionMenuItemDesktopStyle:{paddingBottom:0}})),[r]);return s.createElement(s.Fragment,null,n()(N.Z,{extraTopPadding:!0,desktopStyle:a.sectionMenuItemDesktopStyle,disableMobileBorders:!0,disableMobilePadding:!0},void 0,n()("div",{style:a.root},void 0,n()(me.p,{size:14,style:a.icon,store:t,disabled:!0}),n()(V.Z,{store:t,style:a.teamName}),n()("div",{style:a.grow}),n()(ve,{state:o,setState:i}))))}function ve(e){window.__c={n:"TeamSortSelect"};const{state:t,setState:o}=e,i=(0,u.useIntl)(),n=(0,k.Fg)(),r={menuTitle:i.formatMessage(ge.sortMenuTitle),items:["all","owned","shared"],getKey:e=>e,selectedItem:t.filter,originGap:2,onSelect:e=>{o({query:t.query,filter:e,numPagesShown:_e})},renderItem:e=>s.createElement(R.Z,a()({},e,{title:ye(e.value),checkState:e.value===t.filter})),renderOrigin:e=>s.createElement(E.Z,a()({},e,{style:{display:"flex",fontSize:12,borderRadius:3,padding:"2px 4px",color:n.mediumIconColor}}),ye(t.filter),_.Z.chevronDown({marginLeft:2,marginTop:5,width:10,height:10,fill:n.mediumIconColor}))};return s.createElement(O.Z,r)}function ye(e){return"all"===e?P.default.formatMessage(ge.sortAllPages):"owned"===e?P.default.formatMessage(ge.sortOwnedPages):"shared"===e?P.default.formatMessage(ge.sortSharedPages):void(0,T.t1)(e)}function be(){return window.__c={n:"Footer"},n()(N.Z,{topBorder:!0,disableDesktopPadding:!0},void 0,n()(H.Z,{title:n()(u.FormattedMessage,{defaultMessage:"Learn about shared pages",id:"sharedWithMePopover.learnMore.prompt",description:"Link to a guide to learn more about 'Shared with Me' in popover menu"}),href:(0,B.UY)("guides.sharing"),analyticsFrom:"sharing"}))}function Se(){return window.__c={n:"MobileHelpButton"},n()(z.Z,{href:(0,B.UY)("guides.sharing"),analyticsFrom:"sharing"})}function we(e){const{pages:t}=e,o=(0,s.useMemo)((()=>function(e){const t="today",o="past-week",i="earlier",n=(0,M.Uu)((0,C.r)()),r=n.valueOf(),a=n.minus({week:1}).valueOf(),s=w().groupBy(e,(e=>{let{timestamp:n}=e;return n>r?t:n>a?o:i}));let l=-1;return w().compact([t,o,i].map((e=>{const t=s[e];if(t&&0!==t.length)return{key:e,pages:t.map((e=>(l+=1,{...e,index:l})))}})))}(t)),[t]);return 0===o.length?n()(ke,{}):s.createElement(ue,a()({},e,{sections:o}))}function ke(){window.__c={n:"EmptyState"};const e=(0,l.Fy)(),{isMobile:t}=e,o=(0,k.yK)((e=>({placeHolderStyle:{textAlign:"center",padding:(t?64:0)+"px 20px 0",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:t?void 0:"100%",minHeight:t?void 0:200},iconStyle:{width:36,fill:e.lightIconColor},contentStyle:{fontSize:14,color:e.mediumTextColor,maxWidth:260}})),[t]),i=n()(u.FormattedMessage,{defaultMessage:"No pages found",id:"outlinerViewAllPopover.search.noMatchesPrompt",description:"Message when 'View all' popover query results are empty"});return n()("div",{style:o.placeHolderStyle},void 0,n()("div",{style:{paddingBottom:12}},void 0,_.Z.paperAirplane(o.iconStyle)),n()("div",{style:{...o.contentStyle,fontWeight:500}},void 0,i))}const Ce=function(e){window.__c={n:"OutlinerViewAllPopupContent"};const t=(0,l.O7)(),{device:o}=t,[i,r]=(0,c.AF)(e.openStore),d=(0,c.qz)(void 0,Z.Z),p=(0,k.yK)((()=>({teamNameWrap:{display:"flex",alignItems:"center"},teamName:{maxWidth:180,...I.Z.textOverflowStyle},icon:{marginRight:4}})),[]),m=s.createElement(he,a()({},e,{menuListStore:d}));let h;return h=o.isMobile?{menuType:x.og.Modal,title:"shared"===e.type?n()(u.FormattedMessage,{defaultMessage:"Shared",id:"outlinerViewAllPopover.menu.header",description:"Label for mobile popover menu that displays overflow of shared pages"}):n()("div",{style:p.teamNameWrap},void 0,n()(me.p,{size:18,style:p.icon,store:e.teamStore,disabled:!0}),n()(V.Z,{store:e.teamStore,style:p.teamName})),left:n()(Se,{}),right:n()(L.DoneMenuText,{}),onClickRight:()=>{r(!1),g.navigateToHomeTab(t)},header:m,width:"100vw"}:{menuType:x.og.Popup,width:320,header:m,footer:"shared"===e.type&&!e.state.query&&n()(be,{})},s.createElement(F.Z,h,s.createElement(we,a()({},e,{pages:e.sharedPages,menuListStore:d,onClose:()=>{r(!1)}})))},_e=30,Me=20;function Te(e){window.__c={n:"OutlinerViewAllPopup"};const{allPages:t,type:o,originRef:i,userSettingsStore:r,spaceStore:S,render:w}=e,k=(0,l.O7)(),C=k.device.isMobile,_=(0,u.useIntl)(),M=S.id,T=r.id,[I,P]=s.useState(void 0),x=(0,c.VK)((()=>{var e;return Boolean(null===(e=k.mobileNative)||void 0===e?void 0:e.supportsNativeHomeOnPhone())}),[k]),B=(0,y.L)("shared"===e.type?{type:"shared"}:{type:"team",teamId:e.teamStore.id,teamOutlinerType:e.teamOutlinerType}),[Z,E]=(0,c.AF)(B),[{status:R}]=(0,d.r5)((async()=>{await f.l({environment:k,spaceId:M,userId:T})}),[k,M,T],{debounce:h.vp,interval:Z?30*p.C0:5*p.hM}),A=s.useCallback((()=>{E(!0),P(null!=i&&i.current?i.current.getBoundingClientRect():void 0),m.trackOpenOutlinerViewAllPopover(k,{type:o,from:C?"sidebar_mobile":"sidebar"})}),[k,o,i,C,E]),D=s.useCallback((()=>{E(!1)}),[E]);s.useEffect((()=>{!Z&&x&&g.navigateToHomeTab(k)}),[k,x,Z]);const F=(0,s.useMemo)((()=>({query:"",filter:"all",numPagesShown:_e})),[]),[L,V]=s.useState(F),N=s.useRef(void 0);s.useEffect((()=>(Z?N.current&&(clearTimeout(N.current),N.current=void 0):N.current=setTimeout((()=>{V(F)}),2*p.hM),()=>{N.current&&(clearTimeout(N.current),N.current=void 0)})),[Z,F]);const O="team"===e.type?e.teamStore:void 0,U=x;return n()(b.ZP,{popupType:C?b.ZP.PopupType.SlideUp:b.ZP.PopupType.Popup,hidesMobileNativeBottomBar:U,preventSlideUpTransition:U,originRect:I,alignmentToOrigin:b.ZP.Alignment.Start,placementToOrigin:b.ZP.Placement.Right,originGap:0,isFullWidthOnMobile:!0,preventScaleTransition:!0,open:Z,onDismiss:D,render:()=>{const o=(0,v.l6)({allSharedPages:t,state:L,intl:_,teamStore:O}),i=(0,v.vs)({sharedPageItems:o});return s.createElement(Ce,a()({},e,{isLoading:"pending"===R,state:L,setState:V,sharedPages:i,allSharedPageIds:t.map((e=>{let{id:t}=e;return t})),openStore:B}))},origin:w({onClick:A,isPopoverOpen:Z})})}},45952:(e,t,o)=>{o.d(t,{x:()=>f,Z:()=>y});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(3779),c=o(5366),d=o(33929),p=o(68859),u=o(86671),m=o(49914),g=o(69721);const h=(0,c.defineMessages)({embedButtonText:{defaultMessage:"Embed PDF",id:"pdfBlock.embeds.button.label"}});function f(e){const{type:t,environment:o}=e;return"pdf"===t&&o.device.isMobile}class v extends u.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:p.Z}}renderPersisted(){const e=this.props.store.getType();return e&&f({environment:this.environment,type:e})?a()(g.Z,{store:this.props.store,disabled:this.props.disabled}):s.createElement(m.Z,n()({},this.props,this.stores,{store:this.props.store,iconSvg:l.Z.pdf,mediaMenuCurrentTab:"file",mediaMenuTabs:[{type:"file",fileUpload:!0},{type:"embed"}],mediaMenuEmbedCaption:a()(c.FormattedMessage,{defaultMessage:"Embed a PDF file",id:"pdfBlock.embeds.caption"}),embedButtonText:d.default.formatMessage(h.embedButtonText),urlInputPlaceholder:"https://..."}),a()(c.FormattedMessage,{defaultMessage:"Embed a PDF",id:"pdfBlock.placeholder"}))}}const y=v},35868:(e,t,o)=>{o.d(t,{l:()=>A,Z:()=>F});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(480),u=o(8848),m=o(43593),g=o(17755),h=o(59054),f=o(54642),v=o(72747),y=o(24677),b=o(95477),S=o(98742),w=o(33665),k=o(77907),C=o(34859),_=o(4926),M=o(24042),T=o(39218),I=o(49085);class P extends I.Z{getInitialState(){return{ready:!1,pages:0,renderWidth:0,showPages:0}}}const x=P;var B=o(21199),Z=o(68785),E=o(18647),R=o(43145);class A extends d.Z{constructor(){super(...arguments),this.ReactPDF=void 0,this.storeTypes={store:x},this.handleMouseDown=()=>{y.ZH(this.environment)},this.handleDocumentLoadSuccess=e=>{e&&e._pdfInfo&&this.stores.store.setState({...this.stores.store.state,pages:e._pdfInfo.numPages,showPages:1})},this.handlePageRenderSuccess=()=>{this.stores.store.setState({...this.stores.store.state,ready:!0})},this.handleScrollOffsetChange=e=>{e<A.loadMoreOffset&&this.stores.store.state.ready&&this.renderNextPage()},this.updateRenderWidth=()=>{this.stores.store.setState({...this.stores.store.state,renderWidth:this.props.width})},this.updateRenderWidthDebounced=l().debounce(this.updateRenderWidth,1e3)}async willMount(e){super.willMount(e),this.stores.store.setState({...this.stores.store.state,renderWidth:e.width}),this.ReactPDF=await k.deps.reactPDF.loader(),this.enqueueForceUpdate()}willUpdate(e){super.willUpdate(e),this.updateRenderWidthDebounced()}renderComponent(){if(!this.ReactPDF)return;const{source:e}=this.props,t=this.stores.store.state,{Document:o,Page:i}=this.ReactPDF,r=(0,m.x$)(e)&&!(0,w.Sr)();return a()(B.Z,{capture:!0,render:s=>c.createElement(E.Z,n()({type:C.Z.All,style:this.getStyle()},(0,S.Z)(s,{onMouseDown:this.handleMouseDown})),e&&a()(o,{file:e,loading:a()(Z.Z,{style:A.loadingSpinnerStyle}),onLoadSuccess:this.handleDocumentLoadSuccess,options:{cMapUrl:"/notion-assets/cmaps/",cMapPacked:!0,withCredentials:r}},void 0,l().range(t.showPages).map((e=>a()(i,{pageNumber:e+1,width:this.getPageWidth(),loading:"",renderAnnotationLayer:!1,renderInteractiveForms:!1,onRenderSuccess:this.handlePageRenderSuccess},e+1)))),a()(R.Z,{onChange:this.handleScrollOffsetChange}))})}getPageWidth(){const e=this.stores.store.state;return Math.min(window.innerWidth,e.renderWidth)-2*A.leftRightPadding-_.Z.state}renderNextPage(){const{showPages:e,pages:t}=this.stores.store.state;e<t&&this.stores.store.setState({...this.stores.store.state,ready:!1,showPages:e+1})}getStyle(){const{device:e}=this.environment;return{position:"relative",height:this.props.height,maxHeight:e.isMobile?"75vh":void 0,background:u.ZP.uiExtraLightGray,paddingTop:A.topBottomPadding,paddingBottom:A.topBottomPadding,paddingLeft:A.leftRightPadding,paddingRight:A.leftRightPadding,overflow:"visible"}}}A.displayName="PDFRenderer",A.loadMoreOffset=200,A.topBottomPadding=8,A.leftRightPadding=16,A.loadingSpinnerStyle={position:"absolute",top:"calc(50% - 9px)",left:"calc(50% - 9px)",width:18,height:18};function D(e){window.__c={n:"ProxiedPDFRendererWrapper"};const{contentWrapStyle:t,width:o,height:i,blockLocation:n,source:r}=e,s=e.store.pointer,l=(0,p.O7)(),[{value:c}]=(0,h.r5)((async()=>{if(await T.transactionQueue.awaitRecordTransaction(s),(0,m.E$)(r,b.Z.secureFileS3.url)){const e=l.device;return await f.getSignedFileUrl(l,{url:r,permissionRecord:s,useS3Url:e.isIOS&&e.isMobileNative},Boolean(M.Z.state.isNotionProtocolBugFixed))}return(0,g.EK)({url:r,permissionRecord:s,baseUrl:b.Z.domainBaseUrl,fullyQualified:!1,userId:l.currentUser.id})}),[l,s,r]);return a()("div",{style:t},void 0,a()(A,{source:c,width:o||500,height:i||(v.qC(n)?240:500)}))}const F={render:e=>c.createElement(D,e),embedGhost:!0,resizable:!0}},12337:(e,t,o)=>{o.d(t,{Z:()=>y});var i,n=o(77094),r=o.n(n),a=o(45697),s=o.n(a),l=(o(67294),o(83355)),c=o(8848),d=o(3779),p=o(22808),u=o(57770),m=o(51077),g=o(56496),h=o(48937);!function(e){e[e.NoAccess=0]="NoAccess",e[e.NotFound=1]="NotFound",e[e.Unsafe=2]="Unsafe"}(i||(i={}));const f={iconType:s().any,...l.w};class v extends l.Z{getChildContext(){return{...this.context,iconType:this.props.type}}renderComponent(){const{device:e}=this.environment,t=e.isMobile?48:64,o={marginBottom:e.isMobile?12:16};if(this.props.type===i.NoAccess){const{publicPageData:e}=this.props,i=(0,p.Z)(e.icon)?e.icon:void 0,n=(0,p.Z)(e.icon)?void 0:e.icon;return n?r()("div",{style:o},void 0,r()(m.Z,{type:"image_url",size:t,imageURL:n})):i?r()("div",{style:o},void 0,r()(u.Z,{size:t,emoji:i})):e.spaceName?r()("div",{style:o},void 0,r()(g.Z,{size:t,title:e.spaceName})):r()("div",{style:o},void 0,r()(h.Z,{size:t,isEmptyPage:!1,role:void 0}))}return this.props.type===i.NotFound?d.Z.eyes({width:t,height:t,color:this.theme.regularTextColor,fill:this.theme.regularTextColor,...o}):this.props.type===i.Unsafe?d.Z.pageErrorUnsafe({width:t,height:t,color:c.ZP.frontRed,fill:c.ZP.frontRed,...o}):void 0}}v.displayName="PageErrorIcon",v.Type=i,v.contextTypes=l.w,v.childContextTypes=f;const y=v},12552:(e,t,o)=>{o.d(t,{Z:()=>q});var i=o(96486),n=o.n(i),r=o(62518),a=o(83355),s=o(1302),l=o(88108),c=o(7406),d=o(29477),p=o(45953),u=o(98459),m=o(20073),g=o(25320),h=o(4408),f=o(3898),v=o(761),y=o(11599),b=o(41432),S=o(16691),w=o(64572),k=o(59753),C=o(74446),_=o(98963),M=o(18844),T=o(21202),I=o(6287),P=o(13493),x=o(70279),B=o(33709),Z=o(80396),E=o(19889),R=o(70203);var A=o(54642),D=o(95477),F=o(45950),L=o(5659),V=o(32223),N=o(68015);async function O(e){const{environment:t,request:o,abortSignal:i,prefetchCacheKey:n}=e;return V.isConnected()||V.isConnecting()?A.loadCachedPageChunk(t,o,void 0,void 0,i,n):A.loadPageChunk(t,o,void 0,void 0,i,n)}async function U(e){const{environment:t,request:o,prefetchPromise:i,abortSignal:r,useInMemoryCacheOnly:a}=e,s=p.Ak.create(),l=await async function(e,t,o){let i;i=e.cursor?n().cloneDeep(e.cursor.stack):[];const r=e.page.id,a=e.limit,s=p.Ak.create();0===i.length&&i.push([{table:T.iU,id:r,index:0}]);let l=0,c=0;const d=C.zF.fromMonomorphicFunctionUnsafe((async e=>{const o=s.get(e);if(c+=1,o)return o;const i=await t(e);return s.set(e,i),i&&await m(e.table,i),i})),u=new Set,m=async function(t,r){const a=[],s=r;if(s.parent_table&&s.parent_id&&a.push([p.dr.getParentPointerFromRecordWithParent(s),"Block parent_id"]),t===T.iU){var l;const t=r;if(t.view_ids)for(const e of t.view_ids)a.push([{table:P.n,id:e,spaceId:t.space_id},"CollectionViewBlock view_id"]);const o=k.kk.fromBlock(t).getCollectionPointer();if(o&&a.push([o,"CollectionViewBlock collection_id"]),t.discussions)for(const e of t.discussions)a.push([p.dr.fromPointerLike({table:B.qF,id:e,spaceId:t.space_id}),"Discussion"]);if((0,b.XD)(t.type)&&t.properties&&t.properties.title){const o=R.lz(t.properties.title),i=n().union(...o.map(R.hD));for(const n of i){if(R.ST(n)&&a.push([{table:T.iU,id:R.TO(n)},"page annotation"]),R.IW(n)&&a.push([{table:E.KJ,id:R.zE(n)},"user annotation"]),R.j0(n)){const t=R.zW(n),o=(0,w.A5)({url:t,baseUrl:e.baseUrl,publicDomainName:e.publicDomainName});o&&a.push([{table:T.iU,id:o},"link annotation"])}if(R.nS(n)){const e=R.Ik(n);e&&a.push([{table:T.iU,id:e,spaceId:t.space_id},"eoi annotation"])}}}if(t.type===b.Ti.alias&&t.format&&t.format.alias_pointer&&a.push([t.format.alias_pointer,"alias"]),t.type===b.Ti.externalObjectInstance){var c,m;const e=(null===(c=t.format)||void 0===c?void 0:c.related_external_object_uris_to_instance_ids)&&Object.values(null===(m=t.format)||void 0===m?void 0:m.related_external_object_uris_to_instance_ids)||[];for(const o of e)a.push([{table:T.iU,id:o,spaceId:t.space_id},"eoi"])}t.type===b.Ti.button&&null!==(l=t.format)&&void 0!==l&&l.automation_id&&a.push([{table:_.cv,id:t.format.automation_id,spaceId:t.space_id},"button_automation"])}else if(t===B.qF){const e=r,t=e.comments||[];for(const o of t)a.push([p.dr.fromPointerLike({table:x.x_,id:o,spaceId:e.space_id}),"discussion table comment"])}else if(t===x.x_){const e=r,t=e.content;if(t)for(const o of t)a.push([p.dr.fromPointerLike({table:T.iU,id:o,spaceId:e.space_id}),"comment table comment"]);if(e.reactions)for(const o of e.reactions)a.push([p.dr.fromPointerLike({table:Z.yo,id:o,spaceId:e.space_id}),"comment table reaction"])}else if(t===P.n){var g;const e=r,t=null==e||null===(g=e.format)||void 0===g?void 0:g.collection_pointer;t&&a.push([t,"CollectionView collection_id"])}else if(t===_.cv){const e=r;for(const t of e.action_ids??[])a.push([{table:M.Xj,id:t,spaceId:e.space_id},"Automation action_ids"])}else if(t===M.Xj){const e=r;for(const t of e.blocks??[])i.push([{table:T.iU,id:t,index:0}])}else if(t===I.v){var h;const e=r,t=(null===(h=e.format)||void 0===h?void 0:h.automation_ids)??[];for(const o of t)a.push([{id:o,table:_.cv,spaceId:e.space_id},"Collection automation_ids"])}await Promise.all(a.filter((e=>{let[t,o]=e;const i=(0,S.dn)(t);return!u.has(i)&&(u.add(i),!0)})).map((e=>{let[i,n]=e;return o&&o({table:t,id:r.id},i,n),i})).map(d))},g=async function(){const t=[],n=i[i.length-1];if(l>=a&&c>10*a||!n)return!1;const s=await Promise.all(n.map((async e=>{const{table:t,id:o}=e,i=p.dr.fromPointerLike({table:t,id:o});return await d(i)}))),u=[];for(let o=0;o<n.length;o++){const a=n[o],l=s[o],c=l&&l.content;if(!e.verticalColumns&&l&&c&&"column_list"===l.type&&0===a.index){for(let e=0;e<c.length;e++){const o=c[e];u.push([{table:T.iU,id:o},a,"column"]),t.push({table:T.iU,id:o,index:0})}a.index=c.length}else if(l&&"transclusion_reference"===l.type&&l.format&&l.format.transclusion_reference_pointer&&0===a.index)u.push([l.format.transclusion_reference_pointer,a,"transclusion reference"]),t.push({...l.format.transclusion_reference_pointer,index:0}),a.index=1;else if(l&&c&&(0,b.Um)(l.type,l.format)&&(l.id===r&&1===i.length||"page"!==l.type&&!(0,b.BX)(l.type,l.format))&&c[a.index]){const e=c[a.index];u.push([{table:T.iU,id:e},a,"block content child"]),t.push({table:T.iU,id:e,index:0}),a.index++}}await Promise.all(u.map((e=>{let[t,i,n]=e;return o&&o(i,t,n),t})).map(d));const m=t.filter((e=>{for(let t=0;t<i.length;t++){const o=i[t];for(let t=0;t<o.length;t++){const i=o[t];if(i.table===e.table&&i.id===e.id)return!1}}return!0}));return m.length>0?(i.push(m),l++):i.pop(),!0};for(;await g(););return{recordMap:s,cursorValue:{stack:i}}}({...o,baseUrl:D.Z.domainBaseUrl,publicDomainName:D.Z.publicDomainName},C.zF.fromMonomorphicFunctionUnsafe((async e=>{const o=await F.Ye({environment:t,pointer:e,prefetchPromise:i,useInMemoryCacheOnly:a});if(null!=r&&r.aborted)throw new Error("Abort signal received");if(o)return s.set(e,o),o.value;throw new Error(`Record not found: ${e.table},${e.id}`)})),L.A.enableLogging?(e,t,o)=>{console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${o})`)}:void 0);return{recordMap:s.toJson({allowVersionDowngrade:!1}),cursor:l.cursorValue}}var H=o(77546),z=o(472),W=o(95802),j=o(88632),K=o(79167),Y=o(93220);let G=!1;(0,l.exposeDebugValue)("toggleLogLocalPageLoadFailures",(()=>{G=!G,console.info(G?"Local page load error logging enabled":"Local page load error logging disabled")}));class X extends a.Z{constructor(){super(...arguments),this.lastTimeout=void 0,this.node=void 0,this.scrollableAncestor=void 0,this.isCollectionInPage=!1,this.storeTypes={store:Y.Z},this.handleConnectionStateChange=()=>{const{store:e}=this.stores,t=j.Z.state.online;t&&!this.lastOnlineState&&e.state.error&&(e.reset(),this.requestNextChunk()),this.lastOnlineState=t},this.onReady=n().once(this.props.onReady?this.props.onReady:()=>{}),this.onDone=n().once(this.props.onDone?this.props.onDone:()=>{}),this.requestNextChunk=async()=>{const{loading:e,endOfResultsReached:t,initialRequestCompleted:o,currentCursor:i,currentChunkNumber:n,ready:r,error:a}=this.stores.store.state,{incrementChunkSize:l,initialChunkSize:p}=this.props;if(e||t||o&&a)return;this.stores.store.setState({...this.stores.store.state,loading:!0});const u=o?l:p;let m;o||z.default.initialRenderCompleted||this.environment.device.isAndroid||(m=new d._W(async function(e,t){const o=e.currentUser.id;if(!o||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:o})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),N.unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}(this.environment,{id:this.props.pageStore.id,table:this.props.pageStore.table})));try{const e=await this.requestPageChunk(u,i,n||0,m);o&&await s.default.afterNextFlush();const t=this.isScrolledToPosition()&&this.scrollToBlocksAreRendered(),a=r||!e||t;!r&&a&&s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{this.onReady()}))}));const l=!e;this.stores.store.setState({...this.stores.store.state,ready:a,initialRequestCompleted:!0,loading:!1,currentCursor:e?e.cursor:void 0,currentChunkNumber:e?e.chunkNumber:void 0,endOfResultsReached:l,error:void 0}),l&&this.onDone()}catch(g){this.stores.store.setState({...this.stores.store.state,ready:!0,initialRequestCompleted:!0,loading:!1,error:(0,c.tg)(g)})}},this.requestPageChunk=async(e,t,o,i)=>{const{device:n}=this.environment,{pageStore:r}=this.props,a=(0,u.CG)(r.pointer.spaceId),s={page:{id:r.id,spaceId:a},limit:e,cursor:t||{stack:[]},chunkNumber:o,verticalColumns:n.isMobile},l=t?Promise.resolve(void 0):this.loadScrollToBlocks(),c=this.environment.prefetchCache.isEnabled&&!z.default.initialRenderCompleted?this.performLocalOrRemoteLoadPageChunkInParallel({request:s,initialPreloadPromise:i}):this.performLocalOrRemoteLoadPageChunkSerially({request:s,initialPreloadPromise:i}),p=performance.now(),g=await c;if(!g)throw new Error("No successful load result found.");var h;z.default.initialRenderCompleted||0!==o||z.default.updateInitialPageRenderSubMetrics({page_chunk_source:g.source,page_chunk_wait_time:performance.now()-p,page_chunk_prefetch:null===(h=this.environment.prefetchCache)||void 0===h?void 0:h.getPrefetchAnalytic("initialLoadPageChunk")});this.environment.currentUser.isLoggedIn()&&(K.Z.addFromRecordMapWithRole(g.recordMap),K.Z.isEmpty()||v.dY({environment:this.environment}));const f=performance.now();await(0,d.aM)(l,5e3),z.default.initialRenderCompleted||0!==o||z.default.updateInitialPageRenderSubMetrics({scroll_to_blocks_wait_time:performance.now()-f}),m.O({rootStore:r,cursors:[g.cursor]});const y=g.cursor.stack.length>0?g.cursor:void 0;if(y)return{cursor:y,chunkNumber:o+1}}}shouldComponentUpdate(){return!0}didMount(){super.didMount(),this.lastOnlineState=j.Z.state.online,this.node=r.findDOMNode(this),this.scrollableAncestor=(0,H.VW)(this.node),j.Z.addListener(this.handleConnectionStateChange)}didMountOrUpdate(){super.didMountOrUpdate(),this.requestNextChunk()}willUnmount(){super.willUnmount(),this.lastTimeout&&window.clearTimeout(this.lastTimeout),j.Z.removeListener(this.handleConnectionStateChange)}renderComponent(){const{ready:e,error:t,initialRequestCompleted:o,endOfResultsReached:i}=this.stores.store.state;return this.props.render({error:t,ready:e,initialRequestCompleted:o,endOfResultsReached:i,isCollectionInPage:this.isCollectionInPage})}async performRemoteLoadPageChunk(e){const{request:t,abortSignal:o}=e,{pageStore:i,pageVisitStore:n}=this.props;if(0===t.chunkNumber){const e=O({environment:this.environment,request:t,abortSignal:o,prefetchCacheKey:"initialLoadPageChunk"});this.environment.LocalBacklinkStore.initializeBacklinks({block:{id:i.id,spaceId:(0,u.CG)(i.pointer.spaceId)},currentUserId:this.environment.currentUser.id,environment:this.environment});const r=this.environment.LocalBacklinkStore.awaitLoaded(i.id);g.R(this.environment,{block:i,pageVisitStore:n,incremental:!1});const a=y.A$("backlinks","section_show"),s=e.then((()=>(0,d.aM)(r,1e3))),[l]=a?await Promise.all([e,s]):await Promise.all([e]);if("success"===l.type){const e=p.Ak.create(l.data.recordMap);return this.isCollectionInPage=this.didLoadANonParentCollection(t.page,e,i.inMemoryRecordCache),{recordMap:e,cursor:l.data.cursor,source:"remote"}}}else{const e=await O({environment:this.environment,request:t,abortSignal:o,prefetchCacheKey:void 0});if("success"===e.type){const o=p.Ak.create(e.data.recordMap);return this.isCollectionInPage=this.didLoadANonParentCollection(t.page,o,i.inMemoryRecordCache),{recordMap:o,cursor:e.data.cursor,source:"remote"}}}}async performLocalLoadPageChunk(e){const{request:t,initialPreloadPromise:o,abortSignal:i,useInMemoryCacheOnly:n}=e,{pageStore:r}=this.props;try{const e=await L.A.measure("localLoadPageChunk",`${t.page.id} ${t.cursor.stack.length}`,(()=>U({environment:this.environment,request:t,prefetchPromise:o,abortSignal:i,useInMemoryCacheOnly:n}))),a=p.Ak.create(e.recordMap);return h.fL({environment:this.environment,inMemoryRecordCache:r.inMemoryRecordCache,recordMap:a,debugSource:"PageLoadaingContainer.performLocalLoadPageChunk"}),this.isCollectionInPage=this.didLoadANonParentCollection(t.page,a,r.inMemoryRecordCache),{cursor:e.cursor,recordMap:a,source:"local"}}catch(a){G&&console.error(a)}}didLoadANonParentCollection(e,t,o){var i;if(this.isCollectionInPage)return!0;const n=null===(i=o.getRecord({pointer:{table:"block",id:e.id,spaceId:e.spaceId},userId:this.environment.currentUser.id}))||void 0===i?void 0:i.value;if(n)for(const p of t.getByTable("block")){var r,a,s,l,c,d;if(("collection_view"===(null===(r=p.value)||void 0===r||null===(a=r.value)||void 0===a?void 0:a.type)||"collection_view_page"===(null===(s=p.value)||void 0===s||null===(l=s.value)||void 0===l?void 0:l.type))&&n.parent_id!==(null===(c=p.value)||void 0===c||null===(d=c.value)||void 0===d?void 0:d.collection_id))return!0}return!1}async performLocalOrRemoteLoadPageChunkInParallel(e){const t=await this.performLocalLoadPageChunk({...e,useInMemoryCacheOnly:!0});if(t)return t;const o=new AbortController,i=this.performRemoteLoadPageChunk({...e,abortSignal:o.signal});if(!this.environment.defaultRecordCache.persistedRecordCache)return await i;const n=new AbortController,r=[{promise:this.performLocalLoadPageChunk({...e,abortSignal:n.signal}),abortController:n},{promise:i,abortController:o}],{winner:a}=await(0,d.S3)(r.map((e=>e.promise))),s=0===a?1:0,l=r[a],c=r[s],p=await l.promise;return p?(c.abortController.abort(),p):await c.promise}async performLocalOrRemoteLoadPageChunkSerially(e){const t=await this.performLocalLoadPageChunk(e);return t||await this.performRemoteLoadPageChunk(e)}async loadScrollToBlocks(){this.props.scrollToBlockIds&&await f.Nz(this.props.pageStore,this.props.scrollToBlockIds)}scrollToBlocksAreRendered(){const{scrollToBlockIds:e}=this.props;return!e||W.C.findSelectablesFromIds(e).length===e.length}isScrolledToPosition(){const{scrollToPosition:e}=this.props;return!this.scrollableAncestor||!n().isNumber(e)||e<=this.scrollableAncestor.scrollHeight-this.scrollableAncestor.clientHeight}}X.displayName="PageLoadingContainer",X.scrollThrottle=200;const q=X},22789:(e,t,o)=>{o.d(t,{Z:()=>C});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(19889),p=o(7928),u=o(5366),m=o(50906),g=o(96802),h=o(30149),f=o(34700),v=o(33929),y=o(92547),b=o(3815),S=o(64921),w=o(58032);class k extends l.Z{constructor(){super(...arguments),this.storeTypes={lockStore:y.Z},this.renderTooltip=()=>{const e=this.props.store.getFormat().block_locked_by,t=v.default.getIntl(),{theme:o}=this;if(e){const i=(0,p.Nz)(t,b.t1.createChildStore(this.props.store,{table:d.KJ,id:e}).getModel());return a()("div",{},void 0,a()(u.FormattedMessage,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:a()("b",{},void 0,i),br:a()("br",{}),prompttext:e=>a()("span",{style:{color:o.mediumInvertedTextColor}},void 0,e)}}))}},this.handleLockClick=()=>{const{store:e}=this.props;h.createAndCommit({userAction:"PageLockTopbarIndicator.handleLockClick",environment:this.environment,perform:t=>{g.Wq({environment:this.environment,store:e,isLocked:!1,transaction:t})}}),this.stores.lockStore.setState({...this.stores.lockStore.state,justUnlocked:!0});const t=this.props.store.getType();if(t){var o;let i;e.isCollectionView()&&(i=e.getCollectionViewCollectionStore()),m.trackEditLockToggle(this.environment,{from:"topbar",block_type:t,locked:!1,collection_id:null===(o=i)||void 0===o?void 0:o.id})}},this.handleUnlockClick=()=>{const{store:e}=this.props;h.createAndCommit({userAction:"PageLockTopbarIndicator.handleUnlockClick",environment:this.environment,perform:t=>{g.Wq({environment:this.environment,store:e,isLocked:!0,transaction:t})}}),this.stores.lockStore.setState({...this.stores.lockStore.state,justUnlocked:!1});const t=this.props.store.getType();if(t){var o;let i;e.isCollectionView()&&(i=e.getCollectionViewCollectionStore()),m.trackEditLockToggle(this.environment,{from:"topbar",block_type:t,locked:!0,collection_id:null===(o=i)||void 0===o?void 0:o.id})}}}renderComponent(){return this.props.isMobile?this.renderMobile():this.renderDesktop()}renderDesktop(){return this.props.store.isLocked()?a()(w.Z,{renderTooltip:()=>this.renderTooltip(),disableTooltip:this.props.disableTooltip,render:e=>s.createElement(S.Z,n()({style:this.getUnlockButtonStyle(),onClick:this.handleLockClick},e),c.Z.lockedFilled(k.iconStyle),a()("div",{style:{lineHeight:1}},void 0,a()(u.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})))}):this.stores.lockStore.state.justUnlocked?a()(S.Z,{style:this.getLockButtonStyle(),onClick:this.handleUnlockClick,hoveredStyle:{background:this.theme.outlineBlueButtonHoveredBackground},pressedStyle:{background:this.theme.outlineBlueButtonPressedBackground}},void 0,c.Z.unlockedFilled(k.iconStyle),a()("div",{style:{lineHeight:1}},void 0,a()(u.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"}))):void 0}renderMobile(){const{WindowSizeStore:e}=this.environment;return this.props.store.isLocked()?a()(S.Z,{onClick:this.handleLockClick,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:e.getSafePaddingLeftCSS(10),paddingRight:e.getSafePaddingRightCSS(14)}},void 0,c.Z.mobileLocked({width:20,marginRight:6}),a()("div",{},void 0,a()(u.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"}))):this.stores.lockStore.state.justUnlocked?a()(S.Z,{onClick:this.handleUnlockClick,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:e.getSafePaddingLeftCSS(10),paddingRight:e.getSafePaddingRightCSS(14),color:this.theme.blueColor,fill:this.theme.blueColor}},void 0,c.Z.mobileUnlocked({height:26,width:32,marginRight:6}),a()("div",{},void 0,a()(u.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"}))):void 0}getButtonStyle(){const{isMobile:e,isInlineCollection:t,buttonStyle:o}=this.props;return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:3,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}getUnlockButtonStyle(){return{...this.getButtonStyle(),...(0,f.X)(this.environment.device.isElectronMac,!1),color:this.theme.lightTextColor,fill:this.theme.lightIconColor}}getLockButtonStyle(){return{...this.getButtonStyle(),...(0,f.X)(this.environment.device.isElectronMac,!1),paddingLeft:5,border:`1px solid ${this.theme.blueColor}`,color:this.theme.blueColor,fill:this.theme.blueColor}}}k.displayName="PageLockTopbarIndicator",k.iconStyle={width:16,marginRight:4};const C=k},89302:(e,t,o)=>{o.d(t,{Z:()=>H});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(45953),d=o(98459),p=o(80984),u=o(21202),m=o(77420),g=o(19889),h=o(70203),f=o(5366),v=o(54642),y=o(61045),b=o(95477),S=o(66213),w=o(28020),k=o(21115),C=o(79315),_=o(88632),M=o(4548),T=o(49085);class I extends T.Z{getInitialState(){return{}}}const P=I;var x=o(82136),B=o(3815),Z=o(78291),E=o(50795),R=o(1449),A=o(68785),D=o(77137),F=o(18647),L=o(64369),V=o(2700),N=o(57079),O=o(37064);class U extends l.Z{constructor(){super(...arguments),this.storeTypes={store:P,templateRecordCacheStore:E.$},this.renderResult=(e,t)=>{const{device:o,WindowSizeStore:i}=this.environment,{navigatedRootId:r}=this.stores.store.state;if(t){let e;return e=r?B.G.createChildStore(t,{table:u.iU,id:r}):t,a()("div",{style:this.props.style},void 0,a()("div",{style:{fontSize:14,paddingTop:o.isMobile?4:8,paddingBottom:o.isMobile?4:8,paddingLeft:o.isMobile?10:12,paddingRight:o.isMobile?10:12,height:48,display:"flex",alignItems:"center",flexShrink:0,...o.isMobile?{height:44,borderBottom:`\n\t\t\t\t\t\t\t\t\t\t\t1px solid ${this.theme.regularDividerColor}\n\t\t\t\t\t\t\t\t\t\t`}:{}}},void 0,a()(R.Z,{store:e,maxAncestorCount:2,ancestorMaxWidth:240,currentPageMaxWidth:240,showCurrentPageControls:!1,isMobile:o.isMobile,style:{flexGrow:1,flexShrink:1,minWidth:0,paddingLeft:i.state.paddingLeftCSS,paddingRight:i.state.paddingRightCSS}}),this.props.topbarRightActionButton),a()(O.Z,{store:e,isDefaultContainer:!0,droppable:!0,render:o=>{let{selectableEvents:i,selectableHoverMenuOverlay:r}=o;return s.createElement(F.Z,n()({style:this.getScrollerStyle(),key:e.id,type:(0,w.Zy)({environment:this.environment,store:t}),store:M.Z,preventType:y.Q7(this.environment)},i),r,a()(N.Z,{store:e,loadingContainerStore:void 0,context:this.props.isFrontPage?x.S.FrontPageTemplatePreview:x.S.InAppTemplatePreview,paddingBottom:N.Z.paddingBottom(this.environment),paddingLeft:(0,w.ui)(this.environment),paddingRight:(0,w.ui)(this.environment),pageCoverHeight:N.Z.defaultPageCoverHeight(this.environment),disabled:this.props.disabled}))}},e.id))}return a()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",...this.props.style}},void 0,a()(A.Z,{style:{width:V.Z.spinnerSize,height:V.Z.spinnerSize}}))},this.handleOverrideLinkClick=e=>{const{device:t}=this.environment,o=(0,p.Wj)({url:e,isMobile:t.isMobile,baseUrl:b.Z.domainBaseUrl,publicDomainName:b.Z.publicDomainName,protocol:b.Z.protocol,currentUrl:ncd.href()});"page"===o.name&&(o.peekViewBlockId?this.stores.store.setState({...this.stores.store.state,navigatedRootId:o.peekViewBlockId}):this.stores.store.setState({...this.stores.store.state,navigatedRootId:o.blockId}))},this.performRequest=async e=>{const t=await v.loadBlockSubtree(this.environment,{block:{id:e,spaceId:(0,d.CG)(void 0)},shallow:!1});if("failed"===t.type)throw t.error;const{currentSpaceStore:o}=C.default.state,{data:i}=Z.default.state,{inMemoryRecordCache:n}=this.stores.templateRecordCacheStore.state;n.clearCache(),n.isTemplatePreview=!0;const r=new Set,a=new Set,s=c.Ak.create(t.data.subtreeRecordMap);for(const{pointer:c,value:d}of s){if(!d)return;if(n.setRecord({pointer:c,userId:this.environment.currentUser.id},{role:"editor",value:d.value}),"block"===c.table){const e=d.value;if(e){const t=e.properties||{};for(const e of Object.keys(t)){const o=(0,h.lc)(t[e]);for(const e of o)r.add(e);const i=(0,h.zy)(t[e]);for(const e of i)a.add(e)}e.created_by_table&&e.created_by_id&&(e.created_by_table===g.KJ?r.add(e.created_by_id):a.add(e.created_by_id)),e.last_edited_by_table&&e.last_edited_by_id&&(e.last_edited_by_table===g.KJ?r.add(e.last_edited_by_id):a.add(e.last_edited_by_id))}}}if(i)for(const c of(0,k.CM)(i))r.add(c.userId);const l=await Promise.all(Array.from(r).map((async e=>{if(o){const t=B.U6.createChildStore(o,{table:g.KJ,id:e});await t.load();return t.getValue()}{const t=await v.syncRecordValue(this.environment,{pointer:{table:g.KJ,id:e},userId:this.environment.currentUser.id,version:-1});return t&&t.value}})));for(const c of l)c&&n.setRecord({pointer:{table:g.KJ,id:c.id},userId:this.environment.currentUser.id},{role:"reader",value:c});const p=await Promise.all(Array.from(a).map((async e=>{if(o){const t=(0,B.Kv)(o,{table:m.cZ,id:e,spaceId:o.id});await t.load();return t.getValue()}{const t=await v.syncRecordValue(this.environment,{pointer:{table:m.cZ,id:e},userId:this.environment.currentUser.id,version:-1});return t&&t.value}})));for(const c of p)c&&n.setRecord({pointer:{table:m.cZ,id:c.id,spaceId:c.space_id},userId:this.environment.currentUser.id},{role:"reader",value:c});const{currentUserStore:f}=C.default.state;f&&(await f.load(),n.setRecord({pointer:f.pointer,userId:this.environment.currentUser.id},{role:"editor",value:f.getValue()}));return new B.G(this.environment,{table:u.iU,id:e},{inMemoryRecordCache:n})}}getChildContext(){return{...this.context,overrideLinkClick:this.handleOverrideLinkClick}}renderComponent(){return _.Z.state.online?a()(S.LF,{value:this.handleOverrideLinkClick},void 0,a()(D.Z,{request:this.props.previewRootId,performRequest:this.performRequest,render:this.renderResult})):a()(S.LF,{value:this.handleOverrideLinkClick},void 0,a()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",...this.props.style}},void 0,a()(L.Z,{isSmall:!0},void 0,a()(f.FormattedMessage,{defaultMessage:"Please go online to view this template.",id:"pageTemplatePreview.offline.message"}))))}getScrollerStyle(){const{device:e}=this.environment;return{flex:1,...e.isSafari&&{zIndex:1}}}}U.displayName="PageTemplatePreview",U.contextTypes=l.w,U.childContextTypes={...S.wK,...l.w};const H=U},57079:(e,t,o)=>{o.d(t,{Z:()=>Nn});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(1302),p=o(13991),u=o(6740),m=o(69615),g=o(49271),h=o(41432),f=o(99036),v=o(80951),y=o(1800),b=o(42509),S=o(43593),w=o(6695),k=o(42875),C=o(3779),_=o(63306),M=o(98459),T=o(6287),I=o(90965),P=o(5500),x=o(70203),B=o(97880),Z=o(82990),E=o(51454),R=o(5366),A=o(50906),D=o(35253),F=o(54564),L=o(51365),V=o(96802),N=o(7476),O=o(30149);function U(e){if(e){const t=(0,x.Q)(e.getValue());return Boolean(t)}return!1}function H(e){if(e){const t=e.getSettings();if(t&&t.hidden_collection_descriptions)return t.hidden_collection_descriptions}return[]}function z(e){const{environment:t,pageId:o,isExpanded:i,store:n,userSettingsStore:r,descriptionStore:a}=e,s=n.state.isExpanded;n.setState({isExpanded:i});U(a)&&r&&s!==i&&O.createAndCommit({userAction:"pageDescriptionActions.setExpanded",environment:t,perform:e=>{if(i){const t={pointer:{table:"user_settings",id:r.id},path:["settings","hidden_collection_descriptions"],command:"listRemove",args:{id:o}};O.applyOperation({store:r,transaction:e,operation:t})}else{const t={pointer:{table:"user_settings",id:r.id},path:["settings","hidden_collection_descriptions"],command:"listAfter",args:{id:o}};O.applyOperation({store:r,transaction:e,operation:t});let i=H(r);for(;i.length>1e3;){const t=i[0],o={pointer:{table:"user_settings",id:r.id},path:["settings","hidden_collection_descriptions"],command:"listRemove",args:{id:t}};O.applyOperation({store:r,transaction:e,operation:o}),i=H(r)}}}})}var W=o(9953),j=o(5978),K=o(24677),Y=o(98104),G=o(29373),X=o(39865),q=o(89626),$=o(57819),J=o(95477),Q=o(66890),ee=o(28020),te=o(80365),oe=o(43250),ie=o(78316),ne=o(99417),re=o(11599),ae=o(78089),se=o(41232),le=o(12534),ce=o(70177),de=o(33929),pe=o(10663),ue=o(60709),me=o(59488),ge=o(39500),he=o(45162),fe=o(98165),ve=o(65598),ye=o(33665),be=o(45010),Se=o(77546),we=o(45094),ke=o(472),Ce=o(89086),_e=o(77907),Me=o(46351),Te=o(49427),Ie=o(51),Pe=o(79315),xe=o(61766),Be=o(4787),Ze=o(16772),Ee=o(87404),Re=o(80796),Ae=o(10161),De=o(73329),Fe=o(29755),Le=o(22294),Ve=o(29798),Ne=o(31792),Oe=o(19671),Ue=o(49085);class He extends Ue.Z{getInitialState(){return{isExpanded:!0}}isExpanded(){return Boolean(this.state.isExpanded)}}const ze=He;var We=o(94896),je=o(82136),Ke=o(91551),Ye=o(13023),Ge=o(88923),Xe=o(96026),qe=o(3815),$e=o(3075),Je=o(69784),Qe=o(12318),et=o(17963),tt=o(19079),ot=o(4350),it=o(86671),nt=o(78030),rt=o(12022),at=o(97543),st=o(19195),lt=o(480),ct=o(81954),dt=o(24405),pt=o(68709),ut=o(30016),mt=o(14577),gt=o(44805),ht=o(80503),ft=o(96514),vt=o(24229),yt=o(35973),bt=o(13884),St=o(50628),wt=o(7011),kt=o(21202),Ct=o(19889),_t=o(16402),Mt=o(76798),Tt=o(64369),It=o(67706),Pt=o(72893);function xt(e){let{discussionData:{groupedDiscussionsData:t,id:o},onClick:i}=e;window.__c={n:"GroupedMarginDiscussionItem"};const[n,r]=(0,c.useState)(!1),s=(0,c.useCallback)((()=>{r(!0)}),[]),l=(0,c.useCallback)((()=>{r(!1)}),[]),d=(0,c.useCallback)((async e=>{await i(e,o)}),[i,o]),p=(0,ct.VK)((()=>t.flatMap((e=>(0,ve.D4)(e.discussionStore)))),[t]),u=(0,ct.VK)((()=>{const e=t[0].parentBlockStore;return[...new Set(p.map((e=>e.getCreatedById())).filter(B.$K))].map((t=>qe.U6.createChildStore(e,{table:Ct.KJ,id:t}))).slice(0,3)}),[t,p]),m=(0,ct.VK)((()=>{const e=t[0].closestVisibleParentId,o=t[0].parentBlockStore;if(!e)return;const i=qe.G.createChildStore(o,{table:kt.iU,id:e}),n=i.getParentStore();return n&&n.table===kt.iU&&n.getType()===h.Ti.tab?i:void 0}),[t]),g=(0,ct.VK)((()=>{const e=p.map((e=>e.getLastEditedTime()));return Math.max(...e)}),[p]),f=(0,dt.yK)((e=>({discussion:{border:`1px solid ${e.regularDividerColor}`,borderRadius:3,background:n?e.hoveredMarginDiscussionBackground:e.contentBackground,width:pe.Z,display:"flex",padding:"10px 12px",cursor:"pointer"},userAvatarsContainer:{display:"flex",marginRight:6,justifyContent:"center",alignItems:"center",flexDirection:"row-reverse"},hiddenUsers:{fontSize:14,color:e.mediumTextColor,marginRight:6},commentCount:{fontSize:14,fontWeight:Z.Z.fontWeight.semibold,whiteSpace:"normal",marginLeft:6},textPlaceholder:{background:e.lightDividerColor,height:14,width:81,borderRadius:3,marginLeft:4},lastEditedTime:{margin:"1px 0px 0px 6px",whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px"},commentAuthorAvatarStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative",userSelect:"none",WebkitUserSelect:"none"},commentAuthorPlaceholderStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative"},secondaryLabel:{fontSize:Z.Z.fontSize.UISmall.desktop,marginLeft:4,color:e.lightTextColor,marginTop:1,whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px"},expandIcon:{width:Z.Z.fontSize.UISmall.desktop,height:Z.Z.fontSize.UISmall.desktop,fill:e.lightTextColor,marginTop:1}})),[n]);return a()("div",{style:f.discussion,onMouseEnter:s,onMouseLeave:l,onClick:d,className:oe.S9A},void 0,c.createElement(c.Fragment,null,a()("div",{style:f.userAvatarsContainer},void 0,u.map((e=>a()(Pt.S,{authorStore:e,avatarSize:20,avatarStyle:f.commentAuthorAvatarStyle,placeholderStyle:f.commentAuthorPlaceholderStyle},e.id)))),p.length>0?a()("div",{style:f.commentCount},void 0,a()(R.FormattedMessage,{defaultMessage:"{numComments, plural, one {{numComments} comment} other {{numComments} comments}}",id:"marginComments.collapsed.numComments.count",values:{numComments:p.length}})):a()("div",{style:f.textPlaceholder}),n?c.createElement(c.Fragment,null,a()("div",{style:{marginLeft:10,display:"flex",justifyContent:"center",alignItems:"center"}},void 0,C.Z.expand(f.expandIcon)),a()("div",{style:f.secondaryLabel},void 0,a()(R.FormattedMessage,{defaultMessage:"Expand",id:"marginComments.collapsed.expand.label"}))):g&&a()(Tt.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:f.lastEditedTime},void 0,a()(It.Z,{text:(0,_t.IS)(g),tooltipText:(0,_t.uy)(g),icon:C.Z.calendar})),m&&a()("div",{style:f.secondaryLabel},void 0,a()(Mt.Z,{store:m,maxLength:10}))))}var Bt=o(74725);function Zt(e){let{discussionData:{parentBlockStore:t,discussionInputStore:o},isVisible:i}=e;window.__c={n:"NewMarginDiscussionItem"};const n=(0,c.useRef)(null),r=(0,lt.O7)(),s=(0,c.useCallback)((()=>{N.ZL(r)}),[r]),l=(0,c.useCallback)((()=>{N.uK(o,r)}),[r,o]),d=(0,c.useMemo)((()=>[`.${oe.mJW}`]),[]);(0,Bt.O)({active:i,closeHandler:l,ref:n,excludedSelectors:d,ignoreKeydown:!0});const p=(0,dt.yK)((e=>({discussion:{borderRadius:3,boxShadow:e.marginDiscussionSelectedShadow,width:pe.Z,background:e.selectedMarginDiscussionBackground},discussionInputContainer:{borderRadius:3,padding:"6px 4px 4px 8px"}})),[]);return c.createElement("div",{style:p.discussion,ref:n,className:oe.S9A},a()(st.Z,{parentStore:t,discussionInputStore:o,shouldSaveUnsentComments:!1,isMobileSlideUpMenu:!1,discussionFormat:ae.O2.Margin,onSubmit:s,onCancel:l,isNewComment:!0,blockStore:t,canDrop:!0,showAvatar:!1,containerStyle:p.discussionInputContainer,showCtaButtons:!0}))}var Et=o(80357),Rt=o(89574);function At(e){let{discussionData:{discussionStore:t,parentBlockStore:o},timeMounted:i,onClick:n,isVisible:r,isDiscussionSelected:s,isDiscussionHovered:l}=e;window.__c={n:"SingleMarginDiscussionItem"};const d=(0,c.useRef)(null),p=(0,lt.O7)(),[u,m]=(0,c.useState)((()=>new Ee.Z(p,t.pointer.spaceId))),g=t.id,h=(0,c.useMemo)((()=>[`.${(0,Et.dk)({discussionId:g})}`,`.${oe.mJW}`,`.${oe.S9A}`]),[g]),f=(0,c.useCallback)((async()=>{const e=Rt.Z.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}F.LZ()}),[]);(0,Bt.O)({active:r&&s,closeHandler:f,ref:d,excludedSelectors:h,ignoreKeydown:!0});const v=(0,dt.yK)((e=>({discussion:{border:s?void 0:`1px solid ${e.regularDividerColor}`,borderRadius:3,padding:s?"1px":void 0,background:s?e.selectedMarginDiscussionBackground:l?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:s?e.marginDiscussionSelectedShadow:void 0,width:pe.Z,willChange:"transform",transition:"transform 150ms",transform:s?"translateX(-20px)":l?"translateX(-5px)":void 0,cursor:s?void 0:"pointer"}})),[l,s]),y=(0,c.useCallback)((async e=>{s||(A.trackClickDiscussion(p,{from:"margin_comments"}),await n(e,g))}),[n,g,s,p]);return c.createElement("div",{style:v.discussion,onClick:y,ref:d,className:oe.S9A},a()(at.Z,{store:t,blockStore:o,format:ae.O2.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:i,discussionInputStore:u,collapsed:!s}))}const Dt=c.memo(At);function Ft(e){window.__c={n:"MarginDiscussionItem"};const{discussionData:t,isLastItem:o,isDiscussionSelected:i,discussionItemElementMap:r}=e,a=(0,dt.yK)((e=>({discussionContainer:{transition:"background 300ms ease\n\t\t\t\t"+(t.hide?"":", top 200ms ease-in-out"),top:t.offsetTop,position:"absolute",paddingBottom:o?pe.Vs:pe.wo,zIndex:i?1:void 0,opacity:t.hide?0:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"}})),[t.hide,t.offsetTop,i,o]);let s;const l=t.type;"existing"===l?s=c.createElement(Dt,n()({},e,{discussionData:t})):"new"===l?s=c.createElement(Zt,n()({},e,{discussionData:t})):"grouped"===l?s=c.createElement(xt,n()({},e,{discussionData:t})):(0,B.t1)(l);const d=(0,c.useCallback)((()=>{yt.Z.setState({source:"margin_comments",discussionIds:[t.id]})}),[t.id]),p=(0,c.useCallback)((()=>{yt.Z.setState({discussionIds:[]})}),[]),u=(0,c.useCallback)((e=>{r.set(t.id,e)}),[t.id,r]);return c.createElement("div",{style:a.discussionContainer,onMouseEnter:d,onMouseLeave:p,ref:u},s)}const Lt=c.memo(Ft),Vt=`.${gt.zd}, .${gt.FB}`;function Nt(e){let{pageBlockStore:t,timeMounted:o,isVisible:i,animating:n,pageViewBlockAccessor:r,width:l}=e;window.__c={n:"MarginCommentsContent"};const d=(0,lt.O7)(),p=(0,c.useRef)(null),u=(0,c.useRef)(new Map),m=(0,c.useRef)(new Map),g=(0,ct.VK)((()=>yt.Z.getFirstSelectedDiscussionId()),[]),h=(0,c.useCallback)((async(e,o)=>{(0,ge.X9)()||e.target instanceof Element&&e.target.closest(Vt)||await ft.en({discussionId:o,currentBlockStore:t,environment:d,analyticsFrom:"margin_comments",currentEl:p.current})}),[t,d]),[f,v]=(0,c.useState)({data:[],hasNewDiscussion:!1,selectedDiscussion:void 0}),[y,b]=(0,c.useState)(!1),{WindowSizeStore:S}=d,w=ht.R6(d.device.isElectronMac);(0,c.useEffect)((()=>{if(!i)return;const e=new mt.Z((()=>({selectableRectMap:St.Z.state.selectableRectMap,pageContentStores:t.getContentStores(),sidebarIsAnimating:wt.ZP.state.isAnimating,windowHeight:S.state.height})),{debugName:"effectDataStore"}),o=new mt.Z((()=>pe.EM.state),{debugName:"discussionStoresStore"}),a=new mt.Z((()=>{const e=bt.Z.state;if(e.open&&e.rect&&Te.Z.isBlockInFrame(e.blockStore))return{blockStore:e.blockStore,discussionInputStore:e.discussionInputStore}}),{debugName:"newMarginDiscussionArgsStore"}),l=new mt.Z((()=>vt.Z.getFramePageFirstSelectedDiscussionId()),{debugName:"selectedDiscussionIdStore"});let c=!1;const d=(0,s.debounce)((()=>{const{selectableRectMap:i,pageContentStores:s,sidebarIsAnimating:d,windowHeight:g}=e.state,h=o.state,S=a.state,k=l.state;if(n||d)return;const C=r();if(!(C&&p.current&&i&&i.size))return;(0,pe.H0)({discussionStores:h,pageContentStores:s,marginDiscussionItemRefs:u.current,selectedDiscussionId:k,newMarginDiscussionArgs:S,marginContainerElement:p.current,pageViewBlockElement:C,onComputeComplete:(e,t)=>{c||(m.current=t,y||b(!0),v(e))},computedOnce:y,topbarHeight:w,windowHeight:g,isFullWidth:t.isFullWidth(),prevSelectedDiscussionId:f.selectedDiscussion,previousDiscussionElements:m.current})}),5);return e.addListener(d),o.addListener(d),l.addListener(d),a.addListener(d),()=>{c=!0,e.removeListener(d),o.removeListener(d),l.removeListener(d),a.removeListener(d)}}),[i,n,r,y,t,f.selectedDiscussion,S,w]);const k=(0,dt.yK)((e=>({gradientOverlay:{position:"absolute",pointerEvents:"none",width:"100%",height:"100%",top:"-5px",background:`linear-gradient(to bottom, ${e.contentBackground} 0px, ${e.contentBackgroundTransparent} 15px)`},marginCommentsContainer:{display:"flex",flexDirection:"column",paddingTop:5,paddingBottom:5,paddingLeft:pe.fS,paddingRight:pe.fS,width:l-2*pe.fS,flexShrink:0,height:"100%",position:"relative",pointerEvents:"none",zIndex:E.p8}})),[l]);return c.createElement("div",{style:k.marginCommentsContainer,ref:p},f.data.map(((e,t)=>a()(Lt,{discussionData:e,timeMounted:o,onClick:h,isVisible:i,discussionItemElementMap:u.current,isDiscussionSelected:e.selected||"new"===e.type,isDiscussionHovered:e.id===g,isLastItem:t===f.data.length-1},`margin-discussion-${e.id}`))),a()("div",{style:k.gradientOverlay}))}const Ot=c.memo(Nt);function Ut(e){let{pageBlockStore:t,isVisible:o,pageViewBlockAccessor:i,context:n}=e;window.__c={n:"MarginCommentsSection"};const[r,s]=(0,c.useState)(!1),l=(0,lt.O7)(),d=(0,c.useMemo)((()=>(new Date).getTime()),[]),p=(0,ct.VK)((()=>t.isFullWidth()||n===je.S.CollectionPageView),[n,t]),u=(0,ct.VK)((()=>{if(!p)return{position:"absolute",right:(0,pe.oS)(l,(0,ie.en)(t),(0,ie.Ks)(t))}}),[p,l,t]),m=(0,c.useCallback)((()=>{s(!0)}),[]),g=(0,c.useCallback)((()=>{s(!1)}),[]),h=(0,dt.yK)((()=>({marginCommentsSection:{display:o||r?"flex":"none",flexShrink:0,pointerEvents:"none",width:o?pe.QB:0,...u}})),[o,r,u]);return a()(pt.p,{allowSelectionWithin:!0,style:{width:p&&o?pe.QB:0}},void 0,a()(ut.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},onAnimationStart:m,onAnimationEnd:g,render:()=>a()("div",{style:h.marginCommentsSection},void 0,a()(Ot,{pageBlockStore:t,timeMounted:d,isVisible:o,animating:r,pageViewBlockAccessor:i,width:pe.QB}))}))}var Ht=o(61134),zt=o(59054),Wt=o(54642),jt=o(10279),Kt=o(64964),Yt=o(67669),Gt=o(51445),Xt=o(73063),qt=o(68785),$t=o(63296),Jt=o(89728);const Qt=(0,R.defineMessages)({shareWithParticipants:{id:"contextualSharingPopup.shareSnackBarMessage.success",defaultMessage:"Shared with participants",description:"Message shown to user in snackbar indicating the share succeeded."},failedToShareWithParticipants:{id:"contextualSharingPopup.shareSnackBarMessage.fail",defaultMessage:"Failed to shared with participants",description:"Message shown to user in snackbar indicating the share failed."}});const eo=function(e){let{store:t,events:o}=e;window.__c={n:"ContextualSharingPopup"};const i=(0,dt.Fg)(),n=(0,lt.O7)(),[r,s]=(0,c.useState)(!1),[d,p]=(0,c.useState)(!1),[u,m]=(0,c.useState)(!1),g=(0,ct.VK)((()=>{const e=(0,fe.Pj)(t)||Pe.default.state.currentSpaceStore,o=(0,fe.VP)(t);return Boolean((null==e?void 0:e.getDisableGuests())||(null==o?void 0:o.getDisableGuests()))}),[t]),h=(0,ct.VK)((()=>{const e=o.flatMap((e=>{const o=Gt.G.createChildStore(t,e).getModel();if(!o)return[];return(0,v.rq)((0,v.wS)(o,`${v.UU}attendees`)).flatMap((e=>{const o=Gt.G.createChildStore(t,e).getModel();if(!o)return[];const i=(0,v.wS)(o,`${v.UU}email`)||(0,v.wS)(o,`${v.UU}email_address`),n=(0,x.Q)(i);return n?[n]:[]}))}));return[...new Set(e)]}),[t,o]),[{value:f}]=(0,zt.r5)((async()=>{if(l().isEmpty(h))return[];const e=await Wt.getEmailsWithoutAccessToBlock(n,{emails:h,blockId:t.id,spaceId:t.getSpaceId()});return"success"!==(null==e?void 0:e.type)?[]:e.data.emails}),[h,t,n]);return(0,ct.VK)((()=>!!f&&(0,Yt.dA)(n,f)),[f,n])||u||g||u||!f||0===f.length?null:r?a()("div",{style:{background:i.popoverBackground,borderRadius:3,boxShadow:i.lightBoxShadow,padding:"16px 36px 16px 16px",marginBottom:16,position:"relative",display:"inline-block"}},void 0,a()("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"flex-start",flexDirection:"column"}},void 0,a()("div",{},void 0,a()("div",{style:{fontSize:14,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},void 0,a()(R.FormattedMessage,{id:"contextualSharingPopup.shareButton.expanded.description",defaultMessage:"Share this page with <b>{attendeeCount} event attendees</b> that do not have access.",description:"Text shown the user above the share button that indicates the number of users the doc will be shared with",values:{attendeeCount:f.length,b:e=>a()("b",{style:{display:"contents"}},void 0,e)}}))),a()("div",{},void 0,a()($t.Z,{onClick:async()=>{p(!0);const e=await Wt.processShareActionToBlock(n,{emails:f,blockId:t.id,spaceId:t.getSpaceId()});if("success"!==e.type)return p(!1),void Kt.oV({label:de.default.formatMessage(Qt.failedToShareWithParticipants)});const o=await Wt.getEmailsWithoutAccessToBlock(n,{emails:h,blockId:t.id,spaceId:t.getSpaceId()});if("success"!==o.type||!l().isEmpty(o.data.emails))return p(!1),void Kt.oV({label:de.default.formatMessage(Qt.failedToShareWithParticipants)});p(!1),m(!0),Kt.d4({item:{label:de.default.formatMessage(Qt.shareWithParticipants)},undoFunc:()=>{m(!1),s(!1),O.createAndCommit({userAction:"PermissionItem.handlePermissionItemChange",environment:n,perform:o=>{jt.ep({environment:n,store:t,permissionItems:e.data.userIds.map((e=>({type:"user_permission",user_id:e,role:"none"}))),transaction:o})}})}})},isLarge:!1,isBlue:!0,style:{marginTop:12}},void 0,d?a()(qt.Z,{}):a()(R.FormattedMessage,{id:"contextualSharingPopup.shareButton.expanded.actionButton",defaultMessage:"Invite",description:"The share button to trigger the page to be shared with attendees of the event"}))),a()(Xt.Z,{icon:C.Z.close,onClick:()=>{s(!1)},style:{position:"absolute",top:6,right:6}}))):a()(Jt.Z,{onClick:()=>{s(!0)},isBlue:!0,style:{paddingLeft:6,marginBottom:12}},void 0,C.Z.sidebarInviteTeam({width:16,height:16,display:"block",fill:i.blueColor,marginRight:8,flexShrink:0,backfaceVisibility:"hidden",marginTop:1}),a()(R.FormattedMessage,{id:"contextualSharingPopup.shareButton.notExpanded",defaultMessage:"Share with event attendees",description:"Button shown to user that allows them see the number of users the doc will be shared with."}))};var to=o(91754),oo=o(65162),io=o(31945),no=o(16354),ro=o(84076),ao=o(78140),so=o(40721),lo=o(31278),co=o(58032),po=o(40662),uo=o(46247),mo=o(17748),go=o(83355),ho=o(47307),fo=o(27153),vo=o(53471);const yo="loadingLocalImage",bo="uploading",So="loaded";class wo extends Ue.Z{getInitialState(){return{loadingMode:So}}}const ko=wo;var Co=o(87636),_o=o(64921),Mo=o(71669);function To(e){let{src:t,placeholderSrc:o,placeholderBehavior:i,imageStyle:n,containerStyle:r,onLoadComplete:s}=e;window.__c={n:"ImageBoxWithPlaceholder"};const[l,d]=(0,c.useState)(!0);let p;switch(i){case"force-show-placeholder":p=!0;break;case"force-show-src":p=!1;break;case"show-placeholder-if-loading-src":p=!!o&&(l||void 0===t);break;default:(0,B.t1)(i)}const u=(0,dt.yK)((()=>{const e={gridColumn:1,gridRow:1};return{container:{display:"grid",...r},srcWrapper:{...p&&{display:"none"},...e},placeholderWrapper:{pointerEvents:"none",...e}}}),[r,p]);(0,c.useEffect)((()=>{void 0!==t&&d(!0)}),[t]);const m=(0,c.useCallback)((()=>{d(!1),null==s||s()}),[s]);return a()("div",{style:u.container},void 0,a()(Mo.Z,{src:t,onLoad:m,style:n,placeholderStyle:u.srcWrapper,placeholderLoadedStyle:u.srcWrapper}),o&&a()(Mo.Z,{src:o,style:n,placeholderStyle:u.placeholderWrapper,placeholderLoadedStyle:u.placeholderWrapper}))}var Io=o(32854),Po=o(81865),xo=o(49914),Bo=o(25155);const Zo=(0,R.defineMessages)({embedPlaceholder:{defaultMessage:"Paste an image link…",id:"pageCover.embedType.placeholder"}});class Eo extends go.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={imageUploadStore:ko,mouseStore:Ne.Z},this.handleLoadComplete=()=>{this.stores.imageUploadStore.reset()},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:i,handleRepositionClick:n,handleSavePositionClick:r}=e;if(this.props.disabled||this.stores.imageUploadStore.state.loadingMode!==So)return;const{device:s}=this.environment,{isMobile:l}=s;return a()(ut.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth(),opacity:t?1:0},render:()=>a()("div",{style:{position:"relative",pointerEvents:t?"auto":"none",maxWidth:"100%"}},void 0,a()(Co.Z,{isVisible:t,position:"bottom",style:{marginRight:this.props.paddingRight,marginLeft:this.props.paddingLeft}},void 0,!o&&a()(_o.Z,{style:{...xo.Z.actionButtonStyle,...l&&{borderRight:"none"}},onClick:this.handleChangeCoverClick},void 0,a()(R.FormattedMessage,{defaultMessage:"Change cover",id:"pageCover.changeCover.text"})),!o&&!l&&a()(_o.Z,{style:{...xo.Z.actionButtonStyle,borderRight:"none"},onClick:e=>n(e,this.lastProxiedUrl)},void 0,a()(R.FormattedMessage,{defaultMessage:"Reposition",id:"pageCover.reposition.text"})),o&&!l&&a()(_o.Z,{style:xo.Z.actionButtonStyle,onClick:r},void 0,a()(R.FormattedMessage,{defaultMessage:"Save position",id:"pageCover.savePosition.text"})),o&&!l&&a()(_o.Z,{style:{...xo.Z.actionButtonStyle,borderRight:"none"},onClick:i},void 0,a()(R.FormattedMessage,{defaultMessage:"Cancel",id:"pageCover.reposition.cancelText"}))))})},this.handleFlushTemporaryPosition=e=>{let{imagePosition:t,reset:o}=e;O.createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{V.Mp({store:this.props.store,coverPosition:t,transaction:e}),o()}})},this.handleChangeCoverClick=e=>{const{intl:t,store:o}=this.props;this.stores.mouseStore.reset();const i=e.target.getBoundingClientRect();fo.$(this.environment,{originGap:3,originRect:i,isSmallWidth:!1,popupWidth:540,maxHeight:485,title:t.formatMessage({defaultMessage:"Page cover",id:"pageCover.mobileMenu.title"}),onDelete:this.handleDelete,currentTab:"gallery",tabs:[{type:"gallery",onChange:this.handleGalleryChange},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:a()(R.FormattedMessage,{defaultMessage:"Images wider than {idealImageWidth} pixels work best.",id:"pageCover.fileType.caption",values:{idealImageWidth:1500}}),onUpload:e=>{this.props.store.getCoverStore()&&vo.cT({environment:this.environment,file:e,bucket:"secure",record:o.pointer,onStart:this.handleUploadStart,onProgress:this.handleUploadProgress,onComplete:this.handleUploadComplete,onError:()=>{ho.showErrorMessage(t.formatMessage({defaultMessage:"Upload failed",id:"pageCover.errorDialogMessage.uploadFailed"}))}})}},{type:"embed",title:a()(R.FormattedMessage,{defaultMessage:"Link",id:"pageCover.embedType.title"}),inputPlaceholder:de.default.formatMessage(Zo.embedPlaceholder),caption:a()(R.FormattedMessage,{defaultMessage:"Works with any image from the web.",id:"pageCover.embedType.caption"}),buttonText:a()(R.FormattedMessage,{defaultMessage:"Submit",id:"pageCover.embedType.buttonText"}),onChange:this.handleEmbedLinkChange},{type:"unsplash",onChange:this.handleGalleryChange}]})},this.handleUploadComplete=e=>{this.updatePageCover({url:e,position:.5})},this.handleGalleryChange=e=>{const{url:t,position:o}=e;this.updatePageCover({url:t,position:l().isNumber(o)?o:.5});const{device:i}=this.environment;i.isMobile&&fo.Z()},this.handleEmbedLinkChange=e=>{this.updatePageCover({url:e,position:.5}),fo.Z()},this.coverWithRecordStore=this.createComputedStore((()=>this.props.store.getCover()),!0),this.updatePageCover=async e=>{const{url:t,position:o}=e,{serverCommitResult:i}=O.createAndCommit({userAction:"PageCover.updatePageCover",environment:this.environment,perform:e=>{V.fs({store:this.props.store,url:t,position:o,transaction:e})}});await i,this.stores.imageUploadStore.state.loadingMode===bo&&this.stores.imageUploadStore.setState({loadingMode:"downloading",dataURL:this.stores.imageUploadStore.state.dataURL,uploadProgress:100})},this.handleUploadStart=e=>{const{file:t,name:o,size:i}=e;if(fo.Z(),this.stores.imageUploadStore.setState({loadingMode:yo,file:t,name:o,size:i,uploadProgress:0}),t.type.indexOf("image")>=0){const e=new FileReader;e.onload=e=>{this.stores.imageUploadStore.state.loadingMode===yo&&this.stores.imageUploadStore.setState({...this.stores.imageUploadStore.state,uploadProgress:0,loadingMode:bo,dataURL:e.target.result})},e.readAsDataURL(t)}},this.handleUploadProgress=e=>{const{progressPercent:t}=e;this.stores.imageUploadStore.state.loadingMode===bo&&this.stores.imageUploadStore.setState({...this.stores.imageUploadStore.state,uploadProgress:t})},this.handleDelete=()=>{fo.Z(),O.createAndCommit({userAction:"PageCover.handleDelete",environment:this.environment,perform:e=>{V.MF({store:this.props.store,transaction:e})}})}}renderComponent(){const e=this.coverWithRecordStore.getState();if(!e)return;const t=this.stores.imageUploadStore.state,{WindowSizeStore:o}=this.environment,i=t.loadingMode!==So&&t.loadingMode!==yo;return a()(Bo.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:this.handleFlushTemporaryPosition,renderControl:this.renderControl,source:"page",store:this.props.store,style:{display:"flex",flexDirection:"column",alignItems:"center",height:this.props.height,cursor:"default"}},void 0,(n=>a()(c.Fragment,{},void 0,a()(Po.Z,{url:e.cover,isAuthenticated:!0,permissionRecord:e.pointer,width:o.state.width,render:(e,o)=>{this.lastProxiedUrl=o;const r={width:"100%",height:this.props.height,objectFit:"cover",opacity:i?.5:1,objectPosition:`center ${100*(1-(n.imagePosition||0))}%`,borderRadius:0},s={width:"100%",height:this.props.height};return a()(To,{src:o,placeholderSrc:i?t.dataURL:void 0,placeholderBehavior:i?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:s,imageStyle:r,onLoadComplete:this.handleLoadComplete})}}),i&&a()("div",{style:Mo.Z.loadingContainerStyle},void 0,a()(qt.Z,{style:{width:16,height:16,marginRight:4}}),a()("div",{style:{minWidth:30,textAlign:"right"}},void 0,a()(Io.Z,{percentage:t.uploadProgress}))))))}getAdjustedPageWidth(){let e;return e=!!this.props.store.isFullWidth()?"100%":900,e}}Eo.displayName="PageCover";const Ro=(0,R.injectIntl)(Eo);var Ao=o(89733),Do=o(993),Fo=o(68056),Lo=o(1533),Vo=o(24666),No=o(65187);class Oo extends go.Z{constructor(){super(...arguments),this.editor=null,this.storeTypes={store:Lo.Z,buttonPopupStore:xe.Z},this.renderLockedTooltip=()=>{const{collectionStore:e}=this.props,t=e&&e.getIcon();return a()("div",{style:{display:"flex",alignItems:"start"}},void 0,a()("div",{style:{paddingTop:4,paddingRight:6}},void 0,C.Z.locked({width:12})),a()("div",{},void 0,a()("div",{},void 0,a()(R.FormattedMessage,{defaultMessage:"Please unlock {pageTitleWithIcon} to edit the description.",id:"pageDescription.lockedTooltip.message",values:{pageTitleWithIcon:a()("span",{style:{whiteSpace:"nowrap",fontWeight:Z.Z.fontWeight.bold}},void 0,t&&a()(lo.Z,{disabled:!0,icon:t,isEmptyPage:!1,size:12,style:{marginRight:4,display:"inline-block"}}),e&&a()(Mt.Z,{store:e,style:{display:"inline"}}))}}))))},this.handleTab=e=>!0,this.handleUntab=e=>!0,this.handleEnter=e=>{if(!this.canEdit())return;if(e.preventDefault(),this.editor&&this.editor.isComposing())return;const t=Vo.default.state;if("editing"===t.mode){const e=(0,Fo.QY)(t.multiSelection);if(!e)return;O.createAndCommit({userAction:"PageDescription.handleEnter",environment:this.environment,perform:t=>{Do.hJ({environment:this.environment,store:this.props.descriptionStore,string:"\n",selection:e.selection,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})}},this.handleToggleExpanded=e=>{this.isExpanded()||e.preventDefault(),this.togglePageDescription()},this.handleMouseMove=e=>{const{disabled:t}=this.props;Ao.Js({store:this.stores.store,event:e,disabled:t||!1})},this.handleMouseLeave=e=>{const{disabled:t}=this.props;Ao.iV({store:this.stores.store,event:e,disabled:t||!1})}}renderComponent(){return a()("div",{style:{maxWidth:"100%",borderRadius:3,overflow:"hidden",marginBottom:12},onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,this.renderExpanded())}renderExpanded(){return this.props.isMobile?a()(c.Fragment,{},void 0,this.renderDescriptionText()):a()(co.Z,{renderTooltip:this.renderLockedTooltip,disableTooltip:!this.props.locked||!this.props.canEdit,render:e=>a()("div",{},void 0,c.createElement("div",n()({style:{display:"flex",cursor:"text"}},e),this.renderDescriptionText()))})}renderDescriptionText(){const{device:e}=this.environment,{intl:t}=this.props;if(this.props.descriptionStore)return c.createElement(No.Z,{ref:e=>{this.editor=e},store:this.props.descriptionStore,style:{fontSize:14,paddingLeft:6,paddingBottom:4,paddingTop:3,width:780},disabled:this.props.disabled,placeholder:t.formatMessage({defaultMessage:"Add a description…",id:"pageDescription.emptyPlaceholder"}),disableSlashCommands:!0,disableEmbedMenu:!0,disableDateMentions:!0,disableMentions:!0,onTab:this.handleTab,onUntab:this.handleUntab,onEnter:this.handleEnter,onClick:this.isExpanded()?()=>{}:this.handleToggleExpanded,disableStyleAnnotations:e.isMobileBrowser,disableHorizontalEdgeScroll:!0,pasteBehavior:"inline"})}isExpanded(){return this.props.toggleStore.isExpanded()}canEdit(){const{descriptionStore:e}=this.props,t=this.pageContext&&this.pageContext.publicEditModeStore.state;return!this.props.disabled&&(!(0,Yt.YF)(t)&&e.canEdit())}togglePageDescription(){const e=this.isExpanded();z({environment:this.environment,pageId:this.props.pageId,isExpanded:!e,store:this.props.toggleStore,userSettingsStore:this.props.userSettingsStore,descriptionStore:this.props.descriptionStore})}}Oo.displayName="PageDescription",Oo.stores={store:Lo.Z,buttonPopupStore:xe.Z};const Uo=(0,R.injectIntl)(Oo);var Ho=o(8848),zo=o(90468),Wo=o(84210);function jo(e){window.__c={n:"PageLink"};const{urlStore:t,titleStore:o}=e,i=(0,lt.Fy)(),n=o||t,{icon:r,url:s}=(0,ct.VK)((()=>({icon:n.getIcon(),url:(0,Wo.ZP)({store:t,fullyQualified:!1})})),[n,t]);return a()(ro.Z,{href:s,style:{display:"inline-flex"},innerStyle:{display:"inline-flex",alignItems:"baseline"}},void 0,a()(lo.Z,{disabled:!0,icon:r,isEmptyPage:!1,size:i.isMobile?18:16,emojiSize:i.isMobile?24:20,style:{marginRight:"0.2em",fill:""},pageIconStyle:{fill:Ho.ZP.white}}),a()(Mt.Z,{store:n,style:{fontWeight:Z.Z.fontWeight.medium}}))}function Ko(e){let{movedSourceBlock:t,moveTarget:o}=e;return c.useMemo((()=>a()(jo,{urlStore:qe.G.createChildStore(t,o.moved_to),titleStore:qe.H2.createChildStore(t,{table:zo.bx,id:o.moved_to.spaceId})})),[t,o])}function Yo(e){let{movedSourceBlock:t,moveTarget:o}=e;window.__c={n:"PageMovedMessage"};const i=Ko({movedSourceBlock:t,moveTarget:o});return a()(R.FormattedMessage,{defaultMessage:"Moved to {targetSpaceLink}.",id:"pageViewBlock.movedPageBanner.pageMovedMessage",values:{targetSpaceLink:i}})}function Go(e){let{movedSourceBlock:t,moveTarget:o}=e;window.__c={n:"AncestorMovedMessage"};const i=Ko({movedSourceBlock:t,moveTarget:o});return a()(R.FormattedMessage,{defaultMessage:"{movedAncestorLink} was moved to {targetSpaceLink}.",id:"pageViewBlock.movedPageBanner.ancestorMovedMessage",values:{targetSpaceLink:i,movedAncestorLink:a()(jo,{urlStore:t})}})}var Xo=o(85526),qo=o(50478),$o=o(79131);function Jo(e){return(0,ct.VK)((()=>ie.eD({collectionStore:e,collectionViewBlockStore:e.getParentBlockStore(),checkNavigableAncestorLocked:!1})),[e])}var Qo=o(62518),ei=o(77162),ti=o(16956),oi=o(5149),ii=o(64434),ni=o(79257),ri=o(93959),ai=o(52821),si=o(98742),li=o(29376);class ci extends go.Z{constructor(){super(...arguments),this.renderParentCollectionLockedTooltip=()=>{const{store:e}=this.props,t=e.getIcon(),{propertyName:o}=this.props;return c.createElement(c.Fragment,null,a()("div",{},void 0,o),a()("div",{style:{display:"flex",alignItems:"start"}},void 0,a()("div",{style:{paddingTop:4,paddingRight:6}},void 0,C.Z.locked({width:12,fill:this.theme.regularInvertedTextColor})),a()("div",{},void 0,a()("div",{},void 0,a()(R.FormattedMessage,{defaultMessage:"Page properties are locked",id:"database.editProperty.databaseLocked.tooltipPart1"})),a()("div",{style:{color:this.theme.mediumInvertedTextColor}},void 0,a()(R.FormattedMessage,{defaultMessage:"Please go to {recordIconAndTitle} to unlock",id:"database.editProperty.databaseLocked.tooltipPart2",values:{recordIconAndTitle:a()("span",{style:{whiteSpace:"nowrap",fontWeight:Z.Z.fontWeight.bold}},void 0,t&&a()(lo.Z,{disabled:!0,icon:t,isEmptyPage:!1,size:12,style:{marginRight:4,display:"inline-block"}}),a()(Mt.Z,{store:e,style:{display:"inline"}}))}})))))}}renderComponent(){return a()(co.Z,{renderTooltip:this.renderParentCollectionLockedTooltip,disableTooltip:Boolean(this.props.disableTooltip),delayThreshold:300,render:e=>this.props.render(e),placement:co.Z.Placement.Left})}}ci.displayName="CollectionLockTooltip";const di=ci;var pi=o(22323),ui=o(10107),mi=o(93405),gi=o(52275),hi=o(9342),fi=o(44532),vi=o(72495),yi=o(6318),bi=o(95030),Si=o(19387);class wi extends go.Z{constructor(){super(...arguments),this.popupContainer=null,this.renderOrigin=e=>{const{property:t,schema:o,disabled:i,locked:n,canConfigureCollection:r}=this.props,{collectionContextStore:l}=this.context,c=o[t];if(!c)return;const d=null==l?void 0:l.collectionStore();if(!d||!l)return;const p={onClick:l.permissionScopes.state.canConfigureBlock?this.handleClick:s.identity};return ie.p1(d)?a()(di,{propertyName:c.name,disableTooltip:n||!d.canEditCollection(),render:s=>a()(Ci,{hideIcon:Boolean(this.props.hideIcon),schema:o,property:t,disabled:i,locked:n,canConfigureCollection:r,events:(0,si.Z)(e,(0,si.Z)(p,s))}),store:d}):a()(Ci,{hideIcon:Boolean(this.props.hideIcon),schema:o,property:t,disabled:i,locked:n,canConfigureCollection:r,events:(0,si.Z)(p,e)})},this.renderPopup=()=>{const{collectionContextStore:e}=this.context,t=null==e?void 0:e.settingsStore;if(e&&t)return c.createElement(c.Fragment,null,t.state.open?a()(pi.Z,{context:pi.H.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0}):c.createElement(ki,n()({},this.props,{popupContainer:this.popupContainer})))},this.handleMouseMove=()=>{Xo.Z.setState({...Xo.Z.state,hoveredProperty:this.props.property})},this.handleMouseLeave=()=>{Xo.Z.setState({...Xo.Z.state,hoveredProperty:void 0})},this.handleDragHandleClick=e=>{const{property:t,isInPeekRenderer:o}=this.props;ge.X9()||Xo.Z.setState({...Xo.Z.state,openProperty:{property:t,isInPeekRenderer:o}})},this.handleClick=()=>{Y.ZH(this.environment),K.ZH(this.environment),ii.wG();const{property:e,isInPeekRenderer:t}=this.props;Xo.Z.setState({...Xo.Z.state,openProperty:{property:e,isInPeekRenderer:t}})}}renderComponent(){const{property:e,schema:t,disabled:o,locked:i,canConfigureCollection:n,isInPeekRenderer:r,origin:s,hideDragHandle:l}=this.props,d=t[e],{device:p}=this.environment;if(!d)return;const{collectionContextStore:u}=this.context,m=null==u?void 0:u.collectionStore();if(!m||!u)return;const g=Xo.Z.state.hoveredProperty===e&&!Le.Z.state.isKeyboardMode&&!l,{openProperty:h}=Xo.Z.state;return a()(co.Z,{renderTooltip:()=>a()("div",{},void 0,a()("div",{},void 0,d.name),(0,f.q3)(d)&&a()("div",{style:{color:this.theme.accentColors.gray[200]}},void 0,c.createElement(R.FormattedMessage,ui.sY.keptUpToDateWithNotionAITooltip))),delayThreshold:800,placement:co.Z.Placement.Left,disableTooltip:ie.p1(m),render:t=>a()("div",{style:this.getStyle(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},e,!p.isMobile&&!o&&!(i||!n)&&!l&&a()(ut.Z,{isVisible:!0,animationStyle:{opacity:g?1:0},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>a()("div",{style:{width:qo.C$+4,marginLeft:-(qo.C$+4),...this.props.dragHandleStyle},onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,a()(qo.ZP,{disallowTabbing:!0,onClick:this.handleDragHandleClick}))}),c.createElement(fi.ZP,{style:this.props.popupStyle,popupType:p.isMobile?fi.kQ.SlideUp:fi.kQ.Popup,originGap:1,alignmentToOrigin:io.Z.Alignment.Start,render:this.renderPopup,open:Boolean(h&&h.property===e&&h.isInPeekRenderer===r),onDismiss:()=>{Xo.Z.setState({...Xo.Z.state,openProperty:void 0});const e=u.settingsStore;oi.E3({collectionSettingsStore:e})},origin:s??this.renderOrigin(t),ref:e=>{this.popupContainer=e}}))})}getStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",height:34,width:e.isMobile?120:160,flex:"none",color:this.theme.mediumTextColor,...this.props.style}}}wi.displayName="PagePropertiesRowName",wi.contextTypes={...go.w,...Q.xm};class ki extends go.Z{constructor(){super(...arguments),this.renderHideExtension=()=>{const{property:e,schema:t,format:o}=this.props,i=o.property_visibility;if(!i)return;const n=t[e];if(!n)return;const r=i.find((t=>t.property===e));return a()(yi.Z,{type:"property",propertySchema:n,visibility:(null==r?void 0:r.visibility)||"show",locked:!1,onSelect:e=>this.handleVisibilitySelectClick(e),onClose:()=>{this.handleClose()}})},this.renderShowAsExtension=(e,t)=>{const{property:o,schema:i,format:n}=this.props,r=n.collection_page_sections||[],s=i[o];if(!s)return;const l=r.findIndex((e=>e.section===o)),c=r[l];return a()(yi.Z,{type:"page",propertyType:s.type,visibility:(null==c?void 0:c.visibility)||"section_hide",visibilityLevels:["section_hide","inline","minimal"],locked:!1,onSelect:e=>{this.handleShowAsClick(e),this.handleClose()},onClose:()=>{t.close()},showAsMenu:!0})},this.getPropertyVisibility=()=>{const{property:e,schema:t,format:o}=this.props,i=o.property_visibility;if(!i)return;if(!t[e])return;const n=i.find((t=>t.property===e));return"section"!==(null==n?void 0:n.visibility)?null==n?void 0:n.visibility:void 0},this.handleShowAsClick=e=>{const{property:t,schema:o,collectionStore:i,format:n}=this.props;let r=n.collection_page_sections||[];if(!o[t])return;const a=r.findIndex((e=>e.section===t));-1!==a?r[a]={section:t,visibility:e}:r=[...r,{section:t,visibility:e}];const s="inline"===e||"minimal"===e?"section":"show";r&&(O.createAndCommit({userAction:"PagePropertiesRowName.handleShowAsClick",environment:this.environment,perform:e=>{ni.Do({environment:this.environment,pageSectionFormats:r,store:i,transaction:e}),ni.M0({property:t,visibility:s,store:i,format:n,transaction:e})}}),A.trackRelationShowAs(this.environment,{from:"relation_section",mode:"inline"===e?"page_section":"minimal"===e?"minimal_page_section":"property"}))},this.handleDuplicate=async()=>{const{property:e,collectionStore:t,format:o,schema:i}=this.props,n=o.collection_page_properties||[],r=null==t?void 0:t.getSpaceId();if(!t||!r)return;const a=await ie.xy({environment:this.environment,schema:i,properties:n,property:e,parentStore:t,spaceId:r});a&&O.createAndCommit({userAction:"PagePropertiesRowName.handleDuplicate",environment:this.environment,perform:e=>{const n={...o,collection_page_properties:a.newProperties};ii.Rm({environment:this.environment,collectionStore:t,update:{schema:{...i,[a.newProperty]:a.newPropertySchema},format:n},transaction:e}),a.automationUpdate&&ii.Ki({environment:this.environment,collectionStore:t,update:a.automationUpdate,transaction:e})}})},this.handleDelete=async()=>{const{property:e}=this.props,{collectionContextStore:t}=this.context;t&&await ti.TI({environment:this.environment,collectionContextStore:t,property:e,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme})},this.handleDeleteAccept=()=>{const{property:e,schema:t,collectionStore:o}=this.props,{collectionContextStore:i}=this.context;if(!i)return;O.createAndCommitAsync({environment:this.environment,userAction:"PagePropertiesRowName.handleDeleteAccept",waitForServerCommit:!1,perform:i=>ti.yV({environment:this.environment,collectionStore:o,schema:t,property:e,transaction:i})});const n=o.getSchema()[e];n&&ei.y9({environment:this.environment,collectionContextStore:i,property_type:n.type,from:"table_column",property:e})},this.handleClose=()=>{var e;Xo.Z.setState({...Xo.Z.state,openProperty:void 0});const t=null===(e=this.context.collectionContextStore)||void 0===e?void 0:e.settingsStore;t&&oi.E3({collectionSettingsStore:t})}}willMountOrUpdate(e){const{property:t,schema:o}=e,{collectionContextStore:i}=this.context,n=o[t];if(i&&"relation"===(null==n?void 0:n.type)){const e=li.ny(i,n);null==e||e.load()}}renderComponent(){let e;const{device:t}=this.environment;e=t.isMobile?{menuType:ue.og.ActionSheet}:{menuType:ue.og.Popup,width:220};const o=this.getMenuSections();return c.createElement(ao.Z,e,a()(hi.Z,{type:hi.i.Vertical,initialFocus:void 0,sections:s.compact(null==o?void 0:o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>c.createElement(vi.Z,n()({},e,{topBorder:0!==t})),items:e}})))}))}getMenuSections(){const{property:e,schema:t}=this.props,{environment:o}=this,{device:i}=o,r=t[e],{collectionContextStore:s}=this.context;if(!s)return;const l=s.permissionScopes.state,d=s.settingsStore,p=s.collectionStore();if(!r||!p)return[];const u=[];if(l.canConfigureCollection&&!(0,v.wl)(e)){if("relation"===r.type){const e=[{key:"Show As Property Or Section",action:()=>{},render:(e,t)=>c.createElement(bi.Z,n()({},e,{renderOrigin:e=>c.createElement(mi.Z,n()({},e,{title:a()(R.FormattedMessage,{defaultMessage:"Show as",id:"database.configureProperty.showAsAction",description:"Open up the menu to customize relation property display as section"}),svg:C.Z.collectionShow})),onFocus:t.onFocus,renderExtension:this.renderShowAsExtension}))}];u.push(e)}const t=[];u.push(t),t.push({key:"rename",render:e=>c.createElement(gi.Z,n()({},e,{title:a()(R.FormattedMessage,{defaultMessage:"Rename",id:"database.tableHeaderCell.rename"}),icon:C.Z.rename({width:14})})),action:()=>{oi.r$({collectionContextStore:s,collectionSettingsStore:d}),oi.H4({collectionSettingsStore:d,item:{type:"property",formatKey:"collection_page_properties",property:e,selectNameInitial:!i.isMobile,collectionPointer:p.pointer}})}}),t.push({key:"edit_property",render:e=>a()(co.Z,{placement:co.Z.Placement.Left,render:t=>c.createElement(gi.Z,n()({title:a()(R.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:C.Z.options({width:14})},(0,si.Z)(e,t))),style:{whiteSpace:"normal"},renderTooltip:()=>a()(R.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{oi.r$({collectionContextStore:s,collectionSettingsStore:d}),oi.H4({collectionSettingsStore:d,item:{type:"property",formatKey:"collection_page_properties",property:e,collectionPointer:p.pointer}})}})}const m=[];if(u.push(m),"title"!==r.type&&l.canConfigureBlock&&m.push({key:"Hide Property",action:()=>{},render:(e,t)=>c.createElement(bi.Z,n()({},e,{renderOrigin:e=>c.createElement(mi.Z,n()({},e,{title:a()(R.FormattedMessage,{defaultMessage:"Hide property",id:"database.configureProperty.hideAction"}),svg:C.Z.collectionHide})),onFocus:t.onFocus,renderExtension:this.renderHideExtension}))}),ai.Tr.includes(r.type)&&l.canConfigureCollection&&!(0,v.wl)(e)){(0,f.dx)(r)||m.push({key:"Duplicate Property",render:(e,t)=>c.createElement(mi.Z,n()({},e,{title:a()(R.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.configureProperty.duplicateAction"}),svg:C.Z.duplicate})),action:async()=>{this.handleClose(),await this.handleDuplicate()}});const t=p.getDatabaseType();Boolean(t&&ri.cR(t,e,p))||m.push({key:"delete",render:e=>c.createElement(gi.Z,n()({},e,{title:a()(R.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),icon:C.Z.trash({width:14}),hoveredStyle:{color:Ho.ZP.red,fill:Ho.ZP.red}})),action:async()=>{this.handleClose(),await this.handleDelete()}})}const g=[{key:"customizePage",action:()=>{this.handleClose();const e=Qo.findDOMNode(this.props.popupContainer);if(e&&e instanceof Element){const t=e.getBoundingClientRect();ni.bA({originRect:t})}},render:(e,t)=>c.createElement(mi.Z,n()({},e,{title:a()(R.FormattedMessage,{defaultMessage:"Customize page",id:"pageProperties.editProperty.customizePage.label",description:"Menu item label for customizing page property visibility"}),svg:C.Z.customizePage}))}];return u.push(g),u}handleVisibilitySelectClick(e){const{property:t,format:o,collectionStore:i}=this.props;O.createAndCommit({userAction:"CustomizePageMenu.handleShowAsClick",environment:this.environment,perform:n=>{ni.M0({property:t,visibility:e,format:o,store:i,transaction:n})}})}}function Ci(e){window.__c={n:"PagePropertyRowNameLabel"};const{schema:t,property:o,disabled:i,locked:r,canConfigureCollection:s,events:l}=e,d=t[o];return d?c.createElement(_o.Z,n()({style:{display:"flex",alignItems:"center",height:"100%",width:"100%",borderRadius:3,padding:"0 6px"},disabled:i||r||!s},l),a()(Si.Z,{propertySchema:d,showIcon:!e.hideIcon,showBadge:!0,style:{fontSize:14},property:o})):null}ki.displayName="PagePropertiesRowNameMenu",ki.contextTypes={...go.w,...Q.xm};const _i=(0,R.injectIntl)(wi);var Mi=o(75259),Ti=o(71165);class Ii extends go.Z{constructor(){super(...arguments),this.handleMouseMove=()=>{Xo.Z.setState({...Xo.Z.state,hoveredProperty:this.props.property})},this.handleMouseLeave=()=>{Xo.Z.setState({...Xo.Z.state,hoveredProperty:void 0})},this.handleOpenProperty=e=>{L.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:e,format:nt.C.Page,collectionContextStore:this.context.collectionContextStore})}}renderComponent(){var e;const{property:t,store:o,disabled:i,canConfigureCollection:n,onTab:r,onUntab:s,schema:c,blockPropertyValueOverlayStore:d,collectionStore:p}=this.props,u=null===(e=c[t])||void 0===e?void 0:e.type,{device:m}=this.environment,g=c[t],h=m.isMobile&&!i&&!l().isUndefined(g)&&o.isDefined()&&"relation"===u&&!v.wV({block:o.getModel(),property:t,schema:c,getRecordModel:o.getRecordModel,userTimeZone:(0,k.r)(),intl:de.default.getIntl()}),f=a()(gi.Z,{focused:!1,icon:C.Z.plus({width:16,fill:this.theme.lightIconColor,marginRight:2,marginLeft:-2}),buttonStyle:{marginRight:0,width:"calc(100% - 4px)"},style:this.getAddPageButttonStyle(),title:a()(R.FormattedMessage,{id:"pagePropertyRowValue.addRelationButtonMessage",defaultMessage:"Add page",description:"Button to add a relation"}),onClick:()=>this.handleOpenProperty(t)});return a()("div",{style:Ii.outerStyle},void 0,a()("div",{style:Ii.style,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},t,a()(Mi.Z,{store:o,property:t,locked:!n,disabled:i,format:nt.C.Page,onTab:r,onUntab:s,tableWrap:!1,blockPropertyValueOverlayStore:d,onOpenProperty:this.handleOpenProperty,showRelationTooltip:!0,collectionStore:p})),h&&f)}getAddPageButttonStyle(){const{device:e}=this.environment;return{fontSize:e.isMobile?16:14,minHeight:Ti.w,color:this.theme.lightTextColor,background:void 0,boxShadow:void 0}}}Ii.displayName="PagePropertiesRowValue",Ii.contextTypes={...go.w,...Q.xm},Ii.style={display:"flex",alignItems:"center",marginLeft:4,height:"100%",flex:"auto",minWidth:0},Ii.outerStyle={display:"flex",alignItems:"left",marginLeft:4,height:"100%",flex:"auto",flexDirection:"column",minWidth:0};const Pi=Ii;function xi(e){window.__c={n:"PagePropertyRow"};const{schema:t,format:o,store:i,collectionStore:n,disabled:r,locked:s,blockPropertyValueOverlayStore:p,isInPeekRenderer:u,property:m,mergedProperties:g,dragHandleStyle:h}=e,f=(0,lt.O7)(),v=(0,Q.Y$)(),y=Jo(n),b=(0,c.useCallback)((()=>{const e=p.state;if(!e.isOpen)return;const o=g,n=o.findIndex((t=>t.property===e.property)),r=o.find(((e,o)=>o>n&&Bi(t,e.property)))||o.find(((e,o)=>Bi(t,e.property)));r&&d.default.afterNextFlush((()=>{L.bA({environment:f,blockPropertyValueOverlayStore:p,store:i,property:r.property,format:nt.C.Page,collectionContextStore:v})})),L.xv({environment:f,blockPropertyValueOverlayStore:p})}),[p,v,f,g,t,i]),S=(0,c.useCallback)((()=>{const e=p.state;if(!e.isOpen)return;const o=g,n=o.findIndex((t=>t.property===e.property)),r=l().findLast(o,((e,o)=>o<n&&Bi(t,e.property)))||l().findLast(o,((e,o)=>Bi(t,e.property)));r&&d.default.afterNextFlush((()=>{L.bA({environment:f,blockPropertyValueOverlayStore:p,store:i,property:r.property,format:nt.C.Page,collectionContextStore:v})})),L.xv({environment:f,blockPropertyValueOverlayStore:p})}),[p,v,f,g,t,i]);return a()("div",{style:{display:"flex",paddingBottom:4,width:"100%"}},m,a()(_i,{schema:t,format:o,property:m,collectionStore:n,disabled:r,locked:s,canConfigureCollection:y,isInPeekRenderer:u,dragHandleStyle:h}),a()(Pi,{schema:t,property:m,store:i,collectionStore:n,disabled:r||s,canConfigureCollection:y,onTab:b,onUntab:S,blockPropertyValueOverlayStore:p}))}function Bi(e,t){const o=e[t];return Boolean(o&&!f.uk.includes(o.type))}function Zi(e){const{disabled:t,locked:o,collectionStore:i,format:r,mergedProperties:s,showHiddenProperties:d}=e,p=(0,lt.O7)(),u=s,m=Jo(i),g=u.filter((e=>"section"!==e.visibility&&(!!d||"hide"!==e.visibility&&!("hide_if_empty"===e.visibility&&!e.hasValue)))).map((e=>e.property)),h=(0,c.useCallback)((e=>{const t=r.collection_page_properties||[],o=[...l().compact(e.map((e=>t.find((t=>t.property===e))))),...t.filter((t=>!e.includes(t.property)))];O.createAndCommit({userAction:"PageProperties.handleReorder",environment:p,perform:e=>{V.FH({stores:[i],update:{collection_page_properties:o},transaction:e})}})}),[i,p,r.collection_page_properties]);return t||o||!m?a()("div",{style:$o.yA},void 0,g.map(((t,o)=>a()("div",{},o,c.createElement(xi,n()({},e,{property:t})))))):a()($o.ZP,{direction:"vertical",keys:g,renderKey:t=>c.createElement(xi,n()({},e,{property:t})),onDrop:h})}var Ei=o(1743);function Ri(e){const{locked:t,disabled:o,collectionStore:i,mergedProperties:n,schema:r,isCompact:s}=e,l=(0,ct.VK)((()=>Xo.Z.state.forceShowProperties),[]),d=Vi(n,r,s),p=Jo(i),u=[];return(l||0===d)&&(!t&&!o&&p)&&u.push(c.createElement(Ai,e)),d>0&&(l?u.push(a()(Fi,{mergedProperties:n,schema:r,isCompact:s})):u.push(a()(Di,{mergedProperties:n,schema:r,isCompact:s}))),c.createElement(c.Fragment,null,u)}function Ai(e){window.__c={n:"AddPropertyButton"};const{collectionStore:t,isInPeekRenderer:o}=e,i=(0,Q.Y$)(),r=(0,lt.O7)(),s=(0,ct.qz)(void 0,xe.Z),l=Li(),d=(0,ct.VK)((()=>i.settingsStore.state.open),[i.settingsStore]);(0,c.useEffect)((()=>{d||s.setState({...s,open:!1})}),[s,d]);const p=(0,c.useCallback)((()=>{ti.fH({environment:r,collectionContextStore:i,collectionStore:t,isInPeekRenderer:o,onCloseMenu:()=>{s.setState({open:!1})}})}),[s,i,t,r,o]);return a()("div",{style:{display:"flex"}},void 0,a()(io.Z,{popupType:r.device.isMobile?fi.kQ.SlideUp:fi.kQ.Popup,buttonPopupStore:s,originGap:1,alignmentToOrigin:io.Z.Alignment.Start,render:()=>a()(pi.Z,{context:pi.H.TopbarFilterPopup,collectionContextStore:i,collectionSettingsStore:i.settingsStore,hideDesktopHeader:!0}),onClick:p,onDismiss:()=>{const e=i.settingsStore;oi.E3({collectionSettingsStore:e})},renderOrigin:t=>c.createElement(_o.Z,n()({style:{...l.AddOrTogglePropertyButtonStyle,...e.style}},t),C.Z.plus(l.ActionPropertyButtonIconStyle),a()("div",{style:l.AddPropertyButtonTitleStyle},void 0,a()(R.FormattedMessage,{defaultMessage:"Add a property",id:"database.pageProperties.addPropertyButtonTitle"})))}))}function Di(e){window.__c={n:"ShowMoreButton"};const{mergedProperties:t,schema:o,isCompact:i}=e,n=Li(),r=Vi(t,o,i),s=(0,c.useCallback)((()=>{Xo.Z.setState({...Xo.Z.state,forceShowProperties:!0})}),[]);return a()("div",{style:{display:"flex"}},void 0,a()(_o.Z,{style:{...n.AddOrTogglePropertyButtonStyle,...e.style},onClick:s},"show-more",C.Z.chevronDownThin(n.ActionPropertyButtonIconStyle),a()("div",{style:n.AddPropertyButtonTitleStyle},void 0,a()(R.FormattedMessage,{defaultMessage:"{num, plural, one {1 more property} other {{num} more properties}}",id:"database.pageProperties.showMorePropertyTitle",values:{num:r}}))))}function Fi(e){window.__c={n:"HidePropertiesButton"};const{mergedProperties:t,schema:o,isCompact:i}=e,n=Vi(t,o,i),r=Li(e.style),s=(0,c.useCallback)((()=>{Xo.Z.setState({...Xo.Z.state,forceShowProperties:!1})}),[]);return a()("div",{style:{display:"flex"}},void 0,a()(_o.Z,{style:{...r.AddOrTogglePropertyButtonStyle,...e.style},onClick:s},"hide-properties",C.Z.chevronDownThin({...r.ActionPropertyButtonIconStyle,transform:"rotate(180deg)"}),a()("div",{style:r.AddPropertyButtonTitleStyle},void 0,a()(R.FormattedMessage,{defaultMessage:"{num, plural, one {Hide 1 property} other {Hide {num} properties}}",id:"database.pageProperties.hidePropertyTitle",values:{num:n}}))))}function Li(e){const t=(0,lt.O7)();return(0,dt.yK)((o=>{const{device:i}=t;return{AddOrTogglePropertyButtonStyle:{display:"flex",alignItems:"center",color:o.lightTextColor,borderRadius:3,paddingLeft:6,paddingRight:6,height:34,width:i.isMobile?"100%":"auto",...e},ActionPropertyButtonIconStyle:{width:16,height:16,marginRight:9,marginTop:1,fill:o.lightIconColor},AddPropertyButtonTitleStyle:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0,lineHeight:"16px"}}}),[t,e])}function Vi(e,t,o){return(0,c.useMemo)((()=>e.filter((e=>"hide"===e.visibility||"hide_if_empty"===e.visibility&&!e.hasValue)).length),[e])}function Ni(e){window.__c={n:"PagePropertiesCompact"};const{store:t,collectionStore:o,blockPropertyValueOverlayStore:i,compactProperties:n,disabled:r,locked:s,format:l,isInPeekRenderer:d,hiddenProperties:p}=e,u=(0,ct.VK)((()=>o.getSchema()),[o]),[m,g]=(0,c.useState)(!1),h=Jo(o),f=(0,lt.Fy)(),v=(0,ct.qz)(void 0,xe.Z),y=(0,dt.yK)((()=>({PagePropertiesCompactRow:{display:n.length>=5?"grid":"flex",justifyContent:"flex-start",gridTemplateColumns:"repeat(5, 1fr)",columnGap:10,rowGap:2,marginTop:2,marginBottom:6}})),[n.length]),b=(0,c.useCallback)((()=>{g(!0)}),[]),S=(0,c.useCallback)((()=>{g(!1)}),[]);return a()("div",{style:y.PagePropertiesCompactRow,onMouseEnter:b,onMouseLeave:S},void 0,n.map(((e,c)=>{const g=c===n.length-1;return a()("span",{style:{minWidth:100,flexShrink:1,display:g?"flex":void 0}},e.property,a()("span",{style:{flex:1,overflow:"hidden"}},void 0,a()(_i,{schema:u,format:l,hideIcon:!0,hideDragHandle:!0,property:e.property,collectionStore:o,disabled:r,locked:s,canConfigureCollection:h,isInPeekRenderer:d,style:{height:22,width:"100%"}}),a()(Mi.Z,{store:t,collectionStore:o,blockPropertyValueOverlayStore:i,property:e.property,format:nt.C.CompactPage,disabled:r,locked:s,tableWrap:!1})),g&&a()(ut.Z,{isVisible:m||f.isMobile,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1,marginLeft:"auto"},exitAnimationStyle:{opacity:0},render:()=>a()(Oi,{onClose:S,hiddenProperties:p,canConfigureCollection:h,store:t,collectionStore:o,blockPropertyValueOverlayStore:i,disabled:r,locked:s,isInPeekRenderer:d,format:l,buttonPopupStore:v})}))})))}function Oi(e){const{hiddenProperties:t,canConfigureCollection:o,collectionStore:i,isInPeekRenderer:r,buttonPopupStore:s}=e,l=(0,lt.Fy)(),d=(0,lt.O7)(),p=(0,Q.Y$)(),u=(0,ct.VK)((()=>i.getSchema()),[i]),m=(0,dt.yK)((e=>({overflowIcon:{width:16,height:16,fill:e.mediumIconColor},pagePropertiesOverflow:{width:"100%",fontSize:14,padding:10,marginLeft:18},overflowButtonWrapper:{display:"flex",alignItems:"center",paddingBottom:8},overflowButton:{display:"flex",width:32,height:32,borderRadius:3,justifyContent:"center",alignItems:"center"}})),[]),g=(0,c.useCallback)((()=>{ti.fH({environment:d,collectionContextStore:p,collectionStore:i,isInPeekRenderer:r,onCloseMenu:()=>{s.setState({open:!1})}})}),[d,p,i,r,s]);return t.length?a()(io.Z,{onClose:e.onClose,popupWrapStyle:{width:500},buttonPopupStore:s,popupType:l.isMobile?fi.kQ.SlideUp:fi.kQ.Popup,render:function(){return a()(Ei.Z,{capture:!0},void 0,a()("div",{style:m.pagePropertiesOverflow},void 0,a()(Zi,{showHiddenProperties:!0,schema:u,mergedProperties:t,format:e.format,store:e.store,collectionStore:e.collectionStore,disabled:e.disabled,locked:e.locked,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,isInPeekRenderer:e.isInPeekRenderer}),o&&a()(Ai,{collectionStore:i,isInPeekRenderer:r})))},renderOrigin:e=>a()("div",{style:m.overflowButtonWrapper},void 0,a()(co.Z,{renderTooltip:()=>a()(R.FormattedMessage,{defaultMessage:"{num, plural, one {1 more property} other {{num} more properties}}",description:"Button to indicate there are hidden properties that can be shown",id:"database.pageProperties.compact.showMoreTooltip",values:{num:t.length}}),placement:co.Z.Placement.Bottom,render:t=>c.createElement(_o.Z,n()({style:m.overflowButton,mobileFeedback:l.isMobile},(0,si.Z)(e,t)),C.Z.dots(m.overflowIcon))}))}):o?a()("div",{style:m.overflowButtonWrapper},void 0,a()(co.Z,{renderTooltip:()=>a()(R.FormattedMessage,{defaultMessage:"Add a property",description:"Button that shows when there are no hidden properties to add an additional one",id:"database.pageProperties.compact.addPropertyButtonTitle"}),placement:co.Z.Placement.Bottom,render:t=>a()(io.Z,{popupType:d.device.isMobile?fi.kQ.SlideUp:fi.kQ.Popup,onClose:e.onClose,buttonPopupStore:s,originGap:1,alignmentToOrigin:io.Z.Alignment.Start,render:()=>a()(pi.Z,{context:pi.H.TopbarFilterPopup,collectionContextStore:p,collectionSettingsStore:p.settingsStore,hideDesktopHeader:!0}),onClick:g,onDismiss:()=>{const e=p.settingsStore;oi.E3({collectionSettingsStore:e})},renderOrigin:e=>c.createElement(_o.Z,n()({style:m.overflowButton,mobileFeedback:l.isMobile},(0,si.Z)(e,t)),C.Z.plus(m.overflowIcon))})})):null}function Ui(e){window.__c={n:"PagePropertiesSection"};const{collectionStore:t,schema:o,store:i,format:r}=e,s=(0,R.useIntl)(),d=(0,lt.O7)(),p=(0,ct.qz)(void 0,Ne.Z),u=(0,dt.yK)((e=>({pageProperties:{width:"100%",fontSize:14},dragHandle:{marginLeft:-(qo.C$+10),marginRight:6},hidePropertiesButton:{margin:"0 0 10px"},showMoreButton:{margin:0},addPropertyButton:{margin:"4px 0 0"},moreProperties:{border:`1px solid ${"dark"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[75]}`,borderRadius:4,padding:"8px 6px"}})),[]),m=(0,ct.VK)((()=>Boolean(i.isAssociatedCollectionAPageTree())),[i]),g=(r.collection_page_properties||[]).filter((e=>{var t;return null===(t=r.collection_page_sections)||void 0===t||!t.some((t=>t.section===e.property&&("inline"===t.visibility||"minimal"===t.visibility)))})),h=(0,ct.VK)((()=>{const e=i.getValue(),n="on"===Ae.default.getGroup("default-new-page-property-to-hide-when-empty")?w.iB(r,o,void 0,w.j5.Collection):t.getFormat(),a=n&&n.property_visibility;if(a){return g.map((t=>({visibility:"show",hasValue:!Boolean(e&&(0,v.no)({block:e,property:t.property,schema:o,getRecordValue:i.getRecordValue,userTimeZone:(0,k.r)(),intl:s})),...t,...a.find((e=>e.property===t.property))})))}return g?g.map((e=>({...e,visibility:"show",hasValue:Boolean(i.getPropertyValue(e.property))}))):[]}),[i,r,o,t,g,s]),f=(0,ct.VK)((()=>Xo.Z.state.forceShowProperties),[]),[y,b]=(0,c.useMemo)((()=>l().partition(h,(e=>{var t;return!!(null===(t=o[e.property])||void 0===t?void 0:t.type)&&function(e){if("section"===e.visibility)return!1;if("hide"===e.visibility)return!1;if("hide_if_empty"===e.visibility&&!e.hasValue)return!1;return!0}(e)}))),[h,o]),S=y.concat(b),{paddingLeft:C,paddingRight:_,width:M}=e;let T;return T=m&&!d.device.isMobile?c.createElement(Ni,n()({},e,{compactProperties:y,hiddenProperties:b})):a()("div",{style:{paddingBottom:8}},void 0,c.createElement(Zi,n()({},e,{showHiddenProperties:f,mergedProperties:m?S:h})),c.createElement(Ri,n()({},e,{mergedProperties:m?S:h}))),a()("div",{style:u.pageProperties,onMouseEnter:()=>{p.setState({...p.state,mouseEntered:!0})},onMouseLeave:()=>{p.setState({...p.state,mouseEntered:!1})}},void 0,a()("div",{style:{paddingLeft:C,paddingRight:_,width:M,maxWidth:"100%",padding:m?"10px 0":"8px 0",margin:"0 auto"}},void 0,a()("div",{style:{paddingLeft:C,paddingRight:_,width:M,maxWidth:"100%",paddingTop:"8px",margin:"0 auto"}},void 0,T)))}var Hi=o(39068),zi=o(84619),Wi=o(4615),ji=o(31869),Ki=o(98834),Yi=o(60971),Gi=o(49616),Xi=o(75079),qi=o(70219),$i=o(86098),Ji=o(45452),Qi=o(23049),en=o(68139),tn=o(75203);class on extends go.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:Ve.Z,customTokenLimit:Qe.default.of(10),draggableListStore:Ji.Z},this.getRelationMenuRows=(e,t,o,i,r,a)=>{const{store:s,collectionStore:l,disabled:d,property:p,locked:u}=this.props;return e.reduce(((e,m,g)=>{const h=qe.G.createChildStore(s,m),v=h.getAssociatedCollectionStore();if((null==v?void 0:v.id)===f.F0(t)){const m={key:h.id,render:e=>c.createElement(en.Z,n()({},e,{canDrag:r&&s.canEdit(),collectionStore:l,targetCollectionStore:o,relatedPageStore:h,disabled:d,canConfigureCollection:a,locked:u,isSelected:!0,pageStore:s,property:p,rowType:"section",onActionButtonClick:()=>this.handleRemoveRelationClick(i,h,o),onMouseLeave:()=>this.stores.menuListStore.unsetFocus(),onSecondaryButtonClick:()=>this.handleCreateNewRelation(g+1,o,"relation_section_inline"),onInsertInline:()=>this.handleCreateNewRelation(g+1,o,"relation_section_inline"),onOpenPageButtonClick:()=>{this.handleSelectedPageClick(i,h)},index:g+1,propertyLimit:t.limit})),action:e=>{}};e.push(m)}return e}),[])},this.relationValueStore=this.createComputedStore((()=>{const{store:e,schema:t,property:o}=this.props,i=t[o];if(!i||"relation"!==i.type)return[];const n=e.getPropertyValue(o);return v.j$({relationValue:v.rq(n),propertySchema:i,getRecordValue:e.getRecordValue})}),!0),this.numberOfRelations=this.createComputedStore((()=>this.relationValueStore.state.length)),this.handleRemoveRelationClick=(e,t,o)=>{var i;const{store:n,schema:r,property:a,blockPropertyValueOverlayStore:s}=this.props,{collectionContextStore:l}=this.context,c=r[a];if("relation"!==(null==c?void 0:c.type)||!l)return;const d=c.limit?[]:e.filter((e=>e.id!==t.id)),p=n.getPropertyStore(a);O.createAndCommit({userAction:"RelationSection.handleRemoveRelationClick",environment:this.environment,perform:e=>{ji.sf({store:n,propertyStore:p,value:d,environment:this.environment,relatedPageId:t.id,propertySchema:c,transaction:e,collectionContextStore:l,analyticsData:{isFromBulkActionsToolbar:Gi.VM(s),analyticsFrom:Gi.Sy(nt.C.Page)},isUnthrottled:!1})}}),A.trackRelationRemoveBlock(this.environment,{from:this.props.analyticsFrom,collection_id:null===(i=this.props.collectionStore)||void 0===i?void 0:i.id,target_collection_id:null==o?void 0:o.id})},this.handleDraggableListDrop=(e,t)=>{const{menuListStore:o}=this.stores,{collectionStore:i,schema:n,property:r,store:a}=this.props,s=n[r];if(!s||"relation"!==s.type)return;const l=f.j0(s);if(!l)return;const c=qe.NW.createChildStore(a,l);if(!(0,ve.NZ)(a)||!this.props.property)return;const d=a.getPropertyValue(this.props.property),p=v.j$({relationValue:v.rq(d),propertySchema:s,getRecordValue:a.getRecordValue}),u=[...e.map((e=>({id:e,spaceId:i.pointer.spaceId,table:kt.iU}))),...p.slice(e.length)];this.handleRelationPropertyMenuUpdate({value:u},c),A.trackRelationReorder(this.environment,{from:this.props.analyticsFrom}),Yi.sv({store:o,focus:{section:0,indexLocal:t.endPosition,indexGlobal:t.endPosition}})},this.handleOpenProperty=(e,t,o)=>{const{blockPropertyValueOverlayStore:i,store:n,property:r}=this.props,{collectionContextStore:a}=this.context,s=Qo.findDOMNode(this.relationPropertyPageSectionRef);if(!(s&&s instanceof Element))return;const l=o?null==o?void 0:o.getBoundingClientRect():s.getBoundingClientRect(),c=e?l.top+li.Mu:l.top+5,d=new DOMRect(l.left,c,l.width,l.height);L.bA({environment:this.environment,blockPropertyValueOverlayStore:i,store:n,property:r,rect:d,format:nt.C.Page,mode:t,collectionContextStore:a}),A.trackRelationSectionLinkButton(this.environment,{from:this.props.analyticsFrom})},this.maybeOverwriteBaseUrlFromSpaceId=(0,qi.b)(this.environment),this.handleSelectedPageClick=(e,t,o)=>{const{mainEditorCurrentBlockStore:i}=Pe.default.state;if(!i)return;const n=e.find((e=>e.id===t.id));if(!n)return;let r;if(o){const e=qe.G.createChildStore(i,n).getModel(),t=e?this.maybeOverwriteBaseUrlFromSpaceId(e.getSpaceId()):void 0;r=(0,y.Z)({pageId:n.id,pageModel:e,baseUrl:t})}else{const e=i.getModel(),t=e?this.maybeOverwriteBaseUrlFromSpaceId(e.getSpaceId()):void 0;r=(0,y.Z)({pageId:i.id,pageModel:e,baseUrl:t,peekViewBlockId:n.id,peekMode:(0,Ge.getUrlParamFromPeekMode)(Ge.default.state.mode)}),A.trackRelationNavigateBlock(this.environment,{from:"relation_section",meta_click:Boolean(o)})}j.navigate({environment:this.environment,url:r,openInNew:o})},this.handleRelationPropertyPageSectionRefMount=e=>{e&&(this.relationPropertyPageSectionRef=e)},this.handleCreateNewRelation=(e,t,o)=>{const{store:i,schema:n,property:r,collectionStore:a}=this.props,{collectionContextStore:s}=this.context;if(!r)return;const l=n[r];if(!l||"relation"!==l.type)return;if(!i.canEdit())return;const c=(0,Wi.ZP)(),d=a.pointer.spaceId,p=l.limit,u={id:c,table:kt.iU,spaceId:d};if(!(0,ve.NZ)(i)||!this.props.property)return;const m=i.getPropertyValue(this.props.property),g=v.j$({relationValue:v.rq(m),propertySchema:l,getRecordValue:i.getRecordValue}),{customTokenLimit:h}=this.stores,f=h.get();e&&e+1>f&&h.set(e+1);const y=p?[u]:e?[...g.slice(0,e),u,...g.slice(e)]:[u,...g];this.handleRelationPropertyMenuUpdate({newPage:{id:c,spaceId:d,name:""},value:y},t),A.trackRelationCreateBlock(this.environment,{...(0,Xi.Pn)(s),from:o,target_collection_id:null==t?void 0:t.id})},this.handleRelationPropertyMenuUpdate=(e,t)=>{const{store:o,property:i}=this.props;if(!(0,ve.NZ)(o)||!i)return;let n;O.createAndCommit({userAction:"RelationToken.handleRelationPropertyMenuUpdate",environment:this.environment,perform:r=>{const a=t.id;if(e.newPage&&a){const o=x.TP(e.newPage.name),i={id:e.newPage.id,version:0,type:h.Ti.page,parent_id:a,parent_table:T.v,alive:!0,properties:{title:o},collection_id:void 0,space_id:e.newPage.spaceId};n=W.ae({environment:this.environment,table:kt.iU,value:i,inMemoryRecordCache:t.inMemoryRecordCache,transaction:r});const s=qe.G.createChildStore(this.props.store,n.pointer),l=t.getDefaultTemplatePageStore();l&&Ki.ob({title:{text:o},environment:this.environment,store:s,templateStore:l,isKeyboard:!1,isCreateIn:!1,transaction:r,from:"relation_property_page_section"})}if(e.value){const t=v.ow(e.value),n=o.getPropertyStore(i);W.sO({store:n,value:t,transaction:r})}}}),d.default.afterNextFlush((()=>{if(!n)return;const e=$i.Z.findRow(n.id,"section",i);if(!e)return;const t=e.relationTokenBlockStoreRef.current;if(!t)return;const o=t.getBlockTitleStore(),r=o.getValue(),a=r?r[0][0].length:0,s={start:{index:a,store:o},end:{index:a,store:o}};Y.NA({multiSelection:s})}))}}renderComponent(){const{schema:e,format:t,locked:o,property:i,collectionStore:r,store:s,disabled:l,visibility:d,isInPeekRenderer:p}=this.props,{device:u}=this.environment,{collectionContextStore:m}=this.context,g=e[i];if("relation"!==(null==g?void 0:g.type)||!m)return;const h=f.j0(g);if(!h)return;const v=qe.NW.createChildStore(s,h),y=m.permissionScopes.state,b=this.relationValueStore.state,{customTokenLimit:S}=this.stores,w=S.get(),k=b.slice(0,w);if("section_hide"===d)return;if("minimal"===d||0===this.numberOfRelations.state)return a()(nn,{property:i,propertySchema:g,numberOfRelations:this.numberOfRelations.state,onHandleOpenProperty:this.handleOpenProperty,onHandleRelationPropertyPageSectionRefMount:this.handleRelationPropertyPageSectionRefMount,schema:e,format:t,disabled:l,locked:o,canConfigureCollection:y.canConfigureCollection,collectionStore:r,collectionContextStore:m,isInPeekRenderer:p});const _=1===g.limit,M=!(u.isMobile||l||o||_),T=this.getRelationMenuRows(k,g,v,b,M,y.canConfigureCollection),I=T.map((e=>e.key.toString())),P=a()(hi.Z,{type:hi.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,disableKeyboard:!0,style:{width:"100%"},sections:[{key:"section",render:e=>c.createElement(vi.Z,n()({},e,{disableDesktopPadding:!0,disableMobileBorders:!0}),M?a()($o.ZP,{direction:"vertical",keys:I,renderKey:t=>e.children[I.indexOf(t)],onDrop:this.handleDraggableListDrop,store:this.stores.draggableListStore}):e.children),items:T}]}),x=v.canEdit(),B=s.canEdit(),Z={maxWidth:u.isMobile?"none":300,...!u.isMobile&&{width:"auto"},...u.isMobile&&{paddingLeft:"none"}};return a()(rn,{collectionContextStore:m,title:a()(wi,{schema:e,format:t,property:i,collectionStore:r,disabled:l,locked:o,canConfigureCollection:y.canConfigureCollection,intl:de.default.getIntl(),style:Z,popupStyle:Z,isInPeekRenderer:p}),collectionStore:r,targetCollectionStore:v,property:i,showRight:!0,disabled:l,schema:e,format:t,locked:o,canEditTargetCollection:v.canEdit(),canConfigureCollection:y.canConfigureCollection,canEditCurrentPage:B,handleMouseMove:this.props.handleMouseMove,onHandleOpenProperty:()=>{this.handleOpenProperty(!1,{type:"add",index:this.numberOfRelations.state})},onHandleRelationPropertyPageSectionRefMount:this.handleRelationPropertyPageSectionRefMount,onTitleEnter:()=>this.handleCreateNewRelation(void 0,v,"relation_section_inline")},i,a()("div",{style:{...this.getRelationRowWrapStyle(),...u.isMobile&&{paddingLeft:"none"}},onMouseMove:this.props.handleMouseMove,onMouseLeave:this.props.handleMouseLeave},void 0,P,b.length>w&&a()(_o.Z,{style:this.getShowMoreButtonStyle(),onClick:()=>S.set(w+10)},void 0,a()(Qi.Z,{count:b.length-w,format:zi.l.Medium,style:{margin:void 0},fixedHeight:!1,isCompact:!1})),x&&B&&a()(_o.Z,{style:this.getAddNewRelationButtonWrapperStyle(),onClick:()=>{this.handleCreateNewRelation(b.length>=w?w:b.length+1,v,"relation_section_footer")},disabled:l},void 0,1===g.limit?C.Z.replace(this.getAddNewRelationButtonIconStyle()):C.Z.plus(this.getAddNewRelationButtonIconStyle()),a()("div",{style:on.addNewRelationButtonTitleStyle},void 0,1===g.limit?a()(R.FormattedMessage,{id:"RelationPropertyPageSection.button.replacePage",defaultMessage:"Replace linked page from {propertyName}",description:"Button to create new linked page in the related database that will be added and displayed in this relation section when the relation limit is 1",values:{propertyName:g.name}}):a()(R.FormattedMessage,{id:"RelationPropertyPageSection.button.addPage",defaultMessage:"New page in {propertyName}",description:"Button to create new linked page in the related database that will be added and displayed in this relation section",values:{propertyName:g.name}})))))}getRelationRowWrapStyle(){return{flex:1,minWidth:0,display:"flex",flexWrap:"wrap",flexDirection:"column",paddingBottom:"12px",paddingTop:"12px",width:"100%"}}getShowMoreButtonStyle(){return{width:"100%",display:"flex",alignItems:"center",borderRadius:3,fontSize:14,minHeight:30,margin:0,padding:"6px 8px 7px 8px"}}getAddNewRelationButtonWrapperStyle(){return{display:"flex",alignItems:"center",color:this.theme.lightTextColor,borderRadius:3,paddingLeft:4,paddingRight:6,height:32,width:"100%",fontSize:14}}getAddNewRelationButtonIconStyle(){return{width:16,height:16,marginRight:9,marginTop:1,fill:this.theme.lightIconColor}}}function nn(e){window.__c={n:"RelationPropertyMinimalPageSection"};const{property:t,propertySchema:o,numberOfRelations:i,schema:n,format:r,disabled:s,locked:l,canConfigureCollection:d,collectionStore:p,onHandleOpenProperty:u,onHandleRelationPropertyPageSectionRefMount:m,isInPeekRenderer:g}=e,h=(0,dt.yK)((e=>({hoverButton:{display:"flex",alignItems:"baseline",justifyContent:"normal",color:e.mediumTextColor,width:"100%"},minimalButton:{display:"inline-flex",alignItems:"center",flexShrink:0,whiteSpace:"nowrap",height:28,borderRadius:3,fontSize:14,lineHeight:1.2,minWidth:0,paddingLeft:6,paddingRight:8,fontWeight:Z.Z.fontWeight.medium,color:e.mediumTextColor},minimalButtonWrapper:{width:"100%",maxWidth:"100%",fontWeight:Z.Z.fontWeight.medium,color:e.mediumTextColor},iconStyle:{width:14,height:14,fill:e.mediumIconColor,marginRight:6,alignItems:"baseline"},pagePropertiesRowName:{width:"100%",display:"inline-flex",flexWrap:"wrap"}})),[]),f=(0,dt.Fg)(),v=(0,c.useCallback)((()=>{Xo.Z.setState({...Xo.Z.state,hoveredProperty:t})}),[t]),y=(0,c.useCallback)((()=>{Xo.Z.setState({...Xo.Z.state,hoveredProperty:void 0})}),[]);return a()("div",{style:h.hoverButton,onMouseMove:v,onMouseLeave:y},void 0,a()(wi,{schema:n,format:r,property:t,collectionStore:p,disabled:s,locked:l,canConfigureCollection:d,intl:de.default.getIntl(),style:h.pagePropertiesRowName,popupStyle:h.pagePropertiesRowName,origin:c.createElement("div",{ref:m,style:h.minimalButtonWrapper},a()(_o.Z,{style:h.minimalButton,onClick:()=>u(!0),onContextMenu:e=>{s||l||!d||(e.preventDefault(),Xo.Z.setState({...Xo.Z.state,openProperty:{property:t,isInPeekRenderer:g}}))}},`minimal-section-${t}`,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(Hi.ZP,{size:14,style:h.iconStyle,theme:f,type:o.type??"relation",icon:o.icon}),0===i&&a()(R.FormattedMessage,{id:"RelationPropertyPageSection.show.zeroMinimalRelations",defaultMessage:"Add {propertyName}",description:"Shows a message to add a relation when there are no linked pages in this relation section",values:{propertyName:o.name}}),1===i&&a()(R.FormattedMessage,{id:"RelationPropertyPageSection.show.oneMinimalRelation",defaultMessage:"1 {propertyName}",description:"Shows a message with the number of linked pages for the relation when there is only one linked page in this relation section",values:{propertyName:o.name}}),i>1&&a()(R.FormattedMessage,{id:"RelationPropertyPageSection.show.manyMinimalRelations",defaultMessage:"{numberOfRelations} {propertyName}",description:"Shows the number of linked pages that exist in this relation section",values:{numberOfRelations:i,propertyName:o.name}})))),hideDragHandle:!0,isInPeekRenderer:g}))}function rn(e){window.__c={n:"RelationPropertyPageSectionHeader"};const{collectionStore:t,targetCollectionStore:o,property:i,showRight:r,disabled:s,style:l,children:d,canEditTargetCollection:p,canConfigureCollection:u,canEditCurrentPage:m,handleMouseMove:g,onHandleOpenProperty:h,onHandleRelationPropertyPageSectionRefMount:v,onTitleEnter:y}=e,b=(0,ct.VK)((()=>o.isSyncedCollection()),[o]),S=(0,ct.VK)((()=>{const e=t.getSchema()[i];return Boolean(e&&f.NK(e))}),[t,i]);return c.createElement("div",{style:{width:"100%"},ref:v},c.createElement(vi.Z,n()({},e,{topBorder:!0,children:d,noTextOverflow:!0,isTitleUppercase:!1,right:r&&!b&&!S&&a()("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%"}},void 0,m&&a()(an,{disabled:s,handleMouseMove:g,onClick:h,icon:C.Z.searchThick,tooltipMessage:a()(R.FormattedMessage,{id:"database.RelationPropertyPageSectionHeaderButton.tooltip.searchButton.message",defaultMessage:"Link a page",description:"Tooltip for opening the picker from a relation section"})},`searchIcon-${i}`),p&&m&&a()(an,{disabled:s,handleMouseMove:g,onClick:y,icon:C.Z.plus,tooltipMessage:a()(R.FormattedMessage,{id:"database.RelationPropertyPageSectionHeaderButton.tooltip.addButton.message",defaultMessage:"Add new page",description:"Tooltip for opening the picker from an already related page"})},`addIcon-${i}`),a()(tn.Z,{collectionStore:t,targetCollectionStore:o,property:i,disabled:s||!u,rowType:"section"})),style:{paddingTop:0,paddingBottom:2,width:"100%",...l},desktopTitleStyle:{height:6,paddingLeft:0,paddingRight:8,paddingTop:24,fontWeight:"normal"},mobileTitleStyle:{paddingLeft:0,alignItems:"center",fontWeight:"normal"}})))}function an(e){window.__c={n:"RelationPropertyPageSectionHeaderButton"};const{disabled:t,handleMouseMove:o,onClick:i,icon:r,key:s,tooltipMessage:l}=e,d=(0,dt.yK)((e=>({buttonStyle:{width:24,height:24,borderRadius:3,display:"inline-flex",alignItems:"center",justifyContent:"center",marginRight:4},iconStyle:{width:14,height:14,flexGrow:0,flexShrink:0,fill:e.mediumIconColor}})),[]);return a()(co.Z,{renderTooltip:()=>l,render:e=>c.createElement(_o.Z,n()({key:s,style:d.buttonStyle,onMouseMove:o,onClick:i,disabled:t},e),r(d.iconStyle))})}on.displayName="RelationPropertyPageSection",on.contextTypes={...go.w,...Q.xm},on.addNewRelationButtonTitleStyle={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0};const sn=on;const ln=(0,c.forwardRef)(((e,t)=>{const{property:o,propertySchema:i,numberOfRelations:n,schema:r,format:s,disabled:l,locked:d,canConfigureCollection:p,collectionStore:u,onHandleOpenProperty:m,isInPeekRenderer:g}=e,h=(0,dt.yK)((e=>({hoverButton:{display:"flex",alignItems:"baseline",justifyContent:"normal",color:e.mediumTextColor,width:"100%"},minimalButton:{display:"inline-flex",alignItems:"center",flexShrink:0,whiteSpace:"nowrap",height:28,borderRadius:3,fontSize:14,lineHeight:1.2,minWidth:0,paddingLeft:6,paddingRight:8,fontWeight:Z.Z.fontWeight.medium,color:e.mediumTextColor},minimalButtonWrapper:{width:"100%",maxWidth:"100%",fontWeight:Z.Z.fontWeight.medium,color:e.mediumTextColor},iconStyle:{width:14,height:14,fill:e.mediumIconColor,marginRight:6,alignItems:"baseline"},pagePropertiesRowName:{width:"100%",display:"inline-flex",flexWrap:"wrap"}})),[]),f=(0,dt.Fg)(),v=(0,c.useCallback)((()=>{Xo.Z.setState({...Xo.Z.state,hoveredProperty:o})}),[o]),y=(0,c.useCallback)((()=>{Xo.Z.setState({...Xo.Z.state,hoveredProperty:void 0})}),[]);return a()("div",{style:h.hoverButton,onMouseMove:v,onMouseLeave:y},void 0,a()(wi,{schema:r,format:s,property:o,collectionStore:u,disabled:l,locked:d,canConfigureCollection:p,intl:de.default.getIntl(),style:h.pagePropertiesRowName,popupStyle:h.pagePropertiesRowName,origin:c.createElement("div",{ref:t,style:h.minimalButtonWrapper},a()(_o.Z,{style:h.minimalButton,onClick:()=>m(!0),onContextMenu:e=>{l||d||!p||(e.preventDefault(),Xo.Z.setState({...Xo.Z.state,openProperty:{property:o,isInPeekRenderer:g}}))}},`minimal-section-${o}`,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(Hi.ZP,{size:14,style:h.iconStyle,theme:f,type:i.type??"relation",icon:i.icon}),0===n&&a()(R.FormattedMessage,{id:"RelationPropertyPageSection.show.zeroMinimalRelations",defaultMessage:"Add {propertyName}",description:"Shows a message to add a relation when there are no linked pages in this relation section",values:{propertyName:i.name}}),1===n&&a()(R.FormattedMessage,{id:"RelationPropertyPageSection.show.oneMinimalRelation",defaultMessage:"1 {propertyName}",description:"Shows a message with the number of linked pages for the relation when there is only one linked page in this relation section",values:{propertyName:i.name}}),n>1&&a()(R.FormattedMessage,{id:"RelationPropertyPageSection.show.manyMinimalRelations",defaultMessage:"{numberOfRelations} {propertyName}",description:"Shows the number of linked pages that exist in this relation section",values:{numberOfRelations:n,propertyName:i.name}})))),hideDragHandle:!0,isInPeekRenderer:g}))})),cn=(0,c.forwardRef)(((e,t)=>{const{collectionStore:o,targetCollectionStore:i,property:r,showRight:s,disabled:l,style:d,children:p,canEditTargetCollection:u,canConfigureCollection:m,canEditCurrentPage:g,handleMouseMove:h,onHandleOpenProperty:v,onTitleEnter:y}=e,b=(0,ct.VK)((()=>i.isSyncedCollection()),[i]),S=(0,ct.VK)((()=>{const e=o.getSchema()[r];return Boolean(e&&f.NK(e))}),[o,r]);return c.createElement("div",{style:{width:"100%"},ref:t},c.createElement(vi.Z,n()({},e,{topBorder:!0,children:p,noTextOverflow:!0,isTitleUppercase:!1,right:s&&!b&&!S&&a()("div",{style:{height:"100%",display:"flex",alignItems:"center",width:"100%"}},void 0,g&&a()(dn,{disabled:l,handleMouseMove:h,onClick:v,icon:C.Z.searchThick,tooltipMessage:a()(R.FormattedMessage,{id:"database.RelationPropertyPageSectionHeaderButton.tooltip.searchButton.message",defaultMessage:"Link a page",description:"Tooltip for opening the picker from a relation section"})},`searchIcon-${r}`),u&&g&&a()(dn,{disabled:l,handleMouseMove:h,onClick:y,icon:C.Z.plus,tooltipMessage:a()(R.FormattedMessage,{id:"database.RelationPropertyPageSectionHeaderButton.tooltip.addButton.message",defaultMessage:"Add new page",description:"Tooltip for opening the picker from an already related page"})},`addIcon-${r}`),a()(tn.Z,{collectionStore:o,targetCollectionStore:i,property:r,disabled:l||!m,rowType:"section"})),style:{paddingTop:0,paddingBottom:2,width:"100%",...d},desktopTitleStyle:{height:6,paddingLeft:0,paddingRight:8,paddingTop:24,fontWeight:"normal"},mobileTitleStyle:{paddingLeft:0,alignItems:"center",fontWeight:"normal"}})))}));function dn(e){window.__c={n:"RelationPropertyPageSectionHeaderButton"};const{disabled:t,handleMouseMove:o,onClick:i,icon:r,key:s,tooltipMessage:l}=e,d=(0,dt.yK)((e=>({buttonStyle:{width:24,height:24,borderRadius:3,display:"inline-flex",alignItems:"center",justifyContent:"center",marginRight:4},iconStyle:{width:14,height:14,flexGrow:0,flexShrink:0,fill:e.mediumIconColor}})),[]);return a()(co.Z,{renderTooltip:()=>l,render:e=>c.createElement(_o.Z,n()({key:s,style:d.buttonStyle,onMouseMove:o,onClick:i,disabled:t},e),r(d.iconStyle))})}function pn(e){let{store:t,schema:o,property:i}=e;return(0,ct.VK)((()=>{const e=o[i];if(!e||"relation"!==e.type)return[];const n=t.getPropertyValue(i);return v.j$({relationValue:v.rq(n),propertySchema:e,getRecordValue:t.getRecordValue})}),[o,i,t],{useDeepEqual:!0})}const un=e=>{window.__c={n:"RelationPropertyPageSectionV2"};const{schema:t,format:o,locked:i,property:r,collectionStore:a,store:s,disabled:l,visibility:d,isInPeekRenderer:p,blockPropertyValueOverlayStore:u,analyticsFrom:m}=e,g=(0,lt.O7)(),h=(0,Q.Y$)(),f=t[r],v=(0,c.useRef)(null),y=(0,ct.VK)((()=>Boolean(null==h?void 0:h.permissionScopes.state.canConfigureCollection)),[h]),b=pn({store:s,schema:t,property:r}).length,S=0===b,w="minimal"===d;if("section_hide"===d)return null;if("relation"!==(null==f?void 0:f.type)||!h)return null;const k=(e,t,o)=>{const i=function(e,t,o){const i=Qo.findDOMNode(t.current);if(!(i&&i instanceof Element))return null;const n=e?null==e?void 0:e.getBoundingClientRect():i.getBoundingClientRect(),r=o?n.top+li.Mu:n.top+5;return new DOMRect(n.left,r,n.width,n.height)}(o,v,e);i&&(L.bA({environment:g,blockPropertyValueOverlayStore:u,store:s,property:r,rect:i,format:nt.C.Page,mode:t,collectionContextStore:h}),A.trackRelationSectionLinkButton(g,{from:m}))};return w||S?c.createElement(ln,{property:r,propertySchema:f,numberOfRelations:b,onHandleOpenProperty:k,ref:v,schema:t,format:o,disabled:l,locked:i,canConfigureCollection:y,collectionStore:a,collectionContextStore:h,isInPeekRenderer:p}):c.createElement(mn,n()({propertySchema:f,ref:v,onOpenProperty:k},e))},mn=(0,c.forwardRef)(((e,t)=>{const{schema:o,format:i,locked:r,property:s,collectionStore:l,store:p,disabled:u,isInPeekRenderer:m,blockPropertyValueOverlayStore:g,propertySchema:b,onOpenProperty:S}=e,w=(0,lt.O7)(),{device:k}=w,_=pn({store:p,schema:o,property:s}),[M,I]=(0,c.useState)(10),P=(0,Q.Y$)(),Z=(0,ct.VK)((()=>P.permissionScopes.state.canConfigureCollection),[P]),E=(0,ct.VK)((()=>{const e=f.j0(b);return e?qe.NW.createChildStore(p,e):null}),[p,b]),D=_.slice(0,M),F=1===b.limit,L=!(k.isMobile||u||r||F),V=p.getPropertyStore(s),N=(0,ct.VK)((()=>new Ve.Z),[]),U=(0,ct.VK)((()=>new Ji.Z),[]),H=(0,c.useRef)(null),z=(0,dt.yK)((e=>({relationRowWrapStyle:{flex:1,minWidth:0,display:"flex",flexWrap:"wrap",flexDirection:"column",paddingBottom:"12px",paddingTop:"12px",width:"100%"},showMoreButtonStyle:{width:"100%",display:"flex",alignItems:"center",borderRadius:3,fontSize:14,minHeight:30,margin:0,padding:"6px 8px 7px 8px"},addNewRelationButtonIconStyle:{width:16,height:16,marginRight:9,marginTop:1,fill:e.lightIconColor},addNewRelationButtonTitleStyle:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0},addNewRelationButtonWrapperStyle:{display:"flex",alignItems:"center",color:e.lightTextColor,borderRadius:3,paddingLeft:4,paddingRight:6,height:32,width:"100%",fontSize:14}})),[]),K=(t,o)=>{let i;O.createAndCommit({userAction:"RelationToken.handleRelationPropertyMenuUpdate",environment:w,perform:n=>{const r=o.id;if(t.newPage&&r){const a=x.TP(t.newPage.name),s={id:t.newPage.id,version:0,type:h.Ti.page,parent_id:r,parent_table:T.v,alive:!0,properties:{title:a},collection_id:void 0,space_id:t.newPage.spaceId};i=W.ae({environment:w,table:kt.iU,value:s,inMemoryRecordCache:o.inMemoryRecordCache,transaction:n});const l=qe.G.createChildStore(e.store,i.pointer),c=o.getDefaultTemplatePageStore();c&&Ki.ob({title:{text:a},environment:w,store:l,templateStore:c,isKeyboard:!1,isCreateIn:!1,transaction:n,from:"relation_property_menu_update"})}if(t.value){const e=v.ow(t.value),o=p.getPropertyStore(s);W.sO({store:o,value:e,transaction:n})}}}),d.default.afterNextFlush((()=>{if(!i)return;const e=$i.Z.findRow(i.id,"section",s);if(!e)return;const t=e.relationTokenBlockStoreRef.current;if(!t)return;const o=t.getBlockTitleStore(),n=o.getValue(),r=n?n[0][0].length:0,a={start:{index:r,store:o},end:{index:r,store:o}};Y.NA({multiSelection:a})}))},G=(e,t,o)=>{if(!p.canEdit())return;const i=(0,Wi.ZP)(),n=l.pointer.spaceId,r=b.limit,a={id:i,table:kt.iU,spaceId:n},c=p.getPropertyValue(s),d=v.j$({relationValue:v.rq(c),propertySchema:b,getRecordValue:p.getRecordValue});e&&e+1>M&&I(e+1);const u=r?[a]:e?[...d.slice(0,e),a,...d.slice(e)]:[a,...d];K({newPage:{id:i,spaceId:n,name:""},value:u},t),A.trackRelationCreateBlock(w,{...(0,Xi.Pn)(P),from:o,target_collection_id:null==t?void 0:t.id})},X=(0,qi.b)(w),q=function(e){const{store:t,collectionStore:o,disabled:i,property:r,locked:a,limitedRelationValue:s,propertySchema:l,targetCollectionStore:d,relationValue:p,canDrag:u,canConfigureCollection:m,handleRemoveRelationClick:g,handleCreateNewRelation:h,handleSelectedPageClick:v,menuListStore:y}=e,b=(0,ct.VK)((()=>s.map(((e,o)=>{const i=qe.G.createChildStore(t,e),n=i.getAssociatedCollectionStore();return(null==n?void 0:n.id)===f.F0(l)?{pageStore:i,index:o}:null})).filter(B.K0)),[t,l,s]);if(!d)return[];return b.map((e=>{let{pageStore:s,index:f}=e;return{key:s.id,render:e=>c.createElement(en.Z,n()({},e,{canDrag:u&&t.canEdit(),collectionStore:o,targetCollectionStore:d,relatedPageStore:s,disabled:i,canConfigureCollection:m,locked:a,isSelected:!0,pageStore:t,property:r,rowType:"section",onActionButtonClick:()=>g({relationValue:p,relatedPageStore:s,targetCollectionStore:d}),onMouseLeave:()=>y.unsetFocus(),onSecondaryButtonClick:()=>h(f+1,d,"relation_section_inline"),onInsertInline:()=>h(f+1,d,"relation_section_inline"),onOpenPageButtonClick:()=>{v(p,s)},index:f+1,propertyLimit:l.limit})),action:()=>{}}}),[])}({...e,limitedRelationValue:D,propertySchema:b,targetCollectionStore:E,relationValue:_,canDrag:L,canConfigureCollection:Z,handleRemoveRelationClick:t=>{var o;let{relationValue:i,relatedPageStore:n,targetCollectionStore:r}=t;const a=b.limit?[]:i.filter((e=>e.id!==n.id));O.createAndCommit({userAction:"RelationSection.handleRemoveRelationClick",environment:w,perform:e=>{ji.sf({store:p,propertyStore:V,value:a,environment:w,relatedPageId:n.id,propertySchema:b,transaction:e,collectionContextStore:P,analyticsData:{isFromBulkActionsToolbar:Gi.VM(g),analyticsFrom:Gi.Sy(nt.C.Page)},isUnthrottled:!1})}}),A.trackRelationRemoveBlock(w,{from:e.analyticsFrom,collection_id:null===(o=e.collectionStore)||void 0===o?void 0:o.id,target_collection_id:null==r?void 0:r.id})},menuListStore:N,handleCreateNewRelation:G,handleSelectedPageClick:(e,t,o)=>{const{mainEditorCurrentBlockStore:i}=Pe.default.state;if(!i)return;const n=e.find((e=>e.id===t.id));if(!n)return;let r;if(o){const e=qe.G.createChildStore(i,n).getModel(),t=e?X(e.getSpaceId()):void 0;r=(0,y.Z)({pageId:n.id,pageModel:e,baseUrl:t})}else{const e=i.getModel(),t=e?X(e.getSpaceId()):void 0;r=(0,y.Z)({pageId:i.id,pageModel:e,baseUrl:t,peekViewBlockId:n.id,peekMode:(0,Ge.getUrlParamFromPeekMode)(Ge.default.state.mode)}),A.trackRelationNavigateBlock(w,{from:"relation_section",meta_click:Boolean(o)})}j.navigate({environment:w,url:r,openInNew:o})}}),$=(0,ct.VK)((()=>Boolean(null==E?void 0:E.canEdit())),[E]),J=(0,ct.VK)((()=>p.canEdit()),[p]),ee=(0,ct.VK)((()=>Boolean(null==E?void 0:E.canEdit())),[E]);if(!E)return null;const te=(t,o)=>{const i=p.getPropertyValue(s),n=v.j$({relationValue:v.rq(i),propertySchema:b,getRecordValue:p.getRecordValue}),r=[...t.map((e=>({id:e,spaceId:l.pointer.spaceId,table:kt.iU}))),...n.slice(t.length)];K({value:r},E),A.trackRelationReorder(w,{from:e.analyticsFrom}),Yi.sv({store:N,focus:{section:0,indexLocal:o.endPosition,indexGlobal:o.endPosition}})},oe=q.map((e=>e.key.toString())),ie=a()(hi.Z,{type:hi.i.Vertical,store:N,initialFocus:void 0,disableKeyboard:!0,style:{width:"100%"},sections:[{key:"section",render:e=>c.createElement(vi.Z,n()({},e,{disableDesktopPadding:!0,disableMobileBorders:!0}),L?a()($o.ZP,{direction:"vertical",keys:oe,renderKey:t=>e.children[oe.indexOf(t)],onDrop:te,store:U}):e.children),items:q}]}),ne={maxWidth:k.isMobile?"none":300,...!k.isMobile&&{width:"auto"},...k.isMobile&&{paddingLeft:"none"}},re=_.length;return c.createElement(cn,{key:s,collectionContextStore:P,title:a()(wi,{schema:o,format:i,property:s,collectionStore:l,disabled:u,locked:r,canConfigureCollection:Z,intl:de.default.getIntl(),style:ne,popupStyle:ne,isInPeekRenderer:m}),collectionStore:l,targetCollectionStore:E,property:s,showRight:!0,disabled:u,schema:o,format:i,locked:r,canEditTargetCollection:ee,canConfigureCollection:Z,canEditCurrentPage:J,handleMouseMove:e.handleMouseMove,onHandleOpenProperty:()=>{S(!1,{type:"add",index:re})},ref:H,onTitleEnter:()=>G(void 0,E,"relation_section_inline")},c.createElement("div",{style:{...z.relationRowWrapStyle,...k.isMobile&&{paddingLeft:"none"}},onMouseMove:e.handleMouseMove,onMouseLeave:e.handleMouseLeave,ref:t},ie,_.length>M&&a()(_o.Z,{style:z.showMoreButtonStyle,onClick:()=>I(M+10)},void 0,a()(Qi.Z,{count:_.length-M,format:zi.l.Medium,style:{margin:void 0},fixedHeight:!1,isCompact:!1})),$&&J&&a()(_o.Z,{style:z.addNewRelationButtonWrapperStyle,onClick:()=>{G(_.length>=M?M:_.length+1,E,"relation_section_footer")},disabled:u},void 0,1===b.limit?C.Z.replace(z.addNewRelationButtonIconStyle):C.Z.plus(z.addNewRelationButtonIconStyle),a()("div",{style:z.addNewRelationButtonTitleStyle},void 0,1===b.limit?a()(R.FormattedMessage,{id:"RelationPropertyPageSection.button.replacePage",defaultMessage:"Replace linked page from {propertyName}",description:"Button to create new linked page in the related database that will be added and displayed in this relation section when the relation limit is 1",values:{propertyName:b.name}}):a()(R.FormattedMessage,{id:"RelationPropertyPageSection.button.addPage",defaultMessage:"New page in {propertyName}",description:"Button to create new linked page in the related database that will be added and displayed in this relation section",values:{propertyName:b.name}})))))}));class gn extends go.Z{constructor(){super(...arguments),this.renderSection=e=>{const{schema:t,format:o,locked:i,collectionStore:n,store:r,disabled:s,isInPeekRenderer:l,handleMouseMove:c,handleMouseLeave:d,blockPropertyValueOverlayStore:p}=this.props,u=Ae.default.checkGate("relation_page_sections_v2"),m=(o.collection_page_sections||[]).filter((t=>t.section===e)).map((e=>e.visibility))[0];return a()(u?un:sn,{store:r,collectionStore:n,disabled:s,locked:i,property:e,schema:t,handleMouseMove:c,handleMouseLeave:d,handleContextMenu:()=>{},blockPropertyValueOverlayStore:p,format:o,visibility:m,analyticsFrom:"relation_section",isInPeekRenderer:l})},this.handleReorder=e=>{const{collectionStore:t,format:o}=this.props,i=o.collection_page_sections||[],n=[...l().compact(e.map((e=>i.find((t=>t.section===e))))),...i.filter((t=>!e.includes(t.section)))];O.createAndCommit({userAction:"RelationPropertyPageSections.handleReorder",environment:this.environment,perform:e=>{V.FH({stores:[t],update:{collection_page_sections:n},transaction:e})}})}}renderComponent(){const{locked:e,disabled:t,propertyIds:o,type:i}=this.props,{collectionContextStore:n}=this.context;if(!n)return;const r=n.permissionScopes.state;return"minimal"===i?o.map((e=>a()("div",{},e,this.renderSection(e)))):t||e||!r.canConfigureCollection?a()("div",{style:$o.yA},void 0,o.map((e=>a()("div",{},e,this.renderSection(e))))):a()($o.ZP,{direction:"vertical",keys:o,renderKey:this.renderSection,onDrop:this.handleReorder})}}gn.displayName="RelationPropertyPageSections",gn.contextTypes={...go.w,...Q.xm};const hn=gn;var fn=o(66094),vn=o(37064),yn=o(44862),bn=o(10482),Sn=o(73928),wn=o(88428),kn=o(21325),Cn=o(59389),_n=o(74284),Mn=o(66213),Tn=o(14976),In=o(15010),Pn=o(17504),xn=o(94660),Bn=o(88632),Zn=o(34253),En=o(21199),Rn=o(40698),An=o(34574);class Dn extends go.Z{constructor(){super(...arguments),this.moreAIItemsExpandedStore=new Qe.default(!1),this.moreNewPageItemsExpandedStore=new Qe.default(!1),this.renderMobileTemplatePreviewItem=e=>({key:e.name,render:t=>c.createElement(An.Z,n()({},t,{key:e.name,title:e.name,type:"page_template",format:"page-menu-item",locked:!1})),action:()=>{wn.$7({environment:this.environment,item:e,createNewPage:!1,isPrivate:!1})}}),this.renderPageTemplatePickerItem=e=>({key:e.name,render:t=>{var o;return c.createElement(An.Z,n()({},t,{key:e.name,format:"page-menu-item",title:e.name,type:e.type,icon:null===(o=e.iconFn)||void 0===o?void 0:o.call(e,this.getIconStyle(e)),locked:!1,right:this.maybeRenderEnterIcon(t)}))},action:t=>{kn.M_(this.environment)&&(A.trackSelectTemplate(this.environment,{template_name:e.name,is_keyboard:"keydown"===t.event.type,from:e.from}),e.onClick(this.environment,this.props.store))}}),this.renderAITemplatePickerItem=e=>{const{intl:t}=this.props,o=e.svg&&a()("div",{style:{height:24,width:24,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center",marginRight:10}},void 0,e.svg({width:16,fill:this.theme.lightIconColor}));return{key:e.key,render:i=>c.createElement(An.Z,n()({},i,{key:e.key,format:"page-menu-item",title:t.formatMessage(e.name),type:"ai",icon:o,locked:!1,right:this.maybeRenderEnterIcon(i)})),action:()=>{Sn.lx({environment:this.environment,prompt:e,from:"page_menu"})}}},this.renderAIDraftPageWithGivenTitleTemplatePickerItem=e=>{const{intl:t}=this.props;return{key:"ask ai",render:o=>{const i=e.length>30?`${e.slice(0,30)}…`:e;return c.createElement(An.Z,n()({},o,{key:"genericHelpMeWriteNewPageWithAI",format:"page-menu-item",title:e?t.formatMessage(ne.Dr.genericHelpMeWriteNewPage,{filter:i}):t.formatMessage(ne.Dr.genericHelpMeWriteNewPageEmpty),type:"ai",icon:a()("div",{style:{height:24,width:24,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center",marginRight:10}},void 0,C.Z.sparkles({width:16,fill:this.theme.accentColors.purple[400]})),locked:!1,right:this.maybeRenderEnterIcon(o)}))},action:()=>{const{environment:t}=this,{store:o}=this.props;O.createAndCommit({userAction:"TemplatePicker.genericHelpMeWriteNewPageWithAI",environment:t,perform:e=>{Cn.eV({environment:t,store:o,transaction:e,preventTextSelection:!0})}});const i=(0,ne.FD)();i&&(e?Sn.Tg({environment:this.environment,prompt:(0,ne.qB)({customPrompt:e,isPageEmpty:!0}),context:i,additionalContext:{prompt:e},from:"page_menu",skipInitialForm:!1}):Sn.lx({environment:this.environment,prompt:ne.eL,from:"page_menu"}))}}},this.publicEditModeStore=this.createComputedStore((()=>Xe.Z.getMode(this.environment,this.props.store))),this.handleEmptyPageContinueClick=e=>{(0,le.ZP)({event:e,context:le.Af.EditorClick,callback:()=>{kn.M_(this.environment)&&(O.createAndCommit({userAction:"TemplatePicker.handleEmptyPageContinueClick",environment:this.environment,perform:e=>{Cn.eV({environment:this.environment,store:this.props.store,transaction:e})}}),A.trackSelectTemplate(this.environment,{template_name:"empty",is_keyboard:!1}))}})},this.handleTemplatePickerEmptyEnter=()=>{const e=Vo.default.state;kn.M_(this.environment)&&"editing"===e.mode&&(O.createAndCommit({userAction:"TemplatePicker.handleTemplatePickerEmptyEnter",environment:this.environment,perform:t=>{_n.IO({environment:this.environment,transaction:t,multiSelection:e.multiSelection})}}),A.trackSelectTemplate(this.environment,{template_name:"empty",is_keyboard:!0}))},this.handleCollectionTemplateClick=e=>{O.createAndCommit({userAction:"TemplatePicker.handleCollectionTemplateClick",environment:this.environment,perform:t=>{const o=this.props.store.getTitleValue();Ki.ob({title:""!==x.Q(o)?{text:o}:"template",environment:this.environment,store:this.props.store,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"template_picker"})}})},this.handleTemplateEmptyPageClick=()=>{O.createAndCommit({userAction:"TemplatePicker.handleTemplateEmptyPageClick",environment:this.environment,perform:e=>{Cn.eV({environment:this.environment,store:this.props.store,transaction:e})}})},this.handleCreateDatabaseTemplateClick=()=>{const{store:e}=this.props,t=e.getAssociatedCollectionStore();if(t&&kn.M_(this.environment)){const{performResult:e}=O.createAndCommit({userAction:"TemplatePicker.newPage",environment:this.environment,perform:e=>Ki.nx({environment:this.environment,collectionStore:t,transaction:e})});e&&this.navigateToBlock(e),A.trackCreateCollectionTemplate(this.environment,{collection_id:t.id})}},this.handleCloseTemplateSuggestionsClick=()=>{const{currentUserSettingsStore:e}=Pe.default.state;A.trackDismissNewPageSuggestedTemplates(this.environment),e&&O.createAndCommit({userAction:"NewPageSuggestedTemplates.dismissSuggestions",environment:this.environment,perform:t=>{W.sW({store:e.getSettingsStore(),data:{dismissed_new_page_suggested_templates:!0},transaction:t})}})}}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):j.navigate({environment:this.environment,url:e})}willMount(e){super.willMount(e),e.menuListStore.reset()}renderComponent(){const e=Bn.Z.state.online;return a()(En.Z,{capture:!0,render:t=>(0,Pn.Z)((o=>c.createElement("div",n()({},t,o,{style:Dn.wrapStyle}),this.renderPlaceholder(),e&&this.renderTemplates())))})}renderTemplates(){const{device:e}=this.environment,{store:t}=this.props,o=this.isCollectionPage(),i=this.isTemplatePage(),n=t.getAssociatedCollectionStore(),r=n?n.getParentBlockStore():void 0,s=n?n.getTemplatePageStores():void 0;return a()("div",{},void 0,!o&&!e.isMobile&&this.renderDesktopPageTemplatePicker(),!o&&e.isTablet&&this.renderMobilePageTemplatePicker(),o&&!i&&n&&r&&s&&s.length>0&&a()(Zn.Z,{isOverlay:!1,collectionStore:n,canConfigureCollection:this.canConfigureCollection(),onTemplateClick:this.handleCollectionTemplateClick,onEmptyEnter:this.handleTemplatePickerEmptyEnter,onEmptyPageClick:this.handleTemplateEmptyPageClick,locked:r.isLocked()}))}renderDesktopPageTemplatePicker(){if(this.isSuggestedTemplatesExperimentEnabled()){const e=Ae.default.getEligibleGroup({experimentId:"new_page_suggested_templates",defaultGroup:"control"});let t="Suggested templates";"variant_2"!==e&&"variant_4"!==e||(t=`Suggested templates for ${this.getPersonaLabel()}`);const o=(0,Rn.r)().slice(0,3),i={key:"Suggested Templates",render:e=>a()("div",{},e.key,a()("div",{style:this.getGroupTitleStyle({})},void 0,t,a()(Xt.Z,{ariaLabel:"Dismiss suggested templates",icon:C.Z.closeSmall,style:{position:"static",width:15,height:15,marginLeft:4,borderRadius:100},iconStyle:{width:13,height:13},onClick:this.handleCloseTemplateSuggestionsClick})),e.children),items:o.map(this.renderPageTemplatePickerItem)},n=[{key:"Basic",render:e=>a()("div",{},e.key,e.children),items:(0,Rn.XI)(this.environment,this.props.store).map(this.renderPageTemplatePickerItem)},{key:"Database",render:e=>a()("div",{},e.key,a()("div",{style:this.getGroupTitleStyle({})},void 0,a()(R.FormattedMessage,{defaultMessage:"Database",id:"templatePicker.databaseTemplates.label"})),e.children),items:Rn.Im.filter((e=>e.shouldShow(this.environment))).map(this.renderPageTemplatePickerItem)}];return"control"!==e&&o.length>0&&n.splice(1,0,i),a()(hi.Z,{type:hi.i.Vertical,store:this.props.menuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:this.handleTemplatePickerEmptyEnter,sections:n})}if((0,ne.GD)(this.environment,this.publicEditModeStore.state)){const e=(0,Rn.XI)(this.environment,this.props.store),t=(0,Rn.b6)(e,["empty_page"]).map(this.renderPageTemplatePickerItem),o=this.props.store.getTitleValue(),i=(0,Tn.Xh)(o,this.props.store).trim(),n=[this.renderAIDraftPageWithGivenTitleTemplatePickerItem(i)],r=(0,Rn.b6)(e,["import","templates"]),s=(0,Rn.b6)(Rn.Im,["table","board","timeline","calendar"]),c=l().without(Rn.Im,...s),d=this.moreNewPageItemsExpandedStore.state?[...r,...s,...c].map(this.renderPageTemplatePickerItem):[...r,...s].map(this.renderPageTemplatePickerItem).concat(this.renderMoreTemplatePickerItem("moreNew",this.moreNewPageItemsExpandedStore));return a()(hi.Z,{type:hi.i.Vertical,store:this.props.menuListStore,disableInitialScroll:!0,disableCommandEnter:!0,initialFocus:0,onEmptyEnter:this.handleTemplatePickerEmptyEnter,sections:[{key:"Empty page",render:e=>a()("div",{},void 0,e.children),items:[...t,...n]},{key:"Add new",render:e=>a()("div",{},e.key,a()("div",{style:this.getGroupTitleStyle({})},void 0,a()(R.FormattedMessage,{defaultMessage:"Add new",id:"templatePicker.add new.label",description:"Label for options to add a new page of various types"})),e.children),items:d}]})}return a()(hi.Z,{type:hi.i.Vertical,store:this.props.menuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:this.handleTemplatePickerEmptyEnter,sections:[{key:"Basic",render:e=>a()("div",{},e.key,e.children),items:(0,Rn.XI)(this.environment,this.props.store).map(this.renderPageTemplatePickerItem)},{key:"Database",render:e=>a()("div",{},e.key,a()("div",{style:this.getGroupTitleStyle({})},void 0,a()(R.FormattedMessage,{defaultMessage:"Database",id:"templatePicker.databaseTemplates.label"})),e.children),items:Rn.Im.filter((e=>e.shouldShow(this.environment))).map(this.renderPageTemplatePickerItem)}]})}renderMobilePageTemplatePicker(){var e,t,o;const i=Object.entries((0,xn.it)({userPersona:null===(e=Pe.default.state.currentUserSettingsStore)||void 0===e||null===(t=e.getSettings())||void 0===t?void 0:t.persona,subscriptionTier:null===(o=Pe.default.state.currentSpaceStore)||void 0===o?void 0:o.getSubscriptionTier()})).map((e=>{let[t,o]=e;return{key:t,render:e=>a()("div",{},e.key,a()("div",{style:this.getGroupTitleStyle({})},void 0,c.createElement(R.FormattedMessage,bn._5[t])),e.children),items:o.map(this.renderMobileTemplatePreviewItem)}}));return a()(hi.Z,{type:hi.i.Vertical,store:this.props.menuListStore,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:this.handleTemplatePickerEmptyEnter,sections:[{key:"Basic",render:e=>a()("div",{},e.key,e.children),items:Rn.ss.map(this.renderPageTemplatePickerItem)},{key:"Database",render:e=>a()("div",{},e.key,a()("div",{style:this.getGroupTitleStyle({})},void 0,a()(R.FormattedMessage,{defaultMessage:"Database",id:"templatePicker.mobileTemplatePicker.databaseTemplateSection.label"})),e.children),items:Rn.Im.filter((e=>e.shouldShow(this.environment))).map(this.renderPageTemplatePickerItem)},...i]})}renderMoreTemplatePickerItem(e,t){return{key:e,render:t=>c.createElement(An.Z,n()({},t,{key:e,format:"page-menu-item",title:a()(R.FormattedMessage,{defaultMessage:"More",id:"templatePicker.more.label",description:"Label for button that displays more template items."}),type:"more",icon:C.Z.dots({width:20,fill:this.theme.lightIconColor,marginRight:10}),locked:!1,right:this.maybeRenderEnterIcon(t)})),action:()=>t.setState(!0)}}renderPlaceholder(){const e=this.renderPlaceholderMessage();return e?a()("div",{style:Dn.placeholderWrapStyle},void 0,a()("div",{style:this.getPlaceholderStyle(),onClick:this.handleEmptyPageContinueClick},void 0,e)):void 0}renderPlaceholderMessage(){const{device:e}=this.environment,t=this.props.store.isTemplate(),o=Bn.Z.state.online,i=this.isCollectionPage(),n=this.collectionHasTemplates(),r=i&&!n;return o?t?a()(R.FormattedMessage,{defaultMessage:"{isMobileDevice, select, true {Tap here to continue with an empty page.} other {Press Enter to continue with an empty page.}}",id:"templatePicker.isTemplate.emptyPagePrompt",values:{isMobileDevice:e.isMobile}}):e.isMobile?r?a()(R.FormattedMessage,{defaultMessage:"{isParentLocked, select, true {Tap here to continue with an empty page} other {Tap here to continue with an empty page, or <templatebutton>create a template</templatebutton>}}",id:"templatePicker.mobileCollectionEmptyPage.prompt",values:{isParentLocked:!this.canConfigureCollection(),templatebutton:e=>a()(_o.Z,{style:{display:"inline-block",textDecoration:"underline"},onClick:this.handleCreateDatabaseTemplateClick},void 0,e)}}):e.isTablet?a()(R.FormattedMessage,{defaultMessage:"Tap here to continue with an empty page, or pick a template",id:"templatePicker.mobileTabletEmptyPage.withTemplates.prompt"}):a()(R.FormattedMessage,{defaultMessage:"Tap here to continue...",id:"templatePicker.mobilePhoneEmptyPage.withTemplates.prompt"}):r?a()(R.FormattedMessage,{defaultMessage:"{isParentLocked, select, true {Press Enter to continue with an empty page} other {Press Enter to continue with an empty page, or <templatebutton>create a template</templatebutton>}}",id:"templatePicker.webCollectionEmptyPage.prompt",values:{isParentLocked:!this.canConfigureCollection(),templatebutton:e=>a()(_o.Z,{style:{display:"inline-block",textDecoration:"underline"},onClick:this.handleCreateDatabaseTemplateClick},void 0,e)}}):!(0,ne.GD)(this.environment,this.publicEditModeStore.state)||i?a()(R.FormattedMessage,{defaultMessage:"Press Enter to continue with an empty page, or pick a template (↑↓ to select)",id:"templatePicker.webEmptyPage.withTemplates.prompt"}):void 0:a()(R.FormattedMessage,{defaultMessage:"{isMobileDevice, select, true {Tap here to continue with an empty page. Please go online to use templates.} other {Press Enter to continue with an empty page. Please go online to use templates.}}",id:"templatePicker.deviceOffline.goOnlinePrompt",values:{isMobileDevice:e.isMobile}})}isCollectionPage(){return Boolean(this.props.store.getAssociatedCollectionStore())}canConfigureCollection(){const{store:e}=this.props,t=e.getAssociatedCollectionStore(),o=t&&t.getParentBlockStore();return ie.eD({collectionStore:t,collectionViewBlockStore:o,checkNavigableAncestorLocked:!0})}collectionHasTemplates(){const{store:e}=this.props,t=e.getParentCollectionStore(),o=t?t.getTemplatePageStores():void 0;return o&&o.length>0}isTemplatePage(){return this.props.store.isTemplate()}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=Pe.default.state,o=t?(0,Wo.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1}):(0,Wo.ZP)({store:e,fullyQualified:!1});this.navigate(o)}isSuggestedTemplatesExperimentEnabled(){const{currentUserSettingsStore:e,currentSpaceStore:t}=Pe.default.state,o=null==e?void 0:e.getSettings();if(!e||!o||!t)return!1;const i="team"===t.getPlanType(),n="en-US"===p.SP,r=null==o?void 0:o.dismissed_new_page_suggested_templates,a=(null==o?void 0:o.persona)&&["productDesign","product","marketing","eng"].includes(o.persona),s=(0,In.e2)(e);return i&&n&&!r&&a&&("number"==typeof s&&s<7)&&void 0!==Ae.default.getEligibleGroup({experimentId:"new_page_suggested_templates"})}getPersonaLabel(){const{currentUserSettingsStore:e}=Pe.default.state,t=null==e?void 0:e.getSettings();switch(null==t?void 0:t.persona){case"design":case"marketing":return t.persona;case"product":return"product management";case"eng":return"engineering";default:return""}}getPlaceholderStyle(){return{...g.ZD,color:this.theme.lightTextColor,paddingTop:5,paddingBottom:24}}getGroupTitleStyle(e){const{device:t}=this.environment,o={...g.ZD,marginTop:null!=e&&e.isFirst?8:16,marginBottom:4,textTransform:"uppercase",letterSpacing:1,fontSize:t.isMobile?12:11,color:this.theme.lightTextColor,display:"flex",alignItems:"center",fontWeight:500};return(0,ne.GD)(this.environment,this.publicEditModeStore.state)?{...o,textTransform:void 0,letterSpacing:0,fontSize:13}:o}getIconStyle(e){return e.isLargeDatabaseIcon?{width:16,fill:this.theme.lightIconColor,marginLeft:2,marginRight:12}:{width:20,fill:this.theme.lightIconColor,marginRight:10}}maybeRenderEnterIcon(e){return(0,ne.GD)(this.environment,this.publicEditModeStore.state)&&e.focused&&C.Z.enter({width:14,marginRight:6,fill:this.theme.lightIconColor})}}Dn.displayName="TemplatePicker",Dn.contextTypes={...Mn.wK,...go.w},Dn.wrapStyle={width:"100%",display:"flex",flexDirection:"column",marginBottom:"14vh"},Dn.placeholderWrapStyle={width:"100%"};const Fn=(0,R.injectIntl)(Dn);function Ln(e){return!!e.isIOS&&("local"===J.Z.env||"on"===Ae.default.getGroup("multi-select-new-page-view-block-layout"))}class Vn extends it.Z{constructor(){super(...arguments),this.contentEl=null,this.clickedAddIconState=!1,this.openResolvedDiscussionPopup=()=>{this.stores.resolvedDiscussionButtonPopupStore.setState({open:!0}),this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!0})},this.getContentWrapEl=()=>this.contentEl,this.collectionContextStore=new Be.Z(this.environment),this.discussionInputStore=new Ee.Z(this.environment,(0,M.CG)(this.props.store.pointer.spaceId)),this.documentViewHorizontalOffset=this.createComputedStore((()=>{const{store:e}=this.props;return this.marginCommentsVisible.state&&!this.props.store.isFullWidth()?(0,pe.gC)(this.environment,(0,ie.en)(e),(0,ie.Ks)(e)):0})),this.isCompletionsUiVisible=this.createComputedStore((()=>Boolean((0,$.RR)(Ze.default.state)))),this.storeTypes={headerFocusStore:Qe.default.of(!1),headerMouseStore:Ne.Z,detailsFocusStore:Qe.default.of(!1),detailsMouseStore:Ne.Z,pageViewBlockStore:je.Z,resolvedDiscussionButtonPopupStore:xe.Z,backlinksButtonPopupStore:xe.Z,templatePickerMenuListStore:Ve.Z,pageDescriptionStore:ze},this.isPlaceholderExternalCollection=this.createComputedStore((()=>{const{store:e}=this.props;if(!e.isCollectionView())return!1;const t=e.getCollectionViewSourceCollectionStore();return!!t&&(0,b.OY)(t.getValue())})),this.shouldRenderIconInlineWithTitle=this.createComputedStore((()=>{const{device:e}=this.environment;return!e.isMobile&&this.isInSidePeek()})),this.hasCoverStore=this.createComputedStore((()=>this.props.store.hasCover())),this.hasIconStore=this.createComputedStore((()=>this.props.store.hasIcon())),this.iconStore=this.createComputedStore((()=>{if(this.hasIconStore.state)return this.props.store.getIcon()})),this.renderBacklinksIcon=e=>C.Z.alias({...e,transform:"rotate(180deg)"}),this.titleStore=this.createComputedStore((()=>this.props.store.getTitleStore())),this.canRestorePage=()=>{const{store:e}=this.props;if(!e.canEdit())return!1;const t=e.getParentStore();return!t||t.canEdit()},this.renderRestoreBannerButton=e=>{const t={default:a()(R.FormattedMessage,{defaultMessage:"Restore page",id:"pageViewBlock.trashBanner.restoreButton.label"}),lastVersion:a()(R.FormattedMessage,{defaultMessage:"Restore last version",id:"pageViewBlock.trashBanner.restoreLastVersionButton.label"}),currentPage:a()(R.FormattedMessage,{defaultMessage:"Restore current page",id:"pageViewBlock.trashBanner.restoreCurrentPageButton.label"})};return a()(oo.Z,{style:{marginLeft:12},onClick:this.handleRestoreClick},void 0,t[e])},this.renderRestoreDeleteBannerButtons=()=>a()(c.Fragment,{},void 0,this.renderRestoreBannerButton("default"),a()(oo.Z,{style:{marginLeft:12},onClick:this.handleDeletePermanentlyClick},void 0,a()(R.FormattedMessage,{defaultMessage:"Delete permanently",id:"pageViewBlock.trashBanner.deletePermanentlyButton.label"}))),this.renderMovedBannerContents=e=>{const{store:t,moved:o}=e,{device:i}=this.environment,n=this.canRestorePage(),r={display:"flex",alignItems:"center",justifyContent:"center",...i.isMobile&&{flexWrap:"wrap",paddingTop:8,paddingBottom:8}},s={...i.isMobile&&{marginTop:8}},l=t.id===this.props.store.id,c=a()(l?Yo:Go,{movedSourceBlock:t,moveTarget:o}),d=l?"lastVersion":"currentPage";return a()("div",{style:r},void 0,a()("div",{},void 0,c),n&&a()("div",{style:s},void 0,this.renderRestoreBannerButton(d)))},this.renderDeletedOrMovedBannerContents=()=>{const{store:e}=this.props,{device:t}=this.environment,o=this.canRestorePage(),i=a()(R.FormattedMessage,{defaultMessage:"This page is in Trash.",id:"pageViewBlock.trashBanner.message"}),n=a()(R.FormattedMessage,{defaultMessage:"This page was PERMANENTLY deleted.",id:"pageViewBlock.permanentlyDeleted.message"}),r=fe.fJ(e),s=(0,_.y)(r),l=e.getClosestMovedBlock();return l?this.renderMovedBannerContents(l):t.isMobile&&o?this.renderRestoreDeleteBannerButtons():J.Z.isAdminMode&&s?a()("div",{},void 0,n,this.renderRestoreBannerButton("default")):o?a()(c.Fragment,{},void 0,a()("div",{},void 0,i),this.renderRestoreDeleteBannerButtons()):a()("div",{},void 0,i)},this.renderCollectionTemplatePageBannerContents=e=>{const{device:t}=this.environment,{store:o}=this.props,i=o.getAssociatedCollectionStore();if(!i)return;const r=i.getParentBlockStore();if(!r)return;const s=(0,y.Z)({pageId:r.id}),l=a()(R.FormattedMessage,{defaultMessage:"Back",id:"pageViewBlock.templatePageBanner.backButton.label"});if(t.isMobile)return a()("div",{style:{display:"flex",alignItems:"center",minWidth:0,flexGrow:1}},void 0,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(c.Fragment,{},void 0,a()(Jt.Z,{onClick:this.handleCollectionTemplatePageBannerBackClick,mobileFeedback:!0,style:{marginLeft:-8}},void 0,l),a()("div",{style:{height:18,width:1,marginLeft:4,marginRight:12,flexShrink:0,background:this.theme.darkDividerColor}}))),a()("div",{style:{display:"flex",alignItems:"center",minWidth:0}},void 0,a()(R.FormattedMessage,{defaultMessage:On.editTemplateMobile.defaultMessage,id:On.editTemplateMobile.id,description:On.editTemplateMobile.description,values:{mediumtext:e=>a()("span",{style:{color:this.theme.mediumTextColor}},void 0,e),pageTitleWithIcon:a()(ro.Z,{href:s,style:{marginLeft:8,marginRight:"auto",minWidth:0},innerStyle:{display:"flex",alignItems:"center"}},void 0,a()(lo.Z,{disabled:!0,icon:i.getIcon(),isEmptyPage:!1,size:20}),a()(Mt.Z,{style:{marginLeft:4,marginRight:8},store:i,underline:!0}))}})),a()("div",{style:{marginLeft:"auto"}},void 0,a()(uo.Z,{href:(0,ye.UY)("guides.databaseTemplates"),isRight:!0,analyticsFrom:"collection_template_topbar"})));{const{mediumTextColor:t}=this.theme,o=e?On.editTemplate:On.viewTemplate;return a()("div",{style:{display:"flex",alignItems:"center",minWidth:0,flexGrow:1}},void 0,a()("div",{style:{display:"flex",flex:1}},void 0,a()(Jt.Z,{icon:C.Z.historyBack,isGray:!0,onClick:this.handleCollectionTemplatePageBannerBackClick,style:{marginRight:"auto",marginLeft:this.isPeekContext()?-6:-4}},void 0,l)),a()("div",{style:{display:"flex",alignItems:"center",minWidth:0}},void 0,c.createElement(R.FormattedMessage,n()({},o,{values:{mediumtext:e=>a()("span",{style:{color:t}},void 0,e),pageTitleWithIcon:a()(ro.Z,{href:s,style:{marginLeft:8,marginRight:8,minWidth:0},innerStyle:{display:"flex",alignItems:"center"}},void 0,a()(lo.Z,{disabled:!0,icon:i.getIcon(),isEmptyPage:!1,size:20}),a()(Mt.Z,{style:{marginLeft:4},store:i,underline:!0}))}}))),a()("div",{style:{display:"flex",flex:1}},void 0,a()(no.Z,{href:(0,ye.UY)("guides.databaseTemplates"),style:{marginLeft:"auto",marginRight:-6},onClick:()=>A.trackClickHelpButton(this.environment,{from:"collection_template_topbar"})},void 0,a()(Jt.Z,{isLightGray:!0,icon:C.Z.help},void 0,a()(R.FormattedMessage,{defaultMessage:"Learn more",id:"pageViewBlock.templatePageBanner.learnMoreLink"})))))}},this.renderImportEvernoteBannerContents=()=>{const e=Fe.Z.state.pageMap[this.props.store.id];if(e)return a()(c.Fragment,{},void 0,a()(qt.Z,{isWhite:!0,style:{marginRight:8}}),a()(R.FormattedMessage,{defaultMessage:"Imported {importedNumberOfNotes} of {totalNumberOfNotes}",values:{importedNumberOfNotes:e.importedNotes,totalNumberOfNotes:e.totalNotes},id:"pageViewBlock.evernoteBanner.contents"}))},this.renderEditingPageBannerContents=()=>a()(c.Fragment,{},void 0,a()(R.FormattedMessage,{id:"pageViewBlock.editingPageBanner.status",defaultMessage:"You can now edit this page."}),a()(Jt.Z,{onClick:this.handleStopPublicEdit},void 0,a()(R.FormattedMessage,{id:"pageViewBlock.editingPageBanner.stop",defaultMessage:"Done editing"}))),this.renderInArchivedTeamBannerContents=()=>a()(R.FormattedMessage,{defaultMessage:"This page is in an archived teamspace.",id:"pageViewBlock.archivedTeamBanner.message"}),this.handleAddRandomIconClick=()=>{const{store:e}=this.props;O.createAndCommit({userAction:"PageViewBlock.handleAddRandomIconClick",environment:this.environment,perform:t=>{V.is({store:e,transaction:t})}}),this.clickedAddIconState=!0},this.handleAddRandomCoverClick=()=>{const{store:e}=this.props;O.createAndCommit({userAction:"PageViewBlock.handleAddRandomCoverClick",environment:this.environment,perform:t=>{V.L({store:e,transaction:t})}})},this.handleSubmitNewDiscussion=async()=>{const{device:e}=this.environment,t=this.discussionInputStore.state.textStore.getValue(),o=this.discussionInputStore.state.files;if(t&&t.length>0||o.length>0){const{performResult:i}=O.createAndCommit({userAction:"PageViewBlock.discussionStore",environment:this.environment,perform:e=>N.i8({environment:this.environment,blockStore:this.props.store,commentTextValue:t||[],transaction:e,files:o}),skipUpdatingEditedMetadata:!0});if(this.discussionInputStore.reset(),this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!1}),this.setDiscussionToggleState(!0),i&&!e.isMobile){await d.default.afterNextFlush();const e=Me.Z.find((e=>e.getStore().id===i.id));e&&Y.NX({store:e.getInputStore().state.textStore})}}},this.handleAddDiscussion=async()=>{this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!0}),A.trackOpenBlockDiscussionMenu(this.environment,{from:"page_comments"}),await d.default.afterNextFlush(),Y.NX({store:this.discussionInputStore.state.textStore})},this.handleHideBacklinks=()=>{this.setBacklinksToggleState(!1)},this.handleShowBacklinks=()=>{this.setBacklinksToggleState(!0)},this.handleShowDiscussion=()=>{this.setDiscussionToggleState(!0)},this.handleAddDescriptionClick=()=>{const{device:e}=this.environment,{pageDescriptionStore:t}=this.stores,{currentUserSettingsStore:o}=Pe.default.state,i=this.getDescriptionStore();z({environment:this.environment,pageId:this.props.store.id,store:t,userSettingsStore:o,isExpanded:!0,descriptionStore:i}),d.default.afterNextFlush((()=>{const t=this.getDescriptionStore();t&&(e.isMobileBrowser||Y.NX({store:t}))}))},this.handleHeaderFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,u.E)(t)&&this.stores.headerFocusStore.setState(!0)},this.handleHeaderBlur=()=>{this.stores.headerFocusStore.setState(!1)},this.handleDetailsFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,u.E)(t)&&this.stores.detailsFocusStore.setState(!0)},this.handleDetailsBlur=()=>{this.stores.detailsFocusStore.setState(!1)},this.handleHeaderMouseEnter=()=>{Re.Z.state.isDragging||Je.Z.state.isActive||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{Re.Z.state.isDragging||Je.Z.state.isActive||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleDetailsMouseEnter=()=>{Re.Z.state.isDragging||Je.Z.state.isActive||this.stores.detailsMouseStore.setState({...this.stores.detailsMouseStore.state,mouseEntered:!0})},this.handleDetailsMouseLeave=()=>{Re.Z.state.isDragging||Je.Z.state.isActive||this.stores.detailsMouseStore.setState({...this.stores.detailsMouseStore.state,mouseEntered:!1})},this.handleHideDescription=()=>{const{pageDescriptionStore:e}=this.stores,{currentUserSettingsStore:t}=Pe.default.state,o=this.props.store.id,i=this.getDescriptionStore();z({environment:this.environment,pageId:o,isExpanded:!1,store:e,userSettingsStore:t,descriptionStore:i})},this.handleShowDescription=()=>{const{pageDescriptionStore:e}=this.stores,{currentUserSettingsStore:t}=Pe.default.state,o=this.props.store.id,i=this.getDescriptionStore();z({environment:this.environment,pageId:o,isExpanded:!0,store:e,userSettingsStore:t,descriptionStore:i})},this.handleHeaderMouseEnterThrottled=l().throttle(this.handleHeaderMouseEnter,100),this.handleHeaderMouseLeaveDebounced=l().debounce(this.handleHeaderMouseLeave,100),this.handleDetailsMouseEnterThrottled=l().throttle(this.handleDetailsMouseEnter,100),this.handleDetailsMouseLeaveDebounced=l().debounce(this.handleDetailsMouseLeave,100),this.handleTitleEditText=e=>{const t=this.titleStore.state;t&&(K.eP({environment:this.environment,store:this.props.store}),e.isAtStartOfLine?Y.N_({store:t}):Y.NX({store:t}))},this.handleTitleEsc=e=>{const{onTitleEsc:t}=this.props;Y.ZH(this.environment),t&&t(e)},this.handleTitleTab=e=>{const{store:t}=this.props;if(t.isCollectionView())return!0;if(e.preventDefault(),this.shouldShowProperties()){const e=this.getFormat();if(e&&e.collection_page_properties){const o=e.collection_page_properties.find(((e,t)=>this.canOpenProperty(e.property)));o&&d.default.afterNextFlush((()=>{L.bA({environment:this.environment,blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),collectionContextStore:this.collectionContextStore,store:t,property:o.property,format:nt.C.Page})}))}}},this.handleTitleUntab=e=>{if(this.props.store.isCollectionView())return!0;this.handleTitleEsc(e)},this.handlePlaceholderClick=()=>{const{store:e}=this.props;!e.canEdit()||this.props.store.isLocked()||this.shouldShowSpinner()||(0,ge.X9)()||O.createAndCommit({userAction:"PageViewBlock.handlePlaceholderClick",environment:this.environment,perform:t=>{G.ls({environment:this.environment,store:e,transaction:t})}})},this.handlePlaceholderWrapClick=e=>{(0,le.ZP)({event:e,context:le.Af.EditorClick,callback:this.handlePlaceholderClick})},this.handleRecordIconChange=async e=>{const{store:t}=this.props,o=t.getIconStore();if(o){const t=(0,S.Wv)(e,J.Z.secureFileS3.url,J.Z.secureFileConfig.rootPath,J.Z.secureFileConfig.hostname),i=t?t.link:e,{serverCommitResult:n}=O.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:this.environment,perform:e=>{W.sO({store:o,value:i,transaction:e})}});await n}},this.handleDiscussionWrapMouseDown=e=>{(0,le.ZP)({event:e,context:le.Af.EditorMouseDown,callback:()=>{}})},this.handleDiscussionWrapClick=e=>{(0,le.ZP)({event:e,context:le.Af.EditorClick,callback:()=>{}})},this.handleRestoreClick=()=>{const{store:e}=this.props,{currentSpaceStore:t}=Pe.default.state;t&&X.cB({environment:this.environment,block:e,spaceId:e.pointer.spaceId||t.id})},this.handleDeletePermanentlyClick=()=>{const{store:e}=this.props;X.Rn({environment:this.environment,blocks:[e]})},this.handleCollectionTemplatePageBannerBackClick=()=>{j.back(this.environment)},this.handleStopPublicEdit=()=>{Xe.Z.setState({editing:!1})},this.handleTitleChange=()=>{this.stores.templatePickerMenuListStore.reset()},this.handleAddTitleClick=()=>{const e=this.titleStore.state;e&&(K.ZH(this.environment),Y.NX({store:e}))},this.relatedEventsStore=this.createComputedStore((()=>{const{store:e}=this.props;if(!this.getPageCollectionStore())return[];const t=this.getSchema(),o=Object.entries(t).map((e=>{let[t,o]=e;if(!o||"relation"!==o.type||!o.connectedRelation)return;const i=f.j0(o);return i?{property:t,relatedCollectionPointer:i}:void 0})).filter(B.$K);if((0,s.isEmpty)(o))return[];const i=[];for(const{property:n,relatedCollectionPointer:r}of o){const t=$e.N.createChildStore(e,r).getFormat();if(t.integration_id&&"google_calendar"===(0,P.s9)(t.integration_id)){const t=e.getPropertyValue(n);i.push(...v.rq(t))}}return i})),this.numberOfBacklinks=this.createComputedStore((()=>(0,te.L)(this.props.store,this.environment).backlinks.length)),this.discussionToggleStore=this.createComputedStore((()=>{const e=this.props.store.id;return"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.getToggleState({environment:this.environment,type:"discussion",id:e})})),this.backlinksToggleStore=this.createComputedStore((()=>{const e=this.props.store.id;return"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.getToggleState({environment:this.environment,type:"backlinks",id:e})})),this.inlinePropertyIDsStore=this.createComputedStore((()=>{const e=this.getFormat();if(!e)return;const{store:t}=this.props,o=e.collection_page_sections||[],i=this.getSchema();return o.filter((e=>{const o=i[e.section];if(!o||"relation"!==o.type)return;const n=t.getPropertyValue(e.section),r=v.j$({relationValue:v.rq(n),propertySchema:o,getRecordValue:t.getRecordValue}).length;return"inline"===e.visibility&&i[e.section]&&0!==r})).map((e=>e.section))})),this.minimalPropertyIDsStore=this.createComputedStore((()=>{const e=this.getFormat();if(!e)return;const{store:t}=this.props,o=e.collection_page_sections||[],i=this.getSchema();return o.filter((e=>{const o=i[e.section];if(!o||"relation"!==o.type)return;const n=t.getPropertyValue(e.section),r=v.j$({relationValue:v.rq(n),propertySchema:o,getRecordValue:t.getRecordValue}).length;return"minimal"===e.visibility&&i[e.section]||"inline"===e.visibility&&i[e.section]&&0===r})).map((e=>e.section))})),this.showTemplatePickerStore=this.createComputedStore((()=>{const{store:e,loadingContainerStore:t}=this.props,o=this.environment.currentUser.isLoggedIn(),i=this.pageContext&&this.pageContext.publicEditModeStore.state;return Boolean(e&&t&&e.isDefined()&&!e.isLocked()&&e.canEdit()&&!e.hasContent()&&o&&(!(null!=i&&i.hasPublicPermission)||"edit"===(null==i?void 0:i.permission))&&!this.shouldShowSpinner()&&t.state.ready&&!this.isExternallySyncedPage()&&(!(0,ne.GD)(this.environment,i)||"completionPopup"!==Ze.default.state.type))})),this.emptyTitlePlaceholderStore=this.createComputedStore((()=>{const{store:e}=this.props,t=e.getModel();return null==t?void 0:t.getEmptyTitlePlaceholder({getRecordModel:e.getRecordModel,userTimeZone:(0,k.r)(),intl:de.default.getIntl()})})),this.shouldShowCollectionViewBlockTitle=this.createComputedStore((()=>{const{store:e}=this.props;if(e.getCollectionViewSourceCollectionStore())return!0;const t=this.titleStore.state;if(!t)return!1;if(x.Q(t.getValue()))return!0;return!!(0,Ce.J5)(t)}))}get registries(){return super.registries.concat(Te.Z)}getContentInnerWidth(){const e=this.getContentWrapEl();if(e){const t=e.getBoundingClientRect().width,o=this.getContentPadding()??{paddingLeft:0,paddingRight:0};return t-o.paddingLeft-o.paddingRight}}getContentPadding(){const e=this.getContentWrapEl();if(e){if(Ln(this.environment.device))return{paddingLeft:0,paddingRight:0};const t=getComputedStyle(e),o=parseFloat(t.getPropertyValue("padding-left")),i=parseFloat(t.getPropertyValue("padding-left"));return{paddingLeft:l().isNaN(o)?0:o,paddingRight:l().isNaN(i)?0:i}}}willMount(e){super.willMount(e);const{store:t}=this.props,{currentUserSettingsStore:o}=Pe.default.state,i=t.id;this.stores.pageDescriptionStore=new ze,function(e){const{pageId:t,store:o,userSettingsStore:i,descriptionHasText:n}=e;let r=n;H(i).includes(t)&&(r=!1),o.setState({isExpanded:r})}({pageId:i,store:this.stores.pageDescriptionStore,userSettingsStore:o,descriptionHasText:this.descriptionHasText()})}willMountOrUpdate(e){super.willMountOrUpdate(e);const{store:t,context:o}=e;var i;"page"===this.environment.RouterStore.state.route.name&&(null===(i=this.environment.mobileNative)||void 0===i||i.markTransitionReady({type:"page",id:this.props.store.id}));const n=this.getPageCollectionStore();if(this.collectionContextStore.collectionStore()!==n&&n){const e=n.getParentBlockStore();this.collectionContextStore.setContext({type:"collectionPage",collectionViewBlockStore:e,collectionStore:n})}if(o===je.S.Frame){const e=this.pageContext&&this.pageContext.publicEditModeStore.state;null!=e&&e.hasPublicPermission&&"edit"===e.permission&&!t.isTemplate()?D.Bw({bannerStore:this.getBannerStore(),id:"EditingPageBanner",render:this.renderEditingPageBannerContents,type:to.$.White}):D.qL({bannerStore:this.getBannerStore(),id:"EditingPageBanner"})}if(this.isFrameOrPeekContext()){const e=fe.oZ(t),o=fe.wf(t),i=fe.D0(t);if(((0,I.Eu)(e)||(0,I.D7)(e))&&Ae.default.checkGate("space_consolidation_read_only"))D.Bw({bannerStore:this.getBannerStore(),id:"SpaceContentDuplicationPage",render:()=>this.renderSpaceContentDuplicationBanner(e),type:to.$.Red});else if(o)D.Bw({bannerStore:this.getBannerStore(),id:"DeletedPage",render:this.renderDeletedOrMovedBannerContents,type:to.$.Red});else if(i)D.Bw({bannerStore:this.getBannerStore(),id:"ArchivedTeamPage",render:this.renderInArchivedTeamBannerContents,type:to.$.Red});else for(const t of["SpaceContentDuplicationPage","DeletedPage","ArchivedTeamPage"])D.qL({bannerStore:this.getBannerStore(),id:t})}if(this.isFrameOrPeekContext()&&(t.isTemplate()?D.Bw({bannerStore:this.getBannerStore(),id:"CollectionTemplatePage",render:()=>this.renderCollectionTemplatePageBannerContents(this.canEdit()),type:to.$.Beige}):D.qL({bannerStore:this.getBannerStore(),id:"CollectionTemplatePage"})),o===je.S.Frame){Fe.Z.state.pageMap[t.id]?D.Bw({bannerStore:this.getBannerStore(),id:"ImportingEvernotePage",render:this.renderImportEvernoteBannerContents,type:to.$.Blue}):D.qL({bannerStore:this.getBannerStore(),id:"ImportingEvernotePage"})}}didMount(){const{device:e}=this.environment,{store:t,context:o}=this.props,i=this.titleStore.state,n=this.environment.RouterStore.state;let r;var a,s,l,c,d,p;"page"===n.route.name&&(r=n.route.mobileData,ke.default.updateInitialPageRenderSubMetrics({is_push:null===(a=r)||void 0===a?void 0:a.isPush}));if((0,_e.startDangerouslyLoadingDependenciesForConsumer)("clipboardActions"),(0,ce.L)(),e.isPhone){const{PageScroller:e}=be.Z;if(e){if(e.scrollerEl()&&this.canEdit()&&!this.hasCoverStore.state){const t=this.getTitlePaddingHeightWithPaddingTop();e.scrollTo(t)}}}i&&this.shouldSelectTitleOnMount()&&(K.eP({environment:this.environment,store:t}),Y.NX({store:i}),e.isAndroid&&(0,me.Y)("supportsUntitledPageAutoSelectOnStart")&&(null===(s=this.environment.mobileNative)||void 0===s||s.forceShowSoftKeyboard()));if(o===je.S.Frame&&!this.props.store.isCollectionView())if(ke.default.initialRenderCompleted){if(!ke.default.lastNavigationRenderCompleted&&ke.default.lastNavigationTime&&ke.default.lastNavigationTimePerformance){var u;ke.default.setLastNavigationRenderCompleted(),ke.default.emit(this.environment,{type:"navigation_page_render",startDateTime:ke.default.lastNavigationTime,startPerformanceTime:ke.default.lastNavigationTimePerformance},{is_push:(null===(u=r)||void 0===u?void 0:u.isPush)??!1}),this.markTransitionReadyIfNewPageRender()}}else ke.default.setInitialRenderCompleted(),ke.default.emit(this.environment,{type:"initial_page_render",startDateTime:ke.default.appStartTime,startPerformanceTime:ke.default.appStartTimePerformance},{sub_metrics:ke.default.getInitialPageRenderSubMetrics()}),this.markTransitionReadyIfNewPageRender(),"production"!==J.Z.env&&(null===(l=window.performance)||void 0===l||null===(c=l.mark)||void 0===c||c.call(l,"initial_page_render_completed"),null===(d=window.performance)||void 0===d||null===(p=d.measure)||void 0===p||p.call(d,"initial_page_render",void 0,"initial_page_render_completed"));this.maybeSelectFirstBlockForAiOnboarding()}willUnmount(){super.willUnmount(),this.isFrameOrPeekContext()&&(D.qL({bannerStore:this.getBannerStore(),id:"DeletedPage"}),D.qL({bannerStore:this.getBannerStore(),id:"CollectionTemplatePage"}))}renderCollectionPageViewBlock(){const{store:e,context:t,style:o,paddingLeft:i,paddingRight:n}=this.props,{WindowSizeStore:r}=this.environment;if(e.isCollectionView()){if(t===je.S.CollectionPageView){let e=this.renderCollectionPageViewContent();return(0,he.Aw)(this.environment)&&(e=a()(Ht.O,{displayName:"PageContent",style:{...Vn.wrapStyle,...o},disabled:!this.canEdit()||this.props.store.isLocked()},void 0,e)),e}return c.createElement(c.Fragment,null,this.renderCollectionHeader(e),a()("div",{style:{paddingLeft:r.getSafePaddingLeftCSS(i),paddingRight:r.getSafePaddingRightCSS(n)}},void 0,this.renderPageDiscussion(!0)),this.renderCollectionView(e))}}renderCollectionPageViewContent(){const{store:e}=this.props;if(e.isCollectionView())return a()("main",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5}},void 0,a()(ut.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth()},render:()=>a()("div",{style:{maxWidth:"100%",minWidth:0}},void 0,this.renderDocumentView())}),!this.environment.device.isMobile&&a()(Ut,{pageBlockStore:this.props.store,isVisible:this.marginCommentsVisible.state,context:this.props.context,pageViewBlockAccessor:this.getContentWrapEl}))}renderPersisted(){if(this.props.store.isCollectionView())return a()(Q.L1,{value:this.collectionContextStore},void 0,this.renderCollectionPageViewBlock());let e=this.getPageContent();return this.collectionContextStore&&this.collectionContextStore.contextType&&(e=a()(Q.L1,{value:this.collectionContextStore},void 0,e)),(0,he.Aw)(this.environment)?a()(Ht.O,{displayName:"PageContent",style:{...Vn.wrapStyle,...this.props.style},disabled:!this.canEdit()||this.props.store.isLocked()},void 0,e):e}getPageContent(){const e=this.isMiniPeekContext(),t=!this.isExternallySyncedPage(),o=-1*this.documentViewHorizontalOffset.state;return c.createElement(c.Fragment,null,!e&&this.renderPageCover(),a()("div",{style:{width:"100%",display:"flex",justifyContent:"center",zIndex:E.db,flexShrink:0}},void 0,a()(ut.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth(),translateX:o},render:()=>a()("div",{style:{maxWidth:"100%",minWidth:0}},void 0,this.renderPageHeader())})),t&&a()("main",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5}},void 0,a()(ut.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth(),translateX:o},render:()=>a()("div",{style:{maxWidth:"100%",minWidth:0}},void 0,this.renderDocumentView())}),this.props.context===je.S.Frame&&a()(Ut,{pageBlockStore:this.props.store,isVisible:this.marginCommentsVisible.state,context:this.props.context,pageViewBlockAccessor:this.getContentWrapEl})))}renderDetailsDivider(e){return a()("div",{style:{width:"100%",height:1,background:this.theme.regularDividerColor,marginBottom:8}},e)}renderPageHeader(){const{device:e,WindowSizeStore:t}=this.environment,{store:o,paddingLeft:i,paddingRight:n}=this.props,r=!this.isMiniPeekContext(),s=this.renderIcon(),l=this.renderProperties(),d=this.renderInlinePageSections(),p=this.renderPageDiscussion(),u=this.renderBacklinks(),m=this.renderContextualInvite(),g=[];l&&g.push(l),m&&g.push(m),d&&g.push(d),u&&(g.length>0&&g.push(this.renderDetailsDivider(3)),g.push(u)),p&&(g.length>0&&g.push(this.renderDetailsDivider(2)),g.push(p)),g.length>0&&g.push(this.renderDetailsDivider(1));let h=[],f=[];r&&(h=this.getTopControls(),f=this.getBottomControls(u,p),this.addCommentControl(h,f,p));const v=a()("div",{style:this.getHeaderControlsStyle(),className:"notion-page-controls"},void 0,h),y=e.isMobile&&!this.hasCoverStore.state;return a()(c.Fragment,{},void 0,a()("div",{style:this.getHeaderStyle(),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced},void 0,a()("div",{style:{maxWidth:"100%",paddingLeft:t.getSafePaddingLeftCSS(i),width:"100%"}},void 0,a()(pt.p,{onFocus:this.handleHeaderFocus,onBlur:this.handleHeaderBlur,allowSelectionWithin:!1,style:{pointerEvents:"none"}},void 0,y&&v,!this.shouldRenderIconInlineWithTitle.state&&s,!y&&v),a()("div",{style:{paddingRight:t.getSafePaddingRightCSS(n)}},void 0,this.shouldRenderIconInlineWithTitle.state?a()("div",{style:{display:"flex",alignItems:"flex-start"}},void 0,s,this.renderTitle()):this.renderTitle(),o.isExternalObjectInstancePageBlockStore()&&o.hasError()&&a()(po.Z,{store:o,canEdit:o.canEdit()})))),r&&a()("div",{style:this.getHeaderStyle(),onMouseEnter:this.handleDetailsMouseEnterThrottled,onMouseMove:this.handleDetailsMouseEnterThrottled,onMouseLeave:this.handleDetailsMouseLeaveDebounced},void 0,a()(pt.p,{onFocus:this.handleDetailsFocus,onBlur:this.handleDetailsBlur,allowSelectionWithin:!0,style:{paddingLeft:t.getSafePaddingLeftCSS(i),paddingRight:t.getSafePaddingRightCSS(n),maxWidth:"100%",width:"100%"}},void 0,g,f.length>0&&a()("div",{style:this.getDetailControlsSectionStyle(),className:"notion-page-details-controls"},void 0,f),a()(ot.Z,{store:o},o.id))))}getTopControls(){const e=[],t=this.renderAddIcon();t&&e.push(t);const o=this.renderAddCover();return o&&e.push(o),e}getBottomControls(e,t){const o=[],i=!e&&this.renderShowBacklinks();i&&o.push(i);const n=!t&&this.renderShowDiscussion();n&&o.push(n);const r=this.renderResolveDiscussionButtonPopupMenu();r&&t&&o.unshift(r);const a=this.renderMinimalPageSections();return a&&o.push(a),o}addCommentControl(e,t,o){const{device:i}=this.environment,n=this.renderAddDiscussion(!1),r=this.renderAddDiscussion(!0);!o&&t.length>0||i.isMobile&&0===e.length?r&&t.push(r):n&&e.push(n)}renderCollectionHeader(e){const{paddingLeft:t,paddingRight:o}=this.props,{WindowSizeStore:i}=this.environment,n=a()("div",{onFocus:this.handleHeaderFocus,onBlur:this.handleHeaderBlur,style:{...this.getHeaderControlsStyle()},className:"notion-page-controls"},void 0,this.renderAddIcon(),this.renderAddCover(),this.renderLinkedCollectionViewBlockAddTitle(),this.renderDescriptionToggle()),r=this.shouldShowCollectionViewBlockTitle.state,s=a()("div",{style:{display:"flex",alignItems:"flex-start"}},void 0,this.renderIcon(),r&&this.renderTitle());return a()("div",{style:this.getHeaderStyle(),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced},void 0,this.renderPageCover(),a()(ut.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth()},render:()=>a()("div",{style:{maxWidth:"100%",paddingLeft:i.getSafePaddingLeftCSS(t)}},void 0,n,a()("div",{style:{paddingRight:i.getSafePaddingRightCSS(o),marginBottom:8}},void 0,s,this.shouldShowDescription()&&this.renderDescription(),this.renderProperties()))}))}renderSyncedCollectionIndicators(){const{store:e}=this.props;if(!e.isCollectionView()||!this.collectionContextStore)return;const t=e.getCollectionViewSourceCollectionStore();return t?a()(yn.Z,{collectionStore:t,collectionContextStore:this.collectionContextStore}):void 0}renderPageCover(){const{WindowSizeStore:e}=this.environment,{store:t,paddingLeft:o,paddingRight:i,pageCoverHeight:n}=this.props,r=t.isCollectionView()?"20vh":n;return a()(pt.p,{allowSelectionWithin:!1,style:this.getPageCoverStyle(),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced},void 0,a()(Ro,{height:r,store:t,disabled:!this.isEditable(),paddingLeft:e.getSafePaddingLeftCSS(o),paddingRight:e.getSafePaddingRightCSS(i)}))}isExternallySyncedPage(){const{store:e}=this.props;if(e.isCollectionView()){const t=e.getCollectionViewSourceCollectionStore();return!!t&&t.isSyncedCollection()}return e.isType(h.Ti.externalObjectInstancePage)}getIconSize(){const{store:e}=this.props;if(!this.isInSidePeek()){if(!e.isCollectionView())return 140;if(this.isExternallySyncedPage())return 74}return 36}renderIcon(){const{store:e}=this.props,t=this.hasIconStore.state,{device:o}=this.environment;if(!t)return;const i={position:"relative",zIndex:1,marginLeft:3,marginBottom:o.isMobile?8:0,marginTop:4,pointerEvents:"auto"};let n;e.isCollectionView()||this.isInSidePeek()?i.marginRight=6:i.marginTop=this.hasCoverStore.state?-80:o.isMobile?0:(0,ee.CP)(this.environment),n=e.isCollectionView()||this.isInSidePeek()?{marginTop:(o.isMobile,4),marginRight:8}:{marginTop:this.hasCoverStore.state?-42:o.isMobile?0:(0,ee.CP)(this.environment)};const r=this.getIconSize(),s=e.isCollectionView()||this.isInSidePeek()?36:78;if(this.isEditable()){var l,c;const t=null===(l=e.getIconStore())||void 0===l?void 0:l.table;return a()(lo.Z,{disabled:!1,bucket:"secure",icon:this.iconStore.state,store:e,isEmptyPage:e.isEmptyPage(),onChange:this.handleRecordIconChange,size:r,emojiSize:s,style:i,emojiStyle:n,largeIcon:!0,openMenuOnMount:this.clickedAddIconState,openMenuOnMountCallback:()=>{this.clickedAddIconState=!1},iconLoggingData:{recordTable:t,source:"page_header",block_type:e.getType(),collection_id:"collection"===t?null===(c=e.getIconStore())||void 0===c?void 0:c.id:void 0}})}return a()(lo.Z,{disabled:!0,icon:this.iconStore.state,isEmptyPage:e.isEmptyPage(),size:r,emojiSize:s,style:i,emojiStyle:n,largeIcon:!0})}renderAddIcon(){const{device:e}=this.environment;if(this.isEditable()&&!this.hasIconStore.state)return a()(Jt.Z,{style:this.getControlHoverStyle(),isLightGray:!0,onClick:this.handleAddRandomIconClick,icon:C.Z.addPageIcon},"add-icon",e.isSmallPhone?a()(R.FormattedMessage,{id:"pageViewBlock.add.pageIconMobile",defaultMessage:"Icon"}):a()(R.FormattedMessage,{id:"pageViewBlock.add.pageIcon",defaultMessage:"Add icon"}))}renderAddCover(){const{device:e}=this.environment;if(this.isEditable()&&!this.hasCoverStore.state)return a()(Jt.Z,{style:this.getControlHoverStyle(),isLightGray:!0,onClick:this.handleAddRandomCoverClick,icon:C.Z.addPageCover},"add-cover",e.isSmallPhone?a()(R.FormattedMessage,{id:"pageViewBlock.add.pageCoverMobile",defaultMessage:"Cover"}):a()(R.FormattedMessage,{id:"pageViewBlock.add.pageCover",defaultMessage:"Add cover"}))}renderLinkedCollectionViewBlockAddTitle(){var e;const{store:t}=this.props,{device:o}=this.environment;if(!this.isEditable()||!t.isCollectionView()||t.getCollectionViewSourceCollectionStore())return;return x.Q(null===(e=this.titleStore.state)||void 0===e?void 0:e.getValue())?void 0:a()(Jt.Z,{style:this.getControlHoverStyle(),isLightGray:!0,onClick:this.handleAddTitleClick,icon:C.Z.typesTitle},"add-title",o.isSmallPhone?a()(R.FormattedMessage,{id:"pageViewBlock.add.pageTitleMobile",defaultMessage:"Title"}):a()(R.FormattedMessage,{id:"pageViewBlock.add.pageTitle",defaultMessage:"Add title"}))}renderDescriptionToggle(){const{store:e}=this.props,{device:t}=this.environment;if(e.isCollectionView()&&e.getCollectionViewSourceCollectionStore())return this.shouldShowDescription()?a()(Jt.Z,{isLightGray:!0,style:this.getControlHoverStyle(),onClick:this.handleHideDescription,icon:C.Z.collectionDescriptionSmall},void 0,a()(R.FormattedMessage,{defaultMessage:"Hide description",id:"pageViewBlock.hideDescription.button"})):this.isEditable()&&!this.descriptionHasText()?a()(Jt.Z,{isLightGray:!0,style:this.getControlHoverStyle(),onClick:this.handleAddDescriptionClick,icon:C.Z.collectionDescriptionSmall},void 0,t.isSmallPhone?a()(R.FormattedMessage,{defaultMessage:"Description",id:"pageViewBlock.addDescription.mobileButton"}):a()(R.FormattedMessage,{defaultMessage:"Add description",id:"pageViewBlock.addDescription.button"})):this.descriptionHasText()?a()(Jt.Z,{isLightGray:!0,style:this.getControlHoverStyle(),onClick:this.handleShowDescription,icon:C.Z.collectionDescriptionSmall},void 0,t.isSmallPhone?a()(R.FormattedMessage,{defaultMessage:"Description",id:"pageViewBlock.showDescription.mobileButton"}):a()(R.FormattedMessage,{defaultMessage:"Show description",id:"pageViewBlock.showDescription.button"})):void 0}renderAddDiscussion(e){const{device:t}=this.environment,{store:o}=this.props;if(!re.A$("comments","section_hide")&&!o.isCollectionView()&&!o.isInsideCollection()&&!this.hasDiscussionToShow()&&o.canComment()&&this.environment.currentUser.isLoggedIn()&&!this.stores.pageViewBlockStore.state.forceDiscussionOpen)return a()(Jt.Z,{style:this.getControlHoverStyle(e),isLightGray:!0,onClick:this.handleAddDiscussion,icon:C.Z.addPageDiscussion},"add-comment",t.isSmallPhone?a()(R.FormattedMessage,{id:"pageViewBlock.add.pageCommentMobile",defaultMessage:"Comment"}):a()(R.FormattedMessage,{id:"pageViewBlock.add.pageComment",defaultMessage:"Add comment"}))}renderShowDiscussion(){if(!re.A$("comments","section_hide")&&this.hasDiscussionToShow()){const e=this.getNumberOfComments();return a()(Jt.Z,{isGray:!0,onClick:this.handleShowDiscussion,icon:C.Z.addPageDiscussion,style:this.getDetailControlButtonStyle()},"show-comments",a()(R.FormattedMessage,{id:"pageViewBlock.show.pageComments",defaultMessage:"{numberOfComments, plural, one {{numberOfComments} comment} other {{numberOfComments} comments}}",values:{numberOfComments:e}}))}}renderShowBacklinks(){const e=this.numberOfBacklinks.state;if(0===e)return;if(re.A$("backlinks","section_hide"))return;const t=t=>{let{onClick:o=l().noop,tooltipEvents:i={},buttonPopupEvents:r={}}=t;return c.createElement(Jt.Z,n()({isGray:!0,icon:this.renderBacklinksIcon,style:this.getDetailControlButtonStyle(),onClick:o},r,i),a()(R.FormattedMessage,{id:"pageViewBlock.show.backlinks",defaultMessage:"{numberOfBacklinks, plural, one {{numberOfBacklinks} backlink} other {{numberOfBacklinks} backlinks}}",values:{numberOfBacklinks:e}}))},o=a()(co.Z,{renderTooltip:()=>a()(R.FormattedMessage,{defaultMessage:"Show pages linked to this page",id:"pageViewBlock.show.backlinks.tooltip"}),placement:co.Z.Placement.Bottom,delayThreshold:400,render:e=>t({tooltipEvents:e,onClick:this.handleShowBacklinks})},"show-backlinks"),i=a()(io.Z,{buttonPopupStore:this.stores.backlinksButtonPopupStore,popupType:io.Z.PopupType.Popup,renderOrigin:e=>t({buttonPopupEvents:e}),render:()=>{const e={menuType:ue.og.Popup,width:500};return c.createElement(ao.Z,e,this.renderBacklinksContent({disableHeader:!0}))}},"backlinks-popup");return re.A$("backlinks","section_collapsed")?i:o}renderTitle(){const{device:e}=this.environment,{store:t}=this.props,o=this.canEditCollection()&&!t.isLocked()&&!this.isExternallySyncedPage()&&!(0,ee.xe)(t.id),i=this.titleStore.state;if(!this.isPlaceholderExternalCollection.state&&i){const r=qe.G.createChildStore(i,t.pointer),s=t.isEmptyPage(),l=t.isTemplate(),d=this.showTemplatePickerStore.state,p=t.getParentCollectionTemplateStores(),u=p&&0===p.length,m=this.props.store,h=m.getSyncedUri(),f=h?(0,se.pI)(h,t.pointer.spaceId):void 0,v={...g.ZD,width:m.isExternalObjectInstancePageBlockStore()?"inherit":"100%"},y=e.isIOS,b=a()(No.Z,{style:v,store:i,placeholderStyle:{...g.ZD,WebkitTextFillColor:this.theme.pageTitlePlaceholderTextColor,cursor:"text"},disabled:!o,placeholder:this.emptyTitlePlaceholderStore.state,disableSlashCommands:!0,disableSelectAllBlocks:!0,disableStyleAnnotations:!0,disableMobileActionBar:!1,disableShiftEnter:!0,disableEmbedMenu:!0,onEsc:this.handleTitleEsc,onUntab:this.handleTitleUntab,onTab:this.handleTitleTab,disableUpDownArrows:!(!d||l||u||e.isMobile)&&s,disableEnter:!(!d||l||u||e.isMobile)&&s,onChange:this.handleTitleChange,disableHorizontalEdgeScroll:!0,pasteBehavior:"block"});return a()("div",{style:this.shouldRenderIconInlineWithTitle.state?{flex:1}:void 0},void 0,a()(fn.Z,{canSelect:!1,canDrag:!1,canEditText:o,onEditText:this.handleTitleEditText,store:r,style:this.getTitleStyle(),analyticsName:"page_content",shouldShowDropZone:!0},void 0,y?a()(pt.p,{style:v,allowSelectionWithin:!0},void 0,b):b,m.isExternalObjectInstancePageBlockStore()&&a()(co.Z,{placement:co.Z.Placement.Bottom,renderTooltip:e=>c.createElement(R.FormattedMessage,n()({},e,{defaultMessage:"Link to original url",description:"Link to the original source of the data.",id:"pageViewBlock.syncedBlock.original"})),render:e=>a()(ro.Z,{href:f,ignoreLocalHoverState:!0,hovered:!1},void 0,c.createElement(Xt.Z,n()({},e,{icon:()=>C.Z.link({width:16,fill:this.theme.mediumIconColor}),style:{marginLeft:4},onClick:()=>{f&&j.navigateToExternalURL({url:f,environment:this.environment})}})))}),m.isExternalCollectionBlockStore()&&!e.isMobile&&a()(po.Z,{store:m,canEdit:m.canEdit(),buttonStyle:{fontWeight:"normal",margin:0}})),a()("div",{style:{marginLeft:4}},void 0,this.renderSyncedCollectionIndicators()))}}renderDescription(){const{device:e}=this.environment,{pageDescriptionStore:t}=this.stores,{store:o}=this.props,{currentUserSettingsStore:i}=Pe.default.state,n=o.getCollectionViewSourceCollectionStore(),r=this.getDescriptionStore();if(r&&t.isExpanded())return a()(Uo,{descriptionStore:r,disabled:!this.isEditable(),canEdit:this.canEdit(),locked:this.props.store.isLocked(),pageId:this.props.store.id,isMobile:e.isMobile,collectionStore:n,toggleStore:this.stores.pageDescriptionStore,userSettingsStore:i})}renderContextualInvite(){if(!Ae.default.checkGate("meeting_notes_contextual_sharing"))return null;const e=this.relatedEventsStore.state;return e.length>0?a()(eo,{store:this.props.store,events:e}):void 0}renderProperties(){const{store:e}=this.props;if(e.isCollectionViewPageWithContent())return;const t=this.getPageCollectionStore();if(!t)return;const o=this.getSchema(),i=this.getFormat(),n=e.isLocked();return i?a()(Ui,{store:e,collectionStore:t,schema:o,format:i,disabled:!this.canEdit(),locked:n,width:"100%",blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),isInPeekRenderer:this.isPeekContext()},"page-properties"):void 0}renderInlinePageSections(){const{store:e,disabled:t}=this.props,o=this.getPageCollectionStore();if(!o)return;const i=this.getSchema(),n=this.getFormat(),r=e.isLocked();if(!n)return;const s=this.inlinePropertyIDsStore.state;return s&&s.length?a()(hn,{propertyIds:s,store:e,collectionStore:o,disabled:t,locked:r,schema:i,handleMouseMove:this.handleDetailsMouseEnter,handleMouseLeave:this.handleDetailsMouseLeave,handleContextMenu:()=>{},blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),format:n,isInPeekRenderer:this.isPeekContext()}):void 0}renderMinimalPageSections(){const{store:e,disabled:t}=this.props,o=this.getPageCollectionStore();if(!o)return;const i=this.getSchema(),n=this.getFormat(),r=e.isLocked();if(!n)return;const s=this.minimalPropertyIDsStore.state;return s&&s.length?a()(hn,{propertyIds:s,store:e,collectionStore:o,disabled:t,locked:r,schema:i,handleMouseMove:this.handleDetailsMouseEnter,handleMouseLeave:this.handleDetailsMouseLeave,handleContextMenu:()=>{},blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),format:n,type:"minimal",isInPeekRenderer:this.isPeekContext()}):void 0}renderPageDiscussion(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(re.A$("comments","section_hide"))return;const t=this.environment.currentUser.isLoggedIn(),o=this.shouldShowDiscussion(),{store:i}=this.props,n=ve.vV(i,{recursivelyLoadAllDiscussions:!1}),r=!e&&t&&i.canComment()&&0===n.length&&!this.isExternallySyncedPage();return o&&(r||0!==n.length)?a()("div",{style:{width:"100%",margin:"0 auto"},onMouseDown:this.handleDiscussionWrapMouseDown,onClick:this.handleDiscussionWrapClick,className:oe.KA2},"page-discussion",n.map(((e,t,o)=>a()(at.Z,{store:e,format:ae.O2.Page,isFirst:0===t,isOnly:1===o.length,discussionLocation:"page_discussion",showResolveButtonByDefaultIfPossible:!1,blockStore:i,discussionInputStore:this.discussionInputStore},e.id))),r&&a()("div",{style:{padding:"6px 4px 12px"}},void 0,a()(st.Z,{showAvatar:!0,parentStore:i,onSubmit:this.handleSubmitNewDiscussion,onCancel:()=>Y.ZH(this.environment),discussionInputStore:this.discussionInputStore,discussionFormat:ae.O2.Page,isMobileSlideUpMenu:!1,shouldSaveUnsentComments:!0,canDrop:!0,blockStore:i}))):void 0}renderResolveDiscussionButtonPopupMenu(){const{device:e}=this.environment,t=ve.mY(this.props.store,{recursivelyLoadAllDiscussions:!1});if(0===t.length)return;const o=a()(R.FormattedMessage,{id:"pageViewBlock.showResolvedComments.button",defaultMessage:"{numberOfResolvedComments, plural, one {{numberOfResolvedComments} resolved comment} other {{numberOfResolvedComments} resolved comments}}",values:{numberOfResolvedComments:t.length}});return(0,we.Sx)(this.environment)?a()(Jt.Z,{icon:C.Z.thinCheck,isGray:!0,style:this.getDetailControlButtonStyle(),onClick:()=>{F.Ib({environment:this.environment,blockStore:this.props.store,analyticsFrom:"page_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1,discussionIds:t.map((e=>e.id))})}},void 0,o):a()(io.Z,{buttonPopupStore:this.stores.resolvedDiscussionButtonPopupStore,popupType:e.isMobile?io.Z.PopupType.SlideUp:io.Z.PopupType.Popup,renderOrigin:e=>c.createElement(Jt.Z,n()({icon:C.Z.thinCheck,isGray:!0,style:this.getDetailControlButtonStyle()},e),o),render:o=>{let i;return i=e.isMobile?{menuType:ue.og.Modal,title:a()(R.FormattedMessage,{defaultMessage:"Resolved comments",id:"pageViewBlock.resolvedComments.menuTabTitle"}),right:a()(so.DoneMenuText,{}),onClickRight:o.close,whiteBackground:!0}:{menuType:ue.og.Popup,width:500},c.createElement(ao.Z,i,t.map(((e,t,i)=>a()(vn.Z,{store:e,droppable:!0,render:()=>a()(at.Z,{store:e,format:ae.O2.Menu,isFirst:0===t,isOnly:1===i.length,discussionLocation:"page_discussion",showResolveButtonByDefaultIfPossible:!0,blockStore:this.props.store,onDismiss:o.close},e.id)},e.id))))}},"resolve-discussions")}renderCollectionView(e){if(!e.isCollectionView())return;const{paddingLeft:t,paddingRight:o,context:i}=this.props,n=this.getCurrentCollectionViewId();return a()(rt.Z,{overridePaddingLeft:t,overridePaddingRight:o,store:e,isFullScreen:!0,viewId:n,disabled:this.props.disabled,hideHeaderActions:i===je.S.InAppTemplatePreview})}renderDocumentView(){const e=this.getLayoutContentStyles(),t=this.isEmptyContentBlock()?this.handlePlaceholderWrapClick:void 0;return Ln(this.environment.device)?a()("div",{style:e.wrapper},void 0,e.leftPadding&&a()(pt.p,{allowSelectionWithin:!1,style:e.leftPadding,onClick:t}),this.renderDocumentViewContent(e.body,t),e.rightPadding&&a()(pt.p,{allowSelectionWithin:!1,style:e.rightPadding,onClick:t})):this.renderDocumentViewContent(e.nonIOSLayoutBody,t)}renderDocumentViewContent(e,t){const{store:o}=this.props,i=this.shouldShowSpinner(),n=this.showTemplatePickerStore.state;return c.createElement("div",{style:e,ref:e=>{e&&(this.contentEl=e)},className:oe.QS0,onClick:t},!this.isExternallySyncedPage()&&a()(mo.Z,{store:o.getContentStore(),emptyDroppableStyle:{width:"100%"},disabled:this.props.store.isLocked()||this.props.disabled}),i&&a()(qt.Z,{}),this.isFrameOrPeekContext()&&n&&a()(Fn,{store:o,menuListStore:this.stores.templatePickerMenuListStore}))}renderSpaceContentDuplicationHelpCenterButton(){return a()(oo.Z,{style:{marginLeft:12},onClick:()=>{const e=(0,ye.UY)("guides.domainManagement");j.navigateToExternalURL({environment:this.environment,url:e})}},void 0,a()(R.FormattedMessage,{defaultMessage:"Learn more",id:"pageViewBlock.contentDuplication.learnMoreButton.label",description:"Label for the button that will take the user to the help center documentation explaining workspace content duplication."}))}renderLinkToTargetSpaceButton(e){return a()(oo.Z,{style:{marginLeft:12},onClick:()=>{j.navigate({environment:this.environment,url:(0,I.BD)({spaceValue:{id:e},baseUrl:J.Z.domainBaseUrl}),openInNew:"tab"})}},void 0,a()(R.FormattedMessage,{defaultMessage:"Visit new workspace",id:"pageViewBlock.contentDuplication.linkToTargetWorkspace.label",description:"Label for the button that will take the user to the workspace with the duplicated contents."}))}renderSpaceContentDuplicationBanner(e){const t=a()(R.FormattedMessage,{defaultMessage:"This workspace is in a read-only state while the contents are being duplicated.",id:"pageViewBlock.contentDuplicationInProgress.message",description:"Message shown to the user in a banner indicating that contents cannot change because contents are currently being duplicated to another workspace."}),o=a()(R.FormattedMessage,{defaultMessage:"This workspace's contents have been duplicated. Navigate to the new workspace for edits.",id:"pageViewBlock.contentDuplicationCompleted.message",description:"Message shown to the user in a banner indicating that contents cannot change because all contents have been duplicated to another workspace."});return"started"===e.status?a()(c.Fragment,{},void 0,a()("div",{},void 0,t),this.renderSpaceContentDuplicationHelpCenterButton()):"completed"===e.status?a()(c.Fragment,{},void 0,a()("div",{},void 0,o),this.renderSpaceContentDuplicationHelpCenterButton(),this.renderLinkToTargetSpaceButton(e.target_space_id)):void(0,B.t1)(e)}renderBacklinks(){if(this.shouldShowBacklinks())return this.renderBacklinksContent({disableHeader:!1})}renderBacklinksContent(e){if(0!==this.numberOfBacklinks.state)return a()("div",{style:{width:"100%",maxWidth:"100%",margin:"0 auto 6px auto"},onMouseDown:this.handleDiscussionWrapMouseDown,onClick:this.handleDiscussionWrapClick},"page-backlinks",c.createElement(tt.Z,n()({},e,{type:"page",store:this.props.store,onHide:this.handleHideBacklinks,headerText:a()(R.FormattedMessage,{defaultMessage:"Linked to this page",id:"page.backlinks.label"}),disableCurrentPageToken:!0,disableInaccessiblePages:!0})))}setDiscussionToggleState(e){const t=this.props.store.id;"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.setToggleState({environment:this.environment,type:"discussion",id:t},e)}setBacklinksToggleState(e){const t=this.props.store.id;"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.setToggleState({environment:this.environment,type:"backlinks",id:t},e)}isCurrentBlock(){return this.props.store===Pe.default.state.mainEditorCurrentBlockStore}getBlockPropertyOverlayStore(){return this.isPeekContext()?Ye.Z:Oe.Z}isEmptyContentBlock(){const{store:e}=this.props;return!e.hasContent()&&(!e.isCollectionView()||e.isType("collection_view_page")&&e.isCollectionViewPageWithContent())}isFullWidth(){const{store:e,context:t}=this.props;if(t===je.S.CollectionPageView)return!0;const{device:o}=this.environment,{isPhone:i}=o,n=e.isFullWidth(),r=e.isCollectionView(),a=this.isPeekContext();return n&&!i||r||a||i}getAdjustedPageWidth(){return this.isFullWidth()?"100%":ee.CC}getNumberOfComments(){const{store:e}=this.props;return ve.Xp(e,{recursivelyLoadAllDiscussions:!1})}hasDiscussionToShow(){return this.getNumberOfComments()>0}shouldShowDiscussion(){if(this.stores.pageViewBlockStore.state.forceDiscussionOpen)return!0;const e=re.dy(this.environment,"comments"),t=re.A$("comments","section_collapsed");if(this.props.store.isInsideCollection()&&!this.hasDiscussionToShow()&&(e||t))return!0;if(!this.hasDiscussionToShow())return!1;const o=this.discussionToggleStore.state;return void 0===o?e:o}shouldShowBacklinks(){const e=re.dy(this.environment,"backlinks"),t=this.backlinksToggleStore.state;return void 0===t?e:t}descriptionHasText(){return U(this.getDescriptionStore())}shouldShowDescription(){const e=this.stores.pageDescriptionStore.isExpanded();return(this.descriptionHasText()||this.isEditable())&&e}getDescriptionStore(){const{store:e}=this.props;return e.getCollectionViewSourceDescriptionStore()}shouldShowProperties(){return Boolean(this.getPageCollectionStore())}getPageCollectionStore(){const e=this.props.store.getAssociatedCollectionStore();if(e)return e;const{publicPageData:t}=Ie.Z.state;if(t&&(null==t?void 0:t.pageId)===this.props.store.id&&t.collectionId){const e=$e.N.createChildStore(this.props.store,{table:T.v,id:t.collectionId});if(null!=e&&e.isPageTreeCollection())return e}}getBannerStore(){return this.isPeekContext()?Ke.Z:De.Z}getSchema(){const e=this.getPageCollectionStore();return e?e.getSchema():f.Kc(de.default.getIntl())}getFormat(){const e=this.getPageCollectionStore();if(!e)return;const t=this.getSchema(),o=e.getFormat();return w.iB(o,t,void 0,w.j5.Collection)}canOpenProperty(e){if(!this.getPageCollectionStore())return!1;const t=this.getSchema()[e];return Boolean(t&&!f.uk.includes(t.type))}shouldShowSpinner(){const{store:e}=this.props;return Boolean(et.Z.state.pageMap[e.id])||We.Z.state.pages.has(e.id)}isEditable(){return this.canEditCollection()&&!this.props.store.isLocked()&&!this.isExternallySyncedPage()}getCurrentCollectionViewId(){if(this.isCurrentBlock()){const{RouterStore:e}=this.environment;return e.state.route.collectionViewId}}shouldSelectTitleOnMount(){const{device:e}=this.environment,{store:t}=this.props,o=this.titleStore.state,{forceSelectTitleOnMount:i}=this.props;return!!o&&(!!i||!t.isCollectionView()&&(!(e.isMobile&&!(0,ye.NW)(this.environment)&&!(0,me.Y)("supportsUntitledPageAutoSelectOnStart"))&&(!x.Q(o.getValue())||this.isEmptyContentBlock()&&!e.isMobile)))}markTransitionReadyIfNewPageRender(){const{device:e,RouterStore:t}=this.environment,{route:o}=t.state,i=this.props.store;var n;e.isMobileNative&&"page"===o.name&&o.showMoveTo&&i.isEmptyTitle()&&i.isEmptyPage()&&(null===(n=this.environment.mobileNative)||void 0===n||n.markTransitionReady({type:"new_page",id:i.id}))}maybeSelectFirstBlockForAiOnboarding(){if("space_for_ai"!==(0,q.B1)())return;const e=this.props.store.getContentStores()[0],t=q.__.state;e&&e.id===t&&(K.eP({environment:this.environment,store:e}),Y.NX({store:e.getBlockTitleStore()}))}isMiniPeekContext(){return this.props.context===je.S.MiniPeekView}isPeekContext(){return this.props.context===je.S.PeekView||this.props.context===je.S.MiniPeekView}isFrameOrPeekContext(){return this.props.context===je.S.Frame||this.isPeekContext()}isInSidePeek(){return ie.en(this.props.store)&&(Ge.default.isSidePeekOpen()||Ge.default.isSidePeekClosing.state)}getPageCoverStyle(){const e=this.getHeaderStyle();return e.zIndex=E.ag,e}getHeaderStyle(){const{store:e}=this.props,t={width:"100%",display:"flex",flexDirection:"column",alignItems:"center",flexShrink:0,flexGrow:0};return e.isCollectionView()&&(e.isLocked()&&(t.cursor="default"),Se.eA(this.environment)&&(t.position="sticky",t.left=0)),t}static defaultPageCoverHeight(e){return e.device.isMobile?200:`${Vn.defaultDesktopPageCoverViewportPercentage}vh`}static paddingBottom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{device:o}=e;return o.isTablet?380:o.isIOS?Math.max(350,t):o.isMobile?400:"30vh"}getTitlePaddingMarginTop(){return this.environment.device.isMobile?16:this.isPeekContext()?32:80}getTitlePaddingMarginBottom(){return this.environment.device.isMobile?32:4}getTitlePaddingHeightWithPaddingTop(){return Vn.titlePaddingHeight+this.getTitlePaddingMarginTop()}getHeaderControlsStyle(){const{store:e}=this.props,{device:t}=this.environment,{isMobile:o}=t,i=this.getTitlePaddingMarginTop();let n,r,a;return o?this.hasCoverStore.state?(this.hasIconStore.state,a="block",n=i,r=4):(a="flex",n=i,r=this.getTitlePaddingMarginBottom()):e.isCollectionView()||this.isInSidePeek()?(a="flex",this.hasCoverStore.state?(n=16,r=4):(n=4,r=4)):(a="flex",this.hasIconStore.state?(n=8,r=4):this.hasCoverStore.state?(n=16,r=4):(n=i,r=this.getTitlePaddingMarginBottom())),{display:a,justifyContent:"flex-start",flexWrap:"wrap",marginTop:n,marginBottom:r,marginLeft:-1,color:this.theme.lightTextColor,fontFamily:Z.Z.getCompositeFontFamily(p.SP).sans,height:this.environment.device.isMobile?"auto":24,pointerEvents:"auto"}}getDetailControlsSectionStyle(){return{display:"flex",alignItems:"baseline",justifyContent:"flex-start",flexWrap:"wrap",color:this.theme.lightTextColor,fontFamily:Z.Z.getCompositeFontFamily(p.SP).sans}}getControlHoverIsVisible(e){const{device:t}=this.environment,o=this.stores.headerMouseStore.state.mouseEntered,i=this.stores.detailsMouseStore.state.mouseEntered,n=this.stores.headerFocusStore.state,r=this.stores.detailsFocusStore.state;return!!t.isMobile||(e?i&&!Le.Z.state.isKeyboardMode||r:o&&!Le.Z.state.isKeyboardMode||n)}getControlHoverStyle(e){const{device:t}=this.environment,o=this.getControlHoverIsVisible(e);return{opacity:o?1:0,pointerEvents:o?"auto":"none",transition:"opacity 100ms ease",marginBottom:t.isMobile?0:-16}}getDetailControlButtonStyle(){return{fontWeight:Z.Z.fontWeight.medium,color:this.theme.mediumTextColor}}getTitleStyle(){const{device:e}=this.environment,{store:t,paddingLeft:o,paddingRight:i}=this.props,n=t.getFormat(),r=!!n.page_small_text,a=t.isCollectionView(),s=r||e.isMobile||a||this.isInSidePeek(),l=this.props.titleFontSize??(s?32:40),c=(0,we.$3)(this.environment)+(0,we.vJ)(this.environment)-o-i;return{color:this.theme.regularTextColor,fontWeight:Z.Z.fontWeight.bold,lineHeight:1.2,fontSize:l,fontFamily:Z.Z.getHeaderFontFamily({pageFont:n.page_font,locale:p.SP}),cursor:"text",display:"flex",alignItems:"center",textRendering:e.isSafari?"optimizeSpeed":void 0,width:t.isCollectionView()&&!this.props.store.getAppContainerBlockStore()?c:void 0}}getActionIconButtonStyle(){return{...this.getControlHoverStyle(),display:"flex",alignItems:"center",fontSize:14,height:28,width:28,padding:6,color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor,fontWeight:Z.Z.fontWeight.regular,lineHeight:1,borderRadius:3}}getLayoutContentStyles(){const{device:e}=this.environment,{context:t,paddingLeft:o,paddingRight:i,paddingBottom:n}=this.props,{store:r}=this.props,a=r.getFormat(),s=a.page_font||Vn.defaultFontFamily,l=Vn.fontFamily[s],c=this.isPeekContext(),d=this.isEmptyContentBlock()&&c&&!this.showTemplatePickerStore.state&&!this.shouldShowSpinner(),p=t===je.S.FrontPageTemplatePreview||t===je.S.InAppTemplatePreview;let u,g,h;if(e.isMobile)h=e.isAndroid?Vn.defaultAndroidFontSize:Vn.defaultMobileFontSize;else{h=a.page_small_text?Vn.fontSmallSize[s]||Vn.defaultFontSmallSize:Vn.fontSize[s]||Vn.defaultFontSize}let f={},v={},y={};if(!d){const{WindowSizeStore:e}=this.environment,t=e.getSafePaddingLeftCSS(o),r=e.getSafePaddingRightCSS(i);f={gridTemplateColumns:`${t} calc(100% - ${t} - ${r}) ${r}`},u={},g={},v={paddingBottom:this.isCompletionsUiVisible.state?"600px":this.isEmptyContentBlock()?"15vh":n},y={...v,paddingLeft:t,paddingRight:r}}const b=Vn.fontLetterSpacing[s],S=Vn.fontLineHeight[s]||1.5;let w={};c&&(w={minHeight:Vn.peekViewContentMinHeight,zIndex:1});let k={};p&&(k={margin:"0 auto"});let C={};if(e.isPhone&&!r.isCollectionView()&&this.canEdit()&&!this.hasCoverStore.state){const e=132,t=this.getTitlePaddingHeightWithPaddingTop();C={minHeight:`calc(100vh - ${m.g+e-t}px)`}}return{wrapper:{flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...f},leftPadding:u,body:{display:"flex",alignItems:"flex-start",flexDirection:"column",fontFamily:l,fontSize:h,letterSpacing:b?`${b}em`:void 0,lineHeight:S,zIndex:E.ke,...v,...w,...k,...C},rightPadding:g,nonIOSLayoutBody:{flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flex-start",flexDirection:"column",fontFamily:l,fontSize:h,letterSpacing:b?`${b}em`:void 0,lineHeight:S,width:"100%",zIndex:E.ke,...y,...w,...k,...C}}}}Vn.wrapStyle={width:"100%",display:"flex",flexDirection:"column",position:"relative",alignItems:"center",flexGrow:1},Vn.defaultDesktopPageCoverViewportPercentage=30,Vn.defaultFontFamily=Z.Z.getCompositeFontFamily(p.SP).sans,Vn.defaultFontSize=16,Vn.defaultMobileFontSize=16,Vn.defaultAndroidFontSize=17,Vn.defaultFontSmallSize=14,Vn.titlePaddingHeight=28,Vn.peekViewContentMinHeight=240,Vn.fontFamily={serif:Z.Z.getCompositeFontFamily(p.SP).serif,mono:Z.Z.getCompositeFontFamily(p.SP).mono},Vn.fontSize={serif:17,mono:15},Vn.fontSmallSize={serif:15,mono:14},Vn.fontLetterSpacing={serif:0,mono:.055},Vn.fontLineHeight={serif:1.6,mono:1.6};const Nn=Vn,On=(0,R.defineMessages)({viewTemplate:{defaultMessage:"<mediumtext>You're viewing a template in</mediumtext> {pageTitleWithIcon}`",id:"pageViewBlock.templatePageBanner.viewTemplateLabel",description:"Template banner description for viewing in desktop UI"},editTemplate:{defaultMessage:"<mediumtext>You're editing a template in</mediumtext> {pageTitleWithIcon}",id:"pageViewBlock.templatePageBanner.editTemplateLabel",description:"Template banner description for editing in desktop UI"},editTemplateMobile:{defaultMessage:"<mediumtext>Template in</mediumtext> {pageTitleWithIcon}",id:"pageViewBlock.templatePageBanner.mobile.editTemplateLabel",description:"Template banner description for mobile UI"}})},1548:(e,t,o)=>{o.d(t,{Z:()=>B});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(8848),l=o(96068),c=o(5366),d=o(50906),p=o(54642),u=o(47307),m=o(43250),g=o(33954),h=o(71119),f=o(79315),v=o(69503),y=o(12318),b=o(42922),S=o(36488),w=o(74194),k=o(22346),C=o(63296),_=o(77137),M=o(62385),T=o(64369),I=o(23189),P=o(13490);class x extends a.Z{constructor(){super(...arguments),this.storeTypes={hasPasswordStore:y.default.of(!1),hasPasswordActions:y.default.of(!1),emailStore:y.default.of("")},this.handleChangePasswordClick=()=>{d.trackChangePasswordClick(this.environment),v.Z.setState({open:!0,setNewPassword:!0,password:"",repeatPassword:"",isSet:!1})},this.handleOldPasswordChange=e=>{(v.Z.isSetNewPasswordModal()||v.Z.isRemovePasswordModal())&&v.Z.setState({...v.Z.state,oldPassword:e.target.value,alert:void 0})},this.handleClearOldPassword=()=>{(v.Z.isSetNewPasswordModal()||v.Z.isRemovePasswordModal())&&v.Z.setState({...v.Z.state,oldPassword:"",alert:void 0})},this.handlePasswordChange=e=>{v.Z.isSetNewPasswordModal()&&v.Z.setState({...v.Z.state,password:e.target.value,alert:void 0})},this.handleCancelChangePassword=()=>{const{onCancel:e}=v.Z.state;v.Z.reset(),e&&e()},this.handleClearPassword=()=>{v.Z.isSetNewPasswordModal()&&v.Z.setState({...v.Z.state,password:"",repeatPassword:"",alert:void 0})},this.handleRepeatPasswordChange=e=>{v.Z.isSetNewPasswordModal()&&v.Z.setState({...v.Z.state,repeatPassword:e.target.value,alert:void 0})},this.handleClearRepeatPassword=()=>{v.Z.isSetNewPasswordModal()&&v.Z.setState({...v.Z.state,repeatPassword:"",alert:void 0})},this.handlePasswordBlur=()=>{if(v.Z.isSetNewPasswordModal()){const{password:e,repeatPassword:t}=v.Z.state;e&&t&&e!==t&&v.Z.setState({...v.Z.state,alert:this.props.intl.formatMessage({id:"passwordSettings.changePasswordModal.newPasswordMismatchError",defaultMessage:"Your new password does not match."})})}},this.handleSubmit=async()=>{if(!v.Z.isSetNewPasswordModal())return;const{oldPassword:e,password:t,repeatPassword:o}=v.Z.state,i=this.stores.hasPasswordStore.get(),{intl:n}=this.props;let r;if(i&&!e)r=n.formatMessage({id:"passwordSettings.changePasswordModal.oldPasswordMissingError",defaultMessage:"Please enter your old password."});else if(t){const e=(0,l.I)(t);e.success?o?t!==o&&(r=n.formatMessage({id:"passwordSettings.changePasswordModal.newPasswordsMismatchError",defaultMessage:"Your passwords do not match."})):r=n.formatMessage({id:"passwordSettings.changePasswordModal.newPasswordNotRepeatedError",defaultMessage:"Please repeat your new password."}):r=this.getPasswordErrorMessage(e.reason)}else r=n.formatMessage({id:"passwordSettings.changePasswordModal.passwordNotEnteredError",defaultMessage:"Please enter a password."});if(r)return void v.Z.setState({...v.Z.state,alert:r});const a=await p.setPassword(this.environment,{oldPassword:e,newPassword:t});if("success"===a.type)this.props.requestStore.refresh(),void 0===e?this.saveNewPasswordSuccess():this.changePasswordSuccess();else{const e=(0,g.wf)(this.props.intl,a);v.Z.setState({...v.Z.state,alert:e})}},this.handleShowRemovePasswordModalClick=()=>{v.Z.setState({open:!0,removePassword:!0,oldPassword:"",isSuccess:!1})},this.handleRemovePasswordClick=async()=>{if(!v.Z.isRemovePasswordModal())return;const{oldPassword:e}=v.Z.state;if(d.trackRemovePasswordClick(this.environment),!e)return void v.Z.setState({...v.Z.state,alert:this.props.intl.formatMessage({id:"passwordSettings.removePasswordModal.oldPasswordNotEnteredError",defaultMessage:"Please enter your current password.",description:"We require users to enter their password in a text box before they can delete it. This error message appears if the user attempts to delete their password but hasn't entered it into the text box."})});const t=await p.setPassword(this.environment,{oldPassword:e,clearPassword:!0});if("success"===t.type)this.props.requestStore.refresh(),this.removePasswordSuccess();else{const e=(0,g.wf)(this.props.intl,t);v.Z.setState({...v.Z.state,alert:e||this.props.intl.formatMessage({id:"passwordSettings.removePasswordModal.message",defaultMessage:"Error removing password. Please try again later."})})}},this.defaultErrorMessage=this.props.intl.formatMessage({id:"passwordSettings.genericPasswordSaveError",defaultMessage:"Error saving password. Please try again later."})}willMount(e){super.willMount(e);const{currentUserStore:t}=f.default.state;null!=t&&t.isDefined()&&this.stores.emailStore.set(t.getEmail())}renderComponent(){const e=this.stores.emailStore.get();if(!e)return;const{requestStore:t}=this.props;return n()("div",{style:this.getLegacySettingsOptionStyle()},void 0,n()(I.Z,{smallMarginBottom:!0},void 0,n()(c.FormattedMessage,{id:"passwordSettings.title",defaultMessage:"Password"})),n()(_.Z,{request:{},requestStore:t,performRequest:async()=>{const t=await p.getLoginOptions(this.environment,{email:e});if("success"===t.type){const e=t.data;return{samlEnforced:"required"===e.samlSignIn,hasPassword:"required"!==e.samlSignIn&&e.hasAccount&&e.passwordSignIn}}throw t.error},render:(e,t)=>{if(e)return x.renderLegacyLabel(n()(c.FormattedMessage,{id:"passwordSettings.passwordSetError.message",defaultMessage:"Your password cannot be set at this time. Please try again later."}));if(t){const{samlEnforced:e,hasPassword:o}=t;return e?x.renderLegacyLabel(n()(c.FormattedMessage,{id:"passwordSettings.passwordManagedThroughSAMLProvider.message",defaultMessage:"Your password is managed through your SAML Single Sign-on Provider.",description:"Message letting users know that their password is managed through a 3rd-party provider, which is why they can't set their password on Notion's password settings page."})):(this.stores.hasPasswordStore.set(Boolean(o)),this.renderLegacyPasswordActions())}}}))}renderLegacyPasswordActions(){const{isEducationPlan:e}=this.props,t=this.stores.hasPasswordStore.get();return n()(r.Fragment,{},void 0,x.renderLegacyLabel(n()(c.FormattedMessage,{id:"passwordSettings.passwordSetInstructions",defaultMessage:"You can set a permanent password if you don't want to use temporary login codes."})),e&&x.renderLegacyLabel(this.renderEducationPlanInfo()),n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()(C.Z,{isLarge:!0,onClick:this.handleChangePasswordClick,style:{marginTop:12,marginBottom:4}},void 0,n()(c.FormattedMessage,t?{id:"passwordSettings.changePasswordButton.label",defaultMessage:"Change password"}:{id:"passwordSettings.setPasswordButton.label",defaultMessage:"Set a password"})),this.canRemovePassword()&&n()(M.Z,{onClick:this.handleShowRemovePasswordModalClick,style:{marginLeft:5,marginTop:12,marginBottom:4}},void 0,n()(c.FormattedMessage,{id:"passwordSettings.removePasswordButton.label",defaultMessage:"Remove password"}))),this.renderPasswordModal())}static renderLegacyLabel(e){return n()(T.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},void 0,e)}renderPasswordModal(){const{device:e}=this.environment,{open:t}=v.Z.state;return n()(k.Z,{open:t,onDismiss:this.handleCancelChangePassword,innerStyle:{width:e.isPhone?"90%":460,padding:24},className:m.BKn,preventHideChildrenWhileOpening:!0,render:()=>n()(S.Z,{capture:!0,allowEsc:!0,render:()=>n()(r.Fragment,{},void 0,this.renderPasswordEdit(),this.renderRemovePassword())})})}renderPasswordEdit(){const{isEducationPlan:e}=this.props;if(!v.Z.isSetNewPasswordModal())return;const{password:t,repeatPassword:o,oldPassword:i,alert:a}=v.Z.state,s=this.stores.hasPasswordStore.get(),l=this.stores.emailStore.get();return n()(r.Fragment,{},void 0,n()(w.Z,{style:{display:"none"},type:"text",value:l,autoComplete:"username",disabled:!0}),s&&n()(r.Fragment,{},void 0,n()(P.Z,{},void 0,n()(c.FormattedMessage,{id:"passwordSettings.changePasswordModal.oldPasswordInput.label",defaultMessage:"Old Password"})),n()(w.Z,{type:"password",value:i,onChange:this.handleOldPasswordChange,showClearButton:!0,onClearButtonClick:this.handleClearOldPassword,placeholder:this.props.intl.formatMessage({id:"passwordSettings.oldPasswordInput.placeholder",defaultMessage:"Enter old password..."}),style:{padding:"4px 8px"},focusInitial:!0,autoComplete:"current-password"})),s?n()(P.Z,{hasMarginTop:!0},void 0,n()(c.FormattedMessage,{id:"passwordSettings.newPasswordInput.label",defaultMessage:"New password"})):n()(P.Z,{},void 0,n()(c.FormattedMessage,{id:"passwordSettings.passwordInput.label",defaultMessage:"Password"})),n()(w.Z,{type:"password",value:t,onChange:this.handlePasswordChange,onSubmit:this.handleSubmit,showClearButton:!0,onClearButtonClick:this.handleClearPassword,placeholder:this.props.intl.formatMessage({id:"passwordSettings.newPasswordInput.placeholder",defaultMessage:"Enter new password..."}),style:{padding:"4px 8px"},focusInitial:!s,onBlur:this.handlePasswordBlur,autoComplete:"new-password"}),n()(P.Z,{hasMarginTop:!0},void 0,n()(c.FormattedMessage,{id:"passwordSettings.repeatPasswordInput.label",defaultMessage:"Repeat password"})),n()(w.Z,{type:"password",value:o,onChange:this.handleRepeatPasswordChange,onSubmit:this.handleSubmit,showClearButton:!0,onClearButtonClick:this.handleClearRepeatPassword,placeholder:this.props.intl.formatMessage({id:"passwordSettings.repeatPasswordInput.placeholder",defaultMessage:"Repeat new password..."}),style:{padding:"4px 8px"},onBlur:this.handlePasswordBlur,autoComplete:"new-password"}),n()(T.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginTop:14}},void 0,n()(c.FormattedMessage,{id:"passwordSettings.passwordGuidelines",defaultMessage:"Use a password at least 15 letters long, or at least 8 characters long with both letters and numbers."})),e&&n()(T.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginTop:14}},void 0,this.renderEducationPlanInfo()),this.renderAlert(a),this.renderPasswordEditButtons())}renderPasswordEditButtons(){const e=(0,h.DH)(),t=this.stores.hasPasswordStore.get();return n()("div",{style:this.getPasswordEditButtonsStyle()},void 0,e&&t&&n()(C.Z,{isRed:!0,onClick:this.handleShowRemovePasswordModalClick},void 0,n()(c.FormattedMessage,{id:"passwordSettings.removePasswordButton.label",defaultMessage:"Remove password"})),(()=>n()(b.Z,{isLarge:!0,onClick:this.handleSubmit},void 0,n()(c.FormattedMessage,t?{id:"passwordSettings.changePasswordButton.label",defaultMessage:"Change password"}:{id:"passwordSettings.setPasswordButton.label",defaultMessage:"Set a password"})))())}renderRemovePassword(){const{isEducationPlan:e}=this.props;if(!v.Z.isRemovePasswordModal())return;const{oldPassword:t,alert:o}=v.Z.state;return n()(r.Fragment,{},void 0,n()("div",{style:{fontSize:14,width:"100%"}},void 0,n()(c.FormattedMessage,{id:"passwordSettings.removePasswordModal.text",defaultMessage:"You're about to remove your password. We'll email you temporary login codes to access Notion going forward.",description:"Message warning the user that they're about to delete their password, and telling them how to log in after their password has been deleted."}),e&&n()(c.FormattedMessage,{id:"passwordSettings.removePasswordModal.educationPlanWarning",defaultMessage:"If you lose access to your school email, you'll be unable to log back into Notion.",description:"Warning for users on the Education Plan that if they lose access to their school email, they won't be able to log into Notion without a password."})),n()(P.Z,{hasMarginTop:!0},void 0,n()(c.FormattedMessage,{id:"passwordSettings.deletePasswordModal.passwordInput.label",defaultMessage:"Password"})),n()(w.Z,{type:"password",value:t,onChange:this.handleOldPasswordChange,onSubmit:this.handleRemovePasswordClick,showClearButton:!0,onClearButtonClick:this.handleClearOldPassword,placeholder:this.props.intl.formatMessage({id:"passwordSettings.removePasswordModal.passwordInput.placeholder",defaultMessage:"Enter your password..."}),style:{padding:"4px 8px"},focusInitial:!0,autoComplete:"current-password"}),this.renderAlert(o),n()(b.Z,{isLarge:!0,style:{marginTop:14},onClick:this.handleRemovePasswordClick},void 0,n()(c.FormattedMessage,{id:"passwordSettings.removePasswordModal.removePasswordButton.label",defaultMessage:"Remove password"})))}renderAlert(e){if(e)return n()(T.Z,{isMultiline:!0,style:{marginTop:8,color:s.ZP.red}},void 0,e)}renderEducationPlanInfo(){return n()(c.FormattedMessage,{id:"passwordSettings.educationPlanGuidelines",defaultMessage:"If you lose access to your school email address, you'll be able to log in using your password."})}getLegacySettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}getPasswordEditButtonsStyle(){return{display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:14}}saveNewPasswordSuccess(){const{intl:e,isEducationPlan:t}=this.props,{onSubmit:o}=v.Z.state;v.Z.reset();const i=t?e.formatMessage({id:"passwordSettings.setPasswordSuccess.educationMessage",defaultMessage:"Your password is all set! You'll be able to log in, even if you lose access to your school email address."}):e.formatMessage({id:"passwordSettings.setPasswordSuccess.message",defaultMessage:"Your password is all set!"});u.showMessage({message:i,onAccept:o})}changePasswordSuccess(){const{onSubmit:e}=v.Z.state;v.Z.reset(),u.showMessage({message:this.props.intl.formatMessage({id:"passwordSettings.changePasswordSuccess.message",defaultMessage:"Your new password has been saved."}),onAccept:e})}removePasswordSuccess(){v.Z.reset(),u.showMessage({message:this.props.intl.formatMessage({id:"passwordSettings.removePasswordSuccess.message",defaultMessage:"Your password has been removed."})})}getPasswordErrorMessage(e){const t=g.Ql[e.type];return t?this.props.intl.formatMessage(t):this.defaultErrorMessage}canRemovePassword(){const{isEducationPlan:e}=this.props,t=this.stores.hasPasswordStore.get();return!e&&t}}x.displayName="PasswordSettings";const B=(0,c.injectIntl)(x)},76844:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r);o(67294);const s=function(e){return window.__c={n:"PercentageBox"},e=a().assign({percent:.1},e),n()("div",{style:a().assign({position:"relative",minWidth:30,height:5,borderRadius:1,overflow:"hidden"},e.style)},void 0,n()("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",background:"currentColor",opacity:.1}}),n()("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:100*e.percent+"%",minWidth:2,background:"currentColor",opacity:.6}}))}},33241:(e,t,o)=>{o.d(t,{d:()=>f,M:()=>v});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(24405),c=o(8848),d=o(3779),p=o(26825),u=o(90468),m=o(97880),g=o(5366),h=o(89728);function f(e){let{role:t,events:o,disabled:i,buttonStyle:r,buttonContents:c,icon:p,table:u,isRemovable:m,isCurrentUser:f}=e;window.__c={n:"PermissionRoleButton"};const y=(0,l.Fg)(),b=p||!i&&d.Z.chevronDown;return s.createElement(h.Z,n()({},o,{disabled:i,style:{marginRight:8,...r}}),c||a()("span",{className:"notranslate"},void 0,s.createElement(g.FormattedMessage,v(t,u,m,f).label)),b&&b({width:10,marginLeft:4,fill:y.lightIconColor}))}function v(e,t,o,i){if("access"===e)return{label:p.mq.canAccessLabel};if("limited"===e)return{label:p.mq.limitedAccessLabel};if((0,p.oF)(e))return(0,p.Gx)(e,t);switch(e){case"editor":return t===u.bx?{label:p.mq.workspaceOwnerLabel,caption:p.mq.workspaceOwnerCaption}:{label:p.mq.fullAccessLabel,caption:p.mq.fullAccessCaption};case"membership_admin":return t===u.bx?{label:p.mq.membershipAdminLabel,caption:p.mq.membershipAdminCaption}:{label:p.mq.canEditLabel,caption:p.mq.canEditCaption};case"read_and_write":return t===u.bx?{label:p.mq.memberLabel,caption:p.mq.memberCaption}:{label:p.mq.canEditLabel,caption:p.mq.canEditCaption};case"content_only_editor":return{label:p.mq.canEditContentLabel,caption:p.mq.canEditContentCaption};case"reader":return{label:p.mq.canReadLabel,caption:p.mq.canReadCaption};case"comment_only":return{label:p.mq.canCommentLabel,caption:p.mq.canCommentCaption};case"none":return o?t===u.bx?i?{label:p.mq.leaveWorkspaceLabel,style:{color:c.ZP.red}}:{label:p.mq.removeFromWorkspaceLabel,style:{color:c.ZP.red}}:{label:p.mq.removeWorkspaceLabel,style:{color:c.ZP.red}}:{label:p.mq.noAccessLabel,style:{color:c.ZP.red}};default:(0,m.t1)(e)}}},7567:(e,t,o)=>{o.d(t,{Z:()=>K});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(41892),d=o(3779),p=o(26825),u=o(27006),m=o(90468),g=o(47425),h=o(97880),f=o(5366),v=o(47307),y=o(93678),b=o(95477),S=o(43250),w=o(33929),k=o(60709),C=o(98742),_=o(67669),M=o(33665),T=o(21115),I=o(8323),P=o(61766),x=o(31194),B=o(52275),Z=o(31945),E=o(78140),R=o(28992),A=o(9342),D=o(74136),F=o(72495),L=o(58032),V=o(64369),N=o(84015),O=o(42402),U=o(33241),H=o(60442),z=o(42115);const W=(0,f.defineMessages)({fullAccessTeamGuestsDisabledMessage:{id:"permissionRoleSelect.teamGuestPermissionItem.disabledPermissionitem.tooltip",defaultMessage:"Teamspace guests can't have full access.",description:"Tooltip explaining why team guests cannot have full access."}});class j extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:P.Z},this.renderPermissionOverrideLabel=()=>{const{device:e}=this.environment;return a()(V.Z,{style:{padding:12,backgroundColor:this.theme.sidebarSecondaryBackground,boxShadow:`0 -1px 0 ${this.theme.regularDividerColor}`,marginTop:e.isMobile?28:1},isMultiline:!0,isSmall:!0},void 0,a()(f.FormattedMessage,{id:"permissionRoleSelect.overrideMessage.caption",defaultMessage:"You’ll override permissions from the parent page if you change this role."}))},this.isRemovingSelfRole=e=>this.props.isUserPermission&&(0,p.nl)(this.props.role,e)===this.props.role&&"none"===e,this.isDowngradingSelfRole=e=>this.props.isUserPermission&&(0,p.nl)(this.props.role,e)===this.props.role}renderComponent(){const{device:e}=this.environment,t=!!this.props.isUserPermission;return a()(Z.Z,{onClick:e=>{e.stopPropagation()},popupType:e.isMobile?Z.Z.PopupType.SlideUp:Z.Z.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>this.props.origin?this.props.origin:this.props.isMenuItem?s.createElement(B.Z,n()({},e,{title:s.createElement(f.FormattedMessage,(0,U.M)(this.props.role,this.props.table,this.isRemovable(),t).label),focused:!1,showExtensionArrow:!0})):a()(U.d,{role:this.props.role,events:e,disabled:this.props.disabled,buttonContents:this.props.buttonContents,buttonStyle:this.props.buttonStyle,table:this.props.table,isRemovable:this.isRemovable(),isCurrentUser:t}),placementToOrigin:this.props.placementToOrigin?this.props.placementToOrigin:x.Iw.Bottom,alignmentToOrigin:this.props.alignmentToOrigin,render:t=>{const o=this.props.role;let i,r;if((0,p.oF)(o))i=[{key:"mixed_role_section",render:e=>s.createElement(F.Z,n()({},e,{topBorder:!1})),items:[{key:"mixed_role_description",render:()=>a()(N._,{role:o}),action:()=>{}}]},{key:"bot_capabilities_warning",render:e=>s.createElement(F.Z,n()({},e,{topBorder:!0})),items:[{key:"warning_details",render:e=>s.createElement(R.Z,n()({},e,{shouldWrapCaption:!0,caption:"Integration permissions cannot be changed on a page. You can manage integrations in settings."})),action:()=>{}}]},{key:"remove_bot",render:e=>s.createElement(F.Z,n()({},e,{topBorder:!0})),items:[{key:"none",render:e=>this.getItem({role:"none"},e.focused,e),action:()=>{this.handleSelect("none"),t.close()}}]}];else{i=[{key:"roles",render:e=>s.createElement(F.Z,n()({},e,{topBorder:0!==e.index})),items:this.getAvailableRoles().map((e=>({key:e.role,render:t=>this.getItem(e,t.focused,t),action:()=>{this.handleSelect(e.role),t.close()}})))}]}return r=e.isMobile?{menuType:k.og.Modal,title:a()(f.FormattedMessage,{id:"userPermissionsMenu.mobile.title",defaultMessage:"Select role"}),right:a()(f.FormattedMessage,{id:"userPermissionsMenu.mobile.doneButton.label",defaultMessage:"Done"}),onClickRight:t.close}:{menuType:k.og.Popup,width:264},s.createElement(E.Z,n()({className:S.a6i,header:this.props.header,footer:this.props.footer},r),a()(A.Z,{type:A.i.Vertical,initialFocus:void 0,sections:i}),this.props.showPermissionOverrideWarning&&this.renderPermissionOverrideLabel())}})}getItem(e,t,o){const i=!!this.props.isUserPermission;return this.renderItem({...(0,U.M)(e.role,this.props.table,this.isRemovable(),i),focused:t,props:o,disabledMessage:this.getItemDisabledReason(e.role),availableRole:e})}renderItem(e){const{device:t}=this.environment,{onClick:o,key:i,...r}=e.props,l=e.availableRole.disabledInfo;return l&&l.isDisabled?a()(L.Z,{delayThreshold:0,renderTooltip:e=>s.createElement("div",e,l.disabledMessage),placement:L.Z.Placement.Right,textWrap:!0,render:o=>s.createElement(B.Z,n()({},o,{focused:e.focused,disabled:!0,disabledFeedback:!0,right:this.props.role===e.availableRole.role?a()("div",{style:{width:t.isMobile?16:14}},void 0,d.Z.check()):void 0,title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()("div",{style:{...e.style,marginRight:e.disabledMessage?6:0}},void 0,s.createElement(f.FormattedMessage,e.label))),caption:e.caption&&a()("span",{style:{color:this.theme.mediumTextColor}},void 0,s.createElement(f.FormattedMessage,e.caption)),shouldWrapCaption:!0}))}):a()(z.Z,{requireUpgradeToTier:Boolean(e.disabledMessage)&&T.M9(this.environment),analyticsName:this.props.upgradeButtonName,renderUpgradeTooltip:()=>e.disabledMessage,tooltipPlacement:L.Z.Placement.Left,onClick:o,onUpgradeClick:this.props.onUpgradeButtonClick,render:(o,i)=>{const{focused:l,...c}=(0,C.Z)(r,o);return s.createElement(B.Z,n()({},c,{focused:l||e.focused,right:this.props.role===e.availableRole.role?a()("div",{style:{width:t.isMobile?16:14}},void 0,d.Z.check()):void 0,title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()("div",{style:{...e.style,marginRight:e.disabledMessage?6:0}},void 0,s.createElement(f.FormattedMessage,e.label)),i,e.availableRole.tag&&a()(D.Z,{desktopStyle:{marginLeft:7}},void 0,e.availableRole.tag)),caption:e.caption&&a()("span",{style:{color:this.theme.mediumTextColor}},void 0,s.createElement(f.FormattedMessage,e.caption)),shouldWrapCaption:!0,disabled:!!t.isMobile&&Boolean(e.disabledMessage)}))}},i)}getItemDisabledReason(e){const t=(0,I.zt)();if((0,g.QM)(t)){if((this.props.table===m.bx?u.RN(e):u.J5(e)&&!u.zz(e))&&"public_permission"!==this.props.type&&"bot_permission"!==this.props.type)return this.props.table===m.bx?a()(H.Z,{imageURL:c.Z.images.tooltips.upsells.spaceReadAndWritePng,imageWidth:240,imageHeight:100,caption:a()(f.FormattedMessage,{defaultMessage:"Members cannot change workspace settings or invite new members.",id:"permissionRoleSelect.spaceReadAndWriteUpgradeTooltip.caption"}),title:a()(f.FormattedMessage,{defaultMessage:"Upgrade to add non-admin members",id:"permissionRoleSelect.spaceReadAndWriteUpgradeTooltip.title"})}):a()(H.Z,{imageURL:c.Z.images.tooltips.upsells.userReadAndWritePng,imageWidth:240,imageHeight:100,caption:a()(f.FormattedMessage,{defaultMessage:"Users with edit access can edit a page but not share it with others.",id:"permissionRoleSelect.userReadAndWriteUpgradeTooltip.caption"}),title:a()(f.FormattedMessage,{defaultMessage:"Upgrade to add editors",id:"permissionRoleSelect.userReadAndWriteUpgradeTooltip.title"})})}return!1}getRemoveUserMessage(){const{table:e}=this.props;return e===m.bx&&(0,I.wP)()?a()(f.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeUserFromWorkspace.enterprise.confirmationMessage",defaultMessage:"If you remove this member, they will lose workspace access. After their removal, you may transfer their private pages to another member. <transferpagelink>Learn more</transferpagelink>.",description:"Description for removing a user from a workspace when the workspace is an enterprise plan and has access to page transfer",values:{transferpagelink:e=>a()(O.Z,{href:(0,M.UY)("guides.transferContent"),external:!0},void 0,e)}}):e===m.bx?a()(f.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeUserFromWorkspace.confirmationMessage",defaultMessage:"Are you sure you want to remove this person? They will lose access to the workspace, and any private pages will be lost."}):a()(f.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeUserFromPage.confirmationMessage",defaultMessage:"Are you sure you want to remove this person?"})}getAvailableRoles(){const{type:e,table:t,isInvite:o,role:i,availableRoleItems:n,blockType:r}=this.props;if(n&&n.length>0)return n;const a=[];return"explicit_team_guest_permission"===e?a.push({role:"editor",disabledInfo:{isDisabled:!0,disabledMessage:w.default.formatMessage(W.fullAccessTeamGuestsDisabledMessage)}}):"bot_permission"!==e&&a.push({role:"editor"}),"space"===t&&(0,_.U7)()&&a.push({role:"membership_admin"}),a.push({role:"read_and_write"}),"collection_view"!==r&&"collection_view_page"!==r||"bot_permission"===e&&"content_only_editor"!==i||a.push({role:"content_only_editor"}),t!==m.bx&&("bot_permission"!==e&&a.push({role:"comment_only"}),"bot_permission"===e&&"reader"!==i||a.push({role:"reader"})),o||a.push({role:"none"}),a}isRemovingSpaceUser(e){return this.props.table===m.bx&&"none"===e}isRemovable(){const e=this.props.type;switch(e){case"user_permission":case"bot_permission":case"group_permission":return!0;case"space_permission":case"explicit_team_permission":case"team_permission":case"team_owner_permission":case"explicit_team_owner_permission":case"explicit_team_guest_permission":case"public_permission":return!1;default:(0,h.t1)(e)}}handleSelect(e){const{table:t,role:o}=this.props;if(o===e)return;const i=()=>{this.props.onChange&&this.props.onChange(e)};this.getItemDisabledReason(e)&&!b.Z.isAdminMode?(y.y(this.environment,{from:this.props.upgradeButtonName,for:T.M9(this.environment)||g.$M}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()):this.isRemovingSelfRole(e)?v.showDialog({showCancel:!0,keepFocus:!1,message:t===m.bx?a()(f.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeSelfFromWorkspace.confirmationMessage",defaultMessage:"Are you sure you want to remove your own access? You will lose access to the workspace, and any private pages will be lost."}):a()(f.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeSelfFromPage.confirmationMessage",defaultMessage:"Are you sure you want to remove your own access?"}),items:[{label:a()(f.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeSelfButton.label",defaultMessage:"Remove"}),color:"red",onAccept:i}]}):this.isDowngradingSelfRole(e)?v.showDialog({showCancel:!0,keepFocus:!1,message:a()(f.FormattedMessage,{id:"userPermissionsMenu.downgradePermissionsModal.downgradeSelfFromWorkspaceOrPage.confirmationMessage",defaultMessage:"Are you sure you want to downgrade your own access?",description:"Warning that shows when you try to downgrade your own space role"}),items:[{label:a()(f.FormattedMessage,{id:"userPermissionsMenu.downgradePermissionsModal.downgradeSelfButton.label",defaultMessage:"Downgrade",description:"Downgrade self button label in settings modal"}),color:"red",onAccept:i}]}):this.isRemovingSpaceUser(e)?v.showDialog({showCancel:!0,keepFocus:!1,message:this.getRemoveUserMessage(),items:[{label:a()(f.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeUserButton.label",defaultMessage:"Remove"}),color:"red",onAccept:i}]}):i()}}j.displayName="PermissionRoleSelect";const K=j},91487:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(15070),l=o(84619),c=o(3779),d=o(97880),p=o(7928),u=o(5366),m=o(16639),g=o(58032),h=o(85567);class f extends a.Z{constructor(){super(...arguments),this.handleClickRemove=e=>{e.stopPropagation(),this.props.onClickRemove(this.props.target)}}renderComponent(){const{device:e}=this.environment;return n()(h.Z,{showRemoveButton:!0,isSingle:!1,isStrikedThrough:this.props.isStrikedThrough,backgroundColor:this.props.backgroundColor,format:e.isMobile?l.l.Large:l.l.Medium,onClickRemove:this.handleClickRemove,disabled:this.props.disabled,disabledFeedback:!0,value:this.getTokenContent(),style:this.props.style,shouldWrap:this.props.shouldWrap})}withInfoIcon(e){return n()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,c.Z.info({marginRight:4,width:14,height:14}),e)}getTokenContent(){const{target:e,intl:t,role:o}=this.props;if("group"===e.type&&"owner"===o)return n()(g.Z,{renderTooltip:()=>n()(u.FormattedMessage,{id:"permissionInviteToken.groupRole.ownerAlert.tooltip",defaultMessage:"Groups cannot be added as teamspace owners."}),render:t=>r.createElement("div",t,this.withInfoIcon((0,m.kF)({intl:this.props.intl,group:e.value})))});let i;switch(e.type){case"newUser":i=e.value.email.trim();break;case"existingUser":i=(0,p.Nz)(t,e.value);break;case"bot":i=(0,s.Mh)(e.value);break;case"group":i=(0,m.kF)({intl:this.props.intl,group:e.value});break;default:(0,d.t1)(e)}return this.props.showInfoIcon?this.withInfoIcon(i):i}}f.displayName="PermissionsInviteToken";const v=(0,u.injectIntl)(f)},38294:(e,t,o)=>{o.d(t,{Jm:()=>b,ZP:()=>T});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(3779),p=o(29091),u=o(5366),m=o(52275),g=o(63296),h=o(14871),f=o(64369);const v="other",y={exec:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.exec",defaultMessage:"Executive (C-level / VP)",description:"Field to select under role"}),dept_lead:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.dept_lead",defaultMessage:"Department lead",description:"Field to select under role"}),team_manager:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.team_manager",defaultMessage:"Team manager",description:"Field to select under role"}),member:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.member",defaultMessage:"Team member",description:"Field to select under role"}),solo:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.solo",defaultMessage:"Solo-preneur / Freelancer",description:"Field to select under role"}),personal:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.personal",defaultMessage:"Using Notion just for myself",description:"Field to select under role"})},b={creative:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.creative",defaultMessage:"Creative",description:"Field to select work type"}),founderCeo:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.founderCeo",defaultMessage:"Founder / CEO",description:"Field to select work type"}),internalCommunication:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.internalCommunication",defaultMessage:"Internal Communication",description:"Field to select work type"}),eng:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.eng",defaultMessage:"Engineering",description:"Field to select work type"}),productDesign:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.productDesign",defaultMessage:"Product Design",description:"Field to select work type"}),projectProgramMgmt:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.projectProgramMgmt",defaultMessage:"Project / Program Management",description:"Field to select work type"}),product:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.question.product",defaultMessage:"Product Management",description:"Field to select work type"}),marketing:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.marketing",defaultMessage:"Marketing",description:"Field to select work type"}),sales:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.sales",defaultMessage:"Sales",description:"Field to select work type"}),support:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.support",defaultMessage:"Customer Service",description:"Field to select work type"}),finance:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.finance",defaultMessage:"Finance",description:"Field to select work type"}),hr:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.hr",defaultMessage:"Human Resources",description:"Field to select work type"}),itAdmin:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.itAdmin",defaultMessage:"IT Admin",description:"Field to select work type"}),knowledgeManagement:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.knowledgeManagement",defaultMessage:"Knowledge Management",description:"Field to select work type"}),operations:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.operations",defaultMessage:"Operations",description:"Field to select work type"}),educator:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.educator",defaultMessage:"Educator",description:"Field to select work type"}),other:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.other",defaultMessage:"Other",description:"Field to select work type"}),student:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.workQuestion.student",defaultMessage:"Student",description:"Field to select work type"})},S={creative:b.creative,support:b.support,educator:b.educator,eng:b.eng,finance:b.finance,hr:b.hr,internalCommunication:b.internalCommunication,itAdmin:b.itAdmin,knowledgeManagement:b.knowledgeManagement,marketing:b.marketing,operations:b.operations,productDesign:b.productDesign,projectProgramMgmt:b.projectProgramMgmt,product:b.product,sales:b.sales,other:b.other},w={founder_ceo:b.founderCeo,exec:y.exec,dept_lead:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.director",defaultMessage:"Director",description:"Field to select under role"}),team_manager:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.teamManager",defaultMessage:"Manager",description:"Field to select under role"}),member:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.ic",defaultMessage:"Individual Contributor",description:"Field to select under role"}),business_owner:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.business_owner",defaultMessage:"Business Owner",description:"Field to select under role"}),solo:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.freelancer",defaultMessage:"Freelancer",description:"Field to select under role"}),other:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.roleQuestion.other",defaultMessage:"Other",description:"Field to select under role"})},k={student:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.schoolQuestion.student",defaultMessage:"Student",description:"Field to select work type"}),educator:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.schoolQuestion.educator",defaultMessage:"Educator",description:"Field to select work type"}),other:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.schoolQuestion.other",defaultMessage:"Other",description:"Field to select work type"})},C={docs:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.useQuestion.docs",defaultMessage:"Collaborate with others in docs",description:"Field to select use type"}),wikis:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.useQuestion.wikis",defaultMessage:"Create a knowledge base / wiki",description:"Field to select use type"}),notes:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.useQuestion.notes",defaultMessage:"Write notes",description:"Field to select use type"}),project:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.useQuestion.project",defaultMessage:"Manage projects",description:"Field to select use type"}),goals:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.useQuestion.goals",defaultMessage:"Track company goals and OKRs",description:"Field to select use type goals"}),ai:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.useQuestion.question.ai",defaultMessage:"Write with AI",description:"Field to select work type"}),other:a()(u.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.useQuestion.other",defaultMessage:"Other",description:"Field to select use type other"})},_={"1_49":a()(u.FormattedMessage,{id:"OnboardingSurvey.companySize.question.1_49",defaultMessage:"1-49",description:"Field to select 1-49"}),"50_99":a()(u.FormattedMessage,{id:"OnboardingSurvey.companySize.question.50_99",defaultMessage:"50-99",description:"Field to select 50-99"}),"100_299":a()(u.FormattedMessage,{id:"OnboardingSurvey.companySize.question.100_299",defaultMessage:"100-299",description:"Field to select 100-299"}),"300_999":a()(u.FormattedMessage,{id:"OnboardingSurvey.companySize.question.300_999",defaultMessage:"300-999",description:"Field to select 300-999"}),"1000_5000":a()(u.FormattedMessage,{id:"OnboardingSurvey.companySize.question.1000_5000",defaultMessage:"1000-5000",description:"Field to select 1000-5000"}),"5000+":a()(u.FormattedMessage,{id:"OnboardingSurvey.companySize.question.5000+",defaultMessage:"5000+",description:"Field to select 5000+"})};class M extends l.Z{renderComponent(){const{question:e,questionType:t,title:o,randomizeSelectionOrder:i,className:r,workFunctionOptionsVersion:l,width:p,placeholder:v}=this.props,{device:M}=this.environment;let T={};"role"===t&&(T=2===l?w:y),"school"===t&&(T=k),"work"===t&&(T=2===l?S:b),"use"===t&&(T=C),"companySize"===t&&(T=_);const I={menuTitle:o,items:this.getPersonaSelectionMessages(T,i,this.environment.currentUser.id),width:p||280,disabled:this.props.disabled||!1,getKey:e=>e,selectedItem:t,originGap:4,onSelect:e=>{this.props.onSelect(e)},renderItem:e=>s.createElement(m.Z,n()({title:T[e.key]},e,{className:`${r}-${e.key}`})),renderOrigin:t=>s.createElement(g.Z,n()({},t,{isLarge:!0,style:{...this.getInputStyle(),...this.props.invalid&&{border:`1px solid ${c.ZP.red}`},...this.props.styles},className:r,focused:this.props.focus}),a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(f.Z,{isMobile:M.isMobile,isSecondaryColor:!Boolean(e)},void 0,e?T[e]:v||a()(u.FormattedMessage,{defaultMessage:"Select response",id:"PersonaCollectionModal.selectQuestion.label",description:"placeholder label for selection"}))),d.Z.expand({width:10,fill:this.theme.lightIconColor}))};return s.createElement(h.Z,n()({key:"persona"},I))}getInputStyle(){const{device:e}=this.environment;return{backgroundColor:this.theme.whiteButtonBackground,height:e.isMobile?44:32,padding:"2px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:3,border:0,transition:"box-shadow 0.3s ease",boxShadow:`0 0 0 1px ${this.theme.outlineButtonBorder}`,background:this.theme.buttonBackground}}getPersonaSelectionMessages(e,t,o){const i=Object.keys(e);if(!t)return i;const n=(0,p.yH)(o);return i.filter((e=>e!==v)).sort((()=>n()-.5)).concat(i.filter((e=>e===v)))}}M.displayName="PersonaCollectionModalQuestionSelect";const T=(0,u.injectIntl)(M)},23089:(e,t,o)=>{o.d(t,{Z:()=>W});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(66897),u=o(19889),m=o(51454),g=o(20095),h=o(17504),f=o(65598),v=o(439),y=o(95802),b=o(79315),S=o(24229),w=o(10161),k=o(17903),C=o(22294),_=o(13884),M=o(42057),T=o(3815),I=o(86486),P=o(27724),x=o(24666),B=o(30016),Z=o(10339),E=o(24405),R=o(8848),A=o(15095);function D(e,t){return e&&(0,R.iY)(e,t)}var F=o(24039),L=o(62896),V=o(58032);const N=function(e){let{renderTooltip:t,children:o,style:i}=e;return window.__c={n:"AvatarTooltip"},a()(V.Z,{renderTooltip:t,placement:V.Z.Placement.Bottom,alignment:V.Z.Alignment.Start,render:e=>c.createElement("div",n()({style:i},e),o)})};const O=function(e){let{name:t,size:o,style:i,tooltipStore:n,userId:r}=e;window.__c={n:"AttributionAvatar"};const s=(0,E.yK)((e=>({wrapper:{background:"none",boxShadow:"none"},attribution:{boxSizing:"content-box",width:(o||18)-2,height:(o||18)-2,lineHeight:`${o||18}px`,overflow:"hidden",textAlign:"center",fontSize:11,letterSpacing:"0.03em",userSelect:"none",WebkitUserSelect:"none",fontVariant:"small-caps",color:r&&D(r,e),cursor:"default"}})),[r,o]),l=function(e){const t=e.name,o=e.email;let i;if(t||o){if(t){const e=t.split(" ").filter((e=>e.length>0));i=e.length>1?String(A.p4(e[0])[0])+String(A.p4(e[e.length-1])[0]):String(A.p4(t)[0])+String(A.p4(t)[1])}else i=null==o?void 0:o.substring(0,2);return i=i?i.toUpperCase():void 0,i}}({name:t});return l&&s.attribution.color?a()(N,{style:i,renderTooltip:()=>a()(F.Z,{store:n})},void 0,a()("div",{style:s.wrapper},void 0,a()("div",{style:s.attribution},void 0,a()(L.Z,{},void 0,l)))):null};var U=o(45653),H=o(65200);class z extends d.Z{constructor(){super(...arguments),this.interval=void 0,this.containerEl=void 0,this.handleContainerMount=e=>{e&&(this.containerEl=e)},this.findComponentByBlockId=(e,t,o)=>e.find((e=>{const i=e.props.store;return Boolean(i&&i.id===t&&o.uiContains(i)&&e.props.shouldShowHalo)})),this.presenceAvatarsStore=this.createComputedStore((()=>this.getPresenceAvatars(this.attributionAvatarsStore.state)),!0,"presenceAvatarsStore"),this.blockAttributionEnabledStore=this.createComputedStore((()=>w.default.checkGate("block_attribution")),!1,"blockAttributionEnabledStore"),this.attributionAvatarsStore=this.createComputedStore((()=>{var e;if(!this.blockAttributionEnabledStore.state)return[];const t=this.props.isPeekView?M.Z:k.Z,o=t.state.scrollTop-5e3,i=o+((null===(e=t.state.clientRect)||void 0===e?void 0:e.height)||0)+5e3,n=this.getAttributionAvatars();n.sort(((e,t)=>e.top-t.top));const r=[];return n.every((e=>e.top>=o&&e.top<=i&&(r.push(e),!0))),r}),!0,"attributionAvatarsStore"),this.updateAvatars=()=>{this.attributionAvatarsStore.recompute()},this.updateAvatarsDebounced=l().debounce(this.updateAvatars,100)}didMount(){super.didMount(),this.blockAttributionEnabledStore.state&&(window.addEventListener("resize",this.updateAvatarsDebounced),this.interval=setInterval(this.updateAvatarsDebounced,z.updateInterval))}willUnmount(){super.willUnmount(),window.removeEventListener("resize",this.updateAvatarsDebounced),clearInterval(this.interval)}renderComponent(){return c.createElement("div",{className:"notion-presence-container",style:z.containerStyle,ref:this.handleContainerMount},a()(Z.Z,{render:()=>l().compact([...this.presenceAvatarsStore.state.map((e=>this.renderPresenceAvatar(e))),...(this.attributionAvatarsStore.state||[]).map((e=>this.renderAttributionAvatar(e)))])}))}renderPresenceAvatar(e){const{device:t}=this.environment,{rootStore:o}=this.props.presenceStore.state;if(o&&"presence"===e.type){const{left:i,top:r,userId:s}=e,l=this.getAvatarWrapEnterExitStyle(i,r),d=T.U6.createChildStore(o,{table:u.KJ,id:s});if(!d.isDefined())return;return a()(B.Z,{isVisible:!0,enterAnimationStyle:l,exitAnimationStyle:l,animationStyle:this.getAvatarWrapAnimationStyle(i,r),render:()=>(0,h.Z)((o=>c.createElement("div",n()({key:s,style:this.getAvatarWrapStyle(e.blockType)},o),a()(U.Z,{userStore:d,style:this.getAvatarStyle(),size:t.isMobile?z.avatarMobileSize:z.avatarSize,avatarShouldShowShadow:!0}))))},s)}}renderAttributionAvatar(e){const{rootStore:t}=this.props.presenceStore.state;if(t&&"attribution"===e.type){const{left:o,top:i,actor:r,uniqueId:s,blockStore:l}=e,d=this.getAvatarWrapEnterExitStyle(o,i),u=(0,p.Hl)({pointer:r,getRecordValue:t.getRecordValue});if(!u)return;return a()(B.Z,{isVisible:!0,enterAnimationStyle:d,exitAnimationStyle:d,animationStyle:this.getAvatarWrapAnimationStyle(o,i),springConfig:{scale:{stiffness:200,damping:25,precision:.01},opacity:{stiffness:400,damping:25,precision:.01}},render:()=>(0,h.Z)((e=>{var t,o;return c.createElement("div",n()({key:s,style:this.getAvatarWrapStyle()},e),a()(O,{userId:null===(t=u.value)||void 0===t?void 0:t.id,name:null===(o=u.value)||void 0===o?void 0:o.name,style:this.getAvatarStyle(),size:z.avatarSize,tooltipStore:l}))}))},s)}}findComponentClosestToPresenceBlock(e,t,o){const i=new Map(t.map(((e,t)=>[e,t])));let n,r;for(const a of e){const e=a.props.store,t=i.get(e.id);if(void 0!==t&&((void 0===r||t<r)&&o.uiContains(e)&&a.props.shouldShowHalo&&(n=a,r=t),0===r))return n}return n}getPresenceAvatars(e){const{pageVisitStore:t,presenceStore:o}=this.props,i=new Set(e.map((e=>{let{blockStore:t}=e;return t.id}))),{rootStore:n}=o.state;if(!n)return[];if(!this.containerEl)return[];const r=this.environment.currentUser.id,a=(0,g.AQ)(t,o).filter((e=>e.userId!==r&&(0,g.MR)(this.environment,e)));if(a.length>0){const e={},t=y.C.getMembersByDOMOrder({filter:()=>!0}),o=this.containerEl.getBoundingClientRect(),r=I.default.state;return l().compact(a.map((a=>{const s=(0,g.EB)(a),l=null==a?void 0:a.blockPath;let c;if(l&&l.length>0?c=this.findComponentClosestToPresenceBlock(t,l,n):s&&(c=this.findComponentByBlockId(t,s,n)),!c)return;const d=c.props.store.id;e.hasOwnProperty(d)||(e[d]=0),e[d]++;const p=c.getNode();if(!(p&&p instanceof Element))return;const u=p.getBoundingClientRect(),m=r.isOpen&&r.currentStore.id===d?z.selectableHoverMenuTargetOffset:0,h=i.has(d)?1:0;if(u){let t=u.left-o.left-m;const i=c.getContextHorizontalScroller();if(i){const e=i.stores.store.state.clientRect,n=null==e?void 0:e.left,r=null==e?void 0:e.right;if(r&&u.left>r)return;n&&(t=Math.max(n-o.left-m,t))}return{type:"presence",userId:a.userId,left:t,top:u.top-o.top+(e[d]+h-1)*z.iconStackOffset,blockType:c.props.store.getType()}}})))}return[]}getAttributionAvatars(){var e;const t=w.default.checkGate("block_attribution"),{currentUserSettingsStore:o}=b.default.state,i=(null==o||null===(e=o.getSettings())||void 0===e?void 0:e.show_block_attribution)??!0;if(!t||!i)return[];const{presenceStore:n}=this.props,{rootStore:r}=n.state;if(!this.containerEl||!r||"editing"!==x.default.state.mode||_.Z.state.open||S.Z.state.open||C.Z.state.isKeyboardMode)return[];let a;for(const l of P.default.state.stores){const e=l.findRecordStoreUIAncestor((e=>e instanceof T.G&&e.isTransclusionType())).ancestor;e&&e instanceof T.G&&"transclusion_container"===e.getType()&&(a=e)}const s=y.C.getMembersByDOMOrder({filter:()=>!0}),c=this.containerEl.getBoundingClientRect(),d=f.MF(r).flatMap((e=>{const t=[];if(e.isInsideTransclusion()||e.isTransclusionType()){let o=e;if("transclusion_reference"===e.getType()){const t=e.getTransclusionReferenceTargetStore();t&&(o=t)}"transclusion_reference"!==e.getType()&&"transclusion_container"!==e.getType()||(o!==a?t.push(this.getAttributionAvatarsFromStore(e,s,c)):f.MF(o).map((e=>t.push(this.getAttributionAvatarsFromStore(e,s,c)))))}else t.push(this.getAttributionAvatarsFromStore(e,s,c));return t})).filter((e=>!l().isUndefined(e)));d.sort(((e,t)=>e.top-t.top));const p=d.filter(((e,t,o)=>0===t||e.actor.id!==o[t-1].actor.id));return 1===p.length?[]:p}getAttributionAvatarsFromStore(e,t,o){const i=e.getLastEditedById(),n=e.getLastEditedByTable(),r=I.default.state;if(!i||!n||"bot"===n)return;const a={table:n,id:i},s=this.findComponentByBlockId(t,e.id,e);if(!s)return;const l=e.getType();if("collection_view"===l||"collection_view_page"===l||"divider"===l||"table"===l||"table_row"===l||"tab"===l)return;if(e.isEmptyEditableBlock())return;const c=s.getNode();if(!(c&&c instanceof Element))return;const d=c.getBoundingClientRect();if(!d)return;const p=r.isOpen&&r.currentStore===e?z.selectableHoverMenuTargetOffset:0,u=(0,v.zt)((0,v.oJ)(e),e),m=(H.Z.height-z.attributionAvatarSize)/2,g=d.top-o.top+u-m,h=d.left-o.left;return p>0?{type:"attribution",actor:a,left:h-p,top:g,uniqueId:`${String(e.key)}+left`,blockStore:e}:{type:"attribution",actor:a,left:h,top:g,uniqueId:String(e.key),blockStore:e}}getAvatarWrapAnimationStyle(e,t){const{device:o}=this.environment;o.isMobile?(e-=21,t+=5):(e-=28,t+=3);return{translateX:e,translateY:t,scale:1,opacity:1}}getAvatarWrapEnterExitStyle(e,t){return{...this.getAvatarWrapAnimationStyle(e,t),scale:.7,opacity:0}}getAvatarWrapStyle(e){const{device:t}=this.environment;let o,i=0;if(t.isMobile){const t=e&&["breadcrumb","bulleted_list","numbered_list","toggle"].includes(e);o=z.avatarMobileSize,i=t?3:i}else o=z.avatarSize;return{position:"absolute",top:0,left:i,width:o,height:o}}getAvatarStyle(){const{device:e}=this.environment;let t;return t=e.isMobile?z.avatarMobileSize:z.avatarSize,{width:t,height:t}}}z.displayName="PresenceContainer",z.updateInterval=1e3,z.iconStackOffset=15,z.selectableHoverMenuTargetOffset=38,z.avatarSize=24,z.avatarMobileSize=20,z.attributionAvatarSize=18,z.containerStyle={position:"absolute",top:0,left:0,zIndex:m.eu};const W=z},32469:(e,t,o)=>{o.d(t,{Z:()=>h});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(3779),p=o(82990),u=o(5366),m=o(58032);class g extends l.Z{constructor(){super(...arguments),this.storeTypes={}}renderComponent(){return a()(m.Z,{renderTooltip:()=>a()(u.FormattedMessage,{defaultMessage:"Only you can see this page",id:"privatePageBadge.tooltip"}),render:e=>s.createElement("div",n()({style:{display:"flex",alignItems:"flex-start",...this.props.style||{}}},e),a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()("div",{style:{flexShrink:0,marginTop:-1,marginRight:4,fill:c.ZP.red}},void 0,d.Z.locked({width:12})),a()("span",{style:{fontSize:12,fontWeight:p.Z.fontWeight.semibold,color:c.ZP.red}},void 0,a()(u.FormattedMessage,{defaultMessage:"Private",id:"privatePageBadge.label"}))))})}}g.displayName="PrivatePageBadge",g.style={};const h=g},19387:(e,t,o)=>{o.d(t,{Z:()=>f});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(99036),s=o(39068),l=o(82990),c=o(99417),d=o(61766),p=o(33846),u=o(24405),m=o(5366);const g=function(){window.__c={n:"AiPropertyBadge"};const e=(0,u.Fg)();return n()("span",{style:{marginLeft:6,fontSize:12,padding:"1px 4px",borderRadius:4,display:"inline-flex",flexDirection:"row",alignItems:"center",gap:4,background:e.accentColors.purple[50],color:e.accentColors.purple[500]}},void 0,n()(m.FormattedMessage,{defaultMessage:"AI",id:"database.property.aiAutofillEnabledIndicator",description:"Badge next to a property name to indicate that the property is set up to be filled by AI"}))};class h extends r.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:d.Z,nameInputStore:p.Z}}renderComponent(){const{device:e}=this.environment,{propertySchema:t,showIcon:o,hideName:i,showBadge:r,style:a}=this.props,s=e.isMobile?16:14;return n()("div",{style:{...h.baseStyle,fontSize:s,...a}},void 0,o&&n()("div",{style:this.getIconStyle()},void 0,this.renderIcon()),!i&&n()("div",{style:{...l.Z.textOverflowStyle}},void 0,t.name),r&&this.renderBadge())}renderIcon(){const{device:e}=this.environment,{propertySchema:t}=this.props,{theme:o}=this,i=e.isMobile?18:16;return n()(s.ZP,{type:t.type,icon:t.icon,size:this.props.iconSize||i,theme:o,style:this.props.iconStyle})}renderBadge(){const{propertySchema:e}=this.props;if((0,c.Zt)(this.environment)&&a.q3(e))return n()(g,{})}getIconStyle(){const{hideName:e,iconStyle:t}=this.props;return{marginRight:e?void 0:6,...t}}}h.displayName="Property",h.baseStyle={display:"flex",alignItems:"center",lineHeight:"120%",minWidth:0};const f=h},3072:(e,t,o)=>{o.d(t,{Z:()=>I});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(2032),u=o(5366),m=o(47853),g=o(16187),h=o(60709),f=o(98742),v=o(52275),y=o(78140),b=o(9342),S=o(40721),w=o(44532),k=o(72495),C=o(58032),_=o(95030);const M=(0,u.defineMessages)({noneText:{defaultMessage:"None",id:"database.propertyAggregationMenu.noneText"}});class T extends d.Z{renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:h.og.Modal,title:a()(u.FormattedMessage,{defaultMessage:"Table aggregation",id:"database.mobilePropertyAggregationMenu.title"}),right:a()(S.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:h.og.Popup,width:200},c.createElement(y.Z,t,a()(b.Z,{type:b.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>c.createElement(k.Z,e),items:this.getAggregationActions()}],onAccept:this.props.onClose}))}getAggregationActions(){const e=[],{property:t,schema:o,source:i}=this.props,r=o[t];if(!r)return[];e.push({key:"none",render:e=>c.createElement(v.Z,n()({},e,{title:this.props.noneText||this.props.intl.formatMessage(M.noneText)})),action:()=>this.props.onChange(void 0)});for(const n of p.o5)e.push(this.createAggregationAction(n));if((0,p.iV)(r))for(const n of p.Sy){const t=this.createAggregationAction(n);if("show_unique"===n)switch(i){case"tableAggregation":continue;case"rollupPropertyMenu":e.splice(1,0,t);continue}e.push(t)}if((0,p.O4)(r))for(const n of p.k$)e.push(this.createAggregationAction(n));if((0,p.dN)(r))for(const n of p.f8)e.push(this.createAggregationAction(n));if((0,p.Mv)(r))for(const n of p.gC)e.push(this.createAggregationAction(n));if((0,p.Ei)(r))for(const n of p.OK)e.push(this.getStatusPropAggregationAction(t,n));return e}createAggregationAction(e){const t=g.VN[e];return{key:t,render:o=>a()(C.Z,{placement:w.GI.Placement.Right,delayThreshold:0,render:e=>c.createElement(v.Z,n()({title:t},(0,f.Z)(e,o))),renderTooltip:()=>a()("div",{style:{width:140,whiteSpace:"normal"}},void 0,a()("img",{src:(0,m.D)(g.Sn[e]),style:{borderRadius:3,width:140,marginTop:4}}),g.BG[e])},o.key),action:()=>{this.props.onChange(e)}}}getStatusPropAggregationAction(e,t){const{device:o}=this.environment,i=g.VN[t],r=l().compact(this.createStatusPropGroupAggregationAction(e,t));return{key:t,render:(e,t)=>c.createElement(_.Z,n()({},e,{onFocus:t.onFocus,renderOrigin:e=>c.createElement(v.Z,n()({},e,{title:i})),renderExtension:(e,n)=>{let s;return s=o.isMobile?{menuType:h.og.Modal,title:i,right:a()(S.DoneMenuText,{}),onClickRight:n.close,...e}:{menuType:h.og.Popup,width:200,...e},c.createElement(y.Z,s,a()(b.Z,{type:b.i.Vertical,initialFocus:0,sections:[{key:"groups",render:e=>c.createElement(k.Z,e),items:r}],onAccept:t.onAccept}))}})),action:()=>null}}createStatusPropGroupAggregationAction(e,t){const o=this.props.schema[e];if(!o||"status"!==o.type)return;const i=o.groups;return i?i.map((e=>({key:`${t}${e.name}`,render:o=>this.renderAggregationGroupMenuItem(t,e.name,o),action:()=>{this.props.onChange({operator:t,groupName:e.name})}}))):void 0}renderAggregationGroupMenuItem(e,t,o){return a()(C.Z,{placement:w.GI.Placement.Right,delayThreshold:0,render:e=>c.createElement(v.Z,n()({title:t},(0,f.Z)(e,o))),renderTooltip:()=>a()("div",{style:{width:140,whiteSpace:"normal"}},void 0,a()("img",{src:(0,m.D)(g.Sn[e]),style:{borderRadius:3,width:140,marginTop:4}}),g.BG[e])},o.key)}}T.displayName="PropertyAggregationMenu";const I=(0,u.injectIntl)(T)},69872:(e,t,o)=>{o.d(t,{L:()=>g,Z:()=>f});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(39068),d=o(52821),p=o(60709),u=o(52275),m=o(28992);let g;!function(e){e[e.Name=0]="Name",e[e.Type=1]="Type"}(g||(g={}));class h extends l.Z{renderComponent(){const{name:e,type:t,icon:o}=this.props.propertySchema,i=this.props.format===g.Name?e:d.SO[t],{theme:r}=this;return this.props.locked?s.createElement(m.Z,n()({title:i,icon:a()(c.ZP,{icon:o,type:t,size:this.environment.device.isMobile?18:16,theme:r,style:{fill:r.regularIconColor}})},this.props)):s.createElement(u.Z,n()({title:i,icon:a()(c.ZP,{icon:o,type:t,size:this.environment.device.isMobile?18:16,theme:r,style:{fill:r.regularIconColor,marginLeft:6,marginRight:2}})},this.props))}}h.displayName="PropertyMenuItem",h.DisplayFormat=g,h.contextTypes={...p.mw,...l.w};const f=h},77498:(e,t,o)=>{o.d(t,{Z:()=>T});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(43261),l=o.n(s),c=o(96486),d=o.n(c),p=o(67294),u=o(83355),m=o(99036),g=o(80951),h=o(5366),f=o(60709),v=o(33846),y=o(68894),b=o(78140),S=o(9342),w=o(43765),k=o(40721),C=o(72495),_=o(69872);class M extends u.Z{constructor(){super(...arguments),this.storeTypes={inputStore:v.Z}}renderComponent(){const{onAccept:e,schema:t,onClose:o,allowProperty:i,intl:r,isRelationProperty:s}=this.props,{inputStore:c}=this.stores;let u=Object.keys(t);const v=u.some(g.wl);u=d().sortBy(u,(e=>{const o=(0,g.Qm)({schema:t,property:e});return o?o.name:""}));const M=v?`${g.UU}${m.iw}`:m.iw;u=d().without(u,M),u.unshift(M);const T=c.state.inputValue;if(i&&(u=u.filter((e=>{const o=(0,g.Qm)({schema:t,property:e});return o&&i(o)}))),T){let e=u.map((e=>{const o=(0,g.Qm)({schema:t,property:e});return o&&o.name}));e=l().filter(T,e).map((e=>{let{original:t}=e;return t})),u=u.filter((o=>{const i=(0,g.Qm)({schema:t,property:o});return i&&i.name&&e.includes(i.name)}))}const I=d().compact(u.map((o=>{const i=(0,g.Qm)({schema:t,property:o});if(!i)return;return{key:o,render:e=>p.createElement(_.Z,a()({},e,{propertySchema:i,format:_.Z.DisplayFormat.Name})),action:()=>e(o)}}))),P=[{key:0,render:e=>p.createElement(C.Z,e),items:I}],{device:x}=this.environment,B=n()(C.Z,{isInput:!0},void 0,n()(y.ZP,{focus:!x.isMobile||void 0,focusAfterAnimation:!0,value:T,onChange:e=>this.stores.inputStore.setState({focus:!0,inputValue:e.target.value}),placeholder:s?r.formatMessage({defaultMessage:"Search for a relation property…",id:"propertySelectMenu.searchForProperty.relation.placeholder"}):r.formatMessage({defaultMessage:"Search for a property…",id:"propertySelectMenu.searchForProperty.default.placeholder"})}));let Z;return Z=x.isMobile?{menuType:f.og.Modal,title:s?r.formatMessage({defaultMessage:"Relation property",id:"propertySelectMenu.mobileMenu.relationProperty.header"}):r.formatMessage({defaultMessage:"Property",id:"propertySelectMenu.mobileMenu.property.header"}),right:n()(k.CancelMenuText,{}),onClickRight:o,header:B}:{menuType:f.og.Popup,width:300,header:B},p.createElement(b.Z,Z,0===I.length?n()(C.Z,{},void 0,n()(w.Z,{title:n()(h.FormattedMessage,{defaultMessage:"No results",id:"propertySelectMenu.search.noResults.title"})})):n()(S.Z,{type:S.i.Vertical,sections:P,onAccept:o,initialFocus:T.length>0?0:void 0}))}}M.displayName="PropertySelectMenu";const T=(0,h.injectIntl)(M)},13612:(e,t,o)=>{o.d(t,{Z:()=>k});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(95182),p=o(50906),u=o(24677),m=o(12955),g=o(60709),h=o(35328),f=o(79315),v=o(48019),y=o(64921),b=o(31945),S=o(78140);class w extends l.Z{constructor(){super(...arguments),this.renderOrigin=e=>{const{device:t}=this.environment;return s.createElement(y.Z,a()({style:this.getButtonStyle(),mobileFeedback:t.isMobile},e),c.Z.dots({width:18,height:18}))},this.renderPopup=()=>{var e;const{currentUser:t,device:o}=this.environment,i=Boolean(t.isLoggedIn()||(0,m.getPublicDomainUserId)(this.environment)),{store:r}=this.props,a={environment:this.environment,blocks:[r],publicEditMode:null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state};let l;l=o.isMobile?{menuType:g.og.ActionSheet}:{menuType:g.og.Popup,width:210,maxHeight:"80vh"};let c=d.G9;return!i&&o.isMobile&&(c=d.iD),s.createElement(S.Z,l,n()(v.Z,{sections:c,onAccept:this.handleAccept,context:a}))},this.handleClick=()=>{u.ZH(this.environment),p.trackOpenPublicMoreMenu(this.environment)},this.handleDismiss=()=>{this.props.buttonPopupStore.setState({...this.props.buttonPopupStore.state,open:!1})},this.handleAccept=e=>{const{mainEditorCurrentBlockStore:t}=f.default.state;if(t){const o=t.getType();o&&p.trackBlockAction(this.environment,{analyticsName:e.analyticsName,from:"public_topbar_more_menu",block_id:t.id,block_type:o,is_toggleable:(0,h._A)(o,t.getFormat())})}e.closeParentMenu&&this.handleDismiss()}}renderComponent(){const{device:e}=this.environment;return n()(b.Z,{popupType:e.isMobile?b.Z.PopupType.SlideUp:b.Z.PopupType.Popup,buttonPopupStore:this.props.buttonPopupStore,renderOrigin:this.renderOrigin,onClick:this.handleClick,render:this.renderPopup,originGap:8})}getButtonStyle(){const{device:e}=this.environment;return e.isMobile?{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",marginLeft:8,marginRight:8}:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:28,borderRadius:3}}}w.displayName="PublicTopbarMoreButton";const k=w},62045:(e,t,o)=>{o.d(t,{Z:()=>h});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(3779),p=o(52275),u=o(8982),m=o(63296);class g extends l.Z{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick&&this.props.onClick()}}renderComponent(){const{device:e}=this.environment,t=Boolean(this.props.title);if(e.isMobile)return a()(p.Z,{showExtensionArrow:!this.props.disabled,focused:!1,title:t?a()("div",{style:{display:"flex",alignItems:"center",...this.props.innerStyle}},void 0,this.props.title):a()("div",{style:{display:"flex",alignItems:"center",color:c.ZP.uiGray,...this.props.innerStyle}},void 0,this.props.placeholder),onClick:this.props.onClick});{const e="dark"===this.theme.mode?this.theme.lightTextColor:this.theme.mediumTextColor;return a()(u.i,{action:this.handleClick,disabled:this.props.disabled,render:o=>s.createElement(m.Z,n()({},o,{hovered:o.focused,isLarge:!0,backgroundColor:this.theme.buttonBackground,style:{marginRight:8,maxWidth:180,padding:"0 8px",...o.disabled&&{opacity:.5},...this.props.disableMargins&&{marginRight:0,maxWidth:"100%",justifyContent:"space-between"},...this.props.desktopStyle}}),a()("div",{style:{display:"flex",minWidth:0,color:t?this.theme.regularTextColor:e,...this.props.innerStyle}},void 0,t?this.props.title:this.props.placeholder),!this.props.disabled&&d.Z.chevronDown({width:10,marginLeft:6,fill:this.theme.lightIconColor}))})}}}g.displayName="QueryMenuDropdownItem";const h=g},50542:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(5366),s=o(52275),l=o(19387),c=o(69872),d=o(62045);class p extends r.Z{renderComponent(){const{device:e}=this.environment;if(e.isMobile)return this.props.propertySchema?n()(c.Z,{propertySchema:this.props.propertySchema,onClick:this.props.onClick,focused:!1,format:c.Z.DisplayFormat.Name,showExtensionArrow:!this.props.disabled}):n()(s.Z,{focused:!1,title:n()(a.FormattedMessage,{defaultMessage:"Property",id:"database.mobileFilterAndSortMenu.property.buttonMenuItem.label"})});{const e=this.props.propertySchema&&n()(l.Z,{propertySchema:this.props.propertySchema,showIcon:!0,style:{lineHeight:1.4}}),t=n()(a.FormattedMessage,{defaultMessage:"Property",id:"database.filterAndSortMenu.propertyButton.label"});return n()(d.Z,{title:e,placeholder:t,onClick:this.props.onClick,disabled:this.props.disabled,disableMargins:this.props.disableMargins,desktopStyle:this.props.textWrapperStyle})}}}p.displayName="QueryMenuPropertyItem";const u=p},16472:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(77094),n=o.n(i),r=(o(67294),o(49271)),a=o(5366),s=o(33929),l=o(86671),c=o(17748),d=o(65187);const p=(0,a.defineMessages)({emptyPlaceholder:{defaultMessage:"Empty quote",id:"quoteBlock.emptyQuote.placeholder"}});class u extends l.Z{renderPersisted(){const{disabled:e}=this.props;return n()("div",{style:this.getStyle()},void 0,n()("div",{style:u.innerStyle},void 0,n()(d.Z,{style:u.padding,placeholderStyle:{left:u.innerStyle.paddingLeft,width:"auto",right:u.innerStyle.paddingLeft},disabled:e,store:this.props.store.getBlockTitleStore(),placeholder:s.default.formatMessage(p.emptyPlaceholder),pasteBehavior:"block"}),!this.props.hideContent&&n()(c.Z,{disabled:e,store:this.props.store.getContentStore(),disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag})),this.renderDiscussion())}getStyle(){const e=this.props.store.getFormat();return{fontSize:"large"===(null==e?void 0:e.quote_size)?"1.2em":"1em",...r.ZD,...this.getBlockColorStyle(),display:"flex",...this.props.style}}}u.localSizePreferenceKey="QuoteBlockDefaultSize",u.borderWidth=3,u.horizontalPadding=14,u.padding={paddingLeft:r.ZD.paddingLeft,paddingRight:r.ZD.paddingRight},u.innerStyle={borderLeft:`${u.borderWidth}px solid currentColor`,paddingLeft:u.horizontalPadding,paddingRight:u.horizontalPadding,width:"100%"};const m=u},46978:(e,t,o)=>{o.d(t,{Z:()=>l});var i=o(77094),n=o.n(i),r=o(67294),a=o(24405);function s(e,t){let{isSelected:o}=e;window.__c={n:"RadioButtonIcon"};const{radioButtonStyle:i,dotStyle:s}=(0,a.yK)((e=>({radioButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:16,height:16,borderRadius:16,marginRight:8,background:o?e.blueColor:e.whiteButtonBackground,border:o?"none":`1px solid ${e.radioButtonBorder}`,transition:"background 100ms ease-out"},dotStyle:{width:6,height:6,borderRadius:6,background:e.regularInvertedTextColor,transition:"opacity 100ms ease-out",opacity:o?1:0}})),[o]);return r.createElement("div",{ref:t,style:i},n()("div",{style:s}))}const l=r.forwardRef(s)},86765:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(77094),n=o.n(i),r=(o(67294),o(480)),a=o(81954),s=o(24405),l=o(5366),c=o(31278),d=o(76798),p=o(58613);const u=(0,l.injectIntl)((function(e){window.__c={n:"RelationCreateItemText"};const{title:t,targetCollectionStore:o}=e,i=(0,r.Fy)(),u=(0,a.VK)((()=>o.getIcon()),[o]),m=(0,s.yK)((e=>({medium:{color:e.mediumTextColor},dbName:{display:"flex",alignItems:"center",marginLeft:4},title:{marginLeft:p.Q*(i.isRetina?.5:1)}})),[i.isRetina]),g=t?n()("span",{},void 0," ",t," "):n()("span",{},void 0," "),h=n()("div",{style:m.dbName},void 0,n()(c.Z,{disabled:!0,icon:u,isEmptyPage:!1,size:i.isMobile?24:20}),n()(d.Z,{store:o,style:m.title}));return n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()(l.FormattedMessage,{id:"database.searchRelation.createNewPageFooter",defaultMessage:"<medium>New</medium> {pageName} <medium> in</medium> {databaseNameWithIcon}",description:"Label in relation property menu for row to create a new related page",values:{medium:e=>n()("span",{style:m.medium},void 0,e),pageName:g,databaseNameWithIcon:h}}))}))},9897:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(24405),c=o(3779),d=o(52275),p=o(72495),u=o(86765);function m(e){const{targetCollectionStore:t,title:o,onClick:i,focused:m,isSection:g,index:h}=e,f=(0,s.VK)((()=>t.canEdit()),[t]),v=(0,s.VK)((()=>t.isSyncedCollection()),[t]),y=(0,a.Fy)(),b=(0,l.yK)((e=>({wrapper:{borderTop:`1px solid ${e.lightDividerColor}`,paddingTop:4,paddingBottom:4},icon:{width:16,fill:e.mediumIconColor,marginRight:4,marginLeft:-2},row:{fontSize:y.isMobile?16:14,minHeight:y.isMobile?44:32}})),[y]);if(!f)return null;const S=n()(d.Z,{focused:m,icon:c.Z.plus(b.icon),style:b.row,onClick:()=>i(h),title:n()(u.Z,{targetCollectionStore:t,title:o})});return v?r.createElement(r.Fragment,null):g?n()(p.Z,{style:b.wrapper,disableDesktopPadding:!0,disableMobilePadding:!0},void 0,S):S}},68139:(e,t,o)=>{o.d(t,{Z:()=>N});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(84619),u=o(3779),m=o(5366),g=o(82990),h=o(50906),f=o(5978),v=o(49616),y=o(48543),b=o(73744),S=o(12534),w=o(33929),k=o(29376),C=o(86098),_=o(31792),M=o(19671),T=o(88923),I=o(75259),P=o(78030),x=o(64921),B=o(5145),Z=o(50478),E=o(73063),R=o(11470),A=o(58032),D=o(69265);const F=(0,m.defineMessages)({openAsPageTitle:{defaultMessage:"Open",id:"database.navigateButton.openAsPageTitle",description:"Open as page title"}});class L extends d.Z{constructor(){super(...arguments),this.outerRef=c.createRef(),this.relationTokenBlockStoreRef=c.createRef(),this.storeTypes={mouseStore:_.Z},this.renderInnerRelationMenuRow=(e,t,o,i,n,r,s,l,d,p,g,h,f)=>{const v="section"===i&&!this.props.disabled&&t.canEdit()&&!r.isMobile;return c.createElement(c.Fragment,null,e&&"popup"===i&&a()(B.ZP,{iconSize:12,style:{marginRight:4,height:20}}),r.isPhone?this.renderRelationToken(r,v):this.renderRelationProperties(r,v),(s||l)&&a()("div",{style:this.getRelationButtonWrapperStyle(s||l,!1)},void 0,s&&a()(V,{isOpenPage:!1,onClick:g,style:{borderRadius:3},icon:p?u.Z.checkPartial:u.Z.plus,tooltipMessage:a()(m.FormattedMessage,p?{id:"database.relationMenuRow.tooltip.removePage.message",defaultMessage:"Unlink page",description:"Tooltip for removing an already related page"}:{defaultMessage:"Link page",id:"database.relationMenuRow.tooltip.addPage.message",description:"Tooltip for adding a page as a relation"})}),l&&h&&a()(V,{isOpenPage:!1,onClick:()=>h(this.outerRef.current),style:{borderRadius:0},icon:u.Z.plus,tooltipMessage:a()(m.FormattedMessage,"section"===i&&p?{id:"database.relationMenuRow.tooltip.insertPageInline.message",defaultMessage:"Insert new page",description:"Tooltip for inserting and creating a new page inline underneath the current relation"}:{id:"database.relationMenuRow.tooltip.insertPage.message",defaultMessage:"Link another page",description:"Tooltip for opening the picker from an already related page"})})),d&&f&&a()("div",{style:this.getRelationButtonWrapperStyle(s||l,!0)},void 0,a()(V,{isOpenPage:!0,onClick:f,style:{width:60},icon:"side_peek"===this.peekModeStore.state?u.Z.peekModeSide:"center_peek"===this.peekModeStore.state?u.Z.peekModeCenter:u.Z.openAsPageThick,tooltipMessage:"side_peek"===this.peekModeStore.state?a()(m.FormattedMessage,{id:"database.relationMenuRow.tooltip.openPageSidePeek.message",defaultMessage:"Open in side peek",description:"Tooltip that displays on button to open a related page in a side peek view."}):"center_peek"===this.peekModeStore.state?a()(m.FormattedMessage,{id:"database.relationMenuRow.tooltip.openPageCenterPeek.message",defaultMessage:"Open in center peek",description:"Tooltip for button that opens an already related page in center peek view."}):a()(m.FormattedMessage,{id:"database.relationMenuRow.tooltip.openPage.message",defaultMessage:"Open as page",description:"Tooltip for button that opens an already related page"})})))},this.renderRelationToken=(e,t)=>{const{relatedPageStore:o,rowType:i,pageStore:n}=this.props;return a()("div",{style:{display:"flex",alignItems:"center",flex:"0 1 auto",minWidth:40,minHeight:0,paddingLeft:8}},void 0,c.createElement(D.Z,{ref:this.relationTokenBlockStoreRef,key:o.id,format:p.l.Inline,blockId:o.id,isSingle:!0,parentStore:n,showRelationTooltip:!0,style:{display:"flex",alignItems:"center",margin:0,whiteSpace:"nowrap",marginRight:"section"===i?0:e.isTablet?8:0},tooltipOriginStyle:{minWidth:0},titleStyle:{...g.Z.textOverflowStyle,maxWidth:"100%"},tooltipDynamicMouseOverflow:!0,clickTitleBehavior:t?"edit":void 0,onTitleEnter:this.props.onInsertInline,index:this.props.index}))},this.renderRelationProperties=(e,t)=>{const{relatedPageStore:o,targetCollectionStore:i,blockPropertyValueOverlayStore:n,rowType:r}=this.props,s=this.targetPropertiesToDisplay.state;if(l().isEmpty(s))return;const c="section"!==r||(this.props.disabled||!o.canEdit()||this.environment.device.isMobile),d=s.map((s=>"title"===s.property?this.renderRelationToken(e,t):a()(I.Z,{store:o,property:s.property,disabled:c,locked:!1,format:"section"===r?P.C.RelationSection:P.C.Relation,tableWrap:!1,blockPropertyValueOverlayStore:n??M.Z,collectionStore:i},s.property)));return a()("div",{style:{display:"flex",marginRight:8,maxHeight:22,alignItems:"center"}},void 0,d)},this.targetPropertiesToDisplay=this.createComputedStore((()=>{const{collectionStore:e,targetCollectionStore:t,property:o}=this.props,i=t.getSchema();return i?k.U1({collectionStore:e,property:o}).filter((e=>e.visible&&("title"===e.property||i[e.property]))):[]}),!0),this.peekModeStore=this.createComputedStore((()=>{if(T.default.state.open)return T.default.state.mode;const{blockPropertyValueOverlayStore:e}=this.props,t=null==e?void 0:e.state;if(null==t||!t.isOpen||null==t||!t.collectionContextStore)return T.default.state.mode;const o=t.collectionContextStore,i=null==o?void 0:o.collectionViewStore(),n=null==i?void 0:i.getType();return i&&n?i.getFormat().collection_peek_mode??y.Ls[n]:T.default.state.mode})),this.handleMouseMove=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleButtonClick=e=>{const{collectionStore:t,targetCollectionStore:o,isSelected:i,relatedPageStore:n,onActionButtonClick:r,disabled:a,rowType:s,blockPropertyValueOverlayStore:l}=this.props;if(i||a){const i=b.DJ(e),r=t.id===o.id?T.default.state.resultsStore:void 0,a=t.id===o.id?T.default.state.collectionContextStore:void 0,c=T.default.isSidePeekOpen();if(f.peekBlock({environment:this.environment,store:n,peekMode:this.peekModeStore.state,openInNew:i,resultsStore:r,collectionContextStore:a}),h.trackRelationNavigateBlock(this.environment,{from:"inline"===s||"section"===s?"property_value":"configure_relation_modal",meta_click:Boolean(i)}),"popup"===s&&!c){(l??M.Z).setState({isOpen:!1})}}else r(e)},this.handleRelationSectionRelationMenuRowClick=e=>{const{collectionStore:t,targetCollectionStore:o,isSelected:i,relatedPageStore:n,onActionButtonClick:r,disabled:a}=this.props;(0,S.ZP)({event:e,context:S.Af.EditorClick,callback:()=>{if(i||a){const i=b.DJ(e),r=t.id===o.id?T.default.state.resultsStore:void 0,a=t.id===o.id?T.default.state.collectionContextStore:void 0;f.peekBlock({environment:this.environment,store:n,peekMode:this.peekModeStore.state,openInNew:i,resultsStore:r,collectionContextStore:a}),h.trackRelationNavigateBlock(this.environment,{from:"relation_section",meta_click:Boolean(i)})}else r(e)}})},this.handleContextMenu=e=>{const{device:t}=this.environment;t.isAndroid&&t.isPhone&&e.preventDefault()}}get registries(){return[C.Z]}renderComponent(){const{device:e}=this.environment;return e.isPhone&&"popup"===this.props.rowType?this.renderMobileMenuItem():this.renderDesktopMenuItem()}renderMobileMenuItem(){const{disabled:e,relatedPageStore:t,isSelected:o}=this.props,i=!e&&o;return c.createElement(R.Z,n()({},this.props,{store:t,hidePath:!0,right:i?this.renderMobileRemoveButton():void 0}))}renderDesktopMenuItem(){const{collectionStore:e,property:t,pageStore:o,disabled:i,locked:r,canDrag:s,relatedPageStore:d,focused:p,isSelected:g,rowType:h,targetCollectionStore:f,onActionButtonClick:v,onSecondaryButtonClick:y,onOpenPageButtonClick:b,onMouseEnter:S,onMouseLeave:w}=this.props,{device:C}=this.environment,_=k.BI(e.getSchema(),t),M=(C.isMobile||p)&&!r&&!i,T="section"!==h?(C.isMobile||p)&&!r&&!i:M,I=!r&&!i&&"section"===h&&!C.isMobile&&!(1===this.props.propertyLimit)&&f.canEdit(),P=!C.isMobile&&!r&&p&&!i&&!_&&("inline"===h||"section"===h)&&!l().isUndefined(y),B=!C.isMobile&&p&&!i&&("inline"===h||"section"===h)&&!l().isUndefined(b),R=this.renderInnerRelationMenuRow(s,d,o,h,f,C,T,P&&"section"!==h,B,g,v,y,b),D=this.theme.mediumInvertedTextColor;return c.createElement("div",{style:{display:"flex",alignItems:"center",width:"100%"},onMouseEnter:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,ref:this.outerRef},this.stores.mouseStore.state.mouseEntered&&I&&a()(A.Z,{renderTooltip:()=>a()(m.FormattedMessage,{defaultMessage:"Click <medium>to insert a page below</medium>",id:"database.relationMenuRow.tooltip.floatingAddPageButton.message",description:"Tooltip for adding a page as a relation",values:{medium:e=>a()("span",{style:{color:D}},void 0,e)}}),render:e=>c.createElement(E.Z,n()({hasBackground:!1,icon:u.Z.plus,iconStyle:{width:16,height:16,fill:this.theme.lightIconColor},onClick:this.props.onInsertInline,hoveredStyle:{borderRadius:3},style:{marginLeft:s?-44:-22,position:"absolute",marginRight:4}},e))}),"section"===h&&this.stores.mouseStore.state.mouseEntered&&s&&a()(A.Z,{renderTooltip:()=>a()(m.FormattedMessage,{defaultMessage:"Drag <medium>to move</medium>",id:"database.relationMenuRow..dragPrompt.text",description:"Tooltip for dragging a relation in a section",values:{medium:e=>a()("span",{style:{color:D}},void 0,e)}}),render:e=>c.createElement(E.Z,n()({hasBackground:!1,icon:u.Z.dragHandle,iconStyle:{width:14,height:14,fill:this.theme.lightIconColor},hoveredStyle:{borderRadius:3},style:{cursor:"grab",width:Z.C$+4,marginLeft:-(Z.C$+4),height:24,borderRadius:3}},e))}),"section"===h?a()("div",{style:this.getCellStyle(p),onContextMenu:this.handleContextMenu,onMouseEnter:S,onMouseLeave:w,onClick:this.handleRelationSectionRelationMenuRowClick,role:"button","aria-label":"Editable title","aria-disabled":this.props.disabled,tabIndex:this.props.disabled?-1:0},void 0,R):a()(x.Z,{style:this.getCellStyle(),onContextMenu:this.handleContextMenu,onMouseEnter:S,onMouseLeave:w,onClick:this.handleButtonClick,ignoreLocalHoverState:!0,hovered:p},void 0,R))}renderMobileRemoveButton(){return a()(x.Z,{mobileFeedback:!0,onClick:this.props.onActionButtonClick,style:{padding:12,marginRight:-12}},void 0,u.Z.close({width:20,height:20}))}getCellStyle(e){const{rowType:t}=this.props;return{...g.Z.textOverflowStyle,display:"flex",alignItems:"center",position:"relative",borderRadius:3,width:"100%",height:k.Mu,paddingTop:2,paddingRight:4,paddingBottom:2,paddingLeft:0,fontSize:v.Kt,margin:"popup"===t?"0px 4px":0,cursor:"pointer",background:e?this.theme.buttonHoveredBackground:void 0}}getRelationButtonWrapperStyle(e,t){return{position:"absolute",right:t?e?36:6:6,top:4,display:"inline-flex",flexShrink:0,borderRadius:4,overflow:"hidden",padding:2,gap:1,background:this.theme.popoverBackground,boxShadow:this.theme.lightBoxShadow}}}function V(e){window.__c={n:"RelationButton"};const{isOpenPage:t,onClick:o,style:i,icon:r,tooltipMessage:s}=e;return a()(A.Z,{renderTooltip:()=>s,render:e=>c.createElement(E.Z,n()({hasBackground:!1,icon:r,onClick:o,caption:t&&w.default.formatMessage(F.openAsPageTitle),hoveredStyle:{borderRadius:3},style:{height:20,width:20,flex:"0 0 auto",...i}},e))})}L.displayName="RelationMenuRow";const N=L},75203:(e,t,o)=>{o.d(t,{Z:()=>A});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(39068),u=o(3779),m=o(82990),g=o(5366),h=o(50906),f=o(31869),v=o(96802),y=o(30149),b=o(60709),S=o(29376),w=o(25464),k=o(29798),C=o(73657),_=o(52275),M=o(31945),T=o(79131),I=o(73063),P=o(78140),x=o(9342),B=o(44532),Z=o(72495),E=o(58032);class R extends d.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:k.Z},this.renderRelationPropertyMenuPopup=e=>{const t=this.allRelatedTargetProperties.state;if(!t)return;const o=t.filter((e=>e.visible)),i=t.filter((e=>!e.visible));return a()(P.Z,{menuType:b.og.Popup,maxWidth:240,maxHeight:500},void 0,0===t.length&&a()(Z.Z,{},void 0,a()(C.Z,{caption:a()(g.FormattedMessage,{defaultMessage:"No properties",id:"database.relationMenu.noProperties",description:"Section title that shows when there are no properties on the related database except for the title property"})})),t.length>0&&a()(x.Z,{type:x.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:l().compact([o.length>0&&{key:"visible_and_hidden_properties",render:e=>c.createElement(Z.Z,n()({},e,{noTextOverflow:!0,isTitleUppercase:!1,title:a()(g.FormattedMessage,{defaultMessage:"Shown in relation",id:"database.relationMenu.shownInRelationTitle",description:"Section title that shows when there are visible properties on the related database that can be hidden"}),desktopTitleStyle:{height:18}}),this.renderPropertyDraggableList({visibleProperties:o,hiddenProperties:i,children:e.children})),items:l().compact([...this.renderPropertySortListItems({properties:o,visibility:!0}),i.length>0&&{key:"group-header-hidden-property",render:e=>this.renderHiddenPropertySectionHeader({props:e,children:c.createElement(c.Fragment,null)}),action:()=>{}},...this.renderPropertySortListItems({properties:i,visibility:!1})])},0===o.length&&i.length>0&&{key:"hidden_properties",render:e=>this.renderHiddenPropertySectionHeader({props:e,children:this.renderPropertyDraggableList({visibleProperties:o,hiddenProperties:i,children:e.children})}),items:this.renderPropertySortListItems({properties:i,visibility:!1})}])}))},this.handlePropertyReorder=e=>{const{newPropertyKeys:t}=e,{collectionStore:o,property:i}=this.props,n=S.U1({collectionStore:o,property:i}),r=t.indexOf("group-header-hidden-property"),a=l().compact(t.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const o=n.find((t=>t.property===e));return o?r>0?"title"===e&&t>=r?o:{...o,visible:Boolean(t<r)}:o:{property:e,visible:!(r>0)||Boolean(t<r)}}))),s=n.filter((e=>!t.includes(e.property))),c={...S.ZI(o)};c[i]||(c[i]={}),c[i].related_properties=[...a,...s],y.createAndCommit({userAction:"RelationPropertyCustomizeLayoutMenu.handlePropertyReorder",environment:this.environment,perform:e=>{v.FH({stores:[o],update:{collection_relation_options:c},transaction:e})}}),this.stores.menuListStore.reset()},this.allRelatedTargetProperties=this.createComputedStore((()=>{const{collectionStore:e,targetCollectionStore:t,property:o}=this.props,i=S.U1({collectionStore:e,property:o}),n=Object.keys(t.getSchema()).map((e=>i.find((t=>t.property===e))??{property:e,visible:!1})),r=i.map((e=>e.property)),a=e=>{const t=r.indexOf(e);return-1!==t?t:1/0};return n.sort(((e,t)=>a(e.property)-a(t.property))),n}),!0)}renderComponent(){const{device:e}=this.environment;if(!e.isPhone||"section"===this.props.rowType)return a()(E.Z,{renderTooltip:()=>a()(g.FormattedMessage,{id:"database.RelationCustomizeLayoutMenu.tooltip.button.message",defaultMessage:"Customize shown properties",description:"Tooltip for opening the menu that can be used to customize what properties are shown"}),placement:"section"===this.props.rowType?w.u.Top:w.u.Right,render:e=>c.createElement(M.Z,n()({popupType:B.kQ.Popup,alignmentToOrigin:w.v.Start},e,{renderOrigin:t=>c.createElement(I.Z,n()({icon:u.Z.dots,iconStyle:{width:16,color:this.theme.mediumIconColor,fill:this.theme.mediumIconColor}},t,e)),onClick:()=>{h.trackRelationCustomizeDisplayedProperties(this.environment,{from:"section"===this.props.rowType?"relation_section":"configure_relation_modal"})},originGap:16,render:this.renderRelationPropertyMenuPopup}))})}renderPropertySortListItems(e){const{properties:t,visibility:o}=e;return l().compact(t.map((e=>this.renderPropertySortListItem({propertyFormat:e,visibility:o}))))}renderPropertyDraggableList(e){const{visibleProperties:t,hiddenProperties:o,children:i}=e,n=l().compact([...t.map((e=>e.property)),t.length>0&&o.length>0&&{key:"group-header-hidden-property",draggable:!1},...o.map((e=>e.property))]);return a()(T.ZP,{direction:"vertical",keys:n,renderKey:(e,t)=>i[t],onDrop:e=>{this.handlePropertyReorder({newPropertyKeys:e})},disabled:this.props.disabled})}renderPropertySortListItem(e){const{propertyFormat:t,visibility:o}=e,i=!o,{collectionStore:r,targetCollectionStore:s,property:l,disabled:d}=this.props,g=this.environment,h=s.getSchema();if(!h)return;const v=h[t.property];if(!v)return;const{theme:y}=this;return{key:t.property,render:e=>c.createElement(_.Z,n()({},e,{showDragHandle:!d,title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(p.ZP,{icon:v.icon,type:v.type,size:16,theme:y,style:{fill:y.regularIconColor}}),a()("span",{style:{marginLeft:8,...m.Z.textOverflowStyle}},void 0,v.name)),right:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(I.Z,{icon:i?u.Z.eyeHide:u.Z.eye,iconStyle:{width:16,height:16},isDarkIconColor:!i,onClick:()=>{f.qK({propertyFormat:t,visibility:o,collectionStore:r,property:l,environment:g})},disabled:d||"title"===t.property}))})),action:()=>{}}}renderHiddenPropertySectionHeader(e){const{props:t,children:o}=e;return c.createElement(Z.Z,n()({},t,{noTextOverflow:!0,isTitleUppercase:!1,title:a()(g.FormattedMessage,{defaultMessage:"Hidden in relation",id:"database.relationMenu.hiddenInRelationTitle",description:"Section title that shows when there are hidden properties on the related database that can be made visible"}),desktopTitleStyle:{height:19},children:o,disableDesktopPadding:!0}))}}R.displayName="RelationPropertyCustomizeLayoutMenu";const A=R},58613:(e,t,o)=>{o.d(t,{Z:()=>le,Q:()=>ae});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(1302),d=o(480),p=o(81954),u=o(24405),m=o(99036),g=o(80951),h=o(22433),f=o(1800),v=o(42875),y=o(3779),b=o(4615),S=o(74446),w=o(21202),k=o(5500),C=o(82990),_=o(5366),M=o(50906),T=o(5978),I=o(31299),P=o(66890),x=o(75079),B=o(33929),Z=o(60709),E=o(70219),R=o(86355),A=o(33665),D=o(472),F=o(79315),L=o(10161),V=o(30874),N=o(3815),O=o(49085);class U extends O.Z{getInitialState(){return{searchQuery:"",searchLimit:U.limitIncrement,searchPopupOpen:!1}}}U.limitIncrement=20,U.incrementScrollOffset=200;const H=U;var z=o(72087),W=o(52275),j=o(36488),K=o(74194),Y=o(68894),G=o(84076),X=o(78140),q=o(44532),$=o(31278),J=o(76798),Q=o(77137),ee=o(72495),te=o(46247),oe=o(9897),ie=o(71165);const ne=(0,_.defineMessages)({inputPlaceholder:{defaultMessage:"Link or create a page…",id:"relationPropertyMenu2.searchPlaceholder",description:"Placeholder when searching for a page to relate to for this relation value."},searchLinkedInputPlaceholder:{defaultMessage:"Search linked pages…",id:"relationPropertyMenu2.viewExisting.searchPlaceholder",description:"Placeholder when searching existing related pages."},syncedCollectionInputPlaceholder:{defaultMessage:"Link a page",id:"relationPropertyMenu2.syncedCollection.searchPlaceholder",description:"Placeholder when searching for a page to relate to for this relation value."},connectedRelationInputPlaceholder:{defaultMessage:"Find a page",id:"relationPropertyMenu2.connectedRelation.searchPlaceholder",description:"Placeholder when searching for a page to relate to for this relation value."},connectedRelationGithubInputPlaceholder:{defaultMessage:"Paste in https://github.com/...",id:"relationPropertyMenu2.connectedRelationGithub.searchPlaceholder",description:"Placeholder when searching for a page to relate to for this Github relation value."}});class re extends l.Z{constructor(){super(...arguments),this.storeTypes={store:H,requestStore:z.Z},this.maybeOverwriteBaseUrlFromSpaceId=(0,E.b)(this.environment),this.handleSearchInputChange=e=>{const t=e.target.value;this.stores.store.setState({searchQuery:t,searchPopupOpen:!!t,searchLimit:H.limitIncrement})},this.handleMobileTargetCollectionClick=()=>{const e=this.getRenderState();e&&(T.navigate({environment:this.environment,url:e.targetParentUrl}),M.trackRelationDatabaseClick(this.environment,{from:this.props.analyticsFrom}))},this.handleMobileSearchInputClick=()=>{const e=this.stores.store.state;this.stores.store.setState({searchQuery:e.searchQuery,searchPopupOpen:!0,searchLimit:H.limitIncrement})},this.handleSelectedPageClick=(e,t)=>{const{mainEditorCurrentBlockStore:o}=F.default.state;if(!o)return;let i;if(t){const t=N.G.createChildStore(o,e.pointer),n=t.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(t.getSpaceId()):void 0;i=(0,f.Z)({pageId:e.pointer.id,pageModel:t.getModel(),baseUrl:n})}else{const t=o.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(o.getSpaceId()):void 0;i=(0,f.Z)({pageId:o.id,pageModel:o.getModel(),baseUrl:t,peekViewBlockId:e.pointer.id})}T.navigate({environment:this.environment,url:i,openInNew:t}),M.trackRelationNavigateBlock(this.environment,{from:this.props.analyticsFrom,meta_click:Boolean(t)})},this.handleValueRelationPropertyMenuResultsAccept=(e,t)=>{e.type===R.R.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleSearchRelationPropertyMenuResultsAccept=(e,t)=>{var o;if(this.props.disabled)return;const{value:i,onChange:n,overlayMode:r}=this.props,{mainEditorCurrentBlockStore:a}=F.default.state;if(!a)return;const s=null===(o=this.getRenderState())||void 0===o?void 0:o.propertySchema.limit;if(e.type===R.R.SearchPage){var l,c,d,p,u,m,g;n({value:s?[e.pointer]:"add"===(null==r?void 0:r.type)?[...i.slice(0,r.index),e.pointer,...i.slice(r.index)]:[...i,e.pointer]}),M.trackRelationAddBlock(this.environment,{from:this.props.analyticsFrom,collection_id:null===(l=this.props.collectionStore)||void 0===l?void 0:l.id,collection_view_id:null===(c=this.context.collectionContextStore)||void 0===c||null===(d=c.collectionViewStore())||void 0===d?void 0:d.id,collection_view_block_id:null===(p=this.context.collectionContextStore)||void 0===p||null===(u=p.collectionViewBlockStore())||void 0===u?void 0:u.id,target_collection_id:null===(m=this.getRenderState())||void 0===m||null===(g=m.targetCollectionStore)||void 0===g?void 0:g.id})}else e.type===R.R.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleCreateNewPage=e=>{var t,o,i,n;const{searchQuery:r}=this.stores.store.state,a=(0,b.ZP)(),s=null===(t=this.getRenderState())||void 0===t?void 0:t.targetCollectionStore.getSpaceId(),{value:l,onChange:c}=this.props,d=null===(o=this.getRenderState())||void 0===o?void 0:o.propertySchema.limit,p={id:a,table:w.iU,spaceId:s};c({newPage:{id:a,spaceId:s,name:r},value:d?[p]:e?[...l.slice(0,e),p,...l.slice(e)]:[...l,p]}),M.trackRelationCreateBlock(this.environment,{...(0,x.Pn)(this.context.collectionContextStore),from:this.props.analyticsFrom,target_collection_id:null===(i=this.getRenderState())||void 0===i||null===(n=i.targetCollectionStore)||void 0===n?void 0:n.id})},this.handleClickActionButton=e=>{var t;const{value:o,onChange:i,overlayMode:n}=this.props,{mainEditorCurrentBlockStore:r}=F.default.state;if(!r)return;const a=null===(t=this.getRenderState())||void 0===t?void 0:t.propertySchema.limit;if(e.type===R.R.SearchPage){var s,l;i({value:a?[e.pointer]:"add"===(null==n?void 0:n.type)?[...o.slice(0,n.index),e.pointer,...o.slice(n.index)]:[...o,e.pointer]}),M.trackRelationAddBlock(this.environment,{from:this.props.analyticsFrom,...(0,x.Pn)(this.context.collectionContextStore),target_collection_id:null===(s=this.getRenderState())||void 0===s||null===(l=s.targetCollectionStore)||void 0===l?void 0:l.id})}else if(e.type===R.R.SelectedPage){var c,d;i({value:a?[]:o.filter((t=>t.id!==e.pointer.id))}),M.trackRelationRemoveBlock(this.environment,{...(0,x.Pn)(this.context.collectionContextStore),from:this.props.analyticsFrom,target_collection_id:null===(c=this.getRenderState())||void 0===c||null===(d=c.targetCollectionStore)||void 0===d?void 0:d.id})}},this.handleRelationPropertyMenuResultsDrag=e=>{const{collectionStore:t,onChange:o}=this.props;o({value:e.map((e=>({id:e,spaceId:t.pointer.spaceId,table:w.iU})))}),M.trackRelationReorder(this.environment,{from:this.props.analyticsFrom})},this.handleMobileSearchMenuClickRight=()=>{this.resetInputState()},this.handleSearchScrollOffsetChange=e=>{const{store:t,requestStore:o}=this.stores,{loading:i,result:n}=o.state;e<H.incrementScrollOffset&&n&&!i&&n.results.length>=t.state.searchLimit&&t.setState({...t.state,searchLimit:t.state.searchLimit+H.limitIncrement})},this.performSearchRequest=async e=>{const{value:t,disabled:o,overlayMode:i}=this.props,n={results:[],query:e.query},r=this.getRenderState();if(!r)return n;if(o)return n;if("view"===(null==i?void 0:i.type))return n;const{targetCollectionStore:a}=r,s=[];try{const{results:o}=await I.df({environment:this.environment,query:e.query,collectionId:a.id,limit:e.limit,spaceId:a.getSpaceId(),excludeTemplates:!0,source:"relation_menu",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!0,ignoresHighlight:!0});o.forEach((e=>{if(t.map((e=>e.id)).includes(e)){const t={key:e,type:R.R.SelectedPage,pointer:{spaceId:a.getSpaceId(),id:e,table:w.iU}};s.push(t)}else{const t={key:e,type:R.R.SearchPage,pointer:{spaceId:a.getSpaceId(),id:e,table:w.iU}};s.push(t)}}))}catch(l){}return{results:s,query:e.query}},this.getRecordValue=S.mF.fromMonomorphicFunctionUnsafe((e=>{const t=N.G.createChildStore(this.props.blockStore,e);return t.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:o}=e;return o(t)}))}))}didMount(){super.didMount(),c.default.afterNextFlush((()=>{c.default.afterNextFlush((()=>{const e=this.getRenderState();if(e){0===this.getValueResults(e).length&&this.stores.store.setState({searchPopupOpen:this.environment.device.isMobile,searchQuery:this.props.insertChar??"",searchLimit:H.limitIncrement})}}))}))}renderComponent(){const{device:e}=this.environment,t=this.getRenderState();if(t)return a()(j.Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowUndo:!0,allowTabUntab:!0,render:()=>e.isMobile?this.renderMobileMenu(t):this.renderDesktopMenu(t)})}renderDesktopMenu(e){const{searchQuery:t}=this.stores.store.state,o=this.stores.requestStore.state.result,{blockStore:i,disabled:n,analyticsFrom:r,overlayMode:s}=this.props,{targetCollectionStore:l}=e,c=Boolean(V.Z.bots.state.find((e=>e.integration_id===k.U9))),d=L.default.checkGate("github_link_pasting"),p=g.Kp(e.propertySchema)&&(!d||!c),u=s&&"add"===s.type?s.index:void 0;return a()(X.Z,{menuType:Z.og.Popup,header:p?null:a()(se,{store:this.stores.store,disabled:n,renderState:e,blockStore:i,analyticsFrom:r,isConnectedRelation:Boolean(e.propertySchema.connectedRelation),overlayMode:s}),footer:this.renderFooter({requestStateResult:o,searchQuery:t,overlayMode:s,disabled:n,targetCollectionStore:l,index:u,propertySchema:e.propertySchema})},void 0,a()("div",{style:{overflow:"hidden",maxHeight:"70vh"}},void 0,this.renderSearchResults(e)))}renderFooter(e){const{requestStateResult:t,searchQuery:o,overlayMode:i,disabled:n,targetCollectionStore:r,index:s,propertySchema:l}=e;return"view"===(null==i?void 0:i.type)||n||l.connectedRelation?null:t&&t.results.length>0&&o&&a()(oe.Z,{targetCollectionStore:r,title:o,onClick:this.handleCreateNewPage,focused:!1,isSection:!0,index:s})}renderMobileMenu(e){const{device:t}=this.environment,{searchPopupOpen:o}=this.stores.store.state,{collectionStore:i,property:n,schema:r,blockStore:s,blockPropertyValueOverlayStore:l,disabled:c,canConfigureCollection:d,onDismiss:p}=this.props,{showProperties:u,targetCollectionStore:h}=e,{mediumTextColor:f}=this.theme,v=this.getValueResults(e),b=r[n],S=b&&m.NK(b),w=Boolean(V.Z.bots.state.find((e=>e.integration_id===k.U9))),C=L.default.checkGate("github_link_pasting"),M=g.Kp(e.propertySchema)&&(!C||!w);return a()(X.Z,{menuType:Z.og.Modal,title:e.propertySchema.name,right:a()(_.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileMenuDone.button"}),onClickRight:p},void 0,S?null:a()(ee.Z,{disableMobilePadding:!0},void 0,a()(W.Z,{focused:!1,title:a()("div",{style:{display:"flex"}},void 0,a()(_.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",description:"Title for menu that enables users to search in a database. The word 'in' appears as regular text, and the database appears as clickable page link. This message indicates what database is being searched, for example: 'In [🎒Tasks]'",values:{regular:e=>e,databaseWithIcon:a()("div",{style:{display:"flex",marginLeft:2*ae}},void 0,a()($.Z,{disabled:!0,icon:h.getIcon(),isEmptyPage:!1,size:20}),a()(J.Z,{store:h,underline:!0,style:{marginLeft:ae}}))}})),showExtensionArrow:!1,onClick:this.handleMobileTargetCollectionClick})),M?null:a()(ee.Z,{topBorder:!0,disableMobilePadding:!1},void 0,a()(q.GI,{popupType:q.kQ.SlideUp,open:o,origin:a()(W.Z,{focused:!1,title:a()("span",{style:{display:"flex",alignItems:"center"}},void 0,y.Z.plus({marginRight:8,width:t.isMobile?16:14,height:t.isMobile?16:14}),a()(_.FormattedMessage,{defaultMessage:"Add a page",id:"relationPropertyMenu.addAPage.button"})),onClick:this.handleMobileSearchInputClick,style:{color:f}}),render:()=>this.renderSearchResults(e)})),a()(ie.Z,{collectionStore:i,targetCollectionStore:h,showProperties:u,results:v,resultsType:"existing",property:n,schema:r,parentStore:s,disabled:c,canConfigureCollection:d,loading:!1,canDrag:!1,blockPropertyValueOverlayStore:l,onAccept:this.handleValueRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onCreatePage:this.handleCreateNewPage,relationPropertyMenuStore:this.stores.store}))}renderSearchResults(e){const{device:t}=this.environment,{collectionStore:o,value:i,property:r,schema:l,blockStore:c,blockPropertyValueOverlayStore:d,disabled:p,canConfigureCollection:u,overlayMode:f}=this.props,{requestStore:y}=this.stores,{showProperties:b,targetCollectionStore:S,propertySchema:w}=e,{searchQuery:k,searchLimit:C}=this.stores.store.state;let M=D.default.createMetric("rum.relation_search_query");const T=w.limit?i.slice(0,1):i,P={request:{query:k,limit:C},debounce:I.vp,performRequest:this.performSearchRequest,render:(i,n)=>{let y=[];y=k?this.getValueResults(e).filter((e=>{const t=N.G.createChildStore(this.props.blockStore,e.pointer),o=t.getModel();if(o)return(0,h.fY)({block:o,query:k,getRecordValue:t.getRecordValue,userTimeZone:(0,v.r)(),schema:l,intl:B.default.getIntl(),onlyPropertyIds:["title"]})})):this.getValueResults(e);const C=!n&&0===y.length,I=y;n&&n.results.forEach((e=>{if((e.type===R.R.SelectedPage||e.type===R.R.SearchPage)&&y.find((t=>t.pointer.id===e.pointer.id)))return;const t=e.type!==R.R.NewPage?T.map((e=>e.id)).includes(e.pointer.id):void 0;t&&!k&&"add"===(null==f?void 0:f.type)||(e.type===R.R.SearchPage&&t?I.push({type:R.R.SelectedPage,key:e.key,pointer:e.pointer}):e.type!==R.R.SelectedPage||t?I.push(e):I.push({type:R.R.SearchPage,key:e.key,pointer:e.pointer}))})),!C&&""!==k&&M&&n&&n.query===k&&(D.default.emit(this.environment,M,void 0),M=void 0);const P=a()(ie.Z,{collectionStore:o,targetCollectionStore:S,showProperties:b,results:I,resultsType:0===I.length&&0===this.getValueResults(e).length?"existing":"search",property:r,schema:l,parentStore:c,disabled:p,canConfigureCollection:u,loading:C,canDrag:!p&&0===k.length,blockPropertyValueOverlayStore:d,onAccept:this.handleSearchRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onScrollOffsetChange:this.handleSearchScrollOffsetChange,onDrag:this.handleRelationPropertyMenuResultsDrag,onCreatePage:this.handleCreateNewPage,searchQuery:k,overlayMode:f,relationPropertyMenuStore:this.stores.store});if(t.isMobile){let e=B.default.formatMessage(ne.inputPlaceholder);const o=m.NK(w);return o&&(e=B.default.formatMessage(ne.connectedRelationInputPlaceholder)),g.Kp(w)&&(e=B.default.formatMessage(ne.connectedRelationGithubInputPlaceholder)),a()(X.Z,{menuType:Z.og.Modal,title:a()(_.FormattedMessage,{defaultMessage:"Relation",id:"relationPropertyMenu.mobileRelationMenu.title"}),left:this.renderMobileHelpButton(),right:a()(_.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileDoneButton"}),header:s.createElement(s.Fragment,null,a()(Y.ZP,{value:k,disabled:p,onChange:this.handleSearchInputChange,placeholder:e,showClearButton:!0,focus:!t.isMobile||void 0,focusInitial:!0,style:{...t.isAndroid&&{borderBottom:"none"}}}),k&&!p&&!o&&a()(oe.Z,{targetCollectionStore:S,title:k,onClick:this.handleCreateNewPage,focused:!1,isSection:!0})),onClickRight:this.handleMobileSearchMenuClickRight},void 0,P)}return P}};return s.createElement(Q.Z,n()({},P,{requestStore:y}))}renderMobileHelpButton(){return a()(te.Z,{href:(0,A.UY)("guides.relations"),analyticsFrom:"relation_menu"})}getRenderState(){const{schema:e,property:t,blockStore:o}=this.props,i=e[t];if(!i||"relation"!==i.type)return;const n=m.j0(i);if(!n)return;const r=N.NW.createChildStore(o,n),a=r.getParentId();if(!a)return;const s=N.G.createChildStore(r,{table:w.iU,id:a}),l=m.oC({schema:r.getSchema(),format:r.getFormat(),space_id:r.getSpaceId()}),c=[l[`${g.UU}title`]?`${g.UU}title`:"title"],d=s.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(s.getSpaceId()):void 0,p=(0,f.Z)({pageId:s.id,pageModel:s.getModel(),baseUrl:d});return{propertySchema:i,targetCollectionStore:r,targetParentBlock:s,showProperties:c,targetCollectionSchema:l,targetParentUrl:p}}resetInputState(){this.stores.store.reset()}getValueResults(e){const{value:t,overlayMode:o}=this.props,{propertySchema:i}=e,{searchQuery:n}=this.stores.store.state;return n||"add"!==(null==o?void 0:o.type)?g.j$({relationValue:t,propertySchema:i,getRecordValue:this.getRecordValue}).map((e=>({key:e.id,type:R.R.SelectedPage,pointer:e}))):[]}}re.displayName="RelationPropertyMenu",re.contextTypes={...l.w,...P.xm},re.width=400,re.titleColumnWidth=300,re.columnWidth=150,re.rowHeight=32;const ae=4;function se(e){var t;window.__c={n:"RelationPropertyMenuInput"};const o=(0,d.O7)(),i=(0,d.Fy)(),{targetParentUrl:n,targetCollectionStore:r,propertySchema:s}=e.renderState,[l,c,m]=(0,p.AF)(e.store),{searchQuery:h,searchPopupOpen:f}=l,v=(0,p.VK)((()=>r.getIcon()),[r]),y=(0,p.VK)((()=>r.isSyncedCollection()),[r]),b=(0,p.VK)((()=>{const e=g.Kp(s);return L.default.checkGate("github_link_pasting")&&e}),[s]),S=(0,u.yK)((e=>({regular:{color:e.mediumTextColor,whiteSpace:"nowrap",marginLeft:4},headerWrap:{display:"flex",width:"100%",position:"relative",zIndex:2,padding:"6px 10px",fontSize:14,background:e.inputBackground,boxShadow:`\n\t\t\t\t\t0 1px 0 ${e.darkDividerColor}\n\t\t\t\t`},recordTitle:{fontWeight:C.Z.fontWeight.semibold,fontSize:14,marginLeft:ae*(i.isRetina?.5:1)},searchIcon:{fill:e.mediumIconColor,width:14,height:14,marginRight:10}})),[i.isRetina]);let w=ne.inputPlaceholder;y?w=ne.syncedCollectionInputPlaceholder:b?w=ne.connectedRelationGithubInputPlaceholder:e.isConnectedRelation?w=ne.connectedRelationInputPlaceholder:("view"===(null===(t=e.overlayMode)||void 0===t?void 0:t.type)||e.disabled)&&(w=ne.searchLinkedInputPlaceholder);const k=B.default.formatMessage(w);return a()("div",{style:S.headerWrap},void 0,a()(K.Z,{style:{flexGrow:1},value:h,placeholder:k,forceShowClearButton:Boolean(h||f),focus:!0,onChange:e=>{const t=e.target.value;c({searchQuery:t,searchPopupOpen:!!t,searchLimit:H.limitIncrement})},onClearButtonClick:()=>{c(m.getInitialState())},onClick:()=>{c({searchQuery:l.searchQuery,searchPopupOpen:!0,searchLimit:H.limitIncrement})},onKeyDown:e=>{"Escape"===e.key&&c(m.getInitialState())},format:K.B.Transparent}),a()("div",{style:{display:"flex",marginLeft:10,alignItems:"center"}},void 0,!e.isConnectedRelation&&a()(_.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",description:"Title for menu that enables users to search in a database. The word 'in' appears as regular text, and the database appears as clickable page link. This message indicates what database is being searched, for example: 'In [🎒Tasks]'",values:{regular:e=>a()("span",{style:S.regular},void 0,e),databaseWithIcon:a()(G.Z,{href:n,style:{marginLeft:ae},innerStyle:{display:"flex"},onClick:()=>{M.trackRelationDatabaseClick(o,{from:e.analyticsFrom})}},void 0,a()($.Z,{disabled:!0,icon:v,isEmptyPage:!1,size:20}),a()(J.Z,{store:r,underline:!0,style:S.recordTitle}))}})))}const le=re},71165:(e,t,o)=>{o.d(t,{Z:()=>Ne,w:()=>De});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(81954),u=o(99036),m=o(5366),g=o(60971),h=o(73744),f=o(86355),v=o(34859),y=o(45452),b=o(29798),S=o(3815),w=o(17126),k=o(480),C=o(24405),_=o(80951),M=o(8848),T=o(42875),I=o(59054),P=o(20270),x=o(3779),B=o(61784),Z=o(89837),E=o(16953),R=o(59753),A=o(4615),D=o(21202),F=o(5500),L=o(44805),V=o(44876),N=o(63143),O=o(50906),U=o(54642),H=o(43132),z=o(77162),W=o(47307),j=o(77719),K=o(9953),Y=o(30149),G=o(761),X=o(95477),q=o(70764),$=o(75079),J=o(6398),Q=o(12534),ee=o(98742),te=o(65598),oe=o(79315),ie=o(10161),ne=o(30874),re=o(1634),ae=o(52275),se=o(71669),le=o(68785),ce=o(9342),de=o(72495),pe=o(58032),ue=o(90559),me=o(67219),ge=o(97880),he=o(74882),fe=o(16956),ve=o(5978),ye=o(66890),be=o(33665),Se=o(49122),we=o(64921),ke=o(61519),Ce=o(32662);const _e=(0,m.defineMessages)({githubCopyIdAria:{defaultMessage:"Copy the ID value.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.copyIdAria"},githubAddIdAria:{defaultMessage:"Add a unique id property to the database.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.addIdAria"},githubLearnMoreAria:{defaultMessage:"Learn more about the GitHub Pull Requests feature.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.learnMoreAria"}});function Me(e){const{pageBlockStore:t,blockPropertyValueOverlayStore:o}=e,i=(0,k.O7)(),n=(0,m.useIntl)(),r=Te(),s=(0,p.VK)((()=>ie.default.checkGate("github_link_pasting")),[]),l=(0,ye.Y$)(),d=(0,p.VK)((()=>l.collectionStore()),[l]),u=(0,p.VK)((()=>l.databaseType),[l]),g=(0,p.VK)((()=>{var e;return d&&(null===(e=d.getRecordKeyStore())||void 0===e?void 0:e.getRecordKey())}),[d]),h=(0,p.VK)((()=>{const e=t.getSchema(),o=(0,ge.qP)(e).find((e=>{let[t,o]=e;return"auto_increment_id"===(null==o?void 0:o.type)}));if(!o)return;const[i]=o,n=t.getPropertyValue(i);return(0,_.ah)(n)}),[t]),f=(0,p.VK)((()=>(0,ue.wf)(g,h)),[g,h]),v=(0,p.VK)((()=>!Boolean(g)||!Boolean(h)),[g,h]);function y(){const e=Te();return c.createElement(c.Fragment,null,a()("p",{style:e.githubResultsCopyWrapper},void 0,a()(m.FormattedMessage,{defaultMessage:"To link, paste the GitHub PR URL above",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducationPasteUrl.description",description:"Prompt the user to link a PR to the task via paste url."})),a()("div",{style:e.githubLinkPastingContainer},void 0,a()(ke.Z,{size:1,style:e.githubLinkPastingSeparator}),a()("div",{style:e.githubLinkPastingSeparatorText},void 0,"or")),a()(Ce.Z,{size:8}))}return c.createElement(c.Fragment,null,a()("div",{style:r.githubResults},void 0,s?a()(y,{}):null,a()("p",{style:r.githubResultsCopyWrapper},void 0,a()(m.FormattedMessage,v?{defaultMessage:"Create a prefixed ID property to paste in the GitHub PR title.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.badIdError",description:"Prompt the user to create a unique ID property if they are missing one."}:{defaultMessage:"Copy the {singleItemName} ID and paste it into the title of your PR in GitHub.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducationLinkPastingOn.description",description:"Prompt the user to link a PR to the task via ID below link pasting prompt. singleItemName describes the type of page like [page, task, project].",values:{singleItemName:(0,me.hf)(u).defaultMessage}})),a()(Se.Z,{width:"100%",uniqueIdPrefix:g,uniqueIdValue:h})),a()("div",{style:r.githubResultsButtonsWrapper},void 0,a()(we.Z,{style:r.githubResultsLearnMore,ariaLabel:n.formatMessage(_e.githubLearnMoreAria),onClick:e=>{e.preventDefault(),ve.navigateToExternalURL({environment:i,url:(0,be.UY)("guides.githubRelation"),targetSelf:!1})}},void 0,x.Z.help({width:i.device.isMobile?16:12}),a()(Ce.Z,{size:4}),a()(m.FormattedMessage,{defaultMessage:"Learn more",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.learnMore",description:"Button to the help center article"})),v?a()(we.Z,{style:r.githubResultsCTAButton,ariaLabel:n.formatMessage(_e.githubAddIdAria),onClick:async e=>{e.preventDefault(),d&&(await he.K({environment:i,collectionStore:d}),Y.createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:i,perform:e=>{fe.G3({environment:i,collectionStore:d,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:e})}}),z._H({environment:i,collectionContextStore:l,from:"github_relation_menu",property_type:"auto_increment_id",integration_id:F.U9}))}},void 0,x.Z.plus({width:i.device.isMobile?16:12}),a()(Ce.Z,{size:4}),a()(m.FormattedMessage,{defaultMessage:"Add ID property",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.addId",description:"Button to add a unique ID to the database"})):a()(we.Z,{style:r.githubResultsCTAButton,ariaLabel:n.formatMessage(_e.githubCopyIdAria),onClick:e=>{e.preventDefault(),H.RD({stringValue:f,environment:i,copiedMessage:H.tq.copiedPropertyToClipboard}),o.setState({isOpen:!1})}},void 0,x.Z.copy({width:i.device.isMobile?16:12}),a()(Ce.Z,{size:4}),a()(m.FormattedMessage,{defaultMessage:"Copy {singleItemName} ID",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.copyId",description:"Button to copy the unique ID of the database row. singleItemName describes the type of page like [page, task, project].",values:{singleItemName:(0,me.hf)(u).defaultMessage}}))))}function Te(){const e=(0,k.Fy)().isMobile;return(0,C.yK)((t=>({githubResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4},githubResultsCopyWrapper:{marginTop:0,color:t.lightTextColor},githubResultsErrorWrapper:{marginTop:0,color:M.ZP.red},githubResultsButtonsWrapper:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",fontSize:e?16:12,padding:"10px"},githubResultsLearnMore:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5,color:t.lightTextColor},githubResultsCTAButton:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5,color:t.blueColor},githubLinkPastingSeparator:{border:t.tableDividerColor,width:"100%"},githubLinkPastingContainer:{width:"100%",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",margin:"8px 0px"},githubLinkPastingSeparatorText:{position:"absolute",backgroundColor:t.popoverBackground,color:t.lightTextColor,padding:"0px 8px"}})),[e])}function Ie(e){var t;window.__c={n:"ConnectedRelationPropertyMenuResults"};const{sections:o,collectionStore:i,targetCollectionStore:r,search:s,property:d,propertySchema:u,pageRecordStore:g,blockPropertyValueOverlayStore:h,relationPropertyMenuStore:f}=e,v=(0,C.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"},settingsMenuSearchBox:{background:e.contentBackground,marginBottom:10},addPageButton:{width:"100%",display:"flex",justifyContent:"center"},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:M.ZP.white,background:M.ZP.blue,borderRadius:6,padding:10,boxShadow:e.largeLightBoxShadow,alignSelf:"center",maxWidth:"80%"},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},addingPage:{width:"100%",padding:10,display:"flex",justifyContent:"flex-start",fontSize:14,color:e.mediumTextColor}})),[]),y=null==u?void 0:u.limit,b=_.Kp(u),ue=(0,p.VK)((()=>b&&ie.default.checkGate("github_link_pasting")),[b]),me=(0,p.VK)((()=>{if(!r)return;const e=r.getFormat().integration_id;return ne.Z.integrations.state.find((t=>t.id===e))}),[r]),ge=(0,p.VK)((()=>me?(0,q.NP)(me.id):[]),[me]),he=(0,k.O7)(),fe=(0,m.useIntl)(),ve=(0,C.Fg)(),ye=(0,p.VK)((()=>{const e=ne.Z.state;return e.loaded?e.integrations:[]}),[]),be=(0,p.VK)((()=>{var e;return Boolean(null===(e=oe.default.state.currentSpaceStore)||void 0===e?void 0:e.canAdmin())}),[]),Se=(0,p.VK)((()=>{var e;return!(!(null===(e=oe.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit())||!(0,q.sw)(he))}),[he]),we=(0,p.VK)((()=>{const e=ne.Z.state;return e.loaded&&me?e.externalAuthentications.filter((e=>e.integration_id===me.id)):[]}),[me]),ke=(0,p.VK)((()=>we.length?we[0]:null),[we]),[{value:Ce,status:_e}]=(0,I.r5)((async()=>{if(!ke||!me||"google_calendar"!==(0,F.s9)(me.id))return;const e=ke.parent_id;return U.listExternalObjects(he,{bot_id:e,query:s})}),[he,ke,s,me],{debounce:1e3}),Te=(0,p.VK)((()=>r.getFormat().pattern_name),[r]),Ie=(0,p.VK)((()=>{if(me&&s)return Pe({integration:me,patternName:Te,url:s})}),[Te,me,s]),xe=(0,te.NZ)(g)?g:void 0,Be=(0,te.NZ)(g)?g.getPropertyStore(d):void 0,Ze=(0,p.VK)((()=>Be?_.rq(Be.getValue()):[]),[Be]),Ee=(0,p.VK)((()=>null==r?void 0:r.getIcon()),[r]),Re=(0,p.VK)((()=>{var e;return null===(e=oe.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),[Ae,De]=(0,c.useState)(!1),Fe={key:"githubPrRelationUserEducation",render:e=>void 0!==xe&&a()(Me,{pageBlockStore:xe,blockPropertyValueOverlayStore:h}),items:[]};if(!i||!Be||!me)return a()(ce.Z,{type:ce.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:o});const Le=(null==me?void 0:me.id)===F.U9?null===(t=ge[0])||void 0===t?void 0:t.id:null==ke?void 0:ke.parent_id;if(!Le){const e=function(e){const{collectionIcon:t,integration:o,environment:i,spaceId:r,isAdmin:s,userAllowedToAuth:l}=e,d=o.id===F.U9,p=()=>{r&&(j.h({environment:i,integration:o,spaceId:r,from:"connected_relation_property_menu"}),re.Z.reset())};return{key:"authenticateIntegration",render:e=>c.createElement(de.Z,n()({},e,{disableMobilePadding:!0,title:a()(m.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"connectedRelationPropertyMenuResults.authenticateHeader.title",description:"Header text to prompt user to authenticate an integration (e.g. GitHub)",values:{integration:o.name}})})),items:[!d||s&&l?{key:"authenticateButton",render:e=>c.createElement(ae.Z,n()({},e,{title:a()(m.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"connectedRelationPropertyMenuResults.authenticateButton.title",description:"Button title to authenticate a user with an integration (e.g. GitHub)",values:{integration:o.name}}),icon:a()(se.Z,{src:null==t?void 0:t.icon,style:{width:14}})})),action:()=>p()}:{key:"askAdminToAuthenticateButton",render:e=>c.createElement(ae.Z,n()({},e,{title:a()("div",{style:{whiteSpace:"normal"}},void 0,a()(m.FormattedMessage,{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"connectedRelationPropertyMenuResults.askAdminToAuthenticateButton.title",description:"Prompt for user to ask their admin to configure GitHub"})),icon:a()(se.Z,{src:null==t?void 0:t.icon,style:{width:14}}),hoveredStyle:{cursor:"default",background:void 0},pressedStyle:{background:void 0}})),action:()=>{}}]}}({environment:he,collectionStore:i,integration:me,collectionIcon:Ee,spaceId:Re,isAdmin:be,userAllowedToAuth:Se});return a()(ce.Z,{type:ce.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:[...o,e]})}const Ve=async e=>{De(!0);try{if(!i||!me||!xe)return;const t=e||s||"";if(!Pe({integration:me,patternName:Te,url:t}))return void W.showDialog({items:[{label:a()(m.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information",description:"Button that allows users to copy debugging information that they can share with support"}),color:"blue",onAccept:()=>{H.RD({environment:he,stringValue:JSON.stringify({botId:null==ke?void 0:ke.parent_id,url:t},null,2),copiedMessage:H.tq.copiedToClipboard})}},{label:a()(m.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close",description:"Button that closes the error dialog."}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:a()(m.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source.",description:"Title message in the error dialog box when we failed to sync the source."})});const o=ue?Be.id:void 0,n=ue?ge.map((e=>e.id)):[Le],l=await G.yp({environment:he,url:t,botIds:n,userDefinedExternalCollectionStore:r,relatedPageId:o});if(!l)return;Y.createAndCommit({userAction:"connectedRelationPropertyMenuResults.createRelationPage",environment:he,perform:e=>{const t={id:l.id,table:D.iU,spaceId:l.getSpaceId()},o=y?[t]:[...Ze,t],i=_.ow(o);K.sO({store:Be,value:i,transaction:e}),h&&h.state.isOpen&&h.state.collectionContextStore&&(z.rv({environment:he,collectionContextStore:h.state.collectionContextStore,block_id:xe.id,property:d,property_type:"relation",from:"relation_section",isFromBulkActionsToolbar:!1}),O.trackRelationCreateBlock(he,{...(0,$.Pn)(h.state.collectionContextStore),from:"relation_section",target_collection_id:r.id}))}}),f.reset()}finally{De(!1)}},Ne=("success"===(null==Ce?void 0:Ce.type)&&"data"in Ce.data?Ce.data.data:[]).map((e=>{const t=e.attributes.flatMap((e=>{const t=(0,V.GY)(e);return(0,P.nj)(t)?[t]:(console.error(t),[])})),o=(0,N.m8)(t.flatMap((e=>[[e.id,e]])));return{uri:e.uri,attributes:t,attributesById:o}})),Oe={key:"thirdPartySearchResults",render:e=>c.createElement(de.Z,n()({},e,{disableMobilePadding:!0,title:a()(m.FormattedMessage,{id:"connectedRelationPropertyMenuResults.exactMatchAddPage.label",defaultMessage:"Found exact match",description:"Button for the user to click to start sync for URL provided (i.e. Github Pull Request) if link pasted."})})),items:[{key:"addPage",render:e=>c.createElement(ae.Z,n()({},e,{title:a()(m.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addPageButton.label",defaultMessage:"Add Page",description:"Button for the user to click to start sync for URL provided (i.e. Github Pull Request)"}),icon:x.Z.plusThick({width:14})})),action:e=>{(0,Q.ZP)({event:e,context:Q.Af.ButtonMouseDown,callback:()=>{Ve()}})}}]},Ue={key:"noResultsFoundInThirdParty",render:e=>c.createElement(de.Z,n()({},e,{disableMobilePadding:!0,title:a()(m.FormattedMessage,{defaultMessage:"No results found in {integration}.",id:"connectedRelationPropertyMenuResults.notMatched.help",description:"Prompt the user to change the URL to match the integration pattern (i.e. Github Pull Request)",values:{integration:me.name}})})),items:[]},He=[];me&&"google_calendar"===(0,F.s9)(me.id)&&He.push(...function(e){const{environment:t,intl:o,theme:i,externalIntegrations:r}=e,s=e.results.flatMap((e=>{const t=e.attributesById.start;if(t&&(0,V.Gc)(t)){const i=(0,Z.NK)(t.values[0],(0,T.r)(),o.locale);return[{...e,dateTime:i.start}]}return[]})),d=l().groupBy(s,(e=>e.dateTime.toFormat(Z.Iq))),p=l().sortBy(Object.keys(d),(e=>w.ou.fromFormat(e,Z.Iq).valueOf()));return p.flatMap((s=>{const p=d[s],u=l().sortBy(p,(e=>e.dateTime.valueOf())),m=(0,E.parseDateTimeRangeString)(s);if(!m)return[];let g;(l().isEqual(m,(0,Z.Lg)((0,T.r)()))||l().isEqual(m,(0,Z.Ro)((0,T.r)())))&&(g="relative");const h=(0,B.ZV)({value:m,intl:o,allowRelativeDates:Boolean(g),date_format:g});return[{key:h,items:u.flatMap((s=>{const l=new S.G(t,{table:D.iU,id:(0,A.ZP)(),spaceId:(0,A.ZP)()}),d={id:l.id,type:"external_object_instance",alive:!0,format:{bot_id:"",external_object_id:"",uri:s.uri,attributes:s.attributes},version:0,space_id:"",parent_id:"",parent_table:"block"};let p=null,u=null;const m=s.attributesById.title,g=s.attributesById.start,h=s.attributesById.end;return g&&h&&(0,V.Gc)(g)&&(0,V.Gc)(h)&&(p=a()("div",{},void 0,a()("span",{},void 0,a()(J.r4,{style:{color:void 0,display:"inline"},attribute:g,dateStyle:"exact_time",intl:o})," - ",a()(J.r4,{attribute:h,dateStyle:"exact_time",style:{color:void 0,display:"inline"},intl:o}))),u=a()("div",{},void 0,a()("span",{},void 0,a()(J.ox,{style:{color:void 0,display:"inline"},store:l,attribute:m})),p)),{key:s.uri,render:e=>a()(pe.Z,{renderTooltip:()=>u,placement:pe.Z.Placement.Left,textWrap:!0,render:a=>c.createElement(ae.Z,n()({},(0,ee.Z)(a||{},e),{title:(0,L.dD)({blockModel:R.kk.fromBlock(d),intl:o,index:0,style:{},disableHover:!0,disableLinks:!0,isAndroid:!1,theme:i,baseUrl:X.Z.domainBaseUrl,emojiType:"raw",currentUserId:t.currentUser.id,getRecordModel:l.getRecordModel,externalIntegrations:r}),caption:p}))}),action:t=>{(0,Q.ZP)({event:t.event,context:Q.Af.ButtonMouseDown,callback:()=>{e.addPage(s.uri)}})}}})),render:e=>c.createElement(de.Z,n()({},e,{disableMobilePadding:!0,title:h}))}]}))}({environment:he,intl:fe,theme:ve,externalIntegrations:ye,results:Ne,addPage:Ve}));const ze={key:"loadingSpinner",render:e=>c.createElement(de.Z,n()({},e,{disableMobilePadding:!0,title:a()("div",{style:{...v.addingPage,justifyContent:Ae?"center":"flex-start"}},void 0,a()(le.Z,{}),a()("span",{style:{marginLeft:10}},void 0,a()(m.FormattedMessage,{id:"connectedRelationPropertyMenuResults.fetchingData",defaultMessage:"Fetching data...",description:"Indicates that we are fetching data from the 3rd party application"})))})),items:[]},We=[];return"pending"===_e||Ae?We.push(ze):Ie?We.push(Oe):He.length>0?We.push(...He):b&&0===o.length?We.push(Fe):b&&o.length>0||We.push(Ue),a()(ce.Z,{type:ce.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:[...o,...We]})}const Pe=e=>{var t,o;if(e.patternName)return null===(t=e.integration.info)||void 0===t||null===(o=t.original_url_patterns)||void 0===o?void 0:o.filter((t=>{var o;return t.name===e.patternName&&(null===(o=t.additional_types)||void 0===o?void 0:o.connectedRelation)})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))};var xe=o(79131),Be=o(18647),Ze=o(43145),Ee=o(9897),Re=o(68139),Ae=o(75203);const De=32;class Fe extends d.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:b.Z,draggableListStore:y.Z},this.handleDraggableListDrop=(e,t)=>{const{onDrag:o}=this.props,{menuListStore:i}=this.stores;o&&o(e),g.sv({store:i,focus:{section:0,indexLocal:t.endPosition,indexGlobal:t.endPosition}})},this.hasLimit=()=>{const{property:e,schema:t}=this.props,o=t[e];return Boolean(o&&"relation"===o.type&&1===o.limit)}}didUpdate(e){const{menuListStore:t}=this.stores,{device:o}=this.environment;!this.props.searchQuery||l().isEqual(e.searchQuery,this.props.searchQuery)||o.isMobile||t.setState({...t.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}renderComponent(){const{device:e}=this.environment;return e.isMobile?this.renderMobileResults():this.renderDesktopResults()}renderDesktopResults(){const{results:e,loading:t,onScrollOffsetChange:o}=this.props,i=0===e.length;return a()(c.Fragment,{},void 0,a()(Be.Z,{style:{width:"100%",maxHeight:300,position:"relative",...i&&{marginTop:0}},type:v.Z.Y},void 0,this.renderRowsMenuList(e),t&&a()(Le,{}),o&&a()(Ze.Z,{onChange:o})))}renderMobileResults(){const{results:e,loading:t,resultsType:o}=this.props,i=0===e.length,n=this.props.schema[this.props.property];return Boolean("relation"===(null==n?void 0:n.type)&&n.connectedRelation)&&i?a()("div",{style:{marginTop:20}},void 0,a()(Ie,{blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,collectionStore:this.props.collectionStore,targetCollectionStore:this.props.targetCollectionStore,sections:[],propertySchema:n,property:this.props.property,pageRecordStore:this.props.parentStore,search:this.props.searchQuery,relationPropertyMenuStore:this.props.relationPropertyMenuStore})):a()(c.Fragment,{},void 0,i&&!t&&"existing"===o?void 0:this.renderRowsMenuList(e),t&&a()(Le,{}))}renderRowsMenuList(e){const{parentStore:t,collectionStore:o,targetCollectionStore:i,property:r,canDrag:s,canConfigureCollection:l,loading:d,onCreatePage:p,overlayMode:u}=this.props,{device:g}=this.environment,h=this.props.schema[r],v=Boolean("relation"===(null==h?void 0:h.type)&&h.connectedRelation),y=[],b=[];e.map((e=>{if(e.type===f.R.SearchPage){S.G.createChildStore(t,e.pointer).isTemplate()||b.push(this.renderRowMenuItem(e))}else e.type===f.R.SelectedPage&&y.push(this.renderRowMenuItem(e))}));const w=[];if(y.length>0){const e=y.map((e=>e.key.toString()));w.push({key:"results",render:t=>c.createElement(Ve,n()({},t,{title:this.hasLimit()?a()(m.FormattedMessage,{id:"database.relationProperty.relatedPages.limit.subHeader",defaultMessage:"Linked page",description:"Sub header in relation property menu that shows how many total pages are related."}):a()(m.FormattedMessage,{id:"database.relationProperty.relatedPages.subHeader",defaultMessage:"{count, plural, one {{count} linked page} other {{count} linked pages}}",description:"Sub header in relation property menu that shows how many total pages are related.",values:{count:y.length}}),collectionStore:o,targetCollectionStore:i,property:r,showRight:"add"!==(null==u?void 0:u.type),disabled:!l}),s&&!this.hasLimit()?a()(xe.ZP,{direction:"vertical",keys:e,renderKey:o=>t.children[e.indexOf(o)],onDrop:this.handleDraggableListDrop,store:this.stores.draggableListStore}):t.children),items:y})}if(!v&&(0===b.length&&0===y.length||b.length>0)){const e=d?void 0:b.length>0?y.length>0?a()(m.FormattedMessage,{id:"database.relationProperty.unrelatedPages.anotherPage.subHeader",defaultMessage:"Link another page",description:"Sub header in relation property menu that shows how many total pages are unrelated."}):a()(m.FormattedMessage,{id:"database.relationProperty.unrelatedPages.subHeader",defaultMessage:"Link a page",description:"Sub header in relation property menu that shows how many total pages are unrelated."}):a()(m.FormattedMessage,{id:"database.relationProperty.noResults.subHeader",defaultMessage:"No results",description:"Sub header in relation property menu that shows when there are no search results."});let t;d||0!==b.length||g.isMobile||v||(b.push({key:"empty",render:e=>a()(Ee.Z,{targetCollectionStore:i,title:this.props.searchQuery||"",focused:e.focused,onClick:p,isSection:!1,index:this.props.index}),action:()=>{p&&p()}}),t={paddingBottom:0});const s={key:"unrelated",render:a=>c.createElement(Ve,n()({},a,{title:e,collectionStore:o,targetCollectionStore:i,property:r,showRight:0===y.length||"add"===(null==u?void 0:u.type),disabled:!l,style:t})),items:b};"add"===(null==u?void 0:u.type)?w.unshift(s):w.push(s)}return v?a()(Ie,{blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,collectionStore:o,targetCollectionStore:i,sections:w,propertySchema:h,property:r,pageRecordStore:this.props.parentStore,search:this.props.searchQuery,relationPropertyMenuStore:this.props.relationPropertyMenuStore}):a()(ce.Z,{type:ce.i.Vertical,store:this.stores.menuListStore,style:{padding:"4px 0px"},initialFocus:this.environment.device.isMobile?void 0:0,sections:w})}renderRowMenuItem(e){const{disabled:t,canDrag:o,parentStore:i,collectionStore:r,targetCollectionStore:a,onAccept:s,property:l,blockPropertyValueOverlayStore:d}=this.props,p=S.G.createChildStore(i,e.pointer);return{key:p.id,render:s=>{const u=e.type===f.R.SelectedPage;return c.createElement(Re.Z,n()({},s,{canDrag:o&&u&&!this.hasLimit(),collectionStore:r,targetCollectionStore:a,relatedPageStore:p,disabled:t,isSelected:u,pageStore:i,property:l,rowType:"popup",onActionButtonClick:()=>this.props.onClickActionButton(e),blockPropertyValueOverlayStore:d}))},action:t=>{s(e,h.DJ(t.event))}}}}function Le(){return window.__c={n:"LoadingIndicator"},a()("div",{style:{height:"100%",padding:De,display:"flex",alignItems:"center",justifyContent:"center"}},void 0,a()(le.Z,{style:{margin:"0 auto"}}))}function Ve(e){window.__c={n:"RelationSectionHeader"};const{collectionStore:t,targetCollectionStore:o,property:i,showRight:r,disabled:s,style:l}=e,d=(0,p.VK)((()=>o.isSyncedCollection()),[o]),m=(0,p.VK)((()=>{const e=t.getSchema()[i];return Boolean(e&&u.NK(e))}),[t,i]);return c.createElement(de.Z,n()({},e,{noTextOverflow:!0,isTitleUppercase:!1,right:r&&!d&&!m&&a()(Ae.Z,{collectionStore:t,targetCollectionStore:o,property:i,disabled:s}),style:{paddingTop:0,paddingBottom:4,...l},desktopTitleStyle:{height:19,alignItems:"center",marginTop:6,marginBottom:6,paddingLeft:12,paddingRight:9}}))}Fe.displayName="RelationPropertyMenuResults";const Ne=Fe},14390:(e,t,o)=>{o.d(t,{b:()=>x});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(3779),u=o(63143),m=o(17335),g=o(33929),h=o(60709),f=o(61766),v=o(52275),y=o(31945),b=o(73063),S=o(68894),w=o(78140),k=o(9342),C=o(63296),_=o(44532),M=o(72495),T=o(64369),I=o(62045);function P(e){const{humanReadableLabel:t,placeholder:o,outlineButtonStyle:i,buttonWrapperStyle:r,renderAsQueryDropdown:l,events:c,isMobile:u}=e,m=(0,d.yK)((e=>({iconStyle:{...!u&&{height:12,width:12},color:e.mediumIconColor},textStyle:{marginLeft:6,color:e.regularTextColor}})),[u]);return l?s.createElement(I.Z,n()({},c,{placeholder:o,title:a()(T.Z,{isMobile:u},void 0,t),disableMargins:!0})):s.createElement("div",n()({style:r},c),a()(C.Z,{isLarge:u,style:i},void 0,a()("div",{style:m.textStyle},void 0,t),a()(b.Z,{disableBackground:!0,icon:p.Z.chevronDown,iconStyle:m.iconStyle})))}function x(e){window.__c={n:"RelativeDateRangePicker"};const{onUpdate:t,filter:o,renderAsQueryDropdown:i}=e,r=(0,l.Fy)(),p=(0,c.qz)(void 0,f.Z),b=(0,c.qz)(void 0,f.Z),C="count"in o,T=(0,d.yK)((e=>({directionButtonStyle:{paddingLeft:4,paddingRight:4,minWidth:70,justifyContent:"space-between",...r.isMobile&&{marginTop:12,width:"100%",paddingLeft:12,marginBottom:6},...!C&&{marginRight:4}},unitButtonStyle:{paddingLeft:4,paddingRight:4,minWidth:90,justifyContent:"space-between",width:"100%",...r.isMobile&&{paddingLeft:12,marginTop:6}},directionButtonWrapperStyle:{...r.isMobile&&{width:"100%"},flexGrow:0},unitButtonWrapperStyle:{...r.isMobile&&{width:"100%"},flexGrow:2},inputStyle:{minWidth:35,height:16},inputOuterStyle:{minWidth:60,height:32},container:{display:"flex",justifyContent:"start",alignItems:"center",flexDirection:r.isMobile?"column":"row",width:"100%"},textWrapper:{marginRight:6,marginLeft:i?16:6}})),[r.isMobile,i,C]);function I(e){return"this"===e?g.default.formatMessage(m.Fc[e]):g.default.formatMessage(m.Sj[e])}function x(e,t){return t&&t>1?g.default.formatMessage(m.D0[e]):g.default.formatMessage(m.Sb[e])}const B=["day","week","month","year"].map((e=>({key:e,render:t=>s.createElement(v.Z,n()({},t,{title:x(e,C?o.count:void 0),checkState:e===o.unit})),action:i=>{t({...o,unit:e}),p.setState({open:!1})}}))),Z=["past","future","this"].map((e=>({key:e,render:t=>s.createElement(v.Z,n()({},t,{checkState:"surrounding"===o.value?"this"===e:e===o.direction,title:I(e)})),action:i=>{"this"===e&&"custom"===o.value?t({type:"relative",value:"surrounding",unit:o.unit}):"this"!==e&&"surrounding"===o.value?t({type:"relative",value:"custom",count:1,direction:e,unit:o.unit}):"this"!==e&&"custom"===o.value&&t({...o,direction:e}),b.setState({open:!1})}})));return a()("div",{style:T.container},void 0,a()(y.Z,{buttonPopupStore:b,popupType:r.isMobile?_.kQ.SlideUp:_.kQ.Popup,renderOrigin:e=>a()(P,{events:e,placeholder:m.$7.direction,renderAsQueryDropdown:i,isMobile:r.isMobile,outlineButtonStyle:T.directionButtonStyle,buttonWrapperStyle:T.directionButtonWrapperStyle,humanReadableLabel:I("direction"in o?o.direction:"this")}),render:()=>a()(w.Z,{menuType:r.isMobile?h.og.ActionSheet:h.og.Popup},void 0,a()(k.Z,{initialFocus:void 0,type:k.i.Vertical,sections:[{key:"directionOptions",render:e=>s.createElement(M.Z,n()({disableMobilePadding:!0},e)),items:Z}]}))}),C&&a()(S.ZP,{type:"number",style:T.inputStyle,textWrapperStyle:T.textWrapper,inputOuterStyle:T.inputOuterStyle,min:"1",value:o.count.toString(),onChange:e=>{const i=parseInt(e.target.value);!(0,u.hj)(i)||i<1||t({...o,count:i})}}),a()(y.Z,{buttonPopupStore:p,popupType:r.isMobile?_.kQ.SlideUp:_.kQ.Popup,renderOrigin:e=>a()(P,{events:e,placeholder:m.$7.unit,renderAsQueryDropdown:i,isMobile:r.isMobile,outlineButtonStyle:T.unitButtonStyle,buttonWrapperStyle:T.unitButtonWrapperStyle,humanReadableLabel:x(o.unit,"count"in o?o.count:void 0)}),render:()=>a()(w.Z,{menuType:r.isMobile?h.og.ActionSheet:h.og.Popup},void 0,a()(k.Z,{initialFocus:void 0,type:k.i.Vertical,sections:[{key:"unitOptions",render:e=>s.createElement(M.Z,n()({disableMobilePadding:!0},e)),items:B}]}))}))}},18878:(e,t,o)=>{o.d(t,{mo:()=>f,nH:()=>v,mX:()=>y});var i=o(77094),n=o.n(i),r=o(67294),a=o(81954),s=o(24405),l=o(27006),c=o(97880),d=o(82990),p=o(5366),u=o(34859),m=o(79315),g=o(18647),h=o(79931);function f(e){window.__c={n:"RestorePermissionEdits"};const{openState:t}=e,{mainEditorCurrentBlockStore:o,currentSpaceStore:i}=(0,a.VK)((()=>m.default.state),[]),r=(0,s.yK)((e=>({scroller:{display:"flex",flexDirection:"column",maxHeight:290},editContainer:{marginTop:2,marginBottom:2,color:e.regularTextColor}})),[]);if(!o||!i)return null;const l=Date.now();return n()(g.Z,{type:u.Z.Y,style:r.scroller},void 0,t.permissionChanges.map(((e,t)=>{let[a,s]=e;const c={timestamp:l,space_id:i.id,type:"permission-changed",permission_data:{before:a,after:s}};return n()("div",{style:r.editContainer},`${a.type}-${t}`,n()(h.Z,{rootStore:o,edit:c}))})))}function v(e){return["remove","restrict"].includes(e.type)?n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.actionButton.restrictAccess",defaultMessage:"Restrict access",description:"Button to commit more restrictive permissions for a page."}):"restoreTeamPermissions"===e.type?n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.actionButton.restoreTeamPermissions",defaultMessage:"Reset Permissions",description:"Button to reset permissions to match ancestor permissions."}):n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.actionButton.restoreAccess",defaultMessage:"Restore access",description:"Button to remove the restrictive permissions for a page."})}function y(e){switch(e.type){case"remove":return n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.restrict.description",defaultMessage:"Are you sure you want to remove this {permissionGroup} and restrict access? This page will no longer inherit share settings from the parent page.",description:"'permissionGroup' will be 'user', 'group', 'workspace', or just 'permission'",values:{permissionGroup:b(e)}});case"restrict":return n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.remove.description",defaultMessage:"Are you sure you want to change this role and restrict access? This page will no longer inherit share settings from the parent page."});case"restore":return e.permissionChanges.length>0?n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.restore.description",defaultMessage:"Are you sure you want to restore access? This will inherit the following permissions from the parent page:"}):n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.restoreNoChanges.description",defaultMessage:"Are you sure you want to restore access?"});case"restoreTeamPermissions":return r.createElement(r.Fragment,null,n()("div",{style:{fontWeight:d.Z.fontWeight.semibold,marginBottom:4}},void 0,n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.restoreTeamPermissions.mainDescription",defaultMessage:"Are you sure you want to reset permissions to match the teamspace defaults?",description:"Message in confirmation modal asking the user if they are sure they want to clear all page level permissions to match teamspace default page permissions."})),n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.restoreTeamPermissions.warningMessage",defaultMessage:"Everyone else who is not part of the teamspace will lose access, including guests.",description:"Warning message in confirmation modal for restoring access to teamspace defaults. This reminds users that all page level permissions will be removed if they proceed."}));default:throw c.t1(e)}}function b(e){return(0,l.jg)(e.permissionItem)?n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.permissionGroup.user",defaultMessage:"user",description:"Will be used in the sentence 'If you remove this *user*' in reference to removing the access of a specific user from a page permission."}):(0,l.hV)(e.permissionItem)?n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.permissionGroup.group",defaultMessage:"group",description:"Will be used in the sentence 'If you remove this *group*' in reference to removing the access of a specific group (e.g. the 'Design' group) from a page permission."}):(0,l.ix)(e.permissionItem)?n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.permissionGroup.space",defaultMessage:"workspace",description:"Will be used in the sentence 'If you remove this *workspace*' in reference to removing the access of an entire organization (e.g. all members of the 'Notion' workspace) from a page permission."}):n()(p.FormattedMessage,{id:"restrictedPermissionConfirmationModal.permissionGroup.generic",defaultMessage:"permission",description:"Will be used in the sentence 'If you remove this *permission*' in reference to removing a general level of access (e.g. the 'Share to web' access) from a page permission."})}},18145:(e,t,o)=>{o.d(t,{t:()=>D,Z:()=>L});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o(67294),c=o(83355),d=o(2032),p=o(99036),u=o(3779),m=o(5366),g=o(50906),h=o(66890),f=o(16187),v=o(75079),y=o(60709),b=o(98742),S=o(61766),w=o(3815),k=o(42917),C=o(52275),_=o(31945),M=o(78140),T=o(9342),I=o(40721),P=o(44532),x=o(72495),B=o(58032),Z=o(19387),E=o(3072),R=o(69872),A=o(77498);let D;!function(e){e[e.BlockPropertyOverlay=0]="BlockPropertyOverlay",e[e.ViewSettings=1]="ViewSettings"}(D||(D={}));class F extends c.Z{constructor(){super(...arguments),this.storeTypes={relationButtonPopupStore:S.Z,targetPropertyButtonPopupStore:S.Z,aggregationButtonPopupStore:S.Z},this.renderRelationSelect=e=>a()(A.Z,{schema:this.props.schema,isRelationProperty:!0,onAccept:this.handleRelationAccept,onClose:e.close,allowProperty:this.handleRelationAllowProperty}),this.renderTargetPropertyTooltip=()=>a()(m.FormattedMessage,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."}),this.renderTargetPropertySelect=e=>{const t=this.getRenderState();if(t)return a()(A.Z,{isRelationProperty:!1,schema:t.relatedCollectionSchema,onAccept:this.handleTargetPropertyAccept,allowProperty:this.handleTargetPropertyAllowProperty,onClose:e.close})},this.renderAggregationTooltip=()=>a()(m.FormattedMessage,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."}),this.renderAggregationSelect=e=>{const t=this.getRenderState();if(t&&t.propertySchema.target_property)return a()(E.Z,{property:t.propertySchema.target_property,schema:t.relatedCollectionSchema,onChange:this.handlePropertyAggregationMenuChange,onClose:e.close,noneText:a()(m.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original",description:"Default setting for rollup properties: shows the original value of the selected property of the related pages."}),source:"rollupPropertyMenu"})},this.handleRelationAccept=e=>{const{onChange:t,analyticsFrom:o}=this.props,i=this.getRenderState();if(!i)return;const n={...i.propertySchema,relation_property:e,target_property:"title",target_property_type:"title",aggregation:void 0};null==t||t({propertySchema:n}),g.trackConfigureRollupRelation(this.environment,{...(0,v.Pn)(this.context.collectionContextStore),from:o})},this.handleTargetPropertyAccept=e=>{const{onChange:t,analyticsFrom:o}=this.props,i=this.getRenderState();if(!i||!i.relatedCollectionValue||!i.relatedCollectionSchema)return;const n=i.relatedCollectionSchema[e];if(!n)return;const r={...i.propertySchema,target_property:e,target_property_type:n.type,aggregation:void 0};null==t||t({propertySchema:r}),g.trackConfigureRollupTargetProperty(this.environment,{...(0,v.Pn)(this.context.collectionContextStore),from:o,property_type:n.type})},this.handlePropertyAggregationMenuChange=e=>{const{onChange:t,analyticsFrom:o}=this.props,i=this.getRenderState();if(!i)return;const n={...i.propertySchema,aggregation:e,show_as:void 0};null==t||t({propertySchema:n});const r=e?(0,d.gu)(e):void 0;g.trackConfigureRollupAggregation(this.environment,{...(0,v.Pn)(this.context.collectionContextStore),from:o,aggregation:r})},this.handleRelationAllowProperty=e=>"relation"===e.type,this.handleTargetPropertyAllowProperty=e=>"rollup"!==e.type&&!p.Eu.includes(e.type)}renderComponent(){const{device:e}=this.environment,{context:t}=this.props,o=this.getRenderState();if(!o)return;const i=Boolean(o.propertySchema.relation_property),r=Boolean(o.propertySchema.relation_property&&o.propertySchema.target_property);if(t===D.BlockPropertyOverlay){let t;return t=e.isMobile?{menuType:y.og.Modal,title:o.propertySchema.name,right:a()(I.DoneMenuText,{}),onClickRight:this.props.onDismiss}:{menuType:y.og.Popup},l.createElement(M.Z,t,a()(T.Z,{type:T.i.Vertical,initialFocus:void 0,sections:s.compact([this.renderRelationSection(),this.renderTargetPropertySection(i),this.renderAggregationSection(r)])}))}return l.createElement(l.Fragment,null,a()(_.Z,{popupType:e.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:_.Z.Alignment.End,renderOrigin:e=>l.createElement(k.Z,n()({title:a()(m.FormattedMessage,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:this.props.disabled,showChevron:!0,rotateChevron:this.stores.relationButtonPopupStore.state.open,right:o.relationPropertySchema?a()(Z.Z,{propertySchema:o.relationPropertySchema,showIcon:!0}):a()(m.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"})},e)),render:this.renderRelationSelect,buttonPopupStore:this.stores.relationButtonPopupStore}),a()(B.Z,{renderTooltip:this.renderTargetPropertyTooltip,disableTooltip:i,render:t=>a()(_.Z,{popupType:e.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:_.Z.Alignment.End,renderOrigin:e=>l.createElement(k.Z,n()({title:a()("span",{style:{...!r&&{color:this.theme.mediumTextColor}}},void 0,a()(m.FormattedMessage,{defaultMessage:"Property",id:"database.viewSettings.rollupOptions.targetProperty"})),disabled:!i||this.props.disabled,showChevron:!0,rotateChevron:this.stores.targetPropertyButtonPopupStore.state.open,right:i&&(o.targetPropertySchema?a()(Z.Z,{propertySchema:o.targetPropertySchema,showIcon:!0}):a()(m.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"}))},(0,b.Z)(t,e))),render:this.renderTargetPropertySelect,buttonPopupStore:this.stores.targetPropertyButtonPopupStore})}),a()(B.Z,{renderTooltip:this.renderAggregationTooltip,disableTooltip:r,render:t=>a()(_.Z,{popupType:e.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:_.Z.Alignment.End,renderOrigin:e=>l.createElement(k.Z,n()({disabled:!r||this.props.disabled,title:a()("span",{style:{...!r&&{color:this.theme.mediumTextColor}}},void 0,a()(m.FormattedMessage,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})),showChevron:!0,rotateChevron:this.stores.aggregationButtonPopupStore.state.open,right:r&&this.renderCurrentAggregation()},(0,b.Z)(t,e))),render:this.renderAggregationSelect,buttonPopupStore:this.stores.aggregationButtonPopupStore})}))}renderRelationSection(){const{device:e}=this.environment,{disabled:t}=this.props,o=this.getRenderState();if(o)return{key:0,render:e=>l.createElement(x.Z,n()({},e,{title:a()(m.FormattedMessage,{id:"database.rollupProperty.editRelation.title",defaultMessage:"Relation"}),isTitleUppercase:!0})),items:[{key:0,render:i=>a()(_.Z,{popupType:e.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:e=>o.relationPropertySchema?l.createElement(R.Z,n()({},(0,b.Z)(i,e),{propertySchema:o.relationPropertySchema,format:R.L.Name,right:this.getMenuItemChevron(t),disabled:t})):l.createElement(C.Z,n()({},(0,b.Z)(i,e),{title:a()(m.FormattedMessage,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relation…"}),right:this.getMenuItemChevron(t),style:{color:this.theme.mediumTextColor},disabled:t})),render:this.renderRelationSelect,buttonPopupStore:this.stores.relationButtonPopupStore},i.key),action:()=>{this.stores.relationButtonPopupStore.setState({open:!0})}}]}}renderTargetPropertySection(e){const{device:t}=this.environment,{disabled:o}=this.props,i=this.getRenderState();if(i)return{key:1,render:e=>l.createElement(x.Z,n()({},e,{title:a()(m.FormattedMessage,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0,isTitleUppercase:!0})),items:[{key:0,render:r=>a()(B.Z,{renderTooltip:this.renderTargetPropertyTooltip,disableTooltip:e,render:s=>a()(_.Z,{popupType:t.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:t=>i.targetPropertySchema?l.createElement(R.Z,n()({},(0,b.Z)(r,t),{propertySchema:i.targetPropertySchema,format:R.L.Name,right:this.getMenuItemChevron(o),disabled:o})):l.createElement(C.Z,n()({},(0,b.Z)(r,s),{title:a()(m.FormattedMessage,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property to display…"}),right:this.getMenuItemChevron(!e||o),disabled:!e||o,disabledFeedback:!0})),render:this.renderTargetPropertySelect,buttonPopupStore:this.stores.targetPropertyButtonPopupStore})},r.key),action:()=>{this.stores.targetPropertyButtonPopupStore.setState({open:!0})}}]}}renderAggregationSection(e){const{device:t}=this.environment,{disabled:o}=this.props;if(this.getRenderState())return{key:2,render:e=>l.createElement(x.Z,n()({},e,{title:a()(m.FormattedMessage,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0,isTitleUppercase:!0})),items:[{key:0,render:i=>a()(B.Z,{renderTooltip:this.renderAggregationTooltip,disableTooltip:e,render:r=>e?a()(_.Z,{popupType:t.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:e=>l.createElement(C.Z,n()({},(0,b.Z)(i,e),{title:this.renderCurrentAggregation(),right:this.getMenuItemChevron(o),disabled:o})),render:this.renderAggregationSelect,buttonPopupStore:this.stores.aggregationButtonPopupStore}):l.createElement(C.Z,n()({},(0,b.Z)(i,r),{title:a()(m.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original",description:"Default setting for rollup properties: shows the original value of the selected property of the related pages."}),right:this.getMenuItemChevron(o),disabled:!0,disabledFeedback:!0}))},i.key),action:()=>{this.stores.aggregationButtonPopupStore.setState({open:!0})}}]}}renderCurrentAggregation(){const e=this.getRenderState();if(e)return e.propertySchema.aggregation?f.VN[(0,d.gu)(e.propertySchema.aggregation)]:a()(m.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original",description:"Default setting for rollup properties: shows the original value of the selected property of the related pages."})}getMenuItemChevron(e){return e?void 0:u.Z.chevronDown({width:11,fill:this.theme.mediumIconColor})}getRenderState(){const{schema:e,property:t,parentStore:o}=this.props,i=e[t];if(!i)return;let n,r;if(i.relation_property){const t=e[i.relation_property];t&&"relation"===t.type&&(n=t)}if(n){const e=p.j0(n);if(e){r=w.NW.createChildStore(o,e).getValue()}}const a=r?p.oC(r):{};let s;return r&&i.target_property&&(s=a[i.target_property]),{propertySchema:i,relationPropertySchema:n,relatedCollectionValue:r,relatedCollectionSchema:a,targetPropertySchema:s}}}F.displayName="RollupPropertyMenu",F.contextTypes={...c.w,...h.xm};const L=F},66313:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Lm});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(13991),d=o(97477),p=o(2280),u=o(49271),m=o(8848),g=o(3779),h=o(71644),f=o(98459),v=o(80984),y=o(89101),b=o(29369),S=o(32739),w=o(5366),k=o(50906),C=o(84908),_=o(91376),M=o(5978),T=o(70782),I=o(39634),P=o(37181),x=o(95477),B=o(472),Z=o(77907),E=o(79315),R=o(10161),A=o(3815),D=o(51454),F=o(92108),L=o(74647),V=o(480),N=o(81954),O=o(66673),U=o(63143),H=o(73928),z=o(16772);function W(e){const t=(0,V.O7)(),o=(0,N.VK)((()=>"completionPopup"===z.default.state.type),[]),i=(0,O.D9)(o)&&!o,n=o?30*U.C0:30*U.hM,r=(0,N.VK)((()=>{var e;return null===(e=E.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]);return(0,s.useEffect)((()=>{async function e(){r&&await H.Q2(t,r)}const o=setInterval((()=>{e()}),n);return i||e(),()=>{clearInterval(o)}}),[t,r,n,i]),null}var j=o(16091),K=o(28020),Y=o(23223),G=o(99417),X=o(64286),q=o(67669);const $=16841952e5-30*U.A0;function J(e){return!!e&&"on"===R.default.getEligibleGroup({experimentId:"proj_management_announcement",defaultGroup:"control"})}var Q=o(77124),ee=o(45094),te=o(23537),oe=o(51),ie=o(7755),ne=o(27242),re=o(78291),ae=o(33728),se=o(24211),le=o(61784),ce=o(77671),de=o(35253),pe=o(47307),ue=o(92625),me=o(97977),ge=o(12955),he=o(73329),fe=o(28121),ve=o(91754),ye=o(65162);function be(){return s.useEffect((()=>{if(x.Z.isAdminMode)return de.Bw({bannerStore:he.Z,id:"AdminModeBanner",render:()=>a()(we,{}),type:ve.$.Blue,prepend:!0}),()=>{de.qL({bannerStore:he.Z,id:"AdminModeBanner"})}}),[]),null}const Se={marginLeft:12,color:m.ZP.white,border:`1px solid ${m.ZP.white}`};function we(){window.__c={n:"AdminModeBannerContent"};const e=(0,V.O7)(),t=(0,N.VK)((()=>E.default.state.currentUserStore),[]),o=(0,N.VK)((()=>null==t?void 0:t.getEmail()),[t]),i="makenotion.com"===(0,ae.Gd)(o??""),[n,r]=s.useState("");if(s.useEffect((()=>{!async function(){try{const t=await(0,ge.getCookie)(e,"notion_ghost_preferred_role");r((e=>t??""))}catch(t){console.error(t)}}()})),!o)return null;const l="full"===n?"restricted":"full";return a()("div",{},void 0,`You are currently logged in as ${o}`,a()("i",{},void 0,n&&i?` (${fe.v[n].text} access)`:""),".",n&&i&&a()(ke,{environment:e,currentUserEmail:o,alternateLoginRole:l}),a()(ye.Z,{style:Se,onClick:()=>{M.navigate({environment:e,url:"/__admin"})}},void 0,"Back to Admin Console"),a()(ye.Z,{style:Se,onClick:()=>{ce.B(e)}},void 0,"Logout as user"))}function ke(e){let{environment:t,currentUserEmail:o,alternateLoginRole:i}=e;window.__c={n:"ToggleAdminRole"};const n=s.useCallback((async()=>{const e=await ce.N(t,{email:o,intercomLink:"switch role",preferredLoginRole:i});if("failed"===e.type)ue.x(),pe.showError(e);else{const{userId:n}=e.data,r=`Success! click "Continue" to enter account for "${o}" in ${fe.v[i].text} mode.`,a=e.data.expiryTime?`${r} The user has granted access until ${(0,le.Yx)(e.data.expiryTime,"medium_with_time",se.al)}.`:r;ue.x(),pe.showDialog({message:a,showCancel:!1,keepFocus:!0,items:[{label:"Continue",color:"blue",onAccept:()=>{me.loginAsAdmin({userId:n,environment:t})}}]})}}),[t,o,i]);return a()(ye.Z,{style:Se,onClick:n},void 0,`Switch to ${fe.v[i].text} mode`)}var Ce=o(24405),_e=o(88108),Me=o(94419),Te=o(9953),Ie=o(29974),Pe=o(30149),xe=o(89626),Be=o(51456),Ze=o(22889),Ee=o(69454),Re=o(42922),Ae=o(73420),De=o(36488),Fe=o(22346),Le=o(89728),Ve=o(64369),Ne=o(42402);function Oe(){window.__c={n:"IntroFeatures"};const e=(0,V.O7)(),t=(0,Ce.yK)((e=>({sparkles:{display:"inline",width:14,height:14,fill:"currentColor"},spaceKey:{color:e.regularTextColor,fontWeight:500}})),[]);return a()(Ae.sg,{gap:24},void 0,a()(He,{icon:g.Z.magicWand,title:a()(w.FormattedMessage,{id:"AiIntroModal.intro.feature1.title",defaultMessage:"Ask AI anything",description:"Title for the first feature of the AI intro modal"}),description:e.device.isMobile?a()(w.FormattedMessage,{id:"AiIntroModal.intro.feature1.description.mobile",defaultMessage:"Tap the {sparklesIcon} button when editing pages. Let AI handle your first draft.",description:"Description for the first feature of the AI intro modal on mobile",values:{sparklesIcon:g.Z.sparkles(t.sparkles)}}):a()(w.FormattedMessage,{id:"AiIntroModal.intro.feature1.description.desktop",defaultMessage:"Just press {spaceKey} on a new line or page. Let AI handle your first draft.",description:"Description for the first feature of the AI intro modal",values:{spaceKey:a()("span",{style:t.spaceKey},void 0,a()(w.FormattedMessage,{id:"AiIntroModal.intro.spaceKey",defaultMessage:"‘space’",description:"Name for the space key that triggers AI, with quotes around"}))}})}),a()(He,{icon:g.Z.aiLasso,title:a()(w.FormattedMessage,{id:"AiIntroModal.intro.feature2.title",defaultMessage:"Improve your writing",description:"Title for the second feature of the AI intro modal"}),description:a()(w.FormattedMessage,{id:"AiIntroModal.intro.feature2.description",defaultMessage:"Ask AI to fix spelling, grammar, change tone, translate, and more.",description:"Description for the second feature of the AI intro modal"})}),a()(He,{icon:g.Z.pencil,title:a()(w.FormattedMessage,{id:"AiIntroModal.intro.feature3.title",defaultMessage:"Generate summaries & action items",description:"Title for the third feature of the AI intro modal"}),description:a()(w.FormattedMessage,{id:"AiIntroModal.intro.feature3.description",defaultMessage:"Find key points and next steps in 30 seconds, not 30 minutes.",description:"Description for the third feature of the AI intro modal"})}))}function Ue(){return window.__c={n:"TipsFeatures"},a()(Ae.sg,{gap:24},void 0,a()(He,{icon:g.Z.lockedFilled,title:a()(w.FormattedMessage,{id:"AiIntroModal.tips.feature1.title",defaultMessage:"Designed for your privacy",description:"Title for the first feature of tips screen of the AI intro modal"}),description:a()(w.FormattedMessage,{id:"AiIntroModal.tips.feature1.description",defaultMessage:"Your content and AI conversations are not used for training the AI.",description:"Description for the first feature of tips screen of the AI intro modal on mobile"})}),a()(He,{icon:g.Z.helpMessage,title:a()(w.FormattedMessage,{id:"AiIntroModal.tips.feature2.title",defaultMessage:"AI may provide inaccurate responses",description:"Title for the second feature of tips screen of the AI intro modal"}),description:a()(w.FormattedMessage,{id:"AiIntroModal.tips.feature2.description",defaultMessage:"Review and fact check all AI responses. If not up to standard, tap the {thumbsdown} button to let us know.",description:"Description for the second feature of tips screen of the AI intro modal",values:{thumbsdown:g.Z.thumbDown({display:"inline",width:12,height:12,fill:"currentColor"})}})}),a()(He,{icon:g.Z.giftOutline,title:a()(w.FormattedMessage,{id:"AiIntroModal.tips.feature3.title",defaultMessage:"Try Notion AI for free",description:"Title for the third feature of tips screen of the AI intro modal"}),description:a()(w.FormattedMessage,{id:"AiIntroModal.tips.feature3.description",defaultMessage:"You get 20 AI responses to try. An add-on for unlimited AI responses can be added to your plan later.",description:"Description for the third feature of tips screen of the AI intro modal"})}))}function He(e){window.__c={n:"Feature"};const{icon:t,title:o,description:i}=e,n=(0,V.O7)(),r=(0,N.VK)((()=>n.device.isPhone),[n]),s=(0,Ce.yK)((e=>({icon:{width:r?28:36,height:r?28:36,fill:e.aiPurpleColor},title:{fontWeight:500}})),[r]);return a()(Ae.X2,{alignItems:"flex-start",gap:r?16:24},void 0,t(s.icon),a()(Ae.sg,{gap:4},void 0,a()(Ve.Z,{isMultiline:!0,isMobile:r,style:s.title},void 0,o),a()(Ve.Z,{isSecondaryColor:!0,isMultiline:!0,isMobile:r},void 0,i)))}const ze=function(){window.__c={n:"AiIntroModal"};const[e,t]=(0,s.useState)("introduction"),o=(0,V.O7)(),i=(0,Ce.Fg)(),n=(0,s.useCallback)((e=>{const{currentUserSettingsStore:t}=E.default.state;t&&Pe.createAndCommit({userAction:"AiIntroModal.updateOnboardingPhase",environment:o,perform:o=>{P.d2({userSettingsStore:t,transaction:o,data:{ai_onboarding_phase:e}})},userId:t.id})}),[o]);(0,s.useEffect)((()=>{(0,_e.exposeDebugValue)("resetAIOnboarding",(()=>{t("introduction"),n("not_seen")}))}),[o,n]);const r=(0,xe.TH)({forIntroModal:!0});(0,s.useEffect)((()=>{E.default.state.inAppCalloutStore.updateCalloutStatus({calloutId:"ai_intro_modal",visible:r})}),[r]);const l=(0,s.useCallback)((()=>{Be.track(o,"ai_ga_onboarding_close_click"),n("complete")}),[o,n]),c=(0,s.useCallback)((()=>{Be.track(o,"ai_ga_onboarding_demo_click"),window.open("https://youtu.be/RDZ3mY10zY8")}),[o]),d=(0,s.useCallback)((()=>{Be.track(o,"ai_ga_onboarding_continue_click"),t("tips")}),[o]),p=(0,s.useCallback)((()=>{Be.track(o,"ai_ga_onboarding_skip_click"),n("complete")}),[o,n]),u=function(){const e=(0,V.O7)(),t=(0,N.VK)((()=>E.default.state.currentUserSettingsStore),[]),o=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),i=(0,N.VK)((()=>E.default.state.currentSpaceViewStore),[]);return(0,s.useCallback)((()=>{if(!t||!o||!i)return;Be.track(e,"ai_ga_onboarding_try_now_click");const{performResult:{createdPage:n,firstBlock:r}}=Pe.createAndCommit({userAction:"AiIntroModal.useTryAiCallback",environment:e,perform:n=>{P.d2({userSettingsStore:t,transaction:n,data:{ai_onboarding_phase:"space_for_ai"}});const r=Ie.KE({environment:e,spaceStore:o,spaceViewStore:i,isPrivate:!0,transaction:n}),a=Te.j4({environment:e,type:"text",inMemoryRecordCache:r.inMemoryRecordCache,transaction:n,spaceId:r.pointer.spaceId}),s=Me.R3({parent:r.getContentStore(),append:a,transaction:n}).child;return{createdPage:r,firstBlock:s}},userId:t.id});n&&r&&(xe.__.setState(r.id),M.navigateToBlock({environment:e,store:n,visitType:Ze.vu.Link}))}),[e,t,o,i])}(),h=(0,s.useCallback)((()=>{Be.track(o,"ai_ga_onboarding_done_click"),n("space_for_ai")}),[o,n]),f=(0,N.VK)((()=>o.device.isPhone),[o]),v=(0,N.VK)((()=>{if(!f)return{paddingTop:0,paddingBottom:0};const e=o.WindowSizeStore.getSafePaddingBottomCSS(Ee.Z.estimatedNativeWebBottomOverlap());return{paddingTop:o.WindowSizeStore.getSafePaddingTopCSS(0),paddingBottom:e}}),[o,f]),y=(0,Ce.yK)((e=>({modalInnerStyle:{background:e.sidebarBackground,borderRadius:f?0:12,display:"flex",width:440,minHeight:560},modalInnerStyleMobile:{background:e.sidebarBackground,borderRadius:f?0:12,height:"100%",overflow:"auto",...v},container:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:f?25:15,right:17,width:22,height:22,padding:0,borderRadius:"50%",border:"none",background:"light"===e.mode?m.FN.light.gray[75]:m.FN.dark.gray[500]},closeButtonIcon:{width:12,height:12,fill:"light"===e.mode?m.FN.light.gray[400]:m.FN.dark.gray[800]},body:{position:"relative",flexGrow:1,padding:f?"42px 24px 10px":"42px 42px 20px"},demoButton:{borderRadius:32,padding:"8px 12px",border:"1px solid",borderColor:e.darkDividerColor,height:32,fontWeight:500},footer:{display:"flex",flexWrap:f?"wrap":"nowrap",flexDirection:f?"column-reverse":"row",gap:16,justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderTop:f?void 0:`1px solid ${e.lightDividerColor}`},footerButtons:{display:"flex",flexDirection:f?"column":"row",gap:f?8:16,alignItems:"center",grow:f?1:0,width:f?"100%":void 0},footerIcon:{width:12,height:12,fill:e.lightTextColor},skipButton:{color:e.lightTextColor},blueButton:{padding:"8px 20px",height:f?44:32,width:f?"100%":"auto",fontSize:f?16:14},purpleText:{color:e.aiPurpleColor},contentWrap:{display:"flex",flexDirection:"column",gap:32,height:"100%",alignItems:"center"},headerWrap:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},headerIcon:{display:"flex",height:52,width:52,alignItems:"center",justifyContent:"center"},headerTitle:{marginBottom:12,fontSize:24,fontWeight:700,textAlign:"center"}})),[v,f]);return a()(Fe.Z,{open:r,innerStyle:f?y.modalInnerStyleMobile:y.modalInnerStyle,preventHideChildrenWhileOpening:!0,render:()=>a()(De.Z,{capture:!0,allowEsc:!0,render:()=>a()("div",{style:y.container},void 0,a()("div",{style:y.body},void 0,a()("button",{style:y.closeButton,onClick:l},void 0,g.Z.close(y.closeButtonIcon)),a()("div",{style:y.contentWrap},void 0,a()(Ae.sg,{alignItems:"center"},void 0,a()("div",{style:y.headerWrap},void 0,a()("div",{style:y.headerIcon},void 0,"introduction"===e?"light"===i.mode?g.Z.notionAiLight({width:52,height:52,marginBottom:2}):g.Z.notionAiDark({width:52,height:52,marginBottom:2}):g.Z.info({width:36,height:36,fill:i.mediumTextColor,marginBottom:10})),a()("div",{style:y.headerTitle},void 0,a()(w.FormattedMessage,"introduction"===e?{id:"AiIntroModal.intro.title",defaultMessage:"Introducing <purpleText>Notion AI</purpleText>",description:"Title for the AI intro modal",values:{purpleText:e=>a()("span",{style:y.purpleText},void 0,e)}}:{id:"AiIntroModal.tips.title",defaultMessage:"Tips to get you started",description:"Title for the AI tips modal"})),"introduction"===e&&a()(Le.Z,{style:y.demoButton,onClick:c},void 0,a()(Ae.X2,{gap:4,alignItems:"center"},void 0,g.Z.videoAttachment({width:16,height:16}),a()(Ve.Z,{},void 0,a()(w.FormattedMessage,{id:"AiIntroModal.intro.demoButton",defaultMessage:"See it in action",description:"Button text to see AI demo"})))))),a()("introduction"===e?Oe:Ue,{}))),a()("div",{style:y.footer},void 0,a()(Ve.Z,{isSecondaryColor:!0,isMultiline:!0,isSmall:!0},void 0,"introduction"===e&&a()(w.FormattedMessage,{id:"AiIntroModal.intro.termsLinks",defaultMessage:"Notion has updated <termsLink>its terms</termsLink>. <aiTermsLink>Additional AI terms</aiTermsLink> apply when using AI. <faqLink>See FAQ</faqLink>",description:"Link to updated terms and conditions for Notion, supplemental terms for AI, and FAQ on the changes",values:{termsLink:e=>a()(Ne.Z,{href:"https://notion.notion.site/Terms-and-Privacy-28ffdd083dc3473e9c2da6ec011b58ac",external:!0},void 0,e),aiTermsLink:e=>a()(Ne.Z,{href:"https://notion.notion.site/fa9034c8b5a04818a6baf3eac2adddbb",external:!0},void 0,e),faqLink:e=>a()(Ne.Z,{href:"https://notion.notion.site/93d7e4fe0e564fd181b067118c3c48f7",external:!0},void 0,e)}})),a()("div",{style:y.footerButtons},void 0,"tips"===e&&!o.device.isMobile&&a()(Le.Z,{style:y.skipButton,onClick:p},void 0,a()(w.FormattedMessage,{id:"AiIntroModal.intro.skip.label",defaultMessage:"Skip",description:"Label for the skip button in the AI intro modal"})),"tips"===e?o.device.isMobile?a()(Re.Z,{onClick:h,style:y.blueButton},void 0,a()(w.FormattedMessage,{id:"AiIntroModal.intro.done.label",defaultMessage:"Done",description:"Label for the done button in the AI intro modal"})):a()(Re.Z,{onClick:u,style:y.blueButton},void 0,a()(w.FormattedMessage,{id:"AiIntroModal.intro.tryAiNow.label",defaultMessage:"Try AI Now",description:"Label for the try AI now button in the AI intro modal"})):a()(Re.Z,{onClick:d,style:y.blueButton},void 0,a()(w.FormattedMessage,{id:"AiIntroModal.intro.continue.label",defaultMessage:"Continue",description:"Label for the continue button in the AI intro modal"})))))})})};var We=o(27848),je=o(41432),Ke=o(67219),Ye=o(70538),Ge=o(33929),Xe=o(51127),qe=o(24677),$e=o(63113);const Je=(0,w.defineMessages)({notionProjects:{defaultMessage:"Notion Projects",id:"pmLaunchSandbox.notionProjects",description:"Title of the sandbox container page."},projects:{defaultMessage:"Projects",id:"pmLaunchSandbox.projects",description:"Title of the projects toggle block."},sprints:{defaultMessage:"Sprints",id:"pmLaunchSandbox.sprints",description:"Title of the sprints toggle block."}});function Qe(e){const{environment:t,currentSpaceStore:o,currentSpaceViewStore:i,currentUserSettingsStore:n,isUserEngOrProduct:r}=e;Pe.createAndCommit({environment:t,userId:n.id,userAction:"PMSidebarEntrypoint.createSandbox",perform:e=>{const n=Ie.KE({environment:t,spaceStore:o,spaceViewStore:i,isPrivate:!0,transaction:e,prepend:!0,title:Ge.default.formatMessage(Je.notionProjects)}),a=n.getKeyStore("format");Te.sW({store:a,data:{page_icon:"/icons/stars_lightgray.svg",page_full_width:!0,is_notion_projects_sandbox:!0},transaction:e});const s=Xe.ZF({environment:t,appUri:We.Zv,presetUri:r?Ye.tt:Ye.Yb,appParentStore:o,isNotionProjectsSandbox:!0,transaction:e});s&&(s.forEach((i=>{var r;const a=null===(r=i.getFormat())||void 0===r?void 0:r.app_config_uri;a===Ke.TZ?tt({environment:t,currentSpaceStore:o,selectedDatabase:i,containerBlockStore:n,transaction:e}):a===Ke.k$?et({environment:t,currentSpaceStore:o,toggleTitle:Ge.default.formatMessage(Je.projects),selectedDatabase:i,containerBlockStore:n,transaction:e}):a===Ke.pz&&et({environment:t,currentSpaceStore:o,toggleTitle:Ge.default.formatMessage(Je.sprints),selectedDatabase:i,containerBlockStore:n,transaction:e})})),M.navigateToBlock({environment:t,store:n}))}})}function et(e){const{environment:t,currentSpaceStore:o,toggleTitle:i,selectedDatabase:n,containerBlockStore:r,transaction:a}=e,s=Te.j4({environment:t,type:je.Ti.header,properties:{title:[[i]]},format:{toggleable:!0},inMemoryRecordCache:r.inMemoryRecordCache,transaction:a});Me.R3({parent:r.getContentStore(),append:s,transaction:a}),tt({environment:t,currentSpaceStore:o,selectedDatabase:n,containerBlockStore:s,transaction:a})}function tt(e){const{environment:t,currentSpaceStore:o,selectedDatabase:i,containerBlockStore:n,transaction:r}=e;Me.Od({parent:o.getPagesStore(),childToRemove:i,transaction:r}),Me.R3({parent:n.getContentStore(),append:i,transaction:r}),$e.Cj({environment:t,blocks:[i],blockType:"collection_view",transaction:r}),qe.ZH(t);i.getCollectionViewStores().forEach((e=>{const t=e.getFormatStore();Te.sW({store:t,data:{hide_linked_collection_name:!0},transaction:r})}))}var ot=o(64921),it=o(32662);function nt(){window.__c={n:"ProjManagementIntroModal"};const e=(0,V.O7)(),t=function(){const e=(0,V.Fy)().isMobile,t=9/16;return(0,Ce.yK)((o=>({innerStyle:{background:o.sidebarBackground,borderRadius:12,width:440,height:560,display:"flex"},container:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between"},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:8,right:8,width:22,height:22,borderRadius:"50%",border:"none",background:o.defaultBadgeBackground},closeButtonIcon:{width:12,height:12,fill:o.regularIconColor},headerGroup:{position:"relative",width:e?"85%":300,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},header:{margin:0,fontSize:24,lineHeight:1},subHeader:{textAlign:"center",fontSize:16,fontWeight:300,color:o.lightTextColor},videoWrapper:e?{width:"100%",paddingBottom:100*t+"%",position:"relative"}:{width:390,paddingBottom:390*t,position:"relative"},video:{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:8,border:"none",outline:`2px solid ${o.tableDividerColor}`},footer:{width:"100%",height:80,display:"inline-flex",alignItems:"center",justifyContent:"space-between",fontSize:14,paddingLeft:e?12:20,paddingRight:e?16:24,borderTop:`1px solid ${o.tableDividerColor}`},learnAbout:{display:"inline-flex",alignItems:"center",padding:"4px 8px",borderRadius:4,color:o.lightTextColor,fill:o.lightTextColor}})),[e,t])}(),o=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),i=(0,N.VK)((()=>E.default.state.currentSpaceViewStore),[]),n=(0,N.VK)((()=>E.default.state.currentUserSettingsStore),[]),r=(0,N.VK)((()=>E.default.state.inAppCalloutStore),[]);return s.useEffect((()=>{if(r.canShow("pm_intro_modal"))return r.updateCalloutStatus({calloutId:"pm_intro_modal",visible:!0}),()=>{r.updateCalloutStatus({calloutId:"pm_intro_modal",visible:!1})}}),[r]),s.useEffect((()=>{}),[n,e]),a()(Fe.Z,{open:!0,innerStyle:t.innerStyle,preventHideChildrenWhileOpening:!0,onDismiss:t=>{t.preventDefault(),rt({environment:e,currentUserSettingsStore:n,phase:"dismissed"})},render:()=>a()(De.Z,{capture:!0,allowEsc:!0,render:()=>a()("div",{style:t.container},void 0,a()(ot.Z,{style:t.closeButton,onClick:t=>{t.preventDefault(),rt({environment:e,currentUserSettingsStore:n,phase:"dismissed"})}},void 0,g.Z.close(t.closeButtonIcon)),a()("div",{style:t.headerGroup},void 0,a()("h1",{style:t.header},void 0,"Introducing"),a()(it.Z,{size:8}),a()("h1",{style:{...t.header,color:"hsl(203deg 91% 43%)"}},void 0,"Notion Projects"),a()("p",{style:t.subHeader},void 0,"One tool for projects, docs, and wiki",a()("br",{}),a()("span",{style:{display:"inline-flex"}},void 0,"Now with the power of AI",a()(it.Z,{size:4}),g.Z.sparkles({width:14}))),e.device.isMobile?a()(it.Z,{size:20}):null,a()("div",{style:t.videoWrapper},void 0,a()("iframe",{style:t.video,src:"https://www.youtube.com/embed/RDZ3mY10zY8",allowFullScreen:!0}))),a()("footer",{style:t.footer},void 0,a()(ot.Z,{style:t.learnAbout,onClick:t=>{t.preventDefault(),M.navigateToExternalURL({environment:e,url:"https://youtu.be/RDZ3mY10zY8",targetSelf:!1})}},void 0,"Learn about Notion Projects",a()(it.Z,{size:4}),g.Z.settingsConnectedApps({width:20})),a()(Re.Z,{children:"Try it out",onClick:t=>{t.preventDefault(),o&&i&&n&&(rt({environment:e,currentUserSettingsStore:n,phase:"accepted"}),Qe({environment:e,currentSpaceStore:o,currentSpaceViewStore:i,currentUserSettingsStore:n,isUserEngOrProduct:!0}))}})))})})}function rt(e){const{environment:t,currentUserSettingsStore:o,phase:i}=e;o&&Pe.createAndCommit({userAction:"ProjManagementIntroModal.updateHasSeen",environment:t,perform:e=>{P.d2({userSettingsStore:o,transaction:e,data:{pm_announcement_modal_phase:i}})},userId:o.id})}var at=o(78316),st=o(4787),lt=o(7095),ct=o(12318),dt=o(22323);class pt extends l.Z{willMount(){lt.Z.set({collectionContextStore:new st.Z(this.environment),collectionSettingsStore:new ct.default({open:!1,stack:[]})})}renderComponent(){const e=lt.Z.get();if(!e)return;const{collectionSettingsStore:t,collectionContextStore:o}=e;return t.get().open?a()("div",{style:{flexGrow:0,flexShrink:0,zIndex:D.Ze,borderLeft:`1px solid ${this.theme.regularDividerColor}`,alignSelf:"flex-end",position:"absolute",right:0,top:0,height:"100vh",background:this.theme.sidebarBackground,width:at.R7,overflowY:"auto"}},void 0,a()(dt.Z,{collectionContextStore:o,collectionSettingsStore:t,context:dt.H.ViewBlock,fullHeight:!0})):void 0}}pt.displayName="CollectionViewBlockSettings";const ut=(0,w.injectIntl)(pt);var mt=o(96486),gt=o.n(mt),ht=o(80357),ft=o(70203),vt=o(44805),yt=o(24229),bt=o(35973),St=o(48588);function wt(e){const{discussionId:t,level:o}=e;return`\n\t\t.${(0,ht.vE)({level:o})}.${(0,ht.dk)({discussionId:t})}.${vt.kB} {\n\t\t\tbackground: ${(0,m.Hu)(e)} !important;\n\t\t\topacity: unset !important;\n\t\t\tborder-bottom: 2px solid ${m.mO};\n\t\t}\n\t`}function kt(){function e(){var e,t,o;const i=(null===(e=bt.Z.state)||void 0===e?void 0:e.discussionIds)||[],n=null!==(t=yt.Z.state)&&void 0!==t&&t.open&&(null===(o=yt.Z.state)||void 0===o?void 0:o.discussionIds)||[];return[...i.flatMap((e=>mt.times(ht.nB).map((t=>wt({discussionId:e,level:t+1,hovered:!0,selected:!1}))))),...n.flatMap((e=>mt.times(ht.nB).map((t=>wt({discussionId:e,level:t+1,hovered:!1,selected:!0})))))].join("\n")}function t(){var e,t,o;const i=null===(e=St.Z.state)||void 0===e?void 0:e.store,n=null===(t=St.Z.state)||void 0===t||null===(o=t.annotations)||void 0===o?void 0:o.find(ft.j0);if(!n)return"";const r=(0,ft.zW)(n);return"block"!==(null==i?void 0:i.table)?"":`\n\t\t\t.${(0,ht.S$)({href:r,blockId:i.id})}.${vt.kB} {\n\t\t\t\ttransition: border-color 100ms ease-in, opacity 100ms ease-in;\n\t\t\t\tborder-color: currentColor !important;\n\t\t\t\topacity: 1 !important;\n\t\t\t}\n\t\t`}const o=(0,N.VK)((()=>[e(),t()].filter(Boolean).join("\n")),[]);return o?a()("style",{dangerouslySetInnerHTML:{__html:o}}):null}var Ct=o(55367),_t=o(80796),Mt=o(69784);class Tt extends l.Z{constructor(){super(...arguments),this.getCurrentCursor=this.createComputedStore((()=>Mt.Z.state.isActive&&Mt.Z.state.moved?"default":Ct.ZP.state.isDragging?"-webkit-grabbing":"text"))}renderComponent(){const{device:e}=this.environment;let t="notion-cursor-listener";return"-webkit-grabbing"===this.getCurrentCursor.state&&(t+=" notion-disable-local-cursor"),e.isIOS&&("touch"===_t.Z.state.initiator||Ct.ZP.state.isDragging||Mt.Z.state.isActive?document.body.classList.add("notion-disable-webkit-user-select"):document.body.classList.remove("notion-disable-webkit-user-select")),a()("div",{style:this.getStyle(),className:t},void 0,this.props.children)}getStyle(){return{...this.props.style,cursor:this.getCurrentCursor.state}}}Tt.displayName="CursorListener";const It=Tt;var Pt=o(74055),xt=o(7339);function Bt(e){return window.__c={n:"renderCustomerIoInAppCalloutWindow"},a()("div",{id:"test-customer-io",style:{width:334,height:200,position:"absolute",bottom:64,right:21,zIndex:1,display:e?void 0:"none"}})}const Zt=function(){const e=(0,V.O7)(),{currentUser:t}=e,o=(0,N.VK)((()=>xt.C.state.ready),[]),i=(0,N.VK)((()=>t.isLoggedIn()&&o&&R.default.checkGate("customerio")),[t,o]),n=(0,N.VK)((()=>E.default.state.inAppCalloutStore),[]),r=(0,N.VK)((()=>"dark"!==e.ThemeStore.state.mode),[e]);(0,s.useEffect)((()=>{n.canShow("customer_io")?r?n.canShow("customer_io")&&Pt.Z.state.suppressReason===Pt.V.IN_APP_CALLOUT_CONFLICT?(Pt.Z.setState({...Pt.Z.state,isVisible:!0,suppressReason:void 0}),n.updateCalloutStatus({calloutId:"customer_io",visible:!0})):Pt.Z.setState({...Pt.Z.state,suppressReason:void 0}):(Pt.Z.setState({isVisible:!1,suppressReason:Pt.V.DARK_MODE}),n.updateCalloutStatus({calloutId:"customer_io",visible:!1})):(Pt.Z.setState({isVisible:!1,suppressReason:Pt.V.IN_APP_CALLOUT_CONFLICT}),n.updateCalloutStatus({calloutId:"customer_io",visible:!1}))}),[n,r]);const a=(0,N.VK)((()=>Pt.Z.state.isVisible&&n.canShow("customer_io")),[n]);return i?Bt(!!a):null};var Et=o(41892),Rt=o(15095),At=o(43593),Dt=o(17755),Ft=o(42875),Lt=o(79362),Vt=o(22808),Nt=o(64002),Ot=o(617),Ut=o(17731);async function Ht(e){const t=document.createElement("canvas");t.width=32,t.height=32;const o=t.getContext("2d"),i=document.createElement("img");return i.src=e,new Promise((e=>{i.onload=()=>{o.drawImage(i,0,0,32,32),e(t.toDataURL("image/png"))},i.onerror=()=>{e("")}}))}var zt=o(84210),Wt=o(80641),jt=o(39218),Kt=o(76487);class Yt extends l.Z{constructor(){super(...arguments),this.lastSetIconString=void 0,this.updateBrowserState=()=>{const{device:e}=this.environment,t=this.computedStore.state;if(!t)return;const{url:o,title:i,icon:n}=t;let r,a,s;n&&(0,Lt.V2)(n.icon)?s=n.icon:n&&(0,Vt.Z)(n.icon)?r=n.icon:n&&At.F8(n.icon)&&(a=n);const{intl:l}=this.props,c=t.isNonverified&&!t.hasBypassedContentClassification&&!t.isMemberOfSpace;i&&document.title!==i&&(c?document.title=l.formatMessage({id:"pageTitle.flaggedContent",defaultMessage:"Flagged Content"}):e.isSafari&&r?document.title=`${r} ${i}`:document.title=i),o&&Nt.T1(o)!==Nt.T1(ncd.href())&&(ncd.replaceState(window.history.state,void 0,o),M.updateRouterStateForDocumentTitleChange({environment:this.environment,url:ncd.href()}));const d=document.querySelector("link[rel='shortcut icon']");if(d){const e="local"===x.Z.env?Et.Z.images.faviconLocalIco:"development"===x.Z.env?Et.Z.images.faviconDevIco:Et.Z.images.faviconIco;if(c)d.href=e,this.lastSetIconString=e;else if(r)r!==this.lastSetIconString&&(this.lastSetIconString=r,async function(e,t){const o=document.createElement("canvas");o.width=32,o.height=32;const i=o.getContext("2d");if(i.font="normal normal normal 32px/32px sans",i.textAlign="center",i.textBaseline="middle","raw"===t)return i.fillText(e,o.width/2,o.height/2+4),o.toDataURL("image/png");const n=document.createElement("img");n.src=(0,Rt.bk)(t);const r=(0,Rt.yz)(e);if(!r)return;const a=(0,Rt.G0)(r);return new Promise((e=>{n.onload=()=>{i.drawImage(n,a.x,a.y,a.size,a.size,0,0,32,32),e(o.toDataURL("image/png"))},n.onerror=()=>{e("")}}))}(r,(0,Ut.e_)(this.environment)).then((e=>{d.href=e})));else if(s){if(s!==this.lastSetIconString){this.lastSetIconString=s;Ht(`${s}?mode=${this.theme.mode}`).then((e=>{d.href=e}))}}else if(a){const{icon:e,...t}=a,o=Dt.EK({url:e,width:100,permissionRecord:t.pointer,baseUrl:x.Z.domainBaseUrl,fullyQualified:!1,userId:this.environment.currentUser.id});o!==this.lastSetIconString&&(this.lastSetIconString=o,jt.transactionQueue.awaitRecordTransaction(t.pointer).then((()=>Ht(o))).then((e=>{d.href=e})))}else e!==this.lastSetIconString&&(d.href=e,this.lastSetIconString=e)}C.electronApi&&C.electronApi.setWindowTitle&&i&&C.electronApi.setWindowTitle(i)},this.updateBrowserStateDebounced=gt().debounce(this.updateBrowserState,500,{leading:!0}),this.computedStore=this.createComputedStore((()=>{const{intl:e}=this.props,{RouterStore:t,device:o}=this.environment,i=t.state.route,n=E.default.state.mainEditorCurrentBlockStore;if(!n||!n.isReady())return;if("page"!==i.name||i.blockId!==n.id)return;const r=Kt.Z.getTotalUnreadMentionsCount(),a=n.getTitleStore();let s;const l=n.getModel(),c=n.getCollectionViewIds(),d=null==a?void 0:a.getRecordModel(a.pointer);if(a&&d){if(s=vt.Xh({intl:Ge.default.getIntl(),textValue:a.getValue(),userTimeZone:(0,Ft.r)(),getRecordModel:n.getRecordModel})||d.getEmptyTitlePlaceholder({getRecordModel:a.getRecordModel,userTimeZone:(0,Ft.r)(),intl:e}),"collection"===a.table&&l&&l.isCollectionView()&&c.length>1){const e=E.default.state.currentCollectionViewStore;e&&e.getName()&&(s=`${s} | ${e.getName()}`)}o.isElectron||(s=(0,Rt.db)(s.slice(0,100))),q.IJ(this.environment,n)||this.environment.device.isElectron||(r>9?s=`(9+) ${s}`:r>0&&(s=`(${r}) ${s}`))}const p=(0,zt.ZP)({store:n,fullyQualified:!1,scrollToBlockId:i.scrollToBlockId,peekViewBlockId:i.peekViewBlockId,peekMode:i.peekMode,collectionViewId:i.collectionViewId,discussionId:i.discussionId,showMoveTo:i.showMoveTo,saveParent:i.saveParent,templateGalleryItem:i.templateGalleryItem}),u=n.getIcon(),m=null==l?void 0:l.isNonverifiedContentClassification();return{title:s,url:p,icon:u,isNonverified:m,hasBypassedContentClassification:m&&l&&Wt.Z.bypassedPage(n.id),isMemberOfSpace:(0,Ot.I)({blocks:[n],environment:this.environment,publicEditMode:void 0})}}))}willMount(){this.savedTitle=document.title,this.computedStore.addListener(this.updateBrowserStateDebounced)}willUnmount(){this.computedStore.removeListener(this.updateBrowserStateDebounced),document.title=this.savedTitle}}Yt.displayName="DocumentTitleListener";const Gt=(0,w.injectIntl)(Yt);class Xt extends l.Z{constructor(){super(...arguments),this.konami=void 0,this.unlock=!1,this.handleSuccess=()=>{this.unlock=!0,this.forceUpdate()}}willMountOrUpdate(){this.environment.device.isDesktop?this.loadKonami():this.unloadKonami()}loadKonami(){var e,t;this.konami||(this.konami=(e=this.handleSuccess,(t={addEvent:function(e,t,o){e.addEventListener(t,o,!1)},removeEvent:function(e,t,o){e.removeEventListener(t,o)},input:"",pattern:"38384040373937396665",keydownHandler:function(o){t.input+=o.keyCode,t.input.length>t.pattern.length&&(t.input=t.input.substr(t.input.length-t.pattern.length)),t.input===t.pattern&&(e(),t.input="")},load:function(){this.addEvent(document,"keydown",this.keydownHandler)},unload:function(){this.removeEvent(document,"keydown",this.keydownHandler)}}).load(),t))}unloadKonami(){this.konami&&(this.konami.unload(),this.konami=void 0)}renderComponent(){if(this.unlock)return a()("img",{className:"nyan",style:{position:"fixed",top:"calc(50vh - 100px)",zIndex:1e3,left:"50%",animationName:"leftOrRight",animationDuration:"9s",animationIterationCount:"infinite",pointerEvents:"none",userSelect:"none"},src:Et.Z.images.nyancatGif})}}Xt.displayName="EasterEgg";const qt=Xt;var $t=o(15944),Jt=o(81415);const Qt=(0,w.defineMessages)({pressSlashHeader:{id:"EducationTooltips.pressSlash.header",defaultMessage:"Press {slashkey} for commands",description:"Header for the tooltip to introduce the '/' key to show the slash menu"}});function eo(e){return window.__c={n:"Key"},a()("div",{style:{background:m.ZP.whiteWithAlpha(.1),padding:3,paddingRight:8,paddingLeft:8,marginRight:6,marginLeft:6,borderRadius:3}},void 0,e.char)}function to(){window.__c={n:"PressSlashTooltip"};const e=(0,V.O7)(),t=$t.o();return(0,N.VK)((()=>{const{currentUserSettingsStore:e}=E.default.state;var t;return!e||!e.isReady()||Boolean(null===(t=e.getSettings())||void 0===t?void 0:t.pressed_slash_tooltip)}),[])||e.device.isMobile||!t?null:a()(Jt.U,{hideCloseButton:!0,origin:()=>t.getNode(),placementToOrigin:"bottom",header:s.createElement(w.FormattedMessage,n()({},Qt.pressSlashHeader,{values:{slashkey:a()(eo,{char:"/"})}})),content:null,onCloseClick:()=>$t.q(e)})}var oo=o(21202),io=o(3297),no=o(60709),ro=o(15517),ao=o(78140),so=o(9342),lo=o(72495),co=o(26673);class po extends l.Z{constructor(){super(...arguments),this.didSingleWorkspaceFork=!1}didMountOrUpdate(){const e=(e,t,o,i)=>{this.didSingleWorkspaceFork=!0;return io.DK({environment:this.environment,store:e,spaceStore:t,spaceViewStore:o,isPrivate:i,context:"public_page_duplicate_single_workspace"})};if(!this.environment.currentUser.isLoggedIn()){const{environment:e}=this;return ro.nM({currentUserId:void 0,blockId:this.props.blockId}),"public_page"===this.props.from&&k.trackDuplicateTemplateAttempt(e,{from:"public_page",is_paid:!1,template_block_id:this.props.blockId,public_page_device_id:this.props.tid}),void M.navigate({environment:e,url:y._j.login})}const{currentUserRootStore:t}=E.default.state;if(t&&t&&!this.didSingleWorkspaceFork){const o=A.G.createChildStore(t,{table:oo.iU,id:this.props.blockId}),i=K.o(t);if(1===i.length){const t=i[0],n=t.getSpaceStore();if(!n)return;e(o,n,t,!0)}else if(this.props.workspaceId&&i.length>1){const t=i.filter((e=>e.pointer.spaceId===this.props.workspaceId))[0],n=null==t?void 0:t.getSpaceStore();if(!n)return;e(o,n,t,!0)}}}renderComponent(){const{device:e}=this.environment,{currentUserRootStore:t}=E.default.state;if(!t)return;const{mainEditorCurrentBlockStore:o}=E.default.state;if(!o)return;if(!o.isDefined())return;const i=[{key:"spaces",render:t=>s.createElement(lo.Z,n()({title:e.isMobile?void 0:a()(w.FormattedMessage,{id:"forkPageScreen.chooseWorkspaceForDuplication.message",defaultMessage:"Choose a workspace to duplicate into",description:"Message to the user indicating the menu option to choose a workspace for duplicating the content into."}),isTitleUppercase:!0},t)),items:co.default.getSpaceViewMenuItems(this.environment,o)}];let r;return r=e.isMobile?{menuType:no.og.Modal,title:a()(w.FormattedMessage,{id:"forkPageScreen.chooseWorkspace.message",defaultMessage:"Choose a workspace"}),width:"100vw"}:{menuType:no.og.Popup,height:"auto"},a()(Fe.Z,{open:!0,render:()=>a()("div",{style:this.getStyle()},void 0,s.createElement(ao.Z,r,a()(so.Z,{type:so.i.Vertical,sections:i,initialFocus:1})))})}getStyle(){const{device:e}=this.environment;return{width:"100vw",height:"100vh",paddingLeft:e.isMobile?16:30,paddingRight:e.isMobile?16:30,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}}po.displayName="ForkPageScreen";const uo=po;var mo=o(2700),go=o(45055),ho=o(19889),fo=o(82990),vo=o(7928),yo=o(95489),bo=o(31304),So=o(28040),wo=o(28125),ko=o(26374),Co=o(88632),_o=o(33759),Mo=o(12768),To=o(49085);class Io extends To.Z{getInitialState(){return{isCreatingSpace:!1}}}const Po=Io;var xo=o(88923),Bo=o(8675),Zo=o(61519),Eo=o(16354),Ro=o(84076),Ao=o(63296),Do=o(31278),Fo=o(36360),Lo=o(63209),Vo=o(35708),No=o(12337),Oo=o(54642),Uo=o(33954),Ho=o(61766),zo=o(1743),Wo=o(74194),jo=o(44532),Ko=o(77137);const Yo=(0,w.defineMessages)({requestAccessMessagePlaceholder:{defaultMessage:"Message (optional)",id:"requestAccessForm.messageInput.placeholder"}});function Go(){return window.__c={n:"cancelText"},a()(w.FormattedMessage,{defaultMessage:"Cancel",id:"requestAccessForm.cancelButton.label"})}class Xo extends l.Z{constructor(){super(...arguments),this.storeTypes={requestAttempt:ct.default.of(0),message:ct.default.of(void 0),buttonPopupStore:Ho.Z},this.renderPopup=()=>this.isPhone?a()(ao.Z,{menuType:no.og.Modal,whiteBackground:!0,title:(window.__c={n:"titleText"},a()(w.FormattedMessage,{id:"requestAccessForm.title.label",defaultMessage:"Request access"})),left:Go(),onClickLeft:this.handleCloseClicked,right:a()(w.FormattedMessage,{id:"requestAccessForm.mobileSend.label",defaultMessage:"Send"}),onClickRight:this.handleSendRequestClicked},void 0,a()(zo.Z,{capture:!0},void 0,a()("div",{style:{display:"flex",flexDirection:"column",justifyContent:"stretch",alignItems:"stretch",width:"100%",height:"100%"}},void 0,a()(Ko.Z,{request:this.stores.requestAttempt.state,performRequest:this.submitRequest,render:this.renderRequest})))):a()(zo.Z,{capture:!0},void 0,a()("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-evently",alignItems:"stretch",padding:"20px 28px 24px",width:"340px"}},void 0,a()(Ko.Z,{request:this.stores.requestAttempt.state,performRequest:this.submitRequest,render:this.renderRequest}),a()(Ao.Z,{onClick:this.handleCloseClicked},void 0,Go()))),this.renderRequest=(e,t,o)=>{const i=Boolean(0===this.stores.requestAttempt.state||o&&t&&t.error);return s.createElement(s.Fragment,null,!this.isPhone&&a()("div",{style:{fontSize:16,fontWeight:fo.Z.fontWeight.semibold,marginBottom:16}},void 0,a()(w.FormattedMessage,{defaultMessage:"Request access",id:"requestAccessForm.sendRequestButton.title"})),a()(Wo.Z,{format:this.isPhone?Wo.Z.Format.Transparent:void 0,textarea:!0,value:this.stores.message.state||"",onChange:this.handleMessageChanged,disabled:!i,placeholder:this.props.intl.formatMessage(Yo.requestAccessMessagePlaceholder),style:{...this.isPhone?{...Xo.mobileTextAreaStyle,padding:"16px"}:{...Xo.marginBottomStyle,marginBottom:16,padding:"8px 12px",alignItems:"flex-start"}}}),!this.isPhone&&a()(Re.Z,{isLarge:!0,disabled:!i,onClick:this.handleSendRequestClicked,style:Xo.marginBottomStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"Send request",id:"requestAccessForm.sendRequestButton.label"})),this.renderError(t))},this.submitRequest=async e=>{if(0===e)return;const t=await Oo.requestAccess(this.environment,{type:"current-actor-to-block",block:this.props.block,message:this.stores.message.state});return"success"!==t.type?{error:(0,Uo.wf)(this.props.intl,t)}:(k.trackRequestAccess(this.environment),this.stores.buttonPopupStore.reset(),{value:!0})},this.handleSendRequestClicked=()=>{this.stores.requestAttempt.update((e=>e+1))},this.handleMessageChanged=e=>{this.stores.message.setState(e.target.value)},this.handleOpenClicked=()=>this.stores.buttonPopupStore.setState({open:!0}),this.handleCloseClicked=()=>this.stores.buttonPopupStore.setState({open:!1})}renderComponent(){const e=this.stores.requestAttempt.state>0;return s.createElement(s.Fragment,null,a()(Re.Z,{isLarge:!0,disabled:e,onClick:this.handleOpenClicked},void 0,a()(w.FormattedMessage,e?{id:"fullPageError.requestAccessButton.requested",defaultMessage:"Requested access"}:{id:"fullPageError.requestAccessButton.label",defaultMessage:"Request access"})),this.isPhone?a()(jo.ZP,{popupType:jo.ZP.PopupType.SlideUp,open:this.stores.buttonPopupStore.state.open,render:this.renderPopup}):a()(Fe.Z,{open:this.stores.buttonPopupStore.state.open,onDismiss:this.handleCloseClicked,render:this.renderPopup}))}renderError(e){if(e&&e.error)return a()("div",{style:{color:m.ZP.redWithAlpha(1),textAlign:"center",width:"100%"}},void 0,e.error)}get isPhone(){return this.environment.device.isPhone}}Xo.displayName="RequestAccessForm",Xo.marginBottomStyle={marginBottom:10},Xo.mobileTextAreaStyle={...Xo.marginBottomStyle,width:"100%",height:"100%",padding:10,alignItems:"top",borderRadius:0};const qo=(0,w.injectIntl)(Xo);class $o extends l.Z{constructor(){super(...arguments),this.didPerformAction=!1,this.storeTypes={store:Po,sudoModeStore:Bo.Z},this.handleHelpButtonClick=()=>{I.j({environment:this.environment,from:"page_error"})},this.handleSwitchAccountClick=()=>{const{loggedInUserIds:e,id:t}=this.environment.currentUser;if(2===e.length){const o=e.filter((e=>e!==t))[0],{mainEditorCurrentBlockStore:i}=E.default.state;i&&T.f({environment:this.environment,newCurrentUserId:o,store:i})}},this.handleGoBackClick=()=>{const{currentUserRootStore:e,currentUserSettingsStore:t}=E.default.state;e&&t&&Ie.L5({environment:this.environment,userRootStore:e,userSettingsStore:t})},this.handleCreateAccountClick=async()=>{const{currentUserRootStore:e,currentUserStore:t}=E.default.state;e&&t&&(this.stores.store.setState({...this.stores.store.state,isCreatingSpace:!0}),await yo.xN(this.environment),this.stores.store.setState({...this.stores.store.state,isCreatingSpace:!1}))},this.handleReturnToOnboarding=()=>{const e=Mo.default.state;e.isOnboarding?ko.n0(e)?yo.I1(this.environment,{type:"new-user",disableRedirectUrl:!0}):ko.y7(e)?yo.I1(this.environment,{type:"create-or-join",disableRedirectUrl:!0}):(Mo.default.reset(),M.navigate({environment:this.environment,url:y._j.root})):(Mo.default.reset(),M.navigate({environment:this.environment,url:y._j.root}))},this.handleContentClassificationProceed=()=>{const{mainEditorCurrentBlockStore:e}=E.default.state;e&&(Wt.Z.bypassPage(e.id),k.trackContentClassificationProceed(this.environment))}}willMount(){xo.default.state.open&&bo.v(xo.default.state.presenceStore,this.environment),bo.v(E.default.state.presenceStore,this.environment)}didMount(){if(super.didMount(),B.default.setInitialRenderCompleted(),this.environment.device.isElectron||this.environment.mobileNative){var e;const t=null===(e=this.props.publicPageData)||void 0===e?void 0:e.requireInterstitial;if(t){const e=t+window.location.hash;M.navigateToExternalURL({environment:this.environment,url:e}),M.back(this.environment)}}}willMountOrUpdate(){var e;So.i({environment:this.environment,sudoModeStore:this.stores.sudoModeStore,pageBlockId:null===(e=E.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.id})}renderComponent(){const{publicPageData:e}=this.props;if(!this.didPerformAction){if(Co.Z.state.online){if(e&&"onboarding"===this.props.route.name)return this.renderWorkspaceNoAccess(e,"onboarding");if(null!=e&&e.spaceName){var t;const{currentUserRootStore:o,mainEditorCurrentBlockStore:i}=E.default.state;if(e.requireInterstitial)return this.renderIncorrectDomainInterstitialBlock({href:e.requireInterstitial+window.location.hash,urlToDisplay:e.requireInterstitial});if(null!=i&&null!==(t=i.getModel())&&void 0!==t&&t.isNonverifiedContentClassification())return this.renderContentClassificationBlock();if(this.isLoggedIn()){if(!o||!o.isReady())return;const t=o.getSpaceViewStores();if(!t.every((e=>e.isReady())))return;return t.find((t=>t.getSpaceId()===e.spaceId))&&"page"===this.props.route.name?this.renderWorkspacePrivatePageNoAccess(e):e.canJoinSpace?(this.performJoinWorkspaceRedirect(e),null):this.renderWorkspaceNoAccess(e,"workspace")}return e.requireLogin,this.renderLoggedOutWorkspace(e)}return this.render404()}return this.renderOffline()}}renderOffline(){return k.trackPageError(this.environment,{type:"offline"}),k.trackOfflineAccessFailure(this.environment,{type:"page_error"}),a()("div",{style:this.getStyle()},void 0,a()("div",{style:this.getGreetingStyle()},void 0,a()(w.FormattedMessage,{id:"fullPageError.offlineError.message",defaultMessage:"Oops, you seem to be offline. Please go online to view this page."}),this.renderLoggedInFooter()))}renderContentClassificationBlock(){const e=this.isLoggedIn();return k.trackPageError(this.environment,{type:"content_classification_block"}),a()("div",{style:this.getStyle()},void 0,a()(No.Z,{type:No.Z.Type.Unsafe}),a()("div",{style:this.getGreetingStyle()},void 0,a()(w.FormattedMessage,{id:"fullPageError.unsafePageError.title",defaultMessage:"This page has been flagged as unsafe"})),a()(Ve.Z,{isSmall:!1,isSecondaryColor:!0,isMultiline:!0,style:{textAlign:"center",marginBottom:18,maxWidth:440}},void 0,a()(w.FormattedMessage,{id:"fullPageError.unsafePageError.message",defaultMessage:"This page may contain spam, phishing, illegal, or inappropriate content. If you received this link from an unknown source, we suggest you to close this tab. <proceedanywaylink>Proceed anyway</proceedanywaylink>",values:{proceedanywaylink:e=>a()(Ne.Z,{onClick:this.handleContentClassificationProceed},void 0,e)}})),e&&this.renderNavigateButton("blue"),!e&&this.renderLoggedOutFooter())}renderIncorrectDomainInterstitialBlock(e){let{href:t,urlToDisplay:o}=e;return k.trackPageError(this.environment,{type:"incorrect_domain_interstitial_block"}),a()("div",{style:{position:"relative",height:"100%",width:"100%"}},void 0,a()("div",{style:{...this.getStyle(),height:"100%"}},void 0,a()("div",{style:{...this.getGreetingStyle(),maxWidth:"240px"}},void 0,a()(w.FormattedMessage,{id:"fullPageError.publicDomainInterstitial.title",defaultMessage:"Continue to external site by following the link below"})),a()(Ve.Z,{isSmall:!1,isSecondaryColor:!0,isMultiline:!0,style:{textAlign:"center",marginBottom:18,maxWidth:440}},void 0,a()(Eo.Z,{href:t,external:!1,style:{textDecoration:"underline",color:m.ZP.blue,overflowWrap:"anywhere"}},void 0,o))),a()("div",{style:{position:"fixed",width:"100%",bottom:0}},void 0,this.renderMinimalInterstitialFooter()))}renderWorkspaceNoAccess(e,t){if("onboarding"===t)k.trackPageError(this.environment,{type:"onboarding_error"});else if(k.trackPageError(this.environment,{type:"team_no_access"}),this.isRequestAccessEnabled())return this.renderRequestAccessLoggedInPrivatePage(e);return a()("div",{style:this.getStyle()},void 0,this.environment.device.isElectron&&a()(Fo.Z,{title:Ge.default.getIntl().formatMessage({defaultMessage:"No access",id:"errorPage.workspaceNoAccess.title",description:"The tab title displayed in the desktop app when the user doesn't have access to a page"})}),a()(No.Z,{type:No.Z.Type.NoAccess,publicPageData:e}),a()("div",{style:this.getGreetingStyle()},void 0,a()(w.FormattedMessage,{id:"fullPageError.accessNotAllowed.message",defaultMessage:"You do not have access to {workspaceName}. Please contact an admin to add you as a member.",values:{workspaceName:a()("span",{style:$o.headerBoldStyle},void 0,e.spaceName)}})),this.renderNavigateButton("blue"),this.renderLoggedInFooter())}renderWorkspacePrivatePageNoAccess(e){if(k.trackPageError(this.environment,{type:"team_page_no_access"}),this.isRequestAccessEnabled())return this.renderRequestAccessLoggedInPrivatePage(e);const{mainEditorCurrentBlockStore:t}=E.default.state,o=e.ownerUserId&&t?A.t1.createChildStore(t,{table:ho.KJ,id:e.ownerUserId}):void 0,i=Ge.default.getIntl();return a()("div",{style:this.getStyle()},void 0,a()(No.Z,{type:No.Z.Type.NoAccess,publicPageData:e}),a()("div",{style:this.getGreetingStyle()},void 0,a()(w.FormattedMessage,{id:"fullPageError.pageIsPrivate.message",defaultMessage:"This is a private page in {workspaceName}. {hasOwner, select, true {Please contact {ownerName} ({ownerEmail}) to invite you to collaborate.} other {Please contact the page owner to invite you to collaborate.}}",values:{hasOwner:Boolean(null==o?void 0:o.isDefined()),workspaceName:a()("span",{style:$o.headerBoldStyle},void 0,e.spaceName),ownerName:null!=o&&o.isDefined()?(0,vo.Nz)(i,o.getModel()):void 0,ownerEmail:(null==o?void 0:o.getEmail())??""}})),this.renderNavigateButton("blue"),this.renderLoggedInFooter())}getPrivatePageTitle(){const e=this.stores.sudoModeStore.state.privatePageStore;if(!this.stores.sudoModeStore.shouldUserHaveAccessToPrivatePageBlock()||!e)return;const t=e.getModel();if(!t)return;const o=t.getRenderTitle({getRecordModel:e.getRecordModel,userTimeZone:(0,Ft.r)(),intl:Ge.default.getIntl()}),i=t.getRenderIcon({getRecordModel:e.getRecordModel});return s.createElement(s.Fragment,null,i&&a()(Do.Z,{isEmptyPage:!0,disabled:!0,icon:i,size:24,style:{display:"inline-block",marginRight:4}}),o&&a()("span",{},void 0,o))}renderChangingPermissionsHeading(){var e;const t=this.getPrivatePageTitle(),o=null===(e=E.default.state.currentSpaceStore)||void 0===e?void 0:e.getName();return a()("div",{style:{background:this.theme.cardBackground,borderRadius:3,padding:18,margin:"24px auto 0",width:400}},void 0,a()("div",{style:{...this.getGreetingStyle(),fontWeight:fo.Z.fontWeight.semibold,marginBottom:6}},void 0,a()(w.FormattedMessage,t?{id:"fullPageError.changePermissions.titleWithPageName",defaultMessage:"Change permissions for {pageTitle}",description:"Explaining that the user is changing permissions of the page they're trying to access and you can see the page title.",values:{pageTitle:t}}:{id:"fullPageError.changePermissions.title",defaultMessage:"Change permissions for this page",description:"Explaining that the user is changing permissions of the page they're trying to access and you can see the page title."})),a()(Ve.Z,{isMultiline:!0,style:{textAlign:"center"}},void 0,a()(w.FormattedMessage,o?{id:"fullPageError.workspaceOwner.changePermissions.descriptionWithSpaceName",defaultMessage:"As a workspace owner for <b>{spaceName}</b>, you can change the permissions of this page.",description:"Explaining that a workspace owner can change the permissions of this page and you can see the workspace name.",values:{b:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return a()("b",{},void 0,t)},spaceName:o}}:{id:"fullPageError.workspaceOwner.changePermissions.description",defaultMessage:"As an owner of this workspace, you can change the permissions of this page.",description:"Explaining that a workspace owner can change the permissions of this page.",values:{b:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return a()("b",{},void 0,t)}}})))}renderRequestAccessLoggedInPrivatePageHeading(e){const t=this.getPrivatePageTitle(),o=e.canRequestAccess;return s.createElement(s.Fragment,null,a()("div",{},void 0,g.Z.notionLogoStroked({width:50,height:50,marginBottom:16})),a()("div",{style:{...this.getGreetingStyle(),fontWeight:fo.Z.fontWeight.semibold,marginBottom:6}},void 0,a()(w.FormattedMessage,o?t?{id:"fullPageError.canRequestAccess.titleWithPageName",defaultMessage:"No access to {pageTitle}",description:"Explaining that the user has no access to the page they're trying to access and you can see the page title.",values:{pageTitle:t}}:{id:"fullPageError.canRequestAccess.title",defaultMessage:"No access to this page"}:{id:"fullPageError.noAccess.title",defaultMessage:"Page not found"})),a()("div",{style:{...this.getGreetingStyle(),color:this.theme.mediumTextColor,fontWeight:fo.Z.fontWeight.regular,lineHeight:1.4}},void 0,a()(w.FormattedMessage,o?{id:"fullPageError.canRequestAccess.message",defaultMessage:"You can access this page if someone approves your request."}:{id:"fullPageError.cannotRequestAccess.message",defaultMessage:"Either this page doesn't exist or you don't have permission to access it."})))}renderRequestAccessLoggedInPrivatePage(e){const t=this.stores.sudoModeStore.shouldUserHaveAccessToPrivatePageBlock&&this.stores.sudoModeStore.shouldUserHaveAccessToPrivatePageBlock()&&this.stores.sudoModeStore.state.changePermissionsEnabled;return a()("div",{style:this.getStyle()},void 0,t?this.renderChangingPermissionsHeading():s.createElement(s.Fragment,null,this.renderRequestAccessLoggedInPrivatePageHeading(e),this.renderRequestAccessActions()),this.stores.sudoModeStore.shouldUserHaveAccessToPrivatePageBlock()?this.renderPageBlockPermissionsMenu():null,this.renderLoggedInFooter())}renderLoggedOutWorkspace(e){const{device:t}=this.environment;return k.trackPageError(this.environment,{type:"team_login"}),a()(De.Z,{capture:!0,render:o=>a()(Lo.Z,{analyticsName:"team_login",hideNavItems:!0,hideNotificationBanner:!0,hideFooter:!0},void 0,s.createElement("div",n()({style:this.getFrontBaseStyle()},o),this.environment.device.isElectron&&a()(Fo.Z,{title:Ge.default.getIntl().formatMessage({defaultMessage:"Log in",id:"errorPage.loggedOutWorkspace.title",description:"The tab title displayed in the desktop app when the user is logged out of their workspace"})}),a()(No.Z,{type:No.Z.Type.NoAccess,publicPageData:e}),a()("div",{style:this.getGreetingStyle()},void 0,a()(w.FormattedMessage,{id:"fullPageError.loggedOut.message",defaultMessage:"Welcome to {workspaceName} on Notion.",values:{workspaceName:a()("span",{style:$o.headerBoldStyle},void 0,e.spaceName)}})),a()(Vo.Z,{emailLabelType:"email",style:$o.loginStyle,emailPasscodePlaceholderType:"enter_code",emailInputAutoFocus:!0,from:"pageError",loginStore:_o.Z}),t.isMobile&&!t.isMobileNative&&a()(s.Fragment,{},void 0,a()("div",{style:{height:1,width:"100vw",background:this.theme.regularDividerColor,marginTop:36,marginBottom:36}}),a()(Re.Z,{style:{width:280},isLarge:!0,onClick:()=>{M.openInNativeApp({url:ncd.href(),environment:this.environment})}},void 0,t.isIOS?g.Z.appleLogo($o.storeIconStyle):g.Z.googlePlay($o.storeIconStyle)," ",a()(w.FormattedMessage,{id:"fullPageError.openInMobileAppButton.label",defaultMessage:"Open in mobile app"})),a()(Ro.Z,{href:t.isIOS?y._j.appStore:y._j.playStore,external:!0,innerStyle:{marginTop:16}},void 0,a()(Ve.Z,{isSmall:!0,style:{textDecoration:"underline",fontSize:14}},void 0,a()(w.FormattedMessage,{id:"fullPageError.downloadMobileAppButton.label",defaultMessage:"Get mobile app"})))),this.renderLoggedOutFooter()))})}render404(){const{device:e}=this.environment,t=this.isLoggedIn();return k.trackPageError(this.environment,{type:"404"}),a()("div",{},void 0,this.renderTopbar(),a()("div",{style:{...this.getFrontBaseStyle(),marginTop:e.isMobile?0:"12vh",justifyContent:"start"}},void 0,a()(No.Z,{type:No.Z.Type.NotFound}),a()("div",{style:this.getGreetingStyle()},void 0,a()(w.FormattedMessage,{id:"fullPageError.contentDoesNotExist.title",defaultMessage:"This content does not exist"})),!t&&this.renderLoggedOutFooter(),t&&this.renderNavigateButton("blue"),this.renderDivider(),a()(Ve.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,a()(w.FormattedMessage,{id:"fullPageError.contentDoesNotExist.message",defaultMessage:"Having trouble? <helplink>Message support</helplink>",values:{helplink:e=>a()(Ne.Z,{onClick:this.handleHelpButtonClick},void 0,e)}}))))}renderWorkspaceOwnerPermissionsMenu(){return this.stores.sudoModeStore.shouldUserHaveAccessToPrivatePageBlock()&&this.stores.sudoModeStore.state.privatePageStore&&!this.stores.sudoModeStore.state.changePermissionsEnabled?a()("div",{style:{background:this.theme.cardBackground,borderRadius:3,padding:18,margin:24,width:400}},void 0,a()(Ve.Z,{isMultiline:!0,style:{textAlign:"center"}},void 0,a()(w.FormattedMessage,{id:"fullPageError.workspaceOwner.canChangePermissionsMessage",defaultMessage:"As a <b>workspace owner</b>, you can change the permissions of this page to add yourself or others. Any changes will appear in the audit log.",description:"Explaining that a workspace owner can change the permissions of this page.",values:{b:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return a()("b",{},void 0,t)}}})),a()(Ao.Z,{style:{fontWeight:fo.Z.fontWeight.medium,justifyContent:"center",margin:"18px auto 12px"},onClick:()=>this.stores.sudoModeStore.setState({...this.stores.sudoModeStore.state,changePermissionsEnabled:!0})},void 0,g.Z.settingsSecurity({width:16,height:16,marginRight:6}),a()(w.FormattedMessage,{id:"fullPageError.workspaceOwner.canChangePermissionsMessageButton",defaultMessage:"Change permissions",description:"Button for the workspace owner to activate their ability to share permissions of this page."}))):null}renderPageBlockPermissionsMenu(){return this.stores.sudoModeStore.shouldUserHaveAccessToPrivatePageBlock()&&this.stores.sudoModeStore.state.privatePageStore&&this.stores.sudoModeStore.state.changePermissionsEnabled?a()("div",{style:{textAlign:"left",borderRadius:4,background:this.theme.modalBackground,position:"relative",boxShadow:this.theme.mediumBoxShadow,width:470,margin:"24px auto"}},void 0,a()(Z.LazyShareMenuContainer,{store:this.stores.sudoModeStore.state.privatePageStore,sudoModeStore:this.stores.sudoModeStore,location:"no_access_page"})):null}renderDivider(){return a()(Zo.Z,{size:48,innerStyle:{maxWidth:280}})}renderRequestAccessActions(){const{publicPageData:e}=this.props;if(!(0,q.uT)(this.environment))return this.renderNavigateButton("blue");if(!e)return this.renderNavigateButton("blue");if(!e.canRequestAccess)return this.renderNavigateButton("blue");const{mainEditorCurrentBlockStore:t}=E.default.state;return t?a()("div",{style:{display:"flex",flexDirection:"row"}},void 0,a()("div",{style:{marginTop:8}},void 0,a()(qo,{block:{id:t.id,spaceId:(0,f.CG)(t.pointer.spaceId)}})),a()("div",{style:{width:10,height:10}}),this.renderNavigateButton("white")):this.renderNavigateButton("blue")}renderNavigateButton(e){const{currentUserRootStore:t}=E.default.state,{isCreatingSpace:o}=this.stores.store.state,i=this.theme,r=t=>"blue"===e?s.createElement(Re.Z,t):s.createElement(Ao.Z,n()({backgroundColor:i.whiteButtonBackground},t,{style:{fontWeight:fo.Z.fontWeight.medium,height:"auto",...t.style}}));return"onboarding"===this.props.route.name?a()(r,{isLarge:!0,onClick:this.handleReturnToOnboarding},void 0,a()(w.FormattedMessage,{defaultMessage:"Back to onboarding",id:"fullPageError.returnToOnboardingButton.label"})):t&&0===t.getSpaceViewPointers().length||o?a()(r,{isLarge:!0,onClick:this.handleCreateAccountClick,disabled:o},void 0,a()(w.FormattedMessage,{id:"fullPageError.createOrJoinWorkspaceButton.label",defaultMessage:"Create or join a workspace"})):a()(r,{isLarge:!0,style:{marginTop:8},onClick:this.handleGoBackClick},void 0,a()(w.FormattedMessage,{id:"fullPageError.backToMyContentButton.label",defaultMessage:"Back to my content"}))}renderLoggedInFooter(){const e=(0,K.B7)(this.environment);let t;return t=jt.transactionQueue.hasTasks()?a()(Ve.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},void 0,a()(w.FormattedMessage,{id:"fullPageError.sendMessageForHelp.message",defaultMessage:"<sendmessagelink>Message support</sendmessagelink> for help.",values:{sendmessagelink:e=>a()(Ne.Z,{onClick:this.handleHelpButtonClick},void 0,e)}})):this.isRequestAccessEnabled()?2===this.environment.currentUser.loggedInUserIds.length?a()(Ve.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},void 0,a()(w.FormattedMessage,{id:"fullPageError.wrongAccountRequestAccessSwitchAccount.message",defaultMessage:"You may need to <switchlink>switch accounts</switchlink> or <loginlink>log in</loginlink> with a different email.",values:{loginlink:e=>wo.kH(this.environment)?a()(Ne.Z,{onClick:this.handleGoBackClick},void 0,e):a()(Ne.Z,{href:y._j.logout,onClick:()=>me.logout(this.environment)},void 0,e),switchlink:e=>a()(Ne.Z,{onClick:this.handleSwitchAccountClick},void 0,e)}})):a()(Ve.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},void 0,a()(w.FormattedMessage,{id:"fullPageError.wrongAccountRequestAccess.message",defaultMessage:"You might need to <loginlink>log in</loginlink> with a different email.",values:{loginlink:e=>wo.kH(this.environment)?a()(Ne.Z,{onClick:this.handleGoBackClick},void 0,e):a()(Ne.Z,{href:y._j.logout,onClick:()=>me.logout(this.environment)},void 0,e)}})):a()(Ve.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},void 0,a()(w.FormattedMessage,{id:"fullPageError.wrongAccount.message",defaultMessage:"You might need to <loginlink>log in</loginlink> with a different email, or contact the page's owner to request access to this page.",values:{loginlink:e=>wo.kH(this.environment)?a()(Ne.Z,{onClick:this.handleGoBackClick},void 0,e):a()(Ne.Z,{href:y._j.logout,onClick:()=>me.logout(this.environment)},void 0,e)}})),a()("div",{style:{textAlign:"center"}},void 0,this.stores.sudoModeStore.shouldUserHaveAccessToPrivatePageBlock()?this.renderWorkspaceOwnerPermissionsMenu():this.renderDivider(),a()(Ve.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},void 0,a()(w.FormattedMessage,{id:"fullPageError.wrongLoggedInUserError.message",defaultMessage:"You're currently logged in as {currentlyLoggedInUser}",values:{currentlyLoggedInUser:a()("span",{style:{color:this.theme.regularTextColor}},void 0,null==e?void 0:e.getEmail())}})),t)}renderMinimalInterstitialFooter(){return a()("div",{style:$o.loggedOutFooterWrapStyle},void 0,a()(Ve.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!1,style:{textAlign:"center",marginBottom:18,maxWidth:440}},void 0,a()("div",{style:{display:"flex"}},void 0,a()(w.FormattedMessage,{id:"fullPageError.somethingWrong.label",defaultMessage:"Something wrong?"}),a()(Eo.Z,{onClick:this.handleHelpButtonClick,style:{textDecoration:"underline",paddingLeft:"4px"}},void 0,a()(w.FormattedMessage,{id:"fullPageError.reportAProblem.label",defaultMessage:"Report a problem"})))))}renderLoggedOutFooter(){return a()("div",{style:$o.loggedOutFooterWrapStyle},void 0,a()(Eo.Z,{href:y.AR.product,external:!0},void 0,a()(Le.Z,{isGray:!0},void 0,g.Z.notionLogo({width:16,height:16,marginRight:8}),a()(w.FormattedMessage,{id:"fullPageError.whatIsNotionButton.label",defaultMessage:"What is Notion?"}))),a()(Le.Z,{onClick:this.handleHelpButtonClick,style:{marginLeft:4},isGray:!0},void 0,a()(w.FormattedMessage,{id:"fullPageError.sendMessageButton.label",defaultMessage:"Message support"})),a()(Eo.Z,{href:y._j.termsAndPrivacy,external:!0,style:{marginLeft:4}},void 0,a()(Le.Z,{isGray:!0},void 0,a()(w.FormattedMessage,{id:"fullPageError.termsAndPrivacyButton.label",defaultMessage:"Terms"}))))}renderTopbar(){const{isMobile:e}=this.environment.device;return a()("div",{style:{display:"flex",alignItems:"center",maxWidth:1300,height:80,paddingLeft:20,paddingRight:20}},void 0,g.Z.notionLogoStroked({width:e?28:30,height:e?28:30,marginRight:10,flexShrink:0}),a()("div",{style:{fontWeight:fo.Z.fontWeight.medium,fontSize:16}},void 0,"Notion"))}isLoggedIn(){return!!this.environment.currentUser.id}performJoinWorkspaceRedirect(e){this.didPerformAction=!0;const{currentUserRootStore:t,currentUserSettingsStore:o}=E.default.state;if(t&&o&&e.spaceId){const i=e.spaceId;Ie.j({environment:this.environment,userRootStore:t,spaceId:i,navigate:!0,analyticsFrom:"page_error",userSettingsStore:o})}}isRequestAccessEnabled(){return(0,q.uT)(this.environment)}getStyle(){const{device:e}=this.environment;return{width:"100vw",paddingLeft:e.isMobile?16:30,paddingRight:e.isMobile?16:30,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}getFrontBaseStyle(){const{device:e}=this.environment;return{width:"100vw",paddingLeft:e.isMobile?16:30,paddingRight:e.isMobile?16:30,display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",paddingTop:e.isTablet?"20vh":"12vh"}}getGreetingStyle(){const{device:e}=this.environment;return{fontSize:e.isMobile?18:20,marginBottom:10,textAlign:"center",color:this.theme.regularTextColor,fontWeight:500,maxWidth:(0,q.uT)(this.environment)?350:430}}}$o.displayName="PageError",$o.headerBoldStyle={fontWeight:fo.Z.fontWeight.bold},$o.loginStyle={maxWidth:280},$o.storeIconStyle={width:14,height:14,marginRight:6,flexShrink:0},$o.loggedOutFooterWrapStyle={display:"flex",justifyContent:"center",marginBottom:16,marginTop:16,flexWrap:"wrap"};const Jo=$o;var Qo=o(82540),ei=o(77162),ti=o(87420),oi=o(61045),ii=o(45441),ni=o(43250),ri=o(85957),ai=o(45010),si=o(34859),li=o(4926),ci=o(42330),di=o(82136),pi=o(42057),ui=o(96026),mi=o(27724),gi=o(24666),hi=o(41464),fi=o(30016),vi=o(3386),yi=o(68785),bi=o(41046),Si=o(18647),wi=o(10434),ki=o(12552),Ci=o(57079),_i=o(80503),Mi=o(34700),Ti=o(91551);const Ii=new Ho.Z;var Pi=o(98452),xi=o(99332),Bi=o(24612),Zi=o(48601),Ei=o(73063),Ri=o(58261),Ai=o(58032),Di=o(22789),Fi=o(62518),Li=o(11302),Vi=o(38755),Ni=o(76798),Oi=o(45653);class Ui extends l.Z{constructor(){super(...arguments),this.buttonEl=null,this.handleButtonMount=e=>{this.buttonEl=e},this.handleOpenPopup=e=>{if(e.preventDefault(),this.buttonEl){const e=Fi.findDOMNode(this.buttonEl);e&&Li.bA({environment:this.environment,blocks:[this.props.store],originRect:e.getBoundingClientRect(),moveToContext:"quick_add",onAccept:this.handleMoveToAccept,isAddTo:!0})}},this.handleMoveToAccept=e=>{const{currentSpaceStore:t}=E.default.state;t&&this.props.saveParent&&ro.rq({currentUserId:this.environment.currentUser.id,spaceId:t.id,value:e})}}renderComponent(){const{store:e}=this.props,t=e.getParentStore(),{currentSpaceStore:o}=E.default.state,i=t instanceof A.H2&&o&&t.id===o.id;if(t&&!(t instanceof A.T5)&&!(t instanceof A.zq)){const e=t instanceof A.H2?(0,Vi.Wd)(this.environment,t):t.getIcon();return a()(vi.Z,{capture:!0,onMoveTo:this.handleOpenPopup},void 0,a()("div",{style:Ui.wrapStyle},void 0,a()(Ai.Z,{renderTooltip:()=>a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Set the default page or database",id:"peekMoveToMenu.tooptip"}),a()("br",{}),a()(Ri.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"moveTo"})),render:o=>s.createElement(Le.Z,n()({onClick:this.handleOpenPopup,ref:this.handleButtonMount,shouldShrink:!0},o),i?a()(s.Fragment,{},void 0,a()("span",{style:{color:this.theme.mediumTextColor,marginRight:8}},void 0,a()(w.FormattedMessage,{defaultMessage:"Add to",id:"peekMoveToMenu.addTo.addTo"})),a()(Oi.Z,{size:22,avatarShouldShowShadow:!0,userStore:(0,K.B7)(this.environment)}),a()("span",{style:{fontWeight:fo.Z.fontWeight.medium,marginLeft:4,...fo.Z.textOverflowStyle,overflow:"hidden"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Private pages",id:"peekMoveToMenu.addTo.privatePages"}))):a()(s.Fragment,{},void 0,a()("span",{style:{color:this.theme.mediumTextColor,marginRight:6}},void 0,a()(w.FormattedMessage,{defaultMessage:"Add to",id:"peekMoveToMenu.addTo.defaultButton"})),a()(Do.Z,{disabled:!0,icon:e,isEmptyPage:t instanceof A.G&&t.isEmptyPage(),title:t instanceof A.H2?(0,Vi.rn)(this.environment,t):void 0,size:18,style:{marginRight:4,marginTop:1}}),a()(Ni.Z,{style:{fontWeight:fo.Z.fontWeight.semibold},store:t})),g.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightTextColor}))})))}}}Ui.displayName="PeekMoveToMenu",Ui.wrapStyle={display:"flex",alignItems:"center",fontSize:14,minWidth:0,marginRight:14};const Hi=Ui;var zi=o(37064),Wi=o(79075),ji=o(96677),Ki=o(43803),Yi=o(65917),Gi=o(2911),Xi=o(5149),qi=o(48543),$i=o(98165),Ji=o(52275),Qi=o(31945),en=o(3418);class tn extends l.Z{constructor(){super(...arguments),this.storeTypes={visible:ct.default.of(!1)},this.timeout=void 0,this.renderPopup=()=>a()("div",{style:{fontSize:12,color:m.ZP.white,position:"absolute",top:"calc(100% + 12px)",left:"calc(50% - 110px)",background:m.ZP.blue,borderRadius:6,padding:"8px 12px 12px 12px",width:220,boxShadow:this.theme.largeLightBoxShadow,zIndex:99}},void 0,a()("div",{style:{position:"absolute",top:-12,left:"calc(50% - 2.5px)",background:m.ZP.blue,width:5,height:5,borderRadius:5,boxShadow:`0 0 0 1.5px ${this.theme.contentBackground}`}}),a()("div",{style:{position:"absolute",top:-12,left:"calc(50% - 1px)",background:m.ZP.blue,width:2,height:12}}),a()("div",{style:{width:"90%",fontWeight:500,marginBottom:2}},void 0,a()(w.FormattedMessage,{defaultMessage:"New! Open pages in side peek",id:"peekModeIntroTooltip.title",description:"Title of intro tooltip describing peek mode"})),a()("div",{style:{opacity:.8,lineHeight:1.35}},void 0,a()(w.FormattedMessage,{defaultMessage:"Use Tables, Boards, Lists and Timelines while opening pages on the side for faster workflows. Switch to other peek modes here.",id:"peekModeIntroTooltip.subtitle",description:"Subtitle of intro tooltip describing peek mode options"})),a()(Ei.Z,{icon:g.Z.close,style:{position:"absolute",top:4,right:4,opacity:.8},iconStyle:{width:12,fill:m.ZP.white},onClick:this.handleCloseClick})),this.handleCloseClick=()=>{ti.Om({environment:this.environment,seen:!0})}}willMountOrUpdate(){this.shouldBeVisible()?(clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.stores.visible.set(!0)}),500)):(clearTimeout(this.timeout),this.stores.visible.set(!1))}renderComponent(){const{origin:e}=this.props,{visible:t}=this.stores,{device:o}=this.environment;return o.isMobile?e:a()("div",{style:{position:"relative"}},void 0,e,a()(fi.Z,{isVisible:t.get(),animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:this.renderPopup}))}shouldBeVisible(){const{device:e}=this.environment;if(e.isPhone)return!1;if(en.Z.state.openPopups.size>0)return!1;const{currentUserSettingsStore:t}=E.default.state;if(!t||!t.isReady())return!1;const o=t.getSettings();return!(null!=o&&o.signup_time&&(null==o?void 0:o.signup_time)>165888e7)&&(null==o||!o.seen_peek_mode_tooltip)}}tn.displayName="PeekModeIntroTooltip";const on=(0,w.injectIntl)(tn),nn=(0,w.defineMessages)({changeForThisView:{id:"peekTopbar.changePeekOption.changeForThisView",defaultMessage:"Edit view default",description:"Option to open the view settings menu and change the view peek mode"}});class rn extends l.Z{constructor(){super(...arguments),this.getPeekModeUrl=e=>{const{store:t}=this.props,{mainEditorCurrentBlockStore:o}=E.default.state,i=$i.uJ(t),n=t.isNavigableBlock()?i.slice(1):[...i],r=n.length>0?n[0]:void 0;return(0,at.mb)({store:t,mainEditorCurrentBlockStore:r instanceof A.G&&!xo.default.state.open?r:o,collectionContextStore:xo.default.state.collectionContextStore,fullyQualified:!1,overridePeekMode:(0,xo.getPeekModeFromCollectionPeekModeFormat)(e)})},this.handlePeekModePickerClick=()=>{if(!xo.default.state.open)return;const e=xo.default.state.collectionContextStore;e?ei.nS({environment:this.environment,collectionContextStore:e,from:"peek_topbar",peek_target_id:xo.default.state.target.id,from_peek_mode:xo.default.state.mode}):k.trackPageOpenPeekModePicker(this.environment,{from:"peek_topbar",peek_target_id:xo.default.state.target.id,from_peek_mode:xo.default.state.mode})}}willMount(){const e=this.getPeekModeFormatOptions(),t=this.props.overridePeekMode||xo.default.getCollectionModeFormat();e.find((e=>gt().isEqual(e.key,t)))||Yi.log({level:"warning",from:"TopbarPeekModeButton",type:"InvalidSelectedPeekMode",error:(0,Gi.Ui)("Selected key is invalid.")})}renderComponent(){const{device:e}=this.environment,{mainEditorCurrentBlockStore:t}=E.default.state,o=this.getPeekModeFormatOptions(),i=this.props.overridePeekMode||xo.default.getCollectionModeFormat();return i?a()(Qi.Z,{popupType:e.isMobile?jo.kQ.SlideUp:jo.kQ.Popup,alignmentToOrigin:Qi.Z.Alignment.Center,placementToOrigin:Qi.Z.Placement.Bottom,style:{minWidth:190},originGap:0,onClick:this.handlePeekModePickerClick,renderOrigin:e=>a()(on,{origin:a()(Ai.Z,{renderTooltip:()=>s.createElement(s.Fragment,null,a()(w.FormattedMessage,{defaultMessage:"Switch peek mode",id:"peekTopbar.openPagesAs.button",description:"Tooltip text describing the change peek mode button."})),render:t=>s.createElement(Ei.Z,n()({},e,t,{icon:(0,qi.RO)(i),iconStyle:{fill:this.theme.mediumIconColor}}))})}),render:r=>{var l,c,d;let p;p=e.isMobile?{menuType:no.og.ActionSheet}:{menuType:no.og.Popup,width:220};const u=gt().compact([...o.map(((e,t)=>{const o=e.key,l="full_page"===o?(0,zt.ZP)({store:this.props.store,fullyQualified:!1}):this.getPeekModeUrl(o);return{key:t,render:t=>a()(Eo.Z,{href:l,onClick:()=>{ti.Om({environment:this.environment,seen:!0}),k.trackPageUpdatePeekModeFormat(this.environment,{from:"peek_topbar",peek_mode:o,from_peek_mode:i}),r.close()}},void 0,s.createElement(Ji.Z,n()({},t,{disabled:!1,title:e.title,icon:e.icon,caption:e.caption,body:e.body,checkState:gt().isEqual(e.key,i)}))),action:()=>{}}}))]),m=xo.default.state.open?xo.default.state.collectionContextStore:void 0,h=xo.default.state.open?xo.default.state.target:void 0,f=t&&t.id===(null==m||null===(l=m.collectionViewBlockStore())||void 0===l?void 0:l.getRecordStoreUIRoot().id),v=(null==m||null===(c=m.collectionStore())||void 0===c?void 0:c.id)===(null==h||null===(d=h.getAssociatedCollectionStore())||void 0===d?void 0:d.id)&&(null==m?void 0:m.permissionScopes.state.canConfigureBlock)&&f;return s.createElement(ao.Z,p,a()(so.Z,{type:so.i.Vertical,sections:gt().compact([{key:0,render:e=>s.createElement(lo.Z,n()({enableActionSheetTitle:!0},e)),items:u},v&&{key:1,render:e=>s.createElement(lo.Z,n()({enableActionSheetTitle:!0,topBorder:!0},e)),items:[{key:"change_for_view",render:e=>s.createElement(Ji.Z,n()({},e,{disabled:!1,title:Ge.default.formatMessage(nn.changeForThisView),icon:g.Z.settingsNotificationsAndPersonal({width:16,height:16,fill:this.theme.regularIconColor})})),action:e=>{this.handlePeekModeChangeForViewClick(),r.close()}}]}]),initialFocus:0}))}}):null}getPeekModeFormatOptions(){return["side_peek","center_peek","full_page"].map((e=>({key:e,title:(0,qi.LQ)(e),icon:(0,qi.RO)(e)({width:16,fill:this.theme.mediumTextColor})})))}handlePeekModeChangeForViewClick(){const e=xo.default.state.open?xo.default.state.collectionContextStore:void 0;e&&(ti.Om({environment:this.environment,seen:!0}),xo.default.isCenterPeekOpen()&&this.props.onClose&&this.props.onClose(),Xi.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),Xi.H4({collectionSettingsStore:e.settingsStore,item:{type:"layout"}}),e.settingsStore.setState({...e.settingsStore.state,openButtonPopup:"peekModeFormat"}))}}rn.displayName="TopbarPeekModeButton";const an=rn;var sn=o(11819),ln=o(12253),cn=o(95796),dn=o(23727);class pn extends l.Z{renderComponent(){const{store:e}=this.props;return a()(zi.Z,{store:e,disableRectangularSelection:!0,disableEditNearestBlock:!0,isPeekRenderer:!0,render:t=>{let{selectableEvents:o}=t;return s.createElement("div",n()({},o,{style:this.getWrapStyle()}),a()("div",{style:this.getStyle()},void 0,a()("div",{style:this.getPeekControlsStyle()},void 0,this.renderPeekClose(),this.renderOpenAsPageButton(),xo.default.state.open&&a()(an,{store:e,onClose:this.props.onClose}),this.renderPeekNavArrows(),this.renderMoveToMenu(),a()(Di.Z,{store:e,isMobile:!1,buttonStyle:{...!this.props.shouldShowMoveToMenu&&{marginLeft:12}}})),a()("div",{style:{flexGrow:1,flexShrink:1}}),this.renderActionButtons()),a()(Zi.Z,{banners:Ti.Z.state.banners,isMobile:!1,isInPeekRenderer:!0}))}})}renderPeekClose(){if(xo.default.isSidePeekOpen())return a()(Ai.Z,{renderTooltip:()=>a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Close",id:"peekTopbar.close.button"}),a()("br",{}),a()(Ri.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"esc"})),render:e=>s.createElement(Ei.Z,n()({},e,{icon:g.Z.doubleChevronRight,iconStyle:{width:16,height:16},onClick:()=>this.props.onClose("close_button")}))})}renderOpenAsPageButton(){const{store:e,shouldShowMoveToMenu:t}=this.props,o=(0,zt.ZP)({store:e,fullyQualified:!1});return a()(Ai.Z,{renderTooltip:()=>a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Open in full page",id:"peekTopbar.navigateToPage.tooltip"}),a()("br",{}),a()(Ri.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"commandEnter"})),render:e=>s.createElement(Eo.Z,n()({href:o,onClick:()=>{k.trackOpenPeekAsPage(this.environment,{isNewPage:t,peek_mode:xo.default.state.mode})}},e,{style:{height:24}}),a()(Ei.Z,{icon:g.Z.openAsPageThick,iconStyle:{width:16,height:16}}))})}renderPeekControlsSeparator(){return a()("div",{style:{height:14,width:1,marginLeft:6,marginRight:6,background:this.theme.darkDividerColor}})}renderPeekNavArrows(){if(!xo.default.state.open)return;if(this.props.shouldShowMoveToMenu)return;const{target:e,resultsStore:t}=xo.default.state,o=null==t?void 0:t.getState(),i=e.id;return o&&o.length>0&&o.some((e=>e.id===i))?s.createElement(s.Fragment,null,this.renderPeekControlsSeparator(),a()(Ai.Z,{renderTooltip:()=>a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Previous page",id:"peekTopbar.peekNavUpArrow.tooltip"}),a()("br",{}),a()(Ri.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"peekUp"})),render:e=>s.createElement(Ei.Z,n()({},e,{disabled:i===o[0].id,icon:g.Z.chevronUpRounded,onClick:()=>M.goUpInPeekMode(),iconStyle:{fill:this.theme.mediumIconColor}}))}),a()(Ai.Z,{renderTooltip:()=>a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Next page",id:"peekTopbar.peekNavDownArrow.tooltip"}),a()("br",{}),a()(Ri.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"peekDown"})),render:e=>s.createElement(Ei.Z,n()({},e,{disabled:i===o[o.length-1].id,icon:g.Z.chevronDownRounded,onClick:()=>M.goDownInPeekMode(),iconStyle:{fill:this.theme.mediumIconColor}}))})):void 0}renderMoveToMenu(){const e=xo.default.state;if(e.open&&this.props.shouldShowMoveToMenu)return s.createElement(s.Fragment,null,this.renderPeekControlsSeparator(),a()(Hi,{store:this.props.store,saveParent:e.saveParent}))}renderActionButtons(){const{device:e}=this.environment,{store:t,spaceStore:o,spaceViewStore:i}=this.props,n=(0,q.IJ)(this.environment,t),r=!e.isMobile&&o&&i&&!n;return a()("div",{style:this.getActionButtonsWrapStyle()},void 0,t.isRestricted()&&a()(ln.Z,{style:{marginRight:14},onClick:()=>{xi.Z.setState({open:!0})}}),t.canEdit()&&a()(sn.Z,{rootStore:t,pageVisitStore:this.props.pageVisitStore,presenceStore:this.props.presenceStore}),o&&i&&!n&&a()(cn.Z,{store:t,buttonPopupStore:xi.Z}),r&&a()(Wi.Z,{blockStore:t,spaceStore:o,buttonPopupStore:Ii}),r&&a()(dn.Z,{blockStore:t,spaceStore:o,buttonPopupStore:Bi.Z}),o&&i&&!n&&a()(ji.Z,{store:t,spaceViewStore:i}),r&&a()(Ki.Z,{store:t,buttonPopupStore:Pi.Z}))}getWrapStyle(){return{zIndex:xo.default.isSidePeekOpen()?D.LI:D.Bh,background:this.theme.peekModalBackground,borderTopLeftRadius:5,borderTopRightRadius:5}}getStyle(){const{device:e}=this.environment,t=e.isMobile?4:12;return{height:_i.R6(this.environment.device.isElectronMac)-1,display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:t,paddingRight:t}}getPeekControlsStyle(){return{...(0,Mi.X)(this.environment.device.isElectronMac,!1),display:"grid",gridAutoFlow:"column",gridColumnGap:2,alignItems:"center"}}getActionButtonsWrapStyle(){return{display:"flex",alignItems:"stretch",flexGrow:0,flexShrink:0,zIndex:1}}}pn.displayName="PeekTopbar";const un=pn;var mn=o(23089),gn=o(98742),hn=o(72133),fn=o(96049),vn=o(31792),yn=o(7011),bn=o(6685);class Sn extends l.Z{constructor(){super(...arguments),this.didDragMove=!1,this.storeTypes={mouseStore:vn.Z},this.renderTooltip=()=>{let e;switch(this.props.type){case"page":e=(0,ee.in)(this.environment);break;case"update":e=(0,ee.Sx)(this.environment);break;case"peek":e=xo.default.state.open}const t=this.theme.mediumInvertedTextColor;return a()("div",{style:{textAlign:"center"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Drag <invertedcolor>to resize</invertedcolor>",id:"sidebarResizer.tooltip.dragMessage",values:{invertedcolor:e=>a()("span",{style:{color:t}},void 0,e)}}),a()(s.Fragment,{},void 0,a()("br",{}),a()(w.FormattedMessage,{defaultMessage:"Click <invertedcolor>to {expanded, select, true {close} other {lock open}}</invertedcolor>",id:"sidebarResizer.clickToToggleSidebar.message",values:{expanded:e,invertedcolor:e=>a()("span",{style:{color:t}},void 0,e)}})))},this.handleMouseEnter=e=>{ie.ck.set(e.clientY)},this.handleMouseMove=()=>{this.updateResizingStore({isResizerHovered:!0})},this.handleMouseLeave=()=>{this.updateResizingStore({isResizerHovered:!1})},this.handleDragStart=()=>{qe.ZH(this.environment),this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!0}),this.didDragMove=!1,this.updateResizingStore({...ie.cY.state,isResizing:!0})},this.handleDragMove=e=>{switch(hn.clear(this.environment),this.didDragMove=!0,this.props.type){case"page":L.setWidth({width:this.calculateWidth(e.currentX),environment:this.environment});break;case"update":L.setUpdateWidth({width:this.calculateWidth(e.currentX),environment:this.environment});break;case"peek":L.setPeekWidth({width:this.calculateWidth(e.currentX),environment:this.environment})}},this.handleDragEnd=()=>{if(!this.didDragMove){switch(this.props.type){case"page":L.setExpand({environment:this.environment,isExpanded:!ie.gV.state}),ie.TC.set(!1);break;case"update":L.setUpdateExpand({environment:this.environment,isExpanded:!(0,ee.Sx)(this.environment),from:"drag"});break;case"peek":ti.xv(this.environment,"resizer_click")}this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})}this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1}),this.updateResizingStore({isResizing:!1})},this.handleDragCancel=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1}),this.updateResizingStore({isResizing:!1})}}renderComponent(){const{device:e}=this.environment,t=this.getWidth(),o="page"===this.props.type?t:window.innerWidth-t,i=ie.ck.state;if(!fn.Z.state&&!e.isChromebook)return a()(Ai.Z,{renderTooltip:this.renderTooltip,originRect:new DOMRect(o,i,0,0),delayThreshold:500,placement:"page"===this.props.type?Ai.Z.Placement.Right:Ai.Z.Placement.Left,originGap:10,render:e=>s.createElement("div",n()({style:this.getWrapStyle()},(0,gn.Z)(e,{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onMouseEnter:this.handleMouseEnter})),a()(bn.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>s.createElement("div",n()({style:this.getStyle()},e))}))})}get minWidth(){switch(this.props.type){case"page":return ie.nP;case"update":return yn.AO;case"peek":return xo.sidePeekMinWidth}}get maxWidth(){const e=window.innerWidth;switch(this.props.type){case"page":return 480;case"update":return Math.min(e/2,ee.Nc);case"peek":return e>2*xo.sidePeekMinWidth?e/1.5:e}}calculateWidth(e){const t="page"===this.props.type?e:window.innerWidth-e;return t>this.maxWidth?this.maxWidth:t<this.minWidth?this.minWidth:t}getWidth(){switch(this.props.type){case"page":return ie.GZ.state;case"update":return yn.ZP.state.width;case"peek":return xo.default.state.preferredSidePeekWidth}}updateResizingStore(e){switch(this.props.type){case"page":ie.cY.update((t=>({...t,...e})));break;case"update":yn.ZP.update((t=>({...t,...e})))}}getWrapStyle(){const e=(0,ee.in)(this.environment),t=this.props.type;return{position:"absolute",left:"peek"===t?0:void 0,right:"peek"!==t?0:void 0,width:0,flexGrow:0,zIndex:"peek"===t?D.YO:1,top:e?0:-1,bottom:e?0:-1,pointerEvents:"auto"}}getStyle(){return{cursor:"col-resize",height:"100%",width:12,marginLeft:"update"===this.props.type?-yn.ZP.state.width:-6}}}Sn.displayName="SidebarResizer";const wn=Sn;function kn(){window.__c={n:"MiniPeekRenderer"};const{open:e}=(0,N.VK)((()=>xo.default.state),[]),t=(0,N.VK)((()=>li.Z.state),[]),o=(0,Ce.yK)((e=>({containerStyles:{position:"fixed",top:0,right:0,bottom:0,left:0,background:e.groupedFormBackground,zIndex:D.Nn},contentStyles:{...In(e),top:2.5*xo.PeekModeOuterPadding,left:xo.PeekModeOuterPadding,right:xo.PeekModeOuterPadding,marginRight:"auto",height:`calc(100% - ${xo.PeekModeOuterPadding}px*7)`,maxWidth:xo.PeekModeOuterWidth+t,borderRadius:3}})),[t]);return a()(bi.Z,{open:e},void 0,a()(Mn,{enableCaptureClick:!0,showTopbar:!1,showResizer:!1,priority:void 0,styles:o,horizontalPadding:xo.PeekModePadding.horizontal[xo.PeekModeMini],pageViewBlockContext:di.S.MiniPeekView}))}function Cn(){window.__c={n:"CenterPeekRenderer"};const{open:e}=(0,N.VK)((()=>xo.default.state),[]),t=(0,N.VK)((()=>li.Z.state),[]),o=(0,Ce.yK)((e=>({containerStyles:{position:"fixed",top:0,right:0,bottom:0,left:0,background:e.overlaySmokescreen,zIndex:D.Nn},contentStyles:{...In(e),top:xo.PeekModeOuterPadding,left:xo.PeekModeOuterPadding,right:xo.PeekModeOuterPadding,marginRight:"auto",height:`calc(100% - ${xo.PeekModeOuterPadding}px*2)`,maxWidth:xo.PeekModeOuterWidth+t,borderRadius:3}})),[t]);return a()(bi.Z,{open:e},void 0,a()(Mn,{enableCaptureClick:!0,showTopbar:!0,showResizer:!1,priority:void 0,styles:o,horizontalPadding:xo.PeekModePadding.horizontal[xo.PeekModeCenter],pageViewBlockContext:di.S.PeekView}))}function _n(){window.__c={n:"SidePeekRenderer"};const e=(0,V.O7)(),t=(0,N.VK)((()=>xo.default.state),[]),o=(0,N.VK)((()=>xo.default.getSidePeekWidth(e.WindowSizeStore.state.width)),[e]),i=(0,Ce.yK)((e=>({containerStyles:{position:"fixed",top:0,right:0,bottom:0,translateX:o,width:o,zIndex:D.YO},contentStyles:{...In(e),top:0,right:0,width:"100%",height:"100%",borderRadius:0}})),[o]);return a()(fi.Z,{isVisible:!0,useCompositeLayer:!0,animationStyle:{translateX:t.open&&!t.isClosing?0:o},springConfig:{translateX:{stiffness:t.open&&t.isClosing?50:80,precision:1}},render:()=>a()(Mn,{enableCaptureClick:!1,showTopbar:!0,showResizer:!0,priority:-1,styles:i,horizontalPadding:xo.PeekModePadding.horizontal[xo.PeekModeSide],pageViewBlockContext:di.S.PeekView}),enterAnimationStyle:{translateX:t.open&&t.isClosing?0:void 0},onAnimationEnd:()=>{t.open&&t.isClosing?(xo.default.setState({...t,isClosing:!1}),ti.ME()):t.open&&t.isOpening&&xo.default.setState({...t,isOpening:!1})}})}function Mn(e){const{priority:t}=e,o=(0,V.O7)(),i=(0,N.VK)((()=>xo.default.state),[]),{shouldShowFrame:n}=(0,N.VK)((()=>(0,K.h1)(o)),[o]),r=(0,N.VK)((()=>ri.Tx()),[]),l=(0,N.VK)((()=>i.open&&0===mi.default.state.stores.length&&!mi.default.state.pivot&&"editing"!==gi.default.state.mode&&!ci.ZP.state.isOpen),[i.open]),c=(0,s.useCallback)((()=>{Zn(o)}),[o]),d=(0,s.useCallback)((()=>{!function(e){xo.default.peekTarget.state&&M.navigateToBlock({environment:e,store:xo.default.peekTarget.state})}(o)}),[o]);return n?i.open?s.createElement(s.Fragment,null,a()(hi.Z,{priority:t,capture:r}),a()(vi.Z,{capture:l,onEsc:c,onCommandEnter:d},i.target.id,s.createElement(Tn,e))):s.createElement(Tn,e):null}function Tn(e){window.__c={n:"PeekContentContainer"};const{enableCaptureClick:t,horizontalPadding:o,pageViewBlockContext:i,showResizer:r,showTopbar:l,styles:c}=e,d=(0,s.useRef)(void 0);ai.Z.PeekViewScroller=d.current;const p=(0,V.O7)(),u=(0,N.VK)((()=>xo.default.state),[]),{currentSpaceStore:m,currentSpaceViewStore:g}=(0,N.VK)((()=>E.default.state),[]),h=(0,N.SI)((()=>u.open?ui.Z.getMode(p,u.target):ui.m.disabled),[p,u]),f=(0,N.VK)((()=>{if(!u.open)return;const{currentSpaceStore:e,currentSpaceViewStore:t}=E.default.state;return{pageStore:u.target,spaceStore:e,spaceViewStore:t,presenceStore:u.presenceStore,pageVisitStore:u.pageVisitStore,publicEditModeStore:h}}),[u,h]),v=(0,s.useCallback)((()=>{Zn(p)}),[p]),y=(0,s.useCallback)((e=>{ei._t({environment:p,time:e,collectionContextStore:u.open?at.fm(u.target):void 0})}),[p,u]),b=(0,s.useCallback)((()=>{!function(e){Bn(e)}(p)}),[p]);return a()(Qo.Mi,{value:f},void 0,a()("div",{style:c.containerStyles,className:ni.p1Q},void 0,u.open&&s.createElement(s.Fragment,null,t&&a()("div",{style:{width:"100%",height:"100%"},onClick:b}),a()("div",{style:c.contentStyles},void 0,r&&a()(wn,{type:"peek"}),l&&a()(un,{store:u.target,spaceStore:m,spaceViewStore:g,pageVisitStore:u.pageVisitStore,presenceStore:u.presenceStore,shouldShowMoveToMenu:u.showMoveTo,onClose:e=>{Bn(p,e)}}),a()(zi.Z,{store:u.target,isDefaultContainer:!0,droppable:!0,isPeekRenderer:!0,render:e=>{let{selectableEvents:t,selectableHoverMenuOverlay:r}=e;return a()(ki.Z,{pageStore:u.target,pageVisitStore:u.pageVisitStore,initialChunkSize:25,incrementChunkSize:25,store:u.loadingContainerStore,render:e=>{let{ready:l,initialRequestCompleted:c,endOfResultsReached:m,isCollectionInPage:g}=e;return a()(s.Fragment,{},void 0,s.createElement(Si.Z,n()({ref:d,onScrollLagMeasure:g?y:void 0,preventType:l?oi.Q7(p):si.Z.All,type:si.Z.Y,style:{display:"flex",flexDirection:"column",flexGrow:1,position:"relative",transform:"translateZ(0)",...l?{}:Pn},store:pi.Z},t),r,(0,G.GD)(p,h.state)&&a()(ii.K,{scrollerStore:pi.Z}),c&&a()(s.Fragment,{},void 0,a()(Ci.Z,{context:i,loadingContainerStore:u.loadingContainerStore,store:u.target,onTitleEsc:v,forceSelectTitleOnMount:!0,paddingLeft:o,paddingRight:o,paddingBottom:80,pageCoverHeight:"20vh",disabled:!u.open||u.isClosing}),a()(mn.Z,{pageVisitStore:u.pageVisitStore,presenceStore:u.presenceStore,isPeekView:!0})),l&&!m&&a()(yi.Z,{style:{zIndex:1,opacity:.5,width:xn,height:xn,marginTop:0,marginBottom:24,marginLeft:"auto",marginRight:"auto"}})),a()(wi.Z,{peekMode:xo.default.getPeekMode(),isVisible:!l,store:u.target}))}})}},u.target.id)))))}function In(e){return{flexDirection:"column",position:"absolute",display:"flex",marginLeft:"auto",background:e.peekModalBackground,boxShadow:e.largeLightBoxShadow}}const Pn={opacity:0,pointerEvents:"none",height:0},xn="1.375em";function Bn(e,t){ti.xv(e,t)}function Zn(e){Bn(e,"esc")}const En=function(){const e=(0,V.O7)(),t=(0,s.useCallback)((()=>{xo.default.state.open&&xo.default.isSidePeekOpen()&&(L.toggleLeftSidebarByWindowSize(e),xo.default.setState({...xo.default.state,isOpening:!1}))}),[e]);switch((0,s.useEffect)((()=>(e.WindowSizeStore.addListener(t),e.WindowSizeStore.removeListener(t))),[e.WindowSizeStore,t]),(0,N.VK)((()=>xo.default.getPeekMode()),[])){case xo.PeekModeMini:return a()(kn,{});case xo.PeekModeCenter:return a()(Cn,{});case xo.PeekModeSide:return a()(_n,{})}};var Rn=o(37190);const An={stiffness:80,damping:20},Dn=(0,w.defineMessages)({tooltipNewPageSidebar:{defaultMessage:"Click here to create a page",id:"shadowCursor.tooltips.newPageSidebar",description:"Tooltip that tells the user to create a page"},tooltipCreateSubpageSlashMenu:{defaultMessage:"Type '/page' to create a subpage",id:"shadowCursor.tooltips.createSubpageSlashMenu",description:"Tooltip that tells the user to create a subpage using the slash menu"}});function Fn(e){const{x:t,y:o}=e.position,[i,n]=s.useState(null),r=(0,V.O7)(),l=(0,N.VK)((()=>E.default.state.currentUserSettingsStore),[]),{currentCursorElement:c,visible:d}=(0,N.VK)((()=>{const{shadowCursorStore:e}=E.default.state;return{currentCursorElement:e.state.currentCursorElement,visible:e.state.visible}}),[]),p=(0,N.VK)((()=>R.default.getEligibleGroup({experimentId:"shadow_cursor_subpage",defaultGroup:"control"})),[]),u=(0,Ce.yK)((e=>({underlay:{position:"absolute",top:0,left:0,bottom:0,right:0,background:e.modalUnderlayBackground,pointerEvents:"none",maskImage:`radial-gradient(${2*Rn.SPOTLIGHT_RADIUS}px circle at calc(50% + ${Rn.SPOTLIGHT_RADIUS}px) calc(50% + ${Rn.SPOTLIGHT_RADIUS}px), transparent 50%, black 51%)`,WebkitMaskImage:`radial-gradient(${2*Rn.SPOTLIGHT_RADIUS}px circle at calc(50% + ${Rn.SPOTLIGHT_RADIUS}px) calc(50% + ${Rn.SPOTLIGHT_RADIUS}px), transparent 50%, black 51%)`},borderbox:{position:"absolute",top:0,left:0,bottom:0,right:0,borderRadius:4,border:`4px solid ${m.ZP.blue}`,height:"100vh",width:"100vw",pointerEvents:"none"},container:{width:"200%",height:"200%",position:"fixed",top:0,left:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",transform:"translate(-50%, -50%)"}})),[]),h=(0,s.useCallback)((()=>{n(a()("div",{},void 0,function(e){switch(e){case"new-page-sidebar":return s.createElement(w.FormattedMessage,Dn.tooltipNewPageSidebar);default:return s.createElement(w.FormattedMessage,Dn.tooltipCreateSubpageSlashMenu)}}(c)))}),[c]),f=(0,Q.ob)();return s.useEffect((()=>{switch(c){case"new-page-blank-line":"/page"===f&&l&&Rn.complete(r,l)}}),[c,f,r,l]),d?s.createElement(s.Fragment,null,a()(bi.Z,{open:!0,zIndex:200},void 0,"without_spotlight"===p?a()("div",{className:"shadow-tutorial-border-box",style:u.borderbox}):null,a()("div",{style:u.container},void 0,a()(fi.Z,{isVisible:!0,animationStyle:{translateX:Rn.SPOTLIGHT_RADIUS+t-15,translateY:Rn.SPOTLIGHT_RADIUS+o-10},onAnimationStart:()=>{n(null)},onAnimationEnd:()=>{h()},useCompositeLayer:!0,springConfig:An,render:()=>a()("div",{style:{position:"absolute",zIndex:500}},void 0,"with_spotlight"===p?g.Z.cursor({position:"absolute",height:21,width:22,fill:"#fff",zIndex:500}):g.Z.cursorBlue({position:"absolute",height:21,width:22,fill:"#fff",zIndex:500}),i&&a()("div",{style:{position:"absolute",top:13,width:"max-content",backgroundColor:"with_spotlight"===p?m.ZP.black:m.ZP.blue,padding:"4px 8px",boxShadow:"0 1px 4px rgba(0,0,0,0.3)",borderRadius:4,color:"white",fontSize:12,fontWeight:fo.Z.fontWeight.medium,lineHeight:1.4}},void 0,i))}),"with_spotlight"===p&&a()(fi.Z,{isVisible:!0,animationStyle:{translateX:t,translateY:o},springConfig:An,onAnimationEnd:()=>h(),useCompositeLayer:!0,render:()=>a()("div",{style:{...u.underlay}})})))):null}var Ln=o(36432),Vn=o(12534);var Nn=o(61436),On=o(24042),Un=o(57688),Hn=o(92350),zn=o(14694);function Wn(e){let{onClick:t,label:o}=e;window.__c={n:"SidebarFooterButton"};const i=(0,Ce.yK)((e=>({button:{boxShadow:`0 -1px 0 ${e.regularDividerColor}`},sidebarItem:{color:e.mediumTextColor,height:45},plusIconContainer:{display:"flex",alignItems:"center",justifyContent:"center"},plusIcon:{fill:e.mediumIconColor,width:16,height:16}})),[]);return a()(ot.Z,{onClick:t,style:i.button},void 0,a()(zn.Z,{style:i.sidebarItem,left:a()("div",{style:i.plusIconContainer},void 0,g.Z.plus(i.plusIcon))},void 0,o))}var jn=o(98104),Kn=o(29538);function Yn(e){let{isExpanded:t,mouseEnteredSidebar:o}=e;window.__c={n:"SidebarDesktopOnlyTopBar"};const[{isFullScreen:i}]=(0,N.AF)(Nn.Z),[{isShowingTabBar:n}]=(0,N.AF)(On.Z),{device:r}=(0,V.O7)(),s=r.isElectronMac,l=function(e){let{isElectronMac:t,isShowingTabBar:o}=e;return(0,Ce.yK)((()=>({container:{...(0,Mi.X)(t,!o),display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:11}})),[t,o])}({isElectronMac:s,isShowingTabBar:n});if(!(0,ee.U8)({isElectronMac:s,isExpanded:t,isFullScreenDesktop:i}))return null;const c=(0,ee.wE)({isElectronMac:s,isExpanded:t,isFullScreenDesktop:i,isShowingTabBar:n});return a()(fi.Z,{animationStyle:{height:c?_i.br:0},render:()=>a()("div",{style:l.container},void 0,a()("div",{className:ni.JiD},void 0,a()(Kn.V,{}))),isVisible:!0})}function Gn(e){let{isExpanded:t,mouseEnteredSidebar:o,searchQuery:i,onBackClicked:n,onSearchQueryChanged:r,onClearButtonClicked:l}=e;const c=(0,V.O7)(),[{isFullScreen:d}]=(0,N.AF)(Nn.Z),[{isShowingTabBar:p}]=(0,N.AF)(On.Z),{isElectronMac:u}=c.device,m=(0,Ce.yK)((e=>({headerRow:{display:"flex",justifyContent:"flex-start",alignItems:"center",height:45},headerRowTitle:{flex:1,fontWeight:fo.Z.fontWeight.semibold,fontSize:14,color:e.regularTextColor,alignItems:"center",...fo.Z.textOverflowStyle,paddingRight:7},backIconContainer:{marginLeft:14,marginRight:8},backIcon:{transform:"rotate(90deg)",fill:e.lightIconColor,marginBottom:-1},headerRowUnexpandButton:{justifySelf:"flex-end",marginRight:12},searchContainer:{width:"100%",paddingLeft:15,paddingRight:15}})),[]),h=(0,ee.GD)({isElectronMac:u,isExpanded:t,isFullScreenDesktop:d,mouseEnteredSidebar:o,isShowingTabBar:p});return s.createElement(s.Fragment,null,a()(Yn,{isExpanded:t,mouseEnteredSidebar:o}),a()("div",{style:m.headerRow},void 0,a()("div",{style:m.backIconContainer},void 0,a()(Ei.Z,{icon:g.Z.arrowDownSmall,iconStyle:m.backIcon,onClick:n})),a()("div",{style:m.headerRowTitle},void 0,a()(w.FormattedMessage,{defaultMessage:"All teamspaces",description:"Title for the team browser inside the left sidebar.",id:"sidebarTeamBrowserHeader.title"})),h&&a()("div",{className:ni.JiD,style:m.headerRowUnexpandButton},void 0,a()(Kn.V,{}))),a()("div",{style:m.searchContainer},void 0,a()(Xn,{onChange:r,searchQuery:i,onClearButtonClicked:l})))}function Xn(e){let{onChange:t,searchQuery:o,onClearButtonClicked:i}=e;window.__c={n:"SidebarTeamBrowserSearchInput"};const n=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),r=(0,V.O7)(),l=(0,w.useIntl)(),[c,d]=(0,s.useState)(!0),p=(0,N.VK)((()=>n&&(0,Vi.rn)(r,n)),[n,r]),u=(0,Ce.yK)((e=>({input:{boxShadow:e.inputBoxShadow,borderRadius:3,fontSize:14},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:e.mediumIconColor}})),[]),m=(0,s.useCallback)((e=>t(e.target.value)),[t]),h=(0,s.useCallback)((()=>d(!1)),[]),f=(0,s.useCallback)((()=>{gi.default.isEditingStore.state&&jn.o9(),d(!0)}),[]),v=p?l.formatMessage({defaultMessage:"Search teamspaces...",id:"sidebarTeamBrowserHeader.searchFilter.placeholder",description:"Placeholder text for teamspaces list search filter."},{workspaceName:p}):l.formatMessage({defaultMessage:"Search teamspaces...",id:"sidebarTeamBrowserHeader.searchFilter.placeholderWithoutSpaceName",description:"Placeholder text for teamspaces list search filter."});return a()(zo.Z,{capture:c,allowEsc:!0},void 0,a()(Wo.Z,{placeholder:v,focusInitial:!0,showClearButton:!0,style:u.input,value:o,onChange:m,left:g.Z.searchThick(u.searchIcon),onBlur:h,onFocus:f,onClearButtonClick:i}))}var qn=o(31942),$n=o(75934),Jn=o(50659),Qn=o(70704),er=o(45589),tr=o(56638);function or(e){let{children:t,scrollerStore:o,scrollerStyle:i}=e;window.__c={n:"SidebarOutlinerScrollContainer"};const r=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),l=(0,N.VK)((()=>E.default.state.currentSpaceViewStore),[]),c=(0,N.VK)((()=>xo.default.isMiniOrCenterPeekOpen()||tr.Z.state.open),[]),d=(0,N.VK)((()=>0===o.state.scrollTop),[o]),p=(0,Ce.yK)((e=>({scroller:{paddingTop:6,paddingBottom:20,boxShadow:d?"inset 0 0 0 transparent":`inset 0 1px 0 ${e.regularDividerColor}`,transition:"box-shadow 300ms",...i}})),[i,d]),u=(0,s.useCallback)((e=>{ai.Z.SidebarScroller=e}),[]);return r&&l?a()(zi.Z,{store:r,droppable:!0,disableEditNearestBlock:!0,disable:c,render:e=>{let{selectableEvents:i}=e;return s.createElement(Si.Z,n()({key:l.id,type:si.Z.Y,store:o,style:p.scroller,ref:u},i),t)}}):null}var ir=o(62151);function nr(e){let{moreCount:t,onClick:o,textStyle:i,useIndentedPadding:n}=e;window.__c={n:"NMoreSidebarItem"};const{isMobile:r}=(0,V.Fy)(),s=(0,Ce.yK)((e=>({button:(0,Jn.G$)({isMobile:r}),sidebarItem:{marginBottom:r?16:void 0,...n&&{paddingLeft:r?10:20},color:e.lightTextColor,...i},centeredText:{display:"flex",alignItems:"center",fontSize:r?16:12}})),[r,i,n]);return a()(ot.Z,{style:s.button,mobileFeedback:r,onClick:o},void 0,a()(zn.Z,{style:s.sidebarItem,disableMobileBorder:!0},void 0,a()("div",{style:s.centeredText},void 0,a()(w.FormattedMessage,{defaultMessage:"{moreCount} more",id:"nmoreSidebarItem.nMoreButtonTextLabel",description:"Label that shows there are additional sidebar items that were truncated for an overflowing section in the sidebar. When clicked, all pages/teams/sidebaritems are shown.",values:{moreCount:t}}))))}var rr=o(56252);function ar(e){let{joinedTeams:t,unjoinedTeams:o,sidebarState:i,searchQuery:r,onClearSearchQueryClicked:l}=e;window.__c={n:"TeamBrowserOutliner"};const c=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),d=(0,N.VK)((()=>E.default.state.currentSpaceViewStore),[]),p=(0,V.O7)(),[u,m]=(0,s.useState)(t.length>6),h=sr(),f=sr(),v=sr(),y=(0,N.qz)(void 0,er.Z),b=r.trim(),S=(0,O.Kt)(b,200,((e,t)=>e===t)),k=(0,N.VK)((()=>{if(""!==S)return(0,qn.ZP)(S,[...t,...o],(e=>e.getName()??""))}),[t,S,o]),C=(0,N.VK)((()=>(0,te.Xq)({environment:p,spaceStore:c})),[c,p]),_=(0,s.useCallback)((()=>{m(!1)}),[]),M=(0,s.useCallback)((()=>{m(!1)}),[]),T=(0,Ce.yK)((e=>({scroller:{height:"100%"},noUnjoinedTeamsContainer:{marginLeft:15,...fo.Z.textOverflowStyle,fontSize:fo.Z.fontSize.UIRegular.desktop},noFilterResultsContainer:{display:"flex",flexDirection:"column",padding:15,height:"100%",alignItems:"center",justifyContent:"center"},noFilterResultsTitle:{color:e.mediumTextColor,fontSize:fo.Z.fontSize.UIRegular.desktop},noFilterResultsDescription:{color:e.mediumTextColor,fontSize:fo.Z.fontSize.UIRegular.desktop,fontWeight:fo.Z.fontWeight.regular},noFilterResultsIcon:{width:30,height:30,marginBottom:10},sidebarItemButtonStyle:(0,Jn.G$)({isMobile:!1}),plusIcon:{fill:e.mediumIconColor,width:14,height:14},nMoreText:{fontWeight:fo.Z.fontWeight.semibold}})),[]);if(!c||!d)return null;if(""!==S&&""!==b&&0===(null==k?void 0:k.length))return a()("div",{style:T.noFilterResultsContainer},void 0,g.Z.searchInPage(T.noFilterResultsIcon),a()("div",{style:T.noFilterResultsTitle},void 0,a()(w.FormattedMessage,{id:"teamBrowserOutliner.noFilterResults.title",description:"Label that shows when the user searched the browse teams view and no teams match their search query.",defaultMessage:"No results"})),a()("div",{style:T.noFilterResultsDescription},void 0,a()(w.FormattedMessage,{id:"teamBrowserOutliner.noFilterResults.description",description:"Description that shows when the user searched the browse teams view and no teams match their search query. Clicking on `clear search` will clear the search query and show all teams.",defaultMessage:"Try again or <linkbutton>clear search</linkbutton>",values:{linkbutton:e=>a()(Ne.Z,{onClick:l},void 0,e)}})));const I=""!==S&&""!==b,P={shouldPersistToggleState:!1,spaceStore:c,spaceViewStore:d,showAddButton:!1},x=e=>{let{teams:t,teamOutlinerType:o}=e;const n=t.length,r="teamBrowserJoinedTeams"===o&&u&&n>6,l=r?t.length-5:0,c=e=>a()(rr.O,{initialToggleState:"hidden",teamStore:e,sidebarState:i,isRouteWithoutSpecifiedBlock:!1,isLastTeam:!1,shouldPersistToggleState:!1,teamOutlinerType:o,onTeamJoinComplete:_},e.id);return r?s.createElement(s.Fragment,null,t.slice(0,5).map(c),l>0&&a()(nr,{moreCount:l,onClick:M,textStyle:T.nMoreText})):t.map(c)};return a()(or,{scrollerStore:y,scrollerStyle:T.scroller},void 0,I?s.createElement(ir.Z,n()({},P,{type:$n.mu,outlinerToggleButtonStore:v,sectionLabel:a()(w.FormattedMessage,{defaultMessage:"Search results",description:"Sidebar section label for the team search results list.",id:"teamBrowserOutliner.searchResultsLabel"}),renderSidebar:()=>x({teams:k??[],teamOutlinerType:$n.mu})})):s.createElement(s.Fragment,null,s.createElement(ir.Z,n()({},P,{type:$n.PT,outlinerToggleButtonStore:h,labelTooltip:a()(w.FormattedMessage,{defaultMessage:"Teamspaces you have joined",description:"Tooltip label on hover over the sidebar section `Joined teamspaces`",id:"teamBrowserOutliner.joinedTeamsSection.tooltip"}),sectionLabel:a()(w.FormattedMessage,{defaultMessage:"Your teamspaces",description:"Sidebar section labels for the `Joined teamspaces` list.",id:"teamBrowserOutliner.joinedTeamsLabel"}),renderSidebar:()=>x({teams:t,teamOutlinerType:$n.PT})})),s.createElement(ir.Z,n()({},P,{type:$n.cz,outlinerToggleButtonStore:f,labelTooltip:a()(w.FormattedMessage,{defaultMessage:"Teamspaces you can join",description:"Tooltip label on hover over the sidebar section `Joined teamspaces`",id:"teamBrowserOutliner.unjoinedTeamsSection.tooltip"}),sectionLabel:a()(w.FormattedMessage,{defaultMessage:"More teamspaces",description:"Sidebar section label for the unjoined teamspaces list.",id:"teamBrowserOutliner.unjoinedTeamsLabel"}),renderSidebar:()=>0===o.length?C?a()(ot.Z,{onClick:()=>Un.lo("browse_teams"),style:T.sidebarItemButtonStyle},void 0,a()(zn.Z,{left:g.Z.plusThick(T.plusIcon)},void 0,a()(w.FormattedMessage,{defaultMessage:"New teamspace",description:"Button to create a teamspace in the browse teamspaces sidebar menu.",id:"teamBrowserOutliner.createTeamspaceButton"}))):a()("div",{style:T.noUnjoinedTeamsContainer},void 0,a()(w.FormattedMessage,{id:"teamBrowserOutliner.noUnjoinedTeams",description:"Label that shows when the unjoined teamspaces list is empty because the user has joined every visible teamspace in the workspace.",defaultMessage:"No teamspaces to join"})):x({teams:o,teamOutlinerType:$n.cz})}))))}function sr(){return(0,N.qz)(void 0,Qn.Z)}function lr(e){let{mouseEnteredSidebar:t,isExpanded:o,onBackClicked:i,sidebarState:n}=e;window.__c={n:"SidebarTeamBrowserContent"};const r=(0,V.O7)(),l=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),c=(0,N.VK)((()=>E.default.state.currentSpaceViewStore),[]),[d,p]=(0,s.useState)(""),u=(0,Hn.E7)(),m=(0,Hn.ZW)(),g=(0,N.VK)((()=>{return l?(e=m,t=l,gt().sortBy(e,(e=>-1*(0,te.xf)({teamStore:e,spaceStore:t}).length))):[];var e,t}),[l,m]),h=(0,N.VK)((()=>(0,te.Xq)({environment:r,spaceStore:l})),[l,r]),f=(0,s.useCallback)((()=>Un.lo(0===d.length?"team_browser":"team_browser_search")),[d.length]),v=(0,s.useCallback)((e=>p(e)),[]),y=(0,s.useCallback)((()=>{k.trackClearTeamBrowserSearch(r,{from:"empty_results_reset_link"}),p("")}),[r]),b=(0,s.useCallback)((()=>{k.trackClearTeamBrowserSearch(r,{from:"search_input"}),p("")}),[r]),S=(0,s.useCallback)((()=>{i({numOfJoinedTeams:u.length,numOfUnJoinedTeams:g.length})}),[i,u,g]),C=(0,Ce.yK)((()=>({container:{display:"flex",flexDirection:"column",height:"100%",width:"100%"},headerContainer:{flexShrink:0,paddingBottom:8},outlinerContainer:{overflow:"hidden",flexGrow:1},footerContainer:{flexShrink:0}})),[]);return l&&c?a()("div",{style:C.container},void 0,a()(vi.Z,{capture:!0,onEsc:S}),a()("div",{style:C.headerContainer},void 0,a()(Gn,{isExpanded:o,mouseEnteredSidebar:t,searchQuery:d,onBackClicked:S,onSearchQueryChanged:v,onClearButtonClicked:b})),a()("div",{style:C.outlinerContainer},void 0,a()(ar,{joinedTeams:u,unjoinedTeams:g,sidebarState:n,searchQuery:d,onClearSearchQueryClicked:y})),h&&a()("div",{style:C.footerContainer},void 0,a()(Wn,{onClick:f,label:a()(w.FormattedMessage,{defaultMessage:"New teamspace",description:"Button label to create a new teamspace in the workspace.",id:"sidebarTeamBrowser.newTeam.button"})}))):null}var cr=o(46735),dr=o(35026),pr=o(24864),ur=o(99757),mr=o(31054),gr=o(32016),hr=o(10482),fr=o(65452),vr=o(94660);class yr extends To.Z{getInitialState(){return{isLoaded:!1,left:0,top:0,width:0,height:0}}}const br=yr,Sr=s.forwardRef(((e,t)=>s.createElement("div",{ref:t,className:"OnboardingHighlight"},e.children)));class wr extends l.Z{constructor(e,t){super(e,t),this.boundingBoxRef=void 0,this.storeTypes={store:br},this.renderOverlays=()=>{const{top:e,left:t,width:o,height:i}=this.stores.store.state,n=[{...this.getStyle({top:0,left:0,width:t,height:"100vh"}),backgroundColor:this.theme.onboardingContentOverlay},{...this.getStyle({top:0,left:t,width:o,height:e}),backgroundColor:this.theme.onboardingSidebarOverlay},{...this.getStyle({top:e+i,left:t,width:o,height:"100vh"}),backgroundColor:this.theme.onboardingSidebarOverlay},{...this.getStyle({top:e,left:t,width:o,height:i})}];return a()("div",{},void 0,n.map(((e,t)=>a()("div",{style:e},`onboardingOverlay${t}`))))},this.handleResize=()=>{this.measureBounds()},this.handleResizeDebounced=gt().debounce(this.handleResize,10),this.measureBounds=()=>{if(this.props.show&&this.boundingBoxRef&&this.boundingBoxRef.current){const e=this.boundingBoxRef.current.getBoundingClientRect();this.stores.store.setState({...this.stores.store.state,isLoaded:!0,top:e.top,left:e.left,width:e.width,height:e.height})}},this.boundingBoxRef=s.createRef()}didMount(){const{device:e}=this.environment;e.isMobile||window.addEventListener("resize",this.handleResizeDebounced)}didMountOrUpdate(){const{device:e}=this.environment;!e.isMobile&&this.props.show&&this.measureBounds()}willUnmount(){const{device:e}=this.environment;e.isMobile||window.removeEventListener("resize",this.handleResizeDebounced)}renderComponent(){const{device:e}=this.environment;return e.isMobile||!this.props.show?this.props.highlight():a()(s.Fragment,{},void 0,s.createElement(Sr,{ref:this.boundingBoxRef},this.props.highlight()),!this.props.hideOverlays&&this.renderOverlays())}getStyle(e){const{top:t,left:o,height:i,width:n}=e;return{position:"absolute",top:t,left:o,height:i,width:n,zIndex:D.mJ}}}wr.displayName="AppsSetupHighlightOverlay";const kr=wr;class Cr extends To.Z{getInitialState(){return{isLoaded:!1,left:0,top:0,width:0,height:0}}}const _r=Cr;var Mr=o(72897);class Tr extends l.Z{constructor(){super(...arguments),this.renderContents=()=>a()("div",{style:this.getContentStyles(),className:ni.Cjq},void 0,this.props.children,this.renderNextButton())}renderComponent(){const{device:e}=this.environment,{state:t}=Mo.default;if(!t.isOnboarding)return;const{parentStore:o,verticalOffset:i}=this.props,{top:r,left:l,height:c,width:d}=o.state,p={originRect:{top:r+i,bottom:r+c,left:l+d,right:l+d},placementToOrigin:jo.ZP.Placement.Right,alignmentToOrigin:jo.ZP.Alignment.Start},u=!ko.BB(t);return a()(Mr.Z,{capture:u,preventType:si.Z.All},void 0,s.createElement(jo.ZP,n()({popupType:e.isMobile?jo.ZP.PopupType.SlideUp:jo.ZP.PopupType.Popup,render:this.renderContents,open:!0,originGap:0,preventBlockRenderQueueOnEnter:!0,preventScaleTransition:!0,disableMouseCapture:!0,useLightBoxShadow:this.props.useFlatStyles},p)))}renderNextButton(){return a()("div",{style:{...ko.pd,display:"flex",alignItems:"center"}},void 0,a()(Re.Z,{isLarge:!0,onClick:this.props.handleNext,style:ko.bM},void 0,this.props.buttonText?this.props.buttonText:a()(w.FormattedMessage,{defaultMessage:"Next",id:"onboardingPopup.next"})),this.renderSkip())}renderSkip(){return a()(Ve.Z,{style:{marginLeft:16}},void 0,a()(Ne.Z,{onClick:this.props.handleSkip,disableUnderline:!0},void 0,this.props.skipText?this.props.skipText:a()(w.FormattedMessage,{defaultMessage:"Skip the Rest",id:"onboardingPopup.skip"})))}getContentStyles(){return{padding:"20px 24px 10px",borderRadius:3,fontSize:14,lineHeight:1.3,color:this.theme.regularTextColor,backgroundColor:this.theme.popoverBackground,width:360,minHeight:1,...this.props.useFlatStyles&&{boxShadow:void 0,backgroundColor:this.theme.modalBackground}}}}Tr.displayName="OnboardingPopup";const Ir=Tr;class Pr extends l.Z{constructor(e,t){super(e,t),this.boundingBoxRef=void 0,this.storeTypes={store:_r},this.renderOverlays=()=>{const{top:e,left:t,width:o,height:i}=this.stores.store.state,n=[{...this.getStyle({top:0,left:0,width:t,height:"100vh"}),backgroundColor:this.theme.onboardingContentOverlay},{...this.getStyle({top:0,left:t+o,width:"100vw",height:"100vh"}),backgroundColor:this.theme.onboardingContentOverlay},{...this.getStyle({top:0,left:t,width:o,height:e}),backgroundColor:this.theme.onboardingSidebarOverlay},{...this.getStyle({top:e+i,left:t,width:o,height:"100vh"}),backgroundColor:this.theme.onboardingSidebarOverlay},{...this.getStyle({top:e,left:t,width:o,height:i})}];return a()("div",{},void 0,n.map(((e,t)=>a()("div",{style:e},`onboardingOverlay${t}`))))},this.handleResize=()=>{this.measureBounds()},this.handleResizeDebounced=gt().debounce(this.handleResize,10),this.measureBounds=()=>{if(this.props.show&&this.boundingBoxRef&&this.boundingBoxRef.current){const e=this.boundingBoxRef.current.getBoundingClientRect();this.stores.store.setState({...this.stores.store.state,isLoaded:!0,top:e.top,left:e.left,width:e.width,height:e.height})}},this.boundingBoxRef=s.createRef()}didMount(){const{device:e}=this.environment;e.isMobile||window.addEventListener("resize",this.handleResizeDebounced)}didMountOrUpdate(){const{device:e}=this.environment;!e.isMobile&&this.props.show&&this.measureBounds()}willUnmount(){const{device:e}=this.environment;e.isMobile||window.removeEventListener("resize",this.handleResizeDebounced)}renderComponent(){const{device:e}=this.environment;return e.isMobile||!this.props.show?this.props.highlight():a()(s.Fragment,{},void 0,s.createElement(Sr,{ref:this.boundingBoxRef},this.props.highlight()),!this.props.hideOverlays&&this.renderOverlays(),a()(Ir,{buttonText:this.props.buttonText,skipText:this.props.skipText,parentStore:this.stores.store,useFlatStyles:this.props.useFlatStyles,verticalOffset:this.props.verticalOffset||0,handleSkip:this.props.handleSkip,handleNext:this.props.handleNext},void 0,this.props.renderContents))}getStyle(e){const{top:t,left:o,height:i,width:n}=e;return{position:"absolute",top:t,left:o,height:i,width:n,zIndex:D.mJ}}}Pr.displayName="OnboardingHighlightPopup";const xr=Pr;function Br(e){window.__c={n:"SidebarSectionWithEducationPopup"};const{content:t,type:o}=e,i=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),[n]=(0,N.AF)(Mo.default),r=(0,V.O7)(),l=(0,te.Gc)(),c=(0,Ce.yK)((e=>({onboardingSecondaryText:{...ko.uO,...ko.bm(e)}})),[]),d=(0,N.VK)((()=>null==i?void 0:i.getPlanType()),[i]),p=(0,xe.TH)({forIntroModal:!1}),u=(0,N.VK)((()=>!p&&("team"===d?l?"teams"===o:"workspace"===o:"private"===o)),[p,l,o,d]),m=(0,s.useCallback)((async()=>{const t=r.currentUser.id;if(!i||!t)return;const n="teams"===o?e.teamStores[0].getTeamPagesStores()??[]:e.pages;yo.Qt(r);const a=(0,vr.PL)(n,(e=>!(0,hr.H7)(e)));await Oo.deleteBlocks(r,{blocks:a.map((e=>({id:e.id,spaceId:(0,f.CG)(e.pointer.spaceId)}))),permanentlyDelete:!0}),await fr.l({environment:r,spaceId:i.id,userId:t});const s=(0,vr.PL)(n,hr.H7)[0];s&&M.navigateToBlock({environment:r,store:s})}),[e,i,r,o]);if(!i)return null;if(!d)return null;if(!r.device.isMobile&&l)return a()(kr,{highlight:()=>t,show:!1});const g=ko.Bu(n)&&n;return a()(xr,{buttonText:a()(w.FormattedMessage,{defaultMessage:"OK",id:"outlinerToggleButton.popup.buttonText"}),skipText:a()(w.FormattedMessage,{defaultMessage:"Clear templates",id:"outlinerToggleButton.popup.skipText"}),highlight:()=>t,show:g&&u,renderContents:a()("div",{},void 0,a()("span",{style:ko.Vb},void 0,a()(w.FormattedMessage,{defaultMessage:"Here are some templates to help you get started",id:"sidebar.templateIntro.title"})),a()("br",{}),a()("div",{style:c.onboardingSecondaryText},void 0,a()(w.FormattedMessage,{defaultMessage:"Use them out of the box, or customize them to your own workflows.",id:"sidebar.templateIntro.content"}))),handleNext:()=>{g&&yo.lp(r,g)},handleSkip:m})}var Zr=o(88461),Er=o(97986),Rr=o(25464),Ar=o(60442);function Dr(e){let{}=e;window.__c={n:"SidebarCreateTeamButton"};const{isMobile:t}=(0,V.Fy)(),o=(0,Ce.yK)((e=>({button:(0,Jn.G$)({isMobile:t}),icon:{height:20,fill:e.mediumIconColor}})),[t]),i=()=>{Un.lo("sidebar_create_team_button")};return a()(Ai.Z,{renderTooltip:()=>a()(Ar.Z,{caption:a()(w.FormattedMessage,{defaultMessage:"Use Notion with your team by creating your first teamspace",id:"sidebarCreateTeamButton.tooltip",description:"Tooltip for a button that opens a modal for creating a new teamspace."}),imageURL:Et.Z.images.tooltips.sidebar.inviteTeamPreviewPng,imageWidth:180,imageHeight:100}),originGap:6,placement:Rr.u.Right,render:e=>s.createElement(ot.Z,n()({mobileFeedback:t,onClick:i,style:o.button},e),a()(zn.Z,{left:g.Z.sidebarInviteTeam(o.icon),disableMobileBorder:!0},void 0,a()(w.FormattedMessage,{id:"sidebarCreateTeamButton.singlePlayer.button",defaultMessage:"Create a teamspace",description:"Text for a button that opens a modal for creating a new teamspace in a single-player workspace"})))})}var Fr=o(4615),Lr=o(68821),Vr=o(47593),Nr=o(67940),Or=o(92083);function Ur(e){window.__c={n:"SidebarImportTooltip"};const t=(0,V.O7)(),{styles:o}=e,[,i]=(0,N.AF)(Vr.Z),r=(0,N.VK)((()=>Or.Z.state),[]),l=(0,Ce.yK)((e=>({importIcon:{fill:e.mediumIconColor,height:15}})),[]),c=(0,s.useCallback)((()=>{i({open:!0})}),[i]),d=(0,s.useCallback)((e=>{Or.Z.setState({...r,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}),Nr.Z.setState({flowId:e})}),[r]);return a()(Ai.Z,{renderTooltip:()=>a()(w.FormattedMessage,{defaultMessage:"Import from Word, Markdown, HTML, and more.",id:"sidebar.openImportModalButton.tooltip"}),originGap:6,placement:Rr.u.Right,render:e=>s.createElement(ot.Z,n()({onClick:()=>{const e=(0,Fr.ZP)();k.trackOpenImportModal(t,{from:"sidebar",flowId:e}),(0,Lr.c)()?d(e):c()},style:o.sidebarItemButtonStyle},e),a()(zn.Z,{left:g.Z.sidebarImport(l.importIcon)},void 0,a()(w.FormattedMessage,{defaultMessage:"Import",id:"sidebar.openImportModalButton"})))})}var Hr=o(21323),zr=(o(73499),o(37394));function Wr(e){window.__c={n:"SidebarViewTemplatesTooltip"};const{styles:t}=e,o=(0,Ce.yK)((e=>({templatesIcon:{fill:e.mediumIconColor,height:15}})),[]);function i(){zr.Z.open({analyticsFrom:"sidebar",cloneTo:"destination_picker"})}return a()(Ai.Z,{renderTooltip:()=>a()(w.FormattedMessage,{defaultMessage:"View and clone templates into your workspace.",id:"sidebar.openTemplatePickerButton.tooltip"}),originGap:6,placement:Rr.u.Right,render:e=>s.createElement(ot.Z,n()({onClick:i,style:t.sidebarItemButtonStyle},e),a()(zn.Z,{left:g.Z.sidebarTemplates(o.templatesIcon)},void 0,a()(w.FormattedMessage,{defaultMessage:"Templates",id:"sidebar.openTemplatePickerButton"})))})}function jr(e){window.__c={n:"SidebarBottomActions"};const t=(0,N.VK)((()=>E.default.state.mainEditorCurrentBlockStore),[]),o=(0,V.Fy)().isMobile,i=(0,te.OX)(),r=(0,Ce.yK)((e=>({container:{flexGrow:0,flexShrink:0},addPersonIcon:{fill:e.mediumIconColor,height:22,width:22},templatesIcon:{fill:e.mediumIconColor,height:15},importIcon:{fill:e.mediumIconColor,height:15},sidebarItemButtonStyle:(0,Jn.G$)({isMobile:o})})),[o]);return a()("div",{style:r.container},void 0,i&&a()(Dr,{}),a()(Wr,{styles:{sidebarItemButtonStyle:r.sidebarItemButtonStyle}}),a()(Ur,{styles:{sidebarItemButtonStyle:r.sidebarItemButtonStyle}}),t&&a()(Ai.Z,{renderTooltip:()=>a()(w.FormattedMessage,{defaultMessage:"Restore deleted pages.",id:"sidebar.openTrashModalButton.tooltip"}),originGap:6,placement:Rr.u.Right,render:e=>s.createElement(Hr.Z,n()({store:t,buttonStyle:r.sidebarItemButtonStyle,isMobile:!1},e))}),!1)}var Kr=o(6617);function Yr(e){window.__c={n:"TeamsHeadingOverflowMenu"};const{onDismiss:t}=e,o=(0,V.O7)(),i=(0,Ce.yK)((()=>({browseTeamsIcon:{width:20,height:20}})),[]),r={key:"teamsOverflow",render:e=>s.createElement(Ji.Z,n()({},e,{title:a()(w.FormattedMessage,{id:"outlinerTeamOverflow.menu.browseTeamspaces",defaultMessage:"Browse teamspaces",description:"A menu item giving the user an option to browse all teamspaces."}),icon:g.Z.settingsWorkspace(i.browseTeamsIcon)})),action:()=>{t(),Un.tn(o,{from:"sidebar_team_overflow_menu"})}};return a()(ao.Z,{menuType:no.og.Popup},void 0,a()(so.Z,{type:so.i.Vertical,sections:[{key:"browseTeams",render:e=>s.createElement(lo.Z,e),items:[r]}],initialFocus:void 0}))}const Gr=function(){window.__c={n:"TeamOverflowButton"};const e=(0,Kr.Q)(),t=(0,Ce.Fg)(),o=(0,Ce.yK)((()=>({button:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:3},icon:{fill:t.mediumIconColor,width:14,height:14}})),[t]);return e?null:a()(Qi.Z,{popupType:Qi.Z.PopupType.Popup,alignmentToOrigin:Qi.Z.Alignment.Start,originGap:2,renderOrigin:e=>s.createElement(ot.Z,n()({className:ni.JUE,style:o.button,mobileFeedback:!1},e),g.Z.dots(o.icon)),render:e=>a()(Yr,{onDismiss:e.close}),onClick:()=>{en.Z.addNamedPopup("teams_heading_actions")},onClose:()=>{en.Z.removeNamedPopup("teams_heading_actions")}})};function Xr(e){let{isRouteWithoutSpecifiedBlock:t,sidebarState:o,mouseEnteredSidebar:i,onLinkVisit:n,onBookmarkVisit:r}=e;window.__c={n:"SidebarOutliner"};const{currentSpaceStore:l,currentSpaceViewStore:c,currentUserRootStore:d,currentUserStore:p,currentUserSettingsStore:u,mainEditorCurrentBlockStore:m,shadowCursorStore:g}=(0,N.VK)((()=>{const{currentSpaceStore:e,currentSpaceViewStore:t,currentUserRootStore:o,currentUserStore:i,currentUserSettingsStore:n,mainEditorCurrentBlockStore:r,shadowCursorStore:a}=E.default.state;return{currentSpaceStore:e,currentSpaceViewStore:t,currentUserRootStore:o,currentUserStore:i,currentUserSettingsStore:n,mainEditorCurrentBlockStore:r,shadowCursorStore:a}}),[]),{showBookmarksSection:h,showWorkspaceSection:f,showTeamSection:v,showSharedSection:y,showPrivateSection:b,showOnlyPrivateSection:S,showSharedOverflowButton:k,userJoinedTeamsStores:C,allSharedPagesStores:_,visibleSharedPagesStores:M}=o,T=(0,V.O7)(),I=(0,N.VK)((()=>!ur.n.state),[]),P=(0,N.VK)((()=>g.state.currentCursorElement),[g]),x=(0,N.VK)((()=>(null==l?void 0:l.canEdit())&&I),[l,I]),[,,B]=(0,N.AF)(pr.Z),{privateChildStores:Z,workspaceChildStores:R}=(0,N.VK)((()=>{if(!c)return{privateChildStores:void 0,workspaceChildStores:void 0};const e=e=>(0,dr.EE)({typeWithTeam:{type:e},environment:T,currentSpaceViewStore:c,sidebarState:o});return{workspaceChildStores:e("workspace"),privateChildStores:e("private")}}),[c,T,o]),A=(0,N.VK)((()=>(0,te.Xq)({environment:T,spaceStore:l})),[l,T]);if(!((m||t)&&c&&d&&l&&p&&u&&Z&&R))return null;const D=(e,i)=>a()(Er.r,{state:e,sidebarState:o,onLinkVisit:n,onBookmarkVisit:r,isRouteWithoutSpecifiedBlock:t,additionalOutlinerProps:i}),F=(i||"new-page-sidebar"===P)&&I;let L=null;return v&&null!=C&&C.length&&(L=a()(Br,{content:a()(ir.Z,{type:$n.kg,sectionLabel:a()(w.FormattedMessage,{id:"sidebarOutliner.teamsSection.teamsLabel",description:"Sidebar section label for the teamspaces list.",defaultMessage:"Teamspaces"}),shouldPersistToggleState:!0,spaceStore:l,spaceViewStore:c,showAddButton:F&&A,labelTooltip:a()(w.FormattedMessage,{defaultMessage:"Teamspaces you have joined.",description:"Tooltip label on hover over the sidebar section `Teamspaces`",id:"sidebarOutliner.teamsSection.tooltip"}),right:F&&a()(Gr,{}),renderSidebar:()=>a()(Zr.u,{teams:C,isRouteWithoutSpecifiedBlock:t,reorderable:!0})}),type:"teams",teamStores:C})),a()("nav",{},void 0,h&&a()(ir.Z,{type:"bookmarks",shouldPersistToggleState:!0,spaceStore:l,spaceViewStore:c,showAddButton:!1,labelTooltip:a()(w.FormattedMessage,{defaultMessage:"Pages you have favorited.",id:"sidebar.bookmarkedPagesSection.tooltip"}),renderSidebar:()=>D({type:"bookmarks"})}),f&&a()(Br,{content:a()(ir.Z,{type:"workspace",shouldPersistToggleState:!0,spaceStore:l,spaceViewStore:c,showAddButton:F,labelTooltip:a()(w.FormattedMessage,{defaultMessage:"All workspace members can access these pages.",id:"sidebar.workspacePagesSection.tooltip",description:"Tooltip text in sidebar denoting that all workspace members can access these pages."}),renderSidebar:()=>D({type:"workspace"})}),pages:R.concat(Z),type:"workspace"}),v&&L,y&&a()(ir.Z,{type:"shared",shouldPersistToggleState:!0,spaceStore:l,spaceViewStore:c,showAddButton:!1,labelTooltip:a()(w.FormattedMessage,{defaultMessage:"Only people you shared with can access these pages.",id:"sidebar.sharedPagesSection.tooltip"}),renderSidebar:e=>s.createElement(s.Fragment,null,D({type:"shared"}),k&&a()(gr.QO,{originRef:e,type:"shared",spaceStore:l,spaceViewStore:c,userSettingsStore:u,allPages:_,visiblePageIds:M.map((e=>{let{id:t}=e;return t})),render:e=>{let{onClick:t,isPopoverOpen:o}=e;return a()(mr.A,{isPopoverOpen:o,onClick:t,moreCount:_.length-M.length,inline:!1})}}))}),b&&!S&&a()(ir.Z,{type:"private",shouldPersistToggleState:!0,spaceStore:l,spaceViewStore:c,showAddButton:F,outlinerToggleButtonStore:B,labelTooltip:a()(w.FormattedMessage,{defaultMessage:"Pages you created that are not in any teamspace.",id:"sidebar.privatePagesSection.tooltip",description:"Tooltip for the Private section of the sidebar explaining that the pages in this section are created by the current user and not shared in any teamspace"}),renderSidebar:()=>D({type:"private"})}),S&&a()(Br,{content:D({type:"private"},{isHeaderless:!0}),pages:Z,type:"private"}),a()("div",{style:{marginTop:ir.Z.marginBottom}}),x&&a()(jr,{}))}var qr=o(87531),$r=o(75024),Jr=o(92994),Qr=o(30874),ea=o(28209),ta=o(49900),oa=o(74420);function ia(){window.__c={n:"ProjectManagementSidebarItem"};const[e,t]=s.useState(!1),o=(0,V.O7)(),i=(0,Ce.yK)((e=>({wrapper:{display:"flex",alignItems:"center",width:"100%",fontSize:14,minHeight:27,maxHeight:27,paddingTop:2,paddingBottom:2,marginTop:1,marginBottom:1,...(0,Jn.MF)()},icon:{flexShrink:0,width:16,height:16,margin:"0px 1px"},labelWrapper:{display:"inline-flex",alignItems:"top",flex:"1 1 auto",overflow:"hidden"},label:{display:"inline-flex",flexWrap:"wrap",overflow:"clip",maxHeight:22,rowGap:6},close:{padding:3,margin:0,height:void 0,flex:"0 0 auto",marginLeft:"auto"},closeIcon:{margin:0,fill:e.lightIconColor}})),[]),r=(0,N.VK)((()=>E.default.state.currentUserSettingsStore),[]),l=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),c=(0,N.VK)((()=>E.default.state.currentSpaceViewStore),[]);function d(e){if(function(e){const{environment:t,currentSpaceStore:o,userSettingsStore:i}=e;if(!o||!i)return;Pe.createAndCommit({userAction:"ProjManagementIntroModal.updateHasSeen",environment:t,perform:e=>{P.d2({userSettingsStore:i,transaction:e,data:{dismissed_pm_announcement_sidebar:{[o.id]:!0}}})},userId:i.id})}({environment:o,currentSpaceStore:l,userSettingsStore:r}),"dismiss"!==e&&"create"===e){if(!r||!l||!c)return;Qe({environment:o,currentSpaceStore:l,currentSpaceViewStore:c,currentUserSettingsStore:r,isUserEngOrProduct:!1})}}return a()(ot.Z,{onClick:e=>{e.preventDefault(),d("create")},style:(0,Jn.G$)({isMobile:!1})},void 0,a()("div",{style:i.wrapper,onMouseEnter:()=>{t(!0)},onMouseLeave:()=>{t(!1)}},void 0,a()(it.Z,{size:2}),g.Z.giftOutline(i.icon),a()(it.Z,{size:9}),a()("div",{style:i.labelWrapper},void 0,a()("div",{style:i.label},void 0,a()("div",{style:fo.Z.textOverflowStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"Try Notion Projects",id:"sidebarSettingsButton.desktop.tryNotionProjects",description:"Button for users to try the Project management sandbox."})),a()(oa.Z,{})),e?a()(Ai.Z,{alignment:Ai.Z.Alignment.Center,placement:Ai.Z.Placement.Bottom,renderTooltip:e=>s.createElement("div",e,a()(w.FormattedMessage,{defaultMessage:"Dismiss",id:"sidebarSettingsButton.desktop.dismissSandbox",description:"Button for users to dismiss the Project management sandbox."})),render:e=>s.createElement(Le.Z,n()({},e,{isSmall:!0,icon:g.Z.closeSmall,iconStyle:i.closeIcon,style:i.close,onClick:e=>{e.preventDefault(),d("dismiss")}}))}):null)))}class na extends l.Z{constructor(){super(...arguments),this.handleClick=e=>{this.props.onClick&&this.props.onClick(e),_.r()}}renderComponent(){const{currentSpaceStore:e,currentUserStore:t}=E.default.state;let o;return o=e&&e.canRead()?a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Settings & members",id:"sidebarSettingsButton.settingsAndMembers"})):a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Settings",id:"sidebarSettingsButton.mobile.settingsAndMembers"})),a()(ot.Z,{onClick:this.handleClick,onMouseLeave:this.props.onMouseLeave,onMouseMove:this.props.onMouseMove,onMouseDown:this.props.onMouseDown,style:(0,Jn.G$)({isMobile:this.props.isMobile})},void 0,a()(zn.Z,{left:g.Z.sidebarSettings({fill:this.theme.mediumIconColor,width:14})},void 0,o),e&&t&&"rendered"===E.default.state.renderPhase&&a()(Z.LazySpaceSettings,{spaceStore:e,userStore:t},`${e.id}-${null==t?void 0:t.id}`))}}na.displayName="SidebarSettingsButton";const ra=na;var aa=o(79311);function sa(e){let{showTeamSection:t}=e;window.__c={n:"SidebarActions"};const o=(0,V.O7)(),i=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),r=(0,N.VK)((()=>E.default.state.currentUserSettingsStore),[]),[l,c]=(0,s.useState)(!1),[d,p]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),[h,f]=(0,s.useState)(!1),v=(0,N.VK)((()=>(0,te.Xq)({environment:o,spaceStore:i})),[i,o]),y=(0,N.VK)((()=>{const{mainEditorCurrentBlockStore:e}=E.default.state;return null==e?void 0:e.id}),[]),b=(0,w.useIntl)(),S=(0,N.VK)((()=>Boolean(t&&i&&!(0,Vi.Cx)(i))),[t,i]),k=(0,N.VK)((()=>"fullwidth_button"===R.default.getEligibleGroup({experimentId:"new_page_button",defaultGroup:"unassigned"})),[]),C=(0,N.VK)((()=>function(e,t){if(!e||!t)return!1;const o=t.getSettings(),i=Boolean("dismissed"===(null==o?void 0:o.pm_announcement_modal_phase)),n=null==o?void 0:o.dismissed_pm_announcement_sidebar,r=Boolean(n&&n[e.id]);return i&&!r&&J(e.id)}(i,r)),[i,r]),_=(0,Ce.yK)((e=>({container:{flexGrow:0,flexShrink:0,paddingBottom:8},shortcutLabel:{color:e.mediumInvertedTextColor},searchIcon:{fill:e.mediumIconColor,width:14},browseTeamsIcon:{fill:e.mediumIconColor,height:16},sidebarItemButtonStyle:(0,Jn.G$)({isMobile:!1}),plusButton:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:3},plusIcon:{fill:e.mediumIconColor,width:14,height:14},newPageIcon:{width:14,height:14,fill:"light"===e.mode?"rgba(77, 75, 73, 1)":e.accentColors.gray[800]},newPageText:{color:"light"===e.mode?"rgba(77, 75, 73, 1)":e.accentColors.gray[800]}})),[]),T=(0,Jr.a)("integration_discovery"),I=()=>{Un.lo("sidebar_top_section")},P=a()(Ai.Z,{renderTooltip:()=>a()("div",{},void 0,a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Search and quickly jump to a page",id:"sidebar.quickFindSearch.tooltip"})),a()(Ri.Z,{style:_.shortcutLabel,name:"quickFind"})),originGap:6,placement:Rr.u.Right,render:e=>s.createElement(ot.Z,n()({},e,{onClick:()=>qr.Kf({environment:o,analyticsFrom:"sidebar"}),style:(0,Jn.G$)({isMobile:!1})}),a()(zn.Z,{left:g.Z.sidebarSearch(_.searchIcon),style:(0,Jn.MF)()},void 0,a()(w.FormattedMessage,{defaultMessage:"Search",id:"sidebar.search.label",description:"Button to open the search modal."})))}),x=u||h,B=!x&&(l||d),Z=S&&a()(Ai.Z,{forceVisibleState:B,renderTooltip:()=>s.createElement(s.Fragment,null,a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Browse all teamspaces",id:"sidebar.openSidebarTeamBrowserButton.tooltip",description:"A tooltip text to tell the user they can click on the button to browse all teamspaces."})),a()(Ri.Z,{style:_.shortcutLabel,name:"toggleAllTeams"})),originGap:6,placement:Rr.u.Right,render:e=>s.createElement(ot.Z,n()({onClick:()=>Un.tn(o,{from:"sidebar_browse_team_item"}),style:_.sidebarItemButtonStyle},(0,gn.Z)(e,{onFocus:()=>p(!0),onBlur:()=>p(!1),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1)})),a()(zn.Z,{left:g.Z.openTeamThick(_.browseTeamsIcon),right:v&&a()(Ai.Z,{forceVisibleState:x,textWrap:!1,renderTooltip:()=>a()(w.FormattedMessage,{defaultMessage:"New teamspace",id:"sidebar.addButton.addTeamTooltip",description:"Tooltip for 'New teamspace' button in sidebar"}),originGap:16,placement:Rr.u.Right,render:e=>s.createElement(ot.Z,n()({style:l||d?_.plusButton:$r.jy,mobileFeedback:o.device.isMobile,onClick:I},(0,gn.Z)(e,{onFocus:()=>f(!0),onBlur:()=>f(!1),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1)})),g.Z.plusThick(_.plusIcon))})},void 0,a()(w.FormattedMessage,{defaultMessage:"All teamspaces",description:"Button in the top sidebar menu. When clicked, the user's sidebar will be replaced with the teamspaces browser.",id:"sidebar.openSidebarTeamBrowserButton"})))}),D=a()(Ai.Z,{renderTooltip:()=>a()("div",{style:{width:200}},void 0,a()(w.FormattedMessage,{defaultMessage:"Update your profile, upgrade to Pro, or invite new members",id:"sidebar.upgradeButton.prompt"})),originGap:6,textWrap:!0,placement:Rr.u.Right,render:e=>s.createElement(ra,n()({isMobile:!1},e))}),F=C?a()(ia,{}):null,O="top_left_sidebar"===T?a()(Ai.Z,{renderTooltip:()=>a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Find your integration",id:"sidebar.integrations.tooltip",description:"Button to allow users to find integrations they can install"})),originGap:6,placement:Rr.u.Right,render:e=>s.createElement(ot.Z,n()({},e,{onClick:()=>{Qr.Z.state.loaded&&ta.d.setState({open:!0,selectedIntegration:Qr.Z.state.integrations[0]})},style:(0,Jn.G$)({isMobile:!1})}),a()(zn.Z,{left:g.Z.settingsConnectedApps(),style:(0,Jn.MF)()},void 0,a()(w.FormattedMessage,{defaultMessage:"Integrations",id:"sidebar.integrations.label",description:"Button to open the integrations modal."})))}):null,U=function(e,t){const o=(0,V.Fy)(),i=(0,Ce.yK)((e=>({sidebarCurrent:{fontWeight:fo.Z.fontWeight.semibold,background:e.sidebarItemSelectedBackground,color:e.regularTextColor,...o.isMobile&&{boxShadow:`\n\t\t\t\t\t\t0 1px 0 ${e.buttonHoveredBackground}\n\t\t\t\t\t`}}})),[o]);return(0,N.VK)((()=>{const{userHomePageId:o}=ea.Z.state,{currentSpaceStore:n}=E.default.state;if(!n||!o)return[];const r=A.G.createChildStore(n,{table:oo.iU,id:o,spaceId:n.id}),s=r.getIcon(),l=(0,zt.ZP)({store:r});return a()(Ro.Z,{style:{width:"100%"},href:l,onClick:()=>{M.navigate({environment:e,url:l})},innerStyle:(0,Jn.G$)({isMobile:!1})},void 0,a()(zn.Z,{left:s?a()(Do.Z,{bucket:"secure",icon:s,store:r,disabled:!0,size:18,isEmptyPage:!1}):g.Z.home({height:16}),style:{...t===r.id?i.sidebarCurrent:void 0}},void 0,a()(Ni.Z,{store:r})))}),[e,t,i.sidebarCurrent])}(o,y),H=a()(Ai.Z,{renderTooltip:()=>s.createElement(s.Fragment,null,a()("div",{},void 0,b.formatMessage(L.newPageMessages.tooltip)),o.device.isNative&&a()(Ri.Z,{style:_.shortcutLabel,name:"newPage"})),originGap:6,placement:Rr.u.Right,render:e=>s.createElement(ot.Z,n()({},e,{onClick:()=>{L.quickAddPage({environment:o,from:"sidebar_new_page_button"})},style:(0,Jn.G$)({isMobile:!1})}),a()(zn.Z,{left:g.Z.circlePlus(_.newPageIcon),style:_.newPageText},void 0,a()(w.FormattedMessage,{defaultMessage:"New page",id:"sidebar.newPage.button"})))});return a()("div",{style:_.container},void 0,P,a()(aa.Z,{format:aa.Z.Format.Sidebar}),Z,O,D,F,U,k&&H)}var la=o(59054),ca=o(3791),da=o(4708),pa=o(17364),ua=o(63314),ma=o(98692),ga=o(64964),ha=o(85834),fa=o(9019);const va=function(e){window.__c={n:"GuestMembershipRequest"};const t=(0,V.O7)(),{store:o,origin:i}=e,[n,r]=(0,s.useState)(!1),[l,c]=(0,s.useState)(""),d=(0,w.useIntl)(),p=(0,Ce.yK)((()=>({modalStyle:{alignSelf:"center",overflow:"visible",top:0,width:350},container:{padding:20},title:{fontWeight:fo.Z.fontWeight.medium,marginBottom:10},input:{width:"100%",padding:"8px 12px",marginTop:10,marginBottom:10},button:{width:"100%",marginTop:10}})),[]),u=()=>{const{currentUser:e}=t;e&&e.id&&(k.trackClickMembershipRequest(t,{invite_flow_id:void 0,user_count:1,new_user_count:1,is_bot:!1,space_role:"read_and_write",invite_message_length:l.length,invite_space_role_selection:ha.uq.request_workspace_member,from:"sidebar_guest_request"}),Oo.requestAccess(t,{type:"actor-to-space",forActorId:e.id,spaceId:o.id,message:l,attributes:{origin_id:o.id,origin_type:"sidebar_guest_request",origin_table:"space",add_permissions_on_approval:!1}}).catch((()=>{ga.oV({label:a()(w.FormattedMessage,{id:"guestMembershipRequestModal.confirmationToast.errorMessage",description:"Informs the user that their membership request failed.",defaultMessage:"Failed to send membership request."})})})).finally((()=>{ga.oV({label:a()(w.FormattedMessage,{id:"guestMembershipRequestModal.confirmationToast.successMessage",description:"Informs the user that they successfully sent a request to become a member.",defaultMessage:"Sent membership request."})})})),c(""),r(!1))};return a()(fa.Z,{modalStyle:p.modalStyle,open:n,origin:a()("div",{onClick:()=>{k.trackOpenGuestMembershipRequestModal(t),r(!0)}},void 0,i),onDismiss:()=>r(!1),renderContent:()=>a()("div",{style:p.container},void 0,a()("div",{style:p.title},void 0,a()(w.FormattedMessage,{id:"GuestMembershipRequestModal.title",description:"Title for modal where guests can request to become a workspace member",defaultMessage:"Request membership to workspace"})),a()(zo.Z,{capture:!0,allowEsc:!0},void 0,a()(Wo.Z,{style:p.input,textarea:!0,value:l,placeholder:d.formatMessage({id:"GuestMembershipRequestModal.message.placeholder",defaultMessage:"Reason (optional)",description:"Placeholder text that appears in an empty textbox where users can type a reason for their membership request."}),onChange:e=>{c(e.target.value)}}),a()(Re.Z,{isLarge:!0,style:p.button,onClick:u},void 0,a()(w.FormattedMessage,{id:"GuestMembershipRequestModal.sendRequest.button",description:"Text on button that, when clicked, sends a membership request.",defaultMessage:"Send request"})),a()(Ao.Z,{isLarge:!0,style:p.button,onClick:()=>{c(""),r(!1)}},void 0,a()(w.FormattedMessage,{id:"GuestMembershipRequestModal.cancel.button",description:"Text on button that, when clicked, closes the membership request modal.",defaultMessage:"Cancel"}))))})};const ya=function(e){window.__c={n:"GuestMembershipRequestPrompt"};const t=(0,V.O7)(),{style:o}=e;return(0,s.useEffect)((()=>{k.trackRenderGuestMembershipRequestEntryPoint(t)}),[]),a()(Le.Z,{icon:g.Z.team,style:o},void 0,a()(w.FormattedMessage,{defaultMessage:"Request to be a member",id:"sidebar.guestMember.requestMembershipPrompt",description:"Text on a button that opens a modal where a user can request to become a workspace member."}))};var ba=o(62385);class Sa extends l.Z{renderComponent(){const{title:e,children:t,handleClick:o,handleCloseClick:i,showCloseButton:n,style:r,blueEmphasis:s}=this.props;return a()(ot.Z,{style:{position:"relative",padding:10,margin:12,fontSize:12,background:s?m.ZP.blue:this.theme.sidebarItemSelectedBackground,borderRadius:6,...r},onClick:o,hovered:!1,ignoreLocalHoverState:!0,pressedStyle:s?{background:m.ZP.blue}:{}},void 0,e&&a()("div",{style:{marginRight:16}},void 0,a()("div",{style:{fontWeight:fo.Z.fontWeight.medium,flexGrow:1,color:s?m.ZP.white:this.theme.regularTextColor}},void 0,e)),t,n&&a()(ba.Z,{style:{position:"absolute",top:7,right:8},onClick:i},void 0,g.Z.closeThick({width:10,opacity:"75%",...s?{fill:m.ZP.white}:{}})))}}Sa.displayName="SidebarNotification";const wa=Sa;var ka=o(98285);function Ca(e){const{currentUserSettingsStore:t}=E.default.state;return t?(Pe.createAndCommit({userAction:"SidebarCreateWorkAccountPrompt.hidePrompt",environment:e,perform:e=>{Te.sW({store:t.getSettingsStore(),data:{seen_sidebar_work_prompt:!0},transaction:e})}}),{success:!0}):{success:!1}}const _a=function(e){window.__c={n:"SidebarCreateWorkAccountPrompt"};const t=(0,V.O7)(),o=(0,s.useCallback)((()=>{const{success:e}=Ca(t);e&&k.trackSidebarCreateAccountPromptClick(t)}),[t]),i=(0,s.useCallback)((()=>{const{success:e}=Ca(t);e&&k.trackSidebarCreateAccountPromptCloseClick(t)}),[t]);return a()(wa,{title:a()(w.FormattedMessage,{defaultMessage:"Using Notion for work?",id:"sidebarCreateWorkAccountPrompt.title",description:"Title for the sidebar create work account prompt."}),showCloseButton:!0,handleClick:o,handleCloseClick:i},void 0,a()("div",{style:{display:"flex",flexDirection:"column",marginTop:4}},void 0,a()(w.FormattedMessage,{defaultMessage:"Create a work account with your work email to collaborate with teammates.",id:"sidebarCreateWorkAccountPrompt.subtitle",description:"The description to emphasize that a user can create a work account where they work with their team."}),a()("div",{style:{textDecoration:"underline"}},void 0,a()(ka.Z,{icon:g.Z.team({height:12,width:12,display:"inline",paddingTop:2,marginRight:2}),createType:"create-work"}))))};var Ma=o(32056);class Ta extends l.Z{constructor(){super(...arguments),this.handleClick=()=>{Or.Z.setState({open:!0,currentTab:"credit",defaultSubtab:void 0,highlightedSetting:void 0}),k.trackInvitedByCreditClick(this.environment)},this.handleCloseClick=()=>{const{currentUserSettingsStore:e}=E.default.state;e&&Pe.createAndCommit({userAction:"SidebarCredit.handleCloseClick",environment:this.environment,perform:t=>{Te.sW({store:e.getSettingsStore(),data:{hide_referral_notification:!0},transaction:t}),k.trackInvitedByCreditCloseClick(this.environment)}})}}renderComponent(){const{data:e}=re.default.state;if(!e)return;const{intl:t}=this.props,{availableCredit:o}=e,i=Math.floor(o/x.Z.pricing.personal.monthlyPrice);return a()(wa,{title:a()("div",{style:{display:"flex"}},void 0,g.Z.gift({width:14,marginRight:6,fill:this.theme.mediumIconColor}),a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"You earned {creditAmountInDollars} in credit.",id:"sidebarCredits.earnedCredit.message",values:{creditAmountInDollars:a()("b",{style:{color:this.theme.regularTextColor}},void 0,(0,Ma.Dx)({amount:o,currency:"dollar",intl:t}))}}),i>0&&a()(s.Fragment,{},void 0," ",a()(w.FormattedMessage,{id:"sidebarCredits.freeMonthMessage",description:"Message in sidebar letting user know they have credits",defaultMessage:"{numberOfMonths, plural, one {That's <b>{numberOfMonths} month</b> free.} other {That's <b>{numberOfMonths} months</b> free.}}",values:{numberOfMonths:i,b:e=>a()("b",{style:{color:this.theme.regularTextColor}},void 0,e)}})))),showCloseButton:!0,handleClick:this.handleClick,handleCloseClick:this.handleCloseClick})}}Ta.displayName="SidebarCredit";const Ia=(0,w.injectIntl)(Ta);var Pa=o(90850);class xa extends l.Z{constructor(){super(...arguments),this.handleClick=()=>{Or.Z.setState({open:!0,currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0}),k.trackSidebarPromoClick(this.environment)},this.handleCloseClick=()=>{Pa.$r(this.environment.currentUser.id),this.enqueueForceUpdate()}}renderComponent(){const e=Pa.Zk(this.environment.currentUser.id);if(e)return a()(Ko.Z,{request:e,performRequest:async e=>{const t=await Oo.getPromoCode(this.environment,{code:e});if("success"===t.type&&t.data.promo)return t.data.promo},render:(e,t)=>{if(t)return a()(wa,{title:t.description,showCloseButton:!0,handleClick:this.handleClick,handleCloseClick:this.handleCloseClick})}})}}xa.displayName="SidebarPromoCode";const Ba=xa;var Za=o(21325),Ea=o(21115);class Ra extends l.Z{constructor(){super(...arguments),this.getText=()=>({title:a()(w.FormattedMessage,{defaultMessage:"You're eligible for a free Education plan for individuals.",id:"sidebarStudentPlanPrompt.eligible.messagePlus",description:"Shown to users who are eligible for a discounted plan"}),prompt:a()(w.FormattedMessage,{defaultMessage:"Get the Education Plan",id:"sidebarStudentPlanPrompt.eligible.getFreePromptPlus",description:"Shown to users who are eligible for a discounted plan"})}),this.handleClick=()=>{Or.Z.setState({open:!0,currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0}),k.trackStudentPlanPromptClick(this.environment);const e=E.default.state.currentSpaceStore;e&&Za.r7({environment:this.environment,spaceStore:e})},this.handleCloseClick=()=>{const{currentUserSettingsStore:e}=E.default.state;e&&Pe.createAndCommit({userAction:"SidebarStudentPlanPrompt.handleCloseClick",environment:this.environment,perform:t=>{Te.sW({store:e.getSettingsStore(),data:{hide_student:!0},transaction:t}),k.trackStudentPlanPromptCloseClick(this.environment)}})}}renderComponent(){if((0,Ea.uo)(this.environment))return a()(Ko.Z,{request:{},performRequest:e=>Oo.isEmailEducation(this.environment,e),render:(e,t,o)=>{if(o&&t&&"failed"!==t.type&&t.data.isEligible){const{title:e,prompt:t}=this.getText();return a()(wa,{title:e,showCloseButton:!0,handleClick:this.handleClick,handleCloseClick:this.handleCloseClick},void 0,a()("div",{style:{display:"flex",marginTop:4}},void 0,a()("div",{style:{textDecoration:"underline"}},void 0,t)))}}})}}Ra.displayName="SidebarStudentPlanPrompt";const Aa=Ra;function Da(e){let{}=e;window.__c={n:"SidebarFooter"};const t=(0,V.O7)(),{canEditSpace:o,currentUserRootStore:i,settings:n,currentSpaceStore:r}=(0,N.VK)((()=>{var e,t;return{canEditSpace:(null===(e=E.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit())??!1,currentUserRootStore:E.default.state.currentUserRootStore,settings:null===(t=E.default.state.currentUserSettingsStore)||void 0===t?void 0:t.getSettings(),currentSpaceStore:E.default.state.currentSpaceStore}}),[]),l=(0,N.Kw)(ur.n),{foundInvitedByCredit:c,subscriptionType:d,hasAddOn:p}=(0,N.VK)((()=>{var e;const t=re.default.state.data;return{foundInvitedByCredit:null==t||null===(e=t.credits)||void 0===e?void 0:e.find((e=>"invited_by_user"===e.type)),subscriptionType:null==t?void 0:t.type,hasAddOn:(0,ca.E3)(null==t?void 0:t.addOns)}}),[]),{device:u}=t,m=(0,N.VK)((()=>!(pa.Z.hasAtLeastOneTeamPlan(t)||u.isMobile||u.isMobileBrowser||null!=n&&n.seen_sidebar_work_prompt||"on"!==R.default.getEligibleGroup({experimentId:"prompt_work_account_sidebar",defaultGroup:"control"}))),[n,u,t]),h=(0,Kr.Q)(),f=(0,N.VK)((()=>{const e=R.default.getEligibleGroup({experimentId:"new_page_button",defaultGroup:"unassigned"});return"control"===e||"unassigned"===e}),[]),v=(0,s.useCallback)((()=>{yo.xN(t)}),[t]),y=(0,s.useCallback)((()=>{L.quickAddPage({environment:t,from:"sidebar_new_page_button"})}),[t]),[{value:b,status:S}]=(0,la.r5)((async()=>{if(!r||o)return!1;if(Oo.setSeenGuestMembershipRequests(t,{spaceId:r.id}),!(0,da.Ye)(t))return!1;const e=await Oo.isEligibleForGuestMembershipRequest(t,{spaceId:r.id});return"failed"!==e.type&&(Oo.setSeenGuestMembershipRequests(t,{spaceId:r.id}),e.data.isEligible)}),[o,r,t]),k=(0,Ce.yK)((e=>{const t={display:"block",flexGrow:0,flexShrink:0,flexBasis:"auto",marginTop:"auto"};return{footer:t,canViewOnlyFooter:{...t,padding:14,boxShadow:`0 -1px 0 ${e.regularDividerColor}`},createWorkspaceButton:{marginTop:8,marginLeft:-8}}}),[]);if(!i)return s.createElement(s.Fragment,null);if(!o){if(h)return null;let e=null;return"pending"!==S&&(e=b&&r?a()(va,{store:r,origin:a()(ya,{style:k.createWorkspaceButton})}):a()(Le.Z,{icon:g.Z.team,onClick:v,style:k.createWorkspaceButton},void 0,a()(w.FormattedMessage,{defaultMessage:"Create a workspace",id:"sidebar.guestMember.createWorkspacePrompt"}))),a()("div",{style:k.canViewOnlyFooter},void 0,a()(Ve.Z,{isSmall:!0,isMultiline:!0},void 0,a()(w.FormattedMessage,{defaultMessage:"You are currently a guest. To see all the workspace pages, ask an admin to upgrade you to a member.",id:"sidebar.guestMember.message"})),e)}if(l)return s.createElement(s.Fragment,null);const C=!(null!=n&&n.hide_student||"unsubscribed_admin"!==d&&"unsubscribed_member"!==d),_=c&&!(null!=n&&n.hide_referral_notification),M="unsubscribed_admin"===d||"unsubscribed_member"===d;return a()("div",{style:k.footer},void 0,M&&a()(ma.Z,{source:"sidebar"}),!p&&a()(ua.ZP,{source:"sidebar"}),m&&a()(_a,{}),C&&a()(Aa,{}),_&&a()(Ia,{}),M&&a()(Ba,{}),f&&a()(Wn,{onClick:y,label:a()(w.FormattedMessage,{defaultMessage:"New page",id:"sidebar.newPage.button"})}))}var Fa=o(73744),La=o(31280);function Va(e){let{isExpanded:t,isElectronMac:o,mouseEnteredSidebar:i}=e;window.__c={n:"SidebarHeader"};const n=(0,N.VK)((()=>Nn.Z.state.isFullScreen),[]),r=(0,V.O7)(),{currentUserSettingsStore:l,currentUserRootStore:c}=(0,N.VK)((()=>{const{currentUserSettingsStore:e,currentUserRootStore:t}=E.default.state;return{currentUserRootStore:t,currentUserSettingsStore:e}}),[]),d=(0,N.VK)((()=>On.Z.state.isShowingTabBar),[]),p=(0,s.useCallback)((async e=>{let{event:t,spaceViewStore:o}=e;const i=Fa.DJ(t);await Ie.y3({environment:r,spaceViewStore:o,userSettingsStore:l,userRootStore:c,openInNew:i,shouldDeferSubscriptionRefresh:!0})}),[c,l,r]),u=(0,Ce.yK)((()=>({header:{display:"block",flexShrink:0,flexGrow:0}})),[]),m=(0,ee.GD)({isElectronMac:o,isExpanded:t,isFullScreenDesktop:n,mouseEnteredSidebar:i,isShowingTabBar:d});return a()("div",{style:u.header},void 0,a()(Yn,{isExpanded:t,mouseEnteredSidebar:i}),a()(La.ZP,{shouldShowUnexpandButton:m,format:o&&t?La._S.DesktopMac:La._S.Regular,onSpaceClick:p}))}function Na(e){let{isExpanded:t,isElectronMac:o,mouseEnteredSidebar:i,sidebarState:n}=e;const r=(0,V.O7)(),l=(0,N.qz)(void 0,er.Z),c=(0,N.VK)((()=>(0,v.wO)(r.RouterStore.state.route)),[r.RouterStore]),d=(0,s.useCallback)(((e,t)=>{"link"===e?cr.Z.recordVisit({id:t.id,type:Ze.vu.Link,currentUserId:r.currentUser.id}):"bookmark"===e&&cr.Z.recordVisit({id:t.id,type:Ze.vu.Favorite,currentUserId:r.currentUser.id}),Ln.V()}),[r.currentUser.id]),p=(0,s.useCallback)((e=>d("bookmark",e)),[d]),u=(0,s.useCallback)((e=>d("link",e)),[d]);return s.createElement(s.Fragment,null,a()(Va,{isExpanded:t,isElectronMac:o,mouseEnteredSidebar:i}),a()(sa,{showTeamSection:n.showTeamSection}),a()(or,{scrollerStore:l},void 0,a()(Xr,{isRouteWithoutSpecifiedBlock:c,mouseEnteredSidebar:i,sidebarState:n,onLinkVisit:u,onBookmarkVisit:p})),a()(Da,{}))}function Oa(e){let{isExpanded:t,isElectronMac:o,topPx:i,mouseEnteredSidebar:n}=e;window.__c={n:"SidebarContentContainer"};const r=(0,V.O7)(),l=(0,N.VK)((()=>(0,K.k_)(r).state),[r]),c=(0,N.Kw)(ie.kx),d=(0,s.useCallback)((e=>{k.trackCloseTeamBrowser(r,{from:"sidebar_close_button",num_of_joined_teams:e.numOfJoinedTeams,num_of_unjoined_teams:e.numOfUnJoinedTeams}),ie.kx.setState(!1)}),[r]),p=function(e){let{showTeamBrowser:t,isExpanded:o,topPx:i}=e;return(0,Ce.yK)((()=>{const e={display:"flex",flexDirection:"column",height:o?"100%":"auto",maxHeight:o?"100%":`calc(100vh - ${2*i}px)`};return{paneAnimationContainer:{...e,overflow:"hidden",position:"relative"},teamBrowserContainer:{position:"absolute",height:"100%",width:"100%"},topLevelSidebar:{...e,...t&&{pointerEvents:"none"}}}}),[o,t,i])}({showTeamBrowser:c,isExpanded:t,topPx:i});if(!l)return s.createElement(s.Fragment,null);const u=a()(Na,{isExpanded:t,isElectronMac:o,mouseEnteredSidebar:n,sidebarState:l});return a()("div",{style:p.paneAnimationContainer},void 0,a()(fi.Z,{isVisible:!0,animationStyle:c?Ua:Ha,render:()=>a()("div",{style:p.topLevelSidebar},void 0,u)}),a()(fi.Z,{isVisible:c,enterAnimationStyle:za,animationStyle:Ha,exitAnimationStyle:za,render:()=>a()("div",{style:p.teamBrowserContainer},void 0,a()(lr,{mouseEnteredSidebar:n,isExpanded:t,onBackClicked:d,sidebarState:l}))}))}const Ua={translateXPercent:-100},Ha={translateXPercent:0},za={translateXPercent:100},Wa=function(e){let{isExpanded:t,isElectronMac:o}=e;window.__c={n:"Sidebar"};const i=(0,V.O7)(),n=Ka(i),[r,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),p=(0,N.VK)((()=>ie.GZ.state),[]),u=(0,N.VK)((()=>ie.TC.state),[]),m=(0,N.VK)((()=>ie.cY.state),[]),g=(0,N.VK)((()=>Nn.Z.state.isFullScreen),[]),{isTabsFeatureEnabled:h,isShowingTabBar:f}=(0,N.VK)((()=>On.Z.state),[]),v=m.isResizerHovered||m.isResizing,y=e=>{(0,Vn.ZP)({event:e,context:Vn.Af.SidebarMouseMove,callback:()=>{L.open()}})},b=(0,s.useCallback)((()=>{d(!0)}),[]),S=(0,s.useCallback)((e=>{o&&g&&e.relatedTarget===window||d(!1)}),[o,g]),w=(0,s.useCallback)((e=>{"empty"!==e.state.mode&&Ln.V()}),[]);var k;k=w,(0,s.useEffect)((()=>(gi.default.addListener(k),()=>gi.default.removeListener(k))),[k]);const C=u||t,_=(0,Ce.yK)((e=>{const o={transition:"box-shadow 300ms ease",boxShadow:v?e.sidebarResizerBoxShadow:e.sidebarBoxShadow};return{container:{flexGrow:0,flexShrink:0,pointerEvents:"none",position:"relative",zIndex:D.vt,background:h?e.desktopTabsSidebarBackground:e.sidebarBackground,...o},wrap:{color:e.sidebarTextColor,fontWeight:fo.Z.fontWeight.medium,height:"100%"},resizer:{position:"absolute",top:0,left:0,bottom:0,right:0,borderTopRightRadius:3,borderBottomRightRadius:3,zIndex:-1,display:t?"none":"block",...o},content:{position:"absolute",top:0,left:0,bottom:0,display:"flex",flexDirection:"column",width:0,overflow:"visible",zIndex:D.nD,pointerEvents:"none"},pane:{display:"flex",flexDirection:"column",height:t?"100%":"auto",position:"relative",pointerEvents:C?"auto":"none",visibility:C||r?"visible":"hidden"},paneBackground:{display:t?"none":"block",position:"absolute",top:0,left:0,bottom:0,right:0,borderTopRightRadius:3,borderBottomRightRadius:3,zIndex:-1,background:e.floatingSidebarBackground,boxShadow:e.mediumBoxShadow}}}),[t,C,r,v,h]);return a()(fi.Z,{isVisible:!0,animationStyle:{width:t?p:0},skipAnimation:f&&m.isResizing,render:()=>s.createElement("div",{style:_.container,className:"notion-sidebar-container",ref:e=>{i.device.isElectron&&h&&(e?ie.H3.observe(e):ie.H3.destroy())}},a()("div",{style:_.wrap},void 0,a()("div",{style:_.content,onMouseMove:y},void 0,a()(fi.Z,{isVisible:!0,animationStyle:ja({environment:i,isExpanded:t,isSidebarOpen:u,sidebarWidth:p}),skipAnimation:f&&m.isResizing,useCompositeLayer:!0,onAnimationStart:()=>l(!0),onAnimationEnd:()=>l(!1),render:()=>a()("div",{"aria-hidden":C?void 0:"true",style:_.pane,className:ni.rcG,onMouseMove:b,onMouseLeave:S},void 0,a()("div",{style:_.paneBackground}),a()("div",{style:_.resizer}),a()(Oa,{isElectronMac:o,isExpanded:t,topPx:n,mouseEnteredSidebar:c}),a()(wn,{type:"page"}))}))))})};function ja(e){let{environment:t,isExpanded:o,isSidebarOpen:i,sidebarWidth:n}=e;return o?{width:n,translateX:0,translateY:0,opacity:1}:i?{width:n,translateX:0,translateY:Ka(t),opacity:1}:{width:n,translateX:20-n,translateY:Ka(t),opacity:0}}function Ka(e){return _i.R6(e.device.isElectronMac)+15}var Ya=o(17126),Ga=o(26929),Xa=o(97880),qa=o(62216);const $a={updatePaymentMethod:a()(w.FormattedMessage,{id:"subscription.payment_status_banner.update_payment_method",description:"CTA message for payment status banner for workspace admins",defaultMessage:"View unpaid invoice"}),viewWorkspaceOwner:a()(w.FormattedMessage,{id:"subscription.payment_status_banner.view_workspace_owner",description:"CTA message for payment status banner for members",defaultMessage:"View workspace owner"}),confirmPayment:a()(w.FormattedMessage,{id:"subscription.payment_status_banner.confirm_payment",description:"CTA message for confirmation required banner for workspace admins",defaultMessage:"Confirm payment"})};function Ja(e){const{messageType:t,overdueInvoiceCount:o=1}=e;switch(t){case"past_due_owner":return a()(w.FormattedMessage,{id:"subscription.payment_status_banner.payment_failed.past_due.workspace_owner",description:"Message for payment failed banner for workspace admins",defaultMessage:"We couldn’t process {overdueInvoiceCount, plural, one {your last payment} other {{overdueInvoiceCount} payments}}. Please update your payment method or you may lose access to Notion soon.",values:{overdueInvoiceCount:o}});case"past_due_member":return a()(w.FormattedMessage,{id:"subscription.payment_status_banner.payment_failed.past_due.member",description:"Message for payment failed banner for members",defaultMessage:"Please contact a workspace owner to update your payment method or you may lose access to Notion soon."});case"unpaid_owner":return a()(w.FormattedMessage,{id:"subscription.payment_status_banner.payment_failed.unpaid.workspace_owner",description:"Message for payment failed banner for workspace admins",defaultMessage:"Access to Notion is limited to viewing because we couldn’t process {overdueInvoiceCount, plural, one {your last payment} other {{overdueInvoiceCount} payments}}. Update your payment information to restore full access.",values:{overdueInvoiceCount:o}});case"unpaid_member":return a()(w.FormattedMessage,{id:"subscription.payment_status_banner.payment_failed.unpaid.member",description:"Message for payment failed banner for members",defaultMessage:"Access to Notion is limited to viewing. Contact a workspace owner to update your workspace’s payment method."});default:(0,Xa.t1)(t)}}function Qa(e){const{messageType:t,overdueInvoiceCount:o=1}=e;switch(t){case"past_due_owner":return a()(w.FormattedMessage,{id:"subscription.payment_status_banner.confirmation_required.past_due.workspace_owner",description:"Message for confirmation required banner for workspace admins",defaultMessage:"Please confirm {overdueInvoiceCount, plural, one {your subscription payment} other {{overdueInvoiceCount} payments}} or you may lose access to Notion soon.",values:{overdueInvoiceCount:o}});case"unpaid_owner":return a()(w.FormattedMessage,{id:"subscription.payment_status_banner.confirmation_required.unpaid.workspace_owner",description:"Message for confirmation required banner for workspace admins",defaultMessage:"Access to Notion is limited to viewing. Confirm {overdueInvoiceCount, plural, one {your subscription payment} other {{overdueInvoiceCount} payments}} to restore full access.",values:{overdueInvoiceCount:o}});case"unpaid_member":return a()(w.FormattedMessage,{id:"subscription.payment_status_banner.confirmation_required.unpaid.member",description:"Message for confirmation required banner for members",defaultMessage:"Access to Notion is limited to viewing. Contact a workspace owner to update your workspace’s payment method."});default:(0,Xa.t1)(t)}}function es(){return()=>{_.r()}}function ts(e){if(void 0!==e)return()=>{e&&window.open(e,"_blank")}}function os(e){const{overdueSubscription:t,isWorkspaceOwner:o,paymentStatusWithReason:i}=e,{invoiceHostedUrl:n,overdueInvoiceCount:r}=t,{paymentStatus:a}=i;switch(a){case"past_due":return function(e){const{isWorkspaceOwner:t,invoiceHostedUrl:o,overdueInvoiceCount:i}=e,n=ve.$.Yellow;return t?{bannerType:n,messageType:"past_due_owner",messageText:Ja({overdueInvoiceCount:i,messageType:"past_due_owner"}),callToActionText:$a.updatePaymentMethod,callToActionHandler:ts(o)}:{bannerType:n,messageType:"past_due_member",messageText:Ja({overdueInvoiceCount:i,messageType:"past_due_member"}),callToActionText:$a.viewWorkspaceOwner,callToActionHandler:es()}}({isWorkspaceOwner:o,invoiceHostedUrl:n,overdueInvoiceCount:r});case"unpaid":return function(e){const{isWorkspaceOwner:t,invoiceHostedUrl:o,overdueInvoiceCount:i}=e,n=ve.$.LightRed;return t?{bannerType:n,messageType:"unpaid_owner",messageText:Ja({overdueInvoiceCount:i,messageType:"unpaid_owner"}),callToActionText:$a.updatePaymentMethod,callToActionHandler:ts(o)}:{bannerType:n,messageType:"unpaid_member",messageText:Ja({overdueInvoiceCount:i,messageType:"unpaid_member"}),callToActionText:$a.viewWorkspaceOwner,callToActionHandler:es()}}({isWorkspaceOwner:o,invoiceHostedUrl:n,overdueInvoiceCount:r});case"paid":return;default:(0,Xa.t1)(a)}}function is(e){const{overdueSubscription:t,isWorkspaceOwner:o,paymentStatusWithReason:i}=e,{invoiceHostedUrl:n}=t,{paymentStatus:r}=i;switch(r){case"past_due":return function(e,t,o){if(e)return{bannerType:ve.$.Yellow,messageType:"past_due_owner",messageText:Qa({overdueInvoiceCount:o,messageType:"past_due_owner"}),callToActionText:$a.confirmPayment,callToActionHandler:ts(t)}}(o,n);case"unpaid":return function(e,t,o){const i=ve.$.LightRed;return e?{bannerType:i,messageType:"unpaid_owner",messageText:Qa({overdueInvoiceCount:o,messageType:"unpaid_owner"}),callToActionText:$a.confirmPayment,callToActionHandler:ts(t)}:{bannerType:i,messageType:"unpaid_member",messageText:Qa({overdueInvoiceCount:o,messageType:"unpaid_member"}),callToActionText:$a.viewWorkspaceOwner,callToActionHandler:es()}}(o,n);case"paid":return;default:(0,Xa.t1)(r)}}function ns(e){window.__c={n:"SubscriptionPaymentStatusBannerContent"};const{messages:t,paymentStatusViewData:o}=e,{messageText:i,messageType:n,callToActionText:r,callToActionHandler:l}=t,c=(0,V.O7)(),d=(0,Ce.yK)((e=>({bannerContent:{alignItems:"center",display:"flex",flexWrap:"wrap",gap:6,justifyContent:"space-between",padding:"12px 6px",whiteSpace:"normal",width:"100%",lineHeight:1.35},callToAction:{cursor:"pointer",fontWeight:fo.Z.fontWeight.semibold}})),[]),p=o.overdueSubscription.overdueReason,u=(0,s.useCallback)((e=>{void 0!==l&&l(e),k.trackPaymentStatusBannerAction(c,{overdueReason:p,messageType:n})}),[c,l,n,p]);return a()("div",{style:d.bannerContent},void 0,a()("div",{},void 0,i),void 0!==l?a()("div",{style:d.callToAction,onClick:u},void 0,r):null)}function rs(){const e=(0,V.O7)(),t=function(){const e=(0,V.O7)(),t=["local","staging","development"].includes(x.Z.env);return(0,s.useEffect)((()=>{t&&(0,_e.exposeDebugValue)("advanceTestClock",(async t=>{const{spaceId:o}=re.default.state;o&&(await Oo.stripeAdvanceTestClock(e,{spaceId:o,epochSeconds:t}),re.default.setTestClockSeconds(t))}))}),[t,e]),(0,N.VK)((()=>{var t;if(!(0,qa.IC)())return;const o=null===(t=E.default.state.currentSpaceStore)||void 0===t?void 0:t.getOverdueSubscription();if(!o)return;const i=Ga.cS({now:re.default.state.testClockTime??Ya.ou.now(),overdueSubscription:o});return"paid"!==i.paymentStatus?{overdueSubscription:o,isWorkspaceOwner:(0,Vi.Fn)(e),paymentStatusWithReason:i}:void 0}),[e])}(),o=(0,s.useMemo)((()=>function(e){if(void 0===e)return;const{overdueReason:t}=e.overdueSubscription;if(t)switch(t){case"payment_failed":return os(e);case"confirmation_required":return is(e);default:(0,Xa.t1)(t)}}(t)),[t]);return s.useEffect((()=>(["local","development","staging"].includes(x.Z.env)&&(0,_e.exposeDebugValue)("paymentStatus",t),void 0===o||void 0===t?de.qL({bannerStore:he.Z,id:"SubscriptionPaymentStatusBanner"}):(de.Bw({bannerStore:he.Z,id:"SubscriptionPaymentStatusBanner",render:()=>a()(ns,{messages:o,paymentStatusViewData:t}),type:o.bannerType,prepend:!0}),k.trackPaymentStatusBannerDisplayed(e,{overdueReason:t.overdueSubscription.overdueReason,messageType:o.messageType})),()=>{de.qL({bannerStore:he.Z,id:"SubscriptionPaymentStatusBanner"})})),[e,o,t]),null}function as(){window.__c={n:"SubscriptionTrialAddPaymentMethodBannerContent"};const e=(0,Ce.yK)((e=>({bannerContent:{alignItems:"center",display:"flex",flexWrap:"wrap",gap:6,justifyContent:"space-between",padding:"12px 6px",whiteSpace:"normal",width:"100%",lineHeight:1.35},callToAction:{cursor:"pointer",fontWeight:fo.Z.fontWeight.semibold}})),[]);return a()("div",{style:e.bannerContent},void 0,a()("div",{},void 0,a()(w.FormattedMessage,{id:"app.banner.trial_subscription.add_payment_method",defaultMessage:"Add a payment method to continue using your free trial. You will not be charged until the end of your trial period.",description:"This text is displayed in a yellow banner right below the topbar to workspace owners of trial workspaces. The intent is to nudge them into adding a payment method to their account so that they can continue using Notion uninterrupted after the trial ends. This banner will only be displayed during the last remaining weeks of the trial."})),a()("div",{style:e.callToAction,onClick:()=>_.r({currentTab:"billing"})},void 0,a()(w.FormattedMessage,{id:"app.banner.trial_subscription.add_payment_method.call_to_action",defaultMessage:"Add payment method",description:"This is the text of the call to action link in the banner. Clicking this link opens the Settings page which allows adding their credit card information."})))}function ss(e){const{subscriptionDataStore:t}=e,{showBanner:o}=(0,N.VK)((()=>{const e=Ea.XX(t.state.data);return e&&e.trialEnd?["enterprise_trial","business_trial"].includes(e.plan)||e.last4?{showBanner:!1}:{showBanner:Ya.ou.now()>Ya.ou.fromSeconds(e.trialEnd).minus({days:15})}:{showBanner:!1}}),[t]);return s.useEffect((()=>(o?de.Bw({bannerStore:he.Z,id:"SubscriptionTrialAddPaymentMethodBanner",render:()=>a()(as,{}),type:ve.$.Yellow,prepend:!0}):de.qL({bannerStore:he.Z,id:"SubscriptionTrialAddPaymentMethodBanner"}),()=>{de.qL({bannerStore:he.Z,id:"SubscriptionTrialAddPaymentMethodBanner"})})),[o]),null}var ls=o(15157),cs=o(60113);const ds=(0,w.defineMessages)({"7e89f436-7aac-4f66-b0a6-6e65ec868d2a.a.title":{defaultMessage:"Import your workspace (A)",id:"templateChecklist.quickNote.a.title"},"7e89f436-7aac-4f66-b0a6-6e65ec868d2a.a.description":{defaultMessage:"See your docs and wiki in action (A)",id:"templateChecklist.quickNote.a.description"},"7e89f436-7aac-4f66-b0a6-6e65ec868d2a.b.title":{defaultMessage:"Import your workspace (B)",id:"templateChecklist.quickNote.b.title"},"7e89f436-7aac-4f66-b0a6-6e65ec868d2a.b.description":{defaultMessage:"See your docs and wiki in action (B)",id:"templateChecklist.quickNote.b.description"},"7e89f436-7aac-4f66-b0a6-6e65ec868d2a.c.title":{defaultMessage:"Import your workspace (C)",id:"templateChecklist.quickNote.c.title"},"7e89f436-7aac-4f66-b0a6-6e65ec868d2a.c.description":{defaultMessage:"See your docs and wiki in action (C)",id:"templateChecklist.quickNote.c.description"}});function ps(e){return`templateChecklist--${e}--visible`}class us extends To.Z{getInitialState(){return{open:!0}}}const ms=new us;class gs extends To.Z{getInitialState(){return{templateChecklistRecord:void 0,completed:!1,hide:!1}}}const hs=gs;class fs extends To.Z{getInitialState(){return{step:"list",templateChecklistRecord:void 0}}}const vs=fs;var ys=o(90468);const bs=e=>{let{percentComplete:t=.33}=e;return window.__c={n:"ProgressBar"},a()("div",{style:{height:4,width:288,borderRadius:10,backgroundColor:"#E7E6E5"}},void 0,a()("div",{style:{height:4,width:288*t+"px",borderRadius:10,position:"relative",backgroundColor:"#2383E2"}}))};class Ss extends l.Z{renderComponent(){return a()("div",{},void 0,g.Z.onboardingUseCaseBook({height:24,width:24}),a()("div",{style:this.getHeaderStyle()},void 0,this.getHeaderMessage()),s.createElement(bs,this.props))}getHeaderMessage(){switch(this.props.useCase){case"wiki":return a()(w.FormattedMessage,{id:"templateChecklistHeader.useCaseHeader.wiki",defaultMessage:"Getting started with wikis & docs"});case"doc_notes":case"notes":return a()(w.FormattedMessage,{id:"templateChecklistHeader.useCaseHeader.notes",defaultMessage:"Getting started with notes"});case"bookmarks":return a()(w.FormattedMessage,{id:"templateChecklistHeader.useCaseHeader.databases",defaultMessage:"Getting started with databases"});case"project_management":return a()(w.FormattedMessage,{id:"templateChecklistHeader.useCaseHeader.projectManagement",defaultMessage:"Getting started with projects & tasks"});default:return a()(w.FormattedMessage,{id:"templateChecklistHeader.useCaseHeader.default",defaultMessage:"Getting started with Notion"})}}getHeaderStyle(){return{paddingTop:12,paddingBottom:12,color:this.theme.regularTextColor,fontWeight:fo.Z.fontWeight.semibold,fontSize:17,lineHeight:1.4}}}Ss.displayName="TemplateChecklistHeader";const ws=Ss;var ks=o(12508);class Cs extends l.Z{constructor(){super(...arguments),this.showingMore=new ct.default(!1)}renderComponent(){const{title:e,description:t}=this.props;return a()("div",{style:{paddingTop:12,display:"flex",flexDirection:"row",width:"100%",...this.showingMore.get()?{borderBottom:"1px solid #ECEBEA",marginBottom:12,paddingBottom:12}:{}}},void 0,a()("div",{style:{paddingRight:10}},void 0,a()(ks.Z,{size:22,checked:this.props.checked,onClick:()=>this.props.onClick(),round:!0,fill:m.ZP.white})),a()("div",{style:{width:"100%",paddingRight:"14px"}},void 0,a()("div",{style:{fontSize:14,fontWeight:fo.Z.fontWeight.semibold,display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,e,a()("span",{onClick:()=>this.showingMore.set(!this.showingMore.get())},void 0,this.showingMore.get()?g.Z.chevronDown({height:11,width:11,display:"inline"}):g.Z.chevronRight({height:11,width:11,display:"inline"}))),this.showingMore.get()&&a()("div",{style:{fontSize:14,color:this.theme.mediumTextColor}},void 0,t)))}}Cs.displayName="TemplateChecklistStep";const _s=Cs;class Ms extends l.Z{constructor(){super(...arguments),this.completed=new ct.default(!1),this.renderStepContent=e=>a()("div",{},void 0,a()("div",{style:{paddingBottom:8,width:"100%"}},void 0,a()(ws,{percentComplete:e.getStepsCompleted().length/e.getSteps().length,useCase:ys.rz})),e.getSteps().map((t=>{if(null==e||!e.isDefined())return;const{title:o,description:i}=function(e,t){const o=ds[`${e}.${t}.title`],i=ds[`${e}.${t}.description`];if(!o||!i)throw new Error(`No title or description for ${e} at step ${t}`);return{title:o,description:i}}(e.getCopiedFrom(),t);return a()(_s,{title:s.createElement(w.FormattedMessage,o),description:s.createElement(w.FormattedMessage,i),checked:e.getStepsCompleted().includes(t),onClick:()=>{!function(e){const{environment:t,record:o,step:i}=e;if(!o.isDefined())return;const n=o.getStepsCompleted(),r={steps_completed:n.includes(i)?gt().filter(n,(e=>e!==i)):gt().uniq([...n,i])};Pe.createAndCommit({userAction:"templateChecklistActions.toggleStep",environment:t,perform:e=>{Te.sW({store:o,data:r,transaction:e})}})}({environment:this.environment,record:e,step:t})}},t)}))),this.renderCompleted=()=>a()("div",{style:this.getCompletedContainerStyle()},void 0,a()("img",{style:{width:165,height:80},src:Et.Z.images.feedbackThankYouPng}),a()("div",{style:this.getCompletedTitleStyle()},void 0,a()(w.FormattedMessage,{defaultMessage:"You're done!",id:"templateChecklist.completed.header"})),a()("div",{style:this.getCompletedDescriptionStyle()},void 0,a()(w.FormattedMessage,{defaultMessage:"For more inspirations, go to Notion Guides to sharpen your skills and explore new ways to use Notion.",id:"templateChecklist.completed.description"}))),this.handleCancel=()=>{this.props.onCancel()},this.flexCenteredStyle={display:"flex",alignItems:"center",flexDirection:"column"}}renderComponent(){return a()(fi.Z,{isVisible:ms.state.open,enterAnimationStyle:{opacity:1,scale:1},exitAnimationStyle:{opacity:0,scale:.95},render:()=>a()("div",{style:this.getContainerStyle()},void 0,this.renderCancel(),this.renderStep())})}renderCancel(){return a()(ot.Z,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,g.Z.closeSmall({width:14,fill:this.theme.mediumTextColor}))}renderStep(){const e=this.getTemplateChecklistRecord();if(null==e||!e.isDefined())return;const t=e.getStepsCompleted().length!==e.getSteps().length;return s.createElement(s.Fragment,null,a()(fi.Z,{isVisible:t,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},onAnimationEnd:()=>{this.completed.set(!0),gt().delay((()=>{ms.setState({open:!1}),this.props.onComplete()}),2e3)},render:()=>this.renderStepContent(e)}),a()(fi.Z,{isVisible:!t&&this.completed.get(),enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:this.renderCompleted}))}getTemplateChecklistRecord(){return this.props.templateChecklistStore.state.templateChecklistRecord}getContainerStyle(){return{...this.flexCenteredStyle,cursor:"default",padding:16,textAlign:"left",justifyContent:"start",background:this.theme.popoverBackground,borderRadius:3,boxShadow:this.theme.lightBoxShadow,position:"absolute",bottom:65+li.Z.state,right:16+li.Z.state,width:325,height:400,zIndex:D.hT,clipPath:"inset(-10px -10px -10px -10px)"}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center"}}getCompletedContainerStyle(){return{display:"flex",flexDirection:"column",alignItems:"center",height:"100%",textAlign:"center"}}getCompletedTitleStyle(){return{color:this.theme.regularTextColor,fontWeight:fo.Z.fontWeight.semibold,fontSize:14}}getCompletedDescriptionStyle(){return{color:this.theme.mediumTextColor,fontSize:12}}}Ms.displayName="TemplateChecklist";const Ts=Ms;var Is=o(79482);class Ps extends l.Z{constructor(){super(...arguments),this.storeTypes={templateChecklistButtonStore:hs},this.handleCancel=()=>{const{templateChecklistRecord:e}=this.stores.templateChecklistButtonStore.state;e&&(!function(e){const{environment:t,record:o}=e,i={opt_out:!0};Pe.createAndCommit({userAction:"templateChecklistActions.optOut",environment:t,perform:e=>{Te.sW({store:o,data:i,transaction:e})}})}({environment:this.environment,record:e}),ms.setState({...ms.state,open:!1}))}}renderComponent(){const{mainEditorCurrentBlockStore:e,currentSpaceStore:t}=E.default.state;if(null!=e&&e.isDefined()&&null!=t&&t.isDefined())return a()(Ko.Z,{throttle:1e3,request:{spaceId:t.id,blockId:e.id},performRequest:async e=>{let{blockId:t,spaceId:o}=e;const i=await Oo.getTemplateChecklistForBlock(this.environment,{blockId:t,spaceId:o});if("success"===i.type){const{templateChecklistId:e}=i.data;if(!e)return;const t=new A.XJ(this.environment,{table:cs.$,id:e});if(this.stores.templateChecklistButtonStore.setState({...this.stores.templateChecklistButtonStore.state,templateChecklistRecord:t}),t.isDefined()){const e=ls.Z.get({userId:this.environment.currentUser.id,key:ps(t.id)});this.stores.templateChecklistButtonStore.setState({...this.stores.templateChecklistButtonStore.state,hide:"boolean"==typeof e&&!e})}}},render:(e,t,o)=>{if(!o)return;const{templateChecklistRecord:i,completed:n}=this.stores.templateChecklistButtonStore.state;if(null==i||!i.isDefined()||i.getStepsCompleted().length===i.getSteps().length||n)return;const r=new vs;return r.setState({...r.state,templateChecklistRecord:i}),this.stores.templateChecklistButtonStore.setState({...this.stores.templateChecklistButtonStore.state,templateChecklistRecord:i}),i.getOptOut()?void 0:a()("div",{},void 0,a()(ot.Z,{style:this.getRoundButtonStyle(),hoveredStyle:{background:this.theme.whiteButtonHoveredBackground},pressedStyle:{background:this.theme.whiteButtonPressedBackground},onClick:()=>{const e=this.stores.templateChecklistButtonStore.state.hide;this.stores.templateChecklistButtonStore.setState({...this.stores.templateChecklistButtonStore.state,hide:!e}),this.setVisibilityLocalStorage(e,i.id)}},void 0,g.Z.onboardingUseCaseBook({height:18}),this.stores.templateChecklistButtonStore.state.hide&&a()(ot.Z,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,g.Z.closeSmall({width:14,fill:this.theme.mediumTextColor}))),!this.stores.templateChecklistButtonStore.state.hide&&a()(Ts,{templateChecklistStore:r,onComplete:()=>this.stores.templateChecklistButtonStore.setState({...this.stores.templateChecklistButtonStore.state,completed:!0}),onCancel:()=>{this.setVisibilityLocalStorage(!1,i.id),this.stores.templateChecklistButtonStore.setState({...this.stores.templateChecklistButtonStore.state,hide:!0})}}))}})}setVisibilityLocalStorage(e,t){ls.Z.set({userId:this.environment.currentUser.id,key:ps(t),value:e})}getRoundButtonStyle(){return{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",background:this.theme.buttonBackground,bottom:16+li.Z.state,right:60+li.Z.state,width:36,height:36,borderRadius:"100%",boxShadow:this.theme.lightBoxShadow,zIndex:D.hT,opacity:K.tu.state?0:1,transition:`\n\t\t\t\topacity ${Is.Z.transitionDuration}ms,\n\t\t\t\tcolor ${Is.Z.transitionDuration}ms\n\t\t\t`}}getCancelStyle(){return{position:"absolute",top:-2,right:-1,background:this.theme.buttonHoveredBackground,borderRadius:"100%"}}}Ps.displayName="TemplateChecklistButton";const xs=Ps;var Bs=o(90965);function Zs(e){let{}=e;const t=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),o=(0,N.VK)((()=>{var e;if(!t)return;const o=null===(e=t.getSettings())||void 0===e?void 0:e.space_request;return(0,Bs.DI)(o)?o:void 0}),[t]);return o?a()(Z.LazyTransferWorkspaceModal,{workspaceTransfer:o}):null}var Es=o(74725),Rs=o(80863),As=o(33784),Ds=o(38302),Fs=o(94568),Ls=o(73100),Vs=o(31299),Ns=o(14871),Os=o(56948);function Us(e){window.__c={n:"AssistantFeedbackBar"};const{store:t,type:o,onReply:i}=e,n=(0,V.O7)(),r=(0,Ce.yK)((e=>({wrap:{display:"flex",marginTop:6,marginBottom:6,gap:6},feedbackButton:{width:32}})),[]),l=(0,s.useCallback)((async()=>{await Ls.vR({environment:n,store:t}),Ls.qE({environment:n,store:t})}),[n,t]),c=(0,s.useCallback)((async()=>{await Ls.f6({environment:n,store:t})}),[n,t]),d=(0,s.useCallback)((async()=>{await Ls.eO({environment:n,store:t,type:"assistant_thumbs_up"}),ga.oV({label:"Thanks for your feedback!"})}),[n,t]),p=(0,s.useCallback)((async()=>{await Ls.eO({environment:n,store:t,type:"assistant_thumbs_down"}),ga.oV({label:"Thanks for your feedback!"})}),[n,t]);return a()("div",{style:r.wrap},void 0,"feedback"===o&&s.createElement(s.Fragment,null,a()(Ao.Z,{icon:g.Z.thumbUp,style:r.feedbackButton,onClick:d}),a()(Ao.Z,{icon:g.Z.thumbDown,style:r.feedbackButton,onClick:p})),"accept_action"===o&&s.createElement(s.Fragment,null,a()(Ao.Z,{onClick:l},void 0,"Accept edits"),a()(Ao.Z,{onClick:i},void 0,"Reply")),"error"===o&&s.createElement(s.Fragment,null,a()(Ao.Z,{onClick:l},void 0,"Continue")),a()(Ao.Z,{icon:g.Z.refresh,onClick:c},void 0,"Retry"))}function Hs(e){let{store:t}=e;window.__c={n:"UpdateSidebarTabAssistant"};const[o,i]=(0,s.useState)(""),n=(0,s.useRef)(void 0),r=(0,s.useRef)(void 0),l=(0,N.VK)((()=>t.state),[t]),c=(0,V.O7)(),d=(0,N.VK)((()=>E.default.state.mainEditorCurrentBlockStore),[]),p=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),u=(0,N.VK)((()=>(0,ee._c)(c)),[c]);(0,s.useEffect)((()=>{n.current&&n.current.scrollToBottom()}),[null==l?void 0:l.clientSteps]);const m=(0,s.useCallback)((async()=>{await Ls.CU({environment:c,store:t})}),[c,t]),h=(0,s.useCallback)((e=>{i(e.target.value)}),[i]),f=(0,s.useCallback)((async()=>{t.state||await Ls.CU({environment:c,store:t}),o&&t.state&&(Ls.G6({environment:c,store:t,message:o}),i(""))}),[c,o,i,t]),[v,y]=(0,s.useState)(!1),b=(0,s.useCallback)((()=>{gi.default.hasSelection()&&jn.ZH(c),y(!0)}),[c,y]),S=(0,s.useCallback)((()=>{y(!1)}),[y]),w=(0,Ce.yK)((e=>({wrap:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:u?2:0,pointerEvents:"auto",marginTop:1,height:0},header:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${e.regularDividerColor}`,alignItems:"center",pointerEvents:"auto",padding:12},headerLabel:{fontSize:14,color:e.aiPurpleColor,fontWeight:fo.Z.fontWeight.medium,display:"flex",alignItems:"center"},headerSparkles:{width:16,height:16,marginRight:4,color:e.aiPurpleColor},reset:{color:e.mediumTextColor},input:{width:void 0,marginLeft:8,marginRight:8},scroller:{flexGrow:1,paddingTop:8,paddingBottom:8,paddingLeft:8,paddingRight:8,backgroundColor:e.contentBackground},samplesLabel:{fontSize:12,marginTop:8,marginBottom:8},previewLabel:{fontSize:12},editLink:{fontSize:14,color:e.mediumTextColor,textDecoration:"underline",paddingLeft:8,paddingRight:8},error:{fontSize:14,color:e.errorText}})),[u]),k=(0,N.VK)((()=>(0,G.VB)()),[]),C=(0,N.VK)((()=>{var e;return null===(e=t.state)||void 0===e?void 0:e.instructionsId}),[t]),_=(0,N.VK)((()=>{const{mainEditorCurrentBlockStore:e}=E.default.state;if(C&&e){const t=A.G.createChildStore(e,{table:oo.iU,id:C});return(0,zt.ZP)({store:t})}}),[C]),M=(0,N.VK)((()=>{const{mainEditorCurrentBlockStore:e}=E.default.state;if(e){const t=A.G.createChildStore(e,{table:oo.iU,id:Fs.nv[x.Z.env]});return(0,zt.ZP)({store:t})}}),[]),T=(0,s.useCallback)((()=>{var e;null===(e=r.current)||void 0===e||e.focusInput()}),[]),I=(0,N.VK)((()=>{var e;const o=null===(e=t.state)||void 0===e?void 0:e.previewingStepObservations.filter((e=>"observation"===e.type&&"error"===e.observationType));return null==o?void 0:o.map((e=>e.value)).join("\n")}),[t]),P=(0,N.VK)((()=>(0,G.Gw)()),[]);return p&&d?a()("div",{style:w.wrap},void 0,a()(lo.Z,{},void 0,a()("div",{style:w.header},void 0,k?a()(zs,{store:t}):s.createElement(s.Fragment,null,g.Z.sparkles(w.headerSparkles),a()("div",{style:w.headerLabel},void 0,"Ask AI")),a()("div",{style:{flexGrow:1}}),_&&a()(Ro.Z,{style:w.editLink,href:_,external:!0},void 0,"Edit Bot"),k&&M&&a()(Ro.Z,{style:w.editLink,href:M,external:!0},void 0,"Manage Bots"),a()(Le.Z,{style:w.reset,onClick:m},void 0,"Reset"))),s.createElement(Si.Z,{ref:n,type:si.Z.Y,style:w.scroller},null==l?void 0:l.clientSteps.map(((e,o)=>a()(Os.H,{store:t,clientStep:e},o))),l&&(l.sampling||l.evaluating)&&0===l.temporaryClientSteps.length&&a()(yi.Z,{}),(null==l?void 0:l.temporaryClientSteps)&&l.temporaryClientSteps.map(((e,o)=>a()(Os.H,{store:t,clientStep:e},o))),l&&I&&!l.sampling&&!l.evaluating&&a()("div",{style:w.error},void 0,I),!P&&l&&(l.temporaryClientSteps.length>0||I)&&!l.sampling&&!l.evaluating&&a()(Us,{store:t,type:I?"error":Boolean(l.temporaryClientSteps.find((e=>"assistantTransaction"===e.type)))?"accept_action":"feedback",onReply:T})),a()(lo.Z,{},void 0,a()(zo.Z,{capture:v},void 0,s.createElement(Wo.Z,{style:w.input,value:o,textarea:!0,textareaSubmitOnEnter:!0,autosize:!0,placeholder:"Ask a question or ask to update this page…",onChange:h,onSubmit:f,focusInitial:!0,onFocus:b,onBlur:S,ref:r})))):null}function zs(e){window.__c={n:"InstructionPicker"};const{store:t}=e,o=(0,V.O7)(),i=(0,Ce.yK)((e=>({pickerButton:{},chevronDown:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),[r]=(0,la.r5)((async()=>{var e;const t=null===(e=E.default.state.currentSpaceStore)||void 0===e?void 0:e.id;if(!t)throw new Error("No space ID.");return(await Vs.qh({environment:o,query:"",parentId:Fs.mh[x.Z.env],limit:100,spaceId:t,excludeTemplates:!0,source:"filtered_collection_menu",includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!0})).results}),[o]),l=(0,N.VK)((()=>{var e;return null===(e=t.state)||void 0===e?void 0:e.instructionsId}),[t]),c=(0,s.useCallback)((async e=>{await Ls.CU({environment:o,store:t,instructionsId:e})}),[o,t]),d={menuTitle:"Instruction",items:[void 0,...r.value||[]],getKey:e=>e||"none",selectedItem:l,onSelect:c,renderItem:e=>s.createElement(Ji.Z,n()({title:a()(Ws,{blockId:e.value})},e)),renderOrigin:e=>s.createElement(Ao.Z,n()({},e,{style:i.pickerButton}),a()(Ws,{blockId:l}),g.Z.chevronDown(i.chevronDown)),width:220};return s.createElement(Ns.Z,d)}function Ws(e){window.__c={n:"InstructionPickerTitle"};const{blockId:t}=e,o=(0,N.VK)((()=>E.default.state.mainEditorCurrentBlockStore),[]),i=(0,s.useMemo)((()=>{if(t&&o)return A.G.createChildStore(o,{table:oo.iU,id:t})}),[t,o]);return i?a()(Ni.Z,{store:i}):a()("span",{},void 0,"Notion AI")}var js=o(70268),Ks=o(13018),Ys=o(17652),Gs=o(24809),Xs=o(16444),qs=o(89837),$s=o(62965),Js=o(16287),Qs=o(25320),el=o(20095),tl=o(65598),ol=o(33665),il=o(35314),nl=o(44904),rl=o(67579),al=o(64536);const sl=Date.now();function ll(e){let{store:t,spaceId:o,isDisabledForWorkspace:i}=e;window.__c={n:"PageAnalytics"};const[n,r]=(0,s.useState)("last_28_days"),[l,c]=(0,s.useState)({state:i?"disabled-for-workspace":"loading"}),d=(0,V.O7)(),p=(0,Ce.Fg)(),u=(0,N.VK)((()=>{const{currentSpaceStore:e}=E.default.state;return null==e?void 0:e.getName()}),[]),m=(0,N.VK)((()=>{switch(n){case"last_7_days":return 7;case"last_28_days":return 28;case"last_90_days":return 90;case"all_time":return}}),[n]);(0,s.useEffect)((()=>{i||async function(){const e=await Oo.getPageAnalytics(d,{pageId:t.id,spaceId:o,days:m});if("failed"===e.type)return void c({state:"empty"});const i=e.data.map((e=>{let{ds:t,total_views:o,unique_views:i}=e;return{ds:t,values:{total_views:o,unique_views:i}}}));i.filter((e=>{let{ds:t}=e;return qs.OQ.isoToUnixMs(t,"UTC")??sl<=sl})).every((e=>{let{values:t}=e;return 0===t.total_views}))?c({state:"empty"}):c({state:"loaded",data:i})}()}),[d,t.id,i,o,m]);const h=(0,Ce.yK)((e=>({fullHeight:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},spinner:{width:32,height:32}})),[]);return"loading"===l.state?a()("div",{style:h.fullHeight},void 0,a()(yi.Z,{style:h.spinner})):"empty"===l.state?a()("div",{style:h.fullHeight},void 0,a()(vl,{heading:a()(w.FormattedMessage,{id:"page_analytics.empty.heading",defaultMessage:"No page analytics yet",description:"Heading for the empty state of the page analytics sidebar"}),description:a()(w.FormattedMessage,{id:"page_analytics.empty.description",defaultMessage:"It may take some time for page view information to appear.",description:"Description for the empty state of the page analytics sidebar"})})):"disabled-for-workspace"===l.state?a()("div",{style:h.fullHeight},void 0,a()(vl,{heading:a()(w.FormattedMessage,{id:"page_analytics.disabled.heading",defaultMessage:"Page viewership tracking is disabled",description:"Heading for the disabled state of the page analytics sidebar"}),description:a()("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16}},void 0,a()(w.FormattedMessage,u?{id:"page_analytics.disabled.description",defaultMessage:"Page viewership and analytics is turned off for all pages in {name}",description:"Description for the disabled state of the page analytics sidebar",values:{name:u}}:{id:"page_analytics.disabled.description.unnamed",defaultMessage:"Page viewership and analytics is turned off for all pages in your space",description:"Description for the disabled state of the page analytics sidebar when the space has no name"}),a()("a",{href:(0,ol.UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:p.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"}},void 0,g.Z.help({width:14,height:14}),a()(Ve.Z,{isSmall:!0},void 0,a()(w.FormattedMessage,{id:"page_analytics.disabled.learnMore",defaultMessage:"Learn more",description:"Link to learn more about page analytics"}))))})):a()("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"}},void 0,a()(Ae.sg,{grow:1,gap:16},void 0,a()(dl,{store:t,data:l.data,currentFilter:n,onChangeFilter:r}),a()(ul,{store:t}),a()(fl,{spaceId:o,store:t})),a()("div",{style:{borderTop:`1px solid ${p.regularDividerColor}`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,a()(Qi.Z,{renderOrigin:e=>{let{onClick:t}=e;return a()(Ao.Z,{onClick:t,icon:g.Z.settings},void 0,a()(w.FormattedMessage,{id:"page_analytics.timeseries.settings",defaultMessage:"Settings",description:"The settings button for page analytics"}))},popupType:d.device.isMobile?Qi.Z.PopupType.SlideUp:Qi.Z.PopupType.Popup,render:()=>a()(ao.Z,{menuType:no.og.Popup,width:460},void 0,a()("div",{style:cl},void 0,a()(al.PageAnalyticsPageOptOut,{store:t})))}),a()("a",{href:(0,ol.UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:p.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"}},void 0,g.Z.help({width:14,height:14}),a()(Ve.Z,{isSmall:!0},void 0,a()(w.FormattedMessage,{id:"page_analytics.timeseries.learnMore",defaultMessage:"Learn more",description:"The text for the learn more button on page analytics"})))))}const cl={margin:"8px 16px",pointerEvents:"auto",cursor:"default"};function dl(e){window.__c={n:"PageAnalyticsGraph"};const[t,o]=(0,il.e)(),{blueLayer:i,yellowLayer:n}=(0,Xs.useTimeSeriesPalette)(),r=(0,s.useMemo)((()=>{if(0===e.data.length)return sl;const t=qs.OQ.isoToUnixMs(e.data[0].ds,"UTC")??sl;return Math.min(t,sl)}),[e.data]);return a()("div",{},void 0,a()(pl,{store:e.store,data:e.data,currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter}),s.createElement("div",{ref:t,style:{...cl,marginBottom:0}},a()(Z.LazyTimeSeries,{startDate:(0,le.$6)(r,!0),endDate:(0,le.$6)(sl,!0),width:o,height:175,data:e.data,layers:[{key:"total_views",...i,renderLabel:e=>a()(w.FormattedMessage,{id:"page_analytics.timeseries.total_views",defaultMessage:"{views, plural, one {1 total view} other {{views} total views}}",description:"A label for the number of total views on a page while hovering over the page analytics graph",values:{views:e}})},{key:"unique_views",...n,renderLabel:e=>a()(w.FormattedMessage,{id:"page_analytics.timeseries.unique_views",defaultMessage:"{uniqueViews, plural, one {1 unique view} other {{uniqueViews} unique views}}",description:"A label for the number of unique views on a page while hovering over the page analytics graph",values:{uniqueViews:e}})}]})))}function pl(e){window.__c={n:"PageAnalyticsHeader"};const t=(0,w.useIntl)(),o=(0,s.useMemo)((()=>e.data.reduce(((e,t)=>{let{values:o}=t;return e+o.total_views}),0)),[e.data]);return a()("div",{style:{margin:"14px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,a()(Ae.X2,{justifyContent:"space-between",alignItems:"center",grow:1},void 0,a()(Ae.X2,{gap:4},void 0,a()(Ve.Z,{style:{fontWeight:500}},void 0,a()(w.FormattedMessage,{id:"page_analytics.timeseries.title",defaultMessage:"Views",description:"The title of the page analytics graph"})),a()(Ve.Z,{isSecondaryColor:!0},void 0,a()(w.FormattedMessage,{id:"page_analytics.timeseries.totalViews",defaultMessage:"({totalViews} total)",description:"A label for the number of total views on the page analytics graph",values:{totalViews:(0,Ma.uf)(o,"number_with_commas",t)}}))),a()(rl.f,{currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter})))}function ul(e){window.__c={n:"PageAnalyticsViewers"};const{store:t}=e,{pageVisitStore:o,presenceStore:i}=(0,N.Kw)(E.default),n=(0,V.O7)();(0,s.useEffect)((()=>{Qs.R(n,{block:t,pageVisitStore:o,incremental:!0,limit:100})}),[n,t,o]);const r=(0,N.VK)((()=>(0,el.AQ)(o,i)),[o,i]);return 0===r.length?null:a()("div",{style:{...cl,display:"flex",flexDirection:"column",gap:12}},void 0,a()(Ve.Z,{style:{fontWeight:500}},void 0,a()(w.FormattedMessage,{id:"page_analytics.viewers.title",defaultMessage:"Viewers",description:"The title of the viewers section of the page analytics sidebar"})),a()("div",{style:{display:"flex",flexDirection:"column",gap:10}},void 0,a()(ml,{store:t,users:r.map((e=>{let{userId:t,activityTimestampNearestMinuteMs:o}=e;return{userId:t,timestamp:o}})),collapsedLabel:a()(w.FormattedMessage,{id:"page_analytics.viewers.expand",defaultMessage:"Show more viewers",description:"Callout in the page analytics sidebar to show more viewers"}),expandedLabel:a()(w.FormattedMessage,{id:"page_analytics.viewers.collapse",defaultMessage:"Show less viewers",description:"Callout in the page analytics sidebar to show less viewers"})})))}function ml(e){window.__c={n:"PageAnalyticsUserList"};const{store:t,users:o,collapsedLabel:i,expandedLabel:n}=e,[r,l]=(0,s.useState)(!0),c=r?o.slice(0,5):o;return a()("div",{style:{display:"flex",flexDirection:"column",gap:10}},void 0,c.map((e=>{let{userId:o,timestamp:i}=e;return a()(gl,{store:t,userId:o,timestamp:i},o)})),o.length>5&&a()("button",{onClick:e=>{e.preventDefault(),l(!r)},style:{background:"none",border:"none",textAlign:"left",padding:0,marginTop:4}},"toggle",a()(Ve.Z,{isSecondaryColor:!0,isSmall:!0,style:{display:"flex",gap:3,alignItems:"center"}},void 0,r?i:n,r?g.Z.chevronDownRounded({width:12}):g.Z.chevronUpRounded({width:12}))))}function gl(e){window.__c={n:"PageAnalyticsUser"};const{store:t,userId:o,timestamp:i}=e,n=(0,w.useIntl)(),r=A.U6.createChildStore(t,{table:ho.KJ,id:o}),l=(0,N.VK)((()=>(0,vo.Nz)(n,r.getModel())),[n,r]),d=(0,s.useMemo)((()=>{const e=Date.now();return(0,le.tv)(Math.min(i??e,e),c.SP)}),[i]);return a()(Ae.X2,{alignItems:"center",justifyContent:"space-between"},void 0,a()(Ae.X2,{gap:4},void 0,a()(Oi.Z,{size:18,userStore:r}),a()(Ve.Z,{style:{fontWeight:500}},void 0,l)),a()(Ve.Z,{isSecondaryColor:!0},void 0,i?a()("span",{title:(0,le.Yx)(i,"medium_with_time",c.SP)},void 0,d):d))}function hl(e){const{environment:t,store:o,spaceId:i,hasAccessToEditors:n}=e,[,,r]=(0,N.AF)(void 0,nl.o),[a,l]=(0,s.useState)([]);(0,s.useEffect)((()=>{n&&Js.h(t,{store:r,activityIds:a,spaceId:i,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0},navigableBlockId:o.id})}),[a,r,i,o.id,t,n]);return(0,N.VK)((()=>{if(!n)return[];const e=r.state.activityIds;(0,$s.Z)(a,e)||l(e);const{currentSpaceStore:t}=E.default.state;if(!t)return[];const o=a.map((e=>(0,tl.No)(t,e,t.id))).flatMap((e=>{const t=e.getValue();return t?"top-level-block-created"!==t.type&&"top-level-block-deleted"!==t.type&&"block-edited"!==t.type?[]:function(e){var t;return gt().compact(null===(t=e.edits)||void 0===t?void 0:t.flatMap((e=>{var t;return null===(t=e.authors)||void 0===t?void 0:t.map((t=>({userId:t.id,timestamp:e.timestamp})))})))}(t):[]})),i=gt().sortBy(o,"timestamp").reverse();return gt().uniqBy(i,"userId")}),[a,r,n])}function fl(e){window.__c={n:"PageAnalyticsEditors"};const{spaceId:t,store:o}=e,i=(0,V.O7)(),n=(0,N.VK)((()=>!!R.default.checkGate("page_analytics_editors")&&((0,Ea.qb)(i,"business")||(0,Ea.qb)(i,"enterprise"))),[i]),r=hl({environment:i,hasAccessToEditors:n,spaceId:t,store:o}),s=(0,N.VK)((()=>{const e=o.getCreatedById(),t=o.getCreatedTime();if(e&&t)return{creatorId:e,createdTime:t}}),[o]);return a()("div",{style:{...cl,display:"flex",flexDirection:"column",gap:12}},void 0,a()(Ve.Z,{style:{fontWeight:500}},void 0,a()(w.FormattedMessage,{id:"page_analytics.editors.title",defaultMessage:"Editors",description:"The title of the editors section of the page analytics sidebar"})),s&&a()("div",{style:{display:"flex",flexDirection:"column",gap:10,marginBottom:6}},void 0,a()(Ve.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500}},void 0,a()(w.FormattedMessage,{id:"page_analytics.editors.createdBy",defaultMessage:"Created by",description:"The title of created by section of the page analytics sidebar"})),a()(gl,{store:o,userId:s.creatorId,timestamp:s.createdTime})),n&&r.length>0&&a()("div",{style:{display:"flex",flexDirection:"column",gap:10}},void 0,a()(Ve.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500}},void 0,a()(w.FormattedMessage,{id:"page_analytics.editors.editedBy",defaultMessage:"Recently edited by",description:"The title of the edited by section of the page analytics sidebar"})),a()(ml,{users:r,store:o,collapsedLabel:a()(w.FormattedMessage,{id:"page_analytics.editors.expand",defaultMessage:"Show more editors",description:"Callout in the page analytics sidebar to show more editors"}),expandedLabel:a()(w.FormattedMessage,{id:"page_analytics.editors.collapse",defaultMessage:"Show less editors",description:"Callout in the page analytics sidebar to show less editors"})})))}function vl(e){window.__c={n:"PageAnalyticsEmptyState"};const t=(0,Ce.yK)((e=>({column:{display:"flex",flexDirection:"column"},row:{display:"flex"},centered:{textAlign:"center",alignItems:"center",width:250},analyticsIcon:{position:"relative",top:-8,left:-4},secondaryIcon:{fill:e.mediumTextColor},settingsButton:{padding:"7.5px 10px",alignSelf:"center"},link:{cursor:"pointer",justifyContent:"center",alignItems:"center",padding:8,alignSelf:"center"}})),[]);return a()("div",{style:{...t.column,gap:24}},void 0,a()("div",{style:{...t.column,...t.centered,gap:4}},void 0,g.Z.analyticsSearch({...t.secondaryIcon,...t.analyticsIcon,width:62,height:62}),a()(Ve.Z,{isSecondaryColor:!0,style:{fontSize:16,fontWeight:500}},void 0,e.heading),a()(Ve.Z,{isSecondaryColor:!0,style:{whiteSpace:"normal",overflow:"visible"}},void 0,e.description)))}function yl(e){let{enablePageAnalytics:t}=e;const o=(0,N.VK)((()=>E.default.state.mainEditorCurrentBlockStore),[]),i=(0,N.VK)((()=>{const e=Ya.ou.now().minus({years:1}).valueOf();return!!o&&o.getCreatedTime()<e}),[o]),n=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),r=(0,N.VK)((()=>!(null!=o&&o.canRead())),[o]),l=(0,V.O7)(),c=(0,N.VK)((()=>(0,ee._c)(l)),[l]),d=(0,N.VK)((()=>{var e;const t=null==o?void 0:o.getModel();return o&&null!=t&&t.isCollectionView()?null===(e=o.getCollectionPointer())||void 0===e?void 0:e.id:void 0}),[o]),p=(0,N.VK)((()=>Boolean(null==n?void 0:n.getSettings().disable_page_analytics)),[n]),u=(0,Ce.yK)((e=>({updatesEmptyStyle:{flex:1,display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,background:e.contentBackground,marginRight:c?2:0,pointerEvents:"auto",height:"100%"},updatesNotEmptyStyle:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:c?2:0,pointerEvents:"auto",marginTop:1,height:"100%"}})),[c]),m=(0,N.VK)((()=>yn.ZP.state.currentSubTab),[]),g=(0,N.VK)((()=>(0,Ys.eK)()),[]);if(r)return a()(Si.Z,{type:si.Z.Y,style:u.updatesEmptyStyle},void 0,a()("div",{style:{width:200,alignSelf:"center"}},void 0,a()(w.FormattedMessage,{id:"updateSidebar.commentContainer.restricted",defaultMessage:"You don't have permission to view the updates of this restricted page."})));if(n&&o)return s.createElement(Si.Z,{type:si.Z.Y,ref:e=>{ai.Z.UpdateSidebarScroller=e},style:u.updatesNotEmptyStyle},t&&a()("div",{style:{display:m===yn.uF.Analytics?"block":"none",height:"100%"}},void 0,a()(ll,{spaceId:n.id,store:o,isDisabledForWorkspace:p})),a()("div",{style:{display:m===yn.uF.Updates?"block":"none"}},void 0,a()(Gs.Z,{collectionId:d,navigableBlock:o,prominentGetNotifiedDropdownExperimentEnabled:g,spaceId:n.id,isTopbarUpdatesMenu:!0,source:"updates_sidebar",empty:e=>s.createElement(Si.Z,{type:si.Z.Y,style:u.updatesEmptyStyle,ref:e=>{ai.Z.UpdateSidebarScroller=e}},a()("div",{style:{width:200,alignSelf:"center"}},void 0,e.hasFiltersOn?a()(w.FormattedMessage,{id:"updateSidebar.updatesContainer.emptyAfterSearch",defaultMessage:"No updates match the requested filters."}):a()(w.FormattedMessage,i?{id:"updateSidebar.updatesContainer.emptyMaybePurged",description:"This message is shown in the Updates tab when there are no updates on a page that was created more than a year ago. It is possible that the updates were purged.",defaultMessage:"There are no recent updates on this page. Page updates are retained for one year."}:{id:"updateSidebar.updatesContainer.empty",defaultMessage:"No updates on this page yet."})))},o.id)));throw new Error("Loaded sidebar without AppStore initialized.")}var bl=o(59168);function Sl(e){const{currentTab:t}=e,o=(0,N.VK)((()=>E.default.state.mainEditorCurrentBlockStore),[]),i=(0,N.VK)((()=>E.default.state.currentSpaceStore),[]),n=(0,N.VK)((()=>E.default.state.renderPhase),[]),[r,l]=(0,s.useState)(!1),c=(0,s.useMemo)((()=>(new Date).getTime()),[]);if((0,s.useEffect)((()=>{r||"rendered"!==n||l(!0)}),[null==o?void 0:o.id,r,n]),!o||!i||!r)return a()(js.B,{areaHeight:window.innerHeight});switch(t){case yn.gY.Comments:return a()(Ks.J,{timeMounted:c,location:"sidebar"});case yn.gY.Updates:return a()(yl,{enablePageAnalytics:e.enablePageAnalytics});case yn.gY.Assistant:return a()(Hs,{store:Rs.oX});default:(0,Xa.t1)(t)}}function wl(e){window.__c={n:"UpdateSidebar"};const[t,o]=(0,N.AF)(yn.ZP),i=(0,V.O7)(),{shouldLoadSidebarComponents:n,isExpanded:r,popOutMode:l,closeSidebar:c}=e,d=(0,N.VK)((()=>r&&l&&!Ds.Z.state.isOpen&&!As.Z.state.open),[r,l]),p=(0,s.useRef)(null),u=(0,s.useMemo)((()=>[`.${ni.zar}`,`.${ni.hzx}`,`.${ni.G6g}`,`.${ni.K3y}`,`.${ni.p0b}`,`.${ni.mJW}`]),[]);(0,Es.O)({active:d,closeHandler:c,ref:p,excludedSelectors:u});const m=_i.R6(i.device.isElectronMac),g=(0,Ce.yK)((e=>({container:{flexGrow:0,flexShrink:0,zIndex:D.XB,borderLeft:(l?"unset":!r&&"1px solid rgba(0,0,0,0)")||`1px solid ${e.regularDividerColor}`,alignSelf:"flex-end",position:"absolute",right:0,top:0,height:"100vh",pointerEvents:"none"},popOutContainer:{boxShadow:e.mediumBoxShadow,background:e.popoverBackground,borderRadius:3,border:r?`1px solid ${e.regularDividerColor}`:void 0,height:`calc(100% - 20px - ${m}px)`,marginTop:m+10,marginRight:r?10:0},wrap:{height:"100%"},content:{position:"absolute",top:0,bottom:0,display:r?"flex":"none",flexDirection:"column",overflow:"visible",zIndex:D.XB,width:t.width}})),[t.width,m,l,r]);return n?s.createElement("div",{ref:p,style:{...g.container,...l?g.popOutContainer:{}},onMouseMove:()=>{t.isAnimating||o((e=>({...e,mouseEntered:!0})))},onMouseLeave:()=>{t.isAnimating||o((e=>({...e,mouseEntered:!1})))}},a()("div",{style:g.wrap},void 0,a()("div",{style:g.content},void 0,s.createElement(Cl,e)))):null}function kl(e){let{enablePageAnalytics:t,navigableBlock:o,onTabChange:i}=e;const n=(0,V.O7)(),{popOutMode:r}=(0,N.VK)((()=>({popOutMode:(0,ee._c)(n)})),[n]),s=(0,N.Kw)(yn.ZP),l=(0,Ce.yK)((()=>({commentsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:r?0:_i.R6(n.device.isElectronMac)}})),[n,r]);switch(s.currentTab){case yn.gY.Comments:return a()("div",{style:l.commentsHeaderStyle});case yn.gY.Updates:return a()(bl.Z,{popOutMode:r,navigableBlock:o,enablePageAnalytics:t,onTabChange:i});case yn.gY.Assistant:return a()("div",{style:l.commentsHeaderStyle})}}function Cl(e){window.__c={n:"SidebarActivityFeed"};const{isResizerHovered:t,isResizing:o,currentTab:i,expanded:n}=(0,N.Kw)(yn.ZP),{currentBlockStore:r}=e,l=(0,V.O7)(),{currentTabToRender:c,popOutMode:d}=(0,N.VK)((()=>({currentTabToRender:r.isCollectionView()&&!r.isCollectionViewPageWithContent()&&i!==yn.gY.Assistant?yn.gY.Updates:i,popOutMode:(0,ee._c)(l)})),[r,i,l]),p=(0,N.VK)((()=>{if(!R.default.checkGate("page_analytics")&&!R.default.checkGate("page_analytics_individual"))return!1;const{currentSpaceStore:e}=E.default.state;return!(0,Vi.Cx)(e)}),[]),u=s.useCallback((e=>{k.trackUpdatesSidebarTabClick(l,{tab:e===yn.uF.Updates?"updates":"analytics",origin:xo.default.state.open?"peek_view":"page"}),yn.ZP.setState({...yn.ZP.state,currentSubTab:e})}),[l]),m=(0,Ce.yK)((e=>({pane:{display:"flex",flexDirection:"column",height:"100%",position:"relative",pointerEvents:"none",maxHeight:"100%",backgroundColor:i===yn.gY.Comments?void 0:"inherit"},resizerStyle:{position:"absolute",top:0,left:-3,bottom:0,right:0,height:"100vh",width:3,zIndex:-1,display:"block",transition:"box-shadow 300ms ease-in",...(t||o)&&n?{boxShadow:e.sidebarResizerBoxShadow}:{}},controlsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:d?0:_i.R6(l.device.isElectronMac),paddingTop:4,width:d?"calc(100% - 2px)":"100%",background:e.contentBackground,borderRadius:3,paddingBottom:1}})),[i,t,o,l,n,d]);return a()("div",{style:m.pane,className:ni.zar},void 0,a()("div",{style:m.resizerStyle}),a()(kl,{enablePageAnalytics:p,navigableBlock:r,onTabChange:u}),a()(Sl,{currentTab:c,enablePageAnalytics:p}),n&&a()(wn,{type:"update"}))}const _l=function(e){window.__c={n:"UpdateSidebarAnimatedWrapper"};const{isElectronMac:t,currentBlockStore:o}=e,[i,n]=(0,N.AF)(yn.ZP),r=(0,s.useMemo)((()=>o.clone()),[o]),l=(0,V.O7)(),c=(0,N.VK)((()=>l.currentUser.isLoggedIn()&&(0,ee.Sx)(l)),[l]),{isExpanded:d,popOutMode:p,closeSidebar:u}=(0,N.VK)((()=>({isExpanded:(0,ee.Sx)(l),popOutMode:(0,ee._c)(l),closeSidebar:()=>L.setUpdateExpand({environment:l,isExpanded:!1,from:"close_for_space"})})),[l]),[m,g]=(0,s.useState)(!1),[h,f]=(0,s.useState)(void 0);return(0,s.useEffect)((()=>{(void 0===h||h===o.id)&&d&&(g(!0),f(o.id))}),[h,o,d]),i.canRender?a()(fi.Z,{isVisible:!0,useCompositeLayer:!0,animationStyle:{width:c?i.width:0},render:()=>a()(zi.Z,{store:r,droppable:!0,render:()=>a()(wl,{isElectronMac:t,isFullyExpanded:!i.isAnimating,currentBlockStore:o,isExpanded:d,popOutMode:p,closeSidebar:u,shouldLoadSidebarComponents:m})},r.id),onAnimationStart:()=>{n((e=>({...e,isAnimating:!0})))},onAnimationEnd:()=>{n((e=>({...e,isAnimating:!1})))}}):null};class Ml extends l.Z{constructor(){super(...arguments),this.appRenderState=this.createComputedStore((()=>K.h1(this.environment))),this.handleFrameBlockerClick=()=>{L.close()},this.showHelpButtonStore=this.createComputedStore((()=>{if(!this.environment.currentUser.isLoggedIn())return!1;if(this.environment.device.isMobile)return!1;const{mainEditorCurrentBlockStore:e}=E.default.state;return!!e&&!(0,q.IJ)(this.environment,e)})),this.showTemplateChecklistStore=this.createComputedStore((()=>{if(!this.environment.currentUser.isLoggedIn())return!1;if(this.environment.device.isMobile)return!1;const{mainEditorCurrentBlockStore:e}=E.default.state;if(!e)return!1;return!("on"!==R.default.getGroup("template-checklist"))})),this.isAssistantLabelerModeEnabledStore=this.createComputedStore((()=>(0,G.Gw)())),this.frameBlockerStyle={position:"absolute",top:0,left:(0,ee.qG)(this.environment),right:0,bottom:0,zIndex:D.l6}}didMount(){var e;null!==(e=this.environment.mobileNative)&&void 0!==e&&e.api.appComponentMountState&&this.environment.mobileNative.api.appComponentMountState(!0)}willUnmount(){var e;null!==(e=this.environment.mobileNative)&&void 0!==e&&e.api.appComponentMountState&&this.environment.mobileNative.api.appComponentMountState(!1)}renderComponent(){const{isElectronMac:e,isMobile:t}=this.environment.device,{RouterStore:o}=this.environment,{route:i}=o.state,{mainEditorCurrentBlockStore:n,currentSpaceStore:r,currentUserRootStore:l,currentCollectionViewStore:c,currentUserSettingsStore:d,shadowCursorStore:p}=E.default.state,{publicPageData:u}=oe.Z.state,m=this.environment.currentUser.isLoggedIn(),g=ie.TC.state,f=(0,ee.in)(this.environment),{state:{shouldShowSidebar:y,shouldShowFrame:b,shouldShowError:S}}=this.appRenderState,w="page"===i.name&&i.shouldDuplicate&&n&&(0,q.S4)(n),k="page"===i.name&&i.workspaceId?i.workspaceId:void 0,C=(0,v.wO)(i)&&l||"nativeTab"===i.name&&l||l||n,_="nativeTab"===i.name&&"search"===i.tab,M="nativeTab"===i.name&&"updates"===i.tab,T=((0,te.bq)()||(0,te.XL)())&&s.createElement(s.Fragment,null,a()(Z.LazySidebarCreateTeamModal,{}),a()(Z.LazySidebarTeamModal,{}),a()(Z.LazyCreateTeamFromPageConfirmModal,{}),a()(Z.LazyConfirmPrivilegedActionModal,{}));F.wk({environment:this.environment});const I=re.default.state.data;return a()(It,{style:this.getStyle()},void 0,y&&!t&&a()(Wa,{isElectronMac:e,isExpanded:f}),y&&t&&a()(Z.LazySidebarMobile,{}),a()(kt,{}),"workspaceSetup"===i.name&&a()(Z.LazyAppsSetup,{}),n&&b&&a()(mo.Z,{routerState:this.props.routerState,store:n,collectionViewStore:c}),w&&"page"===i.name&&a()(uo,{blockId:i.blockId,workspaceId:k,tid:i.tid,from:i.from}),S&&u&&!w&&a()(Jo,{route:this.props.routerState.route,publicPageData:u}),y&&!(0,ee.Jr)(this.environment)&&g&&this.renderMobileSidebarFrameBlocker(),a()(Zt,{}),this.showHelpButtonStore.state&&a()(go.Z,{isMobile:!1}),this.showTemplateChecklistStore.state&&a()(xs,{}),this.isAssistantLabelerModeEnabledStore.state&&a()(Z.LazyAssistantLabelerBar,{}),(0,G.GD)(this.environment,void 0)&&s.createElement(s.Fragment,null,a()(j.u7,{}),a()(W,{})),(0,X.u)(this.environment)&&a()(to,{}),this.shouldShowMobileBottomBar()&&m&&n&&r&&a()(Z.LazyMobileBottomBar,{store:n}),!t&&"nativeTab"!==this.props.routerState.route.name&&"workspaceSetup"!==this.props.routerState.route.name&&a()(En,{}),"rendered"===E.default.state.renderPhase&&s.createElement(s.Fragment,null,m&&s.createElement(s.Fragment,null,T,a()(Z.LazyMoveToMenuRenderer,{}),a()(Z.LazyCustomizePageMenuRenderer,{}),a()(Z.LazyTopbarPageAnalyticsOptOutMenu,{}),a()(Z.LazyImportModal,{}),a()(Z.LazyExportModal,{}),a()(Z.LazyPageTemplateModal,{}),a()(Z.LazyTemplateGalleryModal,{}),a()(Z.LazyIntegrationGalleryModal,{}),a()(Z.LazyGoogleAuthPromptModal,{}),a()(Z.LazyStudentNotEligibleModal,{}),a()(Z.LazySpacePermissionSettingsTrialModal,{}),a()(Z.LazyContactModal,{}),a()(Z.LazyPersonaCollectionModal,{}),a()(Z.LazyCookieModal,{}),((0,Y.TN)()||(0,Y.PN)())&&a()(Z.LazyAutomationModal,{}),a()(Z.LazyConfigureIntegrationModal,{}),r&&I&&ne.Z.state.open&&a()(Z.LazySpaceSubscriptionUpgradeModal,{spaceStore:r,data:I}),r&&I&&a()(Z.LazySpaceSubscriptionUpdateModal,{data:I}),r&&I&&a()(Z.LazyAddOnUpgradeModal,{data:I}),d&&r&&n&&a()(Z.LazyCsatPopup,{userSettingsStore:d,spaceStore:r,blockStore:n}),b&&a()(Z.LazyOpenInDesktopAppPopup,{}),b&&a()(Z.LazyShadowCursorTutorialPopup,{})),a()(Z.LazyReportPageModal,{}),C&&!S&&a()(Z.LazySearch,{parentStore:C,renderAsPage:_,renderId:_?(0,h.ZP)():void 0}),M&&a()(aa.Z,{format:aa.Z.Format.RenderAsPage,renderId:(0,h.ZP)()}),a()(Z.LazyForkPagePopup,{}),function(e,t){var o;if(!e||!t)return!1;const i=t.getSettings(),n=null==i?void 0:i.pm_announcement_modal_phase,r=Boolean(n&&"unseen"!==n);let a=null==i?void 0:i.signup_time;10===(null===(o=a)||void 0===o?void 0:o.toString().length)&&(a*=1e3);const s=Boolean(a&&a<$);return!r&&s&&J(e.id)}(r,d)?a()(nt,{}):null,a()(ze,{}),void 0,a()(Zs,{})),a()(Gt,{}),"rendered"===E.default.state.renderPhase&&a()(Z.LazyAppComponents,{}),a()(qt,{}),(0,Q.CO)(this.environment)&&a()(Fn,{position:p.state.position}),y&&!t&&n&&a()(_l,{currentBlockStore:n,isElectronMac:e}),a()(ut,{}),a()(be,{}),a()(rs,{}),a()(ss,{subscriptionDataStore:re.default}))}renderMobileSidebarFrameBlocker(){return a()("div",{style:this.frameBlockerStyle,onClick:this.handleFrameBlockerClick})}shouldShowMobileBottomBar(){const{isTablet:e,isMobileNative:t,isIOS:o}=this.environment.device;return t&&o&&!e}getStyle(){return{width:"100vw",height:"100%",position:"relative",display:"flex",flex:1,background:this.theme.contentBackground}}}Ml.displayName="App";const Tl=Ml;var Il=o(3403);class Pl extends l.Z{renderComponent(){return a()("div",{style:Pl.wrapStyle},void 0,a()(Ro.Z,{href:y._j.root,innerStyle:Pl.logoWrapStyle},void 0,"light"===this.theme.mode?g.Z.notionLogo(Pl.logoStyle):g.Z.notionLogoStroked(Pl.logoStyle)),a()("div",{style:Pl.messageStyle},void 0,this.props.children))}}Pl.displayName="MessageBox",Pl.wrapStyle={width:"100vw",height:"90vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},Pl.messageStyle={maxWidth:320,paddingLeft:18,paddingRight:18},Pl.logoWrapStyle={padding:8,borderRadius:3,marginBottom:2},Pl.logoStyle={width:42,height:42,flexShrink:0,flexGrow:0};const xl=Pl;function Bl(e){let{payload:t}=e;const o=(0,V.O7)(),[i,n]=(0,s.useState)(t?{type:"unconfirmed"}:{type:"error"}),r=(0,s.useCallback)((async()=>{if(!t)return void n({type:"error"});n({type:"loading"});const e=await async function(e){let{environment:t,payload:o}=e;const i=await Oo.unsubscribeFromEmails(t,{payload:o});return"success"===i.type?{type:"success",spaceName:i.data.spaceName}:{type:"error"}}({environment:o,payload:t});n("error"===e.type?{type:"error"}:{type:"confirmed",spaceName:e.spaceName})}),[o,t]),l=(0,Ce.yK)((()=>({confirmUnsubscribeDescription:{marginBottom:10}})),[]);switch(i.type){case"loading":return a()(xl,{},void 0,a()(w.FormattedMessage,{defaultMessage:"Loading…",description:"Loading message that shows on the unsubscribe email page.",id:"confirmUnsubscribePage.loadingMessage"}));case"unconfirmed":return a()(xl,{},void 0,a()("div",{style:l.confirmUnsubscribeDescription},void 0,a()(w.FormattedMessage,{defaultMessage:"Are you sure you want to unsubscribe from this list?",description:"Description above button asking the user if they want to confirm unsubscribing from the email list.",id:"unsubscribeFromEmails.workspace.confirmUnsubscribeDescription"})),a()(Re.Z,{isLarge:!0,onClick:r},void 0,a()(w.FormattedMessage,{id:"confirmUnsubscribePage.confirmButton",description:"Button to confirm unsubscribe from emails.",defaultMessage:"Unsubscribe"})));case"confirmed":return a()(xl,{},void 0,a()(w.FormattedMessage,{defaultMessage:"You have successfully unsubscribed from emails for {workspaceName}",description:"Message shown when a user has successfully unsubscribed from emails.",values:{workspaceName:a()("b",{},void 0,i.spaceName)},id:"unsubscribeFromEmails.workspace.message"}));case"error":return a()(xl,{},void 0,a()(w.FormattedMessage,{id:"confirmUnsubscribePage.errorMessage",description:"Error message that shows when the user tried to unsubscribe from emails but there was an error.",defaultMessage:"Could not unsubscribe."}));default:(0,Xa.t1)(i)}}const Zl=(0,w.defineMessages)({pageTitle:{id:"desktopEmailConfirmPage.title",defaultMessage:"Please check your email to confirm",description:"Page title for Desktop confirm email page"},pageCaption:{id:"desktopEmailConfirmPage.subtitle",defaultMessage:"Almost there!",description:"Page subtitle for Desktop confirm email page"},pageDescription1:{id:"desktopEmailConfirmPage.description1",defaultMessage:"Please check your email and click the link to confirm.",description:"Page description (1) for Desktop confirm email page"},pageDescription2:{id:"desktopEmailConfirmPage.description2",defaultMessage:"Once confirmed, you'll be able to return to the desktop app to complete signup.",description:"Page description (2) for Desktop confirm email page"},checkYourGmail:{id:"desktopEmailConfirmPage.button.checkYourGmail",defaultMessage:"Check your Gmail inbox",description:"Check your Gmail inbox description for button"}}),El=()=>(window.__c={n:"NotionLogo"},a()("svg",{style:{display:"block",height:42},viewBox:"0 0 87 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"},void 0,a()("path",{d:"M1.805 1.294l16.6-1.226c2.039-.175 2.563-.057 3.845.875l5.299 3.733c.874.642 1.165.817 1.165 1.516v20.473c0 1.283-.466 2.042-2.097 2.158L7.34 29.99c-1.224.058-1.807-.117-2.448-.934L.99 23.982c-.7-.934-.99-1.633-.99-2.45V3.334c0-1.049.466-1.924 1.805-2.04z",fill:"#fff"}),a()("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.405.068l-16.6 1.226C.466 1.41 0 2.285 0 3.334v18.198c0 .817.29 1.516.99 2.45l3.902 5.074c.641.817 1.224.992 2.448.934l19.277-1.167c1.63-.116 2.097-.875 2.097-2.158V6.192c0-.663-.262-.854-1.033-1.42a85.473 85.473 0 01-.133-.096L22.25.943c-1.282-.932-1.806-1.05-3.845-.875zM7.776 5.857c-1.574.106-1.931.13-2.825-.597L2.678 3.452c-.231-.234-.115-.526.467-.584l15.958-1.166c1.34-.117 2.038.35 2.562.758l2.737 1.983c.117.059.408.408.058.408l-16.48.992-.204.014zM5.941 26.49V9.11c0-.759.233-1.109.931-1.168L25.8 6.834c.642-.058.932.35.932 1.108v17.264c0 .759-.117 1.401-1.165 1.459l-18.113 1.05c-1.048.058-1.513-.291-1.513-1.225zm17.88-16.448c.116.525 0 1.05-.525 1.11l-.873.173v12.832c-.758.408-1.456.641-2.039.641-.932 0-1.165-.292-1.863-1.166l-5.709-8.982v8.69l1.806.409s0 1.05-1.457 1.05l-4.017.233c-.117-.234 0-.817.407-.933l1.049-.291v-11.49L9.144 12.2c-.117-.525.174-1.283.99-1.342l4.31-.29 5.94 9.098v-8.049l-1.514-.174c-.117-.643.349-1.11.931-1.167l4.02-.234z",fill:"#000"}),a()("path",{className:"fill",d:"M41.434 21.251v-7.91h.137l5.704 7.91h1.796V9.627h-1.997v7.902h-.137l-5.704-7.902H39.43V21.25h2.005zM54.715 21.429c2.635 0 4.238-1.724 4.238-4.584 0-2.852-1.611-4.584-4.238-4.584-2.618 0-4.237 1.74-4.237 4.584 0 2.86 1.595 4.584 4.237 4.584zm0-1.676c-1.393 0-2.19-1.063-2.19-2.908 0-1.837.797-2.908 2.19-2.908 1.386 0 2.183 1.071 2.183 2.908 0 1.845-.789 2.908-2.183 2.908zM60.778 10.28v2.215h-1.393v1.595h1.393v4.809c0 1.708.806 2.393 2.828 2.393.386 0 .757-.04 1.047-.097v-1.563c-.242.024-.395.04-.677.04-.837 0-1.208-.386-1.208-1.256V14.09h1.885v-1.595h-1.885v-2.216h-1.99zM65.85 21.251h1.99v-8.813h-1.99v8.813zm.991-10.27c.66 0 1.192-.533 1.192-1.201 0-.669-.531-1.209-1.192-1.209-.652 0-1.192.54-1.192 1.209 0 .668.54 1.2 1.192 1.2zM73.299 21.429c2.634 0 4.237-1.724 4.237-4.584 0-2.852-1.611-4.584-4.237-4.584-2.619 0-4.238 1.74-4.238 4.584 0 2.86 1.595 4.584 4.238 4.584zm0-1.676c-1.394 0-2.192-1.063-2.192-2.908 0-1.837.798-2.908 2.192-2.908 1.385 0 2.183 1.071 2.183 2.908 0 1.845-.79 2.908-2.183 2.908zM78.725 21.251h1.998V16.12c0-1.297.75-2.119 1.941-2.119 1.217 0 1.78.677 1.78 2.022v5.228h1.999v-5.703c0-2.103-1.072-3.287-3.037-3.287-1.314 0-2.2.604-2.619 1.587h-.137v-1.41h-1.925v8.813z",fill:"#000"})));function Rl(){return window.__c={n:"Header"},a()("div",{style:{padding:24}},void 0,a()(El,{}))}function Al(e){window.__c={n:"Body"};const{experimentVariant:t}=e;return a()("div",{style:{width:800,height:"80vh",margin:"0 auto"}},void 0,a()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"80vh"}},void 0,a()(Ae.sg,{gap:16,padding:16},void 0,a()("div",{style:{fontSize:36,fontWeight:fo.Z.fontWeight.bold}},void 0,s.createElement(w.FormattedMessage,Zl.pageTitle)),a()("div",{style:{fontWeight:fo.Z.fontWeight.bold}},void 0,s.createElement(w.FormattedMessage,Zl.pageCaption)),a()("div",{},void 0,s.createElement(w.FormattedMessage,Zl.pageDescription1)),a()("div",{},void 0,s.createElement(w.FormattedMessage,Zl.pageDescription2)),"with_gmail_cta"===t&&a()(Re.Z,{style:{width:"fit-content"},isLarge:!0,onClick:()=>{window.location.href="https://mail.google.com/mail/u/0/#search/Your+Notion+signup+code+is"}},void 0,s.createElement(w.FormattedMessage,Zl.checkYourGmail))),a()(Ae.sg,{},void 0,a()("img",{style:{width:350},src:Et.Z.images.onboarding.couch2Png}))))}function Dl(){const e=(0,V.O7)(),[t,o]=(0,s.useState)(null);return(0,s.useEffect)((()=>{try{const t=new URLSearchParams(window.location.search).get("state");if(!t)return;const i=JSON.parse(atob(t));i.experimentVariant&&o(i.experimentVariant),i.email&&i.deviceId&&k.trackDesktopAppSignupBrowserVisit(e,{desktopAppRerouteEmail:i.email,desktopAppDeviceId:i.deviceId})}catch(t){}}),[e,o]),s.createElement(s.Fragment,null,a()(Rl,{}),a()(Al,{experimentVariant:t}))}var Fl=o(51428),Ll=o(35868);class Vl extends l.Z{renderComponent(){const e={block:this.props.block,exportType:this.props.blockExportType,timeZone:(0,Ft.r)(),locale:"en"};return a()(Ko.Z,{request:e,performRequest:e=>Oo.exportBlockPreview(this.environment,e),render:(e,t,o)=>{if(e||t&&"failed"===t.type)return a()("div",{},void 0,a()("h1",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Error",id:"exportPreview.error.message"})),a()("pre",{},void 0,a()("code",{},void 0,JSON.stringify(e||t,null,"  "))));if(!o||!t)return a()("h1",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Loading…",id:"exportPreview.loading.message"}));const{exportURL:i}=t.data;return"pdf"===this.props.blockExportType?a()("div",{},void 0,a()("strong",{},void 0,"pdf:"),a()(Ll.l,{source:i,width:1e3,height:1500})):a()("div",{style:{background:"#eee",position:"flex",flexDirection:"column",height:"100%"}},void 0,a()("strong",{},void 0,this.props.blockExportType,":"),a()("div",{style:{position:"relative",background:"#fff",flexGrow:1,height:"100%"}},void 0,a()(Fl.Z,{source:i,isFullWidth:!0,isFullHeight:!0,background:!1})))}})}}Vl.displayName="ExportPreview";var Nl=o(13559),Ol=o(44819),Ul=o(14066);function Hl(e){window.__c={n:"FrontFallbackPage"};const{preventFrontRedirect:t}=e,o=(0,V.O7)(),{pathname:i,search:n,hash:r}=window.location;if(!t&&(0,Ol.XR)(o,i)){const e=n.length>0?`${n}&${Nl.AM}=1`:`?${Nl.AM}=1`;return window.location.href=i+e+r,null}return a()(Ul.Z,{isSignup:!o.currentUser.isLoggedIn()})}var zl=o(26198);class Wl extends l.Z{constructor(){super(...arguments),this.intersectionObserver=void 0,this.registry=new Map,this.handleIntersectionObserverEntries=(e,t)=>{for(const o of e){if(!(o.target instanceof HTMLElement))continue;const e=this.registry.get(o.target);e&&(e.isVisible=o.isIntersecting,e.latestTimestamp=o.time,e.isVisible&&!e.isSpawned&&(e.isSpawned=!0,e.onVisibilityChange(!0)))}this.despawnOldFrames()}}willMount(){void 0!==window.IntersectionObserver&&(this.intersectionObserver=new IntersectionObserver(this.handleIntersectionObserverEntries))}willUnmount(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=void 0)}didUpdate(e){this.props.maxPreferredIFrames<e.maxPreferredIFrames&&this.despawnOldFrames()}despawnOldFrames(){const e=Array.from(this.registry.values()).filter((e=>e.isSpawned)),t=e.length-this.props.maxPreferredIFrames;if(t<=0)return;const o=e.filter((e=>!e.isVisible));o.sort(((e,t)=>e.latestTimestamp-t.latestTimestamp));for(const i of o.slice(0,t))i.isSpawned=!1,i.onVisibilityChange(!1)}track(e,t){this.intersectionObserver?(this.registry.set(e,{isVisible:!1,isSpawned:!1,latestTimestamp:0,onVisibilityChange:gt().debounce(t,50)}),this.intersectionObserver.observe(e)):zl.uf.track(e,t)}untrack(e){this.intersectionObserver?(this.intersectionObserver.unobserve(e),this.registry.delete(e)):zl.uf.untrack(e)}renderComponent(){return a()(zl.Lr.Provider,{value:this},void 0,this.props.children)}}Wl.displayName="IFrameManager";var jl=o(59649),Kl=o(11342),Yl=o(30278),Gl=o(85974),Xl=o(44196);class ql extends l.Z{constructor(){super(...arguments),this.storeTypes={loginStore:Gl.Z,loginPermissionsStore:Yl.Z},this.openIntercom=()=>{I.j({environment:this.environment,from:"desktop_login"})}}didMount(){this.environment.currentUser.isLoggedIn()&&M.navigate({environment:this.environment,url:y._j.root,redirect:!0})}renderComponent(){const{device:e}=this.environment,t=e.isMac?a()(w.FormattedMessage,{id:"desktopLogin.welcomeMessage.mac",defaultMessage:"Welcome to Notion",values:{isMacApp:e.isMac}}):a()(w.FormattedMessage,{id:"desktopLogin.welcomeMessage.windows",defaultMessage:"Welcome to Notion",values:{isMacApp:e.isMac}});return[a()("div",{style:{width:"100%",height:"45px",...(0,Mi.X)(this.environment.device.isElectronMac,!0)}}),a()(Fo.Z,{title:Ge.default.getIntl().formatMessage({defaultMessage:"Log in",id:"loginDesktopPage.title",description:"The tab title displayed in the desktop app when the user needs to log in"})},"title"),a()("div",{style:ql.style},void 0,a()("div",{style:{display:"flex",width:440}},void 0,g.Z.notionLogoStroked({width:64,height:64,display:"block",flexGrow:0,flexShrink:0,marginTop:4}),a()("div",{style:{flexGrow:1,marginLeft:24,lineHeight:1.4}},void 0,a()("div",{style:{fontWeight:fo.Z.fontWeight.semibold,fontSize:21}},void 0,t),a()("div",{style:{fontSize:18}},void 0,a()(w.FormattedMessage,{id:"desktopLogin.loginOrSignupToSyncMessage",defaultMessage:"Log in to sync your content."})))),this.shouldRenderUpgradeWarning()?this.renderUpgradeWarning():this.renderLoginAction(),this.renderFooter())]}renderUpgradeWarning(){const{device:e}=this.environment,t=e.isMac?a()(w.FormattedMessage,{id:"desktopLogin.upgradeWarning.appOutOfDateMessage.mac",defaultMessage:"Your Mac app is out of date.",values:{isMacApp:e.isMac}}):a()(w.FormattedMessage,{id:"desktopLogin.upgradeWarning.appOutOfDateMessage.windows",defaultMessage:"Your Windows app is out of date.",values:{isMacApp:e.isMac}}),o=e.isMac?a()(w.FormattedMessage,{id:"desktopLogin.upgradeWarning.upgradeInstructions.mac",defaultMessage:"Please download and reinstall your Mac app.",values:{isMacApp:e.isMac}}):a()(w.FormattedMessage,{id:"desktopLogin.upgradeWarning.upgradeInstructions.windows",defaultMessage:"Please download and reinstall your Windows app.",values:{isMacApp:e.isMac}});return a()("div",{style:{maxWidth:440,paddingTop:20,textAlign:"center"}},void 0,a()("span",{style:{color:m.ZP.frontRed}},void 0,t),a()("br",{}),a()(Ne.Z,{href:e.isMac?(0,ol.UY)("guides.reinstallMac"):(0,ol.UY)("guides.reinstallWindows"),external:!0},void 0,o))}renderLoginAction(){const{loginStore:e}=this.stores;return e.isMfa()?a()(Xl.Z,{loginStore:e}):s.createElement(Vo.Z,n()({style:{width:320,marginTop:24},emailPasscodePlaceholderType:"enter_code",emailLabelType:"email",emailInputAutoFocus:!0,from:"LoginDesktop"},this.stores))}renderFooter(){return a()("div",{style:ql.footerStyle},void 0,a()(Eo.Z,{onClick:this.openIntercom},void 0,a()(ba.Z,{},void 0,a()(w.FormattedMessage,{id:"desktopLogin.footer.helpCenterLink",defaultMessage:"Need help?"}))),a()(Eo.Z,{style:{marginLeft:4},href:y._j.termsAndPrivacy,external:!0},void 0,a()(ba.Z,{},void 0,a()(w.FormattedMessage,{id:"desktopLogin.footer.privacyAndTermsLink",defaultMessage:"Privacy & Terms"}))),a()(ba.Z,{style:{marginLeft:4},disabled:!0},void 0,"© ",Ya.ou.now().year," ","Notion Labs, Inc."))}shouldRenderUpgradeWarning(){const{device:e}=this.environment;if("production"===x.Z.env){const t=C.getDesktopVersion();if(e.isElectron&&t&&((0,Kl.isLessThanVersion)(t,[0,3,0])||(0,Kl.isEqualVersion)(t,[0,3,0])))return!0}return!1}}ql.displayName="LoginDesktop",ql.style={width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",userSelect:"none",WebkitUserSelect:"none"},ql.footerStyle={display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1.2,position:"fixed",bottom:16,left:0,right:0};const $l=ql,Jl={width:44,height:44,flexGrow:0,flexShrink:0,marginTop:64,marginBottom:20};class Ql extends l.Z{constructor(){super(...arguments),this.storeTypes={loginStore:Gl.Z,loginPermissionsStore:Yl.Z},this.handleReset=e=>{this.stores.loginStore.setState({loginType:"google",email:"",password:""})},this.openIntercom=()=>{I.j({environment:this.environment,from:"mobile_login"})}}willMount(e){super.willMount(e),"email"===this.stores.loginStore.state.loginType&&this.stores.loginStore.setState({...this.stores.loginStore.state,loginType:"google"})}didMount(){this.environment.currentUser.isLoggedIn()&&M.navigate({environment:this.environment,url:y._j.root,redirect:!0})}renderComponent(){const{loginStore:e}=this.stores,t=e.isEmail()||e.isPassword()||e.isMfa();return a()(Si.Z,{style:Ql.scrollerStyle,type:si.Z.Y},void 0,a()("div",{style:this.getScrollContainerStyle()},void 0,a()(Le.Z,{isGray:!0,onClick:this.handleReset,icon:g.Z.backward,style:{marginTop:36,marginBottom:12,display:t?"flex":" none"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Go back",id:"loginMobileNative.goBackButton.label"})),"light"===this.theme.mode?g.Z.notionLogo({...Jl,display:t?"none":"block"}):g.Z.notionLogoStroked({...Jl,display:t?"none":"block"}),a()("div",{style:{lineHeight:1.4,fontSize:18,color:m.ZP.black,display:t?"none":" block"}},void 0,a()("div",{style:{fontWeight:fo.Z.fontWeight.bold,marginBottom:16,color:this.theme.regularTextColor}},void 0,a()(w.FormattedMessage,{defaultMessage:"Welcome to Notion! 👋",id:"loginMobileNative.welcomeMessage"})),a()("div",{style:{marginBottom:20,color:this.theme.regularTextColor}},void 0,a()(w.FormattedMessage,{defaultMessage:"Notion is a collaborative tool for <mediumfont>notes</mediumfont>, <mediumfont>tasks</mediumfont>, and <mediumfont>wikis</mediumfont>",values:{mediumfont:e=>a()("span",{style:{fontWeight:fo.Z.fontWeight.medium}},void 0,e)},id:"loginMobileNative.descriptionOfNotion.message"})," ","✍️")),e.isMfa()?a()(Xl.Z,{loginStore:e}):s.createElement(Vo.Z,n()({style:{marginBottom:24,alignItems:"flex-start"},captionStyle:{textAlign:"left"},emailPasswordSentPromptStyle:{fontSize:13},emailPasscodePlaceholderType:"enter_code",emailLabelType:"email",emailInputAutoFocus:!0,showMobileLayout:!0,from:"loginMobileNative"},this.stores)),this.renderFooter()))}renderFooter(){return a()("div",{style:Ql.footerStyle},void 0,a()("div",{style:{display:"flex",alignItems:"center",lineHeight:1.2}},void 0,a()(Eo.Z,{href:y._j.termsAndPrivacy,external:!0},void 0,a()(ba.Z,{},void 0,a()(w.FormattedMessage,{defaultMessage:"Privacy & terms",id:"loginMobileNative.footer.privacyAndTermsButton.label"}))),a()(ba.Z,{style:{marginLeft:4},onClick:this.openIntercom},void 0,a()(w.FormattedMessage,{defaultMessage:"Need help?",id:"loginMobileNative.footer.helpButton.label"}))),a()(ba.Z,{style:{marginTop:12},disabled:!0},void 0,"© ",Ya.ou.now().year," ","Notion Labs, Inc."))}getScrollContainerStyle(){const{WindowSizeStore:e}=this.environment;return{width:"100%",maxWidth:414,marginLeft:"auto",marginRight:"auto",paddingTop:e.state.paddingTopCSS,paddingLeft:e.getSafePaddingLeftCSS(34),paddingRight:e.getSafePaddingRightCSS(34)}}}Ql.displayName="LoginMobileNative",Ql.footerStyle={marginTop:36,paddingBottom:48,marginLeft:-4},Ql.scrollerStyle={height:"100%",width:"100%"};const ec=Ql;class tc extends l.Z{renderComponent(){const{device:e}=this.environment;return this.environment.currentUser.isLoggedIn()?a()("div",{style:tc.style},void 0,a()(jl.Z,{style:{width:"100%",height:"100%"},spinnerSize:mo.Z.spinnerSize,showSpinnerTimeout:500})):e.isElectron?a()($l,{}):e.isMobileNative?a()(ec,{}):a()(Hl,{preventFrontRedirect:!0})}}tc.displayName="Index",tc.style={position:"absolute",top:0,left:0,bottom:0,right:0};const oc=tc;var ic=o(37770),nc=o(9852);class rc extends l.Z{constructor(){super(...arguments),this.storeTypes={loginPermissionsStore:Yl.Z}}willMount(e){super.willMount(e),e.email&&_o.Z.setState({..._o.Z.state,email:e.email}),e.redirectURL&&(0,nc.setPostLoginRedirect)(e.redirectURL)}didMount(){super.didMount()}renderComponent(){const{device:e}=this.environment,{loginPermissionsStore:t}=this.stores,{intl:o}=this.props;if(e.isElectron)return a()($l,{loginStore:_o.Z,loginPermissionsStore:t});if(e.isMobileNative)return a()(ec,{loginStore:_o.Z,loginPermissionsStore:t});{const e=`Notion - ${this.props.isSignup?o.formatMessage({defaultMessage:"Sign up",id:"signupPage.pageTitle"}):o.formatMessage({defaultMessage:"Log in",id:"loginPage.pageTitle"})}`;return a()(Fo.Z,{title:e},void 0,a()(Ul.Z,{isSignup:this.props.isSignup}))}}}rc.displayName="LoginPage";const ac=(0,w.injectIntl)(rc);class sc extends l.Z{constructor(){super(...arguments),this.handleOpenInNativeApp=()=>{M.openInNativeApp({url:this.props.redirect,environment:this.environment})}}didMount(){this.handleOpenInNativeApp()}renderComponent(){return a()(xl,{},void 0,a()("div",{style:{color:this.theme.regularTextColor}},void 0,a()(w.FormattedMessage,{defaultMessage:"Redirecting to your Notion app…",id:"webApp.redirectingToDesktop.message"})),a()(Ro.Z,{onClick:this.handleOpenInNativeApp,style:{maxWidth:300,textAlign:"center",textDecoration:"underline",color:this.theme.lightTextColor}},void 0,a()(w.FormattedMessage,{defaultMessage:"If you weren't redirected, click here.",id:"webApp.redirectingToDesktop.directLink.message"})),a()(Ro.Z,{href:this.props.redirect,style:{maxWidth:300,textAlign:"center",textDecoration:"underline",color:m.ZP.uiGray}},void 0,a()(w.FormattedMessage,{defaultMessage:"Or, continue in your browser",id:"webApp.redirectingToDesktop.continueInBrowser.message"})))}}sc.displayName="NativeRedirect";const lc=sc;var cc=o(85266),dc=o(57400),pc=o(35822),uc=o(30021);function mc(){return function(){const e=(0,V.O7)(),t=(0,s.useCallback)((()=>{pc.LH(e)}),[e]);(0,s.useEffect)((()=>(t(),uc.Z.addListener(t),()=>{uc.Z.removeListener(t)})),[t])}(),null}var gc=o(47779),hc=o(58455);function fc(){return function(){const e=(0,V.O7)(),t=(0,N.VK)((()=>hc.default.state.isLoaded),[]),o=(0,N.VK)((()=>hc.default.state.isAmplitudeEnabled),[]);(0,s.useEffect)((()=>{t&&async function(){const t=await(0,Be.getDeviceIdForAnalytics)(e);await gc.j2({config:x.Z,isEnabled:o,deviceId:t})}()}),[e,t,o])}(),null}function vc(){return function(){const{deviceType:e}=(0,V.Fy)(),t=(0,V.O7)(),o=t.currentUser.isLoggedIn();(0,s.useEffect)((()=>{if(!o)return;if("windows-desktop"!==e&&"mac-desktop"!==e)return;const i=async()=>{await C.isMainTabOrWindow()&&Oo.registerDesktopApp(t,{deviceType:e})};i();const n=window.setInterval((()=>{i()}),5*U.hM);return()=>{window.clearInterval(n)}}),[o,e,t])}(),null}var yc=o(82246),bc=o(81212),Sc=o(54064),wc=o(29755),kc=o(17963);const Cc=new Sc.Z;class _c extends l.Z{constructor(){super(...arguments),this.lastOnlineState=!1,this.handleConnectionStoreRefresh=()=>{const e=Co.Z.state.online;e&&!this.lastOnlineState&&this.refreshUserTasks(this.environment),this.lastOnlineState=e},this.handleImportEvernote=e=>{"success"===e.state?wc.Z.setStatus(e.request.blockId,void 0):"in_progress"===e.state||"not_started"===e.state?wc.Z.setStatus(e.request.blockId,e.status):wc.Z.setStatus(e.request.blockId,void 0)},this.handleExtractWebClipperContent=e=>{"success"===e.state?kc.Z.setStatus(e.request.blockId,!1):"in_progress"===e.state||"not_started"===e.state?kc.Z.setStatus(e.request.blockId,!0):kc.Z.setStatus(e.request.blockId,!1)}}willMount(){this.lastOnlineState=Co.Z.state.online,setInterval((()=>this.fetchPendingTasks(this.environment)),1e3),this.refreshUserTasks(this.environment),Co.Z.addListener(this.handleConnectionStoreRefresh),Cc.addListener("importEvernote",this.handleImportEvernote),Cc.addListener("extractWebClipperContent",this.handleExtractWebClipperContent)}willUnmount(){Co.Z.removeListener(this.handleConnectionStoreRefresh),Cc.removeListener("importEvernote",this.handleImportEvernote),Cc.removeListener("extractWebClipperContent",this.handleExtractWebClipperContent)}async refreshUserTasks(e){if(e.currentUser.id){const t=await Oo.getUserTasks(e,{});if("success"===t.type){for(const e of t.data.taskIds)Oo.pendingTaskIds.add(e);t.data.taskIds.length>0&&this.fetchPendingTasks(e)}}}async fetchPendingTasks(e){if(e.currentUser.id&&Oo.pendingTaskIds.size>0){const t=await Oo.getTasks(e,{taskIds:Array.from(Oo.pendingTaskIds.values())});if("success"===t.type){const{results:o}=t.data;for(const t of o)t.status&&Oo.handleRecordMapForResponse({environment:e,eventName:t.eventName,response:t.status,userId:e.currentUser.id}),Oo.pendingTaskEventsById.emit(t.id,t),Cc.emit(t.eventName,t),"failure"!==t.state&&"success"!==t.state||Oo.pendingTaskIds.delete(t.id)}}}}_c.displayName="ApiListener";const Mc=_c;var Tc=o(81236);class Ic extends l.Z{constructor(){super(...arguments),this.args=this.createComputedStore((()=>{var e;const{currentUserStore:t,currentUserSettingsStore:o,currentUserRootStore:i}=E.default.state,n=this.environment.currentUser.id,r=n?{user_id:n}:void 0;if(!(n&&t&&o&&i)){const e=(0,ge.getPublicDomainUserId)(this.environment);return e?{user_id:e}:r}const a=i.getSpaceViewStores(),s=a.map((e=>e.isReady()));if(!t.isDefined()||!o.isDefined()||!s)return r;const l=gt().compact(a.map((e=>e.getSpaceId()))).map((e=>Tc.Z.getPublicSpaceData(this.environment,e)));if(!l.every((e=>Boolean(e)||null===e)))return r;const c=(0,Be.getAnalyticsUserPlanType)(l),d=o.getSettings();if(!d)return r;const{device:p}=this.environment,u={user_id:t.id,email:t.getEmail(),user_persona:d.persona,user_team_role:d.team_role,user_use_cases:d.use_cases,user_company_size:d.company_size,user_source:d.source,user_org:d.type,user_plan_type:c,user_subscription_tier:null===(e=re.default.state.data)||void 0===e?void 0:e.subscriptionTier,user_has_at_least_one_free_tier_space:(0,Be.getIfAtLeastOneFreePlanType)(l),time_zone:d.time_zone,locale:d.locale,preferred_locale:d.preferred_locale,signup_time:d.signup_time,app_version:p.version};return d.signup_time&&(u.created_at=Math.floor(d.signup_time/1e3)),p.desktopAppVersion&&(u.desktop_app_version=p.desktopAppVersion),p.mobileAppVersion&&(u.mobile_app_version=p.mobileAppVersion),d.used_desktop_web_app&&(u.used_desktop_web_app=d.used_desktop_web_app),d.used_mobile_web_app&&(u.used_mobile_web_app=d.used_mobile_web_app),d.used_mac_app&&(u.used_mac_app=d.used_mac_app),d.used_windows_app&&(u.used_windows_app=d.used_windows_app),d.used_ios_app&&(u.used_ios_app=d.used_ios_app),d.used_android_app&&(u.used_android_app=d.used_android_app),u}),!0),this.handleIdentifyCurrentUser=()=>{const e=this.args.state;e&&"none"!==e.user_plan_type&&k.identifyCurrentUser(this.environment,e)}}didMount(){this.args.addListener(this.handleIdentifyCurrentUser)}willUnmount(){this.args.removeListener(this.handleIdentifyCurrentUser)}}Ic.displayName="AppIdentifyUserListener";const Pc=Ic;var xc=o(12321);class Bc extends l.Z{async willMountOrUpdate(){const{currentUserRootStore:e}=E.default.state;if(!e)return;await xc.w();const t=e.getSpaceViewStores();for(const o of t){const e=o.getBookmarkedPageStores();for(const o of e)this.preloadPage(o);const t=o.getSharedPageStores();for(const o of t)this.preloadPage(o);const i=o.getTeamsStores();for(const o of i){const e=o.getTeamPagesStores();for(const t of e)this.preloadPage(t)}const n=o.getSpaceStore();if(n){Tc.Z.getPublicSpaceData(this.environment,n.id);const e=(0,Vi.XD)(this.environment,n);for(const t of e)this.preloadPage(t)}}}preloadPage(e){e.load();const t=e.getCollectionViewSourceOrLinkCollectionStores();for(const o of t)o.load()}}Bc.displayName="AppRecordStoreListener";const Zc=Bc;var Ec=o(54153),Rc=o(2449),Ac=o(85844);class Dc extends l.Z{constructor(){super(...arguments),this.renderComponent=()=>{const{isMobile:e}=this.environment.device;return a()(ot.Z,{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:e?"flex-start":"center"},onClick:this.props.onClick,mobileFeedback:!0},void 0,Vc?s.createElement(s.Fragment,null,g.Z.mobileNewFeatures({width:e?26:22,marginRight:e?12:8}),a()("div",{style:{minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Update and see what's new",id:"updateBanner.updateAvailableBanner.message"}))):a()("div",{style:{minWidth:0,wordWrap:"break-word",whiteSpace:"normal",padding:10}},void 0,a()(w.FormattedMessage,e?{id:"updateBanner.updateMessage.noRedirectMobile",defaultMessage:"Tap here to update to the latest version",description:"Text displayed in the blue banner on top of the screen for when want to make sure users have an updated version."}:{id:"updateBanner.updateMessage.noRedirect",defaultMessage:"Click here to update to the latest version",description:"Text displayed in the blue banner on top of the screen for when want to make sure users have an updated version."})))}}}Dc.displayName="UpdateBanner";const Fc=Dc,Lc="electronUpdateReady2",Vc=!1;class Nc extends l.Z{constructor(){super(...arguments),this.handleElectronUpdateChecking=()=>{const{AppUpdateStore:e}=this.environment;e.setState({appUpdate:e.state.appUpdate,electronUpdate:{state:"checking"}})},this.handleElectronUpdateError=(e,t)=>{const{AppUpdateStore:o}=this.environment;o.setState({appUpdate:o.state.appUpdate,electronUpdate:{state:"error",error:t}})},this.handleElectronUpdateNotAvailable=()=>{const{AppUpdateStore:e}=this.environment;e.setState({appUpdate:e.state.appUpdate,electronUpdate:{state:"no-update",timestamp:Date.now()}})},this.handleElectronUpdateAvailable=(e,t)=>{const{AppUpdateStore:o}=this.environment,i=(0,Kl.parseVersion)(t.version),n=C.getDesktopVersion(),r=(0,Kl.getUpdateType)({currentVersion:n,nextVersion:i,app:"desktop"});o.setState({appUpdate:o.state.appUpdate,electronUpdate:{state:"downloading",type:r,version:i,timestamp:Date.now(),progress:0}})},this.handleElectronUpdateProgress=(e,t)=>{const{AppUpdateStore:o}=this.environment,i=o.state;i.electronUpdate&&"downloading"===i.electronUpdate.state&&o.setState({appUpdate:i.appUpdate,electronUpdate:{...i.electronUpdate,progress:t.transferred/t.total}})},this.handleElectronUpdateReady=(e,t)=>{const{device:o}=this.environment,{AppUpdateStore:i}=this.environment,n=Ec.Z.get(Lc),r=t.version;if(n===r){if(o.isMac)return i.setState({appUpdate:i.state.appUpdate,electronUpdate:{state:"ready",type:Kl.UpdateType.Major,version:void 0}}),void pe.showDialog({message:a()(w.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.prompt",defaultMessage:"Please move the Notion app into the Applications folder for the auto-updater to work."}),showCancel:!1,keepFocus:!1,handleCancel:this.handleConfirmUpdate,items:[{label:a()(w.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.dismissButton.label",defaultMessage:"Okay"}),onAccept:this.handleConfirmUpdate}]});Yi.log({level:"error",from:"AppUpdateListener",type:"electronUpdateFailed",data:{miscDataToConvertToString:{previousUpdateReady:n,nextUpdateReady:r}}})}const s=C.getDesktopVersion(),l=(0,Kl.parseVersion)(t.version);if((0,Kl.isEqualVersion)(s,[0,1,9])||(0,Kl.isEqualVersion)(s,[0,1,10]))i.setState({appUpdate:i.state.appUpdate,electronUpdate:{state:"ready",type:Kl.UpdateType.Major,version:void 0}}),this.displayMajorUpdateDialog(),setTimeout(this.handleConfirmUpdate,3e4);else{const e=(0,Kl.getUpdateType)({currentVersion:s,nextVersion:l,app:"desktop"});i.setState({appUpdate:i.state.appUpdate,electronUpdate:{state:"ready",type:e,version:l}}),de.qL({bannerStore:he.Z,id:"ElectronUpdateWarning"}),e===Kl.UpdateType.Major&&"development"!==x.Z.env?this.displayMajorUpdateDialog():e===Kl.UpdateType.Minor&&"development"!==x.Z.env&&this.displayMinorUpdateBanner()}},this.handleAppUpdateChecking=()=>{const{AppUpdateStore:e}=this.environment;e.state.appUpdate&&"ready"===e.state.appUpdate.state||e.setState({electronUpdate:e.state.electronUpdate,appUpdate:{state:"checking"}})},this.handleElectronAppUpdateError=(e,t)=>{this.handleAppUpdateError(t)},this.handleAppUpdateError=e=>{const{AppUpdateStore:t}=this.environment;t.state.appUpdate&&"ready"===t.state.appUpdate.state||t.setState({electronUpdate:t.state.electronUpdate,appUpdate:{state:"error",error:e}})},this.handleAppUpdateNotAvailable=()=>{const{AppUpdateStore:e}=this.environment;e.state.appUpdate&&"ready"===e.state.appUpdate.state||e.setState({electronUpdate:e.state.electronUpdate,appUpdate:{state:"no-update",timestamp:Date.now()}})},this.handleElectronAppUpdateAvailable=(e,t)=>{this.handleAppUpdateAvailable(t)},this.handleAppUpdateAvailable=e=>{const{AppUpdateStore:t}=this.environment;if(t.state.appUpdate&&"ready"===t.state.appUpdate.state)return;const o=(0,Kl.parseVersion)(e.version),i=Rc.ac(),n=(0,Kl.getUpdateType)({currentVersion:i,nextVersion:o,app:"client"});t.setState({electronUpdate:t.state.electronUpdate,appUpdate:{state:"downloading",type:n,version:o,timestamp:Date.now(),progress:0}})},this.handleElectronAppUpdateProgress=(e,t)=>{this.handleAppUpdateProgress(t)},this.handleAppUpdateProgress=e=>{const{AppUpdateStore:t}=this.environment,o=t.state;o.appUpdate&&"downloading"===o.appUpdate.state&&t.setState({electronUpdate:o.electronUpdate,appUpdate:{...o.appUpdate,progress:e.downloaded/e.total}})},this.handleElectronAppUpdateReady=(e,t)=>{this.handleAppUpdateReady(t)},this.handleAppUpdateReady=e=>{const{AppUpdateStore:t}=this.environment,o=(0,Kl.parseVersion)(e.version),i=Rc.ac(),n=(0,Kl.getUpdateType)({currentVersion:i,nextVersion:o,app:"client"});if(!Rc.M0(o)){const e={state:"ready",type:n,version:o};t.setState({electronUpdate:t.state.electronUpdate,appUpdate:e})}"development"===x.Z.env&&Yi.log({level:"info",from:"AppUpdateListener",type:"handleAppUpdateReady",data:{miscDataToConvertToString:{currentVersion:i,nextVersion:o,updateType:n}}}),this.displayUpdateBanner(n,o)},this.handleAppUpdateReload=e=>{de.Js({bannerStore:he.Z}),Rc.hC({environment:this.environment,url:ncd.href(),version:e})},this.handleConfirmUpdate=()=>{const{AppUpdateStore:e,device:t}=this.environment;if(k.trackConfirmAppUpdate(this.environment),Vc){const e=(0,Ol.Us)(y._j.releases);M.navigateToExternalURL({environment:this.environment,url:e})}if(t.isElectron&&e.state.electronUpdate&&"ready"===e.state.electronUpdate.state){const e=C.getDesktopVersion();t.isMac&&((0,Kl.isEqualVersion)(e,[0,2,2])||(0,Kl.isEqualVersion)(e,[0,2,1])||(0,Kl.isEqualVersion)(e,[0,2,0]))?pe.showDialog({showCancel:!1,keepFocus:!1,message:a()(w.FormattedMessage,{id:"desktopAppUpdater.restartDialog.message",defaultMessage:"Please quit and restart the app to install the update."}),items:[{label:a()(w.FormattedMessage,{id:"desktopAppUpdater.dialog.dismissButton.label",defaultMessage:"Okay"}),color:"blue",onAccept:()=>{}}]}):(Ec.Z.set(Lc,(0,Kl.formatVersion)(e)),C.installElectronUpdate())}else e.state.appUpdate&&"ready"===e.state.appUpdate.state?(Rc.hC({environment:this.environment,url:ncd.href(),version:e.state.appUpdate.version}),pe.dismissDialog(),de.Js({bannerStore:he.Z})):(Rc.D$((0,Kl.parseVersion)(x.Z.version)),pe.dismissDialog(),de.Js({bannerStore:he.Z}))},this.handleElectronAppUpdateInstall=()=>{const e=this.environment.AppUpdateStore;if(Co.Z.getState().online&&e.isSilentUpdate()){const t=e.state.appUpdate;Rc.hC({environment:this.environment,url:ncd.href(),version:t.version})}},this.pollForAppJsUpdates=async()=>{const e="local"===x.Z.env?1e4:6e4;let t="";for(await new Promise((e=>setTimeout(e,5e3)));this.componentIsMounted;){if(void 0===Ac.Z.state.isVisible||!0===Ac.Z.state.isVisible)try{const e=Rc.ac(),o=await Oo.getAssetsJsonV2(this.environment,{hash:t});if("success"===o.type){const i=o.data;if("version"in i){const t=(0,Kl.parseVersion)(i.version);t&&((0,Kl.isEqualVersion)(t,e)||this.handleAppUpdateReady(i))}"hash"in i&&(t=i.hash||"")}}catch(o){}await new Promise((t=>setTimeout(t,e)))}}}didMount(){const{device:e,mobileNative:t}=this.environment;if(e.isElectron?(C.electronUpdateReady.addListener(this.handleElectronUpdateReady),C.electronUpdateError.addListener(this.handleElectronUpdateError),C.electronUpdateChecking.addListener(this.handleElectronUpdateChecking),C.electronUpdateAvailable.addListener(this.handleElectronUpdateAvailable),C.electronUpdateProgress.addListener(this.handleElectronUpdateProgress),C.electronUpdateNotAvailable.addListener(this.handleElectronUpdateNotAvailable),C.appUpdateReady.addListener(this.handleElectronAppUpdateReady),C.appUpdateError.addListener(this.handleElectronAppUpdateError),C.appUpdateChecking.addListener(this.handleAppUpdateChecking),C.appUpdateAvailable.addListener(this.handleElectronAppUpdateAvailable),C.appUpdateInstall.addListener(this.handleElectronAppUpdateInstall),C.appUpdateProgress.addListener(this.handleElectronAppUpdateProgress),C.appUpdateNotAvailable.addListener(this.handleAppUpdateNotAvailable),C.appUpdateReload.addListener(this.handleAppUpdateReload)):t?t.updateReceiveApiHandlers({appUpdateReady:this.handleAppUpdateReady,appUpdateError:this.handleAppUpdateError,appUpdateChecking:this.handleAppUpdateChecking,appUpdateAvailable:this.handleAppUpdateAvailable,appUpdateProgress:this.handleAppUpdateProgress,appUpdateNotAvailable:this.handleAppUpdateNotAvailable}):x.Z.isAdminMode||x.Z.isLocalhost&&!x.Z.offline||this.pollForAppJsUpdates(),this.displayBannerIfSilentUpdate(),/Cordova/.test(navigator.userAgent))this.displayCordovaUpdateWarning();else if(e.isMobileNative&&t&&t.api.openUpdateSettings){const t=e.osVersion;e.isAndroid&&(0,Kl.isLessThanVersion)(t,[7,0])?this.displayPlatformUpdateWarning("Android 7.0"):e.isIOS&&(0,Kl.isLessThanVersion)(t,[15,0])&&this.displayPlatformUpdateWarning("iOS 15.0")}if("production"===x.Z.env){const t=C.getDesktopVersion();e.isElectron&&t&&(e.isMac&&(0,Kl.isLessThanVersion)(t,[2,0,17])||e.isWindows&&(0,Kl.isLessThanVersion)(t,[2,0,16]))&&this.displayElectronUpdaterBrokenWarning()}}willUnmount(){const{device:e}=this.environment;e.isElectron&&(C.electronUpdateReady.removeListener(this.handleElectronUpdateReady),C.electronUpdateError.removeListener(this.handleElectronUpdateError),C.electronUpdateChecking.removeListener(this.handleElectronUpdateChecking),C.electronUpdateAvailable.removeListener(this.handleElectronUpdateAvailable),C.electronUpdateProgress.removeListener(this.handleElectronUpdateProgress),C.electronUpdateNotAvailable.removeListener(this.handleElectronUpdateNotAvailable),C.appUpdateReady.removeListener(this.handleElectronAppUpdateReady),C.appUpdateError.removeListener(this.handleElectronAppUpdateError),C.appUpdateChecking.removeListener(this.handleAppUpdateChecking),C.appUpdateAvailable.removeListener(this.handleElectronAppUpdateAvailable),C.appUpdateProgress.removeListener(this.handleElectronAppUpdateProgress),C.appUpdateNotAvailable.removeListener(this.handleAppUpdateNotAvailable),C.appUpdateReload.removeListener(this.handleAppUpdateReload))}displayMajorUpdateDialog(){pe.showDialog({message:a()(w.FormattedMessage,{defaultMessage:"We just launched new features!",id:"breakingUpdateDialog.title"}),showCancel:!1,keepFocus:!1,handleCancel:this.handleConfirmUpdate,items:[{label:a()(w.FormattedMessage,{defaultMessage:"Update and see what's new",id:"breakingUpdateDialog.updateButtonTitle"}),color:"blue",onAccept:this.handleConfirmUpdate}],innerStyle:{width:380}})}async displayMinorUpdateBanner(){await this.shouldShowMinorUpdateBanner()&&de.Bw({bannerStore:he.Z,id:"AppUpdate",render:()=>a()(Fc,{onClick:this.handleConfirmUpdate}),type:ve.$.Blue})}displayUpdateBanner(e,t){e===Kl.UpdateType.Major?t&&Rc.M0(t)?(Rc.D$(t),this.displayMinorUpdateBanner()):this.displayMajorUpdateDialog():e===Kl.UpdateType.Minor?(t&&Rc.M0(t)&&Rc.D$(t),this.displayMinorUpdateBanner()):t&&Rc.M0(t)&&Rc.D$(t)}displayBannerIfSilentUpdate(){const e=Rc.ac(),t=Rc.uG();if(!(0,Kl.isEqualVersion)(e,t)){const o=(0,Kl.getUpdateType)({currentVersion:e,nextVersion:t,app:"client"});"development"===x.Z.env&&Yi.log({level:"info",from:"AppUpdateListener",type:"displayBannerIfSilentUpdate",data:{miscDataToConvertToString:{currentVersion:e,nextVersion:t,updateType:o}}}),this.displayUpdateBanner(o,t)}}renderDownloadAndReinstallElectron(){return a()("span",{},void 0,a()(w.FormattedMessage,{defaultMessage:"<textlink>Download and reinstall</textlink> your desktop app to get the latest features.",id:"appUpdateListener.reinstallDesktopApp.message",values:{textlink:e=>a()(Ne.Z,{disableHover:!0,href:"https://www.notion.so/desktop",external:!0},void 0,e)}}))}displayElectronUpdaterBrokenWarning(){de.Bw({bannerStore:he.Z,id:"ElectronUpdaterBrokenWarning",render:()=>this.renderDownloadAndReinstallElectron(),type:ve.$.Red})}displayPlatformUpdateWarning(e){const{mobileNative:t}=this.environment;t&&de.Bw({bannerStore:he.Z,id:"PlatformUpdateWarning",render:()=>a()("div",{style:{whiteSpace:"normal",textAlign:"center",flex:"1 auto",margin:"8px 0"}},void 0,a()(w.FormattedMessage,{defaultMessage:" This operating system is no longer supported.{br}Please <upgradelink>upgrade to {supportedPlatformVersion} or later.</upgradelink>.",id:"appUpdateListener.mobilePlatformNotSupported.message",values:{br:a()("br",{}),upgradelink:e=>a()(Ne.Z,{onClick:()=>{t.openUpdateSettings()},disableHover:!0},void 0,e),supportedPlatformVersion:e}})),type:ve.$.Red})}displayCordovaUpdateWarning(){const{device:e}=this.environment,{intl:t}=this.props,o=e.isAndroid?t.formatMessage({defaultMessage:"Android",id:"appUpdateListener.mobileAppNotSupported.android"}):t.formatMessage({defaultMessage:"iOS",id:"appUpdateListener.mobileAppNotSupported.ios"});de.Bw({bannerStore:he.Z,id:"CordovaUpdateWarning",render:()=>a()("div",{style:{whiteSpace:"normal",textAlign:"center",flex:"1 auto",margin:"8px 0"}},void 0,a()(w.FormattedMessage,{defaultMessage:"This application version is no longer supported.{br}Please <upgradelink>upgrade your {androidOrIOSApp} app</upgradelink>.",id:"appUpdateListener.mobileAppNotSupported.message",values:{br:a()("br",{}),upgradelink:t=>a()(Ne.Z,{href:e.isAndroid?y._j.playStore:y._j.appStore,disableHover:!0},void 0,t),androidOrIOSApp:o}})),type:ve.$.Red})}async shouldShowMinorUpdateBanner(){await E.default.waitUntilRendered();const{mainEditorCurrentBlockStore:e,currentUserStore:t}=E.default.state;return!(!t||!e)&&!(0,q.IJ)(this.environment,e)}}Nc.displayName="AppUpdateListener";const Oc=(0,w.injectIntl)(Nc);var Uc=o(32223);function Hc(e){Co.Z.setState({...Co.Z.state,online:e,lastOfflineTimestamp:e?Co.Z.state.lastOfflineTimestamp:Date.now()})}class zc extends l.Z{constructor(){super(...arguments),this.connectionIntervalUpdateRequest=void 0}willMount(){this.connectionIntervalUpdateRequest||(this.connectionIntervalUpdateRequest=window.setInterval((()=>async function(e){if((e.device.isBrowser||e.device.isElectron)&&document.hidden)return;if(Uc.isConnected())return void Hc(!0);if(!1===navigator.onLine&&!x.Z.isLocalhost)return void Hc(!1);"success"===(await Oo.ping(e,{})).type?Hc(!0):Hc(!1)}(this.environment)),5e3))}willUnmount(){window.clearInterval(this.connectionIntervalUpdateRequest),this.connectionIntervalUpdateRequest=void 0}}zc.displayName="ConnectionListener";const Wc=zc;class jc extends l.Z{constructor(){super(...arguments),this.renderModal=()=>{const{message:e,description:t,items:o,showCancel:i}=As.Z.state,r=o.map(((e,t)=>({key:t,render:t=>s.createElement(Ao.Z,n()({isLarge:!0,hovered:t.focused,style:{width:"100%",marginTop:8},isSmall:e.isSmall,isRed:"red"===e.color,isBlue:"blue"===e.color},t),e.label||"Label"),action:()=>{e.onAccept&&(e.onAccept(),pe.dismissDialog())}})));return i&&r.push({key:"cancel",render:e=>s.createElement(Ao.Z,n()({isLarge:!0,hovered:e.focused,style:{width:"100%",marginTop:8}},e),a()(w.FormattedMessage,{id:"genericDialogModal.cancelButton.label",defaultMessage:"Cancel",description:"The Cancel button that appears on a modal that we show a user when they're about to do something that requires confirmation, like permanently deleting a page or disconnecting an account. Clicking this button lets them cancel their action and go back to where they were before, while clicking a different button lets them confirm and complete their action."})),action:()=>{this.handleCancel()}}),a()(Mr.Z,{capture:!0,preventType:si.Z.All},void 0,a()("div",{style:{overflowWrap:"break-word"}},void 0,e&&a()("div",{style:{textAlign:t?"unset":"center"}},void 0,e),t&&a()("div",{style:{color:this.theme.mediumTextColor,paddingTop:12,paddingBottom:6}},void 0,t),a()(so.Z,{type:so.i.Vertical,initialFocus:0,sections:[{key:"dialog",render:e=>s.createElement(lo.Z,n()({topBorder:!1,disableMobileBorders:!0},e)),items:r}]})))},this.handleDismiss=()=>{const{disableBackgroundDismiss:e}=As.Z.state;e||this.handleCancel()},this.handleCancel=()=>{pe.dismissDialog();const{handleCancel:e}=As.Z.state;return e&&e(),!1}}renderComponent(){const{open:e,innerStyle:t,keepFocus:o}=As.Z.state;return a()(Fe.Z,{open:e,keepFocus:o,overlayZIndex:D.Wd,onDismiss:this.handleDismiss,preventHideChildrenWhileOpening:!0,innerStyle:{overflow:"hidden",borderRadius:3,padding:"24px 32px",width:380,fontSize:16,boxShadow:this.theme.largeBoxShadow,background:this.theme.modalBackground,marginLeft:24,marginRight:24,...t},render:this.renderModal})}}jc.displayName="DialogRenderer";const Kc=jc;class Yc extends l.Z{constructor(){super(...arguments),this.handleContainerRef=e=>{this.props.store.containerDomNode.set(e)},this.handleMouseMove=e=>{(0,Vn.ZP)({event:e,context:Vn.Af.SidebarMouseMove,callback:()=>{}})}}renderComponent(){return s.createElement("div",{ref:this.handleContainerRef,className:this.props.isDefault?`${ni.mJW} ${ni.YPt}`:ni.mJW,style:this.getContainerStyle(),onMouseMove:this.handleMouseMove},a()("div",{style:{position:"relative",zIndex:0}}))}getContainerStyle(){return{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:this.props.zIndex,pointerEvents:"none",overflow:"hidden"}}}Yc.displayName="OverlayContainer";const Gc=Yc;var Xc=o(27186);function qc(){const e=(0,V.O7)(),t=(0,N.VK)((()=>({observedWidth:ie.H3.rect.get().width,targetWidth:ie.GZ.get(),isExpanded:ie.gV.get(),resizing:ie.cY.get()})),[]),o=e.currentUser.isLoggedIn(),[i,n]=(0,s.useState)(!1),{isTabsFeatureEnabled:r}=(0,N.Kw)(On.Z);(0,s.useEffect)((()=>{i&&r&&C.windowSidebarState.set({isLoggedIn:o,...t})}),[t,o,i,r]),(0,s.useEffect)((()=>{let e;e=o?t.isExpanded?"expanded":"collapsed":"disabled",C.sidebarState.set(e)}),[t.isExpanded,o]);const a=(0,s.useCallback)(((t,o,i)=>{Be.track(e,o,i)}),[e]);(0,s.useEffect)((()=>(C.track.addListener(a),()=>{C.track.removeListener(a)})),[a]);const l=(0,s.useCallback)(((e,t)=>{n(t)}),[]);(0,s.useEffect)((()=>(C.isActiveTab.get().then((e=>{n(e)})),C.isActiveTab.addListener(l),()=>{C.isActiveTab.removeListener(l)})),[l]);const c=(0,s.useCallback)(((e,t)=>{void 0===t.isShowingTabBar&&(t.isShowingTabBar=t.isTabsFeatureEnabled),On.Z.setState(t)}),[]);(0,s.useEffect)((()=>{var e;return null===(e=C.electronAppFeatures.get())||void 0===e||e.then((e=>{On.Z.setState(e)})),C.electronAppFeatures.addListener(c),()=>{C.electronAppFeatures.removeListener(c)}}),[c]);const d=(0,s.useCallback)((o=>{L.setExpand({environment:e,isExpanded:!t.isExpanded})}),[e,t.isExpanded]);(0,s.useEffect)((()=>(C.sidebarState.addToggleListener(d),()=>{C.sidebarState.removeToggleListener(d)})),[d]);const p=(0,s.useCallback)(((e,t)=>{ie.gV.set(t.isExpanded),ie.GZ.set(t.targetWidth)}),[]);return(0,s.useEffect)((()=>(C.windowSidebarState.addListener(p),()=>{C.windowSidebarState.removeListener(p)})),[p]),null}var $c=o(64496);class Jc extends l.Z{constructor(){super(...arguments),this.experimentIntervalRequest=void 0}willMount(){this.load(),this.experimentIntervalRequest||(this.experimentIntervalRequest=window.setInterval((()=>this.load()),6e5))}willUnmount(){window.clearInterval(this.experimentIntervalRequest),this.experimentIntervalRequest=void 0}load(){(0,$c._3)(this.environment)?dc.Tm(this.environment):dc.Th({environment:this.environment,force:!1})}}Jc.displayName="ExperimentListener";const Qc=Jc;var ed=o(34809);class td extends l.Z{constructor(){super(...arguments),this.refreshFileTokenRequest=void 0}willMount(){this.refresh(),this.refreshFileTokenRequest||(this.refreshFileTokenRequest=window.setInterval((()=>this.refresh()),36e5))}willUnmount(){window.clearInterval(this.refreshFileTokenRequest),this.refreshFileTokenRequest=void 0}refresh(){(0,ed.Z)({url:`${x.Z.secureFileConfig.rootPath}/refresh`,environment:this.environment,method:"GET",format:"text"})}}td.displayName="FileTokenRefresh";const od=td;var id=o(45483);function nd(e){window.__c={n:"InertWhenModalsAreOpen"};const t=(0,N.VK)((()=>"on"===R.default.getEligibleGroup({experimentId:"use_inert_html_attribute"})),[]),o=(0,N.VK)((()=>id.Z.state.openModals.size>0),[]),i={inert:t&&o?"true":null};return s.createElement("div",n()({style:e.style},i),e.children)}var rd=o(62134),ad=o(45023);class sd extends l.Z{constructor(){super(...arguments),this.handleEvent=e=>{rd.Zm(this.environment,e)},this.handleKeyDown=e=>{const{shortcutMap:t}=this.environment.KeyboardShortcutStackStore,o=gt().findKey(t,((t,o)=>(0,ad.Z)(this.environment,e,t)));o&&!{cut:!0,copy:!0,paste:!0}[o]&&rd.dJ(this.environment,e,o)}}willMount(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("cut",this.handleEvent),window.addEventListener("copy",this.handleEvent),window.addEventListener("paste",this.handleEvent),window.addEventListener("keypress",this.handleEvent)}willUnmount(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("cut",this.handleEvent),window.removeEventListener("copy",this.handleEvent),window.removeEventListener("paste",this.handleEvent),window.removeEventListener("keypress",this.handleEvent)}}sd.displayName="KeyboardShortcutStackListener";const ld=sd;var cd=o(31104),dd=o(17294),pd=o(13243);class ud extends l.Z{constructor(){super(...arguments),this.renderModal=()=>{const e=cd.Z.state;if(!e.open)return;const{targetRecordId:t}=e;return a()("div",{style:this.getStyle()},void 0,a()("div",{style:this.getMessageStyle()},void 0,e.message,a()(yi.Z,{style:this.getLoadingSpinnerStyle()})),this.shouldShowProgressBar(t)&&a()(pd.Z,{targetRecordId:t,style:this.getMoveOrDuplicateProgressStyle()}))}}renderComponent(){const e=cd.Z.state;return a()(Fe.Z,{open:e.open,render:this.renderModal,overlayZIndex:D._})}shouldShowProgressBar(e){return void 0!==e&&Boolean(dd.Z.state[e])}getStyle(){return{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minWidth:180,padding:"18px 24px 20px",textAlign:"center",maxWidth:this.environment.device.isMobile?"300px":"100%"}}getMessageStyle(){return{display:"flex",alignItems:"center",fontSize:14,color:this.theme.mediumTextColor}}getLoadingSpinnerStyle(){return{marginLeft:6}}getMoveOrDuplicateProgressStyle(){return{marginTop:10}}}ud.displayName="LoadingStateRenderer";const md=ud;class gd extends l.Z{willMountOrUpdate(){const{device:e,mobileNative:t}=this.environment;e.isElectron&&C.setLogglyData(Yi.clientLogglyEnvironmentData),t&&t.setLogglyData(Yi.clientLogglyEnvironmentData)}}gd.displayName="LogglyDataListener";const hd=gd;var fd=o(1302);class vd extends l.Z{constructor(){super(...arguments),this.handleEstimatedKeyboardWebViewOverlapStoreChange=()=>{fd.default.afterNextFlush((()=>{oi.hQ(this.environment)}))},this.estimatedKeyboardWebViewOverlapStore=this.createComputedStore((()=>{const e=Ee.Z.state;return e.phase===Ee.i.willShow?0:e.estimatedKeyboardWebViewOverlap}))}willMount(){this.environment.device.isMobile&&(gi.default.addListener(this.handleEstimatedKeyboardWebViewOverlapStoreChange),this.estimatedKeyboardWebViewOverlapStore.addListener(this.handleEstimatedKeyboardWebViewOverlapStoreChange))}willUnmount(){this.environment.device.isMobile&&(gi.default.removeListener(this.handleEstimatedKeyboardWebViewOverlapStoreChange),this.estimatedKeyboardWebViewOverlapStore.removeListener(this.handleEstimatedKeyboardWebViewOverlapStoreChange))}}vd.displayName="MobileListener";const yd=vd;var bd=o(27328);const Sd=["compact","regular","unknown"];var wd=o(21980),kd=o(92338),Cd=o(36054),_d=o(74487),Md=o(98958),Td=o(59488),Id=o(80084);function Pd(e){const t=(0,bd.w_)(e);switch(t.type){case"native":return;case"web":const e=t.route;switch(e.name){case"page":return e.collectionViewId?"collection":"page";case"nativeTab":switch(e.tab){case"search":return"search";case"updates":return"updates"}break;default:return}}}var xd=o(12252),Bd=o(64233),Zd=o(475),Ed=o(65686),Rd=o(53610),Ad=o(14786),Dd=o(64157),Fd=o(11689),Ld=o(43339),Vd=o(62820);let Nd;class Od extends l.Z{constructor(){super(...arguments),this.bottomBarVisibility=this.createComputedStore((()=>{const{currentUserStore:e,renderPhase:t}=E.default.state,o=Boolean(null==e?void 0:e.id),{shouldShowError:i}=K.h1(this.environment),n="rendered"===t&&i,r=Mo.default.state.isOnboarding,a=(0,Td.Y)("supportsNativeBottomBarOverlappingWebView")?en.Z.hasOpenMobileSlideUps():en.Z.hasOpenPopups();return!n&&o&&!r&&!a})),this.isOnUpdatesPage=this.createComputedStore((()=>{const e=this.environment.TabbedRouterStore.state;return"updates"===e.activeTab&&0===e.tabs.updates.pages.length})),this.sideBarExpandedStateChangeHandler=()=>{var e;null===(e=this.environment.mobileNative)||void 0===e||e.sidebarVisibility(ie.gV.state&&!(0,ee.YR)(this.environment),(0,ee.qG)(this.environment))},this.bottomBarVisibilityChange=()=>{var e;const t=this.bottomBarVisibility.state;null===(e=this.environment.mobileNative)||void 0===e||e.toggleBottomBar(t)},this.handleExperimentStoreChange=()=>{var e;const t=null===(e=this.environment.mobileNative)||void 0===e?void 0:e.api.updateUsedNonControlExperiments;if(!t)return;t(R.default.getUsedNonControlExperimentsMap())},this.handleStatusBarTap=()=>{this.scrollToTop()},this.scrollToTop=()=>{Ed.Z.getPreventScrollType()===si.Z.None&&(ie.TC.state?ai.Z.SidebarMobileScroller&&ai.Z.SidebarMobileScroller.scrollToTop({animate:!0,animationCallback:gt().identity}):ai.Z.MenuScroller?ai.Z.MenuScroller.scrollToTop({animate:!0,animationCallback:gt().identity}):ai.Z.MenuPageScroller?ai.Z.MenuPageScroller.scrollToTop({animate:!0,animationCallback:gt().identity}):ai.Z.PageScroller&&ai.Z.PageScroller.scrollToTop({animate:!0,animationCallback:gt().identity}))},this.handleSwipeNavigation=()=>{const{mobileNative:e,RouterStore:t}=this.environment;if(e&&e.setWebViewAllowsNavigationGestures){const{route:o}=t.state;"onboarding"===o.name||ie.TC.state||Ed.Z.getPreventScrollType()!==si.Z.None?!1!==Nd&&(Nd=!1,e.setWebViewAllowsNavigationGestures(!1)):!0!==Nd&&(Nd=!0,e.setWebViewAllowsNavigationGestures(!0))}},this.spaceId=void 0,this.userEmail=void 0,this.handleAppChange=()=>{const e=E.default.state.currentSpaceStore;this.spaceId!==(null==e?void 0:e.id)&&this.handleSpaceChange(e,E.default.state.currentSpaceViewStore);const t=E.default.state.currentUserStore;void 0!==(null==t?void 0:t.id)&&this.userEmail===(null==t?void 0:t.getEmail())||this.handleUserChange(t)},this.handleSpaceChange=(e,t)=>{var o;this.spaceId=null==e?void 0:e.id;const{mobileNative:i,TabbedRouterStore:n,currentUser:r}=this.environment;if(null!=i&&null!==(o=i.api)&&void 0!==o&&o.setCurrentSpaceInfo&&i.api.setCurrentSpaceInfo({spaceId:null==e?void 0:e.id,spaceViewId:null==t?void 0:t.id,userId:r.id,editable:(null==e?void 0:e.canEdit())??!0}),(0,ol.__)(this.environment)){const e=e=>{if("web"!==e.type)return;const t={...e.queryParams},o=this.spaceId&&(0,Fr.cj)(this.spaceId);t.spaceId=o,e.queryParams=t,e.route.spaceId=o},t=gt().cloneDeep(n.state);e(t.tabs.search.rootPage),e(t.tabs.updates.rootPage),e(t.tabs.addPage.rootPage),this.clearTabbedRouterStoreState(t),n.setState(t)}this.getLocalSearchCache(this.environment)},this.handleUserChange=e=>{var t,o;this.userEmail=null==e?void 0:e.getEmail(),null!==(t=this.environment.mobileNative)&&void 0!==t&&null!==(o=t.api)&&void 0!==o&&o.setCurrentUserInfo&&this.environment.mobileNative.api.setCurrentUserInfo({userId:null==e?void 0:e.id,loggedInUserIds:this.environment.currentUser.loggedInUserIds});const i=!(0,ol.__)(this.environment)||void 0===this.environment.currentUser.id,{TabbedRouterStore:n}=this.environment,r=gt().cloneDeep(n.state);this.clearTabbedRouterStoreState(r,i),n.setState(r)},this.handleKeyboardAutoScroll=()=>{Ee.Z.state.phase===Ee.i.willShow&&fd.default.afterNextFlush((()=>oi.hQ(this.environment)))},this.handleMobileNativeKeyboardStore=()=>{if(Ee.Z.state.phase===Ee.i.hidden){if(Bd.Z.state.open)return;const{NativeMobileActionBarStore:e,device:t}=this.environment;if(e&&null!==e.state.menuType&&t.isAndroid)return;jn.ZH(this.environment)}},this.setCurrentUserId=async e=>{this.environment.currentUser.id!==e&&await T.x({environment:this.environment,newCurrentUserId:e})},this.setCurrentSpace=async(e,t)=>{const o=pa.Z.getSpaceViewStores(this.environment,e).find((e=>e.getSpaceId()===t)),i=await T.x({environment:this.environment,newCurrentUserId:e}),{currentUserRootStore:n,currentUserSettingsStore:r}=E.default.state;n&&r&&o&&Ie.y3({environment:i,spaceViewStore:o,userSettingsStore:r,userRootStore:n})},this.openSearch=()=>{(0,Td.Y)("supportsNativeHome")&&this.environment.device.isPhone?(M.clearHistoryState({RouterStore:this.environment.RouterStore,currentUserId:this.environment.currentUser.id}),qr.UT({environment:this.environment,analyticsFrom:"mobile-bottom-bar",renderAsPage:!0})):qr.UT({environment:this.environment,analyticsFrom:"mobile-bottom-bar"}),k.trackTapMobileBottomBarItem(this.environment,{itemName:"search",logging_source:"mobile_native"})},this.openAllUpdates=()=>{(0,Td.Y)("supportsNativeHome")&&this.environment.device.isPhone?(M.clearHistoryState({RouterStore:this.environment.RouterStore,currentUserId:this.environment.currentUser.id}),M.navigate({environment:this.environment,url:`${y.VP.nativeTab}/updates`,redirect:!0})):Vd.Z.setState({...Vd.Z.state,open:!0})},this.openMembersSettings=()=>{Rd.Z.setState({...Rd.Z.state,open:!0})},this.openHelp=()=>{Zd.Z.setState({...Zd.Z.state,open:!0})},this.openSupportMessages=()=>{I.j({environment:this.environment,from:"help_button"})},this.openMoveTo=e=>{const t=new A.G(this.environment,{table:oo.iU,id:e});Li.bA({environment:this.environment,blocks:[t],moveToContext:"home_tab",onAccept:e=>{M.navigateToPage({store:t,environment:this.environment})}})},this.createOrJoinWorkspace=async()=>{await yo.xN(this.environment)},this.openSettings=()=>{Ad.Z.setState({open:!0,source:Ad.Y.Home})},this.openTrash=e=>{Fd.Z.setState({open:!0});const{query:t}=e;t&&Ld.Z.setState({...Ld.Z.state,currentTab:"all_pages",filter:t,limit:Ld.Z.startLimit})},this.openAddAccount=()=>{Dd.C.setState({...Dd.C.state,open:!0})},this.openAddPage=()=>{(0,Td.Y)("supportsNativeHome")&&this.environment.device.isPhone?(M.clearHistoryState({RouterStore:this.environment.RouterStore,currentUserId:this.environment.currentUser.id}),L.quickAddPage({environment:this.environment,from:"mobile_bottom_bar",redirect:!0,quickAddParentOverride:{type:"space-private-pages"}})):L.quickAddPage({environment:this.environment,from:"mobile_bottom_bar"}),k.trackTapMobileBottomBarItem(this.environment,{itemName:"add_page"})},this.handleTabbedRouterStoreChange=()=>{var e;const{mobileNative:t,TabbedRouterStore:o}=this.environment,i=null==t||null===(e=t.api)||void 0===e?void 0:e.handleTabbedRouterStateUpdate;if(i){const e=o.state;i({state:e,topPage:(0,bd.w_)(e),webTransitionType:Pd(e),updateId:(0,Fr.ZP)()});const t=o.getPreviousState();if(!t)return;const n=(0,bd.F9)(t),r=(0,bd.F9)(e);gt().isEqual(n,r)||k.trackMobileNavigation(this.environment,{origin:n,destination:r,from:e.navigationSource,action:e.navigationAction,logging_source:"mobile_native"})}},this.getLocalSearchCache=gt().memoize((e=>Vs.tw(e)),(e=>{var t;return`${e.currentUser.id}-${(null===(t=E.default.state.currentSpaceViewStore)||void 0===t?void 0:t.id)??"none"}`})),this.clearTabbedRouterStoreState=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e.tabs).forEach((o=>{const i=o;t&&(e.tabs[i].nativeRootPageOverrideEnabled=void 0),e.tabs[i].pages="home"!==i?[]:e.tabs[i].pages.splice(0,1)}))}}willMount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:o,device:i}=this.environment;var n;i.isMobileNative&&e&&(this.handleAppChange(),E.default.addListener(this.handleAppChange),ie.TC.addListener(this.handleSwipeNavigation),ie.gV.addListener(this.sideBarExpandedStateChangeHandler),yc.Z.addListener(this.handleSwipeNavigation),t.addListener(this.handleSwipeNavigation),Ee.Z.addListener(this.handleKeyboardAutoScroll),this.bottomBarVisibility.addListener(this.bottomBarVisibilityChange),this.environment.WindowSizeStore.addListener(this.sideBarExpandedStateChangeHandler),this.handleExperimentStoreChange(),R.default.addListener(this.handleExperimentStoreChange),o.addListener(this.handleTabbedRouterStoreChange),e.updateReceiveApiHandlers({statusBarTap:this.handleStatusBarTap,backButtonPress:()=>rd.Zm(this.environment,{type:"backbutton"}),keyboardWillShow:e=>{Ee.Z.updateKeyboardPhase(this.environment,Ee.i.willShow,e??0)},keyboardDidShow:e=>Ee.Z.updateKeyboardPhase(this.environment,Ee.i.shown,e??0),keyboardWillHide:()=>{var e;(Ee.Z.updateKeyboardPhase(this.environment,Ee.i.willHide,0),(0,Td.Y)("supportsIpadOS16Keyboard"))||i.isIpad&&(qe.ZH(this.environment),null===(e=this.environment.NativeMobileActionBarStore)||void 0===e||e.clear(!0))},keyboardDidHide:()=>{var e;(Ee.Z.updateKeyboardPhase(this.environment,Ee.i.hidden,0),(0,Td.Y)("supportsIpadOS16Keyboard"))&&(i.isIpad&&(qe.ZH(this.environment),null===(e=this.environment.NativeMobileActionBarStore)||void 0===e||e.clear(!0)))},keyboardShortcut:e=>rd.Zm(this.environment,e),pushNotificationTokenRefresh:e=>Md.handleTokenRefresh(this.environment,e,"refresh"),resume:xd.Z.resume,pause:xd.Z.pause,refreshSubscriptionData:async e=>{await Oo.invalidateSubscriptionData(this.environment,{spaceId:e,provider:"revenue_cat"}),await Za.bi(this.environment)},refreshSubscriptionDataV2:async()=>{await Za.bi(this.environment)},processMobileActionBarAction:t=>{const{componentId:o,action:i}=t;e.componentEvents.dispatch("MobileActionBar",o,"onAction",{action:i})},updateExperimentData:async e=>{if((0,$c._3)(this.environment)){const t=await(0,ge.getExperimentDeviceId)(this.environment),o=this.environment.currentUser.id,i=(0,$c.fP)(t,o,e);i&&R.default.updateState(i,this.environment)}},trackExperimentExposure:async e=>{await k.trackExperimentExposure({environment:this.environment,experiment_id:e.experimentId,experiment_version:e.experimentVersion,experiment_group:e.group||"ineligible",logging_source:"mobile_native"})},receiveRawMessageStoreMessage:e=>{Uc.onMobileNativeReceiveRawMessageStoreMessage(e,this.environment)},updateMessageStoreState:e=>{Uc.onMobileNativeUpdateMessageStoreState(e,this.environment)},logout:e=>{me.logoutSingleAccount({environment:this.environment,userId:e})},logoutAll:()=>{me.logout(this.environment)},openDestinationV2:e=>{switch(en.Z.closeAll(),(0,ol.__)(this.environment)&&M.navigateToTab({environment:this.environment,tab:o.state.activeTab,nativeRootPageOverrideEnabled:!1}),e.type){case"moveTo":this.openMoveTo(e.blockId);break;case"outlinerViewAllTeam":M.clearHistoryState({RouterStore:this.environment.RouterStore,currentUserId:this.environment.currentUser.id}),M.navigate({environment:this.environment,url:(0,wd.W)({route:{name:"nativeTab",tab:"teamOutlinerViewAll",spaceId:this.spaceId,teamId:e.teamId}}),redirect:!0});break;case"trash":this.openTrash({query:e.query})}},openDestination:e=>{en.Z.closeAll();switch("closePopup"!==e&&(0,ol.__)(this.environment)&&M.navigateToTab({environment:this.environment,tab:o.state.activeTab,nativeRootPageOverrideEnabled:!1}),e){case"search":this.openSearch();break;case"addPage":this.openAddPage();break;case"allUpdates":this.openAllUpdates();break;case"addAccount":this.openAddAccount();break;case"createOrJoinWorkspace":return this.createOrJoinWorkspace();case"notificationAndSettings":this.openSettings();break;case"trash":this.openTrash({});break;case"memberSettings":this.openMembersSettings();break;case"help":this.openHelp();break;case"intercom_messages":this.openSupportMessages()}},setCurrentUserId:async e=>{await this.setCurrentUserId(e)},setCurrentSpace:async e=>{await this.setCurrentSpace(e.userId,e.spaceId)},updateHorizontalSizeClass:t=>{const o=(0,Cd.Gu)(_d.literals(...Sd),t)?"unknown":t;o!==e.horizontalSizeClass.state&&e.horizontalSizeClass.setState(o)},updateTabbedRouterState:e=>{var t;const{TabbedRouterStore:o}=this.environment,i=o.state;e.tab!==i.activeTab||null!==(t=e.pages)&&void 0!==t&&t.length||i.tabs[i.activeTab].pages.length?M.navigateToTab({environment:this.environment,tab:e.tab,queryParams:e.queryParams,pages:e.pages,nativeRootPageOverrideEnabled:e.nativeRootPageOverrideEnabled,navigationAction:e.navigationAction,navigationSource:e.navigationSource}):this.scrollToTop();const n=o.state;return[{state:n,topPage:(0,bd.w_)(n),webTransitionType:Pd(n),updateId:e.updateId??(0,Fr.ZP)()}]},getLocalSearchResults:async e=>{const t=await this.getLocalSearchCache(this.environment);if(!t)return[{error:"Local cache does not exist"}];const o=(0,Cd.Gu)(kd.GA,e.sort);if(o)return[{error:`old sort type is unsupported! ${o}`}];const i=e.sort,n=Id.iA({query:{query:{text:e.query??"",filters:e.filters,sort:i},limit:e.limit},localCachedPages:t,includeRecordMap:!1,userId:this.environment.currentUser.id}),r=[{value:{total:0,results:[],recordMap:{},trackEventProperties:{}}}];if(!n||0===n.results.length)return r;const a=Co.Z.state.online?Id.g8(this.environment,n.results):n.results;return[{value:{results:a,total:a.length,recordMap:{},trackEventProperties:{}}}]}}),i.isAndroid&&Ee.Z.addListener(this.handleMobileNativeKeyboardStore),null!==(n=this.environment.mobileNative)&&void 0!==n&&n.api.ready&&this.environment.mobileNative.api.ready(),this.sideBarExpandedStateChangeHandler())}willUnmount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:o,device:i}=this.environment;i.isMobileNative&&e&&(E.default.removeListener(this.handleAppChange),ie.TC.removeListener(this.handleSwipeNavigation),ie.gV.removeListener(this.sideBarExpandedStateChangeHandler),yc.Z.removeListener(this.handleSwipeNavigation),t.removeListener(this.handleSwipeNavigation),Ee.Z.removeListener(this.handleKeyboardAutoScroll),this.bottomBarVisibility.removeListener(this.bottomBarVisibilityChange),R.default.removeListener(this.handleExperimentStoreChange),o.removeListener(this.handleTabbedRouterStoreChange),i.isAndroid&&Ee.Z.removeListener(this.handleMobileNativeKeyboardStore))}}Od.displayName="MobileNativeListener";const Ud=Od;var Hd=o(89733);class zd extends l.Z{willMount(){this.environment.device.isMobile&&document.addEventListener("scroll",this.handleScroll,!0)}willUnmount(){this.environment.device.isMobile&&document.removeEventListener("scroll",this.handleScroll,!0)}handleScroll(){for(const e of Hd.U4)e.resetIfInteracted()}}zd.displayName="MobileScrollListener";const Wd=zd;class jd extends l.Z{constructor(){super(...arguments),this.updatePageVisibility=()=>{Ac.Z.setState({...Ac.Z.state,isVisible:!document.hidden});const e=Rc.W$(),t=e&&(Date.now()-e)/U.A0>=7;if(this.environment.device.isBrowser&&!document.hidden&&(!e||t)&&Co.Z.getState().online){const e=this.environment.AppUpdateStore;if(e.isSilentUpdate()){const t=e.state.appUpdate;Rc.hC({environment:this.environment,url:ncd.href(),version:t.version})}}}}didMount(){document.addEventListener("visibilitychange",this.updatePageVisibility),this.updatePageVisibility()}willUnmount(){document.removeEventListener("visibilitychange",this.updatePageVisibility)}}jd.displayName="PageVisibilityListener";const Kd=jd;var Yd=o(18466);new Set(["destinations","amplitudeOptions","datadogOptions","snowflakeOptions","statsigOptions"]),_d.literals("connected_apps_settings","external_object_instance_block","external_object_instance_inline_popup","external_object_instance_block_error_dropdown","placeholder_root_external_collection_view_block","connected_relation_property_menu","source_picker_connect_another_account","integration_gallery","collection_settings_property_type","integration_file_picker","send_to_notion","unfurl","messages_tab","install_redirect","all_updates","notifications_and_settings","collection_view_settings","share_menu");var Gd=o(77897);function Xd(){switch(x.Z.env){case"local":case"development":case"staging":return 100;case"production":return 1}}function qd(e){let{id:t,targetRenderPhase:o="all",samplePercent:i=Xd(),children:n}=e;window.__c={n:"PerformanceProfiler"};const r=(0,V.O7)(),l=(0,s.useCallback)(((e,t,n,a,s,l)=>{(0,Gd.lB)(i)&&("all"!==o&&t!==o||k.trackPerformanceMetric(r,{type:`render_duration.${e}`,dateMeasurement:n,performanceMeasurement:n,data:{render_phase:t}}))}),[r,o,i]),[c]=(0,s.useState)(Yd.Z.withListenerIgnored((()=>R.default.checkGate("client-performance-profiler"))));return c?a()(s.Profiler,{id:t,onRender:l},void 0,n):s.createElement(s.Fragment,null,n)}var $d=o(59238);const Jd=()=>{const e=(0,V.O7)(),t=(0,s.useRef)("none"),o=(0,s.useCallback)((e=>{const o=t.current;e!==o&&(t.current=e,"dragging"===e?$d.Z.setState({isDragging:!0}):"dragging"===o&&$d.Z.setState({isDragging:!1}))}),[]),i=(0,s.useCallback)((()=>{"none"===t.current&&o("touching")}),[o]),n=(0,s.useCallback)((()=>{o("none")}),[o]),r=(0,s.useCallback)((()=>{"touching"===t.current&&hn.isExpanded(hn.get())&&o("dragging")}),[o]);return(0,s.useEffect)((()=>{if(e.device.isIOS)return window.addEventListener("touchstart",i),window.addEventListener("touchend",n),window.addEventListener("touchcancel",n),document.addEventListener("selectionchange",r),()=>{window.removeEventListener("touchstart",i),window.removeEventListener("touchend",n),window.removeEventListener("touchcancel",n),document.removeEventListener("selectionchange",r)}}),[e.device.isIOS,i,n,r]),null},Qd=()=>{window.__c={n:"SelectionListener"};const e=(0,V.O7)(),t=(0,s.useCallback)((()=>{fd.default.afterNextFlush((()=>{jn.ls()}))}),[]),o=(0,s.useCallback)((()=>{setTimeout((()=>{hn.get()||jn.ZH(e)}),0)}),[e]);return(0,s.useEffect)((()=>(window.addEventListener("mousedown",t),e.device.isMobileBrowser&&document.addEventListener("focusout",o),()=>{window.removeEventListener("mousedown",t),document.removeEventListener("focusout",o)})),[e,t,o]),a()(Jd,{})};class ep extends l.Z{constructor(e){super(e),this.mediaQueryList=window.matchMedia("(prefers-color-scheme: dark)"),this.initialSet=new ct.default(!1),this.handleThemeChange=this.handleThemeChange.bind(this)}willMount(){this.setTheme();const{mobileNative:e,device:t}=this.environment;t.isAndroid&&e?e.updateReceiveApiHandlers({themeChanged:e=>this.setTheme()}):this.mediaQueryList.addEventListener?this.mediaQueryList.addEventListener("change",this.handleThemeChange):this.mediaQueryList.addListener&&this.mediaQueryList.addListener(this.handleThemeChange)}willUnmount(){this.mediaQueryList.removeEventListener?this.mediaQueryList.removeEventListener("change",this.handleThemeChange):this.mediaQueryList.removeListener&&this.mediaQueryList.removeListener(this.handleThemeChange)}willUpdate(){var e;!this.initialSet.get()&&null!==(e=E.default.state.mainEditorCurrentBlockStore)&&void 0!==e&&e.isReady()&&(this.setTheme(),this.initialSet.set(!0))}handleThemeChange(e){this.setTheme()}setTheme(){"system"===pc.MH(this.environment)&&uc.Z.emit()}}ep.displayName="SystemThemeListener";const tp=ep;var op=o(8713),ip=o(77505);class np extends l.Z{constructor(){super(...arguments),this.multiSelectionStartStore=void 0,this.multiSelectionEndStore=void 0,this.handleTextSelectionChange=()=>{const e=gi.default.state,t="empty"===e.mode?void 0:e.multiSelection.start.store,o="empty"===e.mode?void 0:e.multiSelection.end.store;if(this.multiSelectionStartStore===t&&this.multiSelectionEndStore===o)return;if(this.multiSelectionStartStore=t,this.multiSelectionEndStore=o,this.multiSelectionStartStore!==this.multiSelectionEndStore)return;const i=ip.UQ();if(!i)return;const{rowIndex:n,columnIndex:r,simpleTableStore:a}=i.props;op.n5({environment:this.environment,rowIndex:n,columnIndex:r,simpleTableStore:a})}}willMount(){gi.default.addListener(this.handleTextSelectionChange)}willUnmount(){gi.default.removeListener(this.handleTextSelectionChange),this.multiSelectionStartStore=void 0,this.multiSelectionEndStore=void 0}}np.displayName="TextAndSimpleTableSelectionSyncer";const rp=np;class ap extends l.Z{constructor(){super(...arguments),this.updateConnectionStateWithEnvironment=()=>Pe.updateConnectionState(this.environment)}willMount(){Co.Z.addListener(this.updateConnectionStateWithEnvironment),Pe.updateConnectionState(this.environment)}willUnmount(){Co.Z.removeListener(this.updateConnectionStateWithEnvironment)}}ap.displayName="TransactionListener";const sp=ap;function lp(){const e=x.Z.isLocalhost||"local"===x.Z.env;return(0,s.useEffect)((()=>{function t(t){if(!e)return;if(!t.data||"string"!=typeof t.data.type)return;const o=t.data.type;"webpackInvalid"===o?ga.oV({label:a()("div",{},void 0,a()("span",{style:{paddingRight:10}},void 0,"Webpack Compiling"),a()("img",{src:"/images/favicon-local.ico",className:"loading-spinner",style:{display:"inline-block"}})),position:"top",durationMs:"keep"}):"webpackOk"!==o&&"webpackWarnings"!==o||ga.rN()}return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}}),[e]),null}class cp extends l.Z{willMount(){const{device:e,mobileNative:t}=this.environment;if(cc.mc(this.environment),dc.Yh(this.environment),t&&t.hideSplashscreen(),/Cordova/.test(navigator.userAgent)){const e=window;e.navigator.splashscreen&&e.navigator.splashscreen.hide()}if(e.isMobile){const e=document.body.parentElement;e&&e.classList.add(ni.aiP)}Be.initializeAnalyticsSettings(this.environment),p.rQ(e,x.Z),e.isElectronMac&&C.getAppPath().then((e=>{e&&(e.startsWith("/Volumes/Notion Installer")||e.startsWith("/Volumes/Notion Dev Installer")||e.startsWith("/Volumes/Notion Stg Installer"))&&pe.showMessage({message:this.props.intl.formatMessage({defaultMessage:"Please move the Notion.app into the /Applications folder for the auto-updater to work.",id:"notionAppContainer.dialog.notionAppNotInApplications.message"})})}))}didMount(){const{device:e,mobileNative:t}=this.environment;"external"===(0,v.Wj)({url:ncd.href(),isMobile:e.isMobile,baseUrl:x.Z.domainBaseUrl,publicDomainName:x.Z.publicDomainName,protocol:x.Z.protocol,currentUrl:ncd.href()}).name&&pe.showDialog({message:"Mismatch between origin and baseUrl (dev).",showCancel:!1,keepFocus:!1,items:[{label:a()(w.FormattedMessage,{defaultMessage:"Okay",id:"notionAppContainer.dialog.mismatchedOriginURL.okayButton.label"}),onAccept:()=>{const e=Nt.O_({relativeUrl:Nt.T1(ncd.href()),baseUrl:x.Z.domainBaseUrl}),t=Nt.Qc(e);t.protocol=Nt.Qc(ncd.href()).protocol,window.location.href=Nt.WU(t)}}]}),null==t||t.markTransitionReady({type:"mount"})}renderComponent(){const e="light"===this.theme.mode?ni.MsS:ni.Xj_;return a()(qd,{id:"app",targetRenderPhase:"mount"},void 0,a()("div",{style:this.getStyle(),className:["notion-app-inner",e].join(" ")},void 0,a()(lp,{}),a()(Oc,{},"AppUpdateListener"),a()(hd,{},"ElectronLogglyDataListener"),a()(nd,{style:{height:"100%"}},void 0,this.props.children),a()(Gc,{store:yc.Z,zIndex:D.mJ,isDefault:!0}),a()(Gc,{store:bc.Z,zIndex:D.O7,isDefault:!1}),a()(Kc,{}),a()(md,{}),a()(Zc,{}),a()(Pc,{}),a()(sp,{}),a()(Qd,{}),a()(ld,{}),a()(Ud,{}),this.environment.device.isElectron&&a()(qc,{}),a()(vc,{}),a()(yd,{}),a()(Xc._g,{}),a()(mc,{}),a()(tp,{}),a()(Wd,{}),a()(Mc,{}),a()(od,{}),a()(Qc,{}),a()(Wc,{}),a()(Kd,{}),a()(rp,{}),a()(fc,{}),a()(Z.LazyInjectThirdPartyScripts,{})))}getStyle(){return{...(0,u.N7)(c.SP),color:this.theme.regularTextColor,WebkitFontSmoothing:"auto",backgroundColor:this.theme.contentBackground}}}cp.displayName="Notion";const dp=(0,w.injectIntl)(cp);var pp=o(29477);class up extends l.Z{renderComponent(){return"Iphone"===this.props.format?this.renderIphone():"IphoneX"===this.props.format?this.renderIphoneX():this.renderAndroid()}renderIphone(){return a()("div",{style:{boxShadow:`0 12px 30px ${m.ZP.blackWithAlpha(.25)}`,background:m.ZP.frontMobilePhoneBackground,overflow:"hidden",position:"relative",width:"100%",borderRadius:"15%/7%",...this.props.style}},void 0,a()("div",{style:{width:"100%",height:0,paddingBottom:"202.5%",backgroundImage:`url(${Et.Z.images.chromeMobileIphonePng})`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"}}),a()("div",{style:{position:"absolute",top:0,left:"6.66667%",width:"86.66666667%",marginTop:"24%"}},void 0,this.props.children))}renderIphoneX(){return a()("div",{style:{position:"relative",transform:"translateZ(0)",width:"100%",filter:"drop-shadow(rgba(15, 15, 15, 0.2) 0px 6px 12px)",...this.props.style}},void 0,a()("img",{src:Et.Z.images.devices.iphoneXFramePng,style:{width:"100%",display:"block",position:"relative",zIndex:2}}),a()("div",{style:{position:"absolute",top:"50%",left:"50%",background:m.ZP.white,transform:"translate(-50%, -50%)",width:"84.5%",height:"95%"}},void 0,this.props.children))}renderAndroid(){return a()("div",{style:{boxShadow:`0 12px 30px ${m.ZP.blackWithAlpha(.25)}`,background:m.ZP.frontMobilePhoneBackground,overflow:"hidden",position:"relative",width:"100%",borderRadius:"15%/7%",...this.props.style}},void 0,a()("div",{style:{width:"100%",height:0,paddingBottom:"205.73012939%",backgroundImage:`url(${Et.Z.images.chromeMobileAndroidPng})`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"}}),a()("div",{style:{position:"absolute",top:0,left:"4.1589648799%",width:"91.5785582255%",marginTop:"20.60998152%"}},void 0,this.props.children))}}up.displayName="FrontMobileChrome";const mp=up;var gp=o(38294),hp=o(85248);const fp=function(e){window.__c={n:"OnboardingProgressBar"};const[t,o]=(0,s.useState)(void 0!==e.startPercentage?e.startPercentage:e.endPercentage);(0,s.useEffect)((()=>{o(e.endPercentage)}),[e.endPercentage]);const i=(0,Ce.yK)((e=>({filledColor:{background:e.blueButtonBackground}})),[]);return a()(hp.k,{percentage:t,height:2,filledColor:i.filledColor.background,filledBarStyle:{transition:"width 0.3s ease-out"}})},vp=new er.Z;const yp=new(o(8297).Z),bp={profile:ni.Xgx,company_survey:ni.iTw,persona_survey:ni.wnm,workspace_choose:ni.gec,workspace_plan_choose:ni.x2W,workspace_create:ni.Qgj,invite:ni.Wy1,desktop_app_download:ni.MV2,error:ni.Uhm};class Sp extends l.Z{constructor(){super(...arguments),this.handleCloseClick=()=>{yo.VW(this.environment)}}renderComponent(){var e;const t=Mo.default.state;if(!t.isOnboarding)return;const o=bp[t.stage],i="on"===(null===(e=t.onboardingExperiments)||void 0===e?void 0:e.onboarding_creator_no_joinable_spaces)?this.theme.onboardingBackground_exp01:this.theme.onboardingBackground;return a()("div",{},void 0,a()(Si.Z,{className:o,style:this.getScrollerStyle(i),type:si.Z.Y,preventType:oi.Q7(this.environment),store:vp},void 0,a()(Zi.Z,{banners:yp.state.banners,isMobile:this.environment.device.isMobile,isInPeekRenderer:!1}),this.renderDesktopIllustration(),a()("div",{style:Sp.getVerticalCenteringWrapStyle(Boolean(this.props.disableAutoHeight))},void 0,this.renderHeader(),a()("div",{style:{...this.props.useInlineStyle?{}:Sp.wrapStyle}},void 0,this.props.children),this.renderFooter()),this.shouldRenderCloseButton(t)&&this.renderCloseButton(),this.props.useScrollMask&&this.renderScrollMask(i)))}renderHeader(){const{title:e,subtitle:t}=this.props;return a()("div",{style:this.getHeaderStyle()},void 0,a()("div",{},void 0,a()("div",{style:this.getTitleStyle()},void 0,e),t&&a()("div",{style:this.getSubtitleStyle()},void 0,t)))}renderFooter(){const{footer:e}=this.props;if(e)return a()("div",{style:this.getFooterStyle()},void 0,a()("div",{style:this.getSubtitleStyle()},void 0,e))}renderDesktopIllustration(){const{illustrationUrl:e}=this.props;if(e)return a()("div",{style:Sp.illustrationWrapStyle},void 0,a()("img",{src:e,style:{height:190}}))}renderCloseButton(){return a()(Le.Z,{isLarge:!0,style:this.getCloseButtonStyle(),onClick:this.handleCloseClick},void 0,a()(w.FormattedMessage,{defaultMessage:"Cancel",id:"useCaseOnboardingStep.cancelButton.label"}))}renderScrollMask(e){return a()("div",{style:this.getScrollMaskStyle(e)})}shouldRenderCloseButton(e){return ko.jF(e)}getScrollerStyle(e){return{height:"100vh",background:e}}getScrollMaskStyle(e){return{position:"absolute",background:`linear-gradient(180deg, ${this.theme.onboardingBackgroundMask} 0%, ${e} 80%)`,bottom:0,left:0,right:0,height:"12vh",pointerEvents:"none",zIndex:9}}static getVerticalCenteringWrapStyle(e){return{display:"flex",flexDirection:"column",justifyContent:"center",...e?{}:{minHeight:"100vh"}}}getHeaderStyle(){return{position:"relative",textAlign:"center",paddingTop:42,paddingBottom:32,marginLeft:"auto",marginRight:"auto",maxWidth:520,...this.props.headerStyles?this.props.headerStyles:{}}}getFooterStyle(){return{position:"relative",textAlign:"center",paddingBottom:42,marginLeft:"auto",marginRight:"auto",maxWidth:520,...this.props.headerStyles?this.props.headerStyles:{}}}getTitleStyle(){return{fontWeight:fo.Z.fontWeight.semibold,fontSize:28,color:this.theme.regularTextColor,fontFamily:fo.Z.getHeaderFontFamily({locale:c.SP})}}getSubtitleStyle(){return{fontSize:18,lineHeight:1.3,paddingTop:2,color:this.theme.mediumTextColor,fontWeight:fo.Z.fontWeight.regular,...this.props.subtitleStyles?this.props.subtitleStyles:{}}}getCloseButtonStyle(){return{position:"absolute",top:18,right:18,fontSize:14}}}Sp.displayName="OnboardingStep",Sp.wrapStyle={display:"flex",flexDirection:"column",paddingBottom:32,alignItems:"center"},Sp.illustrationWrapStyle={position:"fixed",bottom:0,left:30};const wp=Sp;const kp=function(e){window.__c={n:"OnboardingCompanySurvey"};const[t,o]=(0,s.useState)({companyName:e.onboardingState.spaceName||"",companySize:e.onboardingState.companySize||void 0}),[i,n]=(0,s.useState)({companyName:void 0,companySize:void 0}),[r,l]=(0,s.useState)(void 0),[c,d]=(0,s.useState)(0);(0,s.useEffect)((()=>{d(1)}),[]);const p=(0,Ce.yK)((e=>({leftPanel:{width:"100%",background:e.onboardingBackground_exp01,display:"flex",justifyContent:"center"},choiceSection:{minWidth:260,maxWidth:370,marginLeft:"10%",marginRight:"10%",marginTop:"14vh"},errorFormInputStyle:{boxShadow:e.outlineRedInputBoxShadow},formLabelStyle:{color:e.mediumTextColor,fontSize:14,lineHeight:"16px",marginBottom:12},formInputStyle:{display:"flex",alignItems:"center",width:"100%",fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,position:"relative",borderRadius:4,boxShadow:e.inputBoxShadow,cursor:"text",backgroundColor:e.whiteButtonBackground,height:31,transition:"box-shadow 0.3s ease-out"},backButtonStyle:{width:"100%",justifyContent:"center",color:e.lightTextColor,marginTop:8,height:32}})),[]);function u(e){const{field:t,error:o}=e;if(void 0===o)n({...i,[t]:void 0});else{const e=Object.keys(i).reduce(((e,t)=>(e[t]=void 0,e)),{});n({...e,[t]:o})}}async function m(){const o=Object.keys(i).find((e=>void 0!==i[e]));if("companyName"!==o&&"companySize"!==o){if(!(!g()&&(u({field:"companyName",error:a()(w.FormattedMessage,{defaultMessage:"Please fill out the name of your company.",id:"onboardingCompanySurveyStage.companyNameUndefinedError.message",description:"Error message to let users know they need to fill out the company name field."})}),l("companyName"),1)||!t.companySize&&(u({field:"companySize",error:a()(w.FormattedMessage,{defaultMessage:"Please fill out the size of your company.",id:"onboardingCompanySurveyStage.companySizeUndefinedError.message",description:"Error message to let users know they need to fill out the company size field."})}),l("companySize"),1))){const o={...e.onboardingState,spaceName:t.companyName,companySize:t.companySize};k.trackOnboardingCompanySurveyAction(e.environment,{...ko.iF(e.onboardingState),selection:{companySize:t.companySize},action:"submit",plan_selection:e.onboardingState.planSelection}),await yo.lp(e.environment,{...o,back:!1,skip:!1,previousStage:"company_survey"})}}else l(o)}function g(){const e=t.companyName.trim();return o({...t,companyName:e}),e}(0,s.useEffect)((()=>{if(r){const e=setTimeout((()=>{l(void 0)}),100);return()=>clearTimeout(e)}}),[r]);const h="back"in e.onboardingState&&e.onboardingState.back;return a()("div",{style:p.leftPanel},void 0,a()("div",{style:p.choiceSection},void 0,a()(fp,{startPercentage:h?75:25,endPercentage:50}),a()("div",{style:{opacity:c,transition:"opacity 0.75s ease-in-out"}},void 0,a()(wp,{title:a()("div",{style:{lineHeight:"123%",textAlign:"left"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Notion is great for work. Tell us about your work",id:"onboardingCompanySurveyStage.step.title",description:"Title text for the Company Survey stage to ask users to answer questions about their company."})),subtitle:a()("div",{style:{lineHeight:"123%",textAlign:"left"}},void 0,a()(w.FormattedMessage,{defaultMessage:"We'll personalize your workspace based on your answers",id:"onboardingCompanySurveyStage.step.subtitle",description:"Subtitle text to let user know we'll use their answers."})),useInlineStyle:!0,disableAutoHeight:!0,subtitleStyles:{paddingTop:8}},"onboarding_company_survey",a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity,onEnter:m},void 0,a()("div",{style:{paddingLeft:2,paddingRight:2}},void 0,a()(Cp,{companyName:t.companyName,setCompanyName:e=>{o({...t,companyName:e}),u({field:"companyName",error:void 0})},error:i.companyName,focus:"companyName"===r,styles:p,trimAndSaveCompanyName:function(){const t=g(),o={...e.onboardingState,spaceName:t};Mo.default.setState(o)}}),a()(_p,{companySize:t.companySize,setCompanySize:i=>{o({...t,companySize:i}),u({field:"companySize",error:void 0});const n={...e.onboardingState,companySize:i};Mo.default.setState(n),i&&k.trackOnboardingCompanySizeSelect(e.environment,{...ko.iF(e.onboardingState),companySize:i})},error:i.companySize,focus:"companySize"===r,styles:p}),a()(Re.Z,{style:{width:"100%",marginTop:24},isLarge:!0,onClick:m},void 0,a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingCompanySurveyStage.continueButton.label",description:"Button label to continue to the next step"})),a()(Le.Z,{isLarge:!0,onClick:async function(){k.trackOnboardingCompanySurveyAction(e.environment,{...ko.iF(e.onboardingState),selection:{companySize:t.companySize},action:"back",plan_selection:e.onboardingState.planSelection}),await yo.lp(e.environment,{...e.onboardingState,back:!0,skip:!1,previousStage:"workspace_plan_choose"})},style:p.backButtonStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"Back",id:"onboardingCompanySurvey.backButton.label",description:"Button label to back to previous step"})),a()("div",{style:{height:140}})))))))};const Cp=(0,w.injectIntl)((function(e){const{companyName:t,setCompanyName:o,styles:i,error:n,focus:r,intl:l,trimAndSaveCompanyName:c}=e;return s.createElement(s.Fragment,null,a()("div",{style:i.formLabelStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"What is the name of your company?",id:"onboardingCompanySurveyStage.companyName.label",description:"Question to ask users what's the name of the company they work at"})),a()(Wo.Z,{focusInitial:!0,value:t,format:1,focus:r||void 0,placeholder:l.formatMessage({defaultMessage:"e.g. Acme Co",id:"onboardingCompanySurveyStage.companyNameInput.placeholder",description:"Example of what a user can input into the company name input field, e.g. a fake company name"}),onChange:e=>{o(e.target.value)},style:{...i.formInputStyle,...n?i.errorFormInputStyle:{}},onBlur:c}),a()("div",{style:{marginTop:4,marginBottom:8,height:16,position:"relative"}},void 0,n&&a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,color:m.ZP.red}},void 0,n)))}));function _p(e){const{companySize:t,setCompanySize:o,styles:i,error:n,focus:r}=e;return s.createElement(s.Fragment,null,a()("div",{style:i.formLabelStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"How many people work at your company?",id:"onboardingCompanySurveyStage.companySize.label",description:"Question to ask users how many people work at their company"})),a()(gp.ZP,{questionType:"companySize",title:a()(w.FormattedMessage,{defaultMessage:"Company size...",id:"onboardingCompanySurveyStage.companySize.popuplabel",description:"Onboarding question prompt for new users on their company size"}),question:t,randomizeSelectionOrder:!1,invalid:!1,onSelect:e=>{o(e)},className:ni.Aur,width:368,placeholder:a()(w.FormattedMessage,{defaultMessage:"Select number…",id:"PersonaCollectionModal.selectQuestion.companySize.placeholder",description:"Placeholder text for the company size question"}),styles:{...i.formInputStyle,...n?i.errorFormInputStyle:{}},focus:r||void 0}),a()("div",{style:{marginTop:4,height:16,position:"relative"}},void 0,n&&a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,color:m.ZP.red}},void 0,n)))}var Mp=o(71669);const Tp=(0,w.defineMessages)({downloadIntelMac:{id:"downloadMacIntelLabel",defaultMessage:"For Macs with Intel processors"},downloadM1Mac:{id:"downloadMacSiliconLabel",defaultMessage:"For Macs with Apple M1"}});function Ip(e){window.__c={n:"MacAppDownloadButton"};const{state:t}=e,o=(0,V.O7)();return a()(Qi.Z,{popupType:jo.kQ.Popup,renderOrigin:e=>a()(Re.Z,{style:{marginTop:50,height:30,width:300},onClick:t=>e.onClick(t)},void 0,g.Z.appDownload({display:"inline",height:16,width:23,marginRight:5}),a()(w.FormattedMessage,{id:"onboardingAppDownload.step.downloadMacButton",defaultMessage:"Download Mac app"})),placementToOrigin:Qi.Z.Placement.Bottom,render:()=>a()(Pp,{handleClickIntel:async()=>{await yo.lp(o,t),k.trackOnboardingDesktopAppDownloadClick(o,{os:"mac",macType:"intel"})},handleClickM1:async()=>{await yo.lp(o,t),k.trackOnboardingDesktopAppDownloadClick(o,{os:"mac",macType:"m1"})}})})}function Pp(e){window.__c={n:"MacDownloadOptions"};const{handleClickIntel:t,handleClickM1:o}=e,i=(0,Ce.Fg)();return a()("div",{style:{marginTop:6,marginBottom:6}},void 0,a()("div",{},void 0,a()("a",{style:{color:i.darkTextColor,textDecoration:"none"},href:y._j.downloadMacIntel},void 0,a()(Ji.Z,{focused:!1,onClick:t,title:Ge.default.formatMessage(Tp.downloadIntelMac)}))),a()("div",{},void 0,a()("a",{style:{color:i.darkTextColor,textDecoration:"none"},href:y._j.downloadMacAppleSilicon},void 0,a()(Ji.Z,{focused:!1,onClick:o,title:Ge.default.formatMessage(Tp.downloadM1Mac)}))))}function xp(e){window.__c={n:"WindowsAppDownloadButton"};const{state:t}=e,o=(0,V.O7)();return a()("a",{style:{textDecoration:"none",marginLeft:5,marginRight:5},href:y._j.downloadWindows},void 0,a()(Re.Z,{style:{marginTop:50,height:30,width:300},onClick:async()=>{await yo.lp(o,t),k.trackOnboardingDesktopAppDownloadClick(o,{os:"windows"})}},void 0,g.Z.appDownload({display:"inline",height:16,width:23,marginRight:5}),a()(w.FormattedMessage,{id:"onboardingAppDownload.step.downloadWindowsButton",defaultMessage:"Download Windows app"})))}const Bp=(0,w.defineMessages)({macAndWindowsSubtitle:{defaultMessage:"Get the Notion app for Mac or Windows for a better offline experience and notifications.",id:"onboardingAppDownload.subtitle.macAndWindows"},macSubtitle:{defaultMessage:"Get the Notion app for Mac for better offline and notifications.",id:"onboardingAppDownload.subtitle.mac"},windowsSubtitle:{defaultMessage:"Get the Notion app for Windows for better offline and notifications.",id:"onboardingAppDownload.subtitle.windows"},downloadMacApp:{defaultMessage:"Download Mac app",id:"onboardingAppDownload.step.desktop.downloadMacButton",description:"Button to download the Mac desktop app."},downloadWindowsApp:{defaultMessage:"Download Windows app",id:"onboardingAppDownload.step.desktop.downloadWindowsButton",description:"Button to download the Windows desktop app."}});function Zp(e){return{continueButton:{cursor:"pointer",marginTop:20,color:e.lightTextColor,fontSize:fo.Z.fontSize.UIRegular.desktop},image:{margin:"auto",height:"50vh",borderRadius:6,boxShadow:e.lightBoxShadow,minHeight:256,minWidth:415}}}const Ep=function(e){window.__c={n:"OnboardingDesktopAppDownload"};const{onboardingState:t}=e,o=(0,V.O7)(),{device:i}=o,n=(0,Ce.yK)(Zp,[]);let r=!0,s=!0,l=Ge.default.formatMessage(Bp.macAndWindowsSubtitle);return i.isMac?(l=Ge.default.formatMessage(Bp.macSubtitle),s=!1):i.isWindows&&(l=Ge.default.formatMessage(Bp.windowsSubtitle),r=!1),a()(wp,{title:a()(w.FormattedMessage,{defaultMessage:"Download Notion",id:"onboardingAppDownload.step.title"}),subtitle:l,illustrationUrl:Et.Z.tutorial.ada2Png},"desktop_app_download",a()(Mp.Z,{style:n.image,src:Et.Z.images.onboarding.desktopAppPng}),a()("div",{style:{display:"flex",justifyContent:"space-between"}},void 0,r&&a()(Ip,{state:t}),s&&a()(xp,{state:t})),a()("a",{style:n.continueButton,onClick:async()=>{await yo.lp(o,t),Be.track(o,"onboarding_skip_desktop_app_download")}},void 0,a()(w.FormattedMessage,{defaultMessage:"Take me to Notion",id:"onboardingDesktopAppDownload.continueButton.label",description:"Button to continue to Notion from onboarding."})))};var Rp=o(43132);class Ap extends To.Z{getInitialState(){return{emailValue:"",emailTokens:[],validationError:void 0,isInviting:!1,isBulkInvite:!1,emailInputs:[{value:"",sanitizedEmail:""},{value:"",sanitizedEmail:""},{value:"",sanitizedEmail:""}],opacity:0}}addNewEmailValue(){const e=this.state.emailInputs;this.setState({...this.state,emailInputs:[...e,{value:"",sanitizedEmail:""}]})}removeEmailValue(e){if(e>=this.state.emailInputs.length)return;const t=[...this.state.emailInputs];t.splice(e,1),this.setState({...this.state,emailInputs:t})}updateEmailValue(e,t,o){if(e>=this.state.emailInputs.length)return;const i=this.state.emailInputs[e],n=this.state.emailInputs.map(((i,n)=>n===e?{value:t,sanitizedEmail:o}:i));e===this.state.emailInputs.length-1&&""===i.sanitizedEmail&&""!==o&&n.push({value:"",sanitizedEmail:""}),this.setState({...this.state,emailInputs:n})}setInvalidEmails(e,t){const o=this.state.emailInputs.map(((o,i)=>e.includes(i)?{...o,validationError:t.formatMessage({defaultMessage:"Invalid email.",id:"onboardingInviteNew.error.invalidEmail.message"})}:o));this.setState({...this.state,validationError:"One or more invalid emails found.",emailInputs:o})}clearValidationError(e){const t=this.state.emailInputs.map(((t,o)=>e===o?{...t,validationError:void 0}:t));this.setState({...this.state,emailInputs:t})}switchToBulkInvite(){const e=this.state.emailInputs.map((e=>e.sanitizedEmail||e.value)).filter(Boolean);this.updateEmailTokens(...e),this.setState({...this.state,emailInputs:[],isBulkInvite:!0,validationError:void 0})}updateEmailTokens(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];const i=t.map((e=>({email:e,isValidEmail:(0,ae.oH)(e)})));this.setState({...this.state,emailTokens:[...this.state.emailTokens,...i]})}}const Dp=Ap;var Fp=o(64404),Lp=o(91487),Vp=o(47082);class Np extends l.Z{renderComponent(){return a()(ot.Z,{className:ni.Z87,style:this.getButtonStyle(),disabled:this.props.disabled,onClick:this.props.onClick,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onMouseDown:this.props.onMouseDown,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,hoveredStyle:this.props.hoveredStyle,pressedStyle:this.props.pressedStyle},void 0,this.props.children)}getButtonStyle(){const{device:e}=this.environment;return{display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:3,height:e.isMobile?42:32,padding:"0 12px",fontSize:14,lineHeight:1.2,background:this.theme.buttonBackground,border:`1px solid ${this.theme.outlineButtonBorder}`,boxShadow:"rgba(15, 15, 15, 0.1) 0px 1px 2px",...this.props.disabled&&!this.props.useNonDisableColorWhenDisabled?{background:m.ZP.contentGrayBackground,color:m.ZP.lightTextColor}:{},...this.props.style}}}Np.displayName="OnboardingButton";const Op=Np;var Up=o(38870);class Hp extends l.Z{constructor(){super(...arguments),this.handleNextClick=()=>{this.props.showNextButton&&this.props.handleNextClick()}}renderComponent(){const{device:e}=this.environment;if(e.isMobile){const{illustrationPath:e,title:t,subtitle:o,renderUnderNext:i}=this.props,n=()=>yo.VW(this.environment);return a()(Up.Z,{enable:!0,shortcuts:{backbutton:n}},void 0,a()(Zi.Z,{banners:yp.state.banners,isMobile:this.environment.device.isMobile,isInPeekRenderer:!1}),a()(Si.Z,{type:si.Z.Y,style:this.getMobileScrollerStyle()},void 0,this.props.showBackButton?a()(Le.Z,{isGray:!0,onClick:n,style:this.getBackButtonStyle()},void 0,a()(w.FormattedMessage,{defaultMessage:"Cancel",id:"onboardingWorkspaceMobileScroller.mobileCancelButton.label"})):a()("div",{style:{height:44}}),a()("div",{style:this.getMobileWrapStyle()},void 0,t&&a()("div",{style:{fontWeight:600,fontSize:22,textAlign:"center",fontFamily:fo.Z.getHeaderFontFamily({locale:c.SP})}},void 0,t),o&&a()("div",{style:{fontWeight:"normal",fontSize:16,textAlign:"center",color:this.theme.mediumTextColor,paddingLeft:16,paddingRight:16,wordBreak:"break-word",paddingBottom:36}},void 0,o),this.props.children,this.renderNextButton(),Boolean(i)?i:void 0,e&&a()("div",{style:this.getMobileIllustrationWrapStyle()},void 0,a()("img",{src:this.getIllustrationPath(e),style:Hp.mobileIllustrationStyle})))))}return this.props.children}renderNextButton(){if(this.props.showNextButton)return a()(Re.Z,{style:{marginTop:8,width:"100%",height:this.environment.device.isMobile?44:36},isLarge:!0,onClick:this.handleNextClick,disabled:this.props.disableNextButton},void 0,a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingMobileScroller.continueButton.label"}))}getIllustrationPath(e){const{ThemeStore:t}=this.environment;return`/tutorial/${e}${"dark"===t.state.mode?"-dark":""}.png`}getMobileScrollerStyle(){const{WindowSizeStore:e}=this.environment,t={width:"100vw",height:"100vh",paddingTop:e.getSafePaddingTopCSS(24),paddingLeft:e.getSafePaddingLeftCSS(16),paddingRight:e.getSafePaddingRightCSS(16),paddingBottom:e.getSafePaddingBottomCSS(64),background:this.theme.sidebarBackground};return this.props.illustrationPath?{...t,paddingBottom:0}:t}getBackButtonStyle(){return{paddingBottom:20,height:44}}getMobileWrapStyle(){const e={maxWidth:360,fontSize:16,marginLeft:"auto",marginRight:"auto"};return this.props.illustrationPath?{...e,minHeight:"100%",position:"relative",paddingBottom:250}:e}getMobileIllustrationWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment,{illustrationStyle:o}=this.props;return{position:"absolute",overflow:"hidden",height:140,bottom:e.isIPhoneX?0:t.state.paddingBottomCSS,left:-50,...o||{}}}}Hp.displayName="OnboardingMobileScroller",Hp.mobileIllustrationStyle={height:240};const zp=Hp;class Wp extends l.Z{constructor(){super(...arguments),this.storeTypes={store:Dp,spacePermissionsSettingsStore:Fp.Z},this.submit_exp01=async e=>{k.trackOnboardingInviteClick(this.environment,{...ko.iF(e),invited_emails:e.emails}),await ko.SN(e,this.environment),yo.lp(this.environment,e)},this.handleInviteClick_exp01=()=>{const{state:e}=this.stores.store;this.stores.store.setState({...e,validationError:void 0,isInviting:!0}),k.trackOnboardingInviteAttempt(this.environment,{...ko.iF(this.props.onboardingState),invited_emails:e.isBulkInvite?e.emailTokens:e.emailInputs});const t=e.isBulkInvite?this.validateBulkInviteEmails():this.validateSingleInviteEmails(),o={...this.props.onboardingState,emails:t,isBulkInvite:e.isBulkInvite};Boolean(this.stores.store.state.validationError)?(Mo.default.setState(o),this.stores.store.setState({...this.stores.store.state,isInviting:!1})):Mo.default.setState(o)},this.handleInviteClick=async()=>{const{state:e}=this.stores.store;this.stores.store.setState({...e,validationError:void 0,isInviting:!0}),k.trackOnboardingInviteAttempt(this.environment,{...ko.iF(this.props.onboardingState),invited_emails:e.isBulkInvite?e.emailTokens:e.emailInputs});const t=e.isBulkInvite?this.validateBulkInviteEmails():this.validateSingleInviteEmails(),o={...this.props.onboardingState,emails:t,isBulkInvite:e.isBulkInvite};Mo.default.setState(o),Boolean(this.stores.store.state.validationError)||(k.trackOnboardingInviteClick(this.environment,{...ko.iF(this.props.onboardingState),invited_emails:t}),await yo.lp(this.environment,o)),this.stores.store.setState({...this.stores.store.state,isInviting:!1})},this.handleMobileInviteLink=()=>{const e=this.props.onboardingState.inviteLinkUrl;e&&Rp.RD({environment:this.environment,stringValue:e,copiedMessage:Rp.tq.copiedLinkToClipboard}),k.trackOnboardingCopyLinkInvite(this.environment,ko.iF(this.props.onboardingState))}}didMount(){k.trackOnboardingDebugStageRender(this.environment,ko.iF(this.props.onboardingState)),this.stores.store.setState({...this.stores.store.state,opacity:1})}renderComponent(){var e;const{device:t}=this.environment;return"on"===(null===(e=this.props.onboardingState.onboardingExperiments)||void 0===e?void 0:e.onboarding_creator_no_joinable_spaces)&&this.stores.store.state.isInviting&&this.props.onboardingState.spaceSetupCompleted&&!this.props.onboardingState.shouldTriggerPostInviteAnimations&&this.submit_exp01(this.props.onboardingState),t.isMobile?this.renderMobile():"on"===(null===(o=this.props.onboardingState.onboardingExperiments)||void 0===o?void 0:o.onboarding_creator_no_joinable_spaces)?this.renderDesktop_exp01(this.stores.store.state.opacity):this.renderDesktop();var o}renderDesktop(){const e={title:a()(w.FormattedMessage,{defaultMessage:"Invite teammates",id:"onboardingInvite.chrome.title",description:"Title for the invite teammates step in the onboarding flow"}),subtitle:a()(w.FormattedMessage,{defaultMessage:"Get the most out of Notion by inviting your teammates.",id:"onboardingInvite.chrome.subtitle",description:"Subtitle for the invite teammates step in the onboarding flow"}),key:"invite"};return a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity},void 0,s.createElement(wp,n()({},e,{illustrationUrl:ko.tr("ada-1",this.environment.ThemeStore)}),this.renderForm({hideContinueButton:!1})))}renderDesktop_exp01(e){const t={title:a()("div",{style:{lineHeight:"123%",textAlign:"left"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Your workspace is set up! Invite your teammates to join you",id:"onboardingWorkInvite.step.title",description:"Title text for the Invite stage to ask users to invite teammates to join their Notion workspace"})),subtitle:a()("div",{style:{lineHeight:"123%",textAlign:"left"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Start Notion as a team—it’s better together",id:"onboardingWorkInvite.step.subtitle",description:"Subtitle text to let users know we recommend they invite people to their new workspace"})),key:"invite",useInlineStyle:!0,disableAutoHeight:!0};return a()("div",{style:{width:"100%",background:this.theme.onboardingBackground_exp01,display:"flex",justifyContent:"center"}},void 0,a()("div",{style:{minWidth:260,maxWidth:370,marginLeft:"10%",marginRight:"10%",marginTop:"14vh"}},void 0,a()(fp,{startPercentage:75,endPercentage:100}),a()("div",{style:{opacity:e,transition:"opacity 0.75s ease-in-out"}},void 0,a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity},void 0,s.createElement(wp,n()({},t,{subtitleStyles:{paddingTop:8}}),a()("div",{style:{paddingLeft:2,paddingRight:2}},void 0,this.renderForm_exp01(),a()("div",{style:{height:140}})))))))}renderMobileInviteLink(){return a()(Op,{style:this.getMobileInviteLinkStyle(),onClick:this.handleMobileInviteLink},void 0,a()(w.FormattedMessage,{defaultMessage:"Copy invite link",id:"onboardingInvite.mobile.copyButton.title"}))}renderForm(e){return a()("div",{style:{width:460,alignSelf:"center"}},void 0,a()("div",{style:{width:"100%",display:"flex",alignItems:"center",marginBottom:"4px"}},void 0,a()(Ve.Z,{isSecondaryColor:!0,style:{fontWeight:fo.Z.fontWeight.semibold}},void 0,a()(w.FormattedMessage,{defaultMessage:"Send invites",id:"onboardingInvite.emails.sendInvites"})),a()(jp,{onboardingState:this.props.onboardingState,environment:this.environment})),this.stores.store.state.isBulkInvite?a()(Yp,{store:this.stores.store,intl:this.props.intl,spaceInviteState:this.props.onboardingState}):a()(Kp,{store:this.stores.store,intl:this.props.intl,onboardingState:this.props.onboardingState}),a()(Zo.Z,{size:8,style:{marginTop:12}}),this.renderAutoJoinOption(),e.hideContinueButton?null:a()("div",{style:{display:"flex",justifyContent:"center",width:"100%"}},void 0,this.renderContinueButton()),a()("div",{style:{display:"flex",justifyContent:"center",width:"100%",color:m.ZP.red,marginTop:14}},void 0,this.stores.store.state.validationError&&a()(w.FormattedMessage,{defaultMessage:"Looks like some of the emails are invalid. Try again?",id:"onboardingInvite.invalidEmails.error.message"})))}renderContinueButton(e){const{isInviting:t}=this.stores.store.state;return a()(Re.Z,{style:{marginTop:20,width:"280px",...e},isLarge:!0,onClick:this.handleInviteClick,disabled:t},void 0,t?a()(yi.Z,{isWhite:!0}):this.getContinueButtonText())}getContinueButtonText(){return this.environment.device.isMobile?a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingInvite.continueButton",description:"Button indicating to the user to continue with onboarding."}):ko.bN(this.stores.store.state)?a()(w.FormattedMessage,{defaultMessage:"Invite and take me to Notion",id:"onboardingInvite.desktopButton.invitedEmails.finishButton"}):a()(w.FormattedMessage,{defaultMessage:"Take me to Notion",id:"onboardingInvite.finishButton"})}renderForm_exp01(){const{isInviting:e}=this.stores.store.state;return a()("div",{style:{alignSelf:"center"}},void 0,a()("div",{style:{width:"100%",display:"flex",alignItems:"center",marginBottom:"4px"}},void 0,a()(Ve.Z,{isSecondaryColor:!0,style:{fontWeight:fo.Z.fontWeight.semibold}},void 0,a()(w.FormattedMessage,{defaultMessage:"Send invites",id:"onboardingInvite.emails.sendInvites"})),a()(jp,{onboardingState:this.props.onboardingState,environment:this.environment})),this.stores.store.state.isBulkInvite?a()(Yp,{store:this.stores.store,intl:this.props.intl,spaceInviteState:this.props.onboardingState}):a()(Kp,{store:this.stores.store,intl:this.props.intl,onboardingState:this.props.onboardingState}),a()(Zo.Z,{size:8,style:{marginTop:12}}),this.renderAutoJoinOption(),a()("div",{style:{marginTop:4,height:16,position:"relative"}},void 0,this.stores.store.state.validationError&&a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:14,color:m.ZP.red}},void 0,a()(w.FormattedMessage,{defaultMessage:"Looks like some of the emails are invalid. Try again?",id:"onboardingInvite.invalidEmails.error.message"}))),a()(Re.Z,{style:{marginTop:16,width:"100%"},isLarge:!0,onClick:this.handleInviteClick_exp01,disabled:e},void 0,e?a()(yi.Z,{isWhite:!0}):this.getContinueButtonText()))}renderMobile(){return a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity},void 0,a()(zp,{showBackButton:!1,showNextButton:!0,disableNextButton:this.shouldDisableNext(),title:a()(w.FormattedMessage,{defaultMessage:"Invite teammates",id:"onboardingInvite.mobileStep.title"}),subtitle:a()("span",{style:{wordBreak:"keep-all"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Notion works great for teams of any size.",id:"onboardingInvite.mobileStep.subtitle"})),handleNextClick:this.handleInviteClick},"mobile-invites",this.renderMobileSplash(),this.renderMobileInviteLink(),this.renderAutoJoinOption()))}renderMobileSplash(){const{ThemeStore:e}=this.environment,t=`/tutorial/onboarding-wiki${"dark"===e.state.mode?"-dark":""}.png`;return a()("img",{alt:"Image of users with scroll",src:t,style:this.getMobileSplashStyle(),width:"85%"})}renderAutoJoinOption(){const{device:e}=this.environment;return Boolean(this.props.onboardingState.emailDomain)?a()("div",{style:{...ko.pd,display:"flex",...e.isMobile?{marginBottom:16}:{marginTop:16}}},void 0,a()("div",{style:{marginRight:10,paddingLeft:6,paddingTop:4,...e.isMobile?{}:{paddingTop:3}}},void 0,a()(ks.Z,{checked:this.props.onboardingState.isChecked,onClick:()=>{Mo.default.setState({...this.props.onboardingState,isChecked:!this.props.onboardingState.isChecked})},size:e.isMobile?16:14})),a()("div",{onClick:()=>{Mo.default.setState({...this.props.onboardingState,isChecked:!this.props.onboardingState.isChecked})},style:{...ko.bm(this.theme),fontSize:e.isMobile?15:14}},void 0,a()(w.FormattedMessage,{defaultMessage:"Allow anyone with a <b>@{emailDomain}</b> email to join this workspace",id:"onboardingInvite.emailDomainAutoJoinCheckbox.label",values:{emailDomain:this.props.onboardingState.emailDomain,b:e=>a()("span",{style:{fontWeight:fo.Z.fontWeight.semibold}},void 0,e)}}))):void 0}shouldDisableNext(){return this.stores.store.state.isInviting}validateSingleInviteEmails(){const{state:e}=this.stores.store,{intl:t}=this.props,o=[],i=[];for(const[n,r]of e.emailInputs.entries())""!==r.value&&((0,ae.oH)(r.sanitizedEmail)?o.push(n):i.push(n));for(const n of o)this.stores.store.clearValidationError(n);this.stores.store.setInvalidEmails(i,t),0===i.length&&this.stores.store.setState({...this.stores.store.state,validationError:void 0});return o.map((t=>e.emailInputs[t].sanitizedEmail))}validateBulkInviteEmails(){const{state:e}=this.stores.store,[t,o]=gt().partition(e.emailTokens,(e=>e.isValidEmail));return this.stores.store.setState({...e,validationError:o.length>0?"One or more invalid emails found.":void 0}),t.map((e=>e.email))}getMobileSplashStyle(){return{width:"100%",textAlign:"center"}}getMobileInviteLinkStyle(){return{marginTop:"5vh",width:"100%",background:this.theme.buttonBackground,marginBottom:10}}}function jp(e){window.__c={n:"InviteLink"};const{environment:t,onboardingState:o}=e,[i,r]=(0,s.useState)(!1);return a()(Ai.Z,{placement:Rr.u.Bottom,renderTooltip:()=>a()(w.FormattedMessage,{defaultMessage:"Invite teammates with this link",id:"onboardingInvite.sharingButton.tooltip.copy"}),render:e=>s.createElement(Le.Z,n()({isBlue:!i,isLightGray:i,icon:g.Z.link,onClick:()=>{Rp.RD({environment:t,stringValue:o.inviteLinkUrl||"",copiedMessage:Rp.tq.copiedLinkToClipboard}),k.trackOnboardingCopyLinkInvite(t,ko.iF(o)),r(!0),setTimeout((()=>{r(!1)}),1500)},style:{marginLeft:"auto"},disabled:i},e),a()(w.FormattedMessage,i?{defaultMessage:"Copied!",id:"onboardingInvite.sharingButton.copied"}:{defaultMessage:"Get shareable link",id:"onboardingInvite.sharingButton.copy"}))})}function Kp(e){let{intl:t,store:o,onboardingState:i}=e;const n=(0,V.O7)(),r=(0,Ce.Fg)(),l=(0,N.VK)((()=>o.state.emailInputs),[o]),c=l.map(((e,s)=>a()("div",{style:{width:"100%"}},void 0,a()(Wo.Z,{placeholder:t.formatMessage({defaultMessage:"Email address",id:"onboardingInvite.email.placeholder",description:"Email address of team member to invite"}),style:{padding:10,marginBottom:10,background:r.whiteButtonBackground,width:"100%",display:"inline-block",boxShadow:l[s].validationError?r.outlineRedInputBoxShadow:r.inputBoxShadow,transition:"box-shadow 0.3s ease-out"},onChange:e=>{!function(e,t,o){const i=t.target.value,{index:n,store:r}=o,a=(0,ae.dq)(i);r.updateEmailValue(n,i,a)}(0,e,{index:s,store:o})},onBlur:e=>{!function(e,t,o){const i=t.target.value;""!==i&&k.trackOnboardingTeamInviteEmailEntered(e,{...ko.iF(o),emails_entered:[i],is_bulk_invite:!1})}(n,e,i)},value:e.value}))));return s.createElement(s.Fragment,null,a()("div",{style:{marginBottom:2,alignItems:"center",display:"flex",flexFlow:"column"}},void 0,c),a()(Le.Z,{icon:g.Z.plus,onClick:()=>function(e,t){const{store:o,state:i}=t;o.switchToBulkInvite(),k.trackOnboardingTeamInviteAddMoreClicked(e,ko.iF(i))}(n,{store:o,state:i})},void 0,a()(w.FormattedMessage,{defaultMessage:"Add more or invite in bulk",id:"onboardingInvite.emails.addMoreOrInviteInBulkText"})))}function Yp(e){let{intl:t,store:o,spaceInviteState:i}=e;const r=(0,V.O7)(),l=(0,Ce.Fg)(),c=(0,N.VK)((()=>o.state),[o]),d=c.emailTokens.map((e=>{const t={type:"newUser",value:{email:e.email||""},source:"email"},i=e.isValidEmail?{}:{backgroundColor:l.legacyRedSelectColor,isStrikedThrough:!0};return s.createElement(Lp.Z,n()({target:t,onClickRemove:e=>function(e,t){const o=t.state.emailTokens.filter((t=>"newUser"===e.type&&t.email!==e.value.email));t.setState({...t.state,emailTokens:o})}(e,o)},i))})),p=(0,s.useRef)(i);return(0,s.useEffect)((()=>{k.trackOnboardingBulkInvitesRendered(r,ko.iF(p.current))}),[r]),s.createElement(s.Fragment,null,a()(Vp.Z,{format:Vp.Z.Format.Share,value:c.emailValue||"",onChange:e=>function(e,t,o){const{store:i,state:n}=o,r=t.target.value,{extractedEmails:a,newInputValue:s}=(0,ae.zI)(r);i.updateEmailTokens(...a),i.setState({...i.state,emailValue:s}),a.length>0&&k.trackOnboardingTeamInviteEmailEntered(e,{...ko.iF(n),emails_entered:a,is_bulk_invite:!0})}(r,e,{store:o,state:i}),type:"email",tokens:d,disabled:!1,placeholder:t.formatMessage({id:"onboardingInvite.bulkInvites.placeholder",defaultMessage:"annie@myteam.com, fay@company.com, henry@company.com, ...",description:"List of example email addresses. Can localize each email, but the commas (,) should not be localized."}),onKeyDown:e=>function(e,t){if("Enter"===e.key){const o=e.target.value,i=(0,ae.H3)(o);i&&(t.updateEmailTokens(i),t.setState({...t.state,emailValue:""}))}}(e,o),onRemoveLastToken:()=>{},dontShowBorderBottom:!1,style:{boxShadow:"rgba(15, 15, 15, 0.1) 0px 0px 0px 1px inset",background:l.whiteButtonBackground,borderRadius:3,height:150,alignContent:"flex-start"},textarea:!0,inputStyle:{height:"100%"},inputFullWidth:!0}),a()(Ve.Z,{isMultiline:!0,isSmall:!0,style:{marginTop:8,marginBottom:28}},void 0,a()(w.FormattedMessage,{defaultMessage:"Type or paste in one or multiple emails separated by commas, spaces, or line breaks.",id:"onboardingInvite.addEmail.caption"})))}Wp.displayName="OnboardingInvite";const Gp=(0,w.injectIntl)(Wp);class Xp extends l.Z{constructor(){super(...arguments),this.handleClick=async()=>{await yo.lp(this.environment,this.props.onboardingState),this.props.handleClick&&this.props.handleClick()}}didMount(){const e=Mo.default.state;k.trackOnboardingDebugStageRender(this.environment,ko.iF(e))}renderButton(){return this.props.canSkipStep?a()("a",{style:{cursor:"pointer",marginTop:15,color:this.theme.lightTextColor,fontSize:fo.Z.fontSize.UIRegular.desktop},onClick:this.handleClick},void 0,this.props.canSkipStep&&this.props.redirectToStart?a()(w.FormattedMessage,{defaultMessage:"Take me to Notion",id:"onboardingMobileTutorial.button.takeMeToNotion"}):a()(w.FormattedMessage,{defaultMessage:"Skip",id:"onboardingMobileTutorial.button.skip"})):a()(Op,{style:{...this.props.redirectToStart?{backgroundColor:m.ZP.blue,color:m.ZP.white}:{},marginTop:16,width:"100%"},onClick:this.handleClick},void 0,this.props.redirectToStart?a()(w.FormattedMessage,{defaultMessage:"Get started",id:"onboardingMobileTutorial.getStartedButton.label"}):a()(w.FormattedMessage,{defaultMessage:"Next",id:"onboardingMobileTutorial.nextButton.label"}))}renderComponent(){return a()(zp,{showNextButton:!1,showBackButton:!1},"mobile-tutorial",a()("div",{style:Xp.wrapStyle},void 0,this.renderMobileTutorialIllustration(),a()("div",{style:Xp.mobileTutorialStepStyle},void 0,this.props.tipNumber,a()("span",{style:{color:this.theme.mediumTextColor}},void 0," ","/ 4")),this.props.contents,this.props.contentAboveNextButton?a()("div",{style:{alignItems:"center",display:"flex",flexDirection:"column"}},void 0,this.props.contentAboveNextButton,this.renderButton()):this.renderButton()),this.props.visual)}renderMobileTutorialIllustration(){const{ThemeStore:e}=this.environment;return a()("img",{src:ko.tr("simon-half",e),style:{width:100,height:100,marginBottom:8}})}}Xp.displayName="OnboardingMobileTutorial",Xp.wrapStyle={position:"relative",paddingLeft:16,paddingRight:16,display:"flex",flexDirection:"column"},Xp.mobileTutorialStepStyle={textAlign:"right",position:"absolute",top:-4,right:0};const qp=Xp;function $p(e){const{function:t,setFunction:o,styles:i,error:n,focus:r}=e;return s.createElement(s.Fragment,null,a()("div",{style:i.formLabelStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"What is your team?",id:"OnboardingPersonaSurveyStageWork.function.label",description:"Question to ask users which team they work on, e.g. Marketing, Engineering, IT Admin."})),a()(gp.ZP,{questionType:"work",title:a()(w.FormattedMessage,{defaultMessage:"Select team...",id:"OnboardingPersonaSurveyStageWork.function.popuplabel",description:"Onboarding question prompt for new users on their team"}),placeholder:a()(w.FormattedMessage,{defaultMessage:"Select team...",id:"OnboardingPersonaSurveyStageWork.function.placeholder",description:"Empty state for function question"}),question:t,invalid:!1,onSelect:e=>{o(e)},className:ni.IAq,width:368,workFunctionOptionsVersion:2,styles:{...i.formInputStyle,...n?i.errorFormInputStyle:{}},focus:r||void 0,disabled:e.disabled}),a()("div",{style:i.errorLabel},void 0,n&&a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,color:m.ZP.red}},void 0,n)))}function Jp(e){const{role:t,setRole:o,styles:i,error:n,focus:r}=e;return s.createElement(s.Fragment,null,a()("div",{style:i.formLabelStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"What is your role?",id:"OnboardingPersonaSurveyStage.role.label",description:"Question to ask users role they have on their team, e.g. Manager, Individual Contributor."})),a()(gp.ZP,{questionType:"role",title:a()(w.FormattedMessage,{defaultMessage:"Select role...",id:"OnboardingPersonaSurveyStage.role.popuplabel",description:"Onboarding question prompt for new users on their team"}),placeholder:a()(w.FormattedMessage,{defaultMessage:"Select role...",id:"OnboardingPersonaSurveyStage.role.placeholder",description:"Empty state for role question"}),question:t,randomizeSelectionOrder:!1,invalid:!1,onSelect:e=>{o(e)},className:ni.Mpz,width:368,workFunctionOptionsVersion:2,styles:{...i.formInputStyle,...n?i.errorFormInputStyle:{}},focus:r||void 0,disabled:e.disabled}),a()("div",{style:i.errorLabel},void 0,n&&a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,color:m.ZP.red}},void 0,n)))}const Qp=function(e){const{useCases:t,setUseCases:o,styles:i,error:r,focus:l}=e;function c(e){t.has(e)?(t.delete(e),o(t)):(t.add(e),o(t))}return s.createElement(s.Fragment,null,a()("div",{style:i.formLabelStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"What are you planning to use Notion for?",id:"OnboardingPersonaSurveyStage.useCases.label",description:"Question to ask users what they plan to use Notion for, i.e. what functionality they will want to try."})),a()(Ns.Z,{menuTitle:a()(w.FormattedMessage,{defaultMessage:"Select use..",id:"onboardingPersonaSurvey.useCases.popuplabel",description:"Onboarding question prompt for new users on their Notion use case"}),selectedItem:void 0,getKey:e=>e,width:368,items:Object.keys(ou),originGap:4,dontCloseParentOnSelect:!0,disabled:e.disabled,onSelect:e=>c(e),renderItem:e=>s.createElement(Ji.Z,n()({icon:a()(ks.Z,{checked:t.has(e.value),size:16,onClick:()=>c(e.value)}),title:ou[e.value],className:`${ni.J2F}-${e.value}`},e)),renderOrigin:e=>a()(Ao.Z,{isLarge:!0,onClick:t=>e.onClick(t),className:ni.J2F,style:{...i.selectOutlineButton,...r?i.errorFormInputStyle:{}},focused:l||void 0},void 0,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,t.size>0?a()(Ve.Z,{},void 0,a()(w.FormattedMessage,{defaultMessage:"{count, plural, one {{useCase}} other {{count} selected}}",id:"onboardingPersonaSurvey.useCasesField.plural.placeholder",description:"label for select option when multiple use cases selected",values:{count:t.size,useCase:ou[Array.from(t)[0]]}})):a()(Ve.Z,{isSecondaryColor:!0},void 0,a()(w.FormattedMessage,{defaultMessage:"Select use...",id:"onboardingPersonaSurvey.useCasesField.placeholder",description:"empty state for selecting use cases"}))),g.Z.expand(i.icons))},"useCase"),a()("div",{style:{...i.errorLabel,marginBottom:0}},void 0,r&&a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,color:m.ZP.red}},void 0,r)))};const eu=function(e){window.__c={n:"OnboardingPersonaSurveyWork"};const[t,o]=(0,s.useState)({role:e.onboardingState.userRole||void 0,function:e.onboardingState.userPersona||void 0,useCases:new Set(e.onboardingState.useCases)}),[i,n]=(0,s.useState)({role:void 0,function:void 0,useCases:void 0}),[r,l]=(0,s.useState)(void 0),[c,d]=(0,s.useState)(0);(0,s.useEffect)((()=>{d(1)}),[]);const[p,u]=(0,s.useState)(!1),m=(0,Ce.yK)((e=>({leftPanel:{width:"100%",background:e.onboardingBackground_exp01,display:"flex",justifyContent:"center"},choiceSection:{minWidth:260,maxWidth:370,marginLeft:"10%",marginRight:"10%",marginTop:"14vh"},backButtonStyle:{width:"100%",justifyContent:"center",color:e.lightTextColor,marginTop:8,height:32},errorLabel:{marginTop:4,marginBottom:8,height:16,position:"relative"},errorFormInputStyle:{boxShadow:e.outlineRedInputBoxShadow},formLabelStyle:{color:e.mediumTextColor,fontSize:14,lineHeight:"16px",marginBottom:12},formInputStyle:{display:"flex",alignItems:"center",width:"100%",fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,position:"relative",borderRadius:4,boxShadow:e.inputBoxShadow,cursor:"text",backgroundColor:e.whiteButtonBackground,height:31,transition:"box-shadow 0.3s ease-out"},icons:{width:10,fill:e.lightIconColor},selectOutlineButton:{padding:"2px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:3,border:0,transition:"box-shadow 0.3s ease",boxShadow:e.inputBoxShadow,background:e.buttonBackground}})),[]);function g(e){const{field:t,error:o}=e;if(void 0===o)n({...i,[t]:void 0});else{const e=Object.keys(i).reduce(((e,t)=>(e[t]=void 0,e)),{});n({...e,[t]:o})}}async function h(){const o=Object.keys(i).find((e=>void 0!==i[e]));if("role"!==o&&"function"!==o&&"useCases"!==o){if(!t.role)return g({field:"role",error:a()(w.FormattedMessage,{defaultMessage:"Please select your role.",id:"OnboardingPersonaSurveyStage.roleUndefinedError.message",description:"Error message to let users know they need to fill out the role field."})}),void l("role");if(!t.function)return g({field:"function",error:a()(w.FormattedMessage,{defaultMessage:"Please select the team you're on at work.",id:"OnboardingPersonaSurveyStage.functionUndefinedError.message",description:"Error message to let users know they need to fill out the function field."})}),void l("function");if(t.useCases.size<1)return g({field:"useCases",error:a()(w.FormattedMessage,{defaultMessage:"Please select what you're planning to use Notion for.",id:"OnboardingPersonaSurveyStage.useCasesUndefinedError.message",description:"Error message to let users know they need to fill out the use cases field."})}),void l("useCases");{u(!0);const o={...e.onboardingState,userRole:t.role,userPersona:t.function,useCases:Array.from(t.useCases)};k.trackOnboardingPersonaSurveyAction(e.environment,{...ko.iF(e.onboardingState),selection:{userRole:t.role,userPersona:t.function,useCases:Array.from(t.useCases)},action:"submit",plan_selection:e.onboardingState.planSelection}),await yo.lp(e.environment,{...o,back:!1,skip:!1,previousStage:"persona_survey"})}}else l(o)}return(0,s.useEffect)((()=>{if(r){const e=setTimeout((()=>{l(void 0)}),100);return()=>clearTimeout(e)}}),[r]),a()("div",{style:m.leftPanel},void 0,a()("div",{style:m.choiceSection},void 0,a()(fp,{startPercentage:50,endPercentage:75}),a()("div",{style:{opacity:c,transition:"opacity 0.75s ease-in-out"}},void 0,a()(wp,{title:a()("div",{style:{lineHeight:"123%",textAlign:"left"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Tell us more about your role at {companyName}",id:"OnboardingPersonaSurveyStage.step.title",description:"Title text for the Company Survey stage to ask users to answer questions about their company.",values:{companyName:e.companyName}})),subtitle:a()("div",{style:{lineHeight:"123%",textAlign:"left"}},void 0,a()(w.FormattedMessage,{defaultMessage:"We'll personalize your workspace based on your answers",id:"OnboardingPersonaSurveyStage.step.subtitle",description:"Subtitle text to let user know we'll use their answers."})),useInlineStyle:!0,disableAutoHeight:!0,subtitleStyles:{paddingTop:8}},"onboarding_persona_survey",a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity,onEnter:h},void 0,a()("div",{style:{paddingLeft:2,paddingRight:2}},void 0,a()(Jp,{role:t.role,setRole:i=>{o({...t,role:i}),g({field:"role",error:void 0});const n={...e.onboardingState,userRole:i};Mo.default.setState(n),i&&k.trackOnboardingRoleSelect(e.environment,{...ko.iF(e.onboardingState),role:i})},error:i.role,focus:"role"===r,styles:m,disabled:p}),a()($p,{function:t.function,setFunction:i=>{o({...t,function:i}),g({field:"function",error:void 0});const n={...e.onboardingState,userPersona:i};Mo.default.setState(n),i&&k.trackOnboardingPersonaSelect(e.environment,{...ko.iF(e.onboardingState),persona:i})},error:i.function,focus:"function"===r,styles:m,disabled:p}),a()(Qp,{useCases:t.useCases,setUseCases:i=>{o({...t,useCases:i}),g({field:"useCases",error:void 0});const n={...e.onboardingState,useCases:Array.from(i)};Mo.default.setState(n),i.size>0&&k.trackOnboardingUseCasesSelect(e.environment,{...ko.iF(e.onboardingState),useCases:Array.from(i)})},error:i.useCases,focus:"useCases"===r,styles:m,disabled:p}),a()(Re.Z,{style:{width:"100%",marginTop:24},isLarge:!0,onClick:h,disabled:p},void 0,p?a()(yi.Z,{isWhite:!0}):a()(w.FormattedMessage,{defaultMessage:"Continue",id:"OnboardingPersonaSurveyStage.continueButton.label",description:"Button label to continue to the next step"})),a()(Le.Z,{isLarge:!0,onClick:async function(){u(!0),k.trackOnboardingPersonaSurveyAction(e.environment,{...ko.iF(e.onboardingState),selection:{userRole:t.role,userPersona:t.function,useCases:Array.from(t.useCases)},action:"back",plan_selection:e.onboardingState.planSelection}),await yo.lp(e.environment,{...e.onboardingState,back:!0,skip:!1,previousStage:"company_survey"})},style:m.backButtonStyle,disabled:p},void 0,a()(w.FormattedMessage,{defaultMessage:"Back",id:"OnboardingPersonaSurvey.backButton.label",description:"Button label to back to previous step"})),a()("div",{style:{height:140}})))))))};class tu extends l.Z{constructor(){super(...arguments),this.handleNextClick=async()=>{await yo.lp(this.environment,this.props.onboardingState);const{userPersona:e,userRole:t,useCases:o}=this.props.onboardingState;k.trackOnboardingPersonaSurveyAction(this.environment,{selection:{userPersona:e,userRole:t,useCases:o},action:"submit",plan_selection:this.props.onboardingState.planSelection,...this.getAnalyticsData()})},this.handleSkip=()=>{yo.lp(this.environment,{...this.props.onboardingState,skip:!0});const{userPersona:e,userRole:t,useCases:o}=this.props.onboardingState;k.trackOnboardingPersonaSurveyAction(this.environment,{selection:{userPersona:e,userRole:t,useCases:o},action:"skip",plan_selection:this.props.onboardingState.planSelection,...this.getAnalyticsData()})},this.handleBack=()=>{yo.lp(this.environment,{...this.props.onboardingState,back:!0});const{userPersona:e,userRole:t,useCases:o}=this.props.onboardingState;k.trackOnboardingPersonaSurveyAction(this.environment,{selection:{userPersona:e,userRole:t,useCases:o},action:"back",plan_selection:this.props.onboardingState.planSelection,...this.getAnalyticsData()})},this.handleUseCasesEdit=e=>{const{useCases:t}=this.props.onboardingState,o=new Set(t);t.includes(e)?o.delete(e):o.add(e),Mo.default.setState({...this.props.onboardingState,useCases:Array.from(o)}),k.trackOnboardingUseCasesSelect(this.environment,{...this.getAnalyticsData(),useCases:Array.from(o)})}}didMount(){k.trackOnboardingDebugStageRender(this.environment,this.getAnalyticsData())}renderComponent(){var e;const t=a()(w.FormattedMessage,{defaultMessage:"Tell us about yourself",id:"onboardingSurvey.title",description:"Onboarding persona collection step title"}),o=a()(w.FormattedMessage,{defaultMessage:"We'll customize your Notion experience based on your choice.",id:"onboardingSurvey.subtitle",description:"Onboarding persona collection step subtitle"}),{device:i,ThemeStore:n}=this.environment,r=this.shouldShowWorkSurvey(),s=this.shouldShowStudentSurvey(),l=this.shouldShowWorkSurvey();if(i.isMobile)return a()(zp,{title:t,subtitle:o,showNextButton:!0,disableNextButton:!!r&&!this.validatePersonaSurveyInputs(),handleNextClick:this.handleNextClick,showBackButton:!1,renderUnderNext:this.renderButtonBelowContinue(r?"back":"skip")},"mobile_persona_survey",a()("div",{style:{marginBottom:32}},void 0,this.renderForm({showStudentSurvey:s,showOnboardingCompanySizeQuestion:l})));const c={width:280,alignSelf:"center"};if("on"===(null===(e=this.props.onboardingState.onboardingExperiments)||void 0===e?void 0:e.onboarding_creator_no_joinable_spaces))switch(this.props.onboardingState.planSelection){case"team":return a()(eu,{onboardingState:this.props.onboardingState,environment:this.environment,companyName:this.props.onboardingState.spaceName||""});case"school":case"personal":default:throw new Error(`Unexpected plan selection ${this.props.onboardingState.planSelection}`)}return a()(wp,{title:t,subtitle:o,illustrationUrl:ko.tr("ada-1",n),footer:a()("div",{style:c},void 0,a()(Re.Z,{style:{width:"100%"},isLarge:!0,onClick:this.handleNextClick,disabled:!!r&&!this.validatePersonaSurveyInputs()},void 0,a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingSurvey.continueButton.label",description:"Button label to submit persona collection in onboarding"})),this.renderButtonBelowContinue(r?"back":"skip"))},"onboarding_workspace_use_case_setup",a()("div",{style:c},void 0,this.renderForm({showStudentSurvey:s,showOnboardingCompanySizeQuestion:l})))}validatePersonaSurveyInputs(){var e;return!this.props.onboardingState.planSelection||("team"!==this.props.onboardingState.planSelection||Boolean(this.props.onboardingState.userPersona&&this.props.onboardingState.useCases&&this.props.onboardingState.userRole&&"unfilled"!==this.props.onboardingState.userPersona&&(null===(e=this.props.onboardingState.useCases)||void 0===e?void 0:e.length)>0&&"unfilled"!==this.props.onboardingState.userRole))}renderForm(e){const{showOnboardingCompanySizeQuestion:t,showStudentSurvey:o}=e,i={...ko.YH,marginTop:12},{device:n}=this.environment;return s.createElement(s.Fragment,null,a()("div",{style:i},void 0,a()(Ve.Z,{isSmall:!0,isMobile:n.isMobile},void 0,a()(w.FormattedMessage,{defaultMessage:"What kind of work do you do?",id:"onboardingSurvey.persona.label",description:"Onboarding question prompt for new users on their profession"}))),o?this.renderPersonaSelection("school"):this.renderPersonaSelection("work"),o?null:s.createElement(s.Fragment,null,a()("div",{style:i},void 0,a()(Ve.Z,{isSmall:!0,isMobile:n.isMobile},void 0,a()(w.FormattedMessage,{defaultMessage:"What is your role?",id:"onboardingSurvey.teamRole.label",description:"Onboarding question prompt for new users on their role in the organization"}))),this.renderFunctionSelection()),t?s.createElement(s.Fragment,null,a()("div",{style:i},void 0,a()(Ve.Z,{isSmall:!0,isMobile:n.isMobile},void 0,a()(w.FormattedMessage,{defaultMessage:"What is the size of your company?",id:"onboardingSurvey.companySize.label",description:"Onboarding question prompt for new users on their Notion use case"}))),this.renderCompanySizeSelection()):null,a()("div",{style:i},void 0,a()(Ve.Z,{isSmall:!0,isMobile:n.isMobile},void 0,a()(w.FormattedMessage,{defaultMessage:"What are you planning to do in Notion?",id:"onboardingSurvey.useCase.label",description:"Onboarding question prompt for new users on their Notion use case"}))),this.renderUsecaseSelection())}renderButtonBelowContinue(e){const{device:t}=this.environment;return a()(Le.Z,{isLarge:!0,onClick:"skip"===e?this.handleSkip:this.handleBack,style:{width:"100%",justifyContent:"center",color:this.theme.lightTextColor,marginTop:8,height:t.isMobile?44:32}},void 0,a()(w.FormattedMessage,"skip"===e?{defaultMessage:"Skip",id:"onboardingSurvey.cancelButton.label",description:"Button label to skip persona collection step"}:{defaultMessage:"Back",id:"onboardingSurvey.backButton.label",description:"Button label to back to previous step"}))}renderPersonaSelection(e){return a()(gp.ZP,{questionType:e,title:a()(w.FormattedMessage,{defaultMessage:"Your function",id:"onboardingSurvey.persona.popuplabel",description:"Onboarding question prompt for new users on their function"}),question:"personal"===this.props.onboardingState.userPersona?void 0:this.props.onboardingState.userPersona,randomizeSelectionOrder:!0,invalid:!1,onSelect:e=>{Mo.default.setState({...this.props.onboardingState,userPersona:e}),k.trackOnboardingPersonaSelect(this.environment,{...this.getAnalyticsData(),persona:e})},className:ni.IAq,workFunctionOptionsVersion:void 0})}renderFunctionSelection(){return a()(gp.ZP,{questionType:"role",title:a()(w.FormattedMessage,{defaultMessage:"Your role",id:"onboardingSurvey.teamRole.popuplabel",description:"Onboarding question prompt for new users on their role in the organization"}),question:this.props.onboardingState.userRole,invalid:!1,onSelect:e=>{Mo.default.setState({...this.props.onboardingState,userRole:e}),k.trackOnboardingRoleSelect(this.environment,{...this.getAnalyticsData(),role:e})},className:ni.Mpz})}renderCompanySizeSelection(){return a()(gp.ZP,{questionType:"companySize",title:a()(w.FormattedMessage,{defaultMessage:"Company size...",id:"onboardingSurvey.companySize.popuplabel",description:"Onboarding question prompt for new users on their company size"}),question:this.props.onboardingState.companySize,randomizeSelectionOrder:!1,invalid:!1,onSelect:e=>{Mo.default.setState({...this.props.onboardingState,companySize:e}),k.trackOnboardingCompanySizeSelect(this.environment,{...this.getAnalyticsData(),companySize:e})},className:ni.Aur})}renderUsecaseSelection(){const{useCases:e}=this.props.onboardingState,{device:t}=this.environment,{intl:o}=this.props,i={menuTitle:o.formatMessage({defaultMessage:"Using Notion for...",id:"onboardingSurvey.useCase.popuplabel",description:"Onboarding question prompt for new users on their Notion use case"}),items:Object.keys(ou),width:280,getKey:e=>e,selectedItem:void 0,originGap:4,onSelect:this.handleUseCasesEdit,dontCloseParentOnSelect:!0,renderItem:t=>s.createElement(Ji.Z,n()({icon:a()(ks.Z,{checked:e.includes(t.value),size:16,onClick:()=>this.handleUseCasesEdit(t.value)}),title:ou[t.value],className:`${ni.J2F}-${t.value}`},t)),renderOrigin:o=>a()(Ao.Z,{isLarge:!0,onClick:e=>o.onClick(e),style:{padding:"2px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:3,border:0,transition:"box-shadow 0.3s ease",boxShadow:`0 0 0 1px ${this.theme.outlineButtonBorder}`,background:this.theme.buttonBackground},className:ni.J2F},void 0,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(Ve.Z,{isMobile:t.isMobile,isSecondaryColor:0===e.length},void 0,e.length>0?a()(w.FormattedMessage,{defaultMessage:"{count, plural, one {{useCase}} other {{count} selected}}",id:"onboardingSurvey.useCasesSelect.plural.placeholder",description:"label for select option when multiple use cases selected",values:{count:e.length,useCase:ou[Array.from(e)[0]]}}):a()(w.FormattedMessage,{defaultMessage:"Choose one or more...",id:"onboardingSurvey.useCasesSelect.placeholder",description:"empty state for selecting use cases"}))),g.Z.expand({width:10,fill:this.theme.lightIconColor}))};return s.createElement(Ns.Z,n()({key:"useCase"},i))}getAnalyticsData(){const{onboardingState:e}=this.props;return ko.iF(e)}shouldShowWorkSurvey(){return"team"===this.props.onboardingState.planSelection&&("workspace_plan_choose"===this.props.onboardingState.previousStage||"company_survey"===this.props.onboardingState.previousStage)}shouldShowStudentSurvey(){return"school"===this.props.onboardingState.planSelection}}tu.displayName="OnboardingPersonaSurvey";const ou={docs:a()(w.FormattedMessage,{id:"OnboardingSurvery.useCase.question.docs",defaultMessage:"Collaborate with others in docs",description:"Field to select work type"}),wikis:a()(w.FormattedMessage,{id:"OnboardingSurvery.useCase.question.wikis",defaultMessage:"Create a knowledge base / wiki",description:"Field to select work type"}),project:a()(w.FormattedMessage,{id:"OnboardingSurvery.useCase.question.project",defaultMessage:"Manage projects",description:"Field to select work type"}),goals:a()(w.FormattedMessage,{id:"OnboardingSurvery.useCase.question.goals",defaultMessage:"Track company goals and OKRs",description:"Field to select work type"}),notes:a()(w.FormattedMessage,{id:"OnboardingSurvey.useCase.question.notes",defaultMessage:"Write notes",description:"Field to select work type"}),ai:a()(w.FormattedMessage,{id:"OnboardingSurvey.useCase.question.ai",defaultMessage:"Write with AI",description:"Field to select work type"}),other:a()(w.FormattedMessage,{id:"OnboardingSurvery.useCase.question.other",defaultMessage:"Other",description:"Field to select work type"})},iu=(0,w.injectIntl)(tu);var nu=o(11002),ru=o(5575),au=o(73352),su=o(29637),lu=o(92059);const cu=function(e){window.__c={n:"OnboardingTooltip"};const t=(0,Ce.yK)((t=>{const o="dark"===t.mode?t.accentColors.gray[400]:t.accentColors.gray[700];return{tooltip:{width:308,padding:"12px 16px",borderRadius:5,fontWeight:400,fontSize:18,lineHeight:1.4,letterSpacing:-.154,marginBottom:2,color:t.regularInvertedTextColor,background:o,position:"absolute",top:12,...e.styles}}}),[e.styles]);return a()("div",{style:t.tooltip},void 0,e.message)},du=["companyHome","okrs"],pu=["teamspaceHome","engineeringWikiV2","productWikiV2","salesWikiV2","teamWiki","docs","projects","tasks","sprints"],uu=["quickNoteV2","personalHomeV2","taskList","journalV2","readingListV2"],mu=[];const gu=function(e){const[t,o]=(0,s.useState)(e.intent?1:0),[i,n]=(0,s.useState)(e.intent);function r(e){return e&&["school","personal"].includes(e)}(0,s.useEffect)((()=>{if(void 0!==e.intent&&e.intent!==i){if(r(e.intent)&&r(i))return void n(e.intent);o(0),function(t){switch(t){case"personal":case"school":e.triggerTooltip({tooltip:"personalOrSchool",withDelay:!0});break;case"team":e.triggerTooltip({tooltip:"generalTeamspace",withDelay:!0})}}(e.intent);const t=setTimeout((()=>{o(1),void 0!==i&&n(e.intent)}),300);mu.push(t),void 0===i&&n(e.intent)}}),[e.intent,i]);const[l,c]=(0,s.useState)(e.userFunction?1:0),[d,p]=(0,s.useState)(e.userFunction);(0,s.useEffect)((()=>{if(void 0!==e.userFunction&&e.userFunction!==d){c(0),e.triggerTooltip({tooltip:"functionTeamspace",withDelay:!0});const t=setTimeout((()=>{c(1),void 0!==d&&p(e.userFunction)}),300);mu.push(t),void 0===d&&p(e.userFunction)}}),[e.userFunction,d]);const[u,m]=(0,s.useState)({}),[h,f]=(0,s.useState)(v({userFunction:e.userFunction,companySize:e.companySize,useCases:e.useCases,intent:e.intent}));function v(e){const{userFunction:t,companySize:o,useCases:i,intent:n}=e;if("personal"===n||"school"===n)return new Set(uu);const r=new Set;if(o&&r.add("companyHome"),t&&r.add("teamspaceHome"),i.has("docs")&&r.add("docs"),i.has("notes")&&r.add("docs"),i.has("goals")&&r.add("okrs"),i.has("wikis"))switch(t){case"eng":r.add("engineeringWikiV2");break;case"product":r.add("productWikiV2");break;case"sales":r.add("salesWikiV2");break;default:r.add("teamWiki")}if(i.has("project"))switch(t){case"eng":case"productDesign":case"projectProgramMgmt":case"product":r.add("projects"),r.add("tasks"),r.add("sprints");break;default:r.add("projects"),r.add("tasks")}return r}(0,s.useEffect)((()=>{const t=h,o=Object.keys(u).reduce(((e,t)=>({...e,[t]:0})),{}),i={};const n=v({userFunction:e.userFunction,companySize:e.companySize,useCases:e.useCases,intent:e.intent});n.forEach((n=>function(n){i[n]=1,h.has(n)?o[n]=1:(t.add(n),o[n]=0,"companyHome"===n&&e.triggerTooltip({tooltip:"companySize"}))}(n))),f(t),m(o);const r=setTimeout((()=>{f(n),m(i)}),300);return()=>clearTimeout(r)}),[e.userFunction,e.useCases,e.companySize,e.intent]);const y=(0,Ce.yK)((e=>({animatedFadeIn:{transition:"opacity 0.3s ease-out"},section:{display:"flex",flexDirection:"column",gap:16},headerText:{fontSize:18,lineHeight:"20px",display:"flex",alignItems:"center"},icon:{height:31,width:31},smallIcon:{height:26,width:26,fill:e.lightIconColor},appTemplateIcon:{height:22,width:22,fill:e.lightIconColor},iconBoxGeneral:{borderRadius:4,background:"#FADEC9",width:38,height:38,display:"flex",justifyContent:"center",alignItems:"center"},iconBoxFunctionTeamspace:{borderRadius:4,background:"#D3E5EF",width:38,height:38,display:"flex",justifyContent:"center",alignItems:"center"},teamspace:{display:"flex",alignItems:"center",paddingRight:20,width:"100%"},ellipsis:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},templateRowEmoji:{display:"flex",alignItems:"center",marginRight:8,width:22,height:22}})),[]),b={private:a()(w.FormattedMessage,{id:"onboarding.Preview.private",defaultMessage:"Private",description:"Text to indicate this is the user's private space, in the preview of their new Notion app"}),teamspaces:a()(w.FormattedMessage,{id:"onboarding.Preview.teamspaces",defaultMessage:"Teamspaces",description:"Text to indicate this is the list of teamspaces, in the preview of their new Notion app"})},S=a()(w.FormattedMessage,{id:"onboarding.Preview.general",defaultMessage:"General",description:"Name of the general default teamspace"});function k(t){const o=a()("div",{style:{...y.teamspace,opacity:"teamspaceHome"===t?l:u[t]?1:0,...y.animatedFadeIn,gap:4}},void 0,g.Z.chevronRightRoundedThin(y.smallIcon),a()(Ve.Z,{isSecondaryColor:!0,style:{...y.headerText,fontSize:22,lineHeight:"26px"}},void 0,function(t){let o,i,n,r;switch(t){case"companyHome":return s.createElement(s.Fragment,null,a()("span",{style:{...y.templateRowEmoji}},void 0,a()("img",{src:nu.Y.companyHomeV2.icon,style:y.smallIcon})),a()("span",{style:{...y.ellipsis}},void 0,a()(w.FormattedMessage,{id:"onboarding.Preview.template.companyHome",defaultMessage:"{workspaceName} Home",description:"Name of a Notion-made template we'll give users in onboarding",values:{workspaceName:e.workSpaceName}})));case"docs":r=Et.Z.images.appPackages.docsIconSvg,n=ru.sY.docsCollectionName;break;case"projects":r=Et.Z.images.appPackages.projectsIconSvg,n=su.sY.projectsCollectionName;break;case"tasks":r=Et.Z.images.appPackages.taskDbIconSvg,n=su.sY.tasksCollectionName;break;case"sprints":r=Et.Z.images.appPackages.sprintsDbIconSvg,n=au.sY.sprintsCollectionName;break;case"teamspaceHome":r=nu.Y.teamHomeV2.icon,n=(0,hr.wJ)(d);break;case"okrs":case"engineeringWikiV2":case"productWikiV2":case"salesWikiV2":case"teamWiki":case"quickNoteV2":case"personalHomeV2":case"taskList":case"journalV2":case"readingListV2":i=nu.Y[t].icon,i||(o=nu.Y[t].emoji),n=nu.Y[t].nameMessage}if(n){if(o)return s.createElement(s.Fragment,null,a()("span",{style:{...y.templateRowEmoji}},void 0,a()(lu.Z,{char:o||""})),a()("span",{style:{...y.ellipsis}},void 0,s.createElement(w.FormattedMessage,n)));if(r)return s.createElement(s.Fragment,null,a()("span",{style:{...y.templateRowEmoji}},void 0,a()("img",{src:r,style:y.appTemplateIcon})),a()("span",{style:{...y.ellipsis}},void 0,s.createElement(w.FormattedMessage,n)));if(i)return s.createElement(s.Fragment,null,a()("span",{style:{...y.templateRowEmoji}},void 0,a()("img",{src:i,style:y.smallIcon})),a()("span",{style:{...y.ellipsis}},void 0,s.createElement(w.FormattedMessage,n)))}}(t)));return"companyHome"===t?a()("div",{},void 0,a()("div",{style:{position:"relative"}},void 0,a()(cu,{message:a()(w.FormattedMessage,{id:"onboarding.Preview.companyHomeTooltip",defaultMessage:"We added a template that companies of your size use often",description:"Tooltip to let users know that we've added a company home template"}),styles:{opacity:e.tooltipOpacities.companySize,...y.animatedFadeIn,top:36}})),o):o}switch(i){case"personal":case"school":return a()("div",{style:{opacity:t,...y.animatedFadeIn,fontSize:22,lineHeight:"26px"}},void 0,a()("div",{style:y.section},void 0,uu.map((e=>k(e)))),a()(cu,{message:a()(w.FormattedMessage,{id:"onboarding.Preview.personalNotesTemplateTooltip",defaultMessage:"We've added some templates to help you get started",description:"Tooltip to let users know that we've added some templates to their workspace"}),styles:{...y.animatedFadeIn,position:"relative",opacity:e.tooltipOpacities.personalOrSchool}}));case"team":return a()("div",{style:{...y.section,opacity:t,...y.animatedFadeIn,fontSize:22,lineHeight:"26px"}},void 0,(C=b.teamspaces,a()(Ve.Z,{isSecondaryColor:!0,style:y.headerText},void 0,C)),a()("div",{style:{display:"flex",alignItems:"end"}},void 0,a()("div",{style:{position:"relative"}},void 0,a()(cu,{message:a()(w.FormattedMessage,{id:"onboarding.Preview.generalTeamspaceTooltip",defaultMessage:"We've added a {generalSpaceName} space for you to organize company-wide docs in",description:"Tooltip to let users know that we've added a teamspace called 'General'",values:{generalSpaceName:a()("b",{},void 0,S)}}),styles:{opacity:e.tooltipOpacities.generalTeamspace,...y.animatedFadeIn}})),a()("div",{style:y.teamspace},void 0,a()("div",{style:{...y.iconBoxGeneral,marginRight:16}},void 0,a()("img",{src:"/icons/home_orange.svg",style:y.icon})),a()(Ve.Z,{isSecondaryColor:!0,style:{...y.headerText,fontSize:22,lineHeight:"26px"}},void 0,S))),du.map((e=>h.has(e)&&k(e))),d&&s.createElement(s.Fragment,null,a()("div",{style:{opacity:l,...y.animatedFadeIn}},void 0,a()("div",{style:{display:"flex",alignItems:"end"}},void 0,a()("div",{style:{position:"relative"}},void 0,a()(cu,{message:a()(w.FormattedMessage,{id:"onboarding.Preview.functionTeamspaceTooltip",defaultMessage:"We've added a place for your team to add docs to",description:"Tooltip to let users know that we've added a teamspace for them based on their user function"}),styles:{opacity:e.tooltipOpacities.functionTeamspace,...y.animatedFadeIn}})),a()("div",{style:y.teamspace},void 0,a()("div",{style:{...y.iconBoxFunctionTeamspace,flex:"none",marginRight:16}},void 0,a()("img",{src:(0,hr.FA)(d),style:y.icon})),a()(Ve.Z,{isSecondaryColor:!0,style:{...y.headerText,...y.ellipsis,display:"block",fontSize:22,lineHeight:"26px"}},void 0,(0,hr.xY)(Ge.default.getIntl(),d)))))),pu.map((e=>h.has(e)&&k(e))));case void 0:return s.createElement(s.Fragment,null);default:throw new Error(`Invalid intent selection: ${i}`)}var C};const hu=function(){window.__c={n:"ThreeDots"};const e={boxSizing:"border-box",width:19,height:19,borderRadius:45};return a()("div",{style:{display:"flex",gap:12,position:"absolute",top:0,left:0,paddingTop:20,paddingLeft:20,height:80,width:340,background:"linear-gradient(180deg, #F7F7F5 50%, rgba(217, 217, 217, 0) 90.5%)",zIndex:1,borderRadius:"8px 0px 0px 0px"}},void 0,a()("div",{style:{...e,border:"0.5px solid #D2564B",background:"#EE6B60"}}),a()("div",{style:{...e,border:"0.5px solid #D8A74E",background:"#F5BE4F"}}),a()("div",{style:{...e,border:"0.5px solid #62AD4D",background:"#63C655"}}))};const fu=function(e){window.__c={n:"TopNav"};const[t,o]=(0,s.useState)(e.spaceName);(0,s.useEffect)((()=>{e.spaceName!==t&&("company_survey"===e.stage?function(t){n(0),e.triggerTooltip({tooltip:"spaceName",withDelay:!0});const i=setTimeout((()=>{n(1),o(t)}),300)}(e.spaceName):function(e){n(0);const t=setTimeout((()=>{n(1),o(e)}),300)}(e.spaceName))}),[e.stage,e.spaceName,t]);const[i,n]=(0,s.useState)(1),r=(0,Ce.yK)((t=>({grayBox:{width:28,height:28,background:t.lightIconColor,borderRadius:10,opacity:.3},icon:{width:22,height:22,fill:t.onboardingExpandIconColor},fakeSettings:{display:"flex",flexDirection:"column",gap:18,marginTop:19},fakeRow:{display:"flex",flexDirection:"row",gap:15,alignItems:"center"},fakeIcon:{width:20,height:20,fill:t.lightIconColor,opacity:.8},fakeGrayRectangle:{width:216,height:24,background:t.lightIconColor,borderRadius:4,opacity:.15},spaceNameFadeIn:{opacity:i,transition:"opacity 0.3s ease-out"},spaceNameTooltipFadeIn:{opacity:e.tooltipOpacities.spaceName,transition:"opacity 0.3s ease-out"}})),[i,e.tooltipOpacities]);return a()("div",{},void 0,a()("div",{style:{display:"flex",gap:15,alignItems:"center"}},void 0,a()("div",{style:{display:"flex",alignItems:"end"}},void 0,a()("div",{style:{position:"relative"}},void 0,t&&a()(cu,{message:a()(w.FormattedMessage,{id:"onboarding.Preview.spaceNameTooltip",defaultMessage:"We've updated your workspace name to {spaceName}",description:"Tooltip to let users know that we've added a workspace name (which is their Company Name)",values:{spaceName:a()("b",{},void 0,t)}}),styles:r.spaceNameTooltipFadeIn})),a()("div",{style:r.grayBox})),a()("div",{style:{textOverflow:"ellipsis",overflow:"hidden",maxWidth:180,fontSize:22,whiteSpace:"nowrap",lineHeight:"24px",...r.spaceNameFadeIn}},void 0,t||a()(w.FormattedMessage,{id:"onboarding.Preview.spaceNamePlaceholder",defaultMessage:"New space",description:"Placeholder name of the space that we show the user in a preview of their new Space"})),g.Z.expand({...r.icon,...r.spaceNameFadeIn})),a()("div",{style:r.fakeSettings},void 0,a()("div",{style:r.fakeRow},void 0,g.Z.sidebarSearch(r.fakeIcon),a()("div",{style:r.fakeGrayRectangle})),a()("div",{style:r.fakeRow},void 0,g.Z.sidebarUpdates(r.fakeIcon),a()("div",{style:r.fakeGrayRectangle})),a()("div",{style:r.fakeRow},void 0,g.Z.openTeamThick(r.fakeIcon),a()("div",{style:r.fakeGrayRectangle})),a()("div",{style:r.fakeRow},void 0,g.Z.sidebarSettings(r.fakeIcon),a()("div",{style:r.fakeGrayRectangle}))))},vu=["spaceName","companySize","generalTeamspace","personalOrSchool","functionTeamspace"];let yu=[];const bu=function(e){window.__c={n:"Preview"};const t="planSelection"in e.onboardingState?e.onboardingState.planSelection:void 0,o=(0,N.VK)((()=>{const t=Ge.default.getIntl(),o="onboardingData"in e.onboardingState?e.onboardingState.onboardingData.userStore.getFullName(t):void 0;return o?ko.eW(o,t):void 0}),[e.onboardingState]),i="spaceName"in e.onboardingState?e.onboardingState.spaceName:void 0,n="team"===t?i:"personal"===t||"school"===t?o:void 0,r=vu.reduce(((e,t)=>({...e,[t]:0})),{}),[l,c]=(0,s.useState)(r);function d(e){c({...r,[e]:1});for(var t=0;t<yu.length;t++)clearTimeout(yu[t]);yu=[];const o=setTimeout((()=>{c({...r,[e]:0})}),5e3);yu.push(o)}function p(e){const{tooltip:t,withDelay:o}=e;if(1!==l[t])if(Object.values(l).includes(1)||o){c(r);const e=setTimeout((()=>{d(t)}),300);yu.push(e)}else d(t)}const[u,m]=(0,s.useState)({}),g="shouldTriggerPostInviteAnimations"in e.onboardingState&&e.onboardingState.shouldTriggerPostInviteAnimations;(0,s.useEffect)((()=>{switch(e.stage){case"workspace_plan_choose":m({top:"20vh",left:"60vw",height:"80vh",width:"40vw"});break;case"company_survey":m({top:"15vh",left:"60vw",height:"85vh",width:"40vw"});break;case"persona_survey":m({top:"10vh",left:"60vw",height:"90vh",width:"40vw"});break;case"invite":m(g?{height:"166vh",width:"166vw",top:"-33vh",left:"-33vw",transform:"scale(0.6)",zIndex:1}:{height:"140vh",width:"140vw",top:"-20vh",left:"28vw",transform:"scale(0.6)"})}}),[e.stage,g]);const h=(0,Ce.yK)((e=>({rightPanel:{width:"50%",background:e.onboardingPreviewBackground},mockScreen:{position:"absolute",transition:"all 0.8s ease-out",background:e.contentBackground,color:e.darkTextColor,boxShadow:`0px 6px 24px 0px ${e.lightTextColor}`,border:"1px solid",borderColor:e.outlineButtonBorder,borderRadius:"8px 0px 0px 8px",userSelect:"none",...u},sidebar:{background:e.onboardingPreviewBackground,width:340,minWidth:340,height:"100%",paddingLeft:20,paddingTop:20,borderRadius:"8px 0px 0px 8px",overflow:"scroll",paddingBottom:60},biggerRectangle:{background:"#FEF8EE",height:290,width:"100%"},grayRectangle:{background:e.lightIconColor,width:"100%",marginLeft:52,borderRadius:4,opacity:.15}})),[u]);return a()("div",{style:h.rightPanel},void 0,a()("div",{style:{}},void 0,a()("div",{style:h.mockScreen},void 0,a()("div",{style:{display:"flex",flexDirection:"row",width:"100%",height:"100%",opacity:"shouldTriggerPostInviteAnimations"in e.onboardingState&&e.onboardingState.shouldTriggerPostInviteAnimations?0:1,transition:"opacity 1s ease-out"}},void 0,a()("div",{style:h.sidebar},void 0,a()("div",{style:{paddingBottom:52}},void 0,a()(hu,{})),a()("div",{style:{paddingBottom:60}},void 0,a()(fu,{stage:e.stage,spaceName:n,tooltipOpacities:l,triggerTooltip:p})),a()(gu,{intent:t,userFunction:"userPersona"in e.onboardingState?e.onboardingState.userPersona:void 0,companySize:"companySize"in e.onboardingState&&void 0!==e.onboardingState.companySize,role:"userRole"in e.onboardingState?e.onboardingState.userRole:void 0,useCases:"useCases"in e.onboardingState?new Set(e.onboardingState.useCases):new Set,workSpaceName:i,tooltipOpacities:l,triggerTooltip:p})),a()("div",{style:{display:"flex",flexDirection:"column",width:"100%",opacity:"companySize"in e.onboardingState&&void 0!==e.onboardingState.companySize?1:0,transition:"opacity 0.3s ease-out"}},void 0,a()("div",{style:h.biggerRectangle}),a()("div",{style:{...h.grayRectangle,height:62,marginTop:47}}),a()("div",{style:{...h.grayRectangle,height:40,marginTop:28}}),a()("div",{style:{...h.grayRectangle,height:40,marginTop:28}}))))))};var Su=o(80994),wu=o(96068),ku=o(53471);class Cu extends To.Z{getInitialState(){return{showPassword:!1,displayPasswordInput:!0}}}const _u=Cu;var Mu=o(81865),Tu=o(7458);class Iu extends l.Z{constructor(){super(...arguments),this.handleCloseClick=()=>{yo.VW(this.environment)}}renderComponent(){const{onboardingData:e}=this.props.onboardingState,t=e.userStore.getEmail();if(e.userStore.isDefined())return a()("div",{style:{paddingTop:32}},void 0,a()(Ve.Z,{isSmall:!0,style:{lineHeight:1.5}},void 0,a()(w.FormattedMessage,{defaultMessage:"You're creating an account for {userEmail}.{br}If you don't intend to set up a new account, you can <closelink>log in with another email.</closelink>",id:"onboarding.desktopLogoutOption.text",values:{userEmail:a()("span",{style:{fontWeight:500}},void 0,t),closelink:e=>a()(Ne.Z,{onClick:this.handleCloseClick},void 0,e),br:a()("br",{})}})))}}Iu.displayName="OnboardingDesktopLogout";const Pu=Iu;function xu(){window.__c={n:"OnboardingDesktopLogout_exp01"};const e=(0,V.O7)();function t(){yo.VW(e)}return a()("div",{style:{paddingTop:12}},void 0,a()(Ve.Z,{isMultiline:!0,isSmall:!0,isSecondaryColor:!0,style:{lineHeight:1.5}},void 0,a()(w.FormattedMessage,{defaultMessage:"If you don't intend to set up a new account, you can <closelink>log in with another email.</closelink>",id:"onboardingProfile.desktopLogoutOption.text",description:"Give users the option to stop onboarding and log out if they want to switch emails.",values:{closelink:e=>a()(Ne.Z,{onClick:t,style:{fontWeight:fo.Z.fontWeight.semibold}},void 0,e)}})))}function Bu(e){window.__c={n:"OnboardingEmailConsentCheckbox"};const{countryCode:t,onClick:o,emailOptIn:i}=e;if(!(0,N.VK)((()=>R.default.checkGate("onetrust_onboarding_checkbox")),[]))return null;const n="out"===(0,Su.Aw)(t).opt,r=a()(w.FormattedMessage,n?{id:"onboardingEmailConsent.checkbox.optOutlabel",defaultMessage:"No, I do not want to receive marketing communications from Notion.",description:"Checkbox on sign up flow allowing users to opt in/out of receiving marketing communications from Notion"}:{id:"onboardingEmailConsent.checkbox.optInlabel",defaultMessage:"I agree to Notion sending marketing communications about Notion to me.",description:"Checkbox on sign up flow allowing users to opt in/out of receiving marketing communications from Notion"});return a()("div",{style:{marginTop:20}},void 0,a()("div",{onClick:o,style:{cursor:"pointer",display:"flex",alignItems:"center"}},void 0,a()(ks.Z,{checked:n?!i:i,size:12,style:{margin:10,marginLeft:0},onClick:o}),a()(Ve.Z,{isMultiline:!0,isSmall:!0,isSecondaryColor:!0},void 0,r)))}function Zu(e){window.__c={n:"OnboardingEmailConsentCopy"};const{countryCode:t}=e;if(!(0,N.VK)((()=>R.default.checkGate("onetrust_onboarding_checkbox")),[]))return null;let o;return o="doubleIn"===(0,Su.Aw)(t).opt?"https://privacyportal.onetrust.com/ui/#/preferences/multipage/login/85da1f3a-9621-4cdf-a38b-0c15137a20c5":"https://privacyportal.onetrust.com/ui/#/preferences/multipage/login/06108214-ebec-46eb-ba8b-20521af00794",a()(Ve.Z,{isMultiline:!0,isSmall:!0,isSecondaryColor:!0,style:{marginTop:20}},void 0,a()(w.FormattedMessage,{id:"onboardingEmailConsent.unsubscribe.label",defaultMessage:"You may <unsubscribe>unsubscribe</unsubscribe> from receiving marketing communications at any time. Notion's websites and communications are subject to our <privacypolicy>Privacy Policy</privacypolicy>.",description:"Text on sign up flow below the marketing communications opt in/out checkbox telling users how to unsubscribe and linking them to Notion's privacy policy",values:{unsubscribe:e=>a()(Ne.Z,{href:o,external:!0,onClick:e=>e.stopPropagation(),style:{fontWeight:fo.Z.fontWeight.semibold}},void 0,e),privacypolicy:e=>a()(Ne.Z,{href:"https://www.notion.so/Privacy-Policy-3468d120cf614d4c9014c09f6adc9091",external:!0,onClick:e=>e.stopPropagation(),style:{fontWeight:fo.Z.fontWeight.semibold}},void 0,e)}}))}var Eu=o(70411);class Ru extends l.Z{renderComponent(){const{userTeamRole:e}=this.props.onboardingState,{intl:t}=this.props,o={menuTitle:t.formatMessage({defaultMessage:"Team type",id:"onboardingTeamRoleSelect.teamTypeMenu.title"}),items:Array.from(Eu.sE).filter((e=>"unfilled"!==e)),width:280,getKey:e=>e,selectedItem:e,originGap:4,onSelect:e=>{Mo.default.setState({...this.props.onboardingState,userTeamRole:e})},renderItem:e=>s.createElement(Ji.Z,n()({title:this.getTeamRoleMessage(e.value)},e)),renderOrigin:t=>a()(Ao.Z,{isLarge:!0,onClick:e=>t.onClick(e),style:{padding:"2px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:3,border:0,transition:"box-shadow 0.3s ease",boxShadow:`0 0 0 1px ${this.theme.outlineButtonBorder}`,background:this.theme.buttonBackground,...this.getInputStyle()}},void 0,a()("div",{style:{display:"flex",alignItems:"center",color:e?this.theme.regularTextColor:this.theme.lightTextColor},className:"notranslate"},void 0,e?this.getTeamRoleMessage(e):a()(w.FormattedMessage,{defaultMessage:"Select team role",id:"onboardingTeamRoleSelect.teamRoleSelect.placeholder"})),g.Z.expand({width:10,fill:this.theme.lightIconColor}))};return s.createElement(Ns.Z,n()({key:"onboarding"},o))}getTeamRoleMessage(e){switch(e){case"company_lead":return a()(w.FormattedMessage,{defaultMessage:"C-level or VP",id:"onboardingTeamRoleSelect.teamRoleSelect.companyLead"});case"org_lead":return a()(w.FormattedMessage,{defaultMessage:"Department lead",id:"onboardingTeamRoleSelect.teamRoleSelect.orgLead"});case"team_lead":return a()(w.FormattedMessage,{defaultMessage:"Team lead",id:"onboardingTeamRoleSelect.teamRoleSelect.teamLead"});case"not_lead":return a()(w.FormattedMessage,{defaultMessage:"I don't manage a team",id:"onboardingTeamRoleSelect.teamRoleSelect.notLead"})}}getInputStyle(){const{device:e}=this.environment;return{backgroundColor:this.theme.whiteButtonBackground,height:31,...e.isMobile&&{height:42}}}}Ru.displayName="OnboardingTeamRoleSelect";const Au=(0,w.injectIntl)(Ru);class Du extends l.Z{constructor(){super(...arguments),this.storeTypes={store:_u},this.renderPasswordErrorMessage=e=>{if(!e)return null;const t=Uo.Ql[e.type];return a()(w.FormattedMessage,{id:t.id,defaultMessage:t.defaultMessage})},this.handleNextClick=async()=>{const{onboardingState:e,intl:t}=this.props,{name:o,password:i}=e;if(!o)return void yo.EV(this.environment,new TypeError(t.formatMessage({id:"onboardingProfile.nameUndefinedError.message",defaultMessage:"Name is not filled out."})));if(this.stores.store.state.displayPasswordInput&&!i)return void yo.EV(this.environment,new TypeError(t.formatMessage({id:"onboardingProfile.passwordUndefinedError.message",defaultMessage:"Password is not filled out."})));const n={...e,userPersona:e.userPersona||"unfilled",userTeamRole:e.userTeamRole||"unfilled",password:i||"",name:o,emailOptIn:e.emailOptIn};await yo.lp(this.environment,n)},this.handleSubmit_exp01=async e=>{const{onboardingState:t}=this.props,{name:o,password:i,emailOptIn:n}=e,r={...t,userPersona:t.userPersona||"unfilled",userTeamRole:t.userTeamRole||"unfilled",password:i,name:o,emailOptIn:n};await yo.lp(this.environment,r)},this.handleUploadProfilePhoto=()=>{ku.cR({environment:this.environment,bucket:"public",onStart:this.handleProfileUploadStart,onError:this.handleProfileUploadError,onComplete:e=>this.handleProfileUploadComplete(e),accept:"image/*"})},this.handleProfileUploadComplete=e=>{k.trackOnboardingUploadProfilePhoto(this.environment,ko.iF(Mo.default.state)),Mo.default.setState({...this.props.onboardingState,profilePhoto:e[0],uploadingProfilePhoto:!1})},this.handleProfileUploadStart=()=>{Mo.default.setState({...this.props.onboardingState,uploadingProfilePhoto:!0})},this.handleProfileUploadError=()=>{Mo.default.setState({...this.props.onboardingState,uploadingProfilePhoto:!1});const{intl:e}=this.props;pe.showErrorMessage(e.formatMessage({defaultMessage:"Upload failed.",id:"onboardingProfile.dialogError.photoUploadFailure.message"}))},this.handlePasswordChange=e=>{Mo.default.setState({...this.props.onboardingState,password:e.target.value,passwordErrorData:null})},this.handleClearPassword=()=>{Mo.default.setState({...this.props.onboardingState,password:void 0,passwordErrorData:null})},this.handlePasswordBlur=()=>{const{password:e}=this.props.onboardingState;if(e){const t=(0,wu.I)(e);t.success||Mo.default.setState({...this.props.onboardingState,passwordErrorData:t.reason})}},this.handleSubmit=()=>{const e=this.getInvalidField();Boolean(e)?this.stores.store.setState({...this.stores.store.state,invalidField:e}):this.handleNextClick()}}async didMount(){k.trackOnboardingDebugStageRender(this.environment,ko.iF(this.props.onboardingState)),this.props.onboardingState.uploadingProfilePhoto&&Mo.default.setState({...this.props.onboardingState,uploadingProfilePhoto:!1});const e=await me.shouldCreatePassword(this.environment)&&!ko.vA();this.stores.store.setState({...this.stores.store.state,displayPasswordInput:e})}renderComponent(){const{device:e}=this.environment;if(e.isMobile)return this.renderMobile();var t;if("on"===(null===(t=this.props.onboardingState.onboardingExperiments)||void 0===t?void 0:t.onboarding_creator_no_joinable_spaces)){var o;const t=null===(o=E.default.state.currentUserStore)||void 0===o?void 0:o.getEmail();return t?a()(Lu,{countryCode:this.props.onboardingState.onboardingData.countryCode,email:t,passwordRequired:this.stores.store.state.displayPasswordInput,handleSubmit:this.handleSubmit_exp01,device:e}):(yo.EV(this.environment,new TypeError(this.props.intl.formatMessage({id:"onboardingProfile.missingEmail.message",defaultMessage:"Your account does not have an email. Please contact support.",description:"Message to ask users to contact support since there is a Notion error."}))),s.createElement(s.Fragment,null))}return this.renderDesktop()}renderMobile(){return a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity},void 0,a()(zp,{showNextButton:!0,title:a()(w.FormattedMessage,{defaultMessage:"Welcome to Notion",id:"onboardingProfile.mobileStage.title"}),subtitle:a()(w.FormattedMessage,{defaultMessage:"First, tell us a bit about yourself.",id:"onboardingProfile.mobileStage.subtitle"}),handleNextClick:this.handleNextClick,disableNextButton:this.shouldDisableNext(),showBackButton:!0},"mobile_profile",this.renderNameForm(!0),this.renderSaveNewPassword(),this.shouldCollectTeamRole()&&s.createElement(s.Fragment,null,a()("div",{style:{...ko.YH,marginTop:12}},void 0,a()(w.FormattedMessage,{defaultMessage:"Role on your team",id:"onboardingWorkspaceCreate.roleOnTeam.label"})),a()(Au,{onboardingState:this.props.onboardingState})),a()(Bu,{countryCode:this.props.onboardingState.onboardingData.countryCode,onClick:()=>{Mo.default.setState({...this.props.onboardingState,emailOptIn:!this.props.onboardingState.emailOptIn})},emailOptIn:this.props.onboardingState.emailOptIn}),a()(Zu,{countryCode:this.props.onboardingState.onboardingData.countryCode}),a()("div",{style:{marginBottom:12}})))}renderDesktop(){const{profilePhoto:e,uploadingProfilePhoto:t}=this.props.onboardingState,{ThemeStore:o}=this.environment;return a()(wp,{title:a()(w.FormattedMessage,{defaultMessage:"Welcome to Notion",id:"onboardingProfile.stage.title"}),subtitle:a()(w.FormattedMessage,{defaultMessage:"First things first, tell us a bit about yourself.",id:"onboardingProfile.stage.subtitle"}),illustrationUrl:ko.tr("ada-1",o)},"profile",a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity,onEnter:this.handleSubmit},void 0,a()(s.Fragment,{},void 0,a()("div",{style:{width:280,alignSelf:"center"}},void 0,a()(ot.Z,{onClick:()=>this.handleUploadProfilePhoto(),style:{width:64,height:64,borderRadius:"100%",boxShadow:this.theme.avatarBoxShadow,overflow:"hidden",margin:"0 auto"}},void 0,a()(Mu.Z,{url:e||"/tutorial/empty-avatar.png",isAuthenticated:!1,width:120,stripGoogleIconQuery:!0,render:(e,t)=>a()(Mp.Z,{src:t,style:{width:"100%",height:"100%",objectFit:"cover"}})})),a()("div",{style:{width:"100%",textAlign:"center",marginTop:8}},void 0,a()("div",{style:{display:"inline-block"}},void 0,a()(Le.Z,{isSmall:!0,isGray:!0,onClick:()=>this.handleUploadProfilePhoto(),style:{fontSize:12,fontWeight:500,marginTop:4}},void 0,a()(w.FormattedMessage,t?{defaultMessage:"Uploading…",id:"onboardingProfile.uploading.text"}:e?{defaultMessage:"Change",id:"onboardingProfile.changeProfilePhotoButton.label"}:{defaultMessage:"Add a photo",id:"onboardingProfile.addProfilePhotoButton.label"})))),this.renderNameForm(!1),this.renderSaveNewPassword(),this.shouldCollectTeamRole()&&s.createElement(s.Fragment,null,a()("div",{style:{...ko.YH,marginTop:12}},void 0,a()(w.FormattedMessage,{defaultMessage:"Role on your team",id:"onboardingWorkspaceCreate.roleOnTeam.label"})),a()(Au,{onboardingState:this.props.onboardingState})),a()(Bu,{countryCode:this.props.onboardingState.onboardingData.countryCode,onClick:()=>{Mo.default.setState({...this.props.onboardingState,emailOptIn:!this.props.onboardingState.emailOptIn})},emailOptIn:this.props.onboardingState.emailOptIn}),a()(Re.Z,{style:{marginTop:28,width:"100%"},isLarge:!0,disabled:this.shouldDisableNext(),onClick:this.handleNextClick},void 0,a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingProfile.continueButton.label"})),a()(Zu,{countryCode:this.props.onboardingState.onboardingData.countryCode}),a()(xu,{})))))}renderNameForm(e){const{intl:t}=this.props,{name:o}=this.props.onboardingState;return e?s.createElement(s.Fragment,null,a()("div",{style:this.getMobileFormLabelStyle()},void 0,a()(w.FormattedMessage,{defaultMessage:"What should we call you?",id:"onboardingProfile.mobileNameQuestion.label",description:"How we ask for the user's name during onboarding. It's up to the user whether it will be full name or a nickname."})),a()(Wo.Z,{autoFocus:!0,placeholder:t.formatMessage({defaultMessage:"e.g. Ada Lovelace, Ada, AL",id:"onboardingProfile.mobileNameInput.placeholder",description:"Examples of what users can enter in the name field during onboarding, using variations of the name Ada Lovelace, a pioneer of computer science."}),value:o,onChange:e=>{Mo.default.setState({...this.props.onboardingState,name:e.target.value})},style:{marginRight:4,...this.getInputStyle(),..."name"===this.stores.store.state.invalidField?ko.Fz:{}}})):s.createElement(s.Fragment,null,a()("div",{style:{...ko.YH,marginTop:12}},void 0,a()(w.FormattedMessage,{defaultMessage:"What should we call you?",id:"onboardingProfile.nameQuestion.label",description:"How we ask for the user's name during onboarding. It's up to the user whether it will be full name or a nickname."})),a()(Wo.Z,{focusInitial:!0,value:o,placeholder:t.formatMessage({defaultMessage:"e.g. Ada Lovelace, Ada, AL",id:"onboardingProfile.nameInput.placeholder",description:"Examples of what users can enter in the name field during onboarding, using variations of the name Ada Lovelace, a pioneer of computer science."}),onChange:e=>{Mo.default.setState({...this.props.onboardingState,name:e.target.value})},style:{marginRight:4,...this.getInputStyle(),..."name"===this.stores.store.state.invalidField?ko.Fz:{}}}))}renderSaveNewPassword(){if(!this.stores.store.state.displayPasswordInput)return;let e;const{currentUserStore:t}=E.default.state,{intl:o}=this.props;if(null!=t&&t.isDefined()&&(e=t.getEmail()),!e)return;const{password:i,passwordErrorData:n}=this.props.onboardingState,{isMobile:r}=this.environment.device;return a()(s.Fragment,{},void 0,a()(Wo.Z,{style:{display:"none"},type:"text",value:e,autoComplete:"username",disabled:!0}),a()("div",{style:this.environment.device.isMobile?this.getMobileFormLabelStyle():{...ko.YH,marginTop:12}},void 0,a()(w.FormattedMessage,{defaultMessage:"Set a password",id:"onboardingProfile.passwordInput.label"})),a()(Wo.Z,{type:this.stores.store.state.showPassword?"text":"password",value:i||void 0,onChange:this.handlePasswordChange,onIconClick:()=>this.stores.store.setState({showPassword:!this.stores.store.state.showPassword,displayPasswordInput:this.stores.store.state.displayPasswordInput}),icon:g.Z.eye({width:r?18:16,height:r?18:16,fill:this.theme.lightIconColor}),onClearButtonClick:this.handleClearPassword,placeholder:o.formatMessage({defaultMessage:"New password",id:"onboardingProfile.passwordInput.placeholder"}),style:{...this.getInputStyle(),..."password"===this.stores.store.state.invalidField?ko.Fz:{}},onBlur:this.handlePasswordBlur,autoComplete:"new-password"}),a()("div",{style:{marginTop:4,position:"relative"}},void 0,a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,lineHeight:"16px",visibility:i?void 0:"hidden",color:m.ZP.red}},void 0,this.renderPasswordErrorMessage(n))))}shouldCollectTeamRole(){const{userPersona:e}=this.props.onboardingState;return!!e&&!["student","freelancer","educator","entrepreneur"].includes(e)}getInvalidField(){const{name:e,password:t}=this.props.onboardingState;return e?!this.stores.store.state.displayPasswordInput||t&&!Boolean(t&&!(0,wu.I)(t).success)?void 0:"password":"name"}shouldDisableNext(){return Boolean(this.getInvalidField())}getInputStyle(){const{device:e}=this.environment;return{backgroundColor:this.theme.whiteButtonBackground,height:31,...e.isMobile&&{height:42}}}getMobileFormLabelStyle(){return{fontSize:12,color:this.theme.mediumTextColor,fontWeight:500,marginTop:20,marginBottom:4}}}Du.displayName="OnboardingProfile";const Fu=(0,w.injectIntl)(Du);const Lu=(0,w.injectIntl)((function(e){const{email:t,passwordRequired:o,handleSubmit:i,device:n,countryCode:r}=e,l=(0,N.VK)((()=>R.default.checkGate("onetrust_onboarding_checkbox")),[]),[c,d]=(0,s.useState)({name:"",password:"",emailOptIn:l&&(0,Su.Aw)(r).defaultOptIn}),[p,u]=(0,s.useState)({name:void 0,password:void 0}),[m,g]=(0,s.useState)(void 0),h=(0,Ce.yK)((e=>({formInputStyle:{display:"flex",alignItems:"center",width:"100%",fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,position:"relative",borderRadius:4,boxShadow:e.inputBoxShadow,cursor:"text",backgroundColor:e.whiteButtonBackground,height:31,transition:"box-shadow 0.3s ease-out"},formLabelStyle:{color:e.mediumTextColor,fontSize:12,lineHeight:"14px",marginBottom:12},errorFormInputStyle:{boxShadow:e.outlineRedInputBoxShadow},hintText:{fontSize:12,color:e.lightTextColor}})),[]);function f(e){const{field:t,error:o}=e;if(void 0===o)u({...p,[t]:void 0});else{const e=Object.keys(p).reduce(((e,t)=>(e[t]=void 0,e)),{});u({...e,[t]:o})}}async function v(){const e=Object.keys(p).find((e=>void 0!==p[e]));"name"!==e&&"password"!==e?!y()&&(f({field:"name",error:a()(w.FormattedMessage,{defaultMessage:"Please fill out your name.",id:"onboardingProfile.nameUndefinedError.message_exp01",description:"Error message to let users know they need to fill out the name field."})}),g("name"),1)||o&&!(c.password?b():(f({field:"password",error:a()(w.FormattedMessage,{defaultMessage:"Please fill out your password.",id:"onboardingProfile.passwordUndefinedError.message_exp01",description:"Error message to let users know they need to fill out the name field."})}),g("password"),0))||await i({name:c.name.trim(),password:c.password,emailOptIn:c.emailOptIn}):g(e)}function y(){const e=c.name.trim();return d({...c,name:e}),e}function b(){const e=(0,wu.I)(c.password);if(e.success)return!0;{const t=Uo.Ql[e.reason.type];return f({field:"password",error:a()(w.FormattedMessage,{id:t.id,defaultMessage:t.defaultMessage})}),!1}}return(0,s.useEffect)((()=>{if(m){const e=setTimeout((()=>{g(void 0)}),100);return()=>clearTimeout(e)}}),[m]),s.createElement(s.Fragment,null,a()(wp,{title:a()(w.FormattedMessage,{defaultMessage:"Create your account",id:"onboardingProfile.stage.title_exp01",description:"Title text for the Profile stage in onboarding"}),subtitle:a()(w.FormattedMessage,{defaultMessage:"You're signing up as {email}",id:"onboardingProfile.stage.subtitle_exp01",values:{email:a()("b",{},void 0,t)},description:"Subtitle text for the Profile stage in onboarding"})},"profile",a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity,onEnter:v},void 0,a()("div",{style:{position:"fixed",top:n.isElectron?40:13,left:20}},void 0,a()(Tu.Z,{analyticsName:"onboarding"})),a()("div",{style:{width:370,alignSelf:"center"}},void 0,a()(Vu,{name:c.name,setName:e=>{d({...c,name:e}),f({field:"name",error:void 0})},error:p.name,focus:"name"===m,styles:h,trimName:y}),o&&a()(Ou,{email:t,password:c.password,setPassword:e=>{d({...c,password:e}),f({field:"password",error:void 0})},error:p.password,checkPassword:b,focus:"password"===m,styles:h}),a()(Bu,{countryCode:r,onClick:()=>{d({...c,emailOptIn:!c.emailOptIn})},emailOptIn:c.emailOptIn}),a()(Re.Z,{style:{marginTop:24,width:"100%"},isLarge:!0,onClick:v},void 0,a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingProfile.continueButton.label"})),a()(Zu,{countryCode:r}),a()(xu,{})))))}));const Vu=(0,w.injectIntl)((function(e){const{name:t,setName:o,intl:i,styles:n,error:r,focus:l}=e;return s.createElement(s.Fragment,null,a()("div",{style:n.formLabelStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"Full name",id:"onboardingProfile.nameQuestion.label_exp01",description:"Label for asking users for their full name in onboarding Profile stage."})),a()(Wo.Z,{focusInitial:!0,value:t,format:1,focus:l||void 0,placeholder:i.formatMessage({defaultMessage:"e.g. Ada Lovelace, Charles Dickens",id:"onboardingProfile.nameInput.placeholder_exp01",description:"Examples of what users can enter in the name field during onboarding, which include first and last name, using two famous peoples names as examples"}),onChange:e=>{o(e.target.value)},style:{...n.formInputStyle,...r?n.errorFormInputStyle:{}},onBlur:e.trimName}),a()("div",{style:{marginTop:4,marginBottom:8,height:16,position:"relative"}},void 0,r&&a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,color:m.ZP.red}},void 0,r)))}));function Nu(e){return window.__c={n:"HiddenPasswordManagerField"},a()(Wo.Z,{style:{display:"none"},type:"text",value:e.email,autoComplete:"username",disabled:!0})}const Ou=(0,w.injectIntl)((function(e){const{email:t,intl:o,password:i,styles:n,setPassword:r,checkPassword:l,error:c,focus:d}=e,[p,u]=(0,s.useState)(!1),h=(0,Ce.yK)((e=>({icon:{width:16,height:16,fill:e.lightIconColor}})),[]);return s.createElement(s.Fragment,null,a()(Nu,{email:t}),a()("div",{style:n.formLabelStyle},void 0,a()(w.FormattedMessage,{defaultMessage:"Password",id:"onboardingProfile.passwordInput.label_exp01",description:"Form label for password field"})),a()(Wo.Z,{type:p?"text":"password",format:1,value:i,onChange:e=>{r(e.target.value)},focus:d||void 0,onIconClick:()=>u(!p),icon:g.Z.eye(h.icon),placeholder:o.formatMessage({defaultMessage:"New password",id:"onboardingProfile.passwordInput.placeholder"}),style:{...n.formInputStyle,...c?n.errorFormInputStyle:{}},onBlur:l,autoComplete:"new-password"}),a()("div",{style:{marginTop:8,marginBottom:0,position:"relative"}},void 0,c?a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,color:m.ZP.red}},void 0,c):a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:n.hintText},void 0,a()(w.FormattedMessage,{defaultMessage:"Must have a number, letter, and be at least 8 characters long",id:"onboardingProfile.passwordInput.subtext",description:"Password input helper text to tell the user the requirements for the password"}))))})),Uu=(0,w.defineMessages)({disabledSpaceCreationTooltipWithEmailDomain:{id:"onboardingWorkspaceChoose.stage.disabledSpaceCreationTooltipWithEmailDomain",defaultMessage:"Workspace creation has been disabled by your organization, {emailDomain}. Please join an existing workspace.",description:"Onboarding step tooltip to indicate that a user cannot create a new workspace because their organization has disabled it."},disabledSpaceCreationTooltip:{id:"onboardingWorkspaceChoose.stage.disableSpaceCreationTooltip",defaultMessage:"Workspace creation has been disabled by your organization. Please join an existing workspace.",description:"Onboarding step tooltip to indicate that a user cannot create a new workspace because their organization has disabled it."}});class Hu extends l.Z{constructor(){super(...arguments),this.handleJoinSpaceClick=(e,t,o)=>{var i;let n,r;if(!e.canJoinSpace&&e.guestPageIds.length>0){r="guest";const t={type:"guest_redirect",pageId:e.guestPageIds[0],spaceId:e.id};n={...this.props.onboardingState,spaceId:e.id,redirectData:t,spaceJoinOrCreate:"join"}}else r="member",n={...this.props.onboardingState,spaceId:e.id,spaceJoinOrCreate:"join"};k.trackOnboardingJoinSpaceClick(this.environment,{...ko.iF(n),join_space_type:r,joined_space_id:e.id,joined_space_index:t,joined_space_variant:o,joined_space_from_domain:e.canJoinSpace,joined_space_has_invite:e.guestPageIds.length>0,num_of_joinable_spaces:(null===(i=this.props.onboardingState.joinableSpaces)||void 0===i?void 0:i.length)||0}),Mo.default.setState(n),yo.lp(this.environment,n)},this.handleCreateSpaceClick=()=>{const e={...this.props.onboardingState,spaceJoinOrCreate:"create"};Mo.default.setState(e),yo.lp(this.environment,e)}}didMount(){k.trackOnboardingDebugStageRender(this.environment,ko.iF(this.props.onboardingState)),k.trackWorkspaceCreationAbilityFromOnboarding(this.environment,{can_user_create_space:this.props.onboardingState.onboardingData.canUserCreateSpace,is_new_user:this.props.onboardingState.isNewUser,has_joinable_spaces:!0,onboarding_stage:this.props.onboardingState.stage})}renderComponent(){const{device:e}=this.environment,{joinableSpaces:t,onboardingData:o}=this.props.onboardingState;if(0===t.length)throw new Error("Unexpected state. There should always be at least 1 joinable space from the workspace chooser.");if(e.isMobile)return this.renderMobile(t,o.canUserCreateSpace);{const e=this.props.onboardingState.onboardingData.userStore.getEmail();return this.renderDesktop(t,o.canUserCreateSpace,e?(0,ae.Gd)(e):void 0)}}renderDesktop(e,t,o){const i=e?e.length:0,{ThemeStore:n}=this.environment,r=a()(w.FormattedMessage,t?{defaultMessage:"{numberOfWorkspaces, plural, one {You've been invited to {numberOfWorkspaces} workspace. Join it, or create a new one.} other {You've been invited to {numberOfWorkspaces} workspaces. Pick one to join, or create a new one.}}",id:"onboardingWorkspaceChoose.stage.subtitle",values:{numberOfWorkspaces:i}}:{defaultMessage:"{numberOfWorkspaces, plural, one {You've been invited to {numberOfWorkspaces} workspace.} other {You've been invited to {numberOfWorkspaces} workspaces. Pick one to join.}}",id:"onboardingWorkspaceChoose.stage.subtitleWithNoCreateOption",values:{numberOfWorkspaces:i},description:"Subtitle encouraging the user to join one of the joinable workspaces explicitly without encouraging workspace creation."}),s=a()(w.FormattedMessage,{defaultMessage:"Join your teammates on Notion",id:"onboardingWorkspaceChoose.stage.title"});return a()(wp,{title:s,subtitle:r,illustrationUrl:ko.tr("ada-2",n)},"onboarding_workspace_choose",a()("div",{style:{width:300,alignSelf:"center"}},void 0,a()("div",{},void 0,this.renderWorkspaceJoinSpaces(e),t?this.renderCreateSpace({canUserCreateSpace:t}):a()(Ai.Z,{delayThreshold:0,renderTooltip:()=>o?Ge.default.formatMessage(Uu.disabledSpaceCreationTooltipWithEmailDomain,{emailDomain:o}):Ge.default.formatMessage(Uu.disabledSpaceCreationTooltip),render:e=>this.renderCreateSpace({canUserCreateSpace:t,tooltipEvents:e})}))))}renderMobile(e,t){const o=e?e.length:0,i=a()(w.FormattedMessage,{defaultMessage:"{numberOfWorkspaces, plural, one {Looks like you've been invited to{br}<boldtext>{numberOfWorkspaces} workspace</boldtext>, let's join it!} other {Looks like you've been invited to{br}<boldtext>{numberOfWorkspaces} workspaces</boldtext>, let's join one!}}",id:"onboardingWorkspaceChoose.mobileStage.subtitle",values:{br:a()("br",{}),numberOfWorkspaces:o,boldtext:e=>a()("b",{},void 0,e)}});return a()(zp,{showNextButton:!1,title:a()(w.FormattedMessage,{defaultMessage:"Join a workspace",id:"onboardingWorkspaceChoose.mobileStage.title"}),subtitle:i,showBackButton:ko.jF(this.props.onboardingState)},"mobile-choose",this.renderWorkspaceJoinSpaces(e),t&&this.renderCreateSpace({canUserCreateSpace:t}))}renderWorkspaceJoinSpaces(e){const{joinableSpaceGroup:t}=this.props.onboardingState;return"on"===t?this.renderWorkspaceJoinSpacesWithMemberInfo(e):e&&a()("div",{},void 0,e.map(((e,t)=>a()(Op,{style:{width:"100%",marginBottom:10},onClick:()=>{this.handleJoinSpaceClick(e,t,"control")}},e.id,g.Z.team({width:14,marginRight:6}),a()("div",{style:{minWidth:0,overflow:"hidden",textOverflow:"ellipsis"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Join <boldtext>{workspaceName}</boldtext>",id:"onboardingWorkspaceChoose.joinWorkspaceButton.label",values:{workspaceName:e.name,boldtext:e=>a()("b",{},void 0,e)}})),g.Z.chevronRight({marginLeft:"auto",width:15})))))}renderCreateSpace(e){const{canUserCreateSpace:t,tooltipEvents:o,disableBoxShadow:i}=e;return s.createElement(Ao.Z,n()({style:{marginTop:4,width:"100%",background:this.theme.whiteButtonBackground,whiteSpace:"normal",textAlign:"center",...i?void 0:{boxShadow:this.theme.lightBoxShadow}},disabled:!t,onClick:()=>{t&&this.handleCreateSpaceClick()},isLarge:!0},o),a()(w.FormattedMessage,{defaultMessage:"Create new workspace",id:"onboardingWorkspaceChoose.createSpaceOption.message"}))}renderWorkspaceJoinSpacesWithMemberInfo(e){if(e&&0!==e.length)return a()("div",{},void 0,e.map(((e,t)=>{var o;return a()(Op,{style:this.getOnboardingButtonV2Style(),disabled:!1,useNonDisableColorWhenDisabled:!0,hoveredStyle:{background:"rgba(55, 53, 47, 0.03)"},pressedStyle:{background:"rgba(55, 53, 47, 0.06)"},onClick:()=>{this.handleJoinSpaceClick(e,t,"on")}},e.id,a()("div",{style:this.getWorkspaceContainerV2Style()},void 0,a()("div",{style:this.getWorkspaceSpaceInformationV2Style()},void 0,a()("div",{style:this.getWorkspaceIconV2Style()},void 0,a()(Do.Z,{disabled:!0,bucket:"public",icon:this.getIcon(e),isEmptyPage:!1,title:e.name,size:36}),a()("div",{style:this.getWorkspaceTextV2Style()},void 0,a()("div",{style:this.getWorkspaceNameV2Style()},void 0,a()(w.FormattedMessage,{defaultMessage:"{workspaceName}",id:"onboardingWorkspaceChoose.chooseWorkspaceButton.label",description:"Button containing the workspace name. This workspace can be selected to join.",values:{workspaceName:e.name}})),a()("div",{style:this.getWorkspaceMemberCountV2Style()},void 0,a()(w.FormattedMessage,{defaultMessage:"{memberCount, plural, one {{memberCount} member} other {{memberCount} members}}",id:"onboardingWorkspaceChoose.joinWorkspaceButton.memberCount.label",values:{memberCount:e.totalMemberCount||1}})))),a()("div",{},void 0,a()("span",{style:this.getWorkspaceJoinButtonV2Style()},void 0,a()(w.FormattedMessage,{defaultMessage:"Join",id:"onboardingWorkspaceChoose.joinWorkspaceButton.join.label"})))),a()("div",{style:this.getUserAvatarContainerV2Style()},void 0,null==e||null===(o=e.topMembers)||void 0===o?void 0:o.map((e=>a()(Oi.Z,{userValue:e,size:24,avatarShouldShowShadow:!1,style:{marginRight:"7px"},isOffline:!1,hasTooltip:!this.environment.device.isMobile}))))))})))}getIcon(e){if(e.id&&e.spaceIcon)return{pointer:{table:"space",id:e.id},icon:e.spaceIcon}}getWorkspaceNameV2Style(){return{fontWeight:500,fontSize:16,whiteSpace:"normal",overflowWrap:"break-word"}}getWorkspaceTextV2Style(){return{display:"flex",flexDirection:"column",justifyContent:"start",marginLeft:"14px",maxWidth:"200px"}}getWorkspaceJoinButtonV2Style(){return{backgroundColor:"rgba(0, 0, 0, 0.025)",padding:"4px 10px",borderRadius:"10px",fontWeight:600,cursor:"pointer"}}getWorkspaceMemberCountV2Style(){return{color:this.theme.lightTextColor,marginTop:"4px",fontWeight:400,fontSize:14}}getWorkspaceIconV2Style(){return{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}}getWorkspaceSpaceInformationV2Style(){return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"}}getUserAvatarContainerV2Style(){return{display:"flex",flexDirection:"row",justifyContent:"start",marginTop:"16px",overflow:"hidden"}}getWorkspaceContainerV2Style(){return{display:"flex",flexDirection:"column",justifyContent:"start",width:"100%"}}getOnboardingButtonV2Style(){return{width:"100%",padding:"14px",height:"auto",marginBottom:10,borderRadius:5}}}Hu.displayName="OnboardingWorkspaceChoose";const zu=Hu;class Wu extends To.Z{getInitialState(){return{useCases:gt().shuffle([ys.rz,ys.DH,ys.Xs])}}}const ju=Wu;class Ku extends l.Z{constructor(){super(...arguments),this.storeTypes={store:ju},this.handleNextClick=async()=>{const{onboardingState:e,intl:t}=this.props,{spaceName:o,useCases:i}=e;let{userType:n,userPersona:r}=e;if(r||(r="unfilled"),n||(n="unknown"),!o)return void yo.EV(this.environment,new TypeError(t.formatMessage({id:"onboardingWorkspaceCreate.fieldUndefinedError.message",defaultMessage:"Workspace create field is undefined."})));const a={userPersona:r,...e,spaceName:o,userType:n,useCases:i};await yo.lp(this.environment,a)},this.handleIconUploadComplete=e=>{const{onboardingState:t}=this.props;k.trackOnboardingUploadSpaceIcon(this.environment,{...ko.iF(t),spaceIcon:e}),Mo.default.setState({...t,spaceIcon:e||null,uploadingSpaceIcon:!1})},this.handleSubmit=()=>{const e=this.getInvalidField();Boolean(e)?this.stores.store.setState({...this.stores.store.state,invalidField:e}):this.handleNextClick()}}didMount(){k.trackOnboardingDebugStageRender(this.environment,ko.iF(this.props.onboardingState))}renderComponent(){const e=a()(w.FormattedMessage,{defaultMessage:"Create a team workspace",id:"onboardingWorkspaceCreate.stage.team.title"}),t=a()(w.FormattedMessage,{defaultMessage:"Fill in some details for your teammates.",id:"onboardingWorkspaceCreate.stage.subtitle"}),{device:o,ThemeStore:i}=this.environment;return o.isMobile?a()(zp,{showNextButton:!0,disableNextButton:this.shouldDisableNext(),handleNextClick:this.handleNextClick,title:e,subtitle:t,showBackButton:ko.jF(this.props.onboardingState)},"mobile-workspace-create",this.renderForm()):a()(wp,{title:e,subtitle:t,illustrationUrl:ko.tr("ada-1",i)},"profile",this.renderForm())}renderForm(){const{spaceIcon:e,spaceName:t}=this.props.onboardingState,{intl:o}=this.props,i=e?{pointer:{table:"space",id:"undefined"},icon:e}:void 0;return a()(vi.Z,{capture:!0,onLeft:gt().identity,onRight:gt().identity,onSelectAll:gt().identity,onRedo:gt().identity,onUndo:gt().identity,onCut:gt().identity,onCopy:gt().identity,onPaste:gt().identity,onKeypress:gt().identity,onDelete:gt().identity,onBackspace:gt().identity,onTab:gt().identity,onEnter:this.handleSubmit},void 0,a()("div",{style:{...this.environment.device.isMobile?{}:{width:280},alignSelf:"center"}},void 0,!this.environment.device.isMobile&&a()("div",{style:{width:180,overflow:"hidden",margin:"0 auto"}},void 0,a()("div",{style:this.getRecordIconWrapperStyle()},void 0,a()(Do.Z,{bucket:"public",disabled:!1,icon:i,isEmptyPage:!1,title:t||"Notion",size:70,iconLoggingData:{recordTable:"space",source:"onboarding_workspace_create"},onChange:this.handleIconUploadComplete}),this.renderButtonLabel())),a()("div",{style:{...ko.YH,color:this.theme.mediumTextColor,marginTop:16}},void 0,a()(w.FormattedMessage,{defaultMessage:"Workspace name",id:"onboardingWorkspaceCreate.workspaceNameInput.label"})),a()(Wo.Z,{focusInitial:!0,value:t,placeholder:o.formatMessage({defaultMessage:"Acme Inc.",id:"onboardingWorkspaceCreate.workspaceNameInput.placeholder",description:"Placeholder for a generic company name, used when a user is creating a new company workspace. Please feel free to use some locale-specific equivalent placeholder, instead of the direct translation of 'Acme Inc.'"}),onChange:e=>{Mo.default.setState({...this.props.onboardingState,spaceName:e.target.value})},style:{marginRight:4,...this.getInputStyle(),..."space_name"===this.stores.store.state.invalidField?ko.Fz:{}}}),a()("div",{style:{marginTop:4}},void 0,a()(Ve.Z,{isMultiline:!0,isSmall:!0},void 0,a()(w.FormattedMessage,{defaultMessage:"The name of your company or organization.",id:"onboardingWorkspaceCreate.workspaceNameInput.hint"}))),!this.environment.device.isMobile&&a()(Re.Z,{style:{marginTop:20,width:"100%"},isLarge:!0,disabled:this.shouldDisableNext(),onClick:this.handleNextClick},void 0,a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingWorkspaceCreate.nextButton.labelInvite"}))))}renderButtonLabel(){return a()("div",{style:this.getButtonLabelStyle()},void 0,a()(w.FormattedMessage,{defaultMessage:"Choose icon",id:"onboarding.workspaceCreate.buttonLabel.title"}))}getInvalidField(){const{spaceName:e}=this.props.onboardingState;if(!e)return"space_name"}shouldDisableNext(){return Boolean(this.getInvalidField())}getInputStyle(){const{device:e}=this.environment;return{backgroundColor:this.theme.whiteButtonBackground,height:31,...e.isMobile&&{height:42}}}getRecordIconWrapperStyle(){return{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",marginRight:4}}getButtonLabelStyle(){return{fontSize:12,fontWeight:500,marginTop:4,color:this.theme.mediumTextColor}}}Ku.displayName="OnboardingWorkspaceCreate";const Yu=(0,w.injectIntl)(Ku);class Gu extends l.Z{constructor(){super(...arguments),this.handleChooseIntent=e=>{const t=rm[e],o={...this.props.onboardingState,planSelection:t};Mo.default.setState(o)},this.handleClickContinue=async e=>{const{environment:t}=this,o=rm[e],i={...this.props.onboardingState,back:!1,skip:!1,previousStage:"onboarding_profile",planSelection:o};k.trackOnboardingPlanTypeSelect(t,{...ko.iF(i),planType:o}),await yo.lp(t,i)},this.handleNextClick=async()=>{const{environment:e}=this,{onboardingState:t}=this.props,o=t.planSelection;void 0!==o?(k.trackOnboardingPlanTypeSelect(e,{...ko.iF(t),planType:o}),await yo.lp(e,t)):Yi.log({level:"error",from:"OnboardingWorkspacePlanChoose",type:"unexpectedValue",error:{message:"Unexpected Value: onboardingState.planSelection is undefined."}})}}didMount(){k.trackOnboardingDebugStageRender(this.environment,ko.iF(this.props.onboardingState))}renderComponent(){const{onboardingState:e}=this.props,{device:t,ThemeStore:o}=this.environment,i=e.planSelection;return t.isMobile?a()(zp,{title:a()(w.FormattedMessage,{defaultMessage:"I’m using Notion…",id:"onboardingWorkspacePlanChoose.mobileStep.title"}),subtitle:a()(w.FormattedMessage,{defaultMessage:"We’ll streamline your setup experience accordingly.",id:"onboardingWorkspacePlanChoose.mobileStep.subtitle"}),showNextButton:!0,disableNextButton:void 0===i,handleNextClick:this.handleNextClick,showBackButton:ko.jF(this.props.onboardingState)},"mobile_plan",a()(Xu,{onboardingState:this.props.onboardingState,userType:i})):"on"===(null===(n=e.onboardingExperiments)||void 0===n?void 0:n.onboarding_creator_no_joinable_spaces)?a()(sm,{intent:e.planSelection&&am[e.planSelection],handleClickContinue:this.handleClickContinue,handleChooseIntent:this.handleChooseIntent,showVerifiedDomainNotice:e.onboardingData.isUserUsingVerifiedDomain,email:e.onboardingData.userStore.getEmail(),name:e.onboardingData.userStore.getFullName(Ge.default.getIntl()),animateProgressBarBack:"back"in e&&e.back}):a()(wp,{title:a()(w.FormattedMessage,{defaultMessage:"How are you planning to use Notion?",id:"onboardingWorkspacePlanChoose.step.title"}),subtitle:a()(w.FormattedMessage,{defaultMessage:"We’ll streamline your setup experience accordingly.",id:"onboardingWorkspacePlanChoose.step.subtitle"}),illustrationUrl:ko.tr("ada-1",o),footer:this.props.onboardingState.prefilled&&a()(Pu,{onboardingState:this.props.onboardingState})},"onboarding_workspace_plan",a()("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},void 0,a()(Xu,{onboardingState:this.props.onboardingState,userType:i}),a()(Re.Z,{style:{width:"280px",marginBottom:42},isLarge:!0,onClick:this.handleNextClick,disabled:void 0===i},void 0,a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingWorkspacePlanChoose.continueButton.label"})),this.props.onboardingState.onboardingData.isUserUsingVerifiedDomain&&a()(Ve.Z,{isSmall:!0,isMultiline:!0,style:{fontSize:14,fontWeight:400,color:this.theme.selectLightGray[700],position:"relative",textAlign:"center",paddingBottom:42,marginLeft:"auto",marginRight:"auto",maxWidth:520}},void 0,a()(w.FormattedMessage,{defaultMessage:"You are currently logged in as <bold>{email}</bold>. By creating this workspace, you accept that it can be managed by the owners of the email domain <bold>{emailDomain}</bold>. See <domainclaimlink>this page</domainclaimlink> for more info.",id:"onboardingWorkspacePlanChoose.verifiedDomain.byline",description:"A message informing the user that the workspaces they create are eligible to be managed by an enterprise organization",values:{email:this.props.onboardingState.onboardingData.userStore.getEmail()??"",emailDomain:ko.Of(this.props.onboardingState.onboardingData)??"",bold:e=>a()("b",{},void 0,e),domainclaimlink:e=>a()(Ne.Z,{href:(0,ol.UY)("guides.domainManagement"),external:!0},void 0,e)}}))));var n}}function Xu(e){window.__c={n:"Chooser"};const{userType:t,onboardingState:o}=e,i=(0,V.O7)(),[n,r]=(0,s.useState)(t);return a()(s.Fragment,{},void 0,a()("div",{style:qu(i)},void 0,a()(ot.Z,{style:$u(i,"team"===n),hoveredStyle:{opacity:1,background:"white"},pressedStyle:{opacity:1,background:"white"},onClick:()=>im(o,"team",r),className:ni.Voi},void 0,a()("img",{src:"team"===n?Et.Z.images.onboarding.checkedSvg:Et.Z.images.onboarding.uncheckedSvg,style:tm(i)}),a()("div",{style:om(i)},void 0,a()("img",{src:Et.Z.images.onboarding.teamFeaturesIllustrationPng,style:{height:"100%",...i.device.isMobile?{height:48}:{}}})),a()("main",{style:Ju(i)},void 0,a()("header",{style:Qu(i)},void 0,a()(w.FormattedMessage,{defaultMessage:"For my team",id:"onboardingWorkspacePlanChoose.teamUseCaseButtonExperiment.label",description:"Line describing work use case option"})),a()("p",{style:em(i)},void 0,a()(w.FormattedMessage,{defaultMessage:"Collaborate on your docs, projects, and wikis.",id:"onboardingWorkspacePlanChoose.teamUseCaseButton.description"})))),a()(ot.Z,{style:$u(i,"personal"===n),hoveredStyle:{opacity:1,background:"white"},pressedStyle:{opacity:1,background:"white"},onClick:()=>im(o,"personal",r),className:ni.vvn},void 0,a()("img",{src:"personal"!==n?Et.Z.images.onboarding.uncheckedSvg:Et.Z.images.onboarding.checkedSvg,style:tm(i)}),a()("div",{style:om(i)},void 0,a()("img",{src:Et.Z.images.onboarding.useCaseNotePng,style:{height:"100%",...i.device.isMobile?{height:54}:{}}})),a()("main",{style:Ju(i)},void 0,a()("header",{style:Qu(i)},void 0,a()(w.FormattedMessage,{defaultMessage:"For personal use",id:"onboardingWorkspacePlanChoose.personalUseCaseButtonExperiment.label",description:"Line describing personal use case option"})),a()("p",{style:em(i)},void 0,a()(w.FormattedMessage,{defaultMessage:"Write better. Think more clearly. Stay organized.",id:"onboardingWorkspacePlanChoose.personalUseCaseButton.description"})))),a()(ot.Z,{style:$u(i,"school"===n),hoveredStyle:{opacity:1,background:"white"},pressedStyle:{opacity:1,background:"white"},onClick:()=>im(o,"school",r),className:ni.FLq},void 0,a()("img",{src:"school"!==n?Et.Z.images.onboarding.uncheckedSvg:Et.Z.images.onboarding.checkedSvg,style:tm(i)}),a()("div",{style:om(i)},void 0,a()("img",{src:Et.Z.images.onboarding.useCaseWikiPng,style:{height:"100%",...i.device.isMobile?{height:54}:{}}})),a()("main",{style:Ju(i)},void 0,a()("header",{style:Qu(i)},void 0,a()(w.FormattedMessage,{defaultMessage:"For school",id:"onboardingWorkspacePlanChoose.schoolUseCaseButton.label",description:"Label text for the School intent option"})),a()("p",{style:em(i)},void 0,a()(w.FormattedMessage,{defaultMessage:"Keep your notes, research, and tasks all in one place.",id:"onboardingWorkspacePlanChoose.schoolUseCaseButton.description",description:"Text for how you can use Notion for school"}))))))}function qu(e){return{...e.device.isMobile?{marginTop:0,marginBottom:32}:{marginTop:"10px",marginBottom:"32px"},display:e.device.isMobile?void 0:"inline-flex",width:"100%",justifyContent:"center"}}function $u(e,t){const o=(0,m.Vx)(),i={margin:12,textAlign:"center",width:230,height:280,padding:"40px 0",boxShadow:`${o.outlineButtonBorder} 0 0 0 1px, rgba(167, 167, 167, 0.25) 0px 1px 2px`},n={display:"flex",marginTop:20,padding:0,boxShadow:`${o.outlineButtonBorder} 0 0 0 1px, rgba(167, 167, 167, 0.25) 0px 1px 2px`},r={boxShadow:`${m.ZP.blue} 0 0 0 2px, rgba(182, 182, 182, 0.25) 0px 8px 12px`};return{alignItems:"center",justifyContent:"center",whiteSpace:"normal",borderRadius:5,fontSize:14,lineHeight:1.2,background:"white",position:"relative",transition:"all 200ms ease",...e.device.isMobile?n:i,...t&&r,...!t&&{opacity:.7}}}function Ju(e){return{margin:e.device.isMobile?10:20,flex:1}}function Qu(e){return{fontWeight:fo.Z.fontWeight.semibold,fontSize:e.device.isMobile?16:18,marginTop:e.device.isMobile?10:30,color:m.ZP.regularTextColor}}function em(e){const t=e.device.isMobile;return{color:m.ZP.mediumTextColor,fontSize:14,lineHeight:1.4,transition:"all 200ms ease",marginTop:t?4:12,marginBottom:8}}function tm(e){return e.device.isMobile?{order:1,marginRight:20,height:24,width:24}:{position:"absolute",top:12,right:12,height:24,width:24}}function om(e){return e.device.isMobile?{marginLeft:10,height:57,width:85,textAlign:"center"}:{height:90}}function im(e,t,o){let i,n;"personal"===t?(n="personal",i=e.onboardingData.isEducationPlanEligible?"student":"personal"):"school"===t&&(n="personal",i="student"),o(t),Mo.default.setState({...e,userPersona:i,userType:n,planSelection:t})}Gu.displayName="OnboardingWorkspacePlanChoose";const nm=Gu,rm={work:"team",school:"school",life:"personal"},am={team:"work",school:"school",personal:"life"};const sm=function(e){window.__c={n:"IntentChooseDesktopNoIntl_exp01"};const{showVerifiedDomainNotice:t,email:o,name:i}=e,[n,r]=(0,s.useState)(e.intent),[l,c]=(0,s.useState)(!1),[d,p]=(0,s.useState)(0);(0,s.useEffect)((()=>{p(1)}),[]);const u=(0,Ce.yK)((e=>({leftPanel:{width:"100%",background:e.onboardingBackground_exp01,display:"flex",justifyContent:"center"},choiceSection:{minWidth:260,maxWidth:370,marginLeft:"10%",marginRight:"10%",marginTop:"14vh"},domainClaimLabel:{fontSize:14,fontWeight:400,color:e.selectLightGray[700]}})),[]);return a()("div",{style:u.leftPanel},void 0,a()("div",{style:u.choiceSection},void 0,a()(fp,{startPercentage:e.animateProgressBarBack?50:0,endPercentage:25}),a()("div",{style:{opacity:d,transition:"opacity 0.75s ease-in-out"}},void 0,a()(wp,{title:a()("div",{style:{lineHeight:"123%",textAlign:"left"}},void 0,a()(w.FormattedMessage,{defaultMessage:"Welcome{name}! What would you like to use Notion for?",id:"onboardingWorkspacePlanChoose.step.title_exp01",values:{name:i?` ${i}`:""},description:"Title text for the Plan Choose stage to ask users to pick an intention."})),disableAutoHeight:!0,subtitleStyles:{paddingTop:8}},"onboarding_workspace_plan",a()("div",{style:{display:"flex",paddingLeft:2,paddingRight:2}},void 0,a()(lm,{selected:n?"work"===n:void 0,selectIntent:()=>{r("work"),c(!1),e.handleChooseIntent("work")}}),a()(cm,{selected:n?"life"===n:void 0,selectIntent:()=>{r("life"),c(!1),e.handleChooseIntent("life")}}),a()(dm,{selected:n?"school"===n:void 0,selectIntent:()=>{r("school"),c(!1),e.handleChooseIntent("school")}})),a()("div",{style:{marginTop:4,marginBottom:26,height:16,position:"relative",width:"100%"}},void 0,l&&a()(Ve.Z,{isMultiline:!0,isSecondaryColor:!0,style:{fontSize:12,color:m.ZP.red}},void 0,a()(w.FormattedMessage,{defaultMessage:"Please choose an option.",id:"onboardingIntent.error.optionNotChosen",description:"Error message to let users know they need to choose an option."}))),a()(Re.Z,{style:{width:"100%",marginBottom:36},isLarge:!0,onClick:async function(){n?await e.handleClickContinue(n):c(!0)}},void 0,a()(w.FormattedMessage,{defaultMessage:"Continue",id:"onboardingWorkspacePlanChoose.continueButton.label"})),t&&o&&a()(Ve.Z,{isSmall:!0,isMultiline:!0,style:u.domainClaimLabel},void 0,a()(w.FormattedMessage,{defaultMessage:"You are currently logged in as <bold>{email}</bold>. By creating this workspace, you accept that it can be managed by the owners of the email domain <bold>{emailDomain}</bold>. See <domainclaimlink>this page</domainclaimlink> for more info.",id:"onboardingWorkspacePlanChoose.verifiedDomain.byline",description:"A message informing the user that the workspaces they create are eligible to be managed by an enterprise organization",values:{email:o,emailDomain:(0,ae.Gd)(o),bold:e=>a()("b",{},void 0,e),domainclaimlink:e=>a()(Ne.Z,{href:(0,ol.UY)("guides.domainManagement"),external:!0},void 0,e)}})),a()("div",{style:{height:140}})))))};function lm(e){window.__c={n:"WorkIntentButton"};const{selected:t,selectIntent:o}=e;return a()(pm,{selected:t,selectIntent:o,className:ni.Voi,image:Et.Z.images.onboarding.intentWorkPng,style:{marginRight:8}},void 0,a()(w.FormattedMessage,{defaultMessage:"Work",id:"onboardingProfile.intentButtonLabel.work",description:"Label for the button to let users choose 'work' intent"}))}function cm(e){window.__c={n:"LifeIntentButton"};const{selected:t,selectIntent:o}=e;return a()(pm,{selected:t,selectIntent:o,className:ni.vvn,image:Et.Z.images.onboarding.useCaseNotePng,style:{marginRight:8}},void 0,a()(w.FormattedMessage,{defaultMessage:"Life",id:"onboardingProfile.intentButtonLabel.life",description:"Label for the button to let users choose 'life' intent"}))}function dm(e){window.__c={n:"SchoolIntentButton"};const{selected:t,selectIntent:o}=e;return a()(pm,{selected:t,selectIntent:o,className:ni.FLq,image:Et.Z.images.onboarding.useCaseWikiPng},void 0,a()(w.FormattedMessage,{defaultMessage:"School",id:"onboardingProfile.intentButtonLabel.school",description:"Label for the button to let users choose 'school' intent"}))}function pm(e){window.__c={n:"IntentButton"};const{selected:t,selectIntent:o,className:i,image:n,style:r,children:s}=e,l=(0,Ce.yK)((e=>({selected:{boxShadow:`${e.outlinePressedButtonBorder} 0 0 0 1.5px, rgba(182, 182, 182, 0.25) 0px 8px 12px`},unselected:{boxShadow:`${e.outlineButtonBorder} 0 0 0 1px, rgba(167, 167, 167, 0.25) 0px 1px 2px`},buttonText:{color:"black"}})),[]);return a()(ot.Z,{onClick:o,className:i,style:{maxWidth:120,maxHeight:160,padding:16,borderRadius:4,fontSize:14,textAlign:"center",background:"white",...t?l.selected:l.unselected,opacity:!1===t?.7:void 0,...r}},void 0,a()("img",{src:n,style:{maxHeight:"100%",maxWidth:"100%"}}),a()(Ve.Z,{style:l.buttonText},void 0,s))}const um={mobile_editor:1,mobile_sidebar:2},mm={mobile_desktop:3,mobile_web_clipper:4},gm={mobile_web_clipper:3,mobile_app_download:4},hm=["workspace_plan_choose","company_survey","persona_survey","invite"];function fm(){var e;window.__c={n:"Onboarding"};const t=(0,N.Kw)(Mo.default),o=(0,N.Kw)(E.default),i=(0,V.O7)(),n=(0,Ce.yK)((e=>({mobileChrome:{width:"100%",marginTop:28,marginBottom:0,maxWidth:320,marginLeft:"auto",marginRight:"auto"},errorPage:{marginTop:200,width:"100vw",height:"100%",position:"relative",display:"flex",flex:1,background:e.contentBackground},mobileDesktopVisual:{width:"100%",boxShadow:e.mediumBoxShadow,borderRadius:3}})),[]);(0,s.useEffect)((()=>{(0,pp.Vs)(3e3).then((()=>{Mo.default.getState().isOnboarding||M.navigate({environment:i,url:y._j.root,redirect:!0})}))}),[]);const{width:r}=(0,N.VK)((()=>i.WindowSizeStore.state),[i]);if(!t.isOnboarding||t.isLoading)return a()(Il.Z,{});F.wk({environment:i,onboardingState:t});const l="on"===(null===(e=t.onboardingExperiments)||void 0===e?void 0:e.onboarding_creator_no_joinable_spaces)&&t.isOnboarding&&hm.includes(t.stage)&&r>=640;return a()("div",{style:{height:"100%",width:"100%",...l?{display:"flex"}:{}}},void 0,a()("div",{style:l?{width:"50%"}:{}},void 0,function(e,t,o){if(t.isOnboarding)switch(t.stage){case"profile":return function(e){return window.__c={n:"renderProfile"},a()(Fu,{onboardingState:e})}(t);case"workspace_choose":return function(e){return window.__c={n:"renderWorkspaceChoose"},a()(zu,{onboardingState:e})}(t);case"workspace_plan_choose":return function(e){return window.__c={n:"renderWorkspacePlanChoose"},a()(nm,{onboardingState:e})}(t);case"workspace_create":return function(e){return window.__c={n:"renderWorkspaceCreate"},a()(Yu,{onboardingState:e})}(t);case"desktop_app_download":return function(e){return window.__c={n:"renderDesktopAppDownload"},a()(Ep,{onboardingState:e})}(t);case"error":return function(e,t){window.__c={n:"renderPageError"};const{onboardingData:o}=e;return a()(It,{style:t.errorPage},void 0,a()(Jo,{route:{name:"onboarding"},publicPageData:{spaceId:o.redirectSpaceId,spaceName:o.redirectSpaceName,publicAccessRole:"none"}}))}(t,o);case"template_optout":case"workspace_setup":return;case"invite":return function(e){return window.__c={n:"renderInvite"},a()(Gp,{onboardingState:e})}(t);case"mobile_editor":return function(e,t,o){window.__c={n:"renderMobileEditor"};const{device:i}=e;return a()(qp,{onboardingState:t,redirectToStart:!1,contents:a()(s.Fragment,{},void 0,a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Some essential tips:",id:"useCasemobileEditorStep.title",description:"Mobile use case tips title"})),a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"<boldtext>Touch and hold</boldtext> to reorder any content.",id:"useCasemobileEditorStep.description",description:"Mobile use case step tips description",values:{boldtext:e=>a()("b",{},void 0,e)}}))),tipNumber:um[t.stage],visual:i.isAndroid?ym(Et.Z.images.onboarding.mobileHeroAndroidGif,o):vm(Et.Z.tutorial.iosDragAndDropGif,o)})}(e,t,o);case"mobile_sidebar":return function(e,t,o){window.__c={n:"renderMobileSidebar"};const{device:i}=e;return a()(qp,{onboardingState:t,redirectToStart:!1,contents:a()(s.Fragment,{},void 0,a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"The <boldtext>sidebar menu</boldtext> keeps things organized.",id:"useCasemobileEditorSidebarStep.title",description:"Mobile sidebar step tips title",values:{boldtext:e=>a()("b",{},void 0,e)}})),a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"You'll find both workspace pages and your function pages here.",id:"useCasemobileEditorSidebarStep.description",description:"Mobile sidebar step tips description"}))),tipNumber:um[t.stage],visual:i.isAndroid?ym(Et.Z.tutorial.androidSidebarPng,o):vm(Et.Z.tutorial.iosSidebarGif,o)})}(e,t,o);case"mobile_desktop":return function(e,t){return window.__c={n:"renderMobileDesktop"},a()(qp,{onboardingState:e,redirectToStart:!1,contents:a()(s.Fragment,{},void 0,a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Notion also works on <boldtext>Mac</boldtext>, <boldtext>Windows</boldtext>, and in the <boldtext>browser</boldtext>! Everything will stay in sync across your devices.",id:"useCasemobileDesktopStep.title",description:"Desktop step tips title",values:{boldtext:e=>a()("b",{},void 0,e)}}))),tipNumber:mm[e.stage],visual:bm(t)})}(t,o);case"mobile_web_clipper":return function(e,t,o){window.__c={n:"renderMobileWebClipper"};const{device:i}=e;return a()(qp,{onboardingState:t,redirectToStart:!(0,ko.og)(e),contents:a()(s.Fragment,{},void 0,a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"<boldtext>Save web pages or local files into Notion.</boldtext>",id:"useCasemobileWebClipperStep.title",description:"Web clipper step tips title",values:{boldtext:e=>a()("b",{},void 0,e)}})),a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Just tap the share button and pick a page or a database to save to.",id:"useCasewebClipperStep.description",description:"Web clipper step tips description"}))),tipNumber:(0,ko.og)(e)?gm[t.stage]:mm[t.stage],visual:i.isAndroid?ym(Et.Z.tutorial.mobileShareSheetAndroidPng,o):vm(Et.Z.tutorial.iosNotionWebClipperGif,o)})}(e,t,o);case"mobile_app_download":return function(e,t,o){window.__c={n:"renderMobileAppDownload"};const{device:i}=e;return a()(qp,{onboardingState:t,redirectToStart:!0,contents:a()(s.Fragment,{},void 0,a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"<boldtext>Get the app</boldtext>",id:"mobileAppDownloadStep.title",description:"Mobile app download step title",values:{boldtext:e=>a()("b",{},void 0,e)}})),a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Finish setting up Notion on your mobile browser or download Notion for {os}.",id:"mobileAppDownloadStep.subTitle",description:"Mobile app download step sub title",values:{os:i.isIOS?"iOS":"Android"}}))),tipNumber:gm[t.stage],visual:i.isIOS?vm(Et.Z.images.onboarding.mobileHeroGif,o):ym(Et.Z.images.onboarding.mobileHeroGif,o),contentAboveNextButton:a()("a",{onClick:async()=>{await yo.lp(e,t)},href:i.isIOS?y._j.appStore:y._j.playStore,style:{textDecoration:"none",width:"100%",marginTop:16},target:"_blank"},void 0,a()(Re.Z,{style:{width:"100%",height:42}},void 0,i.isIOS?g.Z.appleLogo({fill:"currentColor",width:16,height:16,marginRight:6}):g.Z.androidLogo({fill:"currentColor",width:16,height:16,marginRight:6}),a()(w.FormattedMessage,{defaultMessage:"Download Notion",id:"mobileAppDownloadStep.button",description:"Download Notion button"}))),canSkipStep:!0})}(e,t,o);case"company_survey":return function(e,t){return window.__c={n:"renderOnboardingCompanySurvey"},a()(kp,{onboardingState:t,environment:e})}(e,t);case"persona_survey":return function(e){return window.__c={n:"renderOnboardingPersonaSurvey"},a()(iu,{onboardingState:e})}(t);default:Xa.t1(t)}}(i,t,n),"rendered"===o.renderPhase&&a()(Z.LazyAppComponents,{})),l&&a()(bu,{onboardingState:t,stage:t.stage}))}function vm(e,t){return window.__c={n:"renderiOSPreview"},a()(mp,{format:"IphoneX",style:t.mobileChrome},void 0,a()("img",{src:e,style:{width:"100%"}}))}function ym(e,t){return window.__c={n:"renderAndroidPreview"},a()(mp,{format:"Android",style:t.mobileChrome},void 0,a()("img",{src:e,style:{width:"100%"}}))}function bm(e){return window.__c={n:"renderMobileDesktopVisual"},a()("div",{style:{marginTop:32,position:"relative"}},void 0,a()("div",{style:{position:"absolute",top:0,left:0,width:"70%"}},void 0,a()(Ve.Z,{isSmall:!0,style:{marginBottom:12}},void 0,a()(w.FormattedMessage,{defaultMessage:"Browser",id:"useCasemobileDesktopStep.browser.label",description:"Desktop&Mobile browser step label"})),a()("img",{src:Et.Z.tutorial.mobileSyncSafariPng,style:e.mobileDesktopVisual})),a()("div",{style:{position:"absolute",top:0,left:"30%",width:"70%"}},void 0,a()(Ve.Z,{isSmall:!0,style:{marginBottom:12}},void 0,a()(w.FormattedMessage,{defaultMessage:"Mac & Windows App",id:"useCasemobileDesktopStep.desktopApp.label",description:"Desktop&Mobile desktop app step label"})),a()("img",{src:Et.Z.tutorial.mobileSyncMacPng,style:e.mobileDesktopVisual})))}class Sm extends l.Z{willMount(){const e=S.u5({schemeUrl:ncd.href(),baseUrl:x.Z.domainBaseUrl});M.navigateToExternalURL({environment:this.environment,url:e}),ro.vq(),M.navigate({environment:this.environment,url:y._j.root,redirect:!0})}}Sm.displayName="OpenExternal";const wm=Sm;var km=o(18698),Cm=o(93686);const _m=function(e){window.__c={n:"TeamInviteLinkJoinPage"};const{teamStore:t}=e,o=(0,V.O7)(),{teamName:i}=(0,N.VK)((()=>({teamName:t.getName()})),[t]),n=(0,Ce.yK)((e=>({buttonContainer:{marginTop:15,display:"flex",justifyContent:"space-between"},container:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},title:{fontWeight:fo.Z.fontWeight.semibold,fontSize:20,margin:10},subtitle:{color:e.mediumTextColor,fontSize:18},divider:{maxWidth:280},rightButton:{fontWeight:fo.Z.fontWeight.semibold,marginLeft:10}})),[]);return a()("div",{style:n.container},void 0,a()(Cm.p,{store:t,disabled:!0,size:55}),a()("div",{style:n.title},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkJoinPage.page.title",defaultMessage:"You've been invited to join {teamName}",description:"Title shown when a user clicks on a teamspace invite link",values:{teamName:i}})),a()("div",{style:n.subtitle},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkJoinPage.page.subtitle",defaultMessage:"You can access the content in the teamspace if you join the teamspace.",description:"Text describing what will happen if the user joins the teamspace"})),a()("div",{style:n.buttonContainer},void 0,a()(Re.Z,{isLarge:!0,onClick:async()=>{const e=o.currentUser.id;if(!e)return;const i=[{type:"member",entity_type:"user",user_id:e}];await km.um({environment:o,userId:e,teamStore:t,user:i}),k.trackTeamInviteLinkConfirmationSelection(o,{store:t,selection:"yes"})}},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkJoinPage.joinTeam.label",defaultMessage:"Join teamspace",description:"Button adds the user to the teamspace"})),a()(Ao.Z,{isLarge:!0,style:n.rightButton,onClick:async()=>{k.trackTeamInviteLinkConfirmationSelection(o,{store:t,selection:"no"}),await km.Id({environment:o})}},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkJoinPage.backToMyContentButton.label",defaultMessage:"Back to my content",description:"Button that takes the user back to their first space"}))),a()(Zo.Z,{size:48,innerStyle:n.divider}),a()(Ve.Z,{isSmall:!0},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkJoinPage.contact.message",defaultMessage:"Please contact your workspace owner for any questions.",description:"Additional text that is shown when a user is joining a teamspace"})))};function Mm(e){let{error:t}=e;switch(t){case"nonSpaceMember":return a()(w.FormattedMessage,{id:"teamInviteLinkPageError.nonSpaceMember.title",defaultMessage:"Oops, you are not a member of the workspace.",description:"Text shown when a user clicks on a teamspace invite link, but isn't a member of the space the teamspace is in"});case"inviteLinkDisabled":return a()(w.FormattedMessage,{id:"teamInviteLinkPageError.inviteLinkDisabled.title",defaultMessage:"Oops, invite links are disabled for this teamspace.",description:"Text shown when a user clicks on a teamspace invite link, but invite links are disabled."});case"archivedTeam":return a()(w.FormattedMessage,{id:"teamInviteLinkPageError.archivedTeam.title",defaultMessage:"Oops, this teamspace has been archived.",description:"Text shown when a user clicks on a teamspace invite link, but the teamspace is archived."});default:(0,Xa.t1)(t)}}const Tm=function(e){window.__c={n:"TeamInviteLinkPageError"};const t=(0,V.O7)(),{error:o}=e,i=(0,Ce.yK)((()=>({container:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},button:{marginTop:10}})),[]);return a()("div",{style:i.container},void 0,a()(No.Z,{type:No.Z.Type.NotFound}),a()(Mm,{error:o}),a()("div",{},void 0,a()(Re.Z,{isLarge:!0,style:i.button,onClick:()=>km.Id({environment:t})},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkPageError.backToMyContentButton.label",defaultMessage:"Back to my content",description:"Button that takes the user back to their first space"}))),a()(Zo.Z,{size:48,innerStyle:{maxWidth:280}}),a()(Ve.Z,{isSmall:!0},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkPageError.noAccess.message",defaultMessage:"Please contact your workspace owner for any questions.",description:"Additional text that is shown when a user isn't a member of the space the teamspace is in"})))};var Im=o(78504);function Pm(e){window.__c={n:"TeamInviteLinkRequestPageContent"};const{teamStore:t,teamName:o,onRequestClick:i}=e,n=(0,V.O7)(),r=(0,Ce.yK)((e=>({buttonContainer:{marginTop:15,display:"flex",justifyContent:"space-between"},container:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},title:{fontWeight:fo.Z.fontWeight.semibold,fontSize:20,margin:10},subtitle:{color:e.mediumTextColor,fontSize:18},divider:{maxWidth:280},rightButton:{fontWeight:fo.Z.fontWeight.semibold,marginLeft:10}})),[]);return a()("div",{style:r.container},void 0,a()(Cm.p,{store:t,disabled:!0,size:55}),a()("div",{style:r.title},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkRequestPage.requestAccess.title",defaultMessage:"Request access to {teamName}",description:"Text shown when a user clicks on a teamspace invite link, but isn't a member of the space the teamspace is in.",values:{teamName:o??xm()}})),a()("div",{style:r.subtitle},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkRequestPage.requestAccess.subtitle",defaultMessage:"You can access this teamspace if a teamspace owner approves your request.",description:"Text describing when the user will be able to access the teamspace."})),a()("div",{style:r.buttonContainer},void 0,a()(Re.Z,{isLarge:!0,onClick:i},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkRequestPage.requestAccess.label",defaultMessage:"Request access",description:"Button that opens a modal for the user to request access to a teamspace"})),a()(Ao.Z,{isLarge:!0,style:r.rightButton,onClick:async()=>{await km.Id({environment:n})}},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkRequestPage.backToMyContentButton.label",defaultMessage:"Back to my content",description:"Button that takes the user back to their first space"}))),a()(Zo.Z,{size:48,innerStyle:r.divider}),a()(Ve.Z,{isSmall:!0},void 0,a()(w.FormattedMessage,{id:"teamInviteLinkRequestPage.contact.message",defaultMessage:"Please contact your workspace owner for any questions.",description:"Additional text that is shown when a user is requesting access to a teamspace"})))}function xm(){return window.__c={n:"getPrivateTeamLabel"},a()(w.FormattedMessage,{id:"teamInviteLinkRequestPage.privateTeamspace.label",defaultMessage:"Private Teamspace",description:"Label indicating the teamspace is private."})}const Bm=function(e){const{teamStore:t}=e,[o,i]=(0,s.useState)(!1),{teamName:n}=(0,N.VK)((()=>({teamName:t.getName()})),[t]);return s.createElement(s.Fragment,null,a()(Pm,{teamStore:t,teamName:n,onRequestClick:()=>i(!0)}),a()(Im.Z,{teamStore:t,teamName:n??xm(),teamId:t.id,isModalOpen:o,onDismiss:()=>i(!1)}))};function Zm(e){const{teamAccessLevel:t,teamStore:o}=e;switch(t){case"open":return a()(_m,{teamStore:o});case"closed":case"private":return a()(Bm,{teamStore:o})}}const Em=function(e){window.__c={n:"TeamInviteLinkPage"};const{teamId:t}=e,o=(0,V.O7)(),{teamAccessLevel:i,teamStore:n}=(0,N.VK)((()=>{const e=new A.zX(o,{table:b.e0,id:t});return{teamAccessLevel:e.getTeamAccessLevel(),teamStore:e}}),[o,t]),[{value:r}]=(0,la.r5)((async()=>await km.Ng({environment:o,teamId:t})),[o,t]);(0,s.useEffect)((()=>{!0===(null==r?void 0:r.isValidTeamRequest)&&null!=r&&r.isTeamMember&&(async()=>{var e;const t=null===(e=o.currentUser)||void 0===e?void 0:e.id;t&&n&&await km.t_({environment:o,userId:t,teamStore:n})})()}),[o,n,r]);const l=(0,Ce.yK)((()=>({container:{display:"flex",justifyContent:"center",height:"100%"}})),[]);return a()("div",{style:l.container},void 0,!1===(null==r?void 0:r.isValidTeamRequest)&&(null==r?void 0:r.invalidRequestReason)&&a()(Tm,{error:null==r?void 0:r.invalidRequestReason}),!0===(null==r?void 0:r.isValidTeamRequest)&&!(null!=r&&r.isTeamMember)&&a()(Zm,{teamStore:n,teamAccessLevel:i}))};var Rm=o(89302);class Am extends l.Z{renderComponent(){return a()(Rm.Z,{previewRootId:this.props.id,isFrontPage:!0,disabled:!1,style:this.getPreviewStyle()},this.props.id)}getPreviewStyle(){return{width:"100%",height:"100%",flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column"}}}Am.displayName="TemplatePreviewView";const Dm=Am;class Fm extends l.Z{constructor(){super(...arguments),this.didCatchError=!1,this.openSupportMessages=()=>{I.j({environment:this.environment,from:"page_error"})},this.handleOpenNativeLink=e=>{"string"==typeof e?this.handleOpenNativeLinkV2(e,!1,!1):this.handleOpenNativeLinkV2(e.url,!1,!1)},this.handleOpenNativeLinkV2=(e,t,o)=>{const{RouterStore:i}=this.environment,n=S.RD({url:e,protocol:x.Z.protocol,baseUrl:x.Z.domainBaseUrl}),r=S.u5({schemeUrl:n,baseUrl:x.Z.domainBaseUrl}),a=v.Wj({url:r,baseUrl:x.Z.domainBaseUrl,publicDomainName:x.Z.publicDomainName,isMobile:this.environment.device.isMobile,protocol:x.Z.protocol,currentUrl:ncd.href()});(this.environment.device.isAndroid||t)&&M.clearHistoryState({RouterStore:i,currentUserId:this.environment.currentUser.id}),this.environment.mobileNative&&this.environment.mobileNative.closeInAppBrowser(),"googleAuthCallback"!==a.name&&"samlAuthCallback"!==a.name?M.navigate({environment:this.environment,url:r,redirect:t,updateMobileTabbedRouterArgs:{clearNativeRootPageOverride:o}}):M.navigate({environment:this.environment,url:r})}}async didMount(){await R.default.waitUntil((()=>R.default.state.isLoaded))}willMount(){const{RouterStore:e,currentUser:t}=this.environment,o=t.id;window.addEventListener("beforeunload",(()=>{M.updateHistoryState({historyId:e.state.id,currentUserId:o})})),window.onpopstate=async t=>{const o=ncd.href(),i=t.state?t.state.currentUserId:void 0;let n=this.environment;i&&i!==this.environment.currentUser.id&&(n=await T.x({environment:n,newCurrentUserId:i}));const r=e.state.route,a=v.Wj({url:o,isMobile:n.device.isMobile,baseUrl:x.Z.domainBaseUrl,publicDomainName:x.Z.publicDomainName,protocol:x.Z.protocol,currentUrl:ncd.href()}),s="page"===r.name&&"page"===a.name&&r.blockId===a.blockId,l="onboarding"!==r.name&&"onboarding"===a.name;M.updateHistoryState({historyId:e.state.id,currentUserId:i}),await M.updateRouterState({environment:n,id:t.state&&t.state.id||(0,h.ZP)(),action:"pop",href:o}),l&&!this.environment.device.isMobileNative&&M.navigate({environment:n,url:y._j.root}),s&&M.handleNavigateWithinSamePage(n)},this.environment.mobileNative&&this.environment.mobileNative.subscribeToOpenLink(this.handleOpenNativeLinkV2),C.subscribeToProtocolUrl(this.handleOpenNativeLink),C.subscribeToSettingsMenuItem(this.handleOpenSettings),C.ready(),C.onNewWindow(((e,t)=>{e.preventDefault(),M.navigate({environment:this.environment,url:t,openInNew:"tab"})}))}componentDidCatch(e,t){console.error("Client crash during React render:",e),d.rn(e,{from:"Router",type:"ClientCrash",data:{miscDataToConvertToString:t}}),this.didCatchError=!0,this.forceUpdate()}renderComponent(){return a()(w.IntlProvider,{defaultLocale:"en-US",locale:c.SP,messages:c.sY},void 0,s.createElement(Wl,function(e){let t=e.isMobile?10:50;return e.ramSizeInGB&&(t=Math.floor(2*e.ramSizeInGB)),{maxPreferredIFrames:t}}(this.environment.device),this.renderRouteOrError()))}renderRouteOrError(){return this.didCatchError?a()("div",{style:Fm.reactErrorStyle},void 0,g.Z.eyes({width:42,height:42}),a()("div",{style:Fm.reactErrorMessageStyle},void 0,a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Oops! Something went wrong.",id:"router.renderErrorPage.message.part1"})),a()("div",{},void 0,a()(w.FormattedMessage,{defaultMessage:"Please refresh and try again or <textlink>message support</textlink>.",id:"router.renderErrorPage.message.part2",values:{textlink:e=>a()(Ne.Z,{onClick:this.openSupportMessages},void 0,e)}}))),a()(Re.Z,{isLarge:!0,onClick:()=>window.location.reload()},void 0,a()(w.FormattedMessage,{defaultMessage:"Refresh",id:"router.renderErrorPage.reloadButton.label"}))):a()(dp,{},void 0,this.renderRoute())}renderRoute(){const{RouterStore:e}=this.environment,t=e.state,i=this.createComputedStore((()=>R.default.checkGate("developer_integration_form_redesign")));if("root"!==t.route.name&&"page"!==t.route.name&&"space"!==t.route.name&&(B.default.setInitialRenderCompleted(),E.default.setState({...E.default.state,renderPhase:"rendered"})),this.environment.currentUser.isLoggedIn()||"page"===t.route.name||"space"===t.route.name||p.j(this.environment.device,{facebook:{eventName:"PageView",data:{content_name:ncd.href()}},google:{eventName:"pageView",path:window.location.pathname}}),this.environment.currentUser.isLoggedIn()&&E.default.state.currentUserSettingsStore){const{currentUserSettingsStore:e}=E.default.state;P.dM(this.environment,e)}const{device:n}=this.environment;if(n.isNative&&v.lQ[t.route.name])return a()(wm,{});if("front"===t.route.name)return a()(Hl,{preventFrontRedirect:t.route.alreadyRedirected});if("root"===t.route.name)return a()(oc,{route:t.route});if("nativeRedirect"===t.route.name)return a()(lc,{redirect:t.route.redirect});if("login"===t.route.name)return a()(ac,{isSignup:!1,email:t.route.email,redirectURL:t.route.redirectURL});if("desktopEmailConfirm"===t.route.name)return a()(Dl,{});if("teamsInvite"===t.route.name){const{teamId:e}=t.route;return k.trackClickTeamInviteLink(this.environment,{teamId:e}),a()(ic.Z,{fetch:async()=>{const t=new A.zX(this.environment,{table:b.e0,id:e});await t.load()},render:()=>a()(Em,{teamId:e})})}if("signup"===t.route.name)return a()(ac,{isSignup:!0,email:t.route.email});if("unsubscribe"===t.route.name)return a()(Bl,{payload:t.route.payload});if("onboarding"===t.route.name)return a()(fm,{});if("upcomingInvoice"===t.route.name)return a()(Z.LazyInvoice,{route:t.route});if("invoiceById"===t.route.name)return a()(Z.LazyInvoice,{route:t.route});if(t.route.name,t.route.name,"admin"===t.route.name&&x.Z.isAdminMode)return a()(ic.Z,{fetch:()=>Promise.all([o.e(8611),o.e(2328)]).then(o.bind(o,68611)),render:e=>{let{default:t}=e;return a()(t,{})}});if("adminListData"===t.route.name){const{category:e}=t.route;if(x.Z.isAdminMode)return a()(ic.Z,{fetch:()=>Promise.all([o.e(8611),o.e(2328)]).then(o.bind(o,8817)),render:t=>{let{default:o}=t;return a()(o,{category:e})}})}if("adminSingleRecord"===t.route.name&&x.Z.isAdminMode){const{id:e,table:i}=t.route;return a()(ic.Z,{fetch:()=>Promise.all([o.e(8611),o.e(3854)]).then(o.bind(o,37589)),render:t=>{let{default:o}=t;return a()(o,{table:i,id:e})}})}if("oauthAuthorization"===t.route.name){const{responseType:e,redirectUri:i,integrationId:n,state:r,owner:s,userId:l,spaceId:c}=t.route;return a()(ic.Z,{fetch:()=>Promise.all([o.e(2222),o.e(3370)]).then(o.bind(o,61695)),render:t=>{let{default:o}=t;return a()(o,{responseType:e,redirectUri:i,integrationId:n,state:r,owner:s,userId:l,spaceId:c})}})}return"myIntegrations"===t.route.name?"pointer"in t.route?i.state?a()(Z.LazyDeveloperIntegrationViewV2,{botOrIntegrationPointer:t.route.pointer}):a()(Z.LazyDeveloperIntegrationView,{botOrIntegrationPointer:t.route.pointer}):a()(Z.LazyDeveloperIntegrationsList,{}):"myIntegrationsLab"===t.route.name?a()(Z.LazyDeveloperIntegrationLab,{integrationPointer:t.route.pointer}):"templatePreview"===t.route.name&&"id"in t.route?a()(Dm,{id:t.route.id}):"notFound"===t.route.name?a()(Jo,{route:t.route,publicPageData:void 0}):"page"===t.route.name||"space"===t.route.name||"nativeTab"===t.route.name||"workspaceSetup"===t.route.name?a()(Tl,{routerState:t}):a()(Il.Z,{})}handleOpenSettings(){_.r()}}Fm.displayName="Router",Fm.reactErrorStyle={width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",paddingBottom:100,...(0,u.N7)(c.SP)},Fm.reactErrorMessageStyle={fontSize:14,textAlign:"center",marginTop:6,marginBottom:12,color:m.ZP.uiGray};const Lm=Fm},95691:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(24405),c=o(8848),d=o(3779),p=o(82990),u=o(64921);const m=function(e){window.__c={n:"SegmentedDropdownButton"};const{style:t,color:o,title:i,onClick:r,icon:m,dropdownEvents:g,className:h}=e,f=(0,l.yK)((e=>({wrap:{position:"relative",display:"inline-flex",flexShrink:0,borderRadius:3,overflow:"hidden",height:28},mainButton:{display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderTopLeftRadius:3,borderBottomLeftRadius:3,lineHeight:1.1,paddingLeft:8,paddingRight:8,fontWeight:p.Z.fontWeight.medium,..."blue"===o&&{background:c.ZP.blue,color:c.ZP.white},..."orange"===o&&{background:"dark"===e.mode?e.accentColors.orange[100]:e.accentColors.orange[50],color:"dark"===e.mode?e.accentColors.orange[600]:e.accentColors.orange[400]}},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"center",width:24,alignSelf:"stretch",borderTopRightRadius:3,borderBottomRightRadius:3,..."blue"===o&&{background:c.ZP.blue,color:c.ZP.white,boxShadow:`inset 1px 0 0 ${e.darkDividerColor}`},..."orange"===o&&{background:"dark"===e.mode?e.accentColors.orange[100]:e.accentColors.orange[50],color:e.accentColors.orange[400],boxShadow:"dark"===e.mode?`${e.accentColors.orange[300]} 1px 0 0 inset`:`${e.accentColors.orange[200]} 1px 0 0 inset`}},dropdownButtonIcon:{width:10,marginTop:2,..."blue"===o&&{fill:c.ZP.white},..."orange"===o&&{fill:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[400]}},buttonHoveredStyle:{..."blue"===o&&{background:e.blueButtonHoveredBackground},..."orange"===o&&{background:"dark"===e.mode?e.accentColors.orange[200]:e.accentColors.orange[100]}},buttonPressedStyle:{..."blue"===o&&{background:e.blueButtonPressedBackground},..."orange"===o&&{background:"dark"===e.mode?e.accentColors.orange[300]:e.accentColors.orange[200]}},icon:{width:12,marginRight:6,..."blue"===o&&{fill:c.ZP.white},..."orange"===o&&{fill:e.accentColors.orange[400]}},border:{position:"absolute",pointerEvents:"none",borderRadius:3,top:0,left:0,right:0,bottom:0,..."blue"===o&&{boxShadow:"rgba(15, 15, 15, 0.1) 0px 0px 0px 1px inset, rgba(15, 15, 15, 0.1) 0px 1px 2px"},..."orange"===o&&{boxShadow:"dark"===e.mode?`${e.accentColors.orange[300]} 0px 0px 0px 1px inset`:`${e.accentColors.orange[200]} 0px 0px 0px 1px inset`}}})),[o]);return a()("div",{style:{...f.wrap,...t},className:h},void 0,a()(u.Z,{style:f.mainButton,onClick:r,disabledFeedback:!0,hoveredStyle:f.buttonHoveredStyle,pressedStyle:f.buttonPressedStyle},void 0,m&&m(f.icon),i),s.createElement(u.Z,n()({disabledFeedback:!0,style:f.dropdownButton,hoveredStyle:f.buttonHoveredStyle,pressedStyle:f.buttonPressedStyle},g),d.Z.chevronDown(f.dropdownButtonIcon)),a()("div",{style:f.border}))}},9050:(e,t,o)=>{o.d(t,{Z:()=>g});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(80025),p=o(60709),u=o(52275);class m extends l.Z{renderComponent(){return s.createElement(u.Z,a()({},this.props,{icon:this.renderColorTile(),title:(0,d.Vn)(this.props.color)}))}renderColorTile(){const e=(0,c.KR)(this.theme,this.props.color);return n()("div",{style:{width:this.environment.device.isMobile?24:18,height:this.environment.device.isMobile?24:18,background:e.menuBackgroundColor,color:e.textColor,boxShadow:this.theme.innerBorderBoxShadow,borderRadius:3}})}}m.displayName="SelectColorMenuItem",m.contextTypes={...p.mw,...l.w};const g=m},73456:(e,t,o)=>{o.d(t,{Z:()=>D});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(99036),u=o(8848),m=o(84619),g=o(3779),h=o(6287),f=o(82990),v=o(5366),y=o(50906),b=o(47307),S=o(66890),w=o(75079),k=o(60709),C=o(33846),_=o(13709),M=o(93405),T=o(68894),I=o(78140),P=o(9342),x=o(40721),B=o(44532),Z=o(72495),E=o(9050),R=o(22084);class A extends d.Z{constructor(){super(...arguments),this.storeTypes={renameInputStore:C.Z},this.renderPopup=()=>{const{device:e}=this.environment,{value:t,schema:o,property:i,statusGroup:r}=this.props,{renameInputStore:s}=this.stores,l=o[i];if(!l)return;if(!p.cu(l)&&"status"!==l.type)return;const d=l.options||[],h=d.find((e=>e.value===t));if(!h)return;const f={key:"action",render:e=>c.createElement(Z.Z,e),items:[]};f.items.push({key:"delete",render:e=>c.createElement(M.Z,n()({},e,{title:a()(v.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete",description:"Label for button that deletes an existing option for the focused select option"}),svg:g.Z.trash})),action:this.handleDelete}),r&&"status"===l.type&&(f.items.push({key:"setAsDefault",render:e=>c.createElement(M.Z,n()({},e,{title:a()(v.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default",description:"Label for button that sets the option as the default option for status property"}),svg:g.Z.flag})),action:this.handleSetAsDefault}),f.items.push({key:"Group",render:e=>c.createElement("div",e,c.createElement(_.Z,n()({},e,{title:a()(v.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group",description:"Label for button that sets the group of the option for status property"}),selectedKey:r.name,options:(l.groups??[]).map((e=>({key:e.name,title:e.name}))),icon:e=>g.Z.checkboxSquareChecked({...e,width:16,marginRight:0}),onChange:e=>{this.handleChangeGroup(e)}}))),action:()=>{}}));const y={key:"color",render:e=>c.createElement(Z.Z,n()({},e,{title:a()(v.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors",description:"Menu section header for buttons that change the color of the focused select option"}),isTitleUppercase:!0,topBorder:!0})),items:u.AP.map((e=>({key:e,render:t=>c.createElement(E.Z,n()({},t,{color:e,checkState:h.color===e})),action:()=>{this.handleSelectPropertyColorPickerChange(e)}})))};let b;return b=e.isMobile?{menuType:k.og.Modal,title:a()(R.Z,{format:m.l.Large,value:t,options:d,showRemoveButton:!1,isSingle:!0}),right:a()(x.DoneMenuText,{}),onClickRight:this.handleRenameInputSubmit}:{menuType:k.og.Popup,width:220},c.createElement(I.Z,b,a()(Z.Z,{isInput:!0},void 0,a()(T.ZP,{focus:!e.isMobile||void 0,selectAll:!e.isMobile,value:s.state.inputValue,onChange:this.handleRenameInputChange,onSubmit:this.handleRenameInputSubmit,rightMobileEditLabel:a()(v.FormattedMessage,{defaultMessage:"Rename",id:"database.editProperty.select.mobileLabel"})})),a()(P.Z,{type:P.i.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:[f,y]}))},this.handleDelete=()=>{const{collectionId:e,id:t,value:o,schema:i,property:n,onChange:r,analyticsFrom:s,statusGroup:l}=this.props,c=i[n];c&&("status"!==c.type||o!==c.defaultOption?b.showDialog({showCancel:!0,keepFocus:!1,message:a()(v.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.prompt",defaultMessage:"Are you sure you want to remove this option?"}),items:[{label:a()(v.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.confirmButton",defaultMessage:"Remove"}),color:"red",onAccept:()=>{if(!p.cu(c)&&"status"!==c.type)return;const o={table:h.v,id:e},i=[],a={pointer:o,command:"keyedObjectListRemove",path:["schema",n,"options"],args:{remove:{id:t}}};if(i.push(a),l&&"status"===c.type){const e=(c.groups??[]).findIndex((e=>e.id===l.id)),r={pointer:o,command:"listRemove",path:["schema",n,"groups",e,"optionIds"],args:{id:t}};i.push(r)}r(i),this.props.onClose(),y.trackConfigureProperty(this.environment,{...(0,w.Pn)(this.context.collectionContextStore),property_type:c.type,action:"select_delete_option",from:s})}}]}):b.showErrorMessage(a()(v.FormattedMessage,{defaultMessage:"Cannot delete default option.",id:"database.editProperty.errorDialog.forbidDeleteDefaultOption.message",description:"Prevent user from deleting the default option."})))},this.handleSetAsDefault=async()=>{const{collectionId:e,value:t,schema:o,property:i,onChange:n,statusGroup:r,analyticsFrom:s}=this.props,l=o[i];if(!l||"status"!==l.type||!r)return;if(t===l.defaultOption)return;if(!(await b.confirmUserAction({message:a()("span",{},void 0,a()(v.FormattedMessage,{defaultMessage:"Change default to <b>{defaultValue}</b>?",id:"database.editProperty.setAsDefault.confirm.title",description:"Shown in a dialog to confirm changing the default value",values:{defaultValue:t,b:e=>a()("span",{style:{fontWeight:f.Z.fontWeight.semibold}},void 0,e)}})),description:a()("span",{},void 0,a()(v.FormattedMessage,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",description:"Shown in a dialog to confirm changing the default value",values:{defaultValue:t,b:e=>a()("span",{style:{fontWeight:f.Z.fontWeight.semibold}},void 0,e)}})),acceptLabel:a()(v.FormattedMessage,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton",description:"Shown in a dialog to confirm changing the default value"})})))return;const c=[],d={pointer:{table:h.v,id:e},command:"update",path:["schema",i],args:{defaultOption:t}};c.push(d),n(c),this.props.onClose(),y.trackConfigureProperty(this.environment,{property_type:l.type,action:"status_set_default",from:s,collection_id:e})},this.handleChangeGroup=e=>{const{collectionId:t,id:o,schema:i,property:n,onChange:r,statusGroup:a,analyticsFrom:s}=this.props,l=i[n];if(!l||"status"!==l.type||!a)return;const c={table:h.v,id:t},d=[],p=l.groups??[],u=p.findIndex((e=>e.id===a.id)),m=p.findIndex((t=>t.name===e));if(u===m)return;const g={pointer:c,command:"listRemove",path:["schema",n,"groups",u,"optionIds"],args:{id:o}},f={pointer:c,command:"listAfter",path:["schema",n,"groups",m,"optionIds"],args:{id:o}};d.push(g,f);const v=l.options??[],b={pointer:c,command:"set",path:["schema",n,"options"],args:p.flatMap((e=>{const t=e.optionIds??[];return v.filter((e=>t.includes(e.id)))}))};d.push(b),r(d),y.trackConfigureProperty(this.environment,{property_type:l.type,action:"status_set_default",from:s,collection_id:t})},this.handleRenameInputChange=e=>{const{renameInputStore:t}=this.stores,o=e.target.value.replace(/,/g,"");t.setState({...t.state,inputValue:o}),t.emit()},this.handleRenameInputSubmit=()=>{this.props.onClose(),this.performRename()},this.handleSelectPropertyColorPickerChange=e=>{const{id:t,collectionId:o,property:i,schema:n,onChange:r,analyticsFrom:a}=this.props,s=n[i];if(!s)return;if(!p.cu(s)&&"status"!==s.type)return;const l=(s.options||[]).find((e=>e.id===t));if(!l)return;const c={...l,color:e};r([{pointer:{table:h.v,id:o},command:"keyedObjectListUpdate",path:["schema",i,"options"],args:{value:c}}]),y.trackConfigureProperty(this.environment,{property_type:s.type,action:"select_change_color",from:a,collection_id:o})}}willMount(e){super.willMount(e),this.stores.renameInputStore.setState({...this.stores.renameInputStore.state,inputValue:e.value})}renderComponent(){const{origin:e,open:t,alignmentToOrigin:o}=this.props,{device:i}=this.environment;return a()(B.ZP,{popupType:i.isMobile?B.ZP.PopupType.SlideUp:B.ZP.PopupType.Popup,open:t,onDismiss:this.handleRenameInputSubmit,origin:e,render:this.renderPopup,alignmentToOrigin:o})}performRename(){const{id:e,collectionId:t,property:o,value:i,schema:n,onChange:r}=this.props,{renameInputStore:s}=this.stores,c=s.state.inputValue,d=n[o];if(!d)return;if(!p.cu(d)&&"status"!==d.type)return;const u=d.options||[],m=u.find((t=>t.id!==e&&t.value===c));if(i!==c)if(c)if(m)b.showErrorMessage(a()(v.FormattedMessage,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const n=u.find((t=>t.id===e));if(!n)return;const a={...n,value:c},s={pointer:{table:h.v,id:t},command:"keyedObjectListUpdate",path:["schema",o,"options"],args:{value:a}},p="status"===d.type&&i===d.defaultOption?{pointer:{table:h.v,id:t},command:"update",path:["schema",o],args:{defaultOption:c}}:void 0;r(l().compact([s,p]))}else b.showErrorMessage(a()(v.FormattedMessage,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}}A.displayName="SelectOptionActionMenu",A.contextTypes={...d.w,...S.xm};const D=A},22084:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(8848),s=o(82990),l=o(62896),c=o(85567);class d extends r.Z{renderComponent(){const e=this.props.options.find((e=>e.value===this.props.value));if(!e)return;const t=(0,a.KR)(this.theme,null==e?void 0:e.color);return n()(c.Z,{format:this.props.format,value:n()("div",{style:{...this.props.showEllipsis&&s.Z.textOverflowStyle}},void 0,n()(l.Z,{},void 0,e.value)),onClickRemove:this.props.onClickRemove,showRemoveButton:this.props.showRemoveButton,isSingle:this.props.isSingle,color:t.textColor,backgroundColor:t.backgroundColor,shouldShrink:this.props.shouldShrink,isRound:this.props.isRound,showColoredDot:this.props.showColoredDot,showFullValueTooltip:!0,style:this.props.style})}}d.displayName="SelectToken";const p=d},66094:(e,t,o)=>{o.d(t,{Z:()=>G});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(45060),d=o(8848),p=o(63143),u=o(51454),m=o(95182),g=o(6404),h=o(42239),f=o(87420),v=o(52989),y=o(24677),b=o(30149),S=o(11368),w=o(84064),k=o(43250),C=o(78316),_=o(12534),M=o(98742),T=o(39500),I=o(45162),P=o(73959),x=o(72133),B=o(89086),Z=o(95802),E=o(55367),R=o(10084),A=o(80796),D=o(10161),F=o(49085);class L extends F.Z{getInitialState(){return{}}}const V=new L;var N=o(3815),O=o(69784);class U extends F.Z{getInitialState(){return{shouldShowSelectionHalo:!1,shouldShowDropParentHalo:!1,shouldShowDropZone:!1,shouldShowDropZoneHint:!1,forceRenderSelectionHalo:!1}}}const H=U;var z=o(27724),W=o(24666),j=o(30016),K=o(6685);class Y extends l.Z{constructor(){super(...arguments),this.lastDropZoneHintIndex=void 0,this.selectableDivRef=s.createRef(),this.storeTypes={draggableStore:R.Z,selectableStore:H},this.renderSelectionHaloContent=()=>a()("div",{className:k.No6,style:this.getSelectionHaloStyle()}),this.renderDropParentHaloContent=()=>a()("div",{className:k.No6,style:this.getDropParentHaloStyle()}),this.handleDragStart=e=>{const{mobileNative:t}=this.environment;this.props.canDrag&&(e.preventDefault(),t&&t.buzz()),this.props.onDraggableDragStart&&this.props.onDraggableDragStart(e)},this.handleDragMove=e=>{const{device:t}=this.environment;this.props.canDrag&&!this.props.preventBackgroundDrag?E.ZP.state.isDragging?h.td(this.environment,{currentX:e.currentX,currentY:e.currentY}):T.X9()&&(y.Ys({environment:this.environment,store:this.props.store,toggle:y.ji(this.environment),selectBetween:y.OS()}),h.f$(this.environment,{startX:e.startX,startY:e.startY,stores:this.props.contextMenuAndDragStores||z.default.state.stores,isNativeDrag:!1,getGhostElement:this.props.getGhostElement})):O.Z.state.isActive||t.isPhone||v.AI({environment:this.environment,target:e.target,startX:e.startX,startY:e.startY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!this.props.disableScrollToRevealHorizontal}),this.props.onDraggableDragMove&&this.props.onDraggableDragMove(e)},this.handleDragEnd=e=>{const{device:t}=this.environment;t.isMobile&&A.Z.state.isDragging&&e.preventDefault(),this.props.canDrag&&E.ZP.state.isDragging&&h.fX({environment:this.environment,shiftKey:e.shiftKey,optionKey:e.optionKey,commandKey:e.commandKey,analyticsFrom:this.props.analyticsName}),this.props.onDraggableDragEnd&&this.props.onDraggableDragEnd(e)},this.handleDragCancel=e=>{this.props.canDrag&&E.ZP.state.isDragging&&(h.cQ(this.environment),y.ZH(this.environment)),this.props.onDraggableDragCancel&&this.props.onDraggableDragCancel(e)},this.handleClick=e=>{(0,_.ZP)({event:e,context:_.Af.EditorClick,callback:()=>{var t;if(null!==(t=z.default.getDefaultContainerFromTarget(e.target))&&void 0!==t&&t.isPeekRenderer()||f.E5(this.environment),(0,P.Mn)(this.environment.device))T.X9()||!this.props.canSelect||this.props.store.isInlineCollectionView()||y.Ys({environment:this.environment,store:this.props.store,toggle:y.ji(this.environment),selectBetween:y.OS()});else{const{onEditText:t}=this.props;if(t){const o=(0,B.Rb)(e.target);o&&b.createAndCommit({userAction:"Selectable.handleClick",environment:this.environment,perform:e=>{t({isAtStartOfLine:"start"===o,isClick:!0,transaction:e})}})}}this.props.onClick&&this.props.onClick(e)}})},this.handleContextMenu=e=>{const{device:t}=this.environment;if(t.isAndroid){const t=W.default.state,o=(0,P.mh)(this.props.store),i=o&&"empty"!==t.mode&&(0,I.r)(t.multiSelection,o);if("editing"!==t.mode||!i)return x.isExpanded(x.get())||e.preventDefault(),e.stopPropagation(),!1}if(this.props.canTriggerContextMenu){const t=(0,C.fm)(this.props.store);(0,_.ZP)({event:e,context:_.Af.EditorContextMenu,callback:()=>{e.preventDefault(),y.Ys({environment:this.environment,store:this.props.store}),g.Qn({environment:this.environment,stores:this.props.contextMenuAndDragStores||z.default.state.stores,left:e.clientX,top:e.clientY,actions:this.props.blockMenuActions||m.Qi,showInput:Boolean(this.props.showBlockMenuInput),analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:t}})}})}},this.handleDoubleClick=e=>{this.props.canSelect||(0,_.ZP)({event:e,context:_.Af.EditorDoubleClick,callback:()=>{this.props.onDoubleClick&&this.props.onDoubleClick(e)}})},this.handleMouseOver=e=>{this.props.canSelect&&(0,_.ZP)({event:e,context:_.Af.EditorMouseOver,callback:()=>{V.setState({...V.state,hoveredStore:this.props.store,lastHoveredStore:this.props.store})}})},this.handleMouseOut=()=>{V.state.hoveredStore===this.props.store&&V.setState({...V.state,hoveredStore:void 0})},this.computedStore=this.createComputedStore((()=>{const e=this.getDropZoneHintIndex();!p.z4(e)&&e>=0&&(this.lastDropZoneHintIndex=e);const t=this.shouldShowSelectionHalo(),o=this.shouldShowDropParentHalo(),i=this.getCurrentDropZone(),n=this.getDropZoneHint(),r=this.lastDropZoneHintIndex,a=this.stores.draggableStore.state.dragging,s=this.stores.draggableStore.hasDragged(),l=this.stores.draggableStore.state.initiator,c=this.stores.selectableStore.state,d=this.props.store.getType()||"unknown";return{isDragging:a,initiator:l,hasDragged:s,shouldShowSelectionHalo:t||c.forceRenderSelectionHalo||Boolean(this.props.shouldForceRenderSelectionHalo),shouldShowDropParentHalo:o,currentDropZone:i,dropZoneHint:n,dropZoneHintIndex:r,shouldRenderSelectionHalo:t||c.shouldShowSelectionHalo||c.forceRenderSelectionHalo||Boolean(this.props.shouldForceRenderSelectionHalo),shouldRenderDropParentHalo:o||c.shouldShowDropParentHalo,shouldRenderDropZoneHint:!p.z4(n)||c.shouldShowDropZoneHint,shouldRenderDropZone:!p.z4(i)||c.shouldShowDropZone,propStoreType:d}})),this.shouldShowSelectionHaloForTextSelection=this.createComputedStore((()=>{if(!D.default.checkGate("text_selection_highlight"))return!1;const{store:e}=this.props,t=e.getType();if(!("divider"===t||"image"===t||"page"===t))return!1;if(W.default.isEditingCaption())return!1;const{phase:o,stores:i}=z.default.state;return o===z.SelectionPhase.Editing&&i.includes(e)}))}get registries(){return[Z.C]}getNode(){return this.props.nodeRef?this.props.nodeRef.current:this.selectableDivRef.current}getContextClosestSelectable(){var e;return null===(e=this.context.selectable)||void 0===e?void 0:e.closestSelectable}getContextSelectableContainer(){var e;return null===(e=this.context.selectable)||void 0===e?void 0:e.selectableContainer}getContextVerticalScroller(){var e;return null===(e=this.context.scrollerContext)||void 0===e?void 0:e.verticalScroller}getContextHorizontalScroller(){var e;return null===(e=this.context.scrollerContext)||void 0===e?void 0:e.horizontalScroller}renderComponent(){var e;const{isDragging:t,initiator:o,hasDragged:i,shouldShowDropParentHalo:r,shouldShowSelectionHalo:l,currentDropZone:c,dropZoneHint:d,dropZoneHintIndex:p,shouldRenderSelectionHalo:u,shouldRenderDropParentHalo:m,shouldRenderDropZoneHint:g,shouldRenderDropZone:h,propStoreType:f}=this.computedStore.state,v=u||m||g||h,y=`${k.euV} notion-${f}-block`,b=this.renderDraggable((e=>s.createElement("div",n()({ref:this.selectableDivRef,style:this.getStyle({isPositionRelative:v,isDragging:t,hasDragged:i,initiator:o}),"data-block-id":this.props.store.id,className:this.props.className?`${y} ${this.props.className}`:y},(0,M.Z)(e||{},{onDoubleClick:this.handleDoubleClick,onContextMenu:this.handleContextMenu,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onClick:this.handleClick,onMouseMove:this.props.onMouseMove,onMouseDown:this.props.onMouseDown,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave})),this.props.children,u&&this.renderSelectionHalo(l),m&&this.renderDropParentHalo(r),g&&this.renderDropZoneHint(d,p),h&&this.renderCurrentDropZone(c))));return a()(w.ld,{value:{selectableContainer:null===(e=this.context.selectable)||void 0===e?void 0:e.selectableContainer,closestSelectable:this}},void 0,b)}displaySelectionHalo(e){this.stores.selectableStore.state.forceRenderSelectionHalo||(this.stores.selectableStore.update((e=>({...e,forceRenderSelectionHalo:!0}))),window.setTimeout((()=>{this.stores.selectableStore.update((e=>({...e,forceRenderSelectionHalo:!1})))}),e))}renderDraggable(e){const{device:t}=this.environment;return this.props.canDrag?a()(K.Z,{store:this.stores.draggableStore,forceTouch:t.isMobile&&!this.props.disableForceTouch,touchDragOnly:this.props.touchDragOnly,onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalDragEdgeScroll,render:e}):e(void 0)}renderSelectionHalo(e){return a()(j.Z,{isVisible:e,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:Y.opacitySpringConfig},onAnimationStart:()=>{this.stores.selectableStore.setState({...this.stores.selectableStore.state,shouldShowSelectionHalo:!0})},onAnimationEnd:()=>{e||this.stores.selectableStore.setState({...this.stores.selectableStore.state,shouldShowSelectionHalo:!1})},render:this.renderSelectionHaloContent},"halo")}renderDropParentHalo(e){return a()(j.Z,{isVisible:e,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:Y.opacitySpringConfig},onAnimationStart:()=>{this.stores.selectableStore.setState({...this.stores.selectableStore.state,shouldShowDropParentHalo:!0})},onAnimationEnd:()=>{e||this.stores.selectableStore.setState({...this.stores.selectableStore.state,shouldShowDropParentHalo:!1})},render:this.renderDropParentHaloContent},"parent")}renderCurrentDropZone(e){const t=void 0!==e;return a()(j.Z,{isVisible:t,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:Y.opacitySpringConfig},onAnimationStart:()=>{this.stores.selectableStore.setState({...this.stores.selectableStore.state,shouldShowDropZone:!0})},onAnimationEnd:()=>{t||this.stores.selectableStore.setState({...this.stores.selectableStore.state,shouldShowDropZone:!1})},render:()=>a()("div",{style:this.getDropZoneStyle(e,0)},void 0,e!==E.vh.Onto&&a()("div",{style:this.getHintGapBoxStyle(e)}))},"dropZone")}renderDropZoneHint(e,t){const o=!p.z4(e);return a()(j.Z,{isVisible:o,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:Y.opacitySpringConfig},onAnimationStart:()=>{this.stores.selectableStore.setState({...this.stores.selectableStore.state,shouldShowDropZoneHint:!0})},onAnimationEnd:()=>{o||this.stores.selectableStore.setState({...this.stores.selectableStore.state,shouldShowDropZoneHint:!1})},render:()=>a()("div",{style:this.getDropZoneStyle(e,(t||0)+1)},void 0,a()("div",{style:this.getHintGapBoxStyle(e)}))},"hint")}shouldShowSelectionHalo(){const{device:e}=this.environment,{store:t,shouldShowHalo:o}=this.props;if(!o||!(0,P.Mn)(e))return!1;const{stores:i,phase:n}=z.default.state;return n===z.SelectionPhase.Selected?i.indexOf(t)>=0&&!E.ZP.state.isDragging:this.shouldShowSelectionHaloForTextSelection.state}shouldShowDropParentHalo(){const{store:e,shouldShowHalo:t}=this.props;if(!t)return!1;const o=E.ZP.state;if(!o.isDragging)return!1;const{currentParentStore:i,currentHintDropZones:n,currentDropZone:r}=o;return(!r||r.type!==E.Dl.DropTarget)&&(n.some((e=>e.direction===E.vh.Left||e.direction===E.vh.Right))?Boolean(r&&r.store===e):i===e)}getCurrentDropZone(){const{store:e,shouldShowDropZone:t}=this.props,o=E.ZP.state;if(!o.isDragging)return;const{currentDropZone:i}=o;return i&&i.type===E.Dl.Selectable&&i.store===e&&t?i.direction:void 0}getDropZoneHint(){const{store:e,shouldShowDropZone:t}=this.props,o=E.ZP.state;if(!o.isDragging)return;const{currentHintDropZones:i}=o;if(i&&t){const t=i.find((t=>t.type===E.Dl.Selectable&&t.store===e));if(t)return t.direction}}getDropZoneHintIndex(){const{store:e}=this.props,t=E.ZP.state;if(!t.isDragging)return;const{currentHintDropZones:o}=t;return o?o.findIndex((t=>t.type===E.Dl.Selectable&&t.store===e)):void 0}getStyle(e){const{isPositionRelative:t,isDragging:o,hasDragged:i,initiator:n}=e,r={};return"touch"===n&&(r.transition="transform 200ms ease-out",this.props.canDrag&&o&&!i&&(r.boxShadow=this.theme.mediumBoxShadow,r.transform="scale(1.05)",r.borderRadius=3)),t&&(r.position="relative"),{...r,...this.props.style}}getSelectionHaloStyle(){return{position:"absolute",pointerEvents:"none",top:0,left:0,right:0,bottom:0,background:d.ZP.blueWithAlpha(.14),zIndex:u.py,borderRadius:3,...this.props.haloStyle}}getDropParentHaloStyle(){return{position:"absolute",pointerEvents:"none",top:0,left:0,right:0,bottom:0,background:d.ZP.blueWithAlpha(.07),borderRadius:3}}getHintGapBoxStyle(e){const{device:t}=this.environment;if(void 0===e)return{};const o=t.isMobile?3:2;return e===E.vh.Above||e===E.vh.Below?{position:"relative",left:-o,width:o,height:Y.dropzoneSize,background:this.theme.contentBackground,transform:"translateZ(100px)"}:{position:"relative",top:-o,width:Y.dropzoneSize,height:o,background:this.theme.contentBackground,transform:"translateZ(100px)"}}getDropZoneStyle(e,t){const o={position:"absolute",pointerEvents:"none",background:d.ZP.blueWithAlpha(.43),zIndex:u.S1-t};if(e===E.vh.Onto)o.left=0,o.top=0,o.right=0,o.bottom=0,o.background=d.ZP.blueWithAlpha(.14);else if(e===E.vh.Above||e===E.vh.Below){const t=4;o.left=0,o.right=0,e===E.vh.Above?(o.top=-t,this.props.aboveDropZoneMargin&&(o.top-=this.props.aboveDropZoneMargin)):(o.bottom=-t,this.props.belowDropZoneMargin&&(o.bottom-=this.props.belowDropZoneMargin)),o.height=Y.dropzoneSize}else{const t=8;o.top=0,o.bottom=0,e===E.vh.Left?o.left=this.props.dropzoneGap?-this.props.dropzoneGap:-t:o.right=this.props.dropzoneGap?-this.props.dropzoneGap:-t,o.width=Y.dropzoneSize}return o}}Y.displayName="Selectable",Y.contextTypes={...S.I3,...w.Tf,...l.w},Y.opacitySpringConfig={stiffness:70,damping:10,precision:.001},Y.dropzoneSize=4;const G=Y;(0,c.Rw)({canFormat:e=>Boolean(e&&e instanceof N.G),header(e){const{tr:t,td:o,object:i,objectSummary:n}=c.TI,r=Z.C.findSelectableFromStore(e)||void 0,a=e.getTitleValue(),s=e.getType();return(0,N.KS)(e,a&&t({},o({},"block title:"),o({},n(a,{asJSON:!0}))),s&&t({},o({},"block type:"),o({},i(s))),r&&t({},o({},"<Selectable>:"),o({},i(r))))},hasBody:()=>!1,body:()=>null})},37064:(e,t,o)=>{o.d(t,{Z:()=>me});var i=o(77094),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(62518),c=o(83355),d=o(18466),p=o(1302),u=o(8848),m=o(64434),g=o(87420),h=o(52989),f=o(24677),v=o(8713),y=o(98104),b=o(30149),S=o(84064),w=o(43250),k=o(12534),C=o(39500),_=o(16339),M=o(69784),T=o(50628),I=o(27724),P=o(41046),x=o(86486),B=o(30016),Z=o(10339),E=o(97464),R=o.n(E),A=o(51454),D=o(28020),F=o(73744),L=o(17504),V=o(77546),N=o(439),O=o(38755),U=o(95802),H=o(3779),z=o(97880),W=o(5366),j=o(50906),K=o(42858),Y=o(84084),G=o(78175),X=o(28314),q=o(65598),$=o(10161),J=o(64921),Q=o(58032),ee=o(65200);class te extends c.Z{constructor(){super(...arguments),this.renderTooltip=()=>{const e={color:this.theme.mediumInvertedTextColor};return n()("div",{style:{textAlign:"center"}},void 0,n()(W.FormattedMessage,{defaultMessage:"Click <mediumcolor>to add below</mediumcolor>",id:"block.selectableAddMenu.tooltip.addBlockBelow",description:"Add a block below",values:{mediumcolor:t=>n()("span",{style:e},void 0,t)}}),this.canAddBlockRight()&&n()("div",{},void 0,this.environment.device.isApple?n()(W.FormattedMessage,{defaultMessage:"Option-click <mediumcolor>to add a block to the right</mediumcolor>",id:"block.selectableAddMenu.tooltip.addRight",description:"Add a block to the right of the current one",values:{mediumcolor:t=>n()("span",{style:e},void 0,t)}}):n()(W.FormattedMessage,{defaultMessage:"Alt-click <mediumcolor>to add a block to the right</mediumcolor>",id:"block.selectableAddMenu.tooltip.addRight.windows",description:"Add a block to the right of the current one",values:{mediumcolor:t=>n()("span",{style:e},void 0,t)}})),this.isInAddBlockAboveExperiment.state&&n()("div",{},void 0,this.environment.device.isApple?n()(W.FormattedMessage,{defaultMessage:"Option-click <mediumcolor>to add above</mediumcolor>",id:"block.selectableAddMenu.tooltip.addAbove",description:"Add a block above the current one",values:{mediumcolor:t=>n()("span",{style:e},void 0,t)}}):n()(W.FormattedMessage,{defaultMessage:"Alt-click <mediumcolor>to add a block above</mediumcolor>",id:"block.selectableAddMenu.tooltip.addAbove.windows",description:"Add a block above the current one",values:{mediumcolor:t=>n()("span",{style:e},void 0,t)}})))},this.isInAddBlockAboveExperiment=this.createComputedStore((()=>$.default.checkGate("enable_add_block_above"))),this.handleClick=()=>{const{environment:e}=this,{store:t}=this.props,o=X.lF.state.option&&this.canAddBlockRight(),i=X.lF.state.option&&this.isInAddBlockAboveExperiment.state,n=U.C.findSelectablesFromStore(t).find((e=>Boolean(e.props.onInsertRowBelow)));if(i||o||!q.PF(t))if(n&&n.props.onInsertRowBelow)b.createAndCommit({userAction:"SelectableAddMenu.handleClick.onInsertRowBelow",environment:e,perform:e=>{n.props.onInsertRowBelow&&n.props.onInsertRowBelow({transaction:e})}});else{let n;n=i?"above":o?"right":"below",b.createAndCommit({environment:e,userAction:`SelectableAddMenu.handleClick.${n}`,perform:o=>{"above"===n?K.uE({environment:e,blocks:[t],transaction:o}):"right"===n?K.QK({environment:e,block:t,transaction:o}):"below"===n?K.ZJ({environment:e,blocks:[t],transaction:o}):(0,z.t1)(n)}})}else Y.hb({environment:e,blockStore:t});j.trackClickAddMenu(this.environment),x.default.reset()}}renderComponent(){const{device:e}=this.environment;if(!e.isPhone)return n()(Q.Z,{placement:Q.Z.Placement.Bottom,delayThreshold:300,renderTooltip:this.renderTooltip,render:e=>s.createElement(J.Z,R()({onClick:this.handleClick,style:this.getStyle()},e),H.Z.plus({width:16}))})}canAddBlockRight(){const{store:e}=this.props;return!this.isInAddBlockAboveExperiment.state&&(!(0,G.hF)(e)&&"block"===e.getParentTable())}getStyle(){const e=(0,N.zt)(this.props.offsetTop,this.props.store),t=(0,N.tx)(this.environment,te.itemSize+te.rightMargin+ee.Z.width,this.props.store);return{display:"flex",alignItems:"center",justifyContent:"center",fill:this.theme.lightIconColor,position:"absolute",top:e,left:-t,width:te.itemSize,height:te.itemSize,borderRadius:3,pointerEvents:"auto",cursor:"-webkit-grab"}}}te.displayName="SelectableAddMenu",te.itemSize=24,te.rightMargin=2;const oe=te;var ie=o(7476),ne=o(73063);class re extends c.Z{constructor(){super(...arguments),this.handleClick=e=>{ie.yw({environment:this.environment,blockStore:this.props.store})}}renderComponent(){const{device:e}=this.environment,{mediumInvertedTextColor:t}=this.theme;if(!e.isMobile)return n()("div",{style:this.getStyle(),onMouseDown:k.$0},void 0,n()(Q.Z,{placement:Q.Z.Placement.Bottom,delayThreshold:300,renderTooltip:()=>n()(W.FormattedMessage,{defaultMessage:"Click <invertedcolor>to add a comment</invertedcolor>",id:"selectableCommentMenu.addCommentPrompt.tooltip",values:{invertedcolor:e=>n()("span",{style:{color:t}},void 0,e)}}),render:e=>s.createElement(ne.Z,R()({icon:H.Z.speechBubble,onClick:this.handleClick},e))}))}getStyle(){const e=this.props.shouldOffsetLeft?(0,N.tx)(this.environment,re.itemSize+re.rightMargin+ee.Z.width,this.props.store):oe.itemSize+8;return{position:"absolute",top:this.props.offsetTop,left:-e}}}re.displayName="SelectableCommentMenu",re.itemSize=24,re.rightMargin=2;const ae=re;class se extends c.Z{constructor(){super(...arguments),this.verticalScrollableAncestor=void 0,this.horizontalScrollableAncestor=void 0,this.isCommentMenu=!1,this.showHoverMenu=!1,this.disableHoverMenuDrag=!1,this.targetSelectableStore=this.createComputedStore((()=>{const{target:e}=this.props;return U.C.findSelectablesFromStore(e).find((e=>Boolean(e.props.shouldShowHoverMenu||e.props.shouldShowCommentMenu)))})),this.targetRectStore=this.createComputedStore((()=>{var e,t;return null===(e=this.targetSelectableStore.state)||void 0===e||null===(t=e.getNode())||void 0===t?void 0:t.getBoundingClientRect()})),this.handleScroll=()=>{this.targetRectStore.enqueueRecompute()}}willMount(e){super.willMount(e);const t=this.targetSelectableStore.state;if(!t)return;this.isCommentMenu=Boolean(t.props.shouldShowCommentMenu),this.showHoverMenu=Boolean(t.props.shouldShowHoverMenu);const o=t.getNode();o&&(this.verticalScrollableAncestor=(0,V.VW)(o),this.verticalScrollableAncestor&&(0,F.lj)(this.verticalScrollableAncestor,"scroll",this.handleScroll),this.horizontalScrollableAncestor=(0,V.xH)(o),this.horizontalScrollableAncestor&&this.horizontalScrollableAncestor!==this.verticalScrollableAncestor&&(0,F.lj)(this.horizontalScrollableAncestor,"scroll",this.handleScroll),this.handleScroll())}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&(0,F.ZV)(this.verticalScrollableAncestor,"scroll",this.handleScroll),this.horizontalScrollableAncestor&&(0,F.ZV)(this.horizontalScrollableAncestor,"scroll",this.handleScroll)}renderComponent(){var e,t;const{target:o,container:i}=this.props,r=i?i.getBoundingClientRect():void 0,a=this.targetRectStore.state,l=a?a.top-(r?r.top:0):void 0,c=a?a.left-(r?r.left:0):void 0,d=(0,O.Fn)(this.environment),p="editor"===this.props.target.getRole()||"read_and_write"===this.props.target.getRole()||"edit"===(null===(e=this.pageContext)||void 0===e||null===(t=e.publicEditModeStore.state)||void 0===t?void 0:t.permission),u="external_object_instance_page"===o.getType(),m=!!this.pageContext&&(0,D.xe)(this.pageContext.pageStore.id);return(0,L.Z)((e=>s.createElement("div",R()({style:{position:"absolute",left:c,top:l,zIndex:A.Mo}},e),this.isCommentMenu&&!o.isNavigableAncestorLocked()&&n()(ae,{store:o,offsetTop:(0,N.oJ)(o),shouldOffsetLeft:this.showHoverMenu||d}),this.showHoverMenu&&n()(ee.Z,{store:o,offsetTop:(0,N.oJ)(o),disableDrag:this.disableHoverMenuDrag,isWorkspaceAdmin:d,hasEditorPermissions:p}),!o.isNavigableAncestorLocked()&&!this.isCommentMenu&&p&&!u&&!m&&n()(oe,{store:o,offsetTop:(0,N.oJ)(o)}))))}}se.displayName="SelectableHoverMenuOverlayItem";const le=se;class ce extends c.Z{constructor(){super(...arguments),this.container=void 0,this.targetStore=this.createComputedStore((()=>{const e=x.default.state;if(e.isOpen&&e.container===this.props.selectableContainer)return e.currentStore})),this.handleContainerMount=e=>{e&&(this.container=e)}}renderComponent(){return s.createElement("div",{style:ce.containerStyle,ref:this.handleContainerMount},n()(Z.Z,{render:()=>a().compact([this.renderCurrentTarget()])}))}renderCurrentTarget(){const e=this.targetStore.state;if(e)return n()(B.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>n()(le,{container:this.container,target:e})},e.id)}}ce.displayName="SelectableHoverMenuOverlay",ce.containerStyle={position:"absolute",top:0,left:0};const de=ce;class pe extends c.Z{constructor(){super(...arguments),this.observer=void 0,this.renderRectangularSelectionRect=()=>{const e=M.Z.state;if(e.isActive&&e.showSelectionRect&&this.props.isDefaultContainer)return n()("div",{style:this.getRectangularSelectionStyle()})},this.handleMouseDown=e=>{const{device:t}=this.environment;this.props.disableRectangularSelection||(t.isPhone?(0,k.ZP)({event:e,context:k.Af.EditorMouseDown,callback:()=>{f.ZH(this.environment),m.wG(),v.MO()}}):(0,k.ZP)({event:e,context:k.Af.EditorMouseDown,callback:()=>{1!==e.button&&(e.preventDefault(),h.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1}))}}))},this.handleClick=e=>{this.isStaleMouseEvent(e)||this.props.store.canEdit()&&(0,k.ZP)({event:e,context:k.Af.EditorClick,callback:()=>{var t;if(null!==(t=I.default.getDefaultContainerFromTarget(e.target))&&void 0!==t&&t.isPeekRenderer()||g.E5(this.environment),!C.X9()&&!this.props.disableEditNearestBlock){const{clientX:t,clientY:o,target:i}=e;p.default.afterNextFlush((()=>{b.createAndCommit({userAction:"SelectableContainer.click",environment:this.environment,perform:e=>y.jh(this.environment,{x:t,y:o,target:i instanceof Element?i:void 0},e)})}))}}})},this.shouldRenderRectangularSelectionRectStore=this.createComputedStore((()=>Boolean(M.Z.state.isActive&&M.Z.state.defaultContainer===this)))}get registries(){return[_.Z]}didMount(){if(super.didMount(),this.props.isDefaultContainer){const e=this.props.isRootContainer?a().union([this],I.default.state.defaultContainerStack||[]):a().union(I.default.state.defaultContainerStack||[],[this]);I.default.setState({...I.default.state,defaultContainerStack:e,pivot:void 0,anchor:void 0,anchorContainer:void 0})}if(this.props.droppable){const e=this.props.isRootContainer?a().union([this],I.default.state.droppableContainerStack||[]):a().union(I.default.state.droppableContainerStack||[],[this]);I.default.setState({...I.default.state,droppableContainerStack:e})}f.Jy();const e=l.findDOMNode(this);e&&(this.observer=new MutationObserver(ue),this.observer.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}willUnmount(){if(super.willUnmount(),this.props.isDefaultContainer){const e=a().without(I.default.state.defaultContainerStack||[],this);I.default.setState({...I.default.state,defaultContainerStack:e,pivot:void 0,anchor:void 0,anchorContainer:void 0})}if(this.props.droppable){const e=a().without(I.default.state.droppableContainerStack||[],this);I.default.setState({...I.default.state,droppableContainerStack:e})}this.observer&&this.observer.disconnect()}renderComponent(){var e;const{render:t}=this.props;return n()(S.ld,{value:{selectableContainer:this,closestSelectable:null===(e=this.context.selectable)||void 0===e?void 0:e.closestSelectable}},void 0,n()(P.Z,{open:this.shouldRenderRectangularSelectionRectStore.state,origin:t({selectableEvents:{onMouseDown:this.handleMouseDown,onClick:this.handleClick},selectableHoverMenuOverlay:n()(de,{selectableContainer:this})})},void 0,this.renderRectangularSelectionRect()))}isStaleMouseEvent(e){return T.Z.hasBeenUpdatedSince(e.timeStamp)}isPeekRenderer(){return this.props.isPeekRenderer}getRectangularSelectionStyle(){const e=M.Z.state;if(e.isActive){const{currentRect:t}=e;if(t)return{position:"absolute",pointerEvents:"none",backgroundColor:u.ZP.blueWithAlpha(.14),border:"1px solid transparent",left:t.left,top:t.top,width:t.right-t.left,height:t.bottom-t.top}}}}pe.displayName="SelectableContainer",pe.contextTypes={...S.Tf,...c.w};const ue=e=>{let t=!0;if(e.length<=10){const{selectableElementRectMap:o}=d.Z.withListenerIgnored((()=>T.Z.getState()));t=e.some((e=>function(e,t){const o=t.target instanceof Element?t.target:t.target.parentElement;if(!o)return!0;const i=o.closest(`.${w.euV}`);if(!i)return!0;const n=e.get(i);if(!n)return!0;const r=i.getBoundingClientRect();return!(n.x===r.x&&n.y===r.y&&n.width===r.width&&n.height===r.height)}(o,e)))}t&&f.Ch()};const me=pe},65200:(e,t,o)=>{o.d(t,{Z:()=>D});var i=o(77094),n=o.n(i),r=o(67294),a=o(62518),s=o(83355),l=o(5366),c=o(95182),d=o(50906),p=o(24677),u=o(75079),m=o(78316),g=o(33929),h=o(60709),f=o(33665),v=o(439),y=o(35328),b=o(86486),S=o(27724),w=o(12318),k=o(48494),C=o(80209),_=o(48019),M=o(31945),T=o(50478),I=o(68894),P=o(78140),x=o(44532),B=o(72495),Z=o(83182),E=o(66094);const R=(0,l.defineMessages)({filterActions:{defaultMessage:"Search actions…",id:"selectableHoverMenu.filterActions.placeholder"}});class A extends s.Z{constructor(){super(...arguments),this.node=void 0,this.rect=void 0,this.query=new w.default(""),this.renderPopupContent=()=>{const{device:e}=this.environment;!this.rect&&this.node&&(this.rect=this.node.getBoundingClientRect());const t={environment:this.environment,blocks:S.default.state.stores.length?S.default.state.stores:[this.props.store],originRect:this.rect,publicEditMode:void 0},o=this.query.get(),i=this.props.hasEditorPermissions&&!this.props.store.isNavigableAncestorLocked()&&n()(B.Z,{isInput:!0},void 0,n()(I.ZP,{value:o,onChange:e=>this.query.set(e.target.value),focus:!e.isMobile||void 0,focusAfterAnimation:!0,placeholder:g.default.formatMessage(R.filterActions),preventCaptureDeleteWhenEmpty:!0,preventCaptureClipboardShortcuts:!0}));let a;return a=e.isPhone?{menuType:h.og.ActionSheet,header:i}:{menuType:h.og.Popup,width:265,header:i},r.createElement(P.Z,a,n()(_.Z,{filter:o,initialFocus:o?0:void 0,sections:c.Qi,context:t,onAccept:this.handleAccept}),!o&&(this.props.hasEditorPermissions||this.props.isWorkspaceAdmin)&&n()(k.Z,{store:this.props.store,isPageMoreButton:!1,hideTopBorder:!1}),!o&&n()(C.Z,{store:this.props.store}),!o&&this.props.store.isCollectionView()&&this.renderCollectionHelpButton())},this.handleClick=()=>{const e=b.default.state;if(e.isOpen){this.rect=void 0,this.query.set(""),b.default.setState({...e,menuIsOpen:!0}),p.Ys({environment:this.environment,store:this.props.store});const t=this.props.store.getType();t&&d.trackEditorClickSelectionMenu(this.environment,{blockType:t})}},this.handleAccept=e=>{const t=S.default.state.stores[0],o=t.getType();if(o){const i=(0,m.fm)(this.props.store),n=(0,u.Pn)(i)||{};d.trackBlockAction(this.environment,{analyticsName:e.analyticsName,from:"selection_menu",block_id:t.id,block_type:o,is_toggleable:(0,y._A)(o,t.getFormat()),...n})}e.closeParentMenu&&b.default.reset()},this.handlePopupDismiss=()=>{b.default.reset()}}willUnmount(){super.willUnmount(),this.menuIsOpen()&&b.default.reset()}didMount(){const e=a.findDOMNode(this);e&&e instanceof Element&&(this.node=e)}renderComponent(){const{device:e}=this.environment;if(!e.isPhone)return n()("div",{style:this.getStyle()},void 0,this.renderMenuPopup())}renderMenuPopup(){const{device:e}=this.environment;return n()(x.ZP,{popupType:e.isPhone?M.Z.PopupType.SlideUp:M.Z.PopupType.Popup,open:this.menuIsOpen(),placementToOrigin:M.Z.Placement.Left,alignmentToOrigin:M.Z.Alignment.Center,onDismiss:this.handlePopupDismiss,originGap:5,render:this.renderPopupContent,origin:n()(E.Z,{store:this.props.store,isHoverMenu:!0,canDrag:this.canDrag,canSelect:!1,analyticsName:"selection_menu",disableForceTouch:!0,disableHorizontalDragEdgeScroll:!0},void 0,n()(T.ZP,{onClick:this.handleClick,disableDrag:!this.canDrag||!this.props.hasEditorPermissions||this.props.store.isNavigableAncestorLocked()}))})}renderCollectionHelpButton(){return n()(B.Z,{topBorder:!0},void 0,n()(Z.Z,{title:n()(l.FormattedMessage,{defaultMessage:"Learn about databases",id:"blocks.hoverBlockMenu.collectionHelpButton"}),href:(0,f.UY)("guides.database"),analyticsFrom:"selectable_hover_menu"}))}get canDrag(){return!this.props.disableDrag}menuIsOpen(){const e=b.default.state;return e.isOpen&&e.menuIsOpen&&e.currentStore===this.props.store}getStyle(){return{position:"absolute",top:(0,v.zt)(this.props.offsetTop,this.props.store),left:-(0,v.tx)(this.environment,A.width+2,this.props.store),width:A.width,height:A.height,pointerEvents:"auto",cursor:this.canDrag?"-webkit-grab":void 0}}}A.displayName="SelectableHoverMenu",A.width=T.C$,A.height=T.GN;const D=A},27386:(e,t,o)=>{o.d(t,{k:()=>d,Z:()=>u});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(34859),s=o(91754),l=o(61519),c=o(18647);function d(e){return e?18:60}class p extends r.Z{static renderDivider(){return n()(l.Z,{size:37})}renderComponent(){const{device:e}=this.environment,{children:t,controlRow:o,bannerText:i,controlRowPaddingTopBottom:r=16}=this.props,l=()=>e.isMobile?18:36;return this.props.disableScroller?n()("div",{style:{paddingLeft:d(e.isMobile),paddingRight:d(e.isMobile)}},void 0,n()("div",{style:{paddingTop:l(),paddingBottom:l()}},void 0,t),o&&n()("div",{style:{paddingTop:r,paddingBottom:r,boxShadow:`0 -1px 0 ${this.theme.regularDividerColor}`}},void 0,o)):n()("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%",backgroundColor:this.theme.cardContentBackground}},void 0,i&&n()(s.Z,{type:s.$.Blue,isMobile:!1},void 0,i),n()(c.Z,{type:a.Z.All,style:{flexGrow:1,WebkitOverflowScrolling:"touch",transform:"translateZ(0)",paddingLeft:d(e.isMobile),paddingRight:d(e.isMobile),paddingTop:i?15:l(),paddingBottom:i?22:l()}},void 0,t),o&&n()("div",{style:{flexGrow:0,flexShrink:0,paddingLeft:d(e.isMobile),paddingRight:d(e.isMobile),paddingTop:r,paddingBottom:r,boxShadow:`0 -1px 0 ${this.theme.regularDividerColor}`}},void 0,o))}}p.displayName="SettingBox";const u=p},23189:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(8848),s=o(82990);class l extends r.Z{renderComponent(){const{divider:e,large:t,block:o,children:i,hasMarginTop:r,small:l,style:c,smallMarginBottom:d,isCritical:p,disabled:u}=this.props,m="full"===e;return n()("div",{style:{borderBottom:m?`1px solid ${this.theme.regularDividerColor}`:0,marginBottom:m?16:d?2:8,marginTop:r?16:0,paddingBottom:m?12:0,fontSize:m?16:t?14:l?12:14,fontWeight:m?s.Z.fontWeight.medium:400,width:o?"100%":"auto",color:p?a.ZP.red:u?this.theme.lightTextColor:this.theme.regularTextColor,...c}},void 0,i)}}l.displayName="SettingHeader";const c=l},13490:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(77094),n=o.n(i),r=(o(67294),o(83355));class a extends r.Z{renderComponent(){const{forId:e,children:t,style:o}=this.props;return n()("label",{style:{...this.getStyle(),...o},htmlFor:e},void 0,t)}getStyle(){const{hasMarginTop:e}=this.props,t={display:"block",marginBottom:4,fontSize:12,color:this.theme.mediumTextColor};return e&&(t.marginTop=14),t}}a.displayName="SettingLabel";const s=a},55422:(e,t,o)=>{o.d(t,{Z:()=>R});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(3779),u=o(97880),m=o(5366),g=o(61045),h=o(93678),f=o(11368),v=o(60709),y=o(52275),b=o(31945),S=o(78140),w=o(28992),k=o(9342),C=o(63296),_=o(89728),M=o(72495),T=o(24006),I=o(58032),P=o(64369),x=o(91718),B=o(83590),Z=o(27386),E=o(23189);function R(e){const{title:t,caption:o,captionStyle:i,isMobile:n,upsellOptions:r,type:p,shouldHighlight:u}=e,m=(0,l.O7)(),{paddingLeftCSS:v,paddingRightCSS:y}=(0,c.VK)((()=>m.WindowSizeStore.state),[m]),[b,S]=(0,s.useState)(!1),w=(0,s.useCallback)((()=>S(!0)),[S]),k=(0,s.useCallback)((()=>S(!1)),[S]),C=(0,s.useContext)(f.Ue),_=(0,s.useRef)(null);(0,s.useEffect)((()=>{u&&_.current&&g.bx({element:_.current,scrollers:{verticalScroller:null==C?void 0:C.verticalScroller},vertical:{reveal:"closest"},horizontal:void 0,animate:!0})}),[u,_,null==C?void 0:C.verticalScroller]);const M=(0,d.yK)((t=>({container:{...n&&"dropdown"===p?{display:"flex",flexDirection:"column"}:{display:"flex",alignItems:"center",justifyContent:"space-between"},paddingLeft:n?v:void 0,paddingRight:n?y:void 0,cursor:b&&!e.disabled?"pointer":e.disabled?"not-allowed":"default",...u?{backgroundColor:t.buttonHoveredBackground,marginLeft:-1*(0,Z.k)(n),marginRight:-1*(0,Z.k)(n),paddingLeft:(0,Z.k)(n),paddingRight:(0,Z.k)(n),marginTop:-1*(0,B.f)(n)/2,marginBottom:-1*(0,B.f)(n)/2,paddingTop:(0,B.f)(n)/2,paddingBottom:(0,B.f)(n)/2}:{}},description:{display:"flex",flexDirection:"column",marginRight:"10%"},captionStyle:{...i,...e.disabled?{color:t.lightTextColor}:{}}})),[n,p,v,y,u,b,i,e.disabled]),T="toggle"===e.type||"toggleToButton"===e.type||"custom"===e.type,R=s.createElement("div",{ref:_,style:M.container,onClick:()=>{if(!e.disabled)return r&&r.shouldUpsell?h.y(m,{from:r.analyticsName,for:r.subscriptionTier}):void("toggle"===e.type?e.onToggle():"toggleToButton"===e.type?e.onClick():"custom"===e.type&&e.customButton&&s.isValidElement(e.customButton)&&e.customButton.props.onClick&&"function"==typeof e.customButton.props.onClick&&e.customButton.props.onClick())},onMouseEnter:T?w:void 0,onMouseLeave:T?k:void 0},a()("div",{style:M.description},void 0,a()(E.Z,{smallMarginBottom:!0,disabled:e.disabled,isCritical:e.isCritical},void 0,t,r&&r.shouldUpsell&&a()(x.Z,{subscriptionTier:r.subscriptionTier,analyticsName:r.analyticsName,onClick:()=>h.y(m,{from:r.analyticsName,for:r.subscriptionTier}),desktopStyle:{display:"inline-block",marginLeft:8,marginTop:-3}})),a()(P.Z,{style:M.captionStyle,isSmall:!0,isMultiline:!0},void 0,o)),s.createElement(A,e));return e.tooltipLabel?a()(I.Z,{placement:I.Z.Placement.Bottom,alignment:I.Z.Alignment.Center,disableTooltip:e.disableTooltip,renderTooltip:()=>e.tooltipLabel,render:e=>s.createElement("div",e,R)}):R}function A(e){return"toggle"===e.type?a()(T.Z,{on:e.isOn}):"dropdown"===e.type?s.createElement(D,e):"custom"===e.type?s.createElement(s.Fragment,null,e.customButton):"toggleToButton"===e.type?e.isOn?a()(C.Z,{isLarge:!0,onClick:e.onClick,style:e.buttonStyle,disabled:e.disabled},void 0,e.buttonLabel):a()(T.Z,{on:!1,onClick:e.onClick,disabled:e.disabled}):void(0,u.t1)(e)}function D(e){var t;window.__c={n:"Dropdown"};const{isMobile:o,title:i,upsellOptions:r,currentOption:l,options:c,info:u,onSelectOption:g,menuStyle:h}=e,f=null===(t=c.find((e=>{let{key:t}=e;return t===l})))||void 0===t?void 0:t.label,C=(0,d.yK)((e=>({button:{marginTop:12,marginBottom:4,marginRight:o?"auto":void 0,paddingLeft:o?12:8,paddingRight:o?12:8,height:o?44:28,border:o?`1px solid ${e.outlineButtonBorder}`:void 0},icon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[o]),T=Boolean(r&&r.shouldUpsell)||e.disabled;return a()(b.Z,{popupType:o?b.Z.PopupType.SlideUp:b.Z.PopupType.Popup,placementToOrigin:b.Z.Placement.Right,renderOrigin:e=>s.createElement(_.Z,n()({},e,{isLarge:!0,style:{...C.button,opacity:T?.4:1},disabled:T}),f,p.Z.chevronDown(C.icon)),render:e=>{let t;t=o?{menuType:v.og.Modal,title:i,right:a()(m.FormattedMessage,{defaultMessage:"Done",id:"settingItem.buttonPopup.done.label"}),onClickRight:e.close}:{menuType:v.og.Popup,width:250,...h};const r=[{key:"settings-item-section",render:e=>s.createElement(M.Z,e),items:c.map((t=>{let{key:i,label:r,caption:l}=t;return{key:i,action:()=>{g(i),e.close()},render:e=>s.createElement(y.Z,n()({},e,{title:r,caption:l,shouldWrapCaption:!0,right:f===r?a()("div",{style:{width:o?16:14}},void 0,p.Z.check()):void 0}))}}))}];if(u){const e=u.map((e=>{let{key:t,label:o}=e;return{key:t,action:()=>{},render:e=>s.createElement(w.Z,n()({},e,{shouldWrapCaption:!0,caption:o}))}}));r.push({key:"info-item-section",render:e=>s.createElement(M.Z,n()({},e,{topBorder:!0})),items:e})}return s.createElement(S.Z,t,a()(k.Z,{type:k.i.Vertical,sections:r,initialFocus:void 0}))}})}},1101:(e,t,o)=>{o.d(t,{Z:()=>b});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(82990),p=o(60709),u=o(61766),m=o(48019),g=o(64921),h=o(31945),f=o(78140),v=o(72495);class y extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:u.Z}}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:p.og.ActionSheet}:{menuType:p.og.Popup},a()("div",{style:this.getContainerStyle()},void 0,a()("div",{style:this.getTextStyle()},void 0,this.props.emailAddress),a()(h.Z,{popupType:e.isMobile?h.Z.PopupType.SlideUp:h.Z.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>{if(!this.props.disabled)return s.createElement(g.Z,n()({},e,{style:this.getButtonStyle()}),c.Z.dots(this.getButtonIconStyle()))},render:()=>s.createElement(f.Z,t,a()(m.Z,{sections:[{key:"option section",render:e=>s.createElement(v.Z,e),actions:this.props.accountActions}],context:{environment:this.environment,blocks:[],publicEditMode:void 0}}))}))}getButtonStyle(){const{device:e}=this.environment;return{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:e.isMobile?24:20,height:e.isMobile?24:20,borderRadius:3}}getButtonIconStyle(){const{device:e}=this.environment;return{width:e.isMobile?18:12,height:e.isMobile?18:12}}getContainerStyle(){return{marginTop:this.environment.device.isMobile?20:8,marginLeft:12,marginRight:12,display:"flex",alignItems:"center",justifyContent:"space-between",color:this.theme.mediumTextColor}}getTextStyle(){return{fontSize:this.environment.device.isMobile?14:11,lineHeight:d.Z.lineHeight.UISmall.desktop,fontWeight:d.Z.fontWeight.medium}}}y.displayName="SidebarAccountHeader";const b=y},14694:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(480)),a=o(81954),s=o(24405),l=o(3779),c=o(50659);function d(){window.__c={n:"AliasIcon"};const e=(0,s.yK)((e=>({icon:{position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===e.mode?e.regularTextColor:"#3E3C38",stroke:"dark"===e.mode?e.sidebarBackground:"white",strokeWidth:"dark"===e.mode?"1.85px":"1.5px"}})),[]);return n()("div",{},void 0,l.Z.pageLinkIndicator(e.icon))}function p(e){var t;window.__c={n:"SidebarItem"};const o=(0,r.O7)(),i=o.device.isMobile,l=(0,a.VK)((()=>{var t,n;if(i)return o.WindowSizeStore.getSafePaddingLeftCSS("number"==typeof(null===(t=e.style)||void 0===t?void 0:t.paddingLeft)?null===(n=e.style)||void 0===n?void 0:n.paddingLeft:10)}),[o.WindowSizeStore,i,null===(t=e.style)||void 0===t?void 0:t.paddingLeft]),p=(0,s.yK)((t=>({wrapper:{...i?{display:"flex",alignItems:"center",width:"100%",minHeight:26,fontSize:16,paddingTop:8,paddingBottom:8,paddingLeft:l,paddingRight:10,userSelect:"none",WebkitUserSelect:"none",boxShadow:e.disableMobileBorder?void 0:`0 1px 0 ${t.regularDividerColor}`,marginBottom:e.shouldShowMobileMarginBottom?12:1}:{display:"flex",alignItems:"center",width:"100%",fontSize:14,minHeight:27,paddingTop:2,paddingBottom:2,marginTop:1,marginBottom:1,...(0,c.MF)()},...e.style},icon:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:i?28:22,height:i?24:18,marginLeft:-3,marginRight:4,position:"relative"},right:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,height:"100%"},left:{flexShrink:0,flexGrow:0,borderRadius:3,color:t.mediumTextColor,width:i?26:22,height:i?24:22,display:"flex",alignItems:"center",justifyContent:"center",marginRight:e.icon?0:8},children:{flexGrow:1,flexShrink:1,flexBasis:"auto",whiteSpace:"nowrap",minWidth:0,overflow:"hidden",textOverflow:e.right&&!i?"clip":"ellipsis",...e.childrenStyle}})),[l,e.childrenStyle,e.disableMobileBorder,e.icon,i,e.right,e.shouldShowMobileMarginBottom,e.style]);return n()("div",{style:p.wrapper,onFocus:e.onFocus,onBlur:e.onBlur,onMouseMove:e.onMouseMove,onMouseLeave:e.onMouseLeave,onClick:e.onClick,className:e.className},void 0,e.left&&n()("div",{style:p.left},void 0,e.left),e.icon&&n()("div",{style:p.icon},void 0,e.icon,e.isAlias&&n()(d,{})),n()("div",{style:p.children},void 0,e.children),e.right&&n()("div",{style:p.right},void 0,e.right))}},98285:(e,t,o)=>{o.d(t,{Z:()=>C});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(5366),d=o(50906),p=o(5978),u=o(43250),m=o(88632),g=o(96071),h=o(30278),f=o(85974),v=o(64157),y=o(17364),b=o(52275),S=o(31945),w=o(46457);class k extends l.Z{constructor(){super(...arguments),this.storeTypes={loginStore:f.Z,loginPermissionsStore:h.Z,loginModalStore:g.Z},this.renderAccountActionModal=(e,t)=>{let o,i;switch(e){case"add-account":o=a()(c.FormattedMessage,{id:"sidebarSwitcherMultiAccount.addAccount.title",defaultMessage:"Add an account",description:"Title to add an account"}),i=a()(c.FormattedMessage,{id:"sidebarSwitcherMultiAccount.addAccount.description",defaultMessage:"Use an existing account, or sign up with a new email. Your current account will remain logged in.",description:"Description when adding an account"});break;case"create-work":o=a()(c.FormattedMessage,{id:"sidebarSwitcherMultiAccount.createWork.title",defaultMessage:"Create a work account",description:"Title to create a work account"}),i=a()(c.FormattedMessage,{id:"sidebarSwitcherMultiAccount.createWork.description",defaultMessage:"We’ll check if your teammates are already on Notion. If not, we’ll create a new home for you and your team.",description:"Description when creating a work account"});break;default:throw new Error(this.props.intl.formatMessage({defaultMessage:"Unexpected createType in SidebarSwitcherMultiAccount",id:"sidebarSwitcherMultiAccount.errorMessage"}))}return a()(w._,{loginModalStore:this.stores.loginModalStore,loginStore:this.stores.loginStore,title:o,description:i,disableLoginLink:this.props.disableLoginLink,className:u.zYS,redirectURL:this.props.redirectURL,onDismiss:t})},this.supportsNativeHomeOnPhone=()=>{const{mobileNative:e}=this.environment;return(null==e?void 0:e.supportsNativeHomeOnPhone())||!1},this.getAccountActionStyle=()=>{const{device:e}=this.environment;return{display:"flex",color:this.theme.mediumTextColor,whiteSpace:"nowrap",fontSize:e.isMobile?16:12}}}willMount(e){super.willMount(e);const{loginStore:t}=this.stores;"email"===t.state.loginType&&this.environment.device.isMobile&&t.setState({...t.state,loginType:"google"})}renderComponent(){const{online:e}=m.Z.state,{device:t}=this.environment,{createType:o}=this.props,i=this.supportsNativeHomeOnPhone();return t.isMobile?a()(S.Z,{popupType:S.Z.PopupType.SlideUp,hidesMobileNativeBottomBar:i,preventSlideUpTransition:i,buttonPopupStore:"add-account"===o?v.C:v.E,alignmentToOrigin:S.Z.Alignment.Start,placementToOrigin:S.Z.Placement.Top,originGap:0,isFullWidthOnMobile:!0,render:e=>this.renderAccountActionModal(o,(()=>{this.supportsNativeHomeOnPhone()?p.navigateToHomeTab(this.environment,e.close):e.close()})),preventScaleTransition:!0,renderOrigin:t=>s.createElement(b.Z,n()({focused:!1,disabled:!e,title:this.renderMenuButtonLoginTitle(o),icon:this.props.icon},t))}):a()("div",{onClick:()=>{e&&(d.trackMultiAccountAddOrCreateAccount(this.environment,{createType:o}),y.Z.setState({...y.Z.getState(),createType:o}),this.stores.loginModalStore.setState({open:!0}))}},void 0,a()(b.Z,{focused:!1,disabled:!e,title:this.renderMenuButtonLoginTitle(o),icon:this.props.icon}),this.renderAccountActionModal(o))}renderMenuButtonLoginTitle(e){switch(e){case"create-work":return a()("div",{style:this.getAccountActionStyle()},void 0,a()(c.FormattedMessage,{defaultMessage:"Create work account",id:"sidebarSwitcherMultiAccount.menuItem.createWorkAccountButton.label"}));case"add-account":return a()("div",{style:this.getAccountActionStyle()},void 0,a()(c.FormattedMessage,{defaultMessage:"Add another account",id:"sidebarSwitcherMultiAccount.addAccountButton.label"}))}}}k.displayName="SidebarSwitcherLoginModal";const C=(0,c.injectIntl)(k)},34011:(e,t,o)=>{o.d(t,{Z:()=>b});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(60709),p=o(25464),u=o(64921),m=o(5145),g=o(31278),h=o(58032),f=o(64369),v=o(39849);class y extends l.Z{renderComponent(){const{device:e}=this.environment,{id:t,onClick:o,focused:i,isAddButton:r,title:l,caption:d,shortcut:m,tooltipMessage:g,disableTooltip:v,disabled:y,showDragHandle:b}=this.props,S=this.environment.device.isMobile,w=this.props.isCheck;return a()(h.Z,{renderTooltip:()=>g,disableTooltip:v,placement:p.u.Bottom,render:t=>s.createElement(u.Z,n()({},t,{mobileFeedback:this.environment.device.isMobile,onClick:o,hovered:i,disabled:y,style:this.getStyle()}),b&&this.renderDragHandle(),r?this.renderAddIcon():this.renderIcon(),a()("div",{style:{marginLeft:12,marginRight:m||w?12:0,minWidth:0}},void 0,a()(f.Z,{className:"notranslate",isMobile:e.isMobile},void 0,l),d&&a()(f.Z,{isSmall:!0,isMobile:e.isMobile},void 0,d)),w&&c.Z.check({width:16,height:16,marginLeft:"auto"}),m&&!S&&!w&&a()("div",{style:this.getShortcutStyle()},void 0,m))},`sidebarswitchermenuitem-tooltip-${t}`)}renderDragHandle(){return a()(m.ZP,{iconSize:12,style:{marginLeft:-6,marginRight:4,visibility:this.props.isAddButton?"hidden":"visible"}})}renderIcon(){const e=this.environment.device.isMobile;return a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()("div",{style:{position:"relative"}},void 0,this.props.id&&a()(g.Z,{disabled:!0,icon:this.props.icon,isEmptyPage:!1,title:this.props.title,size:e?y.mobileIconSize:y.desktopIconSize,isLarge:!0}),a()(v.Z,{color:v.Z.Color.Red,count:this.props.unreadMentions,style:{position:"absolute",top:-5,right:-5}})))}renderAddIcon(){const e=this.environment.device.isMobile?y.mobileIconSize:y.desktopIconSize;return a()("div",{style:{...this.getIconWrapStyle(),width:e,height:e}},void 0,this.getPlusIcon())}getStyle(){const e=this.environment.device.isMobile,{WindowSizeStore:t}=this.environment,{disabled:o}=this.props;return{display:"flex",alignItems:"center",lineHeight:"120%",width:"100%",paddingTop:e?8:4,paddingBottom:e?8:4,paddingLeft:e?t.getSafePaddingLeftCSS(16):14,paddingRight:e?t.getSafePaddingRightCSS(16):14,...e&&{boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`},marginBottom:1,fontSize:e?16:14,...e&&{background:this.theme.popoverBackground},height:e?54:48,...this.props.isAddButton&&!e&&{boxShadow:"none",marginBottom:0},...o&&{opacity:.4}}}getPlusIcon(){return c.Z.plus({flexGrow:0,flexShrink:0,width:16,height:16,fill:this.theme.popoverBackground})}getIconWrapStyle(){return{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",background:this.theme.lightIconColor,borderRadius:3,flexShrink:0}}getShortcutStyle(){return{color:this.theme.lightTextColor,fontSize:12,whiteSpace:"nowrap",marginLeft:"auto",flexShrink:0}}}y.displayName="SidebarSwitcherMenuItem",y.contextTypes={...d.mw,...l.w},y.mobileIconSize=36,y.desktopIconSize=32,y.dragHandleEffectiveWidth=16;const b=y},31280:(e,t,o)=>{o.d(t,{_S:()=>be,g6:()=>Se,ZP:()=>we});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(16691),u=o(3779),m=o(45953),g=o(98459),h=o(89101),f=o(77858),v=o(66079),y=o(80503),b=o(5366),S=o(95182),w=o(50906),k=o(97977),C=o(74647),_=o(29974),M=o(94507),T=o(30149),I=o(65452),P=o(43250),x=o(28125),B=o(60709),Z=o(59488),E=o(45094),R=o(38755),A=o(25464),D=o(79315),F=o(88632),L=o(24042),V=o(10161),N=o(30278),O=o(85974),U=o(81236),H=o(3815),z=o(76487),W=o(62213),j=o(17364),K=o(12318),Y=o(64921),G=o(52275),X=o(31945),q=o(79131),$=o(73063),J=o(58261),Q=o(16354),ee=o(78140),te=o(9342),oe=o(40721),ie=o(72495),ne=o(58032),re=o(39849),ae=o(92955),se=o(1101),le=o(82990),ce=o(56496),de=o(31278),pe=o(14694);class ue extends d.Z{renderComponent(){return a()("div",{style:this.getPlaceholderPageStyle()},void 0,this.props.showIcon&&u.Z.templates({width:16,height:16,fill:this.theme.buttonHoveredBackground}),a()("div",{style:this.getPlaceholderTextWrapStyle()},void 0,a()("div",{style:ue.getPlaceholderTextStyle(this.theme)})))}getPlaceholderPageStyle(){return{height:28,display:"flex",alignItems:"center",width:"100%",padding:this.props.showIcon?"0 15px":"0 0px"}}getPlaceholderTextWrapStyle(){return{flexGrow:1,marginLeft:this.props.showIcon?10:0,height:28,display:"flex",alignItems:"center"}}static getPlaceholderTextStyle(e){const t=Math.ceil(60),o=Math.floor(85),i=`${Math.floor(Math.random()*(o-t+1))+t}%`;return{height:4,background:e.buttonHoveredBackground,width:i}}}ue.displayName="SidebarPlaceholderItem";const me=ue;class ge extends d.Z{willMountOrUpdate(){"store"===this.props.type&&this.props.spaceStore.getValue()}renderComponent(){const{device:e}=this.environment,{props:t}=this,{activeUserEmailAddress:o,isMobile:i,style:n,showExpand:r}=t,s="store"===t.type?(0,R.rn)(this.environment,t.spaceStore):t.spaceName;return a()(pe.Z,{style:{overflow:"hidden",width:"100%",...i&&{fontSize:14,padding:0,marginRight:12},...!i&&{paddingLeft:14,paddingRight:14},...n||{}},left:s?this.renderRecordIcon(s,"store"===t.type?void 0:t.spaceIcon,i,"store"===t.type?t.spaceStore:void 0):this.renderPlaceholderRecordIcon(),disableMobileBorder:!0},void 0,!s&&this.renderPlaceholderTitle(),s&&a()("div",{style:{display:"flex",alignItems:"center",justifyContent:o?"space-between":"start"},className:"notranslate"},void 0,a()("div",{style:{display:"flex",flexDirection:"column",marginRight:6,marginTop:e.isAndroid?3:0,...ge.truncateStyle}},void 0,a()("div",{style:{color:this.theme.regularTextColor,fontWeight:le.Z.fontWeight.medium,...ge.truncateStyle}},void 0,s),a()("div",{style:{color:this.theme.mediumTextColor,fontSize:11,lineHeight:"12px",fontWeight:le.Z.fontWeight.regular,...ge.truncateStyle}},void 0,o)),r&&a()("div",{style:{flexGrow:0,flexShrink:0,width:12,height:12,fill:this.theme.mediumIconColor}},void 0,u.Z.expand())))}renderRecordIcon(e,t,o,i){const n=i?(0,R.Wd)(this.environment,i):t?{icon:t,pointer:{table:"space",id:"undefined"}}:void 0,r=i?(0,R.rn)(this.environment,i):e;return a()(de.Z,{disabled:!0,icon:n,isEmptyPage:!1,title:r,size:o?24:22,style:{marginTop:1,color:this.theme.regularTextColor,fontWeight:le.Z.fontWeight.medium}})}renderPlaceholderRecordIcon(){return a()("div",{style:{opacity:.25}},void 0,a()(ce.Z,{size:20,title:void 0}))}renderPlaceholderTitle(){return a()(me,{showIcon:!1})}}ge.displayName="SidebarSpaceName",ge.truncateStyle={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"};const he=ge;var fe=o(98285),ve=o(34011),ye=o(29538);let be;!function(e){e[e.Regular=0]="Regular",e[e.DesktopMac=1]="DesktopMac",e[e.Mobile=2]="Mobile"}(be||(be={}));class Se extends d.Z{constructor(){super(...arguments),this.sidebarSwitcherIsHovered=new K.default(!1),this.storeTypes={loginStore:O.Z,loginPermissionsStore:N.Z},this.height={[be.Regular]:y.Aj,[be.DesktopMac]:y.br,[be.Mobile]:"auto"},this.handleDesktopAppClick=()=>{const{device:e}=this.environment;this.close(),e.isWindows?w.trackDownloadDesktopApp(this.environment,{from:"sidebar",app_platform:"windows"}):w.trackDownloadDesktopApp(this.environment,{from:"sidebar",app_platform:"mac"})},this.handleMobileAppClick=()=>{this.close(),w.trackDownloadMobileApp(this.environment,{from:"sidebar"})},this.handleClick=()=>{W.Z.setState({...W.Z.state,open:!0}),w.trackOpenSpaceSwitcher(this.environment),j.Z.getUserIds(this.environment).forEach((e=>{j.Z.getSpaceViewStores(this.environment,e).forEach((t=>{const o=t.getSpaceId();o&&(I.h({environment:this.environment,spaceId:o,userId:e}),M.I({environment:this.environment,spaceId:o,userId:e}))}))}))},this.logout=()=>{const{online:e}=F.Z.state;e&&(W.Z.setState({...W.Z.state,open:!1}),w.trackSpaceSwitcherLogoutClick(this.environment),k.logout(this.environment))},this.handleDraggableListDrop=e=>t=>{const o=t.filter((e=>"create-workspace-row"!==e)).map(p.Vg).map((e=>m.dr.fromSpaceShardRecordId(e,f.zU))),i=new H.r9(this.environment,{table:v.dx,id:e},{userId:e});T.createAndCommit({userAction:"SidebarSwitcherMultiAccount.handleDraggableListDrop",environment:this.environment,perform:e=>{_._Q({userRootStore:i,transaction:e,spaceViewIds:o.map((e=>e.id)),spaceViewPointers:o})},userId:e}),w.trackReorderWorkspaces(this.environment,{workspace_count:t.length})},this.getAccountActionStyle=()=>({display:"flex",color:this.theme.mediumTextColor,whiteSpace:"nowrap",fontSize:this.isMobile?16:12,paddingLeft:this.isMobile||this.isOnlySpace()?0:ve.Z.dragHandleEffectiveWidth}),this.getFooterStyle=()=>this.environment.device.isMobile?{}:{backgroundColor:this.theme.sidebarSwitcherFooterBackground}}renderComponent(){const{device:e}=this.environment,{shouldShowUnexpandButton:t}=this.props,{currentSpaceStore:o,currentUserStore:i}=D.default.state,n=j.Z.getUserIds(this.environment);if(!o||!i)return;const r=n.length>1?i.getEmail():void 0,s=this.getUnreadCountForOtherSpaces(),l=Boolean(this.props.disabled),d="circle_button"===V.default.getEligibleGroup({experimentId:"new_page_button",defaultGroup:"unassigned"});return a()(X.Z,{popupType:e.isMobile?X.Z.PopupType.SlideUp:X.Z.PopupType.Popup,buttonPopupStore:W.Z,renderOrigin:()=>a()(Y.Z,{style:{...Se.buttonStyle,height:this.height[this.props.format],marginBottom:r?e.isMobile?0:8:0,padding:0,...this.props.buttonStyle},mobileFeedback:e.isMobile,onClick:this.handleClick,disabled:l,className:P.rli,hovered:this.sidebarSwitcherIsHovered.get(),ignoreLocalHoverState:!0,onMouseEnter:()=>this.sidebarSwitcherIsHovered.set(!0),onMouseLeave:()=>this.sidebarSwitcherIsHovered.set(!1)},void 0,a()(he,{isMobile:this.isMobile,spaceStore:o,activeUserEmailAddress:d?void 0:r,showExpand:!l,type:"store",style:{marginLeft:0}}),a()("div",{className:P.JiD,style:{display:"flex",alignItems:"center",height:"100%",marginLeft:"auto",marginRight:s&&!d?0:12}},void 0,t&&a()(ye.V,{}),(!d||!t)&&a()(ae.Z,{type:"otherSpaces",color:re.Z.Color.Red,style:{marginLeft:6,marginRight:d?0:14}}),d&&this.renderNewPageButton())),originGap:0,disableMutationObserver:!0,render:t=>{let o;return o=e.isMobile?{menuType:B.og.Modal,title:a()(b.FormattedMessage,{defaultMessage:"Accounts & Workspaces",id:"sidebarSwitcherMultiAccount.mobileMenu.title"}),right:a()(oe.DoneMenuText,{}),onClickRight:t.close}:{menuType:B.og.Popup,minWidth:270,maxWidth:360,footer:this.renderFooter()},c.createElement(ee.Z,o,n.map(((t,o)=>{const i=this.getMenuListSections(t);return i.length>0?a()(c.Fragment,{},t,this.renderAccountHeader(t),a()("div",{style:e.isMobile?{paddingTop:10}:o!==n.length-1?{borderBottom:`1px solid ${this.theme.lightDividerColor}`}:{}},void 0,a()(te.Z,{type:te.i.Vertical,sections:i,initialFocus:void 0}))):void 0})),e.isMobile&&this.renderFooter())}})}renderNewPageButton(){return a()(ne.Z,{renderTooltip:()=>c.createElement(c.Fragment,null,a()("div",{},void 0,this.props.intl.formatMessage(C.newPageMessages.tooltip)),this.environment.device.isNative&&a()(J.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"newPage"})),originGap:6,placement:A.u.Right,render:e=>c.createElement($.Z,n()({},e,{ariaLabel:this.props.intl.formatMessage(C.newPageMessages.label),hasBackground:!0,icon:u.Z.renameThick,iconStyle:{width:15,height:15},showShadow:!0,style:{marginLeft:6,borderRadius:100,width:32,height:32,boxShadow:"none",border:`1px solid ${this.theme.regularDividerColor}`},isDarkIconColor:!0,onMouseEnter:t=>{var o;this.sidebarSwitcherIsHovered.set(!1),null===(o=e.onMouseEnter)||void 0===o||o.call(e,t)},onMouseLeave:t=>{var o;this.sidebarSwitcherIsHovered.set(!0),null===(o=e.onMouseLeave)||void 0===o||o.call(e,t)},onClick:()=>{C.quickAddPage({environment:this.environment,from:"sidebar_new_page_button"})}}))})}renderAccountHeader(e){const{online:t}=F.Z.state,o=j.Z.getUserEmailAddress(this.environment,e);return o&&a()(se.Z,{emailAddress:o,userId:e,disabled:!t,accountActions:[(0,S.qu)(e),(0,S.pD)(e)]})}renderFooter(){const{redirectURL:e,disableLoginLink:t}=this.props,o=c.createElement(c.Fragment,null,!this.hasAtLeastOneTeamPlan()&&c.createElement(fe.Z,n()({createType:"create-work",redirectURL:e,disableLoginLink:t},this.stores)),!(0,Z.Y)("supportsNativeHome")&&c.createElement(fe.Z,n()({createType:"add-account",redirectURL:e,disableLoginLink:t},this.stores)));return a()("div",{style:this.getFooterStyle()},void 0,a()(ie.Z,{topBorder:!0},void 0,x.kH(this.environment)&&o,this.renderLogoutAll()),!this.isMobile&&a()(ie.Z,{topBorder:!0},void 0,this.renderDownloadApps()))}renderDownloadApps(){const{device:e}=this.environment;return e.isElectron?a()(Q.Z,{external:!0,href:h.AR.mobile,onClick:this.handleMobileAppClick},void 0,a()(G.Z,{focused:!1,title:a()("div",{style:{color:this.theme.mediumTextColor,fontSize:12}},void 0,a()(b.FormattedMessage,{defaultMessage:"Get iOS & Android app",id:"sidebarMultiSwitcher.desktopAppGetMobileApp.prompt"}))})):a()(Q.Z,{external:!0,href:h.AR.desktop,onClick:this.handleDesktopAppClick},void 0,a()(G.Z,{focused:!1,title:a()("div",{style:{color:this.theme.mediumTextColor,fontSize:12}},void 0,e.isWindows?a()(b.FormattedMessage,{defaultMessage:"Get Windows app",id:"sidebarMultiSwitcher.windowsAppButton.text"}):a()(b.FormattedMessage,{defaultMessage:"Get Mac app",id:"sidebarMultiSwitcher.macAppButton.text"}))}))}renderLogoutAll(){const{online:e}=F.Z.state,t=j.Z.getUserIds(this.environment).length>1;return a()(G.Z,{onClick:this.logout,focused:!1,disabled:!e,title:a()("div",{style:{...this.getAccountActionStyle(),paddingLeft:0}},void 0,a()(b.FormattedMessage,{defaultMessage:"{isLoggedIntoMultipleAccounts, select, true {Log out all accounts} other {Log out}}",id:"sidebarSwitcherMultiAccount.menuItem.logoutAllButton.label",values:{isLoggedIntoMultipleAccounts:t}}))})}getMenuListSections(e){const{device:t}=this.environment,o=[...j.Z.getSpaceViewStores(this.environment,e).map((e=>e.pointer)).map((e=>({id:e.id,spaceId:(0,g.CG)(e.spaceId)}))).map(p.vY),"create-workspace-row"];return[{key:"spaces",render:i=>c.createElement(ie.Z,n()({},i,{disableMobilePadding:!0,topBorder:t.isMobile,children:t.isMobile?i.children:a()(c.Fragment,{},void 0,a()(q.ZP,{direction:"vertical",keys:o,renderKey:e=>i.children[o.indexOf(e)],onDrop:this.handleDraggableListDrop(e),style:{marginBottom:1}}))})),items:this.getSpaceMenuListItems(e)}]}renderSpaceMenuItem(e){const{device:t}=this.environment,{online:o}=F.Z.state,i=!this.isOnlySpace(e.userId)&&!t.isMobile;return c.createElement(ve.Z,n()({},e.props,{id:e.id,icon:e.icon,title:e.title,caption:e.subtitle,isCheck:e.isCurrentSpace,unreadMentions:e.unreadMentions,showDragHandle:i,shortcut:this.getSwitcherShortcut({isElectronMac:t.isElectronMac,isElectronUsingCommandNumber:e.isElectronUsingCommandNumber,shortcutIndex:e.shortcutIndex}),disabled:!o&&this.environment.currentUser.id!==e.userId,disableTooltip:!0}))}getSwitcherShortcut(e){if(e.shortcutIndex&&!(e.shortcutIndex>9))return e.isElectronMac?e.isElectronUsingCommandNumber?`⌃⇧${e.shortcutIndex}`:`⌘${e.shortcutIndex}`:e.isElectronUsingCommandNumber?`alt+shift+${e.shortcutIndex}`:`ctrl+${e.shortcutIndex}`}getSpaceMenuListItems(e){const{onSpaceClick:t}=this.props,{device:o}=this.environment,i=[],{currentUserRootStore:n,currentSpaceStore:r}=D.default.state,{isElectronUsingCommandNumber:a}=L.Z.state,s=j.Z.getSpaceViewStores(this.environment,e),c=j.Z.getAllSpaceViewStores(this.environment);if(!n||!r)return[];for(const[d,p]of s.entries()){const s=p.getSpaceStore();if(s){const d=e===n.id&&s.id===r.id,{results:u}=z.Z.state,m=u.find((e=>e.spaceId===s.id)),g=(0,R.rn)(this.environment,s);let h;const f=U.Z.getPublicSpaceData(this.environment,s.id);if(f){const e=this.props.intl.formatMessage((0,E.em)(f.subscriptionTier));h=this.props.intl.formatMessage(E.js.workspaceSubtitleWithMembers,{numberOfWorkspaceMembers:this.props.intl.formatNumber(f.memberCount),planType:e})}const v=l().findIndex(c,(e=>e.id===p.id))+1;i.push({key:p.id,render:t=>this.renderSpaceMenuItem({id:s.id,props:t,title:g,subtitle:h,shortcutIndex:o.isElectron?v:void 0,icon:(0,R.Wd)(this.environment,s),isCurrentSpace:d,userId:e,isElectronUsingCommandNumber:a,unreadMentions:e===this.environment.currentUser.id&&m&&m.spaceId!==r.id&&m.unread.mentions>0?m.unread.mentions:void 0}),action:async e=>{let{event:o}=e;this.close(),d||await t({event:o,spaceViewStore:p}),w.trackSpaceSwitcherSelectSpace(this.environment)}})}}return i}close(){W.Z.setState({...W.Z.state,open:!1})}get isMobile(){return this.props.format===be.Mobile}isOnlySpace(e){return 1===(e?j.Z.getSpaceViewStores(this.environment,e):j.Z.getAllSpaceViewStores(this.environment)).length}hasAtLeastOneTeamPlan(){return j.Z.hasAtLeastOneTeamPlan(this.environment)}getUnreadCountForOtherSpaces(){return z.Z.getUnreadMentionsCountForOtherSpaces()}}Se.displayName="SidebarSwitcherMultiAccount",Se.Format=be,Se.buttonStyle={display:"flex",alignItems:"center",minWidth:0,height:"100%",width:"100%"};const we=(0,b.injectIntl)(Se)},21323:(e,t,o)=>{o.d(t,{Z:()=>ie});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(5366),p=o(50906),u=o(42858),m=o(30149),g=o(98742),h=o(79315),f=o(11689),v=o(43339),y=o(64921),b=o(31945),S=o(66094),w=o(14694),k=o(1800),C=o(21202),_=o(5978),M=o(31299),T=o(74647),I=o(39865),P=o(95477),x=o(43250),B=o(33929),Z=o(60709),E=o(33665),R=o(88632),A=o(3815),D=o(72087),F=o(68894),L=o(68785),V=o(78140),N=o(9342),O=o(43765),U=o(40721),H=o(89728),z=o(11470),W=o(77137),j=o(43145),K=o(72495),Y=o(30506),G=o(33411),X=o(58032),q=o(83182),$=o(46247),J=o(66957);const Q=(0,d.defineMessages)({filterByPlaceholder:{id:"sidebarTrash.filterBy.placeholder",defaultMessage:"Filter by page title…"}});class ee extends l.Z{constructor(){super(...arguments),this.storeTypes={requestStore:D.Z},this.renderTrashPages=(e,t)=>{const{device:o}=this.environment,i=t?t.results:[],{mainEditorCurrentBlockStore:r}=h.default.state;if(!r)return;const l=i.map((e=>A.G.createChildStore(r,{table:C.iU,id:e}))).filter((e=>e.isDefined()&&!v.Z.state.excludePages.has(e.id))).map((e=>({key:e.id,action:t=>{let{event:i}=t;if("metaKey"in i&&i.metaKey){const t=(0,k.Z)({baseUrl:P.Z.domainBaseUrl,pageId:e.id});_.navigateToExternalURL({environment:this.environment,url:t})}else _.navigateToBlock({environment:this.environment,store:e}),f.Z.setState({...f.Z.state,open:!1});o.isMobile&&T.close()},render:t=>s.createElement(z.Z,n()({},t,{dontShrinkRight:!0,store:e,right:a()("div",{style:{display:"flex"}},void 0,a()(X.Z,{placement:X.Z.Placement.Bottom,renderTooltip:()=>a()(d.FormattedMessage,{defaultMessage:"Restore",id:"sidebarTrash.restorePageButton.tooltip"}),render:t=>s.createElement(H.Z,n()({isGray:!0,onClick:()=>this.handleRestoreClick(e)},t),c.Z.undo({width:18,height:18}))}),a()(X.Z,{placement:X.Z.Placement.Bottom,renderTooltip:()=>a()(d.FormattedMessage,{defaultMessage:"Delete permanently",id:"sidebarTrash.deletePagePermanentlyButton.tooltip"}),render:t=>s.createElement(H.Z,n()({isGray:!0,onClick:()=>this.handleDeleteClick(e)},t),c.Z.trash({width:18,height:18}))}))}))})));return 0===l.length?a()(K.Z,{},void 0,o.isMobile?a()(O.Z,{title:a()(d.FormattedMessage,{defaultMessage:"No matches found.",id:"sidebarTrash.mobileFilterBy.noMatchesPrompt"})}):a()("div",{style:{fontSize:14,color:this.theme.mediumTextColor,textAlign:"center"}},void 0,a()(d.FormattedMessage,{defaultMessage:"No matches found.",id:"sidebarTrash.filterBy.noMatchesPrompt"}))):a()(s.Fragment,{},void 0,a()(N.Z,{type:N.i.Vertical,initialFocus:void 0,sections:[{key:0,items:l,render:e=>s.createElement(K.Z,e)}]}),a()(G.Z,{show:this.stores.requestStore.state.loading,showDelay:500,showHold:200,render:e=>{if(e)return a()("div",{style:{height:44,display:"flex",flex:1,alignItems:"center",justifyContent:"center"}},void 0,a()(L.Z,{}))}}),a()(j.Z,{onChange:this.handleScrollOffsetChange}))},this.handleSwipeLeft=()=>{const e=ee.tabs.indexOf(v.Z.state.currentTab)+1,t=ee.tabs[e];void 0!==t&&this.changeTab(t)},this.handleSwipeRight=()=>{const e=ee.tabs.indexOf(v.Z.state.currentTab)-1,t=ee.tabs[e];void 0!==t&&this.changeTab(t)},this.handleTabChange=e=>{const t=ee.tabs[e];this.changeTab(t)},this.handleRestoreClick=e=>{const{currentSpaceStore:t}=h.default.state;t&&I.cB({environment:this.environment,block:e,spaceId:e.pointer.spaceId||t.id})},this.handleDeleteClick=e=>{I.Rn({environment:this.environment,blocks:[e]})},this.handleSearchInputChange=e=>{v.Z.setState({...v.Z.state,filter:e.target.value,limit:v.Z.startLimit})},this.handleClose=()=>{const{mobileNative:e}=this.environment,t=()=>{f.Z.setState({...f.Z.state,open:!1})};null!=e&&e.supportsNativeHomeOnPhone()?_.navigateToHomeTab(this.environment,t):t()},this.handleScrollOffsetChange=e=>{const{requestStore:t}=this.stores,{ready:o,loading:i,result:n}=t.state,r=n;e<=v.Z.loadMoreOffset&&r&&o&&!i&&!r.endOfResultsReached&&v.Z.setState({...v.Z.state,limit:v.Z.state.limit+v.Z.limitIncrement})},this.performSearchRequest=async e=>{const{currentSpaceStore:t,mainEditorCurrentBlockStore:o,currentUserStore:i}=h.default.state;if(!t||!o||!i)return;const{limit:n,filter:r,currentTab:a}=v.Z.state;let s,l;if("in_current_page"===a)if(o.isCollectionView()){if(!o.isDefined())return;const e=o.getCollectionPointer();if(!e)return;l=e.id}else l=o.id;else"last_edited_by_me"===a&&(s=i.id);return await M.bI({environment:this.environment,query:r,limit:n,ancestorId:l,spaceId:t.id,editedById:s})}}willMount(e){super.willMount(e),v.Z.setState({...v.Z.state,limit:v.Z.startLimit,excludePages:new Set})}willUnmount(){v.Z.setState({...v.Z.state,filter:""})}renderComponent(){const{mobileNative:e}=this.environment;return null!=e&&e.supportsNativeHomeOnPhone()?this.renderNativeHomeEnabledLayout():this.renderLayout()}renderLayout(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:Z.og.Modal,title:a()(d.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrash.menu.header"}),left:this.renderMobileHelpButton(),right:a()(U.DoneMenuText,{}),onClickRight:this.handleClose,onCancel:this.handleClose,header:this.renderHeaderWithTabs()}:{menuType:Z.og.Popup,height:"50vh",width:414,header:this.renderHeaderWithTabs(),footer:this.renderFooter()},a()(Y.Z,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>s.createElement(V.Z,n()({},t,e,{className:x.TYv}),this.renderPages())})}renderNativeHomeEnabledLayout(){const e={menuType:Z.og.Modal,title:a()(d.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrash.menu.header"}),left:this.renderMobileHelpButton(),right:a()(U.DoneMenuText,{}),onClickRight:this.handleClose,onCancel:this.handleClose,header:this.renderSearchInput()};return s.createElement(V.Z,n()({},e,{className:x.TYv}),this.renderPages())}renderHeaderWithTabs(){const{device:e}=this.environment,t=v.Z.state.currentTab,o=ee.tabs.indexOf(t);return a()(s.Fragment,{},void 0,a()(J.Z,{tabs:[a()(d.FormattedMessage,{defaultMessage:"All pages",id:"sidebarTrash.allPages.tabHeader"},"allPages"),a()(d.FormattedMessage,{defaultMessage:"In current page",id:"sidebarTrash.inCurrentPage.tabHeader"},"currentPage"),a()(d.FormattedMessage,{defaultMessage:"Last edited by me",id:"sidebarTrash.lastEditedByMe.tabHeader"},"lastEditedByMe")],selectedIndex:o,onChange:this.handleTabChange}),a()("div",{style:{margin:e.isMobile?0:"10px 0"}},void 0,this.renderSearchInput()))}renderSearchInput(){const{device:e}=this.environment;return a()(F.ZP,{left:a()(G.Z,{show:this.stores.requestStore.state.loading,showDelay:500,showHold:200,render:e=>e?a()(L.Z,{style:this.getSearchIconStyle()}):c.Z.searchThick(this.getSearchIconStyle())}),style:{...e.isAndroid&&{borderBottom:"none"}},showClearButton:!0,placeholder:B.default.formatMessage(Q.filterByPlaceholder),focus:!e.isMobile||void 0,value:v.Z.state.filter,onChange:this.handleSearchInputChange})}renderFooter(){return a()(K.Z,{topBorder:!0,disableDesktopPadding:!0},void 0,a()(q.Z,{title:a()(d.FormattedMessage,{defaultMessage:"Learn about deleting and restoring pages",id:"sidebarTrash.learnMore.prompt"}),href:(0,E.UY)("guides.trash"),analyticsFrom:"trash"}))}renderMobileHelpButton(){return a()($.Z,{href:(0,E.UY)("guides.trash"),analyticsFrom:"trash"})}renderPages(){if(!R.Z.state.online)return a()(K.Z,{},void 0,a()(O.Z,{title:a()(d.FormattedMessage,{defaultMessage:"Please go online to view the Trash.",id:"sidebarTrash.goOnline.prompt"})}));{const{filter:e,limit:t,currentTab:o}=v.Z.state,i=`${e}:${t}${o}`;return a()(W.Z,{requestStore:this.stores.requestStore,request:i,performRequest:this.performSearchRequest,render:this.renderTrashPages,debounce:M.vp})}}changeTab(e){v.Z.setState({...v.Z.state,currentTab:e,limit:v.Z.startLimit}),this.stores.requestStore.setState({...this.stores.requestStore.state,result:null}),p.trackToggleTrashTab(this.environment,{tab:e})}getSearchIconStyle(){return{width:14,height:14,flexGrow:0,flexShrink:0,color:this.theme.regularIconColor}}}ee.displayName="SidebarTrash",ee.tabs=["all_pages","in_current_page","last_edited_by_me"];const te=ee;class oe extends l.Z{constructor(){super(...arguments),this.renderOrigin=e=>{const{onClick:t,...o}=(0,g.Z)(e,{onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave});return a()(S.Z,{store:this.clonedStore,canDropOnto:!0,onSelectableDrop:this.handleDrop,analyticsName:"sidebar_trash",shouldShowDropZone:!0},void 0,s.createElement(y.Z,n()({},o,{style:this.props.buttonStyle,onClick:t||this.handleClick,mobileFeedback:this.props.isMobile}),a()(w.Z,{left:this.renderIcon(),style:{...f.Z.state.open&&{background:this.theme.buttonHoveredBackground}},disableMobileBorder:!0},void 0,a()(d.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrashButton.text"}))))},this.renderSidebarTrash=()=>{const{currentSpaceStore:e}=h.default.state;if(e)return a()(te,{spaceStore:e})},this.handleClick=e=>{v.Z.setState({...v.Z.state,currentTab:"all_pages"}),p.trackOpenTrash(this.environment)},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e;o||m.createAndCommit({userAction:"SidebarTrashButton.handleDrop",environment:this.environment,perform:e=>{u.Cl({environment:this.environment,blocks:t,transaction:e})}})}}willMount(e){super.willMount(e),this.clonedStore=e.store.clone()}renderComponent(){const{device:e,mobileNative:t}=this.environment,o=(null==t?void 0:t.supportsNativeHomeOnPhone())||!1;return a()(b.Z,{popupType:e.isMobile?b.Z.PopupType.SlideUp:b.Z.PopupType.Popup,hidesMobileNativeBottomBar:o,preventSlideUpTransition:o,buttonPopupStore:f.Z,alignmentToOrigin:b.Z.Alignment.Start,placementToOrigin:b.Z.Placement.Right,originGap:0,onClick:this.handleClick,isFullWidthOnMobile:!0,render:this.renderSidebarTrash,preventScaleTransition:!0,renderOrigin:this.renderOrigin})}renderIcon(){const{device:e}=this.environment,t=this.theme.mediumIconColor;return e.isMobile?c.Z.sidebarTrash({fill:t,height:16}):c.Z.sidebarTrash({fill:t,width:14})}}oe.displayName="SidebarTrashButton";const ie=oe},73499:(e,t,o)=>{o(97464),o(77094),o(67294),o(480),o(24405),o(3779),o(5366),o(5978),o(95477),o(25464),o(64921),o(58032),o(14694)},35021:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(43593),s=o(54642),l=o(95477),c=o(24042),d=o(39218),p=o(77137);class u extends r.Z{constructor(){super(...arguments),this.performRequest=async e=>a.E$(e.url,l.Z.secureFileS3.url)?(e.permissionRecord&&await d.transactionQueue.awaitRecordTransaction(e.permissionRecord),s.getSignedFileUrl(this.environment,e,Boolean(c.Z.state.isNotionProtocolBugFixed))):e.url}renderComponent(){return n()(p.Z,{request:{url:this.props.url,permissionRecord:this.props.permissionRecord,useS3Url:this.props.useS3Url},performRequest:this.performRequest,render:this.props.render})}}u.displayName="SignedUrl";const m=u},6854:(e,t,o)=>{o.d(t,{Pn:()=>b,ow:()=>S,wr:()=>w});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(480),c=o(24405),d=o(3779),p=o(5366),u=o(55332),m=o(5978),g=o(64964),h=(o(84076),o(89728)),f=o(73744),v=o(22889);const y=(0,p.defineMessages)({open:{defaultMessage:"Open",id:"automations.buttonTrigger.open",description:"Button to open page or database"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo",description:"Button to undo an action"}});function b(e){window.__c={n:"SnackbarButton"};const t=(0,c.Fg)();return s.createElement(h.Z,a()({},e,{style:{color:t.regularInvertedTextColor,fontWeight:500,height:void 0,marginLeft:0,...e.style}}))}function S(e){window.__c={n:"SnackbarUndoButton"};const{onUndo:t}=e,o=(0,l.O7)();return n()(b,{onClick:()=>{u.Yw(o,!0),g.rN(),null==t||t()}},void 0,n()(p.FormattedMessage,{defaultMessage:"Undo",id:"snackbar.undo.title",description:"text on undo button"}))}function w(e){window.__c={n:"SuccessSnackbarButtons"};const{blockStoreToOpen:t,performUndo:o}=e,i=(0,l.O7)(),r=(0,c.yK)((e=>({icon:{fill:e.regularInvertedTextColor},wrap:{display:"flex",columnGap:8}})),[]),a=(0,s.useMemo)((()=>t?e=>{m.navigateToBlock({environment:i,openInNew:(0,f.DJ)(e),store:t,visitType:v.vu.Link})}:void 0),[t,i]);return n()("div",{style:r.wrap},void 0,a&&n()(b,{onClick:a,icon:e=>d.Z.settingsConnectedApps({...e,...r.icon,width:16,height:16}),style:{paddingRight:0}},void 0,s.createElement(p.FormattedMessage,y.open)),o&&n()(b,{onClick:o,icon:e=>d.Z.undo({...e,...r.icon,marginTop:-2,width:16,height:16})},void 0,s.createElement(p.FormattedMessage,y.undo)))}},32617:(e,t,o)=>{o.d(t,{QH:()=>Q,lu:()=>ee,lp:()=>te,ZP:()=>ie});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(3779),u=o(5366),m=o(32056),g=o(3791),h=o(47425),f=o(97880),v=o(82990),y=o(50906),b=o(54642),S=o(99498),w=o(89859),k=o(17153),C=o(93678),_=o(62216),M=o(21115),T=o(5059),I=o(8323),P=o(79315),x=o(78291),B=o(1119),Z=o(42922),E=o(11066),R=o(61519),A=o(22346),D=o(63296),F=o(85248),L=o(58032),V=o(23189);const N=(0,u.defineMessages)({membersPerMonth:{id:"SpaceSubscriptionPlans.membersPerMonth.title",defaultMessage:"<bold>{monthlyPrice}</bold> / member / month",description:"Shown in the plans page in settings."},activeMembers:{id:"SpaceSubscriptionPlans.activeMembers.title",defaultMessage:"{activeMemberCount, plural, one {{activeMemberCount} active member} other {{activeMemberCount} active members}}",description:"Shown in the plans page in settings."},includes:{id:"SpaceSubscriptionPlans.includes.title",defaultMessage:"Includes",description:"Shown in the plans page in settings."},everythingInFree:{id:"SpaceSubscriptionPlans.everythingInFree.title",defaultMessage:"Everything in Free, and",description:"Shown in the plans page in settings."},everythingInPlus:{id:"SpaceSubscriptionPlans.everythingInPlus.title",defaultMessage:"Everything in Plus, and",description:"Shown in the plans page in settings."},everythingInBusiness:{id:"SpaceSubscriptionPlans.everythingInBusiness.title",defaultMessage:"Everything in Business, and",description:"Shown in the plans page in settings."},blocksUsed:{id:"SpaceSubscriptionPlans.blocksUsed.title",defaultMessage:"Team blocks",description:"Shown in the plans page in settings."},blocksUsedDescription:{id:"SpaceSubscriptionPlans.blocksUsed.description",defaultMessage:"Upgrade your plan to get unlimited blocks for teams.",description:"Shown in the plans page in settings."},aiCreditsUsed:{id:"SpaceSubscriptionPlans.aiCredits.title",defaultMessage:"Notion AI",description:"Shown in the plans page in settings."},aiCreditsDescription:{id:"SpaceSubscriptionPlans.aiCredits.description",defaultMessage:"AI responses are available to all members of your workspaces. Add AI to your plan to gain unlimited AI responses.",description:"Shown in the plans page in settings."},aiAddedToPlanDescription:{id:"SpaceSubscriptionPlans.aiAddedToPlan.description",defaultMessage:"Allows members in your workspace to use Notion AI",description:"Shown in the plans page in settings."},viewPlans:{id:"SpaceSubscriptionPlans.viewPlans.title",defaultMessage:"View all plans",description:"Shown in the plans page in settings."},manageUsage:{id:"SpaceSubscriptionPlans.manageUsage.title",defaultMessage:"Manage usage",description:"Shown in the plans page in settings."},usagePercent:{id:"SpaceSubscriptionPlans.usagePercent",defaultMessage:"<bold>({percent}%)</bold>",description:"Shown in the plans page in settings."},blockUsageFraction:{id:"SpaceSubscriptionPlans.blockUsageFraction",defaultMessage:"<bold>{used}/{total} team blocks used</bold> ",description:"Shown in the plans page in settings."},aiUsageFraction:{id:"SpaceSubscriptionPlans.aiUsageFraction",defaultMessage:"{isSalesAssisted, select, true {<bold>{used}+ / {total} AI responses used</bold>} other {<bold>{used}/{total} AI responses used</bold>}}",description:"Shown in the plans page in settings."},otherPlansToConsider:{id:"SpaceSubscriptionPlans.recommendedPlanForYou",defaultMessage:"Other plans to consider",description:"Shown in the plans page in settings."},seeAllPlans:{id:"SpaceSubscriptionPlans.seeAllPlans",defaultMessage:"See all plans",description:"Shown in the plans page in settings."},upgrade:{id:"SpaceSubscriptionPlans.upgrade.button.label",defaultMessage:"Upgrade",description:"Shown in the plans page in settings for users to upgrade their plan."},upgradeToPlus:{id:"SpaceSubscriptionPlans.upgradeToPlus.button.label",defaultMessage:"Upgrade to Plus",description:"Shown in the plans page in settings for users to upgrade to the Plus plan."},upgradeToPlusDescription:{id:"SpaceSubscriptionPlans.upgradeToPlus.description",defaultMessage:"Upgrade to plus to get unlimited team blocks, unlimited file uploads, 30 day page history, and more.",description:"Shown in the plans page in settings for users to upgrade to the Plus plan."},billingIntervalMessage:{id:"SpaceSubscriptionPlans.billingIntervalMessage",defaultMessage:"{billingInterval, select, year {billed annually} other {billed monthly}}",description:"Shown in the plans page in settings."}}),O=(0,u.defineMessages)({iosMessage:{id:"banner.education.switchPlanFromInAppPurchase",defaultMessage:"You're subscribed through an in-app Apple purchase. To switch plans, cancel your subscription with Apple.",description:"Shown in a banner to let customers on ios plan how to cancel their ios subscription."},educationMessage:{id:"banner.education.message",defaultMessage:"Your plan has a 1-member limit. You can switch your plan, but your discounted price will be lost.",description:"Shown in a banner to let customers know they're on an education plan."},singlePlayerMessage:{id:"banner.singlePlayer.message",defaultMessage:"Your plan has a 1-member limit. You can switch your plan, but your discounted price will be lost.",description:"Shown in a banner to let customers know they're on a legacy plan that supports a 1-member limit."}});function U(e){const{data:t,spaceSubscriptionPlansStore:o}=e,i=(0,c.VK)((()=>(0,I.zt)()),[]),n=(0,d.yK)((e=>({overviewCard:{display:"flex",flexDirection:"column",paddingRight:20,minWidth:200,flex:2},highlightsCard:{display:"flex",flexDirection:"column",paddingRight:20,minWidth:275,flex:4},usageCard:{display:"flex",flexDirection:"column",minWidth:200,maxWidth:500,flex:7},container:{display:"flex",flexWrap:"wrap",gap:20,paddingBottom:100,paddingRight:80}})),[]);return i?s.createElement(s.Fragment,null,a()("div",{style:n.container},void 0,a()("div",{style:n.overviewCard},void 0,a()(H,{subscriptionTier:i,data:t,section:"top_section"})),a()("div",{style:n.highlightsCard},void 0,a()(z,{data:t,isRecommendedSection:!1,subscriptionTier:i})),a()("div",{style:n.usageCard},void 0,a()(W,{data:t,subscriptionTier:i,spaceSubscriptionPlansStore:o}))),a()(R.Z,{size:0}),a()(Y,{data:t,store:o})):null}function H(e){const{subscriptionTier:t,data:o,section:i}=e,n=(0,u.useIntl)(),r=(0,d.Fg)(),p=(0,l.O7)(),g=(0,d.yK)((e=>({image:{width:64,height:60,borderRadius:3},headerStyle:{fontSize:22,fontWeight:v.Z.fontWeight.semibold,marginTop:8,marginBottom:4},planTitle:{display:"flex",justifyContent:"space-between"},membersMessage:{fontSize:14,marginTop:4},memberCount:{fontSize:14},upgradeButton:{width:150,marginTop:10}})),[]),h=(0,M.XX)(o),f="top_section"===i,b=(0,c.VK)((()=>(0,M.qX)()),[]),S="year"===(null==h?void 0:h.interval)?"year":"month",w=function(e){const{subscriptionTier:t,isTopSection:o,stripeData:i,billingInterval:n,intl:r}=e;return o?(0,m.Dx)({amount:i?i.monthlyPlanAmount:0,currency:"dollar",intl:r}):(0,M._B)({subscriptionTier:t,intl:r})[n]}({subscriptionTier:t,isTopSection:f,billingInterval:S,stripeData:h,intl:n}),P=J(t),x=(0,s.useMemo)((()=>{const e=T.LU[P].imageByMode;return e[null==r?void 0:r.mode]??e.light}),[r.mode,P]);return s.createElement(s.Fragment,null,a()("img",{src:x,style:g.image}),a()(V.Z,{large:!0,style:g.headerStyle},void 0,f?a()(X,{}):null,a()("div",{style:g.planTitle},void 0,n.formatMessage(T.LU[P].planTitle))),a()("div",{style:g.membersMessage},void 0,n.formatMessage(N.membersPerMonth,{monthlyPrice:w,bold:e=>a()("b",{},void 0,e)})),f?a()("div",{style:g.memberCount},void 0,n.formatMessage(N.activeMembers,{activeMemberCount:b})):null,f?null:s.createElement(s.Fragment,null,a()("div",{style:g.memberCount},void 0,n.formatMessage(N.billingIntervalMessage,{billingInterval:S})),a()(Z.Z,{style:g.upgradeButton,isLarge:!0,onClick:async()=>{await async function(e,t){if(y.trackPlanCtaClick(e,{location:"plans_page",cta_item:t,page_section:"plans_bottom_section",button_text:N.upgrade.defaultMessage}),(0,I.mq)()&&(0,_.yw)())return void k.a("default");return await C.y(e,{from:"plans_page",for:t})}(p,t)}},void 0,n.formatMessage(N.upgrade))))}function z(e){const{data:t,isRecommendedSection:o,subscriptionTier:i,tierToUpsellTo:n}=e,r=(0,u.useIntl)(),m=(0,l.O7)(),g=(0,d.yK)((e=>{const t="dark"===e.mode;return{icon:{display:"inline",height:20,fill:t?e.mediumTextColor:e.accentColors.gray[500],width:void 0,padding:"2px 4px"},text:{color:t?e.mediumTextColor:e.accentColors.gray[500],fontSize:14,fontWeight:v.Z.fontWeight.regular},headerStyle:{fontSize:16,fontWeight:v.Z.fontWeight.medium},title:{display:"flex",justifyContent:"space-between"},highlights:{display:"flex",alignItems:"left",marginBottom:4},upgradeButton:{marginRight:8,width:150}}}),[]),{showBlockUsage:b,blockUsage:S,blockUsagePercent:w}=(0,c.VK)((()=>oe(m,t,i)),[m,t,i]),k=(0,c.VK)((()=>(0,_.$r)()),[]),M=J(o&&n?n:i),I=o&&n?function(e){switch(e){case"team":case"plus":return N.everythingInFree;case"business":return N.everythingInPlus;case"enterprise":return N.everythingInBusiness;default:(0,f.t1)(e)}}(n):N.includes;return b&&k?s.createElement(s.Fragment,null,a()(j,{blockUsage:S,blockUsagePercent:w,showUpgradeToPlusMessage:!0}),a()(Z.Z,{style:g.upgradeButton,isLarge:!0,onClick:async()=>{y.trackPlanCtaClick(m,{location:"plans_page",cta_item:h.$M,page_section:"plans_top_section",button_text:N.upgradeToPlus.defaultMessage}),await C.y(m,{from:"plans_page",for:h.$M})}},void 0,r.formatMessage(N.upgradeToPlus))):s.createElement(s.Fragment,null,a()(V.Z,{large:!0,style:g.headerStyle},void 0,a()("div",{style:g.title},void 0,r.formatMessage(I))),T.LU[M].highlights.map(((e,t)=>a()("div",{style:g.highlights},`highlight-${t}`,p.Z.thinCheck(g.icon),a()("span",{style:g.text},void 0,r.formatMessage(e))))))}function W(e){const t=(0,u.useIntl)(),o=$(),i=(0,l.O7)(),{data:r,subscriptionTier:d,spaceSubscriptionPlansStore:m}=e,h=te(),f=(0,c.VK)((()=>{var e;return(0,g.de)(null===(e=x.default.state.data)||void 0===e?void 0:e.addOns)}),[]),v=(0,M.GJ)(r),b=(0,c.VK)((()=>{var e;return(0,g.ls)(null===(e=x.default.state.data)||void 0===e?void 0:e.addOns)}),[]),{showBlockUsage:k,blockUsage:T,blockUsagePercent:I}=(0,c.VK)((()=>oe(i,r,d)),[i,r,d]),P=(0,c.VK)((()=>(0,_.$r)()),[]),B=void 0!==(null==h?void 0:h.spaceUsage),E=!1===(null==h?void 0:h.isEligible)&&h.isSalesAssisted,R=B?+(h.spaceUsage/h.spaceLimit*100).toFixed(0):0,A=a()(u.FormattedMessage,f?b?{id:"SpaceSubscriptionPlans.resubscribe.label",defaultMessage:"Resubscribe",description:"Shown to cancel an add on from plans page."}:{id:"SpaceSubscriptionPlans.removeFromPlan.label",defaultMessage:"Remove from plan",description:"Shown to cancel an add on from plans page."}:P?{id:"SpaceSubscriptionPlans.purchaseAI.label",defaultMessage:"Purchase AI",description:"Shown as an upsell from plans page so user upgrades their plan."}:{id:"SpaceSubscriptionPlans.addToPlan.label",defaultMessage:"Add to plan",description:"Shown as an upsell from plans page so user upgrades their plan."});return s.createElement(s.Fragment,null,k&&!P?a()(j,{blockUsage:T,blockUsagePercent:I,showUpgradeToPlusMessage:!1}):null,B&&s.createElement(s.Fragment,null,a()(K,{message:N.aiCreditsUsed,type:"ai"}),!f&&s.createElement(s.Fragment,null,a()("div",{style:o.usage},void 0,t.formatMessage(N.aiUsageFraction,{used:h.spaceUsage,total:h.spaceLimit,bold:e=>a()("b",{},void 0,e),isSalesAssisted:E}),a()("div",{style:o.percentageText},void 0,E?null:t.formatMessage(N.usagePercent,{percent:R,bold:e=>a()("b",{},void 0,e)}))),a()(F.k,{style:o.progressBar,percentage:R,height:8,filledColor:o.filled.color,unfilledColor:o.unfilled.color}),a()("div",{style:o.text},void 0,t.formatMessage(N.aiCreditsDescription))),f&&s.createElement(s.Fragment,null,a()("div",{style:o.usage},void 0,p.Z.circleCheckFilled({width:16,margin:"0 4px 0 8px"}),a()(u.FormattedMessage,{id:"SpaceSubscriptionPlans.addedToPlan.label",defaultMessage:"Added to plan",description:"Shown in plans page in settings to show user has an add-on subscription."})),a()("div",{style:o.text},void 0,t.formatMessage(N.aiAddedToPlanDescription))),a()("div",{style:{...o.card,display:"initial",width:150}},void 0,v&&f&&a()(D.Z,{style:{marginRight:8,width:"100%"},isLarge:!0,onClick:async()=>{if(y.trackPlanCtaClick(i,{location:"plans_page",cta_item:"ai",page_section:"plans_top_section",button_text:A.props.defaultMessage}),b){const e=M.XX(r),t=null!=e&&e.customerId?await w.y(i,{offerType:"add_on_upgrade_flow",customerId:e.customerId}):void 0;return S.k2(),void S.Cl(t)}await new Promise((e=>{m.setState({...m.state,churnType:"ai",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})}))}},void 0,A),v&&!f&&a()(Z.Z,{style:{marginRight:8,minWidth:150},isLarge:!0,onClick:async()=>{y.trackPlanCtaClick(i,{location:"plans_page",cta_item:"ai",page_section:"plans_top_section",button_text:A.props.defaultMessage}),await C.y(i,{from:"plans_page",for:d,addOnFeature:"ai"})}},void 0,A),!v&&function(e){window.__c={n:"renderDisabledButtonWithTooltip"};const{tooltip:t,label:o,buttonClassName:i,wrapTooltip:r}=e;return a()(L.Z,{style:{width:r?320:"auto"},textWrap:r,renderTooltip:()=>t,render:e=>s.createElement(D.Z,n()({style:{width:"100%",opacity:.5},isLarge:!0,disabled:!0},e,{className:i}),o)})}({tooltip:a()(u.FormattedMessage,{id:"spaceSubscriptionPlans.aiAddOn.switchPlanAsMember.tooltip",defaultMessage:"Only workspace owners can perform this action.",description:"Shown when a non admin tries to change the plan or add on they're subscribed to."}),label:A,buttonClassName:"space-subscription-ai-usage-button",wrapTooltip:!0}))))}function j(e){const{blockUsage:t,blockUsagePercent:o,showUpgradeToPlusMessage:i}=e,n=(0,u.useIntl)(),r=$();return s.createElement(s.Fragment,null,a()(K,{message:N.blocksUsed,type:"blocks"}),a()("div",{style:r.usage},void 0,n.formatMessage(N.blockUsageFraction,{used:t,total:(0,h.v5)(),bold:e=>a()("b",{},void 0,e)}),a()("div",{style:r.percentageText},void 0,n.formatMessage(N.usagePercent,{percent:o,bold:e=>a()("b",{},void 0,e)}))),a()(F.k,{style:r.progressBar,percentage:o,height:8,filledColor:r.filled.color,unfilledColor:r.unfilled.color}),a()("div",{style:r.text},void 0,n.formatMessage(i?N.upgradeToPlusDescription:N.blocksUsedDescription)),a()("div",{style:{marginTop:10}}))}function K(e){window.__c={n:"PlanHeader"};const t=(0,u.useIntl)();return a()(V.Z,{large:!0,style:{fontSize:16,fontWeight:v.Z.fontWeight.semibold}},void 0,a()("div",{style:{display:"flex"}},void 0,"ai"===e.type&&p.Z.sparkles({height:18,width:18}),t.formatMessage(e.message)))}function Y(e){window.__c={n:"RecommendedPlanDetails"};const t=(0,u.useIntl)(),o=(0,d.yK)((e=>({text:{display:"flex",color:"dark"===e.mode?e.accentColors.gray[900]:e.accentColors.gray[400],fontSize:14,fontWeight:v.Z.fontWeight.regular,marginBottom:20,padding:4},card:{display:"flex",flexDirection:"column",width:195},largeCard:{display:"flex",flexDirection:"row",paddingTop:20},plansToConsiderSection:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:30},otherPlansToConsiderTitle:{display:"flex",justifyContent:"space-between",height:18,paddingRight:10}})),[]),i=(0,c.VK)((()=>(0,I.zt)()),[]),n=(0,c.VK)((()=>(0,_.$r)()),[]);if(!i||!n)return null;const r=function(e){switch(e){case"free":case"personal":case"student":case"personal_free":case"team_free":return[h.$M,"business","enterprise"];case h.$M:case"plus":return["business","enterprise"];case"business":return["enterprise"];case"enterprise":return[];default:(0,f.t1)(e)}}(i);return a()("div",{},void 0,a()("div",{style:o.largeCard},void 0,r.length>0?a()(V.Z,{large:!0,style:{fontSize:18,fontWeight:v.Z.fontWeight.semibold}},void 0,a()("div",{style:o.otherPlansToConsiderTitle},void 0,t.formatMessage(N.otherPlansToConsider))):null,a()(E.Z,{style:o.text,onClick:()=>{var t;(t=e.store).setState({...t.state,page:"grid"})}},void 0,t.formatMessage(N.seeAllPlans),p.Z.arrowRight({width:12,marginLeft:6}))),a()("div",{style:o.plansToConsiderSection},void 0,r.map((t=>a()("div",{style:o.largeCard},t,a()("div",{style:o.card},void 0,a()(H,{subscriptionTier:t,data:e.data,section:"bottom_section"})),a()("div",{style:o.card},void 0,a()(z,{data:e.data,isRecommendedSection:!0,subscriptionTier:t,tierToUpsellTo:t})))))))}function G(e){window.__c={n:"RenderChurnSurveyModal"};const t=(0,c.VK)((()=>(0,I.zt)()),[]),o=(0,c.VK)((()=>e.store.state),[e.store]),i=M.XX(e.data);return null!=o&&o.churnSurveyModalOpen&&t&&i?a()(B.Z,{churnType:o.churnType,currentPlan:t,isWorkspaceDeletion:!1,periodEnd:i.periodEnd,customerId:i.customerId,onAccept:()=>{var t;(t=e.store).state.churnSurveyModalOpen&&t.state.onAccept()},onClose:()=>q(e.store)}):null}function X(){window.__c={n:"DiscountBadge"};const e=(0,d.yK)((e=>({sharedStyleForDiscountBadge:{display:"inline-flex",alignItems:"center",borderRadius:3},innerStyleForDiscountBadge:{padding:"2px 6px",borderRadius:3,color:e.regularTextColor,background:e.accentColors.gray[50],fontWeight:400,fontSize:14,lineHeight:"16px",letterSpacing:"0.04em",whiteSpace:"nowrap"}})),[]);return a()(E.Z,{style:{...e.sharedStyleForDiscountBadge},disabled:!0},void 0,a()("div",{style:{...e.innerStyleForDiscountBadge}},void 0,a()(u.FormattedMessage,{id:"SpaceSubscriptionPlansAndAddOns.currentPlan.label",defaultMessage:"Current plan",description:"Shown in the plans page to let users know this is their current plan."})))}function q(e){e.state.churnSurveyModalOpen&&e.state.onClose(),e.reset()}function $(){return(0,d.yK)((e=>{const t="dark"===e.mode;return{card:{display:"flex",flexDirection:"column",paddingTop:10},text:{paddingTop:10,color:t?e.accentColors.gray[500]:e.accentColors.gray[200],fontSize:12,fontWeight:v.Z.fontWeight.regular},usage:{fontSize:14,display:"flex"},percentageText:{color:e.accentColors.gray[500],paddingLeft:4},progressBar:{paddingTop:8},filled:{color:e.accentColors.gray[900]},unfilled:{color:t?e.accentColors.gray[200]:e.accentColors.gray[50]},image:{width:197,height:122,marginTop:24}}}),[])}function J(e){return(0,h.QM)(e)?"free":(0,h.iJ)(e)?"education":(0,h.Aw)(e)?"singlePlayerPlus":(0,h.eR)(e)?"plus":(0,h.NG)(e)?"business":(0,M.gG)(e)?"enterprise":"legacy"}function Q(e,t){return e?O.iosMessage:(0,h.iJ)(t)?O.educationMessage:(0,h.Aw)(t)?O.singlePlayerMessage:void 0}function ee(e,t){return!!e||!!(0,h.Aw)(t)}function te(){const e=(0,l.O7)(),t=(0,c.VK)((()=>{var e;return null===(e=P.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),[o,i]=(0,s.useState)();return(0,s.useEffect)((()=>{!async function(){if(!t)return;const o=await b.getAIUsageEligibility(e,{spaceId:t,checkIfSalesAssistedCustomer:!0});"failed"!==o.type&&i(o.data)}()}),[e,t]),o}function oe(e,t,o){return(0,M.qX)()>1&&(0,h.QM)(o)?{showBlockUsage:!0,blockUsage:(0,M.Lz)(e,t),blockUsagePercent:+(100*(0,M.zl)(e,t)).toFixed(0)}:{showBlockUsage:!1,blockUsage:0,blockUsagePercent:0}}const ie=function(e){const{churnSurveyModalOpen:t,page:o}=(0,c.VK)((()=>{return{churnSurveyModalOpen:(t=e.spaceSubscriptionPlansStore,t.state.churnSurveyModalOpen),page:e.spaceSubscriptionPlansStore.state.page};var t}),[e.spaceSubscriptionPlansStore]);return"grid"===o?null:s.createElement(s.Fragment,null,a()(U,{data:e.data,spaceSubscriptionPlansStore:e.spaceSubscriptionPlansStore}),a()(A.Z,{innerStyle:{width:300,height:"auto",overflow:"scroll"},open:t,render:()=>a()(G,{data:e.data,store:e.spaceSubscriptionPlansStore}),onDismiss:()=>q(e.spaceSubscriptionPlansStore)}))}},93963:(e,t,o)=>{o.d(t,{z:()=>a});var i=o(77094),n=o.n(i),r=(o(67294),o(24405));function a(e){let{color:t,size:o,style:i}=e;window.__c={n:"StatusDot"};const a=(0,r.yK)((e=>({dot:{height:o||8,width:o||8,background:t||e.blueColor,flexShrink:0,borderRadius:"100%",pointerEvents:"none",...i}})),[o,t,i]);return n()("div",{style:a.dot})}},42982:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(5366),s=o(16354),l=o(63296),c=o(64369),d=o(23189);class p extends r.Z{renderComponent(){return n()("div",{},void 0,this.renderHeader(),n()("div",{style:this.getSettingsOptionStyle()},void 0,n()(c.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},void 0,this.renderMessage()),this.renderManageSubscriptionButton()))}renderHeader(){const{device:e}=this.environment;return n()(d.Z,{large:!e.isMobile||void 0,divider:e.isMobile?void 0:"full"},void 0,n()(a.FormattedMessage,{id:"subscriptionSettings.title",defaultMessage:"Subscription"}))}renderMessage(){const{device:e}=this.environment;return e.isMobile?n()(a.FormattedMessage,{id:"subscriptionSettings.mobileDescription",defaultMessage:"Manage your Personal Pro subscription though the App Store.",description:"Description for a button that will take users to Apple's App Store app to edit their subscription."}):n()(a.FormattedMessage,{id:"subscriptionSettings.description",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. You can manage your subscription in Apple's subscription settings.",description:"Description for a button that will take users to Apple's App Store app to edit their subscription."})}renderManageSubscriptionButton(){return n()(s.Z,{href:"https://apps.apple.com/account/subscriptions"},void 0,n()(l.Z,{isLarge:!0,style:{marginTop:12,marginBottom:4}},void 0,n()(a.FormattedMessage,{id:"subscriptionSettings.button",defaultMessage:"Manage subscription"})))}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}p.displayName="SubscriptionSettings";const u=p},26647:(e,t,o)=>{o.d(t,{n:()=>s,Z:()=>l});var i=o(77094),n=o.n(i),r=o(67294),a=o(65742);let s;!function(e){e[e.up=0]="up",e[e.left=1]="left",e[e.down=2]="down",e[e.right=3]="right"}(s||(s={}));function l(e){const{startPoint:t,endPoint:o,style:i,direction:l,showArrowHead:p,handleMouseMove:u,handleMouseLeave:m}=e,g=void 0===e.curveOffset?a.i2:e.curveOffset;let h={x:0,y:0},f={x:0,y:0};switch(l){case s.down:h={x:t.x,y:t.y+g},f={x:o.x,y:o.y-g};break;case s.right:h={x:t.x+g,y:t.y},f={x:o.x-g,y:o.y};break;case s.up:case s.left:}return r.createElement(r.Fragment,null,n()(d,{startPoint:t,startCurvePoint:h,endPoint:o,endCurvePoint:f,style:i,handleMouseMove:u,handleMouseLeave:m},void 0,e.children),p&&n()(c,{endPoint:o,direction:l,style:i}))}function c(e){const{endPoint:t,direction:o,style:i}=e;switch(o){case s.down:return n()("polyline",{points:`${t.x-6},${t.y-5} ${t.x},${t.y} ${t.x+6},${t.y-5}`,style:i,fill:"transparent"});case s.right:return n()("polyline",{points:`${t.x-5},${t.y-6} ${t.x},${t.y} ${t.x-5},${t.y+6}`,style:i,fill:"transparent"});case s.up:case s.left:return null}}function d(e){const{startPoint:t,startCurvePoint:o,endPoint:i,endCurvePoint:a,style:s,handleMouseMove:l,handleMouseLeave:c}=e,d=function(e,t){function o(e,t,o){const n=t.x-e.x,r=t.y-e.y,a=Math.sqrt(n*n+r*r);return i(e,t,Math.min(1,o/a))}function i(e,t,o){return{x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}}function n(e,t){e.length>2&&(e[e.length-2]=t.x.toString(),e[e.length-1]=t.y.toString())}function r(e){return{x:parseFloat(e[e.length-2]),y:parseFloat(e[e.length-1])}}const a=e.split(/[,\s]/).reduce(((e,t)=>{const o=t.match("([a-zA-Z])(.+)");return o?(e.push(o[1]),e.push(o[2])):e.push(t),e}),[]).reduce((function(e,t){return!isNaN(parseFloat(t))&&e.length?e[e.length-1].push(t):e.push([t]),e}),[]);let s=[];if(a.length>1){const e=r(a[0]);let l=null;"Z"===a[a.length-1][0]&&a[0].length>2&&(l=["L",e.x.toString(),e.y.toString()],a[a.length-1]=l),s.push(a[0]);for(let c=1;c<a.length;c++){const e=s[s.length-1],d=a[c],p=d===l?a[1]:a[c+1];if(p&&e&&e.length>2&&"L"===d[0]&&p.length>2&&"L"===p[0]){const a=r(e),l=r(d),c=r(p),u=o(l,a,t),m=o(l,c,t);n(d,u),s.push(d);const g=i(u,l,.5),h=i(l,m,.5),f=["C",g.x.toString(),g.y.toString(),h.x.toString(),h.y.toString(),m.x.toString(),m.y.toString()];s.push(f)}else s.push(d)}if(l){const e=r(s[s.length-1]);s.push(["Z"]),n(s[0],e)}}else s=a;return s.reduce((function(e,t){return`${e}${t.join(" ")} `}),"")}(`M ${t.x} ${t.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${i.x} ${i.y}`,16);return r.createElement(r.Fragment,null,n()("path",{d,style:s,fill:"transparent"}),(l||c)&&n()("g",{onMouseMove:l,onMouseLeave:c},void 0,n()("path",{d,style:{strokeOpacity:0,strokeWidth:16,pointerEvents:"stroke",cursor:"default"},fill:"transparent"}),e.children))}},44862:(e,t,o)=>{o.d(t,{Z:()=>f});var i=o(77094),n=o.n(i),r=o(67294),a=o(83355),s=o(8848),l=o(3779),c=o(5366),d=o(5149),p=o(41232),u=o(32363),m=o(16402),g=o(84076);class h extends a.Z{constructor(){super(...arguments),this.handleNavigateToSourceClick=()=>{const{collectionContextStore:e}=this.props;e&&(d.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),d.H4({collectionSettingsStore:e.settingsStore,item:{type:"source"}}))}}renderComponent(){const{collectionStore:e}=this.props;if(e.isSyncedCollection())return this.renderSyncedCollectionIndicators()}renderSyncedCollectionIndicators(){const{collectionStore:e}=this.props,t=e.getFormatStore().getKeyStore("original_url").getValue(),o=e.getSpaceId(),i=Boolean(e.getFormatStore().getKeyStore("sync_state").getValue()),a=t&&(0,p.pI)(t,o);return r.createElement(r.Fragment,null,a&&n()(g.Z,{href:a,style:{display:"inline-flex"},hoveredStyle:{background:"none",textDecoration:"underline"},innerStyle:{flexShrink:1,width:"none",padding:"2px 0px",marginRight:5,borderRadius:3,display:"flex",alignItems:"center",alignSelf:"center",...this.getStyle()},external:!0},void 0,(0,u.wY)(t,o)),i?n()("span",{style:{color:this.theme.mediumTextColor}},void 0,"•"):null,i?this.renderSyncState():null)}renderSyncState(){var e,t;const{collectionStore:o}=this.props,i=o.getFormatStore().getKeyStore("sync_state").getKeyStore("syncing").getValue(),r=o.getFormatStore().getKeyStore("sync_state").getKeyStore("last_synced_at").getValue(),a=null===(e=this.props.collectionContextStore)||void 0===e?void 0:e.numberChildrenUnfurled.state,d=null===(t=this.props.collectionContextStore)||void 0===t?void 0:t.numberChildrenReceived.state,p=a&&d&&a/d<1&&!this.environment.device.isMobile,u=i&&this.environment.device.isMobile;let h;return r&&(h=n()(c.FormattedMessage,{defaultMessage:"Synced {lastSyncedAt}",description:"Indicates data finished updating at a certain time. Examples: Synced Just now, Synced 2 hours ago",id:"synced.lastSyncedAt.label",values:{lastSyncedAt:(0,m.IS)(r,{useLowercase:!0})}})),"row_limit_exceeded"===i?n()(g.Z,{style:{display:"inline-flex",...this.getStyle()},onClick:this.handleNavigateToSourceClick},void 0,n()("span",{style:{marginLeft:5,marginRight:5,display:"inline-flex",...this.getStyle()}},void 0,l.Z.warning({fill:(0,s.fi)("orange",this.theme).fill,marginLeft:4,marginRight:4,width:12,alignSelf:"center"}),n()(c.FormattedMessage,{defaultMessage:"Partial Sync",description:"Indicates data is only partially synced.",id:"synced.partial_sync.label"}))):p||u?n()("span",{style:{marginLeft:5,marginRight:5,display:"inline-flex",...this.getStyle()}},void 0,n()(c.FormattedMessage,{defaultMessage:"Syncing",description:"Indicates data is currently still being updated.",id:"synced.syncing.label"}),l.Z.sync({marginLeft:4,marginRight:4,width:12,alignSelf:"center"},"sync-spinner")):n()("span",{style:{marginLeft:5,marginRight:5,display:"inline-flex",...this.getStyle()}},void 0,h)}getStyle(){return{color:this.theme.mediumTextColor,fontSize:14,lineHeight:1.2}}}h.displayName="SyncedCollectionIndicators";const f=(0,c.injectIntl)(h)},66957:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(24405),c=o(60709),d=o(89728);function p(e){let{tabs:t,selectedIndex:o,onChange:i,separatorIndexes:p,right:u,style:m,rightStyle:g,tabStyle:h,tabTitleStyle:f,readOnly:v}=e;window.__c={n:"TabBarMenuItem"};const y=(0,r.useContext)(c.Xp),{device:b,WindowSizeStore:S}=(0,a.O7)(),{safePaddingLeft:w,safePaddingRight:k}=(0,s.VK)((()=>({safePaddingLeft:S.getSafePaddingLeftCSS(16),safePaddingRight:S.getSafePaddingRightCSS(16)})),[S]),C=(0,l.yK)((e=>{const t={paddingTop:6,paddingBottom:6,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.mediumTextColor,...h},o=`inset 0 -1px 0 ${e.regularDividerColor}`,i=y.menuType===c.og.Popup,n={fontSize:16,paddingTop:2,paddingLeft:i?16:w,paddingRight:i?16:k,zIndex:2,height:44,background:e.popoverBackground};return{container:{overflowY:"visible",overflowX:"auto",display:"flex",width:"100%",position:"relative",boxShadow:o,...b.isMobile?n:{fontSize:14,paddingLeft:8,paddingRight:8,zIndex:1},...m},separator:{display:"inline-flex",alignItems:"center",margin:"0 4px",paddingBottom:4,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.regularDividerColor},mobile:{},tab:t,selectedTab:{...t,position:"relative",color:e.regularTextColor},border:{borderBottom:`2px solid ${e.regularTextColor}`,position:"absolute",bottom:0,left:8,right:8},rightContainer:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end",color:e.mediumTextColor,...g}}}),[y.menuType,b.isMobile,g,w,k,m,h]);return n()("div",{className:"hide-scrollbar",style:C.container},void 0,t.map(((e,t)=>{const a=t===o;return r.createElement(r.Fragment,null,n()("div",{style:a?C.selectedTab:C.tab},`tabButton-${t}`,n()(d.Z,{style:f,onClick:()=>i(t),disabled:v,mobileFeedback:b.isMobile},void 0,e),a&&n()("div",{style:C.border})),p&&p.includes(t)&&n()("div",{style:C.separator,className:"notranslate"},`${t}-separator`,"|"))})),u&&n()("div",{style:C.rightContainer},void 0,u))}const u=r.memo(p)},40235:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(82990),s=o(64369);class l extends r.Z{renderComponent(){const{columns:e,rows:t,cellStyle:o,tableStyle:i,hideHeader:r}=this.props;return n()("table",{style:{...this.getStyle(),...i}},void 0,!r&&n()("thead",{},void 0,n()("tr",{style:l.headerRowStyle},void 0,e.map((e=>n()("th",{style:{...l.tableHeaderStyle,...e.style}},e.key,n()(s.Z,{isSmall:!0},void 0,e.header)))))),n()("tbody",{},void 0,t.map((t=>n()("tr",{style:this.getRowStyle()},t.key,t.columns.map(((t,i)=>{const r=e[i];return n()("td",{style:{...l.cellStyle,...o}},r.key,t)})))))))}getStyle(){return{width:"100%",fontSize:13,borderTop:`1px solid ${this.theme.regularDividerColor}`,borderBottom:`1px solid ${this.theme.regularDividerColor}`}}getRowStyle(){return{width:"100%",borderTop:`1px solid ${this.theme.regularDividerColor}`}}}l.displayName="TableBox",l.cellPaddingTopBottom=8,l.headerRowStyle={height:32,width:"100%"},l.tableHeaderStyle={fontWeight:a.Z.fontWeight.regular,textAlign:"left",paddingTop:l.cellPaddingTopBottom,paddingBottom:l.cellPaddingTopBottom},l.cellStyle={paddingTop:l.cellPaddingTopBottom,paddingBottom:l.cellPaddingTopBottom};const c=l},40698:(e,t,o)=>{o.d(t,{XI:()=>I,ss:()=>x,Im:()=>E,b6:()=>R,r:()=>A});var i=o(3779),n=o(5366),r=o(21202),a=o(11002),s=o(10482),l=o(88428),c=o(5978),d=o(59389),p=o(30149),u=o(99417),m=o(33929),g=o(98165),h=o(67669),f=o(89014),v=o(79315),y=o(10161),b=o(47593),S=o(96026),w=o(37394);const k=(0,n.defineMessages)({emptyWithIcon:{defaultMessage:"Empty page with icon",id:"templatePickerHelpers.basicTemplateItems.emptyWithIcon",description:"When creating a new page, this button creates an empty page with a random icon for you"},empty:{defaultMessage:"Empty page",id:"templatePickerHelpers.basicTemplateItems.empty",description:"When creating a new page, this button creates a completely empty page for you"},templates:{defaultMessage:"Templates",id:"templatePickerHelpers.basicTemplateItems.templates",description:"When creating a new page, this button opens up the template picker."},import:{defaultMessage:"Import",id:"templatePickerHelpers.basicTemplateItems.import",description:"When creating a new page, this button opens up a dialog for importing content from text/CSV/HTML/Word documents or external services like Evernote."}}),C=[{name:m.default.formatMessage(k.emptyWithIcon),iconFn:i.Z.page,type:"page_with_icon",shouldShow:()=>!0,onClick:(e,t)=>{p.createAndCommit({userAction:"templatePickerHelpers.emptyTemplateItems",environment:e,perform:o=>{d.T_({environment:e,store:t,transaction:o})}})}},{name:m.default.formatMessage(k.empty),iconFn:i.Z.pageEmpty,type:"empty_page",shouldShow:()=>!0,onClick:(e,t)=>{p.createAndCommit({userAction:"templatePickerHelpers.emptyTemplateItems",environment:e,perform:o=>{d.eV({environment:e,store:t,transaction:o})}})}}],_={name:m.default.formatMessage(k.templates),type:"templates",iconFn:e=>i.Z.templatesColor(e),shouldShow:()=>!0,onClick:()=>{w.Z.open({cloneTo:"current_page",analyticsFrom:"newPage"})}},M={name:m.default.formatMessage(k.templates),type:"templates",iconFn:e=>i.Z.templates(e),shouldShow:()=>!0,onClick:()=>{w.Z.open({cloneTo:"current_page",analyticsFrom:"newPage"})}},T={name:m.default.formatMessage(k.import),type:"import",iconFn:i.Z.import,shouldShow:()=>!0,onClick:(e,t)=>{b.Z.setState({open:!0,pageStore:t})}},I=(e,t)=>{const o=(0,g.n3)(t)&&S.Z.getMode(e,t);return(0,h.YF)(o)?[...C]:[...C,o&&(0,u.GD)(e,o)?M:_,T]},P=(0,n.defineMessages)({pageWithIcon:{defaultMessage:"Page with icon",id:"templatePickerHelpers.mobileBasicTemplateItems.pageWithIcon"},emptyPage:{defaultMessage:"Empty page",id:"templatePickerHelpers.mobileBasicTemplateItems.emptyPage"}}),x=[{name:m.default.formatMessage(P.pageWithIcon),type:"page_with_icon",shouldShow:()=>!0,onClick:(e,t)=>{p.createAndCommit({userAction:"templatePickerHelpers.mobileBasicTemplateItems",environment:e,perform:o=>{d.T_({environment:e,store:t,transaction:o})}})}},{name:m.default.formatMessage(P.emptyPage),type:"empty_page",shouldShow:()=>!0,onClick:(e,t)=>{p.createAndCommit({userAction:"templatePickerHelpers.mobileBasicTemplateItems",environment:e,perform:o=>{d.eV({environment:e,store:t,transaction:o})}})}}],B=(0,n.defineMessages)({table:{defaultMessage:"Table",id:"templatePickerHelpers.databaseTemplateNames.table"},board:{defaultMessage:"Board",id:"templatePickerHelpers.databaseTemplateNames.board"},list:{defaultMessage:"List",id:"templatePickerHelpers.databaseTemplateNames.list"},calendar:{defaultMessage:"Calendar",id:"templatePickerHelpers.databaseTemplateNames.calendar"},gallery:{defaultMessage:"Gallery",id:"templatePickerHelpers.databaseTemplateNames.gallery"},timeline:{defaultMessage:"Timeline",id:"templatePickerHelpers.databaseTemplateNames.timeline"},tableView:{defaultMessage:"Table view",id:"templatePickerHelpers.databaseTemplateNames.tableView"},boardView:{defaultMessage:"Board view",id:"templatePickerHelpers.databaseTemplateNames.boardView"},listView:{defaultMessage:"List view",id:"templatePickerHelpers.databaseTemplateNames.listView"},calendarView:{defaultMessage:"Calendar view",id:"templatePickerHelpers.databaseTemplateNames.calendarView"},galleryView:{defaultMessage:"Gallery view",id:"templatePickerHelpers.databaseTemplateNames.galleryView"},timelineView:{defaultMessage:"Timeline view",id:"templatePickerHelpers.databaseTemplateNames.timelineView"}});function Z(e){const{environment:t,store:o,viewType:i}=e;p.createAndCommit({userAction:"templatePickerHelpers.handleClickForViewType",environment:t,perform:e=>{d.Ud({environment:t,store:o,viewType:i,transaction:e}),c.navigateToBlock({environment:t,store:o});const n=o.getCollectionViewStores()[0];n&&(0,f.u)(n.id,{viewType:i})}})}const E=[{name:m.default.formatMessage(B.table),type:"table",iconFn:i.Z.collectionTable,isLargeDatabaseIcon:!0,shouldShow:()=>!0,onClick:(e,t)=>Z({environment:e,store:t,viewType:"table"})},{name:m.default.formatMessage(B.board),type:"board",iconFn:i.Z.collectionBoard,isLargeDatabaseIcon:!0,shouldShow:()=>!0,onClick:(e,t)=>Z({environment:e,store:t,viewType:"board"})},{name:m.default.formatMessage(B.list),type:"list",iconFn:i.Z.collectionList,isLargeDatabaseIcon:!0,shouldShow:()=>!0,onClick:(e,t)=>Z({environment:e,store:t,viewType:"list"})},{name:m.default.formatMessage(B.timeline),type:"timeline",iconFn:i.Z.collectionTimeline,isLargeDatabaseIcon:!0,shouldShow:()=>!0,onClick:(e,t)=>Z({environment:e,store:t,viewType:"timeline"})},{name:m.default.formatMessage(B.calendar),type:"calendar",iconFn:i.Z.collectionCalendar,isLargeDatabaseIcon:!0,shouldShow:()=>!0,onClick:(e,t)=>Z({environment:e,store:t,viewType:"calendar"})},{name:m.default.formatMessage(B.gallery),type:"gallery",iconFn:i.Z.collectionGallery,isLargeDatabaseIcon:!0,shouldShow:()=>!0,onClick:(e,t)=>Z({environment:e,store:t,viewType:"gallery"})}];function R(e,t){const o=new Map(e.map((e=>[e.type,e])));return t.reduce(((e,t)=>(o.has(t)&&e.push(o.get(t)),e)),[])}function A(){const e=(0,s.HI)([a.Y.weeklyTodoV2,a.Y.habitTrackerV2,a.Y.personalHomeV3],m.default.getIntl()),t=()=>{w.Z.open({analyticsFrom:"new_page_suggested_templates",cloneTo:"current_page"})},o=(e,t,o)=>{const i=o.sources["en-US"];l.Hp({environment:e,pageStore:t,isOnboarding:!1,copyBlock:{id:i.rootId,spaceId:i.spaceId,table:r.iU},item:{id:o.id,name:o.name,sources:o.sources,previewRootId:i.previewRootId,rootId:i.rootId,spaceId:i.spaceId}})};let i,n=[];switch(y.default.getEligibleGroup({experimentId:"new_page_suggested_templates",defaultGroup:"control"})){case"variant_1":i=o,n=e;break;case"variant_2":i=o,n=D();break;case"variant_3":i=t,n=e;break;case"variant_4":i=t,n=D();break;default:return[]}return n?n.map((e=>({name:e.name,iconFn:()=>e.emoji,type:"page_with_icon",shouldShow:()=>!0,onClick:(t,o)=>{i(t,o,e)},from:"new_page_suggested_templates"}))):[]}function D(){const{currentUserSettingsStore:e}=v.default.state,t=null==e?void 0:e.getSettings();return null!=t&&t.persona?(0,s.GZ)(t.persona,y.default,m.default.getIntl()):[]}},34574:(e,t,o)=>{o.d(t,{Z:()=>h});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(49271),s=o(8848),l=o(3779),c=o(82990),d=o(5366),p=o(99417),u=o(64921),m=o(52275);class g extends r.Z{constructor(){super(...arguments),this.completionsEnabledStore=this.createComputedStore((()=>{var e;const t=null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state;return(0,p.GD)(this.environment,t)}))}renderComponent(){return"collection-overlay"===this.props.format?this.renderCollectionOverlayMenuItem():"phone-modal"===this.props.format?this.renderPhoneModalMenuItem():this.renderPageMenuItem()}renderCollectionOverlayMenuItem(){const{device:e}=this.environment;return n()(m.Z,{icon:this.props.icon,title:this.renderTitle(),right:this.props.right,focused:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,showDragHandle:!e.isMobile&&!this.props.locked,dragHandleDisabled:"empty_page"===this.props.type})}renderPhoneModalMenuItem(){return n()(m.Z,{icon:this.props.icon,title:this.renderTitle(),focused:this.props.focused,onClick:this.props.onClick,showDragHandle:!1})}renderPageMenuItem(){return n()(u.Z,{style:this.getWrapStyle(),hovered:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,hoveredStyle:{background:this.theme.buttonHoveredBackground,color:this.theme.regularTextColor},pressedStyle:{background:this.theme.buttonPressedBackground}},void 0,n()("div",{style:this.getIconWrapStyle()},void 0,this.props.icon),this.renderTitle(),this.props.right&&n()("div",{style:{marginLeft:"auto",marginRight:4}},void 0,this.props.right))}renderTitle(){return"collection-overlay"!==this.props.format?this.props.title:n()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,this.props.title,n()("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,this.props.isDefault&&n()("span",{style:{fontSize:12,fontWeight:c.Z.fontWeight.medium,color:this.theme.mediumTextColor}},void 0,n()(d.FormattedMessage,{defaultMessage:"DEFAULT",id:"database.templatePickerMenuItem.default",description:"Default template"})),this.props.recurrence&&l.Z.repeat({width:14,color:s.ZP.blue,marginLeft:8})))}getWrapStyle(){const{device:e}=this.environment;return{...a.ZD,display:"flex",alignItems:"center",flexGrow:1,height:e.isMobile?36:32,fontSize:16,borderRadius:4,paddingLeft:8,marginBottom:2,color:this.completionsEnabledStore.state?this.theme.mediumTextColor:this.theme.lightTextColor}}getIconWrapStyle(){return{width:24,height:24,marginRight:10}}}g.displayName="TemplatePickerMenuItem";const h=g},65187:(e,t,o)=>{o.d(t,{Z:()=>pe});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(97762),p=o(83355),u=o(1302),m=o(41432),g=o(8848),h=o(80357),f=o(42875),v=o(89837),y=o(62193),b=o(98459),S=o(21202),w=o(70203),k=o(63143),C=o(5366),_=o(50906),M=o(43132),T=o(993),I=o(98724),P=o(56971),x=o(74284),B=o(22110),Z=o(98104),E=o(25103),R=o(30149),A=o(92022),D=o(23223),F=o(14976),L=o(99417),V=o(62619),N=o(17731),O=o(33929),U=o(68056),H=o(45162),z=o(73959),W=o(89086),j=o(66638),K=o(62094),Y=o(8949),G=o(16772),X=o(66949),q=o(10161),$=o(52689),J=o(23178),Q=o(19111),ee=o(13884),te=o(3815),oe=o(10743),ie=o(99757),ne=o(24666),re=o(48588),ae=o(29595),se=o(93262),le=o(42402);const ce=(0,C.defineMessages)({typeTextPlaceholder:{defaultMessage:"Press ‘/’ for commands…",id:"text.commandsMenuNotOpen.placeholder"},typeAiTextPlaceholder:{defaultMessage:"Press ‘space’ for AI, ‘/’ for commands…",id:"text.commandsMenuNotOpen.placeholder.ai",description:"Placeholder text for AI-enabled text inputs"},typeTextAiPlaceholder:{defaultMessage:"Press ‘/’ for commands, ‘space’ for AI…",id:"text.commandsMenuNotOpen.placeholder.textAi",description:"Placeholder text for AI-enabled text inputs, prioritizing slash menu"},filterPlaceholder:{defaultMessage:"Type to filter…",id:"text.commandsMenuOpen.placeholder"}});class de extends p.Z{constructor(e){super(e),this.editor=null,this.mergeEditorRefs=(0,y.s)(),this.triggeredAnalytics=!1,this.reminderTimers={},this.renderContentContainer=(e,t)=>c.createElement(ae.Z,a()({},this.classNameAndStyleStore.state,{onBlur:this.props.onBlur,onFocus:this.props.onFocus,getDisabled:this.getDisabled,spellCheck:!this.canExclusivelyComment(),getHtml:this.getHtml,getSelection:this.getContainerSelection,onMutation:this.handleMutation,onCompositionStart:this.handleCompositionStart,onCompositionEnd:this.handleCompositionEnd,onSelect:t,placeholder:this.getCurrentPlaceholder(),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,suppressNewlineEvents:!0,disableContentEditableWhenNotEditingTextOnMobile:!0},e,{ref:this.mergeEditorRefs(this.handleEditorRef,e.leafRef)})),this.handleEditorRef=e=>{this.editor=e},this.handleCompositionStart=()=>{Z.z9(this.environment,!0),this.props.onChange&&this.props.onChange()},this.isSpaceComposition=()=>{if(!this.shouldRenderInteractiveAiPlaceholder.state)return!1;const e=w.ee(this.getTextValue());return 1===e.length&&("　"===e[0]||" "===e[0])},this.handleCompositionEnd=()=>{Z.z9(this.environment,!1),this.props.onChange&&this.props.onChange(),this.isSpaceComposition()?(0,A.hr)({from:"spacebar",environment:this.environment}):R.createAndCommit({userAction:"Text.runAllFiltersAfterCompositionEnd",environment:this.environment,perform:e=>{B.G({environment:this.environment,store:this.props.store,transaction:e})}})},this.handleDelete=e=>{if(!this.canEditStore.state)return;if(this.editor&&this.editor.isComposing)return;this.logTypingLag("typing_delete");const{store:t}=this.props,o=ne.default.state;if("editing"===o.mode){const i=o.multiSelection;i.start.store===t&&R.createAndCommit({userAction:"Text.handleDelete",environment:this.environment,perform:t=>{P.as({environment:this.environment,multiSelection:i,deleteForwards:!0,transaction:t,event:e})}})}this.flushRenderQueue(),this.props.onChange&&this.props.onChange()},this.handleDeleteToEndOfLine=e=>{if(!this.canEditStore.state)return;if(this.editor&&this.editor.isComposing)return;const{store:t}=this.props,o=ne.default.state;if("editing"!==o.mode)return;const i=o.multiSelection;(0,U.iG)(i)&&(0,W.J_)(t,{startIndex:i.start.index,endIndex:i.end.index})&&this.handleDelete(e)},this.handleBackspace=e=>{if(!this.canEditStore.state||this.editor&&this.editor.isComposing)return;this.logTypingLag("typing_backspace");const{store:t}=this.props,o=ne.default.state;if("editing"===o.mode){const i=o.multiSelection;if(i.start.store===t){if(P.YV({device:this.environment.device,event:e,multiSelection:i}))return;R.createAndCommit({userAction:"Text.handleBackspace",environment:this.environment,perform:t=>{P.as({environment:this.environment,multiSelection:i,deleteForwards:!1,transaction:t,event:e})}})}}this.flushRenderQueue(),this.props.onChange&&this.props.onChange()},this.handleEnter=e=>{if(!this.canEditStore.state)return;if(this.logTypingLag("typing_enter"),V.IL(e),this.editor&&this.editor.isComposing)return;const t=ne.default.state;if("editing"===t.mode)if(this.props.onEnter)this.props.onEnter(e);else{const{multiSelection:e}=t;R.createAndCommit({userAction:"Text.handleEnter",environment:this.environment,perform:t=>{x.IO({environment:this.environment,multiSelection:e,transaction:t})}}),this.flushRenderQueue()}this.props.onChange&&this.props.onChange(e)},this.handleShiftEnter=e=>{if(!this.canEditStore.state)return;if(this.editor&&this.editor.isComposing)return;const t=ne.default.state;if("editing"===t.mode){const{device:o}=this.environment;if(!("shiftKey"in e)||e.shiftKey&&!o.isIOS){if(this.props.disableShiftEnter)return;R.createAndCommit({userAction:"Text.handleShiftEnter",environment:this.environment,perform:e=>{T.hJ({environment:this.environment,string:"\n",multiSelection:t.multiSelection,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}}),this.props.onChange&&this.props.onChange(e)}else this.handleEnter(e)}},this.handleTab=e=>{if(this.canEditStore.state){if(this.logTypingLag("typing_tab"),this.props.onTab){this.props.onTab(e)||e.preventDefault()}else{e.preventDefault();const t=(0,z.sQ)(this.props.store);t&&(R.createAndCommit({userAction:"Text.handleTab",environment:this.environment,perform:e=>{T.n2({environment:this.environment,closestSelectable:t,shiftKey:!1,transaction:e})}}),this.flushRenderQueue())}this.props.onChange&&this.props.onChange()}},this.handleUntab=e=>{if(this.canEditStore.state){if(this.logTypingLag("typing_untab"),this.props.onUntab){this.props.onUntab(e)||e.preventDefault()}else{e.preventDefault();const t=(0,z.sQ)(this.props.store);t&&(R.createAndCommit({userAction:"Text.handleUntab",environment:this.environment,perform:e=>{T.n2({environment:this.environment,closestSelectable:t,shiftKey:!0,transaction:e})}}),this.flushRenderQueue())}this.props.onChange&&this.props.onChange()}},this.handleAnnotation=(e,t)=>{this.canEditStore.state&&(t.preventDefault(),I.aS({environment:this.environment,annotation:e}),this.flushRenderQueue(),this.props.onChange&&this.props.onChange(),_.trackKeyboardAnnotation(this.environment,{type:w.J7(e)}))},this.handleToggleHighlight=e=>this.handleAnnotation(["h",$.Z.state.color],e),this.handleToggleBold=e=>this.handleAnnotation(["b"],e),this.handleToggleItalics=e=>this.handleAnnotation(["i"],e),this.handleToggleStrike=e=>this.handleAnnotation(["s"],e),this.handleToggleUnderline=e=>this.handleAnnotation(["_"],e),this.handleToggleCode=e=>this.handleAnnotation(["c"],e),this.handleClick=e=>{this.handleClickActions(e),this.props.onClick&&this.props.onClick(e)},this.handleContextMenu=e=>{const t=this.parentBlockStore.state;t&&F.li({environment:this.environment,event:e,textValue:this.getTextValue(),editorNode:this.getEditorNode(),store:this.props.store,parentStore:t,canEdit:this.canEditStore.state})},this.handleMouseOver=e=>{F.vO({environment:this.environment,event:e,textValue:this.getTextValue(),editorNode:this.getEditorNode(),store:this.props.store,parentStore:this.props.parentStore,canEdit:this.canEditStore.state})},this.handleMouseOut=e=>{F.kV({environment:this.environment,event:e,textValue:this.getTextValue(),editorNode:this.getEditorNode(),store:this.props.store,parentStore:this.props.parentStore,canEdit:this.canEditStore.state})},this.handleCopy=e=>{this.props.onCopy?this.props.onCopy(e):M.JG({environment:this.environment,event:e})},this.handleCut=e=>{if(this.canEditStore.state){if(this.props.onCut)return this.props.onCut(e),void this.flushRenderQueue();M.by({environment:this.environment,event:e}),this.flushRenderQueue(),this.props.onChange&&this.props.onChange()}else e.preventDefault()},this.handlePaste=e=>{this.canEditStore.state&&(R.createAndCommit({userAction:"Text.handlePaste",environment:this.environment,perform:t=>{M.v({environment:this.environment,event:e,disableEmbedMenu:Boolean(this.props.disableEmbedMenu),transaction:t,onPasteFiles:this.props.onPasteFiles||M.AL})}}),this.flushRenderQueue(),this.props.onChange&&this.props.onChange())},this.handleKeyPress=e=>{if(" "===e.key&&!e.shiftKey&&!e.ctrlKey&&!e.altKey&&!this.getTextValue()&&this.shouldRenderInteractiveAiPlaceholder.state)return e.preventDefault(),void(0,A.hr)({from:"spacebar",environment:this.environment});this.canEditStore.state||e.metaKey&&"c"===e.key||e.preventDefault()},this.handleMoveUp=e=>{e.preventDefault(),R.createAndCommit({userAction:"Text.handleMoveUp",environment:this.environment,perform:e=>{T.fs({environment:this.environment,transaction:e,direction:"up"})}})},this.handleMoveDown=e=>{R.createAndCommit({userAction:"Text.handleMoveDown",environment:this.environment,perform:e=>{T.fs({environment:this.environment,transaction:e,direction:"down"})}})},this.aiTextPlaceholderMessage=this.createComputedStore((()=>"on"===q.default.getEligibleGroup({experimentId:"prioritize_slash_menu_block_placeholder",defaultGroup:"control"})?O.default.formatMessage(ce.typeTextAiPlaceholder):O.default.formatMessage(ce.typeAiTextPlaceholder)),!1,"aiTextPlaceholderMessageStore"),this.canEditStore=this.createComputedStore((()=>{if(this.props.disabled)return!1;if(ie.n.state)return!1;const e=this.pageContext&&this.pageContext.publicEditModeStore.state;return(!this.props.isDiscussionInput||null==e||!e.hasPublicPermission||"view"!==e.permission)&&(!(!this.props.isDiscussionInput&&null!=e&&e.hasPublicPermission&&"edit"!==e.permission)&&this.props.store.canEdit())}),!1,"canEditStore"),this.getDisabled=()=>!this.canEditStore.state,this.getDefaultTruncateElement=()=>n()(le.Z,{disableUnderline:!0,style:{color:this.theme.mediumTextColor},onClick:e=>{e.preventDefault(),e.stopPropagation()}},void 0,"…"," ",n()("span",{},void 0,n()(C.FormattedMessage,{id:"text.truncated.showMoreLabel",defaultMessage:"more"}))),this.getHtml=()=>{var e;let t=this.getTextValue(),o=!1;if(this.props.canTruncate&&void 0!==this.props.maxChars){w.ee(t).length>this.props.maxChars&&(t=w.KU(this.getTextValue(),0,this.props.maxChars),o=!0)}const i=F.IY({environment:this.environment,textValue:t&&{value:t,spaceId:(0,b.CG)(this.props.store.pointer.spaceId)},parentStore:this.props.parentStore||this.props.store,disableHover:!1,disableStyleAnnotations:Boolean(this.props.disableStyleAnnotations),disableDateStyleAnnotations:Boolean(this.props.disableDateMentions),disabled:!this.canEditStore.state,theme:this.theme,emojiType:(0,N.e_)(this.environment),katex:this.environment.KatexStore.getKatex(),parentBlockId:this.getParentBlockId(),renderedPageBlockId:null===(e=this.pageContext)||void 0===e?void 0:e.pageStore.id,formulaValueTypes:[]}),r=n()(c.Fragment,{},void 0,i,o&&this.getDefaultTruncateElement());return d.renderToStaticMarkup(r)},this.clearBrowserSelection=()=>{var e;null===(e=this.getEditorNode())||void 0===e||e.blur()},this.getTextValue=()=>F.Rl({store:this.props.store,textValue:this.getTextValueHelper()}),this.getTextValueHelper=()=>{if(this.isNewDiscussionMenuTarget.state)return F.Gj({store:this.props.store});if(this.isInlineEquationOverlayTarget.state)return F.PY({store:this.props.store,equationStore:X.Z});if(this.isMentionMenuTarget.state)return F.Ob({store:this.props.store,mentionMenuState:this.isMentionMenuTarget.state});if(this.linkingMenuSelectionStore.state)return F.So({store:this.props.store,selection:this.linkingMenuSelectionStore.state});if(this.isCompletionPopupTarget.state)return F.fm({store:this.props.store,temporaryAnnotation:w.GK.TemporarySelection,multiSelection:this.getCompletionTextSelection()});const e=this.pageAnnotationBlockMenuStore.state;if(e)return e;if(this.isEditing.state){const e=ne.default.state;if("editing"===e.mode){const t=(0,U.QY)(e.multiSelection);if(t)return F.xX({store:this.props.store,selection:t.selection})}}return this.props.store.getValue()},this.parentBlockStore=this.createComputedStore((()=>{const{store:e}=this.props;if(e.pointer.table===S.iU)return te.G.createChildStore(e,e.pointer)}),!1,"parentBlockStore"),this.isEditing=this.createComputedStore((()=>(0,W.J5)(this.props.store)),!1,"isEditing"),this.isSelectionEndpoint=this.createComputedStore((()=>(0,W.Gq)(this.props.store)),!1,"isSelectionEndpoint"),this.isCompletionsEnabledStore=this.createComputedStore((()=>{var e;const t=null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state;return(0,L.GD)(this.environment,t)}),!1,"isCompletionsEnabledStore"),this.shouldRenderInteractiveAiPlaceholder=this.createComputedStore((()=>{if(this.environment.device.isMobile)return!1;if(this.props.disabled)return!1;const e=this.parentBlockStore.state,t=Boolean(e&&(0,D.td)(e)),o=e&&e.getType(),i=Boolean(o&&(0,m.hD)(o));return this.isCompletionsEnabledStore.state&&i&&!t&&"contains-selection"===this.isEditing.state}),!1,"shouldRenderInteractiveAiPlaceholder"),this.isNewDiscussionMenuTarget=this.createComputedStore((()=>{const e=ee.Z.state;return e.open&&"inline"===e.type&&Boolean((0,H.r)(e.multiSelection,this.props.store))}),!1,"isNewDiscussionMenuTarget"),this.isCompletionPopupTarget=this.createComputedStore((()=>{const e=this.getCompletionTextSelection();return e&&Boolean((0,H.r)(e,this.props.store))}),!1,"isCompletionPopupTarget"),this.isInlineEquationOverlayTarget=this.createComputedStore((()=>{var e;return X.Z.isOpen()&&(null===(e=(0,U.QY)(X.Z.state.savedTextSelectionState.multiSelection))||void 0===e?void 0:e.store)===this.props.store}),!1,"isInlineEquationOverlayTarget"),this.isMentionMenuTarget=this.createComputedStore((()=>{const e=Q.Z.state;return!!e.open&&(e.textStore===this.props.store&&e)}),!1,"isMentionMenuTarget"),this.linkingMenuSelectionStore=this.createComputedStore((()=>{const e=J.Z.state;if(!e.open)return!1;if(!e.focusLinkInput&&!e.focusTitleInput)return!1;if(!this.isEditing.state)return!1;const t=(0,U.QY)(e.savedTextSelectionState.multiSelection);return!!t&&t.selection}),!1,"linkingMenuSelectionStore"),this.pageAnnotationBlockMenuStore=this.createComputedStore((()=>{const e=Y.Z.state;if(!e.isActive)return;const{clickedPageAnnotation:t}=e;if(!t)return;const{parentStore:o,pageAnnotation:i}=t;if(o!==this.parentBlockStore.state)return;const n=this.props.store.getValue();return n?null==n?void 0:n.map((e=>w.km(e)?[e[0],e[1].flatMap((e=>w.ST(e)&&e===i?[i,w.EP()]:[e]))]:e)):void 0}),!1,"pageAnnotationBlockMenuStore"),this.getContainerSelection=()=>{const e=Boolean(this.linkingMenuSelectionStore.state);if((0,H.Aw)(this.environment)&&this.isSelectionEndpoint.state){if(e)return;return(0,W.HE)(this.props.store)}if(this.isEditing.state&&!e){const{store:e}=this.props,t=ne.default.state;if("editing"===t.mode){const o=(0,H.xI)("Text",t.multiSelection);if(o){const{selection:t}=o,i=e.getValue(),n=w.ee(i).length;return{type:"contain",selection:{startIndex:Math.min(t.startIndex,n),endIndex:Math.min(t.endIndex,n)}}}}}},this.getEndSelection=()=>{const e=w.ee(this.getTextValue());return{startIndex:e.length,endIndex:e.length}},this.classNameAndStyleStore=this.createComputedStore((()=>(0,h.iv)(this.getStyle(),this.props.className)),!1,"classNameAndStyleStore"),this.handleMutation=this.handleMutation.bind(this)}willMountOrUpdate(){this.createReminderTimers(),this.environment.KatexStore.loadIfNeeded(this.getTextValue)}willUnmount(){this.clearReminderTimers();const e=re.Z.state;e&&e.store===this.props.store&&E.l()}isComposing(){return this.editor&&this.editor.isComposing}createReminderTimers(){const e=this.getTextValue(),t=w.n(e),o=l().compact(t.map((e=>{const t=(0,v.KR)(e,(0,f.r)());return null==t?void 0:t.toMillis()}))),i=Date.now();for(const n of o){const e=n-i;e>0&&e<k.A0&&(n in this.reminderTimers||(this.reminderTimers[n]=setTimeout(this.enqueueForceUpdate,e)))}for(const n in this.reminderTimers)o.includes(parseInt(n))||(clearTimeout(this.reminderTimers[n]),delete this.reminderTimers[n])}clearReminderTimers(){for(const e in this.reminderTimers)clearTimeout(this.reminderTimers[e]),delete this.reminderTimers[e]}renderComponent(){const{disableInsertText:e,disableStyleAnnotations:t,disableSelectAllBlocks:o,disableSelectionDrag:i,disableDrag:n,disabled:r}=this.props,s=q.default.checkGate("side_peek_anywhere");return c.createElement(se.Z,a()({},this.props,{clearBrowserSelection:this.clearBrowserSelection,getEndSelection:this.getEndSelection,canInsertText:!r&&!e,onClick:this.handleClick,onContextMenu:s?this.handleContextMenu:void 0,onDelete:this.handleDelete,onDeleteToEndOfLine:this.handleDeleteToEndOfLine,onBackspace:this.handleBackspace,onEnter:this.handleEnter,onShiftEnter:this.handleShiftEnter,onTab:this.handleTab,onUntab:this.handleUntab,onToggleHighlight:this.handleToggleHighlight,onToggleBold:this.handleToggleBold,onToggleItalics:this.handleToggleItalics,onToggleStrike:this.handleToggleStrike,onToggleUnderline:this.handleToggleUnderline,onToggleCode:this.handleToggleCode,onCopy:this.handleCopy,onCut:this.handleCut,onPaste:this.handlePaste,onKeyPress:this.handleKeyPress,onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,render:this.renderContentContainer,disableAnnotation:t,canSelectAllBlocks:!o,canSelectionDrag:!i,disableDrag:n,topBottomPadding:9}))}getCurrentPlaceholder(){const{device:e}=this.environment;if(this.shouldRenderInteractiveAiPlaceholder.state&&!e.isMobileNative)return this.aiTextPlaceholderMessage.state;if(this.props.placeholder)return this.props.placeholder;if(!this.props.disabled){if(!this.props.disableSlashCommands&&"contains-selection"===this.isEditing.state&&this.canEditStore.state){if(oe.Z.state.open)return O.default.formatMessage(ce.filterPlaceholder);if(!e.isMobile)return O.default.formatMessage(ce.typeTextPlaceholder)}return" "}}handleMutation(e){if(this.logTypingLag("typing_lag"),!this.canEditStore.state)return;(0,H.Aw)(this.environment)?R.createAndCommit({userAction:"Text.handleMutation",environment:this.environment,perform:t=>{let o=this.props.store;const{multiSelection:i}=e;if(i&&!(0,U.qS)(i)&&(o=i.start.store),T.YV({environment:this.environment,store:o,newValue:e.newValue,disableMentions:Boolean(this.props.disableMentions),disableDateMentions:Boolean(this.props.disableDateMentions),disableDateReminderMentions:Boolean(this.props.disableDateReminderMentions),disableSlashCommands:Boolean(this.props.disableSlashCommands),disableEmojiCommands:Boolean(this.props.disableEmojiCommands),disableFilters:e.isComposing,transaction:t,multiSelection:i}),e.insertedLine){const e="editing"===ne.default.state.mode&&ne.default.state.multiSelection;e&&x.IO({environment:this.environment,multiSelection:e,transaction:t})}(0,K.o)(this.environment,t,o)}}):R.createAndCommit({userAction:"Text.handleMutation",environment:this.environment,perform:t=>{T.aS({environment:this.environment,store:this.props.store,newValue:e.newValue,disableMentions:Boolean(this.props.disableMentions),disableDateMentions:Boolean(this.props.disableDateMentions),disableDateReminderMentions:Boolean(this.props.disableDateReminderMentions),disableSlashCommands:Boolean(this.props.disableSlashCommands),disableEmojiCommands:Boolean(this.props.disableEmojiCommands),disableFilters:e.isComposing,transaction:t})}});const{store:t}=this.props,o=this.parentBlockStore.state;if(o){if(o.getType()){const e=o.getSchema()||{};if("properties"===t.path[0]&&t.path[1]){e[t.path[1]]&&!this.triggeredAnalytics&&(this.triggeredAnalytics=!0)}}}this.props.onChange&&this.props.onChange()}handleClickActions(e){F.SD({environment:this.environment,event:e,textValue:this.getTextValue(),editorNode:this.getEditorNode(),store:this.props.store,parentStore:this.props.parentStore,canEdit:this.canEditStore.state,disableEquationInteraction:this.props.disableEquationInteraction})}canComment(){return!this.props.disabled&&this.props.store.canComment()}canExclusivelyComment(){return this.canComment()&&!this.canEditStore.state}focus(){this.isEditing.state||Z.NX({store:this.props.store})}getEditorNode(){var e;return(null===(e=this.editor)||void 0===e?void 0:e.getNode())||void 0}getCompletionTextSelection(){const e=G.default.state;return("closedWithContext"===e.type||"completionPopup"===e.type&&"initialPromptForAIBlock"!==e.stage)&&"textSelection"===e.context.type?e.context.textSelection:void 0}getParentBlockId(){const{store:e}=this.props;if(e.table===S.iU)return e.id;const{ancestor:t}=e.findRecordStoreUIAncestor((e=>{let{table:t}=e;return t===S.iU}));return t?t.id:void 0}isEmpty(){return 0===w.lz(this.getTextValue()).length}logTypingLag(e){const t=!this.props.disabled&&"inline"===this.props.pasteBehavior;(0,j.u)({type:e,environment:this.environment,store:this.props.store,codeLanguage:void 0,isInCollectionView:t})}flushRenderQueue(){u.default.flush()}getStyle(){const{device:e}=this.environment;let t={maxWidth:"100%",width:"100%",whiteSpace:"pre-wrap",wordBreak:"break-word",caretColor:this.canExclusivelyComment()?g.ZP.transparent:this.theme.regularTextColor,...this.props.style};return this.isEmpty()&&(t.minHeight="1em",t={...t,color:this.theme.regularTextColor,WebkitTextFillColor:this.theme.lightTextColor,...this.props.placeholderStyle}),e.isMobile&&this.canEditStore.state&&(this.isEditing.state?t.WebkitUserModify="read-write-plaintext-only":(t.userSelect="none",t.WebkitUserSelect="none",t.whenFocusedEditable={userSelect:"text",WebkitUserSelect:"text",WebkitUserModify:"read-write-plaintext-only"})),t}}de.displayName="Text";const pe=de},17970:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(49271)),a=o(10161),s=o(86671),l=o(17748),c=o(65187);class d extends s.Z{renderPersisted(){const{store:e,hideContent:t,disabled:o}=this.props;return n()("div",{style:this.getStyle()},void 0,n()("div",{style:{display:"flex"}},void 0,n()(c.Z,{style:r.ZD,placeholderStyle:this.getPlaceholderStyle(),disabled:o,store:e.getBlockTitleStore(),pasteBehavior:"block"}),this.renderDiscussion()),!t&&this.renderContent())}renderContent(){const{store:e,disabled:t}=this.props,o=e.getContentStore();return(o.getValue()||[]).length>0?n()("div",{style:d.listStyle},void 0,n()(l.Z,{disabled:t,store:o,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag})):n()(l.Z,{disabled:!0,store:o})}getBlockAlignment(){if(!a.default.checkGate("text_align"))return{};const{block_alignment:e}=this.props.store.getFormat();switch(e){case"right":case"center":return{textAlign:this.props.store.getFormat().block_alignment};default:return{textAlign:"left"}}}getPlaceholderStyle(){if(!a.default.checkGate("text_align"))return{};const{block_alignment:e}=this.props.store.getFormat();switch(e){case"center":return{textAlign:"left",paddingLeft:"50%"};case"right":return{textAlign:"right"};default:return{textAlign:"left"}}}getStyle(){return{...this.getBlockAlignment(),...this.getBlockColorStyle(),...this.props.style}}}d.listStyle={paddingLeft:"1.5em",display:"flex",flexDirection:"column"};const p=d},5210:(e,t,o)=>{o.d(t,{q:()=>p,Z:()=>m});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(24405),l=o(3779),c=o(5366),d=o(64921);function p(e){let{isSidebar:t,isMobile:o}=e;return t&&!o?20:24}const u=(0,c.defineMessages)({open:{defaultMessage:"Open",id:"toggleButton.open",description:"Screen reader text for a generic toggle button when it is closed."},close:{defaultMessage:"Close",id:"toggleButton.close",description:"Screen reader text for a generic toggle button when it is open."}});function m(e){window.__c={n:"ToggleButton"};const t=(0,a.Fy)(),o=(0,c.useIntl)(),i=(0,r.useMemo)((()=>p({isSidebar:e.isSidebar,isMobile:t.isMobile})),[t.isMobile,e.isSidebar]),m=(0,s.yK)((()=>{const o=e.color||"inherit",n="chevron"===e.icon?`rotateZ(${e.open?0:-90}deg)`:`rotateZ(${e.open?180:90}deg)`,r="chevron"===e.icon,a=r&&t.isMobile;return{button:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:i,height:i,borderRadius:3,...e.style},arrow:{width:a?14:r?12:"0.6875em",height:a?14:r?12:"0.6875em",transition:"transform 200ms ease-out",transform:n,fill:o,opacity:e.fill?1:.5}}}),[t.isMobile,e.color,e.fill,e.icon,e.open,e.style,i]),g=(0,r.useMemo)((()=>{switch(e.icon){case"chevron":return l.Z.chevronDownRoundedThick(m.arrow);case"triangle":default:return l.Z.triangle(m.arrow)}}),[e.icon,m.arrow]);return n()(d.Z,{ariaLabel:e.open?o.formatMessage(u.close):o.formatMessage(u.open),style:m.button,onClick:e.onClick,onMouseDown:e.onMouseDown,disabled:e.disabled},void 0,e.tapArea&&n()("div",{style:{position:"absolute",opacity:0,width:e.tapArea.size,height:e.tapArea.size,top:-(e.tapArea.size-i)/2,left:-(e.tapArea.size-i)/2}}),g)}},85567:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(84619),p=o(3779),u=o(82990),m=o(25464),g=o(64921),h=o(58032);class f extends l.Z{constructor(){super(...arguments),this.tokenTextRef=s.createRef(),this.shouldShowTooltip=()=>Boolean(this.tokenTextRef.current&&this.tokenTextRef.current.offsetWidth<this.tokenTextRef.current.scrollWidth)}renderComponent(){if(this.props.showFullValueTooltip)return n()(h.Z,{placement:m.u.Right,renderTooltip:()=>this.props.value,originGap:20,textWrap:!0,disableTooltip:!this.props.showFullValueTooltip,render:e=>s.createElement("div",a()({style:this.getStyle()},e,{onMouseEnter:t=>{this.shouldShowTooltip()&&e.onMouseEnter&&e.onMouseEnter(t)}}),this.renderTokenContent())});if(this.props.onClick){const e=this.props.backgroundColor?{background:(0,c._j)(this.props.backgroundColor,1)}:void 0,t=this.props.backgroundColor?{background:(0,c._j)(this.props.backgroundColor,2)}:void 0;return n()(g.Z,{style:this.getStyle(),hoveredStyle:e,pressedStyle:t,onClick:this.props.onClick},void 0,this.renderTokenContent())}return n()("div",{style:this.getStyle()},void 0,this.renderTokenContent())}renderTokenContent(){return s.createElement(s.Fragment,null,s.createElement("div",{style:{...this.props.shouldWrap?{overflowWrap:"anywhere"}:u.Z.textOverflowStyle,textDecoration:this.props.isStrikedThrough?"line-through":void 0,display:"inline-flex",alignItems:"center"},ref:this.tokenTextRef},this.renderColoredDot(),this.props.value),this.renderRemoveButton())}renderColoredDot(){if(this.props.showColoredDot)return n()("div",{style:this.getDotStyle(this.props.showColoredDot)})}renderRemoveButton(){const{height:e,removeIconSize:t}=d.Z.styles[this.props.format];if(this.props.showRemoveButton)return n()(g.Z,{onClick:this.props.onClickRemove,style:{...f.removeButtonStyle,width:e,height:e},disabled:this.props.disabled,disabledFeedback:!1,mobileFeedback:!0,className:"notion-token-remove-button"},void 0,p.Z.closeThick({width:t,height:t,opacity:.5}))}getStyle(){const{format:e,isSingle:t,shouldShrink:o,isRound:i,shouldWrap:n}=this.props,{height:r,fontSize:a,paddingLeftRight:s,margin:l}=d.Z.styles[e],{ThemeStore:p}=this.environment,u=i?s+1:s;return{display:t?"inline-flex":"flex",alignItems:"center",flexShrink:t||o?1:0,minWidth:0,maxWidth:"100%",height:r,borderRadius:i?r/2:3,paddingLeft:u,paddingRight:this.props.showRemoveButton?0:i?u+2:u,fontSize:a,lineHeight:"120%",opacity:this.props.disabled&&this.props.disabledFeedback?.4:void 0,color:this.props.color||("light"===p.state.mode?this.theme.regularTextColor:c.ZP.whiteWithAlpha(.7)),background:this.props.backgroundColor||this.theme.legacyDefaultSelectColor,margin:t?0:l,...n&&{height:void 0,paddingTop:4,paddingBottom:4},...this.props.style}}getDotStyle(e){const{format:t}=this.props,{dotSize:o}=d.Z.styles[t],i="default"===e?"gray":e;return void 0===i?{}:{marginRight:5,borderRadius:99,height:o,width:o,backgroundColor:"light"===this.theme.mode?this.theme.accentColors[i][400]:this.theme.accentColors[i][700],display:"inline-flex",flexShrink:0}}}f.displayName="Token",f.removeButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",flexGrow:0,flexShrink:0,marginLeft:2,marginRight:2};const v=f},47082:(e,t,o)=>{o.d(t,{Z:()=>C});var i,n=o(97464),r=o.n(n),a=o(77094),s=o.n(a),l=o(96486),c=o.n(l),d=o(67294),p=o(83355),u=o(3779),m=o(60709),g=o(98742),h=o(34859),f=o(64113),v=o(64921),y=o(37601),b=o(74194),S=o(3386),w=o(18647);!function(e){e[e.Select=0]="Select",e[e.Person=1]="Person",e[e.Relation=2]="Relation",e[e.FilterValue=3]="FilterValue",e[e.Share=4]="Share",e[e.Group=5]="Group"}(i||(i={}));class k extends p.Z{constructor(){super(...arguments),this.storeTypes={store:f.Z},this.handleFocused=()=>{this.stores.store.setState({focused:!0})},this.handleBlurred=()=>{this.stores.store.setState({focused:!1})},this.handleKeyDown=e=>{"Backspace"===e.key&&0===this.props.value.length&&this.props.onRemoveLastToken(),this.props.onKeyDown&&this.props.onKeyDown(e)},this.handleSubmit=e=>{0===this.props.value.length&&this.props.onEmptySubmit&&this.props.onEmptySubmit(),this.props.onSubmit&&this.props.onSubmit(e)},this.handleContainerClick=()=>{var e,t;this.props.disabled||(this.input.focusInput(),null===(e=(t=this.props).onClick)||void 0===e||e.call(t))}}willMount(){(this.props.focus||this.props.focusInitial)&&this.stores.store.setState({focused:!0})}willUpdate(){void 0!==this.props.focus&&this.stores.store.setState({focused:this.props.focus})}renderComponent(){const{disabled:e}=this.props;return s()(S.Z,{capture:!e,onLeft:c().identity,onRight:c().identity,onSelectAll:c().identity,onRedo:c().identity,onUndo:c().identity,onToggleBold:c().identity,onToggleItalics:c().identity,onToggleCode:c().identity,onCut:c().identity,onCopy:c().identity,onPaste:c().identity,onKeypress:c().identity},void 0,s()(S.Z,{capture:!e&&this.props.value.length>0,onDelete:c().identity,onBackspace:c().identity},void 0,this.renderTokenInput()))}renderTokenInput(){const{right:e,showClearButton:t}=this.props;return e||t?s()(w.Z,{type:h.Z.All,style:{...this.getWrapStyle(),flexWrap:"nowrap",...this.props.style},onClick:this.handleContainerClick},void 0,s()("div",{style:{display:"flex",flexWrap:"wrap",flexGrow:1,minWidth:0,...this.props.inputAndTokenWrapRightStyle}},void 0,this.props.tokens,!this.props.hideInput&&this.renderInput()),s()("div",{style:{flexShrink:0}},void 0,this.renderRight())):this.environment.device.isMobile?s()("div",{style:{...this.getWrapStyle(),flexWrap:"nowrap",...this.props.style},onClick:this.handleContainerClick},void 0,s()("div",{style:{display:"flex",flexWrap:"wrap",flexGrow:1,minWidth:0,overflow:"hidden",marginRight:this.isGroup()?6:0}},void 0,this.props.tokens,!this.props.hideInput&&this.renderInput()),s()(y.Z,{show:this.stores.store.state.focused})):s()(w.Z,{type:h.Z.All,style:{...this.getWrapStyle(),...this.props.style},onClick:this.handleContainerClick},void 0,this.props.tokens,!this.props.hideInput&&this.renderInput())}renderRight(){const{showClearButton:e,right:t,onClearButtonClick:o,tokens:i,value:n}=this.props,{isMobile:r}=this.environment.device;return t||(e&&(i.length>0||n.length>0)?s()(v.Z,{onClick:o,style:{flexShrink:0,flexGrow:0,borderRadius:r?24:20,marginTop:2}},void 0,u.Z.clearInput({width:r?16:14,height:r?16:14,fill:this.theme.lightIconColor})):void 0)}renderInput(){const e=0===this.props.tokens.length;return d.createElement(b.Z,r()({disabled:this.props.disabled,format:b.Z.Format.Transparent},(0,g.Z)({onKeyDown:this.handleKeyDown},{onChange:this.props.onChange}),{value:this.props.value,focus:this.props.focus,focusInitial:this.props.focusInitial,focusAfterAnimation:this.props.focusAfterAnimation,style:this.getInputDivStyle(),inputStyle:this.props.inputStyle||{height:this.environment.device.isMobile?24:this.isGroup()?20:18},size:1,ref:e=>e&&(this.input=e),type:this.props.type,placeholder:e?this.props.placeholder:"",onSubmit:this.handleSubmit,onFocus:this.handleFocused,onBlur:this.handleBlurred,textarea:this.props.textarea,autoComplete:this.props.autoComplete}))}isGroup(){return this.props.format===i.Group}getDesktopWrapStyle(){const{disabled:e}=this.props;return{display:"flex",flexWrap:"wrap",alignItems:"flex-start",background:e?"none":this.theme.tokenInputMenuItemBackground,cursor:"text",overflow:"hidden"}}getMobileWrapStyle(){return{display:"flex",flexWrap:"wrap",alignItems:"flex-start",flexShrink:0,minHeight:44,borderBottom:`1px solid ${this.theme.regularDividerColor}`,fontSize:16,background:this.theme.popoverBackground}}getWrapStyle(){var e,t;const{focus:o,format:i}=this.props,{WindowSizeStore:n}=this.environment;return{...this.environment.device.isMobile?{...this.getMobileWrapStyle(),paddingTop:14,paddingBottom:8,paddingLeft:(null===(e=this.context.menu)||void 0===e?void 0:e.menuType)!==m.og.Popup?n.getSafePaddingLeftCSS(16):16,paddingRight:(null===(t=this.context.menu)||void 0===t?void 0:t.menuType)!==m.og.Popup?n.getSafePaddingRightCSS(16):16,...this.props.dontShowBorderBottom&&{borderBottom:"none"}}:{...this.getDesktopWrapStyle(),...this.getStyles()[i].desktopWrapStyle},...this.props.showBorder&&{boxShadow:"rgba(15, 15, 15, 0.1) 0px 0px 0px 1px inset"},...this.props.showBorder&&this.props.focus&&{boxShadow:"rgba(35, 131, 226, 0.57) 0px 0px 0px 1px inset, rgba(35, 131, 226, 0.35) 0px 0px 0px 2px"},...!this.environment.device.isMobile&&o&&this.getStyles()[this.props.format].inputDivDesktopFocusStyle}}getStyles(){const e={desktopWrapStyle:{padding:"8px 9px 1px",width:"100%",minHeight:34,fontSize:14},inputDivDesktopStyle:{margin:"0 6px 6px 0",borderTopLeftRadius:3,borderTopRightRadius:3},inputDivDesktopFocusStyle:{}};return{[i.Select]:e,[i.Person]:e,[i.Relation]:e,[i.Share]:e,[i.Group]:e,[i.FilterValue]:{desktopWrapStyle:{padding:"6px 6px 1px",boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,margin:"6px 8px 2px 8px",minHeight:30,fontSize:12,borderRadius:3},inputDivDesktopStyle:{margin:"0 6px 4px 0"},inputDivDesktopFocusStyle:{boxShadow:"rgba(35, 131, 226, 0.57) 0px 0px 0px 1px inset, rgba(35, 131, 226, 0.35) 0px 0px 0px 2px"}}}}getInputDivStyle(){return{flexGrow:1,flexShrink:1,flexBasis:this.props.inputFullWidth?"100%":60,minWidth:60,width:"auto",lineHeight:"20px",...this.environment.device.isMobile?{margin:"0 8px 8px 0"}:this.getStyles()[this.props.format].inputDivDesktopStyle,...this.props.inputDivStyle}}}k.displayName="TokenInputMenuItem",k.contextTypes={...m.mw,...p.w},k.Format=i;const C=k},60442:(e,t,o)=>{o.d(t,{Z:()=>c});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(82990),s=o(47853);class l extends r.Z{renderComponent(){const{imageURL:e,imageWidth:t,imageHeight:o}=this.props;if(e){const i=(0,s.D)(e);return n()("div",{style:{width:t||200,marginTop:4,marginBottom:4}},void 0,n()("div",{style:{width:"100%",height:o||100,borderRadius:3,backgroundImage:`url(${i})`,backgroundSize:"cover",marginBottom:6}}),this.renderText())}return this.renderText({width:t})}renderText(e){const{caption:t,title:o}=this.props;return n()("div",{style:{whiteSpace:"normal",lineHeight:1.4,...e}},void 0,o&&n()("header",{style:{fontWeight:a.Z.fontWeight.bold,marginBottom:4}},void 0,o),t)}}l.displayName="TooltipThumbnailLayout";const c=l},79482:(e,t,o)=>{o.d(t,{Z:()=>de});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(62518),c=o(83355),d=o(6740),p=o(3779),u=o(89101),m=o(19889),g=o(80503),h=o(51454),f=o(5366),v=o(50906),y=o(47307),b=o(84908),S=o(3297),w=o(87420),k=o(5978),C=o(87531),_=o(95477),M=o(28020),T=o(43250),I=o(12955),P=o(34700),x=o(84210),B=o(12534),Z=o(67669),E=o(17504),R=o(65598),A=o(45094),D=o(15517),F=o(51),L=o(79315),V=o(61436),N=o(24042),O=o(10161),U=o(96071),H=o(85974),z=o(96026),W=o(3815),j=o(16194),K=o(52258),Y=o(66708),G=o(48601),X=o(1449),q=o(63296),$=o(89728),J=o(53834),Q=o(14066),ee=o(46457),te=o(22789),oe=o(13612),ie=o(37064),ne=o(69525),re=o(94686),ae=o(55725),se=o(12253),le=o(75272);class ce extends c.Z{constructor(){super(...arguments),this.startedInitialPublicPageEdit=!1,this.storeTypes={loginModalStore:U.Z,loginStore:H.Z},this.screenXAtLastMouseDown=0,this.screenYAtLastMouseDown=0,this.handleMouseDown=()=>{this.screenXAtLastMouseDown=window.screenX,this.screenYAtLastMouseDown=window.screenY},this.handleClickTopbar=e=>{const t=window.screenX,o=window.screenY;this.screenXAtLastMouseDown===t&&this.screenYAtLastMouseDown===o&&(0,B.ZP)({event:e,context:B.Af.EditorClick,callback:()=>{w.E5(this.environment)}})},this.handleDoubleClickTopbar=e=>{e.target!==e.currentTarget||N.Z.state.isShowingTabBar||(0,B.ZP)({event:e,context:B.Af.EditorDoubleClick,callback:b.toggleMaximized})},this.handleFocus=e=>{const t=e.target;t instanceof HTMLElement&&(0,d.E)(t)&&j.Z.set(!0)},this.handleBlur=()=>{j.Z.set(!1)},this.maybeOpenOnBaseUrl=()=>{var e;const{RouterStore:t}=this.environment,o=t.state.route,i=null===(e=this.pageContext)||void 0===e?void 0:e.pageStore;if("page"===o.name&&o.requestedOnPublicDomain&&i){const e=(0,x.ZP)({store:i,preferPublicLink:!1});return k.navigateOnBaseUrl({environment:this.environment,url:e}),!0}return!1},this.handleStartPublicEdit=()=>{this.maybeOpenOnBaseUrl()||(this.environment.currentUser.isLoggedIn()?y.showDialog({showCancel:!0,keepFocus:!1,message:a()(f.FormattedMessage,{defaultMessage:"When you start editing, your name, email and photo will be visible to the page owners.",id:"topbar.startPublicEditDialog.message"}),items:[{label:a()(f.FormattedMessage,{defaultMessage:"Continue",id:"topbar.startPublicEditDialog.continueLabel"}),color:"blue",onAccept(){z.Z.setState({editing:!0})}}]}):((0,D.Hr)({currentUserId:this.environment.currentUser.id,blockId:this.props.store.id}),k.navigateOnBaseUrl({environment:this.environment,url:u._j.login})))},this.handleAttemptPublicComment=()=>{(0,D.Hr)({currentUserId:this.environment.currentUser.id,blockId:this.props.store.id}),this.maybeOpenOnBaseUrl()||k.navigateOnBaseUrl({environment:this.environment,url:u._j.login})},this.forkPageRef=null,this.handleForkPageRef=e=>{this.forkPageRef=e},this.handleOpenQuickFind=()=>{C.UT({environment:this.environment,analyticsFrom:"public-page-topbar"})},this.handleOpenForkPage=()=>{S.S({environment:this.environment,store:this.props.store,originRect:this.getDuplicateClientRect()})},this.handleClickOpenNotion=async()=>{v.trackNotionTopbarClickEvent(this.environment,{variant:"open_notion"}),await k.publicPageTopBarAction(this.environment,{utmContent:"topbar_cta",nextRoute:u._j.root})},this.handleClickTryNotion=async()=>{v.trackNotionTopbarClickEvent(this.environment,{variant:"try_notion"}),await k.publicPageTopBarAction(this.environment,{utmContent:"topbar_cta",nextRoute:u._j.signup})},this.appRenderState=this.createComputedStore((()=>M.h1(this.environment)))}didUpdate(){const{store:e}=this.props,{RouterStore:t}=this.environment,o=t.state.route,{publicPageData:i}=F.Z.state;this.isReady()&&e.canEdit()&&!z.Z.state.editing&&"page"===o.name&&!o.requestedOnPublicDomain&&this.shouldRenderPublicPageTopbar()&&!this.startedInitialPublicPageEdit&&null!=i&&i.requireLogin&&(this.startedInitialPublicPageEdit=!0,this.handleStartPublicEdit())}renderComponent(){return(0,E.Z)((e=>s.createElement("div",n()({style:this.getWrapStyle()},e),a()("div",{style:this.getStyle(),className:T.lIT,onFocus:this.handleFocus,onBlur:this.handleBlur},void 0,this.isReady()&&(this.shouldRenderPublicPageTopbar()?this.renderPublicPageTopbar():this.renderDefaultTopbar())),a()(G.Z,{banners:this.props.banners,isMobile:!1,isInPeekRenderer:!1}))))}renderPublicPageTopbar(){const{device:e,currentUser:t}=this.environment,{store:o,isInvalidPage:i,isElectron:n}=this.props,r=Boolean(t.isLoggedIn()||(0,I.getPublicDomainUserId)(this.environment)),l=r?"control":O.default.getEligibleGroup({experimentId:"try_notion_cta",defaultGroup:"control"}),{isShowingTabBar:c}=N.Z.state;return a()("div",{style:this.getContainerStyle(c),onDoubleClick:this.handleDoubleClickTopbar},void 0,a()(ee._,{loginModalStore:this.stores.loginModalStore,loginStore:this.stores.loginStore,title:a()(Q.J,{}),isSignup:!0}),n&&!c&&a()(re.Z,{}),!i&&a()(X.Z,{store:o,style:this.getBreadcrumbStyle(),maxAncestorCount:2,ancestorMaxWidth:160,currentPageMaxWidth:240,showCurrentPageControls:!0,isMobile:!1}),a()("div",{style:{flexGrow:1,flexShrink:1}}),o.canEdit()&&!z.Z.state.editing&&a()(q.Z,{onClick:this.handleStartPublicEdit,style:{marginRight:8,padding:"0 8px"}},void 0,p.Z.pencil(ce.topbarIconStyle),a()(f.FormattedMessage,{id:"topbar.publicPage.edit",defaultMessage:"Edit"})),!this.environment.currentUser.isLoggedIn()&&o.canComment()&&!o.canEdit()&&a()(q.Z,{onClick:this.handleAttemptPublicComment,style:{marginRight:8,padding:"0 8px"}},void 0,p.Z.speechBubbleThin(ce.topbarIconStyle),a()(f.FormattedMessage,{id:"topbar.publicPage.comment",defaultMessage:"Comment"})),a()($.Z,{onClick:this.handleOpenQuickFind},void 0,p.Z.searchThick(ce.topbarIconStyle),a()(f.FormattedMessage,{defaultMessage:"Search",id:"topbar.publicPage.searchButton.label"})),(0,Z.S4)(this.props.store)&&s.createElement($.Z,{onClick:this.handleOpenForkPage,ref:this.handleForkPageRef},a()(f.FormattedMessage,{defaultMessage:"Duplicate",id:"topbar.publicPage.duplicateButton.label"})),!e.isMobile&&!i&&a()(oe.Z,{store:o,buttonPopupStore:K.Z}),a()("div",{style:this.getPublicPageTopbarDividerStyle()}),r?a()($.Z,{onClick:this.handleClickOpenNotion},void 0,p.Z.notionLogo(ce.notionLogoStyle),this.renderOpenNotionMessage()):"control"===l?a()($.Z,{onClick:this.handleClickTryNotion},void 0,p.Z.notionLogo(ce.notionLogoStyle),this.renderTryNotionMessage()):this.renderTryNotionCTAExperiment(l))}renderDefaultTopbar(){const{store:e,isInvalidPage:t,isElectron:o,showSidebarButton:i,collectionViewStore:n}=this.props,{isMobile:r}=this.environment.device,{pageVisitStore:s,presenceStore:l,currentSpaceStore:c,currentSpaceViewStore:d}=L.default.state,p=(0,Z.IJ)(this.environment,this.props.store),{isShowingTabBar:u}=N.Z.state;return a()(ie.Z,{store:e,disableRectangularSelection:!0,disableEditNearestBlock:!0,render:()=>a()("div",{style:this.getContainerStyle(u),onClick:this.handleClickTopbar,onMouseDown:this.handleMouseDown,onDoubleClick:this.handleDoubleClickTopbar},void 0,i&&a()(le.Z,{}),o&&!u&&a()(re.Z,{}),!t&&a()(X.Z,{store:e,style:this.getBreadcrumbStyle(),maxAncestorCount:2,ancestorMaxWidth:160,currentPageMaxWidth:240,showCurrentPageControls:!0,isMobile:!1}),e.canEditCollection()&&a()(te.Z,{store:e,isMobile:!1},e.id),e.isRestricted()&&a()(se.Z,{style:{...(0,P.X)(this.environment.device.isElectronMac,!1),marginRight:10},onClick:()=>{Y.Z.setState({open:!0})}}),!t&&a()(ae.Z,{}),a()("div",{style:{flexGrow:1,flexShrink:1}}),!r&&!p&&a()(ne.iY,{store:e,collectionViewStore:n,spaceStore:c,spaceViewStore:d,pageVisitStore:s,presenceStore:l,isInvalidPage:t}))})}renderOpenNotionMessage(){return a()(f.FormattedMessage,{defaultMessage:"Open Notion",id:"topbar.publicPage.cta.label.open"})}renderTryNotionMessage(){return a()(f.FormattedMessage,{defaultMessage:"Try Notion",id:"topbar.publicPage.cta.label.try"})}renderTryNotionCTAExperiment(e){switch(e){case"V1":return a()($.Z,{onClick:this.handleClickTryNotion},void 0,p.Z.notionLogo(ce.notionLogoStyle),a()(f.FormattedMessage,{defaultMessage:"Try Notion free",description:"A call to action for a visitor to try Notion (the app)",id:"topbar.publicPage.cta.label.try.V1"}));case"V2":return a()($.Z,{onClick:this.handleClickTryNotion},void 0,p.Z.notionLogo(ce.notionLogoStyle),a()(f.FormattedMessage,{defaultMessage:"Sign up for Notion",description:"A call to action for a visitor to try Notion (the app)",id:"topbar.publicPage.cta.label.try.V2"}));case"V3":return s.createElement(s.Fragment,null,a()(J.Z,{onClick:this.handleClickTryNotion,variant:"primary",style:{height:"32px"}},void 0,p.Z.notionLogo({...ce.notionLogoStyle,fill:"#ffffff"}),a()(f.FormattedMessage,{defaultMessage:"Try Notion",description:"A call to action for a visitor to try Notion (the app)",id:"topbar.publicPage.cta.label.try.V3"})));case"V4":return a()(J.Z,{onClick:this.handleClickTryNotion,variant:"primary",style:{height:"32px"}},void 0,p.Z.notionLogo({...ce.notionLogoStyle,fill:"#ffffff"}),a()(f.FormattedMessage,{defaultMessage:"Try Notion free",description:"A call to action for a visitor to try Notion (the app)",id:"topbar.publicPage.cta.label.try.V4"}));case"V5":return a()(J.Z,{onClick:this.handleClickTryNotion,variant:"primary",style:{height:"32px"}},void 0,p.Z.notionLogo({...ce.notionLogoStyle,fill:"#ffffff"}),a()(f.FormattedMessage,{defaultMessage:"Sign up for Notion",description:"A call to action for a visitor to try Notion (the app)",id:"topbar.publicPage.cta.label.try.V5"}));default:return null}}getDuplicateClientRect(){if(this.forkPageRef){const e=l.findDOMNode(this.forkPageRef);if(e instanceof Element)return e.getBoundingClientRect()}}isReady(){const e=(0,R.Oh)(this.props.store),{id:t}=this.environment.currentUser,o=t?W.U6.createChildStore(this.props.store,{table:m.KJ,id:t}):void 0,i=!o||o.isReady();return e&&i}shouldRenderPublicPageTopbar(){return!_.Z.isAdminMode&&(0,Z.IJ)(this.environment,this.props.store)}getWrapStyle(){return{maxWidth:"100vw",zIndex:h.lI,background:this.theme.contentBackground,WebkitUserSelect:"none",userSelect:"none"}}getStyle(){return{width:"100%",maxWidth:"100vw",height:g.R6(this.environment.device.isElectronMac),opacity:M.tu.state?0:1,transition:`\n\t\t\t\topacity ${ce.transitionDuration}ms,\n\t\t\t\tcolor ${ce.transitionDuration}ms\n\t\t\t`,position:"relative"}}getContainerStyle(e){const{device:t}=this.environment,o=t.isElectronMac&&(!this.appRenderState.state.shouldShowSidebar||!(0,A.in)(this.environment))&&!V.Z.state.isFullScreen&&!e;return{...(0,P.X)(this.environment.device.isElectronMac,!e),display:"flex",justifyContent:"space-between",alignItems:"center",overflow:"hidden",height:g.R6(this.environment.device.isElectronMac),paddingLeft:o?ce.paddingLeftWhenDesktopSidebarClose:t.isMobile?4:12,paddingRight:t.isMobile?4:10}}getBreadcrumbStyle(){return{...(0,P.X)(this.environment.device.isElectronMac,!1),height:"100%",flexGrow:0,marginRight:8,fontSize:14,minWidth:0}}getPublicPageTopbarDividerStyle(){return{flex:"none",width:1,height:16,marginLeft:8,marginRight:8,background:this.theme.darkDividerColor}}}ce.displayName="Topbar",ce.paddingLeftWhenDesktopSidebarClose=73,ce.transitionDuration=700,ce.topbarIconStyle={width:14,height:14,marginRight:6},ce.notionLogoStyle={width:18,height:18,marginRight:6};const de=ce},69525:(e,t,o)=>{o.d(t,{iY:()=>z,UP:()=>W,W2:()=>j});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(24405),c=o(3779),d=o(80503),p=o(51454),u=o(5366),m=o(74647),g=o(95477),h=o(28020),f=o(43250),v=o(99417),y=o(10663),b=o(45094),S=o(31792);const w=new(o(61766).Z);var k=o(52258),C=o(66708),_=o(77503),M=o(7011),T=o(34700),I=o(73063);function P(e){window.__c={n:"TopbarAssistantButton"};const{blockStore:t}=e,o=(0,a.O7)(),{isElectronMac:i}=o.device,d=(0,l.yK)((e=>({icon:{height:20,width:20,fill:e.aiPurpleColor},button:{...(0,T.X)(i,!1),width:33,height:28,marginRight:2}})),[i]),p=(0,r.useCallback)((()=>{m.handleSidebarButtonClick(o,t,M.gY.Assistant,"topbar")}),[o,t]),u=(0,s.VK)((()=>(0,b.Sx)(o)&&M.ZP.state.currentTab===M.gY.Assistant),[o]);return n()(I.Z,{icon:c.Z.sparkles,iconStyle:d.icon,style:d.button,ariaLabel:"Assistant",className:f.N27,onClick:p,hovered:u})}var x=o(97464),B=o.n(x),Z=o(16402),E=o(24039),R=o(58032);function A(e){const{store:t,isExpanded:o,isWindowSmall:i,isElectronMac:a}=e,c=(0,l.Fg)(),d=(0,s.VK)((()=>t.getLastEditedTime()),[t]),[p,m]=(0,r.useState)("flex"),[g,h]=(0,r.useState)(1);(0,r.useEffect)((()=>{let e;return o||i?o?(h(0),m("none")):(h(0),e=setTimeout((()=>m("none")),150)):(m("flex"),e=setTimeout((()=>h(1)),150)),()=>clearTimeout(e)}),[o,i]);const f=d?(0,Z.IS)(d,{useLowercase:!0,useCompactFormat:!0,roundDownYears:!0}):"";return f?r.createElement(r.Fragment,null,n()("span",{style:{opacity:g,transition:"opacity 150ms linear",display:p,alignItems:"center",fontSize:14,color:c.lightTextColor,height:28,whiteSpace:"nowrap",lineHeight:1.2}},void 0,n()("div",{style:{display:"flex",flexFlow:"wrap"}},void 0,n()(R.Z,{placement:R.Z.Placement.Bottom,alignment:R.Z.Alignment.Start,renderTooltip:()=>n()(E.Z,{store:t,compactFormat:!0}),render:e=>{return r.createElement(r.Fragment,null,r.createElement("div",B()({},e,{style:{...(0,T.X)(a,!1)}}),(t=f,n()(u.FormattedMessage,{defaultMessage:"Edited {timestamp}",id:"pagePropertiesHeader.edited.label",values:{timestamp:t},description:"Text to display when a page was last edited, next to the edited timestamp"}))));var t}})))):null}var D=o(79482),F=o(79075),L=o(96677),V=o(43803),N=o(11819),O=o(95796),U=o(29538),H=o(23727);function z(e){window.__c={n:"TopbarActionButtons"};const t=(0,a.O7)(),{device:o}=t,i=(0,u.useIntl)(),{store:g,spaceStore:T,pageVisitStore:I,presenceStore:x,collectionViewStore:B,spaceViewStore:Z}=e,E=(0,s.VK)((()=>g.canEdit()),[g]),[R,z]=(0,s.AF)(void 0,S.Z),[K,Y]=(0,r.useState)(!1),[G]=(0,s.AF)(M.ZP),X=(0,s.VK)((()=>j({canEditPage:E,device:o})),[E,o]),q=(0,s.VK)((()=>(0,v.jp)(o)),[o]),$=(0,s.VK)((()=>h.xe(g.id)),[g]),J=(0,s.VK)((()=>Boolean(T&&!T.canEdit())),[T]),Q=(0,s.VK)((()=>(0,b.Sx)(t)),[t]),ee=(0,s.VK)((()=>(0,y.ui)(t,!1)<1150),[t]),te=W({isSpaceGuest:J,canEditPage:E});(0,r.useEffect)((()=>{Y(!Q)}),[Q]);const{canShowUpdateSidebarUnexpander:oe,shouldShowUpdateSidebarUnexpander:ie}=(0,s.VK)((()=>{const e=!K&&Q&&!(0,b._c)(t);return{canShowUpdateSidebarUnexpander:e,shouldShowUpdateSidebarUnexpander:e&&(G.mouseEntered||R.mouseEntered)}}),[K,Q,t,R,G]),[ne]=(0,s.AF)(M.ZP),re=(0,s.Kw)(h.tu),ae=(0,s.VK)((()=>!o.isMobile&&(!g.isCollectionView()||g.isCollectionViewPageWithContent())),[g,o]),se=(0,l.yK)((()=>({actionButtonsWrapStyle:{flexGrow:0,flexShrink:0,display:"flex",alignItems:"center",paddingRight:o.isMobile?4:0,paddingLeft:o.isMobile?4:12,width:oe?ne.width:void 0,justifyContent:"space-between",zIndex:p.A_,height:d.R6(t.device.isElectronMac),opacity:re?0:1,transition:`\n\t\t\t\t\topacity ${D.Z.transitionDuration}ms,\n\t\t\t\t\tcolor ${D.Z.transitionDuration}ms\n\t\t\t\t`},rightButtonsContainer:{display:"flex"}})),[oe,o,ne,t,re]);if(e.isInvalidPage)return null;const le=o.isElectronMac&&re||!oe||!o.isElectron&&!ie||G.isAnimating;return $?null:n()("div",{style:se.actionButtonsWrapStyle,onMouseMove:()=>{z({...R,mouseEntered:!0})},onMouseLeave:()=>{z({...R,mouseEntered:!1})},className:f.A_D},void 0,le?n()("div",{}):n()("div",{className:f.JiD},void 0,n()(U.C,{shouldHide:le,icon:c.Z.doubleChevronRight,caption:i.formatMessage({defaultMessage:"Close sidebar",id:"updateSidebarUnexpandButton.closeSidebar.tooltip"}),onClick:()=>{Y(!0),m.setUpdateExpand({environment:t,isExpanded:!1,from:"close_for_space"})},keyboardShortcutName:"toggleUpdateSidebar",isElectron:o.isElectron})),n()("div",{style:se.rightButtonsContainer},void 0,n()(A,{store:g,isExpanded:Q,isWindowSmall:ee,isElectronMac:o.isElectronMac}),E&&I&&x&&n()(N.Z,{rootStore:g,pageVisitStore:I,presenceStore:x}),n()("div",{style:{marginLeft:12}}),te&&n()(O.Z,{store:g,buttonPopupStore:C.Z}),ae&&n()(F.Z,{blockStore:g,spaceStore:T,buttonPopupStore:w}),X&&n()(H.Z,{blockStore:g,spaceStore:T,buttonPopupStore:_.Z}),n()(L.Z,{store:g,spaceViewStore:Z}),q&&n()(P,{blockStore:g}),!o.isMobile&&n()(V.Z,{store:g,collectionViewStore:B,buttonPopupStore:k.Z})))}function W(e){const{canEditPage:t,isSpaceGuest:o}=e;return!!g.Z.isAdminMode||(!o||t)}function j(e){const{canEditPage:t,device:o}=e;return!!g.Z.isAdminMode||!!t&&!o.isPhone}},94686:(e,t,o)=>{o.d(t,{Z:()=>M});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(5366),p=o(50906),u=o(84908),m=o(5978),g=o(34700),h=o(33665),f=o(24042),v=o(88923),y=o(64921),b=o(73063),S=o(21199),w=o(58261),k=o(44532),C=o(58032);class _ extends l.Z{constructor(){super(...arguments),this.renderDesktopButtons=()=>n()(S.Z,{capture:!0,render:e=>s.createElement("div",a()({style:{display:"flex",flexShrink:0}},e),this.renderBackButton(),this.renderForwardButton(),this.renderNewTabButton())}),this.handleBackClick=()=>{const{supportsNativeHomeTabPhone:e}=this.props,{mobileNative:t}=this.environment;p.trackClickDesktopNavigator(this.environment,{type:"back"}),h.__(this.environment)?m.back(this.environment):e&&!h.NW(this.environment)?null==t||t.showNativeHomeTab():m.back(this.environment)},this.handleForwardClick=()=>{p.trackClickDesktopNavigator(this.environment,{type:"forward"}),m.forward()},this.handeNewTabClick=()=>{u.openInNewTab({url:"",makeTabActive:!0,position:"start"})}}renderComponent(){return this.environment.device.isMobile?this.renderMobile():this.renderDesktop()}renderDesktop(){return n()(k.ZP,{style:{background:"transparent",borderRadius:0,boxShadow:"none"},origin:this.renderDesktopButtons(),render:this.renderDesktopButtons,placementToOrigin:k.ZP.Placement.Center,alignmentToOrigin:k.ZP.Alignment.Center,open:v.default.isMiniOrCenterPeekOpen(),disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:k.ZP.PopupType.Popup})}renderBackButton(){const e=e=>c.Z.chevronLeftRoundedThin({...e,width:"24px",height:"24px"}),t=e=>c.Z.historyBack(e);return n()(C.Z,{renderTooltip:()=>n()("div",{style:{display:"flex"}},void 0,n()(d.FormattedMessage,{id:"topbarBrowserHistoryButtons.goBackButton.label",defaultMessage:"Go back"}),n()(w.Z,{name:"goBack",style:{opacity:.5,marginLeft:4}})),placement:C.Z.Placement.Bottom,alignment:C.Z.Alignment.Center,originGap:6,render:o=>s.createElement(b.Z,a()({icon:f.Z.state.isTabsFeatureEnabled?e:t,isDarkIconColor:!0,className:"notion-history-back-button",disabled:!h.NW(this.environment),style:{position:"relative",...(0,g.X)(this.environment.device.isElectronMac,!1)},onClick:this.handleBackClick},o))})}renderForwardButton(){const e=e=>c.Z.chevronRightRoundedThin({...e,width:"24px",height:"24px"}),t=e=>c.Z.historyForward(e);return n()(C.Z,{renderTooltip:()=>n()("div",{style:{display:"flex"}},void 0,n()(d.FormattedMessage,{id:"topbarBrowserHistoryButton.goForwardButton.label",defaultMessage:"Go forward"}),n()(w.Z,{name:"goForward",style:{opacity:.5,marginLeft:4}})),placement:C.Z.Placement.Bottom,alignment:C.Z.Alignment.Center,originGap:6,render:o=>s.createElement(b.Z,a()({icon:f.Z.state.isTabsFeatureEnabled?e:t,isDarkIconColor:!0,className:"notion-history-forward-button",disabled:!h.vy(this.environment),style:{position:"relative",...(0,g.X)(this.environment.device.isElectronMac,!1)},onClick:this.handleForwardClick},o))})}renderNewTabButton(){return f.Z.state.isTabsFeatureEnabled?n()(C.Z,{renderTooltip:()=>n()("div",{style:{display:"flex"}},void 0,n()(d.FormattedMessage,{id:"topbarBrowserHistoryButton.newTabButton.label",defaultMessage:"New tab",description:"Button in the desktop app to create a new tab for a Notion page"}),n()(w.Z,{name:"newTab",style:{opacity:.5,marginLeft:4}})),placement:C.Z.Placement.Bottom,alignment:C.Z.Alignment.Center,originGap:6,render:e=>s.createElement(b.Z,a()({icon:e=>c.Z.plusRounded({...e,width:"24px",height:"24px"}),isDarkIconColor:!0,className:"notion-new-tab-button",style:{position:"relative",...(0,g.X)(this.environment.device.isElectronMac,!1)},onClick:this.handeNewTabClick},e))}):null}renderMobile(){const{supportsNativeHomeTabPhone:e}=this.props;if(e||this.environment.device.isTablet)return n()(S.Z,{capture:!0,render:t=>s.createElement("div",a()({style:{display:"flex",flexShrink:0,height:"100%",paddingLeft:4,paddingRight:e?0:4}},t),this.renderMobileBackButton(),!e&&this.renderMobileForwardButton())})}renderMobileBackButton(){const{RouterStore:e}=this.environment,{supportsNativeHomeTabPhone:t}=this.props,o=!t&&!e.canGoBack();return n()(y.Z,{onClick:this.handleBackClick,className:"notion-history-back-button",disabled:o,disabledFeedback:!0,mobileFeedback:!0,style:_.mobileButtonStyle},void 0,t?c.Z.chevronLeftRounded():c.Z.historyBack({width:16,height:16}))}renderMobileForwardButton(){const e=!h.vy(this.environment);return n()(y.Z,{onClick:this.handleForwardClick,className:"notion-history-forward-button",disabled:e,mobileFeedback:!0,disabledFeedback:!0,style:_.mobileButtonStyle},void 0,c.Z.historyForward({width:16,height:16}))}}_.displayName="TopbarBrowserButtons",_.mobileButtonStyle={position:"relative",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",width:32};const M=_},79075:(e,t,o)=>{o.d(t,{Z:()=>M});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(8848),d=o(3779),p=o(5366),u=o(17503),m=o(74647),g=o(43250),h=o(78089),f=o(34700),v=o(33929),y=o(45094),b=o(88923),S=o(7011),w=o(73063),k=o(58032);const C=(0,p.defineMessages)({updates:{id:"topbar.commentsButton.title",defaultMessage:"Comments"}});class _ extends l.Z{constructor(){super(...arguments),this.hasUnreadCommentsStore=this.createComputedStore((()=>(0,h.DF)({blockStore:this.props.blockStore,ignoreAfterTime:Date.now()}).some((e=>!e.getResolved()&&(0,h.NI)(e).some((t=>u.t({discussionStore:e,commentStore:t})))))),!1),this.handleClickSidebar=()=>{m.handleSidebarButtonClick(this.environment,this.props.blockStore,S.gY.Comments,"topbar")}}renderComponent(){const e=v.default.getIntl(),t=y.vK(this.environment)?a()("div",{style:{textAlign:"center"}},void 0,a()(p.FormattedMessage,{defaultMessage:"Close all comments",id:"topbar.commentsButton.closeSidebartTooltip"})):a()("div",{style:{textAlign:"center"}},void 0,a()(p.FormattedMessage,{defaultMessage:"View all comments",id:"topbar.commentsButton.openSidebartTooltip"}));return a()(k.Z,{placement:k.Z.Placement.Bottom,renderTooltip:()=>t,render:t=>a()("div",{style:{...(0,f.X)(this.environment.device.isElectronMac,!1),position:"relative"}},void 0,s.createElement(w.Z,n()({},t,{icon:d.Z.topbarCommentFilled,iconStyle:{height:20,width:20,fill:this.theme.regularIconColor},onClick:this.handleClickSidebar,style:{width:33,height:28,marginRight:2},ariaLabel:e.formatMessage(C.updates),hovered:y.vK(this.environment)&&!b.default.state.open,className:g.p0b})),this.hasUnreadCommentsStore.state&&a()("div",{style:{position:"absolute",top:1.8,right:5.5,height:11,width:11,border:`2px solid ${this.theme.whiteButtonBackground}`,borderRadius:12,background:c.ZP.red,pointerEvents:"none"}}))},void 0,t)}}_.displayName="TopbarCommentsButton";const M=_},55725:(e,t,o)=>{o.d(t,{Z:()=>V});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(480),u=o(24405),m=o(3779),g=o(32056),h=o(5366),f=o(50906),v=o(47307),y=o(53323),b=o(34700),S=o(45023),w=o(60709),k=o(15517),C=o(88632),_=o(99757);function M(e){const[t,o]=(0,c.useState)(Date.now());return(0,c.useEffect)((()=>{const t=setInterval((()=>{o(Date.now())}),e);return()=>clearInterval(t)}),[e]),t}var T=o(8848),I=o(16402);function P(e){const t=M(500);if(e.device.isMobile||void 0===e.error.approximateBackoffDelayEndTime)return a()(h.FormattedMessage,{defaultMessage:"Something's not right.",id:"connectionErrorIndicator.label.shortMessage",description:"Message displayed when we're having trouble syncing the user's changes with the server."});const o=Math.floor((e.error.approximateBackoffDelayEndTime-t)/1e3);return a()(h.FormattedMessage,o>0?{defaultMessage:"Something's not right. Retrying in {numberOfSeconds}s…",values:{numberOfSeconds:o},id:"connectionErrorIndicator.label.retryingInSeconds",description:"Message displayed when we're having trouble syncing the user's changes with the server, and will retry in a known number of seconds."}:{defaultMessage:"Something's not right. Retrying…",id:"connectionErrorIndicator.label.retrying",description:"Message displayed when we're having trouble syncing the user's changes with the server, and are in the process of retrying."})}function x(e){M(1e4);const{startTime:t}=e,o=(0,I.IS)(t),i=(0,p.O7)();return(0,c.useEffect)((()=>{f.trackConnectionErrorDetailsShow(i,{errorSinceMs:Date.now()-t})}),[i,t]),c.createElement(c.Fragment,null,a()(h.FormattedMessage,{defaultMessage:"{sinceSomeTimeAgo}, an error occurred saving your changes. We'll try again soon.",values:{sinceSomeTimeAgo:o},id:"connectionErrorIndicator.details.message",description:"Details about our troubles syncing the user's changes with the server. 'sinceSomeTimeAgo' is a localized string like '3 hours ago' or 'Just now'."}),e.retryReason?a()("div",{style:{marginTop:8,fontSize:12,color:T.ZP.whiteWithAlpha(.7),fontStyle:"italic"}},void 0,a()(h.FormattedMessage,{defaultMessage:"Debug info: {debugInfo}",values:{debugInfo:e.retryReason},id:"connectionErrorIndicator.details.debugInfo",description:"Debug information about our troubles syncing the user's changes with the server. debugInfo can be a variety of codes such as 'txLoopException', 'notionUnavailable', or 'http403', etc."})):void 0)}var B=o(31945),Z=o(68785),E=o(78140),R=o(89728),A=o(58032);const D=e=>(window.__c={n:"EditsDisabledMessage"},a()(h.FormattedMessage,{defaultMessage:"You can no longer make edits: {errorMessage} {usageInfoMessage}",id:"connectionState.errorIndicator.cannotMakeEdits.detailedMessage",values:{errorMessage:e.errorMessage,usageInfoMessage:e.usageInfoMessage}})),F=e=>{const t=(0,u.Fg)(),o=(0,p.O7)(),i=m.Z.collectionDescriptionSmall({marginLeft:6,width:14,height:14,fill:e.errorStateStyle.color}),r="transactionQueue"===e.type?e.message:void 0,s="lowStorage"===e.type?e.estimate:void 0;return(0,c.useEffect)((()=>{"transactionQueue"===e.type?f.trackTransactionQueueErrorShow(o,{message:r}):"connection"===e.type?f.trackConnectionErrorShow(o):"lowStorage"===e.type&&f.trackLowStorageErrorShow(o,{estimate:s})}),[e.type,r,s,o]),(0,c.useEffect)((()=>{r&&v.showThrottledErrorMessage(a()(D,{errorMessage:r}))}),[r]),o.device.isMobile?a()(B.Z,{popupType:B.Z.PopupType.SlideUp,renderOrigin:t=>c.createElement(R.Z,n()({style:e.errorStateStyle},t),e.indicatorText||i),render:o=>{let{close:i}=o;return a()(E.Z,{menuType:w.og.ActionSheet},void 0,a()("div",{style:{padding:15,background:t.errorText,color:"white"},onClick:i},void 0,e.detailsText))}}):a()(A.Z,{renderTooltip:()=>a()("div",{style:{width:320,whiteSpace:"normal"}},void 0,e.detailsText),render:t=>c.createElement("div",n()({style:e.errorStateStyle},t),e.indicatorText,i)})};class L extends d.Z{constructor(){super(...arguments),this.fakeSync=!1,this.realSync=!1,this.handleKeyDown=e=>{if((0,S.Z)(this.environment,e,"command+s")){e.preventDefault();!C.Z.state.online||this.fakeSync||_.n.state||(this.fakeSync=!0,this.enqueueForceUpdate(),setTimeout((()=>{this.fakeSync=!1,this.enqueueForceUpdate()}),500))}},this.handleStartSync=()=>{C.Z.state.syncing&&!this.realSync&&(this.realSync=!0,this.enqueueForceUpdate())},this.handleStartSyncDebounced=l().debounce(this.handleStartSync,8e3),this.handleStopSync=()=>{this.realSync&&!C.Z.state.syncing&&(this.realSync=!1,this.enqueueForceUpdate())},this.handleStopSyncDebounced=l().debounce(this.handleStopSync,200),this.isOnline=this.createComputedStore((()=>C.Z.state.online)),this.shouldShowLoadingSpinner=()=>(this.fakeSync||this.realSync)&&!_.n.state&&!(0,y.n)()}willMount(){this.listenForSave(),C.Z.addListener(this.handleStartSyncDebounced),C.Z.addListener(this.handleStopSyncDebounced)}willUnmount(){this.unlistenForSave(),C.Z.removeListener(this.handleStartSyncDebounced),C.Z.removeListener(this.handleStopSyncDebounced)}renderComponent(){const{device:e}=this.environment;return a()(c.Fragment,{},void 0,!e.isMobile&&this.renderDesktopIndicators(),e.isMobile&&this.renderMobileLoadingSpinner(),this.renderErrors())}renderDesktopIndicators(){const{intl:e}=this.props;return this.isOnline.state?this.shouldShowLoadingSpinner()?a()(A.Z,{renderTooltip:()=>a()(h.FormattedMessage,{defaultMessage:"{percent} complete.",id:"connectionState.savePercentangeIndicator.tooltip",values:{percent:_.Z.percentComplete(e)}}),render:e=>c.createElement("div",n()({style:this.getLoadingStateStyle()},e),a()(Z.Z,{style:{margin:4,marginRight:8}}),a()(h.FormattedMessage,{defaultMessage:"Saving…",id:"connectionState.saving.message"}))}):void 0:a()(A.Z,{renderTooltip:()=>a()("div",{style:{width:200}},void 0,a()(h.FormattedMessage,{defaultMessage:"{numberOfEdits, plural, one {You have {numberOfEdits} edit that will be synced next time you are online.} other {You have {numberOfEdits} edits that will be synced next time you are online.}}",id:"connectionState.offlineBadge.tooltip",values:{numberOfEdits:_.Z.state.totalPending}})),textWrap:!0,render:e=>c.createElement("div",n()({style:this.getOfflineBadgeStyle()},e),a()(h.FormattedMessage,{defaultMessage:"Offline",id:"connectionState.offlineBadge.label"}))})}renderMobileLoadingSpinner(){var e;const t=this.shouldShowLoadingSpinner(),o=null===(e=this.environment.mobileNative)||void 0===e?void 0:e.supportsNativeHomeOnPhone();return a()("div",{style:{display:"flex",alignItems:"center",height:"100%",marginLeft:"auto",paddingLeft:!o||t?4:0,paddingRight:!o||t?8:0,visibility:t?"visible":"hidden"}},void 0,(!o||t)&&a()(Z.Z,{style:{height:18,width:18}}))}renderErrors(){const{device:e}=this.environment;if(_.Z.state.transactionQueueError){const e=a()(h.FormattedMessage,{defaultMessage:"Cannot save changes",id:"connectionState.errorIndicator.cannotSaveChanges.message"}),t=a()(D,{errorMessage:_.Z.state.transactionQueueError.message,usageInfoMessage:this.renderUsageInfo()});return a()(F,{type:"transactionQueue",message:_.Z.state.transactionQueueError.message,indicatorText:e,detailsText:t,errorStateStyle:this.getErrorStateStyle()})}const t=_.Z.state.storageUsageEstimate;if(void 0!==t&&!(0,k.mn)(t)){const o=e.isBrowser?a()(h.FormattedMessage,{defaultMessage:"Low browser storage",id:"connectionState.errorIndicator.lowStorageOnWebApp.message"}):e.isMobileNative?a()(h.FormattedMessage,{defaultMessage:"Low app storage",id:"connectionState.errorIndicator.lowStorageOnMobileApp.message"}):a()(h.FormattedMessage,{defaultMessage:"Low disk space",id:"connectionState.errorIndicator.lowStorageOnDesktopApp.message"});return a()(F,{type:"lowStorage",estimate:t,indicatorText:o,detailsText:a()(c.Fragment,{},void 0,this.renderUsageInfo()," ",a()(h.FormattedMessage,{id:"connectionState.errorIndicator.possibleLostEdits.detailedMessagePart2",defaultMessage:"You may lose changes made while offline. Try closing and re-opening your app, and contact support if that doesn’t fix the issue."})),errorStateStyle:this.getErrorStateStyle()})}const o=(0,y.L)();if(o)return a()(F,{type:"connection",indicatorText:a()(P,{error:o,device:this.environment.device}),detailsText:c.createElement(x,o),errorStateStyle:this.getErrorStateStyle()})}renderUsageInfo(){const e=_.Z.state.storageUsageEstimate,{intl:t}=this.props;if(e){const o=e.usage/e.quota;return a()(h.FormattedMessage,{defaultMessage:"Notion is using {percentageOfStorageBytesUsed} of its available storage on your device ({usedNumberOfBytes} of {totalNumberOfBytes}).",id:"connectionState.errorIndicator.possibleLostEdits.detailedMessagePart1",values:{usedNumberOfBytes:(0,g.uf)(e.usage,"bytes",t),totalNumberOfBytes:(0,g.uf)(e.quota,"bytes",t),percentageOfStorageBytesUsed:t.formatNumber(o,{style:"percent",maximumFractionDigits:2})}})}}listenForSave(){window.addEventListener("keydown",this.handleKeyDown)}unlistenForSave(){window.removeEventListener("keydown",this.handleKeyDown)}getTextStyle(){const{device:e}=this.environment,t=e.isMobile;return{display:"flex",alignItems:"center",marginRight:t?0:18,fontSize:t?12:14}}getOfflineBadgeStyle(){const{device:e}=this.environment,t=e.isMobile;return{...(0,b.X)(this.environment.device.isElectronMac,!1),display:"flex",alignItems:"center",padding:"0px 6px",height:t?20:24,borderRadius:3,marginRight:t?4:18,whiteSpace:"nowrap",fontSize:t?12:14,color:this.theme.mediumTextColor,border:`1px solid ${this.theme.darkDividerColor}`}}getLoadingStateStyle(){return{...(0,b.X)(this.environment.device.isElectronMac,!1),...this.getTextStyle(),color:this.theme.lightTextColor}}getErrorStateStyle(){return{...(0,b.X)(this.environment.device.isElectronMac,!1),...this.getTextStyle(),whiteSpace:"nowrap",color:this.theme.errorText}}}L.displayName="TopbarConnectionIndicator";const V=(0,h.injectIntl)(L)},96677:(e,t,o)=>{o.d(t,{Z:()=>_});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(5366),p=o(50906),u=o(24677),m=o(74647),g=o(30149),h=o(43250),f=o(34700),v=o(92783),y=o(33929),b=o(73063),S=o(58261),w=o(58032);const k=(0,d.defineMessages)({isBookmarkedMessage:{defaultMessage:"Favorited",id:"topbar.favoriteButton.activeTitle",description:"Favorite button title when it's active"},isNotBookmarkedMessage:{defaultMessage:"Favorite",id:"topbar.favoriteButton.title",description:"Favorite button title when it's NOT active"},isBookmarkedTooltip:{defaultMessage:"Hide this page from your sidebar",id:"topbar.favoriteButton.activeTooltip1",description:"Favorite button tooltip (when it's active), part 1"},isNotBookmarkedTooltip:{defaultMessage:"Pin this page in your sidebar",id:"topbar.favoriteButton.tooltip1",description:"Favorite button tooltip (when it's NOT active), part 1"}});class C extends l.Z{constructor(){super(...arguments),this.renderTooltipMessage=e=>a()("div",{style:{textAlign:"center"}},void 0,a()("div",{},void 0,s.createElement(d.FormattedMessage,e?k.isBookmarkedTooltip:k.isNotBookmarkedTooltip)),a()(S.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleFavorite"})),this.handleBookmarkClick=()=>{const{spaceViewStore:e}=this.props;e&&(u.ZH(this.environment),p.trackBookmark(this.environment,{from:"topbar"}),g.createAndCommit({userAction:"TopbarFavoriteButton.handleBookmarkClick",environment:this.environment,perform:t=>{m.bookmarkPage({spaceViewStore:e,store:this.props.store,transaction:t})}}))},this.handleUnbookmarkClick=()=>{const{spaceViewStore:e}=this.props;e&&(u.ZH(this.environment),p.trackUnbookmark(this.environment,{from:"topbar"}),g.createAndCommit({userAction:"TopbarFavoriteButton.handleUnbookmarkClick",environment:this.environment,perform:t=>{m.unbookmarkPage({spaceViewStore:e,store:this.props.store,transaction:t})}}))}}renderComponent(){const e=y.default.getIntl(),{spaceViewStore:t}=this.props,o=!!t&&(0,v.Z)({spaceViewStore:t,pageId:this.props.store.id}),i=o?c.Z.topbarStarFilled:c.Z.topbarStar,r=o?this.handleUnbookmarkClick:this.handleBookmarkClick;return a()(w.Z,{placement:w.Z.Placement.Bottom,renderTooltip:()=>this.renderTooltipMessage(o),render:t=>s.createElement(b.Z,n()({},t,{className:h.GbT,icon:i,style:{...(0,f.X)(this.environment.device.isElectronMac,!1),width:33,height:28,marginRight:2},iconStyle:{height:20,width:20,fill:o?this.theme.topbarFavorite:this.theme.regularIconColor},onClick:r,ariaLabel:e.formatMessage(o?k.isBookmarkedMessage:k.isNotBookmarkedMessage)}))})}}C.displayName="TopbarFavoriteButton";const _=C},43803:(e,t,o)=>{o.d(t,{Z:()=>U});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(62518),c=o(83355),d=o(3779),p=o(5366),u=o(95182),m=o(50906),g=o(24677),h=o(43250),f=o(34700),v=o(60709),y=o(98742),b=o(33665),S=o(35328),w=o(79315),k=o(21884),C=o(48494),_=o(48019),M=o(64921),T=o(31945),I=o(78140),P=o(28992),x=o(40721),B=o(72495),Z=o(58032),E=o(81415),R=o(83182),A=o(939),D=o.n(A),F=o(49427);class L extends c.Z{constructor(){super(...arguments),this.wordCount=0}willMount(){this.wordCount=this.getWordCount()}renderComponent(){return a()(s.Fragment,{},void 0,this.wordCount)}getWordCount(){const e=F.Z.find((e=>e.props.store===this.props.store));if(e){const t=e.getContentWrapEl();if(t)return D()(t.innerText)}return 0}}L.displayName="PageWordCount";const V=L;var N=o(71424);class O extends c.Z{constructor(){super(...arguments),this.originEl=null,this.onClickOriginRect=void 0,this.renderOrigin=e=>{const{device:t}=this.environment;return a()(Z.Z,{renderTooltip:()=>this.environment.currentUser.isLoggedIn()?a()(p.FormattedMessage,{defaultMessage:"Style, export, and more…",id:"topbarMoreButton.tooltip"}):a()(p.FormattedMessage,{defaultMessage:"More…",id:"topbarMoreButton.loggedOut.tooltip"}),placement:Z.Z.Placement.Bottom,delayThreshold:400,render:o=>s.createElement(M.Z,n()({ref:this.handleButtonMount,style:this.getButtonStyle(),mobileFeedback:t.isMobile,className:h.mSZ},(0,y.Z)(e,o)),t.isMobile?d.Z.mobileTopbarMore({width:26}):d.Z.dots({width:18,height:18,fill:this.theme.regularIconColor}))})},this.renderPopup=e=>{const{device:t}=this.environment,{store:o}=this.props,i={environment:this.environment,blocks:[o],originRect:this.onClickOriginRect,publicEditMode:void 0},n=!o.isCollectionView()&&o.canEdit(),r=n&&(o.hasContent()?a()(P.Z,{caption:a()("span",{style:{color:this.theme.lightTextColor}},void 0,a()(p.FormattedMessage,{id:"pageMoreButton.wordCount.caption",defaultMessage:"Word count: {count}",values:{count:a()(V,{store:o})}}))}):void 0);let l;return l=t.isMobile?{menuType:v.og.Modal,title:a()(p.FormattedMessage,{defaultMessage:"Actions",id:"topbarMoreButton.mobileActionsMenu.title"}),right:a()(x.DoneMenuText,{}),onClickRight:this.handleDismiss}:{menuType:v.og.Popup,width:240,maxHeight:"80vh"},s.createElement(I.Z,l,a()(_.Z,{sections:(0,u.dB)(i),onAccept:this.handleAccept,context:i}),a()(B.Z,{topBorder:!0},void 0,n&&r,o.canEdit()&&this.renderBlockAuthorInfo()),o.canEdit()&&o.isCollectionView()&&this.renderCollectionHelpButton())},this.handleButtonMount=e=>{e&&(this.originEl=l.findDOMNode(e))},this.handleClick=()=>{k.E.setState({showConvertTooltip:!1,forceShow:!1}),g.ZH(this.environment),this.originEl&&(this.onClickOriginRect=this.originEl.getBoundingClientRect()),m.trackOpenMoreMenu(this.environment)},this.handleDismiss=()=>{this.props.buttonPopupStore.setState({...this.props.buttonPopupStore.state,open:!1})},this.handleAccept=e=>{const{mainEditorCurrentBlockStore:t}=w.default.state;if(t){const o=t.getType();o&&m.trackBlockAction(this.environment,{analyticsName:e.analyticsName,from:"topbar_more_menu",block_id:t.id,block_type:o,is_toggleable:(0,S._A)(o,t.getFormat())})}e.closeParentMenu&&this.handleDismiss()}}renderComponent(){const{device:e}=this.environment,{currentSpaceStore:t}=w.default.state;return s.createElement(s.Fragment,null,a()(E.U,{origin:k.E.state.showConvertTooltip?()=>this.originEl:void 0,placementToOrigin:"bottom",header:"Upgrade your existing wikis",content:"Look for the Turn into wiki action here",onCloseClick:()=>{k.E.setState({showConvertTooltip:!1,forceShow:!1})},pointerPosition:"98%",pointerLength:24,pointerOffset:-3,style:{width:N.G5}}),a()(T.Z,{popupType:e.isMobile?T.Z.PopupType.SlideUp:T.Z.PopupType.Popup,buttonPopupStore:this.props.buttonPopupStore,renderOrigin:this.renderOrigin,onClick:this.handleClick,render:()=>this.renderPopup(t),originGap:8,trapFocus:!0}))}renderBlockAuthorInfo(){const{store:e}=this.props;return a()(C.Z,{store:e,isPageMoreButton:!0})}renderCollectionHelpButton(){return a()(B.Z,{topBorder:!0},void 0,a()(R.Z,{title:a()(p.FormattedMessage,{defaultMessage:"Learn about databases",id:"topbar.moreButton.collectionHelpButton"}),href:(0,b.UY)("guides.database"),analyticsFrom:"topbar_more_button"}))}getButtonStyle(){const{device:e}=this.environment;return e.isMobile?{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",paddingLeft:8,paddingRight:8,marginRight:2}:{...(0,f.X)(this.environment.device.isElectronMac,!1),display:"flex",alignItems:"center",justifyContent:"center",width:32,height:28,borderRadius:3}}}O.displayName="TopbarMoreButton";const U=O},64536:(e,t,o)=>{o.r(t),o.d(t,{pageAnalyticsMenu:()=>I,TopbarPageAnalyticsOptOutMenuStore:()=>P,TopbarPageAnalyticsOptOutMenu:()=>x,PageAnalyticsPageOptOut:()=>B});var i=o(77094),n=o.n(i),r=o(67294),a=o(480),s=o(81954),l=o(3779),c=o(5366),d=o(62967),p=o(74647),u=o(97627),m=o(33665),g=o(79315),h=o(10161),f=o(7011),v=o(12318),y=o(73420),b=o(44532),S=o(72495),w=o(42402),k=o(55422),C=o(69525);const _=(0,c.defineMessages)({pageAnalyticsName:{id:"action.pageAnalytics.name",defaultMessage:"Page analytics",description:"Menu for page analytics actions"},viewAnalyticsName:{id:"action.viewAnalytics.name",defaultMessage:"View analytics",description:"Button to view page analytics"},privacySettingsName:{id:"action.privacySettings.name",defaultMessage:"Privacy settings",description:"Button to view privacy settings"}}),M=e=>{const t=e.blocks[0];if(!t)return!1;return(0,C.W2)({canEditPage:t.canEdit(),device:e.environment.device})&&(h.default.checkGate("page_analytics")||h.default.checkGate("page_analytics_individual"))},T=e=>M(e)||h.default.checkGate("page_analytics_prerelease_opt_outs"),I=(0,d.MV)({key:"page analytics menu",displayName:_.pageAnalyticsName,analyticsName:_.pageAnalyticsName.defaultMessage,validators:[T],svg:l.Z.analyticsSearch,subActions:e=>[{key:"view analytics",render:e=>r.createElement(S.Z,e),actions:[(0,d.PH)({key:"view analytics",displayName:_.viewAnalyticsName,analyticsName:_.viewAnalyticsName.defaultMessage,svg:l.Z.analyticsSearch,validators:[M],closeParentMenu:!0,action:()=>{p.handleSidebarButtonClick(e.environment,e.blocks[0],f.gY.Updates,"more_menu"),f.ZP.setState({...f.ZP.state,currentSubTab:f.uF.Analytics})}}),(0,d.PH)({key:"privacy settings",displayName:_.privacySettingsName,analyticsName:_.privacySettingsName.defaultMessage,svg:l.Z.settings,validators:[T],closeParentMenu:!0,action:e=>{P.setState({isOpen:!0,rect:e.originRect})}})]}]}),P=new v.default({isOpen:!1,rect:void 0}),x=()=>{window.__c={n:"TopbarPageAnalyticsOptOutMenu"};const e=(0,a.O7)(),t=(0,s.VK)((()=>P.state.isOpen),[]),o=(0,s.VK)((()=>P.state.rect),[]),i=(0,s.VK)((()=>g.default.state.mainEditorCurrentBlockStore),[]);return i?n()(b.ZP,{popupType:e.device.isMobile?b.ZP.PopupType.SlideUp:b.ZP.PopupType.Popup,alignmentToOrigin:b.ZP.Alignment.Center,open:t,render:()=>n()("div",{style:{minWidth:360,padding:16}},void 0,n()(y.sg,{gap:16},void 0,n()("div",{style:{fontSize:16,fontWeight:500}},void 0,n()(c.FormattedMessage,{id:"TopbarPageAnalyticsOptOutMenu.heading",defaultMessage:"Privacy settings",description:"Heading for the privacy settings menu"})),n()(B,{store:i}))),originRect:o,onDismiss:()=>P.setState({isOpen:!1,rect:void 0})}):null};function B(e){window.__c={n:"PageAnalyticsPageOptOut"};const t=(0,a.O7)(),o=(0,s.VK)((()=>{const e=g.default.state.currentSpaceViewStore;return null==e?void 0:e.getSettings()}),[]),i=(0,s.VK)((()=>{const t=null==o?void 0:o.page_analytics_opt_out_list;return null==t?void 0:t.includes(e.store.id)}),[o,e.store.id]);return n()(k.Z,{type:"dropdown",currentOption:i?"do_not_record":"record",options:[{key:"record",label:n()(c.FormattedMessage,{id:"page_analytics.opt_out.record",defaultMessage:"Record",description:"Option to record page analytics for a page"})},{key:"do_not_record",label:n()(c.FormattedMessage,{id:"page_analytics.opt_out.do_not_record",defaultMessage:"Don't record",description:"Option to opt out of recording for page analytics for a page"})}],onSelectOption:o=>{"do_not_record"===o?u.kY(t,e.store.id):u.pu(t,e.store.id)},isMobile:t.device.isMobile,title:n()(c.FormattedMessage,{id:"page_analytics.opt_out.title",defaultMessage:"My view history",description:"Title for the page analytics page opt out setting"}),caption:n()(c.FormattedMessage,{id:"page_analytics.opt_out.caption",defaultMessage:"Page editors can see my view history for this page. <inlinelink>Learn more</inlinelink>.",description:"Caption for the page analytics page opt out setting",values:{inlinelink:e=>n()(w.Z,{external:!0,href:(0,m.UY)("guides.pageAnalytics")},void 0,e)}}),captionStyle:{maxWidth:270}})}},11819:(e,t,o)=>{o.d(t,{Z:()=>R});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(13991),u=o(61784),m=o(19889),g=o(7928),h=o(5366),f=o(61045),v=o(34700),y=o(33929),b=o(20095),S=o(3815),w=o(64921),k=o(58032),C=o(64369),_=o(29302),M=o(45653),T=o(44615),I=o(25320),P=o(2688),x=o(39218);class B extends d.Z{constructor(){super(...arguments),this.messageStoreListenerReference=void 0}willMount(){this.startMessageStoreListener()}willUnmount(){this.stopMessageStoreListener()}didUpdate(){this.stopMessageStoreListener(),this.startMessageStoreListener()}async startMessageStoreListener(){const{block:e}=this.props;if(await x.transactionQueue.awaitRecordTransaction(e.pointer),!this.componentIsMounted)return;const t=(0,T.pb)(e.id);this.messageStoreListenerReference=P.Z.addListener(t,l().throttle((()=>I.R(this.environment,{block:this.props.block,pageVisitStore:this.props.pageVisitStore,incremental:!0,limit:this.props.limit})),1e3),void 0,this.environment)}stopMessageStoreListener(){this.messageStoreListenerReference&&(P.Z.removeListener(this.messageStoreListenerReference,this.environment),this.messageStoreListenerReference=void 0)}}B.displayName="PageVisitListener";const Z=B;class E extends d.Z{constructor(){super(...arguments),this.renderAvatar=e=>{const{userId:t}=e,o=(0,b.MR)(this.environment,e),i=this.createUserStore(t);if(i.isDefined())return a()(k.Z,{textWrap:!0,renderTooltip:()=>this.renderAvatarTooltip(e,o),render:t=>{const r=a()(M.Z,{userStore:i,style:this.getUserAvatarStyle(),isOffline:!o,size:E.avatarSize,avatarShouldShowShadow:!0});if(o&&e.blockId){const o=e.blockId;return c.createElement(w.Z,n()({},t,{onClick:()=>f.hl([o],!0),style:E.avatarButtonStyle,hoveredStyle:E.avatarButtonHoveredStyle,pressedStyle:E.avatarButtonPressedStyle}),r)}return c.createElement("div",t,r)}},t)},this.renderHiddenUsersTooltipItem=(e,t)=>{const o=(0,b.MR)(this.environment,e),i=this.createUserStore(e.userId);if(!i.isDefined)return;let n;!o&&e.activityTimestampNearestMinuteMs&&(n=(0,u.tv)(e.activityTimestampNearestMinuteMs,p.SP));const r=a()("div",{style:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4}},void 0,a()(_.Z,{userStore:i,avatarSize:18,style:{flexGrow:1}}),a()("div",{style:{marginLeft:"auto",paddingLeft:12,textAlign:"right",flexShrink:1,color:this.theme.mediumInvertedTextColor}},void 0,n));if(o&&e.blockId){const o=e.blockId;return a()(w.Z,{onClick:()=>f.hl([o],!0),style:{display:"flex",alignItems:"center"}},t,r)}return a()("div",{style:{display:"flex",alignItems:"center"}},t,r)},this.renderStateStore=this.createComputedStore((()=>{const{pageVisitStore:e,presenceStore:t}=this.props,o=(0,b.AQ)(e,t),i=this.environment.currentUser.id;if(!i)return;const n=this.createUserStore(i),r=o.find((e=>e.userId===i));if(!r||!n.isDefined())return;let a=o.filter((e=>e.userId!==i&&(0,b.MR)(this.environment,e)));a=this.orderPresenceData(a).reverse();const s=this.orderPresenceData(l().difference(o,a,[r])).reverse(),c=[...a,...s],d=E.maxUsers-1;return{visibleUsers:c.slice(0,d),hiddenUsers:c.slice(d)}}),!0)}renderComponent(){return c.createElement(c.Fragment,null,this.renderPresence(),a()(Z,{block:this.props.rootStore,pageVisitStore:this.props.pageVisitStore,limit:1+E.maxUsers+E.maxOtherUsers}))}renderPresence(){const e=this.environment.currentUser.id;if(!e)return;const t=this.renderStateStore.state;if(!t)return;const{visibleUsers:o,hiddenUsers:i}=t;if([e,...o.map((e=>e.userId)),...i.map((e=>e.userId))].map((e=>this.createUserStore(e))).every((e=>e.isReady()))&&(o.length>0||i.length>0)){const t=[...o];return t.reverse(),a()("div",{style:this.getStyle()},void 0,i.length>0&&this.renderHiddenUsers(i),t.map(this.renderAvatar),this.renderAvatar({userId:e,present:!0}))}}renderAvatarTooltip(e,t){const o=this.environment.currentUser.id,i=this.createUserStore(e.userId);if(!i.isDefined())return;let n;t?o!==i.id&&(n=e.blockId?a()(h.FormattedMessage,{defaultMessage:"Viewing now. Click to see where they are.",id:"topbar.presenceIndicator.viewingNowWithLocation.tooltip"}):a()(h.FormattedMessage,{defaultMessage:"Viewing now",id:"topbar.presenceIndicator.viewingNow.tooltip"})):o!==i.id&&e.activityTimestampNearestMinuteMs&&(n=a()(h.FormattedMessage,{defaultMessage:"Last viewed {timeFromNow}",id:"topbar.presenceIndicator.lastViewedTime.tooltip",values:{timeFromNow:(0,u.tv)(Math.min(e.activityTimestampNearestMinuteMs,Date.now()),p.SP)}}));const r=y.default.getIntl();return a()("div",{},void 0,a()("div",{className:"notranslate"},void 0,(0,g.Nz)(r,i.getModel())),a()("div",{style:{fontWeight:400}},void 0,i.getEmail()),n&&a()("div",{style:{color:this.theme.mediumInvertedTextColor,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3}},void 0,n))}renderHiddenUsers(e){return a()(k.Z,{allowHover:!0,originGap:7,renderTooltip:t=>{const o=[],i=[];for(const r of e)(0,b.MR)(this.environment,r)?o.push(r):i.push(r);const n=i.slice(0,E.maxOtherUsers-o.length);return c.createElement("div",t,o.length>0&&a()("div",{style:{marginBottom:4}},void 0,a()(C.Z,{style:this.getTooltipSectionLabelStyle()},void 0,a()(h.FormattedMessage,{defaultMessage:"Viewing now",id:"topbar.presenceIndicator.hiddenUsers.viewingNow.tooltip"})),o.map(this.renderHiddenUsersTooltipItem)),n.length>0&&a()("div",{style:{marginBottom:4}},void 0,a()(C.Z,{style:{...this.getTooltipSectionLabelStyle()}},void 0,a()(h.FormattedMessage,{defaultMessage:"Last viewed by",id:"topbar.presenceIndicator.hiddenUsers.lastViewedBy.tooltip"})),n.map(this.renderHiddenUsersTooltipItem)),i.length>n.length&&a()("div",{style:{marginLeft:2,marginTop:2,color:this.theme.mediumInvertedTextColor}},void 0,a()(h.FormattedMessage,{defaultMessage:"{notViewingMoreUsersCount} more…",id:"topbarPresence.presenceIndicator.hiddenUsers.moreUsersNotViewing.tooltip",values:{notViewingMoreUsersCount:i.length-n.length}})))},render:t=>c.createElement("div",n()({style:{color:this.theme.mediumTextColor,fontSize:14,marginLeft:2*E.avatarOverlap,marginRight:-E.avatarOverlap,whiteSpace:"nowrap"}},t),a()(h.FormattedMessage,{defaultMessage:"{hiddenUsersCount, plural, one {+{hiddenUsersCount}} other {+{hiddenUsersCount}}}",id:"topbar.presenceIndicator.hiddenUsers.otherCount.message",values:{hiddenUsersCount:e.length}}))})}orderPresenceData(e){return l().sortBy(e,(e=>e.activityTimestampNearestMinuteMs))}createUserStore(e){const{rootStore:t}=this.props;return S.U6.createChildStore(t,{table:m.KJ,id:e})}getStyle(){return{...(0,v.X)(this.environment.device.isElectronMac,!1),display:"flex",alignItems:"center",position:"relative",flexDirection:"row-reverse",marginLeft:4+E.avatarOverlap,marginTop:-2,transform:"translateZ(0)"}}getUserAvatarStyle(){return{width:E.avatarSize,height:E.avatarSize,borderRadius:E.avatarSize,marginRight:-E.avatarOverlap,position:"relative"}}getTooltipSectionLabelStyle(){return{color:this.theme.mediumInvertedTextColor,fontSize:10,textTransform:"uppercase",letterSpacing:"0.015em"}}}E.displayName="TopbarPresence",E.maxOtherUsers=25,E.maxUsers=5,E.avatarSize=23,E.avatarOverlap=5,E.avatarButtonStyle={transition:"all 0.2s ease",transform:"scale(1)"},E.avatarButtonHoveredStyle={transform:"scale(1.15)",background:"none"},E.avatarButtonPressedStyle={transform:"scale(0.9)",background:"none"};const R=E},12253:(e,t,o)=>{o.d(t,{Z:()=>h});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(3779),d=o(5366),p=o(34700),u=o(89728),m=o(58032);class g extends l.Z{renderComponent(){const{device:e}=this.environment;return a()(m.Z,{placement:m.Z.Placement.Bottom,renderTooltip:()=>a()("div",{style:{...(0,p.X)(this.environment.device.isElectronMac,!1),textAlign:"center"}},void 0,a()(d.FormattedMessage,{defaultMessage:"Access restricted from parent page",id:"blockAuthorInfo.restrictedBadge.infoText"}),a()("br",{}),a()("span",{style:{color:this.theme.mediumInvertedTextColor}},void 0,a()(d.FormattedMessage,{defaultMessage:"Click to view access",id:"blockAuthorInfo.restrictedBadge.clickText"}))),render:t=>s.createElement(u.Z,n()({onClick:this.props.onClick,style:{marginRight:e.isMobile?4:2,color:this.theme.lightTextColor,fill:this.theme.lightIconColor}},t),c.Z.eyeHide({width:20,marginRight:4,fill:this.theme.lightIconColor}),a()("div",{style:{color:this.theme.lightTextColor,fontSize:e.isMobile?16:14,lineHeight:e.isAndroid?1.5:1,whiteSpace:"nowrap"}},void 0,a()(d.FormattedMessage,{id:"blockAuthorInfo.restrictedBadge",defaultMessage:"Restricted"})))})}}g.displayName="TopbarRestrictedBadge";const h=g},95796:(e,t,o)=>{o.d(t,{Z:()=>H});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(63143),d=o(5366),p=o(50906),u=o(24677),m=o(48429),g=o(21325),h=o(28040),f=o(37181),v=o(43250),y=o(34700),b=o(98742),S=o(75472),w=o(21115),k=o(77907),C=o(25464),_=o(79315),M=o(10161),T=o(55899),I=o(78291),P=o(8675),x=o(52878),B=o(31945),Z=o(58261),E=o(89728),R=o(44532),A=o(58032),D=o(24405),F=o(8848),L=o(3779),V=o(30016),N=o(73063);function O(e){window.__c={n:"ShareButtonIntroTooltip"};const{visible:t,onDismiss:o}=e,i=(0,D.yK)((e=>({overlayContainer:{position:"relative",width:240,height:140,paddingTop:0,paddingBottom:20,paddingLeft:20,paddingRight:20},container:{fontSize:12,color:F.ZP.white,position:"absolute",top:13,background:F.ZP.blue,borderRadius:6,padding:"8px 12px 12px 12px",width:200,boxShadow:e.largeLightBoxShadow,zIndex:9999},circle:{position:"absolute",top:-12,left:"calc(50% - 2.5px)",background:F.ZP.blue,width:5,height:5,borderRadius:5,boxShadow:`0 0 0 1.5px ${e.contentBackground}`},verticalLine:{position:"absolute",top:-12,left:"calc(50% - 1px)",background:F.ZP.blue,width:2,height:12},textContainer:{width:"90%",fontWeight:500},iconButton:{position:"absolute",top:4,right:4,opacity:.8},iconStyle:{width:12,fill:F.ZP.white}})),[]);return a()("div",{style:i.overlayContainer},void 0,a()(V.Z,{isVisible:t,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:function(){return a()("div",{style:i.container},void 0,a()("div",{style:i.circle}),a()("div",{style:i.verticalLine}),a()("div",{style:i.textContainer},void 0,a()(d.FormattedMessage,{defaultMessage:"You can share your content with your teammates here",id:"shareButtonIntroTooltip.title",description:"Title of intro tooltip describing the share button"})),a()(N.Z,{icon:L.Z.close,style:i.iconButton,iconStyle:i.iconStyle,onClick:()=>o()}))}}))}class U extends l.Z{constructor(){super(...arguments),this.storeTypes={universalMemberInviteStore:x.Z,sudoModeStore:P.Z,inviteTargetsStore:T.ZP},this.showShareButtonTooltip=this.createComputedStore((()=>this.shouldShowShareTooltip())),this.shareButtonStyle=this.createComputedStore((()=>({...(0,y.X)(this.environment.device.isElectronMac,!1),marginRight:2}))),this.renderShareButtonOrigin=e=>a()(A.Z,{renderTooltip:()=>s.createElement(s.Fragment,null,a()("div",{},void 0,a()(d.FormattedMessage,{defaultMessage:"Share or publish to the web",id:"topbar.shareButton.tooltip"})),a()(Z.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"openShareMenu"})),placement:A.Z.Placement.Bottom,delayThreshold:400,render:t=>this.renderShareButton((0,b.Z)(e,t))}),this.renderShareButton=e=>{const t=this.showShareButtonTooltip.state,o=s.createElement(E.Z,n()({className:v.MD7},(0,b.Z)(e,{onClick:t?()=>f.Qm(this.environment):()=>{}}),{style:this.shareButtonStyle.state}),a()(d.FormattedMessage,{defaultMessage:"Share",id:"topbar.shareButton.title"}));return t?a()(R.ZP,{popupType:R.kQ.Popup,open:!0,origin:o,placementToOrigin:C.u.Bottom,alignmentToOrigin:R.ZP.Alignment.Center,preventScaleTransition:!0,preventOpacityTransition:!0,viewportPadding:4,preventCaptureEsc:!0,preventPointerEvents:!1,disableMouseCapture:!0,render:()=>a()(O,{visible:this.showShareButtonTooltip.state,onDismiss:()=>f.Qm(this.environment)}),style:{boxShadow:"none",backgroundColor:"rgba(0, 0, 0, 0)"}}):o},this.getBlockStoreForPermissionsSettings=()=>this.stores.sudoModeStore.shouldUserHaveAccessToPrivatePageBlock()&&this.stores.sudoModeStore.state.changePermissionsEnabled&&this.stores.sudoModeStore.state.privatePageStore?this.stores.sudoModeStore.state.privatePageStore:this.props.store,this.handleClick=()=>{this.resetStores(),u.ZH(this.environment),p.trackOpenPageShare(this.environment),g.bi(this.environment)},this.handleClose=async()=>{const{device:e}=this.environment;if(e.isMobile)return;if(this.stores.inviteTargetsStore.state.inviteTargets.length>0){await m.zd({environment:this.environment,inviteTargetsStore:this.stores.inviteTargetsStore})&&this.resetStores()}const{permissionsInviteStore:t}=this.stores.universalMemberInviteStore.state;if("invitee"===t.state.inputFocus)return void t.setState({...t.state,inputFocus:"none"});await(0,S.Aw)({environment:this.environment,permissionsInviteStoreState:t.state,from:"share_menu"})||this.resetStores()},this.resetStores=()=>{this.props.buttonPopupStore.reset(),this.stores.universalMemberInviteStore.reset(),this.stores.inviteTargetsStore.reset()},this.hasInviteTargets=()=>{const{universalMemberInviteStore:e,inviteTargetsStore:t}=this.stores,{permissionsInviteStore:o}=e.state;return o.state.inviteTargets.length>0||t.state.inviteTargets.length>0}}didMountOrUpdate(){this.props.store.canAdmin()?this.stores.sudoModeStore.reset():h.i({environment:this.environment,sudoModeStore:this.stores.sudoModeStore,pageBlockId:this.props.store.id})}renderComponent(){const{device:e}=this.environment;return a()(B.Z,{popupType:e.isMobile?B.Z.PopupType.SlideUp:B.Z.PopupType.Popup,forceInitialInbound:!0,buttonPopupStore:this.props.buttonPopupStore,renderOrigin:this.renderShareButtonOrigin,originGap:8,style:{width:500,overflow:"hidden"},onClick:this.handleClick,render:()=>a()(k.LazyShareMenuContainer,{buttonPopupStore:this.props.buttonPopupStore,sudoModeStore:this.stores.sudoModeStore,store:this.getBlockStoreForPermissionsSettings(),onUpgradeButtonClick:()=>{this.props.buttonPopupStore.reset()},location:"topbar_share_button"}),persistOnClose:!e.isMobile&&this.hasInviteTargets(),onClose:this.handleClose})}shouldShowShareTooltip(){const{currentUserSettingsStore:e,mainEditorCurrentBlockStore:t}=_.default.state;if(null!=t&&t.isTypedCollectionViewBlock())return!1;if(!e)return!1;if(e.id!==this.environment.currentUser.id)return!1;const o=e.getKeyStore("settings").getKeyStore("seen_share_button_tooltip_at").getValue();if(Boolean(o))return!1;const i=e.getKeyStore("settings").getKeyStore("signup_time").getValue();if(!i)return!1;const n=Date.now()-i;if(n<=30*c.A0){switch(M.default.getEligibleGroup({experimentId:"intro_share_tooltip_condition",defaultGroup:"control"})){case"b200":const{data:e}=I.default.state;if(e){return(0,w.Lz)(this.environment,e)>=200}return!1;case"d3":return n>=3*c.A0;case"control":return n>=10*c.A0}}return!1}}U.displayName="TopbarShareButton";const H=U},75272:(e,t,o)=>{o.d(t,{Z:()=>_});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(3779),u=o(5366),m=o(74647),g=o(43250),h=o(34700),f=o(12534),v=o(7755),y=o(30016),b=o(73063),S=o(58261),w=o(58032),k=o(39849),C=o(92955);function _(){window.__c={n:"TopbarSidebarButton"};const e=(0,l.O7)(),t=(0,l.Fy)(),o=(0,u.useIntl)(),i=(0,c.VK)((()=>v.TC.state),[]),r=(0,d.yK)((e=>({root:{...(0,h.X)(t.isElectronMac,!1),flexShrink:0,width:48,height:48,margin:-12,padding:12,marginRight:-6},button:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:3},buttonWrapper:{position:"absolute",top:0,left:0,willChange:"opacity"},svg:{width:16,height:16,fill:e.regularIconColor},keyboardShortcut:{color:e.mediumInvertedTextColor}})),[t.isElectronMac]),_=e=>{(0,f.ZP)({event:e,context:f.Af.SidebarMouseMove,callback:()=>{const t=e.currentTarget.getBoundingClientRect();v.Ic.set(t.right),m.open()}})},M=o.formatMessage({defaultMessage:"Lock sidebar open",id:"sidebarExpandButton.tooltip"});return a()("div",{style:r.root,onMouseEnter:_,onMouseMove:_},void 0,a()("div",{style:{position:"relative"}},void 0,a()(y.Z,{isVisible:!0,animationStyle:{opacity:i?0:1},render:()=>a()("div",{style:r.buttonWrapper},void 0,a()("div",{style:r.button},void 0,p.Z.hamburgerMenu(r.svg),a()(C.Z,{type:"allSpaces",color:k.Z.Color.Red,style:{position:"absolute",top:-1,right:-4}})))}),a()(y.Z,{isVisible:!0,animationStyle:{opacity:i?1:0},render:()=>a()("div",{style:r.buttonWrapper},void 0,a()(w.Z,{renderTooltip:()=>a()("div",{},void 0,a()("div",{},void 0,M),a()(S.Z,{style:r.keyboardShortcut,name:"toggleSidebar"})),placement:w.Z.Placement.Right,alignment:w.Z.Alignment.Start,delayThreshold:0,originGap:6,render:t=>s.createElement(b.Z,n()({ariaLabel:M,icon:p.Z.doubleChevronRight,style:{position:"relative"},iconStyle:{width:16,height:16},isDarkIconColor:!0,onClick:()=>m.setExpand({environment:e,isExpanded:!0}),className:g.exn},t))}))})))}},29538:(e,t,o)=>{o.d(t,{V:()=>k,C:()=>C});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(3779),u=o(5366),m=o(74647),g=o(28020),h=o(43250),f=o(34700),v=o(24042),y=o(30016),b=o(73063),S=o(58261),w=o(58032);function k(){window.__c={n:"TopbarSidebarUnexpandButton"};const e=(0,l.O7)(),t=(0,l.Fy)(),o=(0,u.useIntl)(),i=(0,c.VK)((()=>v.Z.state.isShowingTabBar||!1),[]),n=(0,c.VK)((()=>g.tu.state),[]),r=o.formatMessage({defaultMessage:"Close sidebar",id:"sidebarUnexpandButton.closeSidebar.tooltip"});return a()(C,{shouldHide:t.isElectronMac&&n||i,icon:p.Z.doubleChevronLeft,caption:r,onClick:()=>m.setExpand({environment:e,isExpanded:!1}),keyboardShortcutName:"toggleSidebar",isElectron:t.isElectron})}function C(e){window.__c={n:"TopbarUnexpandButton"};const t=(0,l.Fy)(),o=(0,d.yK)((e=>({keyboardShortcut:{color:e.mediumInvertedTextColor}})),[]),i=e.isElectron&&!e.shouldHide?1:0,r=e.shouldHide?0:1;return a()(w.Z,{disableTooltip:e.shouldHide,renderTooltip:()=>a()("div",{},void 0,a()("div",{},void 0,e.caption),a()(S.Z,{style:o.keyboardShortcut,name:e.keyboardShortcutName})),originGap:6,render:o=>a()(y.Z,{isVisible:!0,animationStyle:{opacity:r},enterAnimationStyle:{opacity:i},render:()=>s.createElement(b.Z,n()({ariaLabel:e.caption,disabled:e.shouldHide,icon:e.icon,style:{...(0,f.X)(t.isElectronMac,!1),position:"relative",marginLeft:10,...t.isMobile&&{height:"100%"}},iconStyle:{width:16,height:16},mobileFeedback:t.isMobile,onClick:e.onClick,className:h.Mfh},o))})})}},23727:(e,t,o)=>{o.d(t,{l:()=>R,Z:()=>A});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(480),d=o(81954),p=o(24405),u=o(3779),m=o(5366),g=o(50906),h=o(24677),f=o(74647),v=o(43250),y=o(34700),b=o(60709),S=o(98742),w=o(17652),k=o(45094),C=o(88923),_=o(7011),M=o(24809),T=o(31945),I=o(73063),P=o(78140),x=o(58032),B=o(59168);const Z=(0,m.defineMessages)({updates:{id:"topbar.updatesButton.title",defaultMessage:"Updates"}});class E extends l.Z{constructor(){super(...arguments),this.peekStoreTarget=this.createComputedStore((()=>C.default.state.open&&C.default.state.target)),this.renderOrigin=e=>{const{device:t}=this.environment,o=a()(m.FormattedMessage,{defaultMessage:"View past changes to this page",id:"topbar.updatesButton.tooltip"});if(!t.isMobile)return a()(x.Z,{placement:x.Z.Placement.Bottom,renderTooltip:()=>o,render:t=>s.createElement(R,(0,S.Z)(e,t))})},this.renderPopup=()=>{const{blockStore:e}=this.props,t=this.getActivityLogArgs();if(t)return a()(P.Z,{menuType:b.og.Popup,className:v.KLh,header:a()(B.Z,{navigableBlock:e,enablePageAnalytics:!1,popOutMode:!0,inPeekView:!0})},void 0,s.createElement(M.Z,n()({key:e.id,empty:()=>this.renderEmptyState(),prominentGetNotifiedDropdownExperimentEnabled:(0,w.eK)(),isTopbarUpdatesMenu:!0,source:"updates_sidebar",navigableBlock:e},t)))},this.handleClick=()=>{h.ZH(this.environment),g.trackOpenPageUpdates(this.environment)},this.handleClickSidebar=()=>{f.handleSidebarButtonClick(this.environment,this.props.blockStore,_.gY.Updates,"topbar")}}renderComponent(){const{spaceStore:e,buttonPopupStore:t,blockStore:o}=this.props,{device:i}=this.environment;if(this.peekStoreTarget.state!==o){const e=k.J5(this.environment)?a()("div",{style:{textAlign:"center"}},void 0,a()(m.FormattedMessage,{defaultMessage:"Close all updates",id:"topbar.updatesButton.closeSidebartTooltip"})):a()("div",{style:{textAlign:"center"}},void 0,a()(m.FormattedMessage,{defaultMessage:"View all updates",id:"topbar.updatesButton.openSidebartTooltip"}));return a()(x.Z,{placement:x.Z.Placement.Bottom,renderTooltip:()=>e,render:e=>s.createElement(R,n()({},e,{onClick:this.handleClickSidebar,hovered:k.J5(this.environment)&&!C.default.state.open}))},void 0,e)}return a()(T.Z,{onClick:this.handleClick,disabled:!e,popupType:i.isMobile?T.Z.PopupType.SlideUp:T.Z.PopupType.Popup,buttonPopupStore:t,renderOrigin:this.renderOrigin,originGap:8,render:this.renderPopup,style:{width:440,overflow:"hidden"}})}renderEmptyState(){return a()("div",{style:{marginTop:64,textAlign:"center",paddingLeft:18,paddingRight:18,marginBottom:64}},void 0,a()("div",{style:{fontSize:14,color:this.theme.mediumTextColor,marginTop:4}},void 0,a()("span",{},void 0,a()(m.FormattedMessage,{defaultMessage:"No edits in this page yet.",id:"topbar.updatesButton.emptyState"}))))}getActivityLogArgs(){const{spaceStore:e}=this.props;if(!e)return;const{blockStore:t}=this.props,o=t.id,i=e.id,n=t.getModel();let r;if(null!=n&&n.isCollectionView()){const e=t.getCollectionPointer();e&&(r=e.id)}return{navigableBlockId:o,collectionId:r,spaceId:i}}}function R(e){window.__c={n:"TopbarUpdatesIcon"};const{isElectronMac:t}=(0,c.O7)().device,o=(0,m.useIntl)(),i=(0,p.yK)((e=>({icon:{height:20,width:20,fill:e.regularIconColor},button:{...(0,y.X)(t,!1),width:33,height:28,marginRight:2}})),[t]),r=(0,d.VK)((()=>(0,w.qh)()?u.Z.bell:u.Z.topbarUpdate),[]);return s.createElement(I.Z,n()({icon:r,iconStyle:i.icon,style:i.button,ariaLabel:o.formatMessage(Z.updates),className:v.K3y},e))}E.displayName="TopbarUpdatesButton";const A=E},91791:(e,t,o)=>{o.d(t,{Z:()=>ce});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(45697),l=o.n(s),c=o(67294),d=o(83355),p=o(13991),u=o(41432),m=o(8848),g=o(3779),h=o(26825),f=o(27006),v=o(82990),y=o(51454),b=o(5366),S=o(50906),w=o(43132),k=o(47307),C=o(24677),_=o(64964),M=o(98104),T=o(29373),I=o(30149),P=o(95477),x=o(80365),B=o(84210),Z=o(12534),E=o(87290),R=o(33929),A=o(60709),D=o(39500),F=o(67669),L=o(33665),V=o(61766),N=o(88632),O=o(55367),U=o(80796),H=o(22294),z=o(3815),W=o(69784),j=o(49557),K=o(12318),Y=o(19079),G=o(4350),X=o(86671),q=o(13966),$=o(30016),J=o(64921),Q=o(31945),ee=o(84076),te=o(78140),oe=o(76798),ie=o(72495),ne=o(83182),re=o(17748),ae=o(66094);const se=(0,b.defineMessages)({copySuccessMessage:{defaultMessage:"Copied! Now paste in any page to sync content.",id:"transclusionContainerBlock.actions.copySuccessMessage"}});class le extends X.Z{constructor(){super(...arguments),this.storeTypes={hovered:K.default.of(!1),haloShouldBeVisible:K.default.of(!1),actionBarShouldBeVisible:K.default.of(!1),backlinksIndicatorButtonPopupStore:V.Z},this.renderHaloContent=()=>a()("div",{style:{position:"absolute",left:-6,right:-6,top:-3,bottom:-3,pointerEvents:"none",borderRadius:6,border:`2px solid ${this.theme.transclusionBorderColor}`}}),this.renderActionBarContent=()=>{const e=this.numberOfBacklinks.state,t=N.Z.state.online,o=this.hasDifferingReadPermissionsFromSource.state,{isDesktop:i}=this.environment.device;return a()("div",{style:this.getActionBarStyle()},void 0,t&&a()(Q.Z,{popupType:Q.Z.PopupType.Popup,onClick:this.handleActionBarBacklinksClick,originGap:4,renderOrigin:t=>c.createElement(J.Z,n()({style:this.getActionButtonStyle()},t),a()(b.FormattedMessage,e>0?{defaultMessage:"Editing in {icon} {numberOfBacklinks, plural, one {{numberOfBacklinks} other page} other {{numberOfBacklinks} other pages}}",id:"transclusionContainerBlock.editingMultiple",values:{icon:g.Z.alias({width:14,transform:"rotate(180deg)",marginLeft:4,marginRight:4}),numberOfBacklinks:e}}:{id:"transclusionContainerBlock.editingOriginal",defaultMessage:"Editing original"}),o&&g.Z.warning({width:14,fill:(0,m.fi)("orange",this.theme).fill,marginLeft:6}),g.Z.chevronDown({width:10,fill:this.theme.mediumIconColor,marginLeft:4})),render:this.renderBacklinksMenu}),i&&a()(J.Z,{style:this.getActionButtonStyle(),onClick:this.handleCopyClick},void 0,a()(b.FormattedMessage,{id:"transclusionContainerBlock.copy",defaultMessage:"Copy and sync"})),a()(q.Z,{store:this.getParentStore(),fadeIn:!1,style:{width:30,height:void 0},iconStyle:{marginTop:1,fill:this.theme.regularTextColor}}))},this.renderBacklinksMenu=()=>{const{store:e}=this.props,t={menuType:A.og.Popup,width:400},o=this.hasDifferingReadPermissionsFromSource.state,i=e.getNavigableBlockStore();return c.createElement(te.Z,t,o&&i&&a()(ie.Z,{style:{background:this.theme.sidebarSecondaryBackground}},void 0,a()("div",{style:{display:"flex",fontSize:12,padding:"6px 16px"}},void 0,g.Z.eyeHide({width:16,marginTop:6,marginRight:8,color:this.theme.regularIconColor}),a()("div",{},void 0,a()(b.FormattedMessage,{defaultMessage:"Not everyone can see this. The original page <page>source page title</page> isn't shared with everyone on this page.",id:"transclusionContainerBlock.differingPermissionsWarning",values:{page:()=>a()(ee.Z,{underline:!0,inline:!0,href:(0,B.ZP)({store:i,fullyQualified:!1}),style:{color:this.theme.mediumTextColor}},void 0,a()(oe.Z,{store:i,style:{display:"inline"}}))}})))),a()(ie.Z,{topBorder:o},void 0,a()(Y.Z,{type:"transclusion_container",store:this.props.store,originalTransclusionStore:this.props.store,disableArrow:!0})),this.renderLearnMoreMenuSection())},this.handleCopyClick=()=>{C.Z5({environment:this.environment,stores:[this.getParentStore()]}),w.f4(),S.trackTransclusionContainerCopyButton(this.environment),_.oV({label:R.default.formatMessage(se.copySuccessMessage),helpUrl:(0,L.UY)("guides.transclusions")})},this.handleMouseEnter=()=>{U.Z.state.isDragging||W.Z.state.isActive||this.disableTransclusionUI.state||this.stores.hovered.set(!0)},this.handleMouseLeave=()=>{U.Z.state.isDragging||W.Z.state.isActive||this.disableTransclusionUI.state||this.stores.hovered.set(!1)},this.handleEmptyClick=e=>{(0,Z.ZP)({event:e,context:Z.Af.EditorClick,callback:()=>{(0,D.uG)(e)||I.createAndCommit({userAction:"TransclusionContainerBlock.handleEmptyClick",environment:this.environment,perform:e=>{T.ls({environment:this.environment,store:this.props.store,transaction:e})}})}})},this.handleActionBarBacklinksClick=()=>{C.Z5({environment:this.environment,stores:[this.getParentStore()]}),S.trackTransclusionContainerOpenBacklinks(this.environment,{from:"action_bar"})},this.currentState=this.createComputedStore((()=>{const e=this.getParentStore();return(0,E.B)(e,this.stores.hovered.get())})),this.showActionBar=this.createComputedStore((()=>{const e=this.currentState.state;return!(e!==E.x.Selected&&e!==E.x.SelectedDescendant||j.Z.state.isActive||O.ZP.state.isDragging||W.Z.state.isActive||H.Z.state.isKeyboardMode)})),this.numberOfBacklinks=this.createComputedStore((()=>{const e=(0,x.L)(this.props.store,this.environment);return e.backlinks.length+e.inaccessibleBacklinkCount})),this.disableTransclusionUI=this.createComputedStore((()=>{if(P.Z.isAdminMode)return!1;const{disabled:e}=this.props;if(e)return!0;const t=this.getParentStore();if(!t.canEdit())return!0;const o=t.findRecordStoreUIAncestor((e=>e!==t&&e instanceof z.G&&e.getType()===u.Ti.transclusionContainer));return Boolean(o.ancestor)})),this.hasDifferingReadPermissionsFromSource=this.createComputedStore((()=>{const{store:e,referenceStore:t}=this.props;if(!t||!e.canEdit()||!t.canEdit())return!1;const o=(0,F.YO)(e).map((e=>{let{permissionItem:t}=e;return t})),i=(0,F.YO)(t).map((e=>{let{permissionItem:t}=e;return t})),n=(0,h.L2)(o,i).created.find((e=>!(0,f.FB)(e)));return Boolean(n)}))}handleCreated(){this.stores.hovered.set(!1),C.ZH({device:this.environment.device});const{store:e}=this.props,t=e.getContentStores()[0];t&&t.getType()===u.Ti.text&&(C.eP({environment:this.environment,store:t}),M.N_({store:t.getBlockTitleStore()}))}async canRemoveBlock(){const e=this.numberOfBacklinks.state;if(0===e)return{canRemove:!0,canUndo:!0};const t=await this.confirm({header:a()(b.FormattedMessage,{id:"transclusionContainerBlock.remove.header",defaultMessage:"Delete original?"}),text:a()(b.FormattedMessage,{id:"transclusionContainerBlock.remove.text",defaultMessage:"These blocks are synced in {numberOfBacklinks, plural, one {{numberOfBacklinks} other page} other {{numberOfBacklinks} other pages}}. If you delete the original, the blocks will no longer be synced.",values:{numberOfBacklinks:e}}),acceptLabel:a()(b.FormattedMessage,{id:"transclusionContainerBlock.remove.confirm",defaultMessage:"Delete and unsync copies"})});return{canRemove:t,canUndo:t}}async confirmUnsyncTransclusionReference(){return 0===this.numberOfBacklinks.state||this.confirm({header:a()(b.FormattedMessage,{id:"transclusionContainerBlock.unsyncTransclusionReference.header",defaultMessage:"Unsync this?"}),text:a()(b.FormattedMessage,{id:"transclusionContainerBlock.unsyncTransclusionReference.text",defaultMessage:"The selected blocks will no longer be synced with the original."}),acceptLabel:a()(b.FormattedMessage,{id:"transclusionContainerBlock.unsyncTransclusionReference.confirm",defaultMessage:"Unsync"})})}async confirmUnsyncTransclusionContainer(){const e=this.numberOfBacklinks.state;return 0===e||this.confirm({header:a()(b.FormattedMessage,{id:"transclusionContainerBlock.unsyncTransclusionContainer.header",defaultMessage:"Unsync all?"}),text:a()(b.FormattedMessage,{id:"transclusionContainerBlock.unsyncTransclusionContainer.text",defaultMessage:"{numberOfBacklinks, plural, one {{numberOfBacklinks} other page} other {{numberOfBacklinks} other pages}} will no longer sync with these blocks.",values:{numberOfBacklinks:e}}),acceptLabel:a()(b.FormattedMessage,{id:"transclusionContainerBlock.unsyncTransclusionContainer.confirm",defaultMessage:"Unsync all"})})}renderPersisted(){const{store:e}=this.props,{device:t}=this.environment;if(this.disableTransclusionUI.state)return a()(re.Z,{disabled:this.props.disabled,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,store:this.props.store.getContentStore()});{const o=this.currentState.state,i=o!==E.x.Default||this.stores.haloShouldBeVisible.get()||this.stores.actionBarShouldBeVisible.get(),n=this.showActionBar.state,r=!e.hasContent();return this.hasDifferingReadPermissionsFromSource.state,a()("div",{style:{display:"flex"}},void 0,a()("div",{style:{position:i?"relative":void 0,paddingTop:3,paddingBottom:3,width:"100%"},onMouseLeave:this.handleMouseLeave,onMouseEnter:this.handleMouseEnter,onClick:r?this.handleEmptyClick:void 0},void 0,a()(re.Z,{disabled:!1,store:this.props.store.getContentStore(),emptyPlaceholder:this.renderEmptyEditingPlaceholder(),disableHoverMenu:this.props.disableHoverMenu||o!==E.x.SelectedDescendant,disableDrag:t.isMobile}),a()(G.Z,{store:e},e.id),i&&this.renderHalo(o),i&&this.renderActionBar(n)))}}renderHalo(e){const t=e!==E.x.Default;return a()($.Z,{isVisible:t,enterAnimationStyle:{opacity:0,scale:.995},animationStyle:{opacity:e===E.x.Hovered?.45:1,scale:1},exitAnimationStyle:{opacity:0,scale:.995},springConfig:{opacity:ae.Z.opacitySpringConfig},onAnimationStart:()=>{this.stores.haloShouldBeVisible.set(!0)},onAnimationEnd:()=>{t||this.stores.haloShouldBeVisible.set(!1)},render:this.renderHaloContent})}renderActionBar(e){return a()($.Z,{isVisible:e,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:ae.Z.opacitySpringConfig},onAnimationStart:()=>{this.stores.actionBarShouldBeVisible.set(!0)},onAnimationEnd:()=>{e||this.stores.actionBarShouldBeVisible.set(!1)},render:this.renderActionBarContent})}renderLearnMoreMenuSection(){return a()(ie.Z,{topBorder:!0},void 0,a()(ne.Z,{title:this.renderLearnMoreMessage(),href:(0,L.UY)("guides.transclusions"),analyticsFrom:"transclusion_container_block"}))}renderLearnMoreMessage(){return a()(b.FormattedMessage,{defaultMessage:"Learn more about Synced blocks",id:"transclusionContainerBlock.learnMoreLabel"})}renderEmptyEditingPlaceholder(){return a()("div",{style:{caretColor:this.theme.lightTextColor,color:this.theme.lightTextColor}},void 0,a()(b.FormattedMessage,{defaultMessage:"Click or drag blocks here, then paste in another page to sync content.",id:"transclusionContainerBlock.emptyEditingPlaceholder"}))}getParentStore(){const{store:e,referenceStore:t}=this.props;return t||e}confirm(e){const{header:t,text:o,acceptLabel:i}=e;return new Promise((e=>{k.showDialog({showCancel:!0,keepFocus:!1,message:a()("div",{},void 0,a()("div",{style:{fontWeight:v.Z.fontWeight.semibold}},void 0,t),o),items:[{label:i,color:"red",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})}))}getActionBarStyle(){return{position:"absolute",zIndex:y.t8,top:-40,right:-2,borderRadius:3,height:32,fontSize:14,lineHeight:1.2,display:"flex",whiteSpace:"nowrap",fontFamily:v.Z.getCompositeFontFamily(p.SP).sans,background:this.theme.popoverBackground,boxShadow:this.theme.mediumBoxShadow}}getActionButtonStyle(){return{display:"flex",alignItems:"center",padding:"0 8px",borderRight:`1px solid ${m.ZP.whiteWithAlpha(.2)}`,boxShadow:`1px 0 0 ${this.theme.regularDividerColor}`,marginRight:1}}}le.contextTypes={...d.w,isInColumnList:l().any};const ce=le},70268:(e,t,o)=>{o.d(t,{B:()=>s});var i=o(77094),n=o.n(i),r=(o(67294),o(24405)),a=o(36596);function s(e){window.__c={n:"UpdateSidebarLoadingSkeleton"};let t=Math.floor(e.areaHeight/124);0===t&&(t=1);const o=(0,r.yK)((e=>({skeletonRect:{height:8,borderRadius:3,margin:10,backgroundColor:e.lightDividerColor},skeletonCircle:{display:"flex",width:28,height:28,marginRight:8,backgroundColor:e.lightDividerColor,borderRadius:20},skeletonSection:{display:"flex",width:"100%",margin:20,flexDirection:"row"}})),[8,10,20]),i=[...Array(t)].map((e=>n()("div",{style:o.skeletonSection},void 0,n()(a.Z,{style:o.skeletonCircle}),n()("div",{style:{width:"80%"}},void 0,n()(a.Z,{style:{width:"80%",...o.skeletonRect,marginTop:0}}),n()(a.Z,{style:{width:"50%",...o.skeletonRect}}),n()(a.Z,{style:{width:"60%",...o.skeletonRect}}),n()(a.Z,{style:{width:"50%",...o.skeletonRect}})))));return n()("div",{},void 0,i)}},13018:(e,t,o)=>{o.d(t,{J:()=>oe});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o(67294),c=o(74725),d=o(480),p=o(81954),u=o(24405),m=o(42875),g=o(3779),h=o(61784),f=o(80503),v=o(82990),y=o(5366),b=o(54564),S=o(96514),w=o(43250),k=o(78089),C=o(33929),_=o(65598),M=o(77546),T=o(45094),I=o(34859),P=o(79315),x=o(24229),B=o(29798),Z=o(7011),E=o(9342),R=o(18647),A=o(74647),D=o(52275),F=o(89728),L=o(44532),V=o(72495),N=o(64921);function O(){window.__c={n:"UpdateSidebarTabCommentsSegmentedControl"};const e=(0,p.VK)((()=>Z.ZP.state.commentsMode),[]),t=(0,u.yK)((e=>({container:{background:e.buttonHoveredBackground,width:"calc(100% - 32px)",height:36,borderRadius:10,display:"flex",margin:"10px 16px 6px 16px",marginTop:20,padding:4,gap:2,pointerEvents:"auto"},defaultButton:{borderRadius:8,fontSize:13,fontWeight:v.Z.fontWeight.medium,textAlign:"center",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:1.8,color:e.regularTextColor,letterSpacing:-.08},selectedButton:{fontWeight:v.Z.fontWeight.semibold,background:e.segmentedControlActiveBackground,border:`0.5px solid ${e.outlineButtonBorder}`}})),[]);return a()("div",{style:t.container,className:w.rG8},void 0,a()(N.Z,{style:{...t.defaultButton,...e===Z.F7.Unresolved?t.selectedButton:{}},onClick:()=>{A.setUpdateSidebarCommentsMode(Z.F7.Unresolved)}},void 0,a()("span",{},void 0,a()(y.FormattedMessage,{id:"updateSidebarTabCommentsSegmentedControl.option.open",defaultMessage:"Open"}))),a()(N.Z,{style:{...t.defaultButton,...e===Z.F7.Resolved?t.selectedButton:{}},onClick:()=>{A.setUpdateSidebarCommentsMode(Z.F7.Resolved)}},void 0,a()("span",{},void 0,a()(y.FormattedMessage,{id:"updateSidebarTabCommentsSegmentedControl.option.resolved",defaultMessage:"Resolved"}))))}const U=[Z.F7.Unresolved,Z.F7.Resolved],H={[Z.F7.Unresolved]:w.oc0,[Z.F7.Resolved]:w.Y7r},z=(0,y.defineMessages)({[Z.F7.Unresolved]:{id:"updateSidebar.comments.mode.unresolvedOption",defaultMessage:"Open comments"},[Z.F7.Resolved]:{id:"updateSidebar.comments.mode.resolvedOption",defaultMessage:"Resolved comments"}}),W=(0,y.defineMessages)({[Z.F7.Unresolved]:{id:"updateSidebar.comments.filter.button.unresolvedMode",defaultMessage:"Open"},[Z.F7.Resolved]:{id:"updateSidebar.comments.filter.button.resolvedMode",defaultMessage:"Resolved"}});function j(){return(0,d.O7)().device.isMobile?a()(O,{}):a()(K,{})}function K(){window.__c={n:"DesktopUpdateSidebarCommentsFilterControl"};const[e,t]=(0,l.useState)(!1),{commentsMode:o}=(0,p.Kw)(Z.ZP),i=(0,u.yK)((e=>({commentsHeader:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${e.regularDividerColor}`,alignItems:"center",pointerEvents:"auto"},label:{fontSize:14,color:e.regularTextColor,fontWeight:v.Z.fontWeight.medium,display:"flex",alignItems:"center",padding:"12px 12px 12px 16px"},toggleButton:{justifyContent:"center",display:"flex",color:e.mediumTextColor},toggleButtonContainer:{paddingLeft:12,paddingRight:8,display:"flex"},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),r=(0,l.useCallback)((()=>a()(E.Z,{type:E.i.Vertical,initialFocus:void 0,sections:[{key:"commentFilter",render:e=>l.createElement(V.Z,e),items:U.map((e=>({key:e,render:t=>l.createElement(D.Z,n()({},t,{className:H[e],title:C.default.formatMessage(z[e]),right:a()("div",{style:{width:14,opacity:o===e?1:0}},void 0,g.Z.check())})),action:()=>{A.setUpdateSidebarCommentsMode(e),t(!1)}})))}]})),[o]);return a()("div",{style:i.commentsHeader,className:w.I9j},void 0,a()("div",{style:i.label},void 0,a()(y.FormattedMessage,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})),a()("div",{style:i.toggleButtonContainer,className:w.CBT},void 0,a()(L.ZP,{popupType:L.ZP.PopupType.Popup,open:e,origin:a()(F.Z,{style:i.toggleButton,onClick:()=>{t(!0)}},void 0,C.default.formatMessage(W[o]),g.Z.chevronDown(i.chevronIcon)),placementToOrigin:L.ZP.Placement.Bottom,alignmentToOrigin:L.ZP.Alignment.Center,originGap:4,render:r,onDismiss:()=>{t(!1)}})))}var Y=o(21202),G=o(35973),X=o(3815),q=o(97543),$=o(28992);const J=l.forwardRef(((e,t)=>{const{currentBlockStore:o,discussion:i,showAllRepliesAfterTimestamp:n,focused:r,isLast:s,location:c}=e,m=(0,p.VK)((()=>x.Z.state.open&&x.Z.state.discussionIds||[]),[]),g=(0,d.O7)();(0,l.useEffect)((()=>{var e,t;if(r){G.Z.setState({source:"update_sidebar",discussionIds:[i.id]});const e=setTimeout((()=>{var e,t;(null===(e=G.Z.state)||void 0===e||null===(t=e.discussionIds)||void 0===t?void 0:t[0])===i.id&&S.AM([i.id])}),1500);return()=>{clearTimeout(e)}}(null===(e=G.Z.state)||void 0===e||null===(t=e.discussionIds)||void 0===t?void 0:t[0])===i.id&&G.Z.setState({discussionIds:[]})}),[r,i,g]);const h=(0,p.VK)((()=>{var e;return(null===(e=G.Z.state)||void 0===e?void 0:e.discussionIds)||[]}),[]),f=i.id,{parentId:v,currentSpaceId:y}=(0,p.VK)((()=>({parentId:i.getParentId(),currentSpaceId:i.getSpaceId()})),[i]),b=v?X.G.createChildStore(i,{table:Y.iU,id:v}):void 0,C=m.includes(f),_=h.includes(f),M=(0,u.yK)((e=>({discussionContainer:{paddingTop:g.device.isMobile?4:10,borderBottom:s||g.device.isMobile?void 0:`1px solid ${e.regularDividerColor}`,transition:"background 300ms ease"},replyButton:{color:e.blueColor,marginLeft:23,fontSize:14},hoveredStyle:{background:"sidebar"===c?e.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===c?e.focusDiscussionBackground:void 0}})),[c,s,g]);if(!b||!y)return null;const T=l.createElement("div",{className:`sidebar-discussion-${f} ${w.s$o}`,onClick:e.onClick,onMouseEnter:e.onMouseEnter,ref:t,style:{...M.discussionContainer,...r||_?M.hoveredStyle:{},...C?M.pressedStyle:{}}},a()(q.Z,{store:i,blockStore:o,format:k.O2.Sidebar,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"updates_sidebar",showAllRepliesAfterTimestamp:n}));return a()($.Z,{allowTextSelection:!0,title:T,style:{marginLeft:-14,marginRight:-14,width:"calc(100% + 28px)",lineHeight:void 0,cursor:"pointer"}})}));function Q(e){window.__c={n:"UpdateSidebarDiscussionSection"};const{firstItemId:t}=e,o=(0,p.VK)((()=>{var e;return null===(e=G.Z.state)||void 0===e?void 0:e.discussionIds.some((e=>e===t))}),[t]),i=(0,p.VK)((()=>x.Z.state.open&&x.Z.state.discussionIds&&x.Z.state.discussionIds.some((e=>e===t))),[t]),r=(0,u.yK)((t=>({hoveredStyle:{background:"sidebar"===e.location?t.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===e.location?t.focusDiscussionBackground:void 0},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:v.Z.fontWeight.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[e.location]);return l.createElement(V.Z,n()({desktopTitleStyle:{...r.basicDesktopTitleStyle,...o?r.hoveredStyle:{},...i?r.pressedStyle:{}},mobileTitleStyle:r.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0},e))}var ee=o(70268);const te=new B.Z;function oe(e){window.__c={n:"UpdateSidebarTabComments"};const{timeMounted:t,location:o}=e,i=(0,d.O7)(),[r,B]=(0,l.useState)(!1),A=(0,p.VK)((()=>P.default.state.mainEditorCurrentBlockStore),[]),D=(0,p.VK)((()=>i.currentUser.id),[i]),F=(0,p.VK)((()=>(0,k.DF)({blockStore:A,ignoreAfterTime:t,currentUserId:D})),[A,t,D]),[L]=(0,p.AF)(Z.ZP),V=(0,p.VK)((()=>(0,T._c)(i)),[i]),N=(0,p.VK)((()=>x.Z.state.open&&x.Z.state.discussionIds||[]),[]),{resolved:O,unresolved:U}=(0,p.VK)((()=>(0,_.bB)(F)),[F]),H=L.commentsMode===Z.F7.Unresolved,z=H?U:O,W=z.map((e=>e.id));(0,l.useEffect)((()=>{if("popup"===o&&r)return()=>{S.AM(W)}}),[o,W,r]);const K=(0,u.yK)((e=>({commentsEmptyStyle:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,position:"relative",background:e.contentBackground,marginRight:V?2:0,pointerEvents:"auto",paddingTop:10},commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:V?2:0,pointerEvents:"auto",height:"100%"},commentsIconStyle:{height:54,width:54,marginBottom:12,fill:e.mediumIconColor}})),[V]),Y=(0,l.useRef)(null),G=(0,p.VK)((()=>(0,T.Sx)(i)),[i]);(0,c.O)({active:G,closeHandler:b.LZ,ref:Y});const X=(0,p.VK)((()=>{const e=s.groupBy(z,(e=>{const t=(0,k.Qg)({recordStore:e,currentUserId:D});return t?(0,h.$6)(t.getCreatedTime()):""}));return delete e[""],e}),[z,D]),q=(0,p.VK)((()=>(0,k.W5)(z)),[z]);if((0,l.useEffect)((()=>{r||q||B(!0)}),[r,q]),!A||!X||!r)return a()(ee.B,{areaHeight:window.innerHeight});if(0===z.length)return a()("div",{style:K.commentsContentStyle},void 0,a()(j,{}),a()("div",{style:K.commentsEmptyStyle},void 0,g.Z.commentSidebarZero(K.commentsIconStyle),a()("div",{style:{fontWeight:v.Z.fontWeight.semibold,marginBottom:4}},void 0,a()(y.FormattedMessage,H?{id:"updateSidebar.commentContainer.emptyTitleUnresolved",defaultMessage:"No open comments yet"}:{id:"updateSidebar.commentContainer.emptyTitleResolved",defaultMessage:"No resolved comments yet"})),a()("div",{style:{width:200,alignSelf:"center"}},void 0,a()(y.FormattedMessage,H?{id:"updateSidebar.commentContainer.emptyUnresolved",defaultMessage:"Open comments on this page will appear here"}:{id:"updateSidebar.commentContainer.emptyResolved",defaultMessage:"Resolved comments on this page will appear here"}))));const $=Object.keys(X).sort().reverse(),oe=$.map(((e,r)=>{const a=(0,h.ZV)({value:{type:"date",start_date:e},date_format:"relative",userTimeZone:(0,m.r)(),intl:C.default.getIntl(),allowRelativeDates:!0}),s=X[e];return{key:e,render:e=>l.createElement(Q,n()({title:a,firstItemId:s[0].id,location:o},e)),items:s.map(((e,a)=>({key:e.id,render:i=>l.createElement(J,n()({},i,{currentBlockStore:A,discussion:e,isFirstInSection:0===a,location:o,isLast:a===s.length-1&&r===$.length-1,showAllRepliesAfterTimestamp:t})),action:()=>{S.en({discussionId:e.id,currentBlockStore:A,environment:i,analyticsFrom:"updates_sidebar",currentEl:Y.current})}})))}})),ie=oe.flatMap((e=>e.items)).findIndex((e=>N.includes(e.key.toString())));return l.createElement("div",{style:K.commentsContentStyle,ref:Y},a()(j,{}),a()(R.Z,{type:I.Z.Y,style:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0},className:w.Xsh},void 0,a()(E.Z,{disableKeyboard:!0,store:te,type:E.i.Vertical,initialFocus:ie>=0?ie:void 0,scrollElIntoView:e=>{if(e instanceof Element){const t=e.getBoundingClientRect(),o=f.R6(i.device.isElectronMac),n=window.innerHeight,r=o+50,a=n-r;if(t.height>=a)return;const s=t.top>=r&&t.top<=n,l=s&&t.bottom>=n,c=t.bottom>=r&&t.bottom<=n,d=c&&t.top-r<0,p=s||c,u=.4*t.height;l&&Math.abs(t.top-n)<u?(0,M.Wr)(e,{edgeDist:n-t.height-r,animate:!0}):d&&Math.abs(t.bottom-r)<u?(0,M.Wr)(e,{edgeDist:0,animate:!0}):p||(0,M.Wr)(e,{edgeDist:0,animate:!0})}},sections:oe})))}},59168:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(77094),n=o.n(i),r=(o(67294),o(480)),a=o(81954),s=o(24405),l=o(80503),c=o(82990),d=o(5366),p=o(43250),u=o(17652),m=o(7011),g=o(45194),h=o(66957);function f(){return window.__c={n:"UpdatesLabel"},n()(d.FormattedMessage,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates",description:"Label for the updates tab in the update sidebar"})}function v(e){window.__c={n:"UpdateSidebarTabUpdatesHeader"};const t=(0,r.O7)(),{enablePageAnalytics:o,popOutMode:i,navigableBlock:g,inPeekView:v}=e,b=(0,s.yK)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:i?0:l.R6(t.device.isElectronMac),paddingTop:4,width:i&&!v?"calc(100% - 2px)":"100%",background:v?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},label:{fontSize:14,color:e.regularTextColor,fontWeight:c.Z.fontWeight.medium}})),[i,t,v]),S=(0,a.VK)((()=>m.ZP.state.currentSubTab),[]),w=(0,a.VK)((()=>(0,u.eK)()),[]);return n()("div",{style:{...b.updatesHeaderStyle,...o?{padding:"0 6px"}:{}},className:p.cFM},void 0,w&&n()(y,{navigableBlock:g}),o?n()(h.Z,{tabs:[n()(f,{},"updates"),n()(d.FormattedMessage,{id:"updateSidebar.header.analyticsLabel",defaultMessage:"Analytics",description:"Label for the analytics tab in the update sidebar"},"analytics")],selectedIndex:S,onChange:e.onTabChange,style:{...b.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"}}):n()("div",{style:b.label},void 0,n()(f,{})))}function y(e){window.__c={n:"GetNotifiedFor"};const t=(0,s.yK)((e=>({label:{fontSize:c.Z.fontSize.UIRegular.desktop,color:e.regularTextColor,fontWeight:c.Z.fontWeight.medium},container:{padding:"12px 8px 8px 10px"},border:{border:`1px solid ${e.outlineButtonBorder}`,borderRadius:3,marginTop:8}})),[]);return(0,a.VK)((()=>(0,g.D)(e.navigableBlock)),[e.navigableBlock])?n()("div",{style:t.container},void 0,n()("div",{style:t.label},void 0,n()(d.FormattedMessage,{id:"UpdateSidebarTabUpdatesHeader.getNotifiedButton.label",defaultMessage:"Get notified for",description:"Label for the get notified dropdown in the Updates sidebar"})),n()("div",{style:t.border},void 0,n()(g.Z,{blockStore:e.navigableBlock,moreProminentStyling:!0}))):null}},79311:(e,t,o)=>{o.d(t,{Z:()=>De});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(96486),l=o.n(s),c=o(67294),d=o(83355),p=o(3779),u=o(29477),m=o(97880),g=o(82990),h=o(5366),f=o(19719),v=o(17659),y=o(43250),b=o(60709),S=o(98742),w=o(59488),k=o(17652),C=o(50659),_=o(67669),M=o(25464),T=o(79315),I=o(62820),P=o(4761),x=o(12318),B=o(24809),Z=o(30016),E=o(64921),R=o(31945),A=o(36488),D=o(58261),F=o(68785),L=o(78140),V=o(89728),N=o(43145),O=o(30506),U=o(33411),H=o(58032),z=o(37770),W=o(39849),j=o(61208),K=o(480),Y=o(81954),G=o(24405),X=o(73063);function q(e){let{location:t}=e;window.__c={n:"InboxFilterForUnreadButton"};const o=(0,h.useIntl)(),i=(0,K.O7)(),{currentTab:r,showOnlyUnreadNotifications:s,isCurrentTabEmpty:l}=(0,Y.VK)((()=>{const{currentTab:e,isCurrentTabEmpty:t}=P.ZP.state;return{currentTab:e,showOnlyUnreadNotifications:"mentions"===e&&P.ZP.state.showOnlyUnreadNotifications,isCurrentTabEmpty:t}}),[]),d=(0,c.useCallback)((async()=>{if(s)P.ZP.update((e=>({...e,showOnlyUnreadNotifications:!1,unreadNotificationIds:[]}))),f.U0(i,{toggled_to:"off"});else{const e=await v.Qy({environment:i});P.ZP.update((t=>({...t,showOnlyUnreadNotifications:!0,unreadNotificationIds:e}))),f.U0(i,{toggled_to:"on"})}}),[i,s]),u=(0,G.yK)((e=>({mobileTopBarIcon:{height:18,width:18,fill:s?void 0:e.regularTextColor},webUpdatesModalIcon:{height:17,width:17}})),[s]);if("mentions"!==r)return null;const g=!s&&l,y=a()(h.FormattedMessage,s?{defaultMessage:"Show all notifications",id:"updatesModal.unreadNotificationsFilterButton.allTooltip",description:"Tooltip message for button to filter to show unread notifications only."}:{defaultMessage:"Show unread notifications only",id:"updatesModal.unreadNotificationsFilterButton.unreadTooltip",description:"Tooltip message for button to filter to show unread notifications only."}),b=s?o.formatMessage({defaultMessage:"Show all notifications",id:"updatesModal.unreadNotificationsFilterButton.allTooltipAriaLabel",description:"Aria screen reader label for icon button to filter to show unread notifications only."}):o.formatMessage({defaultMessage:"Show unread notifications only",id:"updatesModal.unreadNotificationsFilterButton.unreadTooltipAriaLabel",description:"Aria screen reader label for button to icon button to show unread notifications only."});let S,w;switch(t){case"mobileTopBar":S=void 0,w=u.mobileTopBarIcon;break;case"webUpdatesModal":S=!!s||void 0,u.webUpdatesModalIcon;break;default:(0,m.t1)(t)}return a()(H.Z,{disableTooltip:g,renderTooltip:()=>y,render:e=>c.createElement(X.Z,n()({icon:p.Z.filterCircled,isBlue:s,hovered:S,iconStyle:w,disabled:g,onClick:d,ariaLabel:b},e))})}const $=c.memo(q);var J=o(33665),Q=o(76487),ee=o(74523),te=o(66957),oe=o(63296);function ie(e){let{}=e;window.__c={n:"InboxMentionsActionButtons"};const t=(0,K.Fy)(),o=(0,K.O7)(),i=(0,Y.VK)((()=>P.n_.state),[]),r=(0,Y.VK)((()=>{const{currentTab:e,isCurrentTabEmpty:t}=P.ZP.state;if("mentions"!==e||t)return;const{containsBothReadAndUnreadNotifications:o,containsUnreadNotifications:i,showOnlyUnreadNotifications:n}=P.ZP.state;return{containsBothReadAndUnreadNotifications:o,containsUnreadNotifications:i,showOnlyUnreadNotifications:n}}),[]),s=(0,c.useCallback)((()=>{f.Xf(o),v.go(o)}),[o]),l=(0,c.useCallback)((()=>{if(!r)return;const{containsBothReadAndUnreadNotifications:e,showOnlyUnreadNotifications:t}=r;let i="none";t?i="unread":e&&(i="read"),f.zD(o,{readFilter:i}),v.rG(o,"mentions",i)}),[o,r]),d=(0,G.yK)((e=>{const o={opacity:1,flex:1,height:t.isMobile?32:27};return{headerWithBottomBorder:{borderBottom:i?void 0:`1px solid ${e.regularDividerColor}`},container:{display:"flex",marginTop:12,marginLeft:16,marginRight:16,paddingBottom:12,gap:8},buttons:o,buttonsWithLoweredOpacity:{...o,opacity:.7}}}),[t.isMobile,i]);if(!r)return null;const{containsBothReadAndUnreadNotifications:p,containsUnreadNotifications:u,showOnlyUnreadNotifications:m}=r;return a()("div",{style:d.headerWithBottomBorder},void 0,a()("div",{style:d.container},void 0,a()(H.Z,{disableTooltip:u,renderTooltip:e=>c.createElement("div",e,a()(h.FormattedMessage,{defaultMessage:"All notifications have been marked as read.",id:"updatesModal.spaceUpdatesTab.markAllReadButton.disabledTooltip",description:"Tooltip message for the disabled 'Mark all as read' button explaining that all notifications have been marked as read."})),render:e=>c.createElement(oe.Z,n()({onClick:s,style:u?d.buttons:d.buttonsWithLoweredOpacity,isSmall:!t.isMobile,disabled:!u},e),a()(h.FormattedMessage,{defaultMessage:"Mark all as read",id:"updatesModal.spaceUpdates.mentionsTab.markAllReadButtonTitle",description:"Button text for marking all notifications as read."}))}),a()(oe.Z,{onClick:l,style:d.buttons,isSmall:!t.isMobile},void 0,a()(h.FormattedMessage,m?{defaultMessage:"Archive unread",id:"updatesModal.spaceUpdates.mentionsTab.archiveUnreadButtonTitle",description:"Button text for archiving all unread notifications."}:p?{defaultMessage:"Archive read",id:"updatesModal.spaceUpdates.mentionsTab.archiveReadButtonTitle",description:"Button text for archiving all read notifications."}:{defaultMessage:"Archive all",id:"updatesModal.spaceUpdates.mentionsTab.archiveAllButtonTitle",description:"Button text for archiving all notifications."}))))}const ne=c.memo(ie);var re=o(50906),ae=o(14786),se=o(92083);function le(e){let{location:t}=e;window.__c={n:"InboxNotificationSettingsButton"};const o=(0,h.useIntl)(),i=(0,K.O7)(),r=(0,c.useCallback)((()=>{const{device:e}=i;re.trackOpenNotificationSettingsFromAllUpdates(i),e.isMobile?ae.Z.setState({open:!0,source:ae.Y.Updates}):(I.Z.setState({...I.Z.state,open:!1}),se.Z.setState({...se.Z.state,currentTab:"notifications_and_settings",defaultSubtab:void 0}),se.Z.setState({...se.Z.state,open:!0}))}),[i]),s=(0,G.yK)((e=>({mobileTopBarIcon:{height:18,width:18,fill:e.regularTextColor},webUpdatesModalIcon:{width:16,height:16}})),[]);let l;switch(t){case"mobileTopBar":l=s.mobileTopBarIcon;break;case"webUpdatesModal":l=s.webUpdatesModalIcon;break;default:(0,m.t1)(t)}return a()(H.Z,{renderTooltip:()=>a()(h.FormattedMessage,{defaultMessage:"Open notifications settings",id:"updatesModal.openNotifications.tooltip"}),render:e=>c.createElement(X.Z,n()({icon:p.Z.settings,iconStyle:l,onClick:r,ariaLabel:o.formatMessage({id:"updatesModal.openNotifications.tooltipAriaLabel",defaultMessage:"Open notifications settings button",description:"Accessibility aria label for the open notifications settings button"})},e))})}const ce=c.memo(le);function de(e){let{location:t,onClick:o}=e;window.__c={n:"InboxRefreshAllTabButton"};const i=(0,h.useIntl)(),r=(0,Y.VK)((()=>P.ZP.state.currentTab),[]),s=(0,G.yK)((e=>({mobileTopBarIcon:{height:18,width:18,fill:e.regularTextColor},webUpdatesModalIcon:{height:17,width:17}})),[]);if("allPages"!==r)return null;let l;switch(t){case"mobileTopBar":l=s.mobileTopBarIcon;break;case"webUpdatesModal":l=s.webUpdatesModalIcon;break;default:(0,m.t1)(t)}return a()(H.Z,{renderTooltip:()=>a()(h.FormattedMessage,{defaultMessage:"Refresh",id:"updatesModal.allUpdatesRefreshButton.refreshButtonDescription",description:"Button to refresh the All updates tab."}),render:e=>c.createElement(X.Z,n()({icon:p.Z.refresh,iconStyle:l,onClick:o,ariaLabel:i.formatMessage({defaultMessage:"Refresh",id:"updatesModal.allUpdatesRefreshButton.refreshButtonDescriptionAriaLabel",description:"Aria screen reader label for button to icon button to refresh the All updates tab."})},e))})}const pe=c.memo(de);var ue=o(92955);function me(e){let{orderedTabConfigs:t,onClickRefreshAllTab:o}=e;const i=(0,K.Fy)(),r=(0,K.O7)(),{currentTab:s,currentTabIndex:l}=(0,Y.VK)((()=>{const{currentTab:e}=P.ZP.state,o=t.findIndex((t=>t.tab===e));return{currentTab:e,currentTabIndex:o}}),[t]),d=(0,c.useMemo)((()=>t.map(((e,t)=>{if(e.showSeparatorBefore)return t-1})).filter(m.$K)),[t]),p=(0,Y.VK)((()=>Q.Z.getUnreadCountForCurrentSpace().mentions>0),[]),u=(0,c.useCallback)((e=>{const o=t[e],i=null==o?void 0:o.tab;i&&s!==i&&v.G7({environment:r,newTab:i,shouldTrack:!0})}),[s,r,t]),f=(0,G.yK)((()=>({mentionsContainer:{display:"flex",alignItems:"center",justifyContent:"center",fontWeight:p?g.Z.fontWeight.medium:void 0},tabBarRightStyle:{justifyContent:"space-between"},helpButton:{marginLeft:0,...i.isMobile&&{marginTop:-1}},unreadMentionsBadge:{marginLeft:6},actionButtons:{display:"flex",justifyContent:"center",gap:6}})),[i.isMobile,p]),b=W.Z.Color.Red,S={mentions:a()("div",{style:f.mentionsContainer,className:y.I2F},void 0,a()("div",{},void 0,a()(h.FormattedMessage,{defaultMessage:"Inbox",id:"updatesModal.mentionsTab.title"})),a()(ue.Z,{type:"currentSpace",color:b,style:f.unreadMentionsBadge})),allPages:a()("div",{className:y.gjL},void 0,a()(h.FormattedMessage,{defaultMessage:"All",id:"updatesModal.allUpdatesTab.title"})),archive:a()("div",{className:y.HKr},void 0,a()(h.FormattedMessage,{defaultMessage:"Archived",id:"updatesModal.archiveTab.title"}))},w=t.map((e=>S[e.tab])),k="webUpdatesModal",C=!i.isMobile&&a()("div",{style:f.actionButtons},void 0,a()(pe,{location:k,onClick:o}),a()($,{location:k}),a()(ce,{location:k})),_=c.createElement(c.Fragment,null,a()(H.Z,{render:e=>c.createElement(ee.Z,n()({href:(0,J.UY)("guides.notifications"),analyticsFrom:"inbox_tabs_link",style:f.helpButton},e)),renderTooltip:()=>a()(h.FormattedMessage,{id:"updatesButton.learnMoreAboutInboxLink",description:"Learn more link that shows in the inbox. This link only shows when the 'Remove Following and All tabs' feature is launched, and it is meant to direct users to the help center if they have questions about what happened to those tabs.",defaultMessage:"Learn more about notifications"})}),C);return c.createElement(c.Fragment,null,a()(te.Z,{tabs:w,selectedIndex:l,onChange:u,separatorIndexes:d,right:_,rightStyle:f.tabBarRightStyle}),"mentions"===s&&a()(ne,{}))}const ge=c.memo(me);var he=o(44615),fe=o(65311),ve=o(63143),ye=o(54642),be=o(30149),Se=o(65598),we=o(51811),ke=o(77907),Ce=o(2688),_e=o(88632),Me=o(3815),Te=o(77137),Ie=o(70268);const Pe={mentions:!0,archive:!1};class xe extends d.Z{constructor(){super(...arguments),this.storeTypes={size:x.default.of(20),checkpoint:x.default.of(Math.random())},this.renderRequest=(e,t,o,i)=>{const n=T.default.state.currentSpaceStore;if(!n||t)return a()("div",{style:this.getPlaceholderContentStyle()},void 0,a()(h.FormattedMessage,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"}));const r=(0,w.Y)("supportsNativeHome");let s=r?o??we.Tj(e):o;if(r&&o&&we.yW(e,o),"mentions"===P.ZP.state.currentTab&&P.ZP.state.showOnlyUnreadNotifications&&(s=P.ZP.state.unreadNotificationIds),!s)return a()("div",{style:this.getContentStyle()},void 0,a()(Ie.B,{areaHeight:window.innerHeight}));const c=s.map((e=>Me.t1.createChildStore(n,{table:fe.uX,id:e}))),d=[],p=l().compact(c.map((e=>{const t=e.getValue();if(!t)return;if(t.invalid)return;if(t.visited&&Pe[this.props.type]||!t.visited&&"archive"===this.props.type)return;const o=Se.sl(e);if(!o||!o.isReady())return;const i=o.getValue();if(i){if(!i.invalid)return{activity:i,notification:t};d.push(t)}else d.push(t)})));this.markUnreadNotificationsAsRead(d,n);const u=this.stores.size.get(),m=0===p.length,g=p.some((e=>{let{notification:t}=e;return!t.read})),f=g&&p.some((e=>{let{notification:t}=e;return t.read}));"mentions"===P.ZP.state.currentTab?P.ZP.setState({...P.ZP.state,isCurrentTabEmpty:m,containsBothReadAndUnreadNotifications:f,containsUnreadNotifications:g}):P.ZP.setState({...P.ZP.state,isCurrentTabEmpty:m});const v=(0,k.mf)();return a()("div",{style:m?this.getPlaceholderContentStyle():this.getContentStyle()},void 0,m&&this.props.empty,a()("div",{className:"notranslate"},void 0,p.map(((e,t,o)=>{let{activity:i,notification:r}=e;const s=o.length-1===t,l={source:this.props.source,tab:this.props.tab,notification:r};return a()(ke.LazyActivity,{activity:i,rootStore:n,isLast:s,tabArgs:l,isTopbarUpdatesMenu:!1,useRedesignedIA:v},i.id)}))),a()(N.Z,{onChange:e=>{e<200&&s&&s.length>=u&&this.stores.size.set(s.length+20)}},void 0,!s&&a()(Ie.B,{areaHeight:window.innerHeight})))},this.handleActivityEmit=(e,t)=>{String(t).includes("unreadCount")||this.stores.checkpoint.set(Math.random())},this.handleActivityEmitThrottled=l().throttle(this.handleActivityEmit,1e3),this.handleNotificationEmit=ve.YX(this.handleActivityEmitThrottled),this.notificationListenerReference=void 0,this.markUnreadNotificationsAsRead=(e,t)=>{const o=e.filter((e=>!e.read));0!==o.length&&be.createAndCommit({userAction:"NotificationUpdates.unreadNotificationNotRendered",environment:this.environment,perform:e=>{for(const i of o)v.$h({notification:i,rootStore:t,transaction:e,read:!0})}})}}willMount(){this.startMessageListeners()}willUnmount(){this.stopMessageListeners()}renderComponent(){return _e.Z.state.online?this.renderOnline():this.renderOffline()}renderOffline(){return a()("div",{style:this.getPlaceholderContentStyle()},void 0,a()("div",{},void 0,a()(h.FormattedMessage,{defaultMessage:"Please go online to view updates.",id:"notificationUpdates.offline.message"})))}renderOnline(){const{currentUserStore:e,currentSpaceStore:t}=T.default.state;if(!e||!t)return;const o=t.id,i=this.stores.size.get(),n=this.stores.checkpoint.get(),r=this.props.type,s=e.id;return a()(Te.Z,{throttle:1e3,request:{spaceId:o,size:i,type:r,checkpoint:n},performRequest:async e=>{let{spaceId:t,size:o,type:i}=e;const n=P.ZP.startLoading(),r=await ye.getNotificationLog(this.environment,{spaceId:t,size:o,type:i});if(P.ZP.endLoading(n),"failed"===r.type)throw r.error;if("mentions"===P.ZP.state.currentTab&&P.ZP.state.showOnlyUnreadNotifications){const e=await v.Qy({environment:this.environment}),t=[...P.ZP.state.unreadNotificationIds];for(const o of e)t.includes(o)||t.unshift(o);P.ZP.setState({...P.ZP.state,unreadNotificationIds:t})}return r.data.notificationIds},render:(e,t,i)=>this.renderRequest({spaceId:o,userId:s,type:r},e,t,i)})}startMessageListeners(){const{currentUserStore:e}=T.default.state;if(e){const t=(0,he.Lp)(e.id);this.notificationListenerReference=Ce.Z.addListener(t,this.handleNotificationEmit,void 0,this.environment)}}stopMessageListeners(){this.notificationListenerReference&&(Ce.Z.removeListener(this.notificationListenerReference,this.environment),this.notificationListenerReference=void 0)}getContentStyle(){const{device:e}=this.environment;return{minHeight:e.isMobile||"mentions"===this.props.type?void 0:"75vh"}}getPlaceholderContentStyle(){const{device:e}=this.environment;return{...this.getContentStyle(),paddingTop:e.isMobile?64:void 0,minHeight:e.isMobile?void 0:220,display:"flex",textAlign:"center",alignItems:"center",justifyContent:"center",fontSize:14,color:this.theme.regularTextColor,overflow:"hidden"}}}xe.displayName="NotificationUpdates";const Be=xe;var Ze=o(14694);const Ee=[{tab:"mentions"},{tab:"archive"},{tab:"allPages",showSeparatorBefore:!0}];let Re;!function(e){e[e.Sidebar=0]="Sidebar",e[e.SidebarMobile=1]="SidebarMobile",e[e.MobileBottomBarPhone=2]="MobileBottomBarPhone",e[e.MobileBottomBarTablet=3]="MobileBottomBarTablet",e[e.TopbarMobile=4]="TopbarMobile",e[e.RenderAsPage=5]="RenderAsPage"}(Re||(Re={}));class Ae extends d.Z{constructor(){super(...arguments),this.storeTypes={refreshCountStore:x.default.of(0)},this.loadingSpinner=()=>{if((0,w.Y)("supportsNativeHome"))return a()(U.Z,{show:void 0!==P.ZP.state.loadingId,showDelay:400,showHold:0,render:e=>a()(e?F.Z:"div",{style:{width:14}})})},this.renderSpaceUpdates=()=>{const{device:e}=this.environment;let t;const o=a()(ge,{onClickRefreshAllTab:this.handleRefreshAllThrottled,orderedTabConfigs:Ee});if(e.isMobile){const i="mobileTopBar";t={menuType:b.og.Modal,title:(0,k.Lf)()?a()(h.FormattedMessage,{defaultMessage:"Notifications",id:"notificationsModal.mobileMenu.title",description:"This is the title of the notifications modal in the mobile app."}):a()(h.FormattedMessage,{defaultMessage:"Updates",id:"updatesModal.mobileMenu.title"}),width:this.props.format===Ae.Format.RenderAsPage?"100vw":void 0,renderAsPage:this.props.format===Re.RenderAsPage,right:[a()(pe,{onClick:this.handleRefreshAllThrottled,location:i},"InboxRefreshAllTabButton"),a()($,{location:i},"InboxFilterForUnreadButton"),a()("span",{style:{width:8}},"paddingSpan"),a()(ce,{location:i},"InboxNotificationSettingsButton")],left:[this.loadingSpinner(),e.isPhone&&(0,w.Y)("supportsNativeHome")&&this.props.format===Re.RenderAsPage?void 0:p.Z.chevronLeftRounded({fill:this.theme.regularTextColor,width:26,height:26})],onClickLeft:this.closeMenu,header:o,whiteBackground:!0}}else t={menuType:b.og.Popup,header:o,height:"auto"};return a()(O.Z,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>c.createElement(L.Z,n()({},t,e,{className:y.C18}),a()(N.Z,{onChange:(e,t)=>{let{offsetFromTop:o}=t;P.n_.setState(o<=0)}}),a()(A.Z,{capture:!0,allowUndo:!0,allowEsc:!0,allowMobileAutoScroll:!0,render:()=>this.props.format===Ae.Format.RenderAsPage?this.renderContentAsPageWithLazyLoader():this.renderContent()}))})},this.closeMenu=()=>{this.handleCloseUpdatesPopup(),I.Z.setState({...I.Z.state,open:!1})},this.handleDismiss=()=>{this.handleCloseUpdatesPopup()},this.handleClick=()=>{P.ZP.endSession(),v.G7({environment:this.environment,newTab:"mentions",shouldTrack:!0})},this.handleCloseUpdatesPopup=()=>{f.nI(this.environment),v.G7({environment:this.environment,newTab:"mentions",shouldTrack:!1})},this.handleSwipeLeft=()=>{const e=Ee.findIndex((e=>e.tab===P.ZP.state.currentTab)),t=Ee[e+1].tab;void 0!==t&&v.G7({environment:this.environment,newTab:t,shouldTrack:!0})},this.handleSwipeRight=()=>{const e=Ee.findIndex((e=>e.tab===P.ZP.state.currentTab)),t=Ee[e-1].tab;void 0!==t&&v.G7({environment:this.environment,newTab:t,shouldTrack:!0})},this.handleRefreshAll=()=>{const{refreshCountStore:e}=this.stores;e.setState(e.state+1)},this.handleRefreshAllThrottled=l().debounce(this.handleRefreshAll,1e3,{leading:!0}),this.showUpdatesButtonWithBoldText=()=>{if(this.props.format!==Re.Sidebar)return!1;return I.Z.state.open}}willUnmount(){this.handleCloseUpdatesPopup()}renderComponent(){const{device:e,mobileNative:t}=this.environment;if(this.props.format===Re.RenderAsPage)return a()("div",{style:{background:this.theme.popoverBackground}},void 0,this.renderSpaceUpdates());const o=(0,k.Lf)()?a()(h.FormattedMessage,{defaultMessage:"Notifications for all pages in this workspace",id:"notificationsButton.allNotifications.tooltip",description:"Tooltip for the notifications button in the sidebar"}):a()(h.FormattedMessage,{defaultMessage:"Updates for all pages in this workspace",id:"updatesButton.tooltip"});return a()(H.Z,{renderTooltip:()=>a()("div",{},void 0,a()("div",{},void 0,o),a()(D.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleAllUpdates"})),originGap:6,placement:M.u.Right,render:o=>a()(R.Z,{popupType:e.isMobile?R.Z.PopupType.SlideUp:R.Z.PopupType.Popup,alignmentToOrigin:M.v.Start,placementToOrigin:M.u.Right,onClick:this.handleClick,originGap:0,style:{...!e.isMobile&&{width:500,overflow:"hidden"}},isWideTabletWidth:!0,render:this.renderSpaceUpdates,onClose:this.handleDismiss,isFullWidthOnMobile:!0,preventScaleTransition:!0,preventSlideUpTransition:(null==t?void 0:t.supportsNativeHomeOnPhone())||!1,buttonPopupStore:I.Z,renderOrigin:e=>this.renderButton(o,e)})})}renderButton(e,t){const o=this.props.format,i=I.Z.state.open,r=v.aY(),s=W.Z.Color.Red;if(o===Re.MobileBottomBarPhone)return c.createElement(E.Z,n()({style:Ae.mobileBottomBarPhoneButtonStyle,mobileFeedback:!0},t),a()("div",{style:{position:"relative"}},void 0,p.Z.mobileBottomBarUpdates({width:26,fill:this.theme.regularTextColor}),a()(ue.Z,{type:"currentSpace",color:s,style:{position:"absolute",top:-3,right:r<99?-5:-8}})));if(o===Re.MobileBottomBarTablet)return c.createElement(E.Z,n()({style:Ae.mobileBottomBarTabletButtonStyle,mobileFeedback:!0},t),a()("div",{style:{position:"relative"}},void 0,p.Z.mobileBottomBarUpdates({width:26,fill:this.theme.regularTextColor}),a()(ue.Z,{type:"currentSpace",color:s,style:{position:"absolute",top:-3,right:r<99?-5:-8}})));if(o===Re.TopbarMobile)return c.createElement(E.Z,n()({style:{...Ae.actionButtonStyle,marginLeft:2,marginRight:2},mobileFeedback:!0},t),p.Z.mobileBottomBarUpdates({width:26}),a()(ue.Z,{type:"currentSpace",color:s,style:{position:"absolute",top:8,right:0}}));if(o===Re.SidebarMobile)return c.createElement(E.Z,n()({style:Ae.actionButtonStyle,mobileFeedback:!0},t),p.Z.mobileBottomBarUpdates({width:26}),a()(ue.Z,{type:"currentSpace",color:s,style:{position:"absolute",top:8,right:0}}));if(o===Re.Sidebar){const o=this.showUpdatesButtonWithBoldText(),r=(0,k.Lf)()?a()(h.FormattedMessage,{defaultMessage:"Notifications",id:"notificationsButton.allNotifications.sidebarButton",description:"This is the button that opens the notifications popup in the left sidebar."}):a()(h.FormattedMessage,{defaultMessage:"Updates",id:"updatesButton.allUpdates.sidebarButton"}),l=(0,k.Lf)()?p.Z.sidebarNotifsBell:p.Z.sidebarUpdates;return c.createElement(E.Z,n()({style:{...o&&{fontWeight:g.Z.fontWeight.medium,color:this.theme.regularTextColor},...(0,C.G$)({isMobile:!1})}},(0,S.Z)(e,t)),a()(Ze.Z,{left:a()("div",{style:{color:o?this.theme.regularTextColor:"inherit"}},void 0,l({fill:o?this.theme.regularIconColor:this.theme.mediumIconColor,width:14})),right:a()(ue.Z,{type:"currentSpace",color:s,style:{marginBottom:2,marginLeft:6}}),style:{background:i?this.theme.buttonHoveredBackground:"none"}},void 0,r))}}renderContent(){const e=P.ZP.state.currentTab;if("allPages"===e){const{currentSpaceStore:e,mainEditorCurrentBlockStore:t}=T.default.state;return e&&t?a()(B.Z,{spaceId:e.id,prominentGetNotifiedDropdownExperimentEnabled:!1,empty:()=>a()(j.Z,{message:a()(h.FormattedMessage,{defaultMessage:"Updates on pages in your workspace will appear here.",id:"updatesModal.allPagesTab.emptyPrompt"}),title:a()(h.FormattedMessage,{defaultMessage:"No new updates",id:"updatesModal.allPagesTab.emptyPromptTitle"})}),source:"notifications_tab",isTopbarUpdatesMenu:!1},`all-pages-${this.stores.refreshCountStore.state}`):null}if("mentions"===e){const e=P.ZP.state.showOnlyUnreadNotifications;return a()(Be,{type:"mentions",empty:e?this.renderEmptyUnreadMentionsTab():a()(j.Z,{message:(0,_.uT)(this.environment)?a()(h.FormattedMessage,{defaultMessage:"When someone @mentions you, replies to your comments, sends you a request, or invites you to a page, you’ll be notified here.",id:"updatesModal.spaceUpdatesTab.allArchivedRequests"}):a()(h.FormattedMessage,{defaultMessage:"When someone @mentions you, replies to your comments, or invites you to a page, you’ll be notified here.",id:"updatesModal.spaceUpdatesTab.allArchived"}),title:a()(h.FormattedMessage,{defaultMessage:"You're all caught up",id:"updatesModal.spaceUpdatesTab.allArchivedTitle"})}),source:"notifications_tab",tab:"inbox"},"mentions")}if("archive"===e)return a()(Be,{type:"archive",empty:a()(j.Z,{message:a()(h.FormattedMessage,{defaultMessage:"Any Inbox updates you archived will show up here.",id:"updatesModal.archiveTab.emptyPrompt"}),title:a()(h.FormattedMessage,{defaultMessage:"No archived updates",id:"updatesModal.archiveTab.emptyPromptTitle"})}),source:"notifications_tab",tab:"archive"},"archive");(0,m.t1)(e)}renderContentAsPageWithLazyLoader(){return a()(z.Z,{fetch:async()=>{var e;await u.Vs(0),await T.default.waitUntil((()=>void 0!==T.default.state.currentSpaceStore)),null===(e=this.environment.mobileNative)||void 0===e||e.markTransitionReady({type:"updates"})},loading:()=>a()(c.Fragment,{}),render:()=>a()(Z.Z,{isVisible:!0,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},blockRenderQueueOnEnter:!0,render:()=>this.renderContent()})})}renderEmptyUnreadMentionsTab(){return a()(j.Z,{icon:p.Z.thinCheck,title:a()(h.FormattedMessage,{defaultMessage:"You've read everything",id:"updatesModal.spaceUpdatesTab.emptyUnreadMentionsTabTitle",description:"Title for the mentions tab that shows when the user filters for unread notifications but has none."}),message:a()("div",{},void 0,a()(h.FormattedMessage,{defaultMessage:"You have more notifications in your inbox.",id:"updatesModal.spaceUpdatesTab.emptyUnreadMentionsTabMessage",description:"Message for the mentions tab that shows when the user filters for unread notifications but has none."}),a()("div",{style:{height:12}}),a()(V.Z,{isBlue:!0,onClick:()=>{"mentions"===P.ZP.state.currentTab&&P.ZP.setState({...P.ZP.state,showOnlyUnreadNotifications:!1,unreadNotificationIds:[]})}},void 0,a()(h.FormattedMessage,{defaultMessage:"See all",id:"updatesModal.spaceUpdatesTab.emptyUnreadMentionsTabButton",description:"Button for showing all notifications in the mentions tab. This is visible when the user filters for unread notifications but has none."})))})}}Ae.displayName="UpdatesButton",Ae.Format=Re,Ae.actionButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",flexGrow:0,flexShrink:0,height:"100%",minWidth:34,position:"relative"},Ae.mobileBottomBarPhoneButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",flex:1},Ae.mobileBottomBarTabletButtonStyle={display:"flex",alignItems:"center",justifyContent:"center",width:62,flex:"none"};const De=Ae},42115:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(93678),s=o(98742),l=o(58032),c=o(91718);class d extends r.Z{renderComponent(){const{render:e,requireUpgradeToTier:t,analyticsName:o,renderUpgradeTooltip:i,onUpgradeClick:r,alwaysAllowClick:d,tooltipPlacement:p,upgradeButtonDesktopStyle:u,upgradeButtonMobileStyle:m}=this.props;let g,{onClick:h,renderTooltip:f}=this.props;return t&&(g=n()(c.Z,{subscriptionTier:t,analyticsName:o,desktopStyle:{display:"inline-block",pointerEvents:"none",...u},mobileStyle:{display:"inline-block",pointerEvents:"none",...m}}),d||(h=e=>{a.y(this.environment,{from:o,for:t}),r&&r(e)},f=i)),n()(l.Z,{renderTooltip:f||(()=>null),render:t=>e((0,s.Z)(t,{onClick:h}),g),disableTooltip:!f,placement:p})}}d.displayName="UpsellGate";const p=d},30045:(e,t,o)=>{o.d(t,{Z:()=>w});var i=o(77094),n=o.n(i),r=(o(67294),o(83355)),a=o(13991),s=o(61784),l=o(63143),c=o(5366),d=o(54642),p=o(71119),u=o(79315),m=o(72087),g=o(59649),h=o(63296),f=o(77137),v=o(64369),y=o(23189),b=o(55422);class S extends r.Z{constructor(){super(...arguments),this.storeTypes={requestStore:m.Z},this.renderResult=(e,t,o)=>n()(g.Z,{loaded:o,spinnerSize:16,showSpinnerTimeout:600},void 0,e||!t?n()("div",{},void 0,this.props.intl.formatMessage({id:"userDataConsent.render.error",defaultMessage:"Something went wrong"})):this.renderOutput(t)),this.renderOutput=e=>{const t=Boolean(e.expiryTime&&Number(e.expiryTime)>Date.now()),o=t?this.revokeDataAccess:this.grantDataAccess;return(0,p.DH)()?this.renderUserDataConsentSettings({accessGranted:t,onClick:o,output:e}):this.renderLegacyUserDataConsentSettings({accessGranted:t,onClick:o,output:e})},this.fetchUserDataConsentSettings=async e=>{const t=await d.getDataAccessConsent(this.environment,{});if("failed"===t.type)throw t.error;return t.data},this.grantDataAccess=async()=>{await this.setDataAccessExpiryTime({expiryTime:Date.now()+14*l.A0})},this.revokeDataAccess=async()=>{await this.setDataAccessExpiryTime({})},this.setDataAccessExpiryTime=async e=>{const t=await d.setDataAccessConsent(this.environment,e);if("success"===t.type&&t.data){const e=this.stores.requestStore.state;this.stores.requestStore.setState({...e,result:t.data})}}}renderComponent(){const{currentUserStore:e}=u.default.state;return e&&n()(f.Z,{requestStore:this.stores.requestStore,request:{userId:e.id,expiryTime:Date.now()+14*l.A0},performRequest:this.fetchUserDataConsentSettings,render:this.renderResult})}renderUserDataConsentSettings(e){const{accessGranted:t,onClick:o,output:i}=e,{device:r}=this.environment;return n()(b.Z,{isMobile:r.isMobile,title:n()(c.FormattedMessage,{id:"personalSettings.supportSection.userDataConsentSettings.label",defaultMessage:"Support access",description:"Label for setting to grant Notion support temporary access"}),caption:t&&i.expiryTime?n()(c.FormattedMessage,{id:"userDataConsentSettings.accessGranted.label",defaultMessage:"You have granted Notion access to your account for support purposes until {expiryTime}.",values:{expiryTime:(0,s.Yx)(i.expiryTime,"medium_with_time",a.SP)}}):n()(c.FormattedMessage,{id:"personalSettings.supportSection.userDataConsentSettings.message",defaultMessage:"Grant Notion support temporary access to your account so we can troubleshoot problems or recover content on your behalf. You can revoke access at any time.",description:"Message describing the user data consent setting"}),type:"toggle",isOn:t,onToggle:o})}renderLegacyUserDataConsentSettings(e){const{accessGranted:t,output:o,onClick:i}=e;return n()("div",{style:this.getSettingsOptionStyle()},void 0,n()("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:12,width:"100%"}},void 0,n()("div",{style:{flex:1}},void 0,n()(y.Z,{},void 0,n()(c.FormattedMessage,{id:"userDataConsentSettings.header.label",defaultMessage:"Support access"})),n()(v.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4,width:"80%"}},void 0,t&&o.expiryTime?n()(c.FormattedMessage,{id:"userDataConsentSettings.accessGranted.label",defaultMessage:"You have granted Notion access to your account for support purposes until {expiryTime}.",values:{expiryTime:(0,s.Yx)(o.expiryTime,"medium_with_time",a.SP)}}):n()(c.FormattedMessage,{id:"userDataConsentSettings.accessNotGranted.label",defaultMessage:"Grant Notion support temporary access to your account so we can troubleshoot problems or recover content on your behalf. You can revoke access at any time."})),n()(h.Z,{onClick:i,isLarge:!0,style:{marginTop:12,marginBottom:4}},void 0,n()(c.FormattedMessage,t?{id:"userDataConsentSettings.revokeSupportAccess.button",defaultMessage:"Revoke access"}:{id:"userDataConsentSettings.allowSupportAccess.button",defaultMessage:"Allow support access"})))))}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}S.displayName="UserDataConsentSettings";const w=(0,c.injectIntl)(S)},97680:(e,t,o)=>{o.d(t,{Z:()=>y});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(83355),c=o(66897),d=o(33929),p=o(60709),u=o(98742),m=o(52275),g=o(58032),h=o(70301),f=o(45653);class v extends l.Z{renderComponent(){const{actor:e,userTitle:t,useEmailAsTooltip:o,tooltip:i,tooltipPlacement:r}=this.props,l=d.default.getIntl(),p=e.value&&(0,c.uC)(e)?e.value.email:void 0,v=o&&p?p:i;return a()(g.Z,{placement:r??g.Z.Placement.Bottom,alignment:g.Z.Alignment.Start,textWrap:!0,render:o=>s.createElement(m.Z,n()({},(0,u.Z)(o,this.props),{icon:e&&(0,c.YU)(e)?a()(h.Z,{botValue:null==e?void 0:e.value,size:this.environment.device.isMobile?24:20}):a()(f.Z,{userValue:null==e?void 0:e.value,size:this.environment.device.isMobile?24:20}),title:t??(0,c.$4)(l,e),className:"notranslate"})),disableTooltip:!v,renderTooltip:()=>v})}}v.displayName="UserMenuItem",v.contextTypes={...p.mw,...l.w};const y=v},25155:(e,t,o)=>{o.d(t,{Z:()=>x});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(96486),l=o(67294),c=o(62518),d=o(83355),p=o(13991),u=o(6740),m=o(12137),g=o(8848),h=o(80357),f=o(82990),v=o(63143),y=o(5366),b=o(24677),S=o(31792),w=o(27724),k=o(12318),C=o(49085);class _ extends C.Z{getInitialState(){return{showFadeInAnimation:!1,isRepositioning:!1}}}const M=_;var T=o(30016),I=o(6685);class P extends d.Z{constructor(){super(...arguments),this.storeTypes={focusStore:k.default.of(!1),mouseStore:S.Z,withImageRepositioningStore:M},this.renderDraggable=()=>n()(I.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disabled:!this.isRepositioning(),render:e=>l.createElement("div",a()({},(0,h.iv)(this.getDragContainerStyle()),e),this.props.children({imagePosition:this.getRenderedCoverPosition(),isRepositioning:this.isRepositioning(),showFadeInAnimation:!1}))}),this.shouldBeActiveStore=this.createComputedStore((()=>0===w.default.state.stores.length)),this.handleFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,u.E)(t)&&this.stores.focusStore.setState(!0)},this.handleBlur=e=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=e=>{this.mouseStore.setState({...this.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=e=>{this.mouseStore.setState({...this.mouseStore.state,mouseEntered:!1})},this.handleMouseMoveThrottled=(0,s.throttle)(this.handleMouseMove,100),this.handleMouseLeaveDebounced=(0,s.debounce)(this.handleMouseLeave,100),this.handleWindowMouseDown=e=>{const t=c.findDOMNode(this);t&&!t.contains(e.target)&&this.isRepositioning()&&this.props.onFlushTemporaryPosition({imagePosition:this.getRenderedCoverPosition(),reset:()=>{this.mouseStore.reset(),this.stores.withImageRepositioningStore.reset()}})},this.handleRepositionClick=(e,t)=>{b.ZH(this.environment);const o=new Image;o.onload=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,isRepositioning:!0,image:o})},t&&(o.src=t)},this.handleCancelClick=e=>{this.stores.withImageRepositioningStore.reset()},this.handleSavePositionClick=e=>{this.props.onFlushTemporaryPosition({imagePosition:this.getRenderedCoverPosition(),reset:()=>{this.stores.withImageRepositioningStore.reset()}})},this.handleDragStart=e=>{const t=this.isRepositioning(),{image:o}=this.stores.withImageRepositioningStore.state;if(o&&t){const e=c.findDOMNode(this);if(e&&e instanceof Element){const t=e.getBoundingClientRect().width/o.width*o.height,i=this.getRenderedCoverPosition();this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:t,startDragRenderedPosition:i})}}},this.handleDragMove=e=>{if(this.isRepositioning()){const{startDragRenderedPosition:t,startDragImageScreenHeight:o}=this.stores.withImageRepositioningStore.state,i=e.diffY/(o||0)+(t||0);this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,temporaryPosition:(0,s.round)((0,m.Z)(i,0,1),4)})}},this.handleDragEnd=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})},this.handleDragCancel=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})}}didMount(){super.didMount(),window.addEventListener("mousedown",this.handleWindowMouseDown)}willUnmount(){super.willUnmount(),window.removeEventListener("mousedown",this.handleWindowMouseDown)}willMountOrUpdate(){this.isRepositioning()&&!this.shouldBeActiveStore.state&&this.stores.withImageRepositioningStore.reset()}renderComponent(){const{device:e}=this.environment,{style:t}=this.props,{isMobile:o}=e,i=this.isRepositioning(),{mouseEntered:n}=this.mouseStore.state,r=this.stores.focusStore.state;return l.createElement("div",a()({onFocus:this.handleFocus,onBlur:this.handleBlur,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced},(0,h.iv)(this.getContainerStyle(),t)),this.renderDraggable(),this.renderDragMessage(),this.props.renderControl({handleRepositionClick:this.handleRepositionClick,handleSavePositionClick:this.handleSavePositionClick,handleCancelClick:this.handleCancelClick,isVisible:o||n||r||i,isRepositioning:i}))}renderDragMessage(){const{isRepositioning:e}=this.stores.withImageRepositioningStore.state;if(!this.props.small)return n()(T.Z,{isVisible:!0,animationStyle:{opacity:e?1:0},render:()=>l.createElement("div",a()({},(0,h.iv)(this.getDragMessageContainerStyle()),{"aria-hidden":!e}),n()(y.FormattedMessage,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"}))})}isRepositioning(){return this.stores.withImageRepositioningStore.state.isRepositioning}getRenderedCoverPosition(){const{temporaryPosition:e}=this.stores.withImageRepositioningStore.state;return(0,s.isNumber)(e)?e:this.getPersistedCoverPosition()}getPersistedCoverPosition(){const{source:e,store:t}=this.props;if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,s.isNumber)(e))return e}if(t.isCollectionView()){const e=t.getCollectionViewCollectionStore();if(e){const t=e.getFormat().collection_cover_position;if(!(0,v.z4)(t))return t}}else{const e=t.getFormat().page_cover_position;if((0,s.isNumber)(e))return e}return.5}get mouseStore(){return this.props.mouseStore||this.stores.mouseStore}getContainerStyle(){return{position:"relative",width:"100%"}}getDragContainerStyle(){return{width:"100%",cursor:this.isRepositioning()?"move":"inherit"}}getDragMessageContainerStyle(){return{background:g.ZP.blackWithAlpha(.4),borderRadius:3,color:g.ZP.white,fontSize:12,fontFamily:f.Z.getCompositeFontFamily(p.SP).sans,width:180,left:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center"}}}P.displayName="WithImageRepositioning";const x=P},56948:(e,t,o)=>{o.d(t,{H:()=>x});var i=o(77094),n=o.n(i),r=o(67294),a=o(24405),s=o(3779),l=o(97880),c=o(18466),d=o(26263),p=o(480),u=o(88891),m=o(21202),g=o(19889),h=o(43132),f=o(30149),v=o(3815),y=o(49065),b=o(61134),S=o(17748);function w(e){window.__c={n:"AssistantChatMessageRenderer"};const{clientStep:t}=e,o=(0,p.O7)(),i=(0,r.useMemo)((()=>c.Z.withListenerIgnored((()=>function(e){const{environment:t,clientStep:o}=e,i=new d.Z,n=t.currentUser.id;if(!n)throw new Error("No current user.");const r={table:g.KJ,id:n},a=f.createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStore",environment:t,perform:e=>{for(const s of o.operations){const o=(0,u.N)({assistantOperation:s,actorPointer:r,getRecordValue:i.makeGetRecordValueFn(n)});for(const n of o){const o=new y.ST({environment:t,pointer:n.pointer,path:n.path,inMemoryRecordCache:i});f.applyOperation({store:o,operation:n,transaction:e})}}const a=o.blockIds.map((e=>new v.G(t,{table:m.iU,id:e},{inMemoryRecordCache:i})));return h.Lh({environment:t,stores:a,inMemoryRecordCache:i,transaction:e})}}).performResult;return i.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),a}({environment:o,clientStep:t})))),[o,t]);return n()(b.O,{displayName:"AssistantChatStepContent",disabled:!0},void 0,n()(S.Z,{store:i,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0}))}var k=o(81954),C=o(24677),_=o(95802),M=o(83907);function T(e){const{store:t,clientStep:o}=e,i=[],a=[],s=[];for(const n of o.operations)"createBlock"===n.command||("insertBlockAfter"===n.command||"insertBlockBefore"===n.command?i.push(n.insertId):"removeBlock"===n.command?a.push(n.removeId):"setBlockAttribute"===n.command||"setBlockTagName"===n.command||"setBlockText"===n.command?s.push(n.id):"setBlockProperty"===n.command||"insertOrMoveTableColumns"===n.command||"removeTableColumn"===n.command?s.push(n.blockId):(0,l.t1)(n));return r.createElement(r.Fragment,null,a.length>0&&r.createElement(r.Fragment,null,n()("div",{},void 0,n()("b",{},void 0,`Removed ${a.length} block${a.length>1?"s":""}`)),n()(I,{store:t,blockIds:a})),i.length>0&&r.createElement(r.Fragment,null,n()("div",{},void 0,n()("b",{},void 0,`Inserted ${i.length} block${i.length>1?"s":""}`)),n()(I,{store:t,blockIds:i})),s.length>0&&r.createElement(r.Fragment,null,n()("div",{},void 0,n()("b",{},void 0,`Updated ${s.length} block${s.length>1?"s":""}`)),n()(I,{store:t,blockIds:s})))}function I(e){window.__c={n:"BlockListRenderer"};const{store:t,blockIds:o}=e,i=(0,p.O7)(),a=(0,r.useMemo)((()=>c.Z.withListenerIgnored((()=>{const e=t.state;if(!e)throw new Error("No state");const n=_.C.findSelectablesFromIds(o),r=o.map((t=>{const o=n.find((e=>e.props.store.id===t));return(null==o?void 0:o.props.store)||new v.G(i,{table:m.iU,id:t},{inMemoryRecordCache:e.temporaryCache})}));return C.rs(r),r}))),[i,o,t]);return n()(b.O,{displayName:"AssistantBlockRenderer",disabled:!0},void 0,a.map(((e,t)=>n()(P,{store:e},t))))}function P(e){window.__c={n:"BlockRenderer"};const{store:t}=e,o=(0,k.VK)((()=>(0,M.h)(t)),[t]);return o?n()(o,{store:t,disabled:!0,isFirstItem:!1,isLastItem:!1}):null}function x(e){window.__c={n:"AssistantChatStep"};const{store:t,clientStep:o}=e,i=(0,a.yK)((e=>({wrap:{display:"flex",marginTop:6,marginBottom:6},baseMessage:{maxWidth:"80%",borderRadius:12,paddingLeft:8,paddingRight:8,paddingTop:6,paddingBottom:6,fontSize:14,whiteSpace:"pre-wrap",overflowWrap:"break-word",position:"relative"},humanMessage:{backgroundColor:e.accentColors.purple[50],color:e.aiPurpleColor},assistantMessage:{backgroundColor:"rgba(247, 247, 245, 1)",color:e.darkTextColor}})),[]);let c;var d;"human"===o.type?c=(null===(d=/<chat><text>(.*?)<\/text><\/chat>/gs.exec(o.value))||void 0===d?void 0:d[1])||"":"assistantChat"===o.type?c=n()(w,{clientStep:o}):"assistantTransaction"===o.type?c=n()(T,{store:t,clientStep:o}):"assistantLoadPage"===o.type?c="Load page":"assistantSearch"===o.type?c=r.createElement(r.Fragment,null,n()("div",{style:{display:"flex",alignItems:"center"}},void 0,s.Z.collectionSearch({width:14,marginRight:4}),n()("b",{},void 0,"Search "),o.question)):"queryDatabase"===o.type?c=n()("div",{style:{display:"flex",alignItems:"center"}},void 0,s.Z.collectionSearch({width:14,marginRight:4}),n()("b",{},void 0,"Query database")):(0,l.t1)(o);return n()("div",{style:i.wrap},void 0,"human"===o.type&&n()("div",{style:{flexGrow:1}}),n()("div",{style:{...i.baseMessage,..."human"===o.type?i.humanMessage:i.assistantMessage}},void 0,c))}},85631:(e,t,o)=>{o.d(t,{t:()=>Lo});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(3779),u=o(5366),m=o(98963),g=o(82993),h=o(30149),f=o(29502),v=o(61766),y=o(45452),b=o(52275),S=o(31945),w=o(79131),k=o(63362),C=o(97428),_=o(4615),M=o(97880),T=o(98742),I=o(24457),P=o(63474),x=o(78140),B=o(9342),Z=o(72495),E=o(58032),R=o(60442);function A(e){window.__c={n:"AddActionMenu"};const{contextStore:t,onActionAdded:o,insertionPoint:i}=e,r=(0,u.useIntl)(),c=(0,l.O7)(),d=(0,P.D)(),p=(0,I.F)({width:280}),m=function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}((0,C.P)("display").filter((e=>e.isAvailableForContext(t.context.type)))).map((e=>{const{display:l}=e;return{key:e.type,render:e=>{const t=t=>s.createElement(b.Z,n()({},(0,T.Z)(t??{},e),{icon:a()(D,{display:l}),disabled:!1,title:r.formatMessage(l.name)})),o=l.description;return o?a()(E.Z,{renderTooltip:()=>a()(R.Z,{caption:r.formatMessage(o)}),placement:E.Z.Placement.Right,delayThreshold:0,render:t}):t()},action:()=>{const n=(0,_.ZP)(),a=t.context.automationStore;h.createAndCommit({userAction:"AutomationActionList.addAction",environment:c,perform:t=>{g.zY({actionId:n,actionType:e.type,automationStore:a,environment:c,intl:r,transaction:t,insertionPoint:i})}}),(0,k.eI)(d,{automation_id:a.id,automation_action_id:n,automation_action_type:e.type}),o(n)}}})).filter(M.$K);return s.createElement(x.Z,p,a()(B.Z,{type:B.i.Vertical,sections:[{key:0,render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0},e)),items:m}],initialFocus:0}))}function D(e){window.__c={n:"AddActionIcon"};const{display:t}=e,o=(0,d.yK)((e=>({icon:{width:13,height:13,fill:t.hasSideEffects?e.blueColor:e.mediumIconColor},iconWrapper:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],borderRadius:3,marginLeft:-2}})),[t.hasSideEffects]);return a()("div",{style:o.iconWrapper},void 0,t.icon(o.icon))}var F=o(23290),L=o(82990),V=o(9953),N=o(92223),O=o(89733),U=o(77794);function H(e){const[t,o]=(0,s.useState)(void 0);return(0,s.useEffect)((()=>{const t=new U.E;if(!e.current)throw new Error("ref.current is null");return t.observe(e.current),t.rect.addListener((e=>{o(e.state)})),()=>{t.destroy()}}),[e]),t}var z=o(1533),W=o(30016),j=o(50478),K=o(73063),Y=o(91839),G=o(44532),X=o(27186);const q=(0,u.defineMessages)({moreActionsButtonAriaLabel:{defaultMessage:"More actions",id:"buttonBlock.button.moreActionsButtonAriaLabel",description:"Aria label for the more actions button"}});function $(e){window.__c={n:"AutomationActionHeader"};const{contextStore:t,actionStore:o,disabled:i,dragging:n,title:r,picker:l,onActionAdded:p}=e,u=(0,s.useRef)(null),m=H(u),g=(0,s.useMemo)((()=>Boolean(m&&m.width<320)),[m]),h=(0,c.qz)(void 0,z.Z),f=(0,c.VK)((()=>n||h.state.hovered),[n,h]),v=(0,d.yK)((e=>({iconHandle:{display:"flex",justifyContent:"center",left:0,position:"absolute",top:0,width:24},iconWrap:{position:"relative",width:24},nameRow:{display:"flex",alignItems:g?"flex-start":"center"},name:{flexGrow:1,fontWeight:L.Z.fontWeight.medium,display:"flex",overflow:"hidden",...g?{flexDirection:"row",flexWrap:"wrap",marginLeft:8,alignItems:"center"}:{alignItems:"center",marginLeft:8}},title:{whiteSpace:"nowrap"},picker:{position:"relative",left:-4,...g?{flexShrink:1,display:"inline-flex",minWidth:0}:{flexGrow:1,width:0}}})),[g]),y=(0,c.VK)((()=>o.getType()),[o]);if(!y)return null;const b=(0,C.z)(y),{display:S}=b;return s.createElement("div",{onMouseLeave:e=>O.iV({store:h,event:e,disabled:i}),onMouseMove:e=>O.Js({store:h,event:e,disabled:i}),style:v.nameRow,ref:u},a()("div",{style:v.iconWrap},void 0,a()(W.Z,{isVisible:!0,animationStyle:{opacity:f?0:1},enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:1},render:()=>a()(J,{display:S})}),a()(W.Z,{isVisible:!i,animationStyle:{opacity:f?1:0},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>a()("div",{style:v.iconHandle},void 0,a()(j.ZP,{hideClickMessage:!0}))})),a()("div",{style:v.name},void 0,a()("div",{style:v.title},void 0,r),!g&&s.createElement(s.Fragment,null," "),l&&a()("div",{style:v.picker},void 0,l)),!i&&a()(Q,{contextStore:t,actionStore:o,onActionAdded:p}))}function J(e){window.__c={n:"ActionIcon"};const{display:t}=e,o=(0,d.yK)((e=>({iconWrap:{width:24,height:24,display:"flex",alignItems:"center",borderRadius:4,background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],flexShrink:0},icon:{width:14,height:14,fill:t.hasSideEffects?e.blueColor:e.accentColors.gray[500],margin:"0 auto"}})),[t.hasSideEffects]);return a()("div",{style:o.iconWrap},void 0,t.icon(o.icon))}function Q(e){const{contextStore:t,actionStore:o,onActionAdded:i}=e,r=(0,u.useIntl)(),l=(0,f.d)(),[c,d]=(0,s.useState)("closed"),[m,g]=s.useState(void 0);return s.createElement(s.Fragment,null,a()(S.Z,{popupType:l,alignmentToOrigin:S.Z.Alignment.Center,placementToOrigin:S.Z.Placement.Bottom,originGap:0,renderOrigin:e=>s.createElement(K.Z,n()({ariaLabel:r.formatMessage(q.moreActionsButtonAriaLabel),icon:p.Z.dots},e)),render:t=>s.createElement(te,n()({onClose:()=>t.close(),onAddStep:e=>{g(new DOMRect(X.IL.x,X.IL.y,1,1)),d(e?"above":"below"),t.close()}},e))}),a()(G.ZP,{popupType:l,open:"closed"!==c,originRect:m,placementToOrigin:G.ZP.Placement.Bottom,alignmentToOrigin:G.ZP.Alignment.Center,render:()=>a()(A,{contextStore:t,onActionAdded:e=>{i(e),d("closed")},insertionPoint:"above"===c?{beforeActionId:o.id}:{afterActionId:o.id}}),onDismiss:()=>d("closed")}))}function ee(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const i=[...e];return i[t]=e[o],i[o]=e[t],i}function te(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,contextStore:o,actionStore:i,onAddStep:r}=e,d=(0,u.useIntl)(),f=(0,l.O7)(),v=(0,P.D)(),y=(0,c.VK)((()=>o.context.automationStore),[o]),S=(0,c.VK)((()=>y.getActionIds()),[y]),[w,C]=(0,s.useState)(!1),_=S.length<m.FT,T=S.indexOf(i.id),E=0===T,R=T===S.length-1,A=(0,I.F)(),D={key:"duplicate",action:async()=>{C(!0);const e=h.createAndCommit({userAction:"AutomationAction.duplicateAction",environment:f,perform:e=>g.AN({actionStore:i,automationStore:y,environment:f,intl:d,transaction:e})});i.isDefined()&&(0,k.eI)(v,{automation_id:o.context.automationStore.id,automation_action_id:i.id,automation_action_type:i.getType(),from:"duplicate"});try{await e.performResult.onComplete}finally{C(!1)}t()},render:e=>{const t=w?a()(Y.Z,{}):p.Z.duplicate({height:16,width:16}),o=a()(u.FormattedMessage,w?{id:"automations.duplicatingActionButton.label",defaultMessage:"Duplicating...",description:"Duplicating for an automation."}:{id:"automations.duplicateBelowActionButton.label",defaultMessage:"Duplicate below",description:"Duplicate action below for an automation."});return s.createElement(b.Z,n()({},e,{disabled:w,icon:t,title:o}))}},F={key:"delete",action:()=>{h.createAndCommit({userAction:"AutomationAction.removeAction",environment:f,perform:e=>{g.sl({clientContext:o.context,actionStore:i,transaction:e}),i.isDefined()&&(0,k.co)(v,{automation_id:o.context.automationStore.id,automation_action_id:i.id,automation_action_type:i.getType()})}}),t()},render:e=>s.createElement(b.Z,n()({},e,{icon:p.Z.trash({height:16,width:16}),title:a()(u.FormattedMessage,{id:"automations.deleteActionButton.label",defaultMessage:"Delete",description:"Delete action from an automation."})}))},L=[!0,!1].map((e=>{if(!(e&&E||!e&&R))return{key:e?"moveUp":"moveDown",action:()=>{h.createAndCommit({userAction:"AutomationAction.moveAction",environment:f,perform:t=>{let i;i=ee(S,e?T-1:T+1,T),g.kM({clientContext:o.context,transaction:t,newActionIds:i})}}),t()},render:t=>s.createElement(b.Z,n()({},t,{icon:(e?p.Z.arrowUp:p.Z.arrowDown)({width:16,height:16}),title:a()(u.FormattedMessage,e?{id:"automations.moveUpButton.label",defaultMessage:"Move up",description:"Move an automation action up in a list."}:{id:"automations.moveDownButton.label",defaultMessage:"Move down",description:"Move an automation action down in a list."})}))}})).filter(M.$K),V=[!0,!1].map((e=>({key:e?"addStepAbove":"addStepBelow",action:()=>{r(e)},render:t=>s.createElement(b.Z,n()({},t,{disabledFeedback:!0,icon:e?p.Z.insertUp({width:16,height:16}):p.Z.insertDown({width:16,height:16}),title:a()(u.FormattedMessage,e?{id:"automations.addStepAboveButton.label",defaultMessage:"Add step above",description:"Label for a button to add an automation step above another step."}:{id:"automations.addStepBelowButton.label",defaultMessage:"Add step below",description:"Label for a button to add an automation step below another step."})}))})));return s.createElement(x.Z,A,a()(B.Z,{type:B.i.Vertical,sections:[...L.length>0?[{key:"movement",render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0},e)),items:L}]:[],..._?[{key:"addSteps",render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0,topBorder:!0},e)),items:V},{key:"duplicate",render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0,topBorder:!0},e)),items:[D]}]:[],{key:"delete",render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0,topBorder:!0},e)),items:[F]}],initialFocus:0}))}var oe=o(96486),ie=o.n(oe),ne=o(3865),re=o(48777),ae=o(99036),se=o(76218),le=o(6287),ce=o(24677),de=o(98104),pe=o(89728);const ue=s.forwardRef(((e,t)=>{const{variant:o,onClick:i,style:r,icon:c,children:u}=e,m=(0,l.O7)(),g=(0,d.yK)((e=>({button:{..."gray"===o&&{color:e.mediumTextColor},..."blue"===o&&{color:e.blueColor,fontWeight:500},..."error"===o&&{color:e.errorText},maxWidth:"calc(100% + 2px)",marginLeft:1,padding:"0 8px 0 5px",...r},warningIcon:{width:12,height:12,marginLeft:-6,marginLeft:6,fill:e.errorText,color:e.errorText},chevronIcon:{width:10,height:10,marginLeft:4,marginTop:2,fill:e.lightIconColor},spacer:{flexGrow:1}})),[o,r]),h=(0,s.useCallback)((e=>{de.ZH(m),ce.ZH(m),null==i||i(e)}),[i,m]);return a()(E.Z,{renderTooltip:()=>"error"===o?e.errorMessage:null,placement:E.Z.Placement.Bottom,disableTooltip:"error"!==o,delayThreshold:0,render:e=>s.createElement(pe.Z,n()({},e,{style:g.button,icon:c,onClick:h,ref:t,shouldShrink:!0}),a()("div",{style:{...L.Z.textOverflowStyle}},void 0,u),a()("div",{style:g.spacer}),"error"===o&&p.Z.warning(g.warningIcon),p.Z.chevronDown(g.chevronIcon))})}));function me(e){const{errorMessage:t,hasValue:o}=e;return(0,s.useMemo)((()=>t?{variant:"error",errorMessage:t}:o?{variant:"gray"}:{variant:"blue"}),[t,o])}var ge=o(993),he=o(43250),fe=o(17809),ve=o(24666),ye=o(65187);function be(e){window.__c={n:"SimpleFormulaValueTextInput"};const{value:t,parentSpaceId:o,disabled:i,onChange:r,multiline:c,placeholder:p,disableFormattingAndMentions:u,disableMobileActionBar:m,disableEmojiCommands:g}=e,f=(0,l.O7)(),v=(0,d.yK)((e=>({wrap:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,borderRadius:4,padding:c?"6px 10px":"4px 8px",overflow:"hidden",..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},text:c?{minHeight:60}:{whiteSpace:"pre"},placeholder:c?{minHeight:60}:{}})),[c]),y=(0,s.useCallback)((e=>{r({type:"simple",value:e})}),[r]),{store:b}=(0,fe.Cl)({parentSpaceId:o,initialValue:null==t?void 0:t.value,onChange:y}),S=(0,s.useMemo)((()=>c?()=>{const e=ve.default.state;"editing"===e.mode&&h.createAndCommit({userAction:"SimpleFormulaValueTextInput.handleEnter",environment:f,perform:t=>{ge.hJ({environment:f,string:"\n",multiSelection:e.multiSelection,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})}:void 0),[f,c]);return a()("div",{style:v.wrap,className:he.Wh_},void 0,s.createElement(ye.Z,n()({placeholder:p,disabled:i,store:b,style:v.text,placeholderStyle:v.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:g,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,onEnter:S,disableMobileActionBar:m},u?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0}:{})))}var Se=o(82433),we=o(68626),ke=o(60709),Ce=o(77907),_e=o(40721),Me=o(8848),Te=o(21114),Ie=o(59054),Pe=o(70203),xe=o(68056),Be=o(33665),Ze=o(74523),Ee=o(39068),Re=o(84619),Ae=o(29798),De=o(73657),Fe=o(21396);function Le(e){window.__c={n:"FormulaAutocompleteMenu"};const{selection:t,cursorEditorInfo:o,context:i,value:r,onChange:d}=e,p=(null==o?void 0:o.completions)||[],m=(0,l.Fy)(),g=(0,c.qz)(void 0,Ae.Z);(0,s.useEffect)((()=>{g.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[null==t?void 0:t.startIndex,g]);const h=p.map(((e,a)=>({key:a,render:t=>s.createElement(Ve,n()({completion:e,context:i},t)),action:()=>{o&&function(e){const{completion:t,value:o,selection:i,onChange:n,cursorEditorInfo:r}=e,a=(null==i?void 0:i.endIndex)||0;if(t.kind===Se.WY.Token){if(t.token.type===Se.Oy.Checkbox)return;if(t.token.type===Se.Oy.BlockProperty){var s;const e=a-((null===(s=r.completionsInfo)||void 0===s?void 0:s.prefix)||"").length,i=(0,Pe.vY)(o,e,a),l=t.token.collection?(0,Se.SR)(t.token.property):t.token.property,c=(0,Pe.YC)((0,Pe.kb)({collection:t.token.collection,property:l}));return void n({newValue:(0,Pe.P$)(i,[c],e),newSelection:{startIndex:e+1,endIndex:e+1}})}if(t.token.type===Se.Oy.ContextValue){var l;const e=a-((null===(l=r.completionsInfo)||void 0===l?void 0:l.prefix)||"").length,i=(0,Pe.vY)(o,e,a),s=(0,Se.Kv)(t.token.valueId),c=(0,Pe.YC)((0,Pe._Q)({id:s}));n({newValue:(0,Pe.P$)(i,[c],e),newSelection:{startIndex:e+1,endIndex:e+1}})}else{if(t.token.type===Se.Oy.Date)return;if(t.token.type===Se.Oy.Block)return;if(t.token.type===Se.Oy.Person)return;if(t.token.type===Se.Oy.UserProperty){var c;const e=a-((null===(c=r.completionsInfo)||void 0===c?void 0:c.prefix)||"").length,i=(0,Pe.vY)(o,e,a),s=(0,Pe.YC)((0,Pe.rC)(t.token.userProperty));n({newValue:(0,Pe.P$)(i,[s],e),newSelection:{startIndex:e+1,endIndex:e+1}})}else(0,M.t1)(t.token)}}else if(t.kind===Se.WY.LibraryFunction){var d;const e=a-((null===(d=r.completionsInfo)||void 0===d?void 0:d.prefix)||"").length,i=(0,Pe.vY)(o,e,a),s=(0,Pe.V3)(`${t.libraryFunction.name}()`,[]),l=(0,Pe.P$)(i,[s],e),c=e+t.libraryFunction.name.length+1;n({newValue:l,newSelection:{startIndex:c,endIndex:c}})}else if(t.kind===Se.WY.Binding){var p;const e=a-((null===(p=r.completionsInfo)||void 0===p?void 0:p.prefix)||"").length,i=(0,Pe.vY)(o,e,a),s=(0,Pe.V3)(t.text,[]),l=(0,Pe.P$)(i,[s],e),c=e+t.text.length;n({newValue:l,newSelection:{startIndex:c,endIndex:c}})}else(0,M.t1)(t)}({completion:e,value:r,selection:t,onChange:d,cursorEditorInfo:o})}})));let f;return f=m.isPhone?{menuType:ke.og.ActionSheet,disableBottomPadding:!0}:{menuType:ke.og.Popup,width:m.isPhone?180:240},s.createElement(x.Z,f,a()(B.Z,{type:B.i.Vertical,initialFocus:0,store:g,sections:oe.compact([{key:0,render:e=>s.createElement(Z.Z,n()({},e,{title:a()(u.FormattedMessage,{defaultMessage:"Insert a value",id:"formulaAutocompleteMenu.insertAValue.message",description:"Insert a value in a formula."})})),items:h},0===h.length&&{key:1,render:e=>s.createElement(Z.Z,n()({disableDesktopPadding:!0},e),a()(Oe,{})),items:[]}])}))}function Ve(e){const{completion:t,context:o,...i}=e;if(t.kind===Se.WY.Token){if(t.token.type===Se.Oy.Checkbox)return null;if(t.token.type===Se.Oy.BlockProperty)return s.createElement(b.Z,n()({icon:a()(Ne,{valueType:{type:"text"}}),title:t.name??t.token.property},i));if(t.token.type===Se.Oy.ContextValue){const e=(0,Se.vx)(o.valueTypes,(0,Se.Kv)(t.token.valueId));return e?s.createElement(b.Z,n()({icon:a()(Ne,{valueType:e.type}),title:a()("div",{style:{display:"flex"}},void 0,a()(Fe.F,{value:e,format:Re.l.Medium,isSingle:!0,shouldShrink:!0}))},i)):null}if(t.token.type===Se.Oy.Date)return null;if(t.token.type===Se.Oy.Block)return null;if(t.token.type===Se.Oy.Person)return null;if(t.token.type===Se.Oy.UserProperty)return s.createElement(b.Z,n()({icon:a()(Ne,{valueType:Se.VJ[t.token.userProperty]}),title:t.token.userProperty},i));(0,M.t1)(t.token)}else{if(t.kind===Se.WY.LibraryFunction)return s.createElement(b.Z,n()({icon:a()(Ne,{valueType:t.libraryFunction.iconType}),title:t.libraryFunction.name},i));if(t.kind===Se.WY.Binding)return s.createElement(b.Z,n()({title:t.text},i));(0,M.t1)(t)}}function Ne(e){const{valueType:t}=e,o=(0,d.yK)((e=>({icon:{width:14,fill:e.mediumIconColor}})),[]);return"text"===t.type?Ee.wG.text(o.icon):"number"===t.type?Ee.wG.number(o.icon):"checkbox"===t.type?Ee.wG.checkbox(o.icon):"date"===t.type?Ee.wG.date(o.icon):"block"===t.type?Ee.wG.relation(o.icon):"person"===t.type?Ee.wG.person(o.icon):"select"===t.type?Ee.wG.select(o.icon):"array"===t.type?Ee.wG.multi_select(o.icon):"function"===t.type?Ee.wG.formula(o.icon):"unknown"===t.type?null:void(0,M.t1)(t)}function Oe(){return window.__c={n:"NoResultsMenuItem"},a()(De.Z,{caption:a()(u.FormattedMessage,{defaultMessage:"No results",id:"FormulaAutocompleteMenu.noResults.message",description:"Shows when there are no search results."})})}var Ue=o(97762),He=o(83355),ze=o(1302),We=o(13991),je=o(14577),Ke=o(15095),Ye=o(42875),Ge=o(62193),Xe=o(44805),qe=o(43132),$e=o(98724),Je=o(56971),Qe=o(95477),et=o(14976),tt=o(62619),ot=o(33929),it=o(55227),nt=o(70219),rt=o(89086),at=o(30874),st=o(29595),lt=o(93262);class ct extends He.Z{constructor(){super(...arguments),this.editor=null,this.mergeEditorRefs=(0,Ge.s)(),this.renderContentContainer=(e,t)=>{let{leafRef:o,wrapperRef:i,...r}=e;return s.createElement("div",n()({ref:i},r,{style:{flexGrow:1}}),s.createElement(st.Z,{ref:this.mergeEditorRefs(this.editorRef,o),style:this.getContentEditableStyle(),getDisabled:this.isDisabled,getHtml:()=>this.getHtml(this.textValueStore.state,this.props.errorRanges),getSelection:this.getContainerSelection,onMutation:this.handleMutation,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,suppressNewlineEvents:!1,placeholder:" "}))},this.renderSyntaxTokens=(e,t)=>{const o=it.kF(t,e),{device:i}=this.environment,n=t.map(Pe.hD).map(((e,t)=>Xe.fn({annotations:e,theme:this.theme,getRecordModel:this.props.store.getRecordModel,spaceId:this.props.parentSpaceId})));return o.map(((e,o)=>{const r=t[e.textTokenIndex],l=n[e.textTokenIndex];return Pe.km(r)?(0,Xe.$i)({args:{textValue:{value:t,spaceId:this.props.parentSpaceId},getRecordModel:this.props.store.getRecordModel,getRecordRole:this.props.store.getRecordRole,disableHover:!1,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,Ye.r)(),disabled:!1,isAndroid:i.isAndroid,isSafariOrIOS:i.isSafari||i.isIOS,isWindows:i.isWindows,showEmojiInline:i.isWindows,emojiType:"raw",highlightDiscussionId:void 0,theme:this.theme,intl:ot.default.getIntl(),renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:Qe.Z.domainBaseUrl,publicDomainName:Qe.Z.publicDomainName,currentUserId:this.environment.currentUser.id,overwriteBaseUrlFromSpaceId:(0,nt.b)(this.environment),externalIntegrations:at.Z.integrations.state,formulaValueTypes:this.props.valueTypes},style:l.style,classNames:l.classNames,index:o,token:r,tokenValue:Pe.Wi(r),tokenAnnotations:Pe.hD(r)}):s.createElement(s.Fragment,null,a()("span",{className:[e.classNames||"",...l.classNames].join(" "),style:l.style,"data-token-index":e.textTokenIndex},o,e.value))}))},this.handleClick=e=>{et.SD({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.isDisabled()})},this.handleMutation=e=>{let{newValue:t}=e;h.createAndCommit({userAction:"FormulaInputText.handleMutation",environment:this.environment,perform:e=>{ge.aS({environment:this.environment,store:this.props.store,newValue:t,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableDateReminderMentions:!0,disableFilters:!0,transaction:e})}})},this.handleDelete=e=>{if(this.isDisabled())return;const t=ve.default.state;"editing"===t.mode&&t.multiSelection.start.store===this.props.store&&h.createAndCommit({userAction:"FormulaInputText.handleDelete",environment:this.environment,perform:o=>{Je.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!0,transaction:o,event:e})}})},this.handleBackspace=e=>{if(this.isDisabled())return;const t=ve.default.state;if("editing"===t.mode&&t.multiSelection.start.store===this.props.store){if(Je.YV({device:this.environment.device,event:e,multiSelection:t.multiSelection}))return;h.createAndCommit({userAction:"FormulaInputText.handleBackspace",environment:this.environment,perform:o=>{Je.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!1,transaction:o,event:e})}})}},this.handleShiftEnter=e=>{var t;if(this.isDisabled())return;if(null===(t=e.preventDefault)||void 0===t||t.call(e),this.editor&&this.editor.isComposing)return;const o=ve.default.state,i="editing"===o.mode&&(0,xe.QY)(o.multiSelection);i&&h.createAndCommit({userAction:"FormulaInputText.handleShiftEnter",environment:this.environment,perform:e=>{ge.hJ({environment:this.environment,store:this.props.store,string:"\n",selection:i.selection,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})},this.handleTab=e=>{if(this.isDisabled())return;e.preventDefault();const t=ve.default.state,o="editing"===t.mode&&(0,xe.QY)(t.multiSelection);o&&h.createAndCommit({userAction:"FormulaInputText.handleTab",environment:this.environment,perform:e=>{ge.wA({environment:this.environment,store:this.props.store,selection:o.selection,transaction:e,shouldStripTokens:!1})}})},this.handleUntab=e=>{if(this.isDisabled())return;e.preventDefault();const t=ve.default.state,o="editing"===t.mode&&(0,xe.QY)(t.multiSelection);o&&h.createAndCommit({userAction:"FormulaInputText.handleUntab",environment:this.environment,perform:e=>{ge.O5({environment:this.environment,store:this.props.store,selection:o.selection,transaction:e,shouldStripTokens:!1})}})},this.handleAnnotation=(e,t)=>{this.isDisabled()||(t.preventDefault(),$e.aS({environment:this.environment,annotation:e}),this.flushRenderQueue())},this.handleCopy=e=>{qe.JG({environment:this.environment,event:e})},this.handleCut=e=>{this.isDisabled()?e.preventDefault():qe.by({environment:this.environment,event:e})},this.handlePaste=e=>{this.isDisabled()?e.preventDefault():h.createAndCommit({userAction:"FormulaInputText.handlePaste",environment:this.environment,perform:t=>{qe.v({environment:this.environment,event:e,disableEmbedMenu:!0,transaction:t,onPasteFiles:qe.AL})}})},this.handleMoveUp=e=>{h.createAndCommit({userAction:"FormulaInputText.handleMoveUp",environment:this.environment,perform:e=>{ge.fs({environment:this.environment,transaction:e,direction:"up"})}})},this.handleMoveDown=e=>{h.createAndCommit({userAction:"FormulaInputText.handleMoveDown",environment:this.environment,perform:e=>{ge.fs({environment:this.environment,transaction:e,direction:"down"})}})},this.handleMouseOver=e=>{et.vO({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.isDisabled()})},this.handleMouseOut=e=>{et.kV({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.isDisabled()})},this.isDisabled=()=>this.props.disabled,this.createSyntaxToken=e=>tt.Gs(e)?[e.data]:tt.kK(e)?[e.textContent||"",e.className]:void 0,this.getHtml=(e,t)=>{const{Prism:o}=this.props,i=Pe.Q(e),n=o.languages.jsx,r=document.createElement("div"),l=o.highlight(i,n,"jsx");r.innerHTML=this.flattenHtml(l);const c=ie().compact(Array.from(r.childNodes).map(this.createSyntaxToken));for(const a of t)e=Pe.aS({textValue:e,selection:a,annotation:[Pe.GK.FormulaError]});const d=this.renderSyntaxTokens(ie().compact(c),e||[]),p=a()(s.Fragment,{},void 0,d,a()("span",{},void 0,"\n"));return Ue.renderToStaticMarkup(p)},this.flattenHtml=e=>{let t="";const o=document.createElement("div");o.innerHTML=e;const i=tt.kd(o);for(const n of i){const e=ie().escape(n.data);if(n.parentNode!==o){t+=`<span class="${ie().escape(n.parentNode.className)}">${e}</span>`}else t+=e}return t},this.clearBrowserSelection=()=>{var e;null===(e=this.getEditorNode())||void 0===e||e.blur()},this.textValueStore=new je.Z((()=>this.props.store.getValue()||[]),{debugName:"FormulaInputText.textValueStore"}),this.isEditing=this.createComputedStore((()=>{var e;const t=ve.default.state;return"editing"===t.mode&&(null===(e=(0,xe.QY)(t.multiSelection))||void 0===e?void 0:e.store)===this.props.store})),this.getContainerSelection=()=>{if(this.isEditing.state)return(0,rt.HE)(this.props.store)},this.getEndSelection=()=>{const e=Ke.p4(Pe.Q(this.textValueStore.state));return{startIndex:e.length,endIndex:e.length}},this.editorRef=e=>{this.editor=e}}willMount(e){e.focus&&de.NX({store:e.store})}renderComponent(){const{store:e,disabled:t}=this.props;return a()(lt.Z,{store:e,disabled:t,clearBrowserSelection:this.clearBrowserSelection,getEndSelection:this.getEndSelection,onClick:this.handleClick,onDelete:this.handleDelete,onBackspace:this.handleBackspace,onShiftEnter:this.handleShiftEnter,onCommandEnter:ie().identity,onCommandShiftEnter:ie().identity,onTab:this.handleTab,onUntab:this.handleUntab,onToggleBold:e=>this.handleAnnotation(["b"],e),onToggleItalics:e=>this.handleAnnotation(["i"],e),onToggleUnderline:e=>this.handleAnnotation(["_"],e),onToggleStrike:e=>this.handleAnnotation(["s"],e),onToggleCode:ie().identity,onCopy:this.handleCopy,onCut:this.handleCut,onPaste:this.handlePaste,onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,render:this.renderContentContainer,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!0,canInsertText:!0,canSelectionDrag:!0,disableMobileActionBar:!0,topBottomPadding:40,pasteBehavior:"inline"})}getEditorNode(){var e;return(null===(e=this.editor)||void 0===e?void 0:e.getNode())||void 0}flushRenderQueue(){ze.default.flush()}getContentEditableStyle(){return{flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:L.Z.getCompositeFontFamily(We.SP).githubMono,fontSize:14,tabSize:2,whiteSpace:"pre",borderRadius:3,minHeight:"1em",padding:2,paddingTop:6,height:"100%"}}}ct.displayName="FormulaInputText";const dt=(0,Ce.withDependency)(Ce.deps.prismjs,((e,t)=>s.createElement(ct,n()({},t,{Prism:e}))));function pt(e){window.__c={n:"FormulaInput"};const{errors:t,value:o,parentSpaceId:i,inputHeader:n,onChange:r,disabled:p,context:m}=e,g=(0,l.Fy)(),h=(0,u.useIntl)(),{store:f,setValue:v}=(0,fe.Cl)({parentSpaceId:i,initialValue:o,onChange:r}),y=(0,s.useCallback)((e=>{if(v(e.newValue),e.newSelection){const t={start:{store:f,index:e.newSelection.startIndex},end:{store:f,index:e.newSelection.endIndex}};de.NA({multiSelection:t})}}),[v,f]),[b]=(0,Ie.r5)((()=>Ce.deps.formulas.loader()),[]),S=b.value,w=(0,c.VK)((()=>{var e;const t=ve.default.state;if("editing"===t.mode&&(null===(e=(0,xe.QY)(t.multiSelection))||void 0===e?void 0:e.store)===f)return{startIndex:t.multiSelection.start.index,endIndex:t.multiSelection.end.index}}),[f]),k=(0,c.VK)((()=>function(e,t){const{parserErrors:o,typeErrors:i,evaluatorErrors:n}=e;let r=[];i&&i.length>0?r=i.map((e=>(0,Te.ic)(e))):n&&n.length>0&&(r=n.map((e=>(0,Te.OY)(e))));o&&r.push(...o.map((e=>(0,Te.sG)(e))));if(0===r.length)return;return t.formatList([...new Set(r)],{type:"unit",style:"long"})}(t,h)),[t,h]),C=(0,c.VK)((()=>{if(!o)return[];const e=(0,Pe.Q)(o).length;return function(e,t){const o=[];if(e.parserErrors)for(const i of e.parserErrors){const e="eof"===i.offset?{startIndex:t-1,endIndex:t}:{startIndex:i.offset,endIndex:i.offset+1};o.push(e)}if(e.typeErrors)for(const i of e.typeErrors){const e={startIndex:i.node.startOffset,endIndex:i.node.endOffset+1};o.push(e)}if(e.evaluatorErrors)for(const i of e.evaluatorErrors)if((0,Se.hp)(i)){const e={startIndex:i.node.startOffset,endIndex:i.node.endOffset+1};o.push(e)}return o}(t,e)}),[t,o]),[_,M]=(0,s.useState)(void 0),T=(0,s.useRef)(1);(0,s.useEffect)((()=>{T.current++;const e=T.current;!async function(){if(S){const t=await S.getFormulaEditorInfoAtPosition({formula:o??[],inputPosition:w&&w.startIndex===w.endIndex?w.startIndex:0,context:m,hideDeprecatedCompletions:!0});we.x.isSuccess(t)&&T.current===e&&M(t.value)}}()}),[o,w,S,m]);const I=(0,d.yK)((e=>({error:{color:Me.ZP.redWithAlpha(.8),justifySelf:"flex-start"},container:{display:"flex",height:"100%",paddingBottom:30},inputWrap:{width:g.isMobile?"50vw":void 0,flexGrow:1,overflow:"auto",height:"100%",padding:6,display:"flex",flexDirection:"column"},messageText:{fontSize:L.Z.fontSize.UISmall.desktop},desktopWrap:{zIndex:1,position:"absolute",alignSelf:"flex-end",justifySelf:"flex-end",bottom:0,display:"flex",flex:"none",alignItems:"center",justifyContent:k?void 0:"center",fontSize:12,paddingLeft:8,paddingRight:8,minHeight:30,height:"auto",width:"100%",color:e.mediumTextColor}})),[g.isMobile,k]);let P;return P=k?a()("span",{style:I.error},void 0,k):g.isMobile?null:s.createElement(s.Fragment,null,a()("span",{},void 0,a()(u.FormattedMessage,{id:"formula2Input.keyboardShortcutHint",defaultMessage:"Enter to autocomplete, Shift+Enter to add a new line",description:"Caption that describes keyboard shortcut to autocomplete and add a new line."})),a()("div",{style:{marginLeft:"auto"}},void 0,a()(Ze.Z,{title:a()("span",{style:I.messageText},void 0,a()(u.FormattedMessage,{defaultMessage:"Learn more about formulas",id:"formula2Input.learnMore.button.label",description:"Button label for the learn more button in the formula input"})),href:(0,Be.UY)("guides.formulas"),analyticsFrom:"formula_property_menu"}))),a()("div",{style:I.container},void 0,a()("div",{style:I.inputWrap},void 0,n,a()(dt,{value:o,focus:!0,store:f,disabled:p,parentSpaceId:i,valueTypes:m.valueTypes,errorRanges:C},"input")),a()(Le,{value:o,context:m,selection:w,cursorEditorInfo:_,onChange:y}),a()("div",{style:I.desktopWrap},void 0,P))}var ut=o(30387);const mt=(0,Ce.withDependency)(Ce.deps.formulas,((e,t)=>s.createElement(gt,n()({},t,{formulas:e}))));function gt(e){window.__c={n:"FormulaInputMenu"};const{type:t,value:o,onChange:i,disabled:n,contextStore:r,formulas:{addTypesToFormulaAST:d,convertFormulaCSTToAST:m,parseFormulaInput:g,processFormulaInput:h}}=e,f=(0,se.LX)(t),v=(0,l.Fy)(),y=(0,s.useCallback)((e=>{i({type:"formula",value:e})}),[i]),b=(0,s.useCallback)((()=>{i({type:"simple",value:null==o?void 0:o.value})}),[i,o]),S=(0,c.VK)((()=>r.context.parentRecordStore.getSpaceId()),[r.context.parentRecordStore]),w=(0,c.Kw)(r.compilationResultStore),k=(0,s.useMemo)((()=>(0,Se.yf)(r.context.parentRecordStore.getRecordValue,r.context.parentRecordStore.loadRecordValue)),[r.context.parentRecordStore]),C=(0,c.VK)((()=>{if(we.x.isFail(w))return;return{valueTypes:w.value.valueTypes,handleDataRequest:k}}),[w,k],{useDeepEqual:!0}),[_,M]=(0,s.useMemo)((()=>{const e=null==o?void 0:o.value;return e?h(e):[void 0,void 0]}),[null==o?void 0:o.value,h]),T=(0,c.VK)((()=>{if(_)return g(_,M)}),[_,M,g]),I=(0,c.VK)((()=>{if(T)return m(T[0])}),[T,m]),[P,B]=(0,s.useState)(void 0);(0,s.useEffect)((()=>{!async function(){if(I&&C&&we.x.isSuccess(I)){const e=await d(I.value,C,M);B(e)}else B(void 0)}()}),[I,C,M,T,d]);const Z=(0,c.VK)((()=>({parserErrors:(null==T?void 0:T[1])??[],typeErrors:(null==P?void 0:P.errors)??[],evaluatorErrors:[]})),[null==P?void 0:P.errors,T]);let E;return E=v.isMobile?{menuType:ke.og.Modal,right:a()(_e.DoneMenuText,{}),onClickRight:parent.close}:{menuType:ke.og.Popup,maxHeight:"50vh",width:600,height:320,disableHeaderBorder:!0},S&&C?s.createElement(x.Z,E,a()(pt,{value:null==o?void 0:o.value,context:C,onChange:y,returnType:f,parentSpaceId:S,disabled:n,inputHeader:a()(pe.Z,{isGray:!0,isSmall:!0,icon:p.Z.arrowLeft,onClick:b},void 0,s.createElement(u.FormattedMessage,ut.s.back)),errors:Z,focus:!0})):null}function ht(e){window.__c={n:"NumberInput"};const{value:t,parentSpaceId:o,disabled:i,buttonPopupStore:n,onChange:r}=e,l=(0,d.yK)((e=>({wrap:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,borderRadius:3,padding:4}})),[]),c=(0,s.useCallback)((e=>{"="===(0,Pe.Q)(e)&&(0,fe.V1)()?(r({type:"formula",value:void 0}),n.setState({open:!0})):r({type:"simple",value:e})}),[r,n]),{store:p}=(0,fe.Cl)({parentSpaceId:o,initialValue:null==t?void 0:t.value,onChange:c});return a()("div",{style:l.wrap},void 0,a()(ye.Z,{disabled:i,store:p,pasteBehavior:"inline",disableSlashCommands:!0,disableEmojiCommands:!0,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableEmbedMenu:!0,disableMobileActionBar:!0,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableStyleAnnotations:!0,disableEquationInteraction:!0}))}var ft=o(93313),vt=o(18466),yt=o(17731),bt=o(75311);function St(e){const{value:t,type:o,currentSimpleFormulaValueTokens:i,contextStore:n,context:r}=e,{collectionStore:l,property:p}=r,u=(0,d.yK)((()=>({tokenWrap:{display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginTop:6}})),[]),m=(0,bt.M)(l,p),g=(0,c.VK)((()=>(0,fe.V1)()),[]);if("formula"===(null==t?void 0:t.type)&&t.value&&g)return s.createElement(kt,e);if("text"===o.type||"number"===o.type)return null;if("date"===o.type||"select"===o.type||"checkbox"===o.type){const e=i[0];return void 0===e?a()(wt,{}):a()("div",{style:u.tokenWrap},void 0,a()(ft.K,{token:e,contextStore:n,disabled:!0,currentSimpleFormulaValueTokens:i,context:r}))}if("person_array"===o.type||"block_array"===o.type||"select_array"===o.type)return 0===i.length?a()(wt,{}):a()("div",{style:u.tokenWrap},void 0,m(i,"first").map(((e,t)=>a()(ft.K,{token:e,contextStore:n,disabled:!0,currentSimpleFormulaValueTokens:i,context:r},t))));(0,M.t1)(o)}function wt(){window.__c={n:"ValueEmptyPlaceholder"};const e=(0,d.yK)((e=>({placeholderText:{color:e.lightTextColor}})),[]);return a()("div",{style:e.placeholderText},void 0,s.createElement(u.FormattedMessage,ut.s.personSelect))}function kt(e){window.__c={n:"MinimalFormulaText"};const{value:t,contextStore:o}=e,i=(0,l.O7)(),n=(0,d.Fg)(),r=(0,d.yK)((e=>({wrap:{display:"flex",alignItems:"center",pointerEvents:"none",fontFamily:L.Z.getCompositeFontFamily(We.SP).githubMono,fontSize:12,flexGrow:1,...L.Z.textOverflowStyle},icon:{width:14,fill:e.mediumIconColor,marginRight:6}})),[]),u=(0,yt.kw)(),m=(0,c.VK)((()=>i.KatexStore.getKatex()),[i]),g=(0,c.VK)((()=>o.context.parentRecordStore.getSpaceId()),[o.context.parentRecordStore]),h=(0,c.Kw)(o.compilationResultStore),f=we.x.isSuccess(h)?h.value.valueTypes:void 0,v=(0,s.useMemo)((()=>vt.Z.withListenerIgnored((()=>(0,et.IY)({environment:i,textValue:null!=t&&t.value&&g?{value:t.value,spaceId:g}:void 0,parentStore:o.context.parentRecordStore,disableHover:!1,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:n,emojiType:u,katex:m,parentBlockId:void 0,renderedPageBlockId:void 0,formulaValueTypes:f||[]})))),[t,g,i,o.context.parentRecordStore,u,m,n,f]);return a()("div",{style:r.wrap},void 0,p.Z.typesFormula(r.icon),v)}function Ct(e){const{type:t,value:o,disabled:i,contextStore:r}=e,p=(0,l.Fy)(),u=!o||"simple"===o.type,m=(0,c.VK)((()=>(0,se.A6)(null==o?void 0:o.value)),[o]),g=(0,d.yK)((e=>({button:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow}})),[]),h=(0,c.VK)((()=>r.context.parentRecordStore.getSpaceId()),[r.context.parentRecordStore]),f=(0,c.qz)(void 0,v.Z);return h?"number"===t.type&&u?s.createElement(ht,n()({},e,{parentSpaceId:h,buttonPopupStore:f})):"text"===t.type?s.createElement(be,n()({},e,{parentSpaceId:h})):a()(S.Z,{popupType:p.isMobile?G.kQ.SlideUp:G.kQ.Popup,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,buttonPopupStore:f,disabled:i,renderOrigin:t=>s.createElement(ue,n()({variant:"gray"},t,{style:g.button}),s.createElement(St,n()({},e,{currentSimpleFormulaValueTokens:m}))),render:t=>u?s.createElement(ft.a,n()({},e,{parent:t,currentSimpleFormulaValueTokens:m})):s.createElement(mt,e)}):null}var _t=o(61053);function Mt(e){window.__c={n:"AutomationPropertyPicker"};const{currentValue:t,collectionStore:o,onChange:i,onRemove:r,getProperties:p,disabled:m,alreadyHaveProperties:g}=e,h=(0,l.O7)(),v=(0,d.Fg)(),{device:y}=h,b=(0,c.VK)((()=>o.getSchema()??{}),[o]),w=(0,c.VK)((()=>o.getFormat()??{}),[o]),k=(0,c.VK)((()=>t?o.getSchema()[t]:void 0),[t,o]),C=(0,d.yK)((e=>({propertyIcon:{fill:e.lightTextColor}})),[]),_=(0,f.d)();return a()(S.Z,{popupType:_,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:m,renderOrigin:e=>s.createElement(ue,n()({},e,{icon:k?e=>a()(Ee.ZP,{icon:void 0,type:k.type,size:14,theme:v,style:{...e,...C.propertyIcon}}):void 0,variant:g||k?k?"default":"gray":"blue"}),k?s.createElement(s.Fragment,null,a()("div",{style:{maxWidth:140,...L.Z.textOverflowStyle}},void 0,k.name)):a()(u.FormattedMessage,g?{id:"automations.propertyPicker.buttonPlaceholderAlreadyHaveProperties",defaultMessage:"Edit another property",description:"Choose another property to set."}:{id:"automations.propertyPicker.buttonPlaceholder",defaultMessage:"Edit a property",description:"Choose a property to set."})),render:e=>{const o=(0,I.U)({device:y,width:280,paddingTop:4});return s.createElement(x.Z,o,a()(_t.Z,{schema:b,format:w,showRemoveOption:Boolean(r),currentProperty:t,getProperties:p,onAccept:t=>{t?i(t):null==r||r(),e.close()}}))}})}const Tt=(0,u.defineMessages)({replaceActionLabel:{id:"automations.AutomationActionSetPropertiesSection.replaceAction.label",defaultMessage:"Replace with",description:"Replace a multi-select property option."},appendActionLabel:{id:"automations.AutomationActionSetPropertiesSection.appendAction.label",defaultMessage:"Add",description:"Append a multi-select option to a multi-select property."},removeActionLabel:{id:"automations.AutomationActionSetPropertiesSection.removeAction.label",defaultMessage:"Remove",description:"Remove a multi-select option from a multi-select property."},titlePlaceholder:{id:"automations.AutomationActionSetPropertiesSection.titlePlaceholder",defaultMessage:"Untitled",description:"Placeholder for an input that lets the user set the name of a newly created page."}});function It(e){const{contextStore:t,actionStore:o,collectionStore:i,disabled:n,showSetPropertyActions:r}=e,p=(0,l.O7)(),u=(0,d.yK)((e=>({addPropertyValuePlaceholder:{color:e.mediumTextColor,flexGrow:1,textAlign:"right"},addPropertyRow:{display:"flex",alignItems:"center"}})),[]),m=(0,c.VK)((()=>{const e=o.getConfigStore().getKeyStore("properties").getValue()??[];return At({schema:i.getSchema(),propertyKeys:e,disallowedPropertyKeys:[]})}),[o,i]),g=(0,s.useCallback)((e=>{var t;const i=((null===(t=o.getConfig())||void 0===t?void 0:t.properties)||[]).filter((t=>t!==e)).concat(e);h.createAndCommit({userAction:"AutomationActionSetPropertiesSection.propertiesChange",environment:p,perform:e=>{V.sW({store:o.getConfigStore(),data:{properties:i},transaction:e})}})}),[o,p]),f=(0,s.useCallback)((()=>Rt({collectionStore:i,actionStore:o})),[o,i]),v=(0,c.VK)((()=>0===Rt({collectionStore:i,actionStore:o}).length),[o,i]);return s.createElement(s.Fragment,null,m.length>0&&a()(Pt,{currentProperties:m,contextStore:t,actionStore:o,collectionStore:i,showSetPropertyActions:r,disabled:n}),!n&&!v&&a()("div",{style:u.addPropertyRow},void 0,a()(Mt,{currentValue:void 0,collectionStore:i,contextStore:t,onChange:g,disabled:n,getProperties:f,alreadyHaveProperties:m.length>0})))}function Pt(e){window.__c={n:"PropertySectionList"};const{currentProperties:t,contextStore:o,actionStore:i,collectionStore:n,showSetPropertyActions:r,disabled:l}=e,c=(0,s.useRef)(null),p=H(c),u=(0,s.useMemo)((()=>Boolean(p&&p.width<320)),[p]),m=(0,d.yK)((()=>({wrap:{display:"grid",gridTemplateColumns:u?"1fr":"auto 1fr",alignItems:"center",rowGap:u?2:4,columnGap:4}})),[u]);return s.createElement("div",{style:m.wrap,ref:c},t.map((e=>a()(xt,{contextStore:o,collectionStore:n,actionStore:i,disabled:l,property:e,showSetPropertyActions:r},e))))}function xt(e){const{contextStore:t,actionStore:o,collectionStore:i,property:r,disabled:p,showSetPropertyActions:m,topBorder:g}=e,f=(0,l.O7)(),v=(0,u.useIntl)(),y=(0,d.yK)((e=>({propertyName:{...g?{borderTop:`1px solid ${e.accentColors.gray[100]}`,paddingTop:8,marginTop:4}:{},marginRight:4},propertyValue:{display:"flex",gap:4,minWidth:"0px"}})),[g]),b=(0,s.useMemo)((()=>{if("title"===r)return v.formatMessage(Tt.titlePlaceholder)}),[v,r]),S=(0,s.useCallback)((e=>{const t=o.getConfig(),i=(null==t?void 0:t.properties)||[],n=i.findIndex((e=>e===r));if(n<0||e===r)return;const a=i.filter((t=>t!==e&&t!==r));a.splice(n,0,e),h.createAndCommit({userAction:"AutomationActionSetPropertiesSection.setProperties",environment:f,perform:e=>{V.sW({store:o.getConfigStore(),data:{properties:a,values:{...null==t?void 0:t.values,[r]:void 0}},transaction:e})}})}),[r,o,f]),w=(0,s.useCallback)((()=>{var e;const t=o.getConfig(),i=null==t||null===(e=t.properties)||void 0===e?void 0:e.filter((e=>e!==r));h.createAndCommit({userAction:"AutomationActionSetPropertiesSection.removeProperty",environment:f,perform:e=>{V.sW({store:o.getConfigStore(),data:{properties:i,values:{...null==t?void 0:t.values,[r]:void 0}},transaction:e})}})}),[r,o,f]),k=(0,s.useCallback)((()=>Rt({collectionStore:i,actionStore:o})),[o,i]),C=(0,c.VK)((()=>{const e=i.getSchema()[r];if(e)return e}),[i,r]),_=(0,c.VK)((()=>{if(C)return(0,se.qW)({table:le.v,id:i.id,spaceId:i.getSpaceId()},r,C)}),[i,C,r]),M=(0,c.VK)((()=>null==C?void 0:C.type),[C]),T=(0,c.VK)((()=>o.getConfigStore().getKeyStore("values").getKeyStore(r)),[o,r]),I=(0,c.VK)((()=>T.getValue()),[T]),P=(0,c.VK)((()=>t.context.parentRecordStore.getSpaceId()),[t.context.parentRecordStore]),x=(0,c.VK)((()=>o.id),[o]),B=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"AutomationActionSetPropertiesSection.handleValueChange",environment:f,perform:t=>{V.sO({store:T,value:e,transaction:t})}})}),[f,T]),Z=(0,c.VK)((()=>(0,F.o9)(I)),[I]),E=(0,s.useCallback)((e=>{B({action:Z,value:e})}),[B,Z]),R={type:"collection",collectionStore:i,property:r};if(!_||!P)return null;const A=function(e){if("email"===e||"phone_number"===e||"url"===e)return{disableEmojiCommands:!0,disableFormattingAndMentions:!0};return{}}(M);return s.createElement(s.Fragment,null,a()("div",{style:y.propertyName},void 0,a()(Mt,{currentValue:r,contextStore:t,collectionStore:i,onChange:S,disabled:p,getProperties:k,onRemove:w})),a()("div",{style:y.propertyValue},void 0,m&&C&&re.Y[C.type]&&a()(Bt,{value:I,onChange:B,disabled:p}),s.createElement(Ct,n()({},A,{type:_,actionId:x,value:null==I?void 0:I.value,onChange:E,disabled:p,contextStore:t,context:R,placeholder:b,disableMobileActionBar:!0}))))}function Bt(e){window.__c={n:"SetPropertyListActionDropdownButton"};const{value:t,disabled:o}=e,i=(0,F.o9)(t),r=(0,f.d)();return a()(S.Z,{popupType:r,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:o,renderOrigin:e=>s.createElement(ue,n()({variant:"gray"},e),a()(Et,{action:i})),render:t=>s.createElement(Zt,n()({},e,{parent:t}))})}function Zt(e){window.__c={n:"SetPropertyListActionDropdownMenu"};const{value:t,onChange:o,parent:i}=e,r=(0,I.F)({width:250}),l=oe.compact(F.E2.map(((e,r)=>({key:r,render:o=>s.createElement(b.Z,n()({},o,{disabled:!1,title:a()(Et,{action:e}),checkState:(null==t?void 0:t.action)===e})),action:()=>{o({value:null==t?void 0:t.value,action:e}),i.close()}}))));return s.createElement(x.Z,r,a()(B.Z,{type:B.i.Vertical,sections:[{key:0,render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0},e)),items:l}],initialFocus:0}))}function Et(e){const{action:t}=e;return"replace"===t?s.createElement(u.FormattedMessage,Tt.replaceActionLabel):"append"===t?s.createElement(u.FormattedMessage,Tt.appendActionLabel):"remove"===t?s.createElement(u.FormattedMessage,Tt.removeActionLabel):void(0,M.t1)(t)}function Rt(e){var t;const{collectionStore:o,actionStore:i}=e,n=o.getSchema(),r=(null===(t=i.getConfig())||void 0===t?void 0:t.properties)??[];return At({schema:n,propertyKeys:Object.keys(n),disallowedPropertyKeys:r})}function At(e){const{schema:t,disallowedPropertyKeys:o,propertyKeys:i}=e;return i.filter((e=>{const i=t[e];if(!i)return!1;const n=i.type;return!(!ne.pb[n]||(0,ae.NK)(i))&&!o.includes(e)}))}var Dt=o(98459),Ft=o(3815),Lt=o(71846),Vt=o(76798);function Nt(e){window.__c={n:"AutomationCollectionPicker"};const{currentValue:t,contextStore:o,onChange:i,disabled:r,errorMessage:d}=e,p=(0,l.O7)(),{device:m}=p,g=(0,c.VK)((()=>t?Ft.NW.createChildStore(o.context.parentRecordStore,t):void 0),[t,o.context.parentRecordStore]),h=(0,f.d)(),v=me({errorMessage:d,hasValue:Boolean(g)});return a()(S.Z,{popupType:h,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:r,renderOrigin:e=>s.createElement(ue,n()({},v,e),g?a()(Vt.Z,{store:g}):a()(u.FormattedMessage,{id:"automations.databasePicker.buttonPlaceholder",defaultMessage:"Select database",description:"Select a database to add to."})),render:e=>{const t=(0,I.U)({device:m,width:280});return s.createElement(x.Z,t,a()("div",{style:{paddingTop:6}},void 0,a()(Lt.Z,{requireEditPermissions:!0,collectionContextStore:"button_property"===o.context.type?o.context.collectionContextStore:void 0,selectedCollectionStore:g,context:Lt.S.Automation,onAccept:t=>{i({...t.pointer,spaceId:(0,Dt.CG)(t.pointer.spaceId)}),e.close()},parentStore:o.context.parentRecordStore})))}})}var Ot=o(12534),Ut=o(61134),Ht=o(68709),zt=o(17748),Wt=o(66094);const jt=(0,u.defineMessages)({aboveButtonLabel:{id:"automations.DuplicateBlocksAction.aboveButtonLabel",defaultMessage:"Above button",description:"Label used for inserting blocks before the button"},belowButtonLabel:{id:"automations.DuplicateBlocksAction.belowButtonLabel",defaultMessage:"Below button",description:"Label used for inserting blocks after the button"}});function Kt(e){const{actionStore:t,disabled:o,contentParentPointer:i}=e,n=(0,l.O7)(),r=(0,d.yK)((e=>({listWrap:{background:e.contentBackground,boxShadow:e.inputBoxShadow,padding:"3px 9px",borderRadius:5,minHeight:64,..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"}})),[]),p=(0,c.VK)((()=>Ft.G.createChildStore(t,i)),[t,i]),m=(0,c.VK)((()=>p.getContentStore()),[p]),f=(0,s.useCallback)((e=>{(0,Ot.ZP)({event:e,context:Ot.Af.EditorClick,callback:()=>{if(!m)return;(m.getValue()||[]).length>0||h.createAndCommit({userAction:"DuplicateBlocksAction.handleListClick",environment:n,perform:e=>{g.Nj({environment:n,parentStore:m,transaction:e})}})}})}),[n,m]);return m?s.createElement(s.Fragment,null,a()(Wt.Z,{store:p,analyticsName:"duplicate_blocks_action",isListContainer:!0},void 0,a()(Ht.p,{allowSelectionWithin:!0},void 0,a()("div",{style:r.listWrap,onClick:f,className:he.Wh_},void 0,a()(Ut.O,{displayName:"DuplicateBlocksActionContent",disabled:o},void 0,a()(zt.Z,{disabled:o,store:m,emptyPlaceholder:a()("div",{style:r.emptyPlaceholder},void 0,a()(u.FormattedMessage,{id:"automations.DuplicateBlocksAction.emptyPlaceholder",defaultMessage:"Click to edit or drop blocks here…",description:"Placeholder for empty state."})),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})))))):null}const Yt={before:{icon:p.Z.insertUp({width:16}),key:"before",title:jt.aboveButtonLabel},after:{icon:p.Z.insertDown({width:16}),key:"after",title:jt.belowButtonLabel}};function Gt(e){window.__c={n:"InsertBlockInDropdownButton"};const{actionStore:t,disabled:o}=e,i=(0,u.useIntl)(),r=(0,d.yK)((e=>({button:{fontWeight:"normal"}})),[]),l=(0,f.d)(),p=(0,c.VK)((()=>t.getInsertionPoint()),[t]),m=Object.values(Yt),g=m.find((e=>e.key===p));return g?a()(S.Z,{popupType:l,alignmentToOrigin:S.Z.Alignment.End,disabled:o,placementToOrigin:S.Z.Placement.Bottom,originGap:0,renderOrigin:e=>s.createElement(ue,n()({style:r.button,variant:"gray"},e),i.formatMessage(g.title)),render:e=>a()(Xt,{actionStore:t,currentOption:g,options:m,parent:e})}):null}function Xt(e){window.__c={n:"InsertBlockInDropdownMenu"};const{actionStore:t,currentOption:o,options:i,parent:r}=e,c=(0,l.O7)(),d=(0,u.useIntl)(),p=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:c,perform:o=>{V.sW({store:t.getConfigStore(),data:{insertion_point:e},transaction:o})}})}),[c,t]),m=(0,I.F)({maxWidth:360}),g=i.map((e=>({key:e.key,render:t=>s.createElement(b.Z,n()({},t,{checkState:o.key===e.key,icon:e.icon,title:d.formatMessage(e.title)})),action:()=>{p(e.key),r.close()}})));return s.createElement(x.Z,m,a()(B.Z,{initialFocus:0,sections:[{key:0,render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0},e)),items:g}],type:B.i.Vertical}))}var qt=o(10052);const $t=(0,u.defineMessages)({confirmationInputPlaceholder:{defaultMessage:"Write a message to show users…",id:"automations.BaseModalAction.confirmationPlaceholder",description:"Input placeholder to enter a message which will be displayed to ask a user for confirmation."},continueButtonHint:{defaultMessage:"Completes button action",id:"automations.BaseModalAction.continueButtonHint",description:"Hint for editing the text of a button that will continue a workflow."},cancelButtonHint:{defaultMessage:"Stops button action",id:"automations.BaseModalAction.cancelButtonHint",description:"Hint for editing the text of a button that will stop a workflow."}});function Jt(e){window.__c={n:"WithRightOverlay"};const{children:t,overlayContent:o}=e,i=(0,d.yK)((e=>({wrap:{position:"relative"},overlay:{position:"absolute",height:"100%",display:"flex",alignItems:"center",top:0,right:10,color:e.lightTextColor}})),[]);return a()("div",{style:i.wrap},void 0,t,a()("div",{style:i.overlay},void 0,o))}var Qt=o(98421);function eo(e){window.__c={n:"AutomationKeyValueRow"};const{keyComp:t,valueComp:o,style:i}=e,n=(0,d.yK)((()=>({container:{display:"flex",alignItems:"center",justifyContent:"space-between",...i}})),[i]);return a()("div",{style:n.container},void 0,t,o)}function to(e){return window.__c={n:"AutomationTextKey"},a()("div",{style:{marginRight:4,flexShrink:0}},void 0,e.text)}var oo=o(31942),io=o(21202),no=o(31299),ro=o(68894),ao=o(11470),so=o(78948);function lo(e){window.__c={n:"AutomationPagePicker"};const{contextStore:t,actionStore:o,target:i,onChange:r,disabled:l,errorMessage:d}=e,p=(0,c.VK)((()=>{if(i&&"variable"===i.type)return t.getContextValueForActionById(o.id,i.id)}),[i,t,o.id]),m=(0,f.d)(),g=me({errorMessage:d,hasValue:Boolean(i)});return a()(S.Z,{popupType:m,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:l,renderOrigin:e=>s.createElement(ue,n()({},g,e),i&&"page"===i.type?a()(Vt.Z,{store:Ft.G.createChildStore(t.context.parentRecordStore,i.page)}):p?a()(Fe.F,{value:p,format:Re.l.Medium,isSingle:!0}):a()(u.FormattedMessage,{id:"automations.AutomationPagePicker.pagesDropdown.label",defaultMessage:"Select page",description:"Select pages for the action to use."})),render:e=>a()(co,{contextStore:t,actionStore:o,target:i,parent:e,onChange:r})})}function co(e){window.__c={n:"TargetPickerMenu"};const{contextStore:t,actionStore:o,target:i,parent:r,onChange:d}=e,p=(0,l.O7)(),{device:u}=p,[m,g]=(0,s.useState)(""),[h,f]=(0,s.useState)(5),v=(0,c.qz)(void 0,Ae.Z),y=(0,c.VK)((()=>t.context.parentRecordStore.getSpaceId()),[t.context.parentRecordStore]),b=(0,c.VK)((()=>t.getContextValuesForAction(o.id).filter((e=>(0,Se.uy)(e.type,{type:"block"})))),[t,o],{useDeepEqual:!0}),[S]=(0,Ie.r5)((async()=>{if(!y)return;const e=m?(0,oo.ZP)(m,b,(e=>e.kind===Se.yp.ContextValue?e.name:"")):b,t=await no.D7({environment:p,query:m,limit:h,spaceId:y,requireEditPermissions:!1,excludeTemplates:!0,source:"automation_page_picker",boostRecentlyViewedPages:!0});return{variableResults:e,pageResults:t.results.map((e=>e.id)),showMore:Math.max(0,t.total-t.results.length)}}),[p,y,m,h,b],{debounce:no.vp}),w=(0,I.F)({width:280});return s.createElement(x.Z,n()({},w,{header:a()(Z.Z,{style:{paddingTop:12}},void 0,a()(ro.ZP,{focusInitial:!u.isMobile||void 0,value:m,onChange:e=>{g(e.target.value),f(e.target.value?20:5),v.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:ot.default.formatMessage(uo.inputPlaceholder),showClearButton:!0}))}),a()(po,{contextStore:t,target:i,limit:h,setLimit:f,parent:r,result:S.value,menuListStore:v,onChange:d}))}function po(e){const{contextStore:t,target:o,limit:i,setLimit:r,menuListStore:l,result:m,parent:g,onChange:h}=e,f=(0,d.yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]),v=(0,c.VK)((()=>t.context.parentRecordStore.getSpaceId()),[t.context.parentRecordStore]),y=(0,s.useCallback)((e=>{v&&(h({type:"page",page:{table:io.iU,id:e,spaceId:v}}),g.close())}),[g,v,h]),S=(0,s.useCallback)((e=>{e.kind===Se.yp.ContextValue&&(h({type:"variable",id:e.id}),g.close())}),[h,g]);if(!m)return a()(Z.Z,{},void 0,a()(so.Z,{}));const{variableResults:w,pageResults:k,showMore:C}=m,_=w.map((e=>{if(e.kind!==Se.yp.ContextValue)throw new Error("Not implemented yet.");return{key:e.id,render:t=>a()(E.Z,{renderTooltip:()=>(0,Fe.e)(e),placement:E.Z.Placement.Right,render:i=>s.createElement(b.Z,n()({title:a()("div",{style:{display:"flex"}},void 0,a()(Fe.F,{value:e,format:Re.l.Medium,isSingle:!0,shouldShrink:!0})),checkState:"variable"===(null==o?void 0:o.type)&&o.id===e.id},(0,T.Z)(i,t)))}),action:()=>{S(e)}}})),M=k.map((e=>{const i=Ft.G.createChildStore(t.context.parentRecordStore,{table:io.iU,id:e});return{key:e,render:t=>s.createElement(ao.Z,n()({},t,{checkState:"page"===(null==o?void 0:o.type)&&o.page.id===e,store:i})),action:()=>{y(i.id)}}}));if(C>0){const e={key:"showMore",render:e=>s.createElement(b.Z,n()({},e,{icon:p.Z.dots({width:16,height:16}),style:f.showMoreButton,title:a()(u.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"automations.AutomationPagePicker.showMore.label",description:"Label to show more database results.",values:{showMore:Math.min(C,20)}})})),action:()=>{r(i+20)}};M.push(e)}const I=k.length+w.length;return s.createElement(s.Fragment,null,I>0&&a()(B.Z,{type:B.i.Vertical,initialFocus:0,sections:oe.compact([w.length>0&&{key:"variable_results",render:e=>s.createElement(Z.Z,n()({title:a()(u.FormattedMessage,{defaultMessage:"From this automation",id:"automations.AutomationPagePicker.variables.label",description:"Search for variables in the context."})},e)),items:_},k.length>0&&{key:"page_results",render:e=>s.createElement(Z.Z,n()({title:a()(u.FormattedMessage,{defaultMessage:"Pages",id:"automations.AutomationPagePicker.pages.label",description:"Search for pages."})},e)),items:M}]),store:l}),0===I&&a()(De.Z,{caption:a()(u.FormattedMessage,{defaultMessage:"No results",id:"automations.AutomationPagePicker.noResults.label",description:"Shown when there are no search results."})}))}const uo=(0,u.defineMessages)({inputPlaceholder:{defaultMessage:"Select a page to open…",id:"automations.AutomationPagePicker.pages.inputPlaceholder",description:"Input placeholder to search for a page to open in a button action."}});function mo(e){window.__c={n:"OpenPageInDropdownButton"};const{actionStore:t,disabled:o}=e,i=(0,d.Fg)(),r=(0,c.VK)((()=>t.getOpenPageIn()),[t]),l=(0,f.d)(),p=(0,Qt.v)({currentViewType:void 0,theme:i}).find((e=>e.key===r));return p?a()(S.Z,{popupType:l,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:o,renderOrigin:e=>s.createElement(ue,n()({variant:"gray"},e),p.title),render:t=>s.createElement(go,n()({currentOpenPageIn:r,parent:t},e))}):null}function go(e){window.__c={n:"OpenPageInDropdownMenu"};const{currentOpenPageIn:t,actionStore:o,parent:i}=e,r=(0,l.O7)(),c=(0,d.Fg)(),p=(0,d.yK)((()=>({menuItem:{paddingTop:8,paddingBottom:8}})),[]),u=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"OpenPageAction.setTarget",environment:r,perform:t=>{V.sW({store:o.getConfigStore(),data:{open_in:e},transaction:t})}})}),[r,o]),m=(0,I.F)({width:280,maxWidth:360}),g=(0,Qt.v)({currentViewType:void 0,theme:c}),f=oe.compact(g.map(((e,o)=>({key:o,render:o=>s.createElement(b.Z,n()({},o,{disabled:!1,title:e.title,icon:e.icon,caption:e.caption,body:e.body,style:p.menuItem,checkState:t===e.key},o)),action:()=>{u(e.key),i.close()}}))));return s.createElement(x.Z,m,a()(B.Z,{type:B.i.Vertical,sections:[{key:0,render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0},e)),items:f}],initialFocus:0}))}var ho=o(41418),fo=o(76205),vo=o(31775),yo=o(42917),bo=o(8982);function So(e){var t;window.__c={n:"AutomationCombinatorFilterPopup"};const{contextStore:o,filter:i,onChange:r,noFiltersMessage:l,collectionStore:c,disabled:d}=e,p=(0,f.d)({tabletBehavior:"slideUp"}),m=(null==i||null===(t=i.filters)||void 0===t?void 0:t.length)||0;return a()(S.Z,{popupType:p,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:d,renderOrigin:e=>s.createElement(ue,n()({variant:"gray"},e,{onClick:t=>{e.onClick(t),0===m&&r(fo.TI)}}),m>0?a()(u.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.QueryCollectionAction.filterRuleCount.label",description:"Number of filter rules.",values:{ruleCount:m}}):l),render:e=>a()(wo,{contextStore:o,filter:i,disabled:d,onChange:r,onClose:()=>e.close(),collectionStore:c})})}function wo(e){window.__c={n:"AutomationCombinatorFilterMenu"};const{contextStore:t,filter:o,onChange:i,onClose:n,collectionStore:r}=e,l=(0,c.VK)((()=>r.getSchema()),[r]),d=(0,I.F)({minWidth:300,tabletBehavior:"actionSheet"}),p=(0,s.useCallback)(((e,t)=>{i(t)}),[i]),m=(0,s.useCallback)((()=>{i(void 0),n()}),[i,n]);return s.createElement(x.Z,d,a()(bo.D,{},void 0,a()(vo.Pq,{index:0,level:0,combinatorFilter:o||fo.hh,schema:l,onChange:p,collectionViewType:"table",collectionViewId:"test",parentStore:t.context.parentRecordStore})),a()(Z.Z,{topBorder:!0},void 0,a()(yo.Z,{title:a()(u.FormattedMessage,{defaultMessage:"Delete filter",id:"automations.AutomationCombinatorFilterPopup.deleteFilter.label",description:"Button to delete a database filter."}),onClick:m})))}const ko=(0,u.defineMessages)({addSortLimit:{id:"automations.QueryCollectionAction.addSortLimitButton.addSortLimit",defaultMessage:"Add sort, limit",description:"Button to add a sort or a limit to a database query."},addLimit:{id:"automations.QueryCollectionAction.addSortLimitButton.addLimit",defaultMessage:"Add limit",description:"Button to add a limit to a database query."},addSort:{id:"automations.QueryCollectionAction.addSortLimitButton.addSort",defaultMessage:"Add sort",description:"Button to add a sort to a database query."},limitDescription:{id:"automations.QueryCollectionAction.limitPopup.limitDescription",defaultMessage:"{numberOfPages, plural, one {{numberOfPages} page} other {{numberOfPages} pages}}",description:"Description of how many pages a query result will be limited to."},unlimitedDescription:{id:"automations.QueryCollectionAction.limitPopup.unlimitedDescription",defaultMessage:"Unlimited",description:"Menu option indicating that unlimited pages should be returned from a query."}});function Co(e){const{actionStore:t,collectionStore:o,disabled:i,onSortAdded:r,onLimitAdded:d}=e,p=(0,l.Fy)(),m=(0,l.O7)(),[g,f]=(0,s.useState)(!1);let v;v=p.isMobile?{menuType:ke.og.ActionSheet}:{menuType:ke.og.Popup,width:250};const y=(0,s.useRef)(null),[b,w]=s.useState(void 0),k=(0,c.VK)((()=>o.getSchema()??{}),[o]),C=(0,c.VK)((()=>o.getFormat()??{}),[o]),_=(0,s.useCallback)((()=>Object.keys(o.getSchema())),[o]),M=(0,c.VK)((()=>t.hasSort()),[t]),T=(0,c.VK)((()=>t.hasLimit()),[t]),I=(0,s.useCallback)((e=>{e&&h.createAndCommit({userAction:"QueryCollectionAction.setInitialSort",environment:m,perform:o=>{V.sW({store:t.getConfigStore(),data:{sort:[{property:e,direction:"ascending"}]},transaction:o})}}),f(!1),r()}),[t,m,r]),P=(0,s.useCallback)((()=>{h.createAndCommit({userAction:"QueryCollectionAction.setInitialLimit",environment:m,perform:e=>{V.sW({store:t.getConfigStore(),data:{limit:1},transaction:e})}}),d()}),[t,m,d]);if(M&&T)return null;let B;return B=M?ko.addLimit:T?ko.addSort:ko.addSortLimit,s.createElement(s.Fragment,null,a()(S.Z,{popupType:p.isMobile?G.kQ.SlideUp:G.kQ.Popup,alignmentToOrigin:S.Z.Alignment.Start,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:i,renderOrigin:e=>s.createElement(ue,n()({variant:"gray",ref:y},e),s.createElement(u.FormattedMessage,B)),render:e=>a()(_o,{showSortOption:!M,showLimitOption:!T,onSortSelected:()=>{var t;f(!0),w(null===(t=y.current)||void 0===t?void 0:t.getBoundingClientRect()),e.close()},onLimitSelected:()=>{P(),e.close()}})}),a()(G.ZP,{popupType:p.isMobile?G.kQ.SlideUp:G.kQ.Popup,open:g,placementToOrigin:G.ZP.Placement.Bottom,alignmentToOrigin:G.ZP.Alignment.Start,originRect:b,render:()=>s.createElement(x.Z,v,a()(_t.Z,{schema:k,format:C,currentProperty:void 0,getProperties:_,onAccept:I})),onDismiss:()=>f(!1)}))}function _o(e){window.__c={n:"AddSortLimitMenu"};const{showSortOption:t,showLimitOption:o,onSortSelected:i,onLimitSelected:r}=e;let c;c=(0,l.Fy)().isMobile?{menuType:ke.og.ActionSheet}:{menuType:ke.og.Popup,width:250};const d=[];return t&&d.push({key:"sort",action:i,render:e=>s.createElement(b.Z,n()({},e,{title:"Sort",icon:p.Z.sort({width:16})}))}),o&&d.push({key:"limit",action:r,render:e=>s.createElement(b.Z,n()({},e,{title:"Limit",icon:p.Z.arrowDown({width:16})}))}),s.createElement(x.Z,c,a()(B.Z,{type:B.i.Vertical,sections:[{key:0,render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0},e)),items:d}],initialFocus:0}))}function Mo(e){window.__c={n:"SortPopup"};const{contextStore:t,actionStore:o,collectionStore:i,disabled:r,buttonPopupStore:d}=e,p=(0,l.O7)(),{device:m}=p,g=(0,c.VK)((()=>{var e,t;return(null===(e=o.getConfig())||void 0===e||null===(t=e.sort)||void 0===t?void 0:t.length)??0}),[o]);return a()(S.Z,{popupType:m.isMobile?G.kQ.SlideUp:G.kQ.Popup,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:r,buttonPopupStore:d,renderOrigin:e=>s.createElement(ue,n()({variant:"gray"},e),a()(u.FormattedMessage,g>0?{defaultMessage:"{numberOfSorts, plural, one {{numberOfSorts} sort} other {{numberOfSorts} sorts}}",values:{numberOfSorts:g},id:"automations.QueryCollectionAction.oneOrMoreSorts.title",description:"Message when there are one or more sorts."}:{defaultMessage:"None",id:"automations.QueryCollectionAction.noSorts.title",description:"Message when there are no sorts."})),render:e=>a()(To,{contextStore:t,collectionStore:i,actionStore:o,disabled:r})})}function To(e){window.__c={n:"SortMenu"};const{contextStore:t,actionStore:o,collectionStore:i,disabled:n}=e,r=(0,l.O7)(),{device:d}=r;let p;p=d.isMobile?{menuType:ke.og.ActionSheet}:{menuType:ke.og.Popup,minWidth:300};const u=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"QueryCollectionAction.setSort",environment:r,perform:t=>{V.sW({store:o.getConfigStore(),data:{sort:e},transaction:t})}})}),[r,o]),m=(0,c.VK)((()=>o.getConfigStore().getKeyStore("sort").getValue()??[]),[o]),g=(0,c.VK)((()=>i.getSchema()),[i]),f=(0,c.VK)((()=>i.getFormat()),[i]);return s.createElement(x.Z,p,a()(ho.Z,{schema:g,format:f,collectionViewStore:void 0,sorts:m,disabled:n,parentStore:t.context.parentRecordStore,onChange:u}))}function Io(e){window.__c={n:"LimitPopup"};const{actionStore:t,disabled:o,buttonPopupStore:i}=e,r=(0,l.O7)(),{device:d}=r,p=(0,c.VK)((()=>t.getConfigStore().getKeyStore("limit").getValue()),[t]);return a()(S.Z,{popupType:d.isMobile?G.kQ.SlideUp:G.kQ.Popup,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:o,buttonPopupStore:i,renderOrigin:e=>s.createElement(ue,n()({variant:"gray"},e),(0,M.$K)(p)&&s.createElement(u.FormattedMessage,n()({},ko.limitDescription,{values:{numberOfPages:p}}))),render:e=>a()(Po,{onLimitChanged:o=>{(e=>{h.createAndCommit({userAction:"QueryCollectionAction.setLimit",environment:r,perform:o=>{V.sW({store:t.getConfigStore(),data:{limit:e},transaction:o})}})})(o),e.close()}})})}function Po(e){window.__c={n:"LimitMenu"};const{onLimitChanged:t}=e;let o;o=(0,l.Fy)().isMobile?{menuType:ke.og.ActionSheet}:{menuType:ke.og.Popup,minWidth:250};const i=[];for(let r=1;r<=5;r++)i.push({key:`limit-${r}`,action:()=>{t(r)},render:e=>s.createElement(b.Z,n()({},e,{title:s.createElement(u.FormattedMessage,n()({},ko.limitDescription,{values:{numberOfPages:r}}))}))});return i.push({key:"unlimited",action:()=>{t(void 0)},render:e=>s.createElement(b.Z,n()({},e,{title:s.createElement(u.FormattedMessage,ko.unlimitedDescription)}))}),s.createElement(x.Z,o,a()(B.Z,{type:B.i.Vertical,sections:[{key:0,render:e=>s.createElement(Z.Z,n()({enableActionSheetTitle:!0},e)),items:i}],initialFocus:0}))}var xo=o(22433),Bo=o(37034);function Zo(e){window.__c={n:"TargetPicker"};const{contextStore:t,actionStore:o,disabled:i,errorMessage:r}=e,l=(0,c.VK)((()=>o.getTargetStore().getValue()),[o]),d=(0,c.VK)((()=>{if(l&&"variable"===l.type)return t.getContextValueForActionById(o.id,l.id)}),[t,o,l]),p=me({errorMessage:r,hasValue:Boolean(l||d)}),m=(0,f.d)();return a()(S.Z,{popupType:m,alignmentToOrigin:S.Z.Alignment.End,placementToOrigin:S.Z.Placement.Bottom,originGap:0,disabled:i,renderOrigin:e=>s.createElement(ue,n()({},p,e),l&&"collection"===l.type?a()(Vt.Z,{store:Ft.NW.createChildStore(t.context.parentRecordStore,l.collection)}):d?a()(Fe.F,{value:d,format:Re.l.Medium,isSingle:!0}):a()(u.FormattedMessage,{id:"automations.UpdatePagesAction.pagesDropdown.label",defaultMessage:"Select database",description:"Select pages for the action to update."})),render:e=>a()(Eo,{contextStore:t,actionStore:o,parent:e})})}function Eo(e){window.__c={n:"TargetPickerMenu"};const{contextStore:t,actionStore:o,parent:i}=e,r=(0,l.O7)(),{device:d}=r,[p,u]=(0,s.useState)(""),[m,g]=(0,s.useState)(5),h=(0,c.qz)(void 0,Ae.Z),f=(0,c.VK)((()=>"button_property"===t.context.type?t.context.collectionContextStore.collectionViewBlockStore():void 0),[t.context]),v=(0,c.VK)((()=>{const e=t.getContextValuesForAction(o.id);if(e){return Object.values(e).filter((e=>(0,Se.uy)(e.type,{type:"block"})))}return[]}),[t,o],{useDeepEqual:!0}),[y]=(0,Ie.r5)((async()=>{const e=p?(0,oo.ZP)(p,v,(e=>e.kind===Se.yp.ContextValue?e.name:"")):v,o=await no.RT({environment:r,collectionViewBlockStore:f,parentStore:t.context.parentRecordStore,query:p,limit:m,requireEditPermissions:!0});return{valueResults:e,collectionResults:o.results,showMore:Math.max(0,o.total-o.results.length)}}),[r,f,p,m,v,t.context],{debounce:no.vp}),b=(0,I.F)({width:280,maxWidth:360});return s.createElement(x.Z,n()({},b,{header:a()(Z.Z,{style:{paddingTop:12}},void 0,a()(ro.ZP,{focusInitial:!d.isMobile||void 0,value:p,onChange:e=>{u(e.target.value),g(e.target.value?20:5),h.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:ot.default.formatMessage(Ao.inputPlaceholder),showClearButton:!0}))}),a()(Ro,{contextStore:t,actionStore:o,limit:m,setLimit:g,parent:i,result:y.value,menuListStore:h}))}function Ro(e){const{contextStore:t,actionStore:o,limit:i,setLimit:r,menuListStore:m,result:g,parent:f}=e,v=(0,l.O7)(),y=(0,d.yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]),S=(0,c.VK)((()=>{const e=o.getCollectionTargetStore(),i=null==e?void 0:e.getKeyStore("collection").getValue();if(i)return Ft.NW.createChildStore(t.context.parentRecordStore,i)}),[o,t.context.parentRecordStore]),w=(0,c.VK)((()=>{const e=o.getVariableTargetStore();return null==e?void 0:e.id}),[o]),k=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"UpdatePageAction.updateCollection",environment:v,perform:t=>{V.sW({store:o.getConfigStore(),transaction:t,data:{target:{type:"collection",collection:{table:le.v,id:e.id,spaceId:e.getSpaceId()}},properties:null,values:null}})}}),f.close()}),[v,f,o]),C=(0,s.useCallback)((e=>{if(e.kind!==Se.yp.ContextValue)throw new Error("Not implemented yet.");h.createAndCommit({userAction:"UpdatePageAction.updateVariable",environment:v,perform:t=>{V.sW({store:o.getConfigStore(),transaction:t,data:{target:{type:"variable",id:e.id},properties:null,values:null}})}}),f.close()}),[v,f,o]);if(!g)return a()(Z.Z,{},void 0,a()(so.Z,{}));const{valueResults:_,collectionResults:M,showMore:I}=g,P=_.map((e=>{if(e.kind!==Se.yp.ContextValue)throw new Error("Not implemented yet.");return{key:e.id,render:t=>a()(E.Z,{renderTooltip:()=>e.name,placement:E.Z.Placement.Right,render:o=>s.createElement(b.Z,n()({title:a()("div",{style:{display:"flex"}},void 0,a()(Fe.F,{value:e,format:Re.l.Medium,isSingle:!0,shouldShrink:!0})),checkState:w===e.id},(0,T.Z)(o,t))),textWrap:!0}),action:()=>{C(e)}}})),x=M.map((e=>{const o=Ft.NW.createChildStore(t.context.parentRecordStore,{table:le.v,id:e});return{key:e,render:t=>s.createElement(ao.Z,n()({},t,{checkState:S&&S.id===e,store:o})),action:()=>{k(o)}}}));if(I>0){const e={key:"showMore",render:e=>s.createElement(b.Z,n()({},e,{icon:p.Z.dots({width:16,height:16}),style:y.showMoreButton,title:a()(u.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"automations.UpdatePagesAction.showMore.label",description:"Label to show more database results.",values:{showMore:Math.min(I,20)}})})),action:()=>{r(i+20)}};x.push(e)}const R=M.length+_.length;return s.createElement(s.Fragment,null,R>0&&a()(B.Z,{type:B.i.Vertical,initialFocus:0,sections:oe.compact([_.length>0&&{key:"value_results",render:e=>s.createElement(Z.Z,n()({title:a()(u.FormattedMessage,{defaultMessage:"Workflow values",id:"automations.UpdatePagesAction.values.label",description:"Search for values in the context."})},e)),items:P},M.length>0&&{key:"collection_results",render:e=>s.createElement(Z.Z,n()({title:a()(u.FormattedMessage,{defaultMessage:"Pages in database",id:"automations.UpdatePagesAction.pagesInDatabase.label",description:"Search for databases to update pages in."})},e)),items:x}]),store:m}),0===R&&a()(De.Z,{caption:a()(u.FormattedMessage,{defaultMessage:"No results",id:"automations.UpdatePagesAction.noResults.label",description:"Shown when there are no search results."})}))}const Ao=(0,u.defineMessages)({inputPlaceholder:{defaultMessage:"Select pages to edit…",id:"automations.UpdatePagesAction.pages.inputPlaceholder",description:"Input placeholder to search for pages to update"}}),Do={create_page:function(e){const{contextStore:t,actionStore:o,disabled:i,showErrorIfPresent:r}=e,d=(0,l.O7)(),p=(0,c.VK)((()=>o.getCollectionStore()),[o]),m=(0,c.VK)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.collection}),[o]),g=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"CreatePageAction.setCollection",environment:d,perform:t=>{V.sW({store:o.getConfigStore(),data:{collection:e,properties:["title"],values:null},transaction:t})}})}),[d,o]),f=(0,N.TU)({contextStore:t,actionId:o.id,shouldShow:r});return s.createElement(s.Fragment,null,s.createElement($,n()({},e,{title:a()(u.FormattedMessage,{id:"automations.CreatePageAction.header",defaultMessage:"Add page to",description:"Header for an action that creates a page in the target database. Immediately after this text, the target database is displayed."}),picker:a()(Nt,{currentValue:m,contextStore:t,onChange:g,disabled:i,errorMessage:f})})),p&&a()(It,{contextStore:t,collectionStore:p,actionStore:o,disabled:i,showSetPropertyActions:!1}))},update_pages:function(e){const{contextStore:t,actionStore:o,disabled:i,showErrorIfPresent:r}=e,d=(0,l.O7)(),p=(0,u.useIntl)(),m=(0,c.VK)((()=>o.getTargetStore()),[o]),g=(0,c.VK)((()=>"collection"===m.getKeyStore("type").getValue()),[m]),f=(0,c.VK)((()=>{var e;const t=o.getCollectionTargetStore();return null==t||null===(e=t.getKeyStore("filter"))||void 0===e?void 0:e.getValue()}),[o]),v=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"QueryCollectionAction.setFilter",environment:d,perform:t=>{V.sW({store:m,transaction:t,data:{filter:e}})}})}),[d,m]),y=(0,c.VK)((()=>{const e=m.getValue();if(e){if("collection"===e.type)return Ft.NW.createChildStore(t.context.parentRecordStore,e.collection);if("variable"===e.type){const o=t.compilationResultStore.state;if(we.x.isFail(o))return;const i=(0,Se.vx)(o.value.valueTypes,e.id);if(i&&"block"===i.type.type&&i.type.collection)return Ft.NW.createChildStore(t.context.parentRecordStore,i.type.collection);if(i&&"array"===i.type.type&&"block"===i.type.of.type&&i.type.of.collection)return Ft.NW.createChildStore(t.context.parentRecordStore,i.type.of.collection)}else{if("page"===e.type)return;(0,M.t1)(e)}}}),[m,t.context.parentRecordStore,t.compilationResultStore]),b=(0,c.VK)((()=>y?(0,Bo.v)(y,p):void 0),[y,p]),S=(0,c.VK)((()=>f?(0,xo.Ih)(f,(null==y?void 0:y.getSchema())||{}):void 0),[f,y]),w=(0,N.TU)({contextStore:t,actionId:o.id,shouldShow:r}),k=(0,c.VK)((()=>{var e;const i=null===(e=o.getVariableTargetStore())||void 0===e?void 0:e.getValue();if(!i)return!1;const n=t.getContextValueForActionById(o.id,i.id);return!!n&&"block"===n.type.type}),[o,t]);return s.createElement(s.Fragment,null,s.createElement($,n()({},e,{title:a()(u.FormattedMessage,k?{id:"automations.UpdatePagesAction.singularHeader",defaultMessage:"Edit",description:"Header for an action that edits properties of the specified page. Immediately after this text, a picker for the target page is displayed."}:{id:"automations.UpdatePagesAction.header",defaultMessage:"Edit pages in",description:"Header for an action that edits properties in the specified target database. Immediately after this text, a picker for the target database is displayed."}),picker:a()(Zo,{contextStore:t,actionStore:o,disabled:i,errorMessage:w})})),g&&y&&a()("div",{style:{margin:"0 0 -4px 8px"}},void 0,a()(eo,{keyComp:a()(to,{text:a()(u.FormattedMessage,{id:"automations.UpdatePagesAction.filter.label",defaultMessage:"Pages to edit",description:"Filter pages in database."})}),valueComp:a()(So,{contextStore:t,filter:S,collectionStore:y,onChange:v,disabled:i,noFiltersMessage:(0,M.$K)(b)?a()(u.FormattedMessage,{defaultMessage:"All pages in {collectionName}",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.label",description:"Shows when there are no filters.",values:{collectionName:b}}):a()(u.FormattedMessage,{defaultMessage:"All pages in database",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.fallbackLabel",description:"Shows when there are no filters.",values:{collectionName:b}})})})),y&&a()(It,{contextStore:t,collectionStore:y,actionStore:o,disabled:i,showSetPropertyActions:!0}))},query_collection:function(e){const{contextStore:t,actionStore:o,disabled:i}=e,r=(0,l.O7)(),d=(0,c.VK)((()=>o.getCollectionStore()),[o]),p=(0,c.VK)((()=>o.getConfigStore().getKeyStore("collection").getValue()),[o]),m=(0,c.VK)((()=>o.getConfigStore().getKeyStore("filter").getValue()),[o]),g=(0,c.VK)((()=>o.hasSort()),[o]),f=(0,c.VK)((()=>o.hasLimit()),[o]),y=(0,c.qz)(void 0,v.Z),b=(0,c.qz)(void 0,v.Z),S=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"QueryCollectionAction.setCollection",environment:r,perform:t=>{V.sW({store:o.getConfigStore(),data:{collection:e,filter:void 0,sort:void 0},transaction:t})}})}),[r,o]),w=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"QueryCollectionAction.setFilter",environment:r,perform:t=>{V.sW({store:o.getConfigStore(),data:{filter:e},transaction:t})}})}),[r,o]),k=(0,s.useCallback)((()=>{y.setState({open:!0})}),[y]),C=(0,s.useCallback)((()=>{b.setState({open:!0})}),[b]);return s.createElement(s.Fragment,null,s.createElement($,n()({},e,{title:a()(u.FormattedMessage,{id:"automations.QueryCollectionAction.title",defaultMessage:"Get pages from",description:"Header for an action that gets pages from the specified target database. Immediately after this text, the target database is displayed."}),picker:a()(Nt,{currentValue:p,contextStore:t,onChange:S,disabled:i})})),d&&s.createElement(s.Fragment,null,a()("div",{style:{margin:"0 8px"}},void 0,a()(eo,{keyComp:a()(to,{text:a()(u.FormattedMessage,{id:"automations.QueryCollectionAction.filter.label",defaultMessage:"Filter",description:"Filter pages in database."})}),valueComp:a()(So,{contextStore:t,collectionStore:d,filter:m,onChange:w,disabled:i,noFiltersMessage:a()(u.FormattedMessage,{defaultMessage:"Return all pages",id:"automations.QueryCollectionAction.filterRuleCount.noFilters.label",description:"Shows when there are no filters."})})}),g&&a()(eo,{keyComp:a()(to,{text:a()(u.FormattedMessage,{id:"automations.QueryCollectionAction.sort.label",defaultMessage:"Sort",description:"Sort pages in database."})}),valueComp:a()(Mo,{contextStore:t,collectionStore:d,actionStore:o,disabled:i,buttonPopupStore:y})}),f&&a()(eo,{keyComp:a()(to,{text:a()(u.FormattedMessage,{id:"automations.QueryCollectionAction.limit.label",defaultMessage:"Limit",description:"Limit the number of results returned by a database query."})}),valueComp:a()(Io,{actionStore:o,disabled:i,buttonPopupStore:b})})),a()(Co,{collectionStore:d,actionStore:o,disabled:i,onSortAdded:k,onLimitAdded:C})))},open_page:function(e){const{contextStore:t,actionStore:o,disabled:i,showErrorIfPresent:r}=e,d=(0,l.O7)(),p=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"OpenPageAction.setTarget",environment:d,perform:t=>{V.sW({store:o.getConfigStore(),data:{target:e},transaction:t})}})}),[d,o]),m=(0,c.VK)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.target}),[o]),g=(0,N.TU)({contextStore:t,actionId:o.id,shouldShow:r});return s.createElement(s.Fragment,null,s.createElement($,n()({},e,{title:a()(u.FormattedMessage,{id:"automations.OpenPageAction.header",defaultMessage:"Open",description:"Header for an action that opens the target page. Immediately after this text, a picker for the target page is displayed."}),picker:a()(lo,{actionStore:o,target:m,onChange:p,contextStore:t,disabled:i,errorMessage:g})})),a()("div",{style:{margin:"0 8px"}},void 0,a()(eo,{keyComp:a()(to,{text:a()(u.FormattedMessage,{id:"automations.OpenPageAction.openPageIn.label",defaultMessage:"Open page in",description:"Mode to open page in."})}),valueComp:s.createElement(mo,e)})))},duplicate_blocks:function(e){const{actionStore:t,disabled:o}=e,i=(0,c.VK)((()=>oe.first(t.getBlockPointers())),[t],{useDeepEqual:!0});return s.createElement(s.Fragment,null,s.createElement($,n()({},e,{title:a()(u.FormattedMessage,{id:"automations.DuplicateBlocksAction.header",defaultMessage:"Insert blocks",description:"Header for an action inserts blocks into the current page."}),picker:a()(Gt,{actionStore:t,disabled:o})})),i?s.createElement(Kt,n()({},e,{contentParentPointer:i})):null)},modal_confirmation:function(e){const{actionStore:t,disabled:o,contextStore:i}=e,r=(0,l.O7)(),p=(0,u.useIntl)(),g=(0,d.yK)((e=>({wrap:{display:"flex",flexDirection:"column",gap:10},plainTextInput:{backgroundColor:e.contentBackground,paddingTop:6,paddingBottom:6}})),[]),f=(0,c.VK)((()=>i.context.parentRecordStore.getSpaceId()),[i.context.parentRecordStore]),v=(0,c.VK)((()=>t.getType()),[t]),y=(0,c.VK)((()=>t.getConfigStore().getKeyStore("text")),[t]),b=(0,c.VK)((()=>y.getValue()),[y]),S=(0,s.useCallback)((e=>{h.createAndCommit({userAction:"BaseModalAction.handleTextChange",environment:r,perform:t=>{V.sO({store:y,value:e,transaction:t})}})}),[r,y]),w=t.getConfigStore().getKeyStore("continue_button").getKeyStore("text"),k=(0,c.VK)((()=>t.getConfigStore().getKeyStore("cancel_button").getKeyStore("text")),[t]);if(!v||!f)return null;const _=(0,C.z)(v);return s.createElement(s.Fragment,null,s.createElement($,n()({},e,{title:s.createElement(u.FormattedMessage,_.display.name)})),a()("div",{style:g.wrap},void 0,a()(be,{parentSpaceId:f,actionId:t.id,contextStore:i,disabled:o,value:b,onChange:S,multiline:!0,placeholder:p.formatMessage($t.confirmationInputPlaceholder),disableFormattingAndMentions:!0,disableMobileActionBar:!0}),a()(Jt,{overlayContent:s.createElement(u.FormattedMessage,$t.continueButtonHint)},void 0,a()(qt.Y,{disabled:o,maxlength:m.OO,style:g.plainTextInput,store:w})),a()(Jt,{overlayContent:s.createElement(u.FormattedMessage,$t.cancelButtonHint)},void 0,a()(qt.Y,{disabled:o,maxlength:m.OO,style:g.plainTextInput,store:k}))))}};function Fo(e){window.__c={n:"AutomationAction"};const{contextStore:t,actionStore:o,disabled:i,dragging:n,showErrorIfPresent:r,onActionAdded:s}=e,l=(0,d.yK)((e=>({container:{background:e.contentBackground,borderRadius:5,display:"flex",flexDirection:"column",gap:8,padding:8,marginLeft:12,marginRight:12,marginBottom:8,fontSize:14,boxShadow:n?e.mediumBoxShadow:e.lightBoxShadow,width:"calc(100% - 24px)"},nameRow:{display:"flex",alignItems:"center",marginBottom:4},name:{flexGrow:1,fontWeight:L.Z.fontWeight.medium,marginLeft:8},iconWrap:{width:24,height:24,display:"flex",alignItems:"center",borderRadius:4,background:"rgba(35, 131, 226, 0.14)"},icon:{width:14,height:14,fill:e.blueColor,margin:"0 auto"}})),[n]),p=(0,c.VK)((()=>o.getType()),[o]);if(!p||!(0,F.lK)(p,"display"))return null;const u=Do[p];return a()("div",{style:l.container},void 0,a()(u,{contextStore:t,actionStore:o,disabled:i,dragging:n,showErrorIfPresent:r,onActionAdded:s}))}function Lo(e){const{contextStore:t,disabled:o,suppressErrors:i,onActionAdded:n}=e,r=(0,l.O7)(),p=(0,c.VK)((()=>t.context.automationStore.getActionStores()),[t.context.automationStore]),u=(0,c.VK)((()=>p.map((e=>e.id))),[p]),f=(0,c.qz)(void 0,y.Z),v=(0,c.VK)((()=>f.state.isDragging),[f]),b=(0,c.VK)((()=>f.state.isDragging&&f.state.draggingKey),[f]),S=!o&&p.length<m.FT,k=(0,d.yK)((e=>({actionsLineWrap:{cursor:v?"grabbing":void 0,position:"relative"},actionLine:{position:"absolute",top:0,bottom:8,left:28,width:4,background:e.accentColors.gray[100],zIndex:1},actionsWrap:{position:"relative",zIndex:2}})),[v]);return s.createElement(s.Fragment,null,a()("div",{style:k.actionsLineWrap},void 0,a()("div",{style:k.actionLine}),a()("div",{style:k.actionsWrap},void 0,a()(w.ZP,{direction:"vertical",disabled:o,keys:u,onDrop:e=>{h.createAndCommit({userAction:"AutomationButtonAction.moveAction",environment:r,perform:o=>{g.kM({clientContext:t.context,transaction:o,newActionIds:e})}})},renderKey:e=>{const r=p.find((t=>t.id===e));return r?a()(Fo,{actionStore:r,contextStore:t,disabled:o,dragging:b===e,onActionAdded:n,showErrorIfPresent:Array.isArray(i)?!i.includes(r.id):!i},r.id):null},store:f}))),S&&a()(Vo,{contextStore:t,disabled:o,onActionAdded:n}))}function Vo(e){window.__c={n:"AddActionButton"};const{contextStore:t,disabled:o,onActionAdded:i}=e,r=(0,l.O7)(),{device:m}=r,[g,h]=(0,s.useState)(!0),y=(0,d.yK)((e=>({buttonWrap:{boxShadow:"initial",background:"transparent"},button:{color:e.mediumTextColor,fill:e.mediumIconColor},buttonIcon:{width:24,height:m.isMobile?18:16,marginRight:-2}})),[m.isMobile]),w=(0,c.qz)(void 0,v.Z),k=(0,f.d)(),C=(0,c.VK)((()=>t.context.automationStore.hasAnyActions()),[t.context.automationStore]);return(0,s.useEffect)((()=>{!C&&g&&(w.setState({open:!0}),h(!1))}),[w,C,g]),a()(S.Z,{popupType:k,alignmentToOrigin:S.Z.Alignment.Start,placementToOrigin:S.Z.Placement.Bottom,originGap:0,buttonPopupStore:w,disabled:o,renderOrigin:e=>s.createElement(b.Z,n()({focused:!1,style:y.buttonWrap,buttonStyle:y.button,icon:p.Z.plus(y.buttonIcon),title:a()(u.FormattedMessage,C?{id:"automations.addActionButton.nonEmpty.label",defaultMessage:"Add another step",description:"Add another step to an automation."}:{id:"automations.addActionButton.empty.label",defaultMessage:"Add a step",description:"Add a new step to an automation."})},e)),render:e=>a()(A,{contextStore:t,onActionAdded:t=>{i(t),e.close()}})})}},10052:(e,t,o)=>{o.d(t,{b:()=>f,Y:()=>v});var i=o(77094),n=o.n(i),r=o(97464),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(9953),p=o(98104),u=o(30149),m=o(21199),g=o(1743),h=o(74194);function f(e){window.__c={n:"AutomationPlainTextInput"};const{value:t,onChange:o,wrapStyle:i,...r}=e,[l,c]=(0,s.useState)(!1);return n()(g.Z,{capture:l},void 0,n()(m.Z,{capture:!0,render:e=>s.createElement("div",a()({},e,{style:i}),s.createElement(h.Z,a()({value:t,onChange:e=>o(e.currentTarget.value),onBlur:()=>{c(!1)},onFocus:()=>{p.o9(),c(!0)}},r)))}))}function v(e){window.__c={n:"ConnectedAutomationPlainTextInput"};const{store:t,...o}=e,i=(0,l.O7)(),n=(0,c.VK)((()=>t.getValue()??""),[t]),r=(0,s.useCallback)((e=>{u.createAndCommit({userAction:"AutomationPlainTextInput.setValue",environment:i,perform:o=>{d.sO({store:t,transaction:o,value:e})}})}),[i,t]);return s.createElement(f,a()({value:n,onChange:r},o))}},83907:(e,t,o)=>{o.d(t,{h:()=>Ua});var i=o(10161),n=o(97464),r=o.n(n),a=o(77094),s=o.n(a),l=o(67294),c=o(3779),d=o(5366),p=o(33929),u=o(68859),m=o(86671),g=o(49914);const h=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Abstract",id:"abstractBlock.embeds.button.label"}});class f extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.abstract,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Abstract links with public access enabled",id:"abstractBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(h.embedButtonText),urlInputPlaceholder:"https://abstract.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed Abstract",id:"abstractBlock.placeholder"}))}}const v=f;var y=o(13991),b=o(8848),S=o(82990),w=o(51454),k=o(50906),C=o(73928),_=o(92022),M=o(43250),T=o(14976),I=o(99417),P=o(87290),x=o(16402),B=o(61766),Z=o(16772),E=o(55367),R=o(80796),A=o(22294),D=o(69784),F=o(49557),L=o(77794),V=o(12318),N=o(68709),O=o(30016),U=o(64921),H=o(73420),z=o(63296),W=o(17748),j=o(66094),K=o(65187);const Y=(0,d.defineMessages)({summarize:{id:"aiBlock.summarize",defaultMessage:"Summarize this page with AI",description:"Label for the summary action of the AI block"},findActionItems:{id:"aiBlock.findActionItems",defaultMessage:"Find action items on this page with AI",description:"Label for the find action items action of the AI block"},helpMeWrite:{id:"aiBlock.helpMeWrite",defaultMessage:"Tell the AI what to write…",description:"Label for the help me write action of the AI block"}});class G extends m.Z{constructor(){super(...arguments),this.containerRef=l.createRef(),this.sizeObserver=new L.E,this.storeTypes={isGenerating:V.default.of(!1),isHovering:V.default.of(!1),haloShouldBeVisible:V.default.of(!1),actionBarShouldBeVisible:V.default.of(!1),backlinksIndicatorButtonPopupStore:B.Z},this.renderHaloContent=()=>s()("div",{style:{position:"absolute",left:-6,right:-6,top:-3,bottom:-3,pointerEvents:"none",borderRadius:6,border:`2px solid ${this.theme.aiBlockBorderColor}`}}),this.renderActionBarContent=()=>{const e=this.lastEditedTime.state;return s()("div",{style:this.getActionBarStyle()},void 0,s()(U.Z,{style:{...this.getActionButtonStyle(),display:"flex",gap:4},onClick:this.handleEditPromptClick,disabled:this.disableButton.state},void 0,c.Z.sparkles({width:16,height:16,fill:this.theme.accentColors.purple[400]}),s()("span",{style:{color:this.theme.accentColors.purple[500],fontWeight:500}},void 0,s()(d.FormattedMessage,{id:"aiBlock.generated",defaultMessage:"Generated by AI",description:"Label for the AI generated block"})),e?s()("span",{style:{color:this.theme.accentColors.purple[300]}},void 0,(0,x.IS)(e,{useLowercase:!0,useCompactFormat:!0,roundDownYears:!0})):null,this.disableButton.state?null:c.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),s()(U.Z,{onClick:this.handleGenerateClick,disabled:this.disableButton.state,style:{...this.getActionButtonStyle(),opacity:this.disableButton.state?.5:1,cursor:this.disableButton.state?"not-allowed":"pointer"}},void 0,this.stores.isGenerating.state?s()(d.FormattedMessage,{id:"aiBlockBlock.update.loading",defaultMessage:"Updating…",description:"Button to update the AI summary when currently updating"}):s()(d.FormattedMessage,{id:"aiBlockBlock.update",defaultMessage:"Update",description:"Button to update the AI summary"})))},this.handleMouseEnter=()=>{R.Z.state.isDragging||D.Z.state.isActive||this.stores.isHovering.set(!0)},this.handleMouseLeave=()=>{R.Z.state.isDragging||D.Z.state.isActive||this.stores.isHovering.set(!1)},this.handleGenerateClick=async()=>{k.trackAIBlockAction(this.environment,{type:"generate"}),this.stores.isGenerating.set(!0),await C.iJ({environment:this.environment,store:this.props.store,prompt:this.prompt.state,additionalContext:this.additionalContext.state}),this.stores.isGenerating.set(!1)},this.handleEditPromptClick=()=>{var e;k.trackAIBlockAction(this.environment,{type:"edit_prompt"}),(0,_.yd)({environment:this.environment,store:this.props.store,originRef:this.containerRef,prompt:null===(e=this.additionalContext.state)||void 0===e?void 0:e.prompt,clientPrompt:this.prompt.state})},this.handleFocus=()=>{var e;(0,_.yd)({environment:this.environment,store:this.props.store,originRef:this.containerRef,prompt:null===(e=this.additionalContext.state)||void 0===e?void 0:e.prompt,clientPrompt:this.prompt.state})},this.currentState=this.createComputedStore((()=>this.isEmpty.state?P.x.Hovered:(0,P.B)(this.props.store,this.stores.isHovering.get()))),this.showActionBar=this.createComputedStore((()=>{const e=this.currentState.state;return!(e!==P.x.Selected&&e!==P.x.SelectedDescendant||F.Z.state.isActive||E.ZP.state.isDragging||D.Z.state.isActive||A.Z.state.isKeyboardMode)})),this.lastEditedTime=this.createComputedStore((()=>this.props.store.getFormat().ai_last_edited)),this.isEmpty=this.createComputedStore((()=>!this.props.store.hasContent())),this.prompt=this.createComputedStore((()=>{const e=I.Xi.summarize,t=this.props.store.getFormat().ai_prompt_key;if(!t)return e;const o=I.Xi[t];return o||e})),this.titleValue=this.createComputedStore((()=>this.props.store.getBlockTitleStore().getValue())),this.additionalContext=this.createComputedStore((()=>{const e=this.titleValue.state;if(e)return{prompt:(0,T.Xh)(e,this.props.store)}})),this.disableButton=this.createComputedStore((()=>{var e;const t=this.pageContext&&this.pageContext.publicEditModeStore.state;return!(0,I.GD)(this.environment,t)||(!!this.stores.isGenerating.state||(!(this.props.store.canEdit()&&!this.props.store.isLocked())||"helpMeWrite"===this.prompt.state.key&&(null===(e=this.additionalContext.state)||void 0===e||!e.prompt)))})),this.isCompact=this.createComputedStore((()=>this.sizeObserver.rect.get().width<400))}renderPersisted(){const e=this.currentState.state,t=e!==P.x.Default||this.stores.haloShouldBeVisible.get()||this.stores.actionBarShouldBeVisible.get(),o=Z.default.state,i="completionPopup"===o.type&&"results"===o.stage&&o.loading;return l.createElement("div",{className:M.zov,style:{display:"flex"},ref:this.containerRef},s()("div",{style:{position:t?"relative":void 0,paddingTop:3,paddingBottom:3,width:"100%",marginTop:4,marginBottom:4},onMouseLeave:this.handleMouseLeave,onMouseEnter:this.handleMouseEnter},void 0,this.isEmpty.state?s()(N.p,{allowSelectionWithin:!0},void 0,s()(H.X2,{justifyContent:"space-between",padding:8,gap:8,wrap:this.isCompact.state?"wrap":"initial"},void 0,s()(H.X2,{gap:12,alignItems:"baseline",grow:1},void 0,this.renderIcon(),"helpMeWrite"===this.prompt.state.key?s()(K.Z,{onFocus:this.handleFocus,disabled:!this.canEdit(),store:this.props.store.getBlockTitleStore(),placeholder:p.default.formatMessage(Y.helpMeWrite),pasteBehavior:"block",style:{flexGrow:1,flexBasis:0},onEnter:this.handleGenerateClick}):this.renderPrompt()),s()(z.Z,{disabled:this.disableButton.state,onClick:this.handleGenerateClick,style:{fontWeight:500,color:this.theme.accentColors.purple[500],opacity:this.disableButton.state?.5:1,cursor:this.disableButton.state?"not-allowed":"pointer"}},void 0,this.stores.isGenerating.state?s()(d.FormattedMessage,{id:"aiBlock.generate.loading.label",defaultMessage:"Generating…",description:"Label for the generate button when currently generating"}):s()(d.FormattedMessage,{id:"aiBlock.generate.label",defaultMessage:"Generate",description:"Label for the generate button"}))),this.renderHalo(e)):l.createElement(l.Fragment,null,s()(W.Z,{disabled:this.props.disabled,store:this.props.store.getContentStore(),disableHoverMenu:this.props.disableHoverMenu||e!==P.x.SelectedDescendant,disableDrag:this.environment.device.isMobile}),t&&this.renderHalo(e),!i&&t&&this.renderActionBar(this.showActionBar.state))))}renderIcon(){var e,t;const o={fill:this.theme.accentColors.purple[300],width:21,height:21,position:"relative",top:5};return(null===(e=(t=this.prompt.state).svg)||void 0===e?void 0:e.call(t,o))??c.Z.sparkles(o)}renderPrompt(){var e;return"helpMeWrite"===this.prompt.state.key?(null===(e=this.additionalContext.state)||void 0===e?void 0:e.prompt)||p.default.formatMessage(Y.helpMeWrite):Y[this.prompt.state.key]?p.default.formatMessage(Y[this.prompt.state.key]):void 0}renderHalo(e){const t=e!==P.x.Default;return s()(O.Z,{isVisible:t,enterAnimationStyle:{opacity:0,scale:.995},animationStyle:{opacity:e===P.x.Hovered?.45:1,scale:1},exitAnimationStyle:{opacity:0,scale:.995},springConfig:{opacity:j.Z.opacitySpringConfig},onAnimationStart:()=>{this.stores.haloShouldBeVisible.set(!0)},onAnimationEnd:()=>{t||this.stores.haloShouldBeVisible.set(!1)},render:this.renderHaloContent})}renderActionBar(e){return s()(O.Z,{isVisible:e,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:j.Z.opacitySpringConfig},onAnimationStart:()=>{this.stores.actionBarShouldBeVisible.set(!0)},onAnimationEnd:()=>{e||this.stores.actionBarShouldBeVisible.set(!1)},render:this.renderActionBarContent})}didMount(){const e=this.getNode();e instanceof Element&&this.sizeObserver.observe(e)}willUnmount(){this.sizeObserver.destroy()}getActionBarStyle(){return{position:"absolute",zIndex:w.t8,top:-40,right:-2,borderRadius:3,height:32,fontSize:14,lineHeight:1.2,display:"flex",whiteSpace:"nowrap",fontFamily:S.Z.getCompositeFontFamily(y.SP).sans,background:this.theme.popoverBackground,boxShadow:this.theme.mediumBoxShadow}}getActionButtonStyle(){return{display:"flex",alignItems:"center",padding:"0 8px",borderRight:`1px solid ${b.ZP.whiteWithAlpha(.2)}`,boxShadow:`1px 0 0 ${this.theme.regularDividerColor}`,marginRight:1}}}const X=G,q=(0,d.defineMessages)({helpMeWriteEmpty:{id:"aiBlock.helpMeWrite",defaultMessage:"Tell the AI what to write…",description:"Label for the help me write action of the AI block"}});class $ extends m.Z{constructor(){super(...arguments),this.aiBlockRef=l.createRef(),this.sizeObserver=new L.E,this.storeTypes={isGenerating:V.default.of(!1),backlinksIndicatorButtonPopupStore:B.Z},this.handleTitleClick=()=>{var e;(0,_.yd)({environment:this.environment,store:this.props.store,originRef:this.aiBlockRef,prompt:null===(e=this.additionalContext.state)||void 0===e?void 0:e.prompt,clientPrompt:this.prompt.state})},this.handleGenerateClick=async()=>{k.trackAIBlockAction(this.environment,{type:"generate"}),this.stores.isGenerating.set(!0),await C.iJ({environment:this.environment,store:this.props.store,prompt:this.prompt.state,additionalContext:this.additionalContext.state}),this.stores.isGenerating.set(!1)},this.lastEditedTime=this.createComputedStore((()=>this.props.store.getFormat().ai_last_edited)),this.prompt=this.createComputedStore((()=>{const e=I.Xi.summarize,t=this.props.store.getFormat().ai_prompt_key;if(!t)return e;const o=I.Xi[t];return o||e})),this.additionalContext=this.createComputedStore((()=>{const e=this.props.store.getBlockTitleStore().getValue();if(e)return{prompt:(0,T.Xh)(e,this.props.store)}})),this.disableButton=this.createComputedStore((()=>{var e;const t=this.pageContext&&this.pageContext.publicEditModeStore.state;return!(0,I.GD)(this.environment,t)||(!!this.stores.isGenerating.state||(!(this.props.store.canEdit()&&!this.props.store.isLocked())||"helpMeWrite"===this.prompt.state.key&&(null===(e=this.additionalContext.state)||void 0===e||!e.prompt)))})),this.isCompact=this.createComputedStore((()=>this.sizeObserver.rect.get().width<400))}renderPersisted(){return l.createElement("div",{style:this.getContainerStyles(),ref:this.aiBlockRef},s()(N.p,{allowSelectionWithin:!0},void 0,s()("div",{style:this.getControlsStyles()},void 0,s()(H.X2,{justifyContent:"space-between",gap:8,wrap:this.isCompact.state?"wrap":"initial"},void 0,s()(H.X2,{gap:8,alignItems:"baseline",grow:1},void 0,this.renderIcon(),this.renderTitle()),s()(z.Z,{disabled:this.disableButton.state,onClick:this.handleGenerateClick,style:this.getButtonStyles(),hoveredStyle:{...this.getButtonStyles(),opacity:.8},pressedStyle:this.getButtonStyles()},void 0,this.renderButtonLabel())))),s()(W.Z,{disabled:this.props.disabled,store:this.props.store.getContentStore(),disableDrag:this.environment.device.isMobile}))}renderButtonLabel(){return this.stores.isGenerating.state?s()(d.FormattedMessage,{id:"aiBlock.generate.loading.label",defaultMessage:"Generating…",description:"Label for the generate button when currently generating"}):this.props.store.hasContent()?s()(d.FormattedMessage,{id:"aiBlock.generate.regenerate.label",defaultMessage:"Regenerate",description:"Label for the generate button when there is already content"}):s()(d.FormattedMessage,{id:"aiBlock.generate.label",defaultMessage:"Generate",description:"Label for the generate button"})}renderIcon(){var e,t;const o={fill:this.theme.accent.purple.icon,width:21,height:21,position:"relative",top:5};return(null===(e=(t=this.prompt.state).svg)||void 0===e?void 0:e.call(t,o))??c.Z.sparkles(o)}renderTitle(){return"helpMeWrite"!==this.prompt.state.key||this.props.store.hasContent()?s()(U.Z,{style:this.getTitleStyles(),onClick:this.handleTitleClick},void 0,this.renderPromptLabel(),c.Z.chevronDown(this.getChevronStyles())):s()(K.Z,{disabled:!this.canEdit(),store:this.props.store.getBlockTitleStore(),placeholder:p.default.formatMessage(q.helpMeWriteEmpty),pasteBehavior:"block",style:{flexGrow:1,flexBasis:0},onEnter:this.handleGenerateClick})}renderPromptLabel(){return"helpMeWrite"===this.prompt.state.key?s()(d.FormattedMessage,{id:"aiBlock.helpMeWrite.generated",defaultMessage:"Custom prompt",description:"Label for the help me write action of the AI block when there is already content"}):"summarize"===this.prompt.state.key?s()(d.FormattedMessage,{id:"aiBlock.summarize.generated",defaultMessage:"Summary",description:"Label for the generated summary of the AI block"}):"findActionItems"===this.prompt.state.key?s()(d.FormattedMessage,{id:"aiBlock.findActionItems.generated",defaultMessage:"Action items",description:"Label for the generated action items of the AI block"}):void 0}didMount(){const e=this.getNode();e instanceof Element&&this.sizeObserver.observe(e)}willUnmount(){this.sizeObserver.destroy()}getContainerStyles(){return{background:this.theme.accent.purple.background,borderRadius:6,width:"100%",padding:"12px 16px",marginTop:4,marginBottom:4}}getControlsStyles(){return this.props.store.hasContent()?{marginBottom:10}:{}}getTitleStyles(){return{display:"flex",gap:8,alignItems:"center",color:this.theme.accent.purple.text,fontWeight:500,cursor:"pointer"}}getChevronStyles(){return{width:12,height:16,fill:this.theme.mediumIconColor}}getButtonStyles(){return{fontWeight:500,color:this.theme.regularInvertedTextColor,background:this.theme.accent.purple.button,opacity:this.disableButton.state?.5:1,cursor:this.disableButton.state?"not-allowed":"pointer"}}}const J=$;var Q=o(83355),ee=o(98459),te=o(21202),oe=o(33709),ie=o(95182),ne=o(5978),re=o(95477),ae=o(66213),se=o(22889),le=o(84210),ce=o(60709),de=o(98165),pe=o(46735),ue=o(1533),me=o(31194),ge=o(3815),he=o(24736),fe=o(85590),ve=o(48019),ye=o(31945),be=o(84076),Se=o(78140),we=o(31278),ke=o(76798),Ce=o(49271),_e=o(44805),Me=o(9953),Te=o(30149),Ie=o(67669),Pe=o(15517),xe=o(31792),Be=o(88923),Ze=o(13966),Ee=o(58032),Re=o(78454);class Ae extends Q.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:xe.Z},this.handleRecordIconChange=e=>{const{store:t}=this.props,o=t.getIconStore();o&&Te.createAndCommit({userAction:"Page.handleRecordIconChange",environment:this.environment,perform:t=>{Me.sO({store:o,value:e,transaction:t})}})},this.onMouseMove=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.onMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})}}didMount(){const{RouterStore:e,currentUser:t}=this.environment,{route:o}=e.state;"page"===o.name&&o.shouldDuplicate&&Pe.nM({currentUserId:null==t?void 0:t.id,blockId:o.blockId})}renderComponent(){const{store:e,onClick:t}=this.props,o=i.default.checkGate("side_peek_anywhere"),n=(0,le.Hu)({store:e,fullyQualified:!1}),r=o?(0,le.Hu)({store:this.props.store,openInSidePeek:!0,fullyQualified:!1}):void 0,a=i.default.checkGate("enable_deleted_page_indicator"),l=de.wf(e),c=a&&l;return s()(be.Z,{href:n,altHref:r,forceAltHref:o&&Be.default.isSidePeekOpen(),external:!1,onClick:t,style:this.props.style},void 0,s()(Re.ZP,{childrenStyle:Ae.childrenStyle,alignment:Re.v2.Center,right:this.renderActionButton(),onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},void 0,s()("div",{style:{display:"flex",alignItems:"center"}},void 0,this.renderIconWithArrow(c),s()(ke.Z,{store:e,style:this.getTitleStyle(c)}))))}renderIconWithArrow(e){if(e){const e=this.environment.device.isSafari||this.environment.device.isIOS;return(0,_e.tr)({isSafariOrIOS:e,theme:this.theme})}return s()("div",{style:{position:"relative",width:24,height:24,marginRight:4}},void 0,this.renderIcon(),this.renderArrowIcon())}renderArrowIcon(){if(this.props.isAlias)return s()("div",{},void 0,c.Z.pageLinkIndicator({position:"absolute",width:"50%",height:"50%",right:0,bottom:0}))}renderIcon(){const{store:e,disabled:t}=this.props;return s()(Ee.Z,{renderTooltip:()=>s()(d.FormattedMessage,{defaultMessage:"Change icon",id:"page.changeIcon.tooltip"}),placement:Ee.Z.Placement.Top,disableTooltip:t||!this.canEdit(),render:o=>t||!this.canEdit()?l.createElement(we.Z,r()({disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),role:e.getRole(),size:22,style:{width:"100%",height:"100%"}},o,{largeIcon:!0})):l.createElement(we.Z,r()({disabled:!1,bucket:"secure",store:e,icon:e.getIcon(),role:e.getRole(),isEmptyPage:e.isEmptyPage(),size:22,style:{width:"100%",height:"100%"},iconLoggingData:{recordTable:e.table,source:"subpage",block_type:e.getType()},onChange:this.handleRecordIconChange},o,{largeIcon:!0}))})}renderActionButton(){const{device:e}=this.environment;return this.canEdit()&&(this.stores.mouseStore.state.mouseEntered||e.isMobile)?s()(Ze.Z,{store:this.props.aliasStore??this.props.store,tooltipContent:s()(d.FormattedMessage,{defaultMessage:"Rename, delete, and more…",id:"page.blockActionMenu.tooltip"}),style:{marginRight:4},fadeIn:!0}):s()("div",{style:{width:28}})}canEdit(){const{store:e}=this.props,t=this.pageContext&&this.pageContext.publicEditModeStore.state;return!(0,Ie.YF)(t)&&(e.canEdit()&&!this.props.disabled)}getTitleStyle(e){return{fontWeight:S.Z.fontWeight.medium,lineHeight:1.3,borderBottom:this.props.disableUnderline?"none":`1px solid ${this.theme.darkDividerColor}`,...e&&{color:this.theme.mediumTextColor}}}}Ae.displayName="Page",Ae.childrenStyle={paddingTop:Ce.ZD.paddingTop,paddingBottom:Ce.ZD.paddingBottom,paddingLeft:Ce.ZD.paddingLeft};const De=Ae;class Fe extends m.Z{constructor(){super(...arguments),this.storeTypes={interactionStore:ue.Z},this.origin=l.createRef(),this.handleClick=()=>{const{store:e}=this.props;k.trackClickNestedChildPage(this.environment),pe.Z.recordVisit({id:e.id,type:se.vu.Link,currentUserId:this.environment.currentUser.id})}}activate(){const{store:e}=this.props;this.navigate(e)}navigate(e){if(this.context.overrideLinkClick){const t=(0,le.ZP)({store:e});this.context.overrideLinkClick(t)}else ne.navigateToBlock({environment:this.environment,store:e,visitType:se.vu.Link})}renderPersisted(){const{disabled:e,store:t}=this.props,o=t.getAliasTargetStore();if(!o)return;if(o instanceof ge.G)return s()(N.p,{allowSelectionWithin:!1},void 0,s()(De,{store:o,style:{...this.getBlockColorStyle(),...this.props.style},isAlias:!0,aliasStore:t,disabled:e,onClick:this.handleClick}));const i=de.Dg(o);if("none"===o.getRole())return s()(N.p,{allowSelectionWithin:!1},void 0,s()("div",{style:{border:`1px solid ${this.theme.darkDividerColor}`,borderRadius:3}},void 0,l.createElement(be.Z,{ref:this.origin,style:{width:"100%"},interactionStore:this.stores.interactionStore},s()("div",{style:{display:"flex",padding:9}},void 0,c.Z.commentAlert({width:30,height:30,marginRight:10,marginLeft:5}),s()("div",{style:{fontSize:fe.$}},void 0,s()("div",{style:{fontWeight:S.Z.fontWeight.medium}},void 0,s()(d.FormattedMessage,{defaultMessage:"No access to page comments",id:"aliasBlock.comment.noAccess.title",description:"Text visible to user when they don't have access to view comment data"})),s()(d.FormattedMessage,{defaultMessage:"You don't have permission to view this page and its comments",id:"aliasBlock.comment.noAccess.subtitle",description:"Subtitle text visible to user when they don't have access to view comment data"}))))));if(!i||!o.isDefined())return this.renderShimmerState();const n=ge.t1.createChildStore(i,{table:oe.qF,id:o.getParentId(),spaceId:(0,ee.CG)(i.pointer.spaceId)});if(null==n||!n.isDefined())return;const a=ge.t1.createChildStore(i,{table:te.iU,id:n.getParentId(),spaceId:(0,ee.CG)(i.pointer.spaceId)});if(!a.isDefined())return;const p=i.isDefined()?a.getModel().getRenderUrl({getRecordModel:t.getRecordModel,baseUrl:re.Z.domainBaseUrl,discussionId:n.id}):void 0,{isMobile:u}=this.environment.device,m={blocks:[t],environment:this.environment,publicEditMode:void 0};return s()(N.p,{allowSelectionWithin:!1},void 0,s()("div",{style:{border:`1px solid ${this.theme.darkDividerColor}`,cursor:"pointer",borderRadius:3}},void 0,l.createElement(be.Z,{ref:this.origin,style:{display:"flex"},href:p,interactionStore:this.stores.interactionStore},s()("div",{style:{display:"flex"}},void 0,s()(fe.Z,{store:o,discussionStore:n,showResolveButtonByDefaultIfPossible:!1,blockStore:t,hoveringDiscussion:!1,discussionLocation:"comment_unfurl",collapsed:!0,maxLines:2},o.id),s()(ye.Z,{popupType:u?ye.Z.PopupType.SlideUp:ye.Z.PopupType.Popup,renderOrigin:e=>l.createElement(he.Z,r()({},e,{isMobile:u,style:{margin:8,opacity:u||this.stores.interactionStore.state.hovered?1:0}})),placementToOrigin:me.Iw.Top,render:e=>s()(Se.Z,{menuType:ce.og.Popup},void 0,s()(ve.Z,{sections:ie.Qi,context:m,onAccept:()=>e.close()}))})),i&&s()("div",{style:{display:"flex",alignItems:"center",paddingLeft:"50px",marginBottom:"10px"}},void 0,s()(we.Z,{disabled:!0,icon:i.getIcon(),isEmptyPage:i.isEmptyPage(),size:14,style:{marginLeft:2,marginRight:2}}),s()(ke.Z,{store:i,style:{color:"gray",fontSize:"smaller"}})))))}renderShimmerState(){return s()(be.Z,{external:!0,style:{flexGrow:1,minWidth:0}},void 0,this.renderShimmerbox({width:38,height:38}),s()("div",{style:{display:"flex",flexDirection:"column",flexGrow:1}},void 0,this.renderShimmerbox({width:"50%",height:14,margin:4}),this.renderShimmerbox({width:"40%",height:12,margin:4})))}renderShimmerbox(e){return s()("div",{style:{overflow:"hidden",position:"relative",background:this.theme.selectLightGray[30],...e}},void 0,s()("div",{style:{position:"absolute",height:"100%",width:"100%",zIndex:1,animation:"shimmer 1s infinite",background:`linear-gradient(to right, ${this.theme.selectLightGray[30]} 0%, ${this.theme.selectLightGray[50]} 20%, ${this.theme.selectLightGray[30]} 40%, ${this.theme.selectLightGray[30]} 100%)`}}))}}Fe.contextTypes={...ae.wK,...Q.w};const Le=Fe,Ve=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed audio",id:"audioBlock.embedAudio.button.label"}});class Ne extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.audio,mediaMenuCurrentTab:"file",mediaMenuTabs:[{type:"file",fileUpload:!0},{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with .MP3s, .WAVs, and .OGGs",id:"audioBlock.embed.caption"}),embedButtonText:p.default.formatMessage(Ve.embedButtonText),urlInputPlaceholder:"https://…"}),s()(d.FormattedMessage,{defaultMessage:"Add an audio file",id:"audioBlock.placeholder"}))}}const Oe=Ne;var Ue=o(62518),He=o(30845),ze=o(70203),We=o(64002),je=o(63143),Ke=o(48948),Ye=o(47307),Ge=o(27153),Xe=o(24677),qe=o(98104),$e=o(71669),Je=o(68785),Qe=o(81865),et=o(64369),tt=o(86329),ot=o(35021);const it=2*je.hM,nt=(0,d.defineMessages)({linkPlaceholder:{defaultMessage:"Paste in https://…",id:"bookmarkBlock.editBookmark.linkPlaceholder"},bookmarkTitle:{defaultMessage:"Bookmark",id:"bookmarkBlock.bookmark.title"},errorMessage:{defaultMessage:"Please enter a valid link",id:"bookmarkBlock.invalidLinkError.message"}});class rt extends m.Z{constructor(){super(...arguments),this.caption=()=>{const e=this.props.store.getPropertyStore("caption");Xe.eP({environment:this.environment,store:this.props.store}),qe.NX({store:e})},this.storeTypes={stringInputButtonPopupStore:B.Z,mouseStore:xe.Z},this.handleEmbedConfirm=e=>this.embed(e),this.handleOpenMenu=()=>{if(this.canEdit()){const e=Ue.findDOMNode(this);if(!e)return;if(!(e instanceof Element))return;const t=e.getBoundingClientRect();Ge.$(this.environment,{originRect:t,originGap:0,isSmallWidth:!0,showArrow:!0,title:p.default.formatMessage(nt.bookmarkTitle),currentTab:"embed",tabs:[{type:"embed",caption:s()(d.FormattedMessage,{defaultMessage:"Create a visual bookmark from a link.",id:"bookmarkBlock.visualBookmark.prompt"}),buttonText:s()(d.FormattedMessage,{defaultMessage:"Create bookmark",id:"bookmarkBlock.visualBookmark.create"}),inputPlaceholder:p.default.formatMessage(nt.linkPlaceholder),onChange:e=>{const t=We.D5(e);He.B(t,"url")?(Ge.Z(),this.handleEmbedConfirm(t)):Ye.showErrorMessage(p.default.formatMessage(nt.errorMessage))}}]})}},this.handleMouseMove=()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),this.handleMouseLeave=()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})}handleCreated(){this.edit()}edit(){this.handleOpenMenu()}embed(e){return k.trackUrlPaste(this.environment,{pastedText:e,source:"bookmark_block_menu"}),Ke.K({environment:this.environment,store:this.props.store,url:e})}activate(){const e=this.props.store.getProperties(),t=ze.Q(e&&e.link||[]);t&&ne.navigateToExternalURL({environment:this.environment,url:t})}didMount(){const e=this.props.store.getFormat().bookmark_loading_ttl;if(e){const t=e-Date.now()-it;t>0&&setTimeout(this.enqueueForceUpdate,t+1e3)}}renderPersisted(){const e=this.props.store.getProperties();return e&&e.link?this.renderContent():this.renderPlaceholder()}renderContent(){const{store:e}=this.props,t=e.getProperties(),o=ze.Jc(t&&t.link);let i=ze.Jc(t&&t.title);if(o===i||!i){const e=We.Qc(o);e.hostname&&(i=e.hostname)}const n=ze.Jc(t&&t.description),r=e.getFormat(),a=r.bookmark_cover,l=r.bookmark_icon,c=r.bookmark_loading_ttl,p=c&&c>Date.now()-it;return s()(N.p,{allowSelectionWithin:!0},void 0,s()("div",{style:{display:"flex"}},void 0,s()(ot.Z,{permissionRecord:e.pointer,url:o,render:(e,t)=>s()(be.Z,{href:t,external:!0,style:{flexGrow:1,minWidth:0},innerStyle:this.getContentStyle(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,s()("div",{style:rt.textWrapStyle},void 0,p?s()(et.Z,{style:{minHeight:24,marginBottom:2,display:"inline-flex",alignItems:"center",color:this.theme.mediumTextColor}},void 0,s()(Je.Z,{style:{marginRight:8}})," ",s()(d.FormattedMessage,{defaultMessage:"Fetching preview",id:"bookmarkBlock.loadWhileFetching.message"})):s()(et.Z,{style:{minHeight:24,marginBottom:2}},void 0,i),n&&s()(et.Z,{isSmall:!0,isMultiline:!0,style:{height:32,overflow:"hidden"}},void 0,n),s()("div",{style:{display:"flex",marginTop:6}},void 0,l&&l.length>0&&s()(Qe.Z,{url:l,isAuthenticated:!0,permissionRecord:this.props.store.pointer,render:(e,t)=>t&&s()("img",{src:t,style:rt.linkFaviconStyle})}),s()(et.Z,{style:{color:this.theme.regularTextColor},isSmall:!0},void 0,o))),a&&this.renderImage(a),this.shouldShowActionButton()&&this.canEdit()&&s()(Ze.Z,{store:this.props.store,style:{position:"absolute",top:4,right:4,background:g.Z.actionButtonBackground(this.environment)},iconStyle:{fill:b.ZP.white},fadeIn:!0}))}),this.renderDiscussion()),this.renderCaption())}renderImage(e){return s()("div",{style:rt.imageLinkWrapStyle},void 0,s()("div",{style:rt.imageLinkInnerStyle},void 0,s()(Qe.Z,{url:e,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:250,render:(e,t)=>t&&s()($e.Z,{style:rt.imageStyle,src:t})})))}renderPlaceholder(){const{disabled:e}=this.props;return s()(N.p,{allowSelectionWithin:!1,onMouseEnter:e=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:e=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1}),style:{display:"flex"}},void 0,s()(tt.Z,{iconSvg:c.Z.book,disabled:e,right:this.shouldShowActionButton()&&this.canEdit()&&s()(Ze.Z,{store:this.props.store,fadeIn:!0}),onClick:this.handleOpenMenu,isLoading:!1,progressPercent:0},void 0,s()(d.FormattedMessage,{defaultMessage:"Add a web bookmark",id:"bookmarkBlock.addWebBookmark.placeholder"})),this.renderDiscussion())}shouldShowActionButton(){const{device:e}=this.environment;return e.isMobile||this.stores.mouseStore.state.mouseEntered}getContentStyle(){return{display:"flex",flexWrap:"wrap-reverse",alignItems:"stretch",textAlign:"left",overflow:"hidden",border:`1px solid ${this.theme.darkDividerColor}`,borderRadius:3,position:"relative",...this.getBlockColorStyle()}}}rt.imageLinkWrapStyle={flexGrow:1,flexShrink:1,flexBasis:180,display:"block",position:"relative"},rt.imageLinkInnerStyle={position:"absolute",top:0,left:0,right:0,bottom:0},rt.imageStyle={display:"block",width:"100%",height:"100%",objectFit:"cover"},rt.textWrapStyle={flexGrow:4,flexShrink:1,flexBasis:180,padding:14,paddingTop:12,overflow:"hidden",textAlign:"left"},rt.linkFaviconStyle={width:16,height:16,minWidth:16,marginRight:6};const at=rt;var st=o(1449);class lt extends m.Z{renderPersisted(){const{device:e}=this.environment,t=this.props.store.getNavigableBlockStore(),o=this.canEdit();if(t)return s()(N.p,{allowSelectionWithin:!0,style:{display:"flex",paddingTop:Ce.ZD.paddingTop,paddingBottom:Ce.ZD.paddingBottom}},void 0,s()(st.Z,{showCurrentPageControls:!1,ancestorMaxWidth:200,currentPageMaxWidth:300,store:t,maxAncestorCount:3,isMobile:e.isMobile,style:{flexGrow:1,minWidth:0,fontSize:"inherit"}}),e.isMobile&&o&&s()(Ze.Z,{store:this.props.store,fadeIn:!0,style:{marginTop:2,marginRight:4}}),this.renderDiscussion())}}const ct=lt;var dt=o(80357);const pt=(0,d.defineMessages)({listPlaceholder:{defaultMessage:"List",id:"bulletedListBlock.placeholder.label"}});class ut extends m.Z{constructor(){super(...arguments),this.bulletStore=this.createComputedStore((()=>{var e;const t=null===(e=this.props.bulletedListFormatStore)||void 0===e?void 0:e.getState();return function(e,t){switch(e){case"disc":return'"•"';case"circle":return'"◦"';case"square":return'"▪"';default:return t%3==0?'"•"':t%3==1?'"◦"':'"▪"'}}(null==t?void 0:t.blockIdFormats.get(this.props.store.id),(null==t?void 0:t.depth)||0)}))}renderPersisted(){const{store:e,disabled:t}=this.props;return s()(Re.ZP,{style:this.getStyle(),left:l.createElement("div",(0,dt.iv)({fontSize:"1.5em",lineHeight:1,marginBottom:0,pseudoBefore:{fontFamily:"Arial",content:this.bulletStore.state}})),childrenStyle:{display:"flex",flexDirection:"column"}},void 0,s()("div",{style:{display:"flex"}},void 0,s()(K.Z,{style:Re.R8,disabled:t,store:e.getBlockTitleStore(),placeholder:p.default.formatMessage(pt.listPlaceholder),pasteBehavior:"block"}),this.renderDiscussion({style:ut.discussionIndicatorStyle})),!this.props.hideContent&&s()(W.Z,{disabled:t,store:e.getContentStore(),disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag,bulletedListFormatStore:this.props.bulletedListFormatStore}))}getStyle(){return{...{paddingLeft:Ce.ZD.paddingLeft},...this.getBlockColorStyle(),...this.props.style}}}ut.discussionIndicatorStyle={paddingLeft:0,marginLeft:-6,paddingBottom:2};const mt=ut;var gt=o(4853),ht=o(22808),ft=o(15157);const vt=(0,d.defineMessages)({inputPlaceholder:{defaultMessage:"Type something…",id:"calloutBlock.inputPlaceholder"}});class yt extends m.Z{constructor(){super(...arguments),this.handleChange=async e=>{const{store:t}=this.props,o=t.getIconStore();if(o){const{serverCommitResult:t}=Te.createAndCommit({userAction:"CalloutBlock.handleEmojiChange",environment:this.environment,perform:t=>{Me.sO({store:o,value:e,transaction:t}),(0,ht.Z)(e)&&ft.Z.set({userId:this.environment.currentUser.id,key:Pe.nF,value:e})}});await t}}}renderPersisted(){const{disabled:e}=this.props;return s()("div",{style:{display:"flex"}},void 0,s()("div",{style:this.getStyle()},void 0,s()("div",{},void 0,this.renderIcon()),s()("div",{style:{display:"flex",flexDirection:"column",minWidth:0,marginLeft:8,width:"100%"}},void 0,s()(K.Z,{style:{paddingLeft:Ce.ZD.paddingLeft,paddingRight:Ce.ZD.paddingRight},disabled:!this.canEdit(),store:this.props.store.getBlockTitleStore(),placeholder:p.default.formatMessage(vt.inputPlaceholder),pasteBehavior:"block"}),!this.props.hideContent&&s()(W.Z,{disabled:e,store:this.props.store.getContentStore(),disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag}))),this.renderDiscussion())}renderIcon(){const{store:e}=this.props,t=e.getIcon();return this.canEdit()?s()(we.Z,{bucket:"secure",store:e,isEmptyPage:!1,onChange:this.handleChange,disableRemoveIcon:!0,isCallout:!0,icon:e.getIcon(),size:24,disabled:!1}):s()(we.Z,{icon:t,isEmptyPage:!1,size:24,disabled:!0})}getStyle(){const e=this.props.store.getFormat().block_color||"default",t=(0,b.x7)(e,this.theme);return{...this.props.style,display:"flex",width:"100%",borderRadius:3,border:(0,b.jS)(e)?void 0:`1px solid ${this.theme.darkDividerColor}`,backgroundColor:"transparent",paddingLeft:12,paddingTop:16,paddingBottom:16,paddingRight:16,...t}}}const bt=yt;var St=o(79727);class wt extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.codepen,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with any public CodePen link…",id:"codepenBlock.embed.caption"})}),s()(d.FormattedMessage,{defaultMessage:"Embed CodePen",id:"codepenBlock.placeholder"}))}}const kt=wt;var Ct=o(12022);class _t extends m.Z{constructor(){super(...arguments),this.handleClick=()=>{const{store:e}=this.props;pe.Z.recordVisit({id:e.id,type:se.vu.Link,currentUserId:this.environment.currentUser.id})}}handleCreated(){this.activate(),A.Z.setKeyboardMode(!1)}activate(){if(this.context.overrideLinkClick){const{store:e}=this.props,t=(0,le.ZP)({store:e});this.context.overrideLinkClick(t)}else ne.navigateToBlock({environment:this.environment,store:this.props.store,visitType:se.vu.Link})}renderPersisted(){const{disabled:e}=this.props,t=this.props.store.getCollectionViewSourceCollectionStore();return s()(N.p,{allowSelectionWithin:!1},void 0,s()(De,{store:this.props.store,style:{...this.getBlockColorStyle(),...this.props.style},isAlias:this.props.store.isCollectionViewAlias()||this.props.store.recordStoreParentDiffersFromPersistedParent(),disabled:Boolean(e||(null==t?void 0:t.isSyncedCollection())),onClick:this.handleClick}))}}_t.contextTypes={...ae.wK,...Q.w};const Mt=_t;var Tt=o(96486),It=o.n(Tt),Pt=o(1302),xt=o(13084),Bt=o(52989),Zt=o(78175),Et=o(12534),Rt=o(39500),At=o(50628),Dt=o(480),Ft=o(81954),Lt=o(24405),Vt=o(96049);const Nt=46,Ot=4;function Ut(e){window.__c={n:"ColumnDivider"};const t=(0,Ft.qz)(e.mouseStore,xe.Z),{showHandle:o,onMouseDown:i,onTouchStart:n,onContextMenu:r,onDoubleClick:a}=e,c=(0,Dt.O7)(),d=(0,Ft.VK)((()=>o&&(t.state.mouseEntered||c.device.isMobile&&Vt.Z.state)),[o,t,c.device]),p=(0,l.useCallback)((()=>{t.setState({...t.state,mouseEntered:!1}),Vt.Z.removeListener(p)}),[t]),u=(0,l.useCallback)((()=>{Vt.Z.removeListener(p),Vt.Z.state||t.setState({...t.state,mouseEntered:!0})}),[p,t]),m=(0,l.useCallback)((()=>{Vt.Z.state?Vt.Z.addListener(p):t.setState({...t.state,mouseEntered:!1})}),[p,t]),g=(0,Lt.yK)((e=>{const t={position:"relative",width:Nt,flexGrow:0,flexShrink:0,transition:"opacity 200ms ease-out",opacity:0};return{base:t,hovered:{...t,opacity:1,cursor:"col-resize"},handle:{position:"absolute",top:0,bottom:0,left:Nt/2-Ot/2,width:Ot,height:"100%",background:e.darkDividerColor}}}),[]),h=d?g.hovered:g.base;return s()("div",{style:h,onDoubleClick:a,onMouseDown:i,onTouchStart:n,onContextMenu:r,onMouseEnter:u,onMouseLeave:m},void 0,o&&s()("div",{style:g.handle}))}const Ht=l.memo(Ut);var zt=o(45697),Wt=o.n(zt),jt=o(41432),Kt=o(96802),Yt=o(49085);class Gt extends Yt.Z{getInitialState(){return{dragging:!1}}}const Xt=Gt;var qt=o(23883),$t=o(70518),Jt=o(12137),Qt=o(58202);const eo=function(e){const{columnListStore:t}=e;t.setState({dragging:!1})},to=function(e){const{columnListBlockStore:t,diffX:o,columnListStore:i,leftColumn:n,rightColumn:r}=e;if(i.state.dragging){const{leftColumnStartWidth:e}=i.state,a=(0,Jt.Z)(i.state.leftColumnStartRatio,0,1),{rightColumnStartWidth:s}=i.state,l=(0,Jt.Z)(i.state.rightColumnStartRatio,0,1),c=e+s,d=a+l,p=(0,Jt.Z)(e+o,0,c),u=(0,Jt.Z)(s-o,0,c),m=d*(p/c),g=d*(u/c);if(0===p&&0===u)return i.setState({...i.state,temporaryRatios:{}}),{leftColumnNewRatio:a,rightColumnNewRatio:l};{const e=1/(8*t.getContentLength());let o=Math.round(m/e)*e,s=g+(m-o);return o<e&&(o=e,s=a+l-e),s<e&&(s=e,o=l+a-e),i.setState({...i.state,temporaryRatios:{[n.id]:o,[r.id]:s}}),{leftColumnNewRatio:o,rightColumnNewRatio:s}}}};var oo=o(6685);function io(e){const t=(0,Ft.qz)(e.mouseStore,xe.Z),{canDrag:o,columnList:i,leftColumn:n,rightColumn:a,columnListStore:c}=e,d=(0,Dt.O7)(),p=(0,l.useCallback)((e=>{o&&(e.preventDefault(),function(e){const{environment:t,columnListStore:o,leftColumn:i,rightColumn:n}=e,r=Qt.R.getRect(i),a=Qt.R.getRect(n);r&&a&&(o.setState({dragging:!0,temporaryRatios:{},leftColumnStartWidth:r.width,leftColumnStartRatio:i.getColumnRatio(),rightColumnStartWidth:a.width,rightColumnStartRatio:n.getColumnRatio()}),Xe.ZH(t),qe.ZH(t))}({environment:d,columnListStore:c,leftColumn:n,rightColumn:a}),Xe.ZH(d),qe.sD())}),[o,d,n,c,a]),u=(0,l.useCallback)((e=>{o&&to({columnListBlockStore:i,columnListStore:c,leftColumn:n,rightColumn:a,diffX:e.diffX})}),[o,i,c,n,a]),m=(0,l.useCallback)((e=>{Te.createAndCommit({userAction:"ColumnDivider.handleDragEnd",environment:d,perform:t=>{o&&function(e){const{environment:t,columnListStore:o,transaction:i,leftColumn:n,rightColumn:r}=e,a=to(e);if(a){const{leftColumnNewRatio:e,rightColumnNewRatio:s}=a;Kt.FH({stores:[n],update:{column_ratio:e},transaction:i}),Kt.FH({stores:[r],update:{column_ratio:s},transaction:i}),o.state.dragging&&o.setState({...o.state,temporaryRatios:{}}),k.trackResizeColumn(t)}}({environment:d,columnListBlockStore:i,columnListStore:c,leftColumn:n,rightColumn:a,diffX:e.diffX,transaction:t})}}),eo({columnListStore:c})}),[o,i,c,d,n,a]),g=(0,l.useCallback)((()=>{eo({columnListStore:c})}),[c]),h=(0,l.useCallback)((()=>{Te.createAndCommit({userAction:"ColumnDivider.handleDoubleClick",environment:d,perform:e=>{o&&function(e){const{columnListBlockStore:t,transaction:o,environment:i}=e,n=1/t.getContentLength();Kt.FH({stores:t.getContentStores(),update:{column_ratio:n},transaction:o}),k.trackResetColumnSizes(i)}({environment:d,columnListBlockStore:i,transaction:e})}})}),[o,i,d]);return o?s()(oo.Z,{allowDragWhileTextEditing:!0,onDraggableDragStart:p,onDraggableDragMove:u,onDraggableDragEnd:m,onDraggableDragCancel:g,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0,render:e=>l.createElement(Ht,r()({showHandle:!0,mouseStore:t,onDoubleClick:h},e))}):s()(Ht,{mouseStore:t,showHandle:!1})}const no=l.memo(io);class ro extends m.Z{constructor(){super(...arguments),this.storeTypes={columnListStore:Xt,blockResizerStore:u.Z},this.handleResizeDoubleClick=()=>{Te.createAndCommit({userAction:"ColumnList.handleResizeDoubleClick",environment:this.environment,perform:e=>{if(this.props.store.canEdit()){const t=!this.props.store.getFormat().block_full_width;Kt.FH({stores:[this.props.store],transaction:e,update:{block_full_width:t}})}}})},this.getChildrenLimit=this.createComputedStore((()=>{const{limitParents:e}=qt.Z.state;let t;return this.props.store.findRecordStoreUIAncestor((o=>{const i=e.get(o);return!!i&&(t=i[this.props.store.id],!0)})),t})),this.isColumnListResizableStore=this.createComputedStore((()=>this.props.store.canEdit()&&(0,Zt.Po)(this.props.store,this.environment)))}getChildContext(){return{...this.context,isInColumnList:!0}}renderPersisted(){const{disabled:e}=this.props,t=this.stores.columnListStore.state,o=this.getChildrenLimit.state;let i=this.props.store.getContentStores();It().isNumber(o)&&(i=It().slice(i,0,o));let n=i.map(((e,o)=>{let i;return i=t.dragging&&t.temporaryRatios.hasOwnProperty(e.id)?t.temporaryRatios[e.id]:e.getColumnRatio(),i}));const r=It().sum(n);n=It().map(n,(e=>e/r));const a=[];return i.forEach(((t,o)=>{const r=0===o,l=o===i.length-1;a.push(s()(lo,{store:t,isFirstItem:r,isLastItem:l,numColumns:i.length,ratio:n[o],disabled:e,columnListStore:this.props.store},t.id)),l||a.push(s()(no,{canDrag:this.canEdit(),columnList:this.props.store,leftColumn:t,rightColumn:i[o+1],columnListStore:this.stores.columnListStore},`divider${t.id}`))})),this.renderContainer(a)}renderContainer(e){return this.isColumnListResizableStore.state?s()("div",{style:this.getResizableWrapperStyle()},void 0,s()("div",{style:ro.columnRowStyle},void 0,s()($t.ZP,{disabled:!this.canEdit(),blockResizerStore:this.stores.blockResizerStore,resizeComponent:this,resizerType:$t.IS.Horizontal,resizerAlignment:$t.bZ.Left,preserveScale:!0,resizeHorizontally:!0,resizeVertically:!1,store:this.props.store},"divider-left-edge",s()("div",{style:this.getResizableEdgeHandleStyle("left")},void 0,s()(Ht,{onDoubleClick:this.handleResizeDoubleClick,showHandle:this.canEdit()}))),e,s()($t.ZP,{disabled:!this.canEdit(),resizeComponent:this,resizerType:$t.IS.Horizontal,resizerAlignment:$t.bZ.Right,preserveScale:!0,resizeHorizontally:!0,resizeVertically:!1,store:this.props.store,blockResizerStore:this.stores.blockResizerStore},"divider-right-edge",s()("div",{style:this.getResizableEdgeHandleStyle("right")},void 0,s()(Ht,{onDoubleClick:this.handleResizeDoubleClick,showHandle:this.canEdit()}))))):s()("div",{style:this.getColumnListStyle()},void 0,e)}handleCreated(){const{store:e}=this.props,t=e.getContentStores()[0];if(t&&t.getType()===jt.Ti.column){const e=t.getContentStores()[0];e&&e.getType()===jt.Ti.text&&(Xe.eP({environment:this.environment,store:e}),qe.N_({store:e.getBlockTitleStore()}))}}getColumnListStyle(){const e={display:"flex"};return(0,Zt.zE)(this.props.store,this.environment)||(e.display="block"),e}getResizableWrapperStyle(){const e={position:"relative",transition:"padding 0.2s linear"},t=Boolean(this.props.store.getFormat().block_full_width);return(t&&this.stores.blockResizerStore.state.dragging?this.stores.blockResizerStore.state.temporaryFullWidth:t)&&(e.paddingLeft=Nt,e.paddingRight=Nt),e}getResizableEdgeHandleStyle(e){return{display:"flex",position:"absolute",top:0,bottom:0,right:"left"===e?"100%":"auto",left:"right"===e?"100%":"auto"}}}ro.contextTypes=Q.w,ro.childContextTypes={isInColumnList:Wt().any,...Q.w},ro.topBottomPadding=12,ro.columnRowStyle={display:"flex",position:"relative",flexGrow:1};const ao=ro;class so extends m.Z{constructor(){super(...arguments),this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:i}=e;Te.createAndCommit({userAction:"Column.handleDrop",environment:this.environment,perform:e=>{xt.LQ({environment:this.environment,droppedDirection:t,droppedStores:o,targetParentStore:this.props.columnListStore.getContentStore(),targetStore:this.props.store,duplicate:i,transaction:e})}})},this.handleMouseDown=e=>{(0,Zt.zE)(this.props.store,this.environment)&&(0,Et.ZP)({event:e,context:Et.Af.EditorMouseDown,callback:()=>{this.capturedMouseDown=!0,e.preventDefault(),Bt.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})},this.handleMouseUp=e=>{if(this.capturedMouseDown&&!Rt.uG(e)){const{clientX:t,clientY:o,target:i}=e;Pt.default.afterNextFlush((()=>{qe.J9(this.environment,{x:t,y:o,target:i instanceof Element?i:void 0}),this.capturedMouseDown=!1}))}},this.handleClick=e=>{if(!At.Z.hasBeenUpdatedSince(e.timeStamp)&&this.props.store.canEdit()){const{clientX:t,clientY:o,target:i}=e;Pt.default.afterNextFlush((()=>{Te.createAndCommit({userAction:"Column.handleClick",environment:this.environment,perform:e=>{qe.LG(this.environment,{x:t,y:o,target:i instanceof Element?i:void 0},this.props.store,e)}})}))}}}renderComponent(){const{ratio:e,store:t,isLastItem:o,disabled:i}=this.props,n=1===t.getContentLength(),r=this.canEdit();return s()(O.Z,{isVisible:!0,animationStyle:this.getAnimationStyle({ratio:e}),render:()=>s()("div",{style:this.getStyle(),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick},void 0,s()(j.Z,{store:t,canDropLeft:r&&(0,Zt.zE)(this.props.store,this.environment),canDropRight:o&&r&&(0,Zt.zE)(this.props.store,this.environment),onSelectableDrop:this.handleDrop,analyticsName:"column",style:{display:"flex",flexDirection:"column"},shouldShowDropZone:!0,isListContainer:!0},void 0,s()(W.Z,{store:t.getContentStore(),disabled:i,disableLayout:n,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag})))})}getStyle(){const e={paddingTop:ao.topBottomPadding,paddingBottom:ao.topBottomPadding};return(0,Zt.zE)(this.props.store,this.environment)&&It().assign(e,{flexGrow:0,flexShrink:0}),e}getAnimationStyle(e){let{ratio:t}=e;const o={width:"100%"};return this.props.numColumns>1&&(o.width=`calc((100% - ${Nt*(this.props.numColumns-1)}px) * ${t})`),(0,Zt.zE)(this.props.store,this.environment)||(o.width="100%"),o}}const lo=so;var co=o(13243);class po extends m.Z{renderPersisted(){return s()(N.p,{allowSelectionWithin:!1,style:po.wrapStyle},void 0,s()("div",{style:po.style},void 0,s()(Je.Z,{}),s()("div",{style:po.progressBarStyle},void 0,s()(co.Z,{targetRecordId:this.blockStore().id}))))}}po.style={minHeight:"1.5em",display:"flex",alignItems:"center"},po.progressBarStyle={flex:1,margin:"0 8px"},po.wrapStyle={...Ce.ZD};const uo=po,mo=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Deepnote",id:"deepnoteBlock.embeds.button.label"}});class go extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.deepnote,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Deepnote blocks with public links",id:"deepnoteBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(mo.embedButtonText),urlInputPlaceholder:"https://deepnote.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed Deepnote",id:"deepnoteBlock.placeholder"}))}}const ho=go;var fo=o(6404),vo=o(27724),yo=o(61519);class bo extends m.Z{constructor(){super(...arguments),this.handleClick=e=>{const{device:t}=this.environment;t.isMobile&&(Xe.Ys({environment:this.environment,store:this.props.store}),fo.Qn({environment:this.environment,stores:vo.default.state.stores,left:e.clientX,top:e.clientY,actions:ie.Qi,showInput:!0,analyticsFrom:"content_block_menu"}))}}handleCreated(){Te.createAndCommit({userAction:"DividerBlock.handleCreated",environment:this.environment,perform:e=>xt.Bm({environment:this.environment,targetStore:this.props.store,targetParentStore:this.props.store.getRecordStoreUIParent(),isAtStartOfLine:!1,isClick:!1,transaction:e})})}renderPersisted(){return s()(yo.Z,{className:M.QSt,size:13,style:{color:this.theme.darkDividerColor,pointerEvents:"auto"},onClick:this.handleClick})}}const So=bo;var wo=o(4708);class ko extends m.Z{constructor(){super(...arguments),this.handleCreated=()=>{this.edit()}}renderPersisted(){const e=(0,wo.A3)()?this.getFeatureEnabledProps():this.getFeatureDisabledProps();return l.createElement(g.Z,r()({},this.props,e,{mediaMenuTabs:[],disableMediaMenu:!0,preserveScale:!1,showURLInput:!1}))}edit(){qe.ZH({device:this.environment.device}),Xe.Z5({environment:this.environment,stores:[this.props.store],phase:vo.SelectionPhase.Editing})}getFeatureEnabledProps(){return{source:"https://www.notion.so/product/drawing"}}getFeatureDisabledProps(){return{}}}const Co=ko;var _o=o(61784),Mo=o(91584),To=o(63113),Io=o(40056),Po=o(28415);class xo extends Yt.Z{getInitialState(){return{error:!1,loading:!1}}}const Bo=xo,Zo=(0,d.defineMessages)({menuTitle:{defaultMessage:"Embed",id:"googleDriveBlock.mediaMenuActions.embedTab.title"}});class Eo extends m.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:xe.Z,driveStore:Bo},this.openGoogleDriveFilePicker=e=>{Po.vE({environment:this.environment,accessToken:e.accessToken,callback:t=>{this.loadAndInitializeGoogleDrive(t,e)}})},this.handleMouseEnter=e=>{R.Z.state.isDragging||D.Z.state.isActive||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=e=>{R.Z.state.isDragging||D.Z.state.isActive||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.openMenu=()=>{const{device:e}=this.environment;if(this.canEdit()){const t=Ue.findDOMNode(this);if(t&&t instanceof Element){const o=t.getBoundingClientRect();Ge.$(this.environment,{originRect:o,originGap:0,isSmallWidth:!1,showArrow:!0,currentTab:e.isMobile?"embed":"drive",tabs:this.mediaPickerTabs(),title:p.default.formatMessage(Zo.menuTitle),popupWidth:320,maxHeight:420})}}}}handleCreated(){this.openMenu()}didMount(){super.didMount();const e=this.props.store.getFormat();e&&e.drive_properties&&e.drive_properties.file_id&&e.drive_status&&e.drive_status.last_fetched+5*je.hM<Date.now()&&Mo.WO(this.environment,{id:this.props.store.id,spaceId:(0,ee.CG)(this.props.store.pointer.spaceId)})}renderPersisted(){const e=this.props.store.getProperties(),t=this.props.store.getFormat();return t&&t.drive_properties&&t.drive_status?this.renderBlock(t.drive_properties):e&&e.source?this.renderLegacy():this.renderPlaceholder()}renderBlock(e){const t=e.url;return s()("div",{},void 0,s()("div",{style:{display:"flex"}},void 0,s()(be.Z,{href:t,external:!0,style:this.getContentStyle(),onMouseLeave:this.handleMouseLeave,onMouseEnter:this.handleMouseEnter},void 0,this.renderThumbnail(e),this.renderFile(e),this.shouldShowActionButton()&&this.canEdit()&&this.renderActionMenuButton()),this.renderDiscussion()),this.renderCaption())}renderThumbnail(e){const t=e.thumbnail,o=this.stores.driveStore.state.error;return t&&!o?s()("div",{style:Eo.imageLinkWrapStyle},void 0,s()("div",{style:Eo.imageLinkInnerStyle},void 0,s()(Qe.Z,{url:t,width:1e3,isAuthenticated:!0,permissionRecord:this.props.store.pointer,render:(t,o)=>{if(o){const t=We.SK(o,{v:e.version});return s()("img",{src:t,style:Eo.imageStyle,onError:e=>{this.stores.driveStore.setState({error:!0,loading:!1})}})}t&&this.stores.driveStore.setState({error:!0,loading:!1})}}))):s()("div",{style:this.placeholderStyle()})}renderFile(e){const t=e.title,o=e.url,i=We.Qc(o).hostname;return s()("div",{style:this.getTextWrapStyle()},void 0,t&&s()(et.Z,{style:{marginBottom:2}},void 0,t),this.renderDescription(e),s()("div",{style:this.getLinkStyle()},void 0,e.icon&&s()("div",{style:this.getIconStyle(e.icon)}),s()(et.Z,{style:{color:this.theme.regularTextColor},isSmall:!0},void 0,i)))}renderDescription(e){const t=e.user_name||e.modified_time?s()(d.FormattedMessage,{defaultMessage:"Last modified {hasUserName, select, true {by {userName}} other {}} {hasLastModifiedTime, select, true {{lastModifiedTime}} other {}}",id:"googleDriveBlock.pageDescription",description:"Displayed as a subtitle with the Google Drive file being embedded.",values:{hasUserName:Boolean(e.user_name),userName:e.user_name,hasLastModifiedTime:Boolean(e.modified_time),lastModifiedTime:e.modified_time&&(0,_o.tv)(e.modified_time,y.SP)}}):void 0;return s()("div",{style:this.getDescriptionStyle()},void 0,e.trashed&&s()(d.FormattedMessage,{defaultMessage:"This file is in trash.",id:"googleDriveBlock.pageDeleted.caption"}),t)}renderActionMenuButton(){return s()(Ze.Z,{store:this.props.store,style:{position:"absolute",top:4,right:4,background:g.Z.actionButtonBackground(this.environment)},iconStyle:{fill:b.ZP.white},fadeIn:!0})}renderLegacy(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.googleDrive,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Google Docs, Google Sheets…",id:"googleDriveBlock.legacyLinkInput.caption",description:"This is shown for users using an older Google Drive block version."})}),s()(d.FormattedMessage,{defaultMessage:"Embed a file from Google Drive",id:"googleDriveBlock.legacy.placeholder",description:"This is shown for users using an older Google Drive block version."}))}renderPlaceholder(){const{disabled:e}=this.props,t=this.props.store.getFormat().drive_status,o=!(!t||!t.authed);return s()("div",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,style:{display:"flex"}},void 0,s()(tt.Z,{iconSvg:c.Z.googleDrive,disabled:e,right:this.shouldShowActionButton()&&this.canEdit()&&s()(Ze.Z,{store:this.props.store,fadeIn:!0}),onClick:this.openMenu,isLoading:this.stores.driveStore.state.loading,progressPercent:0},void 0,s()(d.FormattedMessage,o?{defaultMessage:"Choose a file to embed from Google Drive",id:"googleDriveBlock.placeholder.authenticated"}:{defaultMessage:"Connect Google Drive to Notion to embed a file",id:"googleDriveBlock.placeholder.notAuthenticated"})),this.renderDiscussion())}shouldShowActionButton(){const{device:e}=this.environment;return e.isMobile||this.stores.mouseStore.state.mouseEntered}async loadAndInitializeGoogleDrive(e,t){this.stores.driveStore.setState({loading:!0,error:!1});const o=await Mo.Ui({environment:this.environment,store:this.props.store,fileId:e,token:t});this.stores.driveStore.setState({loading:!1,error:!o||!!o.auth_error})}async initializeGoogleDriveBlockFromUrl(e){const t=Io.id(e);if(!t)return void this.convertToTextBlock(e);const o=await Mo.Ui({environment:this.environment,store:this.props.store,fileId:t});o&&o.auth_error&&(Mo.cR(this.environment,{onSuccess:e=>{this.loadAndInitializeGoogleDrive(t,e)},onFailure:()=>{this.convertToTextBlock(e)}}),this.trackAuthPrompt("url_embed"))}convertToTextBlock(e){Te.createAndCommit({userAction:"DriveBlock.convertToTextBlock",environment:this.environment,perform:t=>{Me.sW({store:this.props.store.getPropertiesStore(),data:{title:[ze.V3(e,[ze.ed(e)])]},transaction:t}),To.Cj({environment:this.environment,blocks:[this.props.store],blockType:"text",transaction:t})}})}mediaPickerTabs(){const{device:e}=this.environment,t=[];return t.push({type:"embed",caption:s()(d.FormattedMessage,{defaultMessage:"Works with any file in your Google Drive",id:"googleDriveBlock.embedTab.caption"}),buttonText:s()(d.FormattedMessage,{defaultMessage:"Embed Google Drive file",id:"googleDriveBlock.embedTab.embedButton.label"}),onChange:e=>{Ge.Z(),this.initializeGoogleDriveBlockFromUrl(e)}}),e.isMobile||t.push({type:"drive",title:s()(d.FormattedMessage,{defaultMessage:"Browse Google Drive",id:"googleDriveBlock.mediaPicker.googleDriveTab.title"}),onSelect:async e=>{if(Ge.Z(),e&&e.token)this.openGoogleDriveFilePicker(e.token),k.trackOpenGoogleDriveFilePicker(this.environment);else{const e=await Mo.qN(this.environment);e&&e.token&&this.openGoogleDriveFilePicker(e.token),this.trackAuthPrompt("drive_file_picker")}}}),t}trackAuthPrompt(e){k.trackPromptAuthIntegration(this.environment,{integration_name:"google",from:e})}getContentStyle(){return{display:"flex",flexDirection:"column",width:"100%",border:`1px solid ${this.theme.darkDividerColor}`,borderRadius:3,position:"relative"}}placeholderStyle(){return{...Eo.imageLinkWrapStyle,paddingBottom:"20%",minHeight:80,background:this.theme.embedPlaceholderBackground}}getIconStyle(e){return{flexShrink:0,backgroundImage:`url(${e})`,backgroundSize:"cover",width:16,height:16,marginRight:6}}getTextWrapStyle(){return{width:"100%",minHeight:60,padding:14,paddingTop:12,overflow:"hidden",borderTop:`1px solid ${this.theme.darkDividerColor}`}}getDescriptionStyle(){return{fontSize:12,lineHeight:1.3,color:this.theme.mediumTextColor,maxHeight:32,overflow:"hidden"}}getLinkStyle(){return{display:"flex",alignItems:"center",marginTop:6}}}Eo.imageLinkWrapStyle={display:"block",position:"relative",width:"100%",paddingBottom:"55%"},Eo.imageLinkInnerStyle={position:"absolute",top:0,left:0,right:0,bottom:0},Eo.imageStyle={display:"block",width:"100%",height:"100%",objectFit:"cover",objectPosition:"top"};const Ro=Eo;var Ao=o(83631),Do=o(77907),Fo=o(3702),Lo=o(22492),Vo=o(40148);class No extends m.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:xe.Z,buttonPopupStore:B.Z},this.renderOrigin=()=>{const{device:e}=this.environment,{store:t}=this.props,o=this.getValue();let i,n={};return o?i=s()(Lo.Z,{display:"block",equation:o,style:this.getContainerStyle(!1),errorStyle:this.getContainerStyle(!0),theme:this.theme}):(i=s()(Vo.Z,{iconSvg:c.Z.tex,iconStyle:{width:28,height:28,marginRight:8},style:{background:void 0}},"button",s()(d.FormattedMessage,{defaultMessage:"Add a TeX equation",id:"equationBlock.empty.placeholder"})),n={background:this.theme.sidebarBackground}),s()(U.Z,{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleOpen,style:{position:"relative",width:"100%",borderRadius:3,...n}},void 0,i,this.canEdit()&&(this.stores.mouseStore.state.mouseEntered||e.isMobile)&&s()(Ze.Z,{store:t,tooltipContent:s()(d.FormattedMessage,{defaultMessage:"Rename, delete, and more…",id:"equationBlock.actions.tooltip"}),style:{position:"absolute",top:4,right:4,color:this.theme.mediumTextColor},fadeIn:!0}))},this.handleChange=e=>{Te.createAndCommit({userAction:"EquationBlock.handleChange",environment:this.environment,perform:t=>{Me.sW({store:this.props.store.getPropertiesStore(),data:{title:ze.TP(e)},transaction:t})}})},this.handleOpen=()=>{this.stores.buttonPopupStore.setState({...this.stores.buttonPopupStore.state,open:!0})},this.handleClose=()=>{this.stores.buttonPopupStore.setState({...this.stores.buttonPopupStore.state,open:!1}),Xe.Ys({environment:this.environment,store:this.props.store})},this.handleMouseMove=e=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=e=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleSubmit=()=>{k.trackEquationBlockEdit(this.environment,{equation:this.getValue()})}}handleCreated(){this.handleOpen()}edit(){this.handleOpen()}activate(){this.stores.buttonPopupStore.state.open?this.handleClose():this.handleOpen()}renderPersisted(){const e=this.getValue(),t=this.stores.buttonPopupStore.state.open?{isOpen:!0,equationValue:e,error:Ao.by({environment:this.environment,equation:e,displayMode:"block"})}:{isOpen:!1,equationValue:void 0,error:void 0},o=!this.canEdit(),i=this.renderOrigin();return s()(N.p,{allowSelectionWithin:!0,style:{display:"flex",position:"relative"}},void 0,s()(Do.DependencyConsumer,{dependency:Do.deps.prismjs},void 0,(e=>l.createElement(Fo.Z,r()({},t,{Prism:e,displayMode:"block",disabled:o,origin:i,onDismiss:this.handleClose,onChange:this.handleChange,onSubmit:this.handleSubmit})))),this.renderDiscussion())}getValue(){const e=this.props.store.getProperties();return ze.Jc(e&&e.title)}getContainerStyle(e){const t={display:"flex",padding:"4px 8px",width:"100%"};return this.getValue()?(t.flexDirection="column",t.overflow="auto"):t.color=b.ZP.contentPlaceholder,e&&(t.background=this.theme.equationErrorPlaceholderBackground),{...t,...this.getBlockColorStyle()}}}const Oo=No,Uo=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Excalidraw",id:"excalidrawBlock.embeds.button.label"}});class Ho extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.excalidraw,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Excalidraw whiteboards.",id:"excalidrawBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(Uo.embedButtonText),urlInputPlaceholder:"https://excalidraw.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed Excalidraw",id:"excalidrawBlock.placeholder"}))}}const zo=Ho;var Wo=o(76745),jo=o(95802),Ko=o(26664),Yo=o(54532),Go=o(42858);var Xo=o(21325),qo=o(52315);class $o extends Yt.Z{getInitialState(){return{open:!1}}}const Jo=$o;var Qo=o(42922),ei=o(23189),ti=o(13490);class oi extends Q.Z{constructor(){super(...arguments),this.storeTypes={store:Jo},this.renderProperty=(e,t)=>{let{title:o,subtitle:i,value:n}=e;return s()("div",{},t,s()(yo.Z,{size:36}),s()(ti.Z,{},void 0,o),s()(et.Z,{isSmall:!0},void 0,i),s()("div",{style:{marginTop:8,padding:6,background:this.theme.sidebarBackground,borderRadius:3}},void 0,n))},this.handleCloseClick=()=>{this.stores.store.setState({...this.stores.store.state,open:!1})}}renderComponent(){return this.stores.store.state.open?s()("div",{style:{flexGrow:1,minWidth:0}},void 0,this.props.origin,s()("div",{style:{position:"relative",boxShadow:`inset 0 0 0 1px ${this.theme.regularDividerColor}`,padding:12,borderRadius:3,overflow:"hidden"}},void 0,s()("div",{style:{display:"flex",alignItems:"center"}},void 0,s()(ei.Z,{style:{flex:1,marginRight:16,marginBottom:0}},void 0,this.props.title),s()(Qo.Z,{onClick:this.handleCloseClick},void 0,s()(d.FormattedMessage,{defaultMessage:"Close",id:"factoryBlock.configureMenu.closeButton.label"}))),this.props.properties.map(this.renderProperty))):this.props.origin}}oi.displayName="Configurable",oi.headStyle={display:"flex",alignItems:"center"},oi.titleStyle={flex:1,fontSize:14,userSelect:"none",WebKitUserSelect:"none",cursor:"default"};const ii=oi;var ni=o(61134),ri=o(73063),ai=o(89728);const si=(0,d.defineMessages)({addNewItem:{defaultMessage:"Add a new item",id:"factoryBlock.newItem.button.label"},buttonPlaceholder:{defaultMessage:"Add a new item",id:"factoryBlock.newItem.button.placeholder"}});class li extends m.Z{constructor(){super(...arguments),this.storeTypes={configurableStore:Jo,mouseStore:xe.Z},this.handleMouseMove=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleButtonClick=()=>{this.canEdit()&&Xo.M_(this.environment)&&Te.createAndCommit({userAction:"FactoryBlock.handleButtonClick",environment:this.environment,perform:e=>{!function(e){const{store:t,transaction:o,environment:i}=e,n=t.getRecordStoreUIParent();let r=!1;n&&n.valueIs(Ko.i)&&It().head(n.getValue())!==t.id&&It().last(n.getValue())===t.id&&(r=!0);const a=t.getContentStores().filter((e=>e.isDefined()));r||a.reverse();const s=jo.C.findSelectableFromStore(t),l=[],c=Promise.all(a.map((e=>new Promise((t=>{const n=e.getModel(),a=!n||!n.isTemplateVariableContainerBlock(),[c,d]=Yo.Qi({environment:i,store:e,transaction:o,addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:a,targetSpaceId:(0,ee.CG)(e.pointer.spaceId),baseUrl:re.Z.domainBaseUrl,publicDomainName:re.Z.publicDomainName,preferDuplicateLocation:"local"});d.then((e=>{e&&Ye.showErrorMessage(e),t()})),s&&(r?s.props.onInsertAbove&&s.props.canInsertAbove&&l.push(s.props.onInsertAbove({insertStores:[c],transaction:o})[0]):s.props.onInsertBelow&&s.props.canInsertBelow&&l.push(s.props.onInsertBelow({insertStores:[c],transaction:o})[0]))})))));r||l.reverse(),Xe.Z5({environment:i,stores:l}),c.then((()=>{Pt.default.afterNextFlush((()=>{Go.DV({environment:i,insertedStores:l,isCreated:!0})}))}))}({environment:this.environment,store:this.props.store,transaction:e})}})},this.handleToggleConfigure=()=>{this.stores.configurableStore.state.open?this.stores.configurableStore.setState({...this.stores.configurableStore.state,open:!1}):(k.trackConfigureTemplateButton(this.environment,{from:"gear_button"}),this.stores.configurableStore.setState({...this.stores.configurableStore.state,open:!0}))}}willMountOrUpdate(e){super.willMountOrUpdate(e),qo.b(e.store)}handleCreated(){this.configure()}activate(){this.handleButtonClick()}configure(){this.stores.configurableStore.setState({...this.stores.configurableStore.state,open:!0})}renderPersisted(){const e=this.getDisabled();return s()(N.p,{allowSelectionWithin:!0,style:{display:"flex"}},void 0,s()(ii,{title:s()(d.FormattedMessage,{defaultMessage:"Configure template button",id:"factoryBlock.configureButton.label"}),origin:this.renderFactory(),store:this.stores.configurableStore,properties:[{title:s()(d.FormattedMessage,{defaultMessage:"Button name",id:"factoryBlock.buttonName.title"}),subtitle:s()(d.FormattedMessage,{defaultMessage:"What should this button be called?",id:"factoryBlock.buttonName.subtitle"}),value:s()(K.Z,{disabled:e,store:this.getInteriorTitleStore(),placeholder:p.default.formatMessage(si.addNewItem),onEnter:It().identity,pasteBehavior:"inline"})},{title:s()(d.FormattedMessage,{defaultMessage:"Template",id:"factoryBlock.templateArea.title",description:"Title of the area where user should drop blocks in that will be duplicated every time they add a new item."}),subtitle:s()(d.FormattedMessage,{defaultMessage:"Drop blocks here that you want to duplicate whenever the button is clicked.",id:"factoryBlock.templateArea.subtitle.",description:"Subtitle of the area where user should drop blocks in that will be duplicated every time they add a new item."}),value:s()(ni.O,{displayName:"FactoryBlockContent",disabled:e},void 0,s()(W.Z,{disabled:e,store:this.props.store.getContentStore(),emptyPlaceholder:s()("div",{style:{caretColor:this.theme.regularTextColor,color:this.theme.regularTextColor}},void 0,s()(d.FormattedMessage,{defaultMessage:"Empty. Drop blocks here…",id:"factoryBlock.emptyTemplate.placeholder"})),disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag}))}]}),this.renderDiscussion())}renderFactory(){const{device:e}=this.environment,t=this.getDisabled();return s()(ai.Z,{icon:c.Z.plus,isGray:!0,isLarge:!0,style:{fontSize:"inherit",width:"100%"},shouldShrink:!0,onClick:this.handleButtonClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,disabled:t},void 0,s()(K.Z,{disabled:!0,store:this.props.store.getBlockTitleStore(),placeholder:p.default.formatMessage(si.buttonPlaceholder),style:li.buttonTextStyle,placeholderStyle:this.getPlaceholderStyle()}),!t&&(e.isMobile||this.stores.mouseStore.state.mouseEntered)&&s()("div",{style:{display:"flex",alignItems:"center"},className:M.JiD},void 0,!e.isMobile&&this.renderConfigureButton(),s()(Ze.Z,{tooltipContent:s()(d.FormattedMessage,{defaultMessage:"More actions…",id:"factoryBlock.moreActions.button.label"}),store:this.props.store,fadeIn:!0})))}renderConfigureButton(){return s()(Ee.Z,{renderTooltip:()=>s()(d.FormattedMessage,{defaultMessage:"Configure template",id:"factoryBlock.configureTemplate.button.label"}),delayThreshold:300,render:e=>l.createElement(ri.Z,r()({icon:c.Z.factoryBlockSettings,onClick:this.handleToggleConfigure},e))})}getDisabled(){return this.props.disabled||!this.canEdit()}getInteriorTitleStore(){return ge.G.createChildStore(this.props.store,this.props.store.pointer).getBlockTitleStore()}getPlaceholderStyle(){return{width:"100%",display:"block",caretColor:this.theme.regularTextColor,color:this.theme.regularTextColor,...S.Z.textOverflowStyle}}}li.buttonTextStyle={pointerEvents:"none",...S.Z.textOverflowStyle};const ci=li;class di extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.figma,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with any public Figma shareable link",id:"figmaBlock.caption"})}),s()(d.FormattedMessage,{defaultMessage:"Embed Figma",id:"figmaBlock.placeholder"}))}}const pi=di;var ui=o(69721);const mi=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Framer",id:"framerBlock.embedFramer.button.label"}});class gi extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.framer,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Framer prototypes",id:"framerBlock.linkInput.caption"}),embedButtonText:p.default.formatMessage(mi.embedButtonText),urlInputPlaceholder:"https://framer.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed a Framer prototype",id:"framerBlock.placeholder"}))}}const hi=gi,fi=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Gist",id:"gistBlock.embedButton.label"}});class vi extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.github,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with links to Gists on GitHub",id:"gistBlock.linkInput.caption"}),embedButtonText:p.default.formatMessage(fi.embedButtonText),urlInputPlaceholder:"https://gist.github.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed a Gist",id:"gistBlock.placeholder"}))}}const yi=vi;var bi=o(35328),Si=o(29373),wi=o(45131),ki=o(59649),Ci=o(5210);class _i extends Q.Z{constructor(){super(...arguments),this.isToggleable=this.createComputedStore((()=>{const{store:e}=this.props.blockComponent.props;return bi.fn(e)})),this.blockHasContent=this.createComputedStore((()=>{var e;const{store:t}=this.props.blockComponent.props;return null===(e=t.getFormat())||void 0===e?void 0:e.toggleable})),this.toggle=()=>{bi.th(this.props.blockComponent)},this.isOpen=this.createComputedStore((()=>{const{store:e,hideContent:t}=this.props.blockComponent.props;return wi.Z.isOpen(e.id)&&!t})),this.isEmpty=this.createComputedStore((()=>{const{store:e}=this.props.blockComponent.props;return!e.hasContent()})),this.handlePlaceholderClick=()=>{const{store:e}=this.props.blockComponent.props;Te.createAndCommit({userAction:"FormatToggleable.handlePlaceholderClick",environment:this.environment,perform:t=>{Si.ls({environment:this.environment,store:e,transaction:t})}})}}willMount(){const{store:e}=this.props.blockComponent.props;Si.nz({blockId:e.id,currentUserId:this.environment.currentUser.id}),e.isDefaultRecordCache()&&Si.LO(this.environment,e.pointer)}renderToggleButton(){return s()(Ci.Z,{isSidebar:!1,open:this.isOpen.state,fill:!this.isEmpty.state,onClick:this.toggle,tapArea:this.environment.device.isMobile?{size:30}:void 0})}renderPlaceHolder(){const{disabled:e}=this.props.blockComponent.props;return s()(U.Z,{style:{fontSize:"inherit",width:"100%",borderRadius:3,caretColor:this.theme.lightTextColor,...Ce.ZD,marginTop:2},onClick:this.handlePlaceholderClick,disabled:e},void 0,s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(d.FormattedMessage,{defaultMessage:"Empty toggle. Click or drop blocks inside.",id:"toggleBlockFormat.emptyBlock.placeholderText",description:"Placeholder text for an empty toggle block"})))}renderContent(){const{disabled:e,store:t,disableCommentMenu:o,disableHoverMenu:i,disableDrag:n}=this.props.blockComponent.props,r=qo.b(t)||!t.isDefaultRecordCache();return this.isOpen.state?s()(ki.Z,{loaded:r,spinnerSize:"1em",showSpinnerTimeout:500,innerStyle:{display:"flex",flexDirection:"column"}},void 0,s()(W.Z,{store:t.getContentStore(),emptyPlaceholder:this.isToggleable.state?this.renderPlaceHolder():void 0,disabled:e,disableCommentMenu:o,disableHoverMenu:i,disableDrag:n})):s()(W.Z,{store:t.getContentStore(),disabled:e,disableContent:!0})}renderComponent(){const{children:e,childrenStyleWhenToggleable:t}=this.props;return this.isToggleable.state?s()(Re.ZP,{style:{paddingLeft:Ce.ZD.paddingLeft},left:this.renderToggleButton(),leftStyle:{paddingRight:2,...this.props.toggleStyle}},void 0,s()("div",{style:t},void 0,e),this.renderContent()):this.blockHasContent.state?s()("div",{style:{display:"flex",flexDirection:"column"}},void 0,s()("div",{style:t},void 0,e),this.renderContent()):e}}_i.displayName="FormatToggleable";const Mi=_i,Ti=(0,d.defineMessages)({placeholder:{defaultMessage:"Heading 1",id:"header1Block.placeholder"}});class Ii extends m.Z{constructor(){super(...arguments),this.getHeaderTextStyle=()=>{const{device:e}=this.environment,t=this.rootStorePageFont.state,o=e.isMobile?1.5:1.875;return{fontFamily:S.Z.getHeaderFontFamily({pageFont:t,locale:y.SP}),fontWeight:S.Z.fontWeight.semibold,fontSize:`${o}em`,lineHeight:1.3}}}activate(){bi.th(this)}renderPersisted(){const{disabled:e}=this.props;return s()("div",{style:this.getStyle()},void 0,s()(Mi,{blockComponent:this,toggleStyle:this.getToggleStyle(),childrenStyleWhenToggleable:{display:"flex"}},void 0,s()(K.Z,{disabled:e,store:this.props.store.getBlockTitleStore(),placeholder:p.default.formatMessage(Ti.placeholder),placeholderStyle:{WebkitTextFillColor:this.theme.headerBlockPlaceholderTextColor},style:{...Ce.ZD,...this.getHeaderTextStyle()},pasteBehavior:"block"}),this.renderDiscussion()))}getStyle(){return{display:"flex",width:"100%",...this.getBlockColorStyle(),...this.props.style}}getToggleStyle(){const{device:e}=this.environment;return{height:`${1.3*(e.isMobile?1.5:1.875)}em`,marginTop:3}}}const Pi=Ii,xi=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Hex",id:"hexBlock.embeds.button.label"}});class Bi extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.hex,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Hex cell links with public access.",id:"hexBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(xi.embedButtonText),urlInputPlaceholder:"https://hex.tech/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed Hex",id:"hexBlock.placeholder"}))}}const Zi=Bi;var Ei=o(56813);const Ri=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Invision",id:"invisionBlock.embeds.button.label"}});class Ai extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.invision,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Invision projects",id:"invisionBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(Ri.embedButtonText),urlInputPlaceholder:"https://invis.io/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed an Invision project",id:"invisionBlock.placeholder"}))}}const Di=Ai;var Fi=o(6287),Li=o(72711),Vi=o(31299),Ni=o(68056);class Oi extends Yt.Z{getInitialState(){return{query:""}}}const Ui=Oi;var Hi=o(69454),zi=o(24666),Wi=o(3386),ji=o(9342),Ki=o(43765),Yi=o(11470),Gi=o(77137),Xi=o(72495),qi=o(75987),$i=o(36488),Ji=o(74194),Qi=o(44532);class en extends Q.Z{constructor(){super(...arguments),this.storeTypes={store:Ui},this.handleQueryUpdateDebounced=void 0,this.handleInputChange=e=>{const t=e.target.value;this.stores.store.setState({...this.stores.store.state,query:t}),this.handleQueryUpdateDebounced(t)},this.handleQueryUpdate=e=>{this.props.onQueryUpdate&&this.props.onQueryUpdate({query:e,autocompleteStore:this.stores.store})}}get registries(){return[qi.Z]}willMount(e){super.willMount(e),this.handleQueryUpdateDebounced=It().debounce(this.handleQueryUpdate,this.props.queryUpdateDebounce)}renderComponent(){const{device:e}=this.environment;return s()(Qi.ZP,{popupType:e.isPhone?Qi.ZP.PopupType.SlideUp:Qi.ZP.PopupType.Popup,open:this.props.isOpen,origin:this.renderInput(),placementToOrigin:Qi.ZP.Placement.Bottom,alignmentToOrigin:Qi.ZP.Alignment.Start,originGap:4,disableDarkOverlayBackground:e.isPhone,onDismiss:this.props.onBgClick,render:this.props.renderPopup,preventCaptureEsc:this.props.preventCaptureEsc,disableMouseCapture:this.props.disableMouseCapture,style:this.props.popupStyle})}renderInput(){const e=this.props.isOpen;return s()($i.Z,{capture:e,allowMenuList:!0,render:e=>l.createElement(N.p,r()({allowSelectionWithin:!0},e),s()(Ji.Z,{style:this.props.inputStyle,format:void 0!==this.props.format?this.props.format:Ji.Z.Format.Transparent,value:this.stores.store.state.query,onClick:this.props.onInputClick,onFocus:this.props.onInputFocus,onBlur:this.props.onInputBlur,onChange:this.handleInputChange,placeholder:this.props.inputPlaceholder,focus:this.props.focus}))})}}en.displayName="InlineAutocomplete";const tn=en,on=(0,d.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a database…",id:"linkToCollectionBlock.input.placeholder"}});class nn extends m.Z{constructor(){super(...arguments),this.didPerformAction=!1,this.storeTypes={autocompleteStore:Ui,mouseStore:xe.Z},this.handleBlur=()=>{qe.ZH(this.environment),this.didPerformAction||(this.didPerformAction=!0,Te.createAndCommit({userAction:"LinkToCollectionBlock.handleBlur",environment:this.environment,perform:e=>{Go.Od({store:this.props.store,transaction:e})}}))},this.isEditing=this.createComputedStore((()=>{const{store:e}=this.props,t=zi.default.state;return Boolean("editing"===t.mode&&(0,Ni.qS)(t.multiSelection)&&t.multiSelection.start.store.id===e.id)})),this.performQuery=async e=>this.props.store.isDefaultRecordCache()?(await Vi.bm(this.environment,{query:e,limit:20,source:"link_to_collection_block"})).results:[]}handleCreated(){Xe.$Y({environment:this.environment,phase:vo.SelectionPhase.Editing}),qe.Z5({store:this.props.store,selection:void 0})}renderComponent(){if(this.isEditing.state)return this.renderSearchInput()}renderSearchInput(){const{device:e}=this.environment,{query:t}=this.stores.autocompleteStore.state;return s()(Gi.Z,{request:t,performRequest:this.performQuery,debounce:Vi.vp,render:(t,o,i)=>{const n=(o||[]).map((e=>{const t=ge.NW.createChildStore(this.props.store,{table:Fi.v,id:e});return{key:e,render:e=>l.createElement(Yi.Z,r()({},e,{store:t})),action:()=>{if(!this.didPerformAction){this.didPerformAction=!0;const{store:e}=this.props;Te.createAndCommit({userAction:"LinkToCollectionBlock.menuListItem",environment:this.environment,perform:o=>{const i=Li.Y_({environment:this.environment,store:e,collectionStore:t,collectionViewStore:void 0,transaction:o});i&&Xe.Z5({environment:this.environment,stores:[i]})}})}}}}));return s()(Wi.Z,{capture:this.isEditing.state},void 0,s()(tn,{loading:!i,isOpen:!0,store:this.stores.autocompleteStore,queryUpdateDebounce:Vi.vp,inputPlaceholder:p.default.formatMessage(on.inputPlaceholder),focus:!0,inputStyle:this.getInputStyle(),onBgClick:this.handleBlur,renderPopup:()=>{let t,a;return t=o&&0===n.length?s()(Xi.Z,{title:s()(d.FormattedMessage,{defaultMessage:"Select a database",id:"linkToCollectionBlock.menuItem.noResults.title"}),loading:!i},void 0,s()(Ki.Z,{title:s()(d.FormattedMessage,{defaultMessage:"No results",id:"linkToCollectionBlock.menuItem.noResults.label"})})):s()(ji.Z,{type:ji.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>l.createElement(Xi.Z,r()({},e,{title:s()(d.FormattedMessage,{defaultMessage:"Select a database",id:"linkToCollectionBlock.menuItem.showResults.title"}),loading:!i})),items:n}]}),a=e.isPhone?{menuType:ce.og.ActionSheet,disableBottomPadding:!0,maxHeight:`calc(70vh - ${Hi.Z.estimatedNativeWebBottomOverlap()}px)`}:{menuType:ce.og.Popup,width:460,maxHeight:e.isPhone?"30vh":"40vh"},l.createElement(Se.Z,a,t)}}))}})}getTitleStyle(){return{lineHeight:1.3}}getInputStyle(){return{...this.getTitleStyle(),borderBottom:void 0}}}const rn=nn;var an=o(27006),sn=o(61045),ln=o(28020),cn=o(79315);const dn=(0,d.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a page…",id:"linkToPageBlock.searchPlaceholder"}});class pn extends m.Z{constructor(){super(...arguments),this.didPerformAction=!1,this.storeTypes={autocompleteStore:Ui,mouseStore:xe.Z},this.handleBlur=()=>{qe.ZH(this.environment),this.didPerformAction||(this.didPerformAction=!0,Te.createAndCommit({userAction:"LinkToPageBlock.handleBlur",environment:this.environment,perform:e=>{Go.Od({store:this.props.store,transaction:e})}}))},this.isEditing=this.createComputedStore((()=>{const{store:e}=this.props,t=zi.default.state;return Boolean("editing"===t.mode&&(0,Ni.qS)(t.multiSelection)&&t.multiSelection.start.store.id===e.id)})),this.performQuery=async e=>{const{currentSpaceStore:t,mainEditorCurrentBlockStore:o}=cn.default.state,{store:i}=this.props,n=(0,Ie.YO)(i).find((e=>{let{permissionItem:t}=e;return(0,an.$D)(t)}));if(this.props.store.isDefaultRecordCache()&&(t||n)){if(!e)return n&&!t&&o?[o.id]:ln._u(this.environment).map((e=>e.id));if(t){return(await Vi.nJ({environment:this.environment,query:e,limit:20,spaceId:t.id,requireEditPermissions:!1,excludeTemplates:!1,source:"link_to_page_block",boostRecentlyViewedPages:!0})).results}if(n&&n.from.table===te.iU){return(await Vi.M0({environment:this.environment,query:e,limit:20,ancestorId:n.from.blockId,excludeTemplates:!1,source:"link_to_page_block"})).results}}return[]}}handleCreated(){const{device:e}=this.environment;Xe.$Y({environment:this.environment,phase:vo.SelectionPhase.Editing}),qe.Z5({store:this.props.store,selection:void 0}),e.isMobile&&Hi.Z.onShow((()=>sn.hQ(this.environment)))}renderComponent(){if(this.isEditing.state)return this.renderSearchInput()}renderSearchInput(){const{device:e}=this.environment,{query:t}=this.stores.autocompleteStore.state,o={request:t,performRequest:this.performQuery,debounce:Vi.vp,render:(t,o,i)=>{const n=(o||[]).map((e=>{const t=ge.G.createChildStore(this.props.store,{table:te.iU,id:e});return{key:e,render:e=>l.createElement(Yi.Z,r()({},e,{store:t})),action:()=>{this.didPerformAction||(this.didPerformAction=!0,Te.createAndCommit({userAction:"LinkToPageBlock.menuListItem",environment:this.environment,perform:e=>{const o=Li.hc({environment:this.environment,store:this.props.store,targetStore:t,transaction:e});o&&Xe.Z5({environment:this.environment,stores:[o]})}}))}}}));return s()(Wi.Z,{capture:this.isEditing.state},void 0,s()(tn,{loading:!i,isOpen:!0,store:this.stores.autocompleteStore,queryUpdateDebounce:Vi.vp,inputPlaceholder:p.default.formatMessage(dn.inputPlaceholder),focus:!0,inputStyle:this.getInputStyle(),onBgClick:this.handleBlur,renderPopup:()=>{let t,a;return t=o&&0===n.length?s()(Xi.Z,{title:s()(d.FormattedMessage,{defaultMessage:"Select a page",id:"linkToPageBlock.selectPrompt"}),loading:!i},void 0,s()(Ki.Z,{title:s()(d.FormattedMessage,{defaultMessage:"No results",id:"linkToPageBlock.noSearchResults"})})):s()(ji.Z,{type:ji.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>l.createElement(Xi.Z,r()({},e,{title:s()(d.FormattedMessage,{defaultMessage:"Select a page",id:"linkToPageBlock.selectPrompt.withContents"}),loading:!i})),items:n}]}),a=e.isPhone?{menuType:ce.og.ActionSheet,disableBottomPadding:!0,maxHeight:`calc(70vh - ${Hi.Z.estimatedNativeWebBottomOverlap()}px)`}:{menuType:ce.og.Popup,width:460,maxHeight:e.isMobile?"30vh":"40vh"},l.createElement(Se.Z,a,t)}}))}};return l.createElement(Gi.Z,o)}getTitleStyle(){return{lineHeight:1.3}}getInputStyle(){return{...this.getTitleStyle(),borderBottom:void 0}}}const un=pn;class mn extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.loom,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with any Loom shareable link",id:"loomBlock.embed.caption"})}),s()(d.FormattedMessage,{defaultMessage:"Embed Loom",id:"loomBlock.placeholder"}))}}const gn=mn,hn=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Map",id:"googleMapsBlock.embedButton.label"}});class fn extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.maps,urlInputPlaceholder:"https://www.google.com/maps…",embedButtonText:p.default.formatMessage(hn.embedButtonText),mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with places on Google Maps",id:"googleMapsBlock.embed.caption"})}),s()(d.FormattedMessage,{defaultMessage:"Embed a Google Map",id:"googleMapsBlock.placeholder"}))}}const vn=fn,yn=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Miro",id:"miroBlock.embeds.button.label"}});class bn extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.miro,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Miro links with public access enabled",id:"miroBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(yn.embedButtonText),urlInputPlaceholder:"https://miro.com/app/board/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed Miro",id:"miroBlock.placeholder"}))}}const Sn=bn,wn=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Mixpanel",id:"mixpanelBlock.embeds.button.label"}});class kn extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.mixpanel,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Mixpanel projects",id:"mixpanelBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(wn.embedButtonText),urlInputPlaceholder:"https://mixpanel.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed a Mixpanel project",id:"mixpanelBlock.placeholder"}))}}const Cn=kn;var _n=o(99445);class Mn extends Q.Z{constructor(){super(...arguments),this.counterStore=this.createComputedStore((()=>{if(!this.props.numberedListCounterStore)return Tn({rank:0,index:1,listFormat:void 0});const e=this.props.numberedListCounterStore.state.numberedListBlockIdsWithFormat.find((e=>e.id===this.props.store.id));return Tn({rank:(null==e?void 0:e.depth)||0,index:(null==e?void 0:e.index)||0,listFormat:null==e?void 0:e.format})}))}renderComponent(){const e=this.counterStore.state.index.toString().length;let t=24;return"roman"===this.counterStore.state.listFormat?t=56:3===e?t=32:4===e?t=42:e>4&&(t="unset"),l.createElement("span",(0,dt.iv)({pseudoBefore:{content:`"${this.counterStore.state.index}."`},textAlign:"center",whiteSpace:"nowrap",width:t}))}}function Tn(e){const{rank:t,index:o,listFormat:i}=e;if("numbers"===i)return{index:o,listFormat:i};if("letters"===i)return{index:(0,_n.yt)(o),listFormat:i};if("roman"===i)return{index:(0,_n.bW)(o),listFormat:i};{const e=t%3;return 0===e?{index:o,listFormat:"numbers"}:1===e?{index:(0,_n.yt)(o),listFormat:"letters"}:{index:(0,_n.bW)(o),listFormat:"roman"}}}Mn.displayName="NumberedListCounter";const In=Mn,Pn=(0,d.defineMessages)({listPlaceholder:{defaultMessage:"List",id:"numberedListBlock.placeholder.label"}});class xn extends m.Z{renderPersisted(){const{store:e,disabled:t,numberedListCounterStore:o}=this.props,i=e.getBlockTitleStore();return s()(Re.ZP,{style:this.getStyle(),left:s()(In,{store:e,numberedListCounterStore:o}),leftStyle:{width:"unset"},childrenStyle:{display:"flex",flexDirection:"column"}},void 0,s()("div",{style:{display:"flex"}},void 0,s()(K.Z,{style:Re.R8,disabled:t,store:i,placeholder:p.default.formatMessage(Pn.listPlaceholder),pasteBehavior:"block"}),this.renderDiscussion({style:mt.discussionIndicatorStyle})),!this.props.hideContent&&s()(W.Z,{disabled:t,store:this.props.store.getContentStore(),disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag,numberedListCounterStore:this.props.numberedListCounterStore}))}getStyle(){return{paddingLeft:Ce.ZD.paddingLeft,...this.getBlockColorStyle(),...this.props.style}}}const Bn=xn;var Zn=o(85957);class En extends m.Z{constructor(){super(...arguments),this.handleClick=()=>{const{store:e}=this.props;k.trackClickNestedChildPage(this.environment),pe.Z.recordVisit({id:e.id,type:se.vu.Link,currentUserId:this.environment.currentUser.id})}}handleCreated(){this.activate(),A.Z.setKeyboardMode(!1)}activate(){const{store:e}=this.props;this.navigate(e)}navigate(e){if(this.context.overrideLinkClick){const t=(0,le.ZP)({store:e});this.context.overrideLinkClick(t)}else ne.navigateToBlock({environment:this.environment,store:e,visitType:se.vu.Link,openInSidePeek:i.default.checkGate("side_peek_anywhere")?Be.default.isSidePeekOpen():(0,Zn.wq)(e)})}renderPersisted(){const{disabled:e}=this.props;return s()(N.p,{allowSelectionWithin:!1},void 0,s()(De,{store:this.props.store,style:{...this.getBlockColorStyle(),...this.props.style},isAlias:this.props.store.recordStoreParentDiffersFromPersistedParent(),disabled:e,onClick:this.handleClick}))}}En.contextTypes={...ae.wK,...Q.w};const Rn=En;var An=o(45952),Dn=o(16472);const Fn=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed a repl",id:"replitBlock.embeds.button.label"}});class Ln extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.replit,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Replit.",id:"replitBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(Fn.embedButtonText),urlInputPlaceholder:"https://replit.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed a repl",id:"replitBlock.placeholder"}))}}const Vn=Ln;var Nn=o(8713),On=o(78316),Un=o(45094),Hn=o(77505),zn=o(38755),Wn=o(34859);class jn extends Yt.Z{getInitialState(){return{}}setTemporaryFormat(e){this.update((t=>({...t,temporaryFormat:e})))}updateColumnOrder(e){this.update((t=>({...t,temporaryFormat:{...t.temporaryFormat,table_block_column_order:e}})))}}const Kn=jn;var Yn=o(60749),Gn=o(84568),Xn=o(52543),qn=o(18647),$n=o(76171),Jn=o(52275),Qn=o(24006);function er(e){var t;window.__c={n:"ActionBarContent"};const{simpleTableStore:o,rootSizeObserver:i,offset:n,hoverSizeObserver:a}=e,p=(0,Dt.O7)(),u=(0,Lt.Fg)(),m=(0,Ft.VK)((()=>jo.C.findScrollToSelectableFromStore(o)),[o]),g=null==m||null===(t=m.getNode())||void 0===t?void 0:t.getBoundingClientRect(),h=(0,Ft.VK)((()=>i.rect.get().width),[i]),f=(0,Ft.VK)((()=>a.rect.get().width),[a]);if(!g)return null;const v=Math.min(g.width,h,f);return s()("div",{style:{width:0,position:"absolute",left:v+n,zIndex:w.t8},onMouseDown:Et.$0},void 0,s()("div",{style:{position:"relative"}},void 0,s()("div",{style:or(u)},void 0,s()(Ee.Z,{placement:Ee.Z.Placement.Top,render:e=>l.createElement(U.Z,r()({},e,{style:ir(u),onClick:()=>{Te.createAndCommit({userAction:"SimpleTableActionBar.ActionBarContent",environment:p,perform:e=>{Nn.ys({simpleTableStore:o,parentWidth:a.rect.get().width,transaction:e})}})}}),c.Z.arrowsOut({width:20,fill:u.regularIconColor})),renderTooltip:()=>s()(d.FormattedMessage,{defaultMessage:"Fit table to page width",id:"simpleTable.actionBar.fitToPage"})}),s()(ye.Z,{popupType:ye.Z.PopupType.Popup,originGap:4,renderOrigin:e=>l.createElement(U.Z,r()({style:ir(u)},e),s()(d.FormattedMessage,{id:"simpleTable.actionBar.options",defaultMessage:"Options",description:"Title for simple tables floating menu button for table level settings like headers"}),c.Z.chevronDown({width:10,fill:u.mediumIconColor,marginLeft:4})),render:()=>s()(tr,{simpleTableStore:o})}),s()(Ze.Z,{store:o,fadeIn:!1,style:{display:"flex",justifyContent:"center",alignSelf:"center",width:30,height:void 0,padding:"9px 8px"},iconStyle:{fill:u.regularTextColor}}))))}function tr(e){window.__c={n:"OptionsMenu"};const{simpleTableStore:t}=e,o=(0,Dt.O7)(),i=(0,Lt.Fg)(),n=[{key:"header column",action:()=>{Te.createAndCommit({userAction:"SimpleTableActionBar.menuItems",environment:o,perform:e=>{Nn.sr({simpleTableStore:t,transaction:e})}})},render:e=>l.createElement(Jn.Z,r()({},e,{icon:c.Z.tableHeaderColumn({width:16,fill:i.regularIconColor}),title:s()(d.FormattedMessage,{id:"SimpleTableActionBar.action.rowHeader.title",defaultMessage:"Header column",description:"Enable or disable row headers for simple tables"}),right:s()(Qn.Z,{on:Hn._j(t).headerColumn||!1,onClick:e.onClick})}))},{key:"header row",action:()=>{Te.createAndCommit({userAction:"SimpleTableActionBar.menuItems",environment:o,perform:e=>{Nn.lm({simpleTableStore:t,transaction:e})}})},render:e=>l.createElement(Jn.Z,r()({},e,{icon:c.Z.tableHeaderRow({width:16,fill:i.regularIconColor}),title:s()(d.FormattedMessage,{id:"action.columnHeader.title",defaultMessage:"Header row",description:"Enable or disable column header for simple tables"}),right:s()(Qn.Z,{on:Hn._j(t).headerRow||!1,onClick:e.onClick})}))}];return s()(Se.Z,{menuType:ce.og.Popup,width:240,maxHeight:o.device.isMobile?70:void 0},void 0,s()(ji.Z,{type:ji.i.Vertical,sections:[{key:"appearance section",render:e=>l.createElement(Xi.Z,e),items:n}],initialFocus:void 0}))}function or(e){return{position:"absolute",top:-40,right:0,borderRadius:3,height:32,fontSize:14,lineHeight:1.2,display:"flex",whiteSpace:"nowrap",fontFamily:S.Z.getCompositeFontFamily(y.SP).sans,background:e.popoverBackground,boxShadow:e.mediumBoxShadow}}function ir(e){return{display:"flex",alignItems:"center",padding:"0 8px",borderRight:`1px solid ${b.ZP.whiteWithAlpha(.2)}`,boxShadow:`1px 0 0 ${e.regularDividerColor}`}}const nr=function(e){window.__c={n:"SimpleTableActionBar"};const{disabled:t,canEdit:o,simpleTableStore:i}=e,n=(0,Ft.VK)((()=>{const e=Xn.Z.state,t=Yn.Z.state,o=$n.Z.state,n=A.Z.state,r=vo.default.state,a=e.isActive&&e.simpleTableStore===i,s=1===r.stores.length&&r.stores[0]===i,l=t.isActive&&t.simpleTableStore===i&&"cell"===t.hover.type&&t.hover.resizing,c=o.isActive&&o.simpleTableStore===i;return(a||s)&&!l&&!c&&!n.isKeyboardMode}),[i]);return t||!o?null:s()(O.Z,{isVisible:n,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:j.Z.opacitySpringConfig},render:()=>l.createElement(er,e)})};var rr=o(78429),ar=o(43132),sr=o(50125),lr=o(993),cr=o(90496),dr=o(6695),pr=o(72133);class ur extends Q.Z{constructor(){super(...arguments),this.simpleTableFormat=void 0,this.handleDragStart=e=>{const{simpleTableStore:t,columnID:o,getWidth:i}=this.props;e.preventDefault();const n=Hn.FA(t);this.simpleTableFormat=n&&o in n?n[o]:{},this.simpleTableFormat.width=i(),Nn._C(!0)},this.handleDragMove=e=>{const t=this.getNewFormat(e);t&&this.props.onTemporaryResize(t)},this.handleDragEnd=e=>{const t=this.getNewFormat(e);t&&this.props.onAccept(t),Nn._C(!1)},this.handleDragCancel=()=>{this.props.onCancel(),this.simpleTableFormat=void 0,Nn._C(!1)},this.handleDoubleClick=()=>{const e=cr.Z.findCellsInColumnFromStore(this.props.simpleTableStore,this.props.columnId),t=Tt.compact(e.map((e=>{var t;const o=null===(t=e.node)||void 0===t?void 0:t.querySelector(`.${M.Iiy}`);if(o)return this.calculateMaxTextWidth(o)})));Te.createAndCommit({userAction:"SimpleTableColumnResizer.handleDoubleClick",environment:this.environment,perform:e=>{Nn.LB({tableBlockColumnFormat:{...this.getCurrentFormat().table_block_column_format,[this.props.columnId]:{width:Math.max(...t)}},simpleTableStore:this.props.simpleTableStore,transaction:e})}})},this.showResizeBar=this.createComputedStore((()=>{const{columnIndex:e,simpleTableStore:t}=this.props,o=Yn.Z.state;return!!o.isActive&&(o.simpleTableStore===t&&("cell"===o.hover.type&&(!this.isTableResizing.state&&(o.hover.x===e&&(o.hover.showResizer||o.hover.resizing)))))}),!0),this.isTableResizing=this.createComputedStore((()=>Boolean(Hn.Ts(this.props.simpleTableStore))),!0)}renderComponent(){return s()("div",{style:this.getStyle(),onMouseMove:()=>Nn.Md(!0),onMouseLeave:()=>Nn.Md(!1)},void 0,s()(oo.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>l.createElement("div",r()({style:this.getInnerStyle(),onDoubleClick:this.handleDoubleClick},e))}))}getCurrentFormat(){const{format:e,formatStore:t}=this.props,{temporaryFormat:o}=t.state;return o||e}calculateMaxTextWidth(e){const t=window.getComputedStyle(e),o=e.cloneNode(!0),i=o;i.id="notion-table-cell-shadow",Array.from(t).forEach((e=>i.style.setProperty(e,t.getPropertyValue(e),t.getPropertyPriority(e)))),i.style.opacity="0",i.style.width="100%",i.style.pointerEvents="none",document.body.appendChild(o);const n=i.querySelector(`.${M.qnV}`);if(!n)return void i.remove();n.style.width="",n.style.display="inline-block";const r=window.document.createRange();r.selectNode(n);const a=pr.getRect(r);return i.remove(),null!=a&&a.width?a.width+Cr:void 0}getNewFormat(e){if(this.simpleTableFormat&&this.simpleTableFormat.width){const t=Math.max(this.simpleTableFormat.width+e.diffX,dr.lw);return{...this.simpleTableFormat,width:t}}}getStyle(){return{position:"absolute",right:0,width:0,top:0,flexGrow:0,height:"100%",zIndex:1}}getInnerStyle(){return{position:"absolute",width:3,marginLeft:-1,marginTop:-1,height:"calc(100% + 2px)",transition:"background 150ms ease 50ms",cursor:this.isTableResizing.state?void 0:"col-resize",background:this.showResizeBar.state?this.theme.simpleTableSelectionBorder:b.ZP.blueWithAlpha(0)}}}ur.displayName="SimpleTableColumnResizer";const mr=ur;class gr extends Q.Z{constructor(){super(...arguments),this.reorderState=this.createComputedStore((()=>{const e=Gn.Z.state;if(e.isActive&&e.simpleTableStore===this.props.simpleTableStore&&e.moved&&e.source.index!==e.destIndex)return{destIndex:e.destIndex,sourceIndex:e.source.index,type:e.source.type}}),!0)}renderComponent(){const{rowIndex:e,columnIndex:t}=this.props,o=this.reorderState.state;if(!o)return;const{destIndex:i,sourceIndex:n,type:r}=o;return"row"===r&&i===e?s()("div",{style:this.getRowStyle(n,i)}):"column"===r&&i===t?s()("div",{style:this.getColumnStyle(n,i)}):void 0}getSharedStyle(){return{position:"absolute",flexGrow:0,zIndex:2,background:this.theme.simpleTableSelectionBorder}}getRowStyle(e,t){return{...this.getSharedStyle(),top:e>t?0:void 0,bottom:e<t?0:void 0,left:-1,width:"calc(100% + 2px)",height:3}}getColumnStyle(e,t){return{...this.getSharedStyle(),top:-1,left:e>t?0:void 0,right:e<t?0:void 0,width:3,height:"calc(100% + 2px)"}}}gr.displayName="SimpleTableReorderDropZone";const hr=gr;var fr=o(97880),vr=o(35431);class yr extends vr.Z{findSelectorsOfTypeFromStore(e,t){return this.filter((o=>o.props.simpleTableStore===t&&o.props.type===e))}}const br=new yr;var Sr=o(8949);class wr extends Q.Z{constructor(){super(...arguments),this.dragPosition=void 0,this.node=void 0,this.handleDragStart=e=>{var t;const{type:o}=this.props;e.preventDefault();const i=null===(t=this.node)||void 0===t?void 0:t.parentNode;if(!(i&&i instanceof Element))return;const n=i.getBoundingClientRect();this.dragPosition="column"===o?n.x:n.y;const r="column"===o?e.startX-n.x:e.startY-n.y;Nn.Jc({...this.props,environment:this.environment,theme:this.theme,selectorStartPx:this.dragPosition,mouseOffsetPx:r})},this.handleDragMove=e=>{const{type:t}=this.props;if(!this.dragPosition)return;const o=Gn.Z.state;if(!o.isActive)return;const i="column"===t?e.diffX:e.diffY;if(0!==i){const e=this.dragPosition+i,t=this.getDestIndex({delta:i,selectorDragPx:e+o.source.mouseOffsetPx});Nn.hh({destIndex:t,selectorDragPx:e})}},this.handleDragEnd=e=>{const{isMobile:t}=this.environment.device,{simpleTableStore:o,type:i,format:n}=this.props;Te.createAndCommit({userAction:"SimpleTableRowColumnSelector.handleDragEnd",environment:this.environment,perform:r=>{Nn.gP({event:e,environment:this.environment,simpleTableStore:o,transaction:r,format:n,type:i,onNoChange:t?void 0:this.handleDragNoChange})}}),this.clearDragState()},this.handleDragCancel=()=>{this.clearDragState()},this.clearDragState=()=>{this.dragPosition=void 0,Nn.y1()},this.handleDragNoChange=e=>{fo.Qn({environment:this.environment,stores:[this.props.simpleTableStore],left:e.startX,top:e.startY,showInput:!0,actions:ie.TB,analyticsFrom:"simple_table_menu"})},this.onSelectorClick=e=>{const{type:t,index:o,simpleTableStore:i}=this.props,{isMobile:n}=this.environment.device;Sr.Z.state.isActive||fo.Qn({environment:this.environment,stores:[this.props.simpleTableStore],left:e.clientX,top:e.clientY,showInput:!0,actions:ie.TB,analyticsFrom:"simple_table_menu"}),n&&("column"===t?Nn.iH({environment:this.environment,index:o,simpleTableStore:i}):Nn.pj({environment:this.environment,index:o,simpleTableStore:i}))},this.handleMouseEnter=()=>{const{simpleTableStore:e,type:t,index:o}=this.props;Nn.x$({type:t,simpleTableStore:e,index:o})},this.handleMouseLeave=()=>{Nn.I9()},this.shouldShow=this.createComputedStore((()=>{const{isMobile:e}=this.environment.device;if(e)return this.shouldShowMobile();const{isKeyboardMode:t}=A.Z.state;if(t)return!1;const{simpleTableStore:o,type:i,index:n}=this.props;if(Gn.Z.state.isActive)return!1;const r=Yn.Z.state;if(!r.isActive)return!1;if(r.simpleTableStore!==o)return!1;if(Hn.Ts(o))return!1;const a=vo.default.state;if(a.stores[0]===o&&a.phase===vo.SelectionPhase.Selected)return!1;const s=r.hover;return"cell"!==s.type?s.type===i&&s.index===n:"column"===i?s.x===n:"row"===i&&s.y===n}),!0),this.isDragging=this.createComputedStore((()=>Gn.Z.state.isActive),!0)}get registries(){return[br]}didMountOrUpdate(){this.node=this.getNode()}renderComponent(){const{isSelected:e}=this.props,t=e||this.shouldShow.state;return s()(oo.Z,{allowDragWhileTextEditing:!0,onDraggableDragStart:t?this.handleDragStart:void 0,onDraggableDragMove:t?this.handleDragMove:void 0,onDraggableDragEnd:t?this.handleDragEnd:void 0,onDraggableDragCancel:t?this.handleDragCancel:void 0,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>this.renderButton(e)})}renderButton(e){const{type:t,isSelected:o}=this.props;return l.createElement(U.Z,r()({className:"column"===t?M.Apy:M.f0e,style:this.getStyle(),hoveredStyle:o?this.getSelectedStyle():{background:this.theme.whiteButtonHoveredBackground},pressedStyle:this.getSelectedStyle(!0),onClick:this.onSelectorClick,onTouchStart:this.handleMouseEnter,onTouchEnd:this.handleMouseLeave,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},e,{disallowTabbing:!0}),c.Z.dragHandle({fill:o?b.ZP.white:void 0,width:14,height:14,transform:"column"===t?"rotate(90deg)":void 0}))}shouldShowMobile(){const e=Xn.Z.state;if(!e.isActive)return!1;const{simpleTableStore:t,type:o,index:i}=this.props;if(e.simpleTableStore!==t)return!1;const{selection:n}=e;if(Hn.ok(n)){if("column"===o)return n.start.col===i;if("row"===o)return n.start.row===i}return!1}getDestIndex(e){const{delta:t,selectorDragPx:o}=e,{simpleTableStore:i,type:n}=this.props,r=br.findSelectorsOfTypeFromStore(n,i);if(t>0){const e=r.map((e=>{var t;const o=null===(t=e.node)||void 0===t?void 0:t.parentNode;if(!(o&&o instanceof Element))return;const i=o.getBoundingClientRect();return"column"===n?null==i?void 0:i.x:null==i?void 0:i.y})).filter(fr.$K);e.sort(((e,t)=>e-t));for(let t=e.length-1;t>=0;t--)if(o>e[t])return t;return 0}const a=r.map((e=>{var t;const o=null===(t=e.node)||void 0===t?void 0:t.parentNode;if(!(o&&o instanceof Element))return;const i=o.getBoundingClientRect();return"column"===n?i.x+i.width:i.y+i.height})).filter(fr.$K);return a.sort(((e,t)=>e-t)),a.filter(fr.$K).findIndex((e=>o<e))}getStyle(){const{type:e,isSelected:t}=this.props,o=t||this.shouldShow.state,i={opacity:o?1:0,pointerEvents:o?void 0:"none",transition:"opacity 150ms ease",fill:this.theme.lightIconColor,position:"absolute",display:"flex",alignItems:"center",cursor:this.isDragging.state?"grab":"pointer",justifyContent:"center",borderRadius:4,background:this.theme.whiteButtonBackground,boxShadow:t?void 0:this.theme.lightBoxShadow,zIndex:4};return"column"===e?{...i,...this.getSelectedStyle(),top:-8,left:"calc(50% - 13px)",height:16,width:26,padding:"2px 4px"}:{...i,...this.getSelectedStyle(),top:"calc(50% - 13px)",left:-8,width:16,height:26,padding:"4px 2px"}}getSelectedStyle(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{isSelected:t}=this.props;return t||e?{background:this.theme.simpleTableSelectionBorder}:void 0}}wr.displayName="SimpleTableRowColumnSelector";const kr=wr,Cr=1;class _r extends Q.Z{constructor(){super(...arguments),this.node=void 0,this.editor=null,this.handleCellClick=e=>{const{columnIndex:t,simpleTableStore:o,rowIndex:i,disabled:n,canEdit:r}=this.props;n||(0,Et.ZP)({event:e,context:Et.Af.EditorClick,callback:()=>{Hn._Y()&&r&&e.shiftKey?Nn.m6({environment:this.environment,rowIndex:i,columnIndex:t,simpleTableStore:o}):r?Nn.fT({environment:this.environment,rowIndex:i,columnIndex:t,simpleTableStore:o}):Nn.n5({environment:this.environment,rowIndex:i,columnIndex:t,simpleTableStore:o})}})},this.handleContextMenuClick=e=>{const{columnIndex:t,simpleTableStore:o,rowIndex:i,disabled:n}=this.props;n||(0,Et.ZP)({event:e,context:Et.Af.EditorContextMenu,callback:()=>{Nn.n5({environment:this.environment,rowIndex:i,columnIndex:t,simpleTableStore:o})}})},this.handleTextClick=e=>{const{rowIndex:t,columnIndex:o,simpleTableStore:i,disabled:n,canEdit:r}=this.props;n||Hn._Y()&&r&&e.shiftKey&&Nn.m6({environment:this.environment,rowIndex:t,columnIndex:o,simpleTableStore:i})},this.handleMouseEnter=()=>{const{rowIndex:e,columnIndex:t,simpleTableStore:o,disabled:i}=this.props;i||Nn.Hf({x:t,y:e,simpleTableStore:o})},this.handleMouseLeave=()=>{this.props.disabled||Nn.I9()},this.handleTemporaryColumnResize=e=>{const{formatStore:t}=this.props;t.setTemporaryFormat(this.getNewFormat(e))},this.handleColumnResizeAccept=e=>{const{simpleTableStore:t,formatStore:o}=this.props,i=this.getCurrentFormat().table_block_column_format;Te.createAndCommit({userAction:"SimpleTableCell.handleColumnResizeAccept",environment:this.environment,perform:e=>{Nn.LB({tableBlockColumnFormat:i||{},simpleTableStore:t,transaction:e})}}),o.setTemporaryFormat(void 0)},this.handleTemporaryColumnResizeCancel=()=>{const{formatStore:e}=this.props;e.setTemporaryFormat(void 0)},this.handleEnter=e=>{if(e.preventDefault(),this.editor&&this.editor.isComposing())return;"editing"===zi.default.state.mode&&Nn.rS({environment:this.environment,direction:"down",bypassExistingTextSelection:!0})},this.handleTab=e=>{e.preventDefault(),Nn.eh({environment:this.environment,direction:"right",bypassExistingTextSelection:!0})},this.handleUntab=e=>{e.preventDefault(),Nn.eh({environment:this.environment,direction:"left",bypassExistingTextSelection:!0})},this.handleEsc=e=>{this.props.disabled||(e.preventDefault(),qe.ZH(this.environment))},this.handleCut=e=>{const{disabled:t,canEdit:o}=this.props;if(t||!o)return;this.handleCopy(e);const i="editing"===zi.default.state.mode&&zi.default.state.multiSelection,n=this.environment;i&&!(0,Ni.iG)(i)?Te.createAndCommit({userAction:"SimpleTableCell.handleCut",environment:n,perform:e=>{lr.pz({environment:n,multiSelection:i,transaction:e})}}):Te.createAndCommit({userAction:"SimpleTableCell.handleCut",environment:n,perform:e=>{Nn.W5({environment:n,transaction:e})}})},this.handleCopy=e=>{const t=Xn.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,n=Hn.h4(i);if(!n)return;ar.JG({environment:this.environment,event:e});const r="editing"===zi.default.state.mode&&zi.default.state.multiSelection;r&&!(0,Ni.iG)(r)||sr.qn({environment:this.environment,simpleTableStore:i,selection:o,currentRows:i.getContentStores(),columnOrder:n,event:e})},this.isInDragSource=this.createComputedStore((()=>{const{store:e,columnID:t,simpleTableStore:o}=this.props;if(!e)return!1;const i=Gn.Z.state;if(!i.isActive||i.simpleTableStore!==o||!i.moved)return!1;const{type:n,id:r}=i.source;return"column"===n?r===t:r===e.id}),!0)}get registries(){return[cr.Z]}didMountOrUpdate(){this.node=this.getNode()}renderComponent(){const{columnID:e,columnIndex:t,simpleTableStore:o,rowIndex:i,textStore:n,store:a,format:c,disabled:d,canEdit:p}=this.props,{device:u}=this.environment,m=!d&&p,g=l.createElement(l.Fragment,null,this.isInDragSource.state&&s()("div",{style:{width:"100%",height:"100%",...this.getColorStyle()}}),s()("div",{className:M.Iiy,style:{visibility:this.isInDragSource.state?"hidden":void 0}},void 0,a&&0===i&&m&&s()(kr,{index:t,type:"column",simpleTableStore:o,isSelected:this.isColumnSelected(),id:e,format:c,rowStore:a}),a&&0===t&&m&&s()(kr,{index:i,type:"row",simpleTableStore:o,isSelected:this.isRowSelected(),id:a.id,format:c,rowStore:a}),n?l.createElement(K.Z,{ref:e=>{this.editor=e},disabled:d,store:n,disableSlashCommands:!0,onClick:this.handleTextClick,onEnter:this.handleEnter,onTab:this.handleTab,onUntab:this.handleUntab,onEsc:this.handleEsc,onCut:this.handleCut,onCopy:this.handleCopy,style:this.getTextStyle(),pasteBehavior:"inline",className:M.qnV,disableDrag:!0}):s()("div",{style:this.getTextStyle()},void 0," "),!u.isMobile&&m&&s()(mr,{format:this.props.format,formatStore:this.props.formatStore,columnId:this.getColumnID(),columnIndex:t,columnID:e,simpleTableStore:o,getWidth:()=>{var e;return(null===(e=this.node)||void 0===e?void 0:e.getBoundingClientRect().width)||0},onTemporaryResize:this.handleTemporaryColumnResize,onAccept:this.handleColumnResizeAccept,onCancel:this.handleTemporaryColumnResizeCancel}),!u.isMobile&&m&&s()(hr,{simpleTableStore:o,rowIndex:i,columnIndex:t}))),h={style:this.getStyle(),onClick:this.handleCellClick,onContextMenu:this.handleContextMenuClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},{headerColumn:f,headerRow:v}=this.getHeadersEnabled();return v&&0===i?l.createElement("th",r()({scope:"col"},h),g):f&&0===t?l.createElement("th",r()({scope:"row"},h),g):l.createElement("td",h,g)}getColumnID(){return this.props.columnID}isColumnSelected(){const{columnIndex:e,simpleTableStore:t,selection:o}=this.props;return!!o&&Hn.u({selection:o,columnIndex:e,simpleTableStore:t})}isRowSelected(){const{rowIndex:e,simpleTableStore:t,selection:o}=this.props;return!!o&&Hn.Ax({selection:o,rowIndex:e,simpleTableStore:t})}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.props.formatStore.state;return t||e}getNewFormat(e){const{columnID:t}=this.props,o={[t]:e},i=this.getCurrentFormat();return{...i,table_block_column_format:{...i.table_block_column_format,...o}}}getHeadersEnabled(){const{simpleTableStore:e}=this.props;return Hn._j(e)}getColorStyle(){var e;const{simpleTableStore:t,rowIndex:o,columnIndex:i,columnID:n}=this.props,{headerColumn:r,headerRow:a}=this.getHeadersEnabled();let s=(null===(e=this.props.store)||void 0===e?void 0:e.getFormat().block_color)||"default";const l=Hn.FA(t);if(l&&n in l){var c;const e=null===(c=l[n])||void 0===c?void 0:c.color;e&&(s=e)}return 0===o&&a||0===i&&r?"default"!==s?{...(0,b.fi)(s,this.theme),fontWeight:S.Z.fontWeight.medium}:{background:this.theme.tableHeaderRowColumnBackground,fontWeight:S.Z.fontWeight.medium}:(0,b.fi)(s,this.theme)}getStyle(){return{...this.getColorStyle(),border:`${Cr}px solid ${this.theme.tableDividerColor}`,position:"relative",verticalAlign:"top",textAlign:"start",...this.getWidths(),minHeight:32}}getWidths(){var e;const{columnID:t}=this.props,o=this.getCurrentFormat().table_block_column_format;return o&&null!==(e=o[t])&&void 0!==e&&e.width?{minWidth:o[t].width,maxWidth:o[t].width}:{minWidth:120,maxWidth:240}}getTextStyle(){return{padding:"7px 9px",backgroundColor:"transparent",fontSize:14,lineHeight:"20px"}}}_r.displayName="SimpleTableCell";const Mr=_r;class Tr extends m.Z{constructor(){super(...arguments),this.isLegacyTransclusionStore=this.createComputedStore((()=>Boolean(this.props.rowStore)&&this.props.rowStore.getParentId()!==this.props.store.id)),this.styleStore=this.createComputedStore((()=>(0,rr.H)()&&this.isLegacyTransclusionStore.state?{border:"3px dashed deeppink"}:{}))}renderPersisted(){const{columnOrder:e,store:t,rowIndex:o,rowStore:i,selection:n,formatStore:r,disabled:a}=this.props;return e?s()("tr",{className:M.M_0,style:this.styleStore.state},void 0,e.map(((e,l)=>s()(Mr,{disabled:a,canEdit:this.canEdit(),columnID:e,columnIndex:l,rowIndex:o,store:i,simpleTableStore:t,selection:n,formatStore:r,format:t.getFormat(),textStore:null==i?void 0:i.getPropertyStore(e)},e)))):null}}const Ir=Tr;var Pr=o(40150),xr=o(8958),Br=o(52689);function Zr(e){window.__c={n:"SimpleTableKeyboardArea"};const{store:t,children:o,selection:i,disabled:n,canEdit:r}=e,a=(0,Dt.O7)(),c=(0,l.useCallback)((e=>{e.preventDefault&&e.preventDefault(),Nn.eh({environment:a,direction:"left",bypassExistingTextSelection:!1,expandSelection:Hn._Y()?e.shiftKey:void 0})}),[a]),d=(0,l.useCallback)((e=>{e.preventDefault&&e.preventDefault(),Nn.eh({environment:a,direction:"right",bypassExistingTextSelection:!1,expandSelection:Hn._Y()?e.shiftKey:void 0})}),[a]),p=(0,l.useCallback)((e=>{e.preventDefault&&e.preventDefault(),Nn.rS({environment:a,direction:"up",bypassExistingTextSelection:!1,expandSelection:Hn._Y()?e.shiftKey:void 0})}),[a]),u=(0,l.useCallback)((e=>{e.preventDefault&&e.preventDefault(),Nn.rS({environment:a,direction:"down",bypassExistingTextSelection:!1,expandSelection:Hn._Y()?e.shiftKey:void 0})}),[a]),m=(0,l.useCallback)((e=>{e.preventDefault&&e.preventDefault();const t=Xn.Z.state;if(t.isActive){const{selection:e,simpleTableStore:o}=t;Hn.ok(e)&&Nn.fT({environment:a,rowIndex:e.start.row,columnIndex:e.start.col,simpleTableStore:o})}}),[a]),g=(0,l.useCallback)((e=>{var t;null===(t=e.preventDefault)||void 0===t||t.call(e);const o=Xn.Z.state;if(!o.isActive)return;const{selection:i,simpleTableStore:n}=o;Hn.ok(i)&&i.end.row===Hn.bm(n)-1&&Te.createAndCommit({userAction:"SimpleTableSelectionOverlay.handleShiftEnter",environment:a,perform:e=>{const t=i.end.row+1;Nn.iz({environment:a,transaction:e,index:t,simpleTableStore:n}),Nn.fT({environment:a,rowIndex:t,columnIndex:i.start.col,simpleTableStore:n})}})}),[a]),h=(0,l.useCallback)((e=>{e.preventDefault&&e.preventDefault(),Hn.UQ()?qe.ZH(a):(Nn.MO(),Xe.Z5({environment:a,stores:[t]}))}),[a,t]),f=(0,l.useCallback)((e=>{Te.createAndCommit({userAction:"SimpleTableSelectionOverlay.handleDelete",environment:a,perform:e=>{Nn.fn({environment:a,transaction:e})}})}),[a]),v=(0,l.useCallback)((e=>{!e.key||e.metaKey||e.ctrlKey||(A.Z.setKeyboardMode(!0),Te.createAndCommit({userAction:"SimpleTableSelectionOverlay.handleKeypress",environment:a,perform:t=>{Nn.Fn({environment:a,transaction:t,key:e.key})}}))}),[a]),y=(0,l.useCallback)((e=>{const t=Xn.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,n=Hn.h4(i);n&&sr.qn({environment:a,simpleTableStore:i,selection:o,currentRows:i.getContentStores(),columnOrder:n,event:e})}),[a]),b=(0,l.useCallback)((e=>{!n&&r&&(y(e),Te.createAndCommit({userAction:"SimpleTableSelectionOverlay.handleCut",environment:a,perform:e=>{Nn.WO({environment:a,transaction:e})}}))}),[a,n,r,y]),S=(0,l.useCallback)((e=>{if(n||!r)return;const t=Xn.Z.state;if(!t.isActive)return;const{selection:o,simpleTableStore:i}=t,s=Hn.h4(i);s&&Te.createAndCommit({userAction:"SimpleTableSelectionOverlay.handlePaste",environment:a,perform:t=>{sr.j0({environment:a,simpleTableStore:i,selection:o,currentRows:i.getContentStores(),columnOrder:s,event:e,transaction:t})}})}),[a,n,r]),w=(0,l.useCallback)((e=>{e.preventDefault(),Te.createAndCommit({userAction:"SimpleTableSelectionOverlay.handleDuplicate",environment:a,perform:e=>{Nn.Or({environment:a,transaction:e})}})}),[a]),k=(0,l.useCallback)(((e,o)=>{!n&&r&&(o.preventDefault(),Te.createAndCommit({userAction:"SimpleTableSelectionOverlay.handleAnnotation",environment:a,perform:o=>{Nn.Iu({environment:a,simpleTableStore:t,annotation:e,transaction:o})}}))}),[a,n,r,t]),C=(0,l.useCallback)((e=>k(["h",Br.Z.state.color],e)),[k]),_=(0,l.useCallback)((e=>k(["b"],e)),[k]),M=(0,l.useCallback)((e=>k(["i"],e)),[k]),T=(0,l.useCallback)((e=>k(["s"],e)),[k]),I=(0,l.useCallback)((e=>k(["_"],e)),[k]),P=(0,l.useCallback)((e=>k(["c"],e)),[k]);return s()(Wi.Z,{capture:Boolean(i)&&!n&&r,onLeft:c,onRight:d,onUntab:c,onTab:d,onUp:p,onDown:u,onEnter:m,onShiftEnter:g,onEsc:h,onDelete:f,onBackspace:f,onKeypress:v,onCut:b,onCopy:y,onPaste:S,onDuplicate:w,onToggleHighlight:C,onToggleBold:_,onToggleItalics:M,onToggleStrike:T,onToggleUnderline:I,onToggleCode:P},void 0,o)}var Er=o(6740),Rr=o(71644);const Ar=(0,d.defineMessages)({tooltipContent:{id:"simpleTable.resizer.dimensions",defaultMessage:"{num_columns} × {num_rows}",description:"Dimensions of table in terms of columns and rows"}});class Dr extends Q.Z{constructor(){super(...arguments),this.tooltipOrigin=l.createRef(),this.storeTypes={focusStore:V.default.of(!1)},this.renderTooltip=()=>{const{store:e,intl:t,type:o}=this.props;if(!this.isResizing.state){const e=this.theme.regularInvertedTextColor,t=t=>s()("b",{style:{color:e}},void 0,t);return s()("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",color:this.theme.mediumInvertedTextColor}},void 0,s()("div",{},void 0,"row"===o&&s()(d.FormattedMessage,{id:"simpleTable.resizer.tooltipRow",defaultMessage:"<b>Click</b> to add a new row",values:{b:t}}),"column"===o&&s()(d.FormattedMessage,{id:"simpleTable.resizer.tooltipColumn",defaultMessage:"<b>Click</b> to add a new column",values:{b:t}}),"corner"===o&&s()(d.FormattedMessage,{id:"simpleTable.resizer.tooltipCorner",defaultMessage:"<b>Click</b> to add a new row and column",values:{b:t}})),s()("div",{},void 0,"row"===o&&s()(d.FormattedMessage,{id:"simpleTable.resizer.tooltipSubtitleRow",defaultMessage:"<b>Drag</b> to quickly add or remove rows",values:{b:t}}),"column"===o&&s()(d.FormattedMessage,{id:"simpleTable.resizer.tooltipSubtitleColumn",defaultMessage:"<b>Drag</b> to quickly add or remove columns",values:{b:t}}),"corner"===o&&s()(d.FormattedMessage,{id:"simpleTable.resizer.tooltipSubtitleCorner",defaultMessage:"<b>Drag</b> to quickly add or remove rows and columns",values:{b:t}})))}const i=this.columnOrder.state||[],n=Hn.bm(e),r=this.numTempRows.state,a=t.formatMessage(Ar.tooltipContent,{num_columns:i.length,num_rows:n+r});return s()("div",{},void 0,a)},this.handleResizeClick=()=>{const{store:e,type:t}=this.props;Te.createAndCommit({userAction:"SimpleTableResizer.handleResizeClick",environment:this.environment,perform:o=>{"row"!==t&&Nn.m1({count:1,simpleTableStore:e,transaction:o}),"column"!==t&&Nn.FV({environment:this.environment,count:1,simpleTableStore:e,transaction:o})}})},this.handleDragStart=e=>{var t;e.preventDefault();const{formatStore:o,store:i,type:n}=this.props,r=null===(t=this.tooltipOrigin.current)||void 0===t?void 0:t.getBoundingClientRect();$n.Z.setState({isActive:!0,simpleTableStore:i,resize:n,rowsDelta:0,columnsDelta:0,tooltipOriginRect:r}),o.setTemporaryFormat(i.getFormat())},this.handleDragMove=e=>{var t;const{store:o,type:i,formatStore:n}=this.props,r=Hn.Ts(o,i);if(!r)return;const a=null===(t=this.tooltipOrigin.current)||void 0===t?void 0:t.getBoundingClientRect();if("row"!==i){const t=e.diffX>0?Math.ceil((e.diffX-30)/120):Math.floor((e.diffX+30)/120);if(t<0&&Hn.KA({simpleTableStore:o,lastN:Math.abs(t)}))return;$n.Z.setState({...r,columnsDelta:t,tooltipOriginRect:a});const i=this.getNewColumnOrder(t);n.updateColumnOrder(i),Nn.il(i.length-1)}if("column"!==i){const t=e.diffY>0?Math.ceil((e.diffY-8)/32):Math.max(-(Hn.bm(o)-1),Math.floor((e.diffY+8)/32));if(t<0&&Hn.zi({simpleTableStore:o,lastN:Math.abs(t)}))return;$n.Z.setState({...r,rowsDelta:t,tooltipOriginRect:a}),Nn.p2(Hn.bm(o)+t-1)}},this.handleDragEnd=e=>{const{store:t,type:o}=this.props,i=this.columnOrder.state,n=this.numTempRows.state,r=Hn.WN(t);Te.createAndCommit({userAction:"SimpleTableResizer.handleDragEnd",environment:this.environment,perform:e=>{"row"!==o&&i&&(i.length>r?Nn.m1({count:i.length-r,simpleTableStore:t,transaction:e}):i.length<r&&Nn.g4({simpleTableStore:t,columnOrder:i,transaction:e})),"column"!==o&&(n>0?Nn.FV({environment:this.environment,count:n,simpleTableStore:t,transaction:e}):n<0&&Nn.Q({numRowsToDelete:Math.abs(n),simpleTableStore:t,transaction:e}))}}),this.clearResizeState()},this.handleDragCancel=()=>{this.clearResizeState()},this.handleMouseEnter=()=>{const{store:e,type:t}=this.props;Nn.ce({simpleTableStore:e,resizer:t})},this.handleMouseLeave=()=>{Nn.I9()},this.handleFocus=e=>{const t=e.target;t instanceof HTMLElement&&(0,Er.E)(t)&&this.stores.focusStore.set(!0)},this.handleBlur=()=>{this.stores.focusStore.set(!1)},this.isResizing=this.createComputedStore((()=>{const{store:e,type:t}=this.props;return Boolean(Hn.Ts(e,t))}),!0),this.tooltipOriginRect=this.createComputedStore((()=>{const{store:e,type:t}=this.props,o=Hn.Ts(e,t);return null==o?void 0:o.tooltipOriginRect}),!0),this.columnOrder=this.createComputedStore((()=>{const{store:e,formatStore:t}=this.props,o=e.getFormat(),{temporaryFormat:i}=t.state;return(i||o).table_block_column_order})),this.numTempRows=this.createComputedStore((()=>{const e=Hn.Ts(this.props.store);return e?e.rowsDelta:0})),this.isVisible=this.createComputedStore((()=>{const{type:e,store:t}=this.props,o=Yn.Z.state,i=Hn.Ts(t,e),n=this.stores.focusStore.state;return!A.Z.state.isKeyboardMode&&(this.isHoverVisible(o)||Boolean(i))||n}),!0)}renderComponent(){return l.createElement("div",{style:this.getOuterStyle(),onFocus:this.handleFocus,onBlur:this.handleBlur,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,ref:this.tooltipOrigin},s()(oo.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>l.createElement("div",r()({style:this.getInnerStyle()},e),s()(Ee.Z,{renderTooltip:this.renderTooltip,placement:Ee.Z.Placement.Bottom,delayThreshold:0,originRect:this.tooltipOriginRect.state,forceVisibleState:!0===this.isResizing.state||void 0,render:e=>l.createElement(U.Z,r()({onClick:this.handleResizeClick,style:this.getButtonStyle(!0),hoveredStyle:this.getButtonStyle(!0)},e),s()("div",{style:this.getStyle()},void 0,c.Z.plus({width:12,height:12,fill:this.isResizing.state?b.ZP.white:this.theme.mediumIconColor,padding:"auto"})))}))}))}clearResizeState(){this.props.formatStore.reset(),$n.Z.reset()}getNewColumnOrder(e){const{store:t}=this.props,o=this.columnOrder.state||[],i=Hn.h4(t)||[];if(e>0){const t=e-(o.length-i.length);if(t>0){const e=[...Array(t).keys()].map((e=>(0,Rr.ZP)()));return[...o,...e]}return o.slice(0,o.length+t)}return i.slice(0,Math.max(1,i.length-Math.abs(e)))}isHoverVisible(e){const{type:t,store:o}=this.props;if(!e.isActive||e.simpleTableStore!==o)return!1;const{hover:i}=e;if("cell"===i.type){const e=i.y===Hn.bm(o)-1,n=i.x===Hn.WN(o)-1;return"row"===t?e:("column"===t||e)&&n}return"resizer"===i.type&&i.resizer===t}getOuterStyle(){const{type:e}=this.props,t={position:"absolute",display:"flex"};return"row"===e?{...t,flexDirection:"row",bottom:-18,left:0,right:0}:"column"===e?{...t,right:-18,top:0,bottom:0}:{...t,bottom:-18,right:-18}}getInnerStyle(){const{type:e}=this.props,t=this.isVisible.state;return{display:"flex",flexDirection:"row"===e?"row":void 0,width:"100%",height:"100%",opacity:t?1:0,pointerEvents:t?void 0:"none",transition:"opacity 150ms ease 50ms"}}getButtonStyle(e){const{type:t}=this.props,o=e?16:20,i="100%";return"column"===t?{flex:1,width:o,height:i,cursor:"col-resize",borderRadius:3,overflow:"hidden"}:"row"===t?{flex:1,width:i,height:o,cursor:"row-resize",borderRadius:3,overflow:"hidden"}:{flex:1,width:o,height:o,cursor:"nwse-resize",borderRadius:"50%",overflow:"hidden"}}getStyle(){return{height:"100%",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:this.isResizing.state?this.theme.simpleTableSelectionBorder:this.theme.lightDividerColor}}}Dr.displayName="SimpleTableResizer";const Fr=(0,d.injectIntl)(Dr);function Lr(e){window.__c={n:"SimpleTableSelectionDragHandle"};const{position:t,onDraggableDragStart:o,onDraggableDragMove:i,onDraggableDragEnd:n,onDraggableDragCancel:a}=e,c=(0,Dt.Fy)().isMobile?26:9,d=(0,Lt.yK)((e=>({tapArea:{position:"absolute",top:"top-left"===t?-c/2:void 0,left:"top-left"===t?-c/2:void 0,bottom:"bottom-right"===t?-c/2:void 0,right:"bottom-right"===t?-c/2:void 0,width:c,height:c,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",pointerEvents:"auto",cursor:"nwse-resize",zIndex:10},dragHandle:{width:9,height:9,border:`2px solid ${b.ZP.blueWithAlpha(.57)}`,background:e.contentBackground,borderRadius:"50%"}})),[t,c]);return s()(oo.Z,{allowDragWhileTextEditing:!0,onDraggableDragStart:o,onDraggableDragMove:i,onDraggableDragEnd:n,onDraggableDragCancel:a,render:e=>l.createElement("div",r()({},e,{style:d.tapArea}),s()("div",{style:d.dragHandle}))})}class Vr extends Q.Z{constructor(){super(...arguments),this.tableElement=null,this.observer=void 0,this.handleObserverChange=()=>{var e,t;null===(e=this.selectionStartRectStore)||void 0===e||e.enqueueRecompute(),null===(t=this.selectionEndRectStore)||void 0===t||t.enqueueRecompute()},this.dragSelectAnchor=void 0,this.handleDragStart=e=>{Hn._Y()&&this.props.canEdit&&(e.shiftKey&&this.props.selection?this.dragSelectAnchor=this.props.selection.start:this.dragSelectAnchor=this.getClosestTableCellPosition(e.startX,e.startY))},this.handleDragMove=e=>{if(!Hn._Y()||!this.props.canEdit||!this.dragSelectAnchor)return;const t=this.dragSelectAnchor,o=this.getClosestTableCellPosition(e.currentX,e.currentY);(0,Pr.bp)(t,o)?Nn.n5({environment:this.environment,rowIndex:t.row,columnIndex:t.col,simpleTableStore:this.props.store}):Nn.pB({environment:this.environment,start:t,end:o,simpleTableStore:this.props.store})},this.dragHandleSelectAnchor=void 0,this.handleTopLeftDragHandleDragStart=()=>this.handleDragHandleDragStart("top-left"),this.handleBottomRightDragHandleDragStart=()=>this.handleDragHandleDragStart("bottom-right"),this.handleDragHandleDragMove=e=>{if(!this.dragHandleSelectAnchor)return;const t=this.getClosestTableCellPosition(e.currentX,e.currentY);Nn.pB({environment:this.environment,start:this.dragHandleSelectAnchor,end:t,simpleTableStore:this.props.store})},this.selectionStartRectStore=this.createComputedStore((()=>{const{selection:e}=this.props;if(e)return this.getCellRect(e.start)}),!0),this.selectionEndRectStore=this.createComputedStore((()=>{const{selection:e}=this.props;if(e)return this.getCellRect(e.end)}),!0),this.canShowTableResizers=this.createComputedStore((()=>{const{disabled:e,canEdit:t}=this.props,{device:o}=this.environment;return!(e||!t||o.isMobile)&&!(E.ZP.state.isDragging||this.isColumnResizing()||this.isReordering())}),!0),this.isColumnResizing=()=>{const{store:e}=this.props,t=Yn.Z.state;return!!t.isActive&&(t.simpleTableStore===e&&("cell"===t.hover.type&&t.hover.resizing))},this.isReordering=()=>{const{store:e}=this.props,t=Gn.Z.state;return t.isActive&&t.simpleTableStore===e},this.dragState=this.createComputedStore((()=>{const e=Gn.Z.state;if(!e.isActive)return;if(e.simpleTableStore!==this.props.store)return;if(!this.tableElement)return;const{source:t,selectorDragPx:o,moved:i}=e;if(t.selectorStartPx===o&&!i)return;if(!t.draggedCells[0])return;const n=t.draggedCells[0].rect,r=this.tableElement.getBoundingClientRect(),a="column"===t.type?0:(0,Jt.Z)(o-r.top,-8,r.height-32);return{left:"column"===t.type?(0,Jt.Z)(o-r.left,-n.width/3,r.width-2/3*n.width):0,top:a,draggedCells:t.draggedCells,type:t.type}}),!0)}renderComponent(){const{children:e,store:t,selection:o,formatStore:i,disabled:n,canEdit:a}=this.props,c=this.canShowTableResizers.state;return s()(Zr,{store:t,selection:o,disabled:n,canEdit:a},void 0,s()(oo.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,render:n=>l.createElement("div",r()({style:{position:o||c?"relative":void 0}},n),e,this.shouldRenderOverlay()&&s()("div",{style:{position:"absolute",top:0,left:0,pointerEvents:"none"}},void 0,this.renderDragOverlay(),this.renderSelectionOverlay()),c&&l.createElement(l.Fragment,null,s()(Fr,{store:t,type:"column",formatStore:i},"column"),s()(Fr,{store:t,type:"row",formatStore:i},"row"),s()(Fr,{store:t,type:"corner",formatStore:i},"corner")))}))}shouldRenderOverlay(){const e=this.selectionStartRectStore.state,t=this.selectionEndRectStore.state,o=this.dragState.state;return!this.props.disabled&&(e&&t||o)}renderSelectionOverlay(){const e=this.selectionStartRectStore.state,t=this.selectionEndRectStore.state;if(!e||!t)return;const o=Math.min(e.left,t.left),i=Math.min(e.top,t.top),n=Math.max(e.right,t.right),r=Math.max(e.top+e.height,t.top+t.height),a=this.dragState.state,c={position:"absolute",left:a&&"column"===a.type?a.left:o+1.5,top:a&&"row"===a.type?a.top:i+1.5,width:n-o-3,height:r-i-3};return s()("div",{className:M.y4j},void 0,s()("div",{style:{...c,zIndex:a?4:2,backgroundColor:a?this.theme.contentBackground:void 0,opacity:a?.9:void 0,boxShadow:a?this.theme.mediumBoxShadow:void 0,borderRadius:2}}),s()("div",{style:{...c,border:`solid ${this.theme.simpleTableSelectionBorder}`,borderWidth:2,borderRadius:2,zIndex:a?5:3}},void 0,Hn._Y()&&this.props.canEdit&&l.createElement(l.Fragment,null,!this.environment.device.isMobile&&s()(Lr,{position:"top-left",onDraggableDragStart:this.handleTopLeftDragHandleDragStart,onDraggableDragMove:this.handleDragHandleDragMove}),s()(Lr,{position:"bottom-right",onDraggableDragStart:this.handleBottomRightDragHandleDragStart,onDraggableDragMove:this.handleDragHandleDragMove}))))}renderDragOverlay(){const e=this.dragState.state;if(!e)return;if(!this.tableElement)return;const t=this.tableElement.getBoundingClientRect(),{draggedCells:o,type:i,left:n,top:r}=e;for(const a of o)a.rect="column"===i?new DOMRect(0,a.rect.top-t.top,a.rect.width,a.rect.height):new DOMRect(a.rect.left-t.left,0,a.rect.width,a.rect.height);return s()("div",{style:{position:"absolute",left:n,top:r,zIndex:5}},void 0,s()(xr.Z,{store:this.props.store,ghostElement:o,opacity:.9},"simple_table_drag"))}didMount(){this.tableElement=this.getNode(),this.tableElement?this.observer||(this.observer=new MutationObserver(this.handleObserverChange),this.observer.observe(this.tableElement,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):this.observer&&(this.observer.disconnect(),this.observer=void 0)}handleDragHandleDragStart(e){if(!this.props.selection)return;const{start:t,end:o}=this.props.selection;this.dragHandleSelectAnchor={col:"top-left"===e?Math.max(t.col,o.col):Math.min(t.col,o.col),row:"top-left"===e?Math.max(t.row,o.row):Math.min(t.row,o.row)}}getClosestTableCellPosition(e,t){return{col:this.getClosestColumnIndex(e),row:this.getClosestRowIndex(t)}}getClosestColumnIndex(e){const t=cr.Z.findCellsInRowFromStore(void 0,this.props.store,0).sort(((e,t)=>e.props.columnIndex-t.props.columnIndex));for(let o=0;o<t.length;o++){if(e<=t[o].getNode().getBoundingClientRect().right)return o}return t.length-1}getClosestRowIndex(e){const t=cr.Z.findCellsInColumnFromStore(this.props.store,0).sort(((e,t)=>e.props.rowIndex-t.props.rowIndex));for(let o=0;o<t.length;o++){if(e<=t[o].getNode().getBoundingClientRect().bottom)return o}return t.length-1}getCellRect(e){if(!this.tableElement)return;const{store:t,columnOrder:o}=this.props,i=t.getContentStores()[e.row],n=cr.Z.findCellsInRowFromStore(i,t,e.row);if(!o)return;const r=this.getSelectedCellRect(n,o[e.col]);if(!r)return;const a=this.tableElement.getBoundingClientRect(),s=r.top-a.top,l=r.left-a.left,c=r.width,d=this.getMaxHeightOfCellsInRow(n);return new DOMRect(l-2,s-2,c+4,d+4)}getSelectedCellRect(e,t){var o,i;return null===(o=e.find((e=>e.getColumnID()===t)))||void 0===o||null===(i=o.node)||void 0===i?void 0:i.getBoundingClientRect()}getMaxHeightOfCellsInRow(e){return Math.max(...e.map((e=>{var t,o;return(null===(t=e.node)||void 0===t||null===(o=t.getBoundingClientRect())||void 0===o?void 0:o.height)||0})))}}Vr.displayName="SimpleTableSelectionOverlay";const Nr=Vr;class Or extends m.Z{constructor(){super(...arguments),this.storeTypes={formatStore:Kn},this.rootSizeObserver=new L.E,this.hoverSizeObserver=new L.E,this.nodeRef=l.createRef(),this.handleMount=e=>{e&&this.rootSizeObserver.observe(e)},this.handleHoverMount=e=>{const t=null==e?void 0:e.getNode();t&&this.hoverSizeObserver.observe(t)},this.handleRootMouseDown=e=>{const{device:t}=this.environment;t.isMobile||(0,Et.ZP)({event:e,context:Et.Af.EditorMouseDown,callback:()=>{e.preventDefault(),Bt.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.getSelectableStyle=this.createComputedStore((()=>{const{device:e}=this.environment,t={width:"100%",position:"relative",alignSelf:"center"};return(e.isMobile||this.isInColumnList()||!this.isRootOrDirectChild())&&(t.maxWidth=this.numberOfComments.state?"calc(100% - 40px)":"100%"),t})),this.columnOrder=this.createComputedStore((()=>{const{store:e}=this.props,t=e.getFormat(),{temporaryFormat:o}=this.stores.formatStore.state;return(o||t).table_block_column_order})),this.simpleTableSelection=this.createComputedStore((()=>{const e=Xn.Z.state,{store:t}=this.props;if(e.isActive&&e.simpleTableStore===t){var o;const i=(null===(o=this.columnOrder.state)||void 0===o?void 0:o.length)||(0,Hn.WN)(t),n=(0,Hn.bm)(t)+this.numTempRows.state,{selection:r}=e;return{start:{col:(0,Jt.Z)(r.start.col,0,i-1),row:(0,Jt.Z)(r.start.row,0,n-1)},end:{col:(0,Jt.Z)(r.end.col,0,i-1),row:(0,Jt.Z)(r.end.row,0,n-1)},type:r.type}}}),!0),this.numTempRows=this.createComputedStore((()=>{const e=Hn.Ts(this.props.store);return e?e.rowsDelta:0})),this.resizeCursor=this.createComputedStore((()=>{const{store:e}=this.props,t=Yn.Z.state;if(t.isActive&&t.simpleTableStore===e){const{hover:e}=t;if("cell"===e.type&&e.resizing)return"col-resize"}const o=Hn.Ts(e);if(o){if("column"===o.resize)return"col-resize";if("row"===o.resize)return"row-resize";if("corner"===o.resize)return"nwse-resize"}const i=Gn.Z.state;if(i.isActive&&i.simpleTableStore===e)return"grab"})),this.numberOfBlockComments=this.createComputedStore((()=>Hn.Xp({simpleTableStore:this.props.store,environment:this.environment,includeInline:!1})),!0),this.numberOfComments=this.createComputedStore((()=>Hn.Xp({simpleTableStore:this.props.store,environment:this.environment,includeInline:!0})),!0)}willUnmount(){this.rootSizeObserver.destroy(),this.hoverSizeObserver.destroy()}renderPersisted(){var e,t,o;const{store:i,disabled:n,disableHoverMenu:r}=this.props,a=this.numberOfComments.state,c=this.numberOfBlockComments.state,d=a>0&&0===c,p=this.renderDiscussion({recursivelyLoadAllDiscussions:!this.marginCommentsVisible.state,hideIfSidebarOrMarginCommentsVisible:d}),u=Boolean(p)&&a>0||this.isInColumnList(),m=s()(qn.Z,{type:Wn.Z.X,preventType:sn.Q7(this.environment),style:this.getScrollerStyle(u),showLeftRightOverlay:!0,leftOverlayStyle:{left:u?-8:-8-((null===(e=this.getLeftRightPadding())||void 0===e?void 0:e.paddingLeft)||0),top:8,bottom:18},rightOverlayStyle:{top:8,bottom:18}},void 0,this.renderContent(u)),g=(0,zn.Fn)(this.environment),h=!n&&("comment_only"===this.props.store.getRole()||"comment"===(null===(t=this.pageContext)||void 0===t?void 0:t.publicEditModeStore.state.permission))&&this.environment.currentUser.isLoggedIn();return l.createElement(N.p,{allowSelectionWithin:!0,style:this.getStyle(),ref:this.handleMount,onMouseDown:this.handleRootMouseDown},u?l.createElement(j.Z,{store:i,shouldShowHoverMenu:!r&&(this.canEdit()||g),shouldShowCommentMenu:h,style:this.getSelectableStyle.state,analyticsName:"page_content",ref:this.handleHoverMount},m):m,p,s()(nr,{disabled:n,canEdit:this.canEdit(),simpleTableStore:i,rootSizeObserver:this.rootSizeObserver,offset:u?0:(null===(o=this.getLeftRightPadding())||void 0===o?void 0:o.paddingLeft)||0,hoverSizeObserver:this.hoverSizeObserver}))}renderContent(e){var t;const{store:o,disabled:i,disableHoverMenu:n}=this.props,r=o.getContentStores(),a=this.columnOrder.state;if(!a)return;const c=this.numTempRows.state,d=c<0?r.length+c:r.length,p=this.simpleTableSelection.state,{device:u}=this.environment,m=!u.isPhone,g=!i&&("comment_only"===this.props.store.getRole()||"comment"===(null===(t=this.pageContext)||void 0===t?void 0:t.publicEditModeStore.state.permission))&&this.environment.currentUser.isLoggedIn(),h=s()("div",{style:{display:"flex"}},void 0,s()("div",{style:{paddingTop:8,paddingLeft:8,paddingBottom:18,paddingRight:18}},void 0,s()(j.Z,{store:o,shouldShowHalo:!0,canSelect:!0,canDropLeft:m,canDropRight:m,canDropAbove:!1,canDropBelow:!1,aboveDropZoneMargin:4,belowDropZoneMargin:4,analyticsName:"page_content",shouldShowDropZone:!0,style:{position:"relative"},className:M.OE$,shouldShowCommentMenu:g,nodeRef:this.nodeRef??void 0},void 0,s()(Nr,{store:o,selection:p,columnOrder:a,formatStore:this.stores.formatStore,disabled:i,canEdit:this.canEdit()},void 0,s()("table",{},void 0,l.createElement("tbody",{ref:this.nodeRef,onMouseDown:Hn._Y()?void 0:Et.$0},r.slice(0,d).map(((e,t)=>s()(Ir,{rowIndex:t,rowStore:e,store:o,disabled:i,columnOrder:a,selection:p,formatStore:this.stores.formatStore},e.id))),c>0&&[...Array(c).keys()].map(((e,t)=>s()(Ir,{rowIndex:Hn.bm(o)+t,store:o,rowStore:void 0,disabled:i,columnOrder:a,selection:p,formatStore:this.stores.formatStore},t))))))))),f=(0,zn.Fn)(this.environment);return s()("div",{className:M.fOh,style:{cursor:this.resizeCursor.state,...e?{paddingRight:20}:this.getLeftRightPadding()}},void 0,e?h:l.createElement(j.Z,{store:o,shouldShowCommentMenu:g,shouldShowHoverMenu:!n&&(this.canEdit()||f),style:this.getSelectableStyle.state,analyticsName:"page_content",ref:this.handleHoverMount},h))}handleCreated(){Pt.default.afterNextFlush((()=>{Nn.fT({environment:this.environment,rowIndex:0,columnIndex:0,simpleTableStore:this.props.store})}))}getStyle(){const{store:e}=this.props;return{...this.getBlockColorStyle(),...this.props.style,position:"relative",display:"flex",...(0,On.Ks)(e)&&{width:(0,Un.$3)(this.environment),position:"sticky",left:0}}}getScrollerStyle(e){return{flexGrow:1,marginLeft:-8}}isInColumnList(){return this.context.isInColumnList}getLeftRightPadding(){const{store:e}=this.props;return(0,On.Bs)({environment:this.environment,store:e,isFullScreen:!1,sizeObserver:this.rootSizeObserver})}}Or.contextTypes={...Q.w,isInColumnList:Wt().any};const Ur=Or,Hr=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Sketch",id:"sketchBlock.embeds.button.label"}});class zr extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.sketch,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Sketch links with Public Link Access enabled",id:"sketchBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(Hr.embedButtonText),urlInputPlaceholder:"https://sketch.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed Sketch",id:"sketchBlock.placeholder"}))}}const Wr=zr,jr=(0,d.defineMessages)({placeholder:{defaultMessage:"Heading 2",id:"subheaderBlock.placeholder"}});class Kr extends m.Z{constructor(){super(...arguments),this.getHeaderTextStyle=()=>{const{device:e}=this.environment,t=this.rootStorePageFont.state,o=e.isMobile?1.25:1.5;return{fontFamily:S.Z.getHeaderFontFamily({pageFont:t,locale:y.SP}),fontWeight:S.Z.fontWeight.semibold,fontSize:`${o}em`,lineHeight:1.3}}}activate(){bi.th(this)}renderPersisted(){const{disabled:e}=this.props;return s()("div",{style:this.getStyle()},void 0,s()(Mi,{blockComponent:this,toggleStyle:this.getToggleStyle(),childrenStyleWhenToggleable:{display:"flex"}},void 0,s()(K.Z,{disabled:e,store:this.props.store.getBlockTitleStore(),placeholder:p.default.formatMessage(jr.placeholder),placeholderStyle:{WebkitTextFillColor:this.theme.headerBlockPlaceholderTextColor},style:{...Ce.ZD,...this.getHeaderTextStyle()},pasteBehavior:"block"}),this.renderDiscussion()))}getStyle(){return{display:"flex",width:"100%",...this.getBlockColorStyle(),...this.props.style}}getToggleStyle(){const{device:e}=this.environment;return{height:`${1.3*(e.isMobile?1.25:1.5)}em`,marginTop:e.isMobile?1:Ce.ZD.paddingTop,marginBottom:Ce.ZD.paddingBottom}}}const Yr=Kr,Gr=(0,d.defineMessages)({placeholder:{defaultMessage:"Heading 3",id:"subsubheaderBlock.placeholder"}});class Xr extends m.Z{constructor(){super(...arguments),this.getHeaderTextStyle=()=>{const{device:e}=this.environment,t=this.rootStorePageFont.state,o=e.isMobile?1.17:1.25;return{fontFamily:S.Z.getHeaderFontFamily({pageFont:t,locale:y.SP}),fontWeight:S.Z.fontWeight.semibold,fontSize:`${o}em`,lineHeight:1.3}}}activate(){bi.th(this)}renderPersisted(){const{disabled:e}=this.props;return s()("div",{style:this.getStyle()},void 0,s()(Mi,{blockComponent:this,toggleStyle:this.getToggleStyle(),childrenStyleWhenToggleable:{display:"flex"}},void 0,s()(K.Z,{disabled:e,store:this.props.store.getBlockTitleStore(),placeholder:p.default.formatMessage(Gr.placeholder),placeholderStyle:{WebkitTextFillColor:this.theme.headerBlockPlaceholderTextColor},style:{...Ce.ZD,...this.getHeaderTextStyle()},pasteBehavior:"block"}),this.renderDiscussion()))}getStyle(){return{display:"flex",width:"100%",...this.getBlockColorStyle(),...this.props.style}}getToggleStyle(){const{device:e}=this.environment;return{height:`${1.3*(e.isMobile?1.17:1.25)}em`,marginTop:.5}}}const qr=Xr;var $r=o(34147),Jr=o(94419),Qr=o(52771),ea=o(35973),ta=o(79131);function oa(e){window.__c={n:"TabBlockMenu"};const t=(0,Dt.O7)(),o=(0,Lt.Fg)(),i=(0,Lt.yK)((e=>({baseStyle:{paddingLeft:0,paddingRight:0,marginTop:-6,marginBottom:14},mobileStyle:sa(e),desktopStyle:aa(e),scrollerOverlayStyle:la(e)})),[]),n=(0,l.useRef)(null);return s()("div",{style:{...t.device.isMobile?i.mobileStyle:i.desktopStyle,...i.baseStyle},role:"tablist"},void 0,l.createElement(qn.Z,{type:Wn.Z.X,ref:n,showLeftRightOverlay:!0,rightOverlayStyle:i.scrollerOverlayStyle},s()(ta.ZP,{disabled:e.disabled,direction:"horizontal",keys:e.tabs.map((e=>e.id)),renderKey:(t,o)=>l.createElement(ia,r()({index:o},e)),onDrop:(o,i)=>function(e){const{environment:t,parentStore:o,onDropArgs:i,newTabs:n}=e;Te.createAndCommit({userAction:"TabBlockMenu.handleTabReorder",environment:t,perform:e=>{const{key:t,endPosition:r}=i,a=o.getContentStores().find((e=>e.id===t)),s=n[r-1],l=o.getContentStores().find((e=>e.id===s));if(a){const t=o;Jr.HP({parent:t.getContentStore(),after:l,current:a,transaction:e})}}})}({environment:t,newTabs:o,parentStore:e.parentStore,onDropArgs:i}),disableHorizontalEdgeScroll:!1})),!e.disabled&&s()(ai.Z,{style:{height:28,width:28,marginTop:6,display:"flex",justifyContent:"center"},onClick:()=>{!function(e,t,o){const{performResult:i}=Te.createAndCommit({userAction:"TabBlockMenu.newTab",environment:e,perform:o=>$r.gG({environment:e,store:t,transaction:o})}),n=()=>{const e=t.getContentStores(),o=e[e.length-1];Qr.$({blockStore:i,renderDelete:!0,originRect:o?jo.C.getRectFromStore(o):void 0})};o.current?o.current.scrollToRight({animate:!0,animationCallback:()=>{n()}}):n()}(t,e.parentStore,n)}},void 0,c.Z.plus({fill:o.mediumIconColor,width:16,height:16})))}function ia(e){window.__c={n:"TabItem"};const t=(0,Dt.O7)(),o=(0,d.useIntl)(),{index:i,parentStore:n,selectedIndex:r,tabs:a}=e,l=a[i],c=(0,Lt.yK)((e=>({selectedTab:{...{paddingTop:6,paddingBottom:12,whiteSpace:"nowrap",minWidth:0,flexShrink:0,fontWeight:500},position:"relative"},tab:{paddingTop:6,paddingBottom:12,whiteSpace:"nowrap",minWidth:0,flexShrink:0,fontWeight:500},border:ca(e)})),[]),p=(0,Ft.VK)((()=>{const e=ea.Z.getFirstSelectedDiscussionId();if(!e)return!1;const t=ge.jQ.createChildStore(l,{table:oe.qF,id:e,spaceId:l.getSpaceId()});return(0,de.qA)(t).map((e=>e.id)).includes(l.id)}),[l]),{device:u}=t,m=r===i,g=i===a.length-1,h=0===i;return s()(j.Z,{store:l,analyticsName:"tab",canSelect:!0,canDrag:!1,canDropBelow:!1,canDropLeft:!h,canDropAbove:!1,canNativeDropBelow:!1,canNativeDropLeft:!h,canNativeDropRight:!g,canDropOnto:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!h,canDropRight:!g,canInsertBelow:!g,shouldShowHalo:!0,shouldShowDropZone:!0,shouldShowParentHalo:!0,dropzoneGap:10,onSelectableDrop:e=>{const{droppedDirection:o,droppedStores:i,duplicate:n}=e;Te.createAndCommit({userAction:"TabBlockMenu.dropOntoTab",environment:t,perform:e=>{xt.LQ({environment:t,targetParentStore:l.getContentStore(),targetStore:l,droppedDirection:o,droppedStores:i,duplicate:n,transaction:e})}})},onRemove:()=>{!function(e){const{environment:t,parentStore:o,tabStore:i,index:n}=e;Te.createAndCommit({userAction:"TabBlockMenu.handleRemoveTab",environment:t,perform:e=>{const r=o.getContentStores();if(1===r.length){const t=o.getRecordStoreUIParent();"block"!==(null==t?void 0:t.table)&&"space"!==(null==t?void 0:t.table)||null==t||!t.valueIs(Ko.i)||Jr.Od({parent:t,childToRemove:o,transaction:e})}else{const e=n<r.length-1?r[n+1]:r[n-1];$r.x2({store:o,id:e.id,currentUserId:t.currentUser.id})}Jr.Od({parent:o.getContentStore(),childToRemove:i,transaction:e})}})}({environment:t,parentStore:n,tabStore:l,index:i})}},i,s()("div",{style:{...m?c.selectedTab:c.tab},role:"tab","aria-selected":m?"true":"false"},i,s()(ai.Z,{style:{fontSize:16},onClick:()=>function(e,t,o){if(e.onChange(t),o&&!e.disabled){const o=e.parentStore.getContentStores()[t];Qr.$({blockStore:o,renderDelete:!0})}}(e,i,m),disabled:e.readOnly,mobileFeedback:u.isMobile,hovered:p,isGray:!m},void 0,s()(na,{store:l}),s()(ke.Z,{store:l,placeholder:o.formatMessage(ra.untitledTab)})),m&&s()("div",{style:c.border})))}function na(e){const{store:t}=e,{icon:o,isEmptyPage:i}=(0,Ft.VK)((()=>({icon:t.hasIcon()&&t.getIcon(),isEmptyPage:t.isEmptyPage()})),[t]);return o?s()(we.Z,{disabled:!0,icon:o,isEmptyPage:i,size:20,style:{marginRight:6}}):null}const ra=(0,d.defineMessages)({untitledTab:{id:"tabMenuBlock.title.placeholder",defaultMessage:"Untitled"}});function aa(e){return{display:"flex",fontSize:14,width:"100%",paddingLeft:8,paddingRight:8,boxShadow:`0 1px 0 ${e.regularDividerColor}`,position:"relative",zIndex:1}}function sa(e){return{display:"flex",fontSize:16,width:"100%",paddingTop:2,paddingLeft:16,paddingRight:16,boxShadow:`0 1px 0 ${e.regularDividerColor}`,position:"relative",zIndex:2,height:44,background:e.popoverBackground}}function la(e){return{background:e.regularDividerColor,right:28,opacity:1,marginTop:6,marginBottom:12,width:1}}function ca(e){return{borderBottom:`2px solid ${e.regularTextColor}`,position:"absolute",bottom:0,left:0,right:0}}class da extends m.Z{constructor(){super(...arguments),this.storeTypes={shouldShowBottomBorder:V.default.of(!1)},this.handleTabClick=e=>{$r.a({store:this.props.store,index:e,currentUserId:this.environment.currentUser.id})},this.handlePlaceholderClick=e=>{Te.createAndCommit({userAction:"TabBlock.handlePlaceholderClick",environment:this.environment,perform:t=>{$r.ls({environment:this.environment,store:e,transaction:t})}})},this.handleMouseMove=e=>{const t=e.currentTarget.getBoundingClientRect();this.stores.shouldShowBottomBorder.set(this.getHoveredState(t,e.clientY))},this.handleMouseEnter=e=>{const t=e.currentTarget.getBoundingClientRect();this.stores.shouldShowBottomBorder.set(this.getHoveredState(t,e.clientY))},this.handleMouseLeave=()=>{this.stores.shouldShowBottomBorder.set(!1)},this.getSelectedTabStore=()=>{const e=$r.jL(this.props.store),t=this.props.store.getContentStores();return t.length>e?t[e]:t[0]}}handleCreated(){this.stores.shouldShowBottomBorder.set(!1)}willMount(e){const t=this.environment.currentUser.id;$r.nz({blockId:this.props.store.id,currentUserId:t})}renderPersisted(){return s()("div",{style:this.getStyle()},void 0,s()("div",{onMouseMove:this.handleMouseMove,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},void 0,s()("div",{style:{display:"flex",flexDirection:"column"}},void 0,this.renderTabs()),this.renderCurrentTab()),this.renderDiscussion({style:mt.discussionIndicatorStyle,hideIfSidebarOrMarginCommentsVisible:!0}))}renderCurrentTab(){const e=qo.b(this.props.store);return s()("div",{role:"tabpanel",style:{position:"relative"}},void 0,s()(ki.Z,{loaded:e,spinnerSize:"1em",showSpinnerTimeout:500,innerStyle:{display:"flex",flexDirection:"column"}},void 0,this.renderLoadedContent()))}renderLoadedContent(){const e=this.getSelectedTabStore();return e?s()(j.Z,{store:e,analyticsName:"page_content",canSelect:!1,canDrag:!1,isListContainer:!0,style:{display:"flex",flexDirection:"column"}},e.id,s()(W.Z,{store:e.getContentStore(),disabled:this.props.disabled,disableContent:!1,emptyPlaceholder:this.renderPlaceHolder(e)})):null}renderPlaceHolder(e){return s()(U.Z,{style:this.getPlaceholderButtonStyle(),onClick:()=>this.handlePlaceholderClick(e),disabled:!this.canEdit()},void 0,s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(d.FormattedMessage,{defaultMessage:"Empty tab. Click or drop blocks inside.",id:"tabBlock.emptyBlock.placeholderText"})))}renderTabs(){return s()(oa,{disabled:!this.canEdit(),parentStore:this.props.store,tabs:this.props.store.getContentStores(),selectedIndex:$r.jL(this.props.store),onChange:this.handleTabClick})}getHoveredState(e,t){return!this.props.disabled&&(!!R.Z.state.isDragging||(!!D.Z.state.isActive||t<=e.bottom+20&&t>=e.bottom-20))}getStyle(){return{paddingLeft:Ce.ZD.paddingLeft,flex:1,...this.getBottomBorderStyle(),...this.getBlockColorStyle(),...this.props.style}}getBottomBorderStyle(){return this.stores.shouldShowBottomBorder.get()?{boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`}:{}}getPlaceholderButtonStyle(){return{fontSize:"inherit",width:"100%",borderRadius:3,caretColor:this.theme.lightTextColor,...Ce.ZD,marginTop:2}}}const pa=da;var ua=o(85031),ma=o(33665),ga=o(42402);class ha extends m.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:xe.Z},this.renderHeader=(e,t,o)=>{const i=this.getNavigableAncestor();if(!i)return;const n=(0,le.ZP)({store:i,scrollToBlockId:e.id,fullyQualified:!1}),r=ua.y({headerBlockId:e.id,headerBlockIds:o.map((e=>e.id)),index:t,getRecordModel:this.props.store.getRecordModel});return s()("div",{style:this.getContainerStyle()},e.id,s()(be.Z,{href:n,external:!1},e.id,s()("div",{style:this.getInnerHeaderStyle(r)},void 0,s()(ke.Z,{store:e,shouldWrap:!1,underline:!0}))))},this.handleMouseMove=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.pageHeaderIdsStore=this.createComputedStore((()=>{const e=this.getNavigableAncestor();return e?ua.Q(e.id,this.props.store.getRecordModel):[]}))}renderPersisted(){const{device:e}=this.environment,t=this.getDisabled(),{store:o}=this.props,i=this.pageHeaderIdsStore.state.map((e=>ge.G.createChildStore(o,{table:te.iU,id:e})));return s()(N.p,{allowSelectionWithin:!0,style:ha.style,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,i.map(this.renderHeader),0===i.length&&s()("div",{style:{...this.getPlaceholderStyle(),...!t&&e.isMobile&&{marginRight:36}}},void 0,s()(d.FormattedMessage,{defaultMessage:"Add headings to create a table of contents. <linktohelpbutton>Learn more</linktohelpbutton>.",id:"tableOfContentsBlock.placeholder",values:{linktohelpbutton:e=>s()(ga.Z,{href:(0,ma.UY)("guides.tableOfContents"),external:!0,onClick:()=>k.trackClickHelpButton(this.environment,{from:"table_of_contents_placeholder"})},void 0,e)}})),!t&&e.isMobile&&s()(Ze.Z,{style:ha.actionMenuButtonStyle,tooltipContent:s()(d.FormattedMessage,{defaultMessage:"More actions…",id:"tableOfContentsBlock.mobileActionMenu.button.label"}),store:this.props.store,fadeIn:!1}))}getDisabled(){return this.props.disabled||!this.canEdit()}getNavigableAncestor(){const e=this.props.store.getRecordStoreUIRoot(),{mainEditorCurrentBlockStore:t}=cn.default.state;return e===t?t:Be.default.peekTarget.state===e?Be.default.peekTarget.state:void 0}getContainerStyle(){return{...this.getBlockColorStyle(),...this.props.style}}getInnerHeaderStyle(e){return{...ha.headerTextStyle,display:"flex",alignItems:"center",marginLeft:Re.LK*e,paddingTop:2*Ce.ZD.paddingTop,paddingBottom:2*Ce.ZD.paddingBottom}}getPlaceholderStyle(){return{...ha.headerTextStyle,paddingTop:Ce.ZD.paddingTop,paddingBottom:Ce.ZD.paddingBottom,color:this.theme.lightTextColor}}}ha.style={position:"relative"},ha.actionMenuButtonStyle={position:"absolute",top:3,right:6},ha.headerTextStyle={paddingRight:Ce.ZD.paddingRight,paddingLeft:Ce.ZD.paddingLeft,fontSize:14,lineHeight:1.3};const fa=ha;var va=o(17970),ya=o(80951);var ba=o(12508);const Sa=(0,d.defineMessages)({placeholder:{defaultMessage:"To-do",id:"todoBlock.placeholder"}});class wa extends m.Z{constructor(){super(...arguments),this.handleCheckboxClick=e=>{this.toggleChecked()}}activate(){this.toggleChecked()}renderPersisted(){return s()(Re.ZP,{style:this.getStyle(),left:this.renderCheckbox(),childrenStyle:{display:"flex",flexDirection:"column"}},void 0,s()("div",{style:{display:"flex"}},void 0,this.renderTitle(),this.renderDiscussion({style:mt.discussionIndicatorStyle})),!this.props.hideContent&&this.renderContent())}renderCheckbox(){return s()(ba.Z,{checked:this.isChecked(),onClick:this.handleCheckboxClick,disabled:!this.canEdit(),size:16,fill:this.getBlockColorStyle().color,tapArea:this.environment.device.isMobile?{size:30}:void 0})}renderTitle(){return s()(K.Z,{style:this.getTitleStyle(),disabled:this.props.disabled,store:this.props.store.getBlockTitleStore(),placeholder:p.default.formatMessage(Sa.placeholder),pasteBehavior:"block"})}renderContent(){const{disabled:e}=this.props;return s()(W.Z,{disabled:e,store:this.props.store.getContentStore(),disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag})}isChecked(){const e=this.props.store.getProperties();return!!e&&ya.Ml(e.checked)}toggleChecked(){if(this.canEdit()){let e;e=It().includes(vo.default.state.stores,this.props.store)?vo.default.state.stores:[this.props.store],this.isChecked()?Te.createAndCommit({userAction:"TodoBlock.toggleChecked",environment:this.environment,perform:t=>{!function(e){const{environment:t,blocks:o,transaction:i}=e;for(const n of o)Me.sW({store:n.getPropertiesStore(),data:{checked:ya._I(!1)},transaction:i});k.trackTodoBlockCheck(t,{is_checked:!1})}({environment:this.environment,blocks:e,transaction:t})}}):Te.createAndCommit({userAction:"TodoBlock.toggleChecked",environment:this.environment,perform:t=>{!function(e){const{blocks:t,transaction:o,environment:i}=e;for(const n of t)Me.sW({store:n.getPropertiesStore(),data:{checked:ya._I(!0)},transaction:o});k.trackTodoBlockCheck(i,{is_checked:!0})}({environment:this.environment,blocks:e,transaction:t})}})}}getStyle(){return{paddingLeft:Ce.ZD.paddingLeft,...this.getBlockColorStyle(),...this.props.style}}getTitleStyle(){return{...Re.R8,width:void 0,flexGrow:1,...this.isChecked()&&{textDecoration:"line-through",textDecorationColor:this.theme.strikethroughLineColor,opacity:1,color:this.theme.mediumTextColor}}}}const ka=wa,Ca=(0,d.defineMessages)({placeholder:{defaultMessage:"Toggle",id:"toggleBlock.placeholder"}});class _a extends m.Z{constructor(){super(...arguments),this.isOpen=this.createComputedStore((()=>wi.Z.isOpen(this.props.store.id)&&!this.props.hideContent)),this.isEmpty=this.createComputedStore((()=>!this.props.store.hasContent())),this.handlePlaceholderClick=()=>{Te.createAndCommit({userAction:"ToggleBlock.handlePlaceholderClick",environment:this.environment,perform:e=>{Si.ls({environment:this.environment,store:this.props.store,transaction:e})}})},this.handleToggleButtonClick=e=>{this.toggle()}}activate(){this.toggle()}willMount(e){Si.nz({blockId:e.store.id,currentUserId:this.environment.currentUser.id}),e.store.isDefaultRecordCache()&&Si.LO(this.environment,e.store.pointer)}renderPersisted(){const{store:e,disabled:t}=this.props,o=this.isOpen.state,i=e.getBlockTitleStore();return s()(Re.ZP,{style:this.getStyle(),left:this.renderToggleButton(),leftStyle:{paddingRight:2}},void 0,s()("div",{style:{display:"flex"}},void 0,s()(K.Z,{style:Re.R8,disabled:t,store:i,placeholder:p.default.formatMessage(Ca.placeholder),pasteBehavior:"block"}),this.renderDiscussion({style:_a.discussionIndicatorStyle,recursivelyLoadAllDiscussions:!this.isOpen.state})),o&&this.renderContent(),!o&&s()(W.Z,{store:this.props.store.getContentStore(),disabled:t,disableContent:!0}))}renderToggleButton(){return s()(Ci.Z,{isSidebar:!1,open:this.isOpen.state,fill:!this.isEmpty.state,onClick:this.handleToggleButtonClick,tapArea:this.environment.device.isMobile?{size:30}:void 0})}renderContent(){const{disabled:e,store:t}=this.props,o=qo.b(t)||!t.isDefaultRecordCache();return s()(ki.Z,{loaded:o,spinnerSize:"1em",showSpinnerTimeout:500,innerStyle:_a.contentStyle},void 0,s()(W.Z,{store:this.props.store.getContentStore(),emptyPlaceholder:this.renderPlaceHolder(),disabled:e,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag}))}renderPlaceHolder(){const{disabled:e}=this.props;return s()(U.Z,{style:this.getPlaceholderButtonStyle(),onClick:this.handlePlaceholderClick,disabled:e},void 0,s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(d.FormattedMessage,{defaultMessage:"Empty toggle. Click or drop blocks inside.",id:"toggleBlock.emptyBlock.placeholderText",description:"Placeholder text for an empty toggle block"})))}toggle(){let e;e=It().includes(vo.default.state.stores,this.props.store)?vo.default.state.stores:[this.props.store];const t=!this.isOpen.state;for(const o of e)Si.rd({blockId:o.id,state:t,currentUserId:this.environment.currentUser.id});k.trackToggleBlockToggle(this.environment,{is_toggled:t})}getStyle(){return{paddingLeft:Ce.ZD.paddingLeft,...this.getBlockColorStyle(),...this.props.style}}getPlaceholderButtonStyle(){return{fontSize:"inherit",width:"100%",borderRadius:3,caretColor:this.theme.lightTextColor,...Ce.ZD,marginTop:2}}}_a.contentStyle={display:"flex",flexDirection:"column"},_a.discussionIndicatorStyle={paddingLeft:0,marginLeft:-6,paddingBottom:2};const Ma=_a;var Ta=o(91791);class Ia extends m.Z{renderPersisted(){const{disabled:e,store:t}=this.props,o=t.getTransclusionReferenceTargetStore();if(o&&o.canRead())return s()(Ta.Z,{store:o,disabled:e,intl:this.props.intl,referenceStore:this.props.store,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu})}}const Pa=Ia,xa=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Tweet",id:"tweetBlock.embedTweet.button.label"}});class Ba extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){const{disabled:e}=this.props;return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.twitter,disabled:e,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with links to Tweets",id:"tweetBlock.linkInput.caption"}),embedButtonText:p.default.formatMessage(xa.embedButtonText),urlInputPlaceholder:"https://twitter.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed a Tweet",id:"tweetBlock.placeholder"}))}}const Za=Ba;class Ea extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.typeform,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with any public Typeform link",id:"typeformBlock.embed.caption"})}),s()(d.FormattedMessage,{defaultMessage:"Embed Typeform",id:"typeformBlock.placeholder"}))}}const Ra=Ea,Aa=(0,d.defineMessages)({urlPlaceholder:{defaultMessage:"Paste the video link…",id:"videoBlock.linkInput.placeholder"},embedButtonText:{defaultMessage:"Embed video",id:"videoBlock.embedVideo.button.label"}});class Da extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.video,preserveScale:!0,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"},{type:"file",videoUpload:!0}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with YouTube, Vimeo, and more",id:"videoBlock.linkInput.caption"}),embedButtonText:p.default.formatMessage(Aa.embedButtonText),urlInputPlaceholder:p.default.formatMessage(Aa.urlPlaceholder)}),s()(d.FormattedMessage,{defaultMessage:"Embed or upload a video",id:"videoBlock.placeholder"}))}}const Fa=Da,La=(0,d.defineMessages)({embedButtonText:{defaultMessage:"Embed Whimsical",id:"whimsicalBlock.embeds.button.label"}});class Va extends m.Z{constructor(){super(...arguments),this.storeTypes={blockResizerStore:u.Z}}renderPersisted(){return l.createElement(g.Z,r()({},this.props,this.stores,{store:this.props.store,iconSvg:c.Z.whimsical,mediaMenuCurrentTab:"embed",mediaMenuTabs:[{type:"embed"}],mediaMenuEmbedCaption:s()(d.FormattedMessage,{defaultMessage:"Works with Whimsical links with Public Link Access enabled",id:"whimsicalBlock.embeds.caption"}),embedButtonText:p.default.formatMessage(La.embedButtonText),urlInputPlaceholder:"https://whimsical.com/…"}),s()(d.FormattedMessage,{defaultMessage:"Embed Whimsical",id:"whimsicalBlock.placeholder"}))}}const Na=Va;let Oa;function Ua(e){const t=e.getType();if(t)return"collection_view"===t&&e.recordStoreParentDiffersFromPersistedParent()?Mt:(Oa||(Oa={text:va.Z,image:Ei.Z,video:Fa,bookmark:at,drive:Ro,audio:Oe,tweet:Za,gist:yi,maps:vn,framer:hi,invision:Di,file:ui.Z,page:Rn,to_do:ka,toggle:Ma,bulleted_list:mt,numbered_list:Bn,code:St.Z,factory:ci,button:gt.Z,divider:So,column_list:ao,copy_indicator:uo,embed:g.Z,breadcrumb:ct,equation:Oo,header:Pi,sub_header:Yr,sub_sub_header:qr,quote:Dn.Z,collection_view:Ct.Z,collection_view_page:Mt,link_to_page:un,link_to_collection:rn,figma:pi,loom:gn,codepen:kt,typeform:Ra,column:lo,pdf:An.Z,callout:bt,table_of_contents:fa,whimsical:Na,miro:Sn,abstract:v,sketch:Wr,excalidraw:zo,alias:Le,transclusion_container:Ta.Z,transclusion_reference:Pa,replit:Vn,external_object_instance:Wo.Z,table:Ur,table_row:Ir,tab:pa,hex:Zi,deepnote:ho,mixpanel:Cn,external_object_instance_page:Wo.Z,ai_block:i.default.checkGate("ai_blocks_v2")?J:X,drawing:Co}),Oa[t])}},73299:(e,t,o)=>{o.d(t,{f:()=>a});var i=o(77094),n=o.n(i),r=(o(67294),o(24405));function a(){window.__c={n:"BreadcrumbDivider"};const e=(0,r.yK)((e=>({span:{marginLeft:2,marginRight:2,color:e.lightTextColor}})),[]);return n()("span",{style:e.span},void 0,"/")}},62294:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(77094),n=o.n(i),r=(o(67294),o(480)),a=o(81954),s=o(24405),l=o(82990),c=o(3815),d=o(31278),p=o(76798),u=o(93686);function m(e){const{store:t,ignoreMaxLength:o,maxWidth:i,iconSize:m,titleStyle:g,iconStyle:h,highlighter:f}=e,{device:v}=(0,r.O7)(),y=m??(v.isMobile?24:20),{hasIcon:b,pageIcon:S,isEmptyPage:w}=(0,a.VK)((()=>({hasIcon:t.hasIcon(),pageIcon:t.getIcon(),isEmptyPage:t instanceof c.G&&t.isEmptyPage()})),[t]),k=(0,s.yK)((()=>({containerStyle:{display:"flex",alignItems:"center",minWidth:0},teamRecordTitle:{maxWidth:i,...g},pageRecordTitle:{maxWidth:o?"none":i,...g},recordIconStyle:{marginRight:6,fontWeight:l.Z.fontWeight.medium,...h}})),[o,i,g,h]);return t instanceof c.zX?n()("div",{style:k.containerStyle},void 0,n()(u.p,{disabled:!0,store:t,size:y,style:k.recordIconStyle}),n()(p.Z,{store:t,style:k.teamRecordTitle,highlighter:f,enableHover:!0})):n()("div",{style:k.containerStyle},`breadcrumb-recordtitle-${t.id}`,b&&n()(d.Z,{disabled:!0,icon:S,isEmptyPage:w,size:y,style:k.recordIconStyle,largeIcon:!0}),n()(p.Z,{store:t,style:k.pageRecordTitle,highlighter:f,enableHover:!0}))}},40793:(e,t,o)=>{o.d(t,{Z:()=>b});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(13084),u=o(30149),m=o(84210),g=o(31945),h=o(89728),f=o(66094),v=o(73299),y=o(62294);function b(e){window.__c={n:"BreadcrumbPageButton"};const t=(0,l.O7)(),{device:o}=t,{store:i,showDivider:r,maxWidth:b,popupRenderer:S,iconSize:w,titleStyle:k,iconStyle:C,highlighter:_}=e,M=(0,d.yK)((()=>({selectable:{display:"flex",alignItems:"center",minWidth:0},button:{display:"flex",minWidth:0,fontSize:"inherit",padding:2}})),[]),{url:T,canEdit:I}=(0,c.VK)((()=>({url:(0,m.ZP)({store:i,fullyQualified:!1}),canEdit:i.canEdit()})),[i]),P=(0,s.useCallback)((e=>{const{droppedDirection:o,droppedStores:n,duplicate:r}=e;u.createAndCommit({userAction:"SearchPathBreadcrumb.onDrop",environment:t,perform:e=>p.LQ({environment:t,targetParentStore:i.getContentStore(),targetStore:i,droppedDirection:o,droppedStores:n,duplicate:r,transaction:e})})}),[t,i]);return a()(s.Fragment,{},i.id,a()(f.Z,{store:i,canDropOnto:I,onSelectableDrop:P,style:M.selectable,analyticsName:"breadcrumb",shouldShowDropZone:!0},void 0,S?a()(g.Z,{originGap:4,popupType:o.isMobile?g.Z.PopupType.SlideUp:g.Z.PopupType.Popup,render:S,renderOrigin:e=>s.createElement(h.Z,n()({},e,{style:M.button,isSmall:!0,shouldShrink:!0,mobileFeedback:o.isMobile}),a()(y.Z,{store:i,maxWidth:b,iconSize:w,titleStyle:k,iconStyle:C,highlighter:_}))}):a()(h.Z,{href:T,external:!1,style:M.button,isSmall:!0,shouldShrink:!0,mobileFeedback:o.isMobile},void 0,a()(y.Z,{store:i,maxWidth:b,iconSize:w,titleStyle:k,iconStyle:C,highlighter:_}))),r&&a()(v.f,{}))}},99208:(e,t,o)=>{o.d(t,{Z:()=>A});var i=o(97464),n=o.n(i),r=o(77094),a=o.n(r),s=o(67294),l=o(480),c=o(81954),d=o(24405),p=o(23537),u=o(31945),m=o(89728),g=o(5366),h=o(5978),f=o(73744),v=o(60709),y=o(73657),b=o(78140),S=o(9342),w=o(11470),k=o(72495),C=o(82990),_=o(50906),M=o(3418),T=o(76798),I=o(11913),P=o(30040),x=o(93686);function B(e){const{teamStore:t}=e,o=(0,l.O7)(),i=(0,c.VK)((()=>t.getUserIdsInTeam().length),[t]),n=function(){const e=(0,l.O7)();return(0,d.yK)((t=>({headerWrap:{display:"flex",marginLeft:12,marginRight:12,alignItems:"center",...e.device.isMobile&&{paddingTop:12,paddingBottom:8}},teamNameContainer:{marginRight:10,flexGrow:1,flexShrink:0,lineHeight:"1em"},teamName:{fontSize:12,fontWeight:C.Z.fontWeight.semibold,maxWidth:180,marginRight:4,alignSelf:"center",...C.Z.textOverflowStyle},teamNameAndSettings:{display:"flex"},icon:{marginRight:10,marginTop:2},memberCount:{fontSize:12,color:t.lightTextColor}})),[e])}();return s.createElement(s.Fragment,null,a()("div",{style:n.headerWrap},void 0,a()(x.p,{disabled:!0,store:t,size:28,style:n.icon}),a()("div",{style:n.teamNameContainer},void 0,a()("div",{style:n.teamNameAndSettings},void 0,a()(T.Z,{store:t,style:n.teamName}),a()(I.o,{teamStore:t,onPopupClick:()=>{M.Z.addNamedPopup("team_more_actions"),_.trackOpenOutlinerTeamOverflow(o,{store:t,from:"team_menu_header"})},onPopupClose:()=>{M.Z.removeNamedPopup("team_more_actions")},from:"team_menu_header",hideJoin:!0})),a()("div",{style:n.memberCount},void 0,a()(g.FormattedMessage,{defaultMessage:"{numberOfMembers, plural, one {{numberOfMembers} member} other {{numberOfMembers} members}}",values:{numberOfMembers:i},description:"Number of members on a team",id:"teamMenuHeader.teamMemberCount"}))),a()(P.M,{teamStore:t,from:"team_breadcrumb_popup",navigateToTeamHomeOnJoin:!1})))}function Z(e){window.__c={n:"TeamBreadcrumbPopup"};const{teamStore:t,parent:o}=e,i=(0,l.O7)(),r=(0,c.VK)((()=>t.getTeamPagesStores().filter((e=>e.canRead()&&e.isNavigableBlock()))),[t]),p=function(){const e=(0,l.O7)();return(0,d.yK)((t=>({morePagesCaption:e.device.isMobile?{}:{marginTop:0,marginBottom:0}})),[e])}();return a()(b.Z,{menuType:i.device.isMobile?v.og.ActionSheet:v.og.Popup,minWidth:280,header:a()(k.Z,{extraTopPadding:!0},void 0,a()(B,{teamStore:t}))},void 0,a()(S.Z,{type:S.i.Vertical,initialFocus:void 0,sections:[{key:"pages",items:r.slice(0,7).map((e=>({key:e.id,render:t=>s.createElement(w.Z,n()({store:e,hidePath:!0},t)),action:t=>{const n=f.DJ(t.event);h.navigateToBlock({environment:i,store:e,openInNew:n}),n||o.close()}}))),render:e=>s.createElement(k.Z,e,e.children,r.length>7&&a()(y.Z,{style:p.morePagesCaption,caption:a()(g.FormattedMessage,{defaultMessage:"{numberOfMorePages} more…",values:{numberOfMorePages:r.length-7},description:"Show the number of extra pages not shown",id:"TeamBreadcrumbPopup.morePages"})}))}]}))}var E=o(73299),R=o(62294);function A(e){window.__c={n:"BreadcrumbTeamButton"};const{device:t}=(0,l.O7)(),{store:o,showDivider:i,popupRenderer:r,iconSize:g,iconStyle:h,highlighter:f}=e,v=(0,d.yK)((()=>({button:{fontSize:"inherit",padding:2}})),[]),{teamsEnabled:y,storeIsDefined:b}=(0,c.VK)((()=>({teamsEnabled:(0,p.bq)(),storeIsDefined:o.isDefined()})),[o]);if(!b||!y)return null;return a()(s.Fragment,{},o.id,a()(u.Z,{originGap:4,popupType:t.isMobile?u.Z.PopupType.SlideUp:u.Z.PopupType.Popup,render:r??(e=>a()(Z,{teamStore:o,parent:e})),renderOrigin:i=>s.createElement(m.Z,n()({style:v.button,isSmall:!0,shouldShrink:!0,mobileFeedback:t.isMobile},i),a()(R.Z,{store:o,maxWidth:e.maxWidth,iconSize:g,titleStyle:e.titleStyle,iconStyle:h,highlighter:f}))}),i&&a()(E.f,{}))}},75259:(e,t,o)=>{o.d(t,{Z:()=>fo});var i=o(97464),n=o.n(i),r=o(96486),a=o.n(r),s=o(67294),l=o(33125),c=o(81954),d=o(11368),p=o(58299),u=o(10161),m=o(37911),g=o(77094),h=o.n(g),f=o(480),v=o(24405),y=o(80951),b=o(51365),S=o(30149),w=o(12508),k=o(21366),C=o(7907),_=o(24118);const M=s.forwardRef(((e,t)=>{const{store:o,property:i,disabled:r,enablePointerEventsForInteractiveTypes:a,editButtonClickProps:l,onClick:d,onContextMenu:p,buttonStyle:u,size:m,showLabel:g,isInteractive:_}=e,M=(0,f.O7)(),T=(0,c.VK)((()=>y.Ml(o.getPropertyValue(i))),[i,o]),{baseStyles:I,shouldRenderTooltip:P,isReadOnly:x,trackEditBlockProperty:B,propertySchema:Z}=(0,s.useContext)(C.O),E=Z,R=(0,s.useCallback)((()=>{o.getPropertyStore(i)&&S.createAndCommit({userAction:"BlockPropertyValue.handleEditButtonClick",environment:M,perform:e=>{b.vO({stores:[o],property:i,transaction:e})}}),B(),d&&d()}),[M,d,i,o,B]),A=(0,v.yK)((()=>({cardCheckboxWrapStyle:{display:"flex",alignItems:"center"},cardCheckboxNameStyle:{marginLeft:6,marginRight:2},buttonStyle:{...I.buttonStyle,...u},buttonPressedStyle:I.buttonPressedStyle??{},buttonHoveredStyle:I.buttonHoveredStyle??{}})),[I,u]),D=E.name,F={checked:T,disabled:!_,style:{...a&&{pointerEvents:"auto"}},onClick:R,..."small"===m?{size:12,checkSize:8}:{size:16,checkSize:12}},L=g?h()("div",{style:A.cardCheckboxWrapStyle},void 0,s.createElement(w.Z,F),h()("div",{style:A.cardCheckboxNameStyle},void 0,D)):s.createElement(w.Z,n()({},F,{tooltipHeader:P?s.createElement(s.Fragment,null,E.name):void 0}));return s.createElement(k.Z,{ref:t,disabled:r,readOnly:x,onContextMenu:p,editButtonClickProps:l,style:A.buttonStyle,hoveredStyle:A.buttonHoveredStyle,pressedStyle:A.buttonPressedStyle},L)})),T=s.forwardRef(((e,t)=>{const o=(0,v.yK)((()=>({buttonStyle:{padding:8,justifyContent:"center",userSelect:"none"}})),[]);return s.createElement(M,n()({},F(e,t,o),{size:"regular",showLabel:!1,isInteractive:!1}))})),I=s.forwardRef(((e,t)=>{const o=(0,v.yK)((()=>({buttonStyle:{padding:"9px 8px"}})),[]);return s.createElement(M,n()({},F(e,t,o),{size:"regular",showLabel:!1,isInteractive:!1}))})),P=s.forwardRef(((e,t)=>{const o=(0,v.yK)((()=>({buttonStyle:{padding:"7px 8px"}})),[]);return s.createElement(M,n()({},F(e,t,o),{size:"regular",showLabel:!1}))})),x=s.forwardRef(((e,t)=>s.createElement(M,n()({},F(e,t),{size:"regular",showLabel:!1})))),B=s.forwardRef(((e,t)=>s.createElement(M,n()({},F(e,t),{size:"regular",showLabel:!0})))),Z=s.forwardRef(((e,t)=>{const o=(0,f.Fy)().isPhone?"regular":"small";return s.createElement(M,n()({},F(e,t),{size:o,showLabel:!0}))})),E=s.forwardRef(((e,t)=>{const o=(0,f.Fy)().isMobile?"regular":"small";return s.createElement(M,n()({},F(e,t),{size:o,showLabel:!0}))})),R=s.forwardRef(((e,t)=>{const{disabled:o}=e;return s.createElement(M,n()({},F(e,t),{size:"regular",showLabel:!1,isInteractive:!o}))})),A=s.forwardRef(((e,t)=>s.createElement(M,n()({},F(e,t),{size:"regular",showLabel:!1})))),D=s.forwardRef(((e,t)=>{const o=(0,v.yK)((()=>({buttonStyle:{padding:"8px"}})),[]);return s.createElement(M,n()({},F(e,t,o),{size:"regular",showLabel:!1}))}));function F(e,t,o){const{store:i,collectionStore:n,property:r,disabled:a,enablePointerEventsForInteractiveTypes:s,onClick:l,onContextMenu:c}=e;return{ref:t,store:i,collectionStore:n,property:r,disabled:a,enablePointerEventsForInteractiveTypes:s,editButtonClickProps:(0,_.Qg)(e),onClick:l,onContextMenu:c,isInteractive:!a,buttonStyle:null==o?void 0:o.buttonStyle}}var L=o(32918),V=o(42875),N=o(89837),O=o(49616),U=o(89845),H=o(39694),z=o(39068),W=o(5366);function j(){window.__c={n:"EmptyPropertyText"};const{baseStyles:e}=(0,s.useContext)(C.O);return h()("div",{style:{...null==e?void 0:e.textStyle,...null==e?void 0:e.emptyStyle}},void 0,h()(W.FormattedMessage,{defaultMessage:"Empty",id:"database.pageProperty.emptyTitle"}))}function K(){return s.createElement(s.Fragment,null)}function Y(){window.__c={n:"QuickEditEmptyPropertyText"};const e=(0,v.Fg)(),{propertySchema:t,baseStyles:o}=(0,s.useContext)(C.O);return t?h()("div",{style:{display:"inline-flex",alignItems:"center",...null==o?void 0:o.textStyle,...null==o?void 0:o.emptyStyle}},void 0,h()(z.ZP,{type:t.type,icon:t.icon,size:14,theme:e,style:{marginRight:8}}),h()(W.FormattedMessage,{defaultMessage:"Add {propertyName}",id:"database.boardProperty.fillProperty",values:{propertyName:t.name},description:"Prompt to user to fill in an empty property"})):null}const G=(0,s.forwardRef)(((e,t)=>{const{store:o,collectionStore:i,disabled:n,buttonStyle:r,onContextMenu:a,editButtonClickProps:l,quickActionButtons:d,emptyComponent:p,size:u="regular",fontColor:m="regular"}=e,g=(0,_.Ri)(i,e.property),{propertySchema:f,isReadOnly:b,isEmpty:S,baseStyles:w}=(0,s.useContext)(C.O),M=f,T=function(e,t,o){return(0,c.VK)((()=>{switch(t){case"created_time":const t=e.getCreatedTime();return t?N.CQ(t,(0,V.r)()):void 0;case"last_edited_time":const i=e.getLastEditedTime();return i?N.CQ(i,(0,V.r)()):void 0;default:const n=e.getPropertyValue(o);return(0,y.Gl)(n)}}),[o,e,t])}(o,null==M?void 0:M.type,g),I=(0,v.yK)((e=>({baseTextStyle:{...w.textStyle,fontSize:"small"===u?O.pe:O.Kt,color:"light"===m?e.mediumTextColor:e.regularTextColor},buttonStyle:{...w.buttonStyle,...r},buttonPressedStyle:w.buttonPressedStyle??{},buttonHoveredStyle:w.buttonHoveredStyle??{}})),[w.buttonHoveredStyle,w.buttonPressedStyle,w.buttonStyle,w.textStyle,r,m,u]);return S&&void 0===p?s.createElement(s.Fragment,null):s.createElement(k.Z,{ref:t,style:I.buttonStyle,hoveredStyle:I.buttonHoveredStyle,pressedStyle:I.buttonPressedStyle,disabled:n,readOnly:b,onContextMenu:a,editButtonClickProps:l,quickActionButtons:d},S?p:h()(U.Z,{value:T,dateFormat:(null==M?void 0:M.date_format)||L.sF,timeFormat:(null==M?void 0:M.time_format)||L.c_,style:{...I.baseTextStyle}}))})),X=(0,s.forwardRef)(((e,t)=>{const{store:o,collectionStore:i,property:r,format:a}=e,l=(0,c.VK)((()=>i.getSchema()),[i]),d=(0,c.VK)((()=>o.getValue()),[o]),{isReadOnly:p}=(0,s.useContext)(C.O);return s.createElement(G,n()({},re(e,t),{emptyComponent:h()(j,{}),size:"regular",fontColor:"regular",quickActionButtons:p?void 0:h()(H.Z,{store:o,schema:l,property:r,pageValue:d,format:a})}))})),q=(0,s.forwardRef)(((e,t)=>{const{store:o,collectionStore:i,property:r,format:a}=e,l=(0,c.VK)((()=>i.getSchema()),[i]),d=(0,c.VK)((()=>o.getValue()),[o]),{isReadOnly:p}=(0,s.useContext)(C.O);return s.createElement(G,n()({},re(e,t),{emptyComponent:h()(K,{}),quickActionButtons:p?void 0:h()(H.Z,{store:o,schema:l,property:r,pageValue:d,format:a})}))})),$=(0,s.forwardRef)(((e,t)=>s.createElement(G,n()({},re(e,t),{emptyComponent:h()(j,{})})))),J=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(G,n()({},re(e,t),{size:"small",fontColor:"light",emptyComponent:o?h()(Y,{}):void 0}))})),Q=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(G,n()({},re(e,t),{size:"small",emptyComponent:o?h()(Y,{}):void 0}))})),ee=(0,s.forwardRef)(((e,t)=>s.createElement(G,n()({},re(e,t),{size:"small",fontColor:"light"})))),te=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(G,n()({},re(e,t),{size:"small",emptyComponent:o?h()(Y,{}):void 0}))})),oe=(0,s.forwardRef)(((e,t)=>s.createElement(G,n()({},re(e,t),{size:"small",fontColor:"light"})))),ie=(0,s.forwardRef)(((e,t)=>s.createElement(G,n()({},re(e,t),{size:"small",fontColor:"light"})))),ne=(0,s.forwardRef)(((e,t)=>s.createElement(G,n()({},re(e,t),{size:"small",fontColor:"light"}))));function re(e,t,o){const{store:i,collectionStore:n,property:r,disabled:a,onContextMenu:s}=e;return{ref:t,store:i,collectionStore:n,property:r,disabled:a,editButtonClickProps:(0,_.Qg)(e),onContextMenu:s,buttonStyle:null==o?void 0:o.buttonStyle,emptyComponent:void 0}}var ae=o(84619),se=o(25464),le=o(58032),ce=o(93044),de=o(22084),pe=o(23049);const ue=(0,s.forwardRef)(((e,t)=>{const{buttonStyle:o,disabled:i,editButtonClickProps:n,property:r,emptyComponent:a,onContextMenu:l,tokenFormat:d,tokenLimit:p,store:u}=e,{propertySchema:m,isReadOnly:g,isEmpty:f,baseStyles:b}=(0,s.useContext)(C.O),S=m,w=(0,c.VK)((()=>{const e=u.getPropertyValue(r),t=S.options||[];return y.uP(e,t)}),[S.options,u,r]),_=(0,s.useMemo)((()=>S.options||[]),[S.options]),[M,T]=(0,s.useMemo)((()=>[p?w.slice(0,p):w,p?w.slice(p):[]]),[w,p]),{gap:I}=ce.wS[d],P=(0,v.yK)((e=>({buttonStyle:{...b.buttonStyle,...o},buttonPressedStyle:b.buttonPressedStyle??{},buttonHoveredStyle:b.buttonHoveredStyle??{},overflowIndicator:{marginRight:4,color:e.mediumTextColor},tooltip:{paddingTop:8},tokensContainer:{...b.tokenWrapStyle,gap:I},remainderPropertiesContainer:{display:"flex",flexWrap:"wrap",fontWeight:"normal",width:240},selectToken:{margin:0},moreToken:{margin:0}})),[b.buttonHoveredStyle,b.buttonPressedStyle,b.buttonStyle,b.tokenWrapStyle,o,I]),x=(0,s.useMemo)((()=>f?a:s.createElement("div",{ref:t,style:P.tokensContainer},M.map((e=>h()(de.Z,{value:e,options:_,showRemoveButton:!1,format:d,isSingle:!1,shouldShrink:!!p,style:P.selectToken,showEllipsis:!0},e))),T.length>0&&h()(le.Z,{style:P.tooltip,renderTooltip:()=>h()("div",{style:P.remainderPropertiesContainer},void 0,T.map((e=>h()(de.Z,{value:e,options:_,showRemoveButton:!1,format:d,isSingle:!1,shouldShrink:!1,showEllipsis:!0},e)))),isLightBackground:!0,textWrap:!0,alignment:se.v.Center,placement:se.u.Bottom,render:e=>s.createElement("div",e,h()(pe.Z,{count:T.length,format:d,fixedHeight:!1,style:P.moreToken,isCompact:!0}))}))),[f,a,t,P.tokensContainer,P.tooltip,P.selectToken,P.remainderPropertiesContainer,P.moreToken,M,T,_,d,p]);return f&&void 0===a?s.createElement(s.Fragment,null):s.createElement(k.Z,{ref:t,disabled:i,readOnly:g,editButtonClickProps:n,onContextMenu:l,style:P.buttonStyle,hoveredStyle:P.buttonHoveredStyle,pressedStyle:P.buttonPressedStyle},x)})),me=(0,s.forwardRef)(((e,t)=>s.createElement(ue,n()({},Ce(e,t),{emptyComponent:h()(K,{}),tokenFormat:ae.l.Medium})))),ge=(0,s.forwardRef)(((e,t)=>s.createElement(ue,n()({},Ce(e,t),{emptyComponent:h()(j,{}),tokenFormat:ae.l.Medium})))),he=(0,s.forwardRef)(((e,t)=>s.createElement(ue,n()({},Ce(e,t),{emptyComponent:h()(j,{}),tokenLimit:2,tokenFormat:ae.l.Medium})))),fe=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(ue,n()({},Ce(e,t),{emptyComponent:o?h()(Y,{}):void 0,tokenFormat:ae.l.Inline}))})),ve=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(ue,n()({},Ce(e,t),{emptyComponent:o?h()(Y,{}):void 0,tokenFormat:ae.l.Small}))})),ye=(0,s.forwardRef)(((e,t)=>{const{isPhone:o}=(0,f.Fy)();return s.createElement(ue,n()({},Ce(e,t),{tokenFormat:o?ae.l.Medium:ae.l.ExtraSmall}))})),be=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(ue,n()({},Ce(e,t),{emptyComponent:o?h()(Y,{}):void 0,tokenFormat:ae.l.Inline}))})),Se=(0,s.forwardRef)(((e,t)=>s.createElement(ue,n()({},Ce(e,t),{tokenFormat:ae.l.Inline})))),we=(0,s.forwardRef)(((e,t)=>s.createElement(ue,n()({},Ce(e,t),{tokenFormat:ae.l.Inline})))),ke=(0,s.forwardRef)(((e,t)=>s.createElement(ue,n()({},Ce(e,t),{tokenFormat:ae.l.Inline}))));function Ce(e,t,o){const{store:i,collectionStore:n,property:r,disabled:a,onContextMenu:s}=e;return{ref:t,store:i,collectionStore:n,property:r,disabled:a,editButtonClickProps:(0,_.Qg)(e),onContextMenu:s,buttonStyle:null==o?void 0:o.buttonStyle}}var _e=o(32056),Me=o(61766),Te=o(56247),Ie=o(3779),Pe=o(33929),xe=o(31945),Be=o(73063),Ze=o(75173);const Ee=(0,W.defineMessages)({numberFormat:{defaultMessage:"Number format",id:"database.viewSettings.numberOptions.numberFormat"}});function Re(e){window.__c={n:"NumberFormatButton"};const{numberFormatButtonPopupStore:t,property:o,schema:i,collectionStore:r}=e,a=(0,f.O7)(),{device:l}=a,c=(0,s.useCallback)((()=>{t.reset()}),[t]);return h()(le.Z,{renderTooltip:()=>Pe.default.formatMessage(Ee.numberFormat),render:e=>h()(xe.Z,{popupType:l.isMobile?xe.Z.PopupType.SlideUp:xe.Z.PopupType.Popup,alignmentToOrigin:xe.Z.Alignment.End,buttonPopupStore:t,style:{width:200},renderOrigin:t=>s.createElement(Be.Z,n()({},e,{icon:Ie.Z.collectionNumberType,hasBackground:!0,showShadow:!0,ariaLabel:Pe.default.formatMessage(Ee.numberFormat)},t)),render:()=>h()(Ze.Z,{collectionStore:r,property:o,schema:i,onClose:c})})})}const Ae=(0,s.forwardRef)(((e,t)=>{const{store:o,collectionStore:i,disabled:n,textStyle:r,buttonStyle:a,onContextMenu:l,editButtonClickProps:d,quickActionButtons:p,quickActionButtonsAlign:u,emptyComponent:m}=e,g=(0,_.Ri)(i,e.property),{isReadOnly:f,isEmpty:b,baseStyles:S,propertySchema:w,shouldRenderTooltip:M}=(0,s.useContext)(C.O),T=w,I=(0,c.VK)((()=>{const e=o.getPropertyValue(g);return y.VY(e)}),[g,o]),P=(0,v.yK)((()=>({textStyle:{...S.textStyle,...r},buttonStyle:{...S.buttonStyle,...a},buttonPressedStyle:S.buttonPressedStyle??{},buttonHoveredStyle:S.buttonHoveredStyle??{},barStyle:{flexGrow:1,flexShrink:0,minWidth:48,maxWidth:120}})),[S.buttonHoveredStyle,S.buttonPressedStyle,S.buttonStyle,S.textStyle,a,r]),x=T.number_format||_e.dk;return b&&void 0===m?s.createElement(s.Fragment,null):s.createElement(k.Z,{ref:t,style:P.buttonStyle,hoveredStyle:P.buttonHoveredStyle,pressedStyle:P.buttonPressedStyle,disabled:n,readOnly:f,onContextMenu:l,editButtonClickProps:d,quickActionButtons:p,quickActionButtonsAlign:u},b?m:h()(Te.b,{style:P.textStyle,barStyle:P.barStyle,numberValue:I,numberFormat:x,numberShowAs:T.show_as,shouldRenderTooltip:M}))})),De=(0,s.forwardRef)(((e,t)=>{const{collectionStore:o,property:i,format:r,store:a}=e,{isReadOnly:l}=(0,s.useContext)(C.O),d=(0,s.useMemo)((()=>new Me.Z),[]),p=(0,c.VK)((()=>o.getSchema()),[o]);return s.createElement(Ae,n()({},je(e,t),{emptyComponent:h()(j,{}),quickActionButtons:l?void 0:[h()(Re,{numberFormatButtonPopupStore:d,property:i,collectionStore:o,schema:p},"format"),h()(H.Z,{store:a,schema:p,property:i,format:r},"copy")]}))})),Fe=(0,s.forwardRef)(((e,t)=>{const{collectionStore:o,property:i}=e,{isReadOnly:r}=(0,s.useContext)(C.O),a=(0,s.useMemo)((()=>new Me.Z),[]),l=(0,c.VK)((()=>o.getSchema()),[o]),d=(0,v.yK)((()=>({textStyle:{justifyContent:"flex-end"}})),[]);return s.createElement(Ae,n()({},je(e,t,d),{emptyComponent:h()(K,{}),quickActionButtons:r?void 0:h()(Re,{numberFormatButtonPopupStore:a,property:i,collectionStore:o,schema:l}),quickActionButtonsAlign:"left"}))})),Le=(0,s.forwardRef)(((e,t)=>s.createElement(Ae,n()({},je(e,t),{emptyComponent:h()(j,{})})))),Ve=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(Ae,n()({},je(e,t),{emptyComponent:o?h()(Y,{}):void 0}))})),Ne=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(Ae,n()({},je(e,t),{emptyComponent:o?h()(Y,{}):void 0}))})),Oe=(0,s.forwardRef)(((e,t)=>s.createElement(Ae,je(e,t)))),Ue=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(Ae,n()({},je(e,t),{emptyComponent:o?h()(Y,{}):void 0}))})),He=(0,s.forwardRef)(((e,t)=>s.createElement(Ae,je(e,t)))),ze=(0,s.forwardRef)(((e,t)=>s.createElement(Ae,je(e,t)))),We=(0,s.forwardRef)(((e,t)=>s.createElement(Ae,je(e,t))));function je(e,t,o){const{store:i,collectionStore:n,property:r,disabled:a,onContextMenu:s}=e;return{ref:t,store:i,collectionStore:n,property:r,disabled:a,editButtonClickProps:(0,_.Qg)(e),onContextMenu:s,textStyle:null==o?void 0:o.textStyle,buttonStyle:null==o?void 0:o.buttonStyle,emptyComponent:void 0}}var Ke=o(66897),Ye=o(92864);const Ge=s.forwardRef(((e,t)=>{const{buttonStyle:o,disabled:i,onContextMenu:n,editButtonClickProps:r,property:a,store:l,emptyComponent:c,tokenFormat:d,tokenLimit:p}=e,{propertySchema:u,isEmpty:m,isReadOnly:g,shouldRenderTooltip:f,baseStyles:y}=(0,s.useContext)(C.O),b=u,S=qe(l,b,a),w=Xe(S,l.getRecordValue,p),{gap:_,margin:M}=ce.wS[d],T=(0,v.yK)((e=>({buttonStyle:{...y.buttonStyle,...o},buttonPressedStyle:y.buttonPressedStyle??{},buttonHoveredStyle:y.buttonHoveredStyle??{},tokensContainer:{...y.tokenWrapStyle,gap:d!==ae.l.Inline?_:void 0},actorToken:{margin:0},actorTokenOverlap:{margin:d===ae.l.Inline?M:void 0},moreToken:{margin:0}})),[y.buttonHoveredStyle,y.buttonPressedStyle,y.buttonStyle,y.tokenWrapStyle,o,_,M,d]),I=m?c:s.createElement("div",{ref:t,style:T.tokensContainer},w.map(((e,t)=>{var o;return h()(Ye.ZP,{actor:e,showRemoveButton:!1,format:d,isSingle:!1,shouldShrink:!!p,tooltipHeader:f?s.createElement(s.Fragment,null,b.name):void 0,style:{...T.actorToken,...t<w.length-1?T.actorTokenOverlap:void 0}},null===(o=e.value)||void 0===o?void 0:o.id)})),p&&S.length>p&&h()(pe.Z,{count:S.length-p,format:d,style:T.moreToken,fixedHeight:!0,isCompact:!0}));return m&&void 0===c?s.createElement(s.Fragment,null):s.createElement(k.Z,{ref:t,disabled:i,readOnly:g,editButtonClickProps:r,onContextMenu:n,style:T.buttonStyle,pressedStyle:T.buttonPressedStyle,hoveredStyle:T.buttonHoveredStyle},I)})),Xe=(e,t,o)=>(0,c.VK)((()=>a().compact(e.slice(0,o).map((e=>(0,Ke.Hl)({pointer:e,getRecordValue:t}))))),[e,t,o]),qe=(e,t,o)=>(0,c.VK)((()=>{if("created_by"===t.type){const t=e.getCreatedById(),o=e.getCreatedByTable();if(t&&o)return[{table:o,id:t}]}else if("last_edited_by"===t.type){const t=e.getLastEditedById(),o=e.getLastEditedByTable();if(t&&o)return[{table:o,id:t}]}const i=e.getPropertyValue(o);return y.DW({textValue:i,propertySchema:t,blockCreatorPointer:y.I1(e.getCreatedById(),e.getCreatedByTable())})}),[o,t,e]),$e=s.forwardRef(((e,t)=>s.createElement(Ge,n()({},st(e,t),{emptyComponent:h()(K,{}),tokenFormat:ae.l.Medium})))),Je=s.forwardRef(((e,t)=>s.createElement(Ge,n()({},st(e,t),{emptyComponent:h()(j,{}),tokenFormat:ae.l.Medium})))),Qe=s.forwardRef(((e,t)=>s.createElement(Ge,n()({},st(e,t),{emptyComponent:h()(j,{}),tokenLimit:1,tokenFormat:ae.l.Medium})))),et=s.forwardRef(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(Ge,n()({},st(e,t),{emptyComponent:o?h()(Y,{}):void 0,tokenFormat:ae.l.Inline}))})),tt=s.forwardRef(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(Ge,n()({},st(e,t),{emptyComponent:o?h()(Y,{}):void 0,tokenFormat:ae.l.Medium}))})),ot=s.forwardRef(((e,t)=>{const{isPhone:o}=(0,f.Fy)();return s.createElement(Ge,n()({},st(e,t),{tokenFormat:o?ae.l.Medium:ae.l.ExtraSmall}))})),it=s.forwardRef(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(Ge,n()({},st(e,t),{emptyComponent:o?h()(Y,{}):void 0,tokenFormat:ae.l.Medium}))})),nt=s.forwardRef(((e,t)=>s.createElement(Ge,n()({},st(e,t),{tokenFormat:ae.l.Inline})))),rt=s.forwardRef(((e,t)=>s.createElement(Ge,n()({},st(e,t),{tokenFormat:ae.l.Inline})))),at=s.forwardRef(((e,t)=>s.createElement(Ge,n()({},st(e,t),{tokenFormat:ae.l.Inline}))));function st(e,t,o){const{store:i,property:n,disabled:r,onContextMenu:a}=e;return{ref:t,store:i,property:n,disabled:r,editButtonClickProps:(0,_.Qg)(e),onContextMenu:a,buttonStyle:null==o?void 0:o.buttonStyle}}const lt=(0,s.forwardRef)(((e,t)=>s.createElement(me,n()({},e,{ref:t})))),ct=(0,s.forwardRef)(((e,t)=>s.createElement(ge,n()({},e,{ref:t})))),dt=(0,s.forwardRef)(((e,t)=>s.createElement(he,n()({},e,{ref:t})))),pt=(0,s.forwardRef)(((e,t)=>s.createElement(fe,n()({},e,{ref:t})))),ut=(0,s.forwardRef)(((e,t)=>s.createElement(ve,n()({},e,{ref:t})))),mt=(0,s.forwardRef)(((e,t)=>s.createElement(ye,n()({},e,{ref:t})))),gt=(0,s.forwardRef)(((e,t)=>s.createElement(be,n()({},e,{ref:t})))),ht=(0,s.forwardRef)(((e,t)=>s.createElement(Se,n()({},e,{ref:t})))),ft=(0,s.forwardRef)(((e,t)=>s.createElement(we,n()({},e,{ref:t})))),vt=(0,s.forwardRef)(((e,t)=>s.createElement(ke,n()({},e,{ref:t}))));var yt=o(98459),bt=o(14976),St=o(17731);const wt=(0,s.forwardRef)(((e,t)=>{const{store:o,collectionStore:i,disabled:n,buttonStyle:r,onContextMenu:a,editButtonClickProps:l,quickActionButtons:d,emptyComponent:p}=e,u=(0,f.O7)(),m=(0,v.Fg)(),g=(0,_.Ri)(i,e.property),{isReadOnly:y,isEmpty:b,baseStyles:S}=(0,s.useContext)(C.O),w=(0,c.VK)((()=>o.getPropertyValue(g)),[g,o]),M=(0,St.kw)(),T=(0,c.VK)((()=>u.KatexStore.getKatex()),[u.KatexStore]),I=(0,c.VK)((()=>bt.IY({environment:u,textValue:w&&{value:w,spaceId:(0,yt.CG)(o.pointer.spaceId)},parentStore:o,disableHover:!1,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:m,emojiType:M,katex:T,formulaValueTypes:[]})),[M,u,T,w,o,m]),P=(0,v.yK)((()=>({textStyle:{...S.textStyle},buttonStyle:{...S.buttonStyle,...r},buttonPressedStyle:S.buttonPressedStyle??{},buttonHoveredStyle:S.buttonHoveredStyle??{}})),[S.buttonHoveredStyle,S.buttonPressedStyle,S.buttonStyle,S.textStyle,r]);return b&&void 0===p?s.createElement(s.Fragment,null):s.createElement(k.Z,{ref:t,style:P.buttonStyle,hoveredStyle:P.buttonHoveredStyle,pressedStyle:P.buttonPressedStyle,disabled:n,readOnly:y,onContextMenu:a,editButtonClickProps:l,quickActionButtons:d},b?p:h()("span",{style:P.textStyle},void 0,I))})),kt=(0,s.forwardRef)(((e,t)=>{const{store:o,collectionStore:i,property:r,format:a}=e,l=(0,c.VK)((()=>i.getSchema()),[i]),d=(0,c.VK)((()=>o.getValue()),[o]),{isReadOnly:p}=(0,s.useContext)(C.O);return s.createElement(wt,n()({},Et(e,t),{emptyComponent:h()(j,{}),quickActionButtons:p?void 0:h()(H.Z,{store:o,schema:l,property:r,pageValue:d,format:a})}))})),Ct=(0,s.forwardRef)(((e,t)=>{const{store:o,collectionStore:i,property:r,format:a}=e,l=(0,c.VK)((()=>i.getSchema()),[i]),d=(0,c.VK)((()=>o.getValue()),[o]),{isReadOnly:p}=(0,s.useContext)(C.O);return s.createElement(wt,n()({},Et(e,t),{emptyComponent:h()(K,{}),quickActionButtons:p?void 0:h()(H.Z,{store:o,schema:l,property:r,pageValue:d,format:a})}))})),_t=(0,s.forwardRef)(((e,t)=>s.createElement(wt,n()({},Et(e,t),{emptyComponent:h()(j,{})})))),Mt=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(wt,n()({},Et(e,t),{emptyComponent:o?h()(Y,{}):void 0}))})),Tt=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(wt,n()({},Et(e,t),{emptyComponent:o?h()(Y,{}):void 0}))})),It=(0,s.forwardRef)(((e,t)=>s.createElement(wt,Et(e,t)))),Pt=(0,s.forwardRef)(((e,t)=>{const{showIfEmpty:o}=e;return s.createElement(wt,n()({},Et(e,t),{emptyComponent:o?h()(Y,{}):void 0}))})),xt=(0,s.forwardRef)(((e,t)=>s.createElement(wt,Et(e,t)))),Bt=(0,s.forwardRef)(((e,t)=>s.createElement(wt,Et(e,t)))),Zt=(0,s.forwardRef)(((e,t)=>s.createElement(wt,Et(e,t))));function Et(e,t,o){const{store:i,collectionStore:n,property:r,disabled:a,onContextMenu:s}=e;return{ref:t,store:i,collectionStore:n,property:r,disabled:a,editButtonClickProps:(0,_.Qg)(e),onContextMenu:s,buttonStyle:null==o?void 0:o.buttonStyle,emptyComponent:void 0}}var Rt=o(99036),At=o(65917),Dt=o(82990),Ft=o(64002),Lt=o(77162),Vt=o(64434),Nt=o(9953),Ot=o(24677),Ut=o(98104),Ht=o(52821),zt=o(41232),Wt=o(65598),jt=o(19511),Kt=o(84076),Yt=o(31278),Gt=o(65187),Xt=o(50906),qt=o(66890),$t=o(75079);function Jt(e){window.__c={n:"TitlePropertyEditButton"};const{store:t}=e,o=(0,f.O7)(),i=(0,qt.DK)(),r=(0,s.useCallback)((()=>{const e=t.getBlockTitleStore();Ot.eP({environment:o,store:t}),Ut.NX({store:e}),Vt.Z5({store:t}),Xt.trackCollectionItemEditModeEnter(o,"list_item_edit_mode_enter",{...(0,$t.Pn)(i),block_id:t.id,from:"click",view_type:"list"})}),[t,o,i]),a=(0,v.yK)((e=>({buttonStyle:{color:e.mediumTextColor,fill:e.mediumTextColor,padding:"0 14px"},iconStyle:{color:e.mediumTextColor,fill:e.mediumTextColor}})),[]);return h()(le.Z,{renderTooltip:()=>h()(W.FormattedMessage,{defaultMessage:"Edit",id:"collectionViewItem.edit.tooltip",description:"Tooltip on edit button that prompts user to edit the collection view item (title and other properties)"}),render:e=>s.createElement(Be.Z,n()({icon:Ie.Z.pencil,ariaLabel:"edit",onClick:r,hasBackground:!0,showShadow:!0,style:a.buttonStyle,iconStyle:a.iconStyle},e))})}var Qt=o(5978),eo=o(78316),to=o(79315),oo=o(88923);const io=(0,W.defineMessages)({openAsPageTitle:{defaultMessage:"Open",id:"database.actionButton.openAsPageTitle",description:"Title for the button to open a block as a page"}});function no(e){const{store:t,handleOpenPeekPage:o,showLabel:i}=e,r=(0,f.O7)(),a=(0,qt.DK)(),l=(0,c.VK)((()=>null==a?void 0:a.collectionViewStore()),[a]),{isAlreadyOpenInPeek:d,peekModeProps:p}=(0,c.VK)((()=>{const e=void 0!==l?eo.kr(l):"full_page";return{isAlreadyOpenInPeek:oo.default.state.open&&oo.default.state.target.id===t.id,peekModeProps:(0,O.X9)(e,!1)}}),[t,l],{useDeepEqual:!0}),u=(0,s.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=to.default.state;return eo.mb({store:t,mainEditorCurrentBlockStore:e,collectionContextStore:a,fullyQualified:!1})}),[t,a]),m=(0,v.yK)((e=>({buttonStyle:{color:e.mediumTextColor,fill:e.mediumTextColor,padding:i?"0 6px":"0 14px"},iconStyle:{color:e.mediumTextColor,fill:e.mediumTextColor}})),[i]);return d?s.createElement(s.Fragment,null):h()(le.Z,{renderTooltip:()=>p.tooltip,render:e=>s.createElement(Be.Z,n()({onClick:()=>{const e=u();e&&(o&&o(),Qt.navigate({environment:r,url:e}))},icon:p.icon,ariaLabel:p.tooltip,hasBackground:!0,showShadow:!0,style:m.buttonStyle,iconStyle:m.iconStyle,caption:i?Pe.default.formatMessage(io.openAsPageTitle):void 0},e))})}const ro=(0,s.forwardRef)(((e,t)=>{const{store:o,collectionStore:i,buttonStyle:n,textStyle:r,recordIconStyle:a,format:l,editButtonClickProps:d,onContextMenu:p,quickActionButtons:u,quickActionButtonsStyle:m,onTab:g,onUntab:y,forceMouseEntered:b,iconActionFrom:w,iconSize:M,showIcon:T}=e,I=(0,f.O7)(),P=(0,v.Fg)(),x=(0,_.Ri)(i,e.property),{baseStyles:B,collectionContextStore:Z,isReadOnly:E,isDisabled:R}=(0,s.useContext)(C.O),A=(0,c.VK)((()=>(0,Ht.JI)(o)),[o],{useDeepEqual:!0}),D=(0,c.VK)((()=>{const e=jt.Z.state;return Boolean(e.isActive&&e.store.id===o.id)}),[o]),{icon:F,iconStore:L,isEmptyPage:V,recordTable:N,blockType:U,hasError:H}=(0,c.VK)((()=>{var e;return{icon:o.getIcon(),iconStore:o.getIconStore(),isEmptyPage:o.isEmptyPage(),recordTable:null===(e=o.getIconStore())||void 0===e?void 0:e.table,blockType:o.getType(),hasError:o.hasError()}}),[o],{useDeepEqual:!0}),z=(0,c.VK)((()=>Wt.Xp(o,{recursivelyLoadAllDiscussions:!1})),[o]),W=(0,c.VK)((()=>{const e=o.getFormatStore().getKeyStore("uri").getValue(),t=e&&Ft.Nm({str:e,allowNoProtocol:!1});return t&&(0,zt.pI)(t,o.pointer.spaceId)}),[o]),j=(0,v.yK)((()=>({textStyle:{...B.textStyle,display:"inline",fontWeight:Dt.Z.fontWeight.medium,...r},buttonStyle:{...B.buttonStyle,...n},quickActionButtonsStyle:{...m},buttonPressedStyle:B.buttonPressedStyle??{background:"none"},buttonHoveredStyle:B.buttonHoveredStyle??{background:"none"},recordIconStyle:{display:"inline-flex",verticalAlign:"text-top",...a},externalLinkBox:{flexShrink:1,width:"none",padding:"0 4px",marginLeft:-4,borderRadius:3},discussionIndicator:{display:"inline-flex",alignItems:"center",color:P.lightTextColor,fontSize:12,fontWeight:Dt.Z.fontWeight.semibold,marginLeft:8,verticalAlign:"text-top"},errorIcon:{display:"inline-block",verticalAlign:"text-top",marginLeft:1,marginRight:7,paddingBottom:4,width:16,fill:P.accentColors.orange[500]}})),[B.buttonHoveredStyle,B.buttonPressedStyle,B.buttonStyle,B.textStyle,n,m,a,r,P.accentColors.orange,P.lightTextColor]),K=(0,s.useCallback)((()=>{Z&&Lt.YU({environment:I,collectionContextStore:Z,block_id:o.id,property:x,from:O.Sy(l),is_external_title_property_id:!0})}),[Z,I,l,x,o.id]),Y=(0,s.useCallback)((e=>{L&&S.createAndCommit({userAction:"TitleProperty.handleRecordIconChange",environment:I,perform:t=>{Nt.sO({store:L,value:e,transaction:t})}})}),[I,L]),G=(0,s.useCallback)((e=>{"Enter"!==(null==e?void 0:e.key)&&Vt.IH({store:o})}),[o]),X=(0,s.useCallback)((()=>{jt.Z.setState({isActive:!1}),Ut.ZH(I),Ot.Ys({environment:I,store:o})}),[o,I]),q=(0,s.useMemo)((()=>h()(Gt.Z,{store:A,disabled:!D,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableEmbedMenu:!0,disableShiftEnter:!0,onEnter:X,onEsc:X,onTab:g,onUntab:y,onChange:G,placeholder:D?Pe.default.formatMessage(po.typeAName):Pe.default.formatMessage(po.untitledBlock),style:j.textStyle,disableSelectAllBlocks:!0,pasteBehavior:"inline"})),[A,D,G,g,y,j.textStyle,X]),$=(0,s.useMemo)((()=>H?Ie.Z.warning(j.errorIcon):"withContent"===T&&void 0===F&&V?s.createElement(s.Fragment,null):h()(Yt.Z,R?{disabled:!0,icon:F,isEmptyPage:V,size:M,style:j.recordIconStyle}:{disabled:!1,bucket:"secure",store:o,icon:F,isEmptyPage:V,size:M,iconLoggingData:{collection_id:i.id,recordTable:N,source:w,block_type:U},style:j.recordIconStyle,onChange:Y})),[U,i.id,Y,H,F,w,R,V,M,N,T,o,j.errorIcon,j.recordIconStyle]),J=(0,s.useMemo)((()=>z>0&&h()("span",{style:j.discussionIndicator},"discussion-indicator",Ie.Z.speechBubble({width:14,height:14,marginRight:4,fill:P.mediumIconColor}),z)),[z,j.discussionIndicator,P.mediumIconColor]);return s.createElement(k.Z,{ref:t,disabled:R,readOnly:E,editButtonClickProps:d,onContextMenu:p,style:j.buttonStyle,pressedStyle:j.buttonPressedStyle,hoveredStyle:j.buttonHoveredStyle,quickActionButtons:u,quickActionButtonsStyle:j.quickActionButtonsStyle,quickActionButtonsTrigger:b?"force_visible":"default"},$,(0,Rt.us)(x)&&W?h()(Kt.Z,{href:W,style:{display:"inline-flex"},innerStyle:j.externalLinkBox,external:!0,onClick:K},void 0,q):q,J)})),ao=(0,s.forwardRef)(((e,t)=>{const{store:o,handleOpenPeekPage:i,width:r}=e,a=(0,v.yK)((e=>({textStyle:{...O.z0(e)},recordIconStyle:{height:24,width:24,marginTop:-3,marginRight:2}})),[]);return s.createElement(ro,n()({},co(e,t,a),{iconActionFrom:"collection_table_view",showIcon:"withContent",iconSize:20,quickActionButtons:h()(no,{handleOpenPeekPage:i,store:o,showLabel:void 0===r||r>100})}))})),so=(0,s.forwardRef)(((e,t)=>{const{store:o}=e,{isReadOnly:i}=(0,s.useContext)(C.O),{isPhone:r}=(0,f.Fy)(),a=(0,c.VK)((()=>{const e=jt.Z.state;return Boolean(e.isActive&&e.store.id===o.id)}),[o]),l=(0,v.yK)((e=>({buttonStyle:{marginLeft:0,marginRight:"auto",maxWidth:"max(75%, 400px)",minWidth:r?void 0:240,padding:"0 6px"},textStyle:{fontSize:16,whiteSpace:a?"normal":"nowrap",pointerEvents:a?void 0:"none",cursor:a?"text":void 0,borderBottom:`1px solid ${e.tableDividerColor}`,width:"auto"},recordIconStyle:{marginRight:5,marginTop:3},actionButton:{marginLeft:10}})),[a,r]),d=!i&&!a;return s.createElement(ro,n()({},co(e,t,l),{iconActionFrom:"collection_list_view",showIcon:"always",iconSize:22,editButtonClickProps:void 0,quickActionButtons:d?h()(Jt,{store:o}):h()(no,{store:o,showLabel:!1})}))})),lo=(0,s.forwardRef)(((e,t)=>(At.log({level:"error",from:"BlockPropertyRouter",type:"InvalidTitlePropertyFormat"}),s.createElement(ro,n()({},co(e,t),{iconActionFrom:"collection_table_view",showIcon:"always",iconSize:20})))));function co(e,t,o){const{store:i,collectionStore:n,property:r,onContextMenu:a,format:s,onTab:l,onUntab:c,forceMouseEntered:d}=e;return{ref:t,store:i,collectionStore:n,property:r,editButtonClickProps:(0,_.Qg)(e),onContextMenu:a,buttonStyle:null==o?void 0:o.buttonStyle,textStyle:null==o?void 0:o.textStyle,recordIconStyle:null==o?void 0:o.recordIconStyle,quickActionButtonsStyle:null==o?void 0:o.quickActionButtonsStyle,format:s,onTab:l,onUntab:c,forceMouseEntered:d}}const po=(0,W.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewItemTitle.untitledBlock",description:"Default empty text for collection view item with no title"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewItemTitle.itemName.placeholder",description:"Placeholder text when editing the title of a collection view item"}});var uo=o(52576),mo=o(78030);const go=a().memoize((e=>s.forwardRef(((t,o)=>s.createElement(C.Z,t,s.createElement(e,n()({ref:o},t))))))),ho=s.forwardRef(((e,t)=>{const o={...e,format:mo.C.Page};return s.createElement("div",{style:{marginLeft:-2},ref:t},s.createElement(m.Z,o))}));const fo=function(e){window.__c={n:"BlockPropertyRouter"};const{property:t,collectionStore:o,format:i}=e,{type:r}=(0,_.PJ)(o,t)||{},a=(0,s.useContext)(d.Ue),g=(0,s.useRef)(null),h=(0,c.VK)((()=>u.default.getEligibleGroup({experimentId:"block_property_router",defaultGroup:"control"})),[]);if((0,l.c)(p.Z,(()=>({getNode:()=>{const{current:e}=g;return e?"getNode"in e?e.getNode():e:null},getProps:()=>{const i=o.getMappedProperty(t);return{...e,property:i}},getContextHorizontalScroller:()=>null==a?void 0:a.horizontalScroller,getContextVerticalScroller:()=>null==a?void 0:a.verticalScroller})),[e]),!r)return null;const f=function(e,t,o){const i="on_v2"===o;switch(e){case mo.C.Table:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(q):m.Z;case"verification":return go(uo.aq);case"checkbox":return i?go(T):m.Z;case"multi_select":return i?go(me):m.Z;case"select":return i?go(lt):m.Z;case"person":case"created_by":case"last_edited_by":return i?go($e):m.Z;case"text":return i?go(Ct):m.Z;case"title":return i?go(ao):m.Z;case"number":return i?go(Fe):m.Z;case"url":case"email":case"phone_number":case"file":case"status":case"formula":case"relation":case"rollup":case"button":case"auto_increment_id":case"location":return m.Z}break;case mo.C.Board:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(Q):m.Z;case"verification":return go(uo.Aj);case"checkbox":return i?go(B):m.Z;case"select":return i?go(ut):m.Z;case"multi_select":return i?go(ve):m.Z;case"person":case"created_by":case"last_edited_by":return i?go(tt):m.Z;case"text":return i?go(Tt):m.Z;case"title":return i?go(lo):m.Z;case"number":return i?go(Ne):m.Z;default:return m.Z}case mo.C.Calendar:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(ee):m.Z;case"verification":return go(uo.qO);case"checkbox":return i?go(Z):m.Z;case"select":return i?go(mt):m.Z;case"multi_select":return i?go(ye):m.Z;case"person":case"created_by":case"last_edited_by":return i?go(ot):m.Z;case"text":return i?go(It):m.Z;case"title":return i?go(lo):m.Z;case"number":return i?go(Oe):m.Z;default:return m.Z}case mo.C.Page:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(X):m.Z;case"checkbox":return i?go(I):m.Z;case"verification":return go(uo.l5);case"select":return i?go(ct):m.Z;case"multi_select":return i?go(ge):m.Z;case"person":case"created_by":case"last_edited_by":return i?go(Je):m.Z;case"text":return i?go(kt):m.Z;case"title":return i?go(lo):m.Z;case"number":return i?go(De):m.Z;default:return m.Z}case mo.C.CompactPage:switch(t){case"date":case"created_time":case"last_edited_time":return go($);case"person":case"created_by":case"last_edited_by":return go(Qe);case"select":return go(dt);case"multi_select":return go(he);case"checkbox":return go(P);case"verification":return go(uo.yG);case"text":return i?go(_t):ho;case"title":return i?go(lo):ho;case"number":return i?go(Le):ho;default:return ho}case mo.C.ListView:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(J):m.Z;case"verification":return go(uo.Cl);case"checkbox":return i?go(x):m.Z;case"select":return i?go(pt):m.Z;case"multi_select":return i?go(fe):m.Z;case"person":case"created_by":case"last_edited_by":return i?go(et):m.Z;case"text":return i?go(Mt):m.Z;case"title":return i?go(so):m.Z;case"number":return i?go(Ve):m.Z;default:return m.Z}case mo.C.GalleryView:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(te):m.Z;case"verification":return go(uo.Rb);case"checkbox":return i?go(E):m.Z;case"select":return i?go(gt):m.Z;case"multi_select":return i?go(be):m.Z;case"person":case"created_by":case"last_edited_by":return i?go(it):m.Z;case"text":return i?go(Pt):m.Z;case"title":return i?go(lo):m.Z;case"number":return i?go(Ue):m.Z;default:return m.Z}case mo.C.Timeline:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(oe):m.Z;case"verification":return go(uo.pc);case"checkbox":return i?go(R):m.Z;case"select":return i?go(ht):m.Z;case"multi_select":return i?go(Se):m.Z;case"person":case"created_by":case"last_edited_by":return i?go(nt):m.Z;case"text":return i?go(xt):m.Z;case"title":return i?go(lo):m.Z;case"number":return i?go(He):m.Z;default:return m.Z}case mo.C.Relation:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(ie):m.Z;case"verification":return go(uo.aJ);case"checkbox":return i?go(A):m.Z;case"select":return i?go(ft):m.Z;case"multi_select":return i?go(we):m.Z;case"person":case"created_by":case"last_edited_by":return i?go(rt):m.Z;case"text":return i?go(Bt):m.Z;case"title":return i?go(lo):m.Z;case"number":return i?go(ze):m.Z;default:return m.Z}case mo.C.RelationSection:switch(t){case"date":case"created_time":case"last_edited_time":return i?go(ne):m.Z;case"verification":return go(uo.AB);case"